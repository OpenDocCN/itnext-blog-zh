<html>
<head>
<title>From Monolith to Service Mesh, via a Front Proxy — Learnings from stories of building the Envoy Proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从整体到服务网状，通过前台代理——从构建特使代理的故事中学习</h1>
<blockquote>原文：<a href="https://itnext.io/from-monolith-to-service-mesh-via-a-front-proxy-learnings-from-stories-of-building-the-envoy-9dab4b721089?source=collection_archive---------4-----------------------#2018-09-13">https://itnext.io/from-monolith-to-service-mesh-via-a-front-proxy-learnings-from-stories-of-building-the-envoy-9dab4b721089?source=collection_archive---------4-----------------------#2018-09-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2ca8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<a class="ae kl" href="https://www.youtube.com/watch?v=t_hfoAKMgOo" rel="noopener ugc nofollow" target="_blank">服务网</a>的概念在微服务和容器生态系统中得到了广泛的关注。这项技术有望使服务之间内部网络通信均匀化，并提供跨领域的非功能关注点，如可观察性和容错。然而，支持服务网格的底层代理技术也可以在您的系统边缘(入口点)提供大量价值，特别是在像<a class="ae kl" href="https://www.getambassador.io/" rel="noopener ugc nofollow" target="_blank">开源Kubernetes-native Ambassador gateway</a>这样的API网关内。</p><h1 id="965b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">SOA网络的现状</h1><p id="9f92" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在去年由特使代理的创造者之一<a class="ae kl" href="https://twitter.com/mattklein123?lang=en" rel="noopener ugc nofollow" target="_blank">马特·克莱恩</a>所做的一次演讲中，他将2013年面向服务架构(SOA)和微服务网络的状态描述为“<a class="ae kl" href="https://www.microservices.com/talks/lyfts-envoy-monolith-service-mesh-matt-klein/" rel="noopener ugc nofollow" target="_blank">一个非常大且令人困惑的混乱状态</a>”。调试是困难的或不可能的，每个应用程序公开不同的统计数据和日志记录，并且无法跟踪在参与生成响应的整个服务调用栈中请求是如何处理的。对基础架构组件(如托管负载平衡器、缓存和网络拓扑)的了解也很有限。</p><blockquote class="lp lq lr"><p id="291f" class="jn jo ls jp b jq jr js jt ju jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj kk ij bi translated">太痛苦了。我认为大多数公司和组织都知道SOA(微服务)是未来的一种，实际做它会带来很多灵活性，但在日复一日的基础上，人们会感到很受伤。这种伤害主要与调试有关。</p></blockquote><p id="e6ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">维护基于web的分布式应用程序的可靠性和高可用性是大型组织面临的核心挑战。这些挑战的解决方案通常包括重试逻辑、超时、速率限制和断路的多次或部分实施。许多定制和开源解决方案使用特定于语言(甚至可能是特定于框架)的解决方案，这意味着工程师无意中“基本上永远”将自己锁定在技术堆栈中。克莱恩和他在Lyft的团队认为一定有更好的方法。</p><blockquote class="lp lq lr"><p id="dfb6" class="jn jo ls jp b jq jr js jt ju jv jw jx lt jz ka kb lu kd ke kf lv kh ki kj kk ij bi translated">最终，健壮的可观察性和简单的调试就是一切。随着SOA变得越来越复杂，我们为所有这些问题提供一个通用的解决方案是至关重要的，否则开发人员的工作效率会停滞不前(并且站点会经常宕机)</p></blockquote><p id="eecd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终，<a class="ae kl" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Envoy proxy </a>被创建成这种更好的方式，这个项目由Matt和Lyft团队于2016年9月在<a class="ae kl" href="https://eng.lyft.com/announcing-envoy-c-l7-proxy-and-communication-bus-92520b6c8191" rel="noopener ugc nofollow" target="_blank"/>开源发布。</p><h1 id="0aad" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">使节的演变</h1><p id="746d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我在之前的一篇文章中讨论了Envoy的核心特性，这篇文章涵盖了Matt的另一篇演讲，但在这里我想谈谈高级负载平衡。代理实现“区域感知最小请求负载平衡”，并提供每个区域的特使指标。正如浮力团队在他们的博客文章“<a class="ae kl" href="https://blog.buoyant.io/2016/03/16/beyond-round-robin-load-balancing-for-latency/" rel="noopener ugc nofollow" target="_blank">超越循环法:延迟的负载平衡</a>”中所述，在应用程序/网络堆栈中的这一点上执行负载平衡允许比SOA网络中通常看到的更高级的算法。Envoy还提供流量阴影，可用于将流量分支(和克隆)到测试集群，这被证明是一种在生产中测试基于微服务的应用的流行方法。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi lw"><img src="../Images/0beba393e9e9b838818f90823ea33523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDLMnDDlmwr9PbLzcfvNNQ.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">Lyft当前的服务网状架构</figcaption></figure><p id="7178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Envoy之类的第7层(L7)代理提供的一个核心功能是，通过基于特定于应用程序的数据(如HTTP头)做出路由决策，提供智能部署控制。这允许相对容易地实施蓝/绿部署和金丝雀测试，这也具有以接近实时的速度可控的优势(与使用部署机制来初始化和停用虚拟机或pod以确定哪些服务服务于流量的方法相比)。</p><h1 id="a16f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">可观性，可观性，可观性</h1><p id="2620" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Matt在演讲中指出，到目前为止，Envoy提供的最重要的东西是可观察性。通过Envoy传输所有服务流量提供了一个单一的位置，在这里您可以:为每一跳生成一致的统计数据；创建一个传播稳定的请求标识符(这也需要一个轻量级应用程序库来完全实现)；并提供一致的日志记录和分布式跟踪。</p><p id="aab3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">围绕特使建造的大使API网关包含了与T2相同的原则。指标通过无处不在且经过良好测试的<a class="ae kl" href="https://github.com/etsy/statsd" rel="noopener ugc nofollow" target="_blank"> StatsD </a>协议公开，Ambassador使用典型的StatsD协议设置(UDP到端口8125)自动将统计信息发送到名为statsd-sink的Kubernetes服务。还支持流行的普罗米修斯开源监控系统，并且可以在每个大使吊舱上部署一个StatsD导出器作为侧车。更多详情请见Datawire博客“<a class="ae kl" href="https://www.datawire.io/faster/ambassador-prometheus/" rel="noopener ugc nofollow" target="_blank">库伯内特斯监测特使和大使与普罗米修斯操作员</a>”。</p><p id="b4e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建有效的仪表板本身就是一门艺术，Matt分享了他和他的团队创建的几个仪表板截图，以显示Lyft的Envoy数据。如果您想探索这种仪表盘的真实世界示例，AppDirect的软件开发人员、《AppDirect Kubernetes网络基础设施的演变》一书的作者Alex Gervais最近通过Grafana网站分享了AppDirect团队的Grafana仪表盘。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/7a1faf76efa112ebb7be55ab0f0a6583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*QMRd11viCP8TtZ0m"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">Matt演讲中的特使仪表板示例</figcaption></figure><h1 id="e03b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">特使的未来</h1><p id="1aa6" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">了解Envoy未来发展方向的最佳途径是<a class="ae kl" href="https://www.envoyproxy.io/docs/envoy/latest/" rel="noopener ugc nofollow" target="_blank"> Envoy文档</a>本身。在我在这篇文章中提到的谈话中，Matt暗示了几个已经实现的未来方向。这包括更多的<a class="ae kl" href="https://www.envoyproxy.io/docs/envoy/v1.5.0/configuration/rate_limit" rel="noopener ugc nofollow" target="_blank">速率限制选项</a>(一定要检查v1和v2 APIs)，以及一个<a class="ae kl" href="https://github.com/lyft/ratelimit" rel="noopener ugc nofollow" target="_blank">开源的基于Go的速率限制服务</a>。Datawire团队在suite之后发布了一系列关于如何在Ambassador API网关(实际上是一个特使前端代理)上实现<a class="ae kl" href="https://blog.getambassador.io/tagged/rate-limit-series" rel="noopener ugc nofollow" target="_blank">速率限制的文章，并发布了一个</a><a class="ae kl" href="https://github.com/danielbryantuk/ambassador-java-rate-limiter" rel="noopener ugc nofollow" target="_blank"> Java速率限制服务</a>的演示开源代码。</p><p id="203f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不可否认的是，自从Matt发表演讲以来，这个社区已经以惊人的速度发展。针对<a class="ae kl" href="http://envoyproxy.github.io/community.html" rel="noopener ugc nofollow" target="_blank">特使</a>、<a class="ae kl" href="https://istio.io/community/" rel="noopener ugc nofollow" target="_blank"> Istio </a>和<a class="ae kl" href="https://blog.getambassador.io/growing-the-ambassador-api-gateway-community-7fa7ed064c9c" rel="noopener ugc nofollow" target="_blank">大使</a>(以及其他几个基于特使的服务)的社区非常活跃，非常有用。那么，你还在等什么？参与并帮助引领现代云原生应用程序架构核心组件的未来。你可以在这里加入对话<a class="ae kl" href="http://d6e.co/slack" rel="noopener ugc nofollow" target="_blank">！</a></p><p id="d1ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ls">本文原载于</em> <a class="ae kl" href="https://blog.getambassador.io/from-monolith-to-service-mesh-via-a-front-proxy-learnings-from-stories-of-building-the-envoy-333711bfd60c" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> getambassador.io博客</em> </a> <em class="ls">。</em></p></div></div>    
</body>
</html>