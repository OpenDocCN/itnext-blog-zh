<html>
<head>
<title>Canary Deployments: So Much To Love!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金丝雀部署:太可爱了！</h1>
<blockquote>原文：<a href="https://itnext.io/canary-deployments-so-much-to-love-1fcf0257ac74?source=collection_archive---------5-----------------------#2019-05-22">https://itnext.io/canary-deployments-so-much-to-love-1fcf0257ac74?source=collection_archive---------5-----------------------#2019-05-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/62e2deeea301386634cab8aad235a470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-daPsIPnlXNCcskP"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">艾萨克·本赫瑟德在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0580" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Canary部署是一个很好的例子，说明了Istio和App Mesh等服务网格在微服务环境中实现的自动化和规模。服务网格在安全性、可观察性和流量转移方面有很多好处，所有这些都有助于更轻松地进行大规模部署。南北向(应用集群内外)和东西向(集群内的服务对服务)的易操作性，尤其是微服务架构。微服务架构是关于如何组织您的代码、人员和流程以提高速度。将您的代码快速投入生产，并从最终用户那里获得快速反馈。然而，您不希望牺牲良好的用户体验来换取这样的速度，这就是在您的部署中自动化金丝雀模式可以提供帮助的地方。无论您是已经完全投入到服务网格部署中，还是只需要足够的功能就可以开始部署，都有几种选择可供您选择。</p><p id="45f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">高级Canary部署模式是，当将应用程序变更部署到生产中时，您慢慢地将一小部分请求转移到变更中，并验证它是否按预期处理这些请求。如果一切顺利，您可以不断增加请求流量的百分比，直到您的版本更改处理所有请求，此时您可以关闭该代码的先前版本。金丝雀部署模式帮助您控制生产变化的“爆炸半径”影响。为您的所有服务部署自动化Canary部署模式(理想情况下作为可配置的策略),使您的应用程序团队能够快速将增强功能投入生产，同时降低中断业务或提供糟糕客户体验的风险。</p><p id="aa73" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">三个功能帮助团队自动化金丝雀模式部署:部署控制器、服务健康可观察性和请求流量转移。Kubernetes 提供了一个运行时控制器模式，它可以监视一个声明性的定制资源来启用一个金丝雀部署策略。<a class="ae kf" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>是一个很好的选择，用于捕获健康指标，帮助您监控您的版本变更是否按预期执行，以便您可以决定是否将更高比例的请求转移给它，或者由于太多错误而回滚。<a class="ae kf" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Envoy </a>提供了一个出色的数据平面，既提供了流量转移，例如，10%的请求服务v1，90%的请求服务v2。Envoy还提供了许多关于与服务的请求和响应交互的指标，这些指标可以输入Prometheus来帮助检查Canary服务的运行状况。</p><p id="c487" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">部署在Kubernetes上的服务网格当然会为您提供所有这些功能，甚至更多，尽管这不是唯一的选择。越来越多的基于Envoy的入口/网关为您提供自动化Canary部署所需的功能，而没有像Istio这样的全服务网格安装的所有额外复杂性/优势。如果您的Kubernetes部署规模较小或资源有限，比如只部署了几个微服务，那么这个更有限的堆栈会很有帮助。您可能还会发现使用这个较小的堆栈更容易开始/试验。</p><p id="8c75" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把这个说得更具体些。Weaveworks支持一个开源技术调用<a class="ae kf" href="https://github.com/weaveworks/flagger" rel="noopener ugc nofollow" target="_blank"> Flagger </a>,通过让您在Kubernetes中为每个部署的Kubernetes服务定义一个金丝雀自定义资源(CRD ),支持自动金丝雀部署。Flagger在服务网格上分层，以处理流量转移和指标收集，作为实现Canary部署的一部分。我以前在《<a class="ae kf" href="https://medium.com/solo-io/supergloo-to-the-rescue-making-it-easier-to-write-extensions-for-service-meshes-50313a401692" rel="noopener">超级格洛拯救世界》中写过。</a>”以及在<a class="ae kf" href="https://supergloo.solo.io/" rel="noopener ugc nofollow" target="_blank"> SuperGloo </a>上部署Flagger的完整工作代码示例。SuperGloo是一个多服务网格编制器/管理器，可以安装和管理一个或多个服务网格，如Istio、App Mesh、Linkerd等，SuperGloo帮助激发了微软在2019年5月在巴塞罗那KubeCon上宣布的<a class="ae kf" href="https://smi-spec.io/" rel="noopener ugc nofollow" target="_blank"> SMI互操作性标准</a>。Flagger最近增加了对Ingress' like <a class="ae kf" href="https://gloo.solo.io/" rel="noopener ugc nofollow" target="_blank"> Gloo </a>的支持，这为那些确实需要服务网格的所有额外功能(和复杂性)的人提供了一个更轻量级的金丝雀部署选项。</p><p id="deae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Gloo不是一个服务网格。这是一个基于特使的网关，是管理南北入口流量的绝佳选择。如果您需要的只是流量转移，它可以提供与Istio相同的流量转移功能，而没有额外的复杂性。例如，Knative Serving项目添加了<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/knative-and-solo-io-gloo-2a877d456238"> Gloo作为Istio </a>的替代方案，原因完全相同——Knative Serving只需要流量转移功能，就可以将其规模缩小到零功能。最近<a class="ae kf" href="https://jenkins-x.io" rel="noopener ugc nofollow" target="_blank"> Jenkins X </a>项目<a class="ae kf" href="https://jenkins-x.io/developing/knative/" rel="noopener ugc nofollow" target="_blank">将Knative Serving </a>功能添加到CI/CD功能组合中，他们选择将Knative Service与Gloo结合使用，以保持其强大平台的轻便和敏捷。</p><p id="c62a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Gloo安装和运行Flagger的说明与我为使用SuperGloo安装/管理Istio(或App Mesh)的Flagger提供的说明非常相似。区别在于安装Gloo和SuperGloo，并配置Flagger使用Gloo作为它的“meshProvider”。完整的安装和运行脚本可以在<a class="ae kf" href="https://docs.flagger.app/usage/gloo-progressive-delivery" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="b6c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您继续发展您的微服务架构时，使用金丝雀模式自动化您的部署是获得速度和可控风险的好方法。像Flagger、SuperGloo和Gloo这样的开源项目有助于更容易地使用和消费足够的新技术，以获得立竿见影的效果，同时还可以在准备好的时候轻松采用更先进的技术。</p></div></div>    
</body>
</html>