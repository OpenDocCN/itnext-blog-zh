<html>
<head>
<title>Getting Started with Netmaker: A WireGuard® Virtual Networking Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Netmaker入门:WireGuard虚拟网络平台</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-netmaker-a-wireguard-virtual-networking-platform-3d563fbd87f0?source=collection_archive---------0-----------------------#2021-08-11">https://itnext.io/getting-started-with-netmaker-a-wireguard-virtual-networking-platform-3d563fbd87f0?source=collection_archive---------0-----------------------#2021-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6b1d672610fa5554c95722d7961786d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmRAYajC7Fo9V4y_R5UHXw.png"/></div></div></figure><p id="8383" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Gravitl刚刚发布了0.7版本的<a class="ae kw" href="https://github.com/gravitl/netmaker" rel="noopener ugc nofollow" target="_blank"> Netmaker </a>，这是一个通过WireGuard连接Linux服务器的网状VPN。Netmaker通常被视为Tailscale、ZeroTier或OpenVPN的替代产品。</p><p id="5356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在过去的四个月里，Netmaker的功能集已经发展并专门支持Kubernetes、物联网和远程网络连接。</p><p id="3a00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">V0.7是一次重大的内部技术革新，将数据库从MongoDB迁移到rqlite (RAFT consensus + sqlite)，增加了日志冗长性，并简化了GRPC模型。</p><p id="fa28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker v0.7增加了几个新特性，包括UDP打洞、NAT遍历、Kubernetes清单和多租户。</p><p id="ffd3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近进行的测试显示，基于Netmaker的网络运行速度比其他顶级网状VPN选项(如Tailscale和ZeroTier)快50%以上。</p><p id="af44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将浏览Netmaker的UI和客户机(netclient ),以了解该平台是如何工作的。在开始之前，有必要考虑一些用例。</p><p id="72d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然这个列表并不全面，但是Netmaker是一个高度可配置的平台，所以请花一些时间来阅读这个列表，它将有助于为给定的用例确定适当的配置。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="f336" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">远程连接</h1><p id="3ebb" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">从事咨询、托管服务和系统管理的专业人员通常需要远程访问。Netmaker为第三方提供了快速、安全的远程环境访问，并提供了站点间联网和出口网关等有用的功能。这对客户也很有用，他们可以设置第三方访问的到期日期，并在需要时轻松添加和删除访问。</p><h1 id="ea6f" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">库伯内特斯</h1><p id="afc1" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在云之间运行集群非常具有挑战性。Netmaker提供了一个跨云和混合环境运行集群的系统，具有连续、安全的网络。Netmaker可以在多集群场景中为Submariner提供类似的功能。Netmaker还可以跨多个云扩展单个集群，并允许安全访问集群外的资源，如数据库、API和存储。有关Kubernetes用例的更多信息，请参见<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/8-use-cases-for-kubernetes-over-vpn-unlocking-multicloud-flexibility-3958dab2219f">本帖</a>。</p><h1 id="22a8" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">物联网</h1><p id="608e" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">物联网设备需要快速、自动化和安全的网络，能够快速添加和移除设备。Netmaker提供了一种简单的方法来动态地将物联网设备整合到一个扁平的私有网络中，设备可以自主地加入和离开，而不需要人工操作。由于网络运行在内核WireGuard之上，因此可以保证它们尽可能快地运行，以避免任何性能损失。</p><h1 id="2f6d" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">家庭网络</h1><p id="56e4" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">家庭实验室运营商和自主托管爱好者经常在寻找简化和保护家庭网络的方法，以实现远程访问和服务间的互连。Netmaker简化了家庭网络模型，使其易于管理。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="9bf3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经回顾了一些用例，让我们来谈谈Netmaker是如何工作的。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7468" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">架构</strong></h1><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/5c754b943e3d3b06ff3dffd253ea545d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*h13xuSh1CoLyXj9btHwpmg.png"/></div></figure><p id="4e08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker遵循客户机-服务器体系结构。Netmaker服务器由一个用于管理网络的UI仪表板、一个API和一个与客户端通信的GRPC服务器组成。或者，可以部署管理私有DNS的DNS服务器(CoreDNS)。</p><p id="dd91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">客户机(netclients)是简单的二进制文件，设计用于在大多数Linux系统上运行。这些客户端自动进行WireGuard管理，并保持对等配置最新。</p><p id="a222" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要与“中心辐射”模型混淆，流量不通过服务器路由。相反，服务器充当虚拟网络的配置存储和状态管理服务。</p><p id="b10c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">客户机向服务器登记以维护它们的状态，寻找它们需要的任何改变，并检索对等点列表，这允许它们建立直接的对等连接(全网状)。这将创建一个类似于本地子网或VPC的拓扑。</p><h1 id="6381" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">安装</h1><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/87675db29b563880d80626208af72d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*HRlVwyGEAigZACKCcAe7Pw.png"/></div></figure><p id="ae62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker被设计为部署在容器中，尽管它也可以独立部署。Netmaker可以与docker、docker-compose和Kubernetes清单一起部署。</p><p id="1c31" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Kubernetes集群，您可以使用<a class="ae kw" href="https://github.com/gravitl/netmaker/tree/develop/kube" rel="noopener ugc nofollow" target="_blank">提供的清单</a>来部署Netmaker服务器和netclient daemonset。</p><p id="20ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于中小型环境，Netmaker通常部署在具有静态公共IP的云虚拟机上。Netmaker应该在一个Nginx代理后面运行，并带有一个自定义域，如netmaker.example.com。</p><p id="1957" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://netmaker.readthedocs.io/en/develop/quick-start.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">您可以在这里查看有指导的【快速入门】安装</strong> </a> <strong class="ka ir">。</strong></p><h1 id="d69d" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">服务器使用</h1><p id="87e1" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">一旦Netmaker启动并运行，问题就变成了，你用它做什么？如果您不确定，请花点时间回顾一下用例。这将决定您希望如何设置您的网络，以及您希望启用哪些其他功能:</p><ul class=""><li id="27fb" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated">如果部署在Kubernetes上，Netmaker包括一个netclient daemonset，它将部署在集群中的ever节点上，并将它们添加到指定的WireGuard网络中。</li><li id="5f05" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">如果部署站点到站点网络，您可能希望创建两个网络并用出口网关将它们桥接在一起。</li><li id="2b11" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">如果部署为安全地访问远程资源，您可能希望使用“外部客户端”来扩展网络，从而允许Windows和phone用户访问网络。您可能还想用专用DNS扩展这个网络，这样您就可以通过“files.officenet.private”访问文件服务器。</li></ul><p id="fa3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住这一点，让我们通过探索选项卡来深入了解Netmaker的各种功能。</p><h1 id="b403" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">网络</h1><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/7a3dde8b1598512bbbb0bc1490442224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BrD7k78-ovDJg_oieGHIFA.png"/></div></div></figure><p id="cb13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker允许您定义任意数量的专用网络，这些网络可以在您喜欢的任何地址范围内运行。您只需给它命名，给它一个地址范围，并选择要启用的选项，例如:</p><ul class=""><li id="21f2" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><strong class="ka ir">双栈:</strong>向您的网络添加ipv6地址</li><li id="00a8" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><strong class="ka ir">仅限本地:</strong>网络不会通过公共互联网路由，例如，在数据中心、VPC或家庭/办公室网络内。</li><li id="324e" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><strong class="ka ir">打孔:</strong>端点和端口被动态配置和发现，允许对等体更容易地“打孔”通过NAT。</li></ul><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/d933e36f69169519e4cb5bb9d11312e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4D-yOsv3O_KYav75f9esyg.png"/></div></div></figure><p id="8522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦创建了网络，就可以向网络管理员授予访问权限(参见下面的"<strong class="ka ir">管理用户"</strong>)。</p><p id="3cb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网络管理员对他们创建的网络有很大程度的控制，而不需要对单个机器进行SSH。例如，它们可以更改私有地址范围，节点会相应地更新自己。如果他们认为网络已经被破坏，他们可以使网络中的所有节点刷新他们的公钥。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/607883e0ad7f14276ca87f5fd88e8aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYl5_4ph5hd234MYIDt3zA.png"/></div></div></figure><p id="94c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们还可以在网络级别为节点设置设置“默认设置”，如Keepalives、默认WireGuard端口、网络接口名称，以及为高级设置(如iptables配置)设置post up/down命令。</p><h1 id="4442" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated"><strong class="ak">节点</strong></h1><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6b1d672610fa5554c95722d7961786d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmRAYajC7Fo9V4y_R5UHXw.png"/></div></div></figure><p id="2cc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">节点只是一台机器，通常是运行Linux的服务器，安装了netclient和WireGuard。该节点通过专用网络连接到所有其他节点。一旦节点被添加到网络中，网络管理员就有了很大的控制权。从中央服务器，他们可以更改网络中单个机器上的许多网络设置，例如:</p><ul class=""><li id="55f3" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated">名字</li><li id="1644" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">私人地址</li><li id="9337" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">到期日期(到期后从网络引导)</li><li id="95aa" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated">WireGuard设置</li></ul><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/c91bbb726ed31738c316adea90d0a901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*_tU6V3PnskumCTJoCuDX7Q.png"/></div></figure><p id="d667" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们还可以删除不应再出现在网络中的节点，从而取消对它们的访问。</p><p id="3dca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这使得网络管理员可以管理像Kubernetes和IoT这样的用例的半自动机器群。它还允许他们保持对受信任的用户网络的控制，其中他们知道哪些机器可以访问什么，以及如何在任何时候删除该访问。</p><p id="0aae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重要的是，网络管理员可以将节点指定为<strong class="ka ir">出口</strong>或<strong class="ka ir">入口</strong>网关。这允许它们将流量从外部客户端<strong class="ka ir">路由到</strong>网络(入口)，或者从网络路由到指定的IP范围(出口)。这两个特性开辟了标准网状网络之外的广泛使用案例。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/b62909128cf0d32811d5d89e7a9d2df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*981Vpofc90QN9O-u4o3llg.png"/></div></div></figure><h1 id="b90a" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">访问键</h1><p id="514d" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">要访问网络，节点通常需要访问密钥(尽管您可以选择切换到手动批准过程)。</p><p id="322b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您允许朋友加入您的网络，访问密钥可以使用1次；如果您管理大量设备，访问密钥可以使用100000次。您可以创建任意多个，然后删除它们使其无效。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/39f96e7d49e9bb571b7a1b70e871d044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpiJ06vBMxPPx8qyeTwVmw.png"/></div></div></figure><p id="c95a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">访问键只显示一次，并将显示三个选项:</p><ol class=""><li id="39a1" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv nl my mz na bi translated">原始访问密钥，当客户端需要特殊配置时</li><li id="1a24" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv nl my mz na bi translated">访问令牌，它将访问密钥与用于加入网络的参数(如地址、端口和网络名称)包装在一起。这个令牌由netclient解码，当您运行<strong class="ka ir"> netclient join -t &lt;令牌&gt;时，参数被解析。</strong></li><li id="dfbe" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv nl my mz na bi translated">一个安装脚本，用于标准Linux服务器上的首次安装。它只需下载netclient并为您运行“join”命令。</li></ol><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/f52932a2e125a4d83d071012a8cae9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6x-6pB17mPfIa5Tj9oTNsA.png"/></div></div></figure><h1 id="299d" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">私有DNS</h1><p id="5a05" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">如果启用，Netmaker将通过CoreDNS为您维护专用DNS。Netmaker将为网络中的每个节点创建默认条目。</p><p id="0ded" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以创建自定义DNS条目，例如sqlserver.mynetwork。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/16fc6463b79824fc48c801d544973164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rXpRUdxNChmopr68p36Xeg.png"/></div></div></figure><p id="659d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前只有安装了<strong class="ka ir"> resolvectl </strong>的Linux服务器支持DNS管理。</p><h1 id="9468" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">外部客户</h1><p id="933e" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">标准Linux服务器目前支持netclient，但是网络管理员可能希望允许来自运行Windows、iOS、Android或MacOS的设备的访问。</p><p id="e148" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">外部客户端允许<strong class="ka ir">任何运行WireGuard的</strong>设备安全地访问网络，而不允许运行netclient。</p><p id="134b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">管理员创建一个外部客户端，为WireGuard生成一个配置文件。该文件必须由客户端设备下载或扫描。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/7de1d94711c40dda7d5533742c5427da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTkA1emdqnj4N8-_Y3QQcw.png"/></div></div></figure><p id="32b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，设备通过指定的<strong class="ka ir">入口网关访问网络。</strong>设备可以访问整个网络，但如果网络发生重大变化，则必须手动更新。</p><p id="ee24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着越来越多的操作系统不断增加对网络客户机的支持，对外部客户机功能的需求将会减少，客户机应该运行网络客户机。</p><h1 id="7739" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">管理用户</h1><p id="576c" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">Netmaker超级管理员可以创建控制单个网络的“网络管理员”。这使得多个管理员能够在单个Netmaker实例上分别管理他们自己的网络。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/3abeae7bef161f2bfd2d966db0c185f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wD1Q9_Nmx3B3iRnq7k7aXA.png"/></div></div></figure><h1 id="c5aa" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">文件（documents的简写）</h1><p id="87b2" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">对于本演练中未涉及的选项，在netmaker控制台的左上角总是有<a class="ae kw" href="https://docs.netmaker.org/" rel="noopener ugc nofollow" target="_blank"> Docs </a>链接。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/9ef07e92ab6e0922aabe44be0e33a01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fd23u4Fm9J8xKrci7afz5Q.png"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="005c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这包括服务器，但是管理员和用户仍然需要配置添加到网络中的设备。为此，让我们转向网络客户端。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="759f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">网络客户端</h1><p id="8118" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">netclient是一个简单的CLI，用于连接Netmaker服务器和本地WireGuard配置。neclient将管理您想要添加到其中的任意数量的Netmaker网络。您可能希望一台单独的机器成为一个、两个或十个不同网络的一部分。单个netclient实例将管理所有这些。</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="0a8d" class="nv lf iq nr b gy nw nx l ny nz">alex@home:~$ sudo netclient --help<br/>NAME:<br/>   Netclient CLI - Netmaker's netclient agent and CLI. Used to perform interactions with Netmaker server and set local WireGuard config.</span><span id="1b0c" class="nv lf iq nr b gy oa nx l ny nz">USAGE:<br/>   netclient [global options] command [command options] [arguments...]</span><span id="7051" class="nv lf iq nr b gy oa nx l ny nz">VERSION:<br/>   v0.7.1</span><span id="d7b3" class="nv lf iq nr b gy oa nx l ny nz">COMMANDS:<br/>   join       Join a Netmaker network.<br/>   leave      Leave a Netmaker network.<br/>   checkin    Checks for local changes and then checks into the specified Netmaker network to ask about remote changes.<br/>   push       Push configuration changes to server.<br/>   pull       Pull latest configuration and peers from server.<br/>   list       Get list of networks.<br/>   uninstall  Uninstall the netclient system service.<br/>   help, h    Shows a list of commands or help for one command</span><span id="42aa" class="nv lf iq nr b gy oa nx l ny nz">GLOBAL OPTIONS:<br/>   --help, -h     show help (default: false)<br/>   --version, -v  print the version (default: false)</span></pre><h1 id="53da" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated">它是如何工作的</h1><p id="5ade" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">netclient可以加入网络，推送和拉取更改，以及离开网络。它还有几个用于其他场景的助手命令。首次使用netclient加入网络时，它会尝试在您的设备上将自己设置为托管服务(除非您告诉它不要这样做)。</p><p id="52bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它将创建一个名为/etc/netclient的文件夹，将自己添加到其中，并为您加入的任何网络创建“netconfig-networkname”格式的配置文件。这些配置文件包含机器的状态以及如何配置WireGuard。</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="d275" class="nv lf iq nr b gy nw nx l ny nz">root@workstation:/etc/netclient# ls | sort<br/>netclient<br/>netconfig-default<br/>netconfig-my-net<br/>netconfig-testnet<br/>nettoken-default<br/>nettoken-my-net<br/>nettoken-testnet<br/>wgkey-default<br/>wgkey-my-net<br/>wgkey-testnet</span></pre><p id="2639" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，netclient创建一个名为netclient@networkname的systemd服务，该服务将在一个计时器(默认为30秒)上定期运行“检查”。它将检查中央服务器，并将它的本地配置(netconfig文件)与服务器告诉它的内容进行比较。它将进行适当的更改，下拉对等项列表，并重新配置WireGuard。</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="fb0d" class="nv lf iq nr b gy nw nx l ny nz">root@workstation:/etc/netclient# ls -l /etc/systemd/system/netc*<br/>190 Jul 16 17:05 /etc/systemd/system/netclient-default.timer<br/>188 Jul 28 23:58 /etc/systemd/system/netclient-my-net.timer<br/>199 Jul 15 20:39 /etc/systemd/system/netclient@.service<br/>190 Jul 28 00:49 /etc/systemd/system/netclient-testnet.timer</span></pre><p id="df04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种关系不是单向的。如果需要从机器上修改机器的设置，用户可以进入“netconfig”文件，更改设置，netclient将在下次检入时发布这些更改。</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="4ecd" class="nv lf iq nr b gy nw nx l ny nz">root@workstation:/etc/netclient# cat netconfig-testnet <br/>node:<br/>    name: node-ZKTDz<br/>    interface: nm-testnet<br/>    network: testnet<br/>    password: $2a$05$N5Uj0BiV/HhkqiA0GU.<br/>    macaddress: 8h:90:b4:03:g1:u5<br/>    localaddress: 192.168.1.11<br/>    wgaddress: 1.2.3.2<br/>    wgaddress6: ""<br/>    roaming: "on"<br/>    dns: "on"<br/>    islocal: ""<br/>    isdualstack: ""<br/>    isingressgateway: "no"<br/>    localrange: ""<br/>    postup: ""<br/>    postdown: ""<br/>    port: 51821<br/>    keepalive: 20<br/>    publickey: Msm7Ab+QFQyq405Y840zhfZ4D1kkZVk36Eo2A=<br/>    privatekey: ""<br/>    endpoint: 83.12.45.70<br/>    isstatic: "no"<br/>    ipforwarding: "on"<br/>    udpholepunch: "yes"<br/>    saveconfig: "yes"<br/>network: testnet<br/>daemon: "on"</span></pre><p id="7e0b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">netclient也可以作为简单的CLI运行，用于调试或用于没有systemd的机器。管理员可以运行“netclient pull”来获取最新的服务器设置，运行“netclient push”来将任何本地更改推送到服务器，运行“netclient leave”来离开网络。</p><h1 id="8f23" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated"><strong class="ak">获取网络客户端并加入网络</strong></h1><p id="c47f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">要加入网络，需要两样东西:网络客户端和令牌。</p><p id="a145" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">netclient可以从github repo <a class="ae kw" href="https://github.com/gravitl/netmaker/releases/tag/0.7" rel="noopener ugc nofollow" target="_blank">这里</a>检索。令牌必须在服务器上生成，并带到要添加到网络的机器上。这可以在单个脚本中完成(如本演练的访问令牌部分)，也可以手动完成。</p><p id="119f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">netclient可以为大多数操作系统编译。如果您的架构不在downloads文件夹中，可以通过(go build)下载并构建源repo。)，这应该足以为大多数平台创建一个功能性的二进制文件(尽管它目前只能在基于Linux的平台上运行)。</p><p id="9753" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦netclient安装在机器上，并且检索到令牌，只需运行:</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="5b3a" class="nv lf iq nr b gy nw nx l ny nz"> sudo netclient join -t &lt;token&gt;</span></pre><p id="2d2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，有许多选项会被忽略，但可能会有所帮助。您可以运行“netclient join - help”来查看完整的列表。例如:</p><p id="08a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> - daemon=off : </strong>不要安装在systemd中。手动管理netclient</p><p id="6966" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> -漫游=关:</strong>维护静态IP。不检查IP更改</p><p id="4c1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">-interface =&lt;value&gt;:</strong>要使用的本地接口名称</p><p id="a712" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> - name= &lt; value &gt; : </strong>网络上节点的名称</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/fc065529101f8174710881ea6d6e4b83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__yfV7OzxJys3UhdR4Luwg.png"/></div></div></figure><h1 id="d84d" class="le lf iq bd lg lh mh lj lk ll mi ln lo lp mj lr ls lt mk lv lw lx ml lz ma mb bi translated"><strong class="ak">排除网络客户端故障</strong></h1><p id="c6b5" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">可通过以下方式查看网络客户端日志:</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="ac19" class="nv lf iq nr b gy nw nx l ny nz">systemctl status netclient@networkname</span></pre><p id="f573" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和</p><pre class="mn mo mp mq gt nq nr ns nt aw nu bi"><span id="d640" class="nv lf iq nr b gy nw nx l ny nz">journalctl -u netclient@networkname</span></pre><p id="3254" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当遇到连接问题时，检查这些日志是非常宝贵的。</p><p id="e022" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能还想运行<strong class="ka ir">WG show&lt;network name&gt;</strong>来查看连接是否通过以及您的对等体列表看起来是否正确。</p><p id="356a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，检查/etc/netclient中的netconfig文件有助于确保设置看起来是正确的，或者运行<strong class="ka ir"> netclient list </strong>来获得一些关于当前安装的网络的信息。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="4ef8" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">结论</strong></h1><p id="f7a4" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">这是Netmaker的旋风之旅。省略了许多选项，这些选项对于保持这种演练的“高水平”是必要的。如果你有兴趣深入研究某个特定的主题或查看我们众多教程中的一个，我们鼓励你阅读<a class="ae kw" href="http://docs.netmaker.org" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="c9ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，可以随时联系<strong class="ka ir">support@gravitl.com</strong>，或者加入<a class="ae kw" href="https://discord.gg/zRb9Vfhk8A" rel="noopener ugc nofollow" target="_blank">不和谐<strong class="ka ir">这里</strong> </a>获取更多实时帮助。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="2d82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="oc"> WireGuard是Jason A. Donenfeld的注册商标。</em></p></div></div>    
</body>
</html>