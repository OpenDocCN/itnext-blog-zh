<html>
<head>
<title>Adding Codable support to UserDefaults with Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Swift为用户默认值添加可编码支持</h1>
<blockquote>原文：<a href="https://itnext.io/adding-codable-support-to-userdefaults-with-swift-26a799bf00e1?source=collection_archive---------6-----------------------#2019-09-16">https://itnext.io/adding-codable-support-to-userdefaults-with-swift-26a799bf00e1?source=collection_archive---------6-----------------------#2019-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c1fd6b890598506895a7613c755879dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5koZvoUUD2oLw7pjG6ZeQ.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/photos/E0AHdsENmDg" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/E0AHdsENmDg</a></figcaption></figure><div class=""/><p id="3d36" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你是一名iOS开发者，你很有可能在过去使用过<strong class="ki jk">用户默认值</strong>来保存和加载本地数据。</p><p id="1263" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">目前，UserDefaults支持以下数据类型:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="35b3" class="ln lo jj lj b gy lp lq l lr ls">- URL<br/>- Any (NSData, NSString, NSNumber, NSDate, NSArray, or NSDictionary)<br/>- Bool<br/>- Double<br/>- Float<br/>- Int<br/>- String</span></pre><h1 id="203b" class="lt lo jj bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">好吧，但是Codable呢？🤔</h1><p id="bddf" class="pw-post-body-paragraph kg kh jj ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">假设我们有一艘符合<strong class="ki jk">代码</strong>的<strong class="ki jk">星际飞船</strong>结构。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="8cad" class="ln lo jj lj b gy lp lq l lr ls">struct Starship: Codable {<br/>    let name: String<br/>    let captain: String<br/>}</span><span id="2861" class="ln lo jj lj b gy mv lq l lr ls">let enterprise = Starship(name: "Enterprise D", captain: "Jean Luc Picard")</span></pre><p id="8f55" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们如何<strong class="ki jk">保存</strong>企业<em class="mw">常量到用户默认值？</em></p><p id="ba42" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">目前，唯一的方法是在保存之前将企业数据转换为数据。稍后，当获取值时，我们需要将<strong class="ki jk">数据</strong>转换成Starship。</p><p id="da5c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很无聊吧？😴</p><p id="c012" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有几个方法可以让<strong class="ki jk">保存</strong>和<strong class="ki jk">加载</strong>一个可编码的值，难道没有用吗？</p><h1 id="84d9" class="lt lo jj bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">改善用户默认值</h1><p id="00a1" class="pw-post-body-paragraph kg kh jj ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">好，让我们将下面的UserDefault扩展添加到我们的项目中。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="6a54" class="ln lo jj lj b gy lp lq l lr ls">extension UserDefaults {</span><span id="0e1d" class="ln lo jj lj b gy mv lq l lr ls">func set&lt;Element: Codable&gt;(value: Element, forKey key: String) {<br/>        let data = try? JSONEncoder().encode(value)<br/>        UserDefaults.standard.setValue(data, forKey: key)<br/>    }</span><span id="87e3" class="ln lo jj lj b gy mv lq l lr ls">func codable&lt;Element: Codable&gt;(forKey key: String) -&gt; Element? {<br/>        guard let data = UserDefaults.standard.data(forKey: key) else { return nil }<br/>        let element = try? JSONDecoder().decode(Element.self, from: data)<br/>        return element<br/>    }</span><span id="2fd4" class="ln lo jj lj b gy mv lq l lr ls">}</span></pre><ul class=""><li id="1e25" class="mx my jj ki b kj kk kn ko kr mz kv na kz nb ld nc nd ne nf bi translated">第一个方法接收一个<strong class="ki jk">可编码值</strong>，并将其保存到UserDefaults。</li><li id="6a72" class="mx my jj ki b kj ng kn nh kr ni kv nj kz nk ld nc nd ne nf bi translated">第二种方法返回与给定键相关联的可编码值。</li></ul><p id="6b06" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">多亏了这些方法，我们现在可以对任何可编码类型使用UserDefaults。</p><h1 id="7f60" class="lt lo jj bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">试验🔨</h1><p id="5225" class="pw-post-body-paragraph kg kh jj ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">最后，我们来做一个测试。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="87b0" class="ln lo jj lj b gy lp lq l lr ls">struct Starship: Codable {<br/>    let name: String<br/>    let captain: String<br/>}</span><span id="a27d" class="ln lo jj lj b gy mv lq l lr ls">let enterprise = Starship(name: "Enterprise D", captain: "Jean Luc Picard")</span><span id="f40f" class="ln lo jj lj b gy mv lq l lr ls">UserDefaults.standard.set(value: enterprise, forKey: "enterprise")</span><span id="46d4" class="ln lo jj lj b gy mv lq l lr ls">let value: Starship? = UserDefaults.standard.codable(forKey: "enterprise")</span></pre><p id="afed" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以打印出<strong class="ki jk">值</strong> <em class="mw"> </em>常数<em class="mw">。</em></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="8534" class="ln lo jj lj b gy lp lq l lr ls">Optional(Starship(name: "Enterprise D", captain: "Jean Luc Picard"))</span></pre><h1 id="8860" class="lt lo jj bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">为什么我们需要声明要获取的值的类型？🤔</h1><p id="09f3" class="pw-post-body-paragraph kg kh jj ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">好问题，为什么我们需要写这个</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="8763" class="ln lo jj lj b gy lp lq l lr ls">let value<strong class="lj jk">: Starship?</strong> = UserDefaults.standard.codable(forKey: "enterprise")</span></pre><p id="4bb9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而不是这个？</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="3d33" class="ln lo jj lj b gy lp lq l lr ls">let value = UserDefaults.standard.codable(forKey: "enterprise")</span></pre><p id="29b4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与其他UserDefaults方法(如<strong class="ki jk">userderfaults . standard . integer(forKey:)</strong>)不同，我们的<strong class="ki jk"> codable(forKey:) </strong>方法并不总是返回相同的类型。</p><p id="d282" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">喂👇</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="0e85" class="ln lo jj lj b gy lp lq l lr ls">struct Starship: Codable {<br/>    let name: String<br/>    let captain: String<br/>}</span><span id="fdc4" class="ln lo jj lj b gy mv lq l lr ls">struct SpaceStation: Codable {<br/>    let name: String<br/>}</span><span id="ce76" class="ln lo jj lj b gy mv lq l lr ls">let enterprise = Starship(name: "Enterprise D", captain: "Jean Luc Picard")<br/>let deepSpace9 = SpaceStation(name: "Deep Space Nine")</span><span id="961a" class="ln lo jj lj b gy mv lq l lr ls">UserDefaults.standard.set(value: enterprise, forKey: "enterprise")<br/>UserDefaults.standard.set(value: deepSpace9, forKey: "deepSpace9")</span><span id="cf28" class="ln lo jj lj b gy mv lq l lr ls">let value0: Starship? = UserDefaults.standard.codable(forKey: "enterprise")<br/>let value1: SpaceStation? = UserDefaults.standard.codable(forKey: "deepSpace9")</span></pre><p id="6f5c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">观察最后两行，我们的方法是返回一艘<strong class="ki jk">星际飞船</strong>，然后返回一艘<strong class="ki jk">空间站</strong>。</p><p id="b7df" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是为什么我们需要告诉我们的方法我们期望的类型。</p></div></div>    
</body>
</html>