<html>
<head>
<title>Fast and modern front-end setup with webpack, react, redux, router, saga and postcss, part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用webpack、react、redux、router、saga和postcss的快速现代前端设置，第3部分</h1>
<blockquote>原文：<a href="https://itnext.io/fast-and-modern-front-end-setup-with-webpack-react-redux-router-saga-and-postcss-part-3-27ac4bc3f969?source=collection_archive---------1-----------------------#2018-02-11">https://itnext.io/fast-and-modern-front-end-setup-with-webpack-react-redux-router-saga-and-postcss-part-3-27ac4bc3f969?source=collection_archive---------1-----------------------#2018-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b0edce9ca5bf04674727450842a80dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vu-Ol2OeZqh-5rHNvt0BEQ.jpeg"/></div></div></figure><p id="aad8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望意外三部曲《:D》的最后一部</p><p id="04b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。我们现在有了webpack设置、样式、反应和还原。我们需要管理路由和api调用来完成我们的基本设置。</p><p id="2969" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们添加一个组件，这两个问题我们会更好地理解，所以让我们开始吧。在src/components/ add Menu.js中:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="474e" class="lf lg iq lb b gy lh li l lj lk">import React from 'react';<br/>import PropTypes from 'prop-types';</span><span id="21ab" class="lf lg iq lb b gy ll li l lj lk">import AppBar from 'material-ui/AppBar';<br/>import FlatButton from 'material-ui/FlatButton';</span><span id="70f4" class="lf lg iq lb b gy ll li l lj lk">const Menu = props =&gt; &lt;AppBar<br/>    title="Our project"<br/>    onTitleClick={props.goHome}<br/>    iconElementRight={&lt;FlatButton label="Show stuff" /&gt;}<br/>    onRightIconButtonClick={props.onClick}<br/>/&gt;</span><span id="dee6" class="lf lg iq lb b gy ll li l lj lk">Menu.propTypes = {<br/> goHome: PropTypes.func.isRequired<br/>}</span><span id="93fd" class="lf lg iq lb b gy ll li l lj lk">Menu.defaultProps = {<br/> goHome: () =&gt; console.log('going home')<br/>}</span><span id="2edf" class="lf lg iq lb b gy ll li l lj lk">export default Menu;</span></pre><p id="6f9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并将其包含在我们的App.js中:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f1e2" class="lf lg iq lb b gy lh li l lj lk">import React from 'react';<br/>import PropTypes from 'prop-types';</span><span id="3c2c" class="lf lg iq lb b gy ll li l lj lk">import RaisedButton from 'material-ui/RaisedButton';</span><span id="1bb7" class="lf lg iq lb b gy ll li l lj lk">import Menu from './Menu';</span><span id="22d3" class="lf lg iq lb b gy ll li l lj lk">const App = props =&gt; &lt;div&gt;<br/> &lt;Menu /&gt;<br/> &lt;RaisedButton label={props.buttonText} onClick={props.onClick} /&gt;<br/>&lt;/div&gt;</span><span id="798e" class="lf lg iq lb b gy ll li l lj lk">App.propTypes = {<br/> buttonText: PropTypes.string.isRequired,<br/> onClick: PropTypes.func.isRequired<br/>}</span><span id="b84f" class="lf lg iq lb b gy ll li l lj lk">App.defaultProps = {<br/> buttonText: 'defaultText',<br/> onClick: () =&gt; console.log('default click action')<br/>}</span><span id="99c2" class="lf lg iq lb b gy ll li l lj lk">export default App;</span></pre><p id="234e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到我们的菜单。</p><p id="9af9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们想要的是，当用户点击Show stuff时，我们向后端发送一个请求，我们接收一个json，我们将该json简化为一种状态，然后在另一个页面上显示该状态。为了处理API调用，redux使用中间件，所以让我们设置saga:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="22d9" class="lf lg iq lb b gy lh li l lj lk">npm i -S redux-saga</span></pre><p id="3164" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">中间件的工作方式很像webpack中加载器的工作方式:它们知道在把控制权交还给所有者之前，它们想要处理什么样的事情，它们知道如何处理它，你只需要设置它。那么让我们来设置中间件。我们将在src/文件夹中创建一个名为store.js的新文件:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="94a3" class="lf lg iq lb b gy lh li l lj lk">import { createStore, applyMiddleware, compose } from "redux";<br/>import createSagaMiddleware from "redux-saga";<br/>import { reducers } from "./reducers/index";<br/>import { sagas } from "./sagas/index";</span><span id="0cc1" class="lf lg iq lb b gy ll li l lj lk">let middlewares = [];</span><span id="6d42" class="lf lg iq lb b gy ll li l lj lk">const sagaMiddleware = createSagaMiddleware();<br/>middlewares.push(sagaMiddleware);</span><span id="0514" class="lf lg iq lb b gy ll li l lj lk">let middleware = applyMiddleware(...middlewares);</span><span id="3ec2" class="lf lg iq lb b gy ll li l lj lk">const store = createStore(reducers, middleware);<br/>sagaMiddleware.run(sagas);</span><span id="bbfd" class="lf lg iq lb b gy ll li l lj lk">export { store };</span></pre><p id="bece" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们制作了一个中间件数组，然后使用中间件和reducers创建了商店。我们还使用src/sagas/index中的sagas，我们将在将它导入index.js后使用它，所以删除</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="aa23" class="lf lg iq lb b gy lh li l lj lk">let store = createStore(reducers);</span></pre><p id="c79b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并补充:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="906c" class="lf lg iq lb b gy lh li l lj lk">import {store} from './store';</span></pre><p id="90bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在src/做一个新文件夹叫sagas。这是我们将处理所有异步请求的地方，从而保持我们的reducers的纯净。制作索引. js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f0cb" class="lf lg iq lb b gy lh li l lj lk">import { takeLatest, put, call } from 'redux-saga/effects'<br/>import actions from '../actions'<br/>import api from '../api';</span><span id="839a" class="lf lg iq lb b gy ll li l lj lk">function* getStuff() {<br/> try {<br/>        const data = yield call(api.getStuff);<br/>        yield put({ type: actions.GOT_STUFF, data });<br/>    } catch (error) {<br/>        console.log('saga fail: ', error);<br/>        yield put({ type: actions.GOT_NO_STUFF, error })<br/>    }<br/>}</span><span id="6957" class="lf lg iq lb b gy ll li l lj lk">export function* sagas() {<br/>    yield takeLatest(actions.GET_STUFF, getStuff);<br/>}</span></pre><p id="ef2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">显然，我们需要将这些动作添加到我们的动作列表中:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="7c8d" class="lf lg iq lb b gy lh li l lj lk">export default {<br/>    BASIC_ACTION: 'BASIC_ACTION',<br/>    GET_STUFF: 'GET_STUFF',<br/>    GOT_STUFF: 'GOT_STUFF',<br/>    GOT_NO_STUFF: 'GOT_NO_STUFF'<br/>}</span></pre><p id="e99f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">函数声明中的*表示它是一个生成器函数。简单地说，这个函数不需要立刻运行，它可以产生一些结果，然后在以后继续运行。</p><p id="40c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要理解这一点，请检查主要的sagas()函数。在这里，我们采取了最新GET_STUFF操作。由于我们在一个中间件中，saga将检查所有传递类型。当有匹配时，它将处理它。TakeLatest意味着如果有更多的并发请求，将只处理最新的请求，这很好。在他们的官方页面上查看更多选项。</p><p id="b4f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们取一个最新，然后通过另一个生成器，得到一个东西，有三个产量。首先，我们调用一个api.getStuff函数(我们马上就会用到它)。这个函数发送一个请求，我们的生成器传递回控制并等待。当我们得到数据时，我们把它放回redux，传递一个将在reducer中使用的类型。如果不是跳来跳去，让我们更新reducers/index.js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="7d59" class="lf lg iq lb b gy lh li l lj lk">import { combineReducers } from "redux";<br/>import basicReducer from './basicReducer';<br/>import stuffReducer from './stuffReducer';</span><span id="cbaf" class="lf lg iq lb b gy ll li l lj lk">export const reducers = combineReducers({<br/>  text: basicReducer,<br/>  stuff: stuffReducer<br/>});</span></pre><p id="5ac6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并生成stuffReducer.js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="ca3d" class="lf lg iq lb b gy lh li l lj lk">import actions from '../actions';</span><span id="477a" class="lf lg iq lb b gy ll li l lj lk">const stuffReducer = (state = [], action) =&gt; {<br/> switch(action.type) {<br/>  case actions.GOT_STUFF: return action.data<br/>  default: return state<br/> }<br/>}</span><span id="c1fe" class="lf lg iq lb b gy ll li l lj lk">export default stuffReducer;</span></pre><p id="ba2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我们不处理GET_STUFF，我们等待saga向我们发送数据，只有到那时我们才减少它。</p><p id="2082" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在只需在src/ folder中添加api/ folder，并在那里进行api调用:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a897" class="lf lg iq lb b gy lh li l lj lk">import axios from 'axios';<br/>import actions from '../actions';</span><span id="2d15" class="lf lg iq lb b gy ll li l lj lk">const makeRequest = (urlExtension, data = {}) =&gt; axios.post(config.baseUrl + urlExtension, data, {withCredentials: true});</span><span id="146a" class="lf lg iq lb b gy ll li l lj lk">export default {<br/> getStuff: () =&gt; makeRequest('getStuff.php')<br/>}</span></pre><p id="47e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我用axios做这些事情，所以你要么必须用<code class="fe lm ln lo lb b">npm i -S axios</code>要么用你自己的。无论如何，这将我们的状态管理逻辑与我们的异步逻辑解耦，并将我们的异步逻辑与我们的外部通信逻辑解耦。</p><p id="c26b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好，现在我们已经处理好了，我们为菜单组件准备了一个容器。正如我们已经知道的，这个容器将充当中间人(也是:D中间的东西)并定义实际的onClick函数。制作src/containers/Menu.js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="5ae0" class="lf lg iq lb b gy lh li l lj lk">import { connect } from 'react-redux';<br/>import actions from '../actions/';</span><span id="ec1b" class="lf lg iq lb b gy ll li l lj lk">import TheComponent from '../components/Menu';</span><span id="4d56" class="lf lg iq lb b gy ll li l lj lk">const mapStateToProps = (state, ownProps) =&gt; {<br/>    return {<br/>    }<br/>}</span><span id="d123" class="lf lg iq lb b gy ll li l lj lk">const mapDispatchToProps = (dispatch, ownProps) =&gt; {<br/>    return {<br/>        onClick: () =&gt; {<br/>          dispatch({type: actions.GET_STUFF})<br/>        }<br/>    }<br/>}</span><span id="501f" class="lf lg iq lb b gy ll li l lj lk">const Menu = connect(<br/>    mapStateToProps,<br/>    mapDispatchToProps<br/>)(TheComponent)</span><span id="e95b" class="lf lg iq lb b gy ll li l lj lk">export default Menu;</span></pre><p id="5c92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并将该文件导入components/App.js</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f430" class="lf lg iq lb b gy lh li l lj lk">import Menu from '../containers/Menu';</span></pre><p id="f658" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启动应用程序并单击按钮。您将在控制台中看到一个saga失败，但这是因为我们没有后端端点。本教程不包括这一点，所以让我们只是回顾一下我们到目前为止:</p><ol class=""><li id="890d" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated">在actions/ folder中，我们保存了一个所有可能发生的事情的列表</li><li id="0d1b" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">在containers/ folder中，我们定义了一些函数来调度这些动作中的一个，以防组件中发生了一些事情</li><li id="84b7" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">被分派的对象现在通过中间件。如果没有匹配，它就去减速器。如果有匹配，saga通常通过调用外部api来处理它。</li><li id="6761" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">在api/ folder中，我们可以制作几个文件来处理不同的端点，我们只是导出函数。</li><li id="ed39" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">saga使用这些函数中的一个从服务器获取一些数据，然后用这些数据调度另一个动作</li><li id="b864" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">Redux收回控制权，现在寻找一个reducer来处理新的动作并更新状态树。</li></ol><p id="52d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">太好了，希望这足够简单，:D</p><p id="956f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但我们希望用户能够点击后退按钮，返回到某个先前的屏幕，在东西被显示在某个地方之前。为此，我们需要路由，我们将导入我们的react-router:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="28c3" class="lf lg iq lb b gy lh li l lj lk">npm i -S react-router@3.0.2 react-router-redux</span></pre><p id="6c00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们选择react-router的较低版本是因为^4.0.0与其他库之间存在一些问题，但是您可以自行研究它。</p><p id="22c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将让路由器处理路由、历史等，但是react-router-redux将使数据在状态树中可用。我们来更新一下store.js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0cb2" class="lf lg iq lb b gy lh li l lj lk">import { createStore, applyMiddleware, compose } from "redux";<br/>import createSagaMiddleware from "redux-saga";<br/>import { reducers } from "./reducers/index";<br/>import { sagas } from "./sagas/index";</span><span id="9738" class="lf lg iq lb b gy ll li l lj lk">import { browserHistory } from "react-router";<br/>import { syncHistoryWithStore, routerMiddleware } from "react-router-redux";</span><span id="6bb9" class="lf lg iq lb b gy ll li l lj lk">let middlewares = [];</span><span id="2cc2" class="lf lg iq lb b gy ll li l lj lk">middlewares.push(routerMiddleware(browserHistory));</span><span id="5a26" class="lf lg iq lb b gy ll li l lj lk">const sagaMiddleware = createSagaMiddleware();<br/>middlewares.push(sagaMiddleware);</span><span id="4deb" class="lf lg iq lb b gy ll li l lj lk">let middleware = applyMiddleware(...middlewares);</span><span id="c719" class="lf lg iq lb b gy ll li l lj lk">const store = createStore(reducers, middleware);<br/>const history = syncHistoryWithStore(browserHistory, store);<br/>sagaMiddleware.run(sagas);</span><span id="a119" class="lf lg iq lb b gy ll li l lj lk">export { store, history };</span></pre><p id="a14b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们传递另一个中间件，这个中间件处理browserHistory，并导出这个历史。我们将能够像这样使用这个历史:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="1949" class="lf lg iq lb b gy lh li l lj lk">&lt;Router history={history}&gt;...</span></pre><p id="438e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然是导入之后。我们还需要为此添加一个reducer，请访问reducers/index.js:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="c470" class="lf lg iq lb b gy lh li l lj lk">import { combineReducers } from "redux";<br/>import basicReducer from './basicReducer';<br/>import stuffReducer from './stuffReducer';<br/>import { routerReducer } from "react-router-redux";</span><span id="914f" class="lf lg iq lb b gy ll li l lj lk">export const reducers = combineReducers({<br/>  routing: routerReducer,<br/>  text: basicReducer,<br/>  stuff: stuffReducer<br/>});</span></pre><p id="75f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以查看路由对象，看看它能提供什么。</p><p id="5034" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了不让这篇已经很长的教程变得更长，我将在这里停下来，避免解释react-router。</p><p id="9d5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这很容易理解。如果没有，请对容易混淆的部分发表评论。</p></div></div>    
</body>
</html>