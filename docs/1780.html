<html>
<head>
<title>How to stop content jumping when images load?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">图片加载时如何停止内容跳转？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-stop-content-jumping-when-images-load-7c915e47f576?source=collection_archive---------0-----------------------#2019-01-28">https://itnext.io/how-to-stop-content-jumping-when-images-load-7c915e47f576?source=collection_archive---------0-----------------------#2019-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e77f1ed21ee0132f778d01c70214a032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKPNdhoHgZ2nUMt0cJQfKQ.jpeg"/></div></div></figure><p id="adc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图像在大多数网站、网络应用程序和PWAs中被广泛使用，看看你最近的任何项目，很可能图像是其捆绑大小的很大一部分。</p><p id="a15a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，您可能会遇到这种情况:您的页面中混合了图像和基于文本的内容，但是随着图像的加载，整个布局会移动、跳转和更改，从而提供非常差的用户体验。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/bbc62b0a82bf18de962334899ccd0a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/1*0EHbaworlZeRN1LOeK9PpQ.gif"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">随着图像的加载，内容会四处跳跃</figcaption></figure><p id="9ebc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于有限的屏幕尺寸和连接速度，这在移动设备上尤其糟糕。此外，现代最佳实践推荐在文件夹下延迟加载图像也没有帮助，因为这意味着当用户向下滚动页面时，跳跃和移动将继续。</p><h1 id="e759" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">只需设置图像的宽度和高度？</h1><p id="b8db" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">哦，要是生活有那么简单就好了，事实是，设置图像的<code class="fe mi mj mk ml b">width</code>和<code class="fe mi mj mk ml b">height</code>确实让浏览器在加载之前“保留”图像空间，因为它提前知道图像空间有多大，但是有一个巨大的警告，如果图像是响应性的，<em class="mm">它根本不起作用。</em></p><p id="356c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在大多数情况下，你会有这样的CSS，以确保图像将缩小很好:</p><pre class="kx ky kz la gt mn ml mo mp aw mq bi"><span id="2298" class="mr lg iq ml b gy ms mt l mu mv">img {</span><span id="db6c" class="mr lg iq ml b gy mw mt l mu mv">    max-width: 100%;</span><span id="30ef" class="mr lg iq ml b gy mw mt l mu mv">    height: auto;</span><span id="10b5" class="mr lg iq ml b gy mw mt l mu mv">}</span></pre><p id="2b27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那个<code class="fe mi mj mk ml b">height: auto</code>将“取消”固定的<code class="fe mi mj mk ml b">height</code>属性，这是有充分理由的，现在浏览器不加载它就无法知道图像需要多大。</p><h1 id="913e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">纵横比填充技巧</h1><p id="c9b5" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">图像根据其长宽比放大和缩小，因此知道这一点后，我们可以使用最古老的CSS技巧来解决这个问题。</p><p id="d1a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae mx" href="https://css-tricks.com/aspect-ratio-boxes/" rel="noopener ugc nofollow" target="_blank">纵横比填充技巧</a>通常用于帮助响应视频和SVG，它依赖于百分比填充基于元素宽度的事实，这可以帮助我们解决内容跳跃问题。</p><p id="9572" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们所需要的是将图像包装在一个零高度容器中，并给出一个具有相同图像纵横比的<code class="fe mi mj mk ml b">padding-top</code>,例如:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1ce4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你甚至不需要在这里使用<code class="fe mi mj mk ml b">calc</code>，它只是帮助你更好地形象化它，你所需要的是根据下面的公式得到图像的长宽比:</p><blockquote class="na nb nc"><p id="f6d8" class="jy jz mm ka b kb kc kd ke kf kg kh ki nd kk kl km ne ko kp kq nf ks kt ku kv ij bi translated">(高/宽* 100</p></blockquote><p id="9b6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，你可以在下面的笔中看到，我们已经避免了可怕的内容跳转，即使图像需要一段时间才能加载:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="ng mz l"/></div></figure><h1 id="2a0c" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">额外收获:在上面撒一些JS</h1><p id="91a7" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">由于我们很多人都在使用某种基于组件的javascript框架，我们可以制作一个新的<code class="fe mi mj mk ml b">Img</code>组件来帮助重用我们的新图像，我们还可以添加一些惰性加载功能和有趣的加载指示器，只是为了好玩。</p><p id="4697" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，我将使用ReactJS，但它在您选择的框架中也是可行的，基本概念是相同的:</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c279" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它看起来更复杂，但本质上与静态html/css的想法是一样的。<code class="fe mi mj mk ml b">.wrapper</code>元素将作为填充的容器，<code class="fe mi mj mk ml b">.img</code>元素将被绝对定位在里面。</p><p id="d70b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用内联样式来基于图像大小设置容器上的<code class="fe mi mj mk ml b">padding-top</code>,但是通过使用CSS变量，我们为我们的组件添加了一个额外的时髦词，这个词很适合这个时代。</p><p id="f1b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还使用了<a class="ae mx" href="https://github.com/thebuilder/react-intersection-observer" rel="noopener ugc nofollow" target="_blank">react-intersection-observer</a>库，该库提供了一个带有<code class="fe mi mj mk ml b">inView</code>参数的渲染道具，让我知道图像何时在视口内，并添加了一些CSS动画来显示图像加载时的加载指示器。</p><p id="5a92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们的<code class="fe mi mj mk ml b">Img</code>组件可以像任何其他<code class="fe mi mj mk ml b">img</code>元素一样使用:</p><pre class="kx ky kz la gt mn ml mo mp aw mq bi"><span id="a810" class="mr lg iq ml b gy ms mt l mu mv">&lt;Img</span><span id="7467" class="mr lg iq ml b gy mw mt l mu mv">    width={360}</span><span id="56e1" class="mr lg iq ml b gy mw mt l mu mv">    height={360}</span><span id="2e23" class="mr lg iq ml b gy mw mt l mu mv">    src="https://loremflickr.com/360/360/cat"</span><span id="8715" class="mr lg iq ml b gy mw mt l mu mv">    alt="Cute cat"</span><span id="e10f" class="mr lg iq ml b gy mw mt l mu mv">/&gt;</span></pre><p id="6770" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好处是现在我们有了一个可重复使用的图像组件，包括:</p><ul class=""><li id="b7f4" class="nh ni iq ka b kb kc kf kg kj nj kn nk kr nl kv nm nn no np bi translated">懒加载。</li><li id="8fc4" class="nh ni iq ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated">避免内容跳转。</li><li id="302e" class="nh ni iq ka b kb nq kf nr kj ns kn nt kr nu kv nm nn no np bi translated">装载指示器。</li></ul><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/3f80d1963f0652f16a73db480c5b4b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wXB9lSMvH6VEQ_FngWaasg.gif"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated"><a class="ae mx" href="https://codesandbox.io/s/1642lz7n7" rel="noopener ugc nofollow" target="_blank">https://codesandbox.io/s/1642lz7n7</a></figcaption></figure></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="bbc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请随意使用演示，并在您认为合适的时候进行改进，我们随时欢迎您的反馈！👋🏽</p></div></div>    
</body>
</html>