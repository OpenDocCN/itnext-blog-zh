<html>
<head>
<title>How to manage Jenkins from Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从懈怠中管理詹金斯</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-manage-jenkins-from-slack-7bb42f8f2001?source=collection_archive---------1-----------------------#2020-08-23">https://itnext.io/how-to-manage-jenkins-from-slack-7bb42f8f2001?source=collection_archive---------1-----------------------#2020-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f0869dd00b6c59a51ef2b603ff4af3a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cH0BDT1St8_uMkFaIsMoFg.jpeg"/></div></div></figure><p id="d85b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试自动化不仅仅是自动化应用程序。我会说，甚至以编程的方式与团队共享测试结果也是测试自动化的一部分。因此，团队不依赖任何个人来获得结果。团队还可以根据测试结果立即采取进一步的行动。</p><p id="f005" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将看到如何在Slack中共享测试结果。另外，您如何在Jenkins/CI工具中触发自动化测试套件的执行。</p><p id="4f58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">松弛</strong></p><p id="24e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在组织中使用松弛。您也可以使用Slack在您组织的团队成员之间交流信息。Slack是一个很好的工具，它让每个人都了解最新情况，减少不必要的电子邮件。</p><p id="d743" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Slack </strong>是工作的协作枢纽，无论你做什么工作。这是一个对话、决策和信息唾手可得的地方。有了Slack，您的团队可以更好地联系起来。<br/>你可以使用这个app <a class="ae kw" href="https://slack.com/" rel="noopener ugc nofollow" target="_blank"> on-off.site </a></p><p id="5ea6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Slack — Jenkins CI应用程序—集成</strong></p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/af866093ecd6fe42c3317580be5640f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsNSfWWPaZ9Dxn5wyZBAQA.jpeg"/></div></div></figure><p id="4452" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我假设我们大多数人使用Jenkins进行连续的自动化测试。所以在这篇文章中，我提供了集成Jenkins和Slack的步骤。如果你使用其他工具，如TeamCity、Bamboo等，这个过程几乎还是一样的。</p><p id="1db0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">松弛</strong>:</p><ul class=""><li id="faea" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">转到<a class="ae kw" href="https://slack.com/" rel="noopener ugc nofollow" target="_blank">https://slack.com</a></li><li id="3f45" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">浏览“詹金斯”应用程序</li><li id="0408" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">在您的空闲时间安装Jenkins CI应用程序</li><li id="492d" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">点击“添加配置”</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/1a0553154c26fab05a762540764635ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*wxKc317_DvrW9iL3AF-zPw.png"/></div></figure><ul class=""><li id="edc8" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">记下团队域和令牌</li><li id="2bdc" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">选择我们要放置结果的通道</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/b6d6eaa3b0811baa9bf5212941fb5a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXDi51KXA-Vuw8vEURE6nQ.png"/></div></div></figure><p id="d620" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">詹金斯</p><ul class=""><li id="deab" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">转到管理Jenkins -&gt;管理插件-&gt;可用选项卡</li><li id="cd54" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">安装时差通知插件</li><li id="412c" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">更新备用域和令牌= &gt;管理Jenkins -&gt;配置系统-&gt;全局备用通知程序设置</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/cfca5bddb5c030b02aae3c8fc79585d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sj7GXUEMcxMdF86lRp_hFQ.png"/></div></div></figure><ul class=""><li id="54f1" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">单击“Test Connection”——您应该会在Jenkins中看到“success”消息，并在slack通道中看到以下消息。</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/384b8787f5cc2eb6f0eb53ba47de1991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*1W0jQXvG5vyrz6IGQtIRbw.png"/></div></figure><p id="f7be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">詹金斯—测试工作</strong></p><ul class=""><li id="c4fb" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">为测试创建一个Jenkins作业</li><li id="92d0" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">用您想要的自定义消息更新构建后操作，如下所示</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/99f4f9b22b1f35017cb6c10144ce6ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*f1h9ah5J2e8T35iNl2FeBg.png"/></div></figure><p id="5913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">詹金斯管道</strong></p><p id="2d6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要向插件添加一个调用</p><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="e110" class="lz ma iq lv b gy mb mc l md me">slackSend color: 'good', message: 'Message from Jenkins Pipeline'</span></pre><p id="7493" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要确定消息的正确颜色和信息文本:</p><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="125f" class="lz ma iq lv b gy mb mc l md me">def notifySlack(String buildStatus = 'STARTED') {<br/>    <br/>    // Build status of null means success.<br/>    buildStatus = buildStatus ?: 'SUCCESS'<br/>    def color<br/>    if (buildStatus == 'STARTED') {<br/>        color = '#D4DADF'<br/>    } else if (buildStatus == 'SUCCESS') {<br/>        color = '#BDFFC3'<br/>    } else if (buildStatus == 'UNSTABLE') {<br/>        color = '#FFFE89'<br/>    } else {<br/>        color = '#FF9FA1'<br/>    }<br/>    def msg = "${buildStatus}: `${env.JOB_NAME}` #${env.BUILD_NUMBER}:\n${env.BUILD_URL}"<br/>    slackSend(color: color, message: msg)<br/>}<br/>node {<br/>    try {<br/>        notifySlack()<br/>        sh 'runbuild'<br/>    } catch (e) {<br/>        currentBuild.result = 'FAILURE'<br/>        throw e<br/>    } finally {<br/>        notifySlack(currentBuild.result)<br/>    }<br/>}</span></pre><p id="6d00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">总结</strong></p><p id="2948" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为持续测试过程的一部分，我们定期使用Jenkins运行自动化脚本。只有你，作为测试工程师，大多知道结果。其他团队成员可能不知道测试结果。使用自动化工具，我们可以创建自动化脚本，使用Slack API，我们可以以编程方式共享结果。</p><p id="55c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建新用户</strong></p><p id="16f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从在Jenkins中创建一个新用户供slack使用开始。记下API令牌。</p><p id="7e62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设这个空闲用户有足够的权限触发作业。</p><p id="9490" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">执行下面的CURL命令，验证用户是否能够调用作业。</p><p id="dfc5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是URL的格式。用适当的信息替换[ ]中的内容。</p><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="3c07" class="lz ma iq lv b gy mb mc l md me">curl -X POST http:<em class="mf">//[user:token]@[jenkins-host-with-port]/job/[job-name]/build</em></span></pre><p id="f39d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的例子中，我尝试了如下所示的方法。</p><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="8149" class="lz ma iq lv b gy mb mc l md me">curl -X POST http:<em class="mf">//slack:c1c54d626f6a11fbc98ed795ec8862bc@10.11.12.13:8080/job/TEST_SMOCK_SLACK_JOB_DEMO/build</em></span></pre><p id="e73b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">松弛-斜线命令</strong></p><p id="3573" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了调用上面的Jenkins作业，我们将使用Slack的slash命令。所以每当你在斜杠后面输入一些东西——例如:'/smoke tests '——Slack会把它当作一个命令，并且可以响应这个命令。因此，例如，Slack可以被配置为提供您所在城市的天气报告。</p><p id="c18a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了调用上面的Jenkins作业，我们将使用Slack的slash命令。所以每当你在斜杠后面输入一些东西——例如:'/smoke tests '——Slack会把它当作一个命令，并且可以响应这个命令。因此，例如，Slack可以被配置为提供您所在城市的天气报告。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/f904eb85e789573baa9582fb3a696b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PV-zQHRtR5kz8jwf-w164A.png"/></div></div></figure><ul class=""><li id="57e1" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">转到您的松弛配置以添加斜线配置。</li><li id="ef38" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">我将创建一个冒烟测试命令——这样我的团队就可以从slack中触发冒烟测试来检查应用程序的健康状况。</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/e8aac7685e1caba018aaeed3d561c73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMTa0Jy5MZirmELxO-SfMw.png"/></div></div></figure><ul class=""><li id="b616" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">如下所示添加集成设置。提供我们需要调用来触发Jenkins作业的URL。</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/a0f23aefbb39d6c0145558821ef14df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5B6SOkgDeRKk_bWrovMl3A.png"/></div></div></figure><ul class=""><li id="eefa" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">选择自动完成帮助</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/a12b7c4d9e0c2687e0402aca9059a3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwrsfRNs2alpe7QRxg93ng.png"/></div></div></figure><ul class=""><li id="4741" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">配置完成后，您可以立即在空闲时间进行验证。只需键入“/s”就可以看到“smoketest”命令</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/83ae85ffffaea364dedb02cd9a5d71d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*ErX-ZkVTlGZZrFy_luAc2w.png"/></div></figure><ul class=""><li id="c2b6" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">调用命令—检查Jenkins是否能够触发作业。</li></ul><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/3c89b9589f1518c6ce42b9b5fa9637da.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*QfypEXx4e8qJXgp12ZdVYg.png"/></div></figure><ul class=""><li id="a55a" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">如果作业需要参数，请使用下面的URL格式调用带有默认参数的作业。</li></ul><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="02a8" class="lz ma iq lv b gy mb mc l md me">curl -X POST http:<em class="mf">//[username:token]@[jenkins-host-with-port]/job/[job-name]/buildWithParameters</em></span></pre><ul class=""><li id="9624" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">如果需要传递任何特定的参数，只需在参数中追加变量和值。</li></ul><pre class="ky kz la lb gt lu lv lw lx aw ly bi"><span id="95cc" class="lz ma iq lv b gy mb mc l md me">curl -X POST http:<em class="mf">//[username:token]@[jenkins-host-with-port]/job/[job-name]/buildWithParameters?ENVIRONMENT=UAT</em></span></pre><ul class=""><li id="ab90" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">要获得作业的状态/结果，应该将作业配置为将结果发送回Slack。你可以在这里找到一篇关于这个的文章。</li></ul><p id="fe04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注</strong></p><ul class=""><li id="3120" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">为了让上述方法起作用，Slack应该可以访问您的Jenkins服务器。确保它没有被防火墙阻止。</li></ul><p id="86d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">总结</strong></p><p id="b918" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Slack命令非常有用，在获取信息或触发您可能经常做的事情时非常方便。通过这样做，团队中的任何非技术用户都可以通过直接调用slash命令来使用您的自动化测试脚本。</p></div></div>    
</body>
</html>