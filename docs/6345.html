<html>
<head>
<title>How to Create a Live IfFeatureFlag Directive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建活动的IfFeatureFlag指令</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-create-a-live-iffeatureflag-directive-871c36b6b943?source=collection_archive---------6-----------------------#2021-10-20">https://itnext.io/how-to-create-a-live-iffeatureflag-directive-871c36b6b943?source=collection_archive---------6-----------------------#2021-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="df96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个负责特性标志检查的指令，而且是实时的！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/cdce960caa7777ce79a40cf62c92e6ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*75RPNNPezS3kIjnJQXKc9g.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">旗帜</figcaption></figure><p id="5aae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lb">照片由</em> <a class="ae lc" href="https://unsplash.com/@liamdesic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="lb">利亚姆Desic </em> </a> <em class="lb">上</em><a class="ae lc" href="https://unsplash.com/s/photos/flags?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="lb">Unsplash</em></a><em class="lb">。</em></p><p id="7a7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TL；速度三角形定位法(dead reckoning)</p><blockquote class="ld le lf"><p id="17b1" class="jn jo lb jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">GitHub 的指令代码。</p><p id="d3e4" class="jn jo lb jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">在<a class="ae lc" href="https://stackblitz.com/edit/if-feature-flag-directive?file=src%2Fapp%2Fapp.component.html" rel="noopener ugc nofollow" target="_blank"> StackBlitz </a>的实例。</p></blockquote><h2 id="29f8" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">详情</strong></h2><p id="ba94" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在使用特性标志的Angular项目中，您可能会有一些HTML和TS代码，如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">出现特征标志时切换的视图示例。</figcaption></figure><p id="93f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lb">假设</em> <code class="fe mj mk ml mm b"><em class="lb">featureFlags.checkIsOn</em></code> <em class="lb">返回一个</em> <code class="fe mj mk ml mm b"><em class="lb">Observable&lt;boolean&gt;.</em></code></p><p id="e38d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是<strong class="jp ir">精</strong>。这段代码可以正常工作。</p><h2 id="5d39" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">陈述性和简洁</strong></h2><p id="ee4f" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我的建议应该是这样的:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用“ifFeature”指令的示例。</figcaption></figure><h2 id="f3a5" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">感兴趣吗？请继续阅读。</h2><p id="83fb" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为什么不制定一个指令，就像<code class="fe mj mk ml mm b">*ngIf</code>一样，它会处理繁重的工作，让你:</p><p id="1b0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-少写样板文件</p><p id="11ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-编写更少的测试</p><p id="e50e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-专注于重要的事情</p><h2 id="06ff" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">幼稚的实现</strong></h2><p id="75b9" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">这是一个简短的版本:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">“ifFeatureFlag”指令的简单实现。</figcaption></figure><p id="c604" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它将输入中的特性标志名称和标志集合作为构造函数依赖项(一个服务),并且仅在特性标志打开时显示视图。或者如果特征标志是向下的(不存在)，则隐藏它。</p><p id="9fbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lb"/><code class="fe mj mk ml mm b"><em class="lb">templateRef</em></code><em class="lb">被认为是和标志(服务)一起注入到构造函数中的，</em> <code class="fe mj mk ml mm b"><em class="lb">viewContainerRef</em></code> <em class="lb">。</em></p><p id="203a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是幼稚的版本。它仍然需要:</p><p id="5f39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-支持缺失特征标志的情况</p><p id="1168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-能够根据应用生命周期中功能标志的变化进行更新</p><h2 id="905d" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">丢失特征标志案</strong></h2><p id="d2c4" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们需要添加一个<code class="fe mj mk ml mm b">else</code>处理程序。它可能看起来像这样:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">处理“ifFeature”指令的else情况。</figcaption></figure><p id="e4fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在实例属性中存储了标志和“else”模板之后，<code class="fe mj mk ml mm b">ifFeature</code>和<code class="fe mj mk ml mm b">ifFeatureElse</code>都委托给了<code class="fe mj mk ml mm b">updateView</code>方法。现在我们可以去做:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">如何使用“ifFeature”指令的示例。</figcaption></figure><p id="e83e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">现场更新</strong></p><p id="90d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了能够支持实时更新，因此当特性标志更新时，视图也会更新，我们需要包含可观察的特性链的概念:</p><p id="6a2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lc" href="https://gist.github.com/dd9a02f07201f1d554fde6ac43be76a8" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dd9a02f07201f1d554fde6ac43be76a8</a></p><p id="3996" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设<code class="fe mj mk ml mm b">this.flags.checkIsOn(this.flag)</code>返回一个当特征标志改变时更新的可观察值。</p><p id="315a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，这允许我们的功能标志是活的！</p><h2 id="6e10" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated"><strong class="ak">一些小问题</strong></h2><p id="8f61" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">当然，还有一些细节需要处理。其中之一是<code class="fe mj mk ml mm b">this.flags.checkIsOn(this.flag).subscribe()</code>的“悬空”订阅。另一个是检查订阅是否已经存在，包括两个<code class="fe mj mk ml mm b">@Input</code>调用<code class="fe mj mk ml mm b">updateView</code>并可能创建第二个订阅的情况。在完成的代码中，这些都被处理了。</p><p id="a1c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码存在于<a class="ae lc" href="https://github.com/gparlakov/if-feature-flag/blob/main/src/app/flag-module/if-feature-flag.directive.ts" rel="noopener ugc nofollow" target="_blank"> GitHub </a>中。</p><p id="cbae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae lc" href="https://stackblitz.com/edit/if-feature-flag-directive?file=src%2Fapp%2Fapp.component.html" rel="noopener ugc nofollow" target="_blank"> StackBlitz </a>中还有一个活生生的例子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mn mi l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用指令的StackBlitz Angular应用程序。</figcaption></figure></div></div>    
</body>
</html>