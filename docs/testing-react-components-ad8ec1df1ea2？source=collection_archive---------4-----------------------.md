# 反应测试:单元与功能

> 原文：<https://itnext.io/testing-react-components-ad8ec1df1ea2?source=collection_archive---------4----------------------->

![](img/1967487332016c5658dd5ede98b3fde3.png)

测试非常重要。你只意识到当你不测试你的代码时，它会变成一大段代码，随时都有可能崩溃。随着代码开始编写测试也很重要，这样你就不会错过代码的任何部分。在这篇文章中，我们将讨论测试 react 组件以及[单元测试](https://en.wikipedia.org/wiki/Unit_testing)和[功能测试](https://en.wikipedia.org/wiki/Functional_testing)。

你可以在这个[回购](https://github.com/ErrorPro/react-testings)里找到所有的代码。

**功能样式代码**

当我们说测试时，我们的意思是一个单元对于相同的输入返回相同的输出。但是我们怎么能确定它总是一样的呢？这就是 [FP](https://en.wikipedia.org/wiki/Functional_programming) 帮助我们的地方。FP 说每个函数都应该是纯的，但是纯函数是什么意思呢？你可以在[维基百科](https://en.wikipedia.org/wiki/Pure_function)上阅读，但这是一个简短的解释:

1.  为相同的输入返回相同的输出。
2.  返回值不能依赖于任何隐藏信息或内部状态。
3.  没有副作用。副作用通常是网络请求、一些突变或可变对象。
4.  没有全局变量。函数不能依赖全局变量。
5.  不要覆盖参数。参数是不可变的。
6.  容易测试。不需要嘲笑或提供任何东西。一个函数需要的只是参数。

纯函数的基本例子是:

但是,“纯”react 组件是什么样子的呢？这只是一个观点。转储组件。它只应该呈现道具，没有状态。这是一个[解释](/how-to-structure-your-react-app-98c48e102aad)如何将你的组件拆分为 dump 和 smart。

这个组件总是为相同的属性呈现相同的 html。

**设置**

有一些工具可以帮助你测试你的代码。作为一名测试人员，我使用 [Jest](https://facebook.github.io/jest/) ,因为它可以开箱即用。为了测试 react 组件，我们将使用 [Jest 快照](https://facebook.github.io/jest/docs/en/snapshot-testing.html)和 [react-test-renderer](https://reactjs.org/docs/test-renderer.html) 。Jest snapshot 比较两个组件的输出，一个来自以前的运行(如果以前运行过)，另一个来自当前的运行。当我们第一次运行测试时，Jest 会将组件的输出存储到一个文件中，稍后 jest 会将该“快照”与组件现在呈现的内容进行比较。React-renderer 需要渲染组件并从中获取 JSON，jest 获取 JSON 并将其用作快照。

设置起来很简单，你需要做的就是在这里写(1 个命令)。

**单元测试**

在单元测试中，一切都是一个单元。我们不测试任何功能，不测试任何数据，我们测试的一切都是有回报的。对于一个组件，它是 HTML 代码，对于一个函数，它可能是一切:函数，对象，布尔，字符串等等。

让我们为小而纯的函数编写一个测试:

如果 2 和 2 作为参数传递，sum 函数总是返回 4。相同的参数不可能得到不同的结果。

现在让我们为转储组件编写一个单元测试。

就是这样。单元测试只检查组件是否被正确呈现。它不检查是否调用了 onClick 函数。它给了我们什么？

1.  向我们保证一个组件的渲染和以前一样。
2.  组件被正确呈现。

对于 4 行代码来说还不错，但是我们能得到更多吗？我们可以。这就是功能测试帮助我们的地方。

**功能测试**

如果我们的函数有自己的状态呢？如果我们需要测试一个 onClick 函数被调用时传递了一些参数，该怎么办？假设我们有一个按钮，它以标签的形式显示点击次数，每当我们点击它时，它就会调用一个函数，这个函数以当前的点击次数作为道具传递。

我们在这里可以测试的是:

1.  组件被正确呈现。
2.  当组件被呈现时，计数器等于 0。
3.  当我们点击按钮时，它只调用 onChange 函数。
4.  当我们点击按钮时，它会更新自己的状态，并用计数器调用 onClick 函数。

我们从第一个开始:

很简单。

第二，我们需要访问组件的状态。我们可以使用`renderer.create`函数的一个实例来实现。

为了测试第三个，我们需要使用`jest.fn`作为模拟函数，稍后我们需要检查它是否被调用。

最后一个但不是最不重要的。这里我们需要模拟点击按钮，我们可以用两种方法来实现:使用[反应测试工具](https://reactjs.org/docs/test-utils.html)或者使用[酶](https://github.com/airbnb/enzyme)。我更喜欢用第二种，因为它更简单，更直观。使用 Enzyme，您还可以设置组件的上下文、属性，通过类名或标签(如 JQuery)查找元素。只需 [1 命令](https://github.com/airbnb/enzyme#installation)即可设置。

**结论**

现在我们知道了 react 世界中单元测试和函数的区别。编写单元测试更快，但是它不会让你觉得你的组件工作正常。它只是向你保证一个组件被渲染，它看起来和它之前的渲染没有什么不同。如果你根本没有传递 onClick 函数，当用户试图点击你的组件时，你的组件可能会崩溃。功能测试很难写，因为你需要理解你在测试什么，但是它能给你更多。理想情况下，一起编写单元测试和功能测试会让你的应用程序没有 bug，让你的用户满意。任何测试都是好的，如果它存在；)

下一步是什么？测试简单的 react 组件很容易，但是我们有 relay、redux、react-intl、material-ui theme 和其他组件吗？我们将在下一篇文章中讨论测试复杂的 react 组件。很快。