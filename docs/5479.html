<html>
<head>
<title>Cloud Native CI/CD with Tekton — Laying The Foundation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tekton的云原生CI/CD—奠定基础</h1>
<blockquote>原文：<a href="https://itnext.io/cloud-native-ci-cd-with-tekton-laying-the-foundation-a377a1b59ac0?source=collection_archive---------5-----------------------#2021-03-15">https://itnext.io/cloud-native-ci-cd-with-tekton-laying-the-foundation-a377a1b59ac0?source=collection_archive---------5-----------------------#2021-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="56ba" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">借助Tekton Pipelines在Kubernetes上启动云原生CI/CD之旅的最简单方式…</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9fd1f7e12025b3380e74f8d248ee90f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1MKU3tnp6HEpMOrdKxbKQ.png"/></div></div></figure><p id="0c34" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们都知道每一个严肃的项目都需要CI/CD，我很确定没有必要解释为什么。但是，在决定在哪里构建CI/CD时，有很多工具、平台和解决方案可供选择。您可以选择Jenkins、Travis、CircleCI、Bamboo等等，但是如果您正在为运行在Kubernetes上的云原生应用程序构建CI/CD，那么使用适当的工具同时运行云原生CI/CD是有意义的。</p><p id="1d4a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">允许您在Kubernetes上本机运行CI/CD的一个解决方案是<a class="ae lq" href="https://tekton.dev/" rel="noopener ugc nofollow" target="_blank"> Tekton </a>，因此在本文中，我们将开始关于使用Tekton构建CI/CD的系列文章，从Tekton的介绍、安装和定制开始，开始我们在Kubernetes上的云本机CI/CD之旅。</p><p id="571d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lr">TL；DR:在https://github.com/MartinHeinz/tekton-kickstarter</em><a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter" rel="noopener ugc nofollow" target="_blank"><em class="lr"/></a><em class="lr">可以获得使用Tekton启动您的CI/CD所需的所有资源、脚本和文件。</em></p><h1 id="ea89" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">这是什么？(何必呢？)</h1><p id="6fca" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">顾名思义，Tekton是云原生CI/CD工具。它最初是由谷歌开发的，被称为<em class="lr"> Knative </em> pipelines。它在Kubernetes上作为一组定制资源(CRD)运行，如<em class="lr">管道</em>或<em class="lr">任务</em>，其生命周期由Tekton的控制器管理。它原生运行在Kubernetes上，这使得它非常适合管理/构建/部署也部署在Kubernetes上的任何应用程序和资源。</p><p id="a4d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这表明它适合管理Kubernetes工作负载，但是为什么不使用其他更流行的工具呢？</p><p id="ce09" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Jenkins、Travis或Bamboo等常用的CI/CD解决方案不是为在Kubernetes上运行而构建的，或者缺乏与Kubernetes的适当集成。这使得部署、维护和管理CI/CD工具本身以及使用它来部署任何Kubernetes-native应用程序变得困难和/或令人烦恼。另一方面，Tekton可以很容易地作为Kubernetes运营商与所有其他容器化应用程序一起部署，每个Tekton管道都是另一个Kubernetes资源，其管理方式与传统的<em class="lr"> Pods </em>或<em class="lr">部署</em>相同。</p><p id="a415" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这也使得Tekton能够很好地与GitOps实践合作，因为您可以将所有的管道和配置放在git中进行维护，这对于上面提到的工具中的至少一个来说是不可能的(是的，我非常讨厌Jenkins)。资源消耗也是如此——考虑到整个Tekton部署只是几个pod——与其他CI/CD工具相比，当管道不运行时，消耗的内存和CPU非常少。</p><p id="bb61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">也就是说，很明显，如果您在Kubernetes上运行所有的工作负载，那么非常建议为您的CI/CD使用一些Kubernetes本地工具。泰克顿是唯一的选择吗？不，当然，你可以使用其他工具，其中之一是<em class="lr"> JenkinsX </em>，这是一种<em class="lr">固执己见的方式，通过Kubernetes进行持续交付，即本地</em>。它打包了许多工具，如果您对替代工具没有任何强烈的偏好，这可以让您的生活更轻松，但如果您想要定制您的技术堆栈，这也可能非常烦人。不过，JenkinsX在后台使用Tekton，所以您也可以学习使用Tekton，然后决定是否还需要JenkinsX提供的所有其他组件。</p><p id="47b2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个选择是<em class="lr">Spinnaker</em>——这是一个已经存在很长时间的云计算解决方案。它使用插件来集成各种提供商，其中之一就是Kubernetes。然而，它不是一个构建引擎——它不提供工具来测试您的代码、构建您的应用程序映像或将它们推送到registry，对于这些任务，您仍然需要一些其他CI工具。</p><p id="ba38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在让我们仔细看看Tekton由什么组成——Tekton的核心仅由几个<em class="lr">customresourcediations(CRDs)</em>组成，它们是<em class="lr">任务</em>和<em class="lr">管道</em>，充当<em class="lr">任务运行</em>和<em class="lr">管道运行</em>的蓝图。这四个(加上其他几个即将被否决或现在不相关的)足以开始运行一些管道和任务。</p><p id="2915" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，这通常是不够的，考虑到大多数设置需要构建、部署——因此——以及由一些事件触发的管道。这就是为什么我们还安装了提供额外资源的<em class="lr"> Tekton触发器</em>，即<em class="lr"> EventListener </em>、<em class="lr"> TriggerBinding </em>和<em class="lr"> TriggerTemplate </em>。这三个资源为我们提供了监听特定事件的方法——比如(GitHub) webhooks、<em class="lr"> CloudEvents </em>或cron jobs发送的事件——并启动特定的管道。</p><p id="cdc4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一个也是非常可选的组件是<em class="lr"> Tekton Dashboard </em>，这是一个非常简单的GUI，但也是检查所有CRD的非常方便的工具，包括任务、管道和触发器。它还允许搜索和过滤，这在查找<em class="lr">任务运行</em>和<em class="lr">管道运行</em>时会很有帮助。您还可以使用它从现有任务和管道创建任务运行和管道运行。</p><p id="c902" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">所有这些部分都由控制器部署和pod管理，它们负责上述CRD的生命周期。</p><h1 id="4354" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">设置事物</h1><p id="8b14" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">考虑到Tekton由多个组件组成，安装可能会有点复杂，并且可以通过多种方式完成。通常您至少需要安装管道和触发器，最明显的方法是使用原始的Kubernetes清单来安装，但是您可以选择更简单的方法，从OperatorHub安装Tekton Operator，它已经包含了所有的部分。作为先决条件(对于任何安装方法)，我们显然需要一个集群，这里我们将使用<em class="lr">KinD(Docker中的Kubernetes)</em>进行本地管道开发。我们将使用以下自定义配置，因为我们需要部署入口控制器并暴露端口80/443，以便能够访问Tekton触发器事件监听器。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="7444" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以使用以下命令创建集群:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="addd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，对于Tekton Pipeline和触发器的实际部署，我提到了通过Tekton Operator进行安装，这可能是启动和运行一切预配置的最快和最好的方式，但是该Operator(在撰写本文时)缺乏任何实际的文档，因此您需要挖掘大量内容才能找到关于如何工作的任何解释，这对我个人来说不是大问题。然而，真正的问题是OperatorHub中的操作程序不是最新的，我找不到当前的版本/映像，这使它多少有些无用。我敢肯定，当Tekton Operator稍微成熟一点时，这种情况会有所改变(所以请关注它的<a class="ae lq" href="https://github.com/tektoncd/operator" rel="noopener ugc nofollow" target="_blank">库</a>)，但在此之前，应该使用其他安装选项。</p><p id="46ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您碰巧在OpenShift上运行，您可以使用的选项是<em class="lr"> Red Hat Pipeline Operator </em>，它也是——Kubernetes Operator，但在本例中是由Red Hat管理并为OpenShift定制的。只需在web控制台中点击几下就可以安装它，因此如果您可以访问OpenShift cluster，那么您应该尝试一下。使用它的一个缺点是发布周期较慢，所以你将被迫使用不是最新版本的Tekton。</p><p id="76e9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果OpenShift不是一个选项，或者您只想在Kubernetes上运行，那么使用原始清单进行安装就可以了，这是如何做到的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c763" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您还想在此安装中包含Tekton Dashboard，则需要再应用一组清单:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="c503" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除此之外，我们还需要额外的<em class="lr">入口</em>才能到达仪表板:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="b4b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">默认情况下，以前应用的仪表板资源是在<code class="fe mr ms mt mu b">tekton-pipelines</code>名称空间中创建的，并且包括使用端口<code class="fe mr ms mt mu b">9097</code>的名为<code class="fe mr ms mt mu b">tekton-dashboard</code>的<em class="lr">服务</em>，这是上面的入口中引用的值。这个入口也有重写规则，在<code class="fe mr ms mt mu b">/dashboard/...</code>路径而不是<code class="fe mr ms mt mu b">/</code>显示仪表板。这是因为我们希望使用默认的<code class="fe mr ms mt mu b">/</code>(根)路径作为事件监听器的webhook(稍后讨论)。</p><p id="d5d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要验证仪表板是否真的是活动的，一切都在运行，您可以浏览到<code class="fe mr ms mt mu b">localhost/dashboard/</code>(假设您使用的是<em class="lr">类</em>)，您应该会看到类似这样的内容(减去实际的管道):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/efd0742e678e2c6941acaf9fe66e8f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WL7gqKpIRHlZAe5SLpvhwg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">仪表盘</figcaption></figure><p id="3fa2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果所有这些设置看起来太费力，那么你可以抓取<code class="fe mr ms mt mu b"><a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter" rel="noopener ugc nofollow" target="_blank">tekton-kickstarter</a></code> <a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter" rel="noopener ugc nofollow" target="_blank">库</a>并运行<code class="fe mr ms mt mu b">make</code>，你将在一分钟内准备好以上所有内容。</p><p id="02a9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">部署完成后，所有(非常)基本的部分都已启动并运行，所以让我们在CLI中四处看看我们实际部署了哪些命令…</p><h1 id="0e30" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">探索自定义资源</h1><p id="59cd" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">如果您遵循了上面的步骤(或者只是使用了启动存储库中的<code class="fe mr ms mt mu b">make</code> target)，那么现在您的集群中应该有相当多的新资源了。Tekton的所有组件将位于<code class="fe mr ms mt mu b">tekton-pipelines</code>名称空间中，并应包括以下内容:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="4969" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些包括所有的部署、服务以及autoscaler，它们有助于在请求数量增加的情况下提高可用性。如果需要HA，那么你也可以查看<a class="ae lq" href="https://github.com/tektoncd/pipeline/blob/master/docs/install.md#configuring-high-availability" rel="noopener ugc nofollow" target="_blank">文档部分</a>，它解释了如何为HA配置Tekton。</p><p id="c228" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了上面显示的资源，您还可以在<code class="fe mr ms mt mu b">default</code>名称空间中找到事件监听器及其资源。这些可以与核心组件共享名称空间，但是像这样划分它们允许您根据它们所用于的应用程序/项目来划分管道及其webhooks:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="a314" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Tekton的安装还带来了几个CRD，用于管理所有任务、管道和触发器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="f0ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以使用这些CRD通过<code class="fe mr ms mt mu b">kubectl get</code>或<code class="fe mr ms mt mu b">kubectl describe</code>列出并检查任务和管道。</p><p id="5c5c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于Kubernetes的每个用户来说，与资源交互的自然方式是使用<code class="fe mr ms mt mu b">kubectl</code>，但Tekton也有自己的CLI工具，名为<code class="fe mr ms mt mu b">tkn</code>。你可以从这个<a class="ae lq" href="https://github.com/tektoncd/cli/releases/tag/v0.16.0" rel="noopener ugc nofollow" target="_blank">发布页面</a>下载。</p><p id="ed19" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个CLI允许您与Tekton资源进行交互，而不必处理CRD。例如，您可以列出或检查管线:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="d828" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了检查资源之外，您还可以使用它来启动任务运行或管道运行，并随后读取日志，而不必查找各个pod:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="5db0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如您在上面看到的，如果您最初没有指定参数，它甚至会提示您输入参数！</p><p id="c4f5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">不过，有一件事让我非常恼火，那就是这个CLI工具与<code class="fe mr ms mt mu b">kubectl</code>相比使用的参数顺序颠倒了。使用<code class="fe mr ms mt mu b">kubectl</code>命令是<code class="fe mr ms mt mu b">kubectl &lt;VERB&gt; &lt;RESOURCE&gt;</code>而使用<code class="fe mr ms mt mu b">tkn</code>命令是<code class="fe mr ms mt mu b">tkn &lt;RESOURCE&gt; &lt;VERB&gt;</code> -一个对其他非常方便的工具的小挑剔。</p><h1 id="2f69" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">定制一切</h1><p id="ed24" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我们已经完成的安装为所有配置提供了一些合理的默认值。这些可以稍加改变，以更好地满足您的需求，并简化事情。我们将了解2个<em class="lr">配置图</em>:</p><p id="b228" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个是<code class="fe mr ms mt mu b">config-defaults</code>，顾名思义，它为管道和任务执行设置默认值。这些包括默认超时、<em class="lr">服务账户</em>或节点选择器。这个ConfigMap最初还包括<code class="fe mr ms mt mu b">_example</code>键，它有所有可能的(注释掉的)选项及其描述，所以当有疑问时，只需运行<code class="fe mr ms mt mu b">kubectl get cm config-defaults -n tekton-pipelines -o=jsonpath='{ .data._example }'</code>。</p><p id="51b3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个可用的配置图是<code class="fe mr ms mt mu b">feature-flags</code>，它允许您打开/关闭一些Tekton功能。大多数情况下，您可以保留默认值。我只修改了<code class="fe mr ms mt mu b">require-git-ssh-secret-known-hosts</code>，我更喜欢打开它，要求在使用SSH验证git时包含<code class="fe mr ms mt mu b">known_hosts</code>。要查看当前设置，您可以运行<code class="fe mr ms mt mu b">kubectl get cm feature-flags -n tekton-pipelines -o=jsonpath='{.data}' | jq .</code>。</p><p id="870b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您想要这两种配置的完整定制版本，您可以在我的库<a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter/tree/master/config" rel="noopener ugc nofollow" target="_blank">这里</a>获取它们。如果您在这个存储库中使用了<code class="fe mr ms mt mu b">make</code>脚本来设置Tekton环境，那么这些已经在安装过程中应用了。</p><p id="4f1a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了这些全局缺省值之外，您可能还想设置其他配置。其中最重要的是向git认证的SSH密钥。这在包含SSH私钥的Kubernetes <em class="lr"> Secret </em>和<code class="fe mr ms mt mu b">base64</code>格式的<code class="fe mr ms mt mu b">known_hosts</code>文件中进行配置:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="bb70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个秘密还包括Tekton注释(<code class="fe mr ms mt mu b">tekton.dev/git-*</code>)，以使它知道应该使用它来对指定的提供者进行身份验证。</p><p id="c1c3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个重要的秘密是注册表凭证，它允许您推送Docker图像(或从私有注册表中拉出)。对于这一个，我们使用<code class="fe mr ms mt mu b">dockerconfigjson</code>秘密类型，并且我们再一次用你的提供者的注册URL指定Tekton注释:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="6e3e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，这两者都需要添加到任务和管道将使用的ServiceAccount中。这应该是之前在<code class="fe mr ms mt mu b">config-defaults</code>配置图中指定的ServiceAccount。</p><p id="7504" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">说到service accounts——您需要给它足够的权限来与管道交互，并根据管道将要做的事情有选择地添加额外的权限。例如，如果您想运行<code class="fe mr ms mt mu b">kubectl rollout</code>，那么您的ServiceAccount将需要相应的权限。</p><p id="8a2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ServiceAccount和rational role以及RoleBindings都可以在这里的库<a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter/blob/master/misc/sa.yaml" rel="noopener ugc nofollow" target="_blank">中获得。</a></p><p id="aaf4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后但同样重要的是，我还建议设置<em class="lr"> LimitRange </em>以确保你的每个任务都获得足够的CPU和内存，同时不会消耗太多。确切的值取决于您的使用情况，但这里显示了一些合理的默认值<a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter/blob/master/misc/limit.yaml" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="7649" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">至此，我们已经为Tekton的安装做好了充分的准备和定制，包括所有组件及其配置，准备运行一些管道！</p><h1 id="b191" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated">结论</h1><p id="6c18" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Tekton是一个多功能的工具，可以变得非常复杂，因此一篇短文肯定不足以详细介绍它的每一部分。这一介绍应该足以让您开始并运行所有的配置。在本系列的后续文章中，我们将探索如何使用和构建您自己的定制任务和管道，处理事件处理HTTP事件和用cron调度等等。因此，请继续关注下一篇文章，同时您可以先睹为快地浏览一下<a class="ae lq" href="https://github.com/MartinHeinz/tekton-kickstarter" rel="noopener ugc nofollow" target="_blank"> tekton-kickstarter资源库</a>中的文件，这里已经提供了本文和后续文章中的所有资源。如果你有一些反馈或建议，请随时在知识库中打开一个问题，或者如果你喜欢它的内容，就开始讨论。😉</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="0d71" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lr">本文原帖</em><a class="ae lq" href="https://martinheinz.dev/blog/45?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=blog_post_45" rel="noopener ugc nofollow" target="_blank"><em class="lr">martinheinz . dev</em></a></p><div class="nh ni gp gr nj nk"><a href="https://towardsdatascience.com/deploy-any-python-project-to-kubernetes-2c6ad4d41f14" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">将任何Python项目部署到Kubernetes</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">是时候深入Kubernetes，使用这个成熟的项目模板将您的Python项目带到云中了！</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ks nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a rel="noopener  ugc nofollow" target="_blank" href="/hardening-docker-and-kubernetes-with-seccomp-a88b1b4e2111"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">用seccomp强化Docker和Kubernetes</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">您的容器可能不像您想象的那样安全，但是seccomp配置文件可以帮助您解决这个问题…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">itnext.io</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny ks nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a href="https://towardsdatascience.com/scheduling-all-kinds-of-recurring-jobs-with-python-b8784c74d5dc" rel="noopener follow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd iu gy z fp np fr fs nq fu fw is bi translated">使用Python调度各种循环作业</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">让我们探索一下运行cron作业、延迟任务、重复任务或任何其他计划作业的所有库…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">towardsdatascience.com</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny ks nk"/></div></div></a></div></div></div>    
</body>
</html>