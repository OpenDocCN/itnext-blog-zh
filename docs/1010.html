<html>
<head>
<title>Sharing state between AngularJS and Angular v6 with Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redux在AngularJS和Angular v6之间共享状态</h1>
<blockquote>原文：<a href="https://itnext.io/sharing-state-between-angularjs-and-angular-v6-with-redux-75e3abe7f4f3?source=collection_archive---------1-----------------------#2018-07-04">https://itnext.io/sharing-state-between-angularjs-and-angular-v6-with-redux-75e3abe7f4f3?source=collection_archive---------1-----------------------#2018-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/bcb1c4da8f0da21c71377dd8aa314561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfcO2AhkejlxgZXF4XeHRQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">通过Redux共享AngularJS和Angular之间的状态</figcaption></figure><div class=""/><p id="2fa1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我之前的帖子中，关于<a class="ae la" href="https://medium.com/@roelofjanelsinga/angularjs-angular-v6-hybrid-finally-97ac37087de1" rel="noopener">用AngularJS和Angular v6 </a>构建一个混合应用程序(我从现在开始将它称为Angular)，我设置了拥有一个工作应用程序的基础。但是，当一个框架中的一些动作影响到另一个框架中的状态时，会发生什么呢？那么，您就有麻烦了，因为在Angular中访问$rootScope是一个坏主意，而反过来又太复杂了，花不了多少时间。引入Redux，集中式状态管理器。</p><h1 id="4731" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">它不仅仅与React一起使用</h1><p id="42c8" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Redux？！这难道不是反应吗？不，事实上，它是一个普通的JavaScript库，创建一个包含一些数据的JavaScript对象。这意味着你可以在React、VueJS、Angular、jQuery等中使用它。如果你愿意，你甚至可以在没有框架的情况下使用它。简单来说就是JavaScript。我以前曾经使用过Redux，但是那时候，我正在构建两个完全不同的框架，它们彼此相邻，从不接触。这一次，它是两个框架，相互实现，并一直相互对话。这是让Redux再帮我一次的绝佳时机。</p><h1 id="bbb6" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置Redux</h1><p id="1d2a" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">第一步是设置Redux，不考虑任何框架。我们必须设置一些我们希望触发的动作，一些reducers来处理当前状态中的任何变化，以及一个store来将所有这些集合在一起。然后，该商店将“提供”AngularJS和Angular。当这个完成时，我们将能够在两个框架中分派动作并订阅任何更改，以便能够同步两个不同框架的状态。</p><p id="144a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，让我们创建一个基本的Redux设置。这篇文章不是教程，所以如果你想了解这里发生了什么，我建议你阅读<a class="ae la" href="https://redux.js.org/basics" rel="noopener ugc nofollow" target="_blank">官方文档</a>。我用它作为创建自己的设置的指南，所以它与您自己的实现不会有太大的不同。</p><p id="3c86" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你真的想跟随我的脚步，这里是我的商店:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这是我将在本文中使用的示例商店</figcaption></figure><p id="94c6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">rootReducer将在稍后的博客中展示，所以现在还不用担心。初始状态及其界面如下所示:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这篇文章的初始状态</figcaption></figure><p id="1a9e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这个初始状态，我将我的languages属性设置为一个空数组，这意味着当Redux启动时，它将有一个空值，但该值就在那里，并准备好用数据填充。初始状态的类型为IAppState，如下所示:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="a18f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我不会显示ILanguage界面，因为它与本博客无关。这可以是你能想到的任何东西。它只是告诉TypeScript，languages属性将用一个ILanguage的数组填充。这可以是字符串、整数或布尔值。</p><h1 id="8e05" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置调度员和订户</h1><p id="430a" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">一旦设置好Redux，就可以开始分派动作并订阅这些事件。我想你开始明白这是怎么回事了。您将使用一个与框架无关的库在两个“独立的”框架之间共享数据。每当您调度一个操作时，订阅者都会收到Redux状态新版本形式的数据。这意味着您可以在任一框架中调度操作，在任何需要的地方添加订阅者，并无缝地交换数据。如果您愿意，您甚至可以使用它在同一个框架内交换数据。对于AngularJS，这可以帮助您完全删除对$rootScope的使用。</p><h1 id="24c7" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Ng-Redux</h1><p id="df29" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">为了方便地在AngularJS中集成Redux，我使用了NPM软件包“<a class="ae la" href="https://github.com/angular-redux/ng-redux" rel="noopener ugc nofollow" target="_blank"> ng-redux </a>”。这是完全可选的，因为你不需要它来使Redux工作，但它使与AngularJS的集成更简单。您可以通过发出以下命令来安装它:</p><pre class="me mf mg mh gt mk ml mm mn aw mo bi"><span id="7e67" class="mp lc jf ml b gy mq mr l ms mt">yarn add ng-redux</span></pre><p id="e032" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">或者，如果你不使用纱线:</p><pre class="me mf mg mh gt mk ml mm mn aw mo bi"><span id="56a1" class="mp lc jf ml b gy mq mr l ms mt">npm install ng-redux -S</span></pre><p id="abbb" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当您将这个包包含在您的项目中时，您必须将它与您在我前面提到的Redux指南中创建的Redux store链接起来。我在上面链接的GitHub页面希望你创建一个新的商店，只是为了AngularJS，但这不是我们想要做的事情。我们已经创建了商店，我们不只是想在AngularJS使用它。因此，使用以下代码用现有存储初始化ng-redux:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">在AngularJS应用程序中初始化Redux的简单方法</figcaption></figure><p id="6491" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我在这里做的只是简单地包含我需要的库:Angular、ng-redux和我之前创建的redux存储。然后我告诉ng-redux使用现有的存储，而不是创建一个新的存储。我们需要使用这个现有的商店，因为它允许我们在AngularJS和Angular之间进行交流。现在让我们来看看Angular。</p><h1 id="3d86" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">@angular-redux/store</h1><p id="c045" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">我在Angular中做了类似的事情，但是在这个版本中使用了合适的包。这个包叫:“<a class="ae la" href="https://github.com/angular-redux/store" rel="noopener ugc nofollow" target="_blank"> @angular-redux/store </a>”。再次使用以下命令之一:</p><pre class="me mf mg mh gt mk ml mm mn aw mo bi"><span id="8b44" class="mp lc jf ml b gy mq mr l ms mt">yarn add @angular-redux/store</span></pre><p id="d236" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">或者，如果你不使用纱线:</p><pre class="me mf mg mh gt mk ml mm mn aw mo bi"><span id="d651" class="mp lc jf ml b gy mq mr l ms mt">npm install @angular-redux/store -S</span></pre><p id="32f5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在AngularJS中，我向您展示了我向ng-redux提供了现有的Redux存储。这也正是我们要为Angular做的:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">初始化@ angular-redux/存储在Angular中的AppModule中</figcaption></figure><p id="80b3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请注意，这是我的实际AppModule的精简版本，所以不要简单地将其复制并粘贴到您自己的项目中。我在这个代码片段中做的是包含来自@angular-redux/store包的NgReduxModule和注入器，以及与我在AngularJS代码片段中包含的完全相同的存储，以及一个TypeScript非常喜欢的接口。在AppModule的构造函数中，我为NgRedux提供了我之前创建的并且已经在AngularJS中提供的存储。我们已经准备好让这些框架相互交互了！</p><h1 id="16a0" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">准备时间</h1><p id="3fb2" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">为了使这部分简单，我将向您展示两件事:AngularJS发送事件和Angular接收事件。当你知道如何从一种方式沟通到另一种方式时，其他方式的沟通就很容易了。</p><p id="5bbf" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我将展示一个带有缩减器的动作的一个小片段，所以您大概知道在这个特定的例子中发生了什么。</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这是您可以在这个Redux存储中调度的示例操作</figcaption></figure><p id="e089" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">出于演示的目的，我只包含了一个可以在Redux设置中分派的动作。我使用常量来确定动作，因为它们可以在PhpStorm中进行类型提示，这样可以节省我的时间。</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这是一个带有单个缩减器的根缩减器的例子</figcaption></figure><p id="87d2" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是一个根缩减器，只提供了一个缩减器，即语言缩减器。如果只有一个减速器，就没有必要使用组合减速器。但这是真实设置的简化片段，所以我有大约15个减速器。</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">这是RootReducer中提供的示例语言缩减器</figcaption></figure><p id="78eb" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这是我实际使用的语言缩减器。如你所见，我在这里给出的默认值是INITIAL_STATE常量的一部分。这确保我得到一个可预测的值，以防我选择忽略状态变化。这个reducer所做的只是返回一个填充了ILanguage类型对象的数组。正如我之前提到的，这种类型实际上是什么并不重要。你可以把它当成一个字符串数组来读。</p><h1 id="c1fc" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">是时候开始说话了</h1><p id="8af8" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">因此，有了存储、操作和缩减器，我们就可以开始调度操作和接收数据了。首先，我们来看看AngularJS用一些数据调度一个动作，Angular接收这些数据会是什么样子:</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AngularJS用Redux调度新语言</figcaption></figure><p id="32d0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">AngularJS刚刚派出了一个行动。它包含一个包含一些数据的简单JavaScript对象。让我们看看如何在Angular中捕捉这些数据。</p><figure class="me mf mg mh gt is"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">角度接收随机分量中的数据</figcaption></figure><p id="83b4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这里您可以看到Angular是如何接收组件中的数据的。现在，您已经在两个不同的框架中获得了相同的数据。这可以帮助您使它们保持同步，无缝地协同工作。分享数据不一定很难。根据同样的原理，您可以在Angular中调度一个动作，并在AngularJS中接收数据。不过我打算让你自己弄清楚怎么做:)(在ng-redux和@angular-redux/store的文档中都有，放心吧！).</p><h1 id="1f35" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="c98c" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">一旦你知道它是如何工作的，在框架之间共享数据并不困难。在这篇文章中，我演示了如何在AngularJS和Angular之间发送数据，但是您可以很容易地将其更改为Angular/React、React/VueJS/Angular、AngularJS/VueJS，嘿，让我们来点有趣的，React/jQuery。您使用哪种框架并不重要，只要您使用的是JavaScript(或者我使用的是TypeScript)，您就已经可以在项目中使用Redux了。</p><p id="3148" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你对我如何改进我的内容或我的例子有任何建议，请告诉我！我总是乐于接受建议。如果你有任何问题，你可以在评论中提问，我会尽我所能回答你。</p></div></div>    
</body>
</html>