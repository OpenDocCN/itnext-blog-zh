<html>
<head>
<title>Debug your tests in TypeScript with Visual Studio Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Visual Studio代码在TypeScript中调试测试</h1>
<blockquote>原文：<a href="https://itnext.io/debug-your-tests-in-typescript-with-visual-studio-code-911a4cada9cd?source=collection_archive---------1-----------------------#2021-02-13">https://itnext.io/debug-your-tests-in-typescript-with-visual-studio-code-911a4cada9cd?source=collection_archive---------1-----------------------#2021-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8a2f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在本文中，我将向您展示如何设置Visual Studio代码，以获得测试概述并调试单个测试。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/012c449e094c8a67748ce580c59b26a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fM1GRQBheZduom5ndroBZQ.png"/></div></div></figure><p id="7ab4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们使用了来自<a class="ae ln" rel="noopener ugc nofollow" target="_blank" href="/testing-with-jest-in-typescript-cc1cd0095421">上一篇文章</a>的示例项目，该文章讲述了如何用jest在Typescript中建立一个新项目。</p><p id="2935" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GitHub上的消息来源:【https://github.com/bromix/typescript-jest-example T4】</p><p id="9c45" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随着您的项目继续增长和复杂性的增加，测试的数量也在增加。让我们想象一下，我们有一个大约100个测试的大项目，现在有一个测试失败了。你必须知道哪个测试失败了，为什么失败了，错误发生在源代码的什么地方。</p><h1 id="5a21" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">入门指南</h1><p id="6e04" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">正如我们在上一篇文章中所做的，我们再次更改了<code class="fe ml mm mn mo b">add()</code>函数，导致了一个错误。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/826deb32fac1dd9eaa4b372c000618a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SpwAyUbzwJhP3OtD.png"/></div></div></figure><p id="5e21" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们从控制台运行所有测试，我们将看到类似下图的内容，但是如果IDE能够帮助我们更高效地工作，那将非常有帮助。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/71934071e7d4d122db4cb437d7e9e1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egGsmqMXZnjzviZhgOH31g.png"/></div></div></figure><h1 id="be16" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">测试资源管理器UI扩展</h1><p id="d013" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这个优秀的扩展能做什么我就不细说了。关于它的所有信息都可以在<a class="ae ln" href="https://marketplace.visualstudio.com/items?itemName=hbenl.vscode-test-explorer" rel="noopener ugc nofollow" target="_blank">市场页面</a>上找到。</p><p id="32c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简而言之，这个扩展为Visual Studio代码添加了一个测试浏览器，它通过社区编写的附加扩展(称为适配器)支持不同的语言和测试框架。只要看看Marketplace页面，看看支持多少种语言和测试框架。我自己用它来处理TypeScript、Python和C++。</p><p id="8b23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将安装<a class="ae ln" href="https://marketplace.visualstudio.com/items?itemName=kavod-io.vscode-jest-test-adapter" rel="noopener ugc nofollow" target="_blank"> Jest测试浏览器</a>适配器。适配器还会为我们安装相关的测试资源管理器UI扩展(如果尚未安装的话)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/7b5c732d213f8cd799b1a79a20bb0ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IaR9XJ-RzKJIoTscsjL4Q.png"/></div></div></figure><h1 id="db17" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">它是如何工作的？</h1><p id="f10d" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">安装适配器和扩展后，您将在左侧看到一个新图标(一个试管)。当您点击它时，您将进入测试浏览器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/59340f56bd2ec55d34c24eade56ca25b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVH0dhfpeAiYJtatbSK9Bg.png"/></div></div></figure><p id="7229" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以获得每个测试文件(在我们的例子中是<code class="fe ml mm mn mo b">calc.test.ts</code>)的概述，以及包含在它们自己的层次结构中的测试。在上图中，我试图可视化从测试浏览器到文件中测试的关系。</p><p id="bc52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可能还注意到了测试文件中每个测试上面的附加条目。这些条目将帮助您运行单个单独的测试，或者只是使用工作断点调试单个测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/c355108960a7b1945e8afb3518139431.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvPKa_V_oSwObIr9j6beeA.png"/></div></div></figure><p id="a76a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe ml mm mn mo b">Run</code>将只运行没有附加调试器的测试。<br/> <code class="fe ml mm mn mo b">Debug</code>将使用附加的调试器运行测试。<br/> <code class="fe ml mm mn mo b">Show in Test Explorer</code>将跳转到测试浏览器中的条目。</p><h2 id="606e" class="mt lp iq bd lq mu mv dn lu mw mx dp ly la my mz ma le na nb mc li nc nd me ne bi translated">一次单独或全部运行测试</h2><p id="6b1f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">如果您浏览测试资源管理器，您将看到您可以在层次结构中的任何级别运行测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/782ad79912d171a855ff3575794b3cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*B2NIyffLGP4qywOjQMHTLw.gif"/></div></div></figure><p id="a6b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于这个例子，让我们运行所有的测试，我们会看到所有的测试都会失败。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/652992654edde7ab24f8fda949e87715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*eLZF3NaiABm0mW2v5R7NGw.gif"/></div></div></figure><p id="d0ae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了演示Test Explorer的有用性，我们添加了一个额外的两个数相乘的函数，并为它编写了一个合适的测试。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/0eb1246b16983f3084cba22bd32c0997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m5-AuIpSP8a6ns0WiSjCxw.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">src/calc.ts中的函数mul(x，y)</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/9dcc9d8927bb5578c45239317938691e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6BbBNcW053GmGHzHs7caog.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">在test/calc.test.ts中测试mul(x，y)</figcaption></figure><p id="6353" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您将立即看到Test Explorer已经用新的测试更新了它的概述。现在我们重新开始所有的测试…</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/a01449fe35915d59c88d1fea90d85113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*axuWMrwKTGXd30toIcFGWw.gif"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">显示哪些测试失败了，哪些没有</figcaption></figure><p id="6e6d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在总览中，您现在可以确切地看到哪个层次中的哪个测试失败了。现在让我们想象一下，正如我在开始提到的，我们可能有一个包含100个测试的项目。你很快就会忘记这一点。测试资源管理器对于一个接一个地调试单个测试(如果有几个测试失败)非常有帮助。</p><h2 id="1ddd" class="mt lp iq bd lq mu mv dn lu mw mx dp ly la my mz ma le na nb mc li nc nd me ne bi translated">调试失败的测试</h2><p id="fc79" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">如果您选择了一个失败的测试，您会得到选项(最右边的最后一个图标)来直接跳转到测试的实现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/978776b1e2a2ff53cb6d4a43a0019a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NH9VHiDj4qAswgyibbIS8g.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">跳转到测试的实现</figcaption></figure><p id="7e6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，我们可以在测试中设置一个断点，并使用debug运行单个测试，等待调试器在断点处停止，按F11键跳转到函数<code class="fe ml mm mn mo b">add()</code>，查看值<code class="fe ml mm mn mo b">x</code>和<code class="fe ml mm mn mo b">y</code>，并检查为什么返回值为假。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/cec17efc4bce4fb245d1ce2b718b427e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*_xW2JBAM1NVim8vhh_Ya6w.gif"/></div></div></figure><p id="c1da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们用一个<code class="fe ml mm mn mo b">+</code>替换我们错误设置的<code class="fe ml mm mn mo b">-</code>，并再次运行测试。之后，所有的测试应该会再次成功运行。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nq"><img src="../Images/2a0be303fad8cbc070cb60fd41603331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9OeAruERfvZ2QPXoXxa8A.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">所有测试运行无误</figcaption></figure><h1 id="882f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="f81e" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这是一个非常简单的例子，说明基于测试的调试是如何工作的。我不想因为太多的高级功能而分心，只是在本文中展示了方法和原则。<br/>另外，我想指出由<a class="ae ln" href="https://github.com/hbenl" rel="noopener ugc nofollow" target="_blank"> Holger Benl </a>为Visual Studio代码开发的非常有用的扩展<a class="ae ln" href="https://marketplace.visualstudio.com/items?itemName=hbenl.vscode-test-explorer" rel="noopener ugc nofollow" target="_blank"> Test UI Explorer </a>。在我看来，没有这个扩展，调试测试就没有任何意义了。该扩展为开发人员提供了一个概览，并节省了逐个调试测试的时间。</p><p id="c215" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢这篇文章，如果你有任何问题或建议，请联系我。</p><p id="4b7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完整的例子可以在GitHub上找到:<a class="ae ln" href="https://github.com/bromix/typescript-jest-example" rel="noopener ugc nofollow" target="_blank">https://github.com/bromix/typescript-jest-example</a></p></div></div>    
</body>
</html>