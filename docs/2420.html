<html>
<head>
<title>How to improve the social network auth process in your node application.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何改进你的节点应用中的社交网络认证过程？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-improve-the-social-network-auth-process-in-your-node-application-48ac5791131f?source=collection_archive---------10-----------------------#2019-05-20">https://itnext.io/how-to-improve-the-social-network-auth-process-in-your-node-application-48ac5791131f?source=collection_archive---------10-----------------------#2019-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2bde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将描述对用户系统的小而有用的增强。这有助于更有效地创造新用户注册社交网络。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/311bb31ff2b80ca0e9990f62bb14318d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PirSypUX7sjpvMwkf8m7Dg.jpeg"/></div></div></figure><h2 id="8082" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">任务的核心</h2><p id="7cf7" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">任务是实现存储用户配置文件图像的能力。这是关于注册社交网络的用户。例如谷歌或脸书。</p><h1 id="ac64" class="lv ky iq bd kz lw lx ly lc lz ma mb lf mc md me li mf mg mh ll mi mj mk lo ml bi translated">可能的解决方案</h1><p id="b8ab" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">有多种方法可以解决这个子任务。</p><p id="a158" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">解决方案1。</strong>最简单的是将社交网络提供的用户图片URL存储到你的数据库中。这是一个容易实现的解决方案，但它有很多副作用。首先，存储一个外部链接不是最好的解决方案，因为链接可以在你的应用程序之外改变，而之前存储在你的应用程序中的链接就变得无效了。</p><p id="05db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">方案二。</strong>解决该任务的另一种方法是不仅存储链接，还存储与该链接一起提供的图像。在服务器上存储图像不是最好的主意，使用特殊的文件存储服务要好得多。在我的实践中最受欢迎的是AWS S3(简单存储服务)。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/b3e9d080a366d41de52d6776ec283322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXSoA4l0UVufh0C6IG2aWA.jpeg"/></div></div></figure><p id="7873" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上传到s3存储桶的映像通过公共链接变得可用(在一些附加文件访问配置之后)。S3提供的链接将存储在数据库中，并在必要时发送给客户端。</p><p id="eee1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来几乎像解决方案1，但我们有一个巨大的区别——可靠性。除了S3存储所有者以外，任何人都不能删除文件或更改指向文件的链接。所以存储的链接将是实际的全部时间。<br/>所以存储图像的算法过程看起来如下:</p><ul class=""><li id="2e42" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated">注册过程中从社交网络获取用户图像URL</li><li id="2a14" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">将图像从URL存储到服务器文件系统</li><li id="a9ec" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">将图像上传到S3存储器</li><li id="7bbb" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">疼痛S3图像链接到一个数据库</li><li id="5aa6" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">从文件系统中删除临时映像</li></ul><p id="6604" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法还不错，但不是最好的解决方案。下一个解决方案描述了如何更正确、更快地做同样的事情。</p><p id="dc23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">方案三。</strong>这与上一步中的算法几乎相同，只有一个关键的区别——我不会将图像存储到服务器文件系统中。增强的思想是将图像文件存储到一个临时缓冲区，然后从这个缓冲区上传到S3存储器。</p><p id="e606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么这种方式应该工作得更快？—因为文件操作非常耗时。因此，如果我避免它们，我可以避免一些额外的时间成本。</p><p id="0119" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">理论上看起来不错，让我们在下一节继续练习。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/fcd094dfdcb2eed96b08f8349458c4c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*m5VETgQTH3ZLcfjg09ji1A.jpeg"/></div></figure><h1 id="7539" class="lv ky iq bd kz lw lx ly lc lz ma mb lf mc md me li mf mg mh ll mi mj mk lo ml bi translated">实践</h1><p id="4487" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">所以我将这种方法的实现分为三个功能。</p><ul class=""><li id="4e32" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated">第一个“loadimagefromrurltobuffer”—接受文件URL，将其下载到缓冲区中，并作为执行结果返回一个文件。</li><li id="52fb" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第二个“storebufferedimagetos 3”——接受文件缓冲，上传数据到S3，并返回S3文件链接。</li><li id="1dea" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">第三个是“storeSocialNetworkImageToS3”，它只是一个包装器，提供前面两个函数之间的交互。</li></ul><p id="1e94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个代码示例中所有实现</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="32dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个功能，我使用了两个额外的npm包，这简化了程序员的许多工作=)</p><p id="ad38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“AWS-SDK”——JavaScript的官方AWS SDK。</p><p id="fefa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“请求”——简单而强大的HTTP客户端。</p><p id="9012" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，在上传到S3之前，还可以对缓冲文件进行预处理、调整大小、压缩或其他一些操作。</p><h1 id="e7c9" class="lv ky iq bd kz lw lx ly lc lz ma mb lf mc md me li mf mg mh ll mi mj mk lo ml bi translated">结论</h1><p id="0589" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在本文中，我描述了一种有趣的优化方法，在注册过程中为节点应用程序的用户系统执行一个常见任务。<br/>它也可以针对特定需求进行修改，我只是分享一下核心思想。</p><p id="acbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这篇文章对你来说有趣或有用，请随意在左侧面板留下一些掌声。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/955c002560d2a81c813810dbed318f22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B5q-yZ63JooxlXBPbqkONg.png"/></div></div></figure></div></div>    
</body>
</html>