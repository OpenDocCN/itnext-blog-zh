<html>
<head>
<title>Reading Data From A JSON File With Gatsby + GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gatsby + GraphQL从JSON文件中读取数据</h1>
<blockquote>原文：<a href="https://itnext.io/reading-data-from-a-json-file-with-gatsby-graphql-572b18ab98a?source=collection_archive---------2-----------------------#2019-02-08">https://itnext.io/reading-data-from-a-json-file-with-gatsby-graphql-572b18ab98a?source=collection_archive---------2-----------------------#2019-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8667c974bf3e5ebaf0e538cc3f7b32a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GoJNtJ544CcXgLtkrQ7Lg.png"/></div></div></figure><p id="6913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">目标:</strong>使用<code class="fe kw kx ky kz b">gatsby-transformer-json</code>从本地JSON文件中读取数据，并在React组件中动态生成列表项。</p><p id="21d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">用例:</strong>我有一个侧边栏React组件，它接受侧边栏列表项(对象)的数组，并从它们的数据中动态生成列表项。我不想硬编码所有的侧边栏值，因为这会很快变得难以控制。因此，我希望有一个JSON文件，可以在其中快速添加新的列表项，并将其传播到UI。</p><p id="d122" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">本博客假设你已经有了一个</em> <a class="ae lb" href="https://www.gatsbyjs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="la">盖茨比</em> </a> <em class="la">项目创建。您可以使用Gatsby CLI快速启动新的应用程序。我的sidebar.js组件正在被导入到index.js starter文件中，该文件是在运行CLI命令后生成的。</em></p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><ol class=""><li id="6955" class="lj lk iq ka b kb kc kf kg kj ll kn lm kr ln kv lo lp lq lr bi translated">创建存储JSON数据的目录和JSON文件。我的会住在<code class="fe kw kx ky kz b">src/data/sidebarItems.json</code>里面。</li></ol><p id="8b27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的JSON数据具有以下结构:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/a5f4acfe87177195fc04c52106e42690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKxpJ3gse6Bo5W1KxOcmFA.png"/></div></div></figure><p id="7620" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.接下来，安装<code class="fe kw kx ky kz b">gatsby-transformer-json</code>和<code class="fe kw kx ky kz b">gatsby-source-filesystem</code>。</p><pre class="lt lu lv lw gt lx kz ly lz aw ma bi"><span id="2ea4" class="mb mc iq kz b gy md me l mf mg">npm install gatsby-transformer-json gatsby-source-filesystem --save</span></pre><p id="ded5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.在<code class="fe kw kx ky kz b">gatsby-config.js</code>文件中，添加以下内容:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/934957160d6fa5bf150cc6e7484d9de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*693UhT8gmukxqvxEkxhlow.png"/></div></div></figure><p id="b7b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">path</code>值将链接到包含JSON文件的文件夹。</p><p id="b442" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.接下来，打开要使用数据的组件。我住在<code class="fe kw kx ky kz b">sidebar.js</code>里面</p><p id="9ef2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先从<code class="fe kw kx ky kz b">gatsby</code>导入<code class="fe kw kx ky kz b">StaticQuery</code>和<code class="fe kw kx ky kz b">graphql</code>。我们需要这些来访问我们的JSON数据。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/4a64144e4cffcd80be7b61a3a122c313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j_xHIft1jC-FX__9BaS6TA.png"/></div></div></figure><p id="1fac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用Gatsby的<a class="ae lb" href="https://www.gatsbyjs.org/docs/static-query/" rel="noopener ugc nofollow" target="_blank">静态查询</a>来包装一个<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/react-component-class-vs-stateless-component-e3797c7d23ab">无状态功能反应组件</a>。</p><p id="1999" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">&lt;StaticQuery /&gt;</code>元素内部，添加两个属性:<code class="fe kw kx ky kz b">query</code>和<code class="fe kw kx ky kz b">render</code>。</p><h1 id="ebfa" class="mj mc iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">查询属性</h1><p id="807b" class="pw-post-body-paragraph jy jz iq ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">查询属性的值如下所示:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/862f2754e98365e879be23523057ccb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiTBvfkzaRlA_4Ap9RYUfw.png"/></div></div></figure><p id="22b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们正在创建一个名为<code class="fe kw kx ky kz b">SidebarItemsQuery</code>的查询(您可以随意命名该查询；我选择命名为<code class="fe kw kx ky kz b">{dataReturned}Query</code>。返回的数据将是侧栏条目，因此查询名称将是<code class="fe kw kx ky kz b">SidebarItemsQuery</code>。</p><p id="d1b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们有<code class="fe kw kx ky kz b">allSidebarItemsJson</code>。您必须根据您的JSON文件名来命名它。自从我有了<code class="fe kw kx ky kz b">SidebarItems.json</code>，这就叫做<code class="fe kw kx ky kz b">allSidebarItemsJson</code>。这是默认的命名约定，但是您可以在<code class="fe kw kx ky kz b">gatsby-config.js</code>中更改它(更多细节请参见最后的“更改默认的gatsby-transformer-json命名约定”一节)。</p><p id="e380" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中有<code class="fe kw kx ky kz b">edges</code>、<code class="fe kw kx ky kz b">node</code>，以及我们希望从查询中返回的值。在我的例子中，由于我创建了一个侧边栏，其中有一列指向不同内容的链接，所以我有一个<code class="fe kw kx ky kz b">label</code>和一个<code class="fe kw kx ky kz b">link</code>(参见下面的“GraphQL命名法”一节，了解边和节点的高级定义)。</p><h1 id="cac6" class="mj mc iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">渲染属性</h1><p id="5177" class="pw-post-body-paragraph jy jz iq ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">现在我们有了查询，让我们定义呈现属性。该属性将接受一个参数:来自我们刚刚编写的查询的数据。它将返回我们希望无状态功能组件呈现的JSX。</p><p id="4c00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">注意:您可以将JSX放在空括号中`&lt; &gt; … &lt; / &gt;`作为</em> <a class="ae lb" href="https://reactjs.org/docs/fragments.html" rel="noopener ugc nofollow" target="_blank"> <em class="la"> React片段</em> </a> <em class="la">的简写。这允许您返回多个子组件，而无需向DOM追加额外的节点。</em></p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/5de32ae2cbfc842f0dc1ab478881ff1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_nbNg-kG2m5CIaHiLrYHA.png"/></div></div></figure><p id="a301" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这和写这个是一样的:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/a44dd168acdc46d48f7c6f539f921212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6kjAsbQwcXEAJ7-V6w3pjA.png"/></div></div></figure><p id="2a08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我想迭代这些节点，并为每个标签创建一个<code class="fe kw kx ky kz b">&lt;h1&gt;</code>；它可能看起来像这样。我创建了一个<code class="fe kw kx ky kz b">getSidebarLabels</code>助手函数，它接收数据并对其进行迭代以创建三个<code class="fe kw kx ky kz b">&lt;li&gt;</code>项。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/e91269d2cee949218d8ac44f35556d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8z2WjMlR_GJVa6MMhV-4Eg.png"/></div></div></figure><p id="a0f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">助手功能如下:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/d2a4ad9815423122253061bffb4f4e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VdQ2FVDtP3_L5Q4iYJCTQ.png"/></div></div></figure><p id="4f5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们所料，DOM中添加了三个列表项。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/05888fa4019cdb2aff617456538ef352.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*RFYcaCmQSFKIZhQi_M0_JA.png"/></div></figure><p id="2b29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是<code class="fe kw kx ky kz b">sidebar.js</code>中无状态功能组件的完整代码。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/c91e8ed073145c0cb075dc919d6582e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ki5QO0Q9j-Wb6LFJfNb9Zw.png"/></div></div></figure><h1 id="9b6b" class="mj mc iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">图表命名法</h1><p id="6353" class="pw-post-body-paragraph jy jz iq ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">GraphQL 使用图形来表示数据。你可以把它想象成这样:</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/70d60133f9c19b0989093b6a092f027d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e72Er_KPHQtHtb92TBRk7g.png"/></div></div></figure><p id="6767" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">边:</strong>连接图中不同节点的线，表示一种关系。</p><p id="8076" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">节点:</strong>记录或数据。</p><p id="b1f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们举一个像Medium这样的博客网站的例子。在这个用例中，节点可以被认为是博客文章或用户。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/24946d773db01dd9f25164bdb04a6a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tAd1ZPpiNUKaQDh_GS-P3Q.png"/></div></div></figure><p id="2ed9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不是GraphQL方面的专家；我还在学！如果我说错了什么，请在下面留下你的评论。</p><h1 id="eb26" class="mj mc iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">更改默认的gatsby-transformer-json命名约定</h1><p id="90f2" class="pw-post-body-paragraph jy jz iq ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">要更改JSON查询，请转到<code class="fe kw kx ky kz b">gatsby-config.js</code>，用下面的对象替换<code class="fe kw kx ky kz b">"gatsby-transformer-json"</code>行。</p><p id="c13f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在选项对象内部，更新<code class="fe kw kx ky kz b">typeName</code>键；这可以是任何字符串值。在这里，我们放入了静态值<code class="fe kw kx ky kz b">Json</code>，尽管需要注意的是这只是一个字符串值，所以如果你愿意，你可以称它为<code class="fe kw kx ky kz b">Cats</code>。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/48a628de23a65bfab1a7e75220bb92db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tunJXAiR82_PwusAV-Axyw.png"/></div></div></figure><p id="f29d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在我们创建GraphQL查询的文件内部(在我的例子中是<code class="fe kw kx ky kz b">sidebar.js</code>，用<code class="fe kw kx ky kz b">all{typeName}</code>引用查询中新命名的typeName值。</p><figure class="lt lu lv lw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/705e7ce1da9ffb33b5150248521cee1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llQsOLJBZgBDFVrNhutDsA.png"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="0fb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您知道了如何使用gatsby-transformer-json从本地json文件中读取数据。我写这篇博文主要是为了我自己的利益(我以后可能需要引用它)，所以可能会有一些小错误。如果你发现了什么，请在下面的评论中告诉我。:)</p></div></div>    
</body>
</html>