<html>
<head>
<title>WhatsApp Status Saver/Downloader Using Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter的WhatsApp状态保护程序/下载器</h1>
<blockquote>原文：<a href="https://itnext.io/whatsapp-status-saver-downloader-using-flutter-ff5ff897e56?source=collection_archive---------2-----------------------#2020-01-09">https://itnext.io/whatsapp-status-saver-downloader-using-flutter-ff5ff897e56?source=collection_archive---------2-----------------------#2020-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a56" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你好，今天我将带你了解如何在没有任何额外知识的情况下使用Flutter创建一个WhatsApp状态保护程序。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/fc05b14891aeb33deab113258a2dec24.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*LRmYpvJyn2bqZVwP0TLYpA.png"/></div></figure><p id="82d1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对于那些需要完整代码并且对阅读整篇文章不感兴趣的人来说，Github repo的链接在本文的底部。</p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><p id="591d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以最近一直在学习flutter，决定分享一下这个。我假设你知道关于颤振的基本知识，但最终，我们都是学习者。</p><h1 id="b860" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">文件结构</h1><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="d97f" class="mn lr iq mj b gy mo mp l mq mr">Lib<br/>    -ui<br/>	  - aboutScreen.dart<br/>	  - dashboard.dart<br/>	  - imageScreen.dart<br/>	  - mydrawer.dart<br/>	  - settingScreen.dart<br/>	  - videoScreen.dart<br/>	  - viewphotos.dart<br/>    -utils<br/>	  - video_controller.dart<br/>	  - video_play.dart<br/>    -main.dart</span></pre><p id="40e4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用的插件:</p><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="0384" class="mn lr iq mj b gy mo mp l mq mr">Plugins<br/>share: // to handle sharing of application<br/>url_launcher: // to open links from the app<br/>permission_handler: // to handle storage permissions<br/>flutter_staggered_grid_view: // to display images in a grid <br/>path_provider: // to get path from storage device<br/>image_gallery_saver: // save images to gallery<br/>flutter_fab_dialer: // floating action button dialer<br/>thumbnails:<br/>chewie:<br/>video_player:</span></pre><p id="1334" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">上面已经提到了使用的插件。您可以在pubspec.yaml文件中看到所有插件。现在，我将把pubspec.yaml文件放在这里。</p><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="1b4b" class="mn lr iq mj b gy mo mp l mq mr">name: wa_status_saver<br/>description: A new Flutter application.<br/><br/>environment:<br/>  sdk: "&gt;=2.1.0 &lt;3.0.0"<br/><br/>dependencies:<br/>  flutter:<br/>    sdk: flutter<em class="ms"><br/>  </em>cupertino_icons: ^0.1.2<br/>  share: ^0.6.3+5<br/>  url_launcher: ^5.4.1<br/>  permission_handler: ^4.0.0<br/>  flutter_staggered_grid_view: ^0.3.0<br/>  path_provider: ^1.5.1<br/>  image_gallery_saver: ^1.2.2<br/>  flutter_html: ^0.11.1<br/>  flutter_fab_dialer: ^0.1.1<br/>  esys_flutter_share: ^1.0.2<br/>  thumbnails: ^1.0.1<br/>  chewie: ^0.9.8+1<br/>  video_player: ^0.10.5+1<br/><br/>dev_dependencies:<br/>  flutter_test:<br/>    sdk: flutter<br/>  flutter_launcher_icons: ^0.7.4<br/><br/>flutter_icons:<br/>  android: "launcher_icon"<br/>  ios: true<br/>  image_path: "assets/images/logo.png"<br/><em class="ms"><br/># The following section is specific to Flutter.<br/></em>flutter:</span><span id="94b7" class="mn lr iq mj b gy mt mp l mq mr"><em class="ms">  </em>uses-material-design: true<br/><em class="ms"><br/>  </em>assets:<br/>   - assets/images/logo.png<br/>   - assets/images/video_loader.gif</span></pre><p id="97a5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">应用程序是如何工作的？</p><p id="bae7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">查看上面的截图，更好地了解应用程序的外观。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/6998e0a6bac060b0ae53ed937bf3952e.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*CQTz8tKNNup9BfHbxhOEgg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">android设备上的应用外观</figcaption></figure><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="fe30" class="mn lr iq mj b gy mo mp l mq mr">A user opens the application and has to grant the app access to storage of the device after which app is triggered.<br/>-<strong class="mj ir">Dashboard</strong><br/>  -Photo Status<br/>    - List of WhatsApp Photo Status from user device.<br/>      - View Specific photo (on click)<br/>        - Download Photo. <br/>  -Video Status<br/>    - List of WhatsApp Video Status from user device.<br/>      - View Specific Video (on click)<br/>        - Download Video.<br/>        - Play Video.<br/><strong class="mj ir">-Navigation Drawer<br/>  </strong>-About us <br/>  -Share with Friends<br/>  -Rate and Review</span></pre><p id="8971" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我们来看代码。这个故事似乎很无聊，对吗？</p><p id="5e84" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">首先，我们需要用户设备文件存储的权限，以便访问保存所有状态的WhatsApp目录。状态保存在一个隐藏的目录中(。这就是为什么状态似乎没有出现在文件管理器中。</p><p id="7f1a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将使用permission_handler插件从用户那里获得存储权限。我将在main.dart文件中添加权限代码，因为我想在用户第一次打开应用程序时向他请求权限。</p><p id="6ddf" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">main . dart[代码已用dartfmt格式化，以便于阅读]</p><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="2e5e" class="mn lr iq mj b gy mo mp l mq mr">import 'package:flutter/material.dart';<br/>import 'package:wa_status_saver/ui/dashboard.dart';<br/>import 'package:wa_status_saver/ui/mydrawer.dart';<br/>import 'package:share/share.dart';<br/>import 'package:permission_handler/permission_handler.dart';<br/>import 'package:flutter_html/flutter_html.dart';<br/><br/>final GlobalKey&lt;ScaffoldState&gt; _scaffoldKey = new GlobalKey&lt;ScaffoldState&gt;();<br/><br/>void main() {<br/>  runApp(new MaterialApp(<br/>    debugShowCheckedModeBanner: false,<br/>    home: new MyApp(),<br/>  ));<br/>}<br/><br/>class MyApp extends StatefulWidget {<br/>  @override<br/>  MyAppState createState() =&gt; new MyAppState();<br/>}<br/><br/>class MyAppState extends State&lt;MyApp&gt; {<br/>  int _storagePermissionCheck;<br/>  Future&lt;int&gt; _storagePermissionChecker;<br/><br/>  Future&lt;int&gt; checkStoragePermission() async {<br/>    // bool result = await SimplePermissions.checkPermission(Permission.ReadExternalStorage);<br/>    PermissionStatus result = await PermissionHandler()<br/>        .checkPermissionStatus(PermissionGroup.<em class="ms">storage</em>);<br/>    print("Checking Storage Permission " + result.toString());<br/>    setState(() {<br/>      _storagePermissionCheck = 1;<br/>    });<br/>    if (result.toString() == 'PermissionStatus.denied') {<br/>      return 0;<br/>    } else if (result.toString() == 'PermissionStatus.granted') {<br/>      return 1;<br/>    } else {<br/>      return 0;<br/>    }<br/>  }<br/><br/>  Future&lt;int&gt; requestStoragePermission() async {<br/>    // PermissionStatus result = await SimplePermissions.requestPermission(Permission.ReadExternalStorage);<br/>    Map&lt;PermissionGroup, PermissionStatus&gt; result =<br/>        await PermissionHandler().requestPermissions([PermissionGroup.<em class="ms">storage</em>]);<br/>    if (result.toString() == 'PermissionStatus.denied') {<br/>      return 1;<br/>    } else if (result.toString() == 'PermissionStatus.granted') {<br/>      return 2;<br/>    } else {<br/>      return 1;<br/>    }<br/>  }<br/><br/>  @override<br/>  void initState() {<br/>    super.initState();<br/>    _storagePermissionChecker = (() async {<br/>      int storagePermissionCheckInt;<br/>      int finalPermission;<br/><br/>      print("Initial Values of $_storagePermissionCheck");<br/>      if (_storagePermissionCheck == null || _storagePermissionCheck == 0) {<br/>        _storagePermissionCheck = await checkStoragePermission();<br/>      } else {<br/>        _storagePermissionCheck = 1;<br/>      }<br/>      if (_storagePermissionCheck == 1) {<br/>        storagePermissionCheckInt = 1;<br/>      } else {<br/>        storagePermissionCheckInt = 0;<br/>      }<br/><br/>      if (storagePermissionCheckInt == 1) {<br/>        finalPermission = 1;<br/>      } else {<br/>        finalPermission = 0;<br/>      }<br/><br/>      return finalPermission;<br/>    })();<br/>  }<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      debugShowCheckedModeBanner: false,<br/>      title: 'Savvy',<br/>      theme: ThemeData(<br/>        brightness: Brightness.light,<br/>        primaryColor: Colors.<em class="ms">teal</em>,<br/>      ),<br/>      home: DefaultTabController(<br/>        length: 2,<br/>        child: FutureBuilder(<br/>          future: _storagePermissionChecker,<br/>          builder: (context, status) {<br/>            if (status.connectionState == ConnectionState.done) {<br/>              if (status.hasData) {<br/>                if (status.data == 1) {<br/>                  return MyHome();<br/>                } else {<br/>                  return Scaffold(<br/>                    body: Container(<br/>                      decoration: BoxDecoration(<br/>                          gradient: LinearGradient(<br/>                        begin: Alignment.<em class="ms">bottomLeft</em>,<br/>                        end: Alignment.<em class="ms">topRight</em>,<br/>                        colors: [<br/>                          Colors.<em class="ms">lightBlue</em>[100],<br/>                          Colors.<em class="ms">lightBlue</em>[200],<br/>                          Colors.<em class="ms">lightBlue</em>[300],<br/>                          Colors.<em class="ms">lightBlue</em>[200],<br/>                          Colors.<em class="ms">lightBlue</em>[100],<br/>                        ],<br/>                      )),<br/>                      child: Center(<br/>                        child: Column(<br/>                          mainAxisAlignment: MainAxisAlignment.center,<br/>                          crossAxisAlignment: CrossAxisAlignment.center,<br/>                          children: [<br/>                            Padding(<br/>                              padding: const EdgeInsets.all(20.0),<br/>                              child: Text(<br/>                                "Storage Permission Required",<br/>                                style: TextStyle(fontSize: 20.0),<br/>                              ),<br/>                            ),<br/>                            FlatButton(<br/>                              padding: EdgeInsets.all(15.0),<br/>                              child: Text(<br/>                                "Allow Storage Permission",<br/>                                style: TextStyle(fontSize: 20.0),<br/>                              ),<br/>                              color: Colors.<em class="ms">indigo</em>,<br/>                              textColor: Colors.<em class="ms">white</em>,<br/>                              onPressed: () {<br/>                                setState(() {<br/>                                  _storagePermissionChecker =<br/>                                      requestStoragePermission();<br/>                                });<br/>                              },<br/>                            )<br/>                          ],<br/>                        ),<br/>                      ),<br/>                    ),<br/>                  );<br/>                }<br/>              } else {<br/>                return Scaffold(<br/>                  body: Container(<br/>                    decoration: BoxDecoration(<br/>                        gradient: LinearGradient(<br/>                      begin: Alignment.<em class="ms">bottomLeft</em>,<br/>                      end: Alignment.<em class="ms">topRight</em>,<br/>                      colors: [<br/>                        Colors.<em class="ms">lightBlue</em>[100],<br/>                        Colors.<em class="ms">lightBlue</em>[200],<br/>                        Colors.<em class="ms">lightBlue</em>[300],<br/>                        Colors.<em class="ms">lightBlue</em>[200],<br/>                        Colors.<em class="ms">lightBlue</em>[100],<br/>                      ],<br/>                    )),<br/>                    child: Center(<br/>                      child: Column(<br/>                        mainAxisAlignment: MainAxisAlignment.center,<br/>                        crossAxisAlignment: CrossAxisAlignment.center,<br/>                        children: [<br/>                          Padding(<br/>                            padding: const EdgeInsets.all(20.0),<br/>                            child: Text(<br/>                              "Something went wrong.. Please uninstall and Install Again.",<br/>                              style: TextStyle(fontSize: 20.0),<br/>                            ),<br/>                          ),<br/>                        ],<br/>                      ),<br/>                    ),<br/>                  ),<br/>                );<br/>              }<br/>            } else {<br/>              return Scaffold(<br/>                body: Container(<br/>                  child: Center(<br/>                    child: CircularProgressIndicator(),<br/>                  ),<br/>                ),<br/>              );<br/>            }<br/>          },<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}<br/><br/>class MyHome extends StatefulWidget {<br/>  @override<br/>  _MyHomeState createState() =&gt; _MyHomeState();<br/>}<br/><br/>class _MyHomeState extends State&lt;MyHome&gt; {<br/>  var html =<br/>      "&lt;h3&gt;&lt;b&gt;How To Use?&lt;/b&gt;&lt;/h3&gt;&lt;p&gt;- Check the Desired Status/Story...&lt;/p&gt;&lt;p&gt;- Come Back to App, Click on any Image or Video to View...&lt;/p&gt;&lt;p&gt;- Click the Save Button...&lt;br /&gt;The Image/Video is Instantly saved to your Galery :)&lt;/p&gt;&lt;p&gt;- You can also Use Multiple Saving. [to do]&lt;/p&gt;";<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      key: _scaffoldKey,<br/>      appBar: AppBar(<br/>        leading: IconButton(<br/>            icon: Icon(Icons.<em class="ms">menu</em>),<br/>            onPressed: () =&gt; _scaffoldKey.currentState.openDrawer()),<br/>        title: Text('Status Saver'),<br/>        backgroundColor: Colors.<em class="ms">teal</em>,<br/>        actions: &lt;Widget&gt;[<br/>          IconButton(<br/>              icon: Icon(Icons.<em class="ms">share</em>),<br/>              onPressed: () {<br/>                Share.<em class="ms">share</em>(<br/>                    'check out my wa status downloader https://github.com/mastersam07/wa_status_saver',<br/>                    subject: 'Look what I made!');<br/>              }),<br/>          IconButton(<br/>              icon: Icon(Icons.<em class="ms">help_outline</em>),<br/>              onPressed: () {<br/>                showDialog(<br/>                    context: context,<br/>                    builder: (BuildContext context) {<br/>                      return Dialog(<br/>                        child: Container(<br/>                          height: 400,<br/>                          child: Padding(<br/>                            padding: const EdgeInsets.all(12.0),<br/>                            child: Column(<br/>                              mainAxisAlignment: MainAxisAlignment.start,<br/>                              crossAxisAlignment: CrossAxisAlignment.start,<br/>                              children: [<br/>                                Html(data: html),<br/>                                Expanded(<br/>                                  child: new Align(<br/>                                    alignment: Alignment.<em class="ms">bottomRight</em>,<br/>                                    child: FlatButton(<br/>                                      child: Text(<br/>                                        'OK!',<br/>                                        style: TextStyle(color: Colors.<em class="ms">green</em>),<br/>                                      ),<br/>                                      onPressed: () {<br/>                                        Navigator.<em class="ms">of</em>(context).pop();<br/>                                      },<br/>                                    ),<br/>                                  ),<br/>                                ),<br/>                              ],<br/>                            ),<br/>                          ),<br/>                        ),<br/>                      );<br/>                    });<br/>              })<br/>        ],<br/>        bottom: TabBar(tabs: [<br/>          Container(<br/>            height: 30.0,<br/>            child: Text(<br/>              'IMAGES',<br/>            ),<br/>          ),<br/>          Container(<br/>            height: 30.0,<br/>            child: Text(<br/>              'VIDEOS',<br/>            ),<br/>          ),<br/>        ]),<br/>      ),<br/>      body: Dashboard(),<br/>      backgroundColor: Colors.<em class="ms">white</em>,<br/>      drawer: Drawer(<br/>        child: MyNavigationDrawer(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="be84" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">代码组织良好，易于阅读。很容易看到checkStoragePermission()用于检查存储权限，而requestStoragePermission()用于向用户请求存储权限。</p><p id="3709" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">逻辑很简单。我们检查许可是否被授予。如果许可没有被授予，那么我们请求它。当我们现在拥有存储权限时，我们只是运行MyHome()来触发一个带有一些appBar的Scaffold，Dashboard()是位于ui/dashboard.dart文件内的主体，以及一个位于ui/mydrawer.dart文件内的drawer MyNavigationDrawer()。</p><p id="d57d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们继续到仪表板，它是ui/dashboard.dart文件。这很简单，因为它在选项卡式视图中调用image screen(ui/image screen . dart文件)和video screen(ui/video screen . dart文件)。</p><pre class="kg kh ki kj gt mi mj mk ml aw mm bi"><span id="0faf" class="mn lr iq mj b gy mo mp l mq mr">import 'package:flutter/material.dart';<br/>import 'package:wa_status_saver/ui/imageScreen.dart';<br/>import 'package:wa_status_saver/ui/videoScreen.dart';<br/><br/>class Dashboard extends StatefulWidget {<br/>  @override<br/>  DashboardState createState() =&gt; new DashboardState();<br/>}<br/><br/>class DashboardState extends State&lt;Dashboard&gt; {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    // <em class="ms">TODO: implement build<br/>    </em>return Container(<br/>      child: TabBarView(<br/>        children: [<br/>          ImageScreen(),<br/>          VideoScreen(),<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="1ee4" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我将在这里停止这篇文章，因为它太长了，我不想让你厌烦，但正如我所承诺的，这里是Github回购的链接。<a class="ae mz" href="https://github.com/mastersam07/wa_status_saver" rel="noopener ugc nofollow" target="_blank">https://github.com/mastersam07/wa_status_saver</a></p><p id="d67d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我将在另一篇文章中继续这个应用，我们将从图像屏幕开始。敬请关注。</p></div></div>    
</body>
</html>