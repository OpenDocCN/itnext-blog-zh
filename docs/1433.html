<html>
<head>
<title>Tea-School.js — Generate a PDF File From HTML And CSS in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Tea-School.js —从Node.js中的HTML和CSS生成PDF文件</h1>
<blockquote>原文：<a href="https://itnext.io/tea-school-js-generate-a-pdf-file-from-html-and-css-in-node-js-32529f9b0f37?source=collection_archive---------1-----------------------#2018-10-13">https://itnext.io/tea-school-js-generate-a-pdf-file-from-html-and-css-in-node-js-32529f9b0f37?source=collection_archive---------1-----------------------#2018-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c4796ac069cebcc0c976cd3ebc1f481e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EymdZ2Yl0EOKe2r3"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@punttim?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·高夫</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上发表的“穿着白色上衣使用MacBook的男人”</figcaption></figure><p id="b2b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">哦，好家伙，这是一场多么艰难的斗争… <br/>如果你曾经试图用JavaScript创建一个PDF文件，你可能会发现自己偶尔会说脏话，晚上会不安地躺在床上。</p><h1 id="5acf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="d22e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><a class="ae kc" href="https://github.com/AmirTugi/tea-school" rel="noopener ugc nofollow" target="_blank"> Tea-School.js </a>是我用Node.js中的HTML+CSS创建一个动态PDF文件的包</p><h1 id="b2ee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">示例—复杂的发票PDF文件</h1><p id="2caa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们一起走过创建发票PDF文件的过程。</p><p id="2836" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先让我们描述一下我们的发票模型(使用TypeScript):</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/114865b26b65035cd367a9b862e7e6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*YArz-LmPlWdqYC7rGzCncg.png"/></div></figure><p id="e078" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常简单明了。</p><p id="a0e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们定义PDF文件生成器的标准:</p><ul class=""><li id="76fd" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated"><strong class="kf ir">动态。这不是用已知的、可靠的信息来创建静态的小册子。<br/>我们希望为每个发票ID生成不同的数据。</strong></li><li id="18d7" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf ir">国际化</strong> (I18N)。<br/>在非英语国家开展业务需要您以当地语言开具发票，包括RTL支持。</li><li id="1cb3" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf ir">简单。没有人想写复杂的代码，他们不理解他们所做的大部分事情，但是代码片段显示它应该可以工作。</strong></li><li id="7730" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated"><strong class="kf ir"> HTML + CSS。使用HTML和CSS创建一个模板比使用PDF特定方法(例如<code class="fe mx my mz na b">pdfFile.rectangle(0, 0, 100, 200)</code>)创建一个PDF文件要容易得多。</strong></li></ul><h1 id="3feb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">茶学网</h1><p id="a256" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有几个库满足了我们的一些标准，但是我还没有看到一个满足所有标准的——尤其是简单性。</p><p id="5b84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个问题上挣扎了几个星期，我终于找到了一个可能的解决办法:</p><p id="c8a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<a class="ae kc" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>和<a class="ae kc" href="https://pugjs.org/api/getting-started.html" rel="noopener ugc nofollow" target="_blank">木偶师</a>的组合。</p><p id="e14a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于那些不熟悉这两者的人来说，Puppeteer是一个无头的Chrome JS库，具有Chrome浏览器的所有功能——包括从网页(HTML)创建PDF👍)，而pug.js是一个用于创建HTML模板并用动态数据编译它们的库。</p><p id="a840" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我创建了一个库来抽象这两个文件创建PDF的大部分基本用法，还添加了<a class="ae kc" href="https://github.com/sass/node-sass" rel="noopener ugc nofollow" target="_blank"> node-sass </a>来使用<a class="ae kc" href="https://sass-lang.com/" rel="noopener ugc nofollow" target="_blank"> SASS </a>作为动态CSS内容。</p><p id="4b3e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果:<a class="ae kc" href="https://github.com/AmirTugi/tea-school" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">tea-school . js</strong></a></p><p id="1097" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">轶事:在我的母语(希伯来语)中，茶学校(tiscool)的意思是挫折。这是我在试图找到一个创建PDF文件的漂亮解决方案后的状态。</p><h2 id="6b97" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">使用</h2><p id="c5d1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让我们使用这个新的库来生成一个简单的发票:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/e014f2b37ff1ef13ec3af25495040bf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8e1UzVNHrXsAJGimZsllYg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">做得漂亮，容易</figcaption></figure><h2 id="b008" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">HTML模板</h2><p id="04b4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的模板文件<code class="fe mx my mz na b">invoice-pdf.template.pug</code>:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="e8f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你没有和哈巴狗相处的经验，不要担心。他们有一个很好的文档，所以你可以很容易地拿起你需要创建你的模板。</p><p id="ec6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意特殊的<code class="fe mx my mz na b">compiledStyle</code>键。这个键是为嵌入SASS样式而保留的，lib用我们提供的样式文件编译该样式</p><h2 id="6f5c" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">SASS样式文件</h2><p id="1e8b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mx my mz na b">invoice-pdf.scss</code></p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="4ec2" class="nb lc iq bd ld nc nd dn lh ne nf dp ll ko ng nh lp ks ni nj lt kw nk nl lx nm bi translated">生成PDF</h2><p id="6eed" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe mx my mz na b">index.ts</code></p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="2672" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您也可以在这里查看示例<a class="ae kc" href="https://github.com/AmirTugi/tea-school/tree/master/examples/invoice" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="be18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不是一个很短的片段，但它涵盖了我们需要的一切，并为我们提供了灵活性。</p><p id="6fb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好的一面是，这非常简单:</p><ul class=""><li id="33d7" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">你使用<a class="ae kc" href="https://github.com/sass/node-sass#options" rel="noopener ugc nofollow" target="_blank">节点-Sass选项</a>来定义你需要的样式</li><li id="f35c" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">您为Pug模板传递路径</li><li id="0744" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">你也可以传递额外的Pug数据插入到模板中</li><li id="28cf" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">你使用<a class="ae kc" href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/9aa321f04b1dd2eaf2d2bd757ae658680f660a49/types/puppeteer/index.d.ts#L524" rel="noopener ugc nofollow" target="_blank">木偶选项</a>来定义你需要的PDF文件</li></ul><p id="7c71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们丢失了<code class="fe mx my mz na b">Invoice</code>数据，但是您可以填充它，并运行脚本(首先编译它，或者使用<code class="fe mx my mz na b">ts-node</code>)。<br/>您会注意到现在在<code class="fe mx my mz na b">output</code>文件夹中有一个<code class="fe mx my mz na b">invoice.pdf</code>文件(该文件夹必须事先手动创建)</p><p id="65bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望我已经帮助了一些和我一样在这个问题上挣扎的人。</p><p id="ed44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">再来，这里是</strong><a class="ae kc" href="https://github.com/AmirTugi/tea-school" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">tea-school . js</strong></a><strong class="kf ir">包的链接。</strong></p><p id="5ade" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nq">如果你喜欢这个帖子，请在</em> <a class="ae kc" href="https://medium.com/@amir.tugi" rel="noopener"> <em class="nq">中</em> </a> <em class="nq">和</em> <a class="ae kc" href="https://twitter.com/AmirTugi" rel="noopener ugc nofollow" target="_blank"> <em class="nq">推特</em> </a>上关注我</p></div></div>    
</body>
</html>