<html>
<head>
<title>The ABC of Kubernetes access control</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes访问控制基础知识</h1>
<blockquote>原文：<a href="https://itnext.io/the-abc-of-kubernetes-access-control-e7d280af5c88?source=collection_archive---------0-----------------------#2018-10-21">https://itnext.io/the-abc-of-kubernetes-access-control-e7d280af5c88?source=collection_archive---------0-----------------------#2018-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1877e0408e8ae02e9e36d5976b5505f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-qRdwmveBlK_Q-NiO9Q8Q.png"/></div></div></figure><div class=""/><p id="e602" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ABC就像是在<strong class="ka jc">A</strong>l ways<strong class="ka jc">B</strong>e<strong class="ka jc">C</strong>控制——是的，我知道，我从1992年的电影《格伦加里·罗斯》(Glengarry Glen Ross)中的角色布莱克那里拿走了<a class="ae kw" href="https://www.youtube.com/watch?v=Yz246_Pjjkc" rel="noopener ugc nofollow" target="_blank"> ABC这个名字——我的意思是你不仅应该让</a><a class="ae kw" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" rel="noopener ugc nofollow" target="_blank"> RBAC启用</a>，显然，你还应该为你的应用程序创建并使用专用的<a class="ae kw" href="https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/" rel="noopener ugc nofollow" target="_blank">服务账户</a>。至少对于Kubernetes的本地应用来说是这样，但是如果你养成了这样的习惯，这并没有什么坏处:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="5ca0" class="lg lh jb lc b gy li lj l lk ll">$ kubectl create ns myapp<br/>$ kubectl -n myapp create sa thesa</span></pre><p id="0cc2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以现在你已经在名称空间<code class="fe lm ln lo lc b">myapp</code>中准备了一个专用的服务帐户<code class="fe lm ln lo lc b">thesa</code>,为了你自己，我希望你总是使用专用的名称空间，对吗？</p><p id="2072" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果您启动您的应用程序，<a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" rel="noopener ugc nofollow" target="_blank">使用专用服务帐户</a> <code class="fe lm ln lo lc b">thesa</code>，例如，像这样:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8504" class="lg lh jb lc b gy li lj l lk ll">$ kubectl -n myapp run theapp \<br/>          --image=quay.io/whatever/theapp:0.42 \<br/>          --serviceaccount=thesa</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="e722" class="lg lh jb bd lw lx ly dn lz ma mb dp mc kj md me mf kn mg mh mi kr mj mk ml mm bi translated">为什么？</h2><p id="e10e" class="pw-post-body-paragraph jy jz jb ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">因为现在你可以在任何时间点让应用程序访问你喜欢的任何资源，或者，也可以撤销访问。想要在命名空间中赋予应用程序超能力吗？只需这样做:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="7b2e" class="lg lh jb lc b gy li lj l lk ll">$ kubectl -n myapp create rolebinding givemyappssuperpower \<br/>          --clusterrole=cluster-admin \<br/>          --serviceaccount=myapp:thesa</span></pre><p id="acee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想让你的应用在整个集群中拥有超能力吗(说真的，不要)？把上面的<code class="fe lm ln lo lc b">create rolebinding</code>换成<code class="fe lm ln lo lc b">create clusterrolebinding</code>就行了。想要<a class="ae kw" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#user-facing-roles" rel="noopener ugc nofollow" target="_blank">限制您的应用程序对名称空间中的资源进行只读访问</a>？执行以下操作:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="431e" class="lg lh jb lc b gy li lj l lk ll">$ kubectl -n myapp delete rolebinding givemyappsuperpower</span><span id="b967" class="lg lh jb lc b gy ms lj l lk ll">$ kubectl -n myapp create rolebinding givemyappreadonlyaccess \<br/>          --clusterrole=view \<br/>          --serviceaccount=myapp:thesa</span></pre><p id="94c2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，以上所有操作只能以干净的方式进行，因为您已经提前创建了服务帐户<code class="fe lm ln lo lc b">thesa</code>，并使用该服务帐户启动了应用程序。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="cc21" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，有什么启示呢？不管你<em class="mt">是否需要</em>立即给予一个应用程序一定的权限，<em class="mt">总是</em>创建一个专用的服务帐户并使用它启动应用程序，最好是在一个专用的名称空间中。换句话说:在现实世界的设置中不要使用默认的名称空间和/或默认的服务帐户，但是<em class="mt">总是控制</em>；)</p></div></div>    
</body>
</html>