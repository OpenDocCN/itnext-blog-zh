<html>
<head>
<title>Neo4j: graph database — run with Docker and Cypher QL examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Neo4j:图形数据库—运行Docker和Cypher QL示例</h1>
<blockquote>原文：<a href="https://itnext.io/neo4j-graph-database-run-with-docker-and-cypher-ql-examples-6f81315f682?source=collection_archive---------3-----------------------#2020-07-28">https://itnext.io/neo4j-graph-database-run-with-docker-and-cypher-ql-examples-6f81315f682?source=collection_archive---------3-----------------------#2020-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/b755b5c96e58cee9ad1c1feb3e47cc8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*kTm9RDC7tHpfOldT.png"/></div></figure><p id="9640" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">与数据对象是主要部分的RDMS ( <em class="ks">关系数据库管理系统</em>)相比，在图形数据库中，这种数据对象之间的关系起着主要作用，并被表示为专用对象，这提供了更好的性能，尤其是当您有许多相互关联的小数据块时。</p><p id="cde6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最早的图形数据库系统之一是Neo4j，本文将对其进行研究。</p><p id="8712" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于查询，Neo4j使用Cypher查询语言和<code class="fe ku kv kw kx b">cypher-shell</code>工具，并通过内置UI的通用网络浏览器访问Neo4j数据库。还有，Neo4j支持REST API。</p><p id="b1ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Neo4j是通过付费模式发布的，但它有免费的社区版，但有一些限制(没有集群，没有在线备份，只有一个用户数据库，没有伸缩性等)，加上SaaS光环。参见他们的比较<a class="ae kt" href="https://neo4j.com/subscriptions/" rel="noopener ugc nofollow" target="_blank"> тут &gt; &gt; &gt; </a>。</p><p id="deff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，在本文中，我们将使用Docker启动Neo4j Community Edition实例，简要概述其查询语言，以及如何执行备份-恢复。</p><h1 id="c0d3" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用Docker运行Neo4j</h1><p id="9326" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">让我们在一台工作的笔记本电脑上运行一个带有Docker的容器，看看它是如何工作的。参见文档<a class="ae kt" href="https://neo4j.com/developer/docker-run-neo4j/" rel="noopener ugc nofollow" target="_blank">此处&gt; &gt; &gt; </a>。</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="ba8c" class="mj kz iq kx b gy mk ml l mm mn">$ docker run --rm --name neo4j -p 7474:7474 -p 7687:7687 neo4j:latest<br/>…<br/>Directories in use:<br/>home: /var/lib/neo4j<br/>config: /var/lib/neo4j/conf<br/>logs: /logs<br/>plugins: /var/lib/neo4j/plugins<br/>import: /var/lib/neo4j/import<br/>data: /var/lib/neo4j/data<br/>certificates: /var/lib/neo4j/certificates<br/>run: /var/lib/neo4j/run<br/>Starting Neo4j.<br/>…<br/>2020–07–27 10:11:30.394+0000 INFO Bolt enabled on 0.0.0.0:7687.<br/>2020–07–27 10:11:31.640+0000 INFO Remote interface available at <a class="ae kt" href="http://localhost:7474/" rel="noopener ugc nofollow" target="_blank">http://localhost:7474/</a><br/>2020–07–27 10:11:31.640+0000 INFO Started</span></pre><p id="3b35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查它—打开浏览器，导航到<a class="ae kt" href="http://localhost:7474," rel="noopener ugc nofollow" target="_blank"><em class="ks">http://localhost:7474</em>，</a>并使用默认登录密码<em class="ks"> neo4j:neo4j </em>登录:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/5f962ad39c8c1c9ba0501d312dc6729c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gi1bf8osFqQXtXjz.png"/></div></div></figure><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mt"><img src="../Images/6f634aaf38032cc657f446d892e9b6f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XvJSL6lm3tK_McQW.png"/></div></div></figure><h2 id="5d66" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">管理员密码</h2><p id="2e72" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">要设置新密码，请使用<code class="fe ku kv kw kx b">--env NEO4J_AUTH</code>:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="fca7" class="mj kz iq kx b gy mk ml l mm mn">$ docker run --rm --name neo4j --env NEO4J_AUTH=neo4j/pass -p 7474:7474 -p 7687:7687 neo4j:latest<br/>Changed password for user ‘neo4j’.<br/>…</span></pre><h2 id="e981" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated"><code class="fe ku kv kw kx b">cypher-shell</code></h2><p id="ddad" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">要使用数据库，您可以使用REST API或本地工具— <code class="fe ku kv kw kx b"><a class="ae kt" href="https://neo4j.com/docs/operations-manual/current/tools/cypher-shell/" rel="noopener ugc nofollow" target="_blank">cypher-shell</a></code>。</p><p id="5387" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">连接到容器并破坏外壳:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="4da9" class="mj kz iq kx b gy mk ml l mm mn">$ docker exec -ti neo4j cypher-shell -u neo4j -p pass<br/>Connected to Neo4j 4.1.0 at neo4j://localhost:7687 as user neo4j.<br/>Type :help for a list of available commands or :exit to exit the shell.<br/>Note that Cypher queries must end with a semicolon.<br/>neo4j@neo4j&gt;</span></pre><h2 id="2a20" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">Neo4j配置文件</h2><p id="1892" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">在容器中，主配置文件位于<code class="fe ku kv kw kx b">$NEO4J_HOME/conf/neo4j.conf</code>路径，例如<code class="fe ku kv kw kx b">/var/lib/neo4j/conf/neo4j.conf</code>:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="94c4" class="mj kz iq kx b gy mk ml l mm mn">root@65d8061ac13e:/var/lib/neo4j# head /var/lib/neo4j/conf/neo4j.conf<br/>*****************************************************************<br/>Neo4j configuration<br/>For more details and a complete list of settings, please see<br/>*****************************************************************<br/>The name of the default database<br/>dbms.default_database=neo4j</span></pre><p id="5343" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要重新定义任何设置—将新的配置文件挂载到容器的<code class="fe ku kv kw kx b">/conf</code>目录中。</p><p id="260c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在&gt; &gt; &gt; 这里可以找到<code class="fe ku kv kw kx b">neo4j.conf</code>的所有设置。</p><p id="5e50" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要从shell获取当前配置，请使用<code class="fe ku kv kw kx b"><a class="ae kt" href="https://neo4j.com/docs/operations-manual/current/reference/procedures/" rel="noopener ugc nofollow" target="_blank">dbms.listConfig()</a></code>调用:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="d5be" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; CALL dbms.listConfig()<br/>YIELD name, value<br/>WHERE name STARTS WITH ‘dbms.default’<br/>RETURN name, value<br/>ORDER BY name<br/>LIMIT 3;</span><span id="6434" class="mj kz iq kx b gy nf ml l mm mn">+ — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| name | value |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| “dbms.default_advertised_address” | “localhost” |<br/>| “dbms.default_database” | “neo4j” |<br/>| “dbms.default_listen_address” | “0.0.0.0” |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>3 rows available after 216 ms, consumed after another 13 ms</span></pre><h1 id="f3c1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><code class="fe ku kv kw kx b">cypher-shell</code> &amp; &amp; CQL</h1><h2 id="713d" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated"><code class="fe ku kv kw kx b">CREATE</code></h2><p id="9040" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">我们来玩玩数据。</p><p id="5e10" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Tutorialspoint <a class="ae kt" href="https://www.tutorialspoint.com/neo4j/neo4j_cql_introduction.htm" rel="noopener ugc nofollow" target="_blank">这里有一个很棒的数据类型教程&gt; &gt; &gt; </a>。</p><p id="1981" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建新节点:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="1c1f" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; create (test);<br/>0 rows available after 56 ms, consumed after another 0 ms<br/>Added 1 nodes</span></pre><h2 id="82e0" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated"><code class="fe ku kv kw kx b">DELETE</code></h2><p id="7159" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">删除它:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="2121" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; MATCH (test) DETACH DELETE test;<br/>0 rows available after 32 ms, consumed after another 0 ms<br/>Deleted 1 nodes</span></pre><p id="049f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要删除数据库中的所有记录，请使用<code class="fe ku kv kw kx b">(n)</code>:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="7142" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; MATCH (n) detach delete n;</span></pre><h2 id="e5df" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">标签</h2><p id="893d" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">创建一个标签为<em class="ks"> label1 </em> label的节点，其属性包含两个键— <em class="ks"> key1 </em>和<em class="ks"> key2 </em>:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="5992" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; create (node1:label1 {key1: “value1”, key2: “value2”} );<br/>0 rows available after 47 ms, consumed after another 0 ms<br/>Added 1 nodes, Set 2 properties, Added 1 labels</span></pre><p id="6916" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查一下:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="bba8" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; MATCH (node1) RETURN node1;<br/>+ — — — — — — — — — — — — — — — — — — — — — — +<br/>| node1 |<br/>+ — — — — — — — — — — — — — — — — — — — — — — +<br/>| (:label1 {key1: “value1”, key2: “value2”}) |<br/>+ — — — — — — — — — — — — — — — — — — — — — — +</span></pre><p id="3580" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者使用<code class="fe ku kv kw kx b">RETURN</code> -在创建后立即获取节点，在同一个查询中:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="362f" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; CREATE (node2:label2 {key1: “value1”, key2: “value2”} ) RETURN node2;<br/>+ — — — — — — — — — — — — — — — — — — — — — — +<br/>| node2 |<br/>+ — — — — — — — — — — — — — — — — — — — — — — +<br/>| (:label2 {key1: “value1”, key2: “value2”}) |<br/>+ — — — — — — — — — — — — — — — — — — — — — — +</span></pre><p id="fcdc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<code class="fe ku kv kw kx b">match(n) return n</code>在浏览器中检查以显示所有记录:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ng"><img src="../Images/e398f875882593ea6ecd5b43e1e10cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z9aHz4pZ5rCKGuaC.png"/></div></div></figure><h2 id="de46" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">关系</h2><p id="20dd" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">可以在任何新节点之间或现有节点之间创建新的关系。</p><p id="0d6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要在新节点之间创建关系—添加<code class="fe ku kv kw kx b">-[r:RelationName]-&gt;</code>:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="88b1" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; create (node3:label3 {key1: “value1”, key2: “value2”}) -[r:RelationName]-&gt; (node4:label4{key1: “value1”, key2: “value2”}) RETURN node3, node4;<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| node3 | node4 |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| (:label3 {key1: “value1”, key2: “value2”}) | (:label4 {key1: “value1”, key2: “value2”}) |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>1 row available after 88 ms, consumed after another 8 ms<br/>Added 2 nodes, Created 1 relationships, Set 4 properties, Added 2 labels</span></pre><p id="cd7d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查一下:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi nh"><img src="../Images/96d35b3dac9bafdd8e46713d53d0a776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SkdyzwJZvTHN3VGO.png"/></div></div></figure><p id="10cc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要在现有节点之间创建关系，使用<code class="fe ku kv kw kx b">MATCH</code>选择这些节点:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="9c03" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; MATCH (node3:label3), (node4:label4) CREATE (node3) -[r:RelationName2]-&gt; (node4) RETURN node3, node4;<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| node3 | node4 |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>| (:label3 {key1: “value1”, key2: “value2”}) | (:label4 {key1: “value1”, key2: “value2”}) |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — -+<br/>1 row available after 124 ms, consumed after another 9 ms<br/>Created 1 relationships</span></pre><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi ni"><img src="../Images/f374029ecd6d478cd63847c65e2951d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M29HdBVYyRS_aexz.png"/></div></div></figure><h1 id="4989" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">备份和恢复</h1><p id="81d4" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">数据存储在<code class="fe ku kv kw kx b">$NEO4J_HOME/data</code>中，它实际上是<code class="fe ku kv kw kx b">/data</code>的符号链接，参见此处的<a class="ae kt" href="https://neo4j.com/docs/operations-manual/current/configuration/file-locations/." rel="noopener ugc nofollow" target="_blank">&gt;&gt;&gt;</a>。</p><p id="12d0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查目录:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="36b3" class="mj kz iq kx b gy mk ml l mm mn">root@65d8061ac13e:/var/lib/neo4j# ls -l /var/lib/neo4j/data<br/>lrwxrwxrwx 1 root root 5 Jul 23 09:01 /var/lib/neo4j/data -&gt; /data<br/>root@65d8061ac13e:/var/lib/neo4j# ls -l /data/<br/>total 12<br/>drwxrwxrwx 4 neo4j neo4j 4096 Jul 27 11:19 databases<br/>drwxr-xr-x 2 neo4j neo4j 4096 Jul 27 11:19 dbms<br/>drwxrwxrwx 4 neo4j neo4j 4096 Jul 27 11:19 transactions</span></pre><p id="2906" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">数据库文件存储在<code class="fe ku kv kw kx b">databases</code>目录中，在这里可以找到两个默认的数据库——系统和neo4j ，可以通过<code class="fe ku kv kw kx b">show databases</code>找到:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="3cb5" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; show databases;<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — +<br/>| name | address | role | requestedStatus | currentStatus | error | default |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — +<br/>| “neo4j” | “localhost:7687” | “standalone” | “online” | “online” | “” | TRUE |<br/>| “system” | “localhost:7687” | “standalone” | “online” | “online” | “” | FALSE |<br/>+ — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — +</span></pre><p id="5175" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">系统</em>数据库用于……嗯，用于系统本身，而<em class="ks"> nedo4j </em>是默认的用户数据库。</p><h2 id="6820" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">Neo4j <code class="fe ku kv kw kx b">dump</code></h2><p id="d890" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">创建新目录来保存我们的数据:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="a22a" class="mj kz iq kx b gy mk ml l mm mn">$ mkdir -p /tmp/neo4/{data,logs}</span></pre><p id="8a88" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重新启动Neo4j容器，将这些目录挂载到其中:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="006b" class="mj kz iq kx b gy mk ml l mm mn">$ docker run --rm --name neo4j --env NEO4J_AUTH=neo4j/pass -p 7474:7474 -p 7687:7687 -v /tmp/neo4/data/:/data -v /tmp/neo4/logs/:/logs neo4j:latest<br/>Changed password for user ‘neo4j’.<br/>Directories in use:<br/>home: /var/lib/neo4j<br/>config: /var/lib/neo4j/conf<br/>logs: /logs<br/>plugins: /var/lib/neo4j/plugins<br/>import: /var/lib/neo4j/import<br/>data: /var/lib/neo4j/data<br/>certificates: /var/lib/neo4j/certificates<br/>run: /var/lib/neo4j/run<br/>…</span></pre><p id="190f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查主机上的数据:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="6cd6" class="mj kz iq kx b gy mk ml l mm mn">$ ll /tmp/neo4/data/databases/<br/>total 0<br/>drwxr-xr-x 2 7474 7474 720 Jul 27 16:07 neo4j<br/>-rw-r — r — 1 7474 7474 0 Jul 27 16:07 store_lock<br/>drwxr-xr-x 3 7474 7474 740 Jul 27 16:07 system</span></pre><p id="b67f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">连接，创建新记录:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="2624" class="mj kz iq kx b gy mk ml l mm mn">$ docker exec -ti neo4j cypher-shell -u neo4j -p pass<br/>neo4j@neo4j&gt; create (test:tobackup);<br/>0 rows available after 131 ms, consumed after another 0 ms<br/>Added 1 nodes</span></pre><p id="15fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要创建数据库转储，您首先需要停止实例(因为社区版不具备<em class="ks">在线备份</em>的能力):</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="41ce" class="mj kz iq kx b gy mk ml l mm mn">root@771f04312148:/var/lib/neo4j# neo4j-admin dump --database=neo4j --to=/data/backups/<br/>The database is in use. Stop database ‘neo4j’ and try again.</span></pre><p id="00ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所以，退出容器并停止它:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="17e7" class="mj kz iq kx b gy mk ml l mm mn">$ docker stop neo4j</span></pre><p id="8e05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重新启动，但此时添加<code class="fe ku kv kw kx b">bash</code>命令以阻止Neo4j服务启动:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="e77a" class="mj kz iq kx b gy mk ml l mm mn">$ docker run -ti --rm --name neo4j --env NEO4J_AUTH=neo4j/pass -p 7474:7474 -p 7687:7687 -v /tmp/neo4/data/:/data -v /tmp/neo4/logs/:/logs neo4j:latest bash<br/>neo4j@6d4e9854bc1d:~$</span></pre><p id="d236" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建转储:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="7fe1" class="mj kz iq kx b gy mk ml l mm mn">neo4j@015ba14bdba2:~$ mkdir /data/backup<br/>neo4j@015ba14bdba2:~$ neo4j-admin dump --database=neo4j --to=/data/backup/<br/>Done: 34 files, 250.8MiB processed.</span></pre><p id="68b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查一下:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="9fea" class="mj kz iq kx b gy mk ml l mm mn">neo4j@015ba14bdba2:~$ ls -l /data/backup/<br/>total 12<br/>-rw-r — r — 1 neo4j neo4j 9971 Jul 27 13:46 neo4j.dump</span></pre><h2 id="048f" class="mj kz iq bd la mu mv dn le mw mx dp li kf my mz lm kj na nb lq kn nc nd lu ne bi translated">恢复</h2><p id="a11d" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">在主机上，为第二个Neo4j实例创建一组新目录:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="e75d" class="mj kz iq kx b gy mk ml l mm mn">$ mkdir -p /tmp/neo4–2/{data,logs}</span></pre><p id="e8dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从第一个目录复制备份目录:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="0afe" class="mj kz iq kx b gy mk ml l mm mn">$ sudo cp -r /tmp/neo4/data/backup/ /tmp/neo4–2/data/</span></pre><p id="b5e6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">照常运行服务，挂载<code class="fe ku kv kw kx b">/tmp/neo4-2</code>，替换端口及其名称:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="0cbf" class="mj kz iq kx b gy mk ml l mm mn">$ docker run — rm — name neo4j-2 — env NEO4J_AUTH=neo4j/pass -p 7475:7474 -p 7688:7687 -v /tmp/neo4–2/data/:/data -v /tmp/neo4–2/logs/:/logs neo4j:latest</span></pre><p id="6f15" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">连接并检查数据:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="5a41" class="mj kz iq kx b gy mk ml l mm mn">$ docker exec -ti neo4j-2 cypher-shell -u neo4j -p pass<br/>Connected to Neo4j 4.1.0 at neo4j://localhost:7687 as user neo4j.<br/>Type :help for a list of available commands or :exit to exit the shell.<br/>Note that Cypher queries must end with a semicolon.<br/>neo4j@neo4j&gt; match (n) return n;<br/>+ — -+<br/>| n |<br/>+ — -+<br/>+ — -+</span></pre><p id="92ea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好的—这里什么也没有找到，因为这是一个全新的数据库。</p><p id="f349" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从容器中退出，停止并通过<code class="fe ku kv kw kx b">bash</code>运行:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="b898" class="mj kz iq kx b gy mk ml l mm mn">$ docker run -ti --rm --name neo4j-2 --env NEO4J_AUTH=neo4j/pass -p 7475:7474 -p 7688:7687 -v /tmp/neo4–2/data/:/data -v /tmp/neo4–2/logs/:/logs neo4j:latest bash</span><span id="9e22" class="mj kz iq kx b gy nf ml l mm mn">neo4j@b0f324cb7c9b:~$</span></pre><p id="3af2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用默认的<code class="fe ku kv kw kx b">--force</code>键将转储加载到数据库中<em class="ks"> neo4j </em>数据库已经存在:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="0368" class="mj kz iq kx b gy mk ml l mm mn">neo4j@7bca892e9538:~$ neo4j-admin load --from=/data/backup/neo4j.dump --database=neo4j --force<br/>Done: 34 files, 250.8MiB processed.</span></pre><p id="5a03" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">退出，以正常方式重新启动容器以启动Neo4j进程:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="94b2" class="mj kz iq kx b gy mk ml l mm mn">$ docker run -ti --rm --name neo4j-2 --env NEO4J_AUTH=neo4j/pass -p 7475:7474 -p 7688:7687 -v /tmp/neo4–2/data/:/data -v /tmp/neo4–2/logs/:/logs neo4j:latest</span></pre><p id="3ed9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">连接，检查:</p><pre class="mb mc md me gt mf kx mg mh aw mi bi"><span id="e3e0" class="mj kz iq kx b gy mk ml l mm mn">neo4j@neo4j&gt; match (n) return n;<br/>+ — — — — — — -+<br/>| n |<br/>+ — — — — — — -+<br/>| (:tobackup) |<br/>+ — — — — — — -+</span></pre><p id="ff01" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们的记录就在它的位置上——都完成了。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="bc1d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">最初发布于</em> <a class="ae kt" href="https://rtfm.co.ua/en/neo4j-graph-database-run-with-docker-and-cypher-ql-examples/" rel="noopener ugc nofollow" target="_blank"> <em class="ks"> RTFM: Linux，devo PSисистемноеадминитииовваниованиее</em>T10<em class="ks">。</em></a></p></div></div>    
</body>
</html>