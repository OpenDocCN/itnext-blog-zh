<html>
<head>
<title>Inotify Minikube (Run watch feature in Minikube)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">inotify mini kube(mini kube中的跑步观察功能)</h1>
<blockquote>原文：<a href="https://itnext.io/inotify-minikube-watch-feature-in-minikube-aef6edeb6f08?source=collection_archive---------8-----------------------#2020-01-06">https://itnext.io/inotify-minikube-watch-feature-in-minikube-aef6edeb6f08?source=collection_archive---------8-----------------------#2020-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="19dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你正在为你的开发环境运行Minikube，并且发现你因为你的自动重载构建系统(Webpack <a class="ae kl" href="https://webpack.js.org/configuration/watch/" rel="noopener ugc nofollow" target="_blank"> watch </a>，<a class="ae kl" href="https://pypi.org/project/watchdog/" rel="noopener ugc nofollow" target="_blank"> watchdog </a>)不工作而感到烦恼，这篇文章是为你准备的。</p><p id="c490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/kubernetes/minikube" rel="noopener ugc nofollow" target="_blank"> Minikube </a>允许你在本地运行Kubernetes。我没有说服您使用它，但是如果您在您的生产环境中使用Kubernetes集群，那么使用它是有意义的，因为它为您带来了许多优势。</p><blockquote class="km kn ko"><p id="abda" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">如果您在生产环境中使用Kubernetes集群，我推荐使用Minikube。</p></blockquote><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/fee585ecf42bab501770351ecadd7dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWI1qBdCeSHJdNRj-8Pf3g.jpeg"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@moritz_photography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">莫里茨·金德勒</a>在<a class="ae kl" href="https://unsplash.com/s/photos/mini-shipping-container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0120" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到自动重载构建系统的问题，这是因为共享文件夹之间不支持<a class="ae kl" href="http://man7.org/linux/man-pages/man7/inotify.7.html" rel="noopener ugc nofollow" target="_blank"> inotify </a>事件，因为虚拟机具有不同的文件系统(这是VirtualBox中的一个已知问题，在这里它甚至被标记为wont fix<a class="ae kl" href="https://www.virtualbox.org/ticket/10660" rel="noopener ugc nofollow" target="_blank"/>)。</p><p id="0ab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像<code class="fe lj lk ll lm b">CHOKIDAR_USEPOLLING=true</code>这样的另一种解决方案不是一个选项，因为根据我们的经验，随着时间的推移，它会消耗大量的RAM和CPU，导致我们不得不重新启动我们的虚拟机，从而影响生产力。</p><p id="6286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们相信这些手表功能和Minikube应该让我们更有效率，但它们并没有无缝地工作。但是我们有解决办法！</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="10c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Notify-forwarder </strong>是一个可以将文件系统事件转发到另一台有共享文件夹的机器上的工具。</p><div class="lu lv gp gr lw lx"><a href="https://github.com/mhallin/notify-forwarder" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">mhall in/通知-转发器</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">一个简单的工具，用于将文件系统通知从一个主机转发到另一个主机，可能会在…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ld lx"/></div></div></a></div><p id="4488" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它有两个运行选项:<em class="kp">观看</em>和<em class="kp">接收。</em></p><pre class="ku kv kw kx gt mm lm mn mo aw mp bi"><span id="8596" class="mq mr iq lm b gy ms mt l mu mv"># Run in host<br/>$ notify-forwarder watch -c &lt;remote-ip&gt; &lt;host-path&gt; &lt;to-path&gt;</span><span id="9b3c" class="mq mr iq lm b gy mw mt l mu mv"># Run in VM<br/>$ notify-forwarder receive</span></pre><p id="361f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp">监视</em>选项监视&lt;主机路径&gt;中的文件系统事件，并通过端口29324中的UDP协议将它们发送到&lt;远程ip &gt;。&lt; to-path &gt;是虚拟机中的远程路径或共享路径。</p><p id="359c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp">接收</em>选项然后在运行自动重载构建系统的VM中重放事件。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="043a" class="mq mr iq bd mx my mz dn na nb nc dp nd jy ne nf ng kc nh ni nj kg nk nl nm nn bi translated">在Minikube中运行通知-转发器</h2><p id="e021" class="pw-post-body-paragraph jn jo iq jp b jq no js jt ju np jw jx jy nq ka kb kc nr ke kf kg ns ki kj kk ij bi translated">想法是在Minikube内部运行一个容器，运行<strong class="jp ir">通知-转发器接收</strong>。其他容器应该神奇地获得这些文件更改，因为它们现在实际上是从VM中的同一个文件系统挂载的。</p><p id="aa7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要运行<strong class="jp ir"> notify-forwarder receive </strong>，请应用此清单文件</p><p id="c942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但首先，这是我的设置:</p><ul class=""><li id="2892" class="nt nu iq jp b jq jr ju jv jy nv kc nw kg nx kk ny nz oa ob bi translated">马科斯·莫哈维</li><li id="bbe6" class="nt nu iq jp b jq oc ju od jy oe kc of kg og kk ny nz oa ob bi translated">minikube 1 . 5 . 2版</li><li id="6715" class="nt nu iq jp b jq oc ju od jy oe kc of kg og kk ny nz oa ob bi translated">VirtualBox v5.2.32(旧的我知道:P)</li><li id="57cd" class="nt nu iq jp b jq oc ju od jy oe kc of kg og kk ny nz oa ob bi translated">项目目录路径:/Users/esh/workspace</li></ul><blockquote class="km kn ko"><p id="1bb2" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">注意:如果你已经使用Minikube和VirtualBox有一段时间了，你会知道它会把你的整个主目录挂载到VM中的同一个路径，所以如果你使用的是MacOS，你会把整个/Users挂载到里面。更少的路径需要担心。</p></blockquote><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="oh oi l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">notify-forwarder.yaml</figcaption></figure><p id="4668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行<strong class="jp ir">ku bectl apply-f notify-forwarder . YAML</strong></p><p id="da69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将创建一个Kubernetes服务和一个部署资源，后者创建一个监听端口29324的通知-转发器应用程序。然后，该服务会将其公开给主机。另一个重要的方面是容器中的挂载目录，所以要确保它设置正确。</p><p id="f80e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要检查它是否成功运行，</p><pre class="ku kv kw kx gt mm lm mn mo aw mp bi"><span id="8452" class="mq mr iq lm b gy ms mt l mu mv">$ kubectl get pod | grep notify-forwarder<br/>notify-forwarder-fd66445c8-2gkmf    1/1     Running   1          1m</span><span id="ac55" class="mq mr iq lm b gy mw mt l mu mv">$ kubectl get svc | grep notify-forwarder<br/>notify-forwarder   LoadBalancer   10.107.35.88     10.107.35.88   29324:30732/UDP                1m</span></pre><p id="d4ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记下minikube ip和服务外部端口</p><pre class="ku kv kw kx gt mm lm mn mo aw mp bi"><span id="35aa" class="mq mr iq lm b gy ms mt l mu mv">$ export NOTIFY_LISTENER=$(minikube ip):$(kubectl get svc notify-forwarder --no-headers | awk '{print $5}' | cut -d / -f 1 | cut -d : -f 2)</span><span id="18a0" class="mq mr iq lm b gy mw mt l mu mv">echo $NOTIFY_LISTENER<br/>192.168.99.100:30732</span></pre><p id="cae6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在从主机运行<strong class="jp ir">手表</strong>选项。</p><p id="af78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载适用于您的操作系统的预构建二进制版本</p><ul class=""><li id="0973" class="nt nu iq jp b jq jr ju jv jy nv kc nw kg nx kk ny nz oa ob bi translated">Mac OS X 10.10或更新版本，64位:<a class="ae kl" href="https://github.com/mhallin/notify-forwarder/releases/download/release%2Fv0.1.0/notify-forwarder_osx_x64" rel="noopener ugc nofollow" target="_blank">通知-转发器_osx_x64 </a></li><li id="499a" class="nt nu iq jp b jq oc ju od jy oe kc of kg og kk ny nz oa ob bi translated">Linux 64位:<a class="ae kl" href="https://github.com/mhallin/notify-forwarder/releases/download/release%2Fv0.1.0/notify-forwarder_linux_x64" rel="noopener ugc nofollow" target="_blank">通知-转发器_linux_x64 </a></li><li id="f502" class="nt nu iq jp b jq oc ju od jy oe kc of kg og kk ny nz oa ob bi translated">FreeBSD 64位:<a class="ae kl" href="https://github.com/mhallin/notify-forwarder/releases/download/release%2Fv0.1.0/notify-forwarder_freebsd_x64" rel="noopener ugc nofollow" target="_blank">通知-转发器_freebsd_x64 </a></li></ul><pre class="ku kv kw kx gt mm lm mn mo aw mp bi"><span id="2eea" class="mq mr iq lm b gy ms mt l mu mv">$ ./notify-forwarder_osx_x64 watch -c $NOTIFY_LISTENER /Users/esh/workspace /srv</span></pre><p id="c424" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我们告诉notify-forwarder从<code class="fe lj lk ll lm b">Host:/Users/esh/workspace</code>到<code class="fe lj lk ll lm b">$NOTIFY_LISTENER:/srv</code>发送文件系统更改事件。</p><p id="0a17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在为什么是<code class="fe lj lk ll lm b">/srv</code>？因为那是容器的挂载路径，在那里<strong class="jp ir">接收</strong>选项正在监听。运行构建系统的其他容器现在也应该能够接收文件更改了。</p><p id="9f66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过这种方法，可以使用Ansible或Chef =)轻松实现自动化</p><p id="a30f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是<strong class="jp ir">通知-运输</strong>的文档，供您参考</p><pre class="ku kv kw kx gt mm lm mn mo aw mp bi"><span id="c5ad" class="mq mr iq lm b gy ms mt l mu mv">FROM bitnami/minideb:jessie as build</span><span id="8a76" class="mq mr iq lm b gy mw mt l mu mv">RUN apt update &amp;&amp; apt install -y curl<br/>RUN curl -OL <a class="ae kl" href="https://github.com/mhallin/notify-forwarder/releases/download/release%2Fv0.1.0/notify-forwarder_linux_x64" rel="noopener ugc nofollow" target="_blank">https://github.com/mhallin/notify-forwarder/releases/download/release%2Fv0.1.0/notify-forwarder_linux_x64</a><br/>RUN mv ./notify-forwarder_linux_x64 ./notify-forwarder<br/>RUN chmod u+x ./notify-forwarder</span><span id="117e" class="mq mr iq lm b gy mw mt l mu mv">FROM bitnami/minideb:jessie as final<br/>COPY --from=build /notify-forwarder /usr/bin/notify-forwarder<br/>ENTRYPOINT ["notify-forwarder"]</span></pre></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="bfb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！我希望这有所帮助，如果你对这个问题有不同的看法，请告诉我。</p><p id="c320" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一如既往，我欢迎反馈和建议=)</p><p id="8c00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考资料:</p><div class="lu lv gp gr lw lx"><a href="https://github.com/mhallin/notify-forwarder" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">mhall in/通知-转发器</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">一个简单的工具，用于将文件系统通知从一个主机转发到另一个主机，可能会在…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="oj l mi mj mk mg ml ld lx"/></div></div></a></div><div class="lu lv gp gr lw lx"><a href="https://www.datadoghq.com/container-report/" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">关于真实世界容器使用的8个事实</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">编排正在成为使用容器的组织的标准实践。这一点在……最为明显</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">www.datadoghq.com</p></div></div><div class="mg l"><div class="ok l mi mj mk mg ml ld lx"/></div></div></a></div><div class="lu lv gp gr lw lx"><a href="https://minikube.sigs.k8s.io/" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">迷你库贝</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">只需一个命令，就能轻松再现您的生产环境。始终支持…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">minikube.sigs.k8s.io</p></div></div><div class="mg l"><div class="ol l mi mj mk mg ml ld lx"/></div></div></a></div><div class="lu lv gp gr lw lx"><a href="https://www.virtualbox.org/ticket/10660" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">#10660(共享文件夹中的文件更新不会触发Ubuntu上的inotify)-Oracle VM VirtualBox</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">大家好！我使用的是virtualbox 4.1.16和最新的来宾操作系统。我的主机是Windows 7，客户是Ubuntu 11.10，我有…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">www.virtualbox.org</p></div></div><div class="mg l"><div class="om l mi mj mk mg ml ld lx"/></div></div></a></div></div></div>    
</body>
</html>