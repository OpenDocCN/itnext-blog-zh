<html>
<head>
<title>CKS Exam Series #4 Crash that Apiserver !</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CKS考试系列#4使Apiserver崩溃！</h1>
<blockquote>原文：<a href="https://itnext.io/cks-exam-series-4-crash-that-apiserver-5f4d3d503028?source=collection_archive---------2-----------------------#2021-01-03">https://itnext.io/cks-exam-series-4-crash-that-apiserver-5f4d3d503028?source=collection_archive---------2-----------------------#2021-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="39b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Kubernetes CKS示例考试问题系列</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/05fd8540f5c4485b89dae3aa08122857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXSxzFcP6sn3_QUs5HMIpA.png"/></div></div></figure><blockquote class="kr ks kt"><p id="dc68" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://killer.sh/r?d=cks-series" rel="noopener ugc nofollow" target="_blank"> CKS考试系列</a> | <a class="ae lr" href="https://killer.sh/r?d=cka-series" rel="noopener ugc nofollow" target="_blank"> CKA考试系列</a> | <a class="ae lr" href="https://killer.sh/r?d=ckad-series" rel="noopener ugc nofollow" target="_blank"> CKAD考试系列</a></p></blockquote><p id="499b" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">## # # # # # # # # # # # # # # # # # # # ##</strong></p><p id="70de" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">此挑战不会在此更新，将移至:</strong></p><p id="32df" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><a class="ae lr" href="https://killercoda.com/killer-shell-cks" rel="noopener ugc nofollow" target="_blank">https://killercoda.com/killer-shell-cks</a></p><p id="c87f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">## # # # # # # # # # # # # # # # # # # # # # # ##</strong></p><h1 id="a2ce" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">内容</h1><ol class=""><li id="854c" class="mn mo iq kx b ky mp lb mq ls mr lt ms lu mt lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-1-create-cluster-security-best-practices-50e35aaa67ae?source=friends_link&amp;sk=8bc466dae0ea90412251e32d4eaf7539" rel="noopener">创建集群&amp;安全最佳实践</a></li><li id="1be6" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-2-pods-and-secrets-3d92a6fba331?source=friends_link&amp;sk=379fa6e196233c73ef7845d84a3aa34d" rel="noopener">pod、机密和服务帐户</a></li><li id="8f2a" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-3-immutable-pods-3812cf76cff4?source=friends_link&amp;sk=ed1231a0382d97bd5c8267afe75f14ac" rel="noopener">不可变豆荚</a></li><li id="ff89" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-4-crash-that-apiserver-5f4d3d503028?source=friends_link&amp;sk=3ccd9bf1b728e85f86157ef1af23d455" rel="noopener">崩溃那个Apiserver &amp;检查日志</a></li><li id="b5dd" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-5-imagepolicywebhook-8d09f1ceee70?source=friends_link&amp;sk=93017beeae20f640f52db41d20d3ffcd" rel="noopener">ImagePolicyWebhook/admission controller</a></li><li id="289b" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-6-users-and-certificatesigningrequests-368a5b2c6a3f" rel="noopener">用户和证书签名请求</a></li><li id="e224" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-7-serviceaccount-tokens-1158c93612d4?source=friends_link&amp;sk=1064eaf2f3d4d03576bcde207eaf7cfb" rel="noopener">服务帐户令牌安装</a></li><li id="2927" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-8-rbac-db8a0984059e?source=friends_link&amp;sk=8a1abe2d51275faed47f3d36858b14d5" rel="noopener">基于角色的访问控制(RBAC) </a></li><li id="1291" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-9-rbac-v2-23ee24dd77cd?source=friends_link&amp;sk=2a6027eb75fbcf7876216cab222fa953" rel="noopener">基于角色的访问控制(RBAC) v2 </a></li><li id="186a" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-10-container-hardening-177588b8bbfe?source=friends_link&amp;sk=dbdddc1ee9321a946ee2e3f778c0711a" rel="noopener">容器硬化</a></li><li id="cc7b" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-11-networkpolicies-default-deny-and-allowlist-b2ce4186551f?source=friends_link&amp;sk=bdcc071a32f26b93d6c4a51b9a9436a7" rel="noopener">网络策略(默认拒绝+允许列表)</a></li></ol><p id="ac41" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p id="8923" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">→在Udemy上查看<a class="ae lr" href="https://killer.sh/r?d=cks-course" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">全CKS课程</strong> </a></p><p id="1b1b" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><h1 id="3ccc" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">规则！</h1><ol class=""><li id="10df" class="mn mo iq kx b ky mp lb mq ls mr lt ms lu mt lq mu mv mw mx bi translated">速度要快，避免从头开始手动创建yaml</li><li id="fc57" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">仅使用<a class="ae lr" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank">kubernetes.io/docs</a>帮助。</li><li id="95d2" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">完成您的解决方案后，请查看我们的解决方案。你可能有一个更好的！</li></ol><h1 id="fe83" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">今天的任务:崩溃Apiserver并检查日志</h1><p id="3b36" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated"><em class="kw">你应该很容易改变Apiserver的配置。在修改Apiserver配置时，您可能会搞砸一些事情，如果您知道在哪里检查日志，这并不是一件坏事！</em></p><ol class=""><li id="635d" class="mn mo iq kx b ky kz lb lc ls ng lt nh lu ni lq mu mv mw mx bi translated">用新的参数<code class="fe nj nk nl nm b">--this-is-very-wrong</code>配置Apiserver清单。检查Pod是否重新启动以及这导致了什么日志。再次修复Apiserver。</li><li id="8a4c" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">将现有的Apiserver清单参数更改为:<code class="fe nj nk nl nm b">—-etcd-servers=this-is-very-wrong.</code>检查日志内容，并再次修复它。</li><li id="1ec7" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">更改Apiserver清单并添加无效的YAML。检查日志记录，然后再次修复。</li></ol><p id="cb14" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="42cd" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="5e45" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="5c1d" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="838c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><h1 id="d367" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">解决办法</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/c48a4df0cba310a57dcb22261415c046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ymVDA_YjhQ6U_NiJd6rR-w.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">愿猫与你同在</figcaption></figure><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="2b13" class="nw lw iq nm b gy nx ny l nz oa">alias k=kubectl</span></pre><p id="db2c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">要检查的日志位置:</strong></p><ul class=""><li id="6fb7" class="mn mo iq kx b ky kz lb lc ls ng lt nh lu ni lq ob mv mw mx bi translated"><code class="fe nj nk nl nm b">/var/log/pods</code></li><li id="2437" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated"><code class="fe nj nk nl nm b">/var/log/containers</code></li><li id="87b3" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated"><code class="fe nj nk nl nm b">docker ps</code> + <code class="fe nj nk nl nm b">docker logs</code></li><li id="5952" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated"><code class="fe nj nk nl nm b">crictl ps</code> + <code class="fe nj nk nl nm b">crictl logs</code>(不使用Docker时)</li><li id="cb51" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated">kubelet日志:<code class="fe nj nk nl nm b">/var/log/syslog</code>或<code class="fe nj nk nl nm b">journalctl -u kubelet</code></li></ul><h2 id="0e1c" class="nw lw iq bd lx oc od dn mb oe of dp mf ls og oh mh lt oi oj mj lu ok ol ml om bi translated">1.添加未知参数</h2><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="7cc3" class="nw lw iq nm b gy nx ny l nz oa">cp /etc/kubernetes/manifests/kube-apiserver.yaml ~/kube-apiserver.yaml.ori <strong class="nm ir"># always make a backup !</strong></span><span id="1fcc" class="nw lw iq nm b gy on ny l nz oa">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span></pre><p id="2e4a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">编辑:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="7666" class="nw lw iq nm b gy nx ny l nz oa">...<br/>spec:<br/>  containers:<br/>  - command:<br/>    - kube-apiserver<br/><strong class="nm ir">    - --this-is-very-wrong</strong><br/>    - --advertise-address=10.156.0.53<br/>    - --allow-privileged=true<br/>...</span></pre><p id="55c9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">等待它回来:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="2805" class="nw lw iq nm b gy nx ny l nz oa">k -n kube-system get pod <strong class="nm ir"># nothing there</strong></span></pre><p id="7c80" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">检查日志:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="7a43" class="nw lw iq nm b gy nx ny l nz oa">cd /var/log/pods</span><span id="4f4b" class="nw lw iq nm b gy on ny l nz oa">ls -lh | grep apiserver</span><span id="7892" class="nw lw iq nm b gy on ny l nz oa">tail -f kube-system_kube-apiserver-cks-master_7aef8559c5d7d59259044bb444b01ac3/kube-apiserver/4.log</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/10cb45b6442ca376929d0598a6d2381a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rmz9DSlcCSzvJAR5wMDJ4A.png"/></div></div></figure><p id="ac21" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们移除<code class="fe nj nk nl nm b">unknown flag</code>来再次修复Apiserver:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="5e29" class="nw lw iq nm b gy nx ny l nz oa">cp ~/kube-apiserver.yaml.ori /etc/kubernetes/manifests/kube-apiserver.yaml <strong class="nm ir"># smart people use a backup</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/3b62ed29832c8813a13468aeca432135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OjWtmWrTnAy7-ZnMF8bGw.png"/></div></div></figure><h2 id="44fc" class="nw lw iq bd lx oc od dn mb oe of dp mf ls og oh mh lt oi oj mj lu ok ol ml om bi translated">2.ETCD连接配置错误</h2><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="2a93" class="nw lw iq nm b gy nx ny l nz oa">cp /etc/kubernetes/manifests/kube-apiserver.yaml ~/kube-apiserver.yaml.ori <strong class="nm ir"># always make a backup !</strong></span><span id="1025" class="nw lw iq nm b gy on ny l nz oa">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span></pre><p id="8873" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">编辑:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="acbd" class="nw lw iq nm b gy nx ny l nz oa">...<br/>spec:<br/>  containers:<br/>  - command:<br/>    - kube-apiserver<br/>...<br/>    - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt<br/>    - --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key<br/><strong class="nm ir">    - --etcd-servers=this-is-very-wrong</strong><br/>    - --insecure-port=0<br/>...</span></pre><p id="5379" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">Apiserver需要与ETCD通信:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/969eea88a069233a08ace2638dbee5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7SnOyyYw5v_BM5rk_XYZw.png"/></div></div></figure><p id="a336" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们可以看到流程正在运行:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/7a4be4a9da4cc7dbed32c9cad7a0e3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJEiWCInag3gUnam3KP9MQ.png"/></div></div></figure><p id="0c41" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们看到容器在运行:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/a37c7187e67478f41cd461d0cd012671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ta4xFTYbWLpjfp1k9htquQ.png"/></div></div></figure><blockquote class="kr ks kt"><p id="8d7f" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">如果不使用Docker，则使用</strong> <code class="fe nj nk nl nm b">crictl ps</code>和<code class="fe nj nk nl nm b">crictl logs</code></p></blockquote><p id="5aa9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们可以查看集装箱日志:<code class="fe nj nk nl nm b">docker logs 829f1d829a43</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/91aa244183973634a6cb4b2036fc5932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u8hE5Mg6wOEZc4lGF9EOsw.png"/></div></div></figure><p id="4b4f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们再次修复Apiserver:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="32ed" class="nw lw iq nm b gy nx ny l nz oa">cp ~/kube-apiserver.yaml.ori /etc/kubernetes/manifests/kube-apiserver.yaml <strong class="nm ir"># clever people use a backup</strong></span></pre><h2 id="0987" class="nw lw iq bd lx oc od dn mb oe of dp mf ls og oh mh lt oi oj mj lu ok ol ml om bi translated">3.无效的Apiserver清单YAML</h2><p id="a75e" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">这将导致kubelet甚至无法创建容器。所以我们无法检查Pod或集装箱日志。</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="63e4" class="nw lw iq nm b gy nx ny l nz oa">cp /etc/kubernetes/manifests/kube-apiserver.yaml ~/kube-apiserver.yaml.ori <strong class="nm ir"># do you do backup?</strong></span><span id="3600" class="nw lw iq nm b gy on ny l nz oa">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span></pre><p id="8748" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">编辑无效的YAML:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="b67b" class="nw lw iq nm b gy nx ny l nz oa">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>...<br/>  name: kube-apiserver<br/>  namespace: kube-system<br/><strong class="nm ir">specTHIS IS VERY ::::: WRONG</strong><br/>  containers:<br/>  - command:<br/>    - kube-apiserver<br/>...</span></pre><p id="d70f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">你好apiserver进程？</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="6374" class="nw lw iq nm b gy nx ny l nz oa">ps aux | grep apiserver <strong class="nm ir"># nada</strong></span></pre><p id="6d5f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">豆荚日志？</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="9486" class="nw lw iq nm b gy nx ny l nz oa">find /var/log/pods/ | grep apiserver <strong class="nm ir"># nichts</strong></span></pre><p id="7fa2" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">集装箱？</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="a2d6" class="nw lw iq nm b gy nx ny l nz oa">docker ps | grep apiserver <strong class="nm ir"># YUdGb1lTRWhJUW89Cg==</strong></span></pre><blockquote class="kr ks kt"><p id="4927" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">或者如果不使用Docker，使用</strong> <code class="fe nj nk nl nm b"><em class="iq">crictl ps</em></code>和<code class="fe nj nk nl nm b"><em class="iq">crictl logs</em></code></p></blockquote><p id="c498" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">Kubelet syslog日志(<code class="fe nj nk nl nm b">/var/log/syslog</code>)？</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="86c5" class="nw lw iq nm b gy nx ny l nz oa">Jan  2 18:41:00 cks-controlplane kubelet[7000]: E0102 18:41:00.573469    7000 file.go:187] Can't process manifest file "/etc/kubernetes/manifests/kube-apiserver.yaml": /etc/kubernetes/manifests/kube-apiserver.yaml: <strong class="nm ir">couldn't parse as pod(yaml: line 13: mapping values are not allowed in this context)</strong>, please check config file</span></pre><p id="53ad" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">或者也有可能:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="afa0" class="nw lw iq nm b gy nx ny l nz oa">journalctl -u kubelet | tail</span></pre><p id="2621" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">现在再次修复它以使apiserver满意:</p><pre class="kg kh ki kj gt ns nm nt nu aw nv bi"><span id="c9d6" class="nw lw iq nm b gy nx ny l nz oa">cp ~/kube-apiserver.yaml.ori /etc/kubernetes/manifests/kube-apiserver.yaml <strong class="nm ir"># wise people use a backup</strong></span></pre><p id="ae00" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="15b1" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="2369" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="8271" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><p id="f539" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">.</p><h1 id="d8c6" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">你有不同的解决方法？</h1><p id="d750" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">请在下面留言告诉我们！</p><h1 id="e809" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">重述:不要惊慌</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/a6d24199002684dd915ee6af4783aa68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqc64EP-2OHRSrMGPpWLTA.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk translated">Apiserver没了？不用担心！吸气…呼气…然后检查日志！</figcaption></figure><ul class=""><li id="1137" class="mn mo iq kx b ky kz lb lc ls ng lt nh lu ni lq ob mv mw mx bi translated">如果Apiserver没有恢复，不要惊慌。很可能会有日志给你更多的信息！</li><li id="59f8" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated">在更改K8s组件配置之前，请务必进行备份。</li><li id="85ec" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq ob mv mw mx bi translated">放心地检查Pod/Container/Process/Syslog/kube let日志。</li></ul><h1 id="9727" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">— — —结尾————</h1><p id="7fa4" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">本次会议到此为止。下次再见，祝学习愉快！</p><h1 id="ca0a" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">准备好加入黑仔壳牌了吗？</h1><h2 id="0d9a" class="nw lw iq bd lx oc od dn mb oe of dp mf ls og oh mh lt oi oj mj lu ok ol ml om bi translated">完整的CKS课程</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://killer.sh/r?d=cks-course"><div class="gh gi ov"><img src="../Images/b16ab8b3bd72db1ad641b82f067bdd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULNkfS7aG-FdPA_OEtLbJQ.png"/></div></a><figcaption class="no np gj gh gi nq nr bd b be z dk translated"><a class="ae lr" href="https://killer.sh/r?d=cks-course" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><h2 id="5451" class="nw lw iq bd lx oc od dn mb oe of dp mf ls og oh mh lt oi oj mj lu ok ol ml om bi translated">…或者CKS模拟器</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://killer.sh/cks"><div class="gh gi ow"><img src="../Images/4c118b1471bd606fc46cd5569df4f944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ery6hxFdiGJ6wSlP.png"/></div></a><figcaption class="no np gj gh gi nq nr bd b be z dk translated"><a class="ae lr" href="https://killer.sh/cks" rel="noopener ugc nofollow" target="_blank">https://killer.sh/cks</a></figcaption></figure></div></div>    
</body>
</html>