<html>
<head>
<title>Google Cloud Functions, Node.js and Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云功能，Node.js和Express</h1>
<blockquote>原文：<a href="https://itnext.io/google-cloud-functions-node-js-and-express-aea4a2a9ba3a?source=collection_archive---------1-----------------------#2019-04-07">https://itnext.io/google-cloud-functions-node-js-and-express-aea4a2a9ba3a?source=collection_archive---------1-----------------------#2019-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6e22937e5b859c355a6877a52e24c1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3mxLaycGKDPnZv3nXSLKsA.png"/></div></div></figure><blockquote class="jy jz ka"><p id="e6fe" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您想直接跳到代码，请查看我的<a class="ae la" href="https://github.com/wesley-haigh/gcp-cloud-functions-example" rel="noopener ugc nofollow" target="_blank"> Github </a>以获得本文中使用的完整源代码。</p></blockquote><p id="5c8b" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">谷歌云无服务器产品的核心是<a class="ae la" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank">谷歌云功能</a>。这款谷歌云产品让你不用担心服务器供应、配置自动伸缩等问题。在本文中，我们将了解如何使用Google Cloud Functions、<a class="ae la" href="https://nodejs.org" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae la" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>快速轻松地创建微服务。</p><h1 id="47f8" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">先决条件</h1><p id="02a3" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">在开始之前，您需要确保您已经在您的机器上安装了<a class="ae la" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>，您已经创建了<a class="ae la" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank"> Google Cloud项目</a>，并且您已经安装了<a class="ae la" href="https://cloud.google.com/sdk/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>。</p><p id="ef9f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">要验证节点是否已安装，请运行以下命令。您应该会看到已安装的节点版本的输出。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="b7ad" class="mq lf iq mm b gy mr ms l mt mu">npm -v<br/>node -v</span></pre><p id="3809" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">您可以使用类似的命令来验证Google Cloud SDK是否已经安装。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="1af1" class="mq lf iq mm b gy mr ms l mt mu">gcloud --version</span></pre><h1 id="7092" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">设置Google云</h1><p id="42f5" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">一旦您创建了您的谷歌云项目，我们就可以启用云功能API。在<a class="ae la" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云控制台</a>中导航至<strong class="ke ir">API&amp;服务</strong>，然后在库中搜索<strong class="ke ir">云函数API </strong>。您应该会发现自己出现在类似于下图的屏幕上。继续并启用API。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/949a1ab830dda283a306b206f96efea5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0ktoHf6yMD999CTc7JQPg.png"/></div></div></figure><p id="abcc" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">您可能还在此屏幕上看到了云功能的自由层。这对于我们能够创建自己的微服务(作为本文的一部分)来说已经足够了。</p><p id="2da0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">要验证您是否准备好开始构建和部署您的云功能，请导航到控制台中的<strong class="ke ir">云功能</strong>页面，您应该会看到您能够创建云功能。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/742e7671afc6d20e4391c37fdac3079b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ad0S-X3BFyZkjhijsIpQnQ.png"/></div></div></figure><h1 id="f2ed" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建快速应用程序</h1><p id="3dab" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">为了初始化应用程序，我们将使用<code class="fe mx my mz mm b">npm</code>工具为我们创建<code class="fe mx my mz mm b">package.json</code>，然后我们将创建一个文件，我们将自己编写代码。</p><p id="27d6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">或者，您可以使用<a class="ae la" href="https://expressjs.com/en/starter/generator.html" rel="noopener ugc nofollow" target="_blank">快速生成器工具</a>。这将创建项目的框架，并且是创建Express应用程序的最快和最简单的方法。然而，这会生成大量本文不需要的文件。</p><p id="db0e" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">导航到终端中的新文件夹，并运行以下命令。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="a5b2" class="mq lf iq mm b gy mr ms l mt mu">npm init</span></pre><p id="0b1a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">按照屏幕上的提示，点击回车键跳过问题。您现在应该看到您的目录中有一个<code class="fe mx my mz mm b">package.json</code>。</p><p id="9e9d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来我们将安装Express并保存到我们的<code class="fe mx my mz mm b">package.json</code>中。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="dfe1" class="mq lf iq mm b gy mr ms l mt mu">npm install express --save</span></pre><p id="7c87" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">最后，我们将创建我们的<code class="fe mx my mz mm b">index.js</code>文件。这将是我们编写代码的地方。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="f46e" class="mq lf iq mm b gy mr ms l mt mu">nano index.js</span></pre><p id="649d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在我们准备开始编码。打开你最喜欢的代码编辑器，我们就可以开始了。</p><p id="b12d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">将以下代码添加到<code class="fe mx my mz mm b">index.js</code></p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7771" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，您可以通过以下方式运行您的应用:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8a6a" class="mq lf iq mm b gy mr ms l mt mu">node index.js</span></pre><p id="b05d" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在你应该在终端中看到<code class="fe mx my mz mm b">Server running on port 5555</code>。恭喜你！您已经创建了您的第一个快速应用程序！唯一的问题是，如果你去<a class="ae la" href="http://localhost:5555" rel="noopener ugc nofollow" target="_blank"> http://localhost:5555 </a>你不会看到任何东西，因为我们没有配置应用程序来监听请求。</p><p id="cff1" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">让我们用下面的代码修改我们的<code class="fe mx my mz mm b">index.js</code>来创建一些端点:</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a4d0" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">再次运行该应用程序，您应该能够访问<a class="ae la" href="http://localhost:5555/users" rel="noopener ugc nofollow" target="_blank">http://localhost:5555/users</a>并看到我们的用户列表。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/0271d8b51efd73f9d562ffbf57c78f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwnA4pUfmHyaJ12Kzko6fg.png"/></div></div></figure><p id="d484" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们的第二个端点演示了如何在Express中使用路径参数，因此如果您转到<a class="ae la" href="http://localhost:5555/users/2" rel="noopener ugc nofollow" target="_blank">http://localhost:5555/users/2</a>，您将看到我们的用户“Jane Williams”。</p><h1 id="0566" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">部署到云功能</h1><p id="3e3d" class="pw-post-body-paragraph kb kc iq ke b kf mc kh ki kj md kl km lb me kp kq lc mf kt ku ld mg kx ky kz ij bi translated">现在让我们将我们的应用程序部署到云功能中。要部署我们的应用程序，我们只需要一个命令。在我们的应用程序的根目录下运行命令:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="4678" class="mq lf iq mm b gy mr ms l mt mu">gcloud functions deploy first-function --runtime nodejs8 --trigger-http --entry-point app</span></pre><p id="d2f6" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这将需要几分钟的时间来运行，但完成后，您应该会在控制台中看到以下内容。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="21a0" class="mq lf iq mm b gy mr ms l mt mu">Deploying function (may take a while - up to 2 minutes)...done.<br/>httpsTrigger:<br/>  url: https://us-central1-&lt;GCP-PROJECT-ID&gt;.cloudfunctions.net/first-function<br/>labels:<br/>  deployment-tool: cli-gcloud<br/>name: projects/&lt;GCP-PROJECT-ID&gt;/locations/us-central1/functions/first-function<br/>runtime: nodejs8</span></pre><p id="4fb2" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">让我们分析一下我们简单运行过命令。在<code class="fe mx my mz mm b">gcloud function deploy</code>之后，下一个参数是你的函数名。<code class="fe mx my mz mm b">--runtime</code>标志告诉GCP你的应用需要哪个运行时，你应该检查你的node版本并确保你使用了合适的运行时。<code class="fe mx my mz mm b">--entry-point</code>标志指向<code class="fe mx my mz mm b">index.js</code>中的出口，这是函数的入口点。更多关于<code class="fe mx my mz mm b">gcloud</code>命令的信息可以在<a class="ae la" href="https://cloud.google.com/functions/docs/deploying/filesystem" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8ac5" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在您部署了您的函数之后，您应该能够在Google Cloud控制台中看到它，并且您可以通过转到<code class="fe mx my mz mm b">https://us-central1-&lt;GCP-PROJECT-ID&gt;.cloudfunctions.net/first-function/users</code>来调用您的函数</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/443dd28e0c1fd7c587102a67d2c96dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f1PvOvfnYsTtohY0xMz87Q.png"/></div></div></figure><p id="9718" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">就是这样！我们已经成功地在谷歌的云功能上创建并部署了我们的第一个微服务。</p><p id="156a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">你可以在我的<a class="ae la" href="https://github.com/wesley-haigh/gcp-cloud-functions-example" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到这篇文章的完整源代码。</p><p id="5d2a" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">编码快乐！</p></div></div>    
</body>
</html>