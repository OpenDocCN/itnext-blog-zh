<html>
<head>
<title>Nextcloud + Raspberry Pi + Docker + Onion service = 🔥</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nextcloud +树莓Pi + Docker +洋葱服务=🔥</h1>
<blockquote>原文：<a href="https://itnext.io/nextcloud-docker-raspberry-pi-onion-service-84d4af13f7e6?source=collection_archive---------2-----------------------#2020-07-07">https://itnext.io/nextcloud-docker-raspberry-pi-onion-service-84d4af13f7e6?source=collection_archive---------2-----------------------#2020-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e7c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(<a class="ae kl" href="https://medium.com/@robinriclet/nextcloud-raspberry-pi-docker-onion-service-fr-c778d4974e8a" rel="noopener">法文版此处</a>)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/64c9494bc38550b7fd1ed047694fd2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*846pH8kDD8JlfWz1RUJIGg.png"/></div></div></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="3027" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几个月前，我有一个想法，建立一个私有的<a class="ae kl" href="https://en.wikipedia.org/wiki/Nextcloud" rel="noopener ugc nofollow" target="_blank"> Nextcloud </a>实例，与朋友分享文件，有一个小组议程和更多的协作内容。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lf"><img src="../Images/f8b645e8261bc2b5bd4b521dc85a63ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDus34EG1UYn_eg5RxtNZg.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">(下一代云用户界面)</figcaption></figure><p id="ad48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于隐私方面的考虑，也为了避免支付域名费用，我考虑将这个实例作为一个<a class="ae kl" href="https://en.wikipedia.org/wiki/Tor_(anonymity_network)#Onion_services" rel="noopener ugc nofollow" target="_blank"> Tor隐藏服务</a>。</p><p id="442f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我开始四处询问托管解决方案、价格和隐私政策。在几个星期的不成功的发现之后，我偶然发现这个Reddit帖子建议在Raspberry Pi上托管Nextcloud实例。为什么我没有早点想到这个？！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lk"><img src="../Images/d260815429fd8f0dba3321fc2fadc7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXv9AUDVK76pTM-K0La6bg.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">(一个漂亮的覆盆子Pi 4放在覆盆子色的盒子里，❤)</figcaption></figure><p id="87c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我订购了一个<a class="ae kl" href="https://thepihut.com/collections/raspberry-pi-kits-and-bundles/products/raspberry-pi-starter-kit" rel="noopener ugc nofollow" target="_blank">树莓Pi入门套件</a>，配有全新的树莓Pi 4 Model B (4GB内存)。等包裹的时候发现<a class="ae kl" href="https://github.com/torservers/onionize-docker" rel="noopener ugc nofollow" target="_blank">这个GitHub回购</a>。我使用Docker和MariaDb设置了Nextcloud实例，所有这些都在洋葱服务的背后。<code class="fe ll lm ln lo b">docker-compose.yaml</code>看起来是这样的:</p><pre class="kn ko kp kq gt lp lo lq lr aw ls bi"><span id="9159" class="lt lu iq lo b gy lv lw l lx ly">version: '3'</span><span id="bc01" class="lt lu iq lo b gy lz lw l lx ly">services:<br/>  onionize:<br/>    image: torservers/onionize<br/>    volumes:<br/>      - /var/run/docker.sock:/tmp/docker.sock:ro<br/>    networks:<br/>      - faraday</span><span id="1a23" class="lt lu iq lo b gy lz lw l lx ly">  nextcloud:<br/>    image: nextcloud:apache<br/>    environment:<br/>      - ONIONSERVICE_NAME=app<br/>    networks:<br/>      - faraday<br/>    depends_on:<br/>      - db<br/>    volumes:<br/>      - nextcloud:/var/www/html<br/>      - ./app/config:/var/www/html/config<br/>      - ./app/custom_apps:/var/www/html/custom_apps<br/>      - ./app/data:/var/www/html/data<br/>      - ./app/themes:/var/www/html/themes<br/>      - /etc/localtime:/etc/localtime:ro<br/>    restart: unless-stopped</span><span id="ba9e" class="lt lu iq lo b gy lz lw l lx ly">  db:<br/>    image: mariadb<br/>    networks:<br/>      - faraday<br/>    volumes:<br/>      - db:/var/lib/mysql<br/>      - /etc/localtime:/etc/localtime:ro<br/>    environment:<br/>      - MYSQL_ROOT_PASSWORD=password<br/>      - MYSQL_PASSWORD=mysql<br/>      - MYSQL_DATABASE=nextcloud<br/>      - MYSQL_USER=nextcloud<br/>    restart: unless-stopped</span><span id="4017" class="lt lu iq lo b gy lz lw l lx ly">volumes:<br/>  nextcloud:<br/>  db:</span><span id="432a" class="lt lu iq lo b gy lz lw l lx ly">networks:<br/>  faraday:<br/>    driver: bridge</span></pre></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="3f3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的笔记本电脑一切正常，所以我在等待。收到树莓后，<a class="ae kl" href="https://www.instructables.com/id/Install-and-Setup-Raspbian-Lite-on-Raspberry-Pi-3/" rel="noopener ugc nofollow" target="_blank">我安装了Raspbian Lite并设置了SSH</a>。接下来，我安装了<code class="fe ll lm ln lo b">git</code>、<code class="fe ll lm ln lo b">docker</code>、<code class="fe ll lm ln lo b">docker-compose</code>，并添加了外部存储。</p><p id="ea30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">docker-compose up </code>而且……没有。<code class="fe ll lm ln lo b">nextcloud</code>和<code class="fe ll lm ln lo b">db</code>服务正确启动，但<code class="fe ll lm ln lo b">onionize</code>出错退出。它在我的笔记本电脑上运行良好，为什么在覆盆子上就不行呢？！</p><p id="b575" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker镜像<code class="fe ll lm ln lo b">torservers/onionize:latest</code>的架构是<code class="fe ll lm ln lo b">amd64</code>而<a class="ae kl" href="https://stackoverflow.com/questions/37790029/what-is-difference-between-arm64-and-armhf" rel="noopener ugc nofollow" target="_blank">树莓派4有一个</a> <code class="fe ll lm ln lo b"><a class="ae kl" href="https://stackoverflow.com/questions/37790029/what-is-difference-between-arm64-and-armhf" rel="noopener ugc nofollow" target="_blank">armhf</a></code> <a class="ae kl" href="https://stackoverflow.com/questions/37790029/what-is-difference-between-arm64-and-armhf" rel="noopener ugc nofollow" target="_blank">架构</a>！我做了一些研究，发现了Docker团队最近开发的<a class="ae kl" href="https://github.com/docker/buildx" rel="noopener ugc nofollow" target="_blank">工具</a> : <code class="fe ll lm ln lo b">buildx</code></p><p id="0dad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">buildx</code>允许为特定处理器架构构建映像，如<code class="fe ll lm ln lo b">amd64 </code>或<code class="fe ll lm ln lo b">amrhf</code>。我分叉了<code class="fe ll lm ln lo b">torservers/onionize</code>，改变了docker文件中<code class="fe ll lm ln lo b">docker-gen</code>的架构，并使用<code class="fe ll lm ln lo b">buildx</code>创建了一个兼容<code class="fe ll lm ln lo b">armhf</code>的映像。</p><p id="a06d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里举例:<a class="ae kl" href="https://medium.com/@artur.klauser/building-multi-architecture-docker-images-with-buildx-27d80f7e2408" rel="noopener">https://medium . com/@ Artur . klauser/building-multi-architecture-docker-images-with-buildx-27d 80 f 7 e 2408</a></p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="1bb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">容器现在已经启动一周了，Nextcloud运行得很好，通过Tor网络的响应时间非常快！</p><p id="dbb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的Github回购:<a class="ae kl" href="https://github.com/rriclet/tor-cloud" rel="noopener ugc nofollow" target="_blank">https://github.com/rriclet/tor-cloud</a></p></div></div>    
</body>
</html>