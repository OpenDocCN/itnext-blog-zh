<html>
<head>
<title>Connect to Snowflake Data Warehouse with GO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GO连接到雪花数据仓库</h1>
<blockquote>原文：<a href="https://itnext.io/connect-to-snowflake-data-warehouse-with-go-c42bbcfbbfe4?source=collection_archive---------5-----------------------#2018-07-18">https://itnext.io/connect-to-snowflake-data-warehouse-with-go-c42bbcfbbfe4?source=collection_archive---------5-----------------------#2018-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4684" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一期中，我将介绍连接GO到雪花数据仓库服务(DWaaS)的过程。本教程要求您有一个雪花帐户。你可以在这里注册<a class="ae kl" href="https://trial.snowflake.net/" rel="noopener ugc nofollow" target="_blank">30天/400美元的试用期。</a></p><p id="4582" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载并安装ODBC驱动程序</p><p id="3264" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你在雪花中设置了你的帐户，按照指示下载ODBC驱动程序。它将与您找到snowSQL下载的位置相同:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/991eb09fcde8de6a3a74526d7ae845e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*syJRagZ6XOaF3V5O.png"/></div></div></figure><p id="5d8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装GO</p><p id="0e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装GO可以通过自制软件或者访问<a class="ae kl" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank"> GoLang下载页面</a>来完成。如果你选择了自制，可以在他们的页面上找到安装说明<a class="ae kl" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">，或者你可以复制粘贴:</a></p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="1085" class="ld le iq kz b gy lf lg l lh li">/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span></pre><p id="c324" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这会让你马上行动起来。一旦你开始自制，你可以简单地输入:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="9fe8" class="ld le iq kz b gy lf lg l lh li">Macbook Pro:~ dbryant$ brew install go</span></pre><p id="9a9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确认GO已安装:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="426a" class="ld le iq kz b gy lf lg l lh li">Macbook Pro:~ dbryant$ go version<br/>go version go1.10.1 darwin/amd64</span></pre><p id="cff8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装GO后，这将是更新你的好时机。配置文件包含一个GOPATH环境变量。对于我的配置，它看起来像这样:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="abfd" class="ld le iq kz b gy lf lg l lh li">$ cat .bash_profile<br/>export PS1="$ "<br/>export GOPATH=/Users/dbryant/go<br/><br/>$ echo $GOPATH<br/>/Users/dbryant/go</span></pre><p id="501f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装dep</p><p id="4bef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">dep是一个用于Go的原型依赖管理工具。需要Go 1.9或更新版本才能编译。由于家酿已经在您的机器上，我们可以很容易地使用brew安装dep:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="4814" class="ld le iq kz b gy lf lg l lh li">$ brew install dep<br/>Updating Homebrew...<br/>==&gt; Auto-updated Homebrew!<br/>Updated 1 tap (homebrew/core).<br/>==&gt; New Formulae<br/>amtk<br/>==&gt; Updated Formulae<br/>annie                      git-quick-stats            nvc<br/>ansiweather                giter8                     ola<br/>apache-flink               gitlab-runner              overmind<br/>babel                      gnome-latex                packer<br/>bareos-client              grpc                       paket<br/>bazel                      harfbuzz                   proxychains-ng<br/>binaryen                   jpeg-archive               pulseaudio<br/>byteman                    kube-aws                   sane-backends<br/>ccextractor                latex2rtf                  sipp<br/>charm                      lensfun                    snakemake<br/>cmake                      libdvbpsi                  sphinx-doc<br/>cockroach                  libfixbuf                  tepl<br/>collectd                   libtorrent-rasterbar       tiger-vnc<br/>conjure-up                 liquibase                  traefik<br/>fakeroot                   mpop                       util-linux<br/>fastqc                     mutt                       vala<br/>file-roller                neomutt                    webpack<br/>fn                         net-snmp                   webtorrent-cli<br/>folly                      nifi                       weechat<br/>fwup                       npth                       xonsh<br/><br/>==&gt; Installing dependencies for dep: go<br/>==&gt; Installing dep dependency: go<br/>==&gt; Downloading <a class="ae kl" href="https://homebrew.bintray.com/bottles/go-1.10.3.high_sierra.bottl" rel="noopener ugc nofollow" target="_blank">https://homebrew.bintray.com/bottles/go-1.10.3.high_sierra.bottl</a><br/>######################################################################## 100.0%<br/>==&gt; Pouring go-1.10.3.high_sierra.bottle.tar.gz<br/>==&gt; Caveats<br/>A valid GOPATH is required to use the `go get` command.<br/>If $GOPATH is not specified, $HOME/go will be used by default:<br/>  <a class="ae kl" href="https://golang.org/doc/code.html#GOPATH" rel="noopener ugc nofollow" target="_blank">https://golang.org/doc/code.html#GOPATH</a><br/><br/>You may wish to add the GOROOT-based install location to your PATH:<br/>  export PATH=$PATH:/usr/local/opt/go/libexec/bin<br/>==&gt; Summary<br/>🍺  /usr/local/Cellar/go/1.10.3: 8,170 files, 336.7MB<br/>==&gt; Installing dep<br/>==&gt; Downloading <a class="ae kl" href="https://homebrew.bintray.com/bottles/dep-0.4.1_1.high_sierra.bot" rel="noopener ugc nofollow" target="_blank">https://homebrew.bintray.com/bottles/dep-0.4.1_1.high_sierra.bot</a><br/>######################################################################## 100.0%<br/>==&gt; Pouring dep-0.4.1_1.high_sierra.bottle.tar.gz<br/>🍺  /usr/local/Cellar/dep/0.4.1_1: 7 files, 8.8MB<br/>==&gt; Caveats<br/>==&gt; go<br/>A valid GOPATH is required to use the `go get` command.<br/>If $GOPATH is not specified, $HOME/go will be used by default:<br/>  <a class="ae kl" href="https://golang.org/doc/code.html#GOPATH" rel="noopener ugc nofollow" target="_blank">https://golang.org/doc/code.html#GOPATH</a><br/><br/>You may wish to add the GOROOT-based install location to your PATH:<br/>  export PATH=$PATH:/usr/local/opt/go/libexec/bin</span></pre><p id="3cc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装GO雪花驱动程序:</p><p id="4705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取Gosnowflake源代码和<a class="ae kl" href="https://github.com/golang/dep" rel="noopener ugc nofollow" target="_blank"> dep </a>(依赖管理工具)，如果没有安装，确保安装了依赖库。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="0606" class="ld le iq kz b gy lf lg l lh li">go get -u github.com/snowflakedb/gosnowflake<br/>go get -u github.com/golang/dep/cmd/dep<br/>cd $GOPATH/src/github.com/snowflakedb/gosnowflake/<br/>dep ensure</span></pre><p id="441d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们已经完成了连接的大部分先决条件，我们需要构建示例程序</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="3270" class="ld le iq kz b gy lf lg l lh li">$ make install<br/>for c in $(ls cmd); do \<br/>		(cd cmd/$c;  GOBIN=$GOPATH/bin go install $c.go); \<br/>	done<br/>$</span></pre><p id="bbe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在执行make install命令之后，我在下面的子目录中找到了我们的测试文件“select1.go ”:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="cccd" class="ld le iq kz b gy lf lg l lh li">/Users/dbryant/go/src/github.com/snowflakedb/gosnowflake/cmd/select1/</span></pre><p id="93cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经正确配置了所有的路径信息，那么这对于您测试连接应该是没问题的。这个测试程序将简单地尝试连接到雪花数据仓库。通过GO和select1.go测试文件连接到雪花需要三个参数。</p><p id="71ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看select1.go文件中的代码片段</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="7f34" class="ld le iq kz b gy lf lg l lh li">...<br/><br/>// getDSN constructs a DSN based on the test connection parameters<br/>func getDSN() (string, *sf.Config, error) {<br/>	env := func(k string, failOnMissing bool) string {<br/>		if value := os.Getenv(k); value != "" {<br/>			return value<br/>		}<br/>		if failOnMissing {<br/>			log.Fatalf("%v environment variable is not set.", k)<br/>		}<br/>		return ""<br/>	}<br/><br/>	account := env("SNOWFLAKE_TEST_ACCOUNT", true)<br/>	user := env("SNOWFLAKE_TEST_USER", true)<br/>	password := env("SNOWFLAKE_TEST_PASSWORD", true)<br/>	host := env("SNOWFLAKE_TEST_HOST", false)<br/>	port := env("SNOWFLAKE_TEST_PORT", false)<br/>	protocol := env("SNOWFLAKE_TEST_PROTOCOL", false)<br/><br/>	portStr, _ := strconv.Atoi(port)<br/>	cfg := &amp;sf.Config{<br/>		Account:  account,<br/>		User:     user,<br/>		Password: password,<br/>		Host:     host,<br/>		Port:     portStr,<br/>		Protocol: protocol,<br/>	}<br/><br/>	dsn, err := sf.DSN(cfg)<br/>	return dsn, cfg, err<br/>}<br/>...</span></pre><p id="41d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的函数来自select1.go测试文件。您应该注意到<strong class="jp ir">帐户</strong>、<strong class="jp ir">用户</strong>和<strong class="jp ir">密码</strong>的env函数传递了一个true参数。这些是从O/S环境变量中读取的值。出于测试目的，我创建了一个shell脚本来设置这些值。</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="8ab3" class="ld le iq kz b gy lf lg l lh li">$ cat .sfgo.sh<br/>#!/bin/sh<br/>export SNOWFLAKE_TEST_ACCOUNT=my_account_name<br/>export SNOWFLAKE_TEST_USER=user_name<br/>export SNOWFLAKE_TEST_PASSWORD=password<br/>$ <br/>$ chmod 755 .sfgo.sh<br/>$ . .sfgo.sh</span></pre><p id="04ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行脚本后，检查是否设置了环境变量:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="243e" class="ld le iq kz b gy lf lg l lh li">$ echo $SNOWFLAKE_TEST_USER<br/>user_name<br/>$ echo $SNOWFLAKE_TEST_ACCOUNT<br/>my_account_name<br/>$ echo $SNOWFLAKE_TEST_PASSWORD<br/>password<br/>$</span></pre><p id="35cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">验证这些环境变量设置正确后，确认您位于select1.go文件所在的目录中，并执行以下命令:</p><pre class="kn ko kp kq gt ky kz la lb aw lc bi"><span id="4e96" class="ld le iq kz b gy lf lg l lh li">$ go run select1.go<br/>Congrats! You have successfully run SELECT 1 with Snowflake DB!</span></pre><p id="bb4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你看到祝贺！消息，那么恭喜你，你已经成功连接到雪花数据仓库云服务。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/a4f66edcf4be20241b1a65dcbd921570.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*_MuBZOvem-gOLWNc.png"/></div></figure><p id="fea5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽情享受吧！</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="9c6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lr">最初发表于</em> <a class="ae kl" href="http://dbaontap.com/2018/07/18/connect-snowflake-using-go/" rel="noopener ugc nofollow" target="_blank"> <em class="lr"> dbaonTap </em> </a> <em class="lr">。</em></p></div></div>    
</body>
</html>