<html>
<head>
<title>Data Encryption In Ruby On Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby On Rails中的数据加密</h1>
<blockquote>原文：<a href="https://itnext.io/data-encryption-in-ruby-on-rails-4512fea27893?source=collection_archive---------0-----------------------#2017-11-20">https://itnext.io/data-encryption-in-ruby-on-rails-4512fea27893?source=collection_archive---------0-----------------------#2017-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2bc3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在任何应用程序中，数据安全性都是主要关注点。因为我们存储了用户的个人数据，如出生日期、手机号码、地址、银行信息等。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0c0bc8989ff7c7e1ba7cb1bcb74531cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*La6jFuWFaLYCvIbUZihRFQ.jpeg"/></div></div></figure><p id="3b3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fdata-encryption-in-ruby-on-rails-4512fea27893" rel="noopener ugc nofollow" target="_blank"> <em class="lo">点击这里在LinkedIn </em> </a>上分享这篇文章</p><p id="020c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，您处于实施数据安全功能的正确位置。<br/>这里我们使用的是Ruby(4.2.5)和Postgresql(用来存储用户的数据)。</p><p id="8782" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Ruby On Rails中有多种gem可用。但是我们要实现“attr _ encrypted”Gem。</p><p id="ef9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一步。添加数据加密gem  <br/>在GemFile中添加一个gem。</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="9931" class="lu lv iq lq b gy lw lx l ly lz">gem 'attr_encrypted'</span></pre><p id="7849" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">步骤2。执行捆绑安装</strong></p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="fd27" class="lu lv iq lq b gy lw lx l ly lz">bundle install</span></pre><p id="ada3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">步骤3。生成模型</strong></p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="da3d" class="lu lv iq lq b gy lw lx l ly lz">rails g model UserDetail</span></pre><p id="81b6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">步骤4。在迁移文件中设置加密列。</strong></p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="37c5" class="lu lv iq lq b gy lw lx l ly lz">class CreateUserDetails &lt; ActiveRecord::Migration<br/>  def change<br/>    create_table :user_details do |t|<br/>      t.string :last_name<br/>      t.string :first_name<br/>      t.string :encrypted_birth_date<br/>      t.string :encrypted_birth_date_iv<br/>      t.string :encrypted_mobile_no<br/>      t.string :encrypted_mobile_no_iv<br/>      t.timestamps null: false<br/>    end<br/>  end<br/>end</span></pre><p id="1119" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在迁移文件中，我们需要加密birth_date和mobile_no，所以，我们必须在列名前添加「加密的_」字符串。例如，出生日期。</p><p id="5cc9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，我们的迁移文件看起来像，</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="70fd" class="lu lv iq lq b gy lw lx l ly lz">t.string :encrypted_birth_date<br/>t.string :encrypted_birth_date_iv</span></pre><p id="775e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">iv列用于提高数据安全性。</p><p id="360a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第五步。在型号中设置<br/>在您的型号中，</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="4c54" class="lu lv iq lq b gy lw lx l ly lz">class UserDetail &lt; ActiveRecord::Base<br/>    secret_key = ENV['DB_COL_ENCRYPTED_KEY']<br/>    attr_encrypted :birth_date, :key =&gt; secret_key<br/>    attr_encrypted :mobile_no, :key =&gt; secret_key<br/>    validates_presence_of :last_name<br/>    validates_presence_of :first_name<br/>    validates_presence_of :birth_date <br/>end</span></pre><p id="5f7a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">关于环境变量的设置，请查看以下文章。</strong>http://qiita.com/alokrawat050/items/0d7791b3915579f95791<br/>T22</p><p id="45c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第六步。如何访问视图或rails控制台中的加密字段 <br/>如果你需要访问视图或rails控制台中的加密字段，那么你只需要写列名(不需要写encrypted_)。</p><p id="73d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在视图中，</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="0f56" class="lu lv iq lq b gy lw lx l ly lz">&lt;%= f.text_field :birth_date, class: 'form-control'  %&gt;<br/>&lt;%= f.text_field : mobile_no, class: 'form-control'  %&gt;</span></pre><p id="6c6c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在控制器中，设置许可参数，</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="c709" class="lu lv iq lq b gy lw lx l ly lz">private<br/>    def user_details_params<br/>      params.require(:user_detail).permit(:id, :last_name, :birth_date, :mobile_no)<br/>    end</span></pre><p id="87c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">在rails控制台，</strong> <br/> rails c</p><p id="8a59" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">1 .在user_details表中插入数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ma"><img src="../Images/59a646b16e8f763ad6bf25192387a318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8m1cZ2LZ9vZI9vK3.png"/></div></div></figure><p id="1f92" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的例子中，你可以看到当我们要保存数据时，它加密了列的数据(出生日期和手机号码)。</p><p id="82af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.从user_details表中提取数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mb"><img src="../Images/feec0ae04369512063da256fb02136b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wIeD6TnbI6B797tw.png"/></div></div></figure><p id="c553" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当我们获取数据时，我们只需要调用列名(不需要写encrypted_)。</p><pre class="kg kh ki kj gt lp lq lr ls aw lt bi"><span id="18f6" class="lu lv iq lq b gy lw lx l ly lz">usr = UserDetail.find(1) usr.birth_date usr.mobile_no</span></pre><p id="c9c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你会得到解密后的数据。</p><p id="a23c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">享受编码。</p><p id="4a91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">感谢&amp;最诚挚的问候，<br/> Alok Rawat </strong></p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="d44a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lo">原载于</em><a class="ae ln" href="https://qiita.com/alokrawat050/items/ff6dceec32baa0c8fa57" rel="noopener ugc nofollow" target="_blank"><em class="lo">qiita.com</em></a><em class="lo">。</em></p></div></div>    
</body>
</html>