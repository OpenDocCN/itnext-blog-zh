<html>
<head>
<title>How to use Flutter with SQLite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在SQLite中使用Flutter</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-flutter-with-sqlite-b6c75a5215c4?source=collection_archive---------0-----------------------#2020-02-03">https://itnext.io/how-to-use-flutter-with-sqlite-b6c75a5215c4?source=collection_archive---------0-----------------------#2020-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6654" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用sqflite插件在Flutter中存储应用数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/214061a0ad918de09a75a8a08fdfc303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LEUh31OfZP8soDnbs-N8Mg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Flutter / SQLite</figcaption></figure><h2 id="31aa" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="86f5" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在本文中，我们将了解如何在Flutter中使用SQLite和<code class="fe mn mo mp mq b">sqflite</code>包来本地存储应用程序数据。SQLite自2000年以来一直存在，是在本地应用程序中嵌入数据库的流行选择。对于示例项目，我们将构建一个非常简单的“TODO”应用程序，它可以从一个基本界面创建、更新和删除TODO项目。</p><p id="22cc" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">如果你还没有Flutter，你可以从<a class="ae mw" href="https://flutter.dev/docs/get-started/install" rel="noopener ugc nofollow" target="_blank">安装页面</a>获得一份拷贝。本文中使用的源代码可以从GitHub 上的<a class="ae mw" href="https://github.com/kenreilly/flutter-sqlite-demo" rel="noopener ugc nofollow" target="_blank">处获得。</a></p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="7a67" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">项目配置</h2><p id="b311" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">要在Flutter应用程序中使用SQLite，第一步是将<code class="fe mn mo mp mq b">sqflite</code>包包含在项目的<strong class="lw iu"> pubspec.yaml </strong>中，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="1b04" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">这里我们指定了<code class="fe mn mo mp mq b">sqflite</code>版本<code class="fe mn mo mp mq b">1.2.0</code>或更高版本，以及<code class="fe mn mo mp mq b">path_provider</code>版本<code class="fe mn mo mp mq b">1.6.0</code>或更高版本。除此之外，项目保持精简，以便于工作和理解。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="f538" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建简单的模型</h2><p id="93e0" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了存储数据，一个简单的数据模型类将提供必要的方法，用于在SQLite友好的数据格式和可以在应用程序中使用的对象之间进行转换。首先，一个名为<strong class="lw iu"> Model </strong>的抽象类将作为数据模型的基类。这个文件在<strong class="lw iu"> lib/models/model.dart </strong>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="7c3e" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated"><strong class="lw iu"> Model </strong>类非常简单，是为了方便起见而创建的，用来定义数据模型可以预期的属性/方法，比如上面显示的<code class="fe mn mo mp mq b">id</code>。这使得能够创建一个或多个符合这个基本设计模式的特定数据模型。对于这个示例应用程序，在<strong class="lw iu">lib/models/TODO-item . dart</strong>中创建一个TODO item模型类:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6276" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated"><strong class="lw iu"> TodoItem </strong>类包含了<code class="fe mn mo mp mq b">task</code>和<code class="fe mn mo mp mq b">complete</code>的属性，并且有一个简单的构造函数来创建一个新的TODO项目。为了在数据库使用的TodoItem和Map对象的实例之间进行转换，定义了方法<code class="fe mn mo mp mq b">toMap</code>和<code class="fe mn mo mp mq b">fromMap</code>。请注意，<code class="fe mn mo mp mq b">id</code>只有在不是<code class="fe mn mo mp mq b">null</code>时才会添加到地图中。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="604c" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据库类</h2><p id="e5c5" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">为了方便和易于维护，主数据库处理方法放在<strong class="lw iu"> lib/services/db.dart </strong>中，而不是在整个应用程序中随机混合数据库逻辑:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3525" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">这个类是<code class="fe mn mo mp mq b">abstract</code>,因为它不应该被实例化，并且在内存中只需要它的一个副本。在内部，它在<code class="fe mn mo mp mq b">_db</code>属性中保存对SQLite数据库的引用。数据库版本号已经被硬编码为<code class="fe mn mo mp mq b">1</code>，但是在更复杂的应用程序中，数据库版本可以用于在版本中向上或向下迁移数据库模式，以允许推出新功能，而不必擦除数据库并从头开始。</p><p id="dcb4" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">在<code class="fe mn mo mp mq b">init</code>方法中创建SQLite数据库的一个实例，使用这个项目的<code class="fe mn mo mp mq b">example</code>数据库名。如果<code class="fe mn mo mp mq b">example</code>数据库尚不存在，则自动调用<code class="fe mn mo mp mq b">onCreate</code>。这是放置用于创建表结构的查询的地方。在本例中，我们有一个<code class="fe mn mo mp mq b">todo_items</code>表，其中有一个<code class="fe mn mo mp mq b">id</code>的主键，以及与上面的<code class="fe mn mo mp mq b">TodoItem</code>类的属性相匹配的字段。</p><p id="bfd3" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">定义<code class="fe mn mo mp mq b">query</code>方法以及<code class="fe mn mo mp mq b">insert, update, </code>和<code class="fe mn mo mp mq b">delete</code>是为了在数据库上执行标准的CRUD操作。这些提供了简单的抽象，并允许在该类中包含数据库逻辑，这在重构或对应用程序执行其他维护时非常有用，而不是例如必须在多个文件中搜索和替换字符串或修复简单更改时出现的奇怪错误。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="1d59" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">主应用文件</h2><p id="2220" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">最后但同样重要的是，我们在<strong class="lw iu"> lib/main.dart </strong>中有主应用程序逻辑和UX:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="97e6" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">这个文件对于任何Flutter应用程序来说都是相当标准的，它定义了应用程序的基本外观和感觉以及它的交互。在初始化期间，行<code class="fe mn mo mp mq b">WidgetsFlutterBinding.ensureInitialized()</code>将确保在用<code class="fe mn mo mp mq b">await DB.init().</code>初始化数据库时，Flutter应用程序正确初始化</p><p id="f794" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">当应用程序启动并且呈现出<code class="fe mn mo mp mq b">MyHomePage</code>小部件时，对<code class="fe mn mo mp mq b">refresh()</code>的调用从<code class="fe mn mo mp mq b">todo_items</code>表中拉出待办事项列表，并将其映射到<code class="fe mn mo mp mq b">TodoItem</code>对象的<code class="fe mn mo mp mq b">List</code>。这些将通过<code class="fe mn mo mp mq b">_items</code>访问器呈现在应用程序的主ListView中，该访问器接受<code class="fe mn mo mp mq b">TodoItem</code>对象的<code class="fe mn mo mp mq b">List</code>并将其格式化为一个小部件列表，该列表包含todo项目文本和一个指示项，指示项是否已完成。</p><p id="27c2" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">可以通过按下浮动操作按钮并输入任务名称来添加任务。当按下<code class="fe mn mo mp mq b">Save</code>时，新创建的待办事项列表项被添加到数据库中，其中<code class="fe mn mo mp mq b">DB.insert. </code>单击列表中的任务将通过翻转<code class="fe mn mo mp mq b">complete</code>布尔值在完成/未完成状态之间切换，并通过<code class="fe mn mo mp mq b">DB.update,</code>将修改的对象存储回数据库，水平滑动任务将通过将其提供给<code class="fe mn mo mp mq b">DB.delete</code>方法来删除待办事项项。每当列表发生变化时，调用<code class="fe mn mo mp mq b">refresh()</code>和后续的<code class="fe mn mo mp mq b">setState()</code>将确保列表被正确刷新。</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><h2 id="aca1" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h2><p id="2883" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">SQLite提供了一种在应用程序中本地保存数据的方便的行业标准方法。这个例子展示了如何实现基本的CRUD操作来创建和操作SQLite数据库中的简单记录。有关<code class="fe mn mo mp mq b">sqflite</code>插件及其支持的各种特性的更多信息，请参见<a class="ae mw" href="https://pub.dev/packages/sqflite" rel="noopener ugc nofollow" target="_blank">本资源</a>。</p><p id="e526" class="pw-post-body-paragraph lu lv it lw b lx mr ju lz ma ms jx mc lh mt me mf ll mu mh mi lp mv mk ml mm im bi translated">感谢您的阅读，祝您的下一个颤振项目好运！</p></div><div class="ab cl mx my hx mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/31940e96aab95c9432d4e6a45e354c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qgape9PCABpIaFmIl3oCcw.gif"/></div></div></figure><blockquote class="nh"><p id="d838" class="ni nj it bd nk nl nm nn no np nq mm dk translated">肯尼斯·雷利(<a class="ae mw" href="https://twitter.com/" rel="noopener ugc nofollow" target="_blank"> 8_bit_hacker </a>)是<a class="ae mw" href="https://lvl-up.dev" rel="noopener ugc nofollow" target="_blank"> LevelUP </a>的CTO</p></blockquote></div></div>    
</body>
</html>