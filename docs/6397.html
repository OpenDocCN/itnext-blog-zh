<html>
<head>
<title>Kubernetes Kustomize Cheat Sheet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes Kustomize备忘单</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-kustomize-cheat-sheet-8e2d31b74d8f?source=collection_archive---------0-----------------------#2021-11-07">https://itnext.io/kubernetes-kustomize-cheat-sheet-8e2d31b74d8f?source=collection_archive---------0-----------------------#2021-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/77ddc3d1b9009cefe279999b04996350.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*x6aPDmStciTMo_flvMlbMA.jpeg"/></div></figure><blockquote class="ju jv jw"><p id="c042" class="jx jy jz ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">kustomize是一个命令行工具，支持面向k8s风格对象的声明性配置的无模板、结构化定制。</p><p id="bfb0" class="jx jy jz ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以k8s为目标意味着kustomize对API资源、k8s概念如名称、标签、命名空间等有所了解。，以及资源修补的语义。</p><p id="47bd" class="jx jy jz ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">kustomize是DAM的一个实现。</p></blockquote><ul class=""><li id="4c0f" class="kw kx iq ka b kb kc kf kg ky kz la lb lc ld kv le lf lg lh bi translated"><a class="ae li" href="https://github.com/kubernetes-sigs/kustomize" rel="noopener ugc nofollow" target="_blank"> Github </a></li><li id="6f85" class="kw kx iq ka b kb lj kf lk ky ll la lm lc ln kv le lf lg lh bi translated"><a class="ae li" href="https://kustomize.io/" rel="noopener ugc nofollow" target="_blank"> Kustomize文档</a></li></ul><h1 id="da98" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">装置</h1><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="81e1" class="mv lp iq mr b gy mw mx l my mz">curl -s "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh"  | bash</span></pre><h1 id="811e" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">基本用法</h1><h2 id="3667" class="mv lp iq bd lq na nb dn lu nc nd dp ly ky ne nf mc la ng nh mg lc ni nj mk nk bi translated">内置于kubectl</h2><p id="4b99" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">Kustomize内置于<code class="fe nq nr ns mr b">kubectl</code>。<code class="fe nq nr ns mr b">kubectl apply -k</code>行为与<code class="fe nq nr ns mr b">kustomize build path/to/some/app | kubectl apply -f -</code>如出一辙。</p><h2 id="1b99" class="mv lp iq bd lq na nb dn lu nc nd dp ly ky ne nf mc la ng nh mg lc ni nj mk nk bi translated">创建基础</h2><p id="53af" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">从Kubernetes清单中<br/>搜索当前目录中的所有Kubernetes资源，并将它们添加到<code class="fe nq nr ns mr b">resources</code></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="a84f" class="mv lp iq mr b gy mw mx l my mz">kustomize create --autodetect</span></pre><p id="4cd3" class="pw-post-body-paragraph jx jy iq ka b kb kc kd ke kf kg kh ki ky kk kl km la ko kp kq lc ks kt ku kv ij bi translated">从刈割基础<br/>使用另一个刈割覆盖的<code class="fe nq nr ns mr b">path/to/base</code>作为新覆盖的基础</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="53b0" class="mv lp iq mr b gy mw mx l my mz">kustomize create --resources path/to/base</span></pre><p id="0963" class="pw-post-body-paragraph jx jy iq ka b kb kc kd ke kf kg kh ki ky kk kl km la ko kp kq lc ks kt ku kv ij bi translated">搜索当前目录和所有子目录</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0924" class="mv lp iq mr b gy mw mx l my mz">kustomize create --resources path/to/base --recursive</span></pre><h1 id="04b0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">构建资源</h1><h2 id="64ed" class="mv lp iq bd lq na nb dn lu nc nd dp ly ky ne nf mc la ng nh mg lc ni nj mk nk bi translated">统一资源定位器</h2><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="640b" class="mv lp iq mr b gy mw mx l my mz">kustomize build <a class="ae li" href="https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld?ref=v1.0.6" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld?ref=v1.0.6</a></span></pre><h1 id="958c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">改性碱</h1><h2 id="3bf1" class="mv lp iq bd lq na nb dn lu nc nd dp ly ky ne nf mc la ng nh mg lc ni nj mk nk bi translated">标签和注释</h2><p id="3a6c" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">从远程资源创建新的kustomization.yaml，添加到所有资源标签<code class="fe nq nr ns mr b">app=hello-world</code>和<code class="fe nq nr ns mr b">cloud=gcp</code></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="55c9" class="mv lp iq mr b gy mw mx l my mz">$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6 --labels app:hello-world,cloud:gcp<br/>$ kustomize build .</span></pre><h1 id="d949" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">命名空间</h1><p id="994c" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">从远程资源创建新的kustomization.yaml，向其所有资源添加<code class="fe nq nr ns mr b">namespace</code>属性</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0a60" class="mv lp iq mr b gy mw mx l my mz">kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6 --namespace dev<br/>kustomize build .</span></pre><h1 id="d822" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">资源名称</h1><p id="ad90" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">更新所有资源的名称前缀</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0101" class="mv lp iq mr b gy mw mx l my mz">$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit set nameprefix temp<br/>$ kustomize build .</span></pre><h1 id="61a1" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">形象</h1><p id="dabc" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">将图像<code class="fe nq nr ns mr b">monopole/hello:1</code>更新为<code class="fe nq nr ns mr b">monopole/hello:latest</code></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="c685" class="mv lp iq mr b gy mw mx l my mz">$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit set image monopole/hello:1=monopole/hello:latest<br/>$ kustomize build .</span></pre><h1 id="c589" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">配置图和机密</h1><p id="c2a5" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">从变量生成配置映射清单</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="4327" class="mv lp iq mr b gy mw mx l my mz">$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit add configmap hello-world --behavior create --from-literal=host=google.com<br/>$ kustomize build .</span></pre><h1 id="ce6b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">JSON补丁</h1><p id="22b4" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">更新副本的数量</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="27db" class="mv lp iq mr b gy mw mx l my mz">$ cat &lt;&lt;EOF &gt; patch.yaml<br/>- op: replace<br/>  path: /spec/replicas<br/>  value: 1<br/>EOF<br/>$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit add patch --kind Deployment --path patch.yaml<br/>$ kustomize build .</span></pre><h1 id="0a07" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">战略合并</h1><p id="2fb9" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">添加<code class="fe nq nr ns mr b">emptyDir</code>音量</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="d0c2" class="mv lp iq mr b gy mw mx l my mz">$ cat &lt;&lt;EOF &gt; patch.yaml<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: the-deployment<br/>spec:<br/>  template:<br/>    spec:<br/>      containers:<br/>      - name: the-container<br/>        volumeMounts:<br/>        - name: emptyDir<br/>          mountPath: /appdata <br/>    volumes:<br/>    - name: emptyDir<br/>      emptyDir: {}<br/>EOF<br/>$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit add patch --kind Deployment --path patch.yaml<br/>$ kustomize build .</span></pre><h1 id="5e46" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">移除资源</h1><p id="11dc" class="pw-post-body-paragraph jx jy iq ka b kb nl kd ke kf nm kh ki ky nn kl km la no kp kq lc np kt ku kv ij bi translated">从最终清单集中完全省略资源</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="9cec" class="mv lp iq mr b gy mw mx l my mz">$ cat &lt;&lt;EOF &gt; patch.yaml<br/>\$patch: delete<br/>apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: the-map<br/>EOF<br/>$ kustomize create --resources https://github.com/kubernetes-sigs/kustomize.git/examples/helloWorld\?ref\=v1.0.6<br/>$ kustomize edit add patch --kind ConfigMap --path patch.yaml<br/>$ kustomize build .</span></pre></div></div>    
</body>
</html>