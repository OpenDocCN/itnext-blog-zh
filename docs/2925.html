<html>
<head>
<title>Universal Rendering in Laravel using Vue.js and Ara Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue.js和Ara框架在Laravel中进行通用渲染</h1>
<blockquote>原文：<a href="https://itnext.io/universal-rendering-in-laravel-using-vue-js-and-ara-framework-7b6bc23644b1?source=collection_archive---------4-----------------------#2019-08-30">https://itnext.io/universal-rendering-in-laravel-using-vue-js-and-ara-framework-7b6bc23644b1?source=collection_archive---------4-----------------------#2019-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/992d2e079b9f0a9371c6fce2fd31ecb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GxebaBoEfLCgmfze.png"/></div></div></figure><p id="09dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文原载于<a class="ae kw" href="https://ara-framework.github.io/website/blog/2019/08/28/universal-rendering-in-laravel" rel="noopener ugc nofollow" target="_blank"> Ara博客</a>。</p><p id="bcd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通用渲染包括在服务器上渲染页面，并使用React、Vue.js、Angular等库构建的相同视图组件在浏览器上进行交互。</p><p id="585b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如今，<a class="ae kw" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>、<a class="ae kw" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt.js </a>和<a class="ae kw" href="https://github.com/angular/universal" rel="noopener ugc nofollow" target="_blank"> NgUniversal </a>等JavaScript框架让这项工作变得更加容易。但是，如何在Laravel这样的非JavaScript框架上实现呢？</p><h1 id="58ac" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置Laravel</h1><p id="93b9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">使用Composer下载Laravel安装程序。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="32e6" class="mj ky iq mf b gy mk ml l mm mn">composer global require laravel/installer</span></pre><p id="ce12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个名为<code class="fe mo mp mq mf b">ara-laravel</code>的文件夹，并在该文件夹中运行以下命令来创建一个Laravel项目。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0cd1" class="mj ky iq mf b gy mk ml l mm mn">composer create-project --prefer-dist laravel/laravel laravel-site</span></pre><p id="48f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">项目创建完成后，运行<a class="ae kw" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>上的Laravel应用程序。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="bdc6" class="mj ky iq mf b gy mk ml l mm mn">php artisan serve</span></pre><p id="3c43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">浏览器:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/a5b55d71bf2086b6a6745cce97cd3a36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CPt7YzNVJ6jx1A9q.png"/></div></div></figure><h1 id="ca82" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置Nova服务</h1><p id="588c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将使用Vue.js创建一个Nova服务。</p><p id="6b8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装<a class="ae kw" href="https://github.com/ara-framework/ara-cli" rel="noopener ugc nofollow" target="_blank"> Ara CLI </a>:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0988" class="mj ky iq mf b gy mk ml l mm mn">npm i -g ara-cli</span></pre><p id="435e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建Nova服务:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6cda" class="mj ky iq mf b gy mk ml l mm mn">ara new:nova -t vue nova</span></pre><p id="a5d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到Nova服务文件夹:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5f5e" class="mj ky iq mf b gy mk ml l mm mn">cd nova</span></pre><p id="6d9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行Nova服务:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="90e4" class="mj ky iq mf b gy mk ml l mm mn">yarn dev</span></pre><p id="f3ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nova服务运行在<a class="ae kw" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>上。</p><h1 id="bd85" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试Nova服务。</h1><p id="895a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Nova服务运行后，您可以使用以下有效负载向<a class="ae kw" href="http://localhost:3000/batch" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/batch</a>发出<code class="fe mo mp mq mf b">POST</code>请求:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="a005" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "uuid": {<br/>    "name": "Example",<br/>    "data": {<br/>      "title": "Ara Framework"<br/>    }<br/>  }<br/>}</span></pre><p id="438f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">响应中的<code class="fe mo mp mq mf b">results</code>属性包含由Nova服务呈现的视图的<code class="fe mo mp mq mf b">html</code>。</p><p id="be17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">示例:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="9550" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "success": <strong class="mf ir">true</strong>,<br/>  "error": <strong class="mf ir">null</strong>,<br/>  "results": {<br/>    "uuid": {<br/>      "name": "Example",<br/>      "html": "&lt;div data-hypernova-key=\"Example\" data-hypernova-id=\"4d9e81bd-6413-4661-ab56-ed5bb4f59cae\"&gt;&lt;h1 data-server-rendered=\"true\"&gt;Ara Framework&lt;/h1&gt;&lt;/div&gt;\n&lt;script type=\"application/json\" data-hypernova-key=\"Example\" data-hypernova-id=\"4d9e81bd-6413-4661-ab56-ed5bb4f59cae\"&gt;&lt;!--{\"title\":\"Ara Framework\"}--&gt;&lt;/script&gt;",<br/>      "meta": {},<br/>      "duration": 1.210146,<br/>      "statusCode": 200,<br/>      "success": <strong class="mf ir">true</strong>,<br/>      "error": <strong class="mf ir">null</strong><br/>    }<br/>  }<br/>}</span></pre><h1 id="b4f8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在Laravel Blade中设置Nova指令</h1><p id="8364" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在<code class="fe mo mp mq mf b">laravel-site</code>文件夹中使用Composer为Laravel Blade安装Nova指令。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="47c6" class="mj ky iq mf b gy mk ml l mm mn">composer require marconi1992/hypernova-blade-directive</span></pre><p id="27cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在应用配置<code class="fe mo mp mq mf b">config/app.php</code>中添加<code class="fe mo mp mq mf b">NovaServiceProvider</code></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="8155" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在Laravel视图中使用Nova指令</h1><p id="5e7c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在欢迎页面上添加<code class="fe mo mp mq mf b">Example</code>视图。</p><p id="f082" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mo mp mq mf b">resources/views/welcome.blade.php</code></p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="dba1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">服务器端渲染</h1><p id="b38c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Nova视图还没有渲染，我们需要实现<a class="ae kw" href="https://github.com/ara-framework/nova-proxy" rel="noopener ugc nofollow" target="_blank"> Nova代理</a>以便服务器端渲染并包含Nova视图。</p><p id="fa13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Nova Direvitve呈现包含必要信息的占位符，以使Nova代理能够与Nova服务通信并包括Nova视图。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="7413" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Nova代理</h1><p id="f534" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Nova proxy是一个在任何web平台(Laravel、Flask等)上实现任意视图库(React、Vue.js等)通用渲染的服务。例如，在这个演示中，我们将使用Vue.js在一个用Laravel构建的web应用程序中呈现一个视图。</p><p id="1847" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">工作原理:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="ab gu cl mu"><img src="../Images/4be1759d5853a2d3a4c4c2b7bfac92d7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*0_KCs-IFVCIN8J5RwP7uFg.png"/></div></figure><ol class=""><li id="ac96" class="mv mw iq ka b kb kc kf kg kj mx kn my kr mz kv na nb nc nd bi translated">用户向Nova代理请求一个页面。</li><li id="3781" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">Nova代理将请求传递给网站服务器。</li><li id="da5c" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">网站使用Nova指令来呈现应该包含Nova视图的占位符。</li><li id="5eb9" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">网站将生成的HTML发送回Nova代理。</li><li id="8643" class="mv mw iq ka b kb ne kf nf kj ng kn nh kr ni kv na nb nc nd bi translated">Nova代理包括占位符上的Nova视图，并将HTML发送回浏览器。</li></ol><p id="1b81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在浏览器上，JavaScript用于逐步增强应用程序并使其具有交互性。阅读更多关于Nova架构的<a class="ae kw" href="https://ara-framework.github.io/website/docs/nova-architecture" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="b33c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置Nova代理</h1><p id="9ce9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在根文件夹中创建Nova代理的配置文件:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="2606" class="mj ky iq mf b gy mk ml l mm mn">touch nova-proxy.json</span></pre><p id="19fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mo mp mq mf b">nova-proxy.json</code>文件中添加以下配置，将传入请求代理到Laravel web服务器。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="969f" class="mj ky iq mf b gy mk ml l mm mn">{<br/>  "locations": [<br/>    {<br/>      "path": "/",<br/>      "host": "http://localhost:8000",<br/>      "modifyResponse": <strong class="mf ir">true</strong><br/>    }<br/>  ]<br/>}</span></pre><h1 id="2b33" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">运行Nova代理</h1><p id="4e1a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在运行命令之前，我们需要使用Nova服务端点设置<code class="fe mo mp mq mf b">HYPERNOVA_BATCH</code>变量。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8e52" class="mj ky iq mf b gy mk ml l mm mn">export HYPERNOVA_BATCH=http://localhost:3000/batch</span></pre><p id="ee96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要在创建了<code class="fe mo mp mq mf b">noxa-proxy.json</code>文件的地方运行下面的命令，或者传递带有配置文件路径的<code class="fe mo mp mq mf b">--config</code>参数。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c205" class="mj ky iq mf b gy mk ml l mm mn">ara run:proxy --config ./nova-proxy.json</span></pre><p id="f17b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令在<a class="ae kw" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>上运行Nova代理。</p><p id="cf86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，看看Nova视图是如何显示的，这是因为Nova Proxy在来自Laravel应用程序的页面中包含了Nova视图。</p><p id="d9c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">浏览器:</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/7f212e96011dc4b3b8357283a9791368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5W51C2eN6EeG8Xa5.png"/></div></div></figure><h1 id="3ab2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">客户端渲染</h1><p id="8c8c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated"><code class="fe mo mp mq mf b">Example</code>视图只呈现了一个简单的标题。我们可以通过添加一个改变标题文本的输入元素来使它具有交互性。</p><p id="5e3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用以下代码替换<code class="fe mo mp mq mf b">nova/src/components/Example.vue</code>:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d51f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，Nova视图显示了一个input元素，但是当我们键入一些内容时，标题文本不会改变。这是因为我们需要添加客户端脚本。</p><h1 id="366f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">浏览器上的水合物Nova视图</h1><p id="9e04" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">水合是使用在服务器上呈现视图组件时使用的状态在浏览器上安装视图组件的过程。</p><p id="bcb9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了丰富视图，我们需要在浏览器上加载<code class="fe mo mp mq mf b">client.js</code>脚本。</p><p id="a1f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新Laravel应用程序中的<code class="fe mo mp mq mf b">welcome.blade.php</code>文件:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/85aa96b6a111e0634cbdd0e3b9ed15b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p2Xv8e6cR-R3PqkF.gif"/></div></div></figure><h1 id="5742" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="c1d3" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Nova代理使我们能够在任何web框架上使用现代视图库。因此，如果您之前使用非JavaScript框架(Laravel、Flask、Ruby on Rails等)开发了一个web应用程序，那么Nova Proxy可以帮助您在短时间内逐步将其视图迁移到Javascript视图库(React、Vue.js)。</p></div></div>    
</body>
</html>