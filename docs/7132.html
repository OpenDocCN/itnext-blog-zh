<html>
<head>
<title>OCI User Access Review Made Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OCI用户访问检查变得简单</h1>
<blockquote>原文：<a href="https://itnext.io/oci-user-access-review-made-easy-5393c9a7abfa?source=collection_archive---------5-----------------------#2022-06-20">https://itnext.io/oci-user-access-review-made-easy-5393c9a7abfa?source=collection_archive---------5-----------------------#2022-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1d4363e73325a6c7772536abe6d36cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SPLvWaoDHijxmh88"/></div></div></figure><p id="50f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我相信我们都同意，采用云战略是很棒的。它提供了许多机会和好处。然而，云治理是一个困扰安全性、合规性和管理团队的持续问题，Oracle等云供应商一直在努力解决这一问题。</p><p id="4e82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在读这篇文章，你可能已经被问过或听过至少一次:</p><blockquote class="kw kx ky"><p id="3947" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated">在我们的环境中，谁可以访问什么？</p><p id="8206" class="jy jz kz ka b kb kc kd ke kf kg kh ki la kk kl km lb ko kp kq lc ks kt ku kv ij bi translated"><em class="iq"> -任何安全/合规经理</em></p></blockquote><p id="ef69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">答案应该简单明了。然而，现实可能是大量的手动时间和工作、电子表格，以及在云控制台上无休止的点击。如果你是手动操作，那么我同意，是时候你可以专注于更重要的任务了。</p><p id="6047" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">试图回答这些问题的挑战:</strong></p><ul class=""><li id="8422" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated"><em class="kz">存在哪些用户，他们属于哪些群体？</em></li><li id="0c67" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><em class="kz">我的OCI租赁隔间结构是什么样的？</em></li><li id="6bd8" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><em class="kz">用户明确创建了哪些策略？</em></li><li id="daa8" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><em class="kz">用户在我的租赁中有哪些权限？</em></li><li id="3b7d" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated"><em class="kz">我的租赁中是否有任何过度/不符合政策的&amp;权限？</em></li></ul><p id="60d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些复杂的关系不容易用类似表格的格式来表示和解释。在OCI生态系统中:</p><ul class=""><li id="4c43" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">用户可以与身份提供者联合，并且可以属于一个或多个联合或本地IAM组，</li><li id="212c" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">可以为“任何用户”或一个组定义策略，</li><li id="b699" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">策略是继承的，这意味着它们适用于应用策略的所有子隔离专区。</li></ul><p id="6353" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简化工作，我使用Oracle工具和服务创建了一个名为“Peek”的解决方案来简化OCI租约和用户权限的审计。</p><p id="8086" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:如果您拥有IAM域名而非IDCS的OCI租约，请使用这些说明<a class="ae lr" href="https://medium.com/@scotti.fletcher.1/oci-iam-domains-user-access-review-385a580f7ba0" rel="noopener">https://medium . com/@ scotti . Fletcher . 1/OCI-IAM-Domains-user-access-review-385 a580 F7 ba 0</a>而不是下面的说明。</p><p id="2796" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Peek由一个带有MySQL的Docker容器、OCI CLI和一个Ruby脚本组成，并使用Oracle APEX实例来查看数据和可视化这些复杂的关系。下面是一段演示和解释Peek的视频短片:</p><figure class="ls lt lu lv gt jr"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="d58a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行Peek yourself非常简单，只需20分钟即可完成设置。但是，在我们开始之前，您需要满足几个先决条件:</p><ul class=""><li id="cd35" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">运行Peek容器的<a class="ae lr" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>环境，</li><li id="0770" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">对一个<a class="ae lr" href="https://apex.oracle.com/en/" rel="noopener ugc nofollow" target="_blank"> Oracle APEX </a>实例的运行和管理访问权限，</li><li id="eab7" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">一个<a class="ae lr" href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliconfigure.htm" rel="noopener ugc nofollow" target="_blank"> OCI-CLI配置文件</a>，以及一个有效的OCI API密钥，供您的租户中具有<a class="ae lr" href="https://docs.oracle.com/en-us/iaas/Content/Identity/Concepts/policies.htm" rel="noopener ugc nofollow" target="_blank">读取权限的用户使用</a>，</li><li id="07c2" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">以及可选的<a class="ae lr" href="https://www.oracle.com/au/security/cloud-security/identity-cloud/" rel="noopener ugc nofollow" target="_blank"> Oracle身份云服务/ IAM身份域实例</a>。</li></ul><h2 id="76a3" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">将Peek安装到Oracle APEX中</strong></h2><p id="09b5" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">首先，我们将Peek应用程序安装并配置到您的APEX实例中。如果您没有现有的APEX实例，您可以通过OCI控制台创建一个。</p><ol class=""><li id="4b95" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv mw lj lk ll bi translated">使用默认设置创建APEX实例，例如数据库版本19c、1 OCPU、1TB存储或您希望使用的设置。</li><li id="2e3c" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">使用您在创建过程中指定的管理员用户密码登录APEX实例。</li><li id="e65e" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击“创建工作区”，输入<br/>数据库用户:PEEK <br/>密码:&lt;强密码&gt; <br/>工作区名称:PEEK</li><li id="fde4" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击“登录查看”，它显示在页面顶部的绿色警告框中。</li><li id="557d" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">输入您在步骤3中创建的用户凭据。</li><li id="20be" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从Github下载Peek应用程序ZIP文件<a class="ae lr" href="https://github.com/scotti-fletcher/peek-apex/blob/main/peek-apex-1.0.zip" rel="noopener ugc nofollow" target="_blank">https://Github . com/scotti-Fletcher/Peek-apex/blob/main/Peek-apex-1.0 . ZIP</a></li><li id="6da6" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从App Builder下拉菜单中选择“导入”。</li><li id="2657" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">选择下载的文件，确保选择了文件类型“数据库应用程序、页面或组件导出”，然后单击下一步。</li><li id="bc27" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">将显示文件导入确认，单击下一步。</li><li id="0486" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">将显示安装数据库应用程序，您可以接受所有默认值。单击“安装应用程序”。</li><li id="da5a" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">将显示安装应用程序确认，单击下一步。</li><li id="c34b" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击安装。</li><li id="9a1f" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击“编辑应用程序”。</li><li id="7c30" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从SQL Workshop下拉菜单中选择“SQL脚本”。</li><li id="7e4c" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从Github下载Peek应用程序数据库脚本<a class="ae lr" href="https://github.com/scotti-fletcher/peek-apex/blob/main/peek-apex-db.sql" rel="noopener ugc nofollow" target="_blank">https://Github . com/scotti-Fletcher/Peek-apex/blob/main/Peek-apex-db . SQL</a></li><li id="e269" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">编辑SQL文件，并将p_email_address和p_web_password的值更新为您想要使用的值。强烈建议您选择一个新的、唯一的、强密码。</li><li id="66bb" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击上传，选择您在第15步下载并在第16步编辑的文件，在脚本名称中输入“Install ”,点击上传。</li><li id="a806" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">在上传的脚本上单击运行按钮。</li><li id="c901" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击“立即运行”。</li><li id="e876" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击右上角菜单中的“管理用户和组”。</li><li id="0974" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击API用户。</li><li id="40fd" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击“分组分配”</li><li id="1205" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从左侧列表框中选择所有“oracle.dbtools.role.autorest.*”组，并将其添加到右侧列表框中。</li><li id="e9d7" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击“应用更改”</li><li id="f1be" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">要确认您的APEX ORDS RESTful服务配置正确，您可以运行:<br/> <code class="fe mx my mz na b">curl -i -k --user API:&lt;password from Step 16&gt; https://&lt;your apex hostname&gt;/ords/peek/grant/</code> <br/>，您应该会收到一个带有JSON主体的HTTP 200响应。</li></ol><h2 id="7efd" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">如果您有Oracle身份域云服务</strong></h2><p id="3568" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">这部分是可选的。但是，如果您使用IDCS来映射和可视化IDCS / IAM组关系，我们必须配置IDCS，以允许我们的Docker容器从IDCS API检索信息。</p><p id="b6cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kz">注意:Oracle身份云服务正在成为OCI IAM身份域。在不久的将来，我将更新该指南，以包括特定于身份域的说明。</em></p><ol class=""><li id="5ac3" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv mw lj lk ll bi translated">登录您的Oracle身份云服务控制台。</li><li id="c009" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">从左侧菜单中选择应用程序。</li><li id="f45d" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击“添加”，选择“机密应用”创建一个新的应用。</li><li id="8b68" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">将应用程序命名为“Peek”，可以选择提供描述，然后单击“下一步”。</li><li id="25a8" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">选择“立即将此应用程序配置为客户端”并选中“资源所有者”复选框。</li><li id="2575" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">向下滚动至“授予客户端对Identity Cloud Service管理API的访问权限”,然后单击添加。</li><li id="1184" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">选择“审计管理员”并单击添加。</li><li id="a1bf" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">向上滚动并单击下一步。</li><li id="5aa3" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">在“向其他应用程序公开API”页面上，选择“以后跳过”，然后单击“下一步”。</li><li id="379d" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">在“Web层策略”页面上，选择“以后跳过”，然后单击“下一步”。</li><li id="7017" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">单击“完成”,将显示您的客户端ID和客户端密码。将这些记录在文本文件中以备后用，然后单击关闭。</li><li id="4b10" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv mw lj lk ll bi translated">点击“激活”。这一点很重要，否则您的API调用将会失败。</li></ol><h2 id="0e6c" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">收集所需的输入值</strong></h2><p id="fd06" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">在运行docker容器之前，我们首先需要收集Docker容器中运行的Ruby脚本所需的一些附加细节，具体来说:</p><ul class=""><li id="6e44" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">你在OCI的租约OCID。</li><li id="45f4" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">OCI IAM网址。</li><li id="1008" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">APEX实例的URL。</li><li id="1ff1" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">您为APEX API用户创建的凭证。</li><li id="a591" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">您的本地目录的完整路径，您的OCI配置和。pem密钥存在。</li></ul><p id="6662" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有一个IDCS实例:</p><ul class=""><li id="945d" class="ld le iq ka b kb kc kf kg kj lf kn lg kr lh kv li lj lk ll bi translated">先前创建的IDCS客户端ID。</li><li id="338a" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">先前创造的IDCS秘密。</li><li id="7bb2" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">您的IDCS实例的URL。</li><li id="6ff3" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">IDP集成的OCID。</li></ul><p id="1c2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是如何获得这些值的说明。我建议在文本文件中记下它们的值，因为我们将把这些值作为环境变量传递给Docker容器。</p><h2 id="775c" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">寻找您的OCI租赁OCID </strong></h2><p id="f1cb" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">在OCI控制台中，导航到“身份和安全”并单击隔离专区。您的租赁OCID应该是第一行，悬停在OCID，然后单击复制</p><p id="83fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在文本编辑器中添加一行:</p><p id="5433" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">OCI_TENANCY_OCID = &lt;value from clipboard&gt;</code></p><h2 id="ea35" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">查找您的IAM网址</strong></h2><p id="0320" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">您的IAM网址将是<code class="fe mx my mz na b">https://identity.&lt;oci-region&gt;.oraclecloud.com</code>。您需要将“&lt; oci-region &gt;”替换为您订阅的地区之一。举个例子，我的URL看起来像<code class="fe mx my mz na b"><a class="ae lr" href="https://identity.ap-sydney-1.oraclecloud.com" rel="noopener ugc nofollow" target="_blank">https://identity.ap-sydney-1.oraclecloud.com</a></code></p><p id="c86f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">替换后，将该行添加到您的文本编辑器中:</p><p id="f248" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">OCI_IAM_URL = https://identity.&lt;oci-region&gt;.oraclecloud.com</code></p><h2 id="b7bb" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">查找您的APEX网址</strong></h2><p id="7d8f" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">从OCI控制台单击“启动Apex ”,并从您的web浏览器地址栏复制主机名。例如，URL看起来像<code class="fe mx my mz na b">https://yj6g7sq14zvoj-peek.adb.ap-sydney-1.oraclecloudapps.com</code>。请注意，结尾不应该有尾随的正斜杠。</p><p id="f13b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将这一行添加到文本文件中:</p><p id="3391" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">APEX_URL = &lt;Your APEX URL&gt;</code></p><h2 id="7f48" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">找到你的OCI配置目录</strong></h2><p id="f74e" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">OCI CLI配置通常位于~/中。oci/。配置文件必须包含Docker容器将使用的默认配置文件。~/。oci/ directory还必须包含。pem键。如果您的~/中有多个配置文件。oci/config文件，您可能希望创建一个单独的目录，只包含config和。pem键仅用于此活动。举个例子我的~/。oci/目录看起来像:</p><p id="e58d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">scott@scott-mac ~ % ls -alh /Users/scott/.oci <br/>drwxr-xr-x 6 scott staff 192B 15 Jun 14:59 .<br/>drwxr-x---+ 58 scott staff 1.8K 20 Jun 11:55 ..<br/>-rw-------@ 1 scott staff 1.7K 7 Apr 15:12 mykey.pem<br/>-rw-------@ 1 scott staff 610B 15 Jun 14:59 config</code></p><p id="1e8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我使用的是目录的完整路径，在将这个目录挂载到Docker容器时，我将使用这个完整路径。</p><p id="c004" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您没有配置联盟，您可以跳到<a class="ae lr" href="https://redthunder.blog/2022/06/20/oci-user-access-review-made-easy/#runningpeek" rel="noopener ugc nofollow" target="_blank">运行Peek Docker容器</a></p><h2 id="dbae" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">查找您的IDCS网址</strong></h2><p id="5fd5" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">在OCI控制台中，导航到“Identity &amp; Security ”,然后单击“Federation ”,单击您的联合提供商，例如，我的联合提供商名为OracleIdentityCloudService。</p><p id="dd20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从显示的“Oracle Identity Cloud Service Console”URL中复制主机名(不含路径)。例如，它看起来像<code class="fe mx my mz na b"><a class="ae lr" href="https://idcs-5dfhhd61c419aad5d31c8.identity.oraclecloud.com" rel="noopener ugc nofollow" target="_blank">https://idcs-5dfhhd61c419aad5d31c8.identity.oraclecloud.com</a></code></p><p id="281c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将此行添加到您的文本编辑器中:</p><p id="590c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">IDCS_URL = &lt;Your IDCS URL&gt;</code></p><h2 id="9c9f" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">查找您的IDP ID </strong></h2><p id="7b03" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">要获取您的IDP ID，请运行OCI命令行界面命令:</p><p id="753e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">oci iam identity-provider list --protocol SAML2 --compartment-id &lt;your tenancy OCID&gt;</code></p><p id="18ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将返回一个JSON响应，因为它是一个“id”字段。例如，它看起来像<code class="fe mx my mz na b">ocid1.saml2idp.oc1..aaaaaaaaosb62razrasjddsjdsjjsdsbto655kdfvow5ipfb4i7yina</code></p><p id="3814" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将这一行添加到文本文件中:</p><p id="7959" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">IDP_ID = &lt;your IDP OCID&gt;</code></p><p id="ef28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，将这些值添加到文本文件中:</p><p id="88b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">IDCS_CLIENT_ID = &lt;Client ID from Step 11&gt;<br/>IDCS_SECRET = &lt;Secret from Step 11&gt;</code></p><h1 id="0aad" class="nb lz iq bd ma nc nd ne md nf ng nh mg ni nj nk mj nl nm nn mm no np nq mp nr bi translated"><strong class="ak">运行Peek Docker容器</strong></h1><p id="d460" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">在我们运行Docker容器之前，您需要确保您的文本文件中有所有正确的值。它应该包含以下值:</p><p id="9912" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">APEX_USERNAME=API<br/>APEX_PASSWORD=&lt;Password from Step 16&gt;<br/>OCI_TENANCY_OCID=&lt;Your Tenancy OCID&gt;<br/>OCI_IAM_URL=&lt;Your IAM URL&gt;<br/>APEX_URL=&lt;Your APEX Hostname&gt;<br/>#If you're using IDCS<br/>IDCS_CLIENT_ID=&lt;Client ID from Step 11&gt;<br/>IDCS_SECRET=&lt;Secret from Step 11&gt;<br/>IDCS_URL=&lt;Your IDCS Hostname&gt;<br/>IDP_ID=&lt;Your IDP OCID&gt;</code></p><p id="d1ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行以下命令提取Docker容器</p><p id="a7bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">docker pull scottfletcher/oci-peek:latest</code></p><p id="be92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用以下命令从映像启动Peek Docker容器:</p><p id="34d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">docker run -it --name peek \<br/>--mount type=bind,source=/Full/Path/To/.oci/,target=/root/.oci/,readonly \<br/>-e OCI_TENANCY_OCID=&lt;from text file&gt; \<br/>-e OCI_IAM_URL=&lt;from text file&gt; \<br/>-e APEX_URL=&lt;from text file&gt; \<br/>-e APEX_USERNAME=API \<br/>-e APEX_PASSWORD=&lt;from text file&gt; \<br/>-e IDCS_URL=&lt;from text file&gt; \<br/>-e IDP_ID=&lt;from text file&gt; \<br/>-e IDCS_CLIENT_ID=&lt;from text file&gt; \<br/>-e IDCS_SECRET=&lt;from text file&gt; \<br/>scottfletcher/oci-peek</code></p><p id="d3ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:您需要将/Full/Path/替换为/。oci/ value到您的本地目录，如前面所解释的。还要确保您的键名、等号和值之间没有空格，如图所示。</p><p id="e6af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Docker容器将启动，信息将填充到APEX实例中。填充用户和组大约需要5-10分钟，之后您将能够在APEX应用程序中看到这些结果:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/902ad33c23fe443b21f4059364c817d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fOiS4YGt8cLinzQf"/></div></div></figure><p id="1f33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据租户中用户、组、隔离专区和策略的数量，整个过程可能需要一个小时左右才能完成。</p><p id="3389" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">映射用户和组、隔离舱和策略后，可视化树将开始填充。随着每个用户权限树的创建，它将通过API被推送到APEX，您可以开始您的用户访问检查。</p><p id="d405" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当这个过程完成后，容器中的Ruby脚本将会终止，您可以在终端的Docker输出中看到这一点。然后，您可以停止Docker容器。</p><p id="d796" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要重新运行该流程，只需启动另一个docker容器。存储在APEX数据库中的所有先前结果将被删除，新结果将被填充。</p><p id="1d81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于如何在Peek中查看和解释数据的更多信息，我建议观看本文开头的视频。</p><h2 id="03ea" class="ly lz iq bd ma mb mc dn md me mf dp mg kj mh mi mj kn mk ml mm kr mn mo mp mq bi translated"><strong class="ak">一些最终意见</strong></h2><ul class=""><li id="b671" class="ld le iq ka b kb mr kf ms kj nt kn nu kr nv kv li lj lk ll bi translated">如本文所述，使用随机生成的强密码。还要注意凭证存储在哪里，以及谁可以访问它们。</li><li id="17e1" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">作为一名安全从业者，我总是建议在运行代码之前检查它。脚本代码位于Docker容器的/peek中</li><li id="0146" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">如果你有任何问题，想要一些解释结果的帮助，请随时与我在scott.fletcher@oracle.com联系。</li><li id="f8c5" class="ld le iq ka b kb lm kf ln kj lo kn lp kr lq kv li lj lk ll bi translated">最后，我将在下一个版本中更新该解决方案，以便与IAM身份域一起使用。如果你想在那之前使用Peek，请在评论中告诉我。</li></ul><p id="efb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这篇文章对你有所帮助，也希望它是帮助你进行OCI用户访问审查的有用工具。</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/9a56cc531476b2412596221c40a2bb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:84/0*Ss-b3M852LIaULB1"/></div></figure></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="492a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kz">原载于2022年6月20日</em><a class="ae lr" href="https://redthunder.blog/2022/06/20/oci-user-access-review-made-easy/" rel="noopener ugc nofollow" target="_blank"><em class="kz">http://red thunder . blog</em></a><em class="kz">。</em></p></div></div>    
</body>
</html>