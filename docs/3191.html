<html>
<head>
<title>Create a Vue.js component library (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Vue.js组件库(第2部分)</h1>
<blockquote>原文：<a href="https://itnext.io/create-a-vue-js-component-library-part-2-c92a42af84e9?source=collection_archive---------3-----------------------#2019-10-21">https://itnext.io/create-a-vue-js-component-library-part-2-c92a42af84e9?source=collection_archive---------3-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9224" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您遵循了本教程的第<a class="ae ko" href="https://medium.com/@olivierpicault/create-a-vue-js-component-library-as-a-module-part-1-a1116e632751" rel="noopener">部分</a>，您现在应该已经:</p><ul class=""><li id="7f95" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">带有一个<code class="fe ky kz la lb b">DummyButton.vue</code>组件的基本库</li><li id="0724" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">导入和使用此组件的应用程序</li></ul><p id="2e16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如在第一部分的结尾所说，我有依赖于Vuex商店的组件。我因此有几个问题:</p><ul class=""><li id="e34f" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">如何导出一个Vuex店铺？</li><li id="0687" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">如果我的库有一个名为<code class="fe ky kz la lb b">A</code>的变量，而应用程序也有一个，会发生什么？</li></ul><h1 id="26ac" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">图书馆</h1><p id="a95e" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">你需要知道的一件事是:一个Vue.js应用程序只能有一个Vuex商店实例，并且这个商店将位于应用程序中。因此，您在此应用程序中导入的任何库都不应该有。</p><h2 id="9494" class="mk li it bd lj ml mm dn ln mn mo dp lr kb mp mq lv kf mr ms lz kj mt mu md mv bi translated">但是如果我的库需要Vuex存储怎么办？</h2><p id="d40f" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">这仍然是可行的。诀窍是不导入Vuex，只创建商店的结构。</p><p id="bcd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，让我们创建一个基本的存储结构来存储我们的<code class="fe ky kz la lb b">DummyButton</code>组件被点击了多少次。</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="0d7c" class="mk li it lb b gy ne nf l ng nh">const store = {<br/>  state: {<br/>    counter: 0<br/>  },<br/>  getters: {<br/>    counter: <em class="ni">state</em> =&gt; state.counter<br/>  },<br/>  mutations: {<br/>    increment (<em class="ni">state</em>) {<br/>      state.counter += 1<br/>    }<br/>  }<br/>}</span><span id="0b81" class="mk li it lb b gy nj nf l ng nh">export default store</span></pre><p id="8476" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们更新我们的<code class="fe ky kz la lb b">DummyButton</code>组件</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="06dd" class="mk li it lb b gy ne nf l ng nh">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;button @click="increment"&gt;{{ text }}&lt;/button&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="7a71" class="mk li it lb b gy nj nf l ng nh">&lt;script&gt;<br/>export default {<br/>  computed: {<br/>    times () {<br/>      return this.$store.getters.counter &gt; 1<br/>        ? 'times'<br/>        : 'time'<br/>    },<br/>    text () {<br/>      return `I have been clicked ${this.$store.getters.counter} ${this.times}`<br/>    }<br/>  },<br/>  methods: {<br/>    increment () {<br/>      this.$store.commit('increment')<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="d17f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码没有太大变化。我们移除了<code class="fe ky kz la lb b">data</code>部分并更新了<code class="fe ky kz la lb b">increment</code>方法，这样它就不会更新<code class="fe ky kz la lb b">data</code>中的变量，而是调用一个存储方法。对于<code class="fe ky kz la lb b">text</code>计算属性也是如此。</p><h2 id="26e0" class="mk li it bd lj ml mm dn ln mn mo dp lr kb mp mq lv kf mr ms lz kj mt mu md mv bi translated">作为插件的组件</h2><p id="5c90" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">还记得我们的<code class="fe ky kz la lb b">main.js</code>文件有多简单吗？我们现在需要稍微更新一下。下面是它最终的样子:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="899d" class="mk li it lb b gy ne nf l ng nh">import DummyButton from './components/DummyButton.vue'<br/>import store from './store'</span><span id="33f1" class="mk li it lb b gy nj nf l ng nh">export default {<br/>  install (<em class="ni">Vue</em>, <em class="ni">options</em>) {<br/>    if (!options || !options.store) {<br/>      throw new Error('Please initialise plugin with a Vuex store.')<br/>    }<br/>    <br/>    options.store.registerModule('dummylib', store)<br/> <br/>    Vue.component('dummy-button', DummyButton)<br/>  }<br/>}</span></pre><p id="addb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一些解释。这一次出口我们的组件是不够的。我们需要让它成为一个插件。</p><p id="f802" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是插件的使用方式:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="5967" class="mk li it lb b gy ne nf l ng nh">Vue.use(MyPlugin, { someOption: someValue })</span></pre><p id="8828" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要将应用程序Vuex商店作为一个选项来传递，这样我们就可以注册我们的Vuex模块。所以第一行检查确实是这样。</p><p id="0469" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们注册我们的Vuex模块，并将其命名为<code class="fe ky kz la lb b">dummylib</code>(我们可以随意命名它)。它的好处是，我们商店的整个状态将位于<code class="fe ky kz la lb b">dummylib</code>名称空间下，所以如果应用程序已经有一个名为<code class="fe ky kz la lb b">counter</code>的变量，它不会干扰我们的，因为它被“称为”<code class="fe ky kz la lb b">dummylib.counter</code>。</p><p id="47cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们导出组件。重新构建包。</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="6ac0" class="mk li it lb b gy ne nf l ng nh">yarn build-lib</span></pre><h1 id="433c" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">该应用程序</h1><h2 id="f406" class="mk li it bd lj ml mm dn ln mn mo dp lr kb mp mq lv kf mr ms lz kj mt mu md mv bi translated">创建Vuex商店</h2><p id="c844" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">回到我们的应用程序！</p><p id="bdf3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们要做的第一件事是导入Vuex并创建一个Vuex实例。为此，只需添加<code class="fe ky kz la lb b">vuex</code>作为依赖项</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="a770" class="mk li it lb b gy ne nf l ng nh">yarn add vuex</span></pre><p id="abde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，创建一个<code class="fe ky kz la lb b">store.js</code>文件，并在其中写入以下内容</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="7a3b" class="mk li it lb b gy ne nf l ng nh">import Vue from 'vue'<br/>import Vuex from 'vuex'</span><span id="cafc" class="mk li it lb b gy nj nf l ng nh">Vue.use(Vuex)</span><span id="d14f" class="mk li it lb b gy nj nf l ng nh">export default new Vuex.Store({});</span></pre><p id="b56b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们刚刚创建了一个Vuex商店，一个空的，是的，但这对于本教程来说已经足够了。</p><p id="439b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">理想情况下，你应该创建一个名为<code class="fe ky kz la lb b">store</code>的文件夹，然后在里面放5个文件:</p><ul class=""><li id="9c7e" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">索引. js</li><li id="6159" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">状态. js</li><li id="04c3" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">getters.js</li><li id="3191" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">突变. js</li><li id="f9b8" class="kp kq it js b jt lc jx ld kb le kf lf kj lg kn ku kv kw kx bi translated">actions.js</li></ul><p id="c772" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ky kz la lb b">index.js</code>创建商店，导入它的每一部分，最后公开它。但这对于本教程来说绝对是矫枉过正。</p><p id="4ce7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了自己的商店，让我们确保它可以使用。回到您的<code class="fe ky kz la lb b">main.js</code>文件，导入juste创建的<code class="fe ky kz la lb b">store.js</code>文件，并将其添加到您的Vue实例中。</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="d731" class="mk li it lb b gy ne nf l ng nh">import Vue from 'vue'<br/>import App from './App.vue'<br/>import store from './store';</span><span id="53e7" class="mk li it lb b gy nj nf l ng nh">Vue.config.productionTip = false</span><span id="e799" class="mk li it lb b gy nj nf l ng nh">new Vue({<br/>  store,<br/>  render: <em class="ni">h</em> =&gt; h(App),<br/>}).$mount('#app')</span></pre><p id="1d67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe ky kz la lb b">dummylib</code>包应该已经添加到我们的项目中了。不过，我们需要更新如何导入我们的<code class="fe ky kz la lb b">DummyButton</code>。</p><h2 id="eec9" class="mk li it bd lj ml mm dn ln mn mo dp lr kb mp mq lv kf mr ms lz kj mt mu md mv bi translated">导入我们的库</h2><p id="2a8e" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">如前所述，我们的组件现在是一个插件。下面是我们将如何导入它:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="6551" class="mk li it lb b gy ne nf l ng nh">import DummyButton from 'dummylib';</span><span id="6f98" class="mk li it lb b gy nj nf l ng nh">Vue.use(DummyButton);</span></pre><p id="e760" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们首先导入组件，然后告诉<code class="fe ky kz la lb b">Vue</code>使用它。</p><p id="fd0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们运行<code class="fe ky kz la lb b">yarn serve</code>看看是否一切正常。如果您在<code class="fe ky kz la lb b">http://localhost:8080</code>打开浏览器(或<code class="fe ky kz la lb b">yarn serve</code>给出的URL，如果不同)并打开控制台(MacOS上的<code class="fe ky kz la lb b">CMD</code> + <code class="fe ky kz la lb b">OPT</code> + <code class="fe ky kz la lb b">I</code>)，您应该会看到以下错误:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="22a9" class="mk li it lb b gy ne nf l ng nh">Uncaught Error: Please initialise plugin with a Vuex store.</span></pre><p id="c152" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还记得我们之前写的安装函数吗？我们的组件或插件需要一个<code class="fe ky kz la lb b">Vuex</code>实例。因此，让我们更新我们的应用程序<code class="fe ky kz la lb b">main.js</code>文件:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="12e1" class="mk li it lb b gy ne nf l ng nh">Vue.use(DummyButton, { store });</span></pre><p id="4584" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你没有杀死<code class="fe ky kz la lb b">yarn serve</code>应用程序应该自动刷新你应该不会看到任何错误。耶！</p><h2 id="eaa5" class="mk li it bd lj ml mm dn ln mn mo dp lr kb mp mq lv kf mr ms lz kj mt mu md mv bi translated">使用我们的组件</h2><p id="d147" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated">你有没有注意到我们的组件已经被初始化了，就像我们用<code class="fe ky kz la lb b">Vue.use()</code>初始化<code class="fe ky kz la lb b">Vuex</code>一样？这意味着我们的组件现在是在应用程序级别定义的，而不是像第1部分中那样在组件级别定义的。所以现在使用我们的组件很简单:</p><pre class="mw mx my mz gt na lb nb nc aw nd bi"><span id="985b" class="mk li it lb b gy ne nf l ng nh">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;img alt="Vue logo" src="./assets/logo.png"&gt;<br/>    &lt;dummy-button /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="0f1a" class="mk li it lb b gy nj nf l ng nh">&lt;script&gt;<br/>export default {<br/>  name: 'app',<br/>}<br/>&lt;/script&gt;</span></pre><p id="da76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为我们的组件是在应用程序级别定义的，所以我们不再需要像以前那样导入它。</p><p id="caf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你的浏览器上安装了<a class="ae ko" href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd?hl=en" rel="noopener ugc nofollow" target="_blank"> Vue开发工具</a>，你可以打开它，进入Vuex标签。加载状态。您应该看到这个:</p><figure class="mw mx my mz gt nl gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/dfdd9ce63796762b3a1cd91dfd3670e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*CIIvtVlYN9WCXyK4aCkwmg.png"/></div></figure><p id="1637" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的变量<code class="fe ky kz la lb b">counter</code>在名称空间调用<code class="fe ky kz la lb b">dummylib</code>中定义，就像我们在组件<code class="fe ky kz la lb b">install</code>函数中定义它一样。因此，如果应用程序或任何其他插件也有一个<code class="fe ky kz la lb b">counter</code>变量，它们就不会冲突。</p><p id="a818" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太棒了，不是吗？</p></div></div>    
</body>
</html>