<html>
<head>
<title>Using hooks with Redux + Tailwind</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用带有Redux +顺风的挂钩</h1>
<blockquote>原文：<a href="https://itnext.io/using-hooks-with-redux-tailwind-70a844736d56?source=collection_archive---------3-----------------------#2018-11-06">https://itnext.io/using-hooks-with-redux-tailwind-70a844736d56?source=collection_archive---------3-----------------------#2018-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5880" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">react组件的新<code class="fe kl km kn ko b">hooks</code>提案看起来很棒，语法看起来非常干净，可读性也很好。上周末，我决定试一试，开发一个简单的<a class="ae kp" href="https://budget.bleext.com/" rel="noopener ugc nofollow" target="_blank">预算应用</a>。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/8a4c31cc229b4ca2b5c3858644c6f469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJZkZFgqaoGG2UsjWQyj2A.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">使用React + Redux + Hooks + Tailwind的预算应用程序</figcaption></figure><p id="542d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了加快速度，我决定使用Create React应用程序在几分钟内启动并运行。考虑到我在周末写代码的时间非常有限，我决定用tailwind做样式，这是我一直想用的工具。</p><h1 id="b2e7" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">集成顺风CSS</h1><p id="1fe6" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">将tailwind与CRA集成非常容易，只需安装这个库并创建几个脚本来编译它。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="344f" class="mn lh iq ko b gy mo mp l mq mr">$ yarn add tailwindcss --dev<br/>$ yarn add postcss-cli --dev<br/>$ yarn add autoprefixer --dev</span></pre><p id="3b8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦准备好依赖项，就需要像这样初始化tailwind:</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="d3e4" class="mn lh iq ko b gy mo mp l mq mr">$ ./node_modules/.bin/tailwind init</span></pre><p id="0a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在根目录下创建一个配置文件。您可以在这里配置<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/tailwind.config.js#L46" rel="noopener ugc nofollow" target="_blank">颜色</a>、<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/tailwind.config.js#L645" rel="noopener ugc nofollow" target="_blank">大小</a>、<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/tailwind.config.js#L195" rel="noopener ugc nofollow" target="_blank">字体</a>等。在我的例子中，我离开默认配置仅仅是因为我赶时间(我只能在周末当我的宝宝睡觉的时候编码😅).但是会回来调整它并使<a class="ae kp" href="https://tailwindcss.com/docs/controlling-file-size" rel="noopener ugc nofollow" target="_blank">最终束变得更小</a>。</p><p id="d244" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要配置postcss，我们基本上需要添加tailwind作为插件。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="4487" class="mn lh iq ko b gy mo mp l mq mr">const tailwindcss = require('tailwindcss');</span><span id="8f13" class="mn lh iq ko b gy ms mp l mq mr">module.exports = {<br/>  plugins: [<br/>    tailwindcss('./tailwind.js'),<br/>  ],<br/>};</span></pre><p id="11c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">鉴于我使用的是CRA，我没有对webpack配置的完全访问权(除非<a class="ae kp" href="https://daveceddia.com/customize-create-react-app-webpack-without-ejecting/" rel="noopener ugc nofollow" target="_blank">我们破解了</a>，否则我们可以使用webpack <a class="ae kp" href="https://tailwindcss.com/docs/installation" rel="noopener ugc nofollow" target="_blank">加载器来代替postcss用于顺风</a>。</p><p id="d798" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在React中使用tailwind，我们需要创建一个css文件并导入预检和实用程序。文件可以在任何地方定义，<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/src/theme/base.css" rel="noopener ugc nofollow" target="_blank">在我的例子中</a>在<code class="fe kl km kn ko b">src/theme/base.css</code>下</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="68c0" class="mn lh iq ko b gy mo mp l mq mr">@tailwind preflight;<br/>@tailwind utilities;</span><span id="4496" class="mn lh iq ko b gy ms mp l mq mr">/* Your custom CSS here */</span></pre><p id="551c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要做的最后一件事是编译css并在react应用程序中使用它。我们需要在<code class="fe kl km kn ko b">package.json</code>中添加<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/package.json#L11-L12" rel="noopener ugc nofollow" target="_blank">以下任务</a></p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="b78d" class="mn lh iq ko b gy mo mp l mq mr">"build:css": "postcss src/theme/base.css -o src/index.css",<br/>"watch:css": "postcss src/theme/base.css -o src/index.css -w"</span></pre><p id="0ea1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一项任务是获取基本css文件并将其编译成<code class="fe kl km kn ko b">src/index.css</code>，这是我们需要导入react应用程序的文件。</p><p id="c929" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个任务是可选的，如果您想观察对基本css文件的任何更改，这对开发很有用。</p><p id="b319" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要在使用它之前构建css，我们可以手动完成它，但我认为在启动webpack之前完成它会更容易。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="ed3a" class="mn lh iq ko b gy mo mp l mq mr">"start": "npm run watch:css &amp;&amp; react-scripts start",</span></pre><p id="c2cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们需要将编译后的文件导入React组件。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="aa88" class="mn lh iq ko b gy mo mp l mq mr">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import { StoreProvider } from 'redux-react-hook';<br/>import App from './containers/App';<br/>import store from './store';<br/>import { setAppUpdated } from './store/modules/app/actions';<br/>import * as serviceWorker from './serviceWorker';</span><span id="50ca" class="mn lh iq ko b gy ms mp l mq mr">import './index.css'; // &lt;---- Here!!</span><span id="a3cb" class="mn lh iq ko b gy ms mp l mq mr">ReactDOM.render(<br/>  &lt;StoreProvider value={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/StoreProvider&gt;,<br/>  document.getElementById('root')<br/>);</span><span id="aed8" class="mn lh iq ko b gy ms mp l mq mr">// If you want your app to work offline and load faster, you can change<br/>// unregister() to register() below. Note this comes with some pitfalls.<br/>// Learn more about service workers: <a class="ae kp" href="http://bit.ly/CRA-PWA" rel="noopener ugc nofollow" target="_blank">http://bit.ly/CRA-PWA</a><br/>serviceWorker.register({<br/>  onUpdate: () =&gt; store.dispatch(setAppUpdated()),<br/>});</span></pre><p id="5c6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样，现在我们可以在react组件中使用tailwind了！不用写任何css就能构建ui，真的很牛逼！</p><p id="7f78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看我的面板组件，超级容易搭建！我不用写一行CSS代码:</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="07f2" class="mn lh iq ko b gy mo mp l mq mr">import React from 'react';</span><span id="cd5a" class="mn lh iq ko b gy ms mp l mq mr">export default function Panel({ children, title }) {<br/>  return (<br/>    &lt;div className="bg-white py-8 px-4 border-t-4 border-orange"<br/>      {title &amp;&amp; &lt;h3 className="mb-4"&gt;{title}&lt;/h3&gt; }<br/>      {children}<br/>    &lt;/div&gt;<br/> );<br/>}</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mt"><img src="../Images/05ba0b6ef41cf28de760aa2f4574d4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UraQDuD6e05wTP7HerV25A.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">一个顺风建造的面板组件！</figcaption></figure><h1 id="5c77" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">在Redux中使用React钩子</h1><p id="8186" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">关于如何为redux实现钩子已经有了一个<a class="ae kp" href="https://github.com/reduxjs/react-redux/issues/1063" rel="noopener ugc nofollow" target="_blank">讨论</a>，确实是非常有趣的方法。然而，目前官方的redux项目还不支持钩子。</p><p id="384d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有几个项目可以帮助你用钩子访问redux状态，我最喜欢的一个是<a class="ae kp" href="https://github.com/ianobermiller/redux-react-hook" rel="noopener ugc nofollow" target="_blank"> redux-react-hook </a>。我喜欢它，因为它通过定义一个映射函数让你访问状态，类似于我们在<code class="fe kl km kn ko b">connect</code>中使用的，它也让你访问<code class="fe kl km kn ko b">dispatch</code>方法来触发动作。</p><p id="253f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要做的第一件事是删除官方的<a class="ae kp" href="https://github.com/crysfel/budgeting-app/blob/master/src/index.js" rel="noopener ugc nofollow" target="_blank"> redux provider </a>并在这个库中使用这个provider。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="f4eb" class="mn lh iq ko b gy mo mp l mq mr">import { StoreProvider } from 'redux-react-hook';<br/>import store from './store';</span><span id="86ac" class="mn lh iq ko b gy ms mp l mq mr">ReactDOM.render(<br/>  &lt;StoreProvider value={store}&gt;<br/>    &lt;App /&gt;<br/>  &lt;/StoreProvider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="3c58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了访问React组件内部的状态，您需要使用<code class="fe kl km kn ko b">useMappedState</code>函数，它接收一个映射函数并返回一个包含您需要的数据的对象。</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="dbfa" class="mn lh iq ko b gy mo mp l mq mr">import React from 'react';<br/>import { useMappedState } from 'redux-react-hook';<br/>import { getLatestGroupedByDate } from 'store/modules/transactions/selectors';</span><span id="7bce" class="mn lh iq ko b gy ms mp l mq mr">const mapState = state =&gt; ({<br/>  latest: getLatestGroupedByDate(state),<br/>});</span><span id="3f97" class="mn lh iq ko b gy ms mp l mq mr">export default function Dashboard() {<br/>  const { latest } = useMappedState(mapState);</span><span id="e478" class="mn lh iq ko b gy ms mp l mq mr">  return (<br/>    &lt;span&gt;{latest.length} Transactions&lt;/span&gt;<br/>  );<br/>}</span></pre><p id="6800" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b">mapState</code>函数和我们在<code class="fe kl km kn ko b">connect</code>中使用的完全一样，在react组件之外声明这个函数很重要，否则它会在每次渲染时被创建。</p><p id="7519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们需要在<code class="fe kl km kn ko b">mapState</code>中使用<code class="fe kl km kn ko b">props</code>，那么我们可以将它移动到组件中，但是我们必须使用<code class="fe kl km kn ko b">useCallback</code>来记忆它并避免在每次渲染时重新创建它。</p><p id="b0dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过调用<code class="fe kl km kn ko b">useMappedState</code>，我们可以从redux存储中检索我们需要的数据！使用钩子的语法看起来非常简洁，易于阅读和理解。我们不再需要hoc了🎉！</p><p id="9a50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，为了分派动作，我们需要做的就是调用钩子<code class="fe kl km kn ko b">useDispatch</code>，它将从存储中返回分派方法！从那里你基本上可以发射任何你想要的动作，例如:</p><pre class="kr ks kt ku gt mj ko mk ml aw mm bi"><span id="6cb7" class="mn lh iq ko b gy mo mp l mq mr">import { useDispatch } from 'redux-react-hook';</span><span id="3d53" class="mn lh iq ko b gy ms mp l mq mr">export default function AddTransaction({ isExpense }) {<br/>  const [amount, setAmount] = useState(0);<br/>  const dispatch = useDispatch();<br/>  const saveTransaction = useCallback(<br/>    dispatch(postTransaction({ amount }))<br/>  , [amount]);</span><span id="b765" class="mn lh iq ko b gy ms mp l mq mr">  return (<br/>    &lt;button onClick={saveTransaction}&gt;Save&lt;/button&gt;<br/>  );<br/>}</span></pre><p id="abd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里重要的是使用了<code class="fe kl km kn ko b">useCallback</code>，这是为了避免在每次渲染时创建内部动作，只有在<code class="fe kl km kn ko b">amount</code>更新时才会创建。</p><h1 id="12ce" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="31c8" class="pw-post-body-paragraph jn jo iq jp b jq me js jt ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk ij bi translated">通过使用钩子，你可以看到访问状态和分派动作是多么容易。我真的很喜欢hooks玩redux的方式，我认为这是向前迈出的一步，降低了新开发的门槛。</p><p id="8899" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用顺风真的很牛逼！我喜欢不用写任何css就能构建一个应用程序，真的很棒！</p><p id="fa18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到<a class="ae kp" href="https://budget.bleext.com/" rel="noopener ugc nofollow" target="_blank">运行</a>的应用程序，如果你对代码感兴趣，你应该<a class="ae kp" href="https://github.com/crysfel/budgeting-app" rel="noopener ugc nofollow" target="_blank">检查我的回购</a>。</p></div></div>    
</body>
</html>