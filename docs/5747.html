<html>
<head>
<title>How to upload a file with Selenium WebDriver.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Selenium WebDriver上传文件？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-upload-a-file-with-selenium-webdriver-12154e1d1357?source=collection_archive---------3-----------------------#2021-05-17">https://itnext.io/how-to-upload-a-file-with-selenium-webdriver-12154e1d1357?source=collection_archive---------3-----------------------#2021-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b717477e3c640fbc3e7f03ac6735d92f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en5JzmJG5x4tfuqpadiY6A.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">基弗·里克斯的照片</figcaption></figure><p id="0275" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在测试我们项目的过程中，我们有时不得不面对上传文件的需求。在大多数情况下，我们需要使用Selenium WebDriver上传文件。在大多数情况下，web应用程序应该包含允许用户将文件上传到服务器的功能。然而，这并不总是如此，但更多的关于这一点。测试产品时，掌握使用Selenium WebDriver上传文件的技能非常重要。在本文中，我们将讨论并学习如何使用Selenium WebDriver上传文件。</p><p id="33ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用一个真实的例子来分析文件上传到服务器。假设我们需要编写自动化脚本，用于在用户可以上传一些文件的web平台上进行测试。在这种情况下，您需要使用文件上传概念将文件上传到web应用程序。</p><p id="151a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Selenium WebDriver中，最好使用Selenium Java提供的特性来执行文件上传。这就是SendKeys方法。它直接应用于具有type='file '属性的输入标记。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/6379e6a55c54ea47bd0a1c7391126927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zY_DJak9Y_nfZLqszImNDg.png"/></div></div></figure><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi li"><img src="../Images/0fb0bf616deca264010bbdd21aeec9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*Szi6zONRyeeaqaH6gwQ_zg.png"/></div></figure><p id="7d99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个使用sendKeys上传Selenium和Java文件的示例:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="79f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时我们需要上传文件到远程服务器。例如，为了运行我们的自动化脚本，我们使用Selenium网格或Selenoid服务器。在这种情况下，通常下载文件的方式将会失败。为此，您需要使用远程Web驱动程序。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="9759" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是自动化专家并不总是这么幸运。有时候会出现硒无力的情况。比如根据脚本，你需要上传或者下载一个文件。点击“上传”或“下载”按钮后，操作系统文件管理器窗口出现在浏览器窗口的顶部，Selenium不再能够访问该窗口。测试停止。<br/>此外，有时文件类型的输入字段可能会丢失。上传到网站是通过某个JavaScript函数实现的，或者只是隐藏起来。在这种情况下，你可以使用第三方框架<strong class="kf ir">机器人框架</strong>或者<strong class="kf ir"> AutoIt </strong>。</p><p id="4f98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，我个人更喜欢不同的方法。Selenium WebDriver提供了执行Javascript函数的能力。如果您遇到输入字段不可用的情况，您可以使用以下代码:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="67ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的一堆会改变你的文件输入控件的可见性。然后，您可以继续进行文件上传的常规步骤，例如:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="73fb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，您可以使用以下代码:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="016b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，通过改变输入字段的可见性，您正在干预测试中的应用程序。注入脚本来改变行为是侵入性的，不建议在测试中使用。</p><p id="e389" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候，作为一名自动化工程师，除了通过操作系统窗口，我们没有下载文件的选项。为了实现这种方法，有几个机器人框架和AutoIt库。这两个库都非常强大，并且有很好的文档记录。但就个人而言，当我需要通过操作系统窗口下载文件时，我更喜欢在我的自动化测试中使用WinAppDriver。</p><h1 id="fdb3" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Windows应用程序驱动程序。</h1><p id="ec37" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">Windows应用程序驱动程序(WinAppDriver)是一种支持在Windows应用程序上进行类似Selenium的UI测试自动化的服务。此服务支持在Windows 10 PCs上测试通用Windows平台(UWP)、Windows窗体(WinForms)、Windows演示基础(WPF)和经典Windows (Win32)应用程序。</p><p id="ce8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">WinAppDriver提供了一个<a class="ae kc" href="https://github.com/microsoft/WinAppDriver/releases/tag/UIR-v1.1" rel="noopener ugc nofollow" target="_blank"> UI记录器工具</a>。UI Recorder跟踪应用程序界面的键盘和鼠标交互——代表一个UI动作。当记录处于活动状态时，每次发生新的UI动作时，顶部和底部面板都会用不同的UI元素信息进行动态更新。顶部面板显示了为当前选择的UI元素生成的XPath查询，底部面板显示了同一元素的原始XML信息。您可以导航到底部面板上的C# Code选项卡，查看所记录操作的生成C#代码，您可以在WinAppDriver测试中使用这些代码。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/6bc04dc551a38b48a9ed74293df5452a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gUAYJ8WgVdBjjbB7.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">UI记录器</figcaption></figure><p id="584d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用WinAppDriver上传文件，可以使用以下代码:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="88b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">警告！不幸的是，这种方法只适用于Windows操作系统。</strong></p><p id="da53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的建议是永远不要这样做，这是一种导致不稳定测试的恶意做法:</p><p id="a643" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这种方法有其缺点:</p><ul class=""><li id="0b95" class="mn mo iq kf b kg kh kk kl ko mp ks mq kw mr la ms mt mu mv bi translated">这个解决方案不是跨平台的。</li><li id="496d" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">不稳定。</li><li id="2f5d" class="mn mo iq kf b kg mw kk mx ko my ks mz kw na la ms mt mu mv bi translated">没有可能使用<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/how-to-run-a-headless-chrome-browser-in-selenium-webdriver-c5521bc12bf0">无头浏览器模式</a>。</li></ul><p id="3a8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">操作系统窗口的所有困难都很容易解决——你需要确保这些窗口不会出现，也不会干扰浏览器。尝试找到一种方法来保证操作系统窗口不会打开。</p><h1 id="b136" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论。</h1><p id="d7c8" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">在本文中，我们考虑了如何在HTML页面上上传文件。此外，您如何使用窗体Windows应用程序上传文件。我们还看到了在Selenium中处理文件上传的各种方法。我们还理解了在Selenium中为每种方法处理文件上传的代码实现，最后看了几个例子。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/37405c6bd9906e7572c1b5d0f490ca04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Lu3G8OVrxTr-BOSOHvP5Gw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://test-engineer.site/" rel="noopener ugc nofollow" target="_blank">https://test-engineer.site/</a></figcaption></figure><h1 id="9ef7" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">作者<a class="ae kc" href="https://www.linkedin.com/in/vaskocuturilo/" rel="noopener ugc nofollow" target="_blank">安东·斯米尔诺夫</a></h1></div></div>    
</body>
</html>