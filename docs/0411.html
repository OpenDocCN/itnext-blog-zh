<html>
<head>
<title>Sharing variables between JS and Sass using webpack sass-loader</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用webpack sass-loader在JS和Sass之间共享变量</h1>
<blockquote>原文：<a href="https://itnext.io/sharing-variables-between-js-and-sass-using-webpack-sass-loader-713f51fa7fa0?source=collection_archive---------3-----------------------#2018-03-06">https://itnext.io/sharing-variables-between-js-and-sass-using-webpack-sass-loader-713f51fa7fa0?source=collection_archive---------3-----------------------#2018-03-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b906" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fsharing-variables-between-js-and-sass-using-webpack-sass-loader-713f51fa7fa0" rel="noopener ugc nofollow" target="_blank"> <em class="km">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="2780" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目的主题是一个文件，您可以在其中定义组成其外观的各种属性。这可能包括颜色、字体、断点和大小/间距。有了这个真实的单一来源，更新就变得容易了，这意味着您可以确信您的所有组件都是从同一个地方获得它们的值的。</p><p id="d449" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个项目可能很容易在你希望混合使用JS样式(比如样式化组件或内联样式)和Sass样式的情况下结束，但是我们仍然希望有一个真实的单一来源。那么，我们如何在一个地方定义我们的属性，同时又能被Sass和JS使用呢？</p><p id="1ca0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TL；推倒（网络用词）</p><ul class=""><li id="728e" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">源文件可以在<a class="ae kl" href="https://github.com/planetflash/sharing_variables_js_sass" rel="noopener ugc nofollow" target="_blank">https://github.com/planetflash/sharing_variables_js_sass</a>在线获得</li><li id="2d4a" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">演示网站可在<a class="ae kl" href="https://planetflash.github.io/sharing_variables_js_sass/" rel="noopener ugc nofollow" target="_blank">https://planetflash.github.io/sharing_variables_js_sass/</a>观看</li></ul><h1 id="4044" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">真理的单一来源</h1><p id="edcc" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">所以，我们已经决定我们需要在一个地方定义我们的属性，但是这应该在JS中还是在Sass中？这两种方法似乎都可行，我简要地探讨了这两种方法。我认为定义规则最合理的地方应该是在JSON对象中。设置简单明了，分组直观，如果其他地方需要，可以很容易地将其转换成各种格式。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0cd0" class="mn lc iq mj b gy mo mp l mq mr">// theme.js<br/>module.exports = {<br/>  base: "16px",<br/>  spacing: "1rem",<br/>  breakpoints: {<br/>    xs: "0em" /* 0px */,<br/>    sm: "30em" /* 480px */,<br/>    md: "64em" /* 1024px */,<br/>    lg: "75em" /* 1200px */<br/>  },<br/>  typography: {<br/>    font: "'Open Sans', sans-serif",<br/>    text: "1rem",<br/>    title: "2rem"<br/>  },<br/>  colors: {<br/>    primary: "#2c97de",<br/>    secondary: "#7F8FA4",<br/>    warning: "#f2c500",<br/>    success: "#1fce6d",<br/>    danger: "#e94b35",<br/>    error: "#e94b35"<br/>  },<br/>};</span></pre><p id="aadd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个<code class="fe ms mt mu mj b">theme.js</code>文件是我们的主题可能看起来像什么的一个简化的例子，包含我们的基本大小、断点、字体和颜色。然后可以将这个文件导入到任何需要它的JS组件中。</p><h1 id="eb6f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">具有可用于Sass的值</h1><p id="d8d0" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我们仍然需要将这些相同的值放入Sass，这样我们就可以通过CSS将它们用于样式化。我们使用w <a class="ae kl" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> ebpack </a>来编译我们的代码，更具体地说是使用<a class="ae kl" href="https://github.com/webpack-contrib/sass-loader" rel="noopener ugc nofollow" target="_blank"> sass-loader </a>来将sass编译成CSS，以便可以通过<a class="ae kl" href="https://github.com/webpack-contrib/css-loader" rel="noopener ugc nofollow" target="_blank"> css-loader </a>将其导入到我们的项目中。关于如何在webpack中使用Sass，有大量的文章，所以我们在这里就不深究了。</p><p id="85f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">sass-loader使用<a class="ae kl" href="https://github.com/sass/node-sass" rel="noopener ugc nofollow" target="_blank"> node-sass </a>，这恰好支持<a class="ae kl" href="https://github.com/sass/node-sass#functions--v300---experimental" rel="noopener ugc nofollow" target="_blank">函数</a>。这意味着我们可以创建自定义函数，然后通过我们的Sass文件访问这些函数。这是我们用来访问我们的<code class="fe ms mt mu mj b">theme.js</code>属性的。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="255a" class="mn lc iq mj b gy mo mp l mq mr">// webpack.config.js</span><span id="d190" class="mn lc iq mj b gy mv mp l mq mr">...<br/>const sassVars = require(__dirname + "/src/theme.js");<br/>...<br/>module.exports = {<br/>...<br/>  {<br/>    test: /\.scss$/,<br/>    use: [{<br/>        loader: "style-loader"<br/>    }, {<br/>        loader: "css-loader"<br/>    }, {<br/>        loader: "sass-loader"<br/>        options: {<br/>          functions: {<br/>            "get($keys)": function(keys) {<br/>              keys = keys.getValue().split(".");<br/>              let result = sassVars;<br/>              let i;<br/>              for (i = 0; i &lt; keys.length; i++) {<br/>                result = result[keys[i]];<br/>              }<br/>              result = sassUtils.castToSass(result);<br/>              return result;<br/>            }<br/>          }<br/>        }<br/>    }]<br/>  }<br/>...<br/>}</span></pre><p id="cc24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您会注意到该函数的最后一行使用了来自<a class="ae kl" href="https://github.com/sass-eyeglass/node-sass-utils" rel="noopener ugc nofollow" target="_blank"> node-sass-utils </a>的一个名为<code class="fe ms mt mu mj b"><a class="ae kl" href="https://github.com/sass-eyeglass/node-sass-utils#sassutilscasttosassjsvalue" rel="noopener ugc nofollow" target="_blank">castToSass()</a></code>的函数。这个方便的函数将JS值转换成Sass值，比如将JSON对象转换成Sass映射，使得在Sass中使用JS值成为可能。</p><h1 id="62bb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Sass中的属性</h1><p id="127d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">这使我们可以访问Sass文件中的一个名为<code class="fe ms mt mu mj b">get()</code>的函数，它的用法如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e922" class="mn lc iq mj b gy mo mp l mq mr">// style.scss<br/>.text { <br/>  color: get('colors.secondary');<br/>  background: get('colors.primary');<br/>}</span></pre><p id="ad0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这让我们非常接近最终目标。我不太喜欢这种语法，尤其是在团队环境中，这意味着要培训其他开发人员如何使用它。我更愿意使用Sass变量和Sass映射。为此，我们创建了一个名为<code class="fe ms mt mu mj b">variables.scss</code>的文件</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1a74" class="mn lc iq mj b gy mo mp l mq mr">$base: get("base");<br/>$spacing: get("spacing");<br/>$grid: get("grid");<br/>$breakpoints: get("breakpoints");<br/>$colors: get("colors");</span></pre><p id="9822" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将这个文件导入到任何需要使用这些变量的Sass文件中。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9560" class="mn lc iq mj b gy mo mp l mq mr">// style.scss<br/>@import 'variables.scss';</span><span id="2703" class="mn lc iq mj b gy mv mp l mq mr">.text {<br/>  color: map-get($colors, secondary);<br/>  background: map-get($colors, primary);<br/>}</span></pre><h1 id="2ffc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理维度</h1><p id="c167" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我们现在非常接近了，但是我们还有一场战斗要打——维度。现在的代码<em class="km">会</em>起作用，我们可以说<code class="fe ms mt mu mj b">margin: $spacing;</code>和萨斯会解决这个问题。然而，我们在这里真正做的是给Sass一个字符串，而不是一个维度，如果我们试图对它运行任何数学运算，我们都会得到一个错误。所以我们真的需要把这些字符串转换成维度。</p><p id="8d34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/sass-eyeglass/node-sass-utils" rel="noopener ugc nofollow" target="_blank"> node-sass-utils </a>用它的<a class="ae kl" href="https://github.com/sass-eyeglass/node-sass-utils#class-sassdimension" rel="noopener ugc nofollow" target="_blank"> SassDimension </a>类再次拯救了我们。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0aa0" class="mn lc iq mj b gy mo mp l mq mr">const convertStringToSassDimension = function(result) {<br/>  // Only attempt to convert strings<br/>  if (typeof result !== "string") {<br/>    return result;<br/>  }</span><span id="2dee" class="mn lc iq mj b gy mv mp l mq mr">  const cssUnits = ["rem","em","vh","vw","vmin","vmax","ex","%","px","cm","mm","in","pt","pc","ch"];<br/>  const parts = result.match(/[a-zA-Z]+|[0-9]+/g);<br/>  const value = parts[0];<br/>  const unit = parts[parts.length - 1];<br/>  if (cssUnits.indexOf(unit) !== -1) {<br/>    result = new sassUtils.SassDimension(parseInt(value, 10), unit);<br/>  }</span><span id="17b3" class="mn lc iq mj b gy mv mp l mq mr">  return result;<br/>};</span></pre><p id="3345" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个函数检查传递给它的字符串是否是CSS维度(以px、em、rem等结尾。)如果是这样，就从该值和分母创建一个<code class="fe ms mt mu mj b">SassDimension</code>，这样<code class="fe ms mt mu mj b">castToSass</code>函数就能够正确地将该值解释为一个维度。</p><p id="3f8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要对每个值和对象中的每个值运行这个，这样我们就不会遗漏任何一个值。我们的<code class="fe ms mt mu mj b">get()</code>函数因此变成:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="74be" class="mn lc iq mj b gy mo mp l mq mr">"get($keys)": function(keys) {<br/>  keys = keys.getValue().split(".");<br/>  let result = sassVars;<br/>  let i;<br/>  for (i = 0; i &lt; keys.length; i++) {<br/>    result = result[keys[i]];<br/>    if (typeof result === "string") {<br/>      result = convertStringToSassDimension(result);<br/>    } else if (typeof result === "object") {<br/>      Object.keys(result).forEach(function(key) {<br/>        const value = result[key];<br/>        result[key] = convertStringToSassDimension(value);<br/>      });<br/>    }<br/>  }<br/>  result = sassUtils.castToSass(result);<br/>  return result;<br/>}</span></pre><p id="00fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们能够通过Sass或JS访问我们所有的值，它们的行为就像最初在Sass中声明的一样。我们只需要更新我们的theme.js文件，我们将在站点范围内进行更新——尽管值得注意的是，您需要重新启动webpack才能工作，但这不会在<code class="fe ms mt mu mj b">watch</code>期间发生。</p><p id="f1a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是保罗·托马斯，是英国布里斯托尔<a class="ae kl" href="https://immersivelabs.co.uk/" rel="noopener ugc nofollow" target="_blank">沉浸式实验室</a>的首席开发人员。</p><ul class=""><li id="6ce1" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">在推特上关注我:<a class="ae kl" href="https://twitter.com/motionimaging" rel="noopener ugc nofollow" target="_blank">https://twitter.com/motionimaging</a></li><li id="8268" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">在Github上关注我:<a class="ae kl" href="https://github.com/planetflash" rel="noopener ugc nofollow" target="_blank">https://github.com/planetflash</a></li></ul><figure class="me mf mg mh gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mw"><img src="../Images/d560f8851bad86a316ee604d0af70548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MtH4WPSMIy-Nt3b6Ac4oiw.png"/></div></div></figure></div></div>    
</body>
</html>