<html>
<head>
<title>Devise Gem Tutorial, Authenticate a user by user id and email (Ruby On Rails)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设计Gem教程，通过用户id和电子邮件认证用户(Ruby On Rails)</h1>
<blockquote>原文：<a href="https://itnext.io/devise-gem-tutorial-authenticate-a-user-by-user-id-and-email-ruby-on-rails-e25ae60ca437?source=collection_archive---------1-----------------------#2017-11-30">https://itnext.io/devise-gem-tutorial-authenticate-a-user-by-user-id-and-email-ruby-on-rails-e25ae60ca437?source=collection_archive---------1-----------------------#2017-11-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/9dfbf03932cb152f70c4366286878b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*MQRLKSFr8tSoYEuOUwl5zg.png"/></div><figcaption class="iv iw gj gh gi ix iy bd b be z dk translated">用户认证</figcaption></figure><div class=""/><p id="602d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fdevise-gem-tutorial-authenticate-a-user-by-user-id-and-email-ruby-on-rails-e25ae60ca437" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn </em>上分享这篇文章</a></p><p id="8e1f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户管理和认证设计</p><p id="deef" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下链接是设计宝石的详情:【https://github.com/plataformatec/devise】T5</p><p id="a81c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本教程的主要目的是实现devise gem并通过用户id和电子邮件验证用户。<br/>来实现吧。</p><p id="602f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第一步。在宝石文件中添加设计宝石</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2da1" class="lh li jb ld b gy lj lk l ll lm">gem 'devise', '3.4.1'</span></pre><p id="d8e4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第二步。安装宝石</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="78ae" class="lh li jb ld b gy lj lk l ll lm">bundle install</span></pre><p id="a027" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第三步。模型和视图设置</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="d7ff" class="lh li jb ld b gy lj lk l ll lm">$ rails generate devise:install<br/>$ rails generate devise MODEL<br/>$ rails generate devise:views</span></pre><p id="1f8e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">(如果您想更改视图的布局)</p><p id="32bf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第四步。运行迁移</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="8272" class="lh li jb ld b gy lj lk l ll lm">rake db:migrate</span></pre><p id="5537" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第五步。配置/环境/开发. rb: </strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="bb18" class="lh li jb ld b gy lj lk l ll lm">config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }</span></pre><p id="fe36" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第六步。/config/application.rb中的其他配置设置</strong> <br/></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="bfb0" class="lh li jb ld b gy lj lk l ll lm">config.action_mailer.delivery_method = :smtp<br/>    ActionMailer::Base.smtp_settings = {<br/>    address: "smtp.gmail.com",<br/>    enable_starttls_auto: true,<br/>    port: 587,<br/>    authentication: :plain,<br/>    user_name: ENV["MAIL_USERNAME"],<br/>    password: ENV["MAIL_PASSWORD"],<br/>    openssl_verify_mode: 'none'<br/>    }</span></pre><p id="0ece" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">关于环境设置请查看此</strong> <a class="ae kw" href="http://qiita.com/alokrawat050/items/0d7791b3915579f95791" rel="noopener ugc nofollow" target="_blank"> <strong class="ka jc">条</strong> </a> <strong class="ka jc">。</strong></p><p id="c44b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">步骤7。设置，用户通过电子邮件或user_id </strong> <br/>登录到您的/model/user.rb中</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="33d7" class="lh li jb ld b gy lj lk l ll lm">devise :database_authenticatable, :registerable,:confirmable, :lockable, :timeoutable,:recoverable, :rememberable, :trackable, :validatable, :authentication_keys =&gt; [:login]here we are using :authentication_keys =&gt; [:login], to authenticate user’s login.</span></pre><p id="633c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并在/model/user.rb. '#虚拟属性中添加以下代码，用于通过user_id或email进行身份验证</p><p id="bafa" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">#这是对“user_id”等真实持久化字段的补充</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2289" class="lh li jb ld b gy lj lk l ll lm">attr_accessor :login<br/><br/>  def login=(login)<br/>    @login = login<br/>  end<br/><br/>  def login<br/>    @login || self.user_id || self.email<br/>  end<br/><br/>  def self.find_for_database_authentication(warden_conditions)<br/>    conditions = warden_conditions.dup<br/>    if login = conditions.delete(:login)<br/>      where(conditions.to_h).where(["user_id = :value OR email = :value", { :value =&gt; login.downcase }]).first<br/>    else<br/>      where(conditions.to_h).first<br/>    end<br/>  end<br/><br/>def send_devise_notification(notification, *args)<br/>    devise_mailer.send(notification, self, *args).deliver_later<br/>  end</span></pre><p id="5ac3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">第八步。在/config/initializer/device . Rb文件</strong> <br/>中添加下面一行，行号33→config . authentic ation _ keys =[:log in]</p><p id="5b87" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">步骤九。/views/device/sessions/new . html . erb中视图</strong> <br/>的更改</p><p id="9457" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">替换以下代码:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="fc36" class="lh li jb ld b gy lj lk l ll lm">&lt;%= f.label :email %&gt;<br/>&lt;%= f.email_field :email, autofocus: true %&gt;<br/>↓<br/>&lt;%= f.label :login %&gt;<br/>&lt;%= f.text_field :login, autofocus: true, class: 'form-control'  %&gt;</span></pre><p id="4f65" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在/views/device/registrations/new . html . erb中</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="0f20" class="lh li jb ld b gy lj lk l ll lm">&lt;%= f.label :user_id %&gt;<br/>&lt;%= f.text_field :user_id, class: 'form-control' %&gt;</span></pre><p id="912e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后运行您的应用程序。如果您有疑问，请随时询问。</p><p id="d35b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">享受编码。</p><p id="699d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">感谢&amp;最诚挚的问候<br/> Alok Rawat </strong></p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><p id="dacc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【qiita.com】最初发表于<a class="ae kw" href="https://qiita.com/alokrawat050/items/5267e6ab0e274ad1188a" rel="noopener ugc nofollow" target="_blank"><em class="kx"/></a><em class="kx">。</em></p></div></div>    
</body>
</html>