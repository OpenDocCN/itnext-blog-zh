<html>
<head>
<title>K8s Labels &amp; Selectors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K8s标签和选择器</h1>
<blockquote>原文：<a href="https://itnext.io/k8s-labels-selectors-9ad2fcf78a4e?source=collection_archive---------4-----------------------#2020-11-15">https://itnext.io/k8s-labels-selectors-9ad2fcf78a4e?source=collection_archive---------4-----------------------#2020-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5c0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我们将看看</p><ul class=""><li id="edcd" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">什么是Kubernetes(K8s)标签和选择器</li><li id="eabe" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们为什么需要它们</li><li id="d780" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">如何使用它们</li></ul><p id="e296" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们试着用类比来理解这个概念。如果你看过不同类型的房子，你会看到联排别墅、公寓、独栋住宅、公寓等等。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/4420aeb27308b53865af00bef966bfdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I4WMkyoEJZwIXpZu"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk translated">公寓vs公寓vs独栋住宅vs联排别墅</figcaption></figure><p id="b0e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比方说，我们想对这些房屋进行分类</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="2303" class="lu lv iq lq b gy lw lx l ly lz">- Size(sqft area)</span><span id="4450" class="lu lv iq lq b gy ma lx l ly lz">- Type(condo, apartment, sfh, townhome)</span><span id="df14" class="lu lv iq lq b gy ma lx l ly lz">- Number of people(2,4,6,8+)</span></pre><p id="3cb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些不过是<strong class="jp ir">标签。选择器</strong>帮助过滤掉所有SFH类型且面积大于500平方英尺的房子。人们可以混合搭配不同类型的选择器。</p><p id="f0f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着时间的推移，K8s中可能会有1000个不同的对象，并且需要标记和选择某些类型的对象。<strong class="jp ir"> <em class="mb">标签</em> </strong>是附在对象上的键/值对，比如pod。</p><p id="ab49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">标签示例:</p><ul class=""><li id="abfe" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">“释放”:“稳定”，“释放”:“金丝雀”</li><li id="0bc8" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">“环境”:“开发”、“环境”:“质量保证”、“环境”:“生产”</li><li id="0972" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">"层":"前端"，"层":"后端"，"层":"缓存"</li><li id="09f5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">"分区":"客户a "，"分区":"客户b "</li><li id="058b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">“跟踪”:“每日”、“跟踪”:“每周”</li></ul><h2 id="2a64" class="lu lv iq bd mc md me dn mf mg mh dp mi jy mj mk ml kc mm mn mo kg mp mq mr ms bi translated">为什么我们需要这些标签和选择器？</h2><p id="7a3f" class="pw-post-body-paragraph jn jo iq jp b jq mt js jt ju mu jw jx jy mv ka kb kc mw ke kf kg mx ki kj kk ij bi translated">即使是一个小的Kubernetes集群也可能有数百个容器、pod、服务和许多其他Kubernetes API对象。</p><p id="c804" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览kubectl输出的页面来找到你的对象很快变得很烦人，<strong class="jp ir">标签</strong>完美地解决了这个问题。</p><p id="db36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该使用标签的主要原因是:</p><ul class=""><li id="7f67" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">使您能够在所有集群中逻辑地组织所有Kubernetes工作负载，</li><li id="b6c5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使您能够非常<strong class="jp ir">选择性地过滤</strong> kubectl输出，只过滤您需要的对象。</li><li id="0596" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使您能够<strong class="jp ir">理解所有API对象的层和层次</strong>。</li></ul><blockquote class="my mz na"><p id="bb23" class="jn jo mb jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated"><strong class="jp ir">我们如何使用相同的？</strong></p></blockquote><p id="47c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看，我们想要创建一个带有标签的Pod。使用minikube作为下面的例子，您可以在任何其他K8集群上尝试这样做。</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="eeec" class="lu lv iq lq b gy lw lx l ly lz"><strong class="lq ir">environment=</strong>production</span></pre><p id="5c61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有两种方法可以做到这一点:命令式的方法或声明式的方法</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="b339" class="lu lv iq lq b gy lw lx l ly lz">kubectl run nginx-imperative --image=nginx --restart=Never -l environment=production</span></pre><blockquote class="my mz na"><p id="611f" class="jn jo mb jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated"><strong class="jp ir">让我们尝试使用标签</strong>来确认POD</p></blockquote><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="b36d" class="lu lv iq lq b gy lw lx l ly lz">kubectl get pods -l environment=production<br/>NAME               READY   STATUS    RESTARTS   AGE<br/>nginx-imperative   1/1     Running   0          13s</span></pre><p id="1bf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们尝试使用声明的方式</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="e02c" class="lu lv iq lq b gy lw lx l ly lz"># declarative.yml<br/>apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: declarative-nginx<br/>  labels:<br/>    environment: production<br/>    app: nginx<br/>spec:<br/>  containers:<br/>  - name: nginx<br/>    image: nginx</span></pre><p id="13ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们应用YAML文件，我们看到具有给定标签的POD被创建。通过这里的选项，我们选择了一个特定的标签</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="c4d0" class="lu lv iq lq b gy lw lx l ly lz">kubectl apply -f declarative.yml<br/>pod/declarative-nginx created</span><span id="6aa6" class="lu lv iq lq b gy ma lx l ly lz">kubectl get pods -l environment=production<br/>NAME                READY   STATUS    RESTARTS   AGE<br/>declarative-nginx   1/1     Running   0          74s<br/>nginx-imperative    1/1     Running   0          2m43s</span><span id="99fa" class="lu lv iq lq b gy ma lx l ly lz">kubectl get pods -l environment=production --no-headers<br/>declarative-nginx   1/1   Running   0     2m8s<br/>nginx-imperative    1/1   Running   0     3m37s</span></pre><blockquote class="my mz na"><p id="a8e2" class="jn jo mb jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated"><strong class="jp ir">我们可以使用多个选择器吗？</strong></p></blockquote><p id="0b7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，下面的例子使用了选择器env、bu和type</p><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="2526" class="lu lv iq lq b gy lw lx l ly lz">kubectl get pods -l env=prod,bu=finance,type=app1 --no-headers</span><span id="5c7b" class="lu lv iq lq b gy ma lx l ly lz">kubectl get pods -l 'environment in (production, qa)'</span></pre><blockquote class="my mz na"><p id="be65" class="jn jo mb jp b jq jr js jt ju jv jw jx nb jz ka kb nc kd ke kf nd kh ki kj kk ij bi translated"><strong class="jp ir">如何查看所有正在使用的标签？</strong></p></blockquote><pre class="la lb lc ld gt lp lq lr ls aw lt bi"><span id="f5d5" class="lu lv iq lq b gy lw lx l ly lz">kubectl get all --show-labels<br/>kubectl get pod --show-labels</span></pre><p id="3d5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">标签的K8文档&amp;选择器有更多的细节，如果你想了解的话。作为后续，我们有一个帖子描述标签&amp;注释<a class="ae nh" href="https://sandeepbaldawa.medium.com/k8s-labels-annotations-c61c00237c77" rel="noopener">这里</a>的区别。就这样吧，下次再见！</p></div></div>    
</body>
</html>