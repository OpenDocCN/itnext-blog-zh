<html>
<head>
<title>Multi-Cluster Kubernetes: Managing DigitalOcean Kubernetes and Amazon EKS with KubeSphere</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多集群Kubernetes:使用KubeSphere管理数字海洋Kubernetes和亚马逊EKS</h1>
<blockquote>原文：<a href="https://itnext.io/multi-cluster-kubernetes-managing-digital-ocean-kubernetes-and-amazon-eks-with-kubesphere-6ba3f9cfe676?source=collection_archive---------2-----------------------#2021-06-03">https://itnext.io/multi-cluster-kubernetes-managing-digital-ocean-kubernetes-and-amazon-eks-with-kubesphere-6ba3f9cfe676?source=collection_archive---------2-----------------------#2021-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0add" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">KubeSphere是一个开源的分布式操作系统，用于管理云原生应用。使用<a class="ae kl" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>作为其内核，KubeSphere为无缝集成第三方应用程序提供了一个即插即用的架构，以促进其生态系统。<a class="ae kl" href="https://kubesphere.io/docs/introduction/what-is-kubesphere/#run-kubesphere-everywhere" rel="noopener ugc nofollow" target="_blank"> KubeSphere可以在任何地方运行</a>，因为它是高度可插拔的，不需要侵入Kubernetes。</p><p id="3e5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">KubeSphere旨在解决多集群和多云管理挑战，并实施后续用户场景，为用户提供一个统一的控制平面，以将应用程序及其副本分发到从公共云到内部环境的多个集群。</p><h1 id="e3a6" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">KubeSphere的Kubernetes集群联盟</h1><p id="5d6c" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">基于Kubernetes集群联盟(简称为<a class="ae kl" href="https://github.com/kubernetes-sigs/kubefed" rel="noopener ugc nofollow" target="_blank"> Kubefed </a>)，KubeSphere实现了多集群管理，允许集群管理员轻松管理跨云提供商的多个Kubernetes集群。</p><p id="3992" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将在数据中心安装一个主机集群，充当成员集群的控制面板。然后我们使用两个流行的托管Kubernetes服务，<a class="ae kl" href="https://www.digitalocean.com/products/kubernetes/" rel="noopener ugc nofollow" target="_blank"> DigitalOcean Kubernetes </a>和<a class="ae kl" href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html" rel="noopener ugc nofollow" target="_blank">亚马逊EKS </a>，并将它们导入到主机集群中。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/6a02f09e113d68ba1263074ef26a230e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wh_UZZbLxMYrqyXl.png"/></div></div></figure><h1 id="f61c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">准备主机集群</h1><p id="d025" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在开始之前，您需要安装一个KubeSphere集群，请参见Kubernetes上的quickstarts <a class="ae kl" href="https://kubesphere.io/docs/quick-start/all-in-one-on-linux/" rel="noopener ugc nofollow" target="_blank"> All-in-one </a>或<a class="ae kl" href="https://kubesphere.io/docs/quick-start/minimal-kubesphere-on-k8s/" rel="noopener ugc nofollow" target="_blank">minimal KubeSphere</a>了解详细信息。在本教程中，我们选择在数据中心安装KubeSphere。</p><p id="1ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在KubeSphere集群准备就绪之后，您可以通过使用kubectl编辑集群配置来将clusterRole的值设置为host:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="87df" class="mg kn iq mc b gy mh mi l mj mk">kubectl edit cc ks-installer -n kubesphere-system</span></pre><p id="4361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动并将clusterRole的值设置为host，然后单击Update(如果使用web控制台)使其生效:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="4b08" class="mg kn iq mc b gy mh mi l mj mk">multicluster:</span><span id="6749" class="mg kn iq mc b gy ml mi l mj mk">clusterRole: host</span></pre><p id="93a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存它，您需要等待一段时间，以便更改生效。安装完主机集群后，kubesphere-system中将创建一个名为<a class="ae kl" href="https://github.com/kubesphere/tower" rel="noopener ugc nofollow" target="_blank"> tower </a>的代理服务，其类型为LoadBalancer。</p><p id="117c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果集群有可用的LoadBalancer插件，您可以看到EXTERNAL-IP的相应地址，KubeSphere会自动获取该地址。这意味着您可以跳过设置代理的步骤。执行以下命令来检查服务。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="b5a4" class="mg kn iq mc b gy mh mi l mj mk">kubectl -n kubesphere-system get svcThe output may look as follows:</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/850867f7d0b3280417064083d5e276c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*q2gAhHP-QJ3Gs60V.png"/></div></div></figure><h1 id="04b2" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">准备两个成员集群</h1><p id="0781" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">开始之前，您需要在亚马逊EKS和数字海洋Kubernetes上安装一个最小的KubeSphere，详情请参见<a class="ae kl" href="https://kubesphere.io/docs/installing-on-kubernetes/hosted-kubernetes/install-kubesphere-on-eks/" rel="noopener ugc nofollow" target="_blank">在亚马逊EKS上部署kubes phere</a>和<a class="ae kl" href="https://kubesphere.io/docs/installing-on-kubernetes/hosted-kubernetes/install-kubesphere-on-do/" rel="noopener ugc nofollow" target="_blank">在数字海洋Kubernetes上部署kubes phere</a>。</p><p id="bd50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了管理主机集群中的成员集群，您需要使它们之间的<strong class="jp ir"> jwtSecret </strong>相同。因此，您需要首先通过以下命令从主机集群获取它。</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="ab64" class="mg kn iq mc b gy mh mi l mj mk">kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v “apiVersion” | grep jwtSecret</span></pre><p id="ec61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出可能如下所示:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="083b" class="mg kn iq mc b gy mh mi l mj mk">jwtSecret: “gfIwilcc0WjNGKJ5DLeksf2JKfcLgTZU”</span></pre><p id="f22d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经在亚马逊EKS和数字海洋Kubernetes上安装了KubeSphere，您可以通过编辑集群配置将<strong class="jp ir"> clusterRole </strong>的值设置为member。请注意，此步骤应分别在两个成员的集群中执行:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="c10a" class="mg kn iq mc b gy mh mi l mj mk">kubectl edit cc ks-installer -n kubesphere-system</span></pre><p id="35ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入对应的<strong class="jp ir"> jwtSecret </strong>如上图所示:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="f83f" class="mg kn iq mc b gy mh mi l mj mk">authentication:</span><span id="1cac" class="mg kn iq mc b gy ml mi l mj mk">jwtSecret: gfIwilcc0WjNGKJ5DLeksf2JKfcLgTZU</span></pre><p id="1e69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">向下滚动并将<strong class="jp ir"> clusterRole </strong>的值设置为member，然后单击Update(如果使用web控制台)使其生效:</p><pre class="lq lr ls lt gt mb mc md me aw mf bi"><span id="e6c8" class="mg kn iq mc b gy mh mi l mj mk">multicluster:</span><span id="1726" class="mg kn iq mc b gy ml mi l mj mk">clusterRole: member</span></pre><h1 id="ab0c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">将成员集群导入控制平面</h1><p id="89b7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">确保您已经为亚马逊EKS和数字海洋Kubernetes安装了双成员集群。然后，您就可以将这两个成员集群启动到主机集群中了。在本教程中，我们仅以将亚马逊EKS导入主机集群为例，导入数字海洋Kubernetes的步骤如下。</p><p id="583b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开主机集群仪表板并点击<strong class="jp ir">添加集群。</strong></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/53ebeebab7d8f0c490bb7b5ee2affad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wZJw3klZvgjRSGRA.png"/></div></div></figure><p id="46fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入要导入的集群的基本信息，点击<strong class="jp ir">下一步</strong>。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/493ea9d2a3c8a52f61798617e8a3fefb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zt5vw9CVvzIH2n9v.png"/></div></div></figure><p id="831e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在连接方法中，选择群集连接代理，然后单击导入。它将在控制台中显示由主机集群生成的代理部署。</p><p id="11c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据指令在成员集群中创建一个<strong class="jp ir"> agent.yaml </strong>文件，然后将代理部署复制粘贴到该文件中。在节点上执行<strong class="jp ir">ku bectl create-f agent . YAML</strong>，等待代理启动并运行。请确保成员群集可以访问代理地址。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/0d93bccf0d9f34cb9c5fb0202246b4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M2xtxaWd0gxGWrdT.png"/></div></div></figure><p id="3e7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当集群代理启动并运行时，您可以在主机集群中看到导入的集群。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/944d40c5632e88266ab901a3b2bc2e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YfbewSm-DG1ZV-ZK.png"/></div></div></figure><p id="e9f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从成员集群列表进入亚马逊EKS集群，您将能够看到该集群的概览仪表板，包括集群监控指标和日志记录。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/389e167ce31e8125bf7d49c147f40f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t7HaK2G5nCoyCx6T.png"/></div></div></figure><p id="7317" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你！现在亚马逊EKS已经由KubeSphere导入并管理，您现在应该能够将数字海洋Kubernetes导入其中。在两个成员的集群准备就绪后，在一个多云环境中分发云原生应用将变得非常容易，尽情享受吧！</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="edf7" class="km kn iq bd ko kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj bi translated">关于KubeSphere</h1><p id="c806" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">KubeSphere是一个基于Kubernetes的开源容器平台，其核心是应用程序。它提供全栈It自动化操作和简化的开发运维工作流。</p><p id="f4bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> KubeSphere </a>已被全球数千家企业采用，如<strong class="jp ir"> Aqara、新浪、奔来、中国太平、华夏银行、国药控股、微众银行、Geko Cloud、VNG公司、Radore </strong>。KubeSphere为运维提供向导界面和各种企业级功能，包括Kubernetes资源管理、<a class="ae kl" href="https://kubesphere.io/devops/" rel="noopener ugc nofollow" target="_blank">、DevOps (CI/CD) </a>、应用生命周期管理、服务网格、多租户管理、<a class="ae kl" href="https://kubesphere.io/observability/" rel="noopener ugc nofollow" target="_blank">监控</a>、日志记录、警报、通知、存储和网络管理以及GPU支持。有了KubeSphere，企业能够快速建立一个强大且功能丰富的容器平台。</p><p id="a9da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欲了解更多信息，请访问<a class="ae kl" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> https://kubesphere.io </a></p></div></div>    
</body>
</html>