<html>
<head>
<title>Oracle Always Free Cloud instances in HA configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle始终在高可用性配置中释放云实例</h1>
<blockquote>原文：<a href="https://itnext.io/oracle-always-free-cloud-instances-in-ha-configuration-e1d3dd59d3b1?source=collection_archive---------4-----------------------#2019-10-26">https://itnext.io/oracle-always-free-cloud-instances-in-ha-configuration-e1d3dd59d3b1?source=collection_archive---------4-----------------------#2019-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="96ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Oracle云始终免费提供，是部署最少应用程序或作为开发环境的绝佳资源。</p><p id="71a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将展示如何部署具有高可用性功能的极简双节点Docker Swarm集群。对于此解决方案，我选择了以下组件:</p><ul class=""><li id="0b80" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">Oracle-Linux-7.7–2019 . 09 . 25–0</li><li id="f943" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><a class="ae kz" href="https://docs.oracle.com/en/operating-systems/oracle-linux/gluster-storage/gluster-intro.html" rel="noopener ugc nofollow" target="_blank">面向Oracle Linux的Gluster存储</a></li><li id="2986" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">码头工人群</li></ul><p id="b453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">始终免费的云服务包括:</p><ul class=""><li id="3a69" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">2架<strong class="jp ir"> <em class="la"> VM。标准. E2.1 .微型</em>T5形状</strong></li></ul><blockquote class="lb lc ld"><p id="6591" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">1Gb内存</p><p id="dfaf" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">48 Gb引导磁盘</p><p id="df69" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">2核AMD EPYC 7551 32核处理器</p></blockquote><ul class=""><li id="3858" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">100的块卷(如果启动上述实例，将消耗96)</li><li id="ec69" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">2自治数据库</li><li id="1bb3" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">一个用于OLTP，包括:</li></ul><blockquote class="lb lc ld"><p id="a5b1" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">1个OCPU(两个内核)</p><p id="de0c" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">20Gb数据</p><p id="26d2" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">自动每日备份</p><p id="8b43" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">无自动缩放</p></blockquote><ul class=""><li id="9e0f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">一个用于DW:</li></ul><blockquote class="lb lc ld"><p id="e5e2" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">1个OCPU(两个内核)</p><p id="9290" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">20Gb数据</p><p id="6d27" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">没有后援</p><p id="f61f" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">无自动缩放</p></blockquote><ul class=""><li id="c83f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">一个负载均衡器—<strong class="jp ir"><em class="la">10 Mbps—微型</em> </strong></li></ul><p id="2936" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">面对这种情况，我们能做什么？，嗯很多！！。下图显示了我的部署</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/7cda195fb7c4b327297454495d2bfd3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*6B1pNhJG9KZFipPH6hf2bw.png"/></div></figure><p id="36e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看更多细节:</p><p id="9cd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="la">计算- &gt;实例- &gt;创建实例</em> </strong>步骤:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/81cce93303bb09b7b20e7d29f8addff6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*lQhJirH7Jav7sYbvxlA0Pg.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">实例名称和形状选择</figcaption></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/7ef70fbc9ac2aad9a61a721448afb785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Phy7b4bmyg2GxO4HwdAc-g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">检查始终免费合格</figcaption></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lz"><img src="../Images/2a5b40337bf009708f851e080d7b5800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vQUcogdOGmi2uWv3ei3Ag.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">显示形状、网络和存储选项-&gt;使用ssh启用公共IP访问</figcaption></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ma"><img src="../Images/4d63335bb05483b59f8e5b7e68726b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCzxA3tIPpTN80q2Bk9gDA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">从您的笔记本中选择一个ssh公钥</figcaption></figure><p id="3f7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重复以上创建node2的步骤，几分钟后您将开始运行计算实例:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mb"><img src="../Images/1b2b78a44816f63f23cb9ba02cea471e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wKLemBuP6PH_OXygGz8mQ.png"/></div></div></figure><p id="27fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装后脚本(为Oracle Linux添加<a class="ae kz" href="https://docs.oracle.com/en/operating-systems/oracle-linux/gluster-storage/gluster-intro.html" rel="noopener ugc nofollow" target="_blank"> Gluster存储</a>)，节点1步骤作为根:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="a6b7" class="mh mi iq md b gy mj mk l ml mm"># cat /etc/hosts<br/>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br/>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br/>10.0.1.16 node2 remote<br/># firewall-cmd --permanent --zone=public --add-port=24007-24008/tcp<br/># firewall-cmd --permanent --zone=public --add-port=24007-24008/udp<br/># firewall-cmd --permanent --zone=public --add-port=49152-49156/tcp<br/># firewall-cmd --permanent --zone=public --add-port=49152-49156/udp<br/># firewall-cmd --reload<br/># cd /home/<br/># yum -y update<br/># yum install -y oracle-gluster-release-el7<br/># yum-config-manager --enable ol7_gluster5 ol7_addons ol7_latest ol7_optional_latest ol7_UEKR5<br/># dd if=/dev/zero of=fs.img count=0 bs=1 seek=20G<br/># mkfs.xfs -f -i size=512 -L glusterfs fs.img<br/># mkdir -p /data/glusterfs/myvolume/mybrick<br/># echo '/home/fs.img /data/glusterfs/myvolume/mybrick xfs defaults  0 0' &gt;&gt; /etc/fstab<br/># mount -a &amp;&amp; df<br/># yum install -y glusterfs-server<br/># systemctl enable --now glusterd</span></pre><blockquote class="lb lc ld"><p id="bd52" class="jn jo la jp b jq jr js jt ju jv jw jx le jz ka kb lf kd ke kf lg kh ki kj kk ij bi translated">由于卷磁盘使用的限制，我们削减了20Gb的引导卷，并将其专用于使用Gluster FS的共享镜像存储。</p></blockquote><p id="5c06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在node2上执行类似的步骤，除了/etc/hosts，如下所示:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="ce2a" class="mh mi iq md b gy mj mk l ml mm"># cat /etc/hosts<br/>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br/>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br/>10.0.1.15 node1 remote</span></pre><p id="a8ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Oracle云上配置软件定义的防火墙<br/>网络- &gt;虚拟云网络- &gt;虚拟云网络详细信息- &gt;安全列表(入口规则)</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/3ec814301bda00c5f59be3bd8845ec7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73D1eCIm_xZL2fgHJZVWew.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">允许启用Docker Swarm和GlusterFS的端口</figcaption></figure><p id="6cda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">准备<strong class="jp ir"> <em class="la"> Gluster FS </em> </strong>集群，以节点1为根:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="c9c1" class="mh mi iq md b gy mj mk l ml mm"># gluster peer probe node2<br/># gluster peer status<br/># gluster pool list<br/>UUID     Hostname  State<br/>c1b9cfd0-6e2f-425a-b3da-46803c6312c7 node2     Connected <br/>54746d21-d1e2-4030-b58c-54a45f22fa3c localhost Connected <br/># gluster volume create myvolume replica 2 node{1,2}:/data/glusterfs/myvolume/mybrick/brick<br/># gluster volume start myvolume<br/># gluster volume info</span></pre><p id="f781" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在节点1和节点2上装载复制的存储:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="42b0" class="mh mi iq md b gy mj mk l ml mm"># mkdir /gluster-storage<br/># echo "localhost:/myvolume /gluster-storage glusterfs defaults,_netdev 0 0" &gt;&gt; /etc/fstab<br/># mount /gluster-storage &amp;&amp; df -h</span></pre><p id="0477" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在节点1和节点2上安装Docker Swarm集群:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="b8dd" class="mh mi iq md b gy mj mk l ml mm"># yum install docker-engine<br/># systemctl enable --now docker<br/># firewall-cmd --permanent --zone=public --add-port=2377/tcp<br/># firewall-cmd --reload<br/># docker swarm init --advertise-addr ens3</span></pre><p id="f941" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">初始化节点1上的群集群:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="fd8e" class="mh mi iq md b gy mj mk l ml mm"># docker swarm init --advertise-addr ens3<br/># docker swarm join-token manager</span></pre><p id="acae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在节点node2上使用加入令牌:</p><pre class="li lj lk ll gt mc md me mf aw mg bi"><span id="3090" class="mh mi iq md b gy mj mk l ml mm"># docker swarm join --token SWMTKN-1-3ud0gg60omt194qnu5fxht9qnuhz7zs6v0wt1pcmj3h1cxcacl-d6536ldpb7ijzx7j9iqly8vlv 10.0.1.15:2377</span></pre><p id="f0d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="la">Gluster FS</em></strong>over<strong class="jp ir"><em class="la">XFS</em></strong>基本性能测试本地、读写、并行或顺序。</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mn"><img src="../Images/0701f2f2b75c76666320531263012f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWVxiJPsH6VmLiFa5cZuOA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">使用带有直接标志的dd的单位(MB/s)</figcaption></figure><p id="e00b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，在进行并行写入时，两个节点都在复制的目录上写入，这可能是因为写入了一些额外的元数据，使两个目录同步。</p><p id="3a42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过上述配置，我们可以部署多个应用程序，并提供高可用性支持，例如，让Docker群节点处于耗尽状态进行维护，我们的应用程序将保持运行。</p><p id="0e6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一篇文章将提供在上述集群中部署多个服务的示例，包括，请参见屏幕截图:</p><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mo"><img src="../Images/785fff7706f7d38a772459f0d9abfbf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7xl4p28X0hubnom0ELdow.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">服务启动并运行nginx(复制)portainer和带有UI的私有注册中心</figcaption></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mp"><img src="../Images/ad4525a304cfb162640bd33a87d8d22e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4Z75bdKJXgkPTaF_y3JtQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">使用Portainer进行集群UI管理。超正析象管(Image Orthicon)</figcaption></figure><figure class="li lj lk ll gt lm gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mq"><img src="../Images/d4e6ddffd6b2558748684171acdddcad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n7hsawNB14kcXoDvflIyTw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">带有用户界面和复制存储的专用docker注册表</figcaption></figure></div></div>    
</body>
</html>