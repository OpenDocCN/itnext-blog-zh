<html>
<head>
<title>How to build react-native bridge and get PDF Viewer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建react-native桥并获得PDF查看器</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-react-native-bridge-and-get-pdf-viewer-44614f11e08e?source=collection_archive---------2-----------------------#2018-04-24">https://itnext.io/how-to-build-react-native-bridge-and-get-pdf-viewer-44614f11e08e?source=collection_archive---------2-----------------------#2018-04-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3d0a3c16a3154518debfdef223a0b53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7aJPlxn8gwhI7JjcBFr-tQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/fPkvU7RDmCo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">卡斯帕·鲁宾</a>在<a class="ae kc" href="https://unsplash.com/search/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c85a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React Native允许使用JavaScript语言构建本地应用程序，并提供大量组件和功能。但有些组件或功能在默认情况下不可用。有时有必要提高某些组件的性能。在这些情况下，可以使用本机实现。</p><p id="09c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文描述了如何在JavaScript和原生实现之间架起一座桥梁，并提供了一个如何为React Native构建<a class="ae kc" href="https://www.npmjs.com/package/react-native-view-pdf" rel="noopener ugc nofollow" target="_blank"> PDF查看器</a>以呈现PDF文档的示例。</p><p id="3cb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有源均可在gitlab中获得或作为NPM包获得:</p><ul class=""><li id="7706" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">https://www.npmjs.com/package/react-native-view-pdfNPM包<a class="ae kc" href="https://www.npmjs.com/package/react-native-view-pdf" rel="noopener ugc nofollow" target="_blank"> react-native-view-pdf </a></li><li id="0acd" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Gitlab来源<a class="ae kc" href="https://github.com/rumax/react-native-PDFView" rel="noopener ugc nofollow" target="_blank">rumax/react-native-pdf view【https://github.com/rumax/react-native-PDFView</a><a class="ae kc" href="https://github.com/rumax/react-native-PDFView" rel="noopener ugc nofollow" target="_blank">T21</a></li></ul><p id="3e2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">先准备一个项目。打开终端并运行:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6141" class="ly lz iq lu b gy ma mb l mc md">$ create-react-native-app react-native-PDFView<br/>$ cd react-native-PDFView<br/>$ yarn eject</span></pre><p id="1f60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查项目是否有效:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b1af" class="ly lz iq lu b gy ma mb l mc md">$ yarn run android</span></pre><p id="8bb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并在IDE中打开它。我更喜欢<a class="ae kc" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank">原子</a>，因此在终端我可以做:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e0e9" class="ly lz iq lu b gy ma mb l mc md">$ atom .</span></pre><p id="b046" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开Android Studio，使用Java源代码。</p><p id="d763" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Android Studio中:</p><ul class=""><li id="ce30" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">创建新包<code class="fe me mf mg lu b">reactlibrary</code></li><li id="c9f0" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">创建新的Java类<code class="fe me mf mg lu b">PDFView</code>、<code class="fe me mf mg lu b">PDFViewManager</code>和<code class="fe me mf mg lu b">PDFViewPackage</code></li></ul><p id="a384" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据官方文档，<code class="fe me mf mg lu b">PDFViewPackage</code>应该实现<code class="fe me mf mg lu b">ReactPackage </code>，应该添加缺少的<code class="fe me mf mg lu b">createNativeModules</code>和<code class="fe me mf mg lu b">createViewManagers</code>方法:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="82e1" class="ly lz iq lu b gy ma mb l mc md">public class PDFViewPackage implements ReactPackage {<br/> @Override<br/> public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) {<br/> return Collections.emptyList();<br/> }</span><span id="f1e1" class="ly lz iq lu b gy mh mb l mc md">public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) {<br/> return Arrays.&lt;ViewManager&gt;asList(new PDFViewManager(reactContext));<br/> }<br/>}</span></pre><p id="1752" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Android Studio将突出显示一个错误<code class="fe me mf mg lu b">PDFViewManager cannot be applied to ...</code>，该错误必须通过实现<code class="fe me mf mg lu b">PDFViewManager</code>来修复。</p><p id="7d82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg lu b">PDFViewManager</code>应该扩展<code class="fe me mf mg lu b">SimpleViewManager&lt;PDFView&gt;</code>并实现缺失的方法:</p><ul class=""><li id="b3d1" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe me mf mg lu b">getName</code>哪个应该返回react类的名字</li><li id="ecf8" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><code class="fe me mf mg lu b">createViewInstance</code>是应该初始化查看器的地方</li></ul><p id="037d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码是:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c863" class="ly lz iq lu b gy ma mb l mc md">public class PDFViewManager extends SimpleViewManager&lt;PDFView&gt; {<br/> private static final String REACT_CLASS = "PDFView";<br/> private PDFView pdfView = null;<br/> private Context context;</span><span id="9c53" class="ly lz iq lu b gy mh mb l mc md">public PDFViewManager(ReactApplicationContext context) {<br/> this.context = context;<br/> }</span><span id="6299" class="ly lz iq lu b gy mh mb l mc md">@Override<br/> public String getName() {<br/> return REACT_CLASS;<br/> }</span><span id="63dc" class="ly lz iq lu b gy mh mb l mc md">@Override<br/> public PDFView createViewInstance(ThemedReactContext context) {<br/> if (pdfView == null) {<br/> pdfView = new PDFView(context);<br/> }</span><span id="e48f" class="ly lz iq lu b gy mh mb l mc md">return pdfView;<br/> }<br/>}</span></pre><p id="2d79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">错误是<code class="fe me mf mg lu b">PDFView</code>应该扩展<code class="fe me mf mg lu b">View</code>，这必须通过实现<code class="fe me mf mg lu b">PDFView</code>来修复。</p><p id="2dbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PDFView应该扩展<code class="fe me mf mg lu b">android.view.View</code>并且实现非常简单:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9533" class="ly lz iq lu b gy ma mb l mc md">public class PDFView extends android.view.View {<br/> private ThemedReactContext context;</span><span id="d14a" class="ly lz iq lu b gy mh mb l mc md">public PDFView(ThemedReactContext context) {<br/> super(context);<br/> this.context = context;<br/> }<br/>}</span></pre><p id="379f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，所有课程都已准备就绪，可以注册<code class="fe me mf mg lu b">PDFViewPackage</code>。</p><p id="119a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg lu b">MainApplication.java</code>中有<code class="fe me mf mg lu b">getPackages</code>方法。在<code class="fe me mf mg lu b">MainReactPackage</code>的正下方可以注册<code class="fe me mf mg lu b">PDFViewPackage</code>包:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2522" class="ly lz iq lu b gy ma mb l mc md">@Override<br/>protected List&lt;ReactPackage&gt; getPackages() {<br/> return Arrays.&lt;ReactPackage&gt;asList(<br/> new MainReactPackage(),<br/> new PDFViewPackage()<br/> );<br/>}</span></pre><p id="7749" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Java初始实现就绪！</p><p id="5d5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Atom中创建一个新文件夹<code class="fe me mf mg lu b">PDFView</code>并创建两个文件:</p><p id="5ecc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是主文件，其中需要PDFView react本地组件，并且必须定义组件接口:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="0b40" class="ly lz iq lu b gy ma mb l mc md">import { requireNativeComponent, ViewPropTypes } from 'react-native';<br/>import PropTypes from 'prop-types';</span><span id="ad16" class="ly lz iq lu b gy mh mb l mc md">const componentInterface = {<br/> name: 'PDFView',<br/> propTypes: {<br/> ...ViewPropTypes,<br/> },<br/>};</span><span id="979b" class="ly lz iq lu b gy mh mb l mc md">export default requireNativeComponent('PDFView', componentInterface);</span></pre><p id="0221" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此时，仅使用<code class="fe me mf mg lu b">ViewPropTypes</code>来检查组件是否被正确定义并可以使用。所有其他属性将在以后添加。</p><p id="0fae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该文件是可选的，可用作包装组件，处理错误/加载状态，或使用<a class="ae kc" href="https://flow.org/" rel="noopener ugc nofollow" target="_blank">流</a>类型等:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="935d" class="ly lz iq lu b gy ma mb l mc md">/* @flow */<br/>import React from 'react';</span><span id="f41d" class="ly lz iq lu b gy mh mb l mc md">import RNPDFView from './RNPDFView';</span><span id="f057" class="ly lz iq lu b gy mh mb l mc md">type Props = {};</span><span id="cd49" class="ly lz iq lu b gy mh mb l mc md">class PDFView extends React.Component&lt;Props, *&gt; {<br/> static defaultProps = {};</span><span id="c10a" class="ly lz iq lu b gy mh mb l mc md">constructor(props: Props) {<br/> super(props);<br/> }</span><span id="016a" class="ly lz iq lu b gy mh mb l mc md">render() {<br/> return &lt;RNPDFView {...this.props} /&gt;;<br/> }<br/>}</span><span id="a18c" class="ly lz iq lu b gy mh mb l mc md">export default PDFView;</span></pre><p id="b868" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">桥已经准备好，可以导入和使用了:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="1c29" class="ly lz iq lu b gy ma mb l mc md">import PDFView from './PDFView/index';</span><span id="b6e3" class="ly lz iq lu b gy mh mb l mc md">...</span><span id="1341" class="ly lz iq lu b gy mh mb l mc md">return (<br/> &lt;View style={styles.container}&gt;<br/> &lt;PDFView style={styles.pdfView} /&gt;<br/> &lt;/View&gt;<br/>);</span></pre><p id="b050" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为它在Java中实现了<code class="fe me mf mg lu b">android.view.View</code>，所以它也应该表现为一个<code class="fe me mf mg lu b">View</code> react-native组件。这可以通过定义样式来检查:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e38c" class="ly lz iq lu b gy ma mb l mc md">const styles = StyleSheet.create({<br/> pdfView: {<br/> height: 400,<br/> width: 300,<br/> backgroundColor: 'green',<br/> },<br/> ...</span></pre><p id="5a42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重启应用程序，你会看到一个绿色矩形，如下所示:</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="ab gu cl mi"><img src="../Images/491ecda4de153e7f46236d6e475c3c6d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*aOjQR6Ia1zevEsjr7Bd6Hw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">设计组件的样式</figcaption></figure><p id="8342" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，除了属性和回调，这就是桥的全部内容。如果不需要，已经可以用Java实现组件了。</p><p id="b4aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要实现PDF查看器，有必要了解:</p><ul class=""><li id="fa32" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><em class="mj">资源</em> —定义要渲染的资源的字符串值。可以是url、文件路径或base64数据</li><li id="a4fd" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><em class="mj">资源类型</em> —定义资源类型的字符串值</li></ul><p id="8127" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，从本地部分获得一些对JavaScript的反馈:</p><ul class=""><li id="59f8" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><em class="mj"> onError </em> —出错时必须调用的回调函数</li><li id="2307" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><em class="mj"> onLoad </em> —加载完成时必须调用的回调函数</li></ul><p id="4557" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg lu b">PDFView/RNPDFView.js</code>中，用上述属性扩展<code class="fe me mf mg lu b">componentInterface.propTypes</code>:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="66b1" class="ly lz iq lu b gy ma mb l mc md">const componentInterface = {<br/> name: 'PDFView',<br/> propTypes: {<br/> onError: PropTypes.func,<br/> onLoad: PropTypes.func,<br/> resource: PropTypes.string,<br/> resourceType: PropTypes.string,<br/> ...ViewPropTypes,<br/> },<br/>};</span></pre><p id="e0a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg lu b">PDFView/index.js</code>中进行相同的操作，但使用<em class="mj">流量</em>类型:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="aaa1" class="ly lz iq lu b gy ma mb l mc md">type Props = {<br/> onError: (Error) =&gt; void,<br/> onLoad: () =&gt; void,<br/> resource: string,<br/> resourceType: 'url' | 'base64' | 'file',<br/>};</span></pre><p id="0bf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并将方法<code class="fe me mf mg lu b">onError</code>定义为只传递来自组件的<code class="fe me mf mg lu b">nativeEvent</code>:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6280" class="ly lz iq lu b gy ma mb l mc md">onError: (error: Error) =&gt; void; // Flow type definition<br/>onError(event: any) {<br/> this.props.onError(event &amp;&amp; event.nativeEvent || new Error());<br/>}</span></pre><p id="bedc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要忘记在构造函数中绑定<code class="fe me mf mg lu b">this</code>:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="3a1f" class="ly lz iq lu b gy ma mb l mc md">constructor(props: Props) {<br/> super(props);<br/> this.onError = this.onError.bind(this);<br/>}</span></pre><p id="420e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有搞定<code class="fe me mf mg lu b">render</code>的方法:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="8318" class="ly lz iq lu b gy ma mb l mc md">render() {<br/> const { onError, ...remainingProps } = this.props;<br/> return &lt;RNPDFView {...remainingProps} onError={this.onError} /&gt;;<br/>}</span></pre><p id="8256" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还可以定义默认属性来简化组件的使用:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="55a5" class="ly lz iq lu b gy ma mb l mc md">static defaultProps = {<br/> onError: () =&gt; {},<br/> onLoad: () =&gt; {},<br/> resourceType: 'url',<br/>};</span></pre><p id="afee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">JavaScript实现现在已经完成。</p><p id="edbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">切换到<code class="fe me mf mg lu b">Android Studio</code>打开<code class="fe me mf mg lu b">PDFViewManager</code>类。在这里可以访问<code class="fe me mf mg lu b">JavaScript</code>中定义的所有属性。定义<code class="fe me mf mg lu b">resource</code>:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7627" class="ly lz iq lu b gy ma mb l mc md">@ReactProp(name = "resource")<br/>public void setResource(PDFView pdfView, String resource) {<br/> pdfView.setResource(resource);<br/>}</span></pre><p id="985b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg lu b">resourceType</code>也是一样(回调将在后面实现):</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="1a75" class="ly lz iq lu b gy ma mb l mc md">@ReactProp(name = "resourceType")<br/>public void setResourceType(PDFView pdfView, String resourceType) {<br/> pdfView.setResourceType(resourceType);<br/>}</span></pre><p id="2a75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PDFView类中的实现将是:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d821" class="ly lz iq lu b gy ma mb l mc md">private String resourceType;<br/>private String resource;<br/> <br/>public void setResource(String resource) {<br/> this.resource = resource;<br/>}</span><span id="156f" class="ly lz iq lu b gy mh mb l mc md">public void setResourceType(String resourceType) {<br/> this.resourceType = resourceType;<br/>}</span></pre><p id="40ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg lu b">PDFViewManager</code>中找到以下方法:</p><ul class=""><li id="3817" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe me mf mg lu b">onAfterUpdateTransaction</code>这是设置所有属性后组件应该呈现的位置:</li></ul><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="be6b" class="ly lz iq lu b gy ma mb l mc md">@Override<br/>public void onAfterUpdateTransaction(PDFView pdfView) {<br/> super.onAfterUpdateTransaction(pdfView);<br/> pdfView.render();<br/>}</span></pre><ul class=""><li id="836e" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe me mf mg lu b">onDropViewInstance</code>这是卸载React本地组件时调用的另一个方法。实现可以如下:</li></ul><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="bedf" class="ly lz iq lu b gy ma mb l mc md">@Override<br/>public void onDropViewInstance(PDFView pdfView) {<br/> super.onDropViewInstance(pdfView);<br/> pdfView.onDrop();<br/>}</span></pre><p id="6c16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用加载完成错误回调，必须传递此事件。打开<code class="fe me mf mg lu b">PDFView.java</code>并定义<code class="fe me mf mg lu b">loadComplete</code>和<code class="fe me mf mg lu b">onError</code>方法:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="275e" class="ly lz iq lu b gy ma mb l mc md">@Override<br/>public void loadComplete(int numberOfPages) {<br/> reactNativeEvent("onLoad", null);<br/>}</span><span id="67c3" class="ly lz iq lu b gy mh mb l mc md">@Override<br/>public void onError(Exception ex) {<br/> reactNativeEvent("onError", "error: " + t.getMessage());<br/>}</span></pre><p id="eddb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并实现<code class="fe me mf mg lu b">reactNativeEvent</code>方法。根据官方<a class="ae kc" href="http://facebook.github.io/react-native/docs/native-components-android.html" rel="noopener ugc nofollow" target="_blank">文件</a>应该是:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6fe4" class="ly lz iq lu b gy ma mb l mc md">private void reactNativeEvent(String eventName, String message) {<br/> WritableMap event = Arguments.createMap();<br/> event.putString("message", message);<br/> ReactContext reactContext = (ReactContext) this.getContext();<br/> reactContext<br/> .getJSModule(RCTEventEmitter.class)<br/> .receiveEvent(this.getId(), eventName, event);<br/>}</span></pre><p id="b5c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且在<code class="fe me mf mg lu b">PDFViewManager</code></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e55e" class="ly lz iq lu b gy ma mb l mc md">public Map getExportedCustomBubblingEventTypeConstants() {<br/> return MapBuilder<br/> .builder()<br/> .put(<br/> "onLoad",<br/> MapBuilder.of("phasedRegistrationNames", MapBuilder.of("bubbled", "onLoad"))<br/> )<br/> .put(<br/> "onError",<br/> MapBuilder.of("phasedRegistrationNames", MapBuilder.of("bubbled", "onError"))<br/> )<br/> .build();<br/>}</span></pre><p id="453e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">桥的实现已经准备好了！剩下唯一要做的就是实现<code class="fe me mf mg lu b">PDFViewer.java</code>。我使用了<a class="ae kc" href="https://github.com/barteksc/AndroidPdfViewer" rel="noopener ugc nofollow" target="_blank"> AndroidPdfViewer </a>实现，最终的解决方案你可以在<a class="ae kc" href="https://github.com/rumax/react-native-PDFView/blob/master/android/src/main/java/com/reactlibrary/PDFView.java" rel="noopener ugc nofollow" target="_blank">gitlab</a>(<a class="ae kc" href="https://github.com/rumax/react-native-PDFView" rel="noopener ugc nofollow" target="_blank">https://github.com/rumax/react-native-PDFView</a>)中找到。</p><p id="2b46" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">桥和PDF查看器的实现已经准备好了。定义您要呈现的文档:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="004b" class="ly lz iq lu b gy ma mb l mc md">&lt;View style={styles.container}&gt;<br/> &lt;PDFView<br/> style={styles.pdfView}<br/> onError={error =&gt; console.log('onError', error) }<br/> onLoad={() =&gt; console.log('onLoad') }<br/> resource="http://www.pdf995.com/samples/pdf.pdf" /&gt;<br/>&lt;/View&gt;</span></pre><p id="e92e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重新加载应用程序，您将获得PDF文档，而不是绿色矩形:</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="ab gu cl mi"><img src="../Images/4ac9f2700319fea41b424273223aaeb1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Ku33N0EerjWssachF3aOpg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">PDF查看器结果</figcaption></figure></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="5c20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mj">原载于2018年4月24日</em><a class="ae kc" href="https://medium.com/@m.rusynyk/how-to-build-react-native-bridge-and-get-pdf-viewer-153109e42948" rel="noopener"><em class="mj">【medium.com】</em></a><em class="mj">。</em></p></div></div>    
</body>
</html>