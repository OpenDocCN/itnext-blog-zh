# 特性标志:真正敏捷

> 原文：<https://itnext.io/feature-flags-be-truly-agile-820ff50294c?source=collection_archive---------1----------------------->

![](img/aa3822ad80569a83dbdf254fe5429ebb.png)

帕特里克·帕金斯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

## Scrum 和看板的重大流程变化

**特性标志**是一个非常简单但功能强大的想法，它允许应用程序的持续部署，而不会中断用户的生产，甚至业务也不会察觉。特性标志**是真正革命性的**和**完全** **修复了我的团队在敏捷开发过程中遇到的许多问题**。

**TL；dr** 功能标志将**部署**与**发布**分开。如果你甚至不知道分离的存在，那你就等着享受吧！

*本文是功能标志背后的“为什么”和业务原因。*

# 历史

我有快速解决问题的习惯。这让我在 scrum 团队中工作时陷入困境，因为我一直在寻找更多的工作。

过去，我大部分时间都是独自工作，但当我开始在团队中工作时，我的快节奏成为了一个巨大的限制因素。事实上，这对我的团队也不是好兆头，因为我不能在等待工作的时候无所事事。根据公司的不同，你也不应该为自己工作。这真是个难题。

我工作过的另一个团队通过完全去除 2 周的开发周期解决了 Scrum 的流水线问题。我把他们的过程比作看板。

我将他们的成功归因于多个开发管道并行工作。遗憾的是，这些管道发生在不同的分支中，因此您经常会遇到来自不同团队的代码更改，这些更改需要传播给其他所有人，但这通常会导致一些重大的合并冲突，有时，代码要么没有准备好投入生产，要么业务部门还不想公开它。

# Scrum 烂透了(你在这里听到了，伙计们)

在过去的 8 年里，我在很多地方使用过 scrum，唯一一次它没有减慢开发速度或者让每个人的生活一团糟的时候是只有一个开发人员参与项目的时候。事实上，那些项目也没有 2 周的开发周期；这些项目将在 2-4 周内开始并完成，之后变化很小。

在我工作过的许多地方，那些在 Scrum 上取得成功的公司是那些不这么做的公司。他们让开发人员工作，当事情完成后，他们把它交给客户。一旦业务开始改变优先事项，这就是在 2 周的系统中一切都变得不稳定的时候，老实说，这是每个公司，每个项目，所有的时间。特性标志解决了这个问题，但是下面会有更多的内容。

# 整夜合并代码和修补程序

合并意味着该分支的特性可能会直接进入生产。如果有人正在处理产品版本中的一个 bug，那么最好是测试最新的代码，因为这个 bug 可能已经被修复了，但是现在您面临的问题是，是选择用另一个分支热修复产品，还是尝试找出如何合并来自公司各个项目的所有最新代码。

这个问题在我所在的另一家公司得到了“解决”,在那里，每个人都在 master 上工作，这意味着你几乎永远无法部署；也就是说，直到所有的代码都很完美。祝你好运！这意味着你至少有 2 个代码库的工作副本。一个用于新开发，一个用于修补程序。你以前曾经不得不合并那些完全不同的分支吗？这些修补程序最终需要被推回到主代码库中，对吗？

从我的经验来看，它总是带来更多的麻烦。有些公司甚至会冻结代码，这可能需要一天或更长时间。这允许一个开发团队不间断地合并分支。我确定之后也不会有什么 bug 了。

太可怕了。想想看，25 名开发人员处于代码冻结状态，无法在超过一个工作日的时间里完成很多工作。这对一个公司来说要花多少钱？承包商一天都拿不到工资吗？我肯定他们会为此高兴的。

在任何时候，您今天工作的代码都可能被其他人的更改破坏，并且您甚至不会知道，直到您的更改得到部署。我知道有些人编写单元测试，但是从我所在的所有团队来看，只有少数人真正给了开发人员时间来完成它们。这要花费一家公司多少时间和金钱？

你自己可能也遇到过这些问题。你是怎么对付他们的？我使用了特征标志。

# 真实世界用例

在我的上一份工作中，它从开发人员(嗯，和我一起)开始使用特性标志作为构建配置的一部分，并迅速转移到客户团队和 API 团队的其他人。最终，整个公司都参与进来，这成了一件大事，以至于我们放弃了我的原型服务，并为第三方服务提供商付费。它改变了我们设置任务板的方式，彻底革新了我们的开发工作流程。

# 拉取请求

虽然拉请求很棒，但是它们会占用很多时间。有一个人，后来又有一个人，他们都有拉请求，而我几乎总是很少或没有评论。在这一点上，我决定如果我们让他们(和我自己)直接提交给 master 而不进行特性分支，这对我们所有人都是最好的。这听起来可能有点吓人，但是我们同意一个开发过程，我们使用相似的工具，我们有频繁的成对编码会议来处理主要的变化和定期的“来这里看看我在做什么”的时刻。

这大大加快了开发速度，实际上我在提交代码时遇到的问题要少得多，所以看起来拉请求更像是多余的。

另一方面，不属于我团队的其他开发人员偶尔会做出一些改变。在这种情况下，他们没有 master 的 push 权限，必须从一个特性分支给我一个 pull 请求。这确保了我必须在他们进来之前批准他们的更改，可能会弄乱代码库或带来不符合我们风格指南的代码。

其他团队成员的门控签入是我们防止许多深夜补丁的方法。由于我的团队知道我们的项目中正在发生什么，而其他人不知道，我们可以承诺掌握并让其他人经历一个彻底的审查过程。

事实上，我的团队不需要我的监督就可以提交，这意味着我只需要偶尔做一些来自其他团队成员的请求。这给了我足够的时间来仔细检查其他开发人员代码的长期实现细节。

# 我的第一个制作应用

虽然这在业内是一个相对较新的概念，但我早在 2011 年的第一个生产应用中就使用了类似的东西。虽然在此之前我为网站编写过代码，但我从未编写过应用程序，更不用说人们日常使用的程序了。那是音乐和节奏的游戏:[普尔森](https://pulsengame.com/game)。在那里，我有非常简单的标志用法，但这就是我如何从生产中保持我的开发构建，并确保我不必重新编译应用程序来触发它。

这很简单，只要使用一个`isDev`标志，并将条件放入代码库中就会用到它。每当我准备好公开一些东西时，我都会删除条件代码。

在某个时候，我甚至通过他们的测试版系统向 Steam 用户发布了开发版本，这样人们可以选择以发现新错误为代价来获得最新的功能。它允许我不断地部署变更，并且我不必在 Git 中创建一堆分支。我可以直接脱离 master 工作，并在开发新功能的过程中快速部署 bug 修复程序，而不会暴露任何正在进行的工作。

# 基于主干的开发

使用特性标志的主要部分是基于主干的开发。虽然这可能看起来像昔日的老 SVN 和 TFVC 的结构，有更多的事情要做。

使用特性标志，您仍然可以对拉请求进行分支，但是不能再多了。将所有内容保存在一个 master 分支中，您永远不必担心 master 会过时。

请随意合并分支之间的代码，因为无论如何(在大多数情况下)它们都是有特性标记的。其他人的代码破坏你的构建或你写的任何东西的可能性很小，当版本化应用程序时，版本实际上只是启用标志的集合。

# 一切的解决方案

特性标志和基于主干的开发一起解决了许多令人头疼的开发问题，实际上最终使整个公司的每个部门受益，包括销售部门。

## 开发商

使用特性标志最明显的好处是一般的开发用例。当每个人都在进行基于主干的开发时，无论你在做什么，你总能得到最新的代码和重构。合并冲突(尤其是那些持续数天、一切都中断的冲突)已经成为过去，您可以只做您需要的工作，而不必担心或注意生产周期。它是自由的。

## 质量保证

QA 测试人员可以与其他测试人员隔离测试他们的卡。这样，如果有什么东西没有通过 QA 或破坏了应用程序，只有那个 QA 人员会受到影响，并且只有在测试那个卡时才会受到影响。我见过无数这样的情况，qa 的测试环境发生了变化，但是由于一些严重的错误，没有人能够进行测试。有时候，这些错误可能需要一整天才能修复。

## 客户服务

在我工作的地方，我们有一个直接与客户打交道的客户服务团队。出现任何问题，他们都必须与我们的 BA 沟通，并且有一个创建卡片和确定优先级的过程。

有时，我们需要改变优先级，因为我们会带来一个新客户，他可能想要一些特殊的改变。在这种情况下，我们需要作为开发人员进行调整。有了特性标志之后的代码，我们可以把旧代码留在原来的地方，开始新代码(也有特性标志),新代码最终会更快发布。

我们甚至可以向特定的客户或用户发布特性或错误修复，因为这些改变实际上可能是错误的，谁知道呢！为了限制受影响用户的数量，我们能够限制接收新功能的客户端的数量。

## 生意

总的来说，业务(由执行官、利益相关者、可能还有股东和客户服务组成)决定了什么时候需要发布特性。如果已经部署好了，那么企业就可以安排时间、编写文档、创建培训视频，以及推广新功能，而不需要冻结代码或急于让客户了解最新的变化。

## 技术支持

由于我们的权限设置，我们的支持人员不一定会从功能标志中受益，但从理论上讲，他们可以与用户交谈，并仅为该用户关闭任何特定的标志，以查看是否会缓解问题。如果是这样的话，那么就需要将它向上传递，以便其他人可以为该客户端甚至整个生产环境关闭它。

即使技术支持不直接与用户特定的功能标志进行交互，他们仍然能够将该信息向上传递，其他人可以管理该标志。所有这些都不需要一次代码部署或服务器重启。

## 销售

你的销售团队在外面抢客户。如果，只是如果，你的销售人员出城炫耀你的产品和东西坏了怎么办？很糟糕，对吧？通常，您会希望专门为销售团队演示推出另一个环境，这样您就会知道它是完美的。但这不太可能。销售人员需要展示新的功能，你知道，今天向客户 X 销售时需要的功能；就现在。

用旗帜来拯救！您仍然只有一个您的销售人员正在使用的生产环境，但是由于特性标志，您的新特性只对一个特定的销售人员启用。现在，所有其他未测试的代码通常都是生产就绪的，因为销售团队永远不会看到它们。你保住了工作，你的销售团队拿到了佣金。大家都赢了！

# 坏事

当然会有一些问题出现在特性标志中，但是在将它们真正投入生产之前，没有真正的方法来衡量这种权衡的伟大之处。例如，特性标志从基于主干的开发中受益匪浅。如果你正在做特性分支，Git 流，或者其他方法，特性标志仍然会为你工作，但是它们肯定会导致一些更疯狂的合并冲突。

另一个问题是当你不使用特性标志时。一些错误与语法或其他奇怪的问题有关，比如你输入了错误的函数参数名，这影响了非类型语言。像那样的改变是不可能的。因此，虽然它在几乎所有情况下都有效，但有时情况并非如此，代码更改需要在不被标记的情况下被推送到生产环境中。

尽管如此，还是很少。通过标记其他所有功能，您可以确切地知道您的应用程序中发生了什么变化，而不必担心可能会给用户带来问题的大量完全不相关的变化。

# 结论

功能标志影响整个组织；不仅仅是开发商。而开发人员将从更加幸福的开发人员体验中获益最多(与家人在一起的时间很重要！)，实际上业务的每个部分，包括产品开发过程，都试图从功能标志的广泛使用中获益。你怎么能拒绝呢？

革命性的？算是吧。似乎很明显，对吗？“如果-否则”条件是编码 101，但伙计，当你全力以赴并从根本上改变你的工作流程时，这是一种非凡的感觉。它去掉了 scrum 的苦差事，取而代之的是“我终于可以完成工作了”。

欢迎来到未来！

# 更多阅读

如果你对更多与革命思想相关的话题感兴趣，你应该看看我的其他文章:

*   用食物表情符号制作便便
*   [加速 JavaScript 数组处理](/speed-up-javascript-array-processing-8d601c57bb0d)
*   [Redux-Observable 可以解决你的状态问题](https://medium.com/@Sawtaytoes/redux-observable-can-solve-your-state-problems-15b23a9649d7)
*   [处理缓存和 AJAX 竞争条件](/handling-cache-and-ajax-race-conditions-4cb152db8764)