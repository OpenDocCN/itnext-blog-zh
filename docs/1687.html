<html>
<head>
<title>Hyperparameter Optimization for the Iris Dataset in Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript中虹膜数据集的超参数优化</h1>
<blockquote>原文：<a href="https://itnext.io/hyperparameter-optimization-for-the-iris-dataset-in-javascript-81f81809275e?source=collection_archive---------8-----------------------#2019-01-01">https://itnext.io/hyperparameter-optimization-for-the-iris-dataset-in-javascript-81f81809275e?source=collection_archive---------8-----------------------#2019-01-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="bedb" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">背景</h1><p id="6620" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这学期我一直很忙，但是现在我在放寒假，我想我应该再做一个<a class="ae lj" href="https://hyperjs.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> HPJS </a>的例子。自从我的<a class="ae lj" href="https://medium.com/@martin_stoyanov/a-simple-example-with-hyperparametersjs-3b36edbe838f" rel="noopener">上一篇文章</a>以来，JS机器学习社区有了一些不错的更新。例如，Tensorflow最近发布了<a class="ae lj" href="https://github.com/tensorflow/tfjs-vis" rel="noopener ugc nofollow" target="_blank"> tfjs-vis </a>，它可以让你可视化关于你的模型的信息。在我看来，它与现有的tfjs模型配合得非常好，我已经在这个例子中使用了它。</p><p id="6468" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">对于这个例子，我将介绍如何使用<a class="ae lj" href="https://hyperjs.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> HPJS </a>来优化用于<a class="ae lj" href="https://en.wikipedia.org/wiki/Iris_flower_data_set" rel="noopener ugc nofollow" target="_blank"> iris </a>数据集的tfjs模型中的一些超参数(在这个例子中是优化器和层数)。如果你对<a class="ae lj" href="https://hyperjs.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> HPJS </a>不熟悉，我推荐阅读<a class="ae lj" href="https://medium.com/@martin_stoyanov/hpjs-hyperparameter-optimization-for-javascript-8f78aa7a3368" rel="noopener">这篇文章</a>了解一些背景知识。继续这个例子。</p><h1 id="c882" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">例子</h1><p id="e637" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lp">您可以在</em>  <em class="lp">这里运行示例并查看代码</em> <a class="ae lj" href="https://hyperjs.herokuapp.com/tensorflow/iris" rel="noopener ugc nofollow" target="_blank"> <em class="lp">。然而，我也粘贴了下面的代码。如果trainModel和modelOpt函数令人困惑，我推荐这篇文章</em></a><a class="ae lj" href="https://medium.com/@martin_stoyanov/a-simple-example-with-hyperparametersjs-3b36edbe838f" rel="noopener"><em class="lp"/></a><em class="lp">，在这篇文章中，我一步一步地用hpjs创建了一个简单的例子。</em></p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><p id="d934" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">该示例基于tensorflow团队的iris <a class="ae lj" href="https://github.com/tensorflow/tfjs-examples/tree/master/iris" rel="noopener ugc nofollow" target="_blank">示例</a>；我刚刚在它上面添加了hpjs超参数优化。需要记住的一点是:代码中提到“回调”的任何部分(第29行和第62行)在我们的例子中只用于用户界面，可以忽略。</p><p id="6ea9" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">正如我们在定义的搜索空间(第52行)中看到的，我们正在优化的超参数是层数和优化器:</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="87e6" class="mc jo iq ly b gy md me l mf mg">const space = { <br/>  optimizer: hpjs.choice([‘sgd’, ‘adam’, ‘adagrad’, ‘rmsprop’]),    <br/>  numLayers: hpjs.quniform(2, 5, 1),<br/>};</span></pre><p id="a276" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们在优化函数中实现随机层#如下所示(第12行):</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="5b10" class="mc jo iq ly b gy md me l mf mg">// adding random number of layers  <br/>for (let i = 0; i &lt; numLayers; i += 1) {      <br/>  model.add(tf.layers.dense({<br/>    inputShape: i === 0 ? [4] : [10], // input shape 4 for 1st layer     <br/>    activation: i === numLayers - 1 ? 'softmax' : 'sigmoid', <br/>    units: i === numLayers - 1 ? 3 : 10, // last layer is 3 units <br/>  }));  <br/>}</span></pre><p id="4afa" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">因为我们从搜索空间传入了随机的“numLayers”变量，所以for循环将运行这个次数。</p><p id="25a8" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">第一层的输入形状是4，因为我们给了每朵花4个数据点(萼片长和宽，花瓣长和宽)。</p><p id="7f33" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">对于激活fn，我们对最后一层使用softmax，如tensorflowjs' <a class="ae lj" href="https://github.com/tensorflow/tfjs-examples/blob/31fc6150bf8432326f344b12a5627f879486b73d/iris/index.js#L49" rel="noopener ugc nofollow" target="_blank">示例</a>所示。</p><p id="09cc" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">最后一层的单位设置为3，因为我们正在对3种花进行分类。</p><p id="5a8a" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">对于优化器，我们在编译时从优化器列表中选择(第22行),学习率为0.01:</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="b07e" class="mc jo iq ly b gy md me l mf mg">model.compile({    <br/>  loss: 'categoricalCrossentropy',    <br/>  metrics: ['accuracy'],    <br/>  optimizer: optimizers[optimizer](0.01), // line 22<br/>});</span></pre><p id="28b2" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在tfjs中，您可以将优化器设置为一个字符串或创建一个对象，以便传递学习率等参数。我们做第二个是为了和tensorflow团队的例子保持一致。因为在tfjs中你设置了一个类似“tf.train. <optimizer>”的优化器，所以我在第2行定义了一个对象，当我们在第22行调用它时，它会进行适当的转换。</optimizer></p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="0d2e" class="mc jo iq ly b gy md me l mf mg">const optimizers = {    <br/>  sgd: tf.train.sgd,    <br/>  adagrad: tf.train.adagrad,    <br/>  adam: tf.train.adam,    <br/>  adamax: tf.train.adamax,    <br/>  rmsprop: tf.train.rmsprop,  <br/>};</span></pre><p id="28ff" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这就是虹膜的具体内容。</p><p id="6919" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">您现在可以运行我们的<a class="ae lj" href="https://hyperjs.herokuapp.com/tensorflow/iris" rel="noopener ugc nofollow" target="_blank"> iris示例</a>，并看到我们已经使用<a class="ae lj" href="https://github.com/tensorflow/tfjs-vis" rel="noopener ugc nofollow" target="_blank"> tfjs-vis </a>来显示每次试验的损失、准确性和混淆矩阵等信息。目前，我们的tfjs-vis实现似乎是第一次使用React，所以如果你正在做一个类似的项目，在这里查看我们的代码<a class="ae lj" href="https://github.com/martin-stoyanov/hyperparameters-site/blob/9b2332da27a2b92535b48ce89378df0bb3f2b6f8/components/TrialsTable.js#L82" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/280567ef034facf379d864136de4a846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dApCqT6rC9qPW8WSf0f15g.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">在页面底部，点击每个试验的+号，查看损失、准确性和混淆矩阵</figcaption></figure><p id="5dfd" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在<a class="ae lj" href="https://hyperjs.herokuapp.com/tensorflow/iris" rel="noopener ugc nofollow" target="_blank">运行模型</a>很多次之后，似乎最佳优化器是adam和rmsprop，而最佳层数是3+。对于更深入的测试，您可以更改试验、时期和种子的数量(所有这些都在<a class="ae lj" href="https://hyperjs.herokuapp.com/tensorflow/iris" rel="noopener ugc nofollow" target="_blank">示例页</a>中解释)。</p><h1 id="f101" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="7050" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本文中，我们使用<a class="ae lj" href="https://hyperjs.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> hpjs </a>在iris数据集上优化了<a class="ae lj" href="https://js.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorflowJS </a>模型的一些超参数。优化的超参数是优化器和层数。</p><p id="b933" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">欢迎留下反馈并查看我们的<a class="ae lj" href="https://github.com/atanasster/hyperparameters" rel="noopener ugc nofollow" target="_blank"> github </a>页面和<a class="ae lj" href="https://hyperjs.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">网站</a>！</p></div></div>    
</body>
</html>