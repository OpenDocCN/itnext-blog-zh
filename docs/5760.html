<html>
<head>
<title>ArgoCD: declarative Projects, Applications, and ArgoCD deploy from Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ArgoCD:从Jenkins部署声明性项目、应用程序和ArgoCD</h1>
<blockquote>原文：<a href="https://itnext.io/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins-6dda3cf51f74?source=collection_archive---------2-----------------------#2021-05-19">https://itnext.io/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins-6dda3cf51f74?source=collection_archive---------2-----------------------#2021-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1a446629e8c022ba478ecb739487ffac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LydFAwy_HJjw8lGCsi1Iqg.png"/></div></div></figure><p id="9727" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在ArgoCD中，可以从WebUI、CLI创建应用程序、集群或存储库，也可以通过编写Kubernetes清单来创建，然后将清单传递给<code class="fe kw kx ky kz b">kubectl</code>来创建资源。</p><p id="8ac8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，应用程序是Kubernetes CustomResources，并在Kubernetes CRD <code class="fe kw kx ky kz b"><a class="ae la" href="https://github.com/argoproj/argo-cd/blob/master/manifests/crds/application-crd.yaml" rel="noopener ugc nofollow" target="_blank">applications.argoproj.io</a></code>中进行了描述:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="975c" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl get crd applications.argoproj.io<br/>NAME CREATED AT<br/>applications.argoproj.io 2020–11–27T15:55:29Z</span></pre><p id="98a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且可以在ArgoCD的名称空间中作为公共Kubernetes资源进行访问:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="cd29" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl -n dev-1–18-devops-argocd-ns get applications<br/>NAME SYNC STATUS HEALTH STATUS<br/>backend-app OutOfSync Missing<br/>dev-1–18-web-payment-service-ns Synced Healthy<br/>web-fe-github-actions Synced Healthy</span></pre><p id="533e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种方法能够在创建新的ArgoCD实例时创建所有必要的应用程序。例如，当我们在AWS Elastic Kubernetes服务上升级Kubernetes版本时，我们正在使用Jenkins、Ansible和Helm创建一个新的集群(查看<a class="ae la" href="https://rtfm.co.ua/en/aws-elastic-kubernetes-service-a-cluster-creation-automation-part-1-cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS Elastic Kubernetes服务:集群创建自动化，第1部分—云形成</a>和<a class="ae la" href="https://rtfm.co.ua/en/aws-elastic-kubernetes-service-a-cluster-creation-automation-part-2-ansible-eksctl/" rel="noopener ugc nofollow" target="_blank"> AWS Elastic Kubernetes服务:集群创建自动化，第2部分— Ansible，eksctl </a>了解更多详细信息)。我们在那里安装了所有必要的控制器和操作器，包括ArgoCD。</p><p id="7e1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过使用ArgoCD的声明性方法，我们还可以创建在新的EKS集群供应期间配置的所有应用程序和其他设置。</p><p id="59eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，我们现在的任务是创造:</p><ul class=""><li id="cb27" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated">具有名称空间后端和Web团队的角色和权限的项目</li><li id="7efd" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">应用程序——用于我们的后端和Web项目</li><li id="2933" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">存储库—为Github存储库设置身份验证</li></ul><p id="2f14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们通过手动创建清单和资源来了解它的一般工作方式，然后将它应用到Ansible角色，并创建一个Jenkins作业。</p><ul class=""><li id="1ef2" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Projects" rel="noopener ugc nofollow" target="_blank">项目</a></li><li id="825a" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Applications" rel="noopener ugc nofollow" target="_blank">应用</a></li><li id="0a49" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Repositories" rel="noopener ugc nofollow" target="_blank">储存库</a></li><li id="aa79" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Repository_Secret" rel="noopener ugc nofollow" target="_blank">储存库机密</a></li><li id="986e" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">詹金斯、安西布尔和阿尔戈德</li><li id="b3bd" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Ansible_Kubernetes_Secret" rel="noopener ugc nofollow" target="_blank">不可思议的库伯内特的秘密</a></li><li id="fd38" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/#Ansible_ArgoCD_Projects_and_Applications" rel="noopener ugc nofollow" target="_blank">可行的ArgoCD项目和应用</a></li><li id="01af" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">詹金斯</li></ul><h1 id="608c" class="md lk iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">项目</h1><p id="2902" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">文档— <a class="ae la" href="https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#projects" rel="noopener ugc nofollow" target="_blank">项目</a>。</p><p id="08a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要为我们的两个团队——后端和Wb——准备两个项目，每个项目都需要对使用的名称空间进行限制，并且必须为访问这些项目中的应用程序配置一个角色。</p><p id="6aca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用后端的项目创建一个新文件:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="fde6" class="lj lk iq kz b gy ll lm l ln lo">apiVersion: argoproj.io/v1alpha1<br/>kind: AppProject<br/>metadata:<br/>  name: backend<br/>  namespace: dev-1-18-devops-argocd-ns<br/>  finalizers:<br/>    - resources-finalizer.argocd.argoproj.io<br/>spec:<br/>  description: "Backend project"<br/>  sourceRepos:<br/>  - '*'<br/>  destinations:<br/>  - namespace: 'dev-1-18-backend-*'<br/>    server: <a class="ae la" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>  clusterResourceWhitelist:<br/>  - group: ''<br/>    kind: Namespace<br/>  namespaceResourceWhitelist:<br/>  - group: "*"<br/>    kind: "*"<br/>  roles:<br/>  - name: "backend-app-admin"<br/>    description: "Backend team's deployment role"<br/>    policies:<br/>    - p, proj:backend:backend-app-admin, applications, *, backend/*, allow<br/>    groups:<br/>    - "Backend"<br/>  orphanedResources:<br/>    warn: true</span></pre><p id="c24f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里:</p><ul class=""><li id="c677" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">sourceRepos</code>:允许从任何存储库部署到项目</li><li id="bc1c" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">destinations</code>:允许部署到的集群和其中的名称空间。在上面的例子中，我们使用了<em class="nf"> dev-1-18-backend-* </em>掩码，因此后端团队将被允许部署到从该掩码开始的任何名称空间，对于Web项目，我们将使用类似的掩码<em class="nf"> dev-1-18-web-* </em></li><li id="63d4" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">clusterResourceWhitelist</code>:在集群级别上，只允许创建名称空间</li><li id="431e" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">namespaceResourceWhitelist</code>:在名称空间级别允许创建任何资源</li><li id="fb36" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">roles</code>:创建一个<em class="nf">后端-应用-管理</em>角色，对这个项目中的应用程序有完全的访问权限。更多信息请参见<a class="ae la" href="https://rtfm.co.ua/en/argocd-users-access-and-rbac/" rel="noopener ugc nofollow" target="_blank"> ArgoCD:用户、访问和RBAC </a>和<a class="ae la" href="https://rtfm.co.ua/en/argocd-okta-integration-and-user-groups/" rel="noopener ugc nofollow" target="_blank"> ArgoCD: Okta集成和用户组</a></li><li id="56a3" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">orphanedResources</code>:启用陈旧资源通知，检查<a class="ae la" href="https://argoproj.github.io/argo-cd/user-guide/orphaned-resources/" rel="noopener ugc nofollow" target="_blank">孤立资源监控</a></li></ul><p id="1ab0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署它:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="f109" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl apply -f project.yaml<br/>appproject.argoproj.io/backend created</span></pre><p id="e38d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并检查:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="1976" class="lj lk iq kz b gy ll lm l ln lo">$ argocd proj get backend<br/>Name: backend<br/>Description: Backend project<br/>Destinations: &lt;none&gt;<br/>Repositories: *<br/>Whitelisted Cluster Resources: /Namespace<br/>Blacklisted Namespaced Resources: &lt;none&gt;<br/>Signature keys: &lt;none&gt;<br/>Orphaned Resources: enabled (warn=true)</span></pre><h1 id="2397" class="md lk iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">应用程序</h1><p id="2d7c" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">文档— <a class="ae la" href="https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#applications" rel="noopener ugc nofollow" target="_blank">应用</a>。</p><p id="f454" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们为后端项目中的测试应用程序添加一个清单:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="9012" class="lj lk iq kz b gy ll lm l ln lo">apiVersion: argoproj.io/v1alpha1<br/>kind: Application<br/>metadata:<br/>  name: backend-app<br/>  namespace: dev-1-18-devops-argocd-ns<br/>  finalizers:<br/>    - resources-finalizer.argocd.argoproj.io<br/>spec:<br/>  project: "backend"<br/>  source:<br/>    repoURL: <a class="ae la" href="https://github.com/projectname/devops-kubernetes.git" rel="noopener ugc nofollow" target="_blank">https://github.com/projectname/devops-kubernetes.git</a><br/>    targetRevision: DVPS-967-ArgoCD-declarative-bootstrap<br/>    path: tests/test-svc<br/>    helm:<br/>      parameters:<br/>      - name: serviceType<br/>        value: LoadBalancer<br/>  destination:<br/>    server: <a class="ae la" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>    namespace: dev-1-18-backend-argocdapp-test-ns<br/>  syncPolicy:<br/>    automated:<br/>      prune: false<br/>      selfHeal: false<br/>      allowEmpty: false<br/>    syncOptions:<br/>    - Validate=true<br/>    - CreateNamespace=true<br/>    - PrunePropagationPolicy=foreground<br/>    - PruneLast=true<br/>    retry:<br/>      limit: 5<br/>      backoff:<br/>        duration: 5s<br/>        factor: 2<br/>        maxDuration: 3m</span></pre><p id="0ee8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里:</p><ul class=""><li id="e812" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">finalizers</code>:设置从ArgoCD删除应用时删除所有Kubernetes资源(<em class="nf">级联删除</em>，参见<a class="ae la" href="https://argoproj.github.io/argo-cd/user-guide/app_deletion/" rel="noopener ugc nofollow" target="_blank">应用删除</a>)</li><li id="5a7c" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">project</code>:要添加应用程序的项目，该项目将为应用程序设置限制(名称空间、资源等)</li><li id="5096" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">source:</code>设置要部署的存储库和分支</li><li id="8d93" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">в <code class="fe kw kx ky kz b">helm.parameters</code> -设定舵图表的值(<code class="fe kw kx ky kz b">helm --set</code>)</li><li id="0278" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">destination</code>:要部署到的集群和名称空间。此处的命名空间必须在应用程序所属的项目中允许</li><li id="bf5c" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated"><code class="fe kw kx ky kz b">syncPolicy</code>:同步设置，检查<a class="ae la" href="https://argoproj.github.io/argo-cd/user-guide/auto_sync/" rel="noopener ugc nofollow" target="_blank">自动同步策略</a>和<a class="ae la" href="https://argoproj.github.io/argo-cd/user-guide/sync-options/" rel="noopener ugc nofollow" target="_blank">同步选项</a></li></ul><p id="3307" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，ArgoCD支持所谓的App of Apps，当您为一个将创建一组其他应用程序的应用程序创建清单时。我们不会使用它9)，但看起来很有趣，见<a class="ae la" href="https://argoproj.github.io/argo-cd/operator-manual/cluster-bootstrapping/" rel="noopener ugc nofollow" target="_blank">集群引导</a>。</p><p id="fa2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署应用程序:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="0b06" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl apply -f application.yaml<br/>application.argoproj.io/backend-app created</span></pre><p id="994b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一下:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="1e45" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl -n dev-1–18-devops-argocd-ns get application backend-app<br/>NAME SYNC STATUS HEALTH STATUS<br/>backend-app Unknown Healthy</span></pre><p id="a70a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">及其状态:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="97dd" class="lj lk iq kz b gy ll lm l ln lo">$ argocd app get backend-app<br/>Name: backend-app<br/>Project: backend<br/>Server: <a class="ae la" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>Namespace: dev-1–18-backend-argocdapp-test-ns<br/>URL: https://dev-1–18.argocd.example.com/applications/backend-app<br/>Repo: <a class="ae la" href="https://github.com/projectname/devops-kubernetes.git" rel="noopener ugc nofollow" target="_blank">https://github.com/projectname/devops-kubernetes.git</a><br/>Target: DVPS-967-ArgoCD-declarative-bootstrap<br/>Path: tests/test-svc<br/>SyncWindow: Sync Allowed<br/>Sync Policy: Automated<br/>Sync Status: Unknown<br/>Health Status: Healthy</span><span id="00f1" class="lj lk iq kz b gy ng lm l ln lo">CONDITION MESSAGE LAST TRANSITION</span><span id="0c27" class="lj lk iq kz b gy ng lm l ln lo">ComparisonError rpc error: code = Unknown desc = authentication required 2021–05–18 09:11:13 +0300 EEST<br/>OrphanedResourceWarning Application has 1 orphaned resources 2021–05–18 09:11:13 +0300 EEST</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/e4bfab88006d29fb30cf3b0ca2dfc266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fCZ-CfH9-nb6KjJW.png"/></div></div></figure><p id="10a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们有"<strong class="ka ir"><em class="nf">comparison error = authentic ation required</em></strong>"，因为ArgoCD不能连接到存储库，因为它是私有的。</p><p id="b082" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们转到存储库身份验证。</p><h1 id="432e" class="md lk iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">仓库</h1><p id="aad5" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">文档— <a class="ae la" href="https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#repositories" rel="noopener ugc nofollow" target="_blank">存储库</a>。</p><p id="d857" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">突然间，存储库被添加到<code class="fe kw kx ky kz b">argocd-cm</code> ConfigMap中，而不是一个专用的资源，比如应用程序或项目。</p><p id="88a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对我来说，没有太好的解决方案，如果一个开发人员想添加一个存储库，我必须给他访问“系统”配置图。</p><p id="dba4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，Git服务器的身份验证使用存储在ArgoCD的名称空间中的Kubernetes秘密，因此开发人员也需要访问那里。</p><p id="584a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管如此，ArgoCD仍然有办法通过使用相同的认证设置在Git服务器上对不同的存储库进行认证，参见<a class="ae la" href="https://argoproj.github.io/argo-cd/operator-manual/declarative-setup/#repository-credentials" rel="noopener ugc nofollow" target="_blank">存储库凭证</a>。</p><p id="f113" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">背后的想法是，我们可以为存储库设置一个“掩码”，即【https://github.com/projectname】<a class="ae la" href="https://github.com/projectname," rel="noopener ugc nofollow" target="_blank"><em class="nf"/>，</a>，并附加登录和密码或SSK私钥。然后，开发者可以设置一个像<a class="ae la" href="https://github.com/orgname/reponame," rel="noopener ugc nofollow" target="_blank"><em class="nf">【https://github.com/orgname/reponame】</em>，</a>和ArgoCD这样的库，将使用<em class="nf">github.com/projectname</em>掩码，并将在服务器上为<em class="nf">github.com/projectname/reponame</em>库执行认证。</p><p id="928f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这种方式，我们可以创建一个“单点认证”并且我们所有的开发人员都将使用它作为他们的存储库，因为我们所有的存储库都位于同一个Github组织<em class="nf"> orgname </em>。</p><h2 id="5010" class="lj lk iq bd me ni nj dn mi nk nl dp mm kj nm nn mq kn no np mu kr nq nr my ns bi translated">仓库机密</h2><p id="ca24" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">这里，我们将使用HTTPS和<a class="ae la" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token" rel="noopener ugc nofollow" target="_blank"> Github访问令牌</a>。</p><p id="9caa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到Github概要文件并创建一个令牌(最好为ArgoCD创建一个专用用户):</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/294a64da4a4342dc63a5019dbc187c76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VUw7j4dZWPtBdc30.png"/></div></div></figure><p id="5207" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">授予存储库权限:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/01066194783956fb76f75521ad5e6542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*873qYwJZnTLTSXn8.png"/></div></div></figure><p id="de7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在终端中用base64编码令牌，或者使用<a class="ae la" href="https://www.base64encode.org" rel="noopener ugc nofollow" target="_blank">https://www.base64encode.org</a>编码令牌:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="d30d" class="lj lk iq kz b gy ll lm l ln lo">$ echo -n ghp_GE***Vx911 | base64<br/>Z2h***xMQo=</span></pre><p id="2a77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和用户名:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="89f3" class="lj lk iq kz b gy ll lm l ln lo">$ echo -n username | base64<br/>c2V***eTI=</span></pre><p id="2e51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在ArgoCD名称空间中添加Kubernetes秘密:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="53d3" class="lj lk iq kz b gy ll lm l ln lo">apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: github-access<br/>  namespace: dev-1-18-devops-argocd-ns<br/>data:<br/>  username: c2V***eTI=<br/>  password: Z2h***xMQ==</span></pre><p id="6620" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建它:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="531b" class="lj lk iq kz b gy ll lm l ln lo">$ kubectl apply -f secret.yaml<br/>secret/github-access created</span></pre><p id="c8e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将其用途添加到<code class="fe kw kx ky kz b">argocd-cm</code>配置图:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="da5b" class="lj lk iq kz b gy ll lm l ln lo">...<br/>  repository.credentials: |<br/>    - url: <a class="ae la" href="https://github.com/orgname" rel="noopener ugc nofollow" target="_blank">https://github.com/orgname</a><br/>      passwordSecret:<br/>        name: github-access<br/>        key: password<br/>      usernameSecret:<br/>        name: github-access<br/>        key: username<br/>...</span></pre><p id="f94f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="4466" class="lj lk iq kz b gy ll lm l ln lo">$ argocd repocreds list<br/>URL PATTERN USERNAME SSH_CREDS TLS_CREDS<br/><a class="ae la" href="https://github.com/projectname" rel="noopener ugc nofollow" target="_blank">https://github.com/projectname</a> username false false</span></pre><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi gj"><img src="../Images/3169a1fdef09bb52fe665dff39a0ecde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qbgatkTv9e0_zcTX.png"/></div></div></figure><p id="9f12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并尝试同步应用程序:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="afb9" class="lj lk iq kz b gy ll lm l ln lo">$ argocd app sync backend-app<br/>…<br/>Message: successfully synced (all tasks run)<br/>GROUP KIND NAMESPACE NAME STATUS HEALTH HOOK MESSAGE<br/>Service dev-1–18-backend-argocdapp-test-ns test-svc Synced Progressing service/test-svc created</span></pre><h1 id="a365" class="md lk iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated">詹金斯、安西布尔和阿尔戈德</h1><p id="a2d3" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">现在是时候考虑自动化了。</p><p id="f5d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过使用类似于<a class="ae la" href="https://rtfm.co.ua/ansible-modul-community-kubernetes-i-ustanovka-helm-charta-s-externaldns/#Ansible_%D1%80%D0%BE%D0%BB%D1%8C" rel="noopener ugc nofollow" target="_blank"> Ansible: модуль社区的<code class="fe kw kx ky kz b">community.kubernetes</code>模块，我们从其舵图安装了ArgoCD，并具有Ansible角色。</a></p><p id="7815" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要创造的是:</p><ul class=""><li id="b848" class="lp lq iq ka b kb kc kf kg kj lr kn ls kr lt kv lu lv lw lx bi translated">向Ansible角色添加Github的秘密</li><li id="befc" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">在ArgoCD设置中需要添加<code class="fe kw kx ky kz b">repository.credentials</code></li><li id="cda8" class="lp lq iq ka b kb ly kf lz kj ma kn mb kr mc kv lu lv lw lx bi translated">为项目和应用程序清单创建目录，并在Ansible角色中添加将使用这些清单的<code class="fe kw kx ky kz b"><a class="ae la" href="https://docs.ansible.com/ansible/latest/collections/community/kubernetes/k8s_module.html" rel="noopener ugc nofollow" target="_blank">community.kubernetes.k8s</a></code>。通过这种方式，在新的ArgCD实例供应期间将自动创建应用程序，并且开发人员将能够自己添加新的应用程序</li></ul><h2 id="b622" class="lj lk iq bd me ni nj dn mi nk nl dp mm kj nm nn mq kn no np mu kr nq nr my ns bi translated">不可思议的库伯内特秘密</h2><p id="b75a" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">在变量文件中，在我们的例子中，这将是<code class="fe kw kx ky kz b">group_vars/all.yaml</code>，添加两个新变量并用<code class="fe kw kx ky kz b"><a class="ae la" href="https://rtfm.co.ua/ansible-ispolzovanie-vault-zashifrovannogo-xranilishha/" rel="noopener ugc nofollow" target="_blank">ansible-vault</a></code>加密它们。不要忘记在加密前将它们编码为base64:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="4393" class="lj lk iq kz b gy ll lm l ln lo">...<br/>argocd_github_access_username: !vault |<br/>          $ANSIBLE_VAULT;1.1;AES256<br/>          63623436326661333236383064636431333532303436323735363063333264306535313934373464<br/>          ...<br/>          3132663634633764360a666162616233663034366536333765666364643363336130323137613333<br/>          3636<br/>argocd_github_access_password: !vault |<br/>          $ANSIBLE_VAULT;1.1;AES256<br/>          61393931663234653839326232383435653562333435353435333962363361643634626664643062<br/>          ...<br/>          6239623265306462343031653834353562613264336230613466<br/>...</span></pre><p id="9014" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在角色任务中，在本例中为<code class="fe kw kx ky kz b">roles/argocd/tasks/main.yml</code>，添加秘密创建:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="2f5d" class="lj lk iq kz b gy ll lm l ln lo">...<br/>- name: "Create github-access Secret"<br/>  community.kubernetes.k8s:<br/>    definition:<br/>      kind: Secret<br/>      apiVersion: v1<br/>      metadata:<br/>        name: "github-access"<br/>        namespace: "{{ eks_env }}-devops-argocd-2-0-ns"<br/>      data:<br/>        username: "{{ argocd_github_access_username }}"<br/>        password : "{{ argocd_github_access_password }}"<br/>...</span></pre><p id="3513" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在舵图表中添加<code class="fe kw kx ky kz b">repository.credentials</code>的值，参见<a class="ae la" href="https://github.com/argoproj/argo-helm/blob/master/charts/argo-cd/values.yaml#L574" rel="noopener ugc nofollow" target="_blank"> values.yaml </a>:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="3037" class="lj lk iq kz b gy ll lm l ln lo">...<br/>- name: "Deploy ArgoCD chart to the {{ eks_env }}-devops-argocd-2-0-ns namespace"<br/>  community.kubernetes.helm:<br/>    kubeconfig: "{{ kube_config_path }}"<br/>    name: "argocd20"<br/>    chart_ref: "argo/argo-cd"<br/>    release_namespace: "{{ eks_env }}-devops-argocd-2-0-ns"<br/>    create_namespace: true<br/>    values:<br/>      ...<br/>      server:<br/>        service:<br/>          type: "LoadBalancer"<br/>          loadBalancerSourceRanges:<br/>            ...<br/>        config:<br/>          url: "https://{{ eks_env }}.argocd-2-0.example.com"<br/>          repository.credentials: |<br/>            - url: "https://github.com/projectname/"<br/>              passwordSecret:<br/>                name: github-access<br/>                key: password<br/>              usernameSecret:<br/>                name: github-access<br/>                key: username<br/>...</span></pre><h2 id="1ec3" class="lj lk iq bd me ni nj dn mi nk nl dp mm kj nm nn mq kn no np mu kr nq nr my ns bi translated">可行的ArgoCD项目和应用</h2><p id="5a15" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">创建目录来存储清单文件:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="f365" class="lj lk iq kz b gy ll lm l ln lo">$ mkdir -p roles/argocd/templates/{projects,applications/{backend,web}}</span></pre><p id="4626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe kw kx ky kz b">roles/argocd/templates/projects/</code>目录下为两个项目创建两个文件:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="53f4" class="lj lk iq kz b gy ll lm l ln lo">$ vim -p roles/argocd/templates/projects/backend-project.yaml.j2 roles/argocd/templates/projects/web-project.yaml.j2</span></pre><p id="f8e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">描述后端项目:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="def5" class="lj lk iq kz b gy ll lm l ln lo">apiVersion: argoproj.io/v1alpha1<br/>kind: AppProject<br/>metadata:<br/>  name: "backend"<br/>  namespace: "{{ eks_env }}-devops-argocd-2-0-ns"<br/>  finalizers:<br/>    - resources-finalizer.argocd.argoproj.io<br/>spec:<br/>  description: "Backend project"<br/>  sourceRepos:<br/>  - '*'<br/>  destinations:<br/>  - namespace: "{{ eks_env }}-backend-*"<br/>    server: "https://kubernetes.default.svc"<br/>  clusterResourceWhitelist:<br/>  - group: ''<br/>    kind: Namespace<br/>  namespaceResourceWhitelist:<br/>  - group: "*"<br/>    kind: "*"<br/>  roles:  <br/>  - name: "backend-app-admin"<br/>    description: "Backend team's deployment role"<br/>    policies:<br/>    - p, proj:backend:backend-app-admin, applications, *, backend/*, allow<br/>    groups:<br/>    - "Backend" <br/>  orphanedResources:<br/>    warn: true</span></pre><p id="ed39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对网页重复上述步骤</p><p id="a991" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和创建应用程序。</p><p id="d5e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加一个<code class="fe kw kx ky kz b">roles/argocd/templates/applications/backend/backend-test-app.yaml.j2</code>文件:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="512d" class="lj lk iq kz b gy ll lm l ln lo">apiVersion: argoproj.io/v1alpha1<br/>kind: Application<br/>metadata:<br/>  name: "backend-app-1"<br/>  namespace: "{{ eks_env }}-devops-argocd-2-0-ns"<br/>  finalizers:<br/>    - resources-finalizer.argocd.argoproj.io<br/>spec:<br/>  project: "backend"<br/>  source:<br/>    repoURL: "https://github.com/projectname/devops-kubernetes.git"<br/>    targetRevision: "DVPS-967-ArgoCD-declarative-bootstrap"<br/>    path: "tests/test-svc"<br/>    helm:<br/>      parameters:<br/>      - name: serviceType<br/>        value: LoadBalancer<br/>  destination:<br/>    server: "https://kubernetes.default.svc"<br/>    namespace: "{{ eks_env }}-backend-argocdapp-test-ns"<br/>  syncPolicy:<br/>    automated:<br/>      prune: true<br/>      selfHeal: false<br/>    syncOptions:<br/>    - Validate=true<br/>    - CreateNamespace=true<br/>    - PrunePropagationPolicy=foreground<br/>    - PruneLast=true<br/>    retry:<br/>      limit: 2</span></pre><p id="f1c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在任务结束时，添加这些清单应用程序—首先是项目，然后是应用程序:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="8e3d" class="lj lk iq kz b gy ll lm l ln lo">...<br/>- name: "Create a Backend project"<br/>  community.kubernetes.k8s:<br/>    kubeconfig: "{{ kube_config_path }}"<br/>    state: present<br/>    template: roles/argocd/templates/projects/backend-project.yaml.j2<br/>          <br/>- name: "Create a Web project"<br/>  community.kubernetes.k8s: <br/>    kubeconfig: "{{ kube_config_path }}"<br/>    state: present<br/>    template: roles/argocd/templates/projects/web-project.yaml.j2<br/>          <br/>- name: "Create Backend applications"<br/>  community.kubernetes.k8s:<br/>    kubeconfig: "{{ kube_config_path }}"<br/>    state: present<br/>    template: "{{ item }}"<br/>  with_fileglob:<br/>    - roles/argocd/templates/applications/backend/*.yaml.j2<br/><br/>- name: "Create Web applications"<br/>  community.kubernetes.k8s:<br/>    kubeconfig: "{{ kube_config_path }}"<br/>    state: present<br/>    template: "{{ item }}"<br/>  with_fileglob:<br/>    - roles/argocd/templates/applications/web/*.yaml.j2</span></pre><p id="84ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于应用程序，使用<code class="fe kw kx ky kz b"><a class="ae la" href="https://rtfm.co.ua/ansible-with_fileglob-kopirovanie-neskolkix-shablonov-iz-direktorii/" rel="noopener ugc nofollow" target="_blank">with_fileglob</a></code>从<code class="fe kw kx ky kz b">roles/argocd/templates/applications/</code>获取所有文件，因为计划为每个应用程序提供专用文件，以便于开发人员管理它们。</p><h2 id="bc63" class="lj lk iq bd me ni nj dn mi nk nl dp mm kj nm nn mq kn no np mu kr nq nr my ns bi translated">詹金斯</h2><p id="0b65" class="pw-post-body-paragraph jy jz iq ka b kb na kd ke kf nb kh ki kj nc kl km kn nd kp kq kr ne kt ku kv ij bi translated">参见<a class="ae la" href="https://rtfm.co.ua/jenkins-migraciya-rtfm-2-6-jenkins-pipeline-dlya-ansible/" rel="noopener ugc nofollow" target="_blank">詹金斯:миграция RTFM 2.6 —詹金斯管道для Ansible </a>和<a class="ae la" href="https://rtfm.co.ua/helm-poshagovoe-sozdanie-charta-i-deplojmenta-iz-jenkins/#Jenkins_job" rel="noopener ugc nofollow" target="_blank">赫尔姆:пошаговоесозданиечартаиелонивентаиз詹金斯</a>(不幸的是，两者都在俄罗斯)。</p><p id="435f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不会详细描述这一点，但简而言之，我们使用带有<code class="fe kw kx ky kz b">provision.ansibleApply()</code>函数调用的脚本化管道:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="8f88" class="lj lk iq kz b gy ll lm l ln lo">...<br/>            stage("Applly") {<br/>                // ansibleApply((playbookFile='1', tags='2', passfile_id='3', limit='4')<br/>                provision.ansibleApply( "${PLAYBOOK}", "${env.TAGS}", "${PASSFILE_ID}", "${EKS_ENV}")<br/>            }<br/>...</span></pre><p id="6963" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该函数如下:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="60cf" class="lj lk iq kz b gy ll lm l ln lo">...<br/>def ansibleApply(playbookFile='1', tags='2', passfile_id='3', limit='4') {<br/>        <br/>    withCredentials([file(credentialsId: "${passfile_id}", variable: 'passfile')]) {<br/><br/>        docker.image('projectname/kubectl-aws:4.5').inside('-v /var/run/docker.sock:/var/run/docker.sock --net=host') {<br/>            <br/>            sh """<br/>                aws sts get-caller-identity<br/>                ansible-playbook ${playbookFile} --tags ${tags} --vault-password-file ${passfile} --limit ${limit}<br/>            """ <br/>        }   <br/>    }<br/>}.<br/>...</span></pre><p id="9ef5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，通过Docker，我们用AWS CLI和Ansible为我们的映像构建了一个容器，它运行一个Ansible剧本，传递一个<code class="fe kw kx ky kz b">tag</code>，并执行必要的Ansible角色。</p><p id="e0e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在行动手册中，我们为每个角色设置了标记，因此只执行一个角色很容易:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="7bbf" class="lj lk iq kz b gy ll lm l ln lo">...<br/>    - role: argocd<br/>      tags: argocd, create-cluster<br/>...</span></pre><p id="65b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果，我们有一个带有这样参数的Jenkins作业:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/d2807bb77a0b652c0d31417f8da43ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/0*emAZtIpd59g8_exC.png"/></div></figure><p id="a1e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行它:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/fed84bcb44924b38fbb0ed8f1cc6a5e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QP2svJTm9VqVSGFl.png"/></div></div></figure><p id="e1f1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录到新的ArgoCD实例:</p><pre class="lb lc ld le gt lf kz lg lh aw li bi"><span id="bafb" class="lj lk iq kz b gy ll lm l ln lo">$ argocd login dev-1–18.argocd-2–0.example.com --name admin@dev-1–18.argocd-2–0.example.com</span></pre><p id="31e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查应用程序:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/c4de2701de2923a421fb73e1a1f099ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5ZPT3weZYcVRlLgh.png"/></div></div></figure><p id="bd39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成了。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="df5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nf">最初发布于</em> <a class="ae la" href="https://rtfm.co.ua/en/argocd-declarative-projects-applications-and-argocd-deploy-from-jenkins/" rel="noopener ugc nofollow" target="_blank"> <em class="nf"> RTFM: Linux、DevOps、系统管理</em> </a> <em class="nf">。</em></p></div></div>    
</body>
</html>