<html>
<head>
<title>AWS IoT, LoRa, and LoRaWAN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS IoT、LoRa和LoRaWAN</h1>
<blockquote>原文：<a href="https://itnext.io/aws-iot-lora-and-lorawan-ec073d7bdfa5?source=collection_archive---------4-----------------------#2020-08-27">https://itnext.io/aws-iot-lora-and-lorawan-ec073d7bdfa5?source=collection_archive---------4-----------------------#2020-08-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="17f7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用AWS物联网、LoRa和LoRaWAN近实时收集和分析物联网数据</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">帖子的音频版本</figcaption></figure><h1 id="40f8" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">介绍</h1><p id="b3be" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在ITNEXT最近发表的一篇文章中，<a class="ae mh" rel="noopener ugc nofollow" target="_blank" href="/lora-for-iot-1f91085c5917"> LoRa和LoRaWAN for IoT:LoRa和LoRaWAN协议用于物联网的低功耗广域网</a>入门，我们探索了如何使用<a class="ae mh" href="https://en.wikipedia.org/wiki/LoRa" rel="noopener ugc nofollow" target="_blank">LoRa</a>(<strong class="ln iu">Lo</strong>ng<strong class="ln iu">Ra</strong>nge)和LoRa wan协议在包含多个嵌入式传感器的物联网设备和物联网网关之间远距离传输和接收传感器数据。在这篇文章中，我们将使用AWS IoT将该架构扩展到云，AWS IoT是一套广泛而深入的物联网服务，从边缘到云。我们将使用AWS云平台安全地收集、传输和分析物联网数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/2c1d86e6518ef49f554e40a3da2368fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2bGG0jV6yicEOTftsV8nHQ.png"/></div></div></figure><h2 id="a3bf" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">洛拉和洛拉万</h2><p id="d135" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据<a class="ae mh" href="https://lora-alliance.org/resource-hub/what-lorawanr" rel="noopener ugc nofollow" target="_blank"> LoRa联盟</a>的说法，低功耗广域网(LPWAN)预计将支持预计用于物联网(IoT)的数十亿设备中的大部分。LoRaWAN的设计自下而上地优化了LPWANs的电池寿命、容量、范围和成本。LoRa和LoRaWAN允许不同类型行业的物联网设备进行远程连接。根据<a class="ae mh" href="https://en.wikipedia.org/wiki/LoRa" rel="noopener ugc nofollow" target="_blank">维基百科</a>，LoRaWAN为网络定义了通信协议和系统架构，而LoRa物理层则启用了远程通信链路。</p><h2 id="1528" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">AWS物联网</h2><p id="795f" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS将<a class="ae mh" href="https://aws.amazon.com/iot/" rel="noopener ugc nofollow" target="_blank"> AWS IoT </a>描述为一组托管服务，使<em class="nb">联网设备能够连接到AWS云，并让云中的应用程序与联网设备进行交互</em> AWS物联网服务涵盖三个类别:设备软件、连接和控制以及分析。</p><p id="22b9" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">在本帖中，我们将重点介绍三种AWS IOT服务，每个类别一种，包括AWS物联网设备SDK、AWS物联网核心和AWS物联网分析。根据AWS的说法，<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-sdks.html" rel="noopener ugc nofollow" target="_blank"> AWS物联网设备SDK</a>包括开源库和开发人员以及带有示例的移植指南，以帮助您在您选择的硬件平台上构建创新的物联网产品或解决方案。<a class="ae mh" href="https://aws.amazon.com/iot-core/" rel="noopener ugc nofollow" target="_blank"> AWS物联网核心</a>是一项托管云服务，可让互联设备轻松、安全地与云应用和其他设备进行交互。AWS物联网核心可以可靠、安全地处理消息并将其路由到AWS端点和其他设备。最后，<a class="ae mh" href="https://aws.amazon.com/iot-analytics/" rel="noopener ugc nofollow" target="_blank"> AWS物联网分析</a>是一款完全托管的物联网分析服务，专为物联网设计，可收集、预处理、丰富、存储和分析大规模的物联网设备数据。</p><p id="60ac" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">要了解更多关于AWS物联网的信息，特别是我们将在本文中探索的AWS物联网服务，我建议阅读我最近在《走向数据科学》上发表的文章<a class="ae mh" href="https://towardsdatascience.com/getting-started-with-iot-analytics-on-aws-5f2093bcf704" rel="noopener" target="_blank">开始使用AWS物联网分析</a>。</p><h1 id="67e0" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">硬件选择</h1><p id="fcfb" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在这篇文章中，我们将使用以下硬件。</p><h2 id="cfec" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">具有嵌入式传感器的物联网设备</h2><p id="aa35" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">一个Arduino单板微控制器将作为我们的物联网设备。2019年8月发布的3.3V支持人工智能的<a class="ae mh" href="https://store.arduino.cc/usa/nano-33-ble-sense-with-headers" rel="noopener ugc nofollow" target="_blank"> Arduino Nano 33 BLE感应</a>板(<a class="ae mh" href="https://www.amazon.com/Arduino-Nano-Sense-headers-Mounted/dp/B07WXKDVTL/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:36.00美元)，配备了来自Nordic Semiconductors的强大<a class="ae mh" href="https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF52840" rel="noopener ugc nofollow" target="_blank"> nRF52840 </a>处理器，运行频率为64 MHz的32位ARM Cortex-M4 CPU，1MB的CPU闪存，256KB的SRAM，以及一个<a class="ae mh" href="https://www.u-blox.com/en/product/nina-b3-series-open-cpu" rel="noopener ugc nofollow" target="_blank"> NINA-B306 </a>独立蓝牙5低</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nh"><img src="../Images/aeeb2a072f3866a5a2f74d0cfcdc2ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0uU3dH2K_WW9hdFwHANkw.jpeg"/></div></div></figure><p id="f39b" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">Sense包含一系列令人印象深刻的嵌入式传感器:</p><ul class=""><li id="d22a" class="ni nj it ln b lo nc lr nd lu nk ly nl mc nm mg nn no np nq bi translated">9轴惯性传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lsm9ds1.pdf" rel="noopener ugc nofollow" target="_blank"> LSM9DS1 </a> ): 3D数字线加速度传感器、3D数字<br/>角速度传感器、3D数字磁传感器</li><li id="e6dd" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">湿度和温度传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_HTS221.pdf" rel="noopener ugc nofollow" target="_blank"> HTS221 </a>):电容式数字相对湿度和温度传感器</li><li id="eb5c" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">气压传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lps22hb.pdf" rel="noopener ugc nofollow" target="_blank"> LPS22HB </a> ): MEMS纳米压力传感器:260–1260百帕(hPa)绝对数字输出气压计</li><li id="f345" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">麦克风(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_mp34dt05-a.pdf" rel="noopener ugc nofollow" target="_blank"> MP34DT05 </a> ): MEMS音频传感器全向数字麦克风</li><li id="0370" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">手势、接近度、光色和光强传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_av02-4191en_ds_apds-9960.pdf" rel="noopener ugc nofollow" target="_blank"> APDS9960 </a>):高级手势检测、接近度检测、数字环境光感测(ALS)和颜色感测(RGBC)。</li></ul><p id="2b58" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">Arduino Sense是一款出色的<a class="ae mh" href="https://www.amazon.com/Arduino-Nano-Sense-headers-Mounted/dp/B07WXKDVTL" rel="noopener ugc nofollow" target="_blank">低成本</a>单板微控制器，用于学习物联网传感器数据的收集和传输。</p><h2 id="b756" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网网关</h2><p id="aa28" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据<a class="ae mh" href="https://whatis.techtarget.com/definition/IoT-gateway" rel="noopener ugc nofollow" target="_blank"> TechTarget </a>的说法，物联网网关是一种物理设备或软件程序，充当云与控制器、传感器和智能设备之间的连接点。所有移动到云的数据都要通过网关，网关可以是专用的硬件设备或软件程序，反之亦然。</p><p id="2262" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">借用物联网的话来说，LoRa网关是设备和云之间的桥梁。设备使用LoRaWAN等低功耗网络连接到网关，而网关使用WiFi、以太网或蜂窝等高带宽网络连接到云。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/7b63e10beb5eefac04ce32c3fabe51ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*WsWG0oYyZAeYfGX2W_DxEg.png"/></div></figure><p id="322a" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">一台第三代<a class="ae mh" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 3 Model B+ </a>单板计算机(SBC)将作为我们的LoRa物联网网关。这款Raspberry Pi型号具有1.4GHz Cortex-A53 (ARMv8) 64位四核处理器片上系统(SoC)、1GB LPDDR2 SDRAM、双频无线局域网、蓝牙4.2 BLE和千兆以太网(<a class="ae mh" href="https://www.amazon.com/dp/B085DPFR3N" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:42.99美元)。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nh"><img src="../Images/928586a1a13c28897c4453d959edc5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GRsxsLcm9BvTiZ3dAV7vQ.jpeg"/></div></div></figure><h2 id="e18e" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">LoRa收发器模块</h2><p id="eb0f" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了在包含嵌入式传感器的物联网设备和物联网网关之间传输物联网传感器数据，我使用了REYAX <a class="ae mh" href="http://reyax.com/products/rylr896/" rel="noopener ugc nofollow" target="_blank"> RYLR896 </a> LoRa收发器模块(<a class="ae mh" href="https://www.amazon.com/gp/product/B07NB3BK5H/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:19.50美元x 2)。收发器模块通常被称为<a class="ae mh" href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter" rel="noopener ugc nofollow" target="_blank">通用异步收发器</a> (UART)。UART是用于异步串行通信的计算机硬件设备，其中数据格式和传输速度是可配置的。</p><p id="d97a" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">根据制造商REYAX的说法，<a class="ae mh" href="http://reyax.com/products/rylr896/" rel="noopener ugc nofollow" target="_blank"> RYLR896 </a>包含<a class="ae mh" href="https://www.semtech.com/products/wireless-rf/lora-transceivers/sx1276" rel="noopener ugc nofollow" target="_blank"> Semtech SX1276 </a>远程低功耗收发器。RYLR896模块提供超长距离扩频通信和高抗干扰性，同时最大限度地降低功耗。每个RYLR896模块包含一个小型PCB集成螺旋天线。该收发器工作在868和915 MHz频率范围。在本次演示中，我们将在北美以915 MHz进行传输。</p><p id="6f6c" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">Arduino Sense ( <em class="nb">物联网设备</em>)使用其中一个RYLR896模块(<em class="nb">显示在前</em>下方)传输数据。Raspberry Pi ( <em class="nb">物联网网关</em>)连接到另一个RYLR896模块(<em class="nb">显示在后</em>下方)，接收数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nx"><img src="../Images/37f4b83de17b365d1fbea016b66374bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IalZ9kqp0E3BCKlTdLJJfA.jpeg"/></div></div></figure><h2 id="d958" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">洛拉万保安公司</h2><p id="e711" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">RYLR896支持AES 128位数据加密。使用<a class="ae mh" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="noopener ugc nofollow" target="_blank">高级加密标准</a> (AES)，我们将使用32位十六进制数字密码(128位/ 4位/十六进制数字)对从物联网设备发送到物联网网关的数据进行加密。</p><h1 id="7f73" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">设置AWS资源</h1><p id="a7ca" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">首先，我们将在AWS云平台上创建必要的AWS物联网和相关资源。一旦这些资源到位，我们就可以继续配置物联网设备和物联网网关，以安全地将传感器数据传输到云。</p><p id="f4d5" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">这篇文章的所有源代码都在GitHub 上。使用以下命令git克隆项目的本地副本。</p><pre class="ki kj kk kl gt ny nz oa ob aw oc bi"><span id="6497" class="mp ku it nz b gy od oe l of og">git clone --branch master --single-branch --depth 1 --no-tags \<br/>    <a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/garystafford/iot-aws-lora-demo.git</a></span></pre><h2 id="fcfd" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">自动气象站云形成</h2><p id="858e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">CloudFormation模板<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/blob/master/cloudformation/iot-analytics.yaml" rel="noopener ugc nofollow" target="_blank"> iot-analytics.yaml </a>将创建一个包含以下资源的AWS IoT CloudFormation堆栈。</p><ul class=""><li id="1bec" class="ni nj it ln b lo nc lr nd lu nk ly nl mc nm mg nn no np nq bi translated">AWS物联网</li><li id="56d8" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">AWS物联网政策</li><li id="8786" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">AWS物联网核心主题规则</li><li id="7c42" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">AWS物联网分析渠道、管道、数据存储和数据集</li><li id="99de" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">AWS和λ权限</li><li id="1e3c" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">亚马逊S3桶</li><li id="0dfa" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">亚马逊SageMaker笔记本实例</li><li id="a148" class="ni nj it ln b lo nr lr ns lu nt ly nu mc nv mg nn no np nq bi translated">AWS IAM角色</li></ul><p id="6571" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">继续之前，请注意CloudFormation模板中使用的AWS资源所涉及的成本。要从附带的CloudFormation模板创建AWS CloudFormation堆栈，请执行以下AWS CLI命令。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="d485" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">最终的CloudFormation堆栈应该包含16个AWS资源。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/908d4c37d9586617130d53c3da7400cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5VLr8rZNsjhcRYfzYYJWfg.png"/></div></div></figure><h2 id="012a" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">额外资源</h2><p id="6752" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">不幸的是，AWS CloudFormation无法创建本次演示所需的所有AWS物联网资源。要完成AWS配置过程，请执行以下一系列AWS CLI命令，<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/blob/master/cloudformation/aws_cli_commands.md" rel="noopener ugc nofollow" target="_blank"> aws_cli_commands.md </a>。这些命令将创建剩余的资源，包括AWS物联网事物类型、事物组、事物计费组和X.509证书。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><h1 id="c82e" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">物联网设备配置</h1><p id="bfc8" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">部署AWS资源后，我们可以配置物联网设备和物联网网关。</p><h2 id="d5ea" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">Arduino草图</h2><p id="167f" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">对于那些不熟悉Arduino的人来说，一个<a class="ae mh" href="https://www.arduino.cc/en/tutorial/sketch" rel="noopener ugc nofollow" target="_blank">草图</a>就是一个程序的Arduino等价物。它是上传到非易失性闪存并在Arduino板上运行的代码单元。Arduino语言是一组C和C++函数。所有由<a class="ae mh" href="https://linux.die.net/man/1/avr-g++" rel="noopener ugc nofollow" target="_blank"> avr-g++ </a>编译器支持的标准C和C++结构都应该在Arduino中工作。</p><p id="a43a" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">对于本文，草图<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/blob/master/lora_iot_demo_aws/lora_iot_demo_aws.ino" rel="noopener ugc nofollow" target="_blank"> lora_iot_demo_aws.ino </a>包含使用LoRaWAN协议收集和安全传输环境传感器数据所需的代码，包括温度、相对湿度、气压、红、绿、蓝(RGB)颜色和环境光强度。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><h2 id="2681" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">AT命令</h2><p id="1205" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">与RYLR896远程调制解调器的通信是通过AT命令完成的。AT命令是用于控制调制解调器的指令。AT是<strong class="ln iu">在</strong>tension的缩写。每个命令行都以AT开头。这就是为什么调制解调器命令被称为at命令，根据<a class="ae mh" href="https://www.developershome.com/sms/atCommandsIntro.asp" rel="noopener ugc nofollow" target="_blank">开发者之家</a>。AT命令的完整列表可以从RYLR896产品页面以<a class="ae mh" href="http://reyax.com/wp-content/uploads/2020/01/Lora-AT-Command-RYLR40x_RYLR89x_EN.pdf" rel="noopener ugc nofollow" target="_blank"> PDF </a>格式下载。</p><p id="7590" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">为了有效地将环境传感器数据从物联网传感器传输到物联网网关，草图将传感器ID和传感器值连接在一个字符串中。该字符串将被纳入AT命令，发送到RYLR896 LoRa收发器模块。为了更容易解析物联网网关上的传感器数据，我们将使用竖线(|)来分隔传感器值，而不是逗号。根据REYAX的说法，LoRa有效载荷的最大长度约为330字节。</p><p id="89f0" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">下面，我们将看到一个AT命令的示例，该命令用于发送来自物联网传感器的传感器数据以及物联网网关收到的相应未加密数据。两者都包含LoRa发射器地址ID、有效载荷长度(在本例中为<em class="nb"> 62字节)和有效载荷。物联网网关接收的数据还有<a class="ae mh" href="https://en.wikipedia.org/wiki/Received_signal_strength_indication" rel="noopener ugc nofollow" target="_blank">接收信号强度指标</a> (RSSI)，和<a class="ae mh" href="https://en.wikipedia.org/wiki/Signal-to-noise_ratio" rel="noopener ugc nofollow" target="_blank">信噪比</a> (SNR)。</em></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oj"><img src="../Images/a7195ec2dd02156e292a24fc2cdb1556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x4arMkrDaa9Vd_63"/></div></div></figure><h2 id="604a" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">在物联网网关上接收数据</h2><p id="7181" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">Raspberry Pi将充当LoRa物联网网关，从物联网设备Arduino接收环境传感器数据，并将数据发送到AWS。Raspberry Pi运行一个Python脚本，<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/blob/master/python_scripts/rasppi_lora_receiver_aws.py" rel="noopener ugc nofollow" target="_blank">rasppi _ lora _ receiver _ aws . py</a>，它将从Arduino Sense接收数据，解密数据，解析传感器值，并将数据序列化为JSON有效载荷，最后，将有效载荷以MQTT协议消息的形式传输到AWS。该脚本使用Python串口扩展<a class="ae mh" href="https://pypi.org/project/pyserial/" rel="noopener ugc nofollow" target="_blank"> pyserial </a>，它封装了与RYLR896模块通信的串口访问。该脚本使用<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-sdks.html#iot-python-sdk" rel="noopener ugc nofollow" target="_blank"> AWS物联网设备SDK for Python v2 </a>与AWS通信。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><h2 id="29a3" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">运行物联网网关Python脚本</h2><p id="153e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了在Raspberry Pi上运行Python脚本，我们将使用一个助手shell脚本，<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/blob/master/python_scripts/rasppi_lora_receiver_aws.sh" rel="noopener ugc nofollow" target="_blank">rasppi _ lora _ receiver _ AWS . sh</a>。shell脚本有助于构造执行Python脚本所需的参数。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="f72c" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">为了运行helper脚本，我们执行以下命令，用您的端点替换输入参数AWS IoT端点。</p><pre class="ki kj kk kl gt ny nz oa ob aw oc bi"><span id="0697" class="mp ku it nz b gy od oe l of og">sh ./rasppi_lora_receiver_aws.sh \<br/>  a1b2c3d4e5678f-ats.iot.us-east-1.amazonaws.com</span></pre><p id="e856" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">您应该会看到控制台输出，如下所示。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ok"><img src="../Images/83573942afcfcc1851c0e6903843d96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D6uPn7SWugvjdZtjnbDNcg.png"/></div></div></figure><p id="df71" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">该脚本首先配置RYLR896模块，并将配置输出到日志文件<code class="fe ol om on nz b">output.log</code>。如果成功，我们应该会看到以下记录的调试信息。</p><pre class="ki kj kk kl gt ny nz oa ob aw oc bi"><span id="ba89" class="mp ku it nz b gy od oe l of og">DEBUG:root:Connecting to a1b2c3d4e5f6-ats.iot.us-east-1.amazonaws.com with client ID 'lora-iot-gateway-01'…<br/>DEBUG:root:Connecting to REYAX RYLR896 transceiver module…<br/>DEBUG:root:Connected!<br/>DEBUG:root:Address set? +OK<br/>DEBUG:root:Network Id set? +OK<br/>DEBUG:root:AES-128 password set? +OK<br/>DEBUG:root:Module responding? +OK<br/>DEBUG:root:Address: +ADDRESS=116<br/>DEBUG:root:Network id: +NETWORKID=6<br/>DEBUG:root:UART baud rate: +IPR=115200<br/>DEBUG:root:RF frequency: +BAND=915000000<br/>DEBUG:root:RF output power: +CRFOP=15<br/>DEBUG:root:Work mode: +MODE=0<br/>DEBUG:root:RF parameters: +PARAMETER=12,7,1,4<br/>DEBUG:root:AES128 password of the network: +CPIN=92A0ECEC9000DA0DCF0CAAB0ABA2E0EF</span></pre><p id="c43e" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">出于调试目的，该传感器数据也被写入日志文件。日志中的第一行(<em class="nb">显示在</em>下方)是通过LoRaWAN从物联网设备接收的原始解密数据。第二行是JSON序列化的有效负载，使用MQTT协议安全地发送到AWS。</p><pre class="ki kj kk kl gt ny nz oa ob aw oc bi"><span id="03b0" class="mp ku it nz b gy od oe l of og">DEBUG:root:b'+RCV=116,59,0447383033363932003C0034|23.46|41.89|99.38|230|692|833|1116,-48,39\r\n'</span><span id="38a7" class="mp ku it nz b gy oo oe l of og">DEBUG:root:{'ts': 1598305503.7041512, 'data': {'humidity': 41.89, 'temperature': 23.46, 'device_id': '0447383033363932003C0034', 'gateway_id': '00000000f62051ce', 'pressure': 99.38, 'color': {'red': 230.0, 'blue': 833.0, 'ambient': 1116.0, 'green': 692.0}}}</span><span id="0ffb" class="mp ku it nz b gy oo oe l of og">DEBUG:root:b'+RCV=116,59,0447383033363932003C0034|23.46|41.63|99.38|236|696|837|1127,-49,35\r\n'</span><span id="1dd3" class="mp ku it nz b gy oo oe l of og">DEBUG:root:{'ts': 1598305513.7918658, 'data': {'humidity': 41.63, 'temperature': 23.46, 'device_id': '0447383033363932003C0034', 'gateway_id': '00000000f62051ce', 'pressure': 99.38, 'color': {'red': 236.0, 'blue': 837.0, 'ambient': 1127.0, 'green': 696.0}}}</span><span id="6517" class="mp ku it nz b gy oo oe l of og">DEBUG:root:b'+RCV=116,59,0447383033363932003C0034|23.44|41.57|99.38|232|686|830|1113,-48,32\r\n'</span><span id="a189" class="mp ku it nz b gy oo oe l of og">DEBUG:root:{'ts': 1598305523.8556132, 'data': {'humidity': 41.57, 'temperature': 23.44, 'device_id': '0447383033363932003C0034', 'gateway_id': '00000000f62051ce', 'pressure': 99.38, 'color': {'red': 232.0, 'blue': 830.0, 'ambient': 1113.0, 'green': 686.0}}}</span><span id="3519" class="mp ku it nz b gy oo oe l of og">DEBUG:root:b'+RCV=116,59,0447383033363932003C0034|23.51|41.44|99.38|205|658|802|1040,-48,36\r\n'</span><span id="f4f9" class="mp ku it nz b gy oo oe l of og">DEBUG:root:{'ts': 1598305528.8890748, 'data': {'humidity': 41.44, 'temperature': 23.51, 'device_id': '0447383033363932003C0034', 'gateway_id': '00000000f62051ce', 'pressure': 99.38, 'color': {'red': 205.0, 'blue': 802.0, 'ambient': 1040.0, 'green': 658.0}}}</span></pre><h1 id="4ae2" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">AWS物联网核心</h1><p id="6910" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">基于Raspberry Pi的物联网网关将向<a class="ae mh" href="https://aws.amazon.com/iot-core/" rel="noopener ugc nofollow" target="_blank"> AWS物联网核心</a>注册。物联网核心允许用户快速安全地将设备连接到AWS。</p><h2 id="251f" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">东西</h2><p id="96ee" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">据AWS称，物联网核心可以可靠地扩展到数十亿台设备和数万亿条消息。注册设备在AWS物联网核心中被称为<em class="nb">物</em>。一个<em class="nb">事物</em>是一个特定设备或逻辑实体的表示。关于一个事物的信息作为JSON数据存储在<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-thing-management.html" rel="noopener ugc nofollow" target="_blank">注册表</a>中。</p><p id="1303" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">下面，我们看到一个由云形成创造的东西的例子。这个东西，<code class="fe ol om on nz b">lora-iot-gateway-01</code>，代表物理物联网网关。我们给物联网网关分配了一个物类型<code class="fe ol om on nz b">LoRaIoTGateway</code>，一个物组<code class="fe ol om on nz b">LoRaIoTGateways</code>，一个物计费组<code class="fe ol om on nz b">IoTGateways</code>。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/eda8df427736d966e3135c0fc7c17171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZ5UquP1rY1AAs83zqDTPQ.png"/></div></div></figure><p id="3246" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">在一个真实的物联网环境中，包含数百、数千甚至数百万的物联网设备、网关和传感器，这些分类机制，即事物类型、事物组和事物计费组，将有助于组织物联网资产。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/cd11469423825df0221d77eda83312da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvQRJDYXO7Ws0DYkJYc5HQ.png"/></div></div></figure><h2 id="ca32" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">设备网关和消息代理</h2><p id="5ee1" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">物联网核心提供了一个<a class="ae mh" href="https://aws.amazon.com/iot-core/features" rel="noopener ugc nofollow" target="_blank">设备网关</a>，管理所有活动设备连接。该网关目前支持MQTT、WebSockets和HTTP 1.1协议。在消息网关的背后是一个高吞吐量的发布/订阅<a class="ae mh" href="https://aws.amazon.com/iot-core/features" rel="noopener ugc nofollow" target="_blank">消息代理</a>，它以低延迟安全地向所有物联网设备和应用传输消息。下面，我们看到一个典型的AWS物联网核心架构，包含多个主题、规则和操作。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi op"><img src="../Images/bdb97522225f432ac75263292937cc2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DZJV9zKzpB6WehJ0lcyywg.png"/></div></div></figure><h2 id="b21f" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">AWS物联网安全性</h2><p id="30e7" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网核心提供相互认证和加密，确保AWS和设备之间交换的所有数据在默认情况下都是安全的。在演示中，使用端口443上带有<a class="ae mh" href="https://en.wikipedia.org/wiki/X.509" rel="noopener ugc nofollow" target="_blank"> X.509 </a>数字证书的<a class="ae mh" href="https://en.wikipedia.org/wiki/Transport_Layer_Security" rel="noopener ugc nofollow" target="_blank">传输层安全</a> (TLS) 1.2安全地发送所有数据。下面，我们看到一个分配给这个东西的X.509证书的例子，<code class="fe ol om on nz b">lora-iot-gateway-01</code>，它代表物理物联网网关。之前，使用AWS CLI生成的X.509证书和私钥安装在物联网网关上。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/de8bc365367487052ab49d86fa359719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hljSWavTWt4Rb666yH3lCQ.png"/></div></div></figure><p id="3a38" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">设备访问AWS上任何资源的授权由<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-policies.html" rel="noopener ugc nofollow" target="_blank"> AWS物联网核心政策</a>控制。这些策略类似于AWS IAM策略。下面，我们看到一个分配给物联网网关的AWS物联网核心策略<code class="fe ol om on nz b">LoRaDevicePolicy</code>的示例。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/d85d203a802087c0a2c42cdc28271eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgQckXygEjfDGolL80vOSw.png"/></div></div></figure><h2 id="480b" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">AWS物联网核心规则</h2><p id="050d" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">一旦从物联网网关收到MQTT消息(一件<em class="nb">事情</em>，我们使用<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rules.html" rel="noopener ugc nofollow" target="_blank"> AWS物联网规则</a>将消息数据发送到<a class="ae mh" href="https://docs.aws.amazon.com/iotanalytics/latest/APIReference/API_Channel.html" rel="noopener ugc nofollow" target="_blank"> AWS物联网分析通道</a>。规则使您的设备能够与AWS服务进行交互。分析规则，并基于MQTT主题流执行<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html" rel="noopener ugc nofollow" target="_blank">动作</a>。下面，我们看到一个将我们的消息转发到物联网分析渠道的示例规则。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/6c44d8c9617c863728df948fef61881d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzj__RFOnofnjyOzijkdaw.png"/></div></div></figure><p id="ccf4" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">规则查询语句是用标准结构化查询语言(SQL)编写的。规则查询的数据源是一个物联网主题。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><h1 id="53ad" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">AWS物联网分析</h1><p id="f40f" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析由五个主要组件组成:通道、管道、数据存储、数据集和笔记本。这些组件使您能够收集、准备、存储、分析和可视化您的物联网数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/854d4eb5ba86c4fd3e7b5ee2a9204ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ankgEIoTTwW87gQhtvvGxA.png"/></div></div></figure><p id="618a" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">下面，我们看到一个典型的AWS物联网分析架构。通过规则操作从AWS物联网核心接收物联网消息。<a class="ae mh" href="https://aws.amazon.com/quicksight" rel="noopener ugc nofollow" target="_blank">亚马逊QuickSight </a>提供商业智能、可视化。<a class="ae mh" href="https://aws.amazon.com/quicksight/features-ml" rel="noopener ugc nofollow" target="_blank">亚马逊QuickSight ML Insights </a>增加了异常检测和预测功能。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oq"><img src="../Images/580abf93181c30258628147e17edb2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7UidVZUdltbA_AxjMNmb1Q.png"/></div></div></figure><h2 id="624d" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网分析渠道</h2><p id="840f" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析通道将来自亚马逊S3、亚马逊Kinesis或亚马逊物联网核心等其他AWS来源的消息或数据纳入物联网分析。渠道为物联网分析管道存储数据。渠道和数据存储都支持将数据存储在您自己的亚马逊S3存储桶或物联网分析服务管理的S3存储桶中。在演示中，我们使用服务管理的S3存储桶。</p><p id="4937" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">创建频道时，您还可以决定保留数据的时间。在演示中，我们将数据保留期设置为21天。信道通常不用于数据的长期存储。通常，您只需在需要分析的时间段内将数据保留在通道中。对于物联网消息数据的长期存储，我建议使用AWS物联网核心规则向亚马逊S3发送原始物联网数据的副本，使用诸如<a class="ae mh" href="https://aws.amazon.com/kinesis/data-firehose/" rel="noopener ugc nofollow" target="_blank">亚马逊Kinesis Data Firehose </a>之类的服务。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/94f1639851bb1b2f9c5cd9049ec32e3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQTbyRRPZyMNswnZWp24HA.png"/></div></div></figure><h2 id="58dc" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网分析渠道</h2><p id="3aaa" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析管道使用来自一个或多个渠道的消息。管道在将消息存储到物联网分析数据存储之前，对其进行转换、过滤和丰富。管道由有序的活动列表组成。从逻辑上讲，您必须指定一个<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-datastore" rel="noopener ugc nofollow" target="_blank">Channel</a></code> ( <em class="nb">源</em>)和一个<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-datastore" rel="noopener ugc nofollow" target="_blank">Datastore</a></code> ( <em class="nb">目的地</em>)活动。或者，您可以在<code class="fe ol om on nz b">pipelineActivities</code>数组中选择多达23个附加活动。</p><p id="4f67" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">在我们的演示管道<code class="fe ol om on nz b">iot_analytics_pipeline</code>中，我们指定了三个额外的活动，包括<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-deviceregistryenrich" rel="noopener ugc nofollow" target="_blank">DeviceRegistryEnrich</a></code>、<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-filter" rel="noopener ugc nofollow" target="_blank">Filter</a></code>和<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-lambda" rel="noopener ugc nofollow" target="_blank">Lambda</a></code>。其他活动类型包括<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-math" rel="noopener ugc nofollow" target="_blank">Math</a></code>、<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-selectattributes" rel="noopener ugc nofollow" target="_blank">SelectAttributes</a></code>、<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-removeattributes" rel="noopener ugc nofollow" target="_blank">RemoveAttributes</a>,</code>和<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-addattributes" rel="noopener ugc nofollow" target="_blank">AddAttributes</a></code>。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/929c8d561f3a85fc6910ceba70d4cf4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aF8OLDw9Ku4T7eBuO55kzQ.png"/></div></div></figure><p id="79f1" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated"><code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-filter" rel="noopener ugc nofollow" target="_blank">Filter</a></code>活动确保传感器值不为空或有其他错误；如果为真，则消息被丢弃。<code class="fe ol om on nz b"><a class="ae mh" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-iotanalytics-pipeline-activity.html#cfn-iotanalytics-pipeline-activity-lambda" rel="noopener ugc nofollow" target="_blank">Lambda</a></code>管道活动执行<a class="ae mh" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>函数来转换管道中的消息。消息在事件对象中被发送到Lambda。消息被修改，事件对象被返回给活动。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/39561500cf8eb23b2eb1a4b9b723f766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xv_zbcZ4CVle7dLuHwq2uA.png"/></div></div></figure><p id="f839" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">基于Python的Lambda函数可以轻松处理典型的物联网数据转换任务，包括将<code class="fe ol om on nz b">temperature</code>从摄氏度转换为华氏度，<code class="fe ol om on nz b">pressure</code>从千帕(kPa)转换为英寸汞柱(inHg)，以及将12位RGBA值转换为8位颜色值(0–255)。Lambda函数还将所有值向下舍入到0到2个小数位之间的精度。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="119a" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">该演示的管道还通过来自物联网设备的AWS物联网核心<a class="ae mh" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-thing-management.html" rel="noopener ugc nofollow" target="_blank">注册表</a>的元数据丰富了物联网数据。元数据包括有关生成物联网数据的设备的附加信息，包括自定义属性，如LoRa收发器制造商和型号以及物联网网关制造商。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/eda8df427736d966e3135c0fc7c17171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nZ5UquP1rY1AAs83zqDTPQ.png"/></div></div></figure><p id="40e9" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">管道的一个显著特征是重新处理消息的能力。如果您对管道进行更改(这通常发生在数据准备阶段)，您可以重新处理相关通道中的任何或所有物联网数据，并覆盖数据集中的物联网数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/466f15a3aeb8696421e7133d0788a767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dKbqjPbpr52iVedW"/></div></div></figure><h2 id="f307" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网分析数据存储</h2><p id="750b" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析数据存储将AWS物联网分析管道中准备好的数据存储在一个完全托管的数据库中。渠道和数据存储都支持将物联网数据存储在您自己的亚马逊S3存储桶或物联网分析管理的S3存储桶中。在演示中，我们使用服务管理的S3存储桶将物联网数据存储在我们的数据存储库<code class="fe ol om on nz b">iot_analytics_data_store</code>。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/7b68f5c05561eeb0ffe769a50c5321c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHun1jS-k6UfM_ELzvkCig.png"/></div></div></figure><h2 id="22d7" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网分析数据集</h2><p id="5fc5" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析数据集通过使用标准SQL查询数据存储，自动为数据分析师提供定期的最新见解。使用cron表达式实现定期更新。在演示中，我们以15分钟的间隔更新我们的数据集<code class="fe ol om on nz b">iot_analytics_data_set</code>。时间间隔可以增加或减少，这取决于正在分析的物联网数据所需的“近实时”特性。</p><p id="e1ce" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">下面，我们在数据集的结果预览窗格中看到消息。请注意用于获取消息的SQL查询，它查询数据存储。您会记得，数据存储包含来自管道的转换后的消息。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/5ad15f88be8956623c13698c640db48a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jUCL_rn068dp4-uLQ763dA.png"/></div></div></figure><p id="e9a7" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">物联网分析数据集还支持将内容结果(物联网分析数据的物化视图)发送到亚马逊S3桶。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/7b68f5c05561eeb0ffe769a50c5321c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHun1jS-k6UfM_ELzvkCig.png"/></div></div></figure><p id="e937" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">CloudFormation堆栈创建了一个加密的亚马逊S3桶。每当<code class="fe ol om on nz b">cron</code>表达式运行计划更新时，该存储桶都会收到来自物联网分析数据集的消息副本。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/8758f39fedced4b2b5fed170e0268481.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iek3ssgckyZwCXNIj6jT9w.png"/></div></div></figure><h2 id="f3e5" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">物联网分析笔记本</h2><p id="0637" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">AWS物联网分析笔记本允许用户使用<a class="ae mh" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>对物联网分析数据集进行统计分析和机器学习。物联网分析笔记本服务包括一组笔记本模板，其中包含AWS创作的机器学习模型和可视化。笔记本实例可以链接到GitHub或其他源代码库。使用物联网分析笔记本创建的笔记本也可以通过<a class="ae mh" href="https://aws.amazon.com/sagemaker/" rel="noopener ugc nofollow" target="_blank">亚马逊SageMaker </a>直接访问。为了进行演示，笔记本实例是从我们项目的<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中克隆出来的。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/6f174ba6de621cc85b3fdc4991faea74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sn_EOgEUpKRTJkL3SMXbTA.png"/></div></div></figure><p id="fd9c" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">该存储库包含一个基于<code class="fe ol om on nz b">conda_python3</code>内核的示例Jupyter笔记本，<a class="ae mh" href="https://github.com/garystafford/aws-iot-analytics-demo/blob/master/notebooks/LoRa_IoT_Analytics_Demo.ipynb" rel="noopener ugc nofollow" target="_blank">LoRa _ IoT _ Analytics _ demo . ipynb</a>。这个预装环境包括默认的<a class="ae mh" href="https://www.anaconda.com/" rel="noopener ugc nofollow" target="_blank"> Anaconda </a>安装和Python 3。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/8c062bacfd83c31984ef51bbd80f8371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Vextf-T4_oXT4iAZUbwTw.png"/></div></div></figure><p id="cde2" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">该笔记本使用<a class="ae mh" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank"> pandas </a>、<a class="ae mh" href="https://matplotlib.org/" rel="noopener ugc nofollow" target="_blank"> matplotlib </a>和<a class="ae mh" href="https://plotly.com/python/" rel="noopener ugc nofollow" target="_blank"> plotly </a>来操作和可视化存储在物联网分析数据集中的样本物联网数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/4321dd0a3c9b6a998bf7ddc0663b6ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDC5sqaXwGjERjlgRIphsQ.png"/></div></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/d32f4ad9f05f48e461e46ef0c2c06a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_px9xOQiBkiucQOb4gGFw.png"/></div></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/9294e992c150dead3555f4bb50bf17e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hE5BpOV1doGhDRQPXEp5LQ.png"/></div></div></figure><p id="2684" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">笔记本可以修改，修改的内容推回到GitHub。您可以轻松地派生出演示的GitHub存储库，并修改CloudFormation模板以指向您的源代码存储库。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/3ceea6d06397ec47fb0646401f5bbcc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*civNnr4NjSlR6CX95dl3UA.png"/></div></div></figure><h1 id="a4c6" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">亚马逊QuickSight</h1><p id="eb9a" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated"><a class="ae mh" href="https://aws.amazon.com/quicksight" rel="noopener ugc nofollow" target="_blank">亚马逊QuickSight </a>提供商业智能(BI)和可视化。<a class="ae mh" href="https://aws.amazon.com/quicksight/features-ml" rel="noopener ugc nofollow" target="_blank">亚马逊QuickSight ML Insights </a>增加了异常检测和预测功能。我们可以使用Amazon QuickSight来可视化存储在物联网分析数据集中的物联网消息数据。</p><p id="2ddb" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">亚马逊QuickSight有标准版和企业版。AWS提供了每个版本详细的<a class="ae mh" href="https://aws.amazon.com/quicksight/pricing/?nc=sn&amp;loc=4" rel="noopener ugc nofollow" target="_blank">产品对比</a>。对于帖子，我正在演示企业版，它包括额外的<a class="ae mh" href="https://aws.amazon.com/quicksight/features" rel="noopener ugc nofollow" target="_blank">功能</a>，如ML Insights，每小时刷新<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/welcome.html#spice" rel="noopener ugc nofollow" target="_blank"> SPICE </a>(超快，并行，内存中，计算引擎)，以及主题定制。</p><p id="f804" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">如果您选择跟随演示的这一部分，请注意Amazon QuickSight的成本。虽然有一个Amazon QuickSight API，但在本演示中，Amazon QuickSight不会自动启用或配置CloudFormation或使用AWS CLI。</p><h2 id="b9b4" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">QuickSight数据集</h2><p id="4c08" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">Amazon QuickSight有各种各样的数据源选项来创建Amazon QuickSight数据集，包括下面显示的那些。不要混淆亚马逊QuickSight数据集和物联网分析数据集；它们是两种不同的服务功能。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/6653650e37b003bfe70c9eab5af38baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aoISIwVu0whWQaDuXvwmvw.png"/></div></div></figure><p id="b059" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">为了进行演示，我们将创建一个Amazon QuickSight数据集，该数据集将使用我们的物联网分析数据集<code class="fe ol om on nz b">iot_analytics_data_set</code>。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/c8b7f880349a36312edad9d2c4ae5567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KgfiZGF8jH0OOGeOPh1Ftw.png"/></div></div></figure><p id="bc19" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">Amazon QuickSight让您能够在可视化之前查看和修改QuickSight数据集。QuickSight甚至提供了各种各样的功能，使我们能够对字段值执行动态计算。在本次演示中，我们将保持数据不变，因为所有转换都已在物联网分析管道中完成。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/66f62c9a2eba59bf6c52bc15c859dc90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9iy9R9eQbP2I5JDa7e1Ow.png"/></div></div></figure><h2 id="2f52" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">快速视力分析</h2><p id="b929" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">使用从物联网分析数据集构建的QuickSight数据集作为数据源，我们创建了<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/working-with-analyses.html" rel="noopener ugc nofollow" target="_blank"> QuickSight分析</a>。QuickSight分析控制台如下所示。一个分析主要是视觉效果(也称为视觉类型)的集合。QuickSight提供了几种<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/working-with-visual-types.html" rel="noopener ugc nofollow" target="_blank">视觉类型</a>。每个图像都与一个数据集相关联。可以过滤QuickSight分析或分析中每个视觉的数据。为了演示，我创建了一个简单的QuickSight分析，包括一些典型的QuickSight视觉效果。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi or"><img src="../Images/61776ee42ccc8d3e35b22981b156b44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LINaiC31hRMS7XoQV0lmKg.png"/></div></div></figure><h2 id="81e6" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">QuickSight仪表盘</h2><p id="740c" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了分享QuickSight分析，我们可以创建一个<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/working-with-dashboards.html" rel="noopener ugc nofollow" target="_blank"> QuickSight仪表盘</a>。下面，我们将上面显示的QuickSight分析的几个视图作为仪表板。虽然仪表板的查看者不能编辑视觉效果，但是他们可以应用<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/filtering-visual-data.html" rel="noopener ugc nofollow" target="_blank">过滤</a>和交互式<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/adding-drill-downs.html" rel="noopener ugc nofollow" target="_blank">下钻</a>到视觉效果中的数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/91c2c23b2e4018fc476946e117f022de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47nfVCkjEZXCCKr3yeZhQw.png"/></div></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/87212d128c97676a9eddc130ee80433e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4NwK9rWPLNECMNN9g0WNHA.png"/></div></div></figure><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/815353c43d4020e4698ba34af314d191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3DGG1x2kv0k54Eg43QVSw.png"/></div></div></figure><h1 id="f366" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">亚马逊QuickSight ML洞察</h1><p id="019e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">据<a class="ae mh" href="https://aws.amazon.com/quicksight/features-ml/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>报道，ML Insights利用AWS的机器学习(ML)和自然语言能力，从数据中获得更深入的见解。QuickSight的ML-powered异常检测不断分析数据，以发现聚合内部的异常和变化，让您能够在业务发生变化时采取行动。QuickSight的ML-powered预测可用于准确预测您的业务指标，并通过简单的点击操作执行交互式假设分析。QuickSight的内置算法使任何人都可以轻松地使用从您的数据模式中学习的ML，为您提供基于历史趋势的准确预测。</p><p id="ffa2" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">下面，我们在演示的QuickSight分析中看到ML Insights选项卡(<em class="nb">左</em>)。可将单独检测到的异常添加到QuickSight分析中，如视觉效果，并通过<a class="ae mh" href="https://docs.aws.amazon.com/quicksight/latest/user/anomaly-detection-using.html" rel="noopener ugc nofollow" target="_blank">配置</a>来调整检测参数。观察温度、湿度和大气压力异常，由ML Insights根据其异常分数识别，该分数较高或较低，给定5%的最小差值。这些异常准确地反映了物联网设备的实际故障，该故障是由测试期间过热引起的，从而导致传感器读数异常。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/438ed42e50f5bd47e8bd7ad18120e45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3e5BChEnILZ9dPxZwlZqg.png"/></div></div></figure><h1 id="710e" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">在AWS上接收消息</h1><p id="1c9b" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了确认物联网网关正在发送消息，我们可以在物联网网关上使用数据包分析器，如<code class="fe ol om on nz b">tcpdump</code>。在IoT网关上运行<code class="fe ol om on nz b">tcpdump</code>,下面，我们看到出站加密MQTT消息在端口443上被发送到AWS。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ok"><img src="../Images/82b25375e8a21c50a9855d3099b69af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ih0Mldiz1CQE7y_NrYNtVQ.png"/></div></div></figure><p id="72a3" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">为了确认这些消息是从AWS上的物联网网关接收的，我们可以使用AWS物联网核心测试功能并订阅<code class="fe ol om on nz b">lora-iot-demo</code>主题。我们应该会看到大约每隔5秒钟就有消息从物联网网关流入。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oi"><img src="../Images/bae0f5ed82d7023b765021e99b39c375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81b7i1_3fwRRTnkiUMgTGA.png"/></div></div></figure><p id="e125" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">传入MQTT消息的JSON有效负载结构将类似于下面的示例。<code class="fe ol om on nz b">device_id</code>是使用LoRaWAN传输消息的物联网设备的唯一id。<code class="fe ol om on nz b">gateway_id</code>是使用LoRaWAN接收消息并将其发送给AWS的物联网网关的唯一id。单个物联网网关通常会管理来自多个物联网设备的消息，每个设备都有一个唯一的id。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="055e" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">前面描述的AWS IoT规则使用的SQL查询在将嵌套的JSON有效负载结构传递到AWS IoT分析通道之前，会对其进行转换和展平，如下所示。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="5268" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">我们可以使用<code class="fe ol om on nz b">ts</code>和<code class="fe ol om on nz b">msg_received</code>数据字段来衡量物联网数据的近实时性。<code class="fe ol om on nz b">ts</code>数据字段是物联网设备上出现传感器读数的日期和时间，而<code class="fe ol om on nz b">msg_received</code>数据字段是AWS收到消息的日期和时间。这两个值之间的差值衡量了传感器读数传输到AWS物联网分析通道的接近实时程度。在下面的例子中，<code class="fe ol om on nz b">ts</code>(2020–08–27t 11:45:31.986)和<code class="fe ol om on nz b">msg_received</code>(2020–08–27t 11:45:32.074)之间的差值为88毫秒。</p><h2 id="bac3" class="mp ku it bd kv mq mr dn kz ms mt dp ld lu mu mv lf ly mw mx lh mc my mz lj na bi translated">最终物联网数据消息结构</h2><p id="5d58" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">一旦消息有效负载通过AWS物联网分析管道并进入AWS物联网分析数据集中，其最终数据结构如下所示。请注意，设备的属性元数据已从AWS IoT核心设备注册表中添加。遗憾的是，元数据不是格式良好的JSON，需要额外的转换才能使用。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oh ko l"/></div></figure><p id="6965" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated">GitHub项目的<a class="ae mh" href="https://github.com/garystafford/iot-aws-lora-demo/tree/master/sample_messages" rel="noopener ugc nofollow" target="_blank"> sample_messages </a>目录中包含一组示例消息。</p><h1 id="2a9a" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">结论</h1><p id="90e4" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在本帖中，我们探讨了如何使用LoRa和LoRaWAN协议将环境传感器数据从物联网设备传输到物联网网关。鉴于其低能耗、长距离传输能力和完善的协议，LoRaWAN是物联网设备的理想远程无线协议。然后，我们展示了如何使用AWS物联网设备SDK、AWS物联网核心和AWS物联网分析来近乎实时地安全收集、分析和可视化来自物联网设备的流消息。</p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><p id="a212" class="pw-post-body-paragraph ll lm it ln b lo nc ju lq lr nd jx lt lu ne lw lx ly nf ma mb mc ng me mf mg im bi translated"><em class="nb">本博客代表我自己的观点，不代表我的雇主亚马逊网络服务公司的观点。</em></p></div></div>    
</body>
</html>