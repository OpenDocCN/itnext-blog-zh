<html>
<head>
<title>Convolution Reverb and Web Audio API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">卷积混响和网络音频API</h1>
<blockquote>原文：<a href="https://itnext.io/convolution-reverb-and-web-audio-api-8ee65108f4ae?source=collection_archive---------1-----------------------#2018-06-07">https://itnext.io/convolution-reverb-and-web-audio-api-8ee65108f4ae?source=collection_archive---------1-----------------------#2018-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="25de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">“混响和网络音频API”系列的第1部分</strong></p><p id="59c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文是“混响系列”的第一部分，将涵盖在浏览器中实现<strong class="jp ir">卷积</strong> <strong class="jp ir">混响</strong>的<strong class="jp ir">理论</strong>和<strong class="jp ir">实践</strong>。要理解这一点，你应该熟悉JavaScript，至少对数字音频的工作原理有一点了解，或者随时准备在维基百科上做一些研究。</p><p id="2a28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新:<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/algorithmic-reverb-and-web-audio-api-e1ccec94621a">第二部分:算法混响和网络音频API </a></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="6040" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">简介</strong></p><p id="d116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DSP一直远离Web。主要是因为所有的Daw、VST插件和嵌入式数字合成器软件都是用C/C++编写的。此外，web开发人员经常害怕卷积、FFT和积分之类的东西。然而时代在变化，这些天没有什么能阻止我们使用Web Audio API构建完整的synths副本，这抽象了很多数学。与此同时，我觉得缺乏针对web开发人员的文章，这些文章深入DSP理论，而不仅仅是将一些音频节点连接在一起。这是一个遗憾，因为做DSP而不理解合成是没有乐趣的。</p><p id="7d11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为免责声明，我绝不是DSP专家，我只是一个对DSP感兴趣的网络开发人员，喜欢摆弄合成器和其他音乐相关的东西。</p><p id="7da3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是混响</strong></p><p id="a230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://en.wikipedia.org/wiki/Reverberation" rel="noopener ugc nofollow" target="_blank">混响</a>是一种效果，使您的乐器听起来好像是在某个空间演奏的，比如在桥下、在大音乐厅里或者可能是在铁罐里。每个空间都有自己的音响效果，所以同样的声音在每个空间都会有不同的感受。这是因为声波会根据墙壁的材质、房间的大小以及地板上波斯地毯的厚度而发生不同的反射。</p><p id="930a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们如何让一个干燥的合成器音符听起来像是在莫斯科大剧院演奏的？嗯……让我们来看看。</p><p id="6a98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">拍手和回声</strong></p><p id="f20f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">卷积混响是基于<strong class="jp ir">脉冲响应</strong>的概念——房间对<strong class="jp ir">脉冲</strong>的响应方式，例如对短暂的拍手声。每个房间对拍手声的反应都不一样，房间的音响效果完全可以用它的脉冲响应来表征。理想情况下，脉冲与一个<a class="ae kl" href="https://en.wikipedia.org/wiki/Sampling_(signal_processing)" rel="noopener ugc nofollow" target="_blank">样本</a>一样短，并且所有频率相等。从图形上看，可能是这样的:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/ca89f2ebcba01ca23fa321d2771ac369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cjq9OUC43BOZL4XOcbS-kA.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">脉冲(左)和脉冲响应(右)，<a class="ae kl" href="http://www.earlevel.com/main/1997/01/19/a-bit-about-reverb/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="84a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">换句话说，如果一个人在一个空荡荡的大房间里拍手，这可以被认为是一种<strong class="jp ir">冲动。</strong>和<strong class="jp ir">脉冲响应</strong>是房间对这种脉冲的反应——鼓掌声消失时你听到的回声和回响。现在，如果我们将声音的每个样本(比如说吉他和弦)乘以音乐会呼叫的脉冲响应，然后对其求和，基本上就可以得到吉他的声音，就好像它是在这个音乐厅演奏的一样。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="lj lk l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">脉冲响应示例</figcaption></figure><p id="2a8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JavaScript中卷积混响最基本的简单实现如下所示(但没人这么做):</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ll lk l"/></div></figure><p id="a50d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，实际上这太慢了。想象一下你的声音每秒钟有41000个样本。在一个有很多回声的房间里，脉冲响应可能是2秒，因此有82000个样本长。因此，为了应用卷积混响效果，我们需要进行41000 * 82000 = 3362百万次运算来处理1秒钟的声音。当然，这使得该选项不可能用于实时音频处理。如果我们在频域而不是时域中进行计算，这种计算将变得更加高效。因此，我们首先对输入信号和脉冲响应执行<a class="ae kl" href="https://en.wikipedia.org/wiki/Fourier_transform" rel="noopener ugc nofollow" target="_blank"> FFT </a>，将它们相乘，然后执行反向FFT。</p><p id="15b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果卷积对你来说仍然没有任何意义，或者如果你只是想了解更多，我建议看看这本<a class="ae kl" href="http://www.dspguide.com/ch6.htm" rel="noopener ugc nofollow" target="_blank">书</a>，这是我迄今为止遇到的最好的卷积解释。</p><p id="a533" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，Web Audio API提供了一个<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/API/ConvolverNode" rel="noopener ugc nofollow" target="_blank">卷积器节点</a>，所以我们不必自己实现卷积算法。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="ll lk l"/></div></figure><p id="46a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="http://amiselaytes.com/convolution-reverb/" rel="noopener ugc nofollow" target="_blank">演示</a> <a class="ae kl" href="https://github.com/miselaytes-anton/web-audio-experiments/tree/master/packages/convolution-reverb-app" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p><p id="a36b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">下一步是什么</strong></p><p id="4c18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不幸的是，当应用于实时输入时，即使使用本地卷积器节点也会导致一些<em class="lm">延迟</em>(在我的例子中，我将模拟合成器连接到线路输入)。除此之外，卷积混响的一个很大的缺点是我们<em class="lm">不容易实时调整混响参数</em>。因此，如果我们想要调整房间大小，就必须用不同的脉冲响应进行卷积。由于这些原因，在某些情况下，我们需要卷积的替代方案。</p><p id="d4e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个系列的下一部分，我们将会看到<em class="lm">算法</em>混响、<em class="lm">延迟线</em>、<em class="lm">音频小工具</em>和Shroeder先生的<em class="lm">自由动词。</em></p><p id="1afa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新:<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/algorithmic-reverb-and-web-audio-api-e1ccec94621a">第二部分:算法混响和网络音频API </a></p></div></div>    
</body>
</html>