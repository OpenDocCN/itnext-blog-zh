<html>
<head>
<title>Refactoring the Kubernetes infrastructure at OperationCode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在运营代码中重构Kubernetes基础设施</h1>
<blockquote>原文：<a href="https://itnext.io/refactoring-the-kubernetes-infrastructure-at-operationcode-229e391e3ad9?source=collection_archive---------5-----------------------#2020-03-16">https://itnext.io/refactoring-the-kubernetes-infrastructure-at-operationcode-229e391e3ad9?source=collection_archive---------5-----------------------#2020-03-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dc4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个让我们的Kubernetes infra进入更好状态并在此过程中削减2/3 AWS账单的故事</p><h1 id="f471" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">这一切都始于…</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lj"><img src="../Images/d8d158fbc7eaa21902d48721d45ef74f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ciOHIZ4xo-Oko1QOhoCkNA.png"/></div></div></figure><p id="d74a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="lv lw ep" href="https://medium.com/u/68b109307620?source=post_page-----229e391e3ad9--------------------------------" rel="noopener" target="_blank"> Nell Shamrell </a>在<code class="fe lx ly lz ma b">#infrastructure-team</code>频道中指出，我们每月的AWS账单真的很高，老实说，对于像OperationCode这样的组织来说实在是太高了。</p><p id="c189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经在OperationCode帮忙做了大约一年的运营工作，我们的Kubernetes(又名k8s)集群肯定需要做一些工作:</p><ol class=""><li id="9e7b" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk mg mh mi mj bi translated">它还在Kubernetes 1.11上(21个月大！k8s年一百)原地升级的步骤<a class="ae mk" href="https://github.com/kubernetes/kops/blob/master/docs/releases/1.12-NOTES.md" rel="noopener ugc nofollow" target="_blank">充满了危险</a>。</li><li id="85da" class="mb mc iq jp b jq ml ju mm jy mn kc mo kg mp kk mg mh mi mj bi translated">它有一个繁琐的用户登录过程，包括谷歌认证和一个<code class="fe lx ly lz ma b">secrets.json</code>文件，每个人(包括管理员！)一直输</li><li id="0658" class="mb mc iq jp b jq ml ju mm jy mn kc mo kg mp kk mg mh mi mj bi translated">它花费了我们太多，包括6x t3 .中型实例(3个主节点，3个工作节点)，3个NAT网关(这些贵得惊人！)和过大的EBS卷(每台主机200 GB)</li></ol><p id="8900" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所看到的，对于像我们这样的小组织来说，所有这些加起来真的很快。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi mq"><img src="../Images/31fbf283668b1dc9c8639f21a1c8e5ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-LNgly900o3FrobSmLCag.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">我们2020年2月的AWS成本</figcaption></figure><h1 id="a26a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第0部分:实现监控和可观察性</h1><p id="11e8" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在进行任何更改之前，我仔细检查了我们的监控情况。我们有<a class="ae mk" href="http://sentry.io" rel="noopener ugc nofollow" target="_blank"> Sentry.io </a>来通知我们应用程序错误，还有Prometheus和<a class="ae mk" href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" rel="noopener ugc nofollow" target="_blank"> AlertManager </a>来捕获指标并从我们的Kubernetes集群内部发送警报。</p><p id="4133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我添加了两个外部(和免费)的可见点:</p><ul class=""><li id="9a66" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk na mh mi mj bi translated">来自<a class="ae mk" href="http://honeycomb.io" rel="noopener ugc nofollow" target="_blank"> Honeycomb.io </a>(我的兼职雇主)的可观测性仪器，利用<a class="ae mk" href="https://www.honeycomb.io/pricing/" rel="noopener ugc nofollow" target="_blank">免费社区计划</a>给我们500MB的存储空间和15/GB mo的遥测数据摄取。在我们的后端应用程序中实现<a class="ae mk" href="https://github.com/OperationCode/back-end/pull/277" rel="noopener ugc nofollow" target="_blank">Python直线是相对容易的，事实上大部分工作都涉及到修复构建和更新依赖关系和文档。</a></li><li id="ff6f" class="mb mc iq jp b jq ml ju mm jy mn kc mo kg mp kk na mh mi mj bi translated">具有<a class="ae mk" href="https://www.statuscake.com/" rel="noopener ugc nofollow" target="_blank">状态的外部站点监控进行</a>，也利用他们的<a class="ae mk" href="https://www.statuscake.com/pricing" rel="noopener ugc nofollow" target="_blank">免费计划</a>给我们10个正常运行时间测试URL和1个页面速度测试。</li></ul><p id="44ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我就有信心继续进行整个基础设施改造，因为我知道我们有足够的测试覆盖我们的生产环境。</p><p id="b8b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如<a class="lv lw ep" href="https://medium.com/u/5587d135a397?source=post_page-----229e391e3ad9--------------------------------" rel="noopener" target="_blank">慈善专业</a>总说的，你真的是在生产中做测试。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/95e36e878598409cd624cfd4c68d6882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*oi5RNqKtwUJSfcw79o-9PA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">来源:charity.wtf博客</figcaption></figure><h1 id="2a57" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第1部分:清理未使用的资源</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nc"><img src="../Images/d36d5242bfb024adcafa370882bff625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zaWaGHbT5H12_pVa03rzfw.png"/></div></div></figure><p id="0aa7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的初步检查发现，有近200美元/月的资源完全没有使用，这是之前在ElasticBeanstalk上运行的应用程序版本和一些实验遗留下来的。与另外两个OCers进行了一个小时的配对，我们很快就把它们清理干净了。</p><h1 id="a31a" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第2部分:思考为什么Kubernetes对操作码很重要</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi nd"><img src="../Images/8fafbc7d0b5d7889657b3f885ce8df5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HoB3yeVgtXj_TrmQbJjDw.jpeg"/></div></div></figure><p id="9488" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢OperationCode的一点是我们如何使用自己的网络应用和基础设施作为教学资源，所有的应用和基础设施都是开源的。这使得我们帮助的兽医(以及所有志愿者)能够在当今流行的开发实践中获得经验。我相信我们选择使用和提供“真实的、生产中的”Kubernetes集群也是出于同样的精神。如果对我们的需求来说有点大材小用，这完全没问题，因为它为任何想要它的人提供了宝贵的实践经验。</p><p id="6e00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于我们基于kops的k8s集群的反馈是，它有点太难了，这让人们感到害怕。毕竟，我们在这里讨论的是我们的生产基础设施，它需要保持运行并易于理解。在过去对亚马逊的“托管”EKS产品有过积极的体验后，这感觉像是向前发展的自然选择。它平衡了可访问性和可靠性，同时合理地减少了日常维护的复杂性和工作量。</p><p id="766a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外,“无服务器”Kubernetes的理念与<a class="ae mk" href="https://aws.amazon.com/blogs/aws/amazon-eks-on-aws-fargate-now-generally-available/" rel="noopener ugc nofollow" target="_blank">基于Fargate的新运营模式</a>似乎是进一步减少运营问题的一种有吸引力的方式。它并没有完全解决，但后来更多的。</p><h1 id="1ede" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第3部分:构建新的集群</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ne"><img src="../Images/15f16f9a3ea0a9714db1b7abd3377d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aG65bVTM3SGhhY103mD46A.jpeg"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">AWS容器，这不是我编的</figcaption></figure><p id="82ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多亏了<a class="ae mk" href="http://eksctl.io" rel="noopener ugc nofollow" target="_blank"> eksctl </a>，建立一个新的EKS集群变得异常容易。我意识到我可以通过利用配置文件<a class="ae mk" href="https://github.com/OperationCode/operationcode_infra/blob/7396262afe38c2de4451c7f023d95e7c8649747c/kubernetes/eksctl/operationcode-backend.yaml" rel="noopener ugc nofollow" target="_blank">来实践一些基础设施作为代码实践。eksctl还提供了一个非常方便的<code class="fe lx ly lz ma b">eksctl utils write-kubeconfig</code>,让新用户的加入变得非常简单。</a></p><p id="17ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在构建集群之后(这实际上根本不需要时间！)，AWS文档<a class="ae mk" href="https://docs.aws.amazon.com/eks/latest/userguide/fargate-getting-started.html" rel="noopener ugc nofollow" target="_blank">建议安装以下组件:</a></p><ul class=""><li id="8aae" class="mb mc iq jp b jq jr ju jv jy md kc me kg mf kk na mh mi mj bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html" rel="noopener ugc nofollow" target="_blank"> ALB入口控制器</a></li><li id="d75e" class="mb mc iq jp b jq ml ju mm jy mn kc mo kg mp kk na mh mi mj bi translated"><a class="ae mk" href="https://kubernetes-sigs.github.io/aws-alb-ingress-controller/guide/external-dns/setup/" rel="noopener ugc nofollow" target="_blank">外部DNS控制器</a></li><li id="a713" class="mb mc iq jp b jq ml ju mm jy mn kc mo kg mp kk na mh mi mj bi translated"><a class="ae mk" href="https://docs.aws.amazon.com/eks/latest/userguide/vertical-pod-autoscaler.html" rel="noopener ugc nofollow" target="_blank">垂直Pod自动缩放器</a></li></ul><p id="98a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了外部dns之外，按照说明进行设置相对容易。提供的<a class="ae mk" href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/blob/v1.1.5/docs/examples/external-dns.yaml#L55" rel="noopener ugc nofollow" target="_blank">示例配置指向了一个过时的映像</a>，不幸的是<a class="ae mk" href="https://github.com/kubernetes-sigs/external-dns/blob/master/docs/tutorials/aws.md" rel="noopener ugc nofollow" target="_blank">外部dns文档</a>没有提供任何关于如何在Fargate中使用它的指导。经过一些实验，并得到了Kubernetes slack的友好人士的帮助，我发现我需要使用T1命令为外部DNS创建一个角色，然后使用T2注释将Kubernetes服务帐户映射到IAM角色(这里是T21代码T22)。</p><p id="419c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们使用<a class="ae mk" href="https://argoproj.github.io/argo-cd/" rel="noopener ugc nofollow" target="_blank"> Argo CD </a>来持续交付我们在k8s上运行的后端服务，因此这对于部署非常重要。EKS+法盖特的一个已知限制是，它不支持持久的卷声明，它只能支持短暂的pod。我最终向集群添加了一个单独的<code class="fe lx ly lz ma b">t3a.medium</code>节点，这样Argo就不会在每次pod循环时丢失所有数据:)</p><p id="b117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没有使用Argo的HA安装模板(这对我们来说是多余的)，而是将quickstart模板的Redis服务器部分修改为一个带有持久卷声明的stateful set(<a class="ae mk" href="https://github.com/OperationCode/operationcode_infra/blob/master/kubernetes/argocd/install.yaml#L2294-L2304" rel="noopener ugc nofollow" target="_blank">代码，此处为</a>)，为Argo提供了足够的可用性级别。</p><h1 id="80a1" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第4部分:更新我们的服务k8s清单</h1><p id="0f9a" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在测试中，我们发现有必要对我们的应用程序清单进行一些更改，以便在新的集群上运行。</p><p id="71e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最重要的是根据ALB入口控制器和外部DNS控制器的要求，修改从<code class="fe lx ly lz ma b">type: ClusterIP</code>到<code class="fe lx ly lz ma b">type: NodePort</code>的所有服务。之后，它只是以正确的方式实现入口注释和规则。控制器观察这些注释，然后自动创建AWS ALB和Route53 DNS记录，非常酷！</p><pre class="lk ll lm ln gt nf ma ng nh aw ni bi"><span id="ef6b" class="nj km iq ma b gy nk nl l nm nn">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: back-end<br/>  annotations:<br/>    kubernetes.io/ingress.class: alb<br/>    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-2:633607774026:certificate/d59d030e-0239-4bfa-8553-e4bafb6481b4<br/>    alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'<br/>    alb.ingress.kubernetes.io/scheme: internet-facing<br/>    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-2-2017-01<br/>    external-dns.alpha.kubernetes.io/hostname: backend.k8s.operationcode.org<br/>  labels:<br/>    app: back-end<br/>spec:<br/>  rules:<br/>  - host: backend.k8s.operationcode.org<br/>    http:<br/>      paths:<br/>      - path: /*<br/>        backend:<br/>          serviceName: back-end-service<br/>          servicePort: 80</span></pre><p id="7912" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是包含所有更改的完整拉取请求:</p><div class="no np gp gr nq nr"><a href="https://github.com/OperationCode/operationcode_infra/pull/143/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">返工Kubernetes的部署，以使用EKS+法尔盖特的一切由欧文波普拉请求#143 …</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">问题:我们当前的Kubernetes集群运行起来成本太高，而且还存在可管理性挑战。这个公关的目标…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of lt nr"/></div></div></a></div><p id="9149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，切换就像更改DNS记录一样简单，它(大部分)是在一个周日晚上成功完成的。这有助于我们的PostgreSQL数据库位于RDS上，并且不需要在安全组更改时进行改动。</p><h1 id="1ac5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第5部分:意识到我们的成本仍然太高(唉！)</h1><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi og"><img src="../Images/e462e8481d9ef2bf39f4e44a3f08c544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSKS2OgbSk_5N_H07o_SZg.jpeg"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">DevOps动作集</figcaption></figure><p id="e966" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在运行新设置一周后，我清理了kops集群，然后我们开始密切监控AWS的日常开销。我实现了<a class="ae mk" href="https://www.concurrencylabs.com/blog/introducing-miserbot-aws-cost-management/" rel="noopener ugc nofollow" target="_blank"> MiserBot </a>来为我们提供每日AWS支出更新。不幸的是，一旦稳定下来，我们的日成本仍然是14.51美元(435美元/月)，这仍然太高了。</p><p id="5409" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的分析和建议:</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi oh"><img src="../Images/498a039c70fbc9003d13526ea52e9367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcrGLPoFMH82-TdzltHgDw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">回到OC slack中的#基础设施-团队聊天</figcaption></figure><h1 id="84fa" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">第6部分:转移到Spot实例工作节点</h1><p id="944c" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">好吧，那么Fargate是一个很酷的主意，但它肯定比我想象的要贵。Fargate hours、NAT gateway和t3a.small的总花费为6.16美元/天，我知道我们可以合并成三个AWS <code class="fe lx ly lz ma b">t3.small</code>实例，如果现货定价，总花费为0.45美元/天。这是一个值得的改变。</p><p id="2f04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想小心spot实例循环(被终止和重新创建)影响我们的操作，所以我用Cloudwatch警报和<a class="ae mk" href="https://github.com/widdix/cloudwatch-alarm-to-slack/" rel="noopener ugc nofollow" target="_blank">cloud watch警报对Slack sender </a>实施了额外的监控。</p><p id="381d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我对将<code class="fe lx ly lz ma b">kube-system</code>pod从Fargate转移到worker节点也有一点紧张，但这最终非常顺利地完成了，并且跳过了其余的名称空间。在过渡阶段环境后，我发现我们的RDS安全组被设置为允许来自NAT网关的流量(这也会增加数据传输成本！)，所以我不得不快速实现VPC对等，从安全性和成本的角度来看，这是一个更好的解决方案。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi oi"><img src="../Images/c488d45b5e264ca5e796f1d3c5fa23fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4oieBzmuUFDMWB1bGkONRQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">如果没人注意到，你可以忍者编辑基础设施，对吗？</figcaption></figure><p id="628c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我意识到的另一件事是我们在Fargate上的后端请求延迟有多糟糕，许多请求接近3秒！切换后的图形看起来好多了。</p><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi oj"><img src="../Images/f2838a7a9c5ba600aaa3b2e4393bc9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aNIpw6waa_z6bYUHMevliw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">蜂巢的松弛展开是如此之好，对不对？</figcaption></figure><figure class="lk ll lm ln gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi ok"><img src="../Images/98a714fbb0863df46f64f842fb80fdb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wV6kXTxomp-53izM_2Wa4Q.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">响应时间的差异令人震惊！</figcaption></figure><h1 id="c1bc" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="dfd6" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">运行Kubernetes需要工作、测试和严密监控。该项目进展如此之快，以至于你无法将目光从它身上移开一年，然后期待一次平稳的升级。让它拥有4-5个次要版本，你会发现像我们一样，把所有东西都搬到一个新的集群上要容易得多。</p><p id="a182" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就Kubernetes集群的成本和可管理性而言，我们现在处于一个更好的位置。现在，群集本身的运营成本不到5美元/天(包括入口ALBs ),我们的AWS总支出为7.80美元/天，对于像我们这样的组织来说，这是一个更可持续的价格。</p><p id="c608" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Fargate对这个项目有点失望:我希望AWS在EKS·法盖特的成本上更明确一些。是的，如果你真的仔细挖掘，你会发现它，但它并不明显。但是性价比是最大的败笔。</p><p id="733d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，像OperationCode这样的组织做得很好，他们依赖于我们服务提供商的慷慨以及你们的捐赠。<a class="ae mk" href="https://operationcode.org/" rel="noopener ugc nofollow" target="_blank">请捐款！</a></p></div></div>    
</body>
</html>