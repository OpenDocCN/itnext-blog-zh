<html>
<head>
<title>Kubernetes Resource Statistics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes资源统计</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-resource-statistics-e8247f92b45c?source=collection_archive---------3-----------------------#2018-10-08">https://itnext.io/kubernetes-resource-statistics-e8247f92b45c?source=collection_archive---------3-----------------------#2018-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/4d1fb46f5ccdd3f1849e5bcaa817faca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFNN4s6pld0Svsyz2UWCew.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">krs在行动中的截图。</figcaption></figure><div class=""/><blockquote class="kc kd ke"><p id="ee46" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld ij bi translated">收集资源统计数据(例如，在某个名称空间中有多少pod正在运行)对于有时必要的活动可能是有用的。有了我最近开发的名为<code class="fe le lf lg lh b">krs</code>的小工具，现在以一种零配置的方式来做这件事就很简单了。</p></blockquote></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="c366" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">上周，我在纽约O'Reilly Velocity做了一个主题为<a class="ae ls" href="http://troubleshooting.kubernetes.sh/" rel="noopener ugc nofollow" target="_blank">排除Kubernetes应用程序故障</a>的演讲，作为后续，受到积极反馈和关于该主题的大量讨论的激励，我从工具的角度重新审视了这个领域。事实证明，除了<a class="ae ls" href="https://github.com/kubernetes-incubator/spartakus" rel="noopener ugc nofollow" target="_blank">kubernetes-incubator/spartakus</a>和<a class="ae ls" href="https://github.com/kubernetes/kube-state-metrics" rel="noopener ugc nofollow" target="_blank">kubernetes/kube-state-metrics</a>之外，我们手头并没有多少轻量级工具可以用来收集资源统计数据，比如名称空间中的pod或服务数量。所以我在回家的路上坐下来，开始编写一个小工具——创造性地命名为<code class="fe le lf lg lh b">krs</code>,这是Kubernetes Resource Stats的缩写——它允许你收集这些统计数据。</p><p id="6e1b" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">您可以通过两种方式使用<a class="ae ls" href="https://github.com/mhausenblas/krs" rel="noopener ugc nofollow" target="_blank"> mhausenblas/krs </a>:</p><ul class=""><li id="09db" class="lt lu jf ki b kj kk kn ko lp lv lq lw lr lx ld ly lz ma mb bi translated">直接从命令行(Linux、Windows和macOS的二进制文件可用)</li><li id="8554" class="lt lu jf ki b kj mc kn md lp me lq mf lr mg ld ly lz ma mb bi translated">集群内部署，使用<a class="ae ls" href="https://github.com/mhausenblas/krs/blob/master/launch.sh" rel="noopener ugc nofollow" target="_blank"> launch.sh </a>脚本，动态创建适当的RBAC权限。</li></ul><p id="cb2c" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">请注意，现在还很早，这是大量的WIP，但是到目前为止，<code class="fe le lf lg lh b">krs</code>的0.1版本有以下特点:</p><ul class=""><li id="b36a" class="lt lu jf ki b kj kk kn ko lp lv lq lw lr lx ld ly lz ma mb bi translated">基于每个命名空间，定期收集资源统计信息(支持pod、部署和服务)。</li><li id="324b" class="lt lu jf ki b kj mc kn md lp me lq mf lr mg ld ly lz ma mb bi translated">以<a class="ae ls" href="https://openmetrics.io" rel="noopener ugc nofollow" target="_blank"> OpenMetrics格式</a>公开这些统计数据。</li><li id="c44f" class="lt lu jf ki b kj mc kn md lp me lq mf lr mg ld ly lz ma mb bi translated">直接通过二进制文件使用，或者在包含所有依赖项的容器化设置中使用。</li></ul><p id="978b" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">在目前的形式下，因为我是个懒虫，我假设你已经安装并配置了<code class="fe le lf lg lh b">kubectl</code>，以便<code class="fe le lf lg lh b">krs</code>工作。换句话说，为了收集统计数据，<code class="fe le lf lg lh b">krs</code>依赖于要执行的<code class="fe le lf lg lh b">kubectl get all</code>命令。另一方面，谁在使用Kubernetes而没有安装<code class="fe le lf lg lh b">kubectl</code>？；)</p><p id="50f7" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">使用<code class="fe le lf lg lh b">krs</code>非常简单…只需<a class="ae ls" href="https://github.com/mhausenblas/krs/releases" rel="noopener ugc nofollow" target="_blank">下载</a>适用于您平台的二进制文件，然后像这样执行它:</p><pre class="mh mi mj mk gt ml lh mm mn aw mo bi"><span id="bffa" class="mp mq jf lh b gy mr ms l mt mu">$ krs thenamespacetowatch<br/># HELP pods Number of pods in any state, for example running<br/># TYPE pods gauge<br/>pods{namespace="thenamespacetowatch"} 13<br/># HELP deployments Number of deployments<br/># TYPE deployments gauge<br/>deployments{namespace="thenamespacetowatch"} 6<br/># HELP services Number of services<br/># TYPE services gauge<br/>services{namespace="thenamespacetowatch"} 4</span></pre><p id="0220" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">上面将在前台启动<code class="fe le lf lg lh b">krs</code>，从名称空间<code class="fe le lf lg lh b">thenamespacetowatch</code>收集资源统计信息，并在<code class="fe le lf lg lh b">stdout</code>上以OpenMetrics格式分别输出，供您进一步处理。</p><p id="9be7" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">但是，你可能会问，为什么不用这些指标做一些有用的事情(比如把它们存储在S3)。因为 <a class="ae ls" href="http://harmful.cat-v.org/cat-v/" rel="noopener ugc nofollow" target="_blank"> <em class="kh"> Unix哲学</em> </a> <em class="kh">。</em></p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><p id="751a" class="pw-post-body-paragraph kf kg jf ki b kj kk kl km kn ko kp kq lp ks kt ku lq kw kx ky lr la lb lc ld ij bi translated">对于那些想知道为什么不直接使用Prometheus或<a class="ae ls" href="https://github.com/kubernetes/kube-state-metrics" rel="noopener ugc nofollow" target="_blank">kubernetes/kube-state-metrics</a>来完成这个任务的人:嗯，你当然可以，为什么不呢？<code class="fe le lf lg lh b">krs</code>的重点实际上是作为现有工具的轻量级和易于使用的替代品，甚至可能在某些方面稍微互补。</p></div></div>    
</body>
</html>