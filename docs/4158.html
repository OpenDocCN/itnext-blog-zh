<html>
<head>
<title>Source Code Walkthrough of Telegram-iOS: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Telegram-iOS源代码演练:第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/source-code-walkthrough-of-telegram-ios-part-1-adee673e2202?source=collection_archive---------2-----------------------#2020-05-07">https://itnext.io/source-code-walkthrough-of-telegram-ios-part-1-adee673e2202?source=collection_archive---------2-----------------------#2020-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="13c8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">代码库概述</h2></div><blockquote class="kf kg kh"><p id="441a" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><a class="ae lf" href="https://hubo.dev/2020-05-07-source-code-walkthrough-of-telegram-ios-part-1/" rel="noopener ugc nofollow" target="_blank"> hubo.dev </a>的镜像</p></blockquote><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/176bfe39f3a7920c23fbc6a03c439270.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*639ZmD270Suy_QZ9rAfsRA.png"/></div></div></figure><h1 id="62ab" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">介绍</h1><p id="c01e" class="pw-post-body-paragraph ki kj iq kl b km mk jr ko kp ml ju kr mm mn ku kv mo mp ky kz mq mr lc ld le ij bi ms translated">elegram是市场上最受欢迎的即时通讯工具之一。截至今年4月，其MAU已过<a class="ae lf" href="https://telegram.org/blog/400-million" rel="noopener ugc nofollow" target="_blank"> 4亿</a>。考虑到它的服务在某些国家不可用，这是一个巨大的成就。</p><p id="2c20" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mm kt ku kv mo kx ky kz mq lb lc ld le ij bi translated">大多数Telegram <a class="ae lf" href="https://telegram.org/apps" rel="noopener ugc nofollow" target="_blank">客户端应用</a>都是开源的，以证明其安全性基因。他们还启动了一个新的程序，允许其他人验证iOS和Android的源代码是否与应用商店和Google Play上使用的版本相同。这个过程是一个值得赞赏的举措，有助于缓解过去几年对其缓慢释放习惯的批评。</p><p id="c8e0" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mm kt ku kv mo kx ky kz mq lb lc ld le ij bi translated">由于iOS是我最喜欢的平台，所以第一系列文章都是关于<a class="ae lf" href="https://github.com/TelegramMessenger/Telegram-iOS" rel="noopener ugc nofollow" target="_blank"> Telegram-iOS </a>。代码库展示了其他iOS工程师会遇到的许多实际工程问题的解决方案，如可靠的网络、安全的存储、反应式事件、多媒体回放、交互式UX、复杂的列表UI、系统控制器的定制/破解等。</p><h1 id="3b19" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">代码概述</h1><p id="ec38" class="pw-post-body-paragraph ki kj iq kl b km mk jr ko kp ml ju kr mm mn ku kv mo mp ky kz mq mr lc ld le ij bi translated">Telegram-iOS通过200多个<a class="ae lf" href="https://github.com/TelegramMessenger/Telegram-iOS/tree/master/submodules" rel="noopener ugc nofollow" target="_blank">子模块</a>组织源代码，代码超过200万行。我大致将这些模块分为五类:</p><ul class=""><li id="0796" class="nb nc iq kl b km kn kp kq mm nd mo ne mq nf le ng nh ni nj bi translated"><code class="fe nk nl nm nn b">App</code>，支持主要应用功能的模块，如基础实用程序、UI、网络等。</li><li id="317d" class="nb nc iq kl b km no kp np mm nq mo nr mq ns le ng nh ni nj bi translated"><code class="fe nk nl nm nn b">VoIP</code>，2017年3月底发布的语音通话功能。</li><li id="f528" class="nb nc iq kl b km no kp np mm nq mo nr mq ns le ng nh ni nj bi translated"><code class="fe nk nl nm nn b">Watch</code>，手表app。</li><li id="12bb" class="nb nc iq kl b km no kp np mm nq mo nr mq ns le ng nh ni nj bi translated"><code class="fe nk nl nm nn b">TON</code>，与新区块链平台的实验性整合。</li><li id="8ea1" class="nb nc iq kl b km no kp np mm nq mo nr mq ns le ng nh ni nj bi translated"><code class="fe nk nl nm nn b">3rd-party</code>，它所依赖的其他开源项目。</li></ul><p id="df01" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mm kt ku kv mo kx ky kz mq lb lc ld le ij bi translated">以下是每个类别的LOC统计数据:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="75f9" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mm kt ku kv mo kx ky kz mq lb lc ld le ij bi translated">Telegram-iOS是一个混合语言项目。通过查看<code class="fe nk nl nm nn b">App</code>类别，Swift中有近70%的代码，Objective-C/C++中有24%的代码。<a class="ae lf" href="https://buck.build/" rel="noopener ugc nofollow" target="_blank">降压器</a>用作构建工具。看起来它也在向巴泽尔移动。对于不熟悉iOS构建工具的读者来说，普通的Xcode项目文件格式，比如<code class="fe nk nl nm nn b">.xcodeproj</code>和<code class="fe nk nl nm nn b">.xcworkspace</code>，对于较小的项目已经足够好了。从长远来看，维护起来会变得很困难，因为文件是用XML表示的，并且是通过Xcode UI指令编辑的。当Xcode文件中存在合并冲突时，这通常不是一种愉快的体验，而且在代码审查期间发现问题也很有挑战性。</p><p id="0b16" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr mm kt ku kv mo kx ky kz mq lb lc ld le ij bi translated">Buck是脸书开发的一个构建系统。它鼓励由代码和资源组成的小模块，这导致干净的构建配置文件和更快的并行构建。对于一个典型的模块，它只有一个用十几行描述构建规则的<code class="fe nk nl nm nn b">BUCK</code>文件，一个用于代码文件的<code class="fe nk nl nm nn b">Sources</code>文件夹，以及一个可选的用于图像的<code class="fe nk nl nm nn b">Resouces</code>文件夹。命令<code class="fe nk nl nm nn b">buck project</code>可以生成Xcode项目文件，供工程师在Xcode中开发，这些文件在Git中被显式忽略。您可以在<code class="fe nk nl nm nn b"><a class="ae lf" href="https://github.com/TelegramMessenger/Telegram-iOS/blob/master/Makefile#L382" rel="noopener ugc nofollow" target="_blank">Makefile</a></code>中找到更多详细信息。还有一个来自Airbnb的<a class="ae lf" href="https://github.com/airbnb/BuckSample" rel="noopener ugc nofollow" target="_blank">模板项目</a>使用Buck构建iOS应用。</p><h1 id="2d09" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">子模块</h1><p id="2d46" class="pw-post-body-paragraph ki kj iq kl b km mk jr ko kp ml ju kr mm mn ku kv mo mp ky kz mq mr lc ld le ij bi translated">这里是所有229个子模块的统计列表。136模块由不超过两个几百行的源文件组成。一些小的不值得放在专用模块中，在IMO中可能会被合并，但这是设计品味的问题。</p><div class="nv nw gp gr nx ny"><a href="https://docs.google.com/spreadsheets/d/1isAY-89ZvoXG3JpB4eytVmLYm21TITFkWb7WtR71sQ0/edit#gid=2029178277" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd ir gy z fp od fr fs oe fu fw ip bi translated">电报-iOS统计</h2><div class="of l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">docs.google.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol lq ny"/></div></div></a></div><h1 id="4f34" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="061c" class="pw-post-body-paragraph ki kj iq kl b km mk jr ko kp ml ju kr mm mn ku kv mo mp ky kz mq mr lc ld le ij bi translated">代码统计应该给Telegram-iOS项目一个简要的印象。我将在下一篇文章中讨论基础模块。</p></div></div>    
</body>
</html>