<html>
<head>
<title>eBPF — Understanding The Next-Gen Networking, Security &amp; Observability for Cloud-Native Workloads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">eBPF —了解面向云原生工作负载的下一代网络、安全性和可观察性</h1>
<blockquote>原文：<a href="https://itnext.io/epbf-understanding-the-next-gen-networking-security-observability-for-cloud-native-workloads-1fe8ad87ee0f?source=collection_archive---------0-----------------------#2021-06-23">https://itnext.io/epbf-understanding-the-next-gen-networking-security-observability-for-cloud-native-workloads-1fe8ad87ee0f?source=collection_archive---------0-----------------------#2021-06-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c3c034a0e5a49a73cd7dbdb60c56d46e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twR0W6JmaFVbacC4RBMWZQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="2959" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最近，我有机会在<strong class="kh iu"> InfoQ </strong>的一次现场会议上从<strong class="kh iu"> Liz Rice </strong>那里了解eBPF。当谈到网络、安全和可观察性时，我惊讶地看到它可以带来的超能力和能力。</p><p id="7dd8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本文中，我将探索eBPF和构建在它之上的工具，并看看它们如何在云原生世界中提供帮助。</p><h1 id="5c54" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">eBPF是什么？</h1><p id="be00" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">Linux内核由两部分组成—</p><ul class=""><li id="8cc2" class="mg mh it kh b ki kj km kn kq mi ku mj ky mk lc ml mm mn mo bi translated">用户空间</li><li id="f784" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">内核空间</li></ul><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/5bc9b77374845d82b2d85b417c990844.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wS7Qc8vwPzF90NRY.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源—【https://ebpf.io/ T4】</figcaption></figure><p id="274d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">用户空间是常规应用程序运行的地方，而内核空间是大多数操作系统相关进程运行的地方。内核空间可以直接完全访问硬件。每当用户空间中的应用程序需要连接到硬件时，它都是通过调用内核空间中的API来实现的。将这两者分开提供了安全性好处，并且在大多数应用程序中，这已经足够好了。</p><blockquote class="na nb nc"><p id="b9c9" class="kf kg nd kh b ki kj kk kl km kn ko kp ne kr ks kt nf kv kw kx ng kz la lb lc im bi translated"><strong class="kh iu">eBPF(extended Berkeley Packet Filter)</strong>为程序员提供了一种机制，使他们可以在内核空间执行定制代码，从而可以用来构建更好的调试、跟踪、防火墙等工具。</p></blockquote><p id="2bc7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">eBPF允许用户空间应用程序打包要在内核空间执行的逻辑，而无需更改内核代码，甚至无需重新加载。</p><p id="1dfe" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">用布兰登·格雷格的话说——</p><blockquote class="na nb nc"><p id="5586" class="kf kg nd kh b ki kj kk kl km kn ko kp ne kr ks kt nf kv kw kx ng kz la lb lc im bi translated">eBPF 对Linux的作用就像JavaScript对HTML的作用一样。(算是吧。)因此，与静态HTML网站不同，JavaScript让你定义在鼠标点击等事件上运行的迷你程序，这些程序在浏览器中的安全虚拟机中运行。有了eBPF，而不是固定的内核，您现在可以编写运行在磁盘I/O等事件上的迷你程序，这些程序运行在内核中的安全虚拟机上</p></blockquote><p id="6b6d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下图显示了eBPF的演变—</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/2dc66c8b60c64fbf3e99a0d961c95094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bQJK19dMchaY7EwX.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源—<a class="ae mz" href="https://cilium.io/blog/2020/11/10/ebpf-future-of-networking/" rel="noopener ugc nofollow" target="_blank">https://cilium . io/blog/2020/11/10/ebpf-未来网络/ </a></figcaption></figure><p id="d044" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">程序员可以使用<a class="ae mz" href="https://github.com/iovisor/bcc" rel="noopener ugc nofollow" target="_blank"> BCC </a>工具包编写eBPF程序。有像<a class="ae mz" href="https://github.com/torvalds/linux/blob/master/kernel/bpf/verifier.c" rel="noopener ugc nofollow" target="_blank">验证器</a>这样的程序来检查程序是否做了合法的事情，并且没有最终锁定内核。</p><p id="922a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">由于eBPF程序运行在内核空间中，所以它们具有跨所有进程和应用程序的可见性。因此，它们可以用于许多方面:网络性能、安全、跟踪和防火墙。</p><h1 id="6e95" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">我如何开始？</h1><p id="11ca" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">对于初学者来说，有相当多已经构建好的工具可以开始使用。有密件抄送工具，比如—</p><ul class=""><li id="6fb0" class="mg mh it kh b ki kj km kn kq mi ku mj ky mk lc ml mm mn mo bi translated">execsnoop</li><li id="5bf9" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">opensnoop</li><li id="b04b" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">ext4slower</li><li id="eaa3" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">生物毒性</li><li id="cef1" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">生物睡眠</li><li id="80d7" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">cachestat</li><li id="9967" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">TCP连接</li><li id="dafe" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">tcpaccept</li><li id="528c" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">tcpretrans</li><li id="8c53" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">runqlat</li><li id="8739" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">轮廓</li><li id="c55e" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">等等。</li></ul><p id="63de" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以在这里阅读更多关于这些工具的信息<a class="ae mz" href="https://github.com/iovisor/bcc/blob/master/docs/tutorial.md" rel="noopener ugc nofollow" target="_blank">。下图显示了密件抄送/BPF跟踪工具的完整列表。</a></p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/68defff68d4941a3b4ef1c0e91e408e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B69wLWZ65njM_34F.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源—<a class="ae mz" href="https://github.com/iovisor/bcc/blob/master/images/bcc_tracing_tools_2019.png" rel="noopener ugc nofollow" target="_blank">https://github . com/io visor/bcc/blob/master/images/bcc _ tracing _ tools _ 2019 . png</a></figcaption></figure><h1 id="37a5" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">基于eBPF的项目</h1><p id="6eb7" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">既然您已经理解了eBPF的强大功能，那么是时候理解它有用的用例了。</p><p id="f3e1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">上一节描述了eBPF工具的跟踪功能，但是还有更多内容。相当多的项目将这种能力提升到了一个新的水平。让我们试着去理解这些项目。</p><h2 id="a8f4" class="nj le it bd lf nk nl dn lj nm nn dp ln kq no np lr ku nq nr lv ky ns nt lz nu bi translated"><a class="ae mz" href="https://cilium.io/" rel="noopener ugc nofollow" target="_blank">纤毛</a></h2><p id="5078" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">Cilium是一款开源软件，用于保护使用Docker和Kubernetes等Linux容器管理平台部署的应用程序服务之间的网络连接。</p><p id="02bc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">由于Cilium构建在运行内核的eBPF上，因此不需要更改任何应用程序代码。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/86e5f8376306d40b49d8f2eb36c11328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cCtEZqO8yTUb9I1L.png"/></div></div></figure><p id="00ac" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这里的是一本很好的读物，详细描述了纤毛的功能。通过与Hubble的结合，Cilium可以帮助轻松保护基于Kubernetes的工作负载。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/0d5f012e838dc2a066b6ab49290bfae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gz3A4Gr-D4j8Rvah.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源—<a class="ae mz" href="https://github.com/cilium/hubble" rel="noopener ugc nofollow" target="_blank">https://github.com/cilium/hubble</a></figcaption></figure><p id="0dd0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可能还想参考来自<a class="nx ny ep" href="https://medium.com/u/ee455f5da731?source=post_page-----1fe8ad87ee0f--------------------------------" rel="noopener" target="_blank"> Luc Juggery </a>的一篇<a class="ae mz" href="https://betterprogramming.pub/k8s-network-policy-made-simple-with-cilium-editor-a5b55781291c" rel="noopener ugc nofollow" target="_blank">文章</a>，它讲述了使用纤毛来建立K8网络策略。</p><h2 id="4b1f" class="nj le it bd lf nk nl dn lj nm nn dp ln kq no np lr ku nq nr lv ky ns nt lz nu bi translated"><a class="ae mz" href="https://falco.org/" rel="noopener ugc nofollow" target="_blank">法尔科</a></h2><p id="d706" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">Falco是一个行为分析工具，可以检测应用程序中的异常。使用eBPF，它</p><ul class=""><li id="bc73" class="mg mh it kh b ki kj km kn kq mi ku mj ky mk lc ml mm mn mo bi translated">解析系统调用</li><li id="9853" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">根据定义的规则验证行为</li><li id="46a0" class="mg mh it kh b ki mp km mq kq mr ku ms ky mt lc ml mm mn mo bi translated">违反规则时发出警报</li></ul><p id="d80c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Falco带有预定义的规则，有助于分析异常行为。</p><p id="c842" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以在这里看看一些规则和例子<a class="ae mz" href="https://falco.org/docs/examples/" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="4aa0" class="nj le it bd lf nk nl dn lj nm nn dp ln kq no np lr ku nq nr lv ky ns nt lz nu bi translated"><a class="ae mz" href="https://goteleport.com/" rel="noopener ugc nofollow" target="_blank">瞬间移动</a></h2><p id="a84e" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">Teleport是一个认证机构，也是基础设施的访问平台。它允许用户在一个地方设置单点登录，并访问SSH服务器、K8s和web应用程序。Teleport的一个重要特性就是分享互动会话。</p><p id="af32" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Teleport 4.2版本开始使用一些eBPF程序来捕获SSH会话并将它们转换成事件流。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/56df349046a8ad0bada763049d291f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R_Eu4HXgxyvmPrbv.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源—<a class="ae mz" href="https://goteleport.com/blog/what-is-ebpf/" rel="noopener ugc nofollow" target="_blank">https://goteleport.com/blog/what-is-ebpf/</a></figcaption></figure><h2 id="7a91" class="nj le it bd lf nk nl dn lj nm nn dp ln kq no np lr ku nq nr lv ky ns nt lz nu bi translated"><a class="ae mz" href="https://github.com/facebookincubator/katran" rel="noopener ugc nofollow" target="_blank">卡特兰</a></h2><p id="d5c3" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">Katran是一个开源eBPF项目，用于构建高性能的第4层负载平衡转发平面。Katran于2018年5月由脸书开源。</p><p id="088d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以在这里找到更多关于卡特兰<a class="ae mz" href="https://github.com/facebookincubator/katran" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><h1 id="84a4" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">下一步是什么？</h1><p id="2efd" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">eBPF无疑革新了网络、负载平衡和安全领域。我很确定许多人都在关注这项技术，并且能够用它做更多的事情。</p><p id="23aa" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">到目前为止，eBPF的能力仅限于Linux工作负载。微软最近<a class="ae mz" href="https://cloudblogs.microsoft.com/opensource/2021/05/10/making-ebpf-work-on-windows/" rel="noopener ugc nofollow" target="_blank">宣布了</a>一个可以为Windows启用eBPF的开源项目。</p><p id="caeb" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Google还<a class="ae mz" href="https://cloud.google.com/blog/products/containers-kubernetes/bringing-ebpf-and-cilium-to-google-kubernetes-engine" rel="noopener ugc nofollow" target="_blank">宣布</a>他们将在Google Kubernetes引擎中提供Cilium和eBPF的功能，以提高基于K8的工作负载的安全性。</p><p id="d9a4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因此，我们可以肯定地认为，这一领域将迎来激动人心的时刻！</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><figure class="mv mw mx my gt ju gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/c48de67b33478784c421ad2636f30c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*gVXFiHGIGIBWZACI.png"/></div></figure><h1 id="2c43" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">嘿，如果你喜欢这个故事，看看<a class="ae mz" href="https://deshpandetanmay.medium.com/membership" rel="noopener">中级会员</a>！只要5美元/月！</h1><p id="b07e" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated"><em class="nd">你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</em></p><h1 id="5943" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><a class="ae mz" href="https://deshpandetanmay.medium.com/membership" rel="noopener">现在就成为中等会员吧！</a></h1></div></div>    
</body>
</html>