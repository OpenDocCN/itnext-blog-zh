<html>
<head>
<title>Building a chatbot with Rasa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rasa构建聊天机器人</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-chatbot-with-rasa-9c3f3c6ad64d?source=collection_archive---------0-----------------------#2018-08-18">https://itnext.io/building-a-chatbot-with-rasa-9c3f3c6ad64d?source=collection_archive---------0-----------------------#2018-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/cec430cd6ce32198c65993edcd193aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*R1HRk-lpEcHaFz2fiiCC3Q.jpeg"/></div></figure><div class=""/><div class=""><h2 id="9587" class="pw-subtitle-paragraph ju iw ix bd b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dk translated">在30分钟内创建您自己的聊天机器人！:)</h2></div><h2 id="e535" class="km kn ix bd ko kp kq dn kr ks kt dp ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">介绍</h2><p id="aa3b" class="pw-post-body-paragraph li lj ix lk b ll lm jy ln lo lp kb lq kv lr ls lt kz lu lv lw ld lx ly lz ma ij bi translated">在开始开发之前，让我们先来详细说明一下需求，以及为什么我要深入研究提到的技术。我想建立一个聊天机器人，它能够学习用户的意图，智能地交互，如果用户要求就执行操作，提供有效的学习机制，最重要的是不使用任何付费服务。有一堆在线服务(如<a class="ae mb" href="https://wit.ai/" rel="noopener ugc nofollow" target="_blank"> wit.ai </a>)提供不错的NLU功能，但要收取流量费。这让我开始寻找一个开源框架，它可以在构建机器人的过程中提供足够的独立性。一个这样的工具是<a class="ae mb" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>。</p><h2 id="e699" class="km kn ix bd ko kp kq dn kr ks kt dp ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">Rasa —聊天机器人解决方案</h2><p id="e969" class="pw-post-body-paragraph li lj ix lk b ll lm jy ln lo lp kb lq kv lr ls lt kz lu lv lw ld lx ly lz ma ij bi translated">Rasa提供了一套工具，可以在你的本地桌面上构建一个完整的聊天机器人，而且是完全免费的。他们的旗舰工具是，</p><ul class=""><li id="ad54" class="mc md ix lk b ll me lo mf kv mg kz mh ld mi ma mj mk ml mm bi translated"><strong class="lk iy">拉莎input】:一种自然语言理解解决方案，它接受用户输入，并试图推断用户意图，提取可用实体。</strong></li><li id="f5d8" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated">Rasa核心(Rasa Core):一个对话管理解决方案试图建立一个概率模型，该模型基于先前的一组用户输入来决定要执行的一组动作。</li></ul><p id="7cd8" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">在这篇文章中，你会发现一些关键词在Rasa函数/工具中反复出现，</p><ul class=""><li id="c53c" class="mc md ix lk b ll me lo mf kv mg kz mh ld mi ma mj mk ml mm bi translated"><strong class="lk iy">意图</strong>:将其视为用户输入的目的或目标。如果用户说，“<em class="mv">今天是哪一天</em>？”，目的是找到一周中的某一天。</li><li id="61e5" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated"><strong class="lk iy">实体</strong>:认为是从用户输入中可以提取的有用信息。从前面的例子中，我们知道我们的目标是找到一周中的某一天，但是是哪一天呢？如果我们提取“<em class="mv"> Today </em>”作为实体，我们可以执行今天的操作。</li><li id="1bdf" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated"><strong class="lk iy">动作</strong>:顾名思义，是可以由bot执行的操作。它可能是回复一些东西，查询一个数据库，或者任何其他可能的代码。</li><li id="ac70" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated"><strong class="lk iy"> Stories </strong>:这是用户和机器人之间的一个示例交互，根据捕获的意图和执行的动作来定义。因此，开发人员可以告诉你，如果你得到一个带有/不带有某些实体的用户输入，该怎么做。比如说，如果用户的意图是查找星期几，而实体是今天，则查找今天的星期几并回复。</li></ul><p id="5d89" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">为了完成这项工作，Rasa需要一些文件，这些文件存储了构建机器人所需的所有训练和模型信息。简单概述一下，最重要的有:</p><ul class=""><li id="cb5e" class="mc md ix lk b ll me lo mf kv mg kz mh ld mi ma mj mk ml mm bi translated"><strong class="lk iy"> NLU训练文件</strong>:它包含一堆用户输入的例子，以及它们到合适的意图的映射和每个例子中存在的实体。你提供的例子越多，你的机器人的NLU能力就越强。在这里找到一种创建训练数据的交互方式<a class="ae mb" href="https://rasahq.github.io/rasa-nlu-trainer/" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="6461" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated"><strong class="lk iy">故事文件</strong>:里面有一堆可以学习的故事。每个故事都创造了一个互动的概率模型。</li><li id="4ef0" class="mc md ix lk b ll mn lo mo kv mp kz mq ld mr ma mj mk ml mm bi translated">域文件:这里你列出了所有的意图、实体、动作和类似的信息。您还可以添加示例bot回复模板，并将其用作操作。</li></ul><p id="fcde" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">说够了，让我们开始开发机器人吧！</p><h2 id="82a1" class="km kn ix bd ko kp kq dn kr ks kt dp ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">自然语言理解</h2><p id="3119" class="pw-post-body-paragraph li lj ix lk b ll lm jy ln lo lp kb lq kv lr ls lt kz lu lv lw ld lx ly lz ma ij bi translated">让我们首先训练机器人理解用户语言，这样它就可以对意图进行分类并提取实体。为此，我们将创建一个示例NLU培训文件。</p><p id="cb95" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated"><strong class="lk iy"> NLU培训档案(nlu_train.md): </strong></p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5cac" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">这里，意图的名称被定义在' ##intent:'之后，并且该意图的所有样本用户话语在下面被提及。意向通知`<em class="mv"> query_days_in_month` </em>我们还提到了实体。格式是[word](entity_name)，因此用户话语示例是“一月有多少天”，其中“一月”是名称为“月”的实体。</p><p id="a9ec" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">现在，我们将定义用于训练NLU模型的管道，这里我们将使用spacy来完成此操作。</p><p id="c8bf" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated"><strong class="lk iy">配置文件(nlu_config.yml) </strong></p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="2dee" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">我们现在准备训练NLU模型！让我们用Python来做吧。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d917" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">这将训练nlu模型并将其保存在“models/nlu/”中。让我们试着测试这个模型是如何工作的。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9743" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">输出看起来像这样，</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7d86" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">如您所见，该模型能够完美地将用户问题与其意图对应起来(检查'<em class="mv"> intent </em>'下的'<em class="mv"> name </em>'部分)。它说，对于第一个问题，意图是'<em class="mv"> query_days_in_month </em>，提取的实体是'<em class="mv"> January </em>'(检查'<em class="mv"> entities </em>'下的'<em class="mv"> value' </em>)。第二个问题的输出中有一件很酷的事情，即使我们没有在示例中提供它，它也完全能够猜出意图，甚至提取实体'<em class="mv"> march </em>'。</p><p id="66a4" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">不错，但聊天机器人只是完成了一半，我们仍然需要建立对话管理。</p><h2 id="a38c" class="km kn ix bd ko kp kq dn kr ks kt dp ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">对话管理</h2><p id="0cb0" class="pw-post-body-paragraph li lj ix lk b ll lm jy ln lo lp kb lq kv lr ls lt kz lu lv lw ld lx ly lz ma ij bi translated">首先，让我们定义域文件，该文件包含一些示例模板，我们可以使用这些模板回复用户。</p><p id="4ff3" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated"><strong class="lk iy">域文件(domain.yml): </strong></p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="614f" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">这里我们列出了意图和实体(都在nlu培训文件中)，以及一些模板和动作。模板包含您希望机器人做出的回复，在这种情况下，我希望机器人问候，说再见，并回答用户提出的一个月中的天数问题。现在机器人只会回答这三种月份的答案(机器人不知道闰年，愚蠢的机器人)</p><p id="b605" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">现在让我们创建一个用户-机器人交互的例子。</p><p id="a3f2" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated"><strong class="lk iy">故事文件(stories.md): </strong></p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="eb5a" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">在这里，我们以故事的形式定义了一个机器人和用户之间的示例交互。事情是这样的，如果用户说了什么，并且它的意图是'<em class="mv">问候</em>'机器人将执行动作'<em class="mv">发出问候</em>'。再举一个例子，如果用户的消息有'<em class="mv"> query_days_in_month </em>'意图和'二月'，那么bot将执行'<em class="mv"> utter_answer_28_days </em>'动作。</p><p id="a5d9" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">现在让我们来训练对话管理部分，</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e301" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">在这里，您可以更改培训策略，在该策略中，您可以为对话培训定义自己的LSTM或RNN。重要的一点是，'<em class="mv"> max_history </em>'用于定义一个动作如何依赖于前面的问题。如果max_history为1，那么它只记忆个体意图及其相关动作。由于缺乏训练数据(大量的故事)，我现在只是让它记住规则，你可以创建一些样本故事，看看rasa对话管理的真正潜力。</p><p id="d9ef" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">现在我们完成了。让我们看看机器人是否能够回复我们并回答我们的问题。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7c30" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">确实如此。</p><h2 id="028a" class="km kn ix bd ko kp kq dn kr ks kt dp ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h2><p id="cb4f" class="pw-post-body-paragraph li lj ix lk b ll lm jy ln lo lp kb lq kv lr ls lt kz lu lv lw ld lx ly lz ma ij bi translated">将意图-实体的每种组合映射到故事中的动作是非常低效的。想象一下将每个月单独映射到它的答案。闰年呢？嗯，所有这些都可以通过使用自定义操作来处理，其中操作调用一个python函数，包含所有信息，如意图和实体。现在，在python代码中，您可以执行所有必要的检查并返回消息。</p><p id="2535" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">此外，当你给它更多的数据来训练时，Rasa NLU和核心的真正潜力会大放异彩。或者甚至部署聊天机器人，它从互动中学习。这将使它能够处理尚未输入训练数据的案例。您还可以更改它为模型定型的策略。也许在下一篇文章中会谈到这些。</p><p id="2c9f" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">干杯。</p><p id="97eb" class="pw-post-body-paragraph li lj ix lk b ll me jy ln lo mf kb lq kv ms ls lt kz mt lv lw ld mu ly lz ma ij bi translated">点击查看更多此类文章<a class="ae mb" href="http://mohitmayank.com" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>