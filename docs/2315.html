<html>
<head>
<title>Express server for an Angular application part 2: serve files from a bucket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular应用程序的快速服务器第2部分:从存储桶中提供文件</h1>
<blockquote>原文：<a href="https://itnext.io/express-server-for-an-angular-application-part-2-serve-files-from-a-bucket-ae14d23e7cde?source=collection_archive---------8-----------------------#2019-05-05">https://itnext.io/express-server-for-an-angular-application-part-2-serve-files-from-a-bucket-ae14d23e7cde?source=collection_archive---------8-----------------------#2019-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6c99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Express.js是为构建web应用程序而设计的Node.js的web应用程序框架，在这一系列文章中，我将一步一步地解释我是如何实现一个具有一些高级功能的Express服务器的，我将这些功能用于我用Angular 7制作的单页面应用程序。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3a494ff28fbeddfeb05488cd2505b1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5v10nBszJVrOvgaNTKtIA.png"/></div></div></figure><p id="4f72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将讨论我在不同文章中解决的7个主要问题:</p><ol class=""><li id="a9be" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-1-getting-started-2cd27de691bd?fbclid=IwAR0FqPoqKeBps4QUM3E09aSGKDwjUNKcoZHxPKAB5iBt8dwUbuEol3b7IZ8" rel="noopener">入门</a></li><li id="bf53" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-2-serve-files-from-a-bucket-ae14d23e7cde" rel="noopener">从桶里取文件</a></li><li id="9f67" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-3-redirect-routes-to-an-external-service-d4658ed575cb" rel="noopener">将一些呼叫重定向到外部服务</a></li><li id="7546" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-4-redirect-http-to-https-requests-d4f6e7ed7e93" rel="noopener">将http重定向到https请求</a></li><li id="7343" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-5-redirect-non-www-to-www-requests-b81a7794a4d7" rel="noopener">将非www请求重定向到www请求</a></li><li id="8736" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-5-limit-connections-and-prevent-ddos-e27902cc702b" rel="noopener">限制连接并阻止DDoS </a></li><li id="3715" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-7-add-cache-f11e8060a2e3" rel="noopener">处理一些缓存</a></li></ol><p id="3c63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第二篇文章中，我将讨论<strong class="jp ir">如何提供托管在外部存储桶</strong>上的文件。</p><h1 id="8d71" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考知识库</h1><p id="23f3" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">该项目的一个工作示例可从以下网址获得:</p><p id="ad9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lg" href="https://github.com/mzuccaroli/express_server_for_angular_example" rel="noopener ugc nofollow" target="_blank">https://github . com/mzuccaroli/express _ server _ for _ angular _ example</a>主分支包含最终的完整项目，但每篇文章都有一个专门的分支，对于这篇文章，引用是:<a class="ae lg" href="https://github.com/mzuccaroli/express_server_for_angular_example/tree/feature/angular_from_bucket" rel="noopener ugc nofollow" target="_blank">https://github . com/mzuccaroli/express _ server _ for _ angular _ example/tree/feature/angular _ from _ bucket</a></p><h1 id="0a0b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">为什么你应该使用水桶</h1><p id="0db0" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">当你在处理一个<strong class="jp ir"> javascript单页应用</strong>时，比如Angular、<strong class="jp ir">，把所有静态文件放在一个专用的存储库</strong>里是一个好主意，比如一个<strong class="jp ir">亚马逊s3存储桶</strong>。通过对你的<a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-1-getting-started-2cd27de691bd?fbclid=IwAR0FqPoqKeBps4QUM3E09aSGKDwjUNKcoZHxPKAB5iBt8dwUbuEol3b7IZ8" rel="noopener">基本快速服务器</a>做一些小的修改，你将能够<strong class="jp ir">从angular应用程序中分离出正在运行的服务器。通过这种方式，您将能够利用这两种解决方案的优点:在专用环境中运行一个小型的超级优化的express服务器，并在一个更便宜的桶中托管静态js文件和资产。</strong></p><p id="bdcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们假设您的应用程序版本的副本部署在'<a class="ae lg" href="http://static.test.com.s3-website-eu-west-1.amazonaws.com'" rel="noopener ugc nofollow" target="_blank">http://static . test . com . S3-website-eu-west-1 . Amazon AWS . com '</a>。你可以从我的<a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-1-getting-started-2cd27de691bd?fbclid=IwAR0FqPoqKeBps4QUM3E09aSGKDwjUNKcoZHxPKAB5iBt8dwUbuEol3b7IZ8" rel="noopener">上一篇文章</a>中创建的基本服务器开始，在代码中做一些修改。</p><p id="9c4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，您可以将您的桶地址存储在一个变量中:</p><blockquote class="mp mq mr"><p id="dd8e" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">const _ bucket address = '<a class="ae lg" href="http://static.test.com.s3-website-eu-west-1.amazonaws.com'" rel="noopener ugc nofollow" target="_blank">http://static . test . com . S3-website-eu-west-1 . Amazon AWS . com '</a>；</p></blockquote><h1 id="3d2b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">从桶中提供静态文件</h1><p id="b143" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">在您的代码中找到静态文件处理部分，并将其更改为:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="52b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您所看到的，这段代码将所有静态文件请求重定向到bucket，充当了一个<strong class="jp ir">反向代理</strong>，您可以通过<strong class="jp ir">在路径的正则表达式中识别特定的文件扩展名</strong>来增加一点改进。通过这种方式，您可以直接从您的bucket 中控制您想要提供哪些静态文件。</p><h1 id="1338" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">从存储桶提供应用程序路径</h1><p id="ba30" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">找到应用程序路径代码，并将其更改为:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f22b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主要的应用程序修改非常简单，请注意<strong class="jp ir">如果您需要的话，您可以添加高级url处理</strong>:一个典型的例子可能是在专用的PAH上提供不同的特定语言版本，如果您想了解更多关于使用Angular的多语言应用程序的信息，您可以查看本文</p><p id="af7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以将您的角度应用程序放入您的桶中并运行</p><blockquote class="mp mq mr"><p id="7c10" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">$node server.js</p></blockquote><p id="6487" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开你的浏览器进入<a class="ae lg" href="http://localhost:4100" rel="noopener ugc nofollow" target="_blank"><em class="ms">http://localhost:4100</em></a>如你所见，应用程序运行良好。</p><p id="ee07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，这个小小的修改是对您的应用程序的<strong class="jp ir">大改进:</strong></p><ul class=""><li id="9de0" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk my ld le lf bi translated">服务器代码和应用程序代码完全分离，可以使用不同的方法和管道进行部署</li><li id="da0a" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk my ld le lf bi translated">你的express服务器是一个小的javascript应用程序，很容易变成一个λ函数如果你使用的是Amazon环境，<strong class="jp ir">这是无服务器方法的第一步</strong></li><li id="345b" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk my ld le lf bi translated">服务器和应用程序的<strong class="jp ir">解耦</strong>使您能够根据需要添加一些<strong class="jp ir">高级功能</strong>:您的服务器可以处理不同存储桶中的多个应用程序，或者同一应用程序可以由不同环境中的不同服务器提供服务</li></ul><p id="c052" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快速旅程的下一步是处理一些特殊的路由，并将它们重定向到外部服务器:<a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-3-redirect-routes-to-an-external-service-d4658ed575cb" rel="noopener">将一些调用重定向到外部服务</a></p></div></div>    
</body>
</html>