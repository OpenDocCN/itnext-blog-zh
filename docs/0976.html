<html>
<head>
<title>Creating Ruby objects with keyword arguments and merge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用关键字参数和merge创建Ruby对象</h1>
<blockquote>原文：<a href="https://itnext.io/removing-argument-order-dependencies-c5e2482ba208?source=collection_archive---------6-----------------------#2018-06-26">https://itnext.io/removing-argument-order-dependencies-c5e2482ba208?source=collection_archive---------6-----------------------#2018-06-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f693839752537d3661551bc9a3f8e8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oKlEOpvOe4o15FDE.jpg"/></div></div></figure><p id="6320" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通读Sandi Metz的书<a class="ae kz" href="http://www.poodr.com/" rel="noopener ugc nofollow" target="_blank"><em class="la">Ruby中的实用面向对象设计(POODR) </em> </a> <em class="la">，</em>我发现自己又一次发现了如何以Sandi Metz的方式做事的最佳实践。</p><p id="1fea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本帖中，我们将揭示在不使用散列或关键字参数的情况下创建Ruby对象的一些问题，并提供一些在初始化Ruby对象时处理默认值的解决方案。</p><p id="2566" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们从创建一个基本的Ruby <code class="fe lb lc ld le b">Movie</code>类开始。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="9936" class="ln lo it le b gy lp lq l lr ls">class Movie<br/>  attr_accessor :title, :year, :runtime</span><span id="c316" class="ln lo it le b gy lt lq l lr ls">  def initialize(title, year, runtime)<br/>    <a class="ae kz" href="http://twitter.com/title" rel="noopener ugc nofollow" target="_blank">@title</a> = title<br/>    <a class="ae kz" href="http://twitter.com/year" rel="noopener ugc nofollow" target="_blank">@year</a> = year<br/>    <a class="ae kz" href="http://twitter.com/runtime" rel="noopener ugc nofollow" target="_blank">@runtime</a> = runtime<br/>  end</span><span id="eeb4" class="ln lo it le b gy lt lq l lr ls">end</span><span id="3c67" class="ln lo it le b gy lt lq l lr ls">matrix = Movie.new("The Matrix", 1999, 150)</span><span id="278a" class="ln lo it le b gy lt lq l lr ls">matrix.title #=&gt; "The Matrix"<br/>matrix.year #=&gt; 1999<br/>matrix.runtime #=&gt; 150</span></pre><p id="a44e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很基本的东西。</p><p id="5bff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，正如梅斯总是提到的…</p><blockquote class="lu lv lw"><p id="7917" class="kb kc la kd b ke kf kg kh ki kj kk kl lx kn ko kp ly kr ks kt lz kv kw kx ky im bi translated">设计与其说是实现完美的行为，不如说是保持可变性的艺术。</p></blockquote><p id="04fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，让我们看看如果我们决定向我们的<code class="fe lb lc ld le b">Movie</code>类添加更多的属性会发生什么。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="3711" class="ln lo it le b gy lp lq l lr ls">class Movie<br/>  attr_accessor :title, :year, :runtime, :box_office, :oscar_noms<br/>  <br/>  def initialize(title, year, runtime, box_office, oscar_noms)<br/>    <a class="ae kz" href="http://twitter.com/title" rel="noopener ugc nofollow" target="_blank">@title</a> = title<br/>    <a class="ae kz" href="http://twitter.com/year" rel="noopener ugc nofollow" target="_blank">@year</a> = year<br/>    <a class="ae kz" href="http://twitter.com/runtime" rel="noopener ugc nofollow" target="_blank">@runtime</a> = runtime<br/>    <a class="ae kz" href="http://twitter.com/box_office" rel="noopener ugc nofollow" target="_blank">@box_office</a> = box_office<br/>    <a class="ae kz" href="http://twitter.com/oscar_noms" rel="noopener ugc nofollow" target="_blank">@oscar_noms</a> = oscar_noms<br/>  end</span><span id="d2a2" class="ln lo it le b gy lt lq l lr ls">end</span><span id="469f" class="ln lo it le b gy lt lq l lr ls">matrix = Movie.new("The Matrix", 1999, 150, 463517383, 4)</span></pre><p id="f8db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在创建电影<em class="la"> </em>实例变得相当混乱，容易出错。</p><p id="cf01" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这四个数字又是什么意思？</p><p id="138c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些论点必须按什么顺序排列？</p><p id="4662" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们不一定想谷歌《黑客帝国》的票房收入是多少呢？我们应该在那里输入什么默认值呢？</p><h1 id="6921" class="ma lo it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">使用关键字参数进行初始化</h1><p id="6146" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">为了消除参数顺序依赖性，我们可以像这样使用<a class="ae kz" href="https://robots.thoughtbot.com/ruby-2-keyword-arguments" rel="noopener ugc nofollow" target="_blank">关键字参数</a>来重构我们的<code class="fe lb lc ld le b">#initialize</code>方法。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="c6f2" class="ln lo it le b gy lp lq l lr ls">class Movie<br/>  attr_accessor :title, :year, :runtime, :box_office, :oscar_noms<br/>  <br/>  def initialize(<br/>    title:, <br/>    year: "19XX", <br/>    oscar_noms: "0?", <br/>    runtime: "Longer than an hour", <br/>    box_office: "More than a million?"<br/>  )<br/>  <br/>    <a class="ae kz" href="http://twitter.com/title" rel="noopener ugc nofollow" target="_blank">@title</a> = title<br/>    <a class="ae kz" href="http://twitter.com/year" rel="noopener ugc nofollow" target="_blank">@year</a> = year<br/>    <a class="ae kz" href="http://twitter.com/runtime" rel="noopener ugc nofollow" target="_blank">@runtime</a> = runtime<br/>    <a class="ae kz" href="http://twitter.com/box_office" rel="noopener ugc nofollow" target="_blank">@box_office</a> = box_office<br/>    <a class="ae kz" href="http://twitter.com/oscar_noms" rel="noopener ugc nofollow" target="_blank">@oscar_noms</a> = oscar_noms</span><span id="4d94" class="ln lo it le b gy lt lq l lr ls">  end<br/>end</span><span id="e58c" class="ln lo it le b gy lt lq l lr ls">matrix = Movie.new(<br/>  year: 1999, <br/>  title: "The Matrix", <br/>  runtime: 150,<br/>  oscar_noms: 4<br/>  box_office: 463517383,<br/>)</span></pre><p id="a5d3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用关键字参数，我们可以直接在<code class="fe lb lc ld le b">#initialize</code>方法中指定键及其默认值。</p><p id="1098" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更重要的是，初始化<em class="la">矩阵</em>现在看起来容易多了，最棒的是，我们不再受限于向<code class="fe lb lc ld le b">#initialize</code>方法提交参数的固定顺序。</p><p id="5ed3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然代码比使用固定顺序的参数更冗长，但是重构的<code class="fe lb lc ld le b">#initialize</code>方法在可读性和防止任何意外阅读障碍方面更胜一筹。(即变量的交换顺序)</p><h1 id="ecaf" class="ma lo it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">默认值选项#2:使用#merge</h1><p id="0b7b" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">指定默认值的另一种方法是创建一个单独的<code class="fe lb lc ld le b">#defaults</code>方法，并利用Ruby的<code class="fe lb lc ld le b">#merge</code>方法，如下所示:</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="9c5c" class="ln lo it le b gy lp lq l lr ls">class Movie<br/>  attr_accessor :title, :year, :stars_keanu<br/>  <br/>  def initialize(movie_args)<br/>    movie_args = defaults.merge(movie_args)</span><span id="88da" class="ln lo it le b gy lt lq l lr ls">    <a class="ae kz" href="http://twitter.com/title" rel="noopener ugc nofollow" target="_blank">@title</a> = movie_args[:title]<br/>    <a class="ae kz" href="http://twitter.com/year" rel="noopener ugc nofollow" target="_blank">@year</a> = movie_args[:year]<br/>    <a class="ae kz" href="http://twitter.com/stars_keanu" rel="noopener ugc nofollow" target="_blank">@stars_keanu</a> = movie_args[:stars_keanu]</span><span id="147a" class="ln lo it le b gy lt lq l lr ls">  end</span><span id="ae25" class="ln lo it le b gy lt lq l lr ls">  private</span><span id="dd09" class="ln lo it le b gy lt lq l lr ls">  def defaults<br/>    {year: "No earlier than 20th century, stars_keanu: "???"}<br/>  end</span><span id="073b" class="ln lo it le b gy lt lq l lr ls">end</span><span id="8c94" class="ln lo it le b gy lt lq l lr ls">inception = Movie.new(<br/>  year: 2010, <br/>  title: "Inception", <br/>  stars_keanu: false<br/>)</span><span id="59b0" class="ln lo it le b gy lt lq l lr ls">inception.stars_keanu #=&gt; false</span></pre><p id="5a63" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">方法<code class="fe lb lc ld le b">#merge</code>首先接受由<code class="fe lb lc ld le b">#defaults</code>方法返回的默认散列，然后<em class="la">将</em>合并到用户输入的参数中。</p><p id="8de8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">换句话说，在<code class="fe lb lc ld le b">#defaults</code>方法下，用户提供的任何键值对都将优先于默认的键值对。</p><p id="a299" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的<code class="fe lb lc ld le b">#initialize</code>方法看起来更干净，尽管可能比使用关键字参数更难理解。</p><p id="8335" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">话虽如此，如果默认值开始变得比简单的字符串和数字更复杂，建议为<code class="fe lb lc ld le b">#defaults</code>创建一个单独的包装方法并利用<code class="fe lb lc ld le b">#merge</code>。</p><p id="bb57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la">希望你喜欢这篇文章。请随意在下面留下一些掌声！</em></p></div></div>    
</body>
</html>