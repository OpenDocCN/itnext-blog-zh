<html>
<head>
<title>Karpenter: Open-Source, High-Performance Kubernetes Cluster Autoscaler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Karpenter:开源、高性能的Kubernetes集群自动缩放器</h1>
<blockquote>原文：<a href="https://itnext.io/karpenter-open-source-high-performance-kubernetes-cluster-autoscaler-d56e3ab06aae?source=collection_archive---------0-----------------------#2021-12-03">https://itnext.io/karpenter-open-source-high-performance-kubernetes-cluster-autoscaler-d56e3ab06aae?source=collection_archive---------0-----------------------#2021-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f767" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据AWS，kubernetes-native cluster auto scaler现在已经可以生产了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/02622ca41e39e8f52c3ea6ec44ff65fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PH0A0tT_nfEDLmnz.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片来源:<a class="ae le" href="https://github.com/aws/karpenter" rel="noopener ugc nofollow" target="_blank">卡尔彭特</a></figcaption></figure><p id="8c21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae le" href="https://aws.amazon.com/blogs/aws/top-announcements-of-aws-reinvent-2021/" rel="noopener ugc nofollow" target="_blank"> re:Invent 2021 </a>上，AWS宣布了Karpenter 的v0.5.0版本，标志着其开源的Kubernetes节点供应项目已经准备好投入生产。借助Karpenter，Kubernetes用户现在可以根据pod规范动态配置底层计算节点，比现有的<a class="ae le" href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" rel="noopener ugc nofollow" target="_blank">Kubernetes cluster-auto scaler项目</a>更加高效。</p><p id="542f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么Karpenter是如何工作的，它与cluster autoscaler有什么不同？</p><h1 id="3723" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">卡尔平特深潜</h1><p id="b73e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果你熟悉<a class="ae le" href="https://cloud.google.com/kubernetes-engine/docs/concepts/autopilot-overview" rel="noopener ugc nofollow" target="_blank"> GKE自动驾驶的动态节点供应流程</a>，你可以将Karpenter视为该工具的开源版本，旨在与任何Kubernetes集群一起工作(<em class="mi">注意:目前AWS是唯一官方支持的云提供商</em>)。类似于GKE自动驾驶仪，Karpenter观察不可调度pod的pod规范，计算聚合资源请求，并向底层计算服务(例如亚马逊EC2)发送请求，请求具有运行所有pod所需的容量。在底层，Karpenter定义了一个名为Provisioner的自定义资源，以指定节点配置配置，包括实例大小/类型、拓扑(例如区域)、架构(例如arm64、amd64)和生命周期类型(例如现场、按需、可抢占)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mj"><img src="../Images/ca45e9fcd57b16811efc490b7f520d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LU7PDoZVLWbChnGf.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图片来源:<a class="ae le" href="https://aws.amazon.com/blogs/aws/introducing-karpenter-an-open-source-high-performance-kubernetes-cluster-autoscaler/" rel="noopener ugc nofollow" target="_blank"> AWS博客</a></figcaption></figure><p id="9519" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，Karpenter还可以在不再需要节点时取消供应。这可以通过节点到期配置(<code class="fe mk ml mm mn b">ttlSecondsUntilExpired</code>)或在Karpenter配置的节点上运行的最后一个工作负载终止的时间来确定。这两个事件中的任何一个都会触发终结，终结节点、耗尽pod、终止底层计算资源并删除节点对象。这种取消供应的特性也可以用来使节点保持最新的AMI。</p><h1 id="bdf0" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Karpenter与集群自动缩放</h1><p id="8650" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">粗略地看一下，Karpenter的工作方式类似于现有的Kubernetes集群autoscaler项目。毕竟，cluster autoscaler也是云无关的，可以根据pod资源请求进行扩展或缩减。但是，经过仔细观察，Karpenter比cluster autoscaler有几个优点:</p><ul class=""><li id="3104" class="mo mp it js b jt ju jx jy kb mq kf mr kj ms kn mt mu mv mw bi translated"><strong class="js iu"> Kubernetes本地缩放</strong>:AWS集群自动缩放器利用<a class="ae le" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroup.html" rel="noopener ugc nofollow" target="_blank"> EC2自动缩放组</a>来触发缩放事件。由于ASG是在Kubernetes之前设计的，这种集成既笨拙又缓慢。例如，<a class="ae le" href="https://github.com/aws/containers-roadmap/issues/724" rel="noopener ugc nofollow" target="_blank">受管节点组用户仍然无法将其配置为将节点组扩展到0 </a>，这使得批处理工作负载类型在EKS上运行的成本更高。</li><li id="44a0" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated"><strong class="js iu">不需要预配置节点组:</strong> Cluster autoscaler只能根据节点组提供的规范来配置节点，这些规范要求worker组具有特定的标记，并且最适合使用类似的实例类型。这意味着，如果您想要运行性能测试，您需要预定义一个具有更强大EC2机器类型的节点组，以便集群自动伸缩触发伸缩事件。使用Karpenter，您可以按需利用所有AWS实例类型。由于Karpenter直接管理每个实例，无需节点组，因此当容量不可用时，请求新的计算实例也会快得多。</li><li id="b44c" class="mo mp it js b jt mx jx my kb mz kf na kj nb kn mt mu mv mw bi translated"><strong class="js iu">更快的调度</strong>:借助集群自动缩放，一旦新资源可用，pods就依靠kube-scheduler为新节点创建pods。由于Karpenter直接管理节点，它可以立即将pods启动到新节点，而不必等待调度程序。</li></ul><p id="a8d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于那些希望直观比较Karpenter和cluster autoscaler的人来说，以下视频很好地展示了关键概念:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="60d8" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">最后的想法</h1><p id="e657" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">多年来，我觉得EKS被改造成使用EC2，而不是平稳地运行容器和Kubernetes。我最大的失望一直是<a class="ae le" href="https://medium.com/geekculture/state-of-managed-kubernetes-2021-43e8a4ca0207" rel="noopener">小托管节点组<em class="mi">如何代表我管理</em>节点，相比之下GKE </a>。有了Karpenter，我可以卸载节点供应、自动扩展和升级，专注于运行我的应用程序。很高兴看到Karpenter将来作为托管插件与EKS捆绑在一起。</p></div></div>    
</body>
</html>