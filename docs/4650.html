<html>
<head>
<title>Swift iOS Background App Refresh in 3 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift iOS后台应用程序3步刷新</h1>
<blockquote>原文：<a href="https://itnext.io/swift-ios-background-app-refresh-in-3-steps-cadac5733c1e?source=collection_archive---------0-----------------------#2020-08-14">https://itnext.io/swift-ios-background-app-refresh-in-3-steps-cadac5733c1e?source=collection_archive---------0-----------------------#2020-08-14</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/6c4145cfc95e9dd8fd4ded1c3757264c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZIxZrQ_a-IaGbV4VNGOFA.png"/></div></div></figure><p id="4cb5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">iOS允许应用程序定期刷新其内容，即使它被发送到后台。当应用程序恢复到前台时，应用程序从其服务器检索最新信息并显示给用户是有用的。例如社交媒体应用程序(脸书、Instagram &amp; WhatsApp)和新闻应用程序。</p><p id="bb17" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">然而，这种后台应用程序刷新有很多限制，包括:</p><ol class=""><li id="2ee6" class="la lb iu ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated">用户权限</li><li id="7d07" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">刷新周期</li><li id="6fc5" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">每次刷新执行的持续时间(最长30秒)</li></ol><p id="c6aa" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">让我们看看如何设置后台应用程序刷新，并了解使用它的细节和技巧！</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="1338" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">后台应用刷新的3个步骤</h1><ol class=""><li id="3da1" class="la lb iu ke b kf mt kj mu kn mv kr mw kv mx kz lf lg lh li bi translated">在应用目标选项卡的“<strong class="ke iv">后台模式</strong>”会话中，勾选“<strong class="ke iv">后台获取</strong>”选项</li></ol><figure class="mz na nb nc gu jv gi gj paragraph-image"><div class="gi gj my"><img src="../Images/ba52db1b3d5d2b0eac6223738674941b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*LYdbaLwYVd33dNRCiY2n2Q.png"/></div></figure><p id="ea5d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">2.设置应用启动时应用刷新的最小间隔(<code class="fe nd ne nf ng b">didFinishLaunchingWithOptions</code>)</p><figure class="mz na nb nc gu jv"><div class="bz fq l di"><div class="nh ni l"/></div></figure><blockquote class="nj nk nl"><p id="2b53" class="kc kd nm ke b kf kg kh ki kj kk kl km nn ko kp kq no ks kt ku np kw kx ky kz in bi translated">切记，<strong class="ke iv"> iOS有权限控制app刷新的确切时间间隔！</strong>这个参数只是告诉iOS app期望的最高频率。</p></blockquote><p id="8806" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.在<code class="fe nd ne nf ng b">AppDelegate.swift</code>中实现<code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623125-application" rel="noopener ugc nofollow" target="_blank">application(_:performFetchWithCompletionHandler:)</a></code>方法。</p><figure class="mz na nb nc gu jv"><div class="bz fq l di"><div class="nh ni l"/></div></figure></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="bad0" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">通过Xcode模拟后台应用程序刷新</h1><p id="a999" class="pw-post-body-paragraph kc kd iu ke b kf mt kh ki kj mu kl km kn nr kp kq kr ns kt ku kv nt kx ky kz in bi translated">无限期等待iOS触发后台应用程序刷新是不值得的。为了节省时间，Xcode提供了一个在模拟器和真实设备上模拟后台应用程序刷新的功能。</p><p id="b71d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">请转到调试选项卡并单击“<strong class="ke iv">模拟后台提取</strong>”。</p><figure class="mz na nb nc gu jv gi gj paragraph-image"><div class="gi gj nu"><img src="../Images/e7f0bcec3784111159da24e55b09bf8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*nZv_0I0xki6MAf9RzHUP2w.png"/></div></figure></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="07c8" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">后台应用刷新详细信息</h1><ol class=""><li id="b2cd" class="la lb iu ke b kf mt kj mu kn mv kr mw kv mx kz lf lg lh li bi translated">iOS<strong class="ke iv">不</strong>保证app刷新的确切周期。只有当网络状况良好且设备不在<a class="ae nq" href="https://support.apple.com/en-hk/HT205234#:~:text=Low%20Power%20Mode%20reduces%20the,and%20off%20from%20Control%20Center." rel="noopener ugc nofollow" target="_blank">低功耗模式</a>下运行时，它才会向<code class="fe nd ne nf ng b">performFetchWithCompletionHandler</code>触发事件。这可以确保数据提取有可能成功。</li><li id="aa64" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">在<code class="fe nd ne nf ng b">performFetchWithCompletionHandler</code>回调中应该尽快调用<code class="fe nd ne nf ng b">completionHandler</code>。这是因为冗长的过程消耗更多的能量。为了给用户提供更好的UX，苹果将重新安排应用程序的更新时间，那些需要漫长过程的应用程序将会减少更新频率。</li><li id="46d5" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated">后台app刷新的最大持续时间限制在<strong class="ke iv"> 30s </strong>。我们可以通过在<code class="fe nd ne nf ng b">performFetchWithCompletionHandler</code>注销<code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uiapplication/1623029-backgroundtimeremaining" rel="noopener ugc nofollow" target="_blank">UIApplication.shared.backgroundTimeRemaining</a></code>来测试它。</li></ol><figure class="mz na nb nc gu jv"><div class="bz fq l di"><div class="nh ni l"/></div></figure></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="fc23" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">监控后台应用刷新授权</h1><figure class="mz na nb nc gu jv gi gj paragraph-image"><div class="gi gj nv"><img src="../Images/cad3f76a36f6b4226971525e8ffd4884.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*UKZxVX9PxArKNW9eUi6O8g.png"/></div></figure><p id="f05d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi nw translated"><span class="l nx ny nz bm oa ob oc od oe di"> U </span> ser拥有启用/禁用“后台应用刷新”的最终权限，即使网络和电池状况都处于良好水平。如果后台应用程序刷新是一项关键功能，开发人员应监控相应的授权，并将用户重定向到设置应用程序。</p><figure class="mz na nb nc gu jv"><div class="bz fq l di"><div class="nh ni l"/></div></figure><p id="a2f9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们可以使用<code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uiapplication/1622994-backgroundrefreshstatus" rel="noopener ugc nofollow" target="_blank">UIApplication.shared.backgroundRefreshStatus</a></code>来获取后台App刷新的当前授权状态。有三种可能的值:</p><ol class=""><li id="5785" class="la lb iu ke b kf kg kj kk kn lc kr ld kv le kz lf lg lh li bi translated"><code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/available" rel="noopener ugc nofollow" target="_blank">available</a></code>—用户已启用后台应用刷新功能。这是首次安装应用程序时的默认值。</li><li id="95af" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated"><code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/denied" rel="noopener ugc nofollow" target="_blank">denied</a></code> —用户已明确禁用后台应用刷新功能。我们可以将用户重定向到应用程序设置页面，用代码<code class="fe nd ne nf ng b">UIApplication.shared.open(URL(string: UIApplication.openSettingsURLString)!)</code>切换回状态。</li><li id="decc" class="la lb iu ke b kf lj kj lk kn ll kr lm kv ln kz lf lg lh li bi translated"><code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/restricted" rel="noopener ugc nofollow" target="_blank">restrict</a></code> —由于帐户限制，用户不能切换后台刷新状态，例如家长控制</li></ol><h2 id="59ee" class="of lw iu bd lx og oh dn mb oi oj dp mf kn ok ol mj kr om on mn kv oo op mr oq bi translated">监控授权状态的变化</h2><figure class="mz na nb nc gu jv"><div class="bz fq l di"><div class="nh ni l"/></div></figure><p id="679a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用户更改后台应用刷新状态后，可以通过观察<code class="fe nd ne nf ng b"><a class="ae nq" href="https://developer.apple.com/documentation/uikit/uiapplication/1623085-backgroundrefreshstatusdidchange" rel="noopener ugc nofollow" target="_blank">UIApplication.backgroundRefreshStatusDidChangeNotification</a></code>通知来通知应用。这可用于向用户显示任何弹出对话框，以解释后台应用刷新对应用流的用途和重要性。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="ee01" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">你可能喜欢的东西:</h1><p id="2d57" class="pw-post-body-paragraph kc kd iu ke b kf mt kh ki kj mu kl km kn nr kp kq kr ns kt ku kv nt kx ky kz in bi translated">如果你必须用运行iOS 13或以上版本的设备来支持用户，请使用新推出的<a class="ae nq" href="https://developer.apple.com/documentation/backgroundtasks" rel="noopener ugc nofollow" target="_blank"> BackgroundTasks框架</a>来代替。您可以在下面找到更多信息:</p><div class="or os gq gs ot ou"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-ios-13-backgroundtasks-framework-background-app-refresh-in-4-steps-3da32e65bc3d"><div class="ov ab fp"><div class="ow ab ox cl cj oy"><h2 class="bd iv gz z fq oz fs ft pa fv fx it bi translated">Swift iOS后台任务框架—后台应用程序更新分4步进行</h2><div class="pb l"><h3 class="bd b gz z fq oz fs ft pa fv fx dk translated">iOS 13引入了一个全新的框架——background tasks，用于处理app发送到…时的后台任务</h3></div><div class="pc l"><p class="bd b dl z fq oz fs ft pa fv fx dk translated">itnext.io</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ka ou"/></div></div></a></div></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="5f12" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">更多阅读和参考资料:</h1><h2 id="9119" class="of lw iu bd lx og oh dn mb oi oj dp mf kn ok ol mj kr om on mn kv oo op mr oq bi translated">1.Apple官方文档—使用后台应用程序刷新来更新您的应用程序</h2><div class="or os gq gs ot ou"><a href="https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_background/updating_your_app_with_background_app_refresh" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fp"><div class="ow ab ox cl cj oy"><h2 class="bd iv gz z fq oz fs ft pa fv fx it bi translated">Apple开发者文档</h2><div class="pb l"><h3 class="bd b gz z fq oz fs ft pa fv fx dk translated">编辑描述</h3></div><div class="pc l"><p class="bd b dl z fq oz fs ft pa fv fx dk translated">developer.apple.com</p></div></div></div></a></div><h2 id="a175" class="of lw iu bd lx og oh dn mb oi oj dp mf kn ok ol mj kr om on mn kv oo op mr oq bi translated">2.Raywenderlich背景模式教程</h2><div class="or os gq gs ot ou"><a href="https://www.raywenderlich.com/5817-background-modes-tutorial-getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fp"><div class="ow ab ox cl cj oy"><h2 class="bd iv gz z fq oz fs ft pa fv fx it bi translated">背景模式教程:入门</h2><div class="pb l"><h3 class="bd b gz z fq oz fs ft pa fv fx dk translated">在本教程中，你将创建一个应用程序，使用最常见的背景模式:音频播放，位置更新…</h3></div><div class="pc l"><p class="bd b dl z fq oz fs ft pa fv fx dk translated">www.raywenderlich.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ka ou"/></div></div></a></div></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><p id="dab1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">欢迎您在<a class="ae nq" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ myrik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>