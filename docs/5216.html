<html>
<head>
<title>Virtual Application Networks (VAN) for Multi-Cloud, Multi-Cluster and Cloud-Edge Interconnect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向多云、多集群和云边缘互连的虚拟应用网络(VAN)</h1>
<blockquote>原文：<a href="https://itnext.io/virtual-application-networks-van-for-multi-cloud-multi-cluster-and-cloud-edge-interconnect-1f63a8081f41?source=collection_archive---------1-----------------------#2021-01-14">https://itnext.io/virtual-application-networks-van-for-multi-cloud-multi-cluster-and-cloud-edge-interconnect-1f63a8081f41?source=collection_archive---------1-----------------------#2021-01-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/2961ddc1c91f380efe0223dfdebd184d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfTOvnj6dhlTgLywFa39Ew.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟应用程序网络—连接跨云、集群和网络的分布式应用程序</figcaption></figure><div class=""/><p id="1659" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现代软件开发正从客户机/服务器向服务无处不在的更灵活的架构发展。在多个位置部署或复制应用有多种原因:地理上分散的应用用于增强性能和可用性、维护合规性、互联车辆、5G的本地突破、远程边缘站点等。这种需求使得面向应用的多云和多集群连接成为云计算的必然趋势。</p><p id="8a8f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">VPN技术，如OpenVPN、Strongswan、Wireguard等。被广泛用于在站点之间建立安全的站点到站点的连接，尽管VPN在促进远程站点之间的连接方面是一致的，但也存在一些问题和复杂性。一些重要注意事项:VPN会混淆网络路径，增加网络延迟，通过VPN隧道监控网络路径是一项挑战，随着新站点的增加，要管理的站点到站点连接的数量呈指数级增长—扩展站点变得不切实际，云原生应用程序基于高级调度框架更改拓扑，连接必须自动检测拓扑，最后，VPN的配置和管理非常复杂。</p><p id="c937" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虚拟应用网络(VAN)可在云原生应用环境中实现分布式软件组件之间的高级通信功能，而无需处理复杂的第3层网络控制，如VPN、防火墙规则和访问策略。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi la"><img src="../Images/42733781351eb3ac9b7bde4a4f7401e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*32PUizW1tnQR_To_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟应用网络</figcaption></figure><p id="eaf9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">VAN是覆盖在基于TCP/IP的互联网上的应用层网络。货车可以小到一台笔记本电脑，也可以大到跨越时区和大陆的全球网络。一个VAN可以由一个没有特权的开发人员快速地建立起来，它的拓扑结构可以很容易地添加和修改。使用现有协议(如HTTP、gRPC、AMQP或任何运行在TCP或UDP上的协议)编写的应用程序无需修改就可以在VAN上运行。VAN寻址使用任意字符串直接指向端点，而不依赖于底层主机和端口信息。</p><p id="94ef" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper项目是为Kubernetes构建的一个免费的开源实现。Skupper可以通过简单的配置实现不同集群中运行的应用程序之间的连接，而不必担心特权提升、集群访问或管理员访问(用户只需要访问他被允许使用的特定名称空间)。Skupper可以满足各种各样的用例，其中一些如下所示。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lg"><img src="../Images/8262777a12ac286b9525d65ef3ee6eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w2ZzcIYCXf0a87B1"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用例—货车</figcaption></figure><p id="3259" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg"> VAN地址是一个DNS风格的名称，引用一个进程</strong></p><p id="1405" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">传统的TCP/IP寻址使用“<em class="lh">主机:端口</em>对来指代端点，传统的TCP/IP互联网在将数据从一个点移动到另一个点时快速可靠，但它不太适合支持云原生软件系统的现代需求。在容器和无服务器计算的现代环境中，端口主机的概念增加了额外的开销，并且无法扩展。在提供容器的多个开发人员或团队之间协调端口分配是非常困难的，并且会使用户面临超出他们控制的集群级问题。</p><p id="6da3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">VAN寻址遵循DNS风格命名，其中地址是一个名称。VAN根据VAN地址(简称为“名称”)路由应用流量，而不考虑托管应用的系统所使用的底层IP地址。VAN地址引用正在运行的进程，而IP地址引用运行该进程的主机。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi li"><img src="../Images/b508e8fd3376ab13d610c2a435aab9a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HX2skcqB6AC4IL75"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">TCP/IP与VAN寻址</figcaption></figure><p id="4799" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">货车地址是多路访问的</strong></p><p id="99a1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">IP寻址主要是单播，每个地址代表一台主机。IP确实有多播寻址的概念，其中IPV4和IPV6支持多播，IPV6支持任播，但是在局域网范围之外的实践中并不使用。VAN寻址是<em class="lh">任播</em>或<em class="lh">组播</em>。它建立了这样一种思想，即多个软件组件可以使用相同的地址连接到网络上，以实现多播传输或负载平衡。VAN多播和任播不受组件位置的限制，因此提供网络范围的多播传递和任播负载平衡。</p><p id="de2b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">安全的站点到站点连接</strong></p><p id="705d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在VAN上运行的应用程序受益于网络固有的安全机制。VAN中的所有站点间连接都通过专用的证书颁发机构使用相互TLS(传输层安全性)锁定。来自外部世界的访问只发生在开发者希望提供对门户或web前端的公共访问的地方。服务不会意外地暴露在互联网上。</p><h1 id="083e" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">VAN路由器— Apache Qpid调度路由器</h1><p id="218f" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated">通过在将成为分布式应用命名空间的一部分的每个站点中部署一个VAN路由器(调度路由器),并通过在成对的站点之间建立安全连接，来建立一个VAN。一个站点可以是数据中心中的一个LAN、一台主机或Kubernetes集群中的一个名称空间。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mm"><img src="../Images/69a537e45df623f270e9cdcd4a21456e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*si5qCIkRGqsbN5Sv"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">VAN路由器连通性</figcaption></figure><p id="bc1b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper使用<a class="ae lf" href="http://qpid.apache.org/components/dispatch-router/" rel="noopener ugc nofollow" target="_blank"> Apache Qpid调度路由器</a>作为它的VAN路由器。该路由器基于AMQP协议，是轻量级和无状态的。除了基本路由器之外，Skupper还提供工具来简化网络设置，并提供从HTTP、gRPC和TCP等常用协议到VAN网络的映射。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/d3f894f5c4b41924a04ae2a9afa5bba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s6nf4GOCzB4ocLjz"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Apache Qpid调度路由器</figcaption></figure><p id="bbcd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">调度路由器是一个轻量级的AMQP消息路由器，用于构建可扩展的、可用的和高性能的消息网络。调度路由器灵活地在任何支持AMQP的端点之间路由消息，包括客户端、服务器和消息代理。AMQP除了是一个开放的标准协议，允许系统之间的消息传递互操作性之外，它还是一个通用的网络协议，在服务和API交付方面比HTTP有真正的优势。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c1eec57d8bdf846a034c983768f72d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*RvFxouDoihZTZobe"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">计算最低成本路径-LSRP</figcaption></figure><p id="7f50" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">路由器网络使用类似于OSPF或IS-IS的链路状态路由协议来检测拓扑，并计算每对站点之间的最低成本路径。路由协议会快速自动地对拓扑结构的变化做出反应。这用于提供对故障的恢复能力，并且还使得在需要扩展或改变时从网络中添加位置和移除位置变得容易。</p><p id="ffb4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在下面的拓扑示例中，专用网络A和专用网络B是具有两个不同专用网络的两个不同站点。客户端(C1)位于专用网络B中，后端(B2)位于专用网络A中，通过调度路由客户端C1可以使用专用网络B中的路由器和公共网络之间建立的连接来访问专用网络A中的队列、主题和其他AMQP服务。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/6ec152166793d6af39c467c3af9b00d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DGwkJH2GHdom2NLM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid调度路由器连接</figcaption></figure><p id="8255" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，路由器Ra和Rp可以被配置为将代理B2和代理B1中的队列暴露给网络。然后，客户端C1可以建立到本地路由器Rb的连接，打开到“b1.event-queue”和“b2.event-queue”的订阅链接，并接收存储在代理B1 &amp; B2中的那个队列上的消息。</p><p id="24d1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这种情况下，B1、B2和C1都没有以任何方式被修改，也不需要知道它们之间存在消息路由器网络的事实。</p><h1 id="77b1" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Skupper —组件</h1><p id="938b" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated">Skupper的控制平面组件包括服务控制器和路由器。这两个组件都被部署为感兴趣的名称空间中的部署。路由器组件是实际的Apache Qpid调度路由器，服务控制器促进了公开服务的同步。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/49df5ba4c875be2a8fb38a4febabbdf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HhNxddNEiZEbBw73"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —组件</figcaption></figure><p id="210d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该路由器有助于跨站点连接到其他路由器，并依赖于网桥配置(配置连接器时将被编程的configmap)来检索任何已配置的连接器。使用生成的令牌建立连接，并且使用“<em class="lh">set-context-current-namespace</em>”对令牌进行命名空间限定。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/9fa4b4387177f02d917789463ea1650a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3sOfg_GteNDe77Kl"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper路由器</figcaption></figure><p id="7f94" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务控制器跟踪公开服务的信息。名称空间中的s cupper-services config map在用户配置时用暴露服务的列表进行编程。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/b3dc3e30133f7aa307cce6e3245436ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kb7SS6KsarmEolmC"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper服务控制器</figcaption></figure><p id="8273" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有与路由器相关的配置都作为配置映射提供给路由器部署。skupper-site包括站点名称和其他全局配置参数。s kupper-内部和s kupper-由控制器编程的服务当用户在远程站点公开可用的服务时，这可以使用s kupper CLI(s kupper expose deployment)或向部署提供注释(<em class="lh">skupper.io/proxy和</em>)来配置。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/fb03f1bb003e012ff33d22c4043188c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jNf7MQ9PSkWOZRbr"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper配置映射</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/afbaa6dbe5af2f6b4adbf5c45693eea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*59BMCFGv8r_ziB26"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —站点配置</figcaption></figure><p id="08f2" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有到VAN中其他路由器的站点间连接都使用mutual TLS(传输层安全性)锁定，并提供一个私有的专用认证机构作为秘密。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/33d097aac3085e156a8941f6582b73f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_WDFLqGT5Iv7R89h"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">秘密</figcaption></figure><p id="01db" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在公共云设置中，skupper-controller(路由器)服务被公开为具有公共连接的服务类型负载平衡器，因为私有站点对等需要它。在私有/边缘设置中，唯一的要求是具有出口互联网连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/5ec607071eac7f68d74a0020fa9a0088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WvVxzJeOn3NkBsVa"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —服务</figcaption></figure><p id="222a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">skupper-controller提供了两个控制台，一个是Apache Qpid调度控制台，另一个是skupper控制台(这两个控制台都可以用skupper-site configmap激活，或者用'<em class="lh"> skupper init </em>'传递参数)。Apache Qpid调度控制台提供与路由器和相关连接相关的大量信息，以及具体的监控和模式信息。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/3efd72651558e64d447fab72c28e4a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kwVzWHGSwrC0DbvG"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid —控制台</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/83197ddccfed07e2c65ce9d3f1e8fe71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nxAeNfWceXISbv8s"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid —控制台</figcaption></figure><p id="dc35" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“连接”部分提供了与网络中其它路由器建立的所有路由器-路由器连接、本地连接和基于AMQP的连接的列表。拓扑部分提供了网络中路由器和消息流信息的图形视图。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/eb9c3f86a854a0f8fe87d32660082d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GeFV9HoeD02AzyTV"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid —控制台</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/01c27da3584b0a1e88bcf409603c7f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sIgxfjEYZERSJpyf"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid —控制台—拓扑</figcaption></figure><p id="0980" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper console提供了关于连接站点的简单而丰富的信息，以及部署和服务的详细图形视图。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/794b133ac8be83d052d87f6ea33ac181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GvWj--tO8uT52s-8"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —控制台</figcaption></figure><h1 id="5635" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">尝试—在公共云和边缘站点之间创建一个具有私有连接的VAN</h1><p id="7019" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated">下面的测试拓扑包括一个GKE集群、EKS集群和两个使用Kubeadm引导的私有集群，Skupper只需要一个Kubernetes集群，不依赖于平台/发行版或供应程序。</p><p id="6e86" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在下面的拓扑中，有四个跨云平台和网络的K8集群。GKE和EKS包含<em class="lh"> skupper-controller </em>作为负载均衡器公开，路由器彼此对等。另外两个专用集群(没有来自互联网的公共连接)与GKE集群上的路由器对等。专用集群可以位于不同的隔离网络中，在下面的示例中，尽管两个专用集群位于同一个网络中，但它们并不相互对等(模拟相互之间没有连接的远程站点)。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/4201a0b7ec9d6752fb9f144c7116b800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dT8uA3tcZ0EQjYjQ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">测试拓扑</figcaption></figure><h1 id="ff2f" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">1.连接GKE和EKS</h1><p id="fc7d" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated">GKE集群:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/b9cfe3de33ae4f5e38293d386a0c8cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LON1nPJ6ygirGGEi"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">GKE集群</figcaption></figure><p id="dfc4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">EKS集群:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/f382b353f99a17ceb9eda67f14ba49d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fR1BbuBMuKazoOVZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">EKS集群</figcaption></figure><p id="55a6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">GKE的Skupper路由器和服务控制器:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/7a841c33633bb48f576bcbc3adc9a472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xKN_9AXCiP4TCy5c"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">GKE的Skupper组件</figcaption></figure><p id="cef4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">EKS的Skupper路由器和服务控制器:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/4452f9c76d9674c3ab2c5705e01d4cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6K5iz3NVvEOb4tIe"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">EKS的Skupper组件</figcaption></figure><p id="ba00" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper控制器在GKE上显示为'<em class="lh">类型:外部负载平衡器'</em>:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/5f678f8321523df37f92aed4b2a9b6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W8h6iCXZo35pKAyN"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper控制器服务LB</figcaption></figure><p id="a18c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用命名空间范围的连接令牌对连接路由器进行身份验证。这可以使用s kupper CLI(s kupper connection-token)或通过创建一个将产生连接令牌<em class="lh">的资源——‘skupper.io/type:连接令牌请求’</em>来生成。在这种情况下，在GKE上创建一个连接令牌，并在EKS用于建立连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/f9be29d230e708111dd956deb229f758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NYsuRLieFbp9S_g8"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —连接令牌</figcaption></figure><p id="b73f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦连接建立，基础设施AMQP消息流将在调度路由器之间开始。用户可以使用QPID控制台收集关于拓扑、日志和流量信息的各种信息。</p><p id="a644" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">EKS凝视着GKE:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/83d18fa38b4a8ac4479d6c4489df8233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7Xmbc8FIhrS5omRZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid调度路由器—拓扑</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/b8293754d21940972c3ae4253844486b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iW_Sd98dHAAzcv9Q"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid调度路由器—控制台</figcaption></figure><p id="6abf" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">EKS和GKE之间的消息流可视化:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/280f8160d21e4f246016f100ed33eba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qSKHaSNKjkVNBbrA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid调度路由器—可视化</figcaption></figure><p id="9b06" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">EKS上的调度路由器连接到GKE上作为负载平衡器公开的skupper-controller服务:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/8dc5cfe016642b26e1569b071d340bbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M44HYv4dHmXUcSPC"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid调度路由器—控制台</figcaption></figure><p id="06bd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">具有连接站点信息的Skupper控制台门户:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/587a4020f42331393abc6cadd725c0f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dBDivdqPp65VgjWB"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —控制台</figcaption></figure><h1 id="c107" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">2.连接边缘西部和边缘东部到GKE</h1><p id="e52b" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated">edge-west和edge-east集群是在连接到家庭网络的Udoo X86上运行的私有集群。</p><p id="6771" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，edge-west路由器使用公共服务端点与GKE上的路由器对等。在这种情况下，GKE连接令牌用于创建edge-west和gkeuseast之间的连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/89baad51ac878717cde70ca0ed2de114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z7ET039c0Bz0EUlO"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">公开服务—货车</figcaption></figure><p id="ca43" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为每个连接器创建SSL配置文件，边缘站点中的路由器与GKE上的路由器建立安全的相互TLS连接:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/7d8992a0020d3714599ce34c3fc2b819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kKAdaXsNKmeHseWV"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">公开服务—货车</figcaption></figure><p id="6fac" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">连接站点的Skupper控制台视图:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/9688ff5191679aeb0f96cbf06721f598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pXFWOw1aZBtn339v"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper连接的站点拓扑</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/980a3defe04d7252c9404b8b27963c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8u7ZaLbnYCf3M7-Z"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper连接的站点拓扑</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/000063615c2072294f4dc7cac3202f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f1UiOWnmZIixZ2Mq"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper连接的站点拓扑</figcaption></figure><p id="c0ff" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">QPID拓扑视图:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/2477c8ae42f46b0f6093809dbb82b17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rnx8VmNWoJ_H-vgL"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—连接的站点拓扑</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/cab5c0755ddb1ed4813a85005bab9a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vkjRp9CF_mwKTKna"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—连接</figcaption></figure><p id="c1b6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Qpid控制台—流量指标:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/219204137724117b34a1629f8f4ff7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qceNqkMxXmZkvZA1"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—连接</figcaption></figure><p id="6380" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">类似地，第四个集群/站点edge-east也与gkeuseast对等，如下所示:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/1ef34475ff33755b26d57dceabc714ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9pazbOq-cy_BG7yA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper连接的站点拓扑</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/0d1d3b5c6d44c5afb59e5b53a8082193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kkpxImyv1S1kQVPD"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—连接的站点拓扑</figcaption></figure><p id="c863" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">该拓扑现在在两个集群之间有一个VAN连接，具有到Skupper服务的公共连接，以及两个没有来自互联网的入口连接的私有集群。没有打开特定的端口，而是在路由器之间建立了TLS连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/af21da8b9948be40b860407178bfb4f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GrcNOR2172aXFvIi"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —消息流监控</figcaption></figure><h1 id="148a" class="lj lk jf bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">尝试—在分布于上述四个相连集群的单个Hipster服务之间建立VAN连接</h1><p id="659b" class="pw-post-body-paragraph kc kd jf ke b kf mh kh ki kj mi kl km kn mj kp kq kr mk kt ku kv ml kx ky kz ij bi translated"><a class="ae lf" href="https://github.com/GoogleCloudPlatform/microservices-demo" rel="noopener ugc nofollow" target="_blank">潮人商店</a>由许多用不同语言编写的微服务组成，这些微服务通过gRPC相互对话。这个应用程序部署拓扑包括服务，这些服务是位于不同平台的不同集群上的不同名称空间中的应用程序(前端、后端和数据库)的一部分。从技术上来说，这意味着他们没有办法交流，除非他们暴露在公共互联网上。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/b42fe2ff83dd4d9c833ba7c96d50e97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HcnAxzevP8AbhTSb"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">跨集群的样本Hipster应用程序</figcaption></figure><p id="f6ea" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将Skupper引入每个名称空间有助于创建一个虚拟应用程序网络，该网络可以连接不同集群中的服务。应用程序网络上公开的任何服务在所有连接的名称空间中都表示为本地服务。当前端向所有其他后端实体发送请求时，Skupper将请求转发到后端运行的名称空间，并将响应路由回前端。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/a0a68b340d9be4b49dff9d27927495aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nSw1wX6NvJANBLHU"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper路由器-服务交互</figcaption></figure><p id="7428" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper使用户能够配置协议(tcp、http或http2。默认“tcp”)与端口一起用于通信。在上面的例子中，服务与数据库的连接是“tcp ”,因此用户可以通过用的和的标注服务对象来配置具体的协议</p><p id="e0c1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">前端服务部署在<em class="lh"> gkeuseast </em> (GKE)集群上，没有必要向Skupper公开此服务，因为这是面向用户的，将使用GKE提供的负载平衡器IP (public_ip)进行访问。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/08fe642394c1fbe0c457faa4e05851ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xO27waHOmd00kwJ8"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Fronetend应用程序— GKE</figcaption></figure><p id="8137" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务:购物车，结帐，货币和redis-cart部署在EKS</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/6f00b7fd97a33ad8e116970e444bc5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7JdcfHvGfCcGDU-o"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务— EKS</figcaption></figure><p id="c0e3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务:产品目录和建议部署在edge-west上</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/b2e8bc9e2432678f667f645c877ede50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XVAMYAUalSJYc6n5"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务—边缘1</figcaption></figure><p id="7648" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务:emailservice、paymentservice和shippingservice部署在edge-east上</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/d9b8fe331bc7ac7d99e9a543baa47eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uzl1Z_O-UOxOc4gN"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务— Edge2</figcaption></figure><p id="08db" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下图所示，hipster应用程序不起作用，因为不同集群中的其他服务还没有暴露给Skupper。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/c4efe9a8be68f02fe15a58c0725aa1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wh563Rp9blHJsuMK"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">潮人—非功能性应用</figcaption></figure><p id="5662" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务产品目录和建议在edge-west上向VAN公开。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/9bdadd0fe30264ac8b1c9c4e3863af3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A74xSf-iGBWoD53Z"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="37bf" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦服务被公开，服务就向skupper-router发送请求，然后这些请求被转发给网络中的其他路由器，如下所示:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/7e222e67f50a8901bf19161ab6a491aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5tcywQABp0lX1wO_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="dcc4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">控制器添加skupper-internal config map<em class="lh">bridges . JSON和</em> skupper-services configmap文件，其中包含特定路由器所在命名空间中服务的连接器、相应地址、协议和端口信息，skupper-router和服务控制器将使用这些信息来配置连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/fd1898c11f8d1556a5039fc073f49776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3fskgOGFsWPw65a6"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/ca4612881a30cad380cf1fcec15e9cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0kMX12NP7n6-xuU0"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="13d4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper路由器公开带有端口和站点ID信息(路由器id)的服务:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/334bd9177dd16284077d225879d480be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U2vBAL2ffkC2Auf_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="9bf6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper服务控制器维护所有公开服务的信息:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/bc55e6ee190e1029386d0fb4f74ad0f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q4sHKfyxQlNVuAHz"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="76b5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务:广告、购物车、收银台、货币都在EKS集群上展示。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/0fd7542602ff78087a2810c4c900fea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K8dQ7w6WsuWN9DhS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="cb34" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务:电子邮件、支付和运输都在edge-east上公开。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/1ceb6c77a5da5911f801e9a046a6049a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rDirg9_0XOeb5Mis"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —公开服务</figcaption></figure><p id="bdea" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">默认情况下，所有的服务都用协议:tcp进行了注释，例如，上面的拓扑结构包括多个通过“http”进行通信的服务和cart服务，cart服务是一个需要“tcp”连接的redis数据库。可以根据所需的连接性向单个服务添加注释。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/3cc1df2336c26d52be99abca4780be77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GWtGlrqSOm17Z5nL"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper注释</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/6453cd90b11748d896ab2b34c3279a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NX-wjcAKa0q-FAPI"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper注释</figcaption></figure><p id="f7a0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦所有的服务都暴露在VAN中，应用程序就可以运行，并且现在可以与位于不同平台上的不同集群中的所有其他集成服务进行通信。使用VAN，私有集群中的服务可以被位于公共集群和其他远程私有集群中的其他服务访问。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/e809c3b797c2b2cc6d0d8985b468c9d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f1MCClVg-Esi-Ebv"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">潮人—功能性应用</figcaption></figure><p id="9a51" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“铜控制台部署”选项卡显示成员站点中的所有部署:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/36e8371553e9a12049552c64fe90dfb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oB3LF5MYk9-qnC_P"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —部署控制台</figcaption></figure><p id="3110" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">带有服务连接信息的部署和站点的图形视图:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/fcbf0d1d1a66288fcdea72da8bf9493c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XoAC0CEa2By9Bt3f"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —部署控制台</figcaption></figure><p id="9995" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">监控服务之间的流量:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/c2834254c9b276cf1ad837725f217443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vy7qkpzFh05yzpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —部署控制台</figcaption></figure><p id="79a8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上图所示‘10 . 48 . 2 . 6’是位于GKE集群的前端服务的pod_ip。借助VAN，pod可以与不同集群和网络空间中的其他pod(服务)进行通信，而无需任何站点到站点的VPN连接。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/5d8c599b19c1904c159c3720788c5c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tfrQculS5wD_k0h0"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">前端— Pod_IP</figcaption></figure><p id="fef0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Qpid控制台提供了有关服务连接的详细信息:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/359747709d528b540d9d31193dd6c901.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fIN6JffUfJ82ymRC"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—控制台</figcaption></figure><p id="323d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper —服务的图形视图，包含运行状况、流量和协议信息:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/40001314f8c9fce8b6ad707b3ece296d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1SOJ-x-LyfaOYBiD"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —服务控制台</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/18e269755d6c8f26cd28eb2e574c892d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jXEaugJprtpwWCOB"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —服务控制台</figcaption></figure><p id="d78c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Skupper控制台—站点和服务之间消息流的图形视图:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/8c13422127641c2754adbddbba1b0d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q3Ojb1blOmOK3j5_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —消息流可视化</figcaption></figure><p id="760d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Qpid控制台提供流量水平监控和实时流量:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/f5f8471fcbb2b60c0c2c9bbe79bba908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T9cfE46uwhXcEDDK"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—消息流可视化</figcaption></figure><p id="af8b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">拓扑中的冗余路径提供了针对站点或连接故障的弹性。即使多个专用网络有重叠的CIDR子网，并且没有中央控制器或单点故障，它们也可以参与进来。例如，在使用的拓扑中，可以从两个边缘群集到EKS群集建立连接以实现冗余，如下所示:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/5cc9a539258139a6b0e8c6bf3856743b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-4zyg2m_K16ev6V6"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Skupper —连接的站点拓扑</figcaption></figure><p id="d56f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">两个边缘集群的拓扑与EKS和GKE的路由器对等:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/8ddaac30f822e54c76a9ccecd82b228e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5ZagxIGS6ngEdG4D"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Qpid路由器—连接的站点拓扑</figcaption></figure></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="2882" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">越来越多的应用程序和框架在设计上不再直接绑定到任何云，也不再局限于部署在单个集群中。有了VAN，云原生应用程序的开发人员就不必考虑运行应用程序服务所涉及的主机或端口。VAN可以用更简单的方法和配置满足各种复杂的用例。</p></div></div>    
</body>
</html>