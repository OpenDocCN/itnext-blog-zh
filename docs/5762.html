<html>
<head>
<title>Next Js + React-Intl: Add Internationalisation to Your Next App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">下一个Js + React-Intl:在你的下一个应用中加入国际化</h1>
<blockquote>原文：<a href="https://itnext.io/next-js-react-intl-add-internationalisation-to-your-nextjs-app-4f933104b1f7?source=collection_archive---------0-----------------------#2021-05-20">https://itnext.io/next-js-react-intl-add-internationalisation-to-your-nextjs-app-4f933104b1f7?source=collection_archive---------0-----------------------#2021-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/62849cd3210a93b8b0c357f7c1628770.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WdZxQum1uOGduCmOrbrQug.jpeg"/></div></div></figure><p id="3810" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实施国际化在过去是一个巨大的痛苦。Next 10通过在内部处理一些必需的特性，简化了这个过程。</p><p id="e438" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博客文章中，你将了解到</p><ul class=""><li id="21c9" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">如何在你的下一个应用中集成react-intl</li><li id="4298" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">如何配置CLI以自动提取消息</li><li id="4b58" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">如何配置Babbel为您的消息自动生成Id</li><li id="83c8" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">如何使用NextJs 10(及更高版本)中新的国际化特性</li></ul><p id="4a7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">先决条件:</strong></p><ul class=""><li id="53a3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">对NextJS的一般了解</li><li id="05a5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">对react-intl的一般理解</li></ul><h2 id="6b23" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">💻按照这篇文章安装所需的包</h2><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="faf1" class="lk ll iq mi b gy mm mn l mo mp">npm install react-intl &amp;&amp; npm install --save-dev @formatjs/cli babel-plugin-formatjs</span></pre><h2 id="fee4" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">👏🏼使用Next的新本地化特性</h2><p id="d90b" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">从Next 10开始，框架将为您完成大部分的国际化工作。接下来会帮助你…</p><ul class=""><li id="beca" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">确定向用户显示的最佳语言(通过使用浏览器配置的语言或Cookie)</li><li id="7370" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用子路径(example.de)或域路由(example.de)处理页面路由</li><li id="f4ec" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">在文档的全局&lt; html &gt;标签上设置<code class="fe mv mw mx mi b">lang</code>属性</li></ul><h2 id="71ef" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">☄️:我们开始吧</h2><p id="b5f5" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">要配置您的下一个应用程序使用国际化，请在您的项目根目录中创建或编辑您的<code class="fe mv mw mx mi b">next.config.js</code>文件(即使您的项目是TypeScript项目，该文件也需要是JavaScript文件):</p><blockquote class="my mz na"><p id="0382" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>为了简单起见，我将在这篇博文中设置子路径路由。子路径路由会在你的URL后面添加一个<a class="ae nf" href="https://unicode.org/reports/tr35/#Identifiers" rel="noopener ugc nofollow" target="_blank"> UTS地区标识符</a>，例如example.com/de(你的应用程序的德语版本)或example.com/en(你的应用程序的英语版本)。</p></blockquote><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="964f" class="lk ll iq mi b gy mm mn l mo mp">// next.config.js<br/>module.exports = {<br/>  i18n: {<br/>    locales: ['en-US', 'de-DE'],<br/>    defaultLocale: 'en-US',<br/>  },<br/>}</span></pre><p id="de98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将告诉Next为您配置的语言环境处理子路径路由。</p><h2 id="5bd3" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🚙创建区域设置文件夹和起始文件</h2><p id="5bac" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">React-intl需要两个文件夹来管理你的语言文件。</p><ol class=""><li id="3e34" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv ng lc ld le bi translated"><strong class="ka ir">一个包含您的翻译的文件夹(默认语言环境将由CLI生成):</strong>您将使用该文件夹来创建&amp;您想要翻译的编辑字符串。</li><li id="3d53" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv ng lc ld le bi translated"><strong class="ka ir">编译语言文件的文件夹:</strong> FormatJS将使用您的翻译文件，并根据它们创建编译文件。React-intl将使用这些文件来显示翻译后的字符串。</li></ol><h2 id="976e" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">💻创建以下文件夹和文件:</h2><ol class=""><li id="b45d" class="kw kx iq ka b kb mq kf mr kj nh kn ni kr nj kv ng lc ld le bi translated">项目根目录下名为<code class="fe mv mw mx mi b">content</code>的<strong class="ka ir">文件夹</strong></li><li id="f440" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv ng lc ld le bi translated">一个<strong class="ka ir">文件夹里的</strong>叫做<code class="fe mv mw mx mi b">locales</code>里面的<code class="fe mv mw mx mi b">content</code></li><li id="2436" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv ng lc ld le bi translated">一个<strong class="ka ir">文件</strong>在<code class="fe mv mw mx mi b">locales</code>里面叫做<code class="fe mv mw mx mi b">en.json</code></li><li id="2213" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv ng lc ld le bi translated">一个<strong class="ka ir">文件</strong>在<code class="fe mv mw mx mi b">locales</code>里面被称为<code class="fe mv mw mx mi b">de.json</code></li><li id="3924" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv ng lc ld le bi translated">一个叫做<code class="fe mv mw mx mi b">compiled-locales</code>的<strong class="ka ir">文件夹</strong>里面的内容</li></ol><p id="e049" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mv mw mx mi b">en.json</code>和<code class="fe mv mw mx mi b">de.json</code>内放置一个空的物体<code class="fe mv mw mx mi b">{}</code>。空对象是有效的JSON。</p><h2 id="4317" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🤩配置React-Intl</h2><p id="fcaa" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">如果您以前使用过react-intl，您会意识到设置react-intl需要在文档顶部提供一个提供者。转到您的<code class="fe mv mw mx mi b">_app.tsx</code>文件并添加以下内容:</p><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="3f9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🎙我们在这里做了什么？</p><ul class=""><li id="4bbc" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">由于NextJS在内部处理国际化，它允许我们在应用程序的不同位置提取地区信息(例如getStaticProps，getServerSideProps)。或者，我们可以使用<code class="fe mv mw mx mi b">useRouter()</code>钩子来访问用户的当前语言环境。我们正在访问这个区域并从中提取前两个字母。于是，<code class="fe mv mw mx mi b">en-US</code>(这是locale)变成了<code class="fe mv mw mx mi b">en</code>。我们使用前两个字母，因为我们希望向所有英语用户(美国、英国等)只提供我们应用程序的一种翻译。)</li><li id="fba2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">我们使用<code class="fe mv mw mx mi b">messages</code>来检索正确的编译(！)翻译文件。我们通过使用<code class="fe mv mw mx mi b">messages</code>属性将匹配的翻译文件传递给<code class="fe mv mw mx mi b">IntlProvider</code>。</li><li id="a930" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">我们在<code class="fe mv mw mx mi b">IntlProvider</code>上指定了一个<code class="fe mv mw mx mi b">onError</code>道具，以抑制开发过程中恼人的错误消息。这些错误消息提醒您缺少翻译。如果您想查看错误，可以忽略此设置。</li></ul><h2 id="d346" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">💻配置格式命令行界面</h2><p id="53a4" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">react-intl的主要优势之一是它带有一个专用的CLI。CLI允许我们自动检索我们想要翻译的所有消息，为它们分配一个唯一的Id，并将它们放入我们的翻译文件中。</p><p id="274f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 🎙是什么意思？</strong></p><p id="540e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们通过使用<code class="fe mv mw mx mi b">&lt;FormatMessage .. /&gt; or intl.formatMessage(...)</code>指定一个翻译字符串，我们可以运行一个CLI命令来获取新消息，并用新消息自动填充我们的默认语言环境文件。这意味着我们不必手动将每条新消息添加到我们的翻译文件中(至少对于我们的默认语言是这样)。</p><p id="a3f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使用FormatJS CLI，我们必须对其进行配置。在这篇文章的开始，我们已经安装了CLI。现在，我们使用package.json文件配置定制命令。</p><p id="5aa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mv mw mx mi b">package.json</code>文件的脚本部分，添加以下内容:</p><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="dee5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">🎙我们在这里做什么？</p><ul class=""><li id="ee9c" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><code class="fe mv mw mx mi b">extract</code>命令将CLI配置为遍历文件夹<code class="fe mv mw mx mi b">pages, components &amp; sections</code>并找到所有定义的消息。它将对消息应用散列函数，并将输出作为本地文件中的一个键。React-intl使用这种机制来检查消息是否发生了变化。我们定义所有找到的消息都应该被写到位于<code class="fe mv mw mx mi b">content/locales/en.json</code>的<code class="fe mv mw mx mi b">en.json</code>文件中。</li><li id="8fa7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe mv mw mx mi b">compile</code>命令将从<code class="fe mv mw mx mi b">content/locales/*</code>中提取消息，并从我们的语言环境文件中创建编译后的消息。<strong class="ka ir">节点:</strong>确保您的文件夹路径不以“/”结尾，因为在这种情况下CLI将找不到您的文件。</li><li id="b536" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe mv mw mx mi b">i18n</code>命令是一个快捷方式，我们可以在开发过程中使用它来提取和编译我们的翻译文件，并检查它们的正确性和完整性(您必须手动管理您的翻译或使用工具/服务)</li></ul><p id="c2fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里 (FormatJS CLI参考)阅读关于这些选项<a class="ae nf" href="https://formatjs.io/docs/tooling/cli/" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><h2 id="4d07" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🖐🏽在运行命令之前</h2><p id="f296" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">为了配置我们的翻译，我们还需要做一步。到目前为止，我们已经配置了react-intl来为我们自动生成翻译id。这是一个设计选择，因为我们也允许手动提供id。</p><blockquote class="my mz na"><p id="24a7" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated">要手动提供id，您可以这样指定消息:</p><p id="ce2b" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated"><formattedmessage defaultmessage="Good Morning" class="ka ir"> id="some id"  / &gt;</formattedmessage></p></blockquote><p id="aa2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了将这些自动生成的id附加到我们的消息中，我们必须使用定制的<a class="ae nf" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank"> Babel </a>配置来配置我们的构建管道。在您的项目根文件夹中，创建一个名为<code class="fe mv mw mx mi b">.babelrc</code>的文件。这个文件是Babel的标准配置文件。将以下内容添加到文件中:</p><figure class="md me mf mg gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="ed56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们使用了我们在这篇博文开始时安装的<code class="fe mv mw mx mi b">@babel-plugin-formatjs</code>。</p><blockquote class="my mz na"><p id="61d3" class="jy jz nb ka b kb kc kd ke kf kg kh ki nc kk kl km nd ko kp kq ne ks kt ku kv ij bi translated"><strong class="ka ir">注意:如果您已经运行了任何命令或更改了您的区域文件夹中的文件:</strong>删除<code class="fe mv mw mx mi b">content/compiled-locales</code>中所有编译的语言文件，并将<code class="fe mv mw mx mi b">content/locales</code>中的文件恢复为空对象<code class="fe mv mw mx mi b">{}</code>。这在更改巴别塔配置后是必要的。接下来，重启开发服务器(如果它正在运行的话)。</p></blockquote><h2 id="32fd" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🤙🏽包装它</h2><p id="1b2f" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">要创建和填充您的语言环境文件，请运行:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1252" class="lk ll iq mi b gy mm mn l mo mp">npm run i18n</span></pre><p id="5d85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该看到您的<code class="fe mv mw mx mi b">content/locales/en.json</code>文件被填充了一个新的密钥。您还应该看到创建了一个包含键和值的<code class="fe mv mw mx mi b">content/compiled-locales/en.json</code>文件。</p><h2 id="d420" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">💻添加翻译</h2><p id="e86f" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">添加一个新文件<code class="fe mv mw mx mi b">content/locales/de.json</code>。从<code class="fe mv mw mx mi b">content/locales/en.json</code>复制填充的字典并粘贴到新文件中，翻译字符串:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6041" class="lk ll iq mi b gy mm mn l mo mp"><strong class="mi ir">// en.json</strong><br/>{</span><span id="b341" class="lk ll iq mi b gy nm mn l mo mp">     "93G7sJ": "Good Morning"</span><span id="219e" class="lk ll iq mi b gy nm mn l mo mp">}<br/></span><span id="9bd2" class="lk ll iq mi b gy nm mn l mo mp"><strong class="mi ir">// de.json</strong></span><span id="902a" class="lk ll iq mi b gy nm mn l mo mp">{</span><span id="1a08" class="lk ll iq mi b gy nm mn l mo mp">    "93G7sJ": "Guten Morgen"</span><span id="99f0" class="lk ll iq mi b gy nm mn l mo mp">}</span></pre><p id="5743" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次运行<code class="fe mv mw mx mi b">npm run i18n</code>来创建一个编译好的德语翻译。</p><p id="1a35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在应该看到一个名为<code class="fe mv mw mx mi b">content/compiled-localed/de.json</code>的新文件被创建了。该文件应该包含一个属性。</p><h2 id="643e" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kj lt lu lv kn lw lx ly kr lz ma mb mc bi translated">🍎测试最终应用</h2><p id="3609" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">成功设置后，您将能够导航到应用程序的本地化页面:</p><p id="19e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mv mw mx mi b">localhost:3000/en</code>参见英文翻译</p><p id="7164" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mv mw mx mi b">localhost:3000/de</code>见德文译本</p><h1 id="406d" class="nn ll iq bd lm no np nq lp nr ns nt ls nu nv nw lv nx ny nz ly oa ob oc mb od bi translated">👏🏼无耻的插头</h1><p id="908c" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">如果你喜欢这篇文章，一定要在Medium或Twitter上关注我。敬请关注更多内容。</p><p id="4590" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nb">如果你有兴趣增加你在所有社交渠道的有机接触，请查看</em><a class="ae nf" href="https://gosquad.cc" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nb">https://gosquad . cc</em></strong></a></p></div></div>    
</body>
</html>