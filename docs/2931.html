<html>
<head>
<title>Architecting Security &amp; Governance Across your AWS Accounts Part 3: Data Security on AWS.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨AWS帐户构建安全性和治理第3部分:AWS上的数据安全性。</h1>
<blockquote>原文：<a href="https://itnext.io/architecting-security-governance-across-your-aws-accounts-4ee96b14ea08?source=collection_archive---------4-----------------------#2019-09-01">https://itnext.io/architecting-security-governance-across-your-aws-accounts-4ee96b14ea08?source=collection_archive---------4-----------------------#2019-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f99da634f13b492306c6c8d85bfe8adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6j4kJg4VoovMsxdkZCjcQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kf">“把你学到的东西传下去。”~尤达</strong></figcaption></figure><p id="b326" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le">注意！</em> </strong> <em class="le">:这是一个多集系列的</em> <strong class="ki iu"> <em class="le">第三集</em> </strong> <em class="le">。第一部分请点击</em><strong class="ki iu"><em class="le"/></strong><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/architecting-security-governance-across-your-aws-accounts-part-1-introduction-ae200624424d"><strong class="ki iu"><em class="le">这里。</em></strong></a><strong class="ki iu"><em class="le"/></strong><em class="le">对于第二部分，请点击</em> <a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/architecting-security-governance-across-your-aws-accounts-part-2-incident-response-on-aws-44b1ee01f1ee"> <strong class="ki iu"> <em class="le">这里</em> </strong> </a></p><blockquote class="lg lh li"><p id="992a" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated"><em class="it">“公司在防火墙、加密和安全接入设备上花费数百万美元，这是金钱的浪费；这些措施都没有解决安全链中最薄弱的环节。”— </em>凯文·米特尼克，“世界上最著名的黑客”</p></blockquote><p id="b5dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据《2019年云安全报告》，网络安全专业人士最关心的云安全问题是<strong class="ki iu"> <em class="le">数据丢失和泄露。这些信息对我们任何人来说都不应该感到惊讶，因为现在并不缺少数据泄露。数据从来没有像现在这样有价值，因为大公司愿意花大价钱来获取消费者的数据。尽管我很想谈论我们的数据有多珍贵，但我们需要继续前进。</em></strong></p><p id="a3aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">在我们开始之前，让我们讨论一下为什么我们甚至需要在云中加密我们的数据(业内人士对此怎么说？):</strong></p><blockquote class="lg lh li"><p id="bf3d" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">1-合规性:您需要满足合规性要求，即PCI-DSS</p><p id="8f65" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">2-您试图保护您的数据免受您的云提供商的其他客户的影响</p><p id="259e" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">3-您试图保护您的数据免受云提供商的攻击</p><p id="6ef4" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">4-这是安全最佳实践</p></blockquote><p id="b07f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">我们来翻译一下上面的:</strong></p><blockquote class="lg lh li"><p id="bb61" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~我们需要最大限度地减少未经授权的数据物理访问</p><p id="e0ec" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~我们需要减少对敏感数据的未经授权的逻辑访问</p><p id="16fb" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~我们需要实现数据完整性、机密性和可用性(CIA)</p></blockquote><p id="3199" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，我们不可能在一两篇文章中涵盖数据安全的所有方面，因为这是一个庞大的信息安全领域，关于这个主题的书籍已经有很多了。这篇文章旨在让作为安全或云工程师的你具备在AWS中有效实现数据安全的必要知识。</p><p id="f427" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章的愿望是回答几年前我开始与AWS合作时的问题，试图了解加密和数据安全是如何工作的。我记得问过自己这类问题；“如果我今天加密了一个EBS卷，并在几个月后连接到一个EC2实例。这个EC2实例如何知道用于加密EBS卷的加密密钥？消息服务呢？他们如何处理加密？CloudHSM是否与其他类似于KMS的AWS服务交互？KMS会保存我的加密密钥吗？它会以明文形式存储它们吗？加密对我来说绝不是一个容易解释的话题。如果你试图从我这里理解它而迷失了方向，我不会责怪你。特别是如果你对这个主题不熟悉，我的目标是为你简化它。</p><p id="1daa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AWS有很多存储产品；这使得客户很难理解应该如何配置每个服务来安全地存储数据。数据要么通过线路传输，要么等待传输呼叫</p><h2 id="caba" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">加密所有内容:</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/9db87ff7a855457bd7c9dac18313ebd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_03pqTj1DlGyRt8V3y7hSA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kf">沃纳·威格尔~首席技术官AWS </strong></figcaption></figure><p id="3468" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">说真的，加密一切！如果你的企业大到足以让你迁移到AWS，你就会明白为什么你需要加密一切。在大多数情况下，您所需要做的就是选中一个框或者调用一个API来启用加密。在AWS上启动并运行加密并不需要太多时间。然而，我们需要了解每个服务如何与您的密钥管理系统对话，以及每个服务如何处理数据加密。说到这里，让我们从我的开场白中谈到数据安全时的一个重要的AWS服务(AWS KMS)开始</p><h2 id="35fc" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">AWS密钥管理系统</h2><blockquote class="lg lh li"><p id="429f" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">AWS密钥管理服务(KMS)使您可以轻松创建和管理密钥，并控制各种AWS服务和应用程序中的加密使用。AWS KMS是一项安全且有弹性的服务，它使用已通过FIPS 140–2验证或正在验证的硬件安全模块来保护您的密钥。AWS KMS与AWS CloudTrail集成，为您提供所有关键使用的日志，以帮助满足您的监管和合规需求。</p></blockquote><h2 id="1bde" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">KMS试图解决什么问题？</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/3b509c28a75b623e0cc5cace4912880e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHBiXRhJdvSesQCMby94Gg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kf">HSM黑金库</strong></figcaption></figure><p id="ded3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您想要加密EBS卷中的一些数据，您可以使用OpenSSL轻松应用AES 256加密。这意味着您有一个需要保护的加密密钥。您再次对加密密钥进行双重加密以确保万无一失。然而，最终，您需要明文密钥来解密您的加密密钥，并最终解密您的加密数据。你把钥匙放在哪里？在优盘里？你投资了一些硬件安全模块，在这个超级安全的HSM之外，你的密钥永远不能以明文形式存在。您的应用程序需要扩大和缩小规模，生成万亿字节的数据，并对这些数据进行加密。如何使用您的本地HMS将这个明文密钥安全地传递到您的EBS卷？你不能。使用KMS可以让你谈论AWS管理的云HSM，这意味着KMS只不过是一个存储这些明文密钥的接口。您的明文密钥在数千个HSM中复制，以实现高耐用性，因为这些密钥永远不会丢失。根据AWS的说法，HMS中的密钥存储是AWS向其客户保证的最持久的信息。因此，使用KMS意味着您遵守联邦法规，因为您的密钥存储在FIPS 140–2投诉服务中心。您还可以让您的应用程序使用API来安全地与您的密钥对话。此外，您还将实现低延迟，因为您的数据不会离您的键太远！</p><h2 id="9e13" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">KMS在工作。</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/90e741eb97eb0252e5dcbd285696b15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4K6yuQQ_mMS230jyG4cMZA.png"/></div></div></figure><p id="2070" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您的数据中心存储了一些重要的客户数据。您希望在AWS中存储两个数据副本，一个在亚马逊S3，另一个在EBS卷。</p><p id="9bae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了加密EBS和S3中的数据，您决定使用KMS。让我们把这件事做好，我们会边做边解释，因为我认为基于场景的插图是有意义的。</p><p id="c84e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第一步</strong>:要使用KMS，我们需要创建一个<strong class="ki iu">客户主密钥。</strong>它是什么，为什么称之为客户主密钥？</p><p id="2ea5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">客户主密钥(CMK)是用于加密您的数据加密密钥的实际加密材料的逻辑表示。等等，我不能用这个CMK加密我的数据吗？不，您使用CMK来加密用于加密您的数据的数据密钥。</p><p id="55dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">什么是数据键和备份键？备份密钥是真正的加密材料，为你喜欢的CMK做加密。备份密钥存储在AWS批准的硬件中并受到保护，使用已经过<a class="ae lf" href="https://en.wikipedia.org/wiki/FIPS_140-2" rel="noopener ugc nofollow" target="_blank">FIPS 140–2</a>验证的硬件安全模块。数据密钥是KMS用来加密和解密数据的。数据密钥总是与数据一起加密存储(作为元数据)。等等，KMS不储存数据密钥？不需要，数据键与数据一起存储在S3系统中，每个对象都有一个唯一的数据键，而在EBS中，每个卷都有自己的数据键。</p><h2 id="426e" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">关于CMK的要点:</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/91e1b6faeb83d71ad6b4fc6eec27ea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6T-o_N_yo4G70cd6mWLQhg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">CMK类型</figcaption></figure><p id="71cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CMK被称为CMK，因为“客户”管理钥匙的某些方面。AWS也会代表您创建和管理主密钥，这就是为什么会有这样的区别:</p><blockquote class="lg lh li"><p id="a69c" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated"><em class="it"> 1-客户创建密钥</em></p><p id="9872" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated"><em class="it"> 2-客户可以每年轮换密钥(有一个更频繁轮换的解决方案)</em></p><p id="f12d" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated"><em class="it"> 3-客户管理对密钥的访问(谁可以旋转密钥、删除密钥、使用密钥进行加密操作)</em></p><p id="0aba" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">4-您的存储服务和CMK必须位于同一地区</p><p id="bf76" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">5-您不能导出CMK</p><p id="22ba" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">6-如果您删除了CMK，您将无法读取您使用删除的CMK加密的数据(使用IAM/SCP来消除CMK删除！)</p><p id="4001" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">7- CMK的价格是按密钥和使用情况计算的</p><p id="e9f4" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">8-您可以使用OpenSSL创建自己的加密材料(备份密钥),然后将其作为您的CMK的备份密钥上传到</p><p id="5832" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">9-一些AWS存储服务可以为您生成数据密钥</p></blockquote><p id="19ad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们去找一个新的闪亮的CMK来加密我们的数据。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/d458b15a0a8047c56855a234ba951f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdhQRvLpttVFrBp2-MsHXA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">创造CMK</figcaption></figure><p id="7970" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还需要一个化名，CMK的化名无非是指着你的CMK。创建CMK时，AWS会返回一个CMK Id，您可以在使用CMK时参考该Id。</p><p id="9dd3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">CMK别名的最大用处是利用它来更频繁地轮换您的CMK键。</p><p id="57a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您有一个法规遵从性要求，您需要每三个月更换一次KMS CMK密钥。因为AWS只允许每12个月自动轮换一次密钥。我们可以通过删除来旋转密钥。但是，请记住，如果删除密钥，您将无法读取使用删除的密钥加密的数据。CMK化名拯救者。创建第一个CMK键时，请确保使用以下命令为其创建别名:</p><pre class="mf mg mh mi gt mn mo mp mq aw mr bi"><span id="57b6" class="lm ln it mo b gy ms mt l mu mv">aws kms create-alias --target-key-id ca52d1a0-af36-4ab6-95b6-567fbf837e17 --alias-name "alias/Part3" --region us-east-1 --profile default</span></pre><p id="9f6a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当需要旋转密钥时，创建一个新的CMK，并将您的别名指向新的CMK Id。请记住，CMK别名应该在您的应用程序中硬编码，以便它们能够解密数据。接下来，KMS将使用新创建的CMK Id/旧别名来处理现有的数据密钥。</p><p id="45e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建一个bucket并将一个文件上传到其中，然后解释AWS如何对文件进行加密。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/368d604c18e5d1863c0a99d4e972b37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yksIOcDu-YccTWDMTXc6Rg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">选择第3部分KMS·CMK作为加密对象元数据的新存储桶显示了我们的CMK的使用</figcaption></figure><p id="a04d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所见，我们不必担心数据密钥生成，我们所要做的就是告诉我们的桶应该使用哪个CMK。</p><p id="8225" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">信封加密:</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/31684a76d4c82242ca9d3a1d5d3f99d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q57xUy3m3-FDaW7PP7SBTQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kf">信封加密</strong></figcaption></figure><p id="3c93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">每当我们将一个对象上传到我们的S3存储桶时，AWS都会生成一个新的加密(数据)密钥，用于在将对象存储到磁盘之前对其进行加密。</em></p><p id="42eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">对存储的对象进行加密意味着拥有存储在磁盘上的原始对象的攻击者在计算上无法对其进行解密，任何拥有该密钥的人都可以对其进行解密，因此数据密钥必须以相对无用的形式安全存储，这可以通过使用CMK对数据密钥进行加密来实现。</em></p><p id="fddd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要解密该对象，您需要拥有该对象的唯一数据密钥，但即使您拥有该密钥，也无法用于解密数据，因为它也已被CMK加密。</p><p id="21be" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">要解密数据密钥，或至少代表您使用它，您必须拥有客户主密钥，或与控制客户主密钥并能代表您使用它的实体建立信任关系。</em></p><p id="5540" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">数据密钥非常小，因为KMS只支持对称加密，使用一个密钥来加密和解密数据。每个数据密钥只有几十个字节，这就是为什么CMK不用于加密大型对象，而只用于加密微小的数据密钥。当轮换客户主密钥时，特定于对象的加密(数据)密钥用旧的后备密钥解密，并用新的后备密钥重新加密。新的数据版本被存储，旧的版本被丢弃。</em></p><p id="7a6c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">由于数据键的尺寸很小，当我们旋转CMK AWS时，税收并不多。AWS必须只处理小型数据密钥，而不是使用数据密钥的天文对象。</em></p><blockquote class="lg lh li"><p id="a1ad" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">可以将几个类比引向公寓大楼，其中钥匙存储在公共锁箱中，其中改变锁箱锁将通过限制对公共锁箱的访问来限制对单独公寓钥匙的访问，从而限制将来对单独公寓的访问。这种类比不成立，因为除其他原因外，物理钥匙很容易被复制……但很明显，在这个例子中，更换锁箱锁(相对简单的操作)与更换一个或多个公寓的锁(更实质性的操作)无关。</p><p id="f586" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">总之，在这种情况下，他们会创建一个新的密钥来加密/解密您上传的每个对象，然后以加密的形式存储该密钥…作为一种预防措施，他们会定期地、对您透明地更改其存储的密钥表示。~ <strong class="ki iu">迈克尔— sqlbot </strong> <a class="my mz ep" href="https://medium.com/u/d53dd768d047?source=post_page-----4ee96b14ea08--------------------------------" rel="noopener" target="_blank"> <strong class="ki iu">堆栈溢出</strong> </a></p></blockquote><h2 id="ba4d" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">深度潜水:</h2><p id="3373" class="pw-post-body-paragraph kg kh it ki b kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">让我们通过扮演一个S3桶请求数据密钥来加密和解密一个文本文件的角色来模拟上面的情况。希望这个过程能帮助我们理解幕后的工作原理。</p><p id="2e30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1-生成数据密钥；这一步发生在我们上传一个对象到s3的时候。AWS为我们生成一个用于加密数据的纯文本密钥和用于解密数据的CiphertextBlob。在S3的情况下，CiphertextBlob作为元数据与对象一起存储。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/07e91bc9586320a93e5a22840a2c0f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDX7uWG0UM3ANTZoy6hV-A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">注意，我们提到的是别名，而不是Id</figcaption></figure><p id="34a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要跟踪CiphertextBlob和明文，以便进行后续操作。</p><p id="ec16" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将它们保存在单独的文件中:</p><pre class="mf mg mh mi gt mn mo mp mq aw mr bi"><span id="6d43" class="lm ln it mo b gy ms mt l mu mv">CiphertextBlob_base64_datakey.txt<br/>Plaintext_base64_datakey.txt</span></pre><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/56e83853a495355bd31d19d974547f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CI-nuDeohsEshD2gHgE3rg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">保存明文及其加密版本</figcaption></figure><p id="2771" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们解码Plaintext_base64_datakey.txt文件，因为KMS希望我们解码base64编码的文件。最后，让我们使用OpenSSL和解码后的明文密钥加密一些数据。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/dfe4ec326e3c4a9f89bc81d86c1098e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1eyRDxxCP1zT-VZb8m5PQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">加密数据</figcaption></figure><p id="78a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解码和base64明文数据密钥已经完成了它们的工作，帮助我们加密我们的秘密，现在是我们摆脱它们的时候了！我们不再需要他们了。因为如果我们需要解密数据，加密版本(CiphertextBlob)具有所有需要的信息。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/ed873723f8114be0a3ea2f9bd62f9f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KA11Q-0mpU59qJgj-qZcRg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">删除明文密钥</figcaption></figure><h2 id="48bb" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">反转关于(这次不截图):</h2><p id="4f58" class="pw-post-body-paragraph kg kh it ki b kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ne lb lc ld im bi translated">要使用KMS解密加密的文件，我们需要运行以下命令</p><p id="1b77" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">1-解码base64 cipher text blob _ base64 _ data key . txt文件:</p><pre class="mf mg mh mi gt mn mo mp mq aw mr bi"><span id="7eb3" class="lm ln it mo b gy ms mt l mu mv">cat CiphertextBlob_base64_datakey.txt | base64 --decode  &gt; CiphertextBlob_decoded_datakey.txt</span></pre><p id="0c21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2-请KMS解密你的密码:</p><pre class="mf mg mh mi gt mn mo mp mq aw mr bi"><span id="1bd0" class="lm ln it mo b gy ms mt l mu mv">aws kms decrypt --ciphertext-blob CiphertextBlob_decoded_datakey.txt --region us-east-1 --profile default</span></pre><p id="5d34" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个命令应该返回解密数据所需的明文。我们首先将它保存在一个文件中，然后对它进行编码，最后对加密的数据文件运行以下命令:</p><pre class="mf mg mh mi gt mn mo mp mq aw mr bi"><span id="edd6" class="lm ln it mo b gy ms mt l mu mv">cat my_super_important_secret.txt | openssl enc -d -aes256 -k plaintext_decode.txt</span></pre><p id="11e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该命令应该返回“在您的AWS帐户中设计安全性和治理”，我们将它保存在我们的cat my _ super _ important _ secret . txt文件中</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h2 id="a988" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">KMS接入政策:</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/4180f55a617222eba081e4d67b58f762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIyHVSUibXQ9eht6pLARWw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae lf" href="https://unsplash.com/@milkovi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">米尔科维</a>在<a class="ae lf" href="https://unsplash.com/search/photos/secure?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8825" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">意外或恶意删除CMK云比一开始就不用它来加密数据密钥更危险。不幸的是，你再也不能恢复密钥或读取加密数据了。</p><p id="7f95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有两种方法来管理KMS密钥的安全性。您可以让您的安全团队在您的AWS安全帐户中创建这些密钥，然后与开发帐户共享它们。这种方法减少了不知道这些键是在哪里创建、管理等带来的压力。我的首选方法是允许开发人员在他们的开发帐户中创建这些密钥，这将有助于您更精细地管理密钥访问。您可以始终拥有一个服务控制策略来防止用户删除这些密钥。</p><p id="db67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种技术还限制了爆炸半径，因为只有该帐户中的用户才能访问KMS密钥。但是，您可以始终使用密钥策略，只允许少数个人访问KMS密钥。总的来说，我喜欢看到密钥更靠近数据，因为当开发人员需要解决数据和加密密钥的问题时，这可以降低复杂性。</p><p id="af5a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于管理您的KMS关键政策，我认为您应该看看<a class="ae lf" href="https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>，因为我认为它做得很好</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><p id="73af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我们上面的KMS讨论涉及了加密静态数据的很多方面。让我们通过快速总结AWS如何帮助您处理通过网络传输的加密数据来结束这个循环。</p><h2 id="7747" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">运输安全中的AWS数据</h2><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/fca8fa32bb155211a2b139e9dc8aaa0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSDuXk-I2wMZ-WehH93zUw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><strong class="bd kf"> AWS雪地车</strong></figcaption></figure><p id="369d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着确保数据在内部和外部端点之间传输时得到加密和保护。应该使用TLS、IPsec和MACsec等协议用您控制的密钥对数据进行加密。</p><p id="1f0b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">网络层加密:</strong></p><p id="6f50" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如今，AWS为客户提供了三种不同的选项来加密虚拟私有云内的流量。以下截图摘自AWS文档，总结了这些产品。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/e7139fb7968a1dad3635a8f29289e133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PmdLu0l_b26rnggnlyRqwg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">VPC流量加密(第4层)</figcaption></figure><p id="7167" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请记住，AWS最近宣布，默认情况下，您的VPC内端点之间的所有流量都是加密的，这就是AWS。</p><p id="9792" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">网页层加密:</strong></p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/5aaa1c709a206cc176b101f52e795705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-F6MEfMfh9KvQwPQuAiPA.png"/></div></div></figure><p id="9850" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AWS有一项名为ACM (AWS Certificate Manager，AWS证书管理器)的令人难以置信的服务，可以帮助您将私有和公共证书供应和推送至您的云资源。ACM还将管理这些证书的轮换，您也可以获得类似于KMS的加密密钥。</p><p id="56f1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ACM正试图解决以下两个问题中的一些:</p><p id="7e2e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 1-为面向公众的AWS云资源提供TLS证书:</strong></p><blockquote class="lg lh li"><p id="9449" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~阿尔布/NLB</p><p id="dbc7" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~亚马逊云锋</p><p id="c670" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~亚马逊API网关</p></blockquote><p id="56e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 2-处理PKI的棘手部分:</strong></p><blockquote class="lg lh li"><p id="b9b4" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~密钥对和cets签名请求生成和分发</p><p id="fc30" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~私钥的加密和安全存储</p><p id="8118" class="kg kh le ki b kj kk kl km kn ko kp kq lj ks kt ku lk kw kx ky ll la lb lc ld im bi translated">~ cert的管理更新和开发</p></blockquote><p id="0f38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下服务时，您可以导入自己的证书或使用ACM:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/6289a20261594625001f8d045e541465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GEXVZ3zf2YxI_f_DpO064A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">TLS端点(HTTPS)</figcaption></figure><h2 id="882d" class="lm ln it bd kf lo lp dn lq lr ls dp lt kr lu lv lw kv lx ly lz kz ma mb mc md bi translated">感谢您的宝贵时间:)如果您希望看到更多关于AWS云安全的内容，或者您可以帮助我改进这些内容，请告诉我们。</h2></div></div>    
</body>
</html>