<html>
<head>
<title>Kafka on Kubernetes, the Strimzi way! (Part 4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">库伯内特斯上的卡夫卡，斯特里姆兹之路！(第四部分)</h1>
<blockquote>原文：<a href="https://itnext.io/kafka-on-kubernetes-the-strimzi-way-part-4-bf1e651e25b8?source=collection_archive---------0-----------------------#2020-07-28">https://itnext.io/kafka-on-kubernetes-the-strimzi-way-part-4-bf1e651e25b8?source=collection_archive---------0-----------------------#2020-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e699688d3b052551b5f76396ac6abc55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LW1uDYqPuGBIPkMczv2wkA.png"/></div></div></figure><p id="0244" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">欢迎来到这个关于在Kubernetes上运行卡夫卡的博客系列:</p><ul class=""><li id="e887" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/kafka-on-kubernetes-the-strimzi-way-part-1-bdff3e451788">第一部分</a></li><li id="0569" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/kafka-on-kubernetes-the-strimzi-way-part-2-43192f1dd831">第二部分</a></li><li id="28c1" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/kafka-on-kubernetes-the-strimzi-way-part-3-19cfdfe86660">第三部分</a></li><li id="077d" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">第4部分:这个博客</li></ul></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="821a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们已经有了一个带有TLS加密的Kafka单节点集群，在此基础上，我们配置了不同的身份验证模式(<code class="fe ls lt lu lv b">TLS</code>和<code class="fe ls lt lu lv b">SASL SCRAM-SHA-512</code>)，使用User Operator定义了用户，使用CLI和Go客户端连接到集群，并看到了使用Topic Operator管理Kafka主题是多么容易。到目前为止，我们的集群使用了<code class="fe ls lt lu lv b">ephemeral</code>持久性，在单节点集群的情况下，这意味着如果Kafka或Zookeeper节点(<code class="fe ls lt lu lv b">Pod</code> s)由于任何原因重启，我们将会丢失数据。</p><p id="fb8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们继续前进！在这一部分，我们将涵盖:</p><ul class=""><li id="8138" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">如何配置Strimzi以增加集群的持久性:</li><li id="2ab2" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">探索<code class="fe ls lt lu lv b">PersistentVolume</code>和<code class="fe ls lt lu lv b">PersistentVolumeClaim</code>等组件</li><li id="86dc" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">如何修改存储质量</li><li id="9618" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">尝试扩展我们Kafka集群的存储大小</li></ul><blockquote class="lw lx ly"><p id="b2fa" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">代码在GitHub上可以找到—</em><a class="ae lf" href="https://github.com/abhirockzz/kafka-kubernetes-strimzi/" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github.com/abhirockzz/kafka-kubernetes-strimzi/</em></a></p></blockquote><h1 id="7267" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">我需要什么来浏览这个教程？</h1><p id="b2c2" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated"><code class="fe ls lt lu lv b">kubectl</code>-<a class="ae lf" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></p><p id="48f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将使用<a class="ae lf" href="https://docs.microsoft.com/azure/aks/intro-kubernetes?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">Azure Kubernetes Service(AKS)</a>来演示这些概念，但总的来说，它是独立于Kubernetes提供商的。如果你想使用<code class="fe ls lt lu lv b">AKS</code>，你所需要的就是一个<a class="ae lf" href="https://docs.microsoft.com/azure/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">微软Azure账户</a>，如果你还没有的话，你可以<a class="ae lf" href="https://azure.microsoft.com/free/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">免费获得</a>。</p><blockquote class="lw lx ly"><p id="2c71" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">在本系列的本部分或后续部分中，我不会重复一些常见的部分(如安装/设置(Helm、Strimzi、Azure Kubernetes服务)、Strimzi概述)，我会要求您</em> <a class="ae lf" href="https://dev.to/azure/kafka-on-kubernetes-the-strimzi-way-part-1-57g7" rel="noopener ugc nofollow" target="_blank"> <em class="iq">参考第一部分</em> </a></p></blockquote></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="e56a" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">添加持久性</h1><p id="8ef5" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">我们将从创建一个持久集群开始。下面是规范的一个片段(你可以在GitHub 上访问完整的YAML <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent.yaml" rel="noopener ugc nofollow" target="_blank"/></p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="7a94" class="nt me iq lv b gy nu nv l nw nx">apiVersion: kafka.strimzi.io/v1beta1<br/>kind: Kafka<br/>metadata:<br/>  name: my-kafka-cluster<br/>spec:<br/>  kafka:<br/>    version: 2.4.0<br/>    replicas: 1<br/>    storage:<br/>      type: persistent-claim<br/>      size: 2Gi<br/>      deleteClaim: true<br/>....<br/>  zookeeper:<br/>    replicas: 1<br/>    storage:<br/>      type: persistent-claim<br/>      size: 1Gi<br/>      deleteClaim: true</span></pre><p id="bdd6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">需要注意的关键事项:</p><ul class=""><li id="0480" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><code class="fe ls lt lu lv b">storage.type</code>是<a class="ae lf" href="https://github.com/abhirockzz/kafka-kubernetes-strimzi/blob/master/part-2/kafka.yaml#L20" rel="noopener ugc nofollow" target="_blank">中的<code class="fe ls lt lu lv b">persistent-claim</code>(相对于<code class="fe ls lt lu lv b">ephemeral</code>)之前的例子</a></li><li id="9cf9" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><code class="fe ls lt lu lv b">storage.size</code>对于卡夫卡和动物园管理员来说，节点分别是<code class="fe ls lt lu lv b">2Gi</code>和<code class="fe ls lt lu lv b">1Gi</code></li><li id="6d6e" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><code class="fe ls lt lu lv b">deleteClaim: true</code>表示删除/取消部署集群时，相应的<code class="fe ls lt lu lv b">PersistentVolumeClaim</code>也会被删除</li></ul><blockquote class="lw lx ly"><p id="37cb" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">可以看一下</em><code class="fe ls lt lu lv b"><em class="iq">storage</em></code><a class="ae lf" href="https://strimzi.io/docs/operators/master/using.html#type-PersistentClaimStorage-reference" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://strim zi . io/docs/operators/master/using . html # type-PersistentClaimStorage-reference</em></a></p></blockquote><p id="aa64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建集群，请执行以下操作:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="4135" class="nt me iq lv b gy nu nv l nw nx">kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent.yaml</a></span></pre><p id="9c16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看创建集群后会发生什么</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="cd07" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">Strimzi Kubernetes魔术…</h1><p id="e10e" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated"><a class="ae lf" href="https://strimzi.io/" rel="noopener ugc nofollow" target="_blank"> Strimzi </a>负责创建运行集群所需的Kubernetes资源。我们在<a class="ae lf" href="https://dev.to/azure/kafka-on-kubernetes-the-strimzi-way-part-1-57g7" rel="noopener ugc nofollow" target="_blank">第1部分</a> — <code class="fe ls lt lu lv b">StatefulSet</code>(和<code class="fe ls lt lu lv b">Pods</code>)、<code class="fe ls lt lu lv b">LoadBalancer</code>服务、<code class="fe ls lt lu lv b">ConfigMap</code>、<code class="fe ls lt lu lv b">Secret</code>等中涵盖了其中的大部分。在这篇博客中，我们将只关注与持久性相关的组件- <code class="fe ls lt lu lv b">PersistentVolume</code>和<code class="fe ls lt lu lv b">PersistentVolumeClaim</code></p><blockquote class="lw lx ly"><p id="72a1" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">如果你正在使用Azure Kubernetes服务(AKS)，这将创建一个</em> <a class="ae lf" href="https://docs.microsoft.com/azure/virtual-machines/windows/managed-disks-overview?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> Azure托管磁盘</em></a><em class="iq">——稍后将有更多相关内容</em></p></blockquote><p id="22de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查<code class="fe ls lt lu lv b">PersistentVolumeClaim</code> s</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="4acf" class="nt me iq lv b gy nu nv l nw nx">kubectl get pvc<br/></span><span id="b8dd" class="nt me iq lv b gy ny nv l nw nx">NAME                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br/>data-my-kafka-cluster-kafka-0       Bound    pvc-b4ece32b-a46c-4fbc-9b58-9413eee9c779   2Gi        RWO            default        94s<br/>data-my-kafka-cluster-zookeeper-0   Bound    pvc-d705fea9-c443-461c-8d18-acf8e219eab0   1Gi        RWO            default        3m20s</span></pre><p id="375f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…以及他们被<code class="fe ls lt lu lv b">Bound</code>到的<code class="fe ls lt lu lv b">PersistentVolume</code></p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="e018" class="nt me iq lv b gy nu nv l nw nx">kubectl get pv<br/></span><span id="8e73" class="nt me iq lv b gy ny nv l nw nx">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                       STORAGECLASS   REASON   AGE<br/>pvc-b4ece32b-a46c-4fbc-9b58-9413eee9c779   2Gi        RWO            Delete           Bound    default/data-my-kafka-cluster-kafka-0       default                 107s<br/>pvc-d705fea9-c443-461c-8d18-acf8e219eab0   1Gi        RWO            Delete           Bound    default/data-my-kafka-cluster-zookeeper-0   default                 3m35s</span></pre><blockquote class="lw lx ly"><p id="3a38" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">请注意，磁盘大小是在清单ie中指定的。</em><code class="fe ls lt lu lv b"><em class="iq">2</em></code><em class="iq"/><code class="fe ls lt lu lv b"><em class="iq">1</em></code><em class="iq">Gib分别为卡夫卡和动物园管理员</em></p></blockquote><h2 id="848f" class="nt me iq bd mf nz oa dn mj ob oc dp mn kj od oe mr kn of og mv kr oh oi mz oj bi translated">数据在哪里？</h2><p id="a695" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">如果我们想看到数据本身，让我们首先检查存储Kafka服务器配置的<code class="fe ls lt lu lv b">ConfigMap</code>:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="1293" class="nt me iq lv b gy nu nv l nw nx">export CLUSTER_NAME=my-kafka-cluster</span><span id="1aae" class="nt me iq lv b gy ny nv l nw nx">kubectl get configmap/${CLUSTER_NAME}-kafka-config -o yaml</span></pre><p id="41f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe ls lt lu lv b">server.config</code>部分，您会发现一个条目:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="12f3" class="nt me iq lv b gy nu nv l nw nx">##########<br/># Kafka message logs configuration<br/>##########<br/>log.dirs=/var/lib/kafka/data/kafka-log${STRIMZI_BROKER_ID}</span></pre><p id="4283" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这告诉我们，卡夫卡的数据存储在<code class="fe ls lt lu lv b">/var/lib/kafka/data/kafka-log${STRIMZI_BROKER_ID}</code>中。在这种情况下,<code class="fe ls lt lu lv b">STRIMZI_BROKER_ID</code>就是<code class="fe ls lt lu lv b">0</code>,因为我们只有一个节点</p><p id="79c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这些信息，让我们看看卡夫卡<code class="fe ls lt lu lv b">Pod</code>:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="80b7" class="nt me iq lv b gy nu nv l nw nx">export CLUSTER_NAME=my-kafka-cluster</span><span id="2350" class="nt me iq lv b gy ny nv l nw nx">kubectl get pod/${CLUSTER_NAME}-kafka-0 -o yaml</span></pre><p id="b065" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您查看<code class="fe ls lt lu lv b">kafka</code> <code class="fe ls lt lu lv b">container</code>部分，您会注意到以下内容:</p><p id="f845" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ls lt lu lv b">volumes</code>配置之一:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="8168" class="nt me iq lv b gy nu nv l nw nx">volumes:<br/>  - name: data<br/>    persistentVolumeClaim:<br/>      claimName: data-my-kafka-cluster-kafka-0</span></pre><p id="45e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">名为<code class="fe ls lt lu lv b">data</code>的<code class="fe ls lt lu lv b">volume</code>与<code class="fe ls lt lu lv b">data-my-kafka-cluster-kafka-0</code> PVC相关联，相应的<code class="fe ls lt lu lv b">volumeMounts</code>使用该卷来确保Kafka数据存储在<code class="fe ls lt lu lv b">/var/lib/kafka/data</code>中</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="bbd4" class="nt me iq lv b gy nu nv l nw nx">volumeMounts:<br/>    - mountPath: /var/lib/kafka/data<br/>      name: data</span></pre><p id="107b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看内容，</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="32b8" class="nt me iq lv b gy nu nv l nw nx">export STRIMZI_BROKER_ID=0</span><span id="6ecb" class="nt me iq lv b gy ny nv l nw nx">kubectl exec -it my-kafka-cluster-kafka-0 -- ls -lrt /var/lib/kafka/data/kafka-log${STRIMZI_BROKER_ID}</span></pre><blockquote class="lw lx ly"><p id="66f6" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">你也可以对Zookeeper节点重复同样的操作</em></p></blockquote><h1 id="5776" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">…云呢？</h1><p id="ce1f" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">如前所述，在AKS的情况下，数据将最终存储在Azure管理的磁盘中。磁盘类型取决于AKS集群中的<code class="fe ls lt lu lv b">default</code>存储类别。对我来说，就是:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="1e03" class="nt me iq lv b gy nu nv l nw nx">kubectl get sc</span><span id="102c" class="nt me iq lv b gy ny nv l nw nx">azurefile           kubernetes.io/azure-file   58d<br/>azurefile-premium   kubernetes.io/azure-file   58d<br/>default (default)   kubernetes.io/azure-disk   2d18h<br/>managed-premium     kubernetes.io/azure-disk   2d18h</span><span id="0344" class="nt me iq lv b gy ny nv l nw nx">//to get details of the storage class<br/>kubectl get sc/default -o yaml</span></pre><blockquote class="lw lx ly"><p id="8cf4" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">更多关于语义为</em> <code class="fe ls lt lu lv b"><em class="iq">default</em></code> <em class="iq">的存储类在</em> <code class="fe ls lt lu lv b"><em class="iq">AKS</em></code> <em class="iq"> </em> <a class="ae lf" href="https://docs.microsoft.com/azure/aks/concepts-storage?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <em class="iq">文档中</em> </a></p></blockquote><p id="47a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要在Azure中查询磁盘，使用<code class="fe ls lt lu lv b">kubectl get pv/&lt;name of kafka pv&gt; -o yaml</code>提取<code class="fe ls lt lu lv b">PersistentVolume</code>信息，并获取Azure磁盘的ID，即<code class="fe ls lt lu lv b">spec.azureDisk.diskURI</code></p><p id="abcf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用Azure CLI命令<code class="fe ls lt lu lv b"><a class="ae lf" href="https://docs.microsoft.com/cli/azure/disk?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-disk-show" rel="noopener ugc nofollow" target="_blank">az disk show</a></code>命令</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="a17d" class="nt me iq lv b gy nu nv l nw nx">az disk show --ids &lt;diskURI value&gt;</span></pre><p id="caf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将看到在<code class="fe ls lt lu lv b">sku</code>部分定义的存储类型是<code class="fe ls lt lu lv b">StandardSSD_LRS</code>，它对应于一个<a class="ae lf" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#standard-ssd" rel="noopener ugc nofollow" target="_blank">标准固态硬盘</a></p><blockquote class="lw lx ly"><p id="3d07" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">此表提供了不同</em> <a class="ae lf" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#disk-comparison" rel="noopener ugc nofollow" target="_blank"> <em class="iq">天蓝色磁盘类型</em> </a>的对比</p></blockquote><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="90d4" class="nt me iq lv b gy nu nv l nw nx">"sku": {<br/>    "name": "StandardSSD_LRS",<br/>    "tier": "Standard"<br/>  }</span></pre><p id="8ad6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">……<code class="fe ls lt lu lv b">tags</code>属性突出显示了<code class="fe ls lt lu lv b">PV</code>和<code class="fe ls lt lu lv b">PVC</code>的关联</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="9bcc" class="nt me iq lv b gy nu nv l nw nx">"tags": {<br/>    "created-by": "kubernetes-azure-dd",<br/>    "kubernetes.io-created-for-pv-name": "pvc-b4ece32b-a46c-4fbc-9b58-9413eee9c779",<br/>    "kubernetes.io-created-for-pvc-name": "data-my-kafka-cluster-kafka-0",<br/>    "kubernetes.io-created-for-pvc-namespace": "default"<br/>  }</span></pre><blockquote class="lw lx ly"><p id="a768" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated">你也可以对Zookeeper磁盘重复同样的操作</p></blockquote></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="de0a" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">快速测试…</h1><p id="d942" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">按照以下步骤确认集群是否按预期运行..</p><p id="459d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建制作人<code class="fe ls lt lu lv b">Pod</code>:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="1e3e" class="nt me iq lv b gy nu nv l nw nx">export KAFKA_CLUSTER_NAME=my-kafka-cluster</span><span id="9b64" class="nt me iq lv b gy ny nv l nw nx">kubectl run kafka-producer -ti --image=strimzi/kafka:latest-kafka-2.4.0 --rm=true --restart=Never -- bin/kafka-console-producer.sh --broker-list $KAFKA_CLUSTER_NAME-kafka-bootstrap:9092 --topic my-topic</span></pre><p id="6b46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在另一个终端中，创建一个消费者<code class="fe ls lt lu lv b">Pod</code>:</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="966c" class="nt me iq lv b gy nu nv l nw nx">export KAFKA_CLUSTER_NAME=my-kafka-cluster</span><span id="c5e1" class="nt me iq lv b gy ny nv l nw nx">kubectl run kafka-consumer -ti --image=strimzi/kafka:latest-kafka-2.4.0 --rm=true --restart=Never -- bin/kafka-console-consumer.sh --bootstrap-server $KAFKA_CLUSTER_NAME-kafka-bootstrap:9092 --topic my-topic --from-beginning</span></pre></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="49a3" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">如果…会怎么样</h1><p id="0cc8" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">让我们探讨一下如何解决您将会遇到的几个需求:</p><ul class=""><li id="71b1" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">使用不同的存储类型——例如，在Azure的情况下，您可能希望使用<a class="ae lf" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#premium-ssd" rel="noopener ugc nofollow" target="_blank"> Azure Premium SSD </a>来处理生产工作负载</li><li id="2ffb" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">重新调整存储规模—在某个时候，您会想要向Kafka集群添加存储</li></ul><h2 id="e812" class="nt me iq bd mf nz oa dn mj ob oc dp mn kj od oe mr kn of og mv kr oh oi mz oj bi translated">更改存储类型</h2><p id="ab2a" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">回想一下，Strimzi的默认行为是创建一个引用<code class="fe ls lt lu lv b">default</code>存储类的<code class="fe ls lt lu lv b">PersistentVolumeClaim</code>。要对此进行定制，您可以简单地在<code class="fe ls lt lu lv b">spec.kafka</code>(和/或<code class="fe ls lt lu lv b">spec.zookeeper</code>)中的<code class="fe ls lt lu lv b">storage</code>规范中包含<code class="fe ls lt lu lv b">class</code>属性。</p><p id="7561" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Azure中，<code class="fe ls lt lu lv b">managed-premium storage</code>类对应于高级SSD: <code class="fe ls lt lu lv b">kubectl get sc/managed-premium -o yaml</code></p><p id="472e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是存储配置的一个片段，其中添加了<code class="fe ls lt lu lv b">class: managed-premium</code>。</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="e69e" class="nt me iq lv b gy nu nv l nw nx">storage:<br/>      type: persistent-claim<br/>      size: 2Gi<br/>      deleteClaim: true<br/>      class: managed-premium</span></pre><p id="6538" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，您不能更新现有群集的存储类型。要尝试这一点:</p><ul class=""><li id="3f74" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">删除已有的集群— <code class="fe ls lt lu lv b">kubectl delete kafka/my-kafka-cluster</code>(稍等)</li><li id="586c" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">创建新的集群— <code class="fe ls lt lu lv b">kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-premium.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-premium.yaml</a></code></li></ul><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="3850" class="nt me iq lv b gy nu nv l nw nx">//Delete the existing cluster<br/>kubectl delete kafka/my-kafka-cluster</span><span id="8994" class="nt me iq lv b gy ny nv l nw nx">//Create a new cluster<br/>kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-premium.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-premium.yaml</a></span></pre><p id="3c50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了确认，检查卡夫卡节点的<code class="fe ls lt lu lv b">PersistentVolumeClain</code>——注意<code class="fe ls lt lu lv b">STORAGECLASS</code>列</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="ad68" class="nt me iq lv b gy nu nv l nw nx">kubectl get pvc/data-my-kafka-cluster-kafka-0</span><span id="52da" class="nt me iq lv b gy ny nv l nw nx">NAME                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE<br/>data-my-kafka-cluster-kafka-0   Bound    pvc-3f46d6ed-9da5-4c49-87ef-86684ab21cf8   2Gi        RWO            managed-premium   21s</span></pre><blockquote class="lw lx ly"><p id="6712" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">我们只配置了Kafka broker使用高级存储，所以Zookeeper </em> <code class="fe ls lt lu lv b"><em class="iq">Pod</em></code> <em class="iq">将使用</em> <code class="fe ls lt lu lv b"><em class="iq">StandardSSD</em></code> <em class="iq">存储类型。</em></p></blockquote><h2 id="be3a" class="nt me iq bd mf nz oa dn mj ob oc dp mn kj od oe mr kn of og mv kr oh oi mz oj bi translated">调整存储大小(TL；灾难恢复—还不工作)</h2><p id="9e4b" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">Azure Disks允许你添加更多的存储空间。在Kubernetes的情况下，是存储类定义了是否支持这一点——对于AKS，如果您检查default(或<code class="fe ls lt lu lv b">managed-premium</code>)存储类，您会注意到属性<code class="fe ls lt lu lv b">allowVolumeExpansion: true</code>，这表明您也可以在Kubernetes PVC的上下文中这样做。</p><p id="02ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Strimzi使得增加Kafka集群的存储变得非常容易——您所需要做的就是将<code class="fe ls lt lu lv b">storage.size</code>字段更新为所需的值</p><p id="832c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在检查PVC:<code class="fe ls lt lu lv b">kubectl describe pvc data-my-kafka-cluster-kafka-0</code></p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="0c6d" class="nt me iq lv b gy nu nv l nw nx">Conditions:<br/>  Type       Status  LastProbeTime                     LastTransitionTime                Reason  Message<br/>  ----       ------  -----------------                 ------------------                ------  -------<br/>  Resizing   True    Mon, 01 Jan 0001 00:00:00 +0000   Mon, 22 Jun 2020 23:15:26 +0530           <br/>Events:<br/>  Type     Reason              Age                From           Message<br/>  ----     ------              ----               ----           -------<br/>  Warning  VolumeResizeFailed  3s (x11 over 13s)  volume_expand  error expanding volume "default/data-my-kafka-cluster-kafka-0" of plugin "kubernetes.io/azure-disk": compute.DisksClient#CreateOrUpdate: Failure sending request: StatusCode=0 -- Original Error: autorest/azure: Service returned an error. Status=&lt;nil&gt; Code="OperationNotAllowed" Message="Cannot resize disk kubernetes-dynamic-pvc-3f46d6ed-9da5-4c49-87ef-86684ab21cf8 while it is attached to running VM /subscriptions/9a42a42f-ae42-4242-b6a7-dda0ea91d342/resourceGroups/mc_my-k8s-vk_southeastasia/providers/Microsoft.Compute/virtualMachines/aks-agentpool-42424242-1. Resizing a disk of an Azure Virtual Machine requires the virtual machine to be deallocated. Please stop your VM and retry the operation."</span></pre><p id="34ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意<code class="fe ls lt lu lv b">"Cannot resize disk...</code>错误信息。发生这种情况是因为Azure磁盘当前与AKS集群节点相连，这是因为<code class="fe ls lt lu lv b">Pod</code>与<code class="fe ls lt lu lv b">PersistentVolumeClaim</code>相关联——这个<a class="ae lf" href="https://docs.microsoft.com/azure/virtual-machines/linux/expand-disks?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">是一个记录在案的限制</a></p><p id="b70b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，我不是第一个遇到这个问题的人。详情请参考<a class="ae lf" href="https://github.com/kubernetes/kubernetes/issues/68427" rel="noopener ugc nofollow" target="_blank">问题，如本</a>问题。</p><blockquote class="lw lx ly"><p id="e470" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated">有一些解决方法，但是在这篇博客中没有讨论。我加入了这一部分，因为我想让你知道这个警告</p></blockquote></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="f3bb" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">最后倒计时…</h1><p id="cdc2" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">我们想高调离开，不是吗？好了，总结一下，让我们将群集从一个节点扩展到三个节点。这非常简单！</p><p id="4f55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要做的就是将副本增加到所需的数量——在本例中，我将其配置为3(针对Kafka和Zookeeper)</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="bb31" class="nt me iq lv b gy nu nv l nw nx">...<br/>spec:<br/>  kafka:<br/>    version: 2.4.0<br/>    replicas: 3<br/>  zookeeper:<br/>    replicas: 3<br/>...</span></pre><p id="b02b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除此之外，我还添加了一个外部负载平衡器监听器(这将创建一个Azure负载平衡器，正如在<a class="ae lf" href="https://dev.to/azure/kafka-on-kubernetes-the-strimzi-way-part-2-1210" rel="noopener ugc nofollow" target="_blank">第2部分</a>中所讨论的)</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="6e26" class="nt me iq lv b gy nu nv l nw nx">...<br/>    listeners:<br/>      plain: {}<br/>      external:<br/>        type: loadbalancer<br/>...</span></pre><p id="f7b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建新的，只需使用新的清单</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="c0cc" class="nt me iq lv b gy nu nv l nw nx">kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-multi-node.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kafka-kubernetes-strimzi/master/part-4/kafka-persistent-multi-node.yaml</a></span></pre><blockquote class="lw lx ly"><p id="6a30" class="jy jz lz ka b kb kc kd ke kf kg kh ki ma kk kl km mb ko kp kq mc ks kt ku kv ij bi translated"><em class="iq">请注意，总体集群就绪需要时间，因为将有额外的组件(Azure磁盘、负载平衡器公共IP等。)这将在pod被激活之前创建</em></p></blockquote><h2 id="6384" class="nt me iq bd mf nz oa dn mj ob oc dp mn kj od oe mr kn of og mv kr oh oi mz oj bi translated">在您的k8s集群中，您将看到…</h2><p id="b711" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">卡夫卡和动物园管理员各三个</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="50d0" class="nt me iq lv b gy nu nv l nw nx">kubectl get pod -l=app.kubernetes.io/instance=my-kafka-cluster</span><span id="fcbb" class="nt me iq lv b gy ny nv l nw nx">NAME                           READY   STATUS    RESTARTS   AGE<br/>my-kafka-cluster-kafka-0       2/2     Running   0          54s<br/>my-kafka-cluster-kafka-1       2/2     Running   0          54s<br/>my-kafka-cluster-kafka-2       2/2     Running   0          54s<br/>my-kafka-cluster-zookeeper-0   1/1     Running   0          4m44s<br/>my-kafka-cluster-zookeeper-1   1/1     Running   0          4m44s<br/>my-kafka-cluster-zookeeper-2   1/1     Running   0          4m44s</span></pre><p id="c3a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">三副(卡夫卡和动物园管理员各一副)<code class="fe ls lt lu lv b">PersistentVolumeClaims</code> …</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="0f93" class="nt me iq lv b gy nu nv l nw nx">kubectl get pvc</span><span id="6aba" class="nt me iq lv b gy ny nv l nw nx">NAME                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE<br/>data-my-kafka-cluster-kafka-0       Bound    pvc-0f52dee1-970a-4c55-92bd-a97dcc41aee6   3Gi        RWO            managed-premium   10m<br/>data-my-kafka-cluster-kafka-1       Bound    pvc-f8b613cb-3da0-4932-acea-7e5e96df1433   3Gi        RWO            managed-premium   4m24s<br/>data-my-kafka-cluster-kafka-2       Bound    pvc-fedf431c-d87a-4bf7-80d0-d43b1337c079   3Gi        RWO            managed-premium   4m24s<br/>data-my-kafka-cluster-zookeeper-0   Bound    pvc-1fda3714-3c37-428f-9e4b-bdb5da71cda6   1Gi        RWO            default           12m<br/>data-my-kafka-cluster-zookeeper-1   Bound    pvc-702556e0-890a-4c07-ae5c-e2354d74d006   1Gi        RWO            default           6m42s<br/>data-my-kafka-cluster-zookeeper-2   Bound    pvc-176ffd68-7e3a-4e04-abb1-52c54dcb84f0   1Gi        RWO            default           6m42s</span></pre><p id="f69d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…以及它们所绑定的各自的<code class="fe ls lt lu lv b">PersistentVolumes</code></p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="e96a" class="nt me iq lv b gy nu nv l nw nx">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                                       STORAGECLASS      REASON   AGE<br/>pvc-0f52dee1-970a-4c55-92bd-a97dcc41aee6   3Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-kafka-0       managed-premium            12m<br/>pvc-176ffd68-7e3a-4e04-abb1-52c54dcb84f0   1Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-zookeeper-2   default                    8m45s<br/>pvc-1fda3714-3c37-428f-9e4b-bdb5da71cda6   1Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-zookeeper-0   default                    14m<br/>pvc-702556e0-890a-4c07-ae5c-e2354d74d006   1Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-zookeeper-1   default                    8m45s<br/>pvc-f8b613cb-3da0-4932-acea-7e5e96df1433   3Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-kafka-1       managed-premium            6m27s<br/>pvc-fedf431c-d87a-4bf7-80d0-d43b1337c079   3Gi        RWO            Delete           Bound       default/data-my-kafka-cluster-kafka-2       managed-premium            6m22s</span></pre><p id="263b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…和负载平衡器IP。请注意，这些是为每个Kafka代理创建的，还有一个从客户端应用程序连接时推荐使用的引导IP。</p><pre class="nl nm nn no gt np lv nq nr aw ns bi"><span id="1652" class="nt me iq lv b gy nu nv l nw nx">kubectl get svc -l=app.kubernetes.io/instance=my-kafka-cluster</span><span id="c809" class="nt me iq lv b gy ny nv l nw nx">NAME                                        TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)                      AGE<br/>my-kafka-cluster-kafka-0                    LoadBalancer   10.0.11.154    40.119.248.164   9094:30977/TCP               10m<br/>my-kafka-cluster-kafka-1                    LoadBalancer   10.0.146.181   20.43.191.219    9094:30308/TCP               10m<br/>my-kafka-cluster-kafka-2                    LoadBalancer   10.0.223.202   40.119.249.20    9094:30313/TCP               10m<br/>my-kafka-cluster-kafka-bootstrap            ClusterIP      10.0.208.187   &lt;none&gt;           9091/TCP,9092/TCP            16m<br/>my-kafka-cluster-kafka-brokers              ClusterIP      None           &lt;none&gt;           9091/TCP,9092/TCP            16m<br/>my-kafka-cluster-kafka-external-bootstrap   LoadBalancer   10.0.77.213    20.43.191.238    9094:31051/TCP               10m<br/>my-kafka-cluster-zookeeper-client           ClusterIP      10.0.3.155     &lt;none&gt;           2181/TCP                     18m<br/>my-kafka-cluster-zookeeper-nodes            ClusterIP      None           &lt;none&gt;           2181/TCP,2888/TCP,3888/TCP   18m</span></pre><p id="7bcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要访问集群，您可以使用<a class="ae lf" href="https://dev.to/azure/kafka-on-kubernetes-the-strimzi-way-part-2-1210" rel="noopener ugc nofollow" target="_blank">第2部分</a>中概述的步骤</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="11a7" class="md me iq bd mf mg ng mi mj mk nh mm mn mo ni mq mr ms nj mu mv mw nk my mz na bi translated">这是一个总结！</h1><p id="71a1" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">这就是这个博客系列的全部内容，其中涵盖了使用开源Strimzi操作符在Kubernetes上运行Kafka的一些方面。</p><p id="c486" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您对这个主题感兴趣，我鼓励您查看其他解决方案，如<a class="ae lf" href="https://docs.confluent.io/current/installation/operator/index.html" rel="noopener ugc nofollow" target="_blank">合流运算符</a>和<a class="ae lf" href="https://github.com/banzaicloud/kafka-operator" rel="noopener ugc nofollow" target="_blank">坂仔云卡夫卡运算符</a></p></div></div>    
</body>
</html>