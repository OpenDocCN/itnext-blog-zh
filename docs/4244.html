<html>
<head>
<title>How to deploy Angular app in production — CPAS 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在生产中部署Angular app—CPAS新协议</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-deploy-angular-app-in-production-cpas-2-affb711d18fc?source=collection_archive---------1-----------------------#2020-05-23">https://itnext.io/how-to-deploy-angular-app-in-production-cpas-2-affb711d18fc?source=collection_archive---------1-----------------------#2020-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/92ebf7760c82d422b57fe07245317aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9gVOJowwDqQUEKtSqxzEA.png"/></div></div></figure><h1 id="2e72" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">序</h1><blockquote class="kz la lb"><p id="7996" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><em class="it">最近，我决定做一个名为</em><strong class="lf iu"><em class="it">CAPS——常见问题及解决方案</em> </strong> <em class="it">的系列故事，在其中我将向你展示如何解决编码中最常见的问题。可以在这里</em>  <em class="it">看到本系列第一篇</em> <a class="ae mb" rel="noopener ugc nofollow" target="_blank" href="/remove-elements-from-an-array-recursively-cpas-1-856cc44613c5"> <em class="it">。</em></a></p></blockquote></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="aeb5" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">如果您是Angular部署环境的新手，并且对于如何让其他人使用这种类型的应用程序感到非常困惑，那么本文就是为您准备的。这也适用于Angular、React或任何其他基于框架的应用程序，它们依赖于内部路由器。</p><h1 id="7301" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">误解</h1><p id="4add" class="pw-post-body-paragraph lc ld it lf b lg mm li lj lk mn lm ln mj mo lq lr mk mp lu lv ml mq ly lz ma im bi translated">一个常见的误解是需要NodeJS服务器来部署应用程序。</p><figure class="mr ms mt mu gt ju"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="658b" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">前端代码运行在浏览器上，浏览器只理解HMTL、CSS和JavaScript。一旦您运行build命令，您的代码就会变成这样。</p><p id="aea4" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">如果您在Angular项目文件夹中运行<code class="fe mx my mz na b">ng build --prod</code>，您将在<strong class="lf iu"> dist </strong>文件夹中只看到JavaScript、CSS和HTML文件。</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/8c9a16b2c587352f128a3f51e2ae329c.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*Jh7nY3EoVRnsyMjFPyLnSQ.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">ng build命令在生产中的输出</figcaption></figure><p id="8a6c" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">现在这些只是简单的静态文件，您可以像任何普通的静态网站一样实现应用程序。您需要注意的唯一部分是，应用程序有一个内部路由器，所有请求都必须发送到这个路由器。</p><h1 id="f20f" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">部署</h1><p id="0634" class="pw-post-body-paragraph lc ld it lf b lg mm li lj lk mn lm ln mj mo lq lr mk mp lu lv ml mq ly lz ma im bi translated">在接下来的示例中，我们将了解如何在两个最常见的解决方案上部署这些代码:</p><ul class=""><li id="fb5d" class="ng nh it lf b lg lh lk ll mj ni mk nj ml nk ma nl nm nn no bi translated">在VPS上的Nginx下</li><li id="b993" class="ng nh it lf b lg np lk nq mj nr mk ns ml nt ma nl nm nn no bi translated">在像Heroku这样的PaaS上</li></ul><h2 id="0dd4" class="nu kc it bd kd nv nw dn kh nx ny dp kl mj nz oa kp mk ob oc kt ml od oe kx of bi translated">NGINX</h2><p id="53c3" class="pw-post-body-paragraph lc ld it lf b lg mm li lj lk mn lm ln mj mo lq lr mk mp lu lv ml mq ly lz ma im bi translated">在下面的文件夹中，用这个内容为你的应用程序创建一个新文件。</p><p id="3601" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated"><code class="fe mx my mz na b">$ cd /etc/nginx/sites-available &amp;&amp; nano my-website</code></p><p id="d95d" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated"><strong class="lf iu">我的网站</strong></p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="d58c" class="nu kc it na b gy ok ol l om on">server {<br/> root <em class="le">path_to_the_app_folder/dist</em>;<br/> index index.html;<br/> server_name <em class="le">application_domain.com</em>;<br/> location / {<br/>    try_files $uri $uri/ /index.html;<br/> }<br/>}</span></pre><p id="2664" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">通过这一行，我们让Nginx只服务于<strong class="lf iu">index.html</strong>文件，而不管我们<strong class="lf iu">application _ domain . com .</strong>的<strong class="lf iu"> URL </strong></p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="3dbe" class="nu kc it na b gy ok ol l om on">try_files $uri $uri/ /index.html;</span></pre><p id="cc06" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">例如:</p><ul class=""><li id="c3dc" class="ng nh it lf b lg lh lk ll mj ni mk nj ml nk ma nl nm nn no bi translated">https://application _ domain . com-&gt;将提供index.html文件</li><li id="9fd0" class="ng nh it lf b lg np lk nq mj nr mk ns ml nt ma nl nm nn no bi translated">https://application _ domain . com/my-route--&gt;仍将服务于index.html</li></ul><p id="8be3" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">Nginx只会从<strong class="lf iu">站点启用的</strong>文件夹中接管配置。这就是为什么我们需要使用以下命令为我们的文件创建一个符号链接:</p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="5808" class="nu kc it na b gy ok ol l om on">$ sudo ln -s /etc/nginx/sites-available/<!-- -->my-website<!-- --> /etc/nginx/sites-enabled/</span></pre><p id="9c06" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">最后，用这个命令验证您的配置是否正确</p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="de6f" class="nu kc it na b gy ok ol l om on">$ sudo nginx -t</span></pre><p id="262d" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">并重新启动Nginx服务。</p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="1e52" class="nu kc it na b gy ok ol l om on">$ sudo systemctl restart nginx</span></pre><h2 id="1c5a" class="nu kc it bd kd nv nw dn kh nx ny dp kl mj nz oa kp mk ob oc kt ml od oe kx of bi translated">赫罗库</h2><p id="2ca9" class="pw-post-body-paragraph lc ld it lf b lg mm li lj lk mn lm ln mj mo lq lr mk mp lu lv ml mq ly lz ma im bi translated">要在Heroku上部署它，我们需要创建一个应用服务器来服务我们的静态文件。为此，我们可以使用任何与Heroku兼容的后端语言。出于演示的目的，我们将使用NodeJS。</p><blockquote class="kz la lb"><p id="c4bc" class="lc ld le lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">这在第一个例子中是不必要的，因为Nginx是一个web服务器，也能够提供静态文件。实际上，就服务静态文件的性能而言，它是最好的。</p></blockquote><p id="c8d4" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">像往常一样使用<strong class="lf iu"> express </strong>在项目的根目录下创建一个新的服务器，并将其设置为只发送index.html的<strong class="lf iu">文件<strong class="lf iu">。</strong></strong></p><p id="f1be" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated"><strong class="lf iu"> server.js </strong></p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/3fb4f8de22fde808f20b4c41090c4b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lfzYsCRcDKyinXrG2ed39w.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated"><a class="ae mb" href="https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&amp;t=seti&amp;wt=none&amp;l=javascript&amp;ds=true&amp;dsyoff=20px&amp;dsblur=68px&amp;wc=true&amp;wa=true&amp;pv=56px&amp;ph=56px&amp;ln=false&amp;fl=1&amp;fm=Hack&amp;fs=14px&amp;lh=133%25&amp;si=false&amp;es=2x&amp;wm=false&amp;code=const%2520express%2520%253D%2520require(%2522express%2522)%253B%250Aconst%2520app%2520%253D%2520express()%253B%250Aconst%2520port%2520%253D%2520process.env.PORT%2520%257C%257C%25203005%253B%250Aconst%2520path%2520%253D%2520require(%2522path%2522)%253B%250A%250Aconst%2520fileDirectory%2520%253D%2520path.resolve(__dirname%252C%2520%2522.%252Fdist%2522)%250A%250Aapp.use(express.static(fileDirectory))%253B%250A%250Aapp.get(%2522*%2522%252C%2520(req%252C%2520res)%2520%253D%253E%2520%257B%250A%2520%2520res.sendFile(%2522index.html%2522%252C%2520%257B%2520root%253A%2520fileDirectory%2520%257D%252C%2520(err)%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520res.end()%253B%250A%250A%2520%2520%2520%2520if%2520(err)%2520throw%2520err%253B%250A%2520%2520%257D)%253B%250A%257D)%253B%250A%250Aapp.listen(port%252C%2520()%2520%253D%253E%250A%2520%2520console.log(%2560App%2520listening%2520at%2520http%253A%252F%252Flocalhost%253A%2524%257Bport%257D%2560)%250A)%253B%250A" rel="noopener ugc nofollow" target="_blank">此处代码</a></figcaption></figure><p id="02a9" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">为了与Heroku兼容，创建一个名为<strong class="lf iu"> Procfile </strong>的文件，并添加<strong class="lf iu"> </strong> start命令。</p><pre class="mr ms mt mu gt og na oh oi aw oj bi"><span id="8303" class="nu kc it na b gy ok ol l om on">web: node server.js</span></pre></div><div class="ab cl mc md hx me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="im in io ip iq"><p id="2c94" class="pw-post-body-paragraph lc ld it lf b lg lh li lj lk ll lm ln mj lp lq lr mk lt lu lv ml lx ly lz ma im bi translated">所以，就这样了！通过这种配置，您可以在Nginx和Heroku上部署任何web应用程序。请记住，您需要将所有请求发送到index.html，这样它们就可以被应用程序的内部路由器解析。</p></div></div>    
</body>
</html>