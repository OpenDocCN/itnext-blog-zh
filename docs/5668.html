<html>
<head>
<title>How to make a basic cryptocurrency chart app with (near) real-time updating by using React Hooks and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React Hooks和Plotly制作一个基本的(接近)实时更新的加密货币图表app</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-make-a-basic-cryptocurrency-chart-app-with-near-real-time-updating-by-using-react-hooks-6a466529c2dc?source=collection_archive---------0-----------------------#2021-04-28">https://itnext.io/how-to-make-a-basic-cryptocurrency-chart-app-with-near-real-time-updating-by-using-react-hooks-6a466529c2dc?source=collection_archive---------0-----------------------#2021-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cc629f10c0ad3415ac9a01cfea567240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQKhB9FkMr6TsH2vHa4JeA.jpeg"/></div></div></figure><p id="e7b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，我通过当地的外汇市场对ETH加密货币进行了一笔小额投资。我想在业余时间检查我的投资，并打电话买多或卖多。不幸的是，外汇市场没有给我提供图表，但他们只有简单的API来跟踪投资组合的平衡，目前以当地货币为基础的要价和出价。结果就是一直跟踪趋势，挺烦的。最后，我决定写一个供我个人使用的基本价格图表(我已经结合了本地交易所的一些API，为我的私人应用程序包含了更多的统计数据)。事实证明，制作这个图表项目比我预期的更有趣，当看到它实时运行时，我完全满足了。</p><p id="d828" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我做了一些研究来找到一个解决方案，为这个小型项目提供数据。有一些优秀的包，比如Ran Aroussi的<a class="ae kw" href="https://github.com/ranaroussi/yfinance" rel="noopener ugc nofollow" target="_blank"> yfinance </a>。我已经做了一些原型，但是，这个解决方案需要一个后端服务器运行，我真的不想再为这样一个小应用程序维护一个服务器。幸运的是，CoinGecko免费提供了一套精彩的<a class="ae kw" href="https://www.coingecko.com/en/api" rel="noopener ugc nofollow" target="_blank">API</a>。</p><p id="3022" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始，或者你可以在这里看一下<a class="ae kw" href="https://techika-cryptocurrency-chart.netlify.app/" rel="noopener ugc nofollow" target="_blank">现场演示</a>。</p><p id="d177" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我使用我最喜欢的捆绑工具<a class="ae kw" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> Vite </a>和react模板来搭建项目。你可以根据自己的喜好使用<code class="fe kx ky kz la b">create-react-app</code>。</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="8528" class="lj lk iq la b gy ll lm l ln lo">yarn create <a class="ae kw" href="http://twitter.com/vitejs/app" rel="noopener ugc nofollow" target="_blank">@vitejs/app</a> trading-chart --template react</span></pre><p id="bc00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，进入<code class="fe kx ky kz la b">trading-chart</code>目录，在运行开发服务器之前安装所需的包:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="b8e5" class="lj lk iq la b gy ll lm l ln lo">cd trading-chart<br/>yarn<br/>yarn dev</span></pre><p id="c831" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是当前的目录结构</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/d501752036d89143b6a774d19d465b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*pcnjrkhSvuzdXjZCM7bKPQ.png"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">初始项目结构</figcaption></figure><p id="53c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，打开浏览器，输入<code class="fe kx ky kz la b"><a class="ae kw" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>，你会看到来自Vite的演示页面。现在，我们将<code class="fe kx ky kz la b">index.html</code>文件改为包含第三方库和用于UI的引导CSS框架。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">文件:index.html</figcaption></figure><h1 id="8c45" class="lw lk iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">初始化图表</h1><p id="b1e9" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">在接下来的步骤中，我们将使用<code class="fe kx ky kz la b">useEffect</code>从CoinGecko API获取数据，然后在处理它到Plotly.js进行绘制之前对其进行处理。提取的URL是:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="c669" class="lj lk iq la b gy ll lm l ln lo"><a class="ae kw" href="https://api.coingecko.com/api/v3/coins/ethereum/market_chart?vs_currency=usd&amp;days=1&amp;interval=1m" rel="noopener ugc nofollow" target="_blank">https://api.coingecko.com/api/v3/coins/ethereum/market_chart?vs_currency=usd&amp;days=1&amp;interval=1m</a></span></pre><p id="7764" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该响应将为我们提供价格、市场资本和总交易量(相对于美元)。单个项目将采用数组格式，其中<code class="fe kx ky kz la b">timestamp</code>和<code class="fe kx ky kz la b">value</code>如下图所示:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/4d07516051d54d918eb4736fa461e1b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ipocAC6U-VXkFwvP7hHqg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">来自CoinGecko API的示例响应</figcaption></figure><p id="19b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于这个项目的范围很小，我只是用一个包装器来处理我为以前的项目写的错误获取API。我在<code class="fe kx ky kz la b">src</code>文件夹中创建了一个新文件<code class="fe kx ky kz la b">utils.js</code>。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="1e53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我在<code class="fe kx ky kz la b">App.jsx</code>中编写了一个函数，请求获取数据并处理到<code class="fe kx ky kz la b">data</code>字典中，如下所示，用于接下来的步骤:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="3857" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一个函数初始化图表，使用来自Plotly.js的API，并将上面的<code class="fe kx ky kz la b">data</code>作为输入。你可能想看看它的官方文档<a class="ae kw" href="https://plotly.com/javascript/" rel="noopener ugc nofollow" target="_blank">来探索更多的特性。基本上，在下面的代码块中，我通过<code class="fe kx ky kz la b">data</code>对象绘制了两个折线图，一个是价格，一个是交易量，x轴是时间序列。</a></p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="9477" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，<code class="fe kx ky kz la b">useEffect</code>和<code class="fe kx ky kz la b">useState</code>将用于设置数据并计算ETH的最新价格。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="5b80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实上，传递给<code class="fe kx ky kz la b">useEffect</code>的空数组并不是一个好的设计模式。它通知<code class="fe kx ky kz la b">useEffect</code>调用一次函数，目前还不错。我们将在下一部分重构它。</p><p id="3d55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，组装好一切，我们有了一个完整的<code class="fe kx ky kz la b">App.jsx</code>文件。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="fc7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">图表应显示在<code class="fe kx ky kz la b"><a class="ae kw" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code></p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/272e261e9c0816fac168b88311a3d903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OH-qImBG0EJeHHMRA0zyBA.png"/></div></div></figure><h1 id="2c41" class="lw lk iq bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">实时更新</h1><p id="b182" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">好吧，老实说，这不是一种像WebSocket或服务器发送事件技术那样的实时发射。不使用它们有两个原因。首先，对于这样一个小项目来说，它们太复杂了。其次，我找不到任何支持那些接口的免费API提供者(如果你找到了，请建议我。)所以，为了简单起见，我只使用了<code class="fe kx ky kz la b">setInterval</code>函数在一段固定的时间(通常是60秒，因为我们从API获取数据)后继续更新图表。你得到的数据几乎是实时更新的。实际上，我们可以将间隔时间设置为1秒或更短，但是CoinGeckco API提供程序会禁止这样做。</p><p id="75d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要实现这个过程，我们需要一个自定义函数来更新Plotly.js中的图表，如下所示。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="17a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们给<code class="fe kx ky kz la b">useEffect</code>加上间隔时间</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lu lv l"/></div></figure><p id="39f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">瞧，我们已经完成了一个美元/瑞士法郎的实时图表。又快又简单。在完成的代码中，我添加了每当图表更新时闪烁的效果，以及加载消息。</p><p id="3c0a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="na">本帖原帖来自</em> <a class="ae kw" href="https://techika.com/2021/04/28/cryptocurrency-real-time-chart/" rel="noopener ugc nofollow" target="_blank"> <em class="na">我的博客</em> </a> <em class="na">。</em></p><p id="61d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://techika-cryptocurrency-chart.netlify.app/" rel="noopener ugc nofollow" target="_blank">现场演示</a> <br/> <a class="ae kw" href="https://github.com/infantiablue/cryptocurrency-chart" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div></div>    
</body>
</html>