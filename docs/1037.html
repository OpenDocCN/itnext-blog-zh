<html>
<head>
<title>Unlocking WhatsApp’s hidden GIF provider (Giphy / Tenor) and exploring the code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解锁WhatsApp的隐藏GIF提供程序(Giphy / Tenor)并探索代码</h1>
<blockquote>原文：<a href="https://itnext.io/taking-the-training-wheels-off-whatsapps-gif-search-to-include-nsfw-and-choose-between-giphy-and-885dd1c7a98c?source=collection_archive---------1-----------------------#2018-07-10">https://itnext.io/taking-the-training-wheels-off-whatsapps-gif-search-to-include-nsfw-and-choose-between-giphy-and-885dd1c7a98c?source=collection_archive---------1-----------------------#2018-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d3c358d6fd182df6b4ea50da7510525e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8Lz_nA5qW05NQjng.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片来自<a class="ae kc" href="https://www.hulldailymail.co.uk/news/hull-east-yorkshire-news/spectacular-sea-hull-pictures-spencer-112231" rel="noopener ugc nofollow" target="_blank">赫尔每日邮报</a></figcaption></figure><p id="04f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di">答</span>在<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/exploiting-freely-accessible-whatsapp-data-or-why-does-whatsapp-know-my-battery-level-ddac224041b4">上一篇报道</a>获得了压倒性的浏览量后，我决定继续探索WhatsApp的源代码，看看我是否能找到其他有趣的东西，我是说<strong class="kf ir">谁不喜欢喝着咖啡浏览109000行代码呢</strong>？。</p><blockquote class="lk"><p id="03bf" class="ll lm iq bd ln lo lp lq lr ls lt la dk translated">正如我之前关于WhatsApp的<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/exploiting-freely-accessible-whatsapp-data-or-why-does-whatsapp-know-my-battery-level-ddac224041b4">故事</a>一样，这是关于WhatsApp web的，我不会详细介绍如何做到这一点，主要是探索和分享结果</p></blockquote><p id="5596" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">几个月前，我想在群聊中给一个朋友回复一张某人模拟开枪自杀的GIF，我想要一张《我是如何遇见你母亲的》<em class="lz"/>在哪里<a class="ae kc" href="http://how-i-met-your-mother.wikia.com/wiki/Barney_Stinson" rel="noopener ugc nofollow" target="_blank">巴尼·斯丁森</a>中的特定图片。我找不到它，也找不到任何有点NSFW或暴力的东西，我明白，孩子们使用这个应用程序(他们不应该这样做，但他们这样做了)，我们必须保护我们的孩子，但…我能对我自己的WhatsApp做些什么，以便在不离开标签的情况下，我可以改善我的GIF搜索体验吗？</p><p id="6213" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们来了解一下！</p><h1 id="2051" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">你说的这个男高音是什么？</h1><p id="9ee4" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">你可能听说过<a class="ae kc" href="https://tenor.com/" rel="noopener ugc nofollow" target="_blank"> Tenor </a> gif键盘，它可以让你搜索大量的gif图片，并轻松地将它们插入到你用来聊天的应用程序中，我肯定<strong class="kf ir">从未听说过它们</strong>。在随意查看WhatsApp网站的源代码时，我注意到有一个可疑的switch语句，它考虑了用户不使用<a class="ae kc" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank"> Giphy </a>搜索引擎的可能性。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="49d9" class="nm mb iq ni b gy nn no l np nq">function n() {<br/>    switch (c["default"].gifSearch) {<br/>        case "giphy":<br/>            return u;<br/>        case "tenor":<br/>        default:<br/>            return f<br/>    }<br/>}</span></pre><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/2e2a54b8ac282eab7f9b1ba94159de36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4I63ULCq8OeU4MzbgN3PPA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我的默认gif搜索引擎</figcaption></figure><p id="ef15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，<code class="fe ns nt nu ni b">f</code>应该是<code class="fe ns nt nu ni b">"tenor"</code>,但我在搜索对话中使用的有趣的GIF时，总是会看到上面的图片。在网上阅读时，你可能会认为他们在同一个搜索中整合了这两者，也许对于iPhone用户来说就是这样，没有办法验证这一点。然而，看一下代码就可以清楚地看到(不管流在通过混淆器后变得多么迟钝),它来自两个独立的API。</p><ul class=""><li id="1bff" class="nv nw iq kf b kg kh kk kl ko nx ks ny kw nz la oa ob oc od bi translated">吉菲利用<a class="ae kc" href="https://api.giphy.com/v1/" rel="noopener ugc nofollow" target="_blank">https://api.giphy.com/v1/</a></li><li id="8cda" class="nv nw iq kf b kg oe kk of ko og ks oh kw oi la oa ob oc od bi translated">男高音使用<a class="ae kc" href="https://wa.tenor.co/v1" rel="noopener ugc nofollow" target="_blank">https://wa.tenor.co/v1</a></li></ul><p id="d298" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将<code class="fe ns nt nu ni b">c["default"].gifSearch</code>的值更改为“<em class="lz">期限</em>”或除了“<em class="lz"> giphy </em>”之外的任何值，将使您的查询通过期限API并提供不同的结果。我敢肯定，无论是在web应用程序还是Android应用程序中都没有改变GIF提供者的选项，但如果有，请让我知道，因为这样整个部分都变得很傻。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/f43a3cd89230477b3b1fe6efea5eccb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KnU8exh0JUQxfk_EYos3dQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我们有所发现，我们可以搜索高音！</figcaption></figure><h1 id="4409" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">这两个搜索引擎相比如何</h1><p id="e00c" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我读到过，搜索到的最常见的gif是猫的gif，所以为了比较结果，在我尝试去NSFW之前，我将使用术语“<em class="lz">猫</em>”。让我警告你，结果至少是反气候的。</p><p id="08f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为什么WhatsApp有这个能力在两者之间选择却替我们决定？我猜这可能与你来自的国家有关，也许他们与每个公司都有协议，并根据用户的位置将流量转移到一个或另一个公司，但这是纯粹和有趣的推测性谈话。</p><div class="nd ne nf ng gt ab cb"><figure class="ok jr ol om on oo op paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/ad362a9acbe1edab4e065ddd91338f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*isl1SJ7cRje_3mXTYzHHFg.png"/></div></figure><figure class="ok jr oq om on oo op paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/352dd3267e4a2aa03258a62f73b3bfac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*M8swyFvnF0F1LQW4tro-Og.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk or di os ot translated">我想，吉卜利在左边，男高音在右边</figcaption></figure></div><p id="fe66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lz">完全编造了那个说法，不好意思，想交猫税。</em></p><h1 id="5773" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">我们使用PG-13版本的搜索</h1><p id="fffb" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">抛开比较不谈，这两个搜索引擎有一些共同点，它们都将搜索结果限制在PG-13美国电影协会级别。男高音网站上有一个表格，列出了这包括哪些内容(不包括明显的裸露)<a class="ae kc" href="https://tenor.com/gifapi/documentation#localization" rel="noopener ugc nofollow" target="_blank">。在源代码中，这被设置为“<em class="lz">中度</em>”，删除了图形暴力、强烈的亵渎、毒品和带有伤害意图的武器。</a></p><p id="19b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Giphy的代码部分设置了一个"<em class="lz"> pg-13 </em>"值，但没有说明它究竟阻止了我们的结果，而是将我们指向美国电影协会电影分级官方网站<a class="ae kc" href="http://www.mpaa.org/film-ratings/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="84aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="https://portswigger.net/burp" rel="noopener ugc nofollow" target="_blank">打嗝</a>上设置匹配和替换规则，用“<em class="lz">关</em>”和“<em class="lz"> r </em>”替换“<em class="lz">中等</em>”和“<em class="lz"> pg-13 </em>”值，应该可以消除这种限制，并允许搜索这些提供商的完整目录，但是pg等级对头像结果没有影响。或者实际上任何进一步的关键字。</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/ee6a92b418844e7847d25549c2441dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/1*sGhAYV2FbXKuXHUdpzmq9w.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">唉，至少我在找男高音而不是吉菲，对吗？</figcaption></figure><p id="8714" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">说到底，两家提供商<strong class="kf ir">都有非常严格的NSFW指导方针</strong>，如果它们的目录中没有，我们就没有办法找到它，所以我们也可以不去管它，我们可以添加模仿giphy和tenor APIs的其他端点，但这没什么意思。</p><p id="ef1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单地将引擎从giphly改为tenor会为关键字“<em class="lz">裸体”、</em>产生完全不同的一组结果，但是正如我提到的，没有一个结果是显式的。<br/>还有另一件值得注意的事情，那就是搜索结果是按受欢迎程度排序的，因此，由于大多数人无法在没有过滤器的情况下进行搜索，即使有更明确的结果，那些过滤后的结果也会出现在顶部。</p><div class="nd ne nf ng gt ab cb"><figure class="ok jr ov om on oo op paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/4b1acacf30127ed388846cd9933fd9ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*S9UBmK0kN45_fOdW0qhMPA.gif"/></div></figure><figure class="ok jr ov om on oo op paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/5f1fde53d108fd4e527388955f5464e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*WtGuIqtRKebZ3KmgcdA8VA.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk ow di ox ot translated">giphy和tenor的结果比较，是的，我的互联网糟透了</figcaption></figure></div><h1 id="269a" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">结论</h1><p id="1d5e" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我能有什么结论？唯一的结论是我现在有太多的空闲时间。我很好奇将Tenor作为默认设置但在某个时候被Giphy覆盖的原因，所以我做了更多的研究，但我只能确定数据的来源是来自他们服务器的websocket消息:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="16db" class="nm mb iq ni b gy nn no l np nq">MESSAGE_INFO:true<br/>SET_BLOCK:true<br/>SPAM:true<br/>announceGroups:1001<br/>bucket:""<br/>edit:1<br/>fbCrashlog:true      <br/>gifSearch:"giphy"    #There we go<br/>groupDescLength:512<br/>groupsV3:1<br/>imageMaxEdge:1600<br/>imageMaxKBytes:1024<br/>maxFileSize:100<br/>maxParticipants:257<br/>maxSubject:25<br/>media:64<br/>restrictGroups:1<br/>videoMaxEdge:960<br/>webPresence:false</span></pre><p id="2272" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有一个巨大的对象，内部称为<code class="fe ns nt nu ni b">c["default"]</code>，包含这一个和另一个设置，如电池警告阈值(默认为15和5，测试更改为99，果然我得到了低电池警告)，以及一些显然未使用的谷歌地图设置(可能在网络中未使用，在iPhone中使用)名为<code class="fe ns nt nu ni b">GOOGLE_MAPS_DO_NOT_AUTH</code>。难倒我了…</p><p id="00eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在就这样吧，我会用这些设置再玩一些，如果我发现什么就告诉你们。</p></div></div>    
</body>
</html>