<html>
<head>
<title>Reflecting business logic rules into the domain models using typescript — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用typescript将业务逻辑规则反映到域模型中—第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/reflecting-business-logic-rules-into-the-domain-models-using-typescript-part-1-e696773ae4ae?source=collection_archive---------2-----------------------#2020-08-02">https://itnext.io/reflecting-business-logic-rules-into-the-domain-models-using-typescript-part-1-e696773ae4ae?source=collection_archive---------2-----------------------#2020-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a86e0f73d52fa2b9de709cf5d33b222f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-d4vOE2IRgxqMEM1VJSciw.jpeg"/></div></div></figure><p id="4643" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Typescript是一个强大的类型检查工具，但是如果您没有根据业务逻辑规则定义您的类型，它可能会让您感到困扰。</p><p id="e070" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您的模型没有反映业务逻辑规则，过一段时间后，它将在业务逻辑所说的内容和您的代码行为之间产生差距。</p><p id="d867" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们用一个例子来解释这个。</p><p id="f769" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要定义一个存储<code class="fe kw kx ky kz b">Person</code>数据的模型。规则和约束是:</p><ul class=""><li id="f56d" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">一个人的名字必须限制在50个字符以内</li><li id="13cb" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人的姓氏长度必须限制在50以内</li><li id="ede0" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人必须有联系信息。联系信息可以是电子邮件或邮政编码，或者两者都有。</li></ul><p id="8a47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">把<code class="fe kw kx ky kz b">Person</code>模型做成这样似乎很合理。</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="840a" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: string<br/>     lastName: string<br/>     email?: string<br/>     postalCode?: string<br/>}</span></pre><p id="1d47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是这种建模存在一些问题。</p><ul class=""><li id="d64d" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated"><code class="fe kw kx ky kz b">firstName</code>和<code class="fe kw kx ky kz b">lastName</code>不是任何字符串。他们不能有任何长度，他们应该有一个有限的长度为50。</li><li id="e910" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated"><code class="fe kw kx ky kz b">email</code>不是任何字符串。它应该有一些特定的形状(有@字符和域名)</li><li id="3a8e" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated"><code class="fe kw kx ky kz b">postalCode</code>不是任何字符串。它应该包含10个数字。</li></ul><p id="207f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何将这些规则放到我们的模型中呢？</p><h1 id="030c" class="mc lx iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">受歧视的工会</h1><p id="6e19" class="pw-post-body-paragraph jy jz iq ka b kb mz kd ke kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ij bi translated">根据文件显示</p><blockquote class="ne nf ng"><p id="cd96" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated">您可以组合单例类型、联合类型、类型保护和类型别名来构建一个高级模式，称为<em class="iq">区分联合</em>，也称为<em class="iq">标记联合</em>或<em class="iq">代数数据类型</em>。</p></blockquote><p id="565f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae nl" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions" rel="noopener ugc nofollow" target="_blank">https://www . typescriptlang . org/docs/handbook/advanced-types . html # discribed-unions</a></p><p id="938e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们先解决<code class="fe kw kx ky kz b">firstName</code>和<code class="fe kw kx ky kz b">lastName</code>的问题。<br/>我们需要一个<code class="fe kw kx ky kz b">string</code>应该有一个50有限的长度。所以我们创造了一种新的类型，比如:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="1930" class="lw lx iq kz b gy ly lz l ma mb">type String50 = {<br/>    kind: "String50"<br/>    value: string<br/>}</span></pre><p id="6d56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们可以这样重新定义我们的<code class="fe kw kx ky kz b">Person</code>模型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="c008" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: String50<br/>     lastName: String50<br/>}</span></pre><p id="ba36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以理解，一个人必须有名和姓，这两个名字的长度都应该限制在50以内。</p><p id="03c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们回到联系信息规则。<br/>我们可以将<code class="fe kw kx ky kz b">Email</code>和<code class="fe kw kx ky kz b">PostalCode</code>定义如下:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="5f8f" class="lw lx iq kz b gy ly lz l ma mb">type Email = {<br/>    kind: "Email"<br/>    value: string<br/>}</span><span id="f7c6" class="lw lx iq kz b gy nm lz l ma mb">type PostalCode = {<br/>    kind: "PostalCode"<br/>    value: string<br/>}</span></pre><p id="2feb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们更新<code class="fe kw kx ky kz b">Person</code>模型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="1082" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: String50<br/>     lastName: String50<br/>     email?: Email<br/>     postalCode?: PostalCode<br/>}</span></pre><p id="3804" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是有一个问题。你看到了吗？根据业务逻辑，一个人必须有联系信息，联系信息可以是电子邮件或邮政编码，也可以是两者都有。但是在我们的模型中，一个人可能没有任何联系信息，因为他们都是可选的。</p><p id="aba3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们像这样改变我们的模型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="7c0a" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: String50<br/>     lastName: String50<br/>     email: Email<br/>     postalCode: PostalCode<br/>}</span></pre><p id="22b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它也有一个问题。现在一个人必须同时拥有电子邮件和邮政编码！</p><p id="c2b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们应该如何解决这个问题？</p><h1 id="fe6d" class="mc lx iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">工会类型</h1><p id="932c" class="pw-post-body-paragraph jy jz iq ka b kb mz kd ke kf na kh ki kj nb kl km kn nc kp kq kr nd kt ku kv ij bi translated">联合类型将多个类型组合成一个类型。这允许您将现有的类型添加到一起，以获得可能是其中之一的单个类型。</p><p id="a01c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里阅读更多关于union type的内容:<br/><a class="ae nl" href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#union-types" rel="noopener ugc nofollow" target="_blank">https://www . typescriptlang . org/docs/handbook/advanced-types . html # union-types</a></p><p id="8ca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于我们的例子，我们可以这样定义<code class="fe kw kx ky kz b">ContactInfo</code>类型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="96b8" class="lw lx iq kz b gy ly lz l ma mb">type <!-- -->ContactInfo =<br/>   | Email<br/>   | PostalCode</span></pre><p id="c20d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它说<code class="fe kw kx ky kz b">ContactInfo</code>可能是<code class="fe kw kx ky kz b">Email</code>也可能是<code class="fe kw kx ky kz b">PostalCode</code></p><p id="b081" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们再次重新定义我们的<code class="fe kw kx ky kz b">Person</code>模型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="a8b6" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: String50<br/>     lastName: String50<br/>     contactInfo: <!-- -->ContactInfo<br/>}</span><span id="b107" class="lw lx iq kz b gy nm lz l ma mb">type <!-- -->ContactInfo =<br/>   | Email<br/>   | PostalCode</span></pre><p id="cba1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们回顾一下我们的业务规则:</p><ul class=""><li id="122b" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">一个人的名字必须限制在50个字符以内</li><li id="76d5" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人的姓氏长度必须限制在50以内</li><li id="d25d" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人必须有联系信息。联系信息可以是电子邮件或邮政编码，或者两者都有。</li></ul><p id="71e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一条规则有一些其他约束。你看到了吗？</p><p id="715a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们说<code class="fe kw kx ky kz b">ContactInfo</code>可能是<code class="fe kw kx ky kz b">Email</code>或者<code class="fe kw kx ky kz b">PostalCode</code>。如果一个人既有电子邮件又有邮政编码怎么办？</p><p id="5927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们应该为这种情况创建一个新类型:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="1ac4" class="lw lx iq kz b gy ly lz l ma mb">type EmailAndPostalCode = {<br/>    email: Email<br/>    postalCode: PostalCode<br/>}</span></pre><p id="a55e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后更新<code class="fe kw kx ky kz b">ContactInfo</code></p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="60a6" class="lw lx iq kz b gy ly lz l ma mb">type <!-- -->ContactInfo =<br/>   | Email<br/>   | PostalCode<br/>   | <!-- -->EmailAndPostalCode</span></pre><p id="e1dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在联系信息可以是电子邮件或邮政编码，或者两者都有。</p><p id="98f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们再次回顾一下业务逻辑规则，并用我们的类型来检查它们:</p><pre class="lo lp lq lr gt ls kz lt lu aw lv bi"><span id="228a" class="lw lx iq kz b gy ly lz l ma mb">type Person = {<br/>     firstName: String50<br/>     lastName: String50<br/>     contactInfo: <!-- -->ContactInfo<br/>}</span><span id="c60f" class="lw lx iq kz b gy nm lz l ma mb">type <!-- -->ContactInfo =<br/>   | Email<br/>   | PostalCode<br/>   | <!-- -->EmailAndPostalCode</span><span id="59ad" class="lw lx iq kz b gy nm lz l ma mb">type EmailAndPostalCode = {<br/>    email: Email<br/>    postalCode: PostalCode<br/>}</span></pre><ul class=""><li id="7715" class="la lb iq ka b kb kc kf kg kj lc kn ld kr le kv lf lg lh li bi translated">一个人的名字必须限制在50个字符以内</li><li id="ce82" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人的姓氏长度必须限制在50以内</li><li id="562c" class="la lb iq ka b kb lj kf lk kj ll kn lm kr ln kv lf lg lh li bi translated">一个人必须有联系信息。联系信息可以是电子邮件或邮政编码，或者两者都有。</li></ul><p id="72eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你现在看到的,<code class="fe kw kx ky kz b">Person</code>模型反映了所有的业务逻辑规则，它是非常可读和干净的代码。<br/>没有任何额外的文档或注释或任何<code class="fe kw kx ky kz b">if else</code>语句，它显示了业务逻辑规则，并且是自文档化的。</p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="a78f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一集里，我们学习了如何使用有区别的联合和联合类型来创建可读和自记录的类型。<br/>但他们只是类型。他们什么也不做。</p><p id="f87e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下一集，我们尝试创建一些代码来创建和验证<code class="fe kw kx ky kz b">Person</code>模型。</p><p id="c954" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae nl" href="https://medium.com/@mohsen.sareminia/reflecting-business-logic-rules-into-the-domain-models-using-typescript-part-2-61a19fba069d" rel="noopener">继续下一篇。</a></p></div></div>    
</body>
</html>