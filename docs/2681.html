<html>
<head>
<title>Using LetsEncrypt SSL certificates in AWS Certificate Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS证书管理器中使用LetsEncrypt SSL证书</h1>
<blockquote>原文：<a href="https://itnext.io/using-letsencrypt-ssl-certificates-in-aws-certificate-manager-c2bc3c6ae10?source=collection_archive---------0-----------------------#2019-07-10">https://itnext.io/using-letsencrypt-ssl-certificates-in-aws-certificate-manager-c2bc3c6ae10?source=collection_archive---------0-----------------------#2019-07-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="db4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">我最近需要为我自己的个人域创建一个SSL证书，这样我就可以用它来托管一个示例AWS应用程序，该应用程序要求您在AWS证书管理器中拥有一个SSL证书。当SSL证书只是临时使用时，我不想为其付费，所以我决定尝试一下<a class="ae kx" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank"> LetsEncrypt </a>解决方案(其证书是免费的，但在颁发后3个月到期)。</p><p id="5467" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我为我的域名使用的注册商是<a class="ae kx" href="https://www.fasthosts.co.uk/" rel="noopener ugc nofollow" target="_blank"> FastHosts </a>，由于它目前没有托管任何内容，我决定创建SSL证书的最便捷途径是使用LetsEncrypt的<em class="ky"> certbot </em> CLI工具，在手动模式下进行DNS验证。</p><h1 id="f88b" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">安装LetsEncrypt CLI</h1><p id="f4aa" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">在MacOS上，<em class="ky"> brew </em>安装路径对我来说是很容易的选择，我安装了LetsEncrypt的<em class="ky"> certbot </em> CLI工具(参见LetsEncrypt文档以安装到其他OS上)。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="fe23" class="ml la it mh b gy mm mn l mo mp">brew install letsencrypt</span></pre><h1 id="ead0" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">生成证书</h1><p id="7724" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">一旦安装了LetsEncrypt，生成SSL证书只需运行<em class="ky"> certbot </em> CLI工具并让它验证您是指定域的所有者。对于我的使用，我决定创建一个通配符证书，覆盖我的域的所有子域，由CLI的<em class="ky"> *.arronharden.com </em>选项指示。这意味着相同的证书可以用于我的根域下的任何子域。</p><p id="9d77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，<em class="ky"> certbot </em>工具需要以root身份运行，例如在MacOS上需要<em class="ky"> sudo </em>。或者，它可以在没有sudo的情况下运行，并设置适当的标志来改变默认目录，这就是我在这里要做的。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d313" class="ml la it mh b gy mm mn l mo mp">$ mkdir ~/letsencrypt<br/>$ cd ~/letsencrypt<br/>$ certbot certonly \<br/>    --manual \<br/>    --preferred-challenges=dns \<br/>    --email your@email-address.com \<br/>    --agree-tos \<br/>    --config-dir ./config \<br/>    --logs-dir ./logs \<br/>    --work-dir ./workdir \<br/>    -d *.arronharden.com</span></pre><h1 id="28e4" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">DNS验证</h1><p id="6942" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">因为我选择了DNS验证，这涉及到我为我的域创建一个DNS TXT记录——它包含一个由<em class="ky"> certbot </em> CLI工具生成的随机字符串——以便验证我控制着那个域。当使用上述选项运行<em class="ky"> certbot </em> CLI工具时，它将显示以下输出，并等待您为指定的域创建DNS TXT记录。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="387e" class="ml la it mh b gy mm mn l mo mp">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br/>Please deploy a DNS TXT record under the name<br/>_acme-challenge.arronharden.com with the following value:</span><span id="3377" class="ml la it mh b gy mq mn l mo mp">I1cln1SGtKLmVRw8tHlyhBk-5jcrNaUv-yeHW-dER0U</span><span id="7bb0" class="ml la it mh b gy mq mn l mo mp">Before continuing, verify the record is deployed.<br/>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br/>Press Enter to Continue<br/>Waiting for verification...</span></pre><p id="7419" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用我的注册商提供的管理控制台，在<em class="ky">高级DNS </em>部分，我能够简单地为我的<em class="ky">arronharden.com</em>域名添加一个TXT记录，并提供所需的值。</p><figure class="mc md me mf gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mr"><img src="../Images/28725e82533fcb27caba5e3c55fb9dda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6nIQNHnbF24tgcOc6AMuHQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">在FastHosts管理控制台中添加DNS TXT记录</figcaption></figure><p id="0520" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尽管任何DNS更改都需要一些时间来传播到各个DNS系统，但对我来说这发生得非常快(几秒钟的事情)。我通过使用由<a class="ae kx" href="https://mxtoolbox.com/TXTLookup.aspx" rel="noopener ugc nofollow" target="_blank"> MxToolBox </a>提供的查找工具，验证了该变更已经发布。</p><figure class="mc md me mf gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nd"><img src="../Images/45390c31c9d3509dd4965ec945329712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3JNm4CZjpUVj_apISWUUw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用MxToolBox验证TXT DNS记录</figcaption></figure><p id="8d90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦TXT记录就绪，我就可以返回到<em class="ky"> certbot </em> CLI工具，让它继续运行。它验证了TXT记录与其生成的内容相匹配，并继续创建证书文件:</p><ul class=""><li id="bf95" class="ne nf it js b jt ju jx jy kb ng kf nh kj ni kn nj nk nl nm bi translated">私人证书(<em class="ky"> privkey.pem </em>)</li><li id="f02c" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">公共证书(<em class="ky"> cert.pem </em>)</li><li id="97e2" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated">公共证书链(<em class="ky"> fullchain.pem </em>)。</li></ul><h1 id="d37c" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">导入AWS证书管理器</h1><p id="15e4" class="pw-post-body-paragraph jq jr it js b jt lx jv jw jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn im bi translated">除了允许您购买证书，AWS证书管理器还允许您导入现有的证书，这就是我们现在对从LetsEncrypt创建的证书所做的事情。</p><p id="82c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦AWS证书管理器服务被打开，并且导入过程开始，它只为相关的<em class="ky">保留。pem将由<em class="ky"> certbot </em> CLI工具创建的</em>文件复制并粘贴到下面的相关字段中。</p><figure class="mc md me mf gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ns"><img src="../Images/7ab86fc6edc1d66bed31147bae8677b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5TbikQCITdHdgwqmr7Ntaw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">将证书导入AWS证书管理器</figcaption></figure><p id="cc7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ky">需要注意的重要一点是，一些AWS服务(例如AWS Cognito)将始终在美国东部(N. Virginia)地区寻找证书，即使服务本身是从不同的地区使用的。如果没有列出您的证书，请尝试使用美国东部地区导入证书。</em></p><p id="caa1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">成功导入证书后，您可以查看证书详细信息，并在AWS服务中引用该证书。</p><figure class="mc md me mf gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nt"><img src="../Images/ea99209214bfc0cb6b8f1ed6b13cc70b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*otqqtQJmWSnUtp66FWfCtg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">AWS证书管理器中的证书详细信息</figcaption></figure><p id="db7e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，一旦在应用程序中使用，您可以验证证书是否被浏览器接受以及是否与您期望的细节相匹配。</p><figure class="mc md me mf gt ms gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/faa16676e982c95fe01607dfaafe5627.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*Sm_LoB1xx6i_ZZHrvquzMw.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">arronharden.com子域中托管的应用程序的浏览器(Chrome)证书详细信息</figcaption></figure></div></div>    
</body>
</html>