<html>
<head>
<title>Relay modern — Refetch container usage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现代继电器—回收容器的使用</h1>
<blockquote>原文：<a href="https://itnext.io/relay-modern-refetch-container-c886296448c7?source=collection_archive---------2-----------------------#2017-07-12">https://itnext.io/relay-modern-refetch-container-c886296448c7?source=collection_archive---------2-----------------------#2017-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Relay modern是一个很棒的库，但是它有一个缺点——文档。</p><p id="6d17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇短文中，我将尝试解释和展示它是如何工作的，以及如何使用它。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/0a5badac48632894dc07498239fcc566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYdl8hCpQ1pCSniKm4GnoA.jpeg"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="b705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从一个示例开始:假设我们有一个名为viewer的根值，还有一个名为users的查询，类型为[User],用户类型为id、name、company、DOB字段。该查询让我们按公司查找用户。让我们编写一个查询，获取在Company字段中有“MyCompany”的用户。</p><p id="da48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的<code class="fe le lf lg lh b">UsersList</code>组件中:</p><pre class="kt ku kv kw gt li lh lj lk aw ll bi"><span id="07c1" class="lm ln iq lh b gy lo lp l lq lr">const UsersList = props =&gt; (<br/>  &lt;div&gt;{props.users.length}&lt;/div&gt;<br/>);</span><span id="7121" class="lm ln iq lh b gy ls lp l lq lr">&lt;QueryRenderer<br/>  query={graphql`<br/>    UsersListQuery($company: String) {<br/>      users(company: $company) {<br/>        id<br/>        name<br/>      }<br/>    }`<br/>  }<br/>  variables={{company: 'MyCompany'}}<br/>  environment={myEnvironment}<br/>  render={({ error, props ) =&gt; &lt;UsersList users={props.data} /&gt;}<br/>/&gt;</span></pre><p id="ddc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是获取和显示数据通常的样子。它可能看起来有点不同，但应该是非常相似的。</p><p id="37ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们获取所有在公司字段中有我的公司的用户，这是可以的。但是如果我们想获取在company字段中有另一家公司的用户呢？这就是<code class="fe le lf lg lh b">refetchContainer</code>的目的。</p><p id="ba2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要向我们的<code class="fe le lf lg lh b">UsersList</code>组件添加一个特设。</p><pre class="kt ku kv kw gt li lh lj lk aw ll bi"><span id="c84d" class="lm ln iq lh b gy lo lp l lq lr">const UsersList = (props) =&gt; (<br/>  &lt;div&gt;<br/>    &lt;span&gt;{users.length}&lt;/span&gt;<br/>    &lt;button<br/>      onClick={() =&gt; props.relay.refetch((prev) =&gt; ({ company: 'NotMyCompany' }))}<br/>    &gt;<br/>      Load users with NotMyCompany<br/>    &lt;/button&gt;<br/>&lt;div&gt;<br/>);<br/>const RefetchableUsersList = createRefetchContainer(<br/>  UsersList,<br/>  {<br/>     users: graphql.experimental`<br/>       fragment UsersList_users on User<br/>       @argumentDefinitions(<br/>         company: { type: String }<br/>       ) {<br/>         id<br/>         name<br/>       }<br/>     `<br/>  },<br/>  graphql.experimental`<br/>    query UsersListRefetchQuery($company: String) {<br/>      users(company: $company) {<br/>        ...UsersList_users @arguments(company: $company)<br/>      }<br/>    }<br/>  `<br/>);</span><span id="8373" class="lm ln iq lh b gy ls lp l lq lr">&lt;QueryRenderer<br/>  query={graphql`<br/>    UsersListQuery{<br/>      users {<br/>        ...UsersList_users<br/>      }<br/>    }`<br/>  }<br/>  variables={{company: 'MyCompany'}}<br/>  environment={myEnvironment}<br/>  render={({ error, props ) =&gt; &lt;RefetchableUsersList users={props.data} /&gt;}<br/>/&gt;</span></pre><p id="b1d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们来看看代码中的每一项:<code class="fe le lf lg lh b">UsersList</code> component现在又多了一个道具，叫做relay。Relay有一个方法refetch，它采用一个函数(或一组变量)来返回一组新的变量。一旦我们点击这个按钮，一个带有变量<code class="fe le lf lg lh b">company: NotMyCompany</code>的请求将被发送。它也采用这些论点:</p><pre class="kt ku kv kw gt li lh lj lk aw ll bi"><span id="4a46" class="lm ln iq lh b gy lo lp l lq lr">refetchVariables: Variables | ((fragmentVariables: Variables) =&gt; Variables),<br/>renderVariables: ?Variables,<br/>callback: ?(error: ?Error) =&gt; void,<br/>options?: RefetchOptions,</span></pre><p id="c63a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">createRefetchContainer是一个工具，它允许我们更改变量并从服务器获取另一组数据。这需要:</p><ol class=""><li id="3c25" class="lt lu iq jp b jq jr ju jv jy lv kc lw kg lx kk ly lz ma mb bi translated">组件。将传递中继道具的React组件。</li><li id="bbfb" class="lt lu iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated">碎片。碎片的对象。需要注意的是，这个对象中的键应该与查询名相同，否则relay不会将数据传递给组件。</li><li id="88a9" class="lt lu iq jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated">TaggedNode。查询本身。它基本上是一个每当调用<code class="fe le lf lg lh b">refetch</code>函数时都会被调用的查询。</li></ol><p id="bf20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经注意到了，代码太多了。或许你会发现这个库很有用<a class="ae mh" href="https://github.com/ErrorPro/relay-compose" rel="noopener ugc nofollow" target="_blank">https://github.com/ErrorPro/relay-compose</a></p><p id="9c10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个基本用法。请注意，该功能仍处于试验阶段，这意味着它可能会在未来发生变化。我现在不提供演示，但如果这篇文章对一些人有帮助，我会创建一个并更新这篇文章。喜欢和分享；)</p><p id="a24b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些链接:</p><p id="8b0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">工作示例:<a class="ae mh" href="https://github.com/ErrorPro/relay-modern-hello-world/commit/94548f22ad1d31bc21ae7874470151ed2824fd43" rel="noopener ugc nofollow" target="_blank">https://github . com/error pro/relay-modern-hello-world/commit/94548 f 22 ad 3d 31 BC 21 AE 7874470151 ed 2824 FD 43</a></p><div class="mi mj gp gr mk ml"><a href="https://facebook.github.io/relay/docs/refetch-container.html" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">RefetchContainer -中继文档</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">用于构建数据驱动的React应用程序的JavaScript框架</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">facebook.github.io</p></div></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://github.com/facebook/relay/blob/master/packages/react-relay/modern/ReactRelayRefetchContainer.js" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">facebook/relay</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">relay - Relay是一个JavaScript框架，用于构建数据驱动的React应用程序。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">github.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lc ml"/></div></div></a></div></div></div>    
</body>
</html>