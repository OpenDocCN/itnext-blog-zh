<html>
<head>
<title>Using Managed Kubernetes Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用托管Kubernetes服务</h1>
<blockquote>原文：<a href="https://itnext.io/using-managed-kubernetes-services-6201258e0df2?source=collection_archive---------6-----------------------#2018-05-08">https://itnext.io/using-managed-kubernetes-services-6201258e0df2?source=collection_archive---------6-----------------------#2018-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aab8738a4ffbb131cff9cebf2ed7dfbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JdQ1oX0reklenlg8qufLkg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">约瑟夫·巴里恩托斯在<a class="ae kc" href="https://unsplash.com/search/photos/ship-wheel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片。</figcaption></figure><p id="d67f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文概述了主要云提供商的托管Kubernetes服务，并解释了如何使用它们。</p><h1 id="baea" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">手动与托管Kubernetes</h1><p id="3928" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Kubernetes是一种可以安装在现有计算基础设施上的软件，通常安装在一组互连的物理机器上。</p><p id="3a82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在出现托管Kubernetes服务之前，您通常会配置机器(在本地或云中)，在这些机器上安装Kubernetes，将它们绑定到一个集群，然后开始使用带有<code class="fe me mf mg mh b">kubectl</code>的集群。</p><p id="de0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特别是，您需要选择其中一台机器作为主节点，在这个主节点上安装Kubernetes，然后在所有其他机器上安装Kubernetes，这些机器将成为工作节点，然后将工作节点加入主节点以形成一个集群。</p><p id="5a58" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了托管Kubernetes服务，这变得更加容易。这些服务提供了创建整个Kubernetes集群的简单命令。这包括机器的供应、Kubernetes的安装和集群的形成。所有这些都是在幕后自动完成的。执行这个命令后，Kubernetes集群就可以使用了。您只需要将集群的地址提供给本地机器上的<code class="fe me mf mg mh b">kubectl</code>，然后您就可以开始使用带有<code class="fe me mf mg mh b">kubectl</code>的集群。</p><p id="8308" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，使用托管Kubernetes服务的典型工作流程如下:</p><ol class=""><li id="493a" class="mi mj iq kf b kg kh kk kl ko mk ks ml kw mm la mn mo mp mq bi translated">使用托管Kubernetes服务提供的命令启动Kubernetes集群。</li><li id="7938" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">将本地机器上的<code class="fe me mf mg mh b">kubectl</code>指向这个集群。</li><li id="06ef" class="mi mj iq kf b kg mr kk ms ko mt ks mu kw mv la mn mo mp mq bi translated">用<code class="fe me mf mg mh b">kubectl</code>开始使用集群。</li></ol><h1 id="a6d8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">现有的托管Kubernetes服务</h1><p id="eb52" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">所有主要的云提供商，<strong class="kf ir">亚马逊网络服务(AWS) </strong>、<strong class="kf ir">谷歌云平台(GCP) </strong>、<strong class="kf ir">微软Azure </strong>和<strong class="kf ir"> IBM Cloud </strong>，目前都提供托管的Kubernetes服务。具体而言，这些是:</p><h2 id="b19c" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><a class="ae kc" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank">谷歌Kubernetes引擎(GKE) </a></h2><p id="165f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">自2014年Kubernetes成立以来就一直存在(如你所知，Kubernetes诞生于谷歌的Borg项目)。</p><h2 id="ae45" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><a class="ae kc" href="https://docs.microsoft.com/en-us/azure/aks/" rel="noopener ugc nofollow" target="_blank"> Azure Kubernetes服务(AKS) </a></h2><p id="d33e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">于【2017年秋季推出。目前(2018年春季)在预览中，但已正式上市。</p><h2 id="6672" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><a class="ae kc" href="https://aws.amazon.com/eks/" rel="noopener ugc nofollow" target="_blank">亚马逊弹性集装箱服务(EKS) </a></h2><p id="a98d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">目前(2018年春季)在预览中，但尚未<strong class="kf ir"> </strong>全面上市。</p><p id="9da5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">编辑:<em class="ni"> </em> </strong> EKS已于2018年6月公开发售(见<a class="ae kc" href="https://aws.amazon.com/blogs/aws/amazon-eks-now-generally-available/" rel="noopener ugc nofollow" target="_blank">此处</a>)，但目前(2018年8月)仅在<em class="ni">美东-1 </em>和<em class="ni">美西-2 </em>地区发售。</p><h2 id="95f0" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated"><a class="ae kc" href="https://www.ibm.com/cloud/container-service" rel="noopener ugc nofollow" target="_blank"> IBM云容器服务</a></h2><p id="fdd6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">2017年春季<a class="ae kc" href="https://www.ibm.com/blogs/bluemix/2017/03/kubernetes-now-available-ibm-bluemix-container-service/" rel="noopener ugc nofollow" target="_blank">推出。</a></p><h1 id="d9e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">托管Kubernetes服务命令</h1><p id="4ab8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">下面是一些使用<strong class="kf ir">AK</strong>和<strong class="kf ir"> GKE </strong>的托管Kubernetes服务的有用命令，分别是微软Azure和谷歌云平台的托管Kubernetes服务。</p><p id="6e0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:将来我可能会为AWS和IBM Cloud的Kubernetes服务添加等效的命令。</p><p id="28c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">深入研究这些命令的最好方法是查看内置的帮助消息，您可以通过向任何命令添加<code class="fe me mf mg mh b">-h</code>选项来显示这些消息。</p><h2 id="e53b" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">创建一个集群</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="9fbb" class="mw lc iq mh b gy nr ns l nt nu">az aks create -n my-cluster<br/>    [--node-count n]<br/>    [--node-vm-size type]</span><span id="82c0" class="mw lc iq mh b gy nv ns l nt nu">gcloud container clusters create my-cluster<br/>    [--num-nodes n]<br/>    [--machine-type type]</span></pre><p id="da09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AKS和GKE的默认集群节点数都是3。Azure的可用计算实例类型在这里列出<a class="ae kc" href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/sizes" rel="noopener ugc nofollow" target="_blank">，GCP的可用计算实例类型在这里列出</a><a class="ae kc" href="https://cloud.google.com/compute/docs/machine-types" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="24e4" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">列出所有集群</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="4340" class="mw lc iq mh b gy nr ns l nt nu">az aks list</span><span id="c135" class="mw lc iq mh b gy nv ns l nt nu">gcloud container clusters list</span></pre><h2 id="1ee6" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">列出计算实例</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="feb7" class="mw lc iq mh b gy nr ns l nt nu">az vm list</span><span id="9e89" class="mw lc iq mh b gy nv ns l nt nu">gcloud compute instances list</span></pre><p id="620c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这包括由<em class="ni">创建集群</em>命令创建的计算实例。</p><h2 id="2978" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">删除集群</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="0e43" class="mw lc iq mh b gy nr ns l nt nu">az aks delete -n my-cluster</span><span id="eadf" class="mw lc iq mh b gy nv ns l nt nu">gcloud container clusters delete my-cluster</span></pre><p id="7e65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这还会删除与群集关联的所有计算实例。</p><h2 id="0c07" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">将kubectl指向一个集群</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="9af7" class="mw lc iq mh b gy nr ns l nt nu">az aks get-credentials -n my-cluster</span><span id="6b61" class="mw lc iq mh b gy nv ns l nt nu">gcloud container clusters get-credentials my-cluster</span></pre><p id="0fe0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这编辑<code class="fe me mf mg mh b">$HOME/.kube/config</code>。</p><h1 id="79bf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">享受你的集群</h1><p id="37f1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在执行上面的最后一个命令(将<code class="fe me mf mg mh b">kubectl</code>指向集群)后，您就有了一个正常工作的集群，并且您可以将它与<code class="fe me mf mg mh b">kubectl</code>一起使用。</p><p id="68a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从这一点开始使用<code class="fe me mf mg mh b">kubectl</code>总是以相同的方式工作，不管您是使用AKS、GKE还是手动创建集群。</p><p id="4ba0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">托管Kubernetes服务只是帮助您创建集群，但是一旦完成，您就不必再处理它了。</p><p id="9bf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你现在是在纯粹的Kubernetes世界。</p><p id="1faf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<code class="fe me mf mg mh b">kubectl cluster-info</code>或<code class="fe me mf mg mh b">kubectl get nodes</code>进行测试。</p><h1 id="7687" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">附录:自定义Azure CLI</h1><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/ef170afd14c05ef795c56958cf8f87ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AoZG8WGyBJZcfoXBvNqfAQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/xyGfJ2cKCl4?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">蒂姆·福斯特</a>在<a class="ae kc" href="https://unsplash.com/search/photos/ocean?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照。</figcaption></figure><p id="176e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一些定制Azure CLI的命令。</p><p id="8611" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特别是，设置默认的资源组和位置非常方便，因为它使您不必分别用<code class="fe me mf mg mh b">-g</code>和<code class="fe me mf mg mh b">-l</code>选项为每个命令指定资源组和位置。</p><p id="5f81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">资源组</strong>是一组可以作为一个整体来管理(例如，删除)的资源。对于您创建的每个资源(例如，一个计算实例)，您必须定义它属于哪个资源组。</p><p id="85e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">资源提供者</strong>只是一个提供资源的Azure服务(例如微软。提供计算实例计算机)。</p><p id="78b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看<a class="ae kc" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-overview" rel="noopener ugc nofollow" target="_blank">关于资源组和相关概念的官方文档</a>。</p><h2 id="4cc8" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">设置默认位置</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="8004" class="mw lc iq mh b gy nr ns l nt nu">az configure --defaults location=CanadaEast</span></pre><h2 id="4221" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">创建资源组</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="2682" class="mw lc iq mh b gy nr ns l nt nu">az group create -n my-resource-group</span></pre><p id="327c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">刚开始用Azure的时候要创建一个资源组。</p><h2 id="5c12" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">设置默认资源组</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="4810" class="mw lc iq mh b gy nr ns l nt nu">az configure --defaults group=my-resource-group</span></pre><h2 id="8b60" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">注册资源提供者</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="13a8" class="mw lc iq mh b gy nr ns l nt nu">az provider register -n Microsoft.Compute</span></pre><p id="9ea3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您第一次使用AKS时，这对于几个资源提供者可能是必要的。</p><h2 id="a661" class="mw lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">将默认输出格式设置为“<em class="nx">表格”</em>(默认为“<em class="nx">JSON”</em>)</h2><pre class="nj nk nl nm gt nn mh no np aw nq bi"><span id="8688" class="mw lc iq mh b gy nr ns l nt nu">az configure -o table</span></pre><p id="9934" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这会将所有命令的默认输出格式设置为人类可读的格式。</p></div></div>    
</body>
</html>