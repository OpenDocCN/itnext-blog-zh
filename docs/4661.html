<html>
<head>
<title>Swift iOS BackgroundTasks framework — Background App Refresh in 4 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift iOS后台任务框架—后台应用程序更新分4步进行</h1>
<blockquote>原文：<a href="https://itnext.io/swift-ios-13-backgroundtasks-framework-background-app-refresh-in-4-steps-3da32e65bc3d?source=collection_archive---------0-----------------------#2020-08-18">https://itnext.io/swift-ios-13-backgroundtasks-framework-background-app-refresh-in-4-steps-3da32e65bc3d?source=collection_archive---------0-----------------------#2020-08-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/8c671830b30f07dac1f62b20e1215b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJr-kWg3hqwwReiQKZ37mQ.png"/></div></div></figure><p id="b7e4" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated"><span class="l lb lc ld bm le lf lg lh li di"> I </span> OS允许app刷新it内容，即使是发送到后台。iOS可以智能地研究用户的行为，并在日常使用之前安排后台任务。当应用程序恢复到前台时，从其服务器检索最新信息并显示给用户是有用的。比如社交媒体应用(脸书，Instagram &amp; WhatsApp)和新闻应用。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj lj"><img src="../Images/9653320f4ab3910f297d5c9e8cd75456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1CP9_J0szc88pKo--wPQg.png"/></div></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">前台和后台任务的说明；复制自WWDC 2019演示幻灯片</figcaption></figure><p id="b8e9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">从iOS 13开始，苹果增加了一个新的框架——<strong class="ke iv">background tasks</strong>——处理iOS和app端之间的后台任务请求。<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgapprefreshtask" rel="noopener ugc nofollow" target="_blank">BGAppRefreshTask</a>&amp;<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgprocessingtask" rel="noopener ugc nofollow" target="_blank">BGProcessingTask</a>是两种可用的后台任务类型。BGAppRefreshTask可以有<strong class="ke iv"> 30秒</strong>来完成它的工作，BGProcessingTask可以有<strong class="ke iv">一分多钟</strong>。对于旧的<a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623125-application" rel="noopener ugc nofollow" target="_blank">应用(_:performFetchWithCompletionHandler:)</a>方式，处理方式有所不同。</p><p id="14e9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">后台任务的执行取决于几个条件，包括:</p><ol class=""><li id="181d" class="lt lu iu ke b kf kg kj kk kn lv kr lw kv lx kz ly lz ma mb bi translated">“后台应用程序刷新”的用户权限</li><li id="ba22" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">充电器供电</li><li id="4295" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">网络连接</li></ol><p id="cc8b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">让我们看看如何设置后台应用程序刷新，并了解使用它的细节！</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="2c0c" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">后台应用更新的4个步骤</h1><h2 id="e697" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤1)为应用程序目标启用后台模式</h2><p id="4b78" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">如果分别使用了<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgapprefreshtask" rel="noopener ugc nofollow" target="_blank"> BGAppRefreshTask </a>和<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgprocessingtask" rel="noopener ugc nofollow" target="_blank"> BGProcessingTask </a>，则进入app target的<strong class="ke iv">后台模式</strong>会话，检查<strong class="ke iv">后台获取</strong>和<strong class="ke iv">后台处理</strong>选项。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/f485b21dd8f2608052d86b8ec2c3a145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kElplkWQeUuWf0Ua1Rb9hw.png"/></div></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">应用程序目标的功能会话</figcaption></figure><h2 id="ed78" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤2)添加“<strong class="ak">允许的后台任务调度程序标识符</strong></h2><p id="c148" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">转到<code class="fe oe of og oh b">info.plist</code>并添加“<strong class="ke iv">允许的后台任务计划程序标识符</strong>属性，其标识符为<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgapprefreshtaskrequest" rel="noopener ugc nofollow" target="_blank">BGAppRefreshTaskRequest</a>和<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgprocessingtaskrequest" rel="noopener ugc nofollow" target="_blank">BGProcessingTaskRequest</a>。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oi"><img src="../Images/4348d182b389c2156f054564f2619933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tWav_TgsSqlmHKRd8RiOA.png"/></div></div><figcaption class="lo lp gk gi gj lq lr bd b be z dk translated">属性列表模式</figcaption></figure><h2 id="25fb" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤3)注册调度器任务标识符</h2><p id="2482" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">用上一步定义的标识符和后台任务触发时执行的完成处理程序将调度程序任务注册到<code class="fe oe of og oh b">BGTaskScheduler</code>。</p><blockquote class="oj ok ol"><p id="8f64" class="kc kd om ke b kf kg kh ki kj kk kl km on ko kp kq oo ks kt ku op kw kx ky kz in bi translated">根据<a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgtaskscheduler" rel="noopener ugc nofollow" target="_blank">官方文档</a>，<code class="fe oe of og oh b">BGTaskRequest</code>的启动处理程序应该在app启动序列结束前注册，即<a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application" rel="noopener ugc nofollow" target="_blank">应用(_:didFinishLaunchingWithOptions:)</a>。</p></blockquote><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure><blockquote class="oj ok ol"><p id="2f93" class="kc kd om ke b kf kg kh ki kj kk kl km on ko kp kq oo ks kt ku op kw kx ky kz in bi translated">相同任务标识符的重复注册会导致iOS终止应用程序！！以下是错误消息:</p></blockquote><pre class="lk ll lm ln gu os oh ot ou aw ov bi"><span id="c7ea" class="nm mp iu oh b gz ow ox l oy oz">*** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'Launch handler for task with identifier com.example.fooBackgroundAppRefreshIdentifier has already been registered'</span></pre><h2 id="30b6" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤4)将<code class="fe oe of og oh b">BGTaskRequest</code>提交给<code class="fe oe of og oh b">BGTaskScheduler</code></h2><p id="891a" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">提交一个<code class="fe oe of og oh b">BGTaskRequest</code>会抛出以下异常:</p><ol class=""><li id="1bc1" class="lt lu iu ke b kf kg kj kk kn lv kr lw kv lx kz ly lz ma mb bi translated"><code class="fe oe of og oh b">BGTaskSchedulerErrorCodeUnavailable</code> <br/>用户在应用设置页面禁用了“后台应用刷新”选项</li><li id="3c06" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated"><code class="fe oe of og oh b">BGTaskSchedulerErrorCodeTooManyPendingTaskRequests</code> <br/>一次可以调度1个刷新任务和10个处理任务。</li><li id="3ad9" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated"><code class="fe oe of og oh b">BGTaskSchedulerErrorCodeNotPermitted<br/></code>在app功能的后台模式会话中，不检查相应的<strong class="ke iv">“后台获取”</strong>或<strong class="ke iv">“后台处理”</strong>。</li></ol><p id="99ba" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">以下是<code class="fe oe of og oh b">BGAppRefreshTaskRequest</code>的代码:</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="946f" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">模拟BGTask</h1><p id="3aad" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">在开发过程中，等待iOS触发<code class="fe oe of og oh b">BGTask</code>是一项繁琐的工作，因为iOS控制<code class="fe oe of og oh b">BGTask</code>的确切触发时间，以优化设备性能。因此，Apple提供了以下命令(<code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/starting_and_terminating_tasks_during_development" rel="noopener ugc nofollow" target="_blank">simulateLaunchForTaskWithIdentifier</a></code> <a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/starting_and_terminating_tasks_during_development" rel="noopener ugc nofollow" target="_blank"> &amp; </a> <code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/starting_and_terminating_tasks_during_development" rel="noopener ugc nofollow" target="_blank">simulateExpirationForTaskWithIdentifier</a></code>)来模拟和终止一个<code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgtask" rel="noopener ugc nofollow" target="_blank">BGTask</a></code>:</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure><blockquote class="oj ok ol"><p id="a4ed" class="kc kd om ke b kf kg kh ki kj kk kl km on ko kp kq oo ks kt ku op kw kx ky kz in bi translated">这些命令不是Swift代码，只能在Xcode终端上执行。按照以下步骤触发Xcode中的<code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/backgroundtasks/bgtask" rel="noopener ugc nofollow" target="_blank">BGTask</a></code>:</p></blockquote><h2 id="0b8c" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤1:在将BGTask提交给BGTaskScheduler后，随时暂停应用程序</h2><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pa"><img src="../Images/6593158f26c7e2b34e5ed4649631898b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2E_jY2S4Gp0u8yk2hXbhDQ.png"/></div></div></figure><h2 id="4a9a" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">步骤2:在Xcode终端运行命令</h2><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pb"><img src="../Images/6b384b84ac24e45baa81c772b73dc9ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tEGqF755zNkqbOe5UGmaA.png"/></div></div></figure><h2 id="38c3" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">第三步:恢复你的应用程序</h2><p id="7375" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">您可以看到，注册的BGTask的完成处理程序随后被触发。</p><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pc"><img src="../Images/a7aa7428efc082b73f8c96635220d098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2eKustqn-Z7aAlCVRFHYsA.png"/></div></div></figure></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="cd42" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">BGAppRefreshTask与BGProcessingTask</h1><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure><h2 id="fbd9" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated"><code class="fe oe of og oh b">Property: expirationHandler</code></h2><p id="39fc" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated"><code class="fe oe of og oh b">BGTask</code>最重要的属性是<code class="fe oe of og oh b">expirationHandler</code>。当<code class="fe oe of og oh b">BGTask</code>由于超时或其他问题而必须被系统终止时，iOS将调用这个回调函数。</p><h2 id="e6bc" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">函数:setTaskCompleted(成功: )</h2><p id="003e" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">这是一个重要的功能，它通知后台任务调度程序任务已经完成。开发者应该尽快调用这个函数，因为额外的电池电量会被消耗，一旦所有后台任务完成，iOS就会暂停应用程序！</p><h2 id="c62d" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">比较:用法</h2><p id="4353" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated"><code class="fe oe of og oh b">BGAppRefreshTask</code>用于更新少量信息，例如从服务器获取最新的股票价格和新闻。发送到后台后，持续时间限制在<strong class="ke iv"> 30s </strong>左右。</p><p id="5e5d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe oe of og oh b">BGProcessingTask</code>用于执行耗时的加工。BGProcessingTask的时间可以从<strong class="ke iv">到分钟</strong>！然而，处理任务仅在设备<strong class="ke iv">空闲</strong>时运行。当用户<strong class="ke iv">开始使用设备</strong>时，系统终止任何正在运行的后台处理任务。后台刷新任务不受影响。因此，有必要为上一节介绍的<code class="fe oe of og oh b">BGTask</code>对象设置<code class="fe oe of og oh b">expirationHandler</code>。只要用户在过去一周内使用过你的应用程序，系统将在接下来的两天内尽力满足该请求。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="cb34" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">BGAppRefreshTaskRequest和BGProcessingTaskRequest</h1><h2 id="e755" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">普通字段)<code class="fe oe of og oh b">earliestBeginDate</code></h2><p id="1c3a" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">它表示应该执行此任务的最早日期。然而，<strong class="ke iv">最早日期不等于确切日期</strong>。iOS不保证任务将在最早的日期开始，并且可以延迟电源优化和应用程序使用模式的后台任务。</p><h2 id="59f8" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">BGProcessingTaskRequest —配置1)需要网络连接</h2><p id="e1c9" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">指示此后台进程是否需要网络连接。默认值为false。</p><h2 id="8bb4" class="nm mp iu bd mq nn no dn mu np nq dp my kn nr ns nc kr nt nu ng kv nv nw nk nx bi translated">BGProcessingTaskRequest —配置2)需要外部电源</h2><p id="e06d" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">指示此后台进程是否要求设备连接到外部电源。只有当任务是资源密集型的，以最小化对电池寿命的影响时，才设置为真。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="dacb" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">监控后台应用刷新授权</h1></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><figure class="lk ll lm ln gu jv gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/8f8d2979982ac10994b89b6d379b9da4.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*ppc8nUGMmA1o92e3.png"/></div></figure><p id="41cc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用户拥有启用/禁用<strong class="ke iv">“后台应用刷新”</strong>的最终权限，即使网络和电池状况都处于良好水平。如果后台应用程序刷新是一项关键功能，开发人员应监控相应的授权，并将用户重定向到设置应用程序。</p><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure><p id="f2fc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们可以使用<code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplication/1622994-backgroundrefreshstatus" rel="noopener ugc nofollow" target="_blank">UIApplication.shared.backgroundRefreshStatus</a></code>来获取后台App刷新的当前授权状态。有三种可能的值:</p><ol class=""><li id="d9b3" class="lt lu iu ke b kf kg kj kk kn lv kr lw kv lx kz ly lz ma mb bi translated"><code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/available" rel="noopener ugc nofollow" target="_blank">available</a></code>—用户已启用后台应用刷新功能。这是首次安装应用程序时的默认值。</li><li id="1107" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated"><code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/denied" rel="noopener ugc nofollow" target="_blank">denied</a></code> —用户已明确禁用后台应用刷新功能。我们可以将用户重定向到应用程序设置页面，用代码<code class="fe oe of og oh b">UIApplication.shared.open(URL(string: UIApplication.openSettingsURLString)!)</code>切换回状态。</li><li id="f29f" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated"><code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/uikit/uibackgroundrefreshstatus/restricted" rel="noopener ugc nofollow" target="_blank">restrict</a></code> —由于帐户限制，例如家长控制，用户无法切换后台刷新状态</li></ol><h1 id="0c76" class="mo mp iu bd mq mr pe mt mu mv pf mx my mz pg nb nc nd ph nf ng nh pi nj nk nl bi translated">监控授权状态的变化</h1><figure class="lk ll lm ln gu jv"><div class="bz fq l di"><div class="oq or l"/></div></figure><p id="1124" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用户更改后台应用刷新状态后，可以通过观察<code class="fe oe of og oh b"><a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplication/1623085-backgroundrefreshstatusdidchange" rel="noopener ugc nofollow" target="_blank">UIApplication.backgroundRefreshStatusDidChangeNotification</a></code>通知来通知应用。这可用于向用户显示任何弹出对话框，以解释后台应用刷新对应用流的用途和重要性。</p></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="c1eb" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">摘要</h1><ol class=""><li id="f316" class="lt lu iu ke b kf ny kj nz kn pj kr pk kv pl kz ly lz ma mb bi translated">只有当用户启用“后台应用刷新”时，才能执行后台任务。</li><li id="2810" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">后台任务标识符必须添加到<code class="fe oe of og oh b">info.plist</code>中的“<strong class="ke iv">允许的后台任务调度程序标识符”</strong>字段</li><li id="1b4d" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated"><code class="fe oe of og oh b">BGAppRefreshTask</code> can有30s，<code class="fe oe of og oh b">BGProcessingTask</code>有1分多钟完成其后台任务。</li><li id="fa3c" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">任何时候都可以安排总共1个刷新任务和10个处理任务。</li><li id="f9ff" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">任务标识符的注册应在应用程序使用选项<a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application" rel="noopener ugc nofollow" target="_blank">应用程序(_:didfinesslaunchingwithoptions:)</a>完成启动之前完成</li><li id="498c" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">相同任务标识符的重复注册会导致iOS终止您的应用程序。</li><li id="0e1b" class="lt lu iu ke b kf mc kj md kn me kr mf kv mg kz ly lz ma mb bi translated">已经触发的后台任务以后不能再次触发。必须再次重新提交/重新安排。</li></ol></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="100e" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">你可能喜欢的东西:</h1><p id="2d57" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">如果您必须使用运行iOS 12或更低版本的设备来支持用户，请使用<a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623125-application" rel="noopener ugc nofollow" target="_blank">应用程序(_:performFetchWithCompletionHandler:)</a>和<a class="ae ls" href="https://developer.apple.com/documentation/uikit/uiapplication/1623100-setminimumbackgroundfetchinterva" rel="noopener ugc nofollow" target="_blank">setMinimumBackgroundFetchInterval(:_)</a>来代替。您可以在下面找到更多信息:</p><div class="pm pn gq gs po pp"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-ios-background-app-refresh-in-3-steps-cadac5733c1e"><div class="pq ab fp"><div class="pr ab ps cl cj pt"><h2 class="bd iv gz z fq pu fs ft pv fv fx it bi translated">Swift iOS后台应用程序3步刷新</h2><div class="pw l"><h3 class="bd b gz z fq pu fs ft pv fv fx dk translated">iOS允许应用程序定期刷新其内容，即使它被发送到后台。有多少限制…</h3></div><div class="px l"><p class="bd b dl z fq pu fs ft pv fv fx dk translated">itnext.io</p></div></div><div class="py l"><div class="pz l qa qb qc py qd ka pp"/></div></div></a></div></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><h1 id="0e0c" class="mo mp iu bd mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl bi translated">参考和进一步阅读:</h1><p id="bd47" class="pw-post-body-paragraph kc kd iu ke b kf ny kh ki kj nz kl km kn oa kp kq kr ob kt ku kv oc kx ky kz in bi translated">1.WWDC 2019会议<a class="ae ls" href="https://developer.apple.com/videos/play/wwdc19/707/" rel="noopener ugc nofollow" target="_blank">707:App后台执行的进步</a>样本代码。</p><div class="pm pn gq gs po pp"><a href="https://developer.apple.com/documentation/backgroundtasks/refreshing_and_maintaining_your_app_using_background_tasks" rel="noopener  ugc nofollow" target="_blank"><div class="pq ab fp"><div class="pr ab ps cl cj pt"><h2 class="bd iv gz z fq pu fs ft pv fv fx it bi translated">Apple开发者文档</h2><div class="pw l"><h3 class="bd b gz z fq pu fs ft pv fv fx dk translated">WWDC 2019</h3></div><div class="px l"><p class="bd b dl z fq pu fs ft pv fv fx dk translated">developer.apple.com</p></div></div></div></a></div><p id="e80f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">2.背景任务框架官方文档</p><p id="9ecc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">后台任务| Apple开发者文档</p><div class="pm pn gq gs po pp"><a href="https://developer.apple.com/documentation/backgroundtasks" rel="noopener  ugc nofollow" target="_blank"><div class="pq ab fp"><div class="pr ab ps cl cj pt"><h2 class="bd iv gz z fq pu fs ft pv fv fx it bi translated">Apple开发者文档</h2><div class="pw l"><h3 class="bd b gz z fq pu fs ft pv fv fx dk translated">后台任务| Apple开发者文档</h3></div><div class="px l"><p class="bd b dl z fq pu fs ft pv fv fx dk translated">developer.apple.com</p></div></div></div></a></div></div><div class="ab cl mh mi hy mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="in io ip iq ir"><p id="f4b5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">欢迎您在<a class="ae ls" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ myrik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>