<html>
<head>
<title>OpenShift Service Mesh essentials — Part II — Control Plane</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenShift服务网格基础—第二部分—控制平面</h1>
<blockquote>原文：<a href="https://itnext.io/openshift-service-mesh-essentials-part-ii-control-plane-9c76a35936b5?source=collection_archive---------2-----------------------#2020-10-13">https://itnext.io/openshift-service-mesh-essentials-part-ii-control-plane-9c76a35936b5?source=collection_archive---------2-----------------------#2020-10-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5811bc69ab8d84ca5bb5dcff5b4fc55d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UUWbvmpDwINXZl3kLok0vA.jpeg"/></div></div></figure><p id="cb52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在第二篇文章中，我们将介绍OpenShift服务网格控制平面的准备和部署。您将看到在部署您的服务网格控制平面时使用的不同配置选项，包括您应该如何为生产环境设置它(剧透:这不是默认配置)，以及如何在您的OpenShift集群中部署它们。</p><p id="c2ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将尝试包含比当前官方<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/welcome/index.html" rel="noopener ugc nofollow" target="_blank"> OpenShift文档</a>更多的信息，但本文的大部分内容都可以在那里找到。我将添加一些您可能会觉得有用的屏幕截图和具体示例，我们还将回顾一下运营商在您的集群中安装和配置了什么。</p><p id="29f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您错过了简介，您可以在此回顾服务网格存在的原因，请在此处查看:</p><div class="kx ky gp gr kz la"><a href="https://medium.com/@luis.ariz/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">open shift Service Mesh essentials—第一部分—原因和内容</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">在这第一篇文章中，我们将讨论一些关于OpenShift服务网格的介绍性问题，包括它的特性…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jw la"/></div></div></a></div><p id="d6dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者你也可以直接跳到下面的文章，如果你对那些文章更感兴趣的话:</p><div class="kx ky gp gr kz la"><a href="https://luis-javier-arizmendi-alonso.medium.com/openshift-service-mesh-essentials-part-iii-data-plane-341ce477c269" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">OpenShift服务网格基础—第三部分—数据平面</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">在本文中，我们将通过展示一个应用程序部署来探索OpenShift服务网格数据平面…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">luis-javier-arizmendi-alonso.medium.com</p></div></div><div class="lj l"><div class="lp l ll lm ln lj lo jw la"/></div></div></a></div><p id="86e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者开始检查服务网格功能:</p><div class="kx ky gp gr kz la"><a href="https://luis-javier-arizmendi-alonso.medium.com/openshift-service-mesh-essentials-part-iv-features-routing-3189dae64615" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">OpenShift服务网格基础—第四部分—功能:路由</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">了解如何使用高级路由来修改应用程序的行为，而不包括API网关或…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">luis-javier-arizmendi-alonso.medium.com</p></div></div><div class="lj l"><div class="lq l ll lm ln lj lo jw la"/></div></div></a></div><h1 id="30eb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">OpenShift服务网格安装和使用与上游ISTIO不同吗？</h1><p id="4c51" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@luis.ariz/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener">在本系列文章的第一部分</a>中，您已经看到了OpenShift服务网格如何使用上游ISTIO项目作为主要组件。现在，您可能想知道是否有任何定制使安装或使用变得不同。如果您将OpenShift服务网格与默认的ISTIO上游部署进行比较，就会发现在某些方面存在差异(<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/service_mesh/service_mesh_arch/ossm-vs-community.html" rel="noopener ugc nofollow" target="_blank">此处</a>您可以找到更多详细信息):</p><ul class=""><li id="b5bf" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">安装:上游<a class="ae kw" href="https://istio.io/latest/docs/setup/install/" rel="noopener ugc nofollow" target="_blank"> ISTIO有多种安装方式</a>，其中之一是<a class="ae kw" href="https://istio.io/latest/docs/setup/install/operator/" rel="noopener ugc nofollow" target="_blank">基于操作员的安装</a>，它简化了ISTIO部署的生命周期管理。这也是OpenShift用来部署服务网格的模式，但是在ISTIO upstream中，您使用<code class="fe nd ne nf ng b">istioctl</code>客户端，而在OpenShift中，您将使用<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/operators/understanding/olm/olm-understanding-olm.html" rel="noopener ugc nofollow" target="_blank">操作员生命周期管理器</a>和<a class="ae kw" href="https://operatorhub.io/" rel="noopener ugc nofollow" target="_blank">操作员中心</a>来安装和管理操作员。</li><li id="c309" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">多租户:默认情况下，上游ISTIO部署不是多租户的，尽管您可以按照一些步骤部署它以获得一些软多租户。相比之下，当您在OpenShift中部署服务网格时，您将默认获得ISTIO的多租户设置，如下所示。</li><li id="3b97" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">Sidecar注入:Upstream Istio默认安装会自动将sidecar注入到您已标记的项目内的pod中，但是OpenShift服务网格要求您指定一个注释。这使得精细选择哪些服务将被包括在网格中成为可能。</li><li id="4613" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">伊斯迪奥·RBAC:OpenShift服务网格提供了所有上游RBAC的可能性，而且通过使用正则表达式扩展了匹配请求头的能力，我们将在开始使用open shift服务网格功能时看到这一点。</li><li id="7c17" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">SSL库:OpenShift服务网格用OpenSSL替换了BoringSSL。</li><li id="7072" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">网络配置:Red Hat OpenShift服务网格包括CNI插件，它为您提供了配置应用程序pod网络的替代方法。CNI插件取代了<code class="fe nd ne nf ng b">init-container</code>网络配置，不再需要授予服务帐户和项目访问安全上下文约束(SCC)的特权。当Multus的二级接口被配置时，这个CNI插件的使用也有影响，我们将在本系列博客的“数据平面”部分看到。</li><li id="69d4" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">不支持的功能(OpenShift 4.5): OpenShift服务网格不支持基于QUIC的服务和秘密发现服务(SDS)功能的使用。它也不支持包含外部元素(即虚拟机)。</li></ul><h1 id="1caa" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">如何在OpenShift中安装服务网格？</h1><p id="ad39" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">安装OpenShift Service Mesh有两种不同的方法:使用Web控制台或使用CLI。在本文中，我们将使用Web控制台，但是如果您想查看一些CLI提示和技巧，我建议您看一看<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/security-zones-in-openshift-worker-nodes-part-i-introduction-4f85762962d7">“open shift worker nodes中的安全区域”博客系列</a>。</p><p id="0e73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你<a class="ae kw" href="https://medium.com/@luis.ariz/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener">还记得第一部分的话，</a> OpenShift服务网格包含多个部分，包括ISITO、Jaeger、Kiali、Prometheus和Grafana。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/d634cd91c351219e78fd23ddfb118122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lS_B7zgif4ERJJi3.png"/></div></div></figure><p id="b364" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢<a class="ae kw" href="https://www.openshift.com/learn/topics/operators" rel="noopener ugc nofollow" target="_blank">运营商</a>的部署和生命周期管理(即更新)非常容易，而且由于OpenShift <a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/operators/understanding/olm/olm-understanding-olm.html" rel="noopener ugc nofollow" target="_blank">运营商生命周期管理器</a>和<a class="ae kw" href="https://operatorhub.io/" rel="noopener ugc nofollow" target="_blank">运营商中心</a>，用户体验比寻找上游运营商并手动部署它们要好得多。</p><p id="b187" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看看安装OpenShift服务网格的步骤</p><h2 id="8ddf" class="nr ls iq bd lt ns nt dn lx nu nv dp mb kj nw nx mf kn ny nz mj kr oa ob mn oc bi translated">1.安装所需的操作器</h2><p id="5fee" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">在我们的例子中，在OpenShift 4.5中(将来可能会被简化)，我们将不得不部署(作为<em class="od"> cluster-admin </em>用户)一些操作符，作为安装OpenShift服务网格操作符之前的先决条件。如果您想获得支持，请不要安装“社区”版本的操作系统):</p><p id="011c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在操作期间保持默认选择的选项。您可能希望选择手动更新，以确保运营商不会升级服务，直到有人手动启动升级，如果您认为这可能意味着更稳定的环境。</p><ol class=""><li id="941b" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv oe na nb nc bi translated">Elasticsearch operator:将托管Jaeger数据。</li></ol><blockquote class="of og oh"><p id="04c8" class="jy jz od ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">注意:如果您查看<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/service_mesh/v1x/installing-ossm.html#jaeger-operator-install-elasticsearch_installing-ossm-v1x" rel="noopener ugc nofollow" target="_blank">官方文档</a>，其中显示的步骤提到该操作符应安装在<em class="iq"> openshift-operators-redhat名称空间</em>中，但是<em class="iq"> </em>我发现仅在<em class="iq">open shift-operators-red hat</em>名称空间中安装elasticsearch而不是在所有名称空间中安装可能意味着，如果您想要部署Jaeger模板“production-elasticsearch”(如下所述)，您将面临Jaeger部署的问题，因为elasticsearch集群尚未创建(可能是因为控制平面名称空间没有访问权限如果您在所有命名空间中安装此运算符，此问题会消失，但也可以通过安装文档中提到的，但在控制平面命名空间上添加一些额外权限来解决</p></blockquote><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/230a6a48cb0cb5ee484c8854e6786338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8xzii4UZAY2VFCZ_jqVDUQ.gif"/></div></div></figure><p id="02ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.耶格操作员:将提供追踪功能。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/d14cc892a2254009e1a6f30d1a9ab203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*i_c5STHYt-BLSVKqA-BUsA.gif"/></div></div></figure><p id="6c93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.Kiali操作员:将为ISTIO系统提供网络控制台。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/524a2ff304d320067d46de0084277305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qYEYsHIdXNIkSiTXUqN9OA.gif"/></div></div></figure><p id="d3a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为必须为所有名称空间安装操作符，所以操作符窗格将位于"<em class="od"> openshift-operators </em>"名称空间中，您可以检查它们是否已经部署并正在运行:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/a283cea338d62dd6e3af14ad3684463e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qV9zhazSOwR5myVPDz59kw.gif"/></div></div></figure><p id="1e02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦部署了预先需要的操作符，就可以部署OpenShift服务网格操作符(缺省值是OK的):</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/7af078c930c43940de30825bd0c1aff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Wgs8Ubkr4CWbZLDK-6fQlA.gif"/></div></div></figure><p id="0f36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个OpenShift服务网格操作器是从<a class="ae kw" href="https://maistra.io/" rel="noopener ugc nofollow" target="_blank">上游Maistra项目</a>中产品化出来的。操作员配置ISTIO(和其余组件),这在前面的章节中已经描述过(即多租户部署)</p><h2 id="8d05" class="nr ls iq bd lt ns nt dn lx nu nv dp mb kj nw nx mf kn ny nz mj kr oa ob mn oc bi translated">2.准备OpenShift服务网格控制平面配置</h2><p id="a2bc" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">我们已经安装了操作符，但是操作符并不提供他们自己“管理”的服务，操作符提供了<a class="ae kw" href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/" rel="noopener ugc nofollow" target="_blank">自定义资源定义</a>(cdr)来扩展Kubernetes API，并使得以一种简单的方式部署实际的服务成为可能。</p><p id="ab2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，我们已经部署了“Jaeger Operator ”,但我们仍然没有在OpenShift集群上运行Jaeger，我们已经部署了Openshift服务网格Operator，但我们甚至还没有部署任何ISTIO控制平面组件。</p><p id="e61b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们有一些好消息，你不必使用他们的运营商逐个部署服务(Elasticsearch，Jaeger，Kiali，Prometheus，Grafana，ISTIO)，你只需部署一个“服务网格”控制平面，一切都会自动完成。</p><p id="183d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在部署服务网格控制平面之前，仍然有两个先决条件必须满足。</p><p id="6a1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个是您必须创建一个OpenShift项目(Kubernetes名称空间),您将在其中部署pod。在大多数OpenShift文档中，您会发现项目被命名为“istio-system ”,但是您可以在任何项目中部署控制平面。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/8cfbd4c92b3d797d37892993b4fce444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cjxY7gCuwlCDC2pKkHrW5Q.gif"/></div></div></figure><blockquote class="of og oh"><p id="2779" class="jy jz od ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">注意:如果您计划安装多个控制平面，您需要考虑到每个名称空间/项目只能部署一个OpenShift服务网格控制平面。在我们的示例中，我们将使用两个控制平面，因此我还创建了第二个名称空间“istio-system-b”来托管第二个名称空间。</p></blockquote><p id="2795" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二个先决条件是您需要控制平面配置。</p><p id="9182" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您尝试部署OpenShift服务网格控制平面时，您将看到一个默认的"<em class="od">基本-安装</em> " <em class="od">服务网格控制计划</em>对象(旨在用作实验室环境，而非生产环境)。如果您想查看此配置，您可以执行控制面板安装步骤，但…无需按“创建”按钮。</p><p id="5b91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，如果您这样做了，您会发现默认情况下表单视图(从OpenShift 4.5开始)是在配置中进行一些更改的一种简单方法，但遗憾的是并没有显示所有选项，因此您需要更改为YAML视图:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/55838e8779a2160b57419161db2af070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1e68KEWleToXBVouxGRwcA.gif"/></div></div></figure><p id="4226" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用尝试部署控制面板时出现的默认配置(用于实验室，而不是我们将看到的生产)，但在这里，我们将探索一些我们可以使用的选项。</p><p id="f903" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于“默认”概念的一个注意事项。这个“<em class="od">基本安装</em>”默认对象并不强制执行与操作符相同的“默认值”，这意味着，对于某些值，如果您不包含任何配置，您会发现操作符的默认值(因此在这种情况下会使用的值)与您在“<em class="od">基本安装</em>”默认对象中找到的值不同。 例如，<em class="od"> traceSampling </em>变量默认为1(运算符)，但在您尝试部署控制平面时发现的“<em class="od"> basic-install </em>”默认对象中为100。</p><p id="9fa1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，当我提到“默认值”时，我指的是操作符默认值，而不是"<em class="od">basic-install</em>"<em class="od">ServiceMeshControlPlane</em>对象，您可以在下面找到它的配置(OpenShift 4.5)，您将看到它如何覆盖一些Maistra操作符默认值:</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="20e2" class="nr ls iq ng b gy ot ou l ov ow">apiVersion: maistra.io/v1<br/>kind: ServiceMeshControlPlane<br/>metadata:<br/>  name: basic-install<br/>  namespace: &lt;selected namespace&gt;<br/>spec:<br/>  version: v1.1<br/>  istio:<br/>    gateways:<br/>      istio-egressgateway:<br/>        autoscaleEnabled: false<br/>      istio-ingressgateway:<br/>        autoscaleEnabled: false<br/>        ior_enabled: false<br/>    mixer:<br/>      policy:<br/>        autoscaleEnabled: false<br/>      telemetry:<br/>        autoscaleEnabled: false<br/>    pilot:<br/>      autoscaleEnabled: false<br/>      traceSampling: 100<br/>    kiali:<br/>      enabled: true<br/>    grafana:<br/>      enabled: true<br/>    tracing:<br/>      enabled: true<br/>      jaeger:<br/>        template: all-in-one</span></pre><p id="2f9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于操作变量，您可以<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/service_mesh/service_mesh_install/customizing-installation-ossm.html#customize-installation-ossm" rel="noopener ugc nofollow" target="_blank">查看文档</a>中所有支持的值。我将使用您可以在该文档中找到的相同结构，浏览不同的部分，但我会尝试澄清一些变量。</p><p id="e083" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">全局</strong></p><p id="473b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="aca1" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>  global:<br/>    disablePolicyChecks: true<br/>    policyCheckFailOpen: false<br/>    hub: registry.redhat.io/openshift-service-mesh/<br/>    tag: 1.1.0<br/>    proxy:<br/>      resources:<br/>        requests:<br/>          cpu: 10m<br/>          memory: 128Mi<br/>        limits:<br/>          cpu: 2000m<br/>          memory: 1024Mi<br/>    mtls:<br/>      enabled: false<br/>...</span></pre><ul class=""><li id="ee9e" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">禁用策略检查</li></ul><p id="fe51" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该参数启用/禁用<a class="ae kw" href="https://istio.io/latest/docs/reference/config/policy-and-telemetry/" rel="noopener ugc nofollow" target="_blank">混合器的策略执行</a>。正如我们在<a class="ae kw" href="https://medium.com/@luis.ariz/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener">这个博客系列的第一部分</a>中所评论的，在新的ISTIO架构中，Mixer被弃用，Mixer提供的功能被转移到了Envoy代理中。虽然Maistra 1.x尚未部署Istiod和新架构(这将由2.0版完成，可能会与OpenShift 4.6保持一致)，但政策和遥测功能的变化已在一段时间前开始。</p><p id="d040" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您查看与最新版本上的上游策略特性相关的<a class="ae kw" href="https://istio.io/latest/docs/tasks/policy-enforcement/" rel="noopener ugc nofollow" target="_blank">上游文档，您将会看到其中一些是如何被“否决”的。如果你输入其中的任何一个，你会看到新推荐的方式来提供相同的功能，但使用特使而不是混合器。请记住，Maistra部署的ISTIO版本不是最后一个，因此如果您检查上游文档，您应该</a><a class="ae kw" href="https://archive.istio.io/" rel="noopener ugc nofollow" target="_blank">检查正确的ISTIO版本</a>，而不是最新的版本。</p><p id="87fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想了解正在安装的Maistra版本中包含的ISTIO版本，您需要查看OpenShift发行说明。<a class="ae kw" href="https://docs.openshift.com/container-platform/4.3/service_mesh/servicemesh-release-notes.html#component-versions-included-in-red-hat-openshift-service-mesh-version-1-1-9" rel="noopener ugc nofollow" target="_blank">您可以在这里找到OpenShift 4.5和Maistra 1.1.9版本</a>的示例。如您所见，对于Maistra 1.1.9，ISTIO版本为1.4.10，因此您应该查看<a class="ae kw" href="https://istio.io/v1.4/docs/" rel="noopener ugc nofollow" target="_blank"> ISTIO 1.4上游文档</a>。在这里，您可以看到<a class="ae kw" href="https://istio.io/v1.4/docs/tasks/policy-enforcement/" rel="noopener ugc nofollow" target="_blank">您仍然可以使用基于Mixer </a>的“旧”策略特性。我们将在另一篇文章中讨论这个概念，并且我们将看到如果我们想要使用这个特性，我们必须如何<a class="ae kw" href="https://maistra.io/docs/troubleshooting/troubleshooting_policy/" rel="noopener ugc nofollow" target="_blank">启用它。</a></p><ul class=""><li id="c741" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">policyCheckFailOpen</li></ul><p id="c809" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如OpenShift文档中所述，此参数指示当无法到达混合器策略服务时，是否允许流量通过特使边车。默认值为false，这意味着当客户端无法连接到Mixer时，流量被拒绝。</p><ul class=""><li id="a605" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">中心</li></ul><p id="6837" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您计划在自己的注册表中托管ISTIO映像，请考虑此参数，例如，<a class="ae kw" href="https://access.redhat.com/articles/4740011" rel="noopener ugc nofollow" target="_blank">您可以在此处检查，</a>服务网格运营商支持<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/operators/admin/olm-restricted-networks.html" rel="noopener ugc nofollow" target="_blank">断开环境</a>，在这些情况下，注册表将是本地的，而不是在线默认注册表<em class="od"> quay.io </em>。</p><ul class=""><li id="41ec" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">标签</li></ul><p id="9411" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与“hub”变量相关，“tag”将用于了解从注册表中提取哪些ISTIO容器图像。</p><ul class=""><li id="3ccf" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">imagePullSecret(默认情况下不设置)</li></ul><p id="6ddd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与“hub”变量相关，如果注册表已经用凭证保护，您可以在这里分配拉秘密。你必须在这一个中使用它:</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="9de9" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>  global:<br/>...<br/>    imagePullSecrets:<br/>      - MyPullSecret<br/>...</span></pre><p id="fd02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解更多关于如何在OpenShift中使用拉取密码的信息，你可以查看文档。</p><ul class=""><li id="459a" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">代理人</li></ul><p id="45ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个小节，包含了特使代理的一些配置，更具体地说，您可以在sidecar容器中包含<a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/" rel="noopener ugc nofollow" target="_blank"> (Kubernetes)请求以及CPU和内存的限制</a>。</p><ul class=""><li id="6799" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">mtls</li></ul><p id="9c3b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果设置为“true ”,将在您的所有网格中强制执行相互传输层安全性(mTLS)通信。如果您的工作负载不与网格外部的服务通信，这是一种启用mTLS的简单方法(否则，您的通信将会中断，因为它将只接受加密连接)。如果您想微调mTLS在您的网格中的使用位置，您可以将该变量保持为“false ”,并为每个服务或名称空间配置mTLS的使用(在后续文章中可以看到)。</p><p id="6e18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">网关</strong></p><p id="de67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="faba" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  gateways:<br/>       istio-egressgateway:<br/>         autoscaleEnabled: true<br/>         autoscaleMin: 1<br/>         autoscaleMax: 5<br/>       istio-ingressgateway:<br/>         autoscaleEnabled: true<br/>         autoscaleMin: 1<br/>         autoscaleMax: 5<br/>         ior_enabled: false<br/>...</span></pre><ul class=""><li id="0242" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">istio-egressgateway</li></ul><p id="c51b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，您可以找到一个开关(<em class="od">autoscalenabled</em>)来启用/禁用自动缩放，以及两个附加变量来设置此控制平面的最大和最小网关数量。</p><ul class=""><li id="10fa" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">istio-Ingres网关</li></ul><p id="2d2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与istio-egressgateway中的相同，外加一个变量来启用/禁用IOR特性。IOR是Maistra控制平面的一个组件，它将Istio网关与OpenShift路由同步，当我们在后续文章中讨论这个路由同步时，会更好地理解这一点。</p><p id="bc71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在过去，它是默认启用的，但由于一些问题，它被禁用。现在这些问题都消失了，但是默认特性仍然是禁用的。</p><blockquote class="of og oh"><p id="2195" class="jy jz od ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">注意:还有更多(不太常见的)配置选项将在本系列的下一篇文章中与数据层一起讨论。</p></blockquote><p id="deb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">混合器</strong></p><p id="550b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="d611" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  mixer:<br/>    enabled: true<br/>    policy:<br/>      autoscaleEnabled: true<br/>      autoscaleMin: 1<br/>      autoscaleMax: 5<br/>    telemetry:<br/>      autoscaleEnabled: true<br/>      autoscaleMin: 1<br/>      autoscaleMax: 5<br/>      resources:<br/>        requests:<br/>          cpu: 10m<br/>          memory: 128Mi<br/>        limits:<br/>          cpu: 4800m<br/>          memory: 4G<br/>...</span></pre><ul class=""><li id="5c1c" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">使能够</li></ul><p id="323d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用该变量完全禁用混音器，包括指标(请记住，我们讨论的是带有发布版本&lt; 2.0, as you find in OpenShift 4.5 and previous releases, where a new architecture without Mixer will be deployed)</p><ul class=""><li id="7708" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">policy</li></ul><p id="ddf3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">You can enable/disable the autoscaling of the policy component of Mixer as we mentioned above while reviewing the defaults.</p><ul class=""><li id="a334" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">telemetry</li></ul><p id="7cbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Aside from enabling/disabling the autoscaling, you can also setup the QoS (requests/limits) for the telemetry Mixer containers.</p><p id="11b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> pilot </strong>的Maistra操作符</p><p id="ac01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="ff49" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  pilot:<br/>    resources:<br/>      requests:<br/>        cpu: 10m<br/>        memory: 128Mi<br/>    autoscaleEnabled: true<br/>    traceSampling: 1.0<br/>...</span></pre><ul class=""><li id="8505" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">资源</li></ul><p id="1489" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过Pilot PODs设置所需的CPU和内存。</p><ul class=""><li id="2ce3" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">自动缩放启用</li></ul><p id="317c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启用/禁用先导组件的自动缩放。</p><ul class=""><li id="5db8" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">示踪取样</li></ul><p id="f536" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">分布式跟踪使用户能够通过分布在多个服务中的网格来跟踪请求。这允许通过可视化更深入地理解请求延迟、序列化和并行性。Istio利用<a class="ae kw" href="https://www.envoyproxy.io/docs/envoy/v1.12.0/intro/arch_overview/observability/tracing" rel="noopener ugc nofollow" target="_blank"> Envoy的分布式跟踪</a>功能提供开箱即用的跟踪集成(Maistra部署Jaeger作为跟踪后端，在那里收集这些跟踪)。</p><p id="b90e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要从您的流量中获取跟踪，使用此参数，您可以决定从中获取多少样本。OpenShift服务网格默认值中的“<em class="od">基本安装</em>”ServiceMeshControlPlane默认对象为100(而实际的Maistra默认值为1.0)，这意味着对100%的流量进行采样。这对于开发或测试来说非常好，但在某些情况下(生产环境)，可能会发现收集了“太多的数据”(不仅要考虑存储，还要考虑Envoy代理消耗的CPU资源)，这也是为什么不将这个"<em class="od">basic-install</em>" ServiceMeshControlPlane默认对象用于生产的另一个原因。</p><p id="a1c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">基亚利</strong></p><p id="ff15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="705f" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  kiali:<br/>    enabled: true<br/>    dashboard:<br/>      viewOnlyMode: false<br/>    ingress:<br/>      enabled: true<br/>...</span></pre><ul class=""><li id="ef22" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">使能够</li></ul><p id="50df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">切换到启用/禁用ISTIO安装的Web用户界面。</p><ul class=""><li id="981b" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">仪表盘</li></ul><p id="5311" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kiali不仅“显示”当前配置和您的ISTIO服务网格中正在发生的事情，它还提供允许更改一些ISTIO特定配置的功能。Maistra提供了一个变量<em class="od"> viewOnlyMode </em>使这些特性被禁用，但是在OpenShift(至少在当前版本中)中，由于kiali与OpenShift SSO集成在一起，用户权限会覆盖Kiali提供的权限，因此用户将始终能够修改他们有权访问的对象。</p><p id="4661" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，仪表板下还有两个额外参数没有设置。</p><p id="3195" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个是“grafanaURL”变量。Kiali可以自动检测Grafana URL，但是如果您有自定义的Grafana安装，您可以使用此变量设置URL值，例如:</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="7b4f" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  kiali:<br/>...<br/>    dashboard:<br/>      viewOnlyMode: false<br/><strong class="ng ir">      grafanaURL:  "https://grafana-istio-system.ocp.domain.com"</strong><br/>...</span></pre><p id="60d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与grafana的情况一样，您也可以设置一个自定义Jaeger，并通过添加jaegerURL变量将URL包含在Kiali中:</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="636e" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  kiali:<br/>...<br/>    dashboard:<br/>      viewOnlyMode: false<br/><strong class="ng ir">      jaegerURL: "http://jaeger-query-istio-system.ocp.domain.com"</strong><br/>...</span></pre><ul class=""><li id="d035" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">进入</li></ul><p id="9196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您部署Kiali时，默认情况下会创建一个OpenShift路由，以便从OpenShift集群外部访问Kiali，但是您可以通过设置<em class="od"> enabled=false </em>来禁用此元素创建，这样Kiali将被安装，但它只能通过内部服务使用。</p><p id="f90a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">格拉夫纳</strong></p><p id="9b62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(OpenShift 4.5):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="12e3" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  grafana:<br/>     enabled: true<br/>...</span></pre><ul class=""><li id="21dd" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">使能够</li></ul><p id="f0d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启用/禁用Grafana的自动部署。理论上，您可以将此设置为禁用，并部署您自己的Grafana架构，然后将其与服务网格集成。但是如果您启用此选项，操作员会为您完成。</p><p id="414f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">追踪</strong></p><p id="b459" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值(Maistra 1.1):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="12cd" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  tracing:<br/>    enabled: true<br/>    ingress:<br/>      enabled: true<br/>    jaeger:<br/>      template: all-in-one<br/>...</span></pre><ul class=""><li id="834b" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">使能够</li></ul><p id="bb8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以启用/禁用跟踪功能。</p><ul class=""><li id="d6c4" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">进入</li></ul><p id="02b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如在Kiali一节中，您会发现这个变量使得不创建从OpenShift集群外部访问Jaeger的OpenShift路径成为可能</p><ul class=""><li id="3867" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">贼鸥</li></ul><p id="fb1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们有两个部署选项，默认的<code class="fe nd ne nf ng b">all-in-one</code>为Jaeger使用内存存储，另一个<code class="fe nd ne nf ng b">production-elasticsearch</code>选项旨在用于生产(这是唯一支持的在生产中部署它的方式)。</p><p id="edaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如上所述，默认使用<code class="fe nd ne nf ng b">all-in-one</code>模板，这样可以使用最少的资源完成安装(如果您正在部署一个生产环境，请记住更改这一点)。</p><p id="2628" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Jaeger部分，如果您将默认的"<em class="od"> all-in-one" </em>模板更改为"<em class="od">production-elasticsearch</em>"，您还可以在elasticsearch部分配置一些参数，在这里您可以定制相关的elastic search部署。您可以为elasticsearch PODs设置节点数(默认为1，但对于生产，您需要将其设置为3，用于HA)或QoS(对于生产用途，您应该为每个Pod默认分配不少于16Gi，但最好尽可能多分配，每个Pod最多64Gi和至少1个CPU)，这是一个带有默认参数的示例</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="a31f" class="nr ls iq ng b gy ot ou l ov ow">...<br/>istio:<br/>...<br/>  tracing:<br/>    enabled: true<br/>    ingress:<br/>      enabled: true<br/>    jaeger:<br/>      template: production-elasticsearch<br/>      elasticsearch:<br/>        nodeCount: 1<br/>        resources:<br/>          requests:<br/>            cpu: "500m"<br/>            memory: "1Gi"<br/>          limits:<br/>            cpu: ""<br/>            memory: ""<br/>...</span></pre><p id="d5cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">3刻度ISTIO适配器</strong></p><p id="6716" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不会在这一系列文章中涉及它，但<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/service_mesh/threescale_adapter/threescale-adapter.html" rel="noopener ugc nofollow" target="_blank">它确实存在一个用于3SCALE </a>的适配器，允许您将OpenShift服务网格与<a class="ae kw" href="https://www.redhat.com/en/technologies/jboss-middleware/3scale" rel="noopener ugc nofollow" target="_blank"> 3scale API管理解决方案</a>集成。您可以在控制平面配置描述符的“<em class="od"> threeScale </em>”部分设置所需的参数。</p><p id="63f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> sidecarInjectorWebhook </strong></p><p id="294b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您计划将Multus与服务网格一起使用，您会发现还有一个额外的配置很有用(请记住，Multus接口将在服务网格之外)。</p><p id="2294" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您想在使用Multus的pod中包含额外的接口时，您将需要添加一个注释，但是这些注释不会被automatic Envoy sidecar injector保存，它会用自己的注释覆盖它们。如果您想将该值与边车注射器引入的新注释一起保留，您可以通过将<code class="fe nd ne nf ng b">injectPodRedirectAnnot=true</code>变量添加到您的控制平面配置中来实现。</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="63ba" class="nr ls iq ng b gy ot ou l ov ow">...<br/>spec:<br/>  istio:<br/>    sidecarInjectorWebhook:<br/>      injectPodRedirectAnnot: true<br/>...</span></pre><h2 id="4a50" class="nr ls iq bd lt ns nt dn lx nu nv dp mb kj nw nx mf kn ny nz mj kr oa ob mn oc bi translated">3.部署OpenShift服务网格控制平面</h2><p id="522e" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">现在我们准备创建我们的控制平面。正如您将在下面看到的，我们将部署两个不同的控制平面，但是，为什么您希望在您的群集中有多个控制平面呢？嗯，您可能需要不同的人群，使用不同的控制平面配置，或者您可能只需要额外的多租户级别，因为在这种情况下，您还将拥有两个不同的数据平面，因此您将能够完全隔离这些流量。您可以在下面找到我们将要部署的两种控制面板配置。</p><p id="c108" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一个控制平面(<em class="od">“控制平面-A”</em>)将部署在项目“<em class="od"> istio-system </em>”中，而<em class="od">“控制平面-B”</em>将托管在项目“<em class="od"> istio-system-b </em>”中(请记住，您不能在同一个项目/命名空间中安装两个不同的控制平面)，正如您在对象描述符的命名空间分配中看到的那样。看一下预览文章，其中解释了每个配置变量。</p><p id="c14f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="od">控制平面-A: </em></p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="6700" class="nr ls iq ng b gy ot ou l ov ow">apiVersion: maistra.io/v1<br/>kind: ServiceMeshControlPlane<br/>metadata:<br/>  name: controlplane-A<br/>  namespace: istio-system<br/>spec:<br/>  version: v1.1<br/>  istio:<br/>    global:<br/>      proxy:<br/>        resources:<br/>          requests:<br/>            cpu: 20m<br/>            memory: 200Mi<br/>          limits:<br/>            cpu: 3000m<br/>            memory: 2048Mi<br/>    gateways:<br/>      istio-egressgateway:<br/>        autoscaleEnabled: true<br/>        autoscaleMin: 1<br/>        autoscaleMax: 3<br/>      istio-ingressgateway:<br/>        autoscaleEnabled: true<br/>        autoscaleMin: 2<br/>        autoscaleMax: 3<br/>        ior_enabled: true<br/>    pilot:<br/>      traceSampling: 10.0    <br/>    sidecarInjectorWebhook:<br/>      injectPodRedirectAnnot: true<br/>    tracing:<br/>      jaeger:<br/>        template: production-elasticsearch<br/>        elasticsearch:<br/>          nodeCount: 1<br/>          resources:<br/>            requests:<br/>              cpu: "500m"<br/>              memory: "1Gi"<br/>            limits:<br/>              cpu: "1000m"<br/>              memory: "2Gi"</span></pre><p id="33ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认值有一些变化:</p><ul class=""><li id="199e" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">网关的自动缩放以及最小值和最大值已启用。我还包括至少两个入口网关</li><li id="0697" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">IOR设置也已启用</li><li id="68e6" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">特使代理的QoS已配置</li><li id="5f46" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">追踪取样增加到10%</li><li id="3814" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">边车注射器将保持多点注释</li><li id="4cc0" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">jaeger template将使用一个elasticsearch集群(但只有一个节点),其中我们还设置了一些QoS设置。</li></ul><p id="11c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="od">控制平面-B: </em></p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="593d" class="nr ls iq ng b gy ot ou l ov ow">apiVersion: maistra.io/v1<br/>kind: ServiceMeshControlPlane<br/>metadata:<br/>  name: controlplane-B<br/>  namespace: istio-system-b<br/>spec:<br/>  version: v1.1<br/>  istio:<br/>    global:<br/>      disablePolicyChecks: false<br/>    gateways:<br/>      istio-egressgateway:<br/>        autoscaleEnabled: false<br/>      istio-ingressgateway:<br/>        autoscaleEnabled: false<br/>        ior_enabled: false<br/>    mixer:<br/>      policy:<br/>        autoscaleEnabled: false<br/>      telemetry:<br/>        autoscaleEnabled: false<br/>    pilot:<br/>      autoscaleEnabled: false<br/>      traceSampling: 100  <br/>    kiali:<br/>      enabled: true<br/>      dashboard:<br/>        viewOnlyMode: false<br/>    grafana:<br/>      enabled: false<br/>    tracing:<br/>      ingress:<br/>        enabled: true<br/>      jaeger:<br/>        template: all-in-one</span></pre><p id="149a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此控制面板(将安装在istio-system-b命名空间中)中，我们更改了这些默认值:</p><ul class=""><li id="9ade" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">将disablePolicycheck设置为false</li><li id="df3a" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">Kiali <em class="od"> viewOnlyMode </em>已启用，因此我们检查该变量是否会影响OpenShift 4.5中的Kiali部署</li><li id="acc4" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">格拉夫纳残疾人</li><li id="da98" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">从集群外部访问它的Jaeger OpenShift路径不会自动生成</li></ul><p id="10f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你如何部署控制平面？使用安装OpenShift服务网格操作符时创建的CRD对象。在本例中，您将看到我如何删除默认的“基本安装”对象并粘贴我们的配置:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/7324422928c7211d4c34637cb2100305.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gQVvPK09DJ8n2CCTn2bBMw.gif"/></div></div></figure><p id="3f18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是要考虑到，因为我们在配置描述符中有所有信息(甚至包括名称空间)，所以我们可以只使用顶栏上的“+”符号来创建对象。这里是第二个控制平面的示例:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/467c60c82894305dfe30598d5cab70fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*14rBlBxFoXIwuNyBOSVJkQ.gif"/></div></div></figure><p id="926f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您创建ServiceMeshControlPlane时，实际的OpenShift服务网格控制平面已部署，您可以检查是否在创建后立即移动到部署控制平面的命名空间上的窗格列表:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/9d0d92767f91140b63aed8605638b246.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oDhpUp-6Zn3FqmXAT2oYEA.gif"/></div></div></figure><h2 id="da00" class="nr ls iq bd lt ns nt dn lx nu nv dp mb kj nw nx mf kn ny nz mj kr oa ob mn oc bi translated">4.创建OpenShift服务网格成员卷</h2><p id="91e5" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">使用OpenShift，您不必安装单个集群范围的Istio服务网格，您可以根据需要部署任意多的控制平面，因此您需要一种方法来将不同的项目/名称空间分配给“正确的”服务网格。在OpenShift中，我们使用由服务网格操作符创建的<em class="od">ServiceMeshMemberRoll</em>CRD对象来实现。</p><p id="ef73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使用它，您必须在与<code class="fe nd ne nf ng b">ServiceMeshControlPlane</code>相同的项目中创建一个名为<code class="fe nd ne nf ng b">default</code>的<code class="fe nd ne nf ng b">ServiceMeshMemberRoll</code>资源，并在其中包含相关的项目。对于我们的示例，我创建了四个项目，其中两个将被分配给控制平面A(项目-A1和项目-A2)，另外两个将被分配给控制平面B(项目-B1和项目-B2)。</p><p id="9db3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些是您应该为这样的配置创建的<code class="fe nd ne nf ng b">ServiceMeshMemberRoll</code>资源(您可以使用上面显示的“+”方法部署它们)(注意“名称空间”和“成员”):</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="cdf9" class="nr ls iq ng b gy ot ou l ov ow">apiVersion: maistra.io/v1<br/>kind: ServiceMeshMemberRoll<br/>metadata:<br/>  name: default<br/>  namespace: istio-system<br/>spec:<br/>  members:<br/>    - project-a1<br/>    - project-a2</span></pre><p id="f871" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="9e8b" class="nr ls iq ng b gy ot ou l ov ow">apiVersion: maistra.io/v1<br/>kind: ServiceMeshMemberRoll<br/>metadata:<br/>  name: default<br/>  namespace: istio-system-b<br/>spec:<br/>  members:<br/>    - project-b1<br/>    - project-b2</span></pre><p id="56fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开始回顾我们已经部署的内容之前，需要注意的是，前面所有的步骤都是由具有集群管理权限的用户执行的，但是有时让不具有集群范围管理权限的项目管理员将他们的项目包含/排除到特定的服务网格中是很有用的。OpenShift通过执行以下步骤实现了这一点:</p><ol class=""><li id="5349" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv oe na nb nc bi translated">将<code class="fe nd ne nf ng b">mesh-user</code>角色添加到服务网格控制平面名称空间(<em class="od">控制平面的<em class="od">istio-system</em>-示例<em class="od">的</em>)中，以添加到您想要授予此功能的项目管理员用户(在此示例中为user1)</em></li></ol><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/8fb6589764c351a868a7979f3ec55639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oGcP9HBdZv_9up-ogM8tAQ.gif"/></div></div></figure><p id="56c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.然后，无特权用户(检查右上角)可以创建一个<code class="fe nd ne nf ng b">ServiceMeshMember</code>对象，该对象将在特定控制平面(用户仍然没有访问权)中执行<code class="fe nd ne nf ng b">ServiceMeshMemberRoll</code>的自动升级。继续我们的示例，用户1将创建一个新项目，并将其包含到控制面板a中</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/a04272e073547154fdcc282d66ef0838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hwWd94yMPvPnfCfEEzVUHQ.gif"/></div></div></figure><p id="ee0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您尝试使用不具有网格用户角色的用户(步骤1)或在不同的服务网格控制平面中创建这样的对象，您将会得到以下错误:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/34790176e0a9521b4b97cca6889f9065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*rBqqL6lSsz9o5UTGA-6wdQ.png"/></div></figure><p id="560c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以检查(使用cluster-admin用户)该项目是否已经包含在<code class="fe nd ne nf ng b">ServiceMeshMemberRoll</code>中，即使user1没有“直接”权限来更改它:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/fd10739f00beb70ac9ee92df80cb3afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YPHzFqFrHWpbyaSSDDy4UA.gif"/></div></div></figure><h1 id="bb9f" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">检查控制面板安装</h1><p id="ef12" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">让我们回顾一下创建对象时操作员执行的资源和一些集群配置，比较两个控制平面。</p><p id="e0db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Istio控制平面</strong></p><p id="e08d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您检查用于托管服务网格控制平面的任何名称空间(在我们的示例中是istio-system或istio-system-b ),您将看到创建运行istio控制平面组件的pod的部署对象:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/5fcfa201327868e81f0ca416d66cfdfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*wg6d4GWXRnhLUzRKv7kACA.png"/></div></figure><p id="8ed8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您<a class="ae kw" href="https://medium.com/swlh/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener">还记得第一篇文章</a>中的ISTIO控制平面(在ISTIO 1.5之前，由Maistra在2.0之前的版本中部署)有几个组件，让我们试着将它们与上面显示的部署相匹配:</p><ul class=""><li id="e872" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">城堡:<em class="od"> istio-citadel </em></li><li id="6aad" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">试点:<em class="od"> istio-pilot </em></li><li id="d238" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">图库:<em class="od"> istio-gallery </em></li><li id="83f0" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated">Mixer:它有两个主要职责，访问控制策略管理和遥测数据收集，这些职责被分成两个不同的部署:<em class="od"> istio-policy </em>和<em class="od"> istio-telemetry </em></li></ul><p id="67da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有两个额外的部署:</p><ul class=""><li id="0a56" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated"><em class="od"> istio-sidecar-injector </em>他将使用部署对象中的注释在pod中注入sidecar代理，我们将在下一篇文章中看到</li><li id="bba9" class="mu mv iq ka b kb nh kf ni kj nj kn nk kr nl kv mz na nb nc bi translated"><em class="od">istio-Ingres gateway</em>和<em class="od"> istio-egressgateway </em>将创建入口和出口网关。</li></ul><p id="6552" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到为了Istio正常工作，进入网格的流量必须总是通过入口网关，因此进入的流量应该到达服务网格控制平面名称空间(即istio-system)进入网络网格，独立于我们部署服务的名称空间(即项目-a1)。为了发布该入口网关，运营商还在控制平面名称空间中自动创建服务和开放移位路由:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pa"><img src="../Images/4d1ddfd6113a301936c716219c7fdcf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5gPyVeB_DVe6EbdLIbdMUw.png"/></div></div></figure><p id="3dea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你还记得在位于<em class="od"> istio-system </em>名称空间的控制平面中，我们至少配置了两个入口网关吗？，您可以检查操作员如何配置了两个<em class="od">istio-Ingres gateway</em>部署的副本:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/7d24cb06eb2631d3cfd3b2722a698a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*v1WUbhFJMpzYbvteiWjL_w.png"/></div></figure><p id="be7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了这些部署，在我们部署的启用了IOR路由同步的控制平面中，还有一个额外的部署(名称为<em class="od"> ior </em>)来创建负责此类同步的POD</p><p id="01f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Istio CNI插件</strong></p><p id="2a8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如这里的<a class="ae kw" href="https://istio.io/latest/docs/setup/additional-setup/cni/" rel="noopener ugc nofollow" target="_blank">所解释的</a>，<em class="od">默认情况下，Istio在网格中部署的pod中注入一个</em> <code class="fe nd ne nf ng b"><em class="od">initContainer</em></code> <em class="od">，</em> <code class="fe nd ne nf ng b"><em class="od">istio-init</em></code> <em class="od">。</em> <code class="fe nd ne nf ng b"><em class="od">istio-init</em></code> <em class="od">容器设置去往/来自Istio边车代理的pod网络流量重定向。这要求将pod部署到网格的用户或服务帐户拥有足够的Kubernetes RBAC权限来部署具有</em>  <code class="fe nd ne nf ng b"><a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" rel="noopener ugc nofollow" target="_blank"><em class="od">NET_ADMIN</em></a></code> <a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" rel="noopener ugc nofollow" target="_blank"> <em class="od">和</em> </a> <code class="fe nd ne nf ng b"><a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" rel="noopener ugc nofollow" target="_blank"><em class="od">NET_RAW</em></a></code> <a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" rel="noopener ugc nofollow" target="_blank"> <em class="od">功能</em> </a> <em class="od">的</em> <a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container" rel="noopener ugc nofollow" target="_blank"> <em class="od">容器。要求Istio用户具有提升的Kubernetes RBAC权限对于一些组织的安全合规性来说是有问题的。Istio CNI插件是</em> <code class="fe nd ne nf ng b"><em class="od">istio-init</em></code> <em class="od">容器的替代品，它执行相同的网络功能，但不要求Istio用户启用提升的Kubernetes RBAC权限。</em></a></p><p id="8993" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OpenShift服务网格使用Istio CNI插件，该插件由服务网格操作者通过在部署服务网格操作者的名称空间中创建DaemonSet ( <code class="fe nd ne nf ng b"><em class="od">istio-node</em></code>)而部署在每个节点中(在我们的例子中是openshift-operators，因为操作者是在集群范围内部署的)</p><p id="237f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个插件负责操作节点中的iptables路由规则，这些节点是用Envoy sidecar容器注入的。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/34e37f066e9e47e5c901a54f1588a49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*8a-XnbJUpqYKJqOG-MYBOQ.png"/></div></figure><p id="7bae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">命名空间网络配置</strong></p><p id="69fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务网格操作符还在作为网格一部分的每个项目中创建一个<code class="fe nd ne nf ng b">NetworkAttachmentDefinition</code>对象。<code class="fe nd ne nf ng b">NetworkAttachmentDefinition</code>是一个定制资源，它将第二层暴露给一个特定的名称空间，在本例中是ISTIO CNI。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/c26808f06ea8227f81814f287a9415fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*65fTXGZ2A-a9dKCjHlkUOQ.png"/></div></figure><p id="5e7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">操作员还在每个成员项目中创建<code class="fe nd ne nf ng b">NetworkPolicy</code>对象(如果您从服务网格中删除一个成员，这个<code class="fe nd ne nf ng b">NetworkPolicy</code>资源也将从项目中删除)。每个名称空间创建两个<code class="fe nd ne nf ng b">NetworkPolicy</code>对象:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/971900990370241547d90bc65620711e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*pau_BhLxAUFCiJuROj29fA.png"/></div></figure><p id="a1c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nd ne nf ng b">istio-mesh</code>策略只允许进入该服务网格控制平面的成员项目的流量(使用标签<em class="od">maistra.io/member-of: istio-system</em>的名称空间)。</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="3a75" class="nr ls iq ng b gy ot ou l ov ow">...<br/>spec:<br/>  podSelector: {}<br/>  ingress:<br/>    - from:<br/>        - namespaceSelector:<br/>            matchLabels:<br/>              maistra.io/member-of: istio-system<br/>  policyTypes:<br/>    - Ingress</span></pre><p id="e79b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要从非成员项目直接进入(不通过入口网关)PODs，您需要创建一个<code class="fe nd ne nf ng b">NetworkPolicy</code>来允许该流量，但是请记住，您应该通过入口网关来确保ISTIO按预期工作。</p><p id="85a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网络策略强制将对网格中的服务的直接访问限制到作为同一控制平面成员的命名空间上的pod，例如<em class="od"> project-a2 </em>是控制平面<em class="od"> controlplane-a </em>的成员，该控制平面部署在<em class="od"> istio-system </em>命名空间中:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/90ebd2ce9d276f77552ab5066c0443fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*RcMsrh8a9N1fyje3nlycPg.png"/></div></figure><p id="7e33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ISTIO入口网关还需要直接访问部署在网格上的服务，因此可以想象，控制平面名称空间也包含此标签:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/c2d059863c91f6b7c447947f1a28dedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*beBzeGEECU6ys5RjjB0zQQ.png"/></div></figure><p id="1ace" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一个<code class="fe nd ne nf ng b">istio-expose-route</code>网络策略:</p><pre class="nn no np nq gt op ng oq or aw os bi"><span id="712c" class="nr ls iq ng b gy ot ou l ov ow">...<br/>spec:<br/>   podSelector:<br/>    matchLabels:<br/>      maistra.io/expose-route: 'true'<br/>   ingress:<br/>    - from:<br/>        - namespaceSelector:<br/>            matchLabels:<br/>              network.openshift.io/policy-group: ingress<br/>   policyTypes:<br/>    - Ingress</span></pre><p id="af39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它仅适用于标签为<em class="od">maistra.io/expose-route:“真”</em>的pod，并且对于允许需要在服务网格登记的名称空间内部署并且必须使用标准路由发布的非网格服务(并且不通过允许的业务流的ISTIO入口网关)是有用的。</p><p id="bad0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您需要在服务网格之外的名称空间中部署一个服务，您应该用标签<code class="fe nd ne nf ng b">maistra.io/expose-route: "true" </code>来标记它的部署，以确保OpenShift容器平台到这些服务的路由仍然工作。尽管如此，请记住，最佳实践是将服务部署到网格外部的独立名称空间中，这些名称空间不在任何网格中。我们将在以后的文章中回顾一个例子，这样可能会更好理解。</p><p id="02c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">吉利</strong></p><p id="0781" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有在控制平面配置中禁用Kiali，则由服务网格运营商使用部署对象来部署它。运营商还在控制平面命名空间中创建一个OpenShift路由(如果您没有在控制平面配置中禁用Kiali入口),该路由向群集外部公开:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/2c530e6d537bc75c6bc37f7e9cfe3bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*zbdLqfKtDVxh5z5JzXxnzA.png"/></div></figure><p id="fc1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，Kiali部署了SSO集成，您可以使用OpenShift凭证来访问:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/2c4397795aafdc0b2881dadfe6e9918f.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*8eHX7DxTJI0OB7o6FR2tXQ.png"/></div></figure><p id="5d83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个特定的设置中，我发现了我们两个服务网格部署之间的差异。我们部署了一个使用Jaeger模板<code class="fe nd ne nf ng b">all-in-one</code>的控制面板和另一个使用<code class="fe nd ne nf ng b">production-elasticsearch</code>的控制面板，我注意到在Kiali中，直接访问Jager控制台(查看下面的截图，你会在左侧看到一个名为“分布式跟踪”的链接)只出现在<code class="fe nd ne nf ng b">all-in-one </code>安装中。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ph"><img src="../Images/5f55a99e2dd5ee2318c950d63f11eab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TaQT1K3M3Zf3KUaHDujIiA.png"/></div></div></figure><p id="20f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没问题！，你还记得有一个控制平面配置选项，我们可以包括Jaeger的网址吗？我们可以获取Jaeger route(您将在控制平面名称空间中找到它，<em class="od"> istio-system </em>)并在控制平面描述符的Kiali部分下添加配置选项(JaegerURL):</p><blockquote class="of og oh"><p id="9b16" class="jy jz od ka b kb kc kd ke kf kg kh ki oi kk kl km oj ko kp kq ok ks kt ku kv ij bi translated">注意:确保您的更改在规格&gt; istio&gt;kiali下，而不是在状态&gt;最后应用配置&gt; istio&gt;kiali下，否则配置不会被保存</p></blockquote><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/bf1d7fcd7638d00991b7113cf1d8d21c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*E8tXsxbQO7x-CNTj2KX5EA.gif"/></div></div></figure><p id="e1e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一段时间后(你需要等一会儿)，你会发现从Kiali到你的Jaeger控制台的直接访问也是由那个控制平面部署的。</p><p id="a6a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试<em class="od"> viewOnlyMode </em>参数对用户可以从Kiali修改的内容没有实际影响，您可以打开我们尝试启用这种“仅查看”模式的控制平面的Kiali UI，然后尝试修改一个对象(在这种情况下，我已经创建了一个网关对象，这将在下一篇文章中针对这一特定测试进行解释)</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/2685ab8334823a6ebceb50e9b5289143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0cFX5BRtcWqnbdb-IicpBQ.gif"/></div></div></figure><p id="ad47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如在<a class="ae kw" href="https://medium.com/swlh/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener">上一篇文章</a>中所解释的，Istio与Jaeger和Prometheus集成，作为提供跟踪和度量的后端，而不仅仅是Istio，如果您看一下<a class="ae kw" href="https://kiali.io/documentation/v1.0/architecture/" rel="noopener ugc nofollow" target="_blank"> Kiali架构</a>您会看到“Kiali图表”,所以让我们继续这些组件…</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/512ac6c934c1adf1b50293b23aa58863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3E9-eUfP3BOT9_Ak.png"/></div></figure><p id="8f9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Jaeger + elasticsearch </strong></p><p id="4bc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们将发现部署的两个服务网格之间的巨大差异。在名称空间<em class="od"> istio-system </em>上，我们部署了一个由elasticsearch支持的Jaeger控制平面(我们只配置了一个节点)，但在部署在<em class="od"> istio-system-b </em>名称空间上的控制平面中，Jaeger使用的是内存数据库(<code class="fe nd ne nf ng b">all-in-one</code>模板)。这使得在<em class="od"> istio-system-b </em>名称空间中，您将找到一个部署(<code class="fe nd ne nf ng b">jaeger</code> )…</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/880902aeee334d737eb08907671619b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*YoyUhJrrFfBYxvBg2vpeMA.png"/></div></div></figure><p id="9b67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…在<em class="od"> istio-system </em>名称空间中，您会发现<code class="fe nd ne nf ng b">jaeger-collector</code>和<code class="fe nd ne nf ng b">jaeger-query</code>以及elasticsearch部署。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/613a393f5cb83f058481e9648694f71a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*E4GdlMTCBc8Qg6lAhCzFWA.png"/></div></figure><p id="5555" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解更多关于这些部分的信息，你可以看一下<a class="ae kw" href="https://www.jaegertracing.io/docs/1.19/architecture/" rel="noopener ugc nofollow" target="_blank"> Jaeger架构文档</a>，在那里你可以找到<em class="od"> jaeger-collector </em>和<em class="od"> jaeger-query </em>的解释(以及这个示例模式):</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pj"><img src="../Images/0484ad52ffa1f6960652652217f81b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qr9axSvblfJ9hCXV.png"/></div></div></figure><p id="c606" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您稍微研究一下部署对象，您会发现<code class="fe nd ne nf ng b">jaeger</code>对象没有任何对外部elasticsearch的引用…</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/6c2b24d3357b54dae6662faa4c777447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GismQHNmXgsB_Wr6F9OzSA.png"/></div></div></figure><p id="7367" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…但是<code class="fe nd ne nf ng b">jaeger-collector</code>和<code class="fe nd ne nf ng b">jaeger-query</code>对象指向内部的Kubernetes服务，该服务公开了由我们的运营商部署的elasticsearch(查看上面的Jaeger架构模式，这两个部分需要访问数据库):</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pk"><img src="../Images/9220dcda947f883b67e47b8ce9ea12d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxVXB_XTkr-iz7dzOkj9kw.png"/></div></div></figure><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pl"><img src="../Images/ac99f2fef5e0858c357ea1a1def2827d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BfEjj-PljmD7bcL-o4YhHw.png"/></div></div></figure><p id="26b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">普罗米修斯</strong></p><p id="a587" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以进入Prometheus Web控制台并检查目标的状态:</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/23fabbf01a5ece4a915729d07671b849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZnoFVKk74TE0A7gxxE88hA.gif"/></div></div></figure><p id="5bcf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">格拉夫纳</strong></p><p id="bd23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于Grafana没有太多要说的(我们将在下一篇文章中检查仪表板)，也许最重要的部分是检查位于<em class="od"> istio-system-b </em>名称空间中的控制平面<em class="od"> controlplane-b </em>中，我们禁用了Grafana，因此您不应该发现它是该控制平面的一部分。</p><h1 id="bcdb" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">下一步是什么？</h1><p id="7838" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">我们已经了解了如何部署OpenShift服务网格控制平面，以及一旦部署完成，我们如何查看一些主要的OpenShift服务网格组件，您会发现这些组件已经安装在您的OpenShift集群中。</p><p id="8644" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下一篇文章中，我们将看到如何注入sidecar代理来启用数据平面，并且我们将开始使用服务网格特性。</p><figure class="nn no np nq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pm"><img src="../Images/1f95795dbec7d3550a4c3983b60a0575.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OIsdm7PFnRtM6PWZ.png"/></div></div></figure><blockquote class="pn"><p id="a66f" class="po pp iq bd pq pr ps pt pu pv pw kv dk translated">在本系列的下一篇文章中，我们将从数据平面和服务网格功能开始。</p><p id="9e2a" class="po pp iq bd pq pr px py pz qa qb kv dk translated">您也可以重新回顾本系列第一篇文章中的概念:</p></blockquote><div class="qc qd qe qf qg la"><a href="https://medium.com/@luis.ariz/openshift-service-mesh-essentials-part-i-the-why-and-what-of-it-a3ef09bf8aa8" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">open shift Service Mesh essentials—第一部分—原因和内容</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">在这第一篇文章中，我们将讨论一些关于OpenShift服务网格的介绍性问题，包括它的特性…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jw la"/></div></div></a></div><blockquote class="pn"><p id="fc51" class="po pp iq bd pq pr ps pt pu pv pw kv dk translated">或者继续阅读下一篇文章:</p></blockquote><div class="qc qd qe qf qg la"><a href="https://luis-javier-arizmendi-alonso.medium.com/openshift-service-mesh-essentials-part-iii-data-plane-341ce477c269" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">OpenShift服务网格基础—第三部分—数据平面</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">在本文中，我们将通过展示一个应用程序部署来探索OpenShift服务网格数据平面…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">luis-javier-arizmendi-alonso.medium.com</p></div></div><div class="lj l"><div class="lp l ll lm ln lj lo jw la"/></div></div></a></div><div class="kx ky gp gr kz la"><a href="https://luis-javier-arizmendi-alonso.medium.com/openshift-service-mesh-essentials-part-iv-features-routing-3189dae64615" rel="noopener follow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">OpenShift服务网格基础—第四部分—功能:路由</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">了解如何使用高级路由来修改应用程序的行为，而不包括API网关或…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">luis-javier-arizmendi-alonso.medium.com</p></div></div><div class="lj l"><div class="lq l ll lm ln lj lo jw la"/></div></div></a></div></div></div>    
</body>
</html>