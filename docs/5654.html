<html>
<head>
<title>Cross browser window state management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨浏览器窗口状态管理</h1>
<blockquote>原文：<a href="https://itnext.io/cross-browser-window-state-management-77bf837b6574?source=collection_archive---------2-----------------------#2021-04-26">https://itnext.io/cross-browser-window-state-management-77bf837b6574?source=collection_archive---------2-----------------------#2021-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6375" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种新方法非常强大，而且易于使用。</p><p id="da68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实现依赖于使用<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker" rel="noopener ugc nofollow" target="_blank">的共享工作人员</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/2fcd5733c96caf9fcfca36cf34f35ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MMG_IfSjn8huMBTBHJxI5g.png"/></div></div></figure><h1 id="38b8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">内容</h1><ol class=""><li id="ece6" class="lw lx iq jp b jq ly ju lz jy ma kc mb kg mc kk md me mf mg bi translated">运行中的演示应用</li><li id="5ba7" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">应用程序架构的魔力</li><li id="82b3" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">访问状态数据的绑定</li><li id="bdad" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">在线演示</li><li id="0d56" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">关于neo.mjs中状态管理的更多信息</li><li id="94ef" class="lw lx iq jp b jq mh ju mi jy mj kc mk kg ml kk md me mf mg bi translated">我们能为这个演示获得一个独立的存储库吗？</li></ol><h1 id="544b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">1.运行中的演示应用</h1><p id="746f" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我让演示应用程序尽可能简单。</p><p id="8646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个简短的视频，看看我们将要谈论的内容:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h1 id="f677" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2.应用程序架构的魔力</h1><p id="22cd" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">自动生成的索引文件:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="fc91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在使用<code class="fe ms mt mu mv b">useSharedWorkers</code>框架配置从使用普通web workerss切换到共享web worker(多窗口上下文需要)。</p><p id="13f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们指向我们的app.mjs文件。</p><p id="1aaa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">窗口(主线程)将<strong class="jp ir">而不是</strong>包含它。相反，它会被应用程序工作人员拾取(单独的线程→ CPU)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="6cbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个应用程序都是从一个空的视窗开始的:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="35b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主应用程序正在使用ViewportController:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="190a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[旁注]有了<a class="ae kl" href="https://github.com/webpack/webpack" rel="noopener ugc nofollow" target="_blank"> webpack ^5.35.1 </a>，我们终于可以在dist/*输出中使用<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Public_class_fields" rel="noopener ugc nofollow" target="_blank">公共类字段</a>。</p><p id="612c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在SharedWorkers范围内，我们可以使用<code class="fe ms mt mu mv b">connect</code>和<code class="fe ms mt mu mv b">disconnect</code>事件，它们在主线程到达或离开时发生。这也包括当前的应用程序。</p><p id="3bd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ms mt mu mv b">onAppConnect()</code>已经是本文的重点部分。</p><p id="8fa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当第一个应用程序(浏览器窗口)连接时，我们将创建一个包含状态(数据)的视图模型。</p><p id="a222" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后连接的所有应用程序都将收到对此模型的父引用。</p><p id="85dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://github.com/neomjs/neo" rel="noopener ugc nofollow" target="_blank"> neo.mjs </a>上下文中的“视图模型”意味着一个完全可选的构造，使子组件可以访问数据。</p><p id="e97b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，这是两个应用程序都在使用的唯一一个视图模型(以防我们没有计算纯父参考模型)。</p><h1 id="c49e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">3.访问状态数据的绑定</h1><p id="08af" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">两个视口都添加了这个主容器:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="30de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">标题工具栏中的标签包含一个绑定的文本配置。</p><p id="a531" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在使用<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" rel="noopener ugc nofollow" target="_blank">模板文字</a>，并且可以访问整个父模型链来自动找到每个数据属性的最接近匹配。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="1372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的视图控制器中，我们将延迟加载对话框JS模块，以防它还不在那里，并再次将父引用指向最近的模型。</p><p id="36b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，模型会自动找到最近的父节点，但是对话框是特殊的，因为它们位于组件树之外(直接的子节点<code class="fe ms mt mu mv b">document.body</code>)。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="b920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在对话框视图中，我们将两个文本字段值config绑定到模型数据。</p><p id="4405" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还添加了更改监听器，我们将在最近的视图控制器中接收这些监听器。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mr mq l"/></div></figure><p id="7c56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用<code class="fe ms mt mu mv b">this.getModel().setData()</code>来访问每个数据属性的最近视图模型。</p><p id="4b18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正确，这意味着我们的第一个应用程序的视图模型，即使它存在于不同的浏览器窗口中。</p><p id="8285" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是了。就这么简单。</p><h1 id="6a3b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">4.在线演示</h1><p id="5c0e" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated"><strong class="jp ir">重要提示</strong>:先打开主应用，然后在不同的窗口打开子应用。要“重新加载”应用程序，您需要关闭window2并重新加载window1(一个SharedWorker一直存在，直到没有连接剩下)。</p><p id="ed3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们当然可以增强应用程序(例如，给子应用程序添加一个视口控制器)，这样你就可以先打开这个应用程序。</p><p id="59cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览器支持桌面:<strong class="jp ir"> Chrome，Edge，Firefox </strong></p><p id="a36b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主应用:<br/> <a class="ae kl" href="https://neomjs.github.io/pages/node_modules/neo.mjs/dist/production/examples/model/multiWindow/index.html" rel="noopener ugc nofollow" target="_blank">分销/生产/示例/模型/多窗口/ </a></p><p id="7dbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">子App:<br/><a class="ae kl" href="https://neomjs.github.io/pages/node_modules/neo.mjs/dist/production/examples/model/multiWindow2/index.html" rel="noopener ugc nofollow" target="_blank">dist/production/examples/model/multi window 2/</a></p><p id="4cb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要访问控制台，您需要打开，例如:</p><pre class="kn ko kp kq gt mw mv mx my aw mz bi"><span id="e486" class="na kz iq mv b gy nb nc l nd ne">chrome://inspect/#workers</span></pre><p id="452d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后选择app worker(您也可以在这里终止它们)。</p><p id="a2c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于非共享工作人员，您可以在“普通”控制台中获得所有日志。</p><p id="79fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对Webkit (Safari)有疑问，这里有相关的标签:</p><div class="nf ng gp gr nh ni"><a href="https://bugs.webkit.org/show_bug.cgi?id=149850" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">149850 -恢复对共享工作者的支持</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">错误149850:恢复对共享工作人员的支持</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">bugs.webkit.org</p></div></div></div></a></div><h1 id="502d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">5.关于neo.mjs中状态管理的更多信息</h1><p id="fbf4" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">本文是版本2发布系列的一部分:</p><div class="nf ng gp gr nh ni"><a rel="noopener  ugc nofollow" target="_blank" href="/the-webworkers-driven-ui-framework-neo-mjs-version-2-release-announcement-b91b476d6f16"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">webworkers驱动的UI框架neo.mjs第2版发布公告</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">新产品的概念必须是颠覆性的，否则就没什么必要。然而，使用它们的方法…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">itnext.io</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kw ni"/></div></div></a></div><p id="f64c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章指向了前两篇文章，其中包含了更多关于如何使用视图模型以及它们是如何详细实现的背景信息。</p><div class="nf ng gp gr nh ni"><a rel="noopener  ugc nofollow" target="_blank" href="/enhance-your-frontend-state-management-with-view-models-7bf49e1a0991"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">使用视图模型增强您的前端状态管理</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">您很可能使用过MobX、Redux或React上下文API。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">itnext.io</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw kw ni"/></div></div></a></div><div class="nf ng gp gr nh ni"><a href="https://tobiasuhlig.medium.com/enhance-your-frontend-state-management-with-view-models-part2-5a9384bd863c" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">使用视图模型增强您的前端状态管理—第2部分</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">设计目标&amp;谈基于模板文字的视图模型实现。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">tobiasuhlig.medium.com</p></div></div><div class="nr l"><div class="ny l nt nu nv nr nw kw ni"/></div></div></a></div><p id="d03a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在以下位置找到neo.mjs存储库:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/neomjs/neo" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">近地天体</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">neo.mjs使您能够使用一个以上的CPU创建可扩展的高性能应用程序，而无需使用…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="nz l nt nu nv nr nw kw ni"/></div></div></a></div><h1 id="9ddd" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">6.我们能为这个演示获得一个独立的存储库吗？</h1><p id="a8ad" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">已经有了这个问题，答案是肯定的:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/neomjs/cross-browser-state" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">neomjs/跨浏览器状态</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div></div></a></div><p id="fb4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然您可以使用<code class="fe ms mt mu mv b">npx neo-app</code>来创建自己的工作空间，但它可能更方便，例如，转而使用这个repo并将其作为起点。</p><p id="8273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序内容几乎完全相同，除了调整后的应用程序名称:</p><p id="3556" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于框架回购中的例子来说,<code class="fe ms mt mu mv b">Neo.examples.model.multiWindow</code>是可以的，但是通常应用程序的名字都很短。这里的<code class="fe ms mt mu mv b">MyApp</code>和<code class="fe ms mt mu mv b">MyApp2</code>。</p><p id="2c50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">视图内容也被移到了一个<code class="fe ms mt mu mv b">view</code>文件夹中。</p><p id="78b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">问候&amp;快乐编码，<br/>托拜厄斯</p></div></div>    
</body>
</html>