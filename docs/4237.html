<html>
<head>
<title>Application Monitoring I Wish I Had Before</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我希望以前有过的应用程序监控</h1>
<blockquote>原文：<a href="https://itnext.io/application-monitoring-i-wish-i-had-before-ce9b305c636c?source=collection_archive---------4-----------------------#2020-05-20">https://itnext.io/application-monitoring-i-wish-i-had-before-ce9b305c636c?source=collection_archive---------4-----------------------#2020-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0e33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">免责声明:</em> </strong> <em class="kl">故事涵盖了一般概念，构成了方便监控系统的基础。像Prometheus/Grafana设置属性这样的实现细节不在讨论范围之内。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b17ea15c397e5c0519b021956f72a030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OS1FRduXVyS4oYBj-8sL3A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Tobias Jussen 在<a class="ae lc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="5465" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我为几个生产服务重新设计和实现了应用程序监控。我对结果很满意，以下是我的要点:</p><h1 id="4f0a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">#0:收集足够的数据</h1><h2 id="e34f" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">从内外观察你的系统</h2><p id="4fcb" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">根据设计，应用程序无法完全监控自身。例如，web应用程序路由器不希望出现特殊符号，并且在不增加错误计数器的情况下安静地崩溃。除非您有可以从外部观察服务器的东西(反向代理、负载平衡器、客户端)，否则您不会注意到问题。另一方面，你不能只从外部观察系统，因为一些细节是内在隐藏的。</p><h2 id="bf7c" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">将最重要的传感器集中在一个地方</h2><p id="b46e" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">很有可能在发生事故时，你会得到一个警报，它很少或根本没有提到原因，因此不会帮助你找出如何稳定你的系统。这就是为什么将重要的传感器集中在一个容易看到的地方非常重要。</p><p id="6c51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">慢慢来，思考可能出现的问题，回顾以前的事件，组装相应的传感器。随着你的系统和相关知识的增长，不要忘记重温它。</p><h1 id="e7d2" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">#1:当事情变糟需要立即采取行动时，发送通知</h1><h2 id="450a" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">提高警报的反应能力</h2><p id="c719" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">发生事故时，应尽快发送警报—更快的反应意味着更短的事故持续时间。这在很大程度上取决于alert的表达式，例如，计算平均值会降低反应速度，计算大窗口的指标也会降低反应速度。</p><p id="375d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相对较小窗口上的百分位数应该是您的首选。</p><h2 id="2242" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">警报应代表被破坏的SLO/用户体验</h2><p id="a6f7" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">不要对一些隐藏的潜在前兆发出警报，比如GC计时的轻微增加。GC本身是无害的，<strong class="jp ir">除非你的服务SLO因为它而被攻破。</strong></p><p id="b586" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您的SLO警报是反应性的，并且GC降级到足以影响用户——无论如何您都会收到通知。<strong class="jp ir">但当用户不受影响时，问题可以等一等。</strong></p><h1 id="62c2" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">#2:当不需要立即行动时，不要发送通知</h1><h2 id="207a" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">过度信息谬误</h2><p id="5386" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">有时候，人们决定他们想得到每一件事情的通知。最终你会开始忽略它们，并且会错过一个重要的，这就是大脑的工作方式。不要上当。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/6f8cf6065dc6196767c9f6247a707153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_1ulBtvKA7YNRMdkGt7tA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><a class="ae lc" href="https://unsplash.com/@chairulfajar_?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">@ chairufajar _</a>在<a class="ae lc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="c951" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">重新设计假阴性警报</h2><p id="7427" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">警告没有严重原因的哔哔声是最糟糕的。这分散了工程师的注意力，使他们不愿意对警报做出反应。这发生在我身上一次，这是我一生中最愚蠢的事件。</p><p id="fab6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，当至少有一种情况属实时，警报是不可靠的:</p><ul class=""><li id="e5af" class="ms mt iq jp b jq jr ju jv jy mu kc mv kg mw kk mx my mz na bi translated">单个阈值违规时触发警报</li><li id="9077" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated">首先评估指标，然后汇总</li><li id="a31f" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated">在非峰值期间，可测量值向尾部移动</li></ul><p id="1a24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">评估一个窗口内的数据(非高峰时数据会变大)或等待几个连续的结果应该可以解决问题。</p><p id="57be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，这与反应性完全相反<strong class="jp ir">:更大的窗口意味着更低的反应性，更小的窗口意味着更多的假阴性警报。</strong>达到平衡需要时间，但值得。</p><h2 id="baef" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">考虑警报范围粒度</h2><p id="38f2" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">如果您部署了许多无状态实例，比如每个可用性区域有3个以上的实例，那么当其中一个出现故障时，您不需要得到通知。系统本身应该容许微小的误差。进行适当的容量规划，设置足够的超时、重试和断路器应该可以做到。</p><p id="be72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">针对每个实例配置的警报是彻底审查的主题。</p><h2 id="6bfa" class="mb le iq bd lf mc md dn lj me mf dp ln jy mg mh lr kc mi mj lv kg mk ml lz mm bi translated">独立的警报通道</h2><p id="6859" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">虽然我批评了广泛的警报，但了解您的系统发生了什么是至关重要的(我怎么强调都不为过！)，你只是不需要直接了解它——使用异步通道。</p><h1 id="976b" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">#3:观察趋势并提前采取必要行动的能力</h1><p id="d868" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">远距离趋势，如cpu消耗、连接池大小和数据库中存储的数据量，不需要立即采取措施，可以通过以下方式进行检查:</p><ol class=""><li id="c694" class="ms mt iq jp b jq jr ju jv jy mu kc mv kg mw kk ng my mz na bi translated">人工:每天/每周重新查看所有仪表板。无法随着传感器和应用数量的增加而很好地扩展</li><li id="9442" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk ng my mz na bi translated">半自动:克隆相应的警报并设置较低的阈值。然后将其附加到单独的通道，在那里进行重复数据删除，汇总到单个报告中，并每天/每周发送</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/466375db68581bf3fab3144ebad79703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Z3IDdt_2qWlGEJpH8juLw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">不同的警报如何相互关联</figcaption></figure></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="6eed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我把这些整合在一起时，我发现做一名随叫随到的工程师并不一定是一场噩梦:)</p><p id="9e36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读，希望你学到了有用的东西！</p></div></div>    
</body>
</html>