<html>
<head>
<title>Destroying Backends — Amplified Mobile App Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">摧毁后端——扩大移动应用开发</h1>
<blockquote>原文：<a href="https://itnext.io/destroying-backends-amplified-mobile-app-development-e1ea8bfe7802?source=collection_archive---------5-----------------------#2019-04-07">https://itnext.io/destroying-backends-amplified-mobile-app-development-e1ea8bfe7802?source=collection_archive---------5-----------------------#2019-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jq jr js jt gh gi paragraph-image"><div class="ab gu cl ju"><img src="../Images/f0bae3a9e409bd781b84eed62f77acc1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Q0kFri-mPUsdHLmtqthLBA.jpeg"/></div></figure><p id="d0f7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本教程中，我将制作一个移动应用程序来发布对DynamoDB文档的引用，并在所有设备上实时查看更新。我将使用React Native和AWS Amplify作为后端，使用Auth和GraphQL API。看看我以前的教程，了解更多关于这些！</p><div class="kv kw gp gr kx ky"><a href="https://medium.com/capgemini-norway/destroying-backends-with-serverless-introduction-and-authentication-e940946c6de2" rel="noopener follow" target="_blank"><div class="kz ab fo"><div class="la ab lb cl cj lc"><h2 class="bd iu gy z fp ld fr fs le fu fw is bi translated">使用无服务器销毁后端—简介和身份验证</h2><div class="lf l"><h3 class="bd b gy z fp ld fr fs le fu fw dk translated">第1部分，共3部分:介绍和认证。这是集成放大器系列三部分的第一部分…</h3></div><div class="lg l"><p class="bd b dl z fp ld fr fs le fu fw dk translated">medium.com</p></div></div><div class="lh l"><div class="li l lj lk ll lh lm jv ky"/></div></div></a></div><div class="kv kw gp gr kx ky"><a href="https://medium.com/capgemini-norway/destroying-backends-with-amplify-appsync-graphql-api-5521c0e62a4c" rel="noopener follow" target="_blank"><div class="kz ab fo"><div class="la ab lb cl cj lc"><h2 class="bd iu gy z fp ld fr fs le fu fw is bi translated">使用Amplify销毁后端— AppSync GraphQL API</h2><div class="lf l"><h3 class="bd b gy z fp ld fr fs le fu fw dk translated">第2/3部分</h3></div><div class="lg l"><p class="bd b dl z fp ld fr fs le fu fw dk translated">medium.com</p></div></div><div class="lh l"><div class="ln l lj lk ll lh lm jv ky"/></div></div></a></div><h1 id="96e5" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">让我们创造</h1><p id="cf43" class="pw-post-body-paragraph jx jy it jz b ka mm kc kd ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku im bi translated">首先，开始使用React Native。全局安装<a class="ae mr" href="https://facebook.github.io/react-native/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> Expo CLI </a>并运行expo init“项目名称”。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c3ce" class="nb lp it mx b gy nc nd l ne nf">npm install -g expo-cli<br/>expo init quoted<br/>cd quoted</span></pre><p id="5618" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在项目目录中，安装<a class="ae mr" href="https://aws-amplify.github.io/docs/" rel="noopener ugc nofollow" target="_blank"> Amplify CLI </a>并在您的项目中启动它。这要求你至少拥有一个<a class="ae mr" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank">自由级AWS账户</a>。这样，您就可以为您的项目配置Amplify，但是不要担心。这都是通过Amplify CLI完成的。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2083" class="nb lp it mx b gy nc nd l ne nf">npm install -g @aws-amplify/cli<br/>amplify configure</span></pre><p id="fe25" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这将启动一组提示。</p><ul class=""><li id="d2b0" class="ng nh it jz b ka kb ke kf ki ni km nj kq nk ku nl nm nn no bi translated">选择离你最近的地区，然后回车。</li><li id="b8c7" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">给IAM用户一个名称，然后按enter键。您将被自动带到AWS浏览器控制台，并与您的用户一起登录。</li><li id="e4ed" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">登录后，在CLI中点击“enter”继续。</li><li id="3980" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">这将带您进入IAM服务，创建一个具有管理员权限的用户。选择所有默认值。</li><li id="4905" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">完成后，复制访问密钥，转到CLI，粘贴它，按enter，返回，复制密钥，转到CLI，粘贴它，按enter，完成！</li></ul><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi nu"><img src="../Images/e075fd7b1ef10dc9bd5e874e2f0d59a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulOrY8fqiMcBPmix7nAk2A.png"/></div></div></figure><blockquote class="nz oa ob"><p id="8f72" class="jx jy oc jz b ka kb kc kd ke kf kg kh od kj kk kl oe kn ko kp of kr ks kt ku im bi translated">这是唯一一次你必须花在AWS浏览器控制台，除非你想！</p></blockquote><p id="2b95" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在应用程序目录中创建一个/src文件夹，并启动Amplify。这将带您完成另外5个提示，它们很容易填写。用作源目录路径的文件夹是aws-exports.js文件将出现的目录，该文件用于放大. configure()您的客户端。稍后会详细介绍。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="8cfb" class="nb lp it mx b gy nc nd l ne nf">mkdir src<br/>amplify init</span></pre><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi og"><img src="../Images/433194cd29ea0904c6b34e89cb59aaf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z2-B41dOHoxeY0mTAjuEmA.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">放大初始化过程</figcaption></figure><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi ol"><img src="../Images/56d5dfd4a29242f12cca81feb15f79e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiGCvcZ5XyfuTf5OEuerEQ.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">您可以使用Amplify CLI执行的操作</figcaption></figure><p id="24fa" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">命令' amplify push '和' amplify publish '将生成aws-exports.js。如果您使用GraphQL API(我们稍后会用到)，它将要求您更新生成的代码以与API通信。如果您使用“发布”,则需要启用托管，这会自动将应用程序发布到您的S3虚拟主机中。</p><h1 id="56fa" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">添加Auth和GraphQL API</h1><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5bdf" class="nb lp it mx b gy nc nd l ne nf">amplify add auth<br/>&gt; use default config<br/>&gt; that's it<br/>amplify add api<br/>&gt; Pick GraphQL<br/>&gt; Pick API name (default is your project name)<br/>&gt; Pick Cognito as Auth mechanism<br/>&gt; Pick No for having your own schema<br/>&gt; Pick Yes for automatic schema creation<br/>&gt; Pick Yes to edit the schema now</span></pre><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi om"><img src="../Images/11be004b45414994e1b545adf0c215d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grO5AgTupqhpZC55juIjsA.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">添加Auth (AWS Cognito)和API (AWS AppSync GraphQL服务器)</figcaption></figure><p id="e705" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">用您的编辑器找到模式，修改它并保存。当你对你的模式/数据模型满意的时候，运行amplify push，对所有选项点击yes。这将自动生成包含3个文件的目录“quotes/src/graphql ”;<em class="oc"> subscriptions.js、mutations.js和queries.js. </em>它们包含了CRUD到GraphQL服务器的代码。</p><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi on"><img src="../Images/784fef1b75ab4d54b1d1cf5d387b38b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y6zSHERz07ER9-hHMwcCXg.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">这是一个经过修改的schema.graphql，它自动将作者保存到数据库中，并且只允许作者读/写。如果希望所有用户都能看到引用，请忽略作者</figcaption></figure><h1 id="69fc" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">一直到客户</h1><p id="d179" class="pw-post-body-paragraph jx jy it jz b ka mm kc kd ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku im bi translated">在AWS (amplify push)中构建Amplify模板时，打开另一个控制台窗口，cd进入您的项目目录并运行“<em class="oc"> expo start </em>”。这将启动expo服务器来开发/测试您的React本地应用程序。此外，下载世博移动应用程序。我使用安卓系统:</p><div class="kv kw gp gr kx ky"><a href="https://play.google.com/store/apps/details?id=host.exp.exponent&amp;hl=en" rel="noopener  ugc nofollow" target="_blank"><div class="kz ab fo"><div class="la ab lb cl cj lc"><h2 class="bd iu gy z fp ld fr fs le fu fw is bi translated">博览会Google Play上的应用</h2><div class="lf l"><h3 class="bd b gy z fp ld fr fs le fu fw dk translated">开始使用您的Android设备和计算机构建丰富的体验。Expo是一个开发工具，用于创建…</h3></div><div class="lg l"><p class="bd b dl z fp ld fr fs le fu fw dk translated">play.google.com</p></div></div><div class="lh l"><div class="oo l lj lk ll lh lm jv ky"/></div></div></a></div><p id="3e3a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">一个二维码将出现在你的控制台上，一个浏览器窗口将显示你正在运行的expo服务器。</p><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi op"><img src="../Images/0cdefe07a715ed6e6182b9f6332ced2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SEixcDX7iqLDdbGmfWebUQ.png"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">下载Android/IOS版Expo应用程序，扫描二维码即可在手机上查看实时更新。您可能必须在同一个网络上才能工作。</figcaption></figure><p id="dd21" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您的Amplify后端已经完成上传模板，下载连接您的客户端到Amplify所需的2个NPM包</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="cefb" class="nb lp it mx b gy nc nd l ne nf">npm install --save aws-amplify aws-amplify-react-native</span></pre><h1 id="5314" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">最终的客户代码</h1><p id="1835" class="pw-post-body-paragraph jx jy it jz b ka mm kc kd ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku im bi translated">现在，为了完成我们的应用程序，我们需要添加React本机代码。我建议在您的/src文件夹中创建一个新文件Root.js。从App.js引用Root.js，用Amplify withAuthenticator()包装。用Amplify.configure()连接生成的aws-exports.js文件。该文件用于在Root.js中使用Amplify之前设置所有配置。</p><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi oq"><img src="../Images/5158eb5fe0db94d0189cefcd3e4478c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ME2Arfd8qqwkjmybJdbVg.png"/></div></div></figure><h1 id="6263" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">Root.js</h1><p id="e1f0" class="pw-post-body-paragraph jx jy it jz b ka mm kc kd ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku im bi translated">我们将在这个文件中完成大部分工作。这样做的原因是，我们使用App.js链接到Cognito，我们希望在实际调用API之前对用户进行身份验证。我会解释你在这两个文件里看到了什么。</p><p id="4870" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">进口</strong></p><ul class=""><li id="6bf4" class="ng nh it jz b ka kb ke kf ki ni km nj kq nk ku nl nm nn no bi translated"><strong class="jz iu"> { withAuthenticator } </strong>在我们的导出中用作特设，用预先制作的授权接口包装整个应用程序。</li><li id="0958" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated"><strong class="jz iu"> Amplify，{ API，graphqlOperation } </strong>用于用从我们生成的/graphql目录导入的函数调用我们的API。</li><li id="cb9c" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated"><strong class="jz iu"> *作为查询、突变、订阅</strong>是我们用来调用GraphQL函数的由Amplify生成的代码。</li><li id="ae03" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated"><strong class="jz iu"> { awsmobile } </strong>是Amplify用我们的API端点、Cognito键等生成的文件。不要将此文件存储在存储库中。</li><li id="d2cb" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated"><strong class="jz iu">amplify . configure(AWS mobile)</strong>是实际连接我们的键、端点等的过程。给我们的客户。</li><li id="62d2" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">而<strong class="jz iu"> react-native导入</strong>是React Native用来编译到Android Java和IOS Swift的组件。</li></ul><h1 id="b6e1" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">脏污</h1><p id="41f2" class="pw-post-body-paragraph jx jy it jz b ka mm kc kd ke mn kg kh ki mo kk kl km mp ko kp kq mq ks kt ku im bi translated">在Root.js文件中，我创建了一些简单的函数，用于添加和删除引号，以及使用强大的GraphQL订阅将实时数据流发送到我们的GUI。简而言之，每次“createQuote”成功返回数据时，它都会在订阅中被侦听，我们可以将它添加到我们的状态数组中。我们将componentDidMount()中的所有订阅设置为只调用一次，并调用query . list quotes。</p><figure class="ms mt mu mv gt jt"><div class="bz fp l di"><div class="or os l"/></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">功能的完整客户端代码</figcaption></figure><figure class="ms mt mu mv gt jt gh gi paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="gh gi ot"><img src="../Images/828e38551b6ca48a8dbce4bdfe01dbba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-v5NtKoyBt5GBl2Jg5Vtog.jpeg"/></div></div></figure><h1 id="056f" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">现在怎么办？</h1><ul class=""><li id="d4a2" class="ng nh it jz b ka mm ke mn ki ou km ov kq ow ku nl nm nn no bi translated">我们有一个非常简单的移动应用程序。我将继续添加样式和动画。我可能会在另一个更侧重于React本机的教程中写这方面的内容。</li><li id="52ff" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">遵循本世博会指南，你可以签署一份APK。这会给你一个工作的Android/IOS应用程序。</li><li id="fc59" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">该应用程序实时运行。如果更多的用户使用该应用程序登录，GraphQL订阅将实时更新所有内容。</li><li id="627b" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">在我的schema.graph模型文件中，我添加了@auth ( "owner ")，强制CRUD只获取您自己的项目。因此，只有我的报价会出现在这里。如果您希望所有用户都能看到所有报价，请删除此选项。</li><li id="34e7" class="ng nh it jz b ka np ke nq ki nr km ns kq nt ku nl nm nn no bi translated">使用的名称是您在注册屏幕上注册的名称。使用Amplify的withAuthenticate()函数，注册屏幕围绕着应用程序本身。</li></ul></div><div class="ab cl ox oy hx oz" role="separator"><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc pd"/><span class="pa bw bk pb pc"/></div><div class="im in io ip iq"><p id="9851" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个应用程序“引用”，我将与我的朋友们一起使用来添加彼此的引用，我会添加更多的功能来改变引用的作者等</p><p id="a6e9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">感谢您的阅读，让您的移动应用流畅起来。我会继续写文章来推广Amplify，因为我发现它对测试我的许多想法非常有用。</p></div></div>    
</body>
</html>