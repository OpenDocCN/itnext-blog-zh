<html>
<head>
<title>Elastic Stack: an overview and ELK installation on Ubuntu 20.04</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">弹性堆栈:概述和ELK在Ubuntu 20.04上的安装</h1>
<blockquote>原文：<a href="https://itnext.io/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04-e4bc61c69c7b?source=collection_archive---------9-----------------------#2022-02-22">https://itnext.io/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04-e4bc61c69c7b?source=collection_archive---------9-----------------------#2022-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/28746bf442f63ce2c9098c7b83f5c3ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*v0-ZzcOazei8SnvsMn82JA.png"/></div></figure><p id="7e61" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我最后一次与麋鹿栈合作是在大约7年前，参见<a class="ae ks" href="https://rtfm.co.ua/centos-ustanovka-elasticsearch-logstash-kibana-elk/" rel="noopener ugc nofollow" target="_blank">麋鹿:установкаelastic search+Logstash+ki BanaнаCentOS</a>。</p><p id="9143" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目前，我们正在使用<a class="ae ks" href="http://Logz.io" rel="noopener ugc nofollow" target="_blank"> Logz.io </a>，但是它的成本越来越高，所以我们开始寻找在我们的AWS弹性Kubernetes服务集群上运行的自托管ELK解决方案。</p><p id="fd17" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，目前的任务是旋转弹性堆栈，检查如何将其安装在Ubuntu 20.04上，使用Filebeat配置日志收集，使用Logstash进行转换，保存到Elasticsearch数据库，使用Kibana显示，并查看所有这些组件如何在幕后协同工作。</p><p id="1e21" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">主要目标是检查它们的配置，并了解它们是如何协同工作的。这将“像一个生产设置”，所以我们不会检查一些Kinaa设置，如用户认证，而是我们会看看<code class="fe kt ku kv kw b">grok</code>，弹性搜索索引，等等。</p><p id="f767" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">尽管如此，像往常一样，我会在帖子的末尾添加一些链接。</p><p id="d3b4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记住:“<strong class="jw ir"> <em class="kx"> 10个小时的调试和尝试，看看它是如何工作的，将为您节省10分钟阅读文档的时间”</em> </strong>。</p><h1 id="3f81" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">内容</h1><ul class=""><li id="0b83" class="lw lx iq jw b jx ly kb lz kf ma kj mb kn mc kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elastic_Stack_components_overview" rel="noopener ugc nofollow" target="_blank">弹性堆栈:组件概述</a></li><li id="fb6c" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Create_an_AWS_%D0%95%D0%A12" rel="noopener ugc nofollow" target="_blank">创建AWSес2</a></li><li id="085b" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elastic_StackELK_installation_on_Ubuntu_2004" rel="noopener ugc nofollow" target="_blank">Ubuntu 20.04上的弹性堆栈/ELK安装</a></li><li id="945a" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elasticsearch_installation" rel="noopener ugc nofollow" target="_blank">弹性搜索装置</a></li><li id="1aec" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elasticsearch_Index" rel="noopener ugc nofollow" target="_blank">弹性搜索指数</a></li><li id="5bfc" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#View_an_Index" rel="noopener ugc nofollow" target="_blank">查看索引</a></li><li id="ea70" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Create_an_Index" rel="noopener ugc nofollow" target="_blank">创建一个索引</a></li><li id="6714" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Create_a_document_in_an_index" rel="noopener ugc nofollow" target="_blank">在索引中创建文档</a></li><li id="afbd" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Searching_an_index" rel="noopener ugc nofollow" target="_blank">搜索索引</a></li><li id="ab37" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Delete_an_index" rel="noopener ugc nofollow" target="_blank">删除一个索引</a></li><li id="4ffe" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_installation" rel="noopener ugc nofollow" target="_blank">日志存储安装</a></li><li id="367c" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Working_with_Logstash_pipelines" rel="noopener ugc nofollow" target="_blank">使用Logstash管道</a></li><li id="ba86" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_Input_and_Output" rel="noopener ugc nofollow" target="_blank"> Logstash输入和输出</a></li><li id="ca93" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_Filter_grok" rel="noopener ugc nofollow" target="_blank">日志存储过滤器:grok </a></li><li id="5921" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_Input_file" rel="noopener ugc nofollow" target="_blank">日志存储输入:文件</a></li><li id="7d42" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_output_elasticsearch" rel="noopener ugc nofollow" target="_blank"> Logstash输出:elasticsearch </a></li><li id="2016" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Filebeat_installation" rel="noopener ugc nofollow" target="_blank"> Filebeat安装</a></li><li id="7584" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Kibana_installation" rel="noopener ugc nofollow" target="_blank">基巴纳装置</a></li><li id="f898" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_Filebeat_and_NGINX_configuration_example" rel="noopener ugc nofollow" target="_blank"> Logstash、Filebeat和NGINX:配置示例</a></li><li id="380e" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Filebeat_Inputs_configguration" rel="noopener ugc nofollow" target="_blank"> Filebeat输入配置</a></li><li id="c781" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash_configuration" rel="noopener ugc nofollow" target="_blank">日志存储配置</a></li><li id="f965" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Useful_links" rel="noopener ugc nofollow" target="_blank">有用的链接</a></li><li id="c0b9" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elastic_Stack" rel="noopener ugc nofollow" target="_blank">弹性栈</a></li><li id="35d9" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Elasticsearch" rel="noopener ugc nofollow" target="_blank">弹性搜索</a></li><li id="f7c6" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Logstash" rel="noopener ugc nofollow" target="_blank">日志存储</a></li><li id="fb20" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/#Filebeat" rel="noopener ugc nofollow" target="_blank"> Filebeat </a></li></ul><h1 id="2878" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">弹性堆栈:组件概述</h1><p id="cbe8" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">Elastic Stack，以前被称为ELK(elastic search+Logstash+Kibana ),是最著名和最广泛使用的日志收集和聚合系统之一。此外，它还可以用来显示来自服务的指标—云、服务器等。</p><p id="e283" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">弹性堆栈由三个主要组件组成:</p><ul class=""><li id="dfbe" class="lw lx iq jw b jx jy kb kc kf mp kj mq kn mr kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">elastic search</strong></a>:使用<a class="ae ks" href="https://opster.com/guides/elasticsearch/glossary/elasticsearch-index/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch Index </a>的具有快速搜索功能的数据库</li><li id="4b8b" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/logstash/" rel="noopener ugc nofollow" target="_blank"/></li><li id="d79c" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/kibana/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> Kibana </strong> </a>:显示来自Elasticsearch的数据的web界面</li></ul><p id="382d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">另外，ELK还有一套叫做<strong class="jw ir"> <em class="kx"> Beats </em> </strong>的附加工具用来收集数据。其中，值得一提的是用于收集日志的Filebeat和用于收集CPU、内存、磁盘等信息的Metricbeat。另请参见<a class="ae ks" href="https://rtfm.co.ua/en/logz-io-collection-logs-from-kubernetes-fluentd-vs-filebeat/" rel="noopener ugc nofollow" target="_blank"> Logz.io:来自Kubernetes的收集日志— fluentd与filebeat </a>。</p><p id="fdbd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，堆栈的工作流程如下:</p><ol class=""><li id="abcb" class="lw lx iq jw b jx jy kb kc kf mp kj mq kn mr kr ms me mf mg bi translated">服务器生成数据，例如日志</li><li id="c59b" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">然后由本地Beat应用程序收集数据，对于日志，这将是Filebeat(虽然这不是强制性的，日志可以由Logstash本身收集)，然后将数据发送到Logstash或直接发送到Elastisearch数据库</li><li id="8f4e" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">Logstash从各种来源收集数据(从Beats，或通过直接收集数据)，进行必要的转换，如添加/删除字段，然后将数据传递给Elastisearch数据库</li><li id="8875" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">Elasticsearch用于存储数据和快速搜索</li><li id="fe0a" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">Kibana用于通过web界面显示来自Elastisearch数据库的数据</li></ol><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mt"><img src="../Images/3a135fd207ee5abf05c045d0672cae1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Itc9Bku-3GYoPFTo.png"/></div></div></figure><h1 id="89fc" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建AWSес2</h1><p id="be5d" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">因此，让我们继续安装过程。</p><p id="a689" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将使用Ubuntu 20.04，运行在AWS EC2实例上。</p><p id="c693" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将使用一个“清晰”的系统——没有任何Docker或Kubernetes集成，一切都将直接在主机上完成。</p><p id="e52a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">所使用的方案对于栈来说是常见的:Elasticsearch用于存储数据，Filebeat用于从日志中收集数据，Logstash用于处理数据并将数据推送到弹性索引，Kibana用于可视化。</p><p id="a84a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入<em class="kx"> AWS控制台&gt; EC2 &gt;实例</em>，新建一个，选择Ubuntu OS:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nc"><img src="../Images/8b4f04814a866ac41445c56481266f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ff9eDziGB8tdiHyA.png"/></div></div></figure><p id="35dc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们选择<code class="fe kt ku kv kw b">c5.2xlarge</code>实例type - 4 vCPU，9 GB RAM，因为Elasticsaerch在热爱内存和CPU的Java上工作，Logstash用<a class="ae ks" href="https://www.jruby.org/" rel="noopener ugc nofollow" target="_blank"> JRuby </a>编写:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nd"><img src="../Images/1c0f0687976ff3566ff204fb581b2208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dIVgSloj-UXelBZp.png"/></div></div></figure><p id="98ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">网络设置可以保留默认设置，因为这也是一种概念验证，所以无需深入探究:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ne"><img src="../Images/8e23aace2873127af3d995b265103aca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*49nD-G9WUIWyzi00.png"/></div></div></figure><p id="eb16" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">稍后，我们将添加一个弹性IP。</p><p id="5044" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将实例的磁盘大小增加到50 GB:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nf"><img src="../Images/93ce0ee2415a731f2a14906a9f3db92c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7j9ay-PQ1qOZKd1q.png"/></div></div></figure><p id="2d34" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在安全组中，从您的IP打开SSH和端口5601 (Kibana ):</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ng"><img src="../Images/f3b307de5ad75aaa16b15a687703985f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s81Lzo9p33J_WyNr.png"/></div></div></figure><p id="9020" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在更像生产的设置中，我们将不得不在使用SSL的Kibana之前拥有一些NGINX或入口资源。现在，按“原样”运行它。</p><p id="00ab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个新的RSA密钥对(<strong class="jw ir"> <em class="kx">提示</em> </strong> <em class="kx">:在其名称</em>中包含一个密钥的AWS区域是一个好主意，保存它:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/340c9532a7c53756868e4e6b4a83a17b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/0*idsxHs2s3p5uvk50.png"/></div></figure><p id="f162" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到弹性IP地址，获取新的EIP:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ni"><img src="../Images/f5cdd8ed82e18335dd5e516a75215b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cu28Vdh9B3dA_P8P.png"/></div></div></figure><p id="a01a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将其附加到EC2实例:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nj"><img src="../Images/e68205a54ec62d4d6cc928b7299c2fe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M7qu3HiGtz26iasy.png"/></div></div></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi nk"><img src="../Images/3603e05a3ab347c21db5fea967581ecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C3t56or2CeitUUMk.png"/></div></div></figure><p id="ffad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在您的工作站上，更改密钥的权限，使其仅对您的用户可读:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="5b08" class="np kz iq kw b gy nq nr l ns nt">$ chmod 600 ~/Temp/elk-test-eu-west-2.pem</span></pre><p id="fa84" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查连接:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="0baa" class="np kz iq kw b gy nq nr l ns nt">$ ssh -i ~/Temp/elk-test-eu-west-2.pem ubuntu@18.135.74.203<br/>…<br/>ubuntu@ip-172–31–43–4:~$</span></pre><p id="8a1b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">升级系统:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="fe4c" class="np kz iq kw b gy nq nr l ns nt">ubuntu@ip-172–31–43–4:~$ sudo -s<br/>root@ip-172–31–43–4:/home/ubuntu# apt update &amp;&amp; apt -y upgrade</span></pre><p id="9719" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">升级后重新启动它以加载新的内核:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="0006" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# reboot</span></pre><p id="8b55" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并转到ELK组件安装。</p><h1 id="2c71" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Ubuntu 20.04上的弹性堆栈/ELK安装</h1><p id="3a7e" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">添加弹性搜索存储库:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="226d" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# wget -qO — <a class="ae ks" href="https://artifacts.elastic.co/GPG-KEY-elasticsearch" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/GPG-KEY-elasticsearch</a> | sudo apt-key add -<br/>OK</span><span id="676c" class="np kz iq kw b gy nu nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt -y install apt-transport-https</span><span id="c700" class="np kz iq kw b gy nu nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# sh -c 'echo "deb <a class="ae ks" href="https://artifacts.elastic.co/packages/7.x/apt" rel="noopener ugc nofollow" target="_blank">https://artifacts.elastic.co/packages/7.x/apt</a> stable main" &gt; /etc/apt/sources.list.d/elastic-7.x.list'</span></pre><h2 id="0f2e" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">弹性搜索装置</h2><p id="5343" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">安装<code class="fe kt ku kv kw b">elasticsearch</code>包:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="81de" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt update &amp;&amp; apt -y install elasticsearch</span></pre><p id="75c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Elastic的配置文件— <code class="fe kt ku kv kw b">/etc/elasticsearch/elasticsearch.yml</code>。</p><p id="e34d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加一个新参数— <code class="fe kt ku kv kw b"><a class="ae ks" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-settings.html" rel="noopener ugc nofollow" target="_blank">discovery.type: single-node</a></code>，因为我们的Elasticsearch将作为单个节点工作，而不是作为一个集群。</p><p id="f350" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果需要更新JVM选项，请使用<code class="fe kt ku kv kw b">/etc/elasticsearch/jvm.options</code>。</p><p id="8f14" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-minimal-setup.html" rel="noopener ugc nofollow" target="_blank">中描述的用户和认证为Elasticsearch </a>设置了最低限度的安全性，但是现在我们将跳过这一步——对于测试，我们已经在EC2的AWS SecurityGroup中设置了限制就足够了。</p><p id="ac94" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启动服务，将其添加到自动启动:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="a42e" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl start elasticsearch<br/>root@ip-172–31–43–4:/home/ubuntu# systemctl enable elasticsearch</span></pre><p id="1562" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查对<a class="ae ks" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html" rel="noopener ugc nofollow" target="_blank"> Elasticseacrh API </a>的访问:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="8cc9" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -X GET "localhost:9200"<br/>{<br/>“name” : “ip-172–31–43–4”,<br/>“cluster_name” : “elasticsearch”,<br/>“cluster_uuid” : “8kVCdVRySfKutRjPkkVr5w”,<br/>“version” : {<br/>“number” : “7.16.3”,<br/>“build_flavor” : “default”,<br/>“build_type” : “deb”,<br/>“build_hash” : “4e6e4eab2297e949ec994e688dad46290d018022”,<br/>“build_date” : “2022–01–06T23:43:02.825887787Z”,<br/>“build_snapshot” : false,<br/>“lucene_version” : “8.10.1”,<br/>“minimum_wire_compatibility_version” : “6.8.0”,<br/>“minimum_index_compatibility_version” : “6.0.0-beta1”<br/>},<br/>“tagline” : “You Know, for Search”<br/>}</span></pre><p id="76a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">日志在<code class="fe kt ku kv kw b">/var/log/elasticsearch</code>中可用，数据存储在<code class="fe kt ku kv kw b">/var/lib/elasticsearch</code>目录中。</p><h2 id="8e5d" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">弹性搜索指数</h2><p id="0237" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">让我们简短地概述一下Elastiseacrh中的索引，以及如何通过API访问它们。</p><p id="769a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">事实上，你可以把它们想象成像MySQL一样的RDBMS系统中的数据库。数据库存储<em class="kx">文档</em>，这些文档是特定<em class="kx">类型</em>的JSON对象。</p><p id="fe20" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">索引被分成碎片——存储在一个或多个Elastisearch节点上的数据段，但是碎片和聚类不在本文的讨论范围之内。</p><h2 id="51c1" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">查看索引</h2><p id="3144" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">要查看所有索引，请使用<code class="fe kt ku kv kw b">GET _cat/indices?v</code>请求:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="4e8a" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/_cat/indices?v<br/>health status index uuid pri rep docs.count docs.deleted store.size pri.store.size<br/>green open .geoip_databases 2E8sIYX0RaiqyZWzPHYHfQ 1 0 42 0 40.4mb 40.4mb</span></pre><p id="84f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">目前，我们只能看到Elastic自己的名为<code class="fe kt ku kv kw b">.geoip_databases</code>的索引，其中包含IP块和相关区域的列表。稍后，它可以用来将访问者的信息添加到NGINX访问日志的数据中。</p><h2 id="cbaa" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">创建索引</h2><p id="8a34" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">添加新的空索引:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="bc44" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -X PUT localhost:9200/example_index?pretty<br/>{<br/>“acknowledged” : true,<br/>“shards_acknowledged” : true,<br/>“index” : “example_index”<br/>}</span></pre><p id="4e3a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查一下:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="ace5" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/_cat/indices?v<br/>health status index uuid pri rep docs.count docs.deleted store.size pri.store.size<br/>green open .geoip_databases 2E8sIYX0RaiqyZWzPHYHfQ 1 0 42 0 40.4mb 40.4mb<br/>yellow open example_index akWscE7MQKy_fceS9ZMGGA 1 1 0 0 226b 226b</span></pre><p id="1e15" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe kt ku kv kw b">example_index</code>——这是我们的新索引。</p><p id="042c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并检查索引本身:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="bb1b" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/example_index?pretty<br/>{<br/>“example_index” : {<br/>“aliases” : { },<br/>“mappings” : { },<br/>“settings” : {<br/>“index” : {<br/>“routing” : {<br/>“allocation” : {<br/>“include” : {<br/>“_tier_preference” : “data_content”<br/>}<br/>}<br/>},<br/>“number_of_shards” : “1”,<br/>“provided_name” : “example_index”,<br/>“creation_date” : “1642848658111”,<br/>“number_of_replicas” : “1”,<br/>“uuid” : “akWscE7MQKy_fceS9ZMGGA”,<br/>“version” : {<br/>“created” : “7160399”<br/>}<br/>}<br/>}<br/>}<br/>}</span></pre><h2 id="ffcf" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">在索引中创建文档</h2><p id="fcf4" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">让我们向上面创建的索引添加一个简单的文档:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="a1af" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -H 'Content-Type: application/json' -X POST localhost:9200/example_index/document1?pretty -d ‘{ “name”: “Just an example doc” }’<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “rhF0gX4Bbs_W8ADHlfFY”,<br/>“_version” : 1,<br/>“result” : “created”,<br/>“_shards” : {<br/>“total” : 2,<br/>“successful” : 1,<br/>“failed” : 0<br/>},<br/>“_seq_no” : 2,<br/>“_primary_term” : 1<br/>}</span></pre><p id="a016" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<code class="fe kt ku kv kw b">_search</code>操作检查索引的所有内容:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="0aac" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/example_index/_search?pretty<br/>{<br/>“took” : 3,<br/>“timed_out” : false,<br/>“_shards” : {<br/>“total” : 1,<br/>“successful” : 1,<br/>“skipped” : 0,<br/>“failed” : 0<br/>},<br/>“hits” : {<br/>“total” : {<br/>“value” : 2,<br/>“relation” : “eq”<br/>},<br/>“max_score” : 1.0,<br/>“hits” : [<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “qxFzgX4Bbs_W8ADHTfGi”,<br/>“_score” : 1.0,<br/>“_source” : {<br/>“name” : “Just an example doc”<br/>}<br/>},<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “rhF0gX4Bbs_W8ADHlfFY”,<br/>“_score” : 1.0,<br/>“_source” : {<br/>“name” : “Just an example doc”<br/>}<br/>}<br/>]<br/>}<br/>}</span></pre><p id="c86e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用文档ID —获取其内容:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="0e52" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -X GET 'localhost:9200/example_index/document1/qxFzgX4Bbs_W8ADHTfGi?pretty'<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “qxFzgX4Bbs_W8ADHTfGi”,<br/>“_version” : 1,<br/>“_seq_no” : 0,<br/>“_primary_term” : 1,<br/>“found” : true,<br/>“_source” : {<br/>“name” : “Just an example doc”<br/>}<br/>}</span></pre><h2 id="2d83" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">搜索索引</h2><p id="2936" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">此外，我们可以在索引中进行快速搜索。</p><p id="ce9d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们寻找由<code class="fe kt ku kv kw b">name</code>字段和文档的部分内容组成的"<em class="kx">doc</em>word:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="b95f" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -H 'Content-Type: application/json' -X GET 'localhost:9200/example_index/_search?pretty' -d { “query”: { "match": { "name": "doc" } } }'<br/>{<br/>“took” : 2,<br/>“timed_out” : false,<br/>“_shards” : {<br/>“total” : 1,<br/>“successful” : 1,<br/>“skipped” : 0,<br/>“failed” : 0<br/>},<br/>“hits” : {<br/>“total” : {<br/>“value” : 2,<br/>“relation” : “eq”<br/>},<br/>“max_score” : 0.18232156,<br/>“hits” : [<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “qxFzgX4Bbs_W8ADHTfGi”,<br/>“_score” : 0.18232156,<br/>“_source” : {<br/>“name” : “Just an example doc”<br/>}<br/>},<br/>{<br/>“_index” : “example_index”,<br/>“_type” : “document1”,<br/>“_id” : “rhF0gX4Bbs_W8ADHlfFY”,<br/>“_score” : 0.18232156,<br/>“_source” : {<br/>“name” : “Just an example doc”<br/>}<br/>}<br/>]<br/>}<br/>}</span></pre><h2 id="f66d" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">删除索引</h2><p id="aadf" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">使用<code class="fe kt ku kv kw b">DELETE</code>并指定要删除的索引名称:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="2835" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -X DELETE localhost:9200/example_index<br/>{“acknowledged”:true}</span></pre><p id="9f83" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好了，现在，我们已经了解了什么是索引，以及如何使用它们。</p><p id="b1b3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们继续安装Logstash。</p><h2 id="38e1" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Logstash安装</h2><p id="8efb" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">安装Logstash，它已经存在于我们之前添加的弹性存储库中:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="3bfd" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt -y install logstash</span></pre><p id="93e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行服务:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="c414" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl start logstash<br/>root@ip-172–31–43–4:/home/ubuntu# systemctl enable logstash<br/>Created symlink /etc/systemd/system/multi-user.target.wants/logstash.service → /etc/systemd/system/logstash.service.</span></pre><p id="ffbd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">主配置文件— <code class="fe kt ku kv kw b">/etc/logstash/logstash.yml</code>，对于我们的配置文件，我们将使用<code class="fe kt ku kv kw b">/etc/logstash/conf.d/</code>目录。</p><p id="2f4d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它的输出(stdout) Logstash将写入<code class="fe kt ku kv kw b">/var/logs/syslog</code>。</p><h2 id="9ba4" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">使用Logstash管道</h2><p id="3e39" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">参见<a class="ae ks" href="https://www.elastic.co/guide/en/logstash/current/pipeline.html" rel="noopener ugc nofollow" target="_blank">log stash如何工作</a>。</p><p id="2e25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Logstash中的管道描述了一个链:输入&gt;过滤&gt;输出。</p><p id="ec2b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在输入中，我们可以使用例如<code class="fe kt ku kv kw b">file</code>、<code class="fe kt ku kv kw b">stdin</code>或<code class="fe kt ku kv kw b">beats</code>这样的输入。</p><h2 id="cb61" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">输入和输出</h2><p id="7000" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">为了了解Logstash一般是如何工作的，让我们创建一个最简单的管道，通过它的<code class="fe kt ku kv kw b">stdin</code>接收数据，并通过<code class="fe kt ku kv kw b">stdout</code>将数据打印到终端。</p><p id="2358" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">测试Logstash最简单的方法是直接运行它的bin文件，并通过<code class="fe kt ku kv kw b">-e</code>传递配置选项:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="7e7d" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# /usr/share/logstash/bin/logstash -e 'input { stdin { } } output { stdout {} }'<br/>…<br/>The stdin plugin is now waiting for input:<br/>Hello, World!<br/>{<br/>“message” =&gt; “Hello, World!”,<br/>“@version” =&gt; “1”,<br/>“@timestamp” =&gt; 2022–01–22T11:30:33.971Z,<br/>“host” =&gt; “ip-172–31–43–4”<br/>}</span></pre><h2 id="1d0b" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">日志存储过滤器:<code class="fe kt ku kv kw b">grok</code></h2><p id="8f95" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">还有一个很基础的<code class="fe kt ku kv kw b"><a class="ae ks" href="https://logz.io/blog/logstash-grok/" rel="noopener ugc nofollow" target="_blank">grok</a></code>例子。</p><p id="956d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个名为<code class="fe kt ku kv kw b">logstash-test.conf</code>的文件:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="2b5b" class="np kz iq kw b gy nq nr l ns nt">input { stdin { } }<br/><br/>filter {<br/>    grok {<br/>      match =&gt; { "message" =&gt; "%{GREEDYDATA}" }<br/>    }<br/>}<br/><br/>output {<br/>  stdout { }<br/>}</span></pre><p id="0bdb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，在<code class="fe kt ku kv kw b">filter</code>中我们使用了<code class="fe kt ku kv kw b">grok</code>，它将在消息文本中搜索匹配。</p><p id="ae28" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于这样的搜索，<code class="fe kt ku kv kw b">grok</code>使用正则表达式模式。在上面的例子中，我们使用了<code class="fe kt ku kv kw b"><a class="ae ks" href="https://github.com/logstash-plugins/logstash-patterns-core/blob/main/patterns/legacy/grok-patterns#L17" rel="noopener ugc nofollow" target="_blank">GREEDYDATA</a></code>过滤器，它对应于<code class="fe kt ku kv kw b">.*</code>正则表达式，即任何符号。</p><p id="39f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">再次运行Logstash，但是这次使用<code class="fe kt ku kv kw b">-f</code>而不是<code class="fe kt ku kv kw b">-e</code>并传递文件名:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="9f06" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# /usr/share/logstash/bin/logstash -f logstash-test.conf<br/>…<br/>The stdin plugin is now waiting for input:<br/>Hello, Grok!<br/>{<br/>“message” =&gt; “Hello, Grok!”,<br/>“@timestamp” =&gt; 2022–01–22T11:33:49.797Z,<br/>“@version” =&gt; “1”,<br/>“host” =&gt; “ip-172–31–43–4”<br/>}</span></pre><p id="76a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好吧。</p><p id="1961" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们尝试做一些数据转换，例如，让我们添加一个名为"<em class="kx"> Example </em>"的新标签和两个新字段:一个将只包含一个文本"<em class="kx"> Example value </em>"，在第二个字段中，我们将添加收到消息的时间:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="bd4a" class="np kz iq kw b gy nq nr l ns nt">input { stdin { } }<br/>filter {<br/>    grok {<br/>      match =&gt; { "message" =&gt; "%{GREEDYDATA:my_message}" }<br/>      add_tag =&gt; ["Example"]<br/>      add_field =&gt; [ "example_field", "Example value" ]<br/>      add_field =&gt; [ "received_at", "%{@timestamp}" ]<br/>    }<br/>}<br/>output {<br/>  stdout { }<br/>}</span></pre><p id="a0ba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行它:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="472d" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# /usr/share/logstash/bin/logstash -f logstash-test.conf<br/>…<br/>Hello again, Grok!<br/>{<br/>“message” =&gt; “Hello again, Grok!”,<br/>“host” =&gt; “ip-172–31–43–4”,<br/>“tags” =&gt; [<br/>[0] “Example”<br/>],<br/>“received_at” =&gt; “2022–01–22T11:36:46.893Z”,<br/>“my_message” =&gt; “Hello again, Grok!”,<br/>“@timestamp” =&gt; 2022–01–22T11:36:46.893Z,<br/>“example_field” =&gt; “Example value”,<br/>“@version” =&gt; “1”<br/>}</span></pre><h2 id="611a" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Logstash输入:<code class="fe kt ku kv kw b">file</code></h2><p id="09e2" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">好的，现在让我们尝试一些不同的东西，例如，让我们从<code class="fe kt ku kv kw b">/var/log/syslog</code>日志文件中读取数据。</p><p id="614d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，检查文件的内容:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="0b67" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# tail -1 /var/log/syslog<br/>Jan 22 11:41:49 ip-172–31–43–4 logstash[8099]: [2022–01–22T11:41:49,476][INFO ][logstash.agent ] Successfully started Logstash API endpoint {:port=&gt;9601, :ssl_enabled=&gt;false}</span></pre><p id="a3b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是什么？</p><ol class=""><li id="8f02" class="lw lx iq jw b jx jy kb kc kf mp kj mq kn mr kr ms me mf mg bi translated">数据和时间— <code class="fe kt ku kv kw b">Jan 22 11:41:49</code></li><li id="fa3f" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">主持人— <code class="fe kt ku kv kw b">ip-172-31-43-4</code></li><li id="70b0" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">程序名— <code class="fe kt ku kv kw b">logstash</code></li><li id="471b" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">一个过程PID — <code class="fe kt ku kv kw b">8099</code></li><li id="7f92" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">和信息本身</li></ol><p id="c97a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们的过滤器中，让我们再次使用<code class="fe kt ku kv kw b">grok</code>，并在它的<code class="fe kt ku kv kw b">match</code>中指定模式和字段:让我们添加<code class="fe kt ku kv kw b"><a class="ae ks" href="https://github.com/logstash-plugins/logstash-patterns-core/blob/main/patterns/legacy/grok-patterns#L81" rel="noopener ugc nofollow" target="_blank">SYSLOGTIMESTAMP</a></code>，而不是将所有数据保存在“消息”字段中的<code class="fe kt ku kv kw b">GREEDYDATA</code>，它将在值<em class="kx">1月21日14:06:23 </em>时被触发，并且该值将被保存到<code class="fe kt ku kv kw b">syslog_timestamp</code>字段，而<code class="fe kt ku kv kw b">SYSLOGHOST</code>、<code class="fe kt ku kv kw b">DATA</code>、<code class="fe kt ku kv kw b">POSINT</code>以及我们将使用已知的<code class="fe kt ku kv kw b">GREEDYDATA</code>获得的其余数据，并将被保存</p><p id="45d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">同样，让我们添加两个额外的字段— <code class="fe kt ku kv kw b">received_at</code>和<code class="fe kt ku kv kw b">received_from</code>，并将使用在<code class="fe kt ku kv kw b">macth</code>中解析的数据，然后让我们删除原来的<code class="fe kt ku kv kw b">message</code>字段，因为我们已经在<code class="fe kt ku kv kw b">syslog_message</code>中保存了必要的数据:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="d8b0" class="np kz iq kw b gy nq nr l ns nt">input { <br/>  file {<br/>    path =&gt; "/var/log/syslog"<br/>  }<br/>}<br/><br/>filter {<br/>    grok {<br/>      match =&gt; { "message" =&gt; "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}" }<br/>      add_field =&gt; [ "received_at", "%{@timestamp}" ]<br/>      add_field =&gt; [ "received_from", "%{host}" ]<br/>      remove_field =&gt; "message"<br/>    }<br/>}<br/><br/>output {<br/>  stdout { }<br/>}</span></pre><p id="8284" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行它:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="53aa" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# /usr/share/logstash/bin/logstash -f logstash-test.conf<br/>…<br/>{<br/>“host” =&gt; “ip-172–31–43–4”,<br/>“path” =&gt; “/var/log/syslog”,<br/>“received_at” =&gt; “2022–01–22T11:48:27.582Z”,<br/>“syslog_message” =&gt; “#011at usr.share.logstash.lib.bootstrap.environment.&lt;main&gt;(/usr/share/logstash/lib/bootstrap/environment.rb:94) ~[?:?]”,<br/>“syslog_timestamp” =&gt; “Jan 22 11:48:27”,<br/>“syslog_program” =&gt; “logstash”,<br/>“syslog_hostname” =&gt; “ip-172–31–43–4”,<br/>“@timestamp” =&gt; 2022–01–22T11:48:27.582Z,<br/>“syslog_pid” =&gt; “9655”,<br/>“@version” =&gt; “1”,<br/>“received_from” =&gt; “ip-172–31–43–4”<br/>}<br/>…</span></pre><p id="c18b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">嗯，不错！</p><h2 id="86f6" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Logstash输出:<code class="fe kt ku kv kw b">elasticsearch</code></h2><p id="e774" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">在上面的例子中，我们已经在终端上打印了所有内容。</p><p id="c0ec" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们尝试将数据保存到一个Elastisearch索引中:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="1c6f" class="np kz iq kw b gy nq nr l ns nt">input {<br/>  file {<br/>    path =&gt; "/var/log/syslog"<br/>  }<br/>}<br/><br/>filter {<br/>    grok {<br/>      match =&gt; { "message" =&gt; "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}" }<br/>      add_field =&gt; [ "received_at", "%{@timestamp}" ]<br/>      add_field =&gt; [ "received_from", "%{host}" ]<br/>      remove_field =&gt; "message"<br/>    }<br/>}<br/><br/>output {<br/>  elasticsearch {<br/>    hosts =&gt; ["localhost:9200"]<br/>  }<br/>  stdout { }<br/>}</span></pre><p id="521a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行它，并检查弹性指数——log stash必须在这里创建一个新的指数:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="228e" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/_cat/indices?v<br/>health status index uuid pri rep docs.count docs.deleted store.size pri.store.size<br/>green open .geoip_databases 2E8sIYX0RaiqyZWzPHYHfQ 1 0 42 0 40.4mb 40.4mb<br/>yellow open logstash-2022.01.22–000001 ekf_ntRxRiitIRcmYI2TOg 1 1 0 0 226b 226b<br/>yellow open example_index akWscE7MQKy_fceS9ZMGGA 1 1 2 1 8.1kb 8.1kb</span></pre><p id="1fb6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">啊哈，我们到了！</p><p id="abab" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们对其进行一些搜索，例如，关于<code class="fe kt ku kv kw b">logstash</code>流程，因为它将其输出保存到<code class="fe kt ku kv kw b">/var/log/syslog</code>文件中:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="2459" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl -H 'Content-Type: application/json' localhost:9200/logstash-2022.01.22–000001/_search?pretty -d '{ "query": { "match": { "syslog_program: "logstash" } } }'<br/>{<br/>“took” : 3,<br/>“timed_out” : false,<br/>“_shards” : {<br/>“total” : 1,<br/>“successful” : 1,<br/>“skipped” : 0,<br/>“failed” : 0<br/>},<br/>“hits” : {<br/>“total” : {<br/>“value” : 36,<br/>“relation” : “eq”<br/>},<br/>“max_score” : 0.33451337,<br/>“hits” : [<br/>{<br/>“_index” : “logstash-2022.01.22–000001”,<br/>“_type” : “_doc”,<br/>“_id” : “9BGogX4Bbs_W8ADHCvJl”,<br/>“_score” : 0.33451337,<br/>“_source” : {<br/>“syslog_program” : “logstash”,<br/>“received_from” : “ip-172–31–43–4”,<br/>“syslog_timestamp” : “Jan 22 11:57:18”,<br/>“syslog_hostname” : “ip-172–31–43–4”,<br/>“syslog_message” : “[2022–01–22T11:57:18,474][INFO ][logstash.runner ] Starting Logstash {\”logstash.version\”=&gt;\”7.16.3\”, \”jruby.version\”=&gt;\”jruby 9.2.20.1 (2.5.8) 2021–11–30 2a2962fbd1 OpenJDK 64-Bit Server VM 11.0.13+8 on 11.0.13+8 +indy +jit [linux-x86_64]\”}”,<br/>“host” : “ip-172–31–43–4”,<br/>“@timestamp” : “2022–01–22T11:59:40.444Z”,<br/>“path” : “/var/log/syslog”,<br/>“@version” : “1”,<br/>“syslog_pid” : “11873”,<br/>“received_at” : “2022–01–22T11:59:40.444Z”<br/>}<br/>},<br/>…</span></pre><p id="779f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">耶！有用！</p><p id="3c75" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们继续吧。</p><h2 id="51d4" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Filebeat安装</h2><p id="db41" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">安装软件包:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="40ce" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt -y install filebeat</span></pre><p id="4bcf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">配置文件— <code class="fe kt ku kv kw b">/etc/filebeat/filebeat.yml</code>。</p><p id="ae44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">默认情况下，Filebeat会将数据直接传递给Elasticsearch实例:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="4930" class="np kz iq kw b gy nq nr l ns nt">...<br/># ================================== Outputs ===================================<br/># Configure what output to use when sending the data collected by the beat.<br/># ---------------------------- Elasticsearch Output ----------------------------<br/>output.elasticsearch:<br/>  # Array of hosts to connect to.<br/>  hosts: ["localhost:9200"]<br/>  # Protocol - either `http` (default) or `https`.<br/>  #protocol: "https"<br/>  # Authentication credentials - either API key or username/password.<br/>  #api_key: "id:api_key"<br/>  #username: "elastic"<br/>  #password: "changeme"<br/>...</span></pre><p id="4a0f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更新文件:添加<code class="fe kt ku kv kw b">/var/log/syslog</code>文件解析，让我们将数据放入Logstash，而不是Elastic。</p><p id="a709" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">配置<code class="fe kt ku kv kw b">filestream</code>输入，现在不要忘记用<code class="fe kt ku kv kw b">enabled: true</code>启用它:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="8843" class="np kz iq kw b gy nq nr l ns nt">...<br/>filebeat.inputs:<br/>...<br/>- type: filestream<br/>  ...<br/>  enabled: true<br/>  ...<br/>  paths:<br/>    - /var/log/syslog<br/>...</span></pre><p id="89db" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">注释<code class="fe kt ku kv kw b">output.elasticsearch</code>块，取消注释<code class="fe kt ku kv kw b">output.logstash</code>:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="c0eb" class="np kz iq kw b gy nq nr l ns nt">...<br/># ---------------------------- Elasticsearch Output ----------------------------<br/>#output.elasticsearch:<br/>  # Array of hosts to connect to.<br/>  #  hosts: ["localhost:9200"]<br/>  ...<br/># ------------------------------ Logstash Output -------------------------------<br/>output.logstash:<br/>  ...<br/>  hosts: ["localhost:5044"]<br/>...</span></pre><p id="0204" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为日志存储创建一个新的配置文件<code class="fe kt ku kv kw b">/etc/logstash/conf.d/beats.conf</code>:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="8da5" class="np kz iq kw b gy nq nr l ns nt">input {<br/>  beats {<br/>    port =&gt; 5044<br/>  }<br/>}<br/>output {<br/>  elasticsearch {<br/>    hosts =&gt; ["http://localhost:9200"]<br/>    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"<br/>  }<br/>}</span></pre><p id="3265" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe kt ku kv kw b">elasticsearch</code>中指定用于保存数据的主机和索引名称。</p><p id="60c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行日志存储:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="312d" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl start logstash</span></pre><p id="e9cf" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查<code class="fe kt ku kv kw b">/var/log/syslog</code>:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="babd" class="np kz iq kw b gy nq nr l ns nt">Jan 22 12:10:34 ip-172–31–43–4 logstash[12406]: [2022–01–22T12:10:34,054][INFO ][org.logstash.beats.Server][main][e3ccc6e9edc43cf62f935b6b4b9cf44b76d887bb01e30240cbc15ab5103fe4b6] Starting server on port: 5044</span></pre><p id="13b1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行Filebeat:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="2500" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl start filebeat</span></pre><p id="7e9b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查弹性指数:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="8ef3" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/_cat/indices?v<br/>health status index uuid pri rep docs.count docs.deleted store.size pri.store.size<br/>green open .geoip_databases 2E8sIYX0RaiqyZWzPHYHfQ 1 0 42 0 40.4mb 40.4mb<br/>yellow open filebeat-7.16.3–2022.01.22 fTUTzKmKTXisHUlfNbobPw 1 1 7084 0 14.3mb 14.3mb<br/>yellow open logstash-2022.01.22–000001 ekf_ntRxRiitIRcmYI2TOg 1 1 50 0 62.8kb 62.8kb<br/>yellow open example_index akWscE7MQKy_fceS9ZMGGA 1 1 2 1 8.1kb 8.1kb</span></pre><p id="3271" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe kt ku kv kw b">filebeat-7.16.3-2022.01.22</code>——在这里。</p><h2 id="5dc5" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">基巴纳装置</h2><p id="43cb" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">安装软件包:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="1279" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt -y install kibana</span></pre><p id="4c27" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑它的配置文件<code class="fe kt ku kv kw b">/etc/kibana/kibana.yml</code>，设置<code class="fe kt ku kv kw b">server.host==0.0.0.0</code>使它可以通过互联网访问。</p><p id="0a28" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行服务:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="aac5" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl start kibana<br/>root@ip-172–31–43–4:/home/ubuntu# systemctl enable kibana</span></pre><p id="b1ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用浏览器检查:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi og"><img src="../Images/6199ded081d7f2b3daf9153fee01354e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0GH8uXi6MZZ0ONCB.png"/></div></div></figure><p id="afe9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">其地位——<code class="fe kt ku kv kw b">/status</code>:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oh"><img src="../Images/0855e5566654ff97b64cdaad1dcc4f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U7XUMw78hs4YbXtB.png"/></div></div></figure><p id="7203" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击<em class="kx">自行探索</em>，进入<em class="kx">管理&gt;堆栈管理</em>:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/8097f41c8d372cbb15829f27f29f312d.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*0QgNT4XZzWNVOI_f.png"/></div></figure><p id="f389" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="kx">索引图案</em>，使用<code class="fe kt ku kv kw b">filebeat-*</code>蒙版为基巴纳创建一个新图案，在右侧会看到，基巴纳已经找到了相应的弹性搜索索引:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oj"><img src="../Images/4b4eb0cb26c10f603cc9ce4300e2464c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wOzBQ6pqS8SovMx8.png"/></div></div></figure><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ok"><img src="../Images/e824a6c9108c85d6949246a285e18fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fmzrfzefEDDe7WZj.png"/></div></div></figure><p id="5728" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们可以看到所有字段，已经由Kibana索引:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ol"><img src="../Images/9d1e100e610853849969541375903c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DzQk_oXsZusgwLlh.png"/></div></div></figure><p id="9d67" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="kx">可观察性—日志</em> s:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/6dfe626360e95a1ee6f4ba1af9ab21a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/0*Wb-fP3QTRTA1vwzO.png"/></div></figure><p id="c790" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且可以看到我们的<code class="fe kt ku kv kw b">/var/log/syslog</code>:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi on"><img src="../Images/0ff34500ef19a1b71c72575c370f3350.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J7p-v8ZTJFfaHLQe.png"/></div></div></figure><h1 id="364a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Logstash、Filebeat和NGINX:配置示例</h1><p id="3f6b" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">现在，让我们从现实世界中做一些事情:</p><ol class=""><li id="8283" class="lw lx iq jw b jx jy kb kc kf mp kj mq kn mr kr ms me mf mg bi translated">安装NGINX</li><li id="d4bd" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">配置Filebeat来收集NGINX的日志</li><li id="2281" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">配置Logstash以接受它们并将数据保存到弹性域</li><li id="e69d" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">并将检查基巴纳</li></ol><p id="669a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装NGINX:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="1425" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# apt -y install nginx</span></pre><p id="1571" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查其日志文件:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="09ca" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# ll /var/log/nginx/<br/>access.log error.log</span></pre><p id="a207" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查web服务器是否工作正常:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="86d1" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:80<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>…</span></pre><p id="d9db" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">и<code class="fe kt ku kv kw b">access.log</code>:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="6327" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# tail -1 /var/log/nginx/access.log<br/>127.0.0.1 — — [26/Jan/2022:11:33:21 +0000] “GET / HTTP/1.1” 200 612 “-” “curl/7.68.0”</span></pre><p id="9d28" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好吧。</p><h2 id="fd5e" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Filebeat输入配置</h2><p id="6274" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">文档— <a class="ae ks" href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html" rel="noopener ugc nofollow" target="_blank">配置输入</a>，而<a class="ae ks" href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-general-options.html" rel="noopener ugc nofollow" target="_blank">配置通用设置</a>。</p><p id="3460" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">编辑<code class="fe kt ku kv kw b">filebeat.inputs</code>块，向<code class="fe kt ku kv kw b">/var/log/syslog</code>输入添加两个新的-用于NGINX的访问和错误日志:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="8268" class="np kz iq kw b gy nq nr l ns nt">...<br/># ============================== Filebeat inputs ===============================<br/><br/>filebeat.inputs:<br/><br/>- type: filestream<br/>  enabled: true<br/>  paths:<br/>    - /var/log/syslog<br/>  fields:<br/>    type: syslog<br/>  fields_under_root: true<br/>  scan_frequency: 5s<br/><br/>- type: log<br/>  enabled: true<br/>  paths:<br/>      - /var/log/nginx/access.log<br/>  fields:<br/>    type: nginx_access<br/>  fields_under_root: true<br/>  scan_frequency: 5s<br/><br/>- type: log<br/>  enabled: true<br/>  paths:<br/>      - /var/log/nginx/error.log<br/>  fields:<br/>    type: nginx_error<br/>  fields_under_root: true<br/>  scan_frequency: 5s<br/>...</span></pre><p id="8da3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，我们使用的是<code class="fe kt ku kv kw b">log</code>类型的输入，并将添加一个新的字段——<code class="fe kt ku kv kw b">type: nginx_access/nginx_error</code>。</p><h2 id="69ca" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">日志存储配置</h2><p id="abdf" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf mm kh ki kj mn kl km kn mo kp kq kr ij bi translated">删除我们之前创建的Logstash的配置文件<code class="fe kt ku kv kw b">/etc/logstash/conf.d/beats.conf</code>，并改写它:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="9772" class="np kz iq kw b gy nq nr l ns nt">input {<br/>  beats {<br/>    port =&gt; 5044<br/>  }<br/>}<br/><br/>filter {<br/>  if [type] == "syslog" {<br/>    grok {<br/>      match =&gt; { "message" =&gt; "%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}" }<br/>      add_field =&gt; [ "received_at", "%{@timestamp}" ]<br/>      add_field =&gt; [ "received_from", "%{host}" ]<br/>      remove_field =&gt; "message"<br/>    }<br/>  }<br/>}<br/><br/>filter {<br/> if [type] == "nginx_access" {<br/>    grok {<br/>        match =&gt; { "message" =&gt; "%{IPORHOST:remote_ip} - %{DATA:user} \[%{HTTPDATE:access_time}\] \"%{WORD:http_method} %{DATA:url} HTTP/%{NUMBER:http_version}\" %{NUMBER:response_code} %{NUMBER:body_sent_bytes} \"%{DATA:referrer}\" \"%{DATA:agent}\"" }<br/>    }<br/>  }<br/>  date {<br/>        match =&gt; [ "timestamp" , "dd/MMM/YYYY:HH:mm:ss Z" ]<br/>  }<br/>  geoip {<br/>         source =&gt; "remote_ip"<br/>         target =&gt; "geoip"<br/>         add_tag =&gt; [ "nginx-geoip" ]<br/>  } <br/>} <br/>  <br/>output {<br/><br/>  if [type] == "syslog" {<br/>    elasticsearch {<br/>      hosts =&gt; ["localhost:9200"]<br/>      index =&gt; "logstash-%{+YYYY.MM.dd}"<br/>    }<br/>  }<br/>  <br/>  if [type] == "nginx_access" {<br/>    elasticsearch { <br/>      hosts =&gt; ["localhost:9200"]<br/>      index =&gt; "nginx-%{+YYYY.MM.dd}"<br/>    }<br/>  }<br/> <br/>  stdout { }<br/>}</span></pre><p id="78b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里我们设置了:</p><ol class=""><li id="a310" class="lw lx iq jw b jx jy kb kc kf mp kj mq kn mr kr ms me mf mg bi translated"><code class="fe kt ku kv kw b">input</code>上的5044端口为<code class="fe kt ku kv kw b">filebeat</code></li><li id="96d5" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">两个<code class="fe kt ku kv kw b">filter</code>:</li><li id="5479" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">第一个:将检查<code class="fe kt ku kv kw b">type</code>字段，如果它的值== <em class="kx"> syslog </em>，那么Logstash将解析它的数据</li><li id="fcc3" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated">第二个:将检查<code class="fe kt ku kv kw b">type</code>字段，如果它的值== <em class="kx"> nginx_access </em>，那么Logstash将把它的数据解析为NGINX access-log</li><li id="53c0" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr ms me mf mg bi translated"><code class="fe kt ku kv kw b">outout</code>使用两个<code class="fe kt ku kv kw b">if</code>条件，并根据结果将数据传递给索引<code class="fe kt ku kv kw b">logstash-%{+YYYY.MM.dd}</code>(用于syslog)或<code class="fe kt ku kv kw b">nginx-%{+YYYY.MM.dd}</code>(用于NGINX)</li></ol><p id="efbc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重新启动Logstash和Filebeat:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="31e0" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# systemctl restart logstash<br/>root@ip-172–31–43–4:/home/ubuntu# systemctl restart filebeat</span></pre><p id="c7bc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">循环运行<code class="fe kt ku kv kw b">curl</code>,在NGINX access-log中生成一些数据:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="bf91" class="np kz iq kw b gy nq nr l ns nt">ubuntu@ip-172–31–43–4:~$ watch -n 1 curl -I localhost</span></pre><p id="1964" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查弹性搜索指数:</p><pre class="mu mv mw mx gt nl kw nm nn aw no bi"><span id="a8a8" class="np kz iq kw b gy nq nr l ns nt">root@ip-172–31–43–4:/home/ubuntu# curl localhost:9200/_cat/indices?v<br/>health status index uuid pri rep docs.count docs.deleted store.size pri.store.size<br/>…<br/>yellow open logstash-2022.01.28 bYLp_kI3TwW3sPfh7XpcuA 1 1 213732 0 159mb 159mb<br/>…<br/>yellow open nginx-2022.01.28 0CwH4hBhT2C1sMcPzCQ9Pg 1 1 1 0 32.4kb 32.4kb</span></pre><p id="f9b7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我们新的NGINX指数。</p><p id="b967" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到Kibana，添加另一个索引模式<code class="fe kt ku kv kw b">logstash-*</code>:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oo"><img src="../Images/319eb69f739db766382af4f3c1ed9786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c_6Er1Qf0RKJv_zL.png"/></div></div></figure><p id="ff26" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="kx">分析&gt;发现</em>，选择一个指数，并查看您的数据:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi op"><img src="../Images/04d59d667b631fb632a874bdb5947b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SRNVvFR4JZ3Om-Et.png"/></div></div></figure><p id="f5b5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">同样，对于NGINX日志:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi oq"><img src="../Images/de189874a863c09539f3ab6aaa8c042d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xzkpRVqkakukdVU0.png"/></div></div></figure><p id="45bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p><h1 id="53d8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">有用的链接</h1><h2 id="8300" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">弹性堆叠</h2><ul class=""><li id="ac12" class="lw lx iq jw b jx ly kb lz kf ma kj mb kn mc kr md me mf mg bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/deploy-elastic-stack-on-kubernetes-1-15-using-helm-v3-9105653c7c8">Kubernetes 1.15上使用Helm v3的弹性堆栈</a></li><li id="9232" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://phoenixnap.com/kb/elk-stack" rel="noopener ugc nofollow" target="_blank">麋鹿栈教程:Elasticsearch、Logstash、Kibana、&amp; Beats </a>入门</li><li id="9221" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://phoenixnap.com/kb/how-to-install-elk-stack-on-ubuntu" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu 18.04 / 20.04上安装ELK Stack (Elasticsearch、Logstash和Kibana)</a></li><li id="3544" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://logit.io/blog/post/elk-stack-guide" rel="noopener ugc nofollow" target="_blank">更新了2022年的ELK堆栈指南</a></li><li id="7bf3" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.digitalocean.com/community/tutorials/how-to-install-elasticsearch-logstash-and-kibana-elastic-stack-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu 18.04上安装Elasticsearch、Logstash和Kibana(弹性堆栈)</a></li></ul><h2 id="68fa" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">弹性搜索</h2><ul class=""><li id="fc8f" class="lw lx iq jw b jx ly kb lz kf ma kj mb kn mc kr md me mf mg bi translated"><a class="ae ks" href="https://opster.com/guides/elasticsearch/glossary/elasticsearch-index/#" rel="noopener ugc nofollow" target="_blank">弹性搜索指数</a></li></ul><h2 id="d017" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Logstash</h2><ul class=""><li id="85b1" class="lw lx iq jw b jx ly kb lz kf ma kj mb kn mc kr md me mf mg bi translated">Logstash是如何工作的</li><li id="065c" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/guide/en/logstash/current/filter-plugins.html" rel="noopener ugc nofollow" target="_blank">过滤器插件</a></li><li id="899d" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/blog/a-practical-introduction-to-logstash" rel="noopener ugc nofollow" target="_blank">Logstash实用介绍</a></li><li id="6ad2" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="http://logstash-docs.elasticsearch.org.s3.amazonaws.com/logstash-reference.html" rel="noopener ugc nofollow" target="_blank">开始使用logstash </a></li><li id="67b5" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://coralogix.com/blog/logstash-grok-tutorial-with-examples/" rel="noopener ugc nofollow" target="_blank">教程:带示例的Logstash Grok模式</a></li><li id="bd8d" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated">Logstash Grok初学者指南</li><li id="5532" class="lw lx iq jw b jx mh kb mi kf mj kj mk kn ml kr md me mf mg bi translated"><a class="ae ks" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-beats.html" rel="noopener ugc nofollow" target="_blank"> Beats输入插件</a></li></ul><h2 id="4d4a" class="np kz iq bd la nv nw dn le nx ny dp li kf nz oa lm kj ob oc lq kn od oe lu of bi translated">Filebeat</h2><ul class=""><li id="4621" class="lw lx iq jw b jx ly kb lz kf ma kj mb kn mc kr md me mf mg bi translated">【Filebeat入门</li></ul></div><div class="ab cl or os hu ot" role="separator"><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow ox"/><span class="ou bw bk ov ow"/></div><div class="ij ik il im in"><p id="405a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kx">最初发布于</em> <a class="ae ks" href="https://rtfm.co.ua/en/elastic-stack-an-overview-and-elk-installation-on-ubuntu-20-04/" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> RTFM: Linux、DevOps、系统管理</em> </a> <em class="kx">。</em></p></div></div>    
</body>
</html>