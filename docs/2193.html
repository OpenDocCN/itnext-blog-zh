<html>
<head>
<title>Testing with Jest and Vue.js: Pocket guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest和Vue.js测试:袖珍指南</h1>
<blockquote>原文：<a href="https://itnext.io/testing-with-jest-and-vue-js-pocket-guide-7be290d20954?source=collection_archive---------2-----------------------#2019-04-14">https://itnext.io/testing-with-jest-and-vue-js-pocket-guide-7be290d20954?source=collection_archive---------2-----------------------#2019-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/89163d259d990e0bb905583db07b2af3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xHwuLD0XRtfxhjV-qQjWrQ.png"/></div></div></figure><p id="ec20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在测试应用程序时，我从过去与<strong class="ka ir"> Vue.js </strong>的合作中收集了一些例子，并意识到我可以写一篇文章来帮助我的同事和(希望)你。</p><p id="7da0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vue.js 是一个非常流行的开源javascript框架，用于构建用户界面和单页面应用程序，易于理解，许多公司开始采用。</p><p id="fc2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了测试<strong class="ka ir"> Vue.js </strong>应用程序，我使用<a class="ae kw" href="https://github.com/vuejs/vue-test-utils" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Vue测试工具</strong> </a> <strong class="ka ir"> </strong>作为javascript测试工具。它有很多好的方法来帮助你安装你的组件和测试你需要测试的案例。比如单元测试你的组件功能或者测试交互。</p><p id="d6c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">写这篇文章的原因是为了测试应用程序的某些部分，你总是要做同样的事情。你有办法测试函数，模拟请求，模拟函数返回，等等。</p><p id="2020" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，为什么不创建一个袖珍指南供以后使用呢？<br/> <strong class="ka ir">我们开始吧？</strong></p><h1 id="89e4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">组件状态</h1><p id="28a1" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">你需要小心的一件事是改变状态。在Vue中，如果你不声明状态属性，你将不能改变它们，因为它们不是反应性的！</p><p id="4060" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请确保从您需要的所有属性开始，不要这样做，因为这样做是行不通的:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="0a5c" class="mj ky iq mf b gy mk ml l mm mn">beforeEach(() =&gt; {<br/>  state = {};<br/>}</span><span id="b2cf" class="mj ky iq mf b gy mo ml l mm mn">it('should do someting', () =&gt; {<br/> state.foo = 'bar';<br/>});</span></pre><p id="6426" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8d5e" class="mj ky iq mf b gy mk ml l mm mn">beforeEach(() =&gt; {<br/>  state = {<br/>    foo: 'hello',<br/>  }<br/>}</span><span id="6c52" class="mj ky iq mf b gy mo ml l mm mn">it('should do someting', () =&gt; {<br/> state.foo = 'bar';<br/>});</span></pre><p id="f7fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我使用了<code class="fe mp mq mr mf b">beforeEach</code>方法在每次测试前重置状态。</p><h1 id="850f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">元件安装</h1><p id="0ecc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先要做的是安装组件。为此，我们将使用<a class="ae kw" href="https://github.com/vuejs/vue-test-utils" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Vue测试工具</strong> </a>来帮助我们。</p><p id="05e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr mf b">shallowMount</code>是我们将要使用的第一种方法。此方法允许您挂载组件，并将使用存根子组件进行呈现。</p><p id="f2be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像这样，你也不需要担心使用或安装它们。这个方法将为您挂载和渲染所有内容。</p><h2 id="84ee" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">Vue实例</h2><p id="983a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了在添加组件、混音、道具等时创建一个Vue类<code class="fe mp mq mr mf b">wrapper</code>而不污染全局Vue类，我们也将使用<strong class="ka ir"> Vue测试工具</strong>中的一个方法，即<code class="fe mp mq mr mf b">createLocalVue</code>方法。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="62ba" class="mj ky iq mf b gy mk ml l mm mn">import Vue from 'vue';<br/>import { shallowMount, createLocalVue } from '@vue/test-utils';</span><span id="54f4" class="mj ky iq mf b gy mo ml l mm mn">const localVue = createLocalVue();</span><span id="9acd" class="mj ky iq mf b gy mo ml l mm mn">describe('caption.vue', () =&gt; {<br/>  let wrapper;</span><span id="dc94" class="mj ky iq mf b gy mo ml l mm mn">beforeEach(() =&gt; {<br/>    wrapper = shallowMount(ComponentName, {<br/>      localVue,<br/>      propsData: {},<br/>    });<br/>  });<br/>});</span></pre><h1 id="45b8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">模拟功能</h1><p id="a97c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了模仿函数，我们将得到<strong class="ka ir"> Jest </strong>和<strong class="ka ir"> </strong>的帮助，这是一个特殊的方法<code class="fe mp mq mr mf b">fn</code>，它返回一个模仿函数，在这里你可以访问一些有用的方法。下面我会给你看更多！</p><p id="c248" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要模拟Vue实例中的方法，可以使用Vue类的<code class="fe mp mq mr mf b">vm</code>变量进行访问。</p><p id="b758" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr mf b">wrapper.vm.didBlur = jest.fn();</code></p><h2 id="19f7" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">函数的模拟返回值</h2><p id="3f34" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果您需要模拟模块中某个方法的返回值，您将需要<code class="fe mp mq mr mf b">require</code>整个模块，即使您已经使用了命名导出。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="fa43" class="mj ky iq mf b gy mk ml l mm mn">const captionsHelper = require('@/js/helpers/captions');<br/>captionsHelper.didClickOutside.mockReturnValueOnce(false);</span></pre><h2 id="33c8" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">期待n次函数调用</h2><p id="9768" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果您希望某个函数被调用<code class="fe mp mq mr mf b">n</code>次，那么在另一个<code class="fe mp mq mr mf b">it</code>语句中调用该函数时要小心。</p><p id="b4d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对<code class="fe mp mq mr mf b">expect n</code>函数的调用:<br/> <code class="fe mp mq mr mf b">expect(wrapper.vm.didBlur.mock.calls.length).toBe(1);</code></p><h1 id="fb9b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">预期是否发出了事件</h1><h2 id="876b" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">通过组件发出的事件</h2><ul class=""><li id="dd94" class="nd ne iq ka b kb lv kf lw kj nf kn ng kr nh kv ni nj nk nl bi translated">您需要调用将发出事件的函数</li><li id="32a8" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">检查是否发出了事件</li><li id="e61a" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">检查传递了哪些参数</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="13ed" class="mj ky iq mf b gy mk ml l mm mn">describe('#didBlur', () =&gt; {<br/>  it('should emit setActiveCaptionState event', () =&gt; {<br/>    wrapper.vm.didBlur();<br/>    <br/>    expect(wrapper.emitted('setActiveCaptionState')).toBeTruthy();<br/>    expect(wrapper.emitted('setActiveCaptionState')).toEqual([<br/>      [{ caption: wrapper.vm.subtitle, isActive: false }],<br/>    ]);<br/>  });<br/>});</span></pre><h2 id="267d" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">通过全局$eventHub的事件</h2><ul class=""><li id="7834" class="nd ne iq ka b kb lv kf lw kj nf kn ng kr nh kv ni nj nk nl bi translated">用jest创建一个存根函数</li><li id="725c" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">添加存根作为事件的回调</li><li id="ca0e" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">调用将发出事件的方法</li><li id="92db" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">检查是否发出了事件或传递了参数</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="55d3" class="mj ky iq mf b gy mk ml l mm mn">it('emit handleCaptionClicked event', () =&gt; {<br/>  const stub = jest.fn();<br/>  wrapper.vm.$eventHub.$on('handleCaptionClicked', stub);<br/>  wrapper.vm.handleClick();</span><span id="0a88" class="mj ky iq mf b gy mo ml l mm mn">  expect(stub).toBeCalled();<br/>  expect(stub).toBeCalledWith(wrapper.vm.subtitle.start_time);<br/>});</span></pre><h1 id="1e19" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">检查是否调用了组件中的方法</h1><ul class=""><li id="ccb4" class="nd ne iq ka b kb lv kf lw kj nf kn ng kr nh kv ni nj nk nl bi translated">调用将发出事件的方法</li><li id="6ccd" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">检查是否发出了事件或传递了参数</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="955b" class="mj ky iq mf b gy mk ml l mm mn">it('emit <!-- -->changeLineBackgroundWarning<!-- --> event', () =&gt; {<br/>  <!-- -->wrapper.vm.changeLineBackgroundWarning  = jest.fn();<br/>  wrapper.vm.handleInput(event);<br/>  <br/>  expect(wrapper.vm.changeLineBackgroundWarning).toHaveBeenCalled();<br/>});</span></pre><h1 id="7302" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试观察者</h1><ul class=""><li id="cee1" class="nd ne iq ka b kb lv kf lw kj nf kn ng kr nh kv ni nj nk nl bi translated">设置你正在观看的道具或状态</li><li id="070f" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">改变你正在观看的道具或状态</li><li id="21e8" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">预期</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="e4e1" class="mj ky iq mf b gy mk ml l mm mn">it('should change the state prop isRead to true', () =&gt; {<br/>  wrapper = shallowMount(Caption, {<br/>    localVue,<br/>    propsData: {<br/>      subtitle: {<br/>        start_time: 0.5,<br/>      },<br/>      currentTime: 0,<br/>    },<br/>  });<br/>  <br/>  wrapper.setData({ isRead: false });<br/>  wrapper.setProps({<br/>    currentTime: 1,<br/>  });</span><span id="8183" class="mj ky iq mf b gy mo ml l mm mn">  expect(wrapper.vm.isRead).toBeTruthy();<br/>});</span></pre><h1 id="c8d0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">独立测试Vuex</h1><p id="2d75" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">不要忘记您需要导入您想要测试的<code class="fe mp mq mr mf b">real</code>突变/动作/getter，因为您稍后会调用它。</p><h2 id="ed31" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">测试操作</h2><ul class=""><li id="250a" class="nd ne iq ka b kb lv kf lw kj nf kn ng kr nh kv ni nj nk nl bi translated">你应该从商店打电话给行动</li><li id="ae74" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">提交、分派等应该是jest函数，这样你就可以检查它们是否被调用</li></ul><p id="796d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想要检查某个操作是否调度了其他操作或提交了任何变异，您可以执行以下操作:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="8d50" class="mj ky iq mf b gy mk ml l mm mn">// Check if a specific action has been called<br/>it('should initiate the smartcheck plugin', () =&gt; {<br/>  state.showSmartcheck = true;<br/>  actions.setTaskState(<br/>    { dispatch, commit, getters, state },<br/>    { taskFromServer: task, localStorageTaskType: 'captioning' },<br/>  );</span><span id="1304" class="mj ky iq mf b gy mo ml l mm mn">  expect(dispatch).toHaveBeenCalledWith('initSmartcheckPlugin');<br/>});</span></pre><h2 id="b201" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">测试吸气剂</h2><p id="df39" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于getter，您唯一需要做的就是检查getter是否返回了您所期望的结果。根据您的当前状态，它可以是不同的数据结构，如对象或不同的数据。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4f78" class="mj ky iq mf b gy mk ml l mm mn">describe('taskInfo', () =&gt; {<br/>  const state = {<br/>    id: 'cenas',<br/>    type: 'cenas',<br/>    status: 'cenas',<br/>  };</span><span id="7b46" class="mj ky iq mf b gy mo ml l mm mn">  it('should return the right properties', () =&gt; {<br/>    expect(getters.taskInfo(state)).toEqual({<br/>      id: state.id,<br/>      type: state.type,<br/>    });<br/>  });<br/>});</span></pre><h2 id="317c" class="mj ky iq bd kz ms mt dn ld mu mv dp lh kj mw mx ll kn my mz lp kr na nb lt nc bi translated">测试突变</h2><p id="8616" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要测试突变，唯一需要测试的是状态是否已经改变。为此，我们:</p><ul class=""><li id="8c6b" class="nd ne iq ka b kb kc kf kg kj nr kn ns kr nt kv ni nj nk nl bi translated">创建状态对象</li><li id="10af" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">将状态作为变异的参数传递</li><li id="ac77" class="nd ne iq ka b kb nm kf nn kj no kn np kr nq kv ni nj nk nl bi translated">检查状态是否是你所期望的</li></ul><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b034" class="mj ky iq mf b gy mk ml l mm mn">import mutations from '@/js/store/modules/foo/mutations';</span><span id="a0cd" class="mj ky iq mf b gy mo ml l mm mn">beforeEach(() =&gt; {<br/>  state = {<br/>    foo: 'bar'<br/>  };<br/>});</span><span id="ee69" class="mj ky iq mf b gy mo ml l mm mn">it('should change foo state to john', () =&gt; {<br/>  mutations.CHANGE_TO_JOHN(state);<br/>  expect(state).toEqual({<br/>    foo: 'john',<br/>  });<br/>});</span></pre><p id="7861" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">暂时就这样吧！我可能会用更多的案例来更新这篇文章。这将是我未来参考的袖珍指南！</p></div></div>    
</body>
</html>