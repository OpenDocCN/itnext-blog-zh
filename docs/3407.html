<html>
<head>
<title>Dockerize a SpringBoot app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将SpringBoot应用程序归档</h1>
<blockquote>原文：<a href="https://itnext.io/dockerize-a-springboot-app-1755e49fe3d9?source=collection_archive---------1-----------------------#2019-12-08">https://itnext.io/dockerize-a-springboot-app-1755e49fe3d9?source=collection_archive---------1-----------------------#2019-12-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="99e0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">让我们从docker图像和容器开始，让我们展示如何对SpringBoot应用程序进行Docker化并上传到Docker注册表</h2></div><p id="8270" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个故事中，我们将探索如何简单地将一个SpringBoot应用程序dockerize并运行到一个容器中。然后，我们将看到如何在我们自己的docker hub中的公共docker注册表中推送它，以便稍后在k8s pod中使用它。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/997afd0cd86c5908152e54831b234b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*au6r2J8STqolQeN2"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk translated">托马斯·李普克在<a class="ae lr" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="1710" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，需要注册docker hub。这使我们能够创建公共或私有存储库来推送我们的docker映像。因此，让我们访问<a class="ae lr" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker hub官方网站</a>并注册。请记住用户名(docker id)和密码，以便进行后续步骤。</p><p id="29ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，我们可以从<a class="ae lr" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank">这里</a>开始为我们的平台系统分别下载Docker就我而言，我会下载mac发行版。让我们安装下载的软件包。它将为我们提供能够与Docker生态系统交互的完整命令。</p><p id="ab0d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用下面的命令</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="884f" class="me mf iq ma b gy mg mh l mi mj">docker -v</span></pre><p id="a190" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试安装是否成功。我正在使用的当前版本是</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="446b" class="me mf iq ma b gy mg mh l mi mj">Docker version 19.03.5, build 633a0ea</span></pre><p id="cd03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">听起来很棒！现在，我们已经准备好并能够创建我们的第一个Docker图像。</p><p id="d74f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个故事中，我不会给你任何SpringBoot应用程序。你可以决定从任何你想要的应用程序中创建一个图像。</p><p id="3816" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，一旦你决定了哪个是dockerize的起点，让我们来介绍一下<strong class="kh ir"> <em class="mk"> Dockerfile </em> </strong>。为了定义在容器中成功启动和运行该文件(以及映像)所需的所有步骤，该文件必须出现在项目中。</p><p id="c50e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Docker文件必须直接存放在项目根目录下；pom.xml文件所在的同一文件夹中。在我们的例子中，文件如下所示:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7c2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在应该逐行解释这个文件的含义。</p><p id="ac6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第一行</strong> <em class="mk">。设置基本图像容器来保存和运行项目。在我们的例子中，我们需要有一个JDK 8 </em> <a class="ae lr" href="https://hub.docker.com/_/alpine" rel="noopener ugc nofollow" target="_blank"> <em class="mk">高山</em> </a> <em class="mk">版本。</em></p><p id="2ef6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第三行</strong>。<em class="mk">复制。/usr/src/demo文件夹中的jar文件。</em></p><p id="88a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第5行</strong>。<em class="mk">将当前工作目录设置到上面的同一个文件夹中，其中。jar文件已被复制。这意味着接下来的命令如</em> <strong class="kh ir"> <em class="mk"> run、cmd等……</em></strong><em class="mk">将把当前工作目录作为基本路径。</em></p><p id="454d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第7行</strong>。<em class="mk">暴露端口8080。</em></p><p id="aa22" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">第9行。</strong> <em class="mk">执行命令‘Java-jar demo-0 . 0 . 1-snapshot . jar’运行程序。</em></p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="d84b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">干得好。现在是时候了解一些最常见的Docker命令来管理我们的图像和容器了。</p><p id="ce8f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个命令是以这种方式使用的<strong class="kh ir"> docker build </strong></p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="c5f3" class="me mf iq ma b gy mg mh l mi mj">docker build -t &lt;your-docker-id&gt;/&lt;your-image-name&gt; .</span></pre><p id="f866" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该命令从Docker文件所在的同一文件夹中的命令行启动，创建整个项目的Docker图像，并将一个标签关联到所创建的图像；在这种情况下<em class="mk">&lt;your-docker-id&gt;/&lt;your-image-name&gt;</em>。</p><p id="cf6b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">执行这个命令，Docker创建带有相关标签的图像。使用下面的命令可以列出所有的图像</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="4d88" class="me mf iq ma b gy mg mh l mi mj"><em class="mk">docker images</em> or <em class="mk">docker image ls</em></span></pre><p id="5657" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，你还可以看到他们唯一的ID。</p><p id="377c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当我们想要删除一幅图像，我们可以这样做，感谢</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="7655" class="me mf iq ma b gy mg mh l mi mj">docker delete image &lt;image-id&gt;</span></pre><p id="956f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们可以看到run命令。它能够将我们的图像放入容器中。</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="df3e" class="me mf iq ma b gy mg mh l mi mj">docker run --name &lt;your-name-here&gt; -p 8080:8080 -d &lt;image-tag&gt;</span></pre><ol class=""><li id="b16b" class="mn mo iq kh b ki kj kl km ko mp ks mq kw mr la ms mt mu mv bi translated">- name <your-name-here>设置容器的名称</your-name-here></li><li id="f7ba" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">-p设置并公开端口8080，并执行本地机器到容器之间以及本地机器8080端口和容器的8080端口之间的请求转发</li><li id="9007" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated">-d以守护模式执行容器</li><li id="6cbb" class="mn mo iq kh b ki mw kl mx ko my ks mz kw na la ms mt mu mv bi translated"><image-tag>表示在容器内运行的Docker图像</image-tag></li></ol><p id="f702" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们终于创建了我们的第一个Docker映像，并且能够在Docker容器中运行它。现在，让我们向<a class="ae lr" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>提出请求，享受我们做出的伟大作品吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="6f08" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个故事的最后一章中，我们将看到如何将Docker镜像推送到docker hub中的远程公共注册中心。</p><p id="02e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们登录docker</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="c1cc" class="me mf iq ma b gy mg mh l mi mj">docker login --username &lt;your-docker-id&gt;</span></pre><p id="8c5d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该命令将在隐藏模式下要求您输入密码。</p><p id="f18b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，您可以使用</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="58bb" class="me mf iq ma b gy mg mh l mi mj">--password &lt;your-docker-hub-password&gt;</span></pre><p id="01c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的命令中；但是，通过这种方式，您的密码在您的命令历史记录中仍然可见。</p><p id="a852" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，以这种方式标记你的图像</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="7a2f" class="me mf iq ma b gy mg mh l mi mj">docker tag &lt;image-id&gt; &lt;docker-id&gt;/&lt;custom-image-name&gt;</span></pre><p id="02b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单地说，执行下面的命令</p><pre class="lc ld le lf gt lz ma mb mc aw md bi"><span id="4c5e" class="me mf iq ma b gy mg mh l mi mj">docker push &lt;docker-id&gt;/&lt;custom-image-name&gt;</span></pre><p id="1010" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个过程可能需要一段时间，但是最终，您应该会看到您的第一个存储库上传到您的私有hub中！</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nb"><img src="../Images/ded716c610ab93f31b09d1bfe7e109cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sM3b8CVkSFd-mnDm0cv2kw.png"/></div></div></figure><h1 id="5c78" class="nc mf iq bd nd ne nf ng nh ni nj nk nl jw nm jx nn jz no ka np kc nq kd nr ns bi translated">结论</h1><p id="7224" class="pw-post-body-paragraph kf kg iq kh b ki nt jr kk kl nu ju kn ko nv kq kr ks nw ku kv kw nx ky kz la ij bi translated">在这个故事中，我们看到了如何从SpringBoot应用程序开始创建和管理Docker图像。用同样的方法，可以创建Node.js应用程序的映像等等。我们还讨论了如何在docker hub的公共注册表中上传图片，以备使用，例如在k8s中。</p><p id="0013" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非常感谢您的阅读。如果你喜欢这个故事，请鼓掌跟随。</p><p id="7512" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下次见！</p></div></div>    
</body>
</html>