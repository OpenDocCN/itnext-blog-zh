<html>
<head>
<title>React: Smart component API with conditional props and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React:带有条件属性和类型脚本的智能组件API</h1>
<blockquote>原文：<a href="https://itnext.io/react-write-awesome-component-api-with-conditional-props-and-typescript-ae9fcdd29cab?source=collection_archive---------0-----------------------#2021-04-19">https://itnext.io/react-write-awesome-component-api-with-conditional-props-and-typescript-ae9fcdd29cab?source=collection_archive---------0-----------------------#2021-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/50d9f1c0196d7676bb26c475fee12aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjL5LJNPPxam4kCV3GTKSw.png"/></div></div></figure><p id="4758" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用TypeScript和条件属性，您可以为React组件构建一个API，该API对属性的要求是清晰明确的。这样做将有助于你的团队，并让你成为一名出色的开发人员。</p><p id="f61f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将从一个简单的用例开始，并以一个涉及泛型的更高级的用例结束。</p><p id="7306" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程假设您对TypeScript和类型有基本的了解。</p><h1 id="f801" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">非此即彼</h1><p id="7152" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">假设你有一个组件，其中有两个冲突的属性。您希望客户端提供其中一个属性，而不是两个都提供。</p><p id="97a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于我们的例子，我们将使用一个接受URL字符串或文件对象作为源的Avatar组件。如果客户端提供了URL字符串，我们不希望他们也提供文件，反之亦然。</p><p id="f949" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">组件的第一次迭代可能是这样的:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/3f1aa9be5ffc6ce794b8c25baf1a9821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CAvJg9J5iYIpUHA16qXh5A.png"/></div></div></figure><p id="ddc9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，如果我们通过了两个道具，我们的组件不会抱怨:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/8988773ebd319434bbc91d192eb27b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jlLEHSL2NVxqS-j1E1D6lg.png"/></div></div></figure><p id="06d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这不行——如果我们两个道具都通过了，我们希望TypeScript对我们大喊大叫！</p><p id="363f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了实现这一点，我们可以使用两种类型创建一个<a class="ae mi" href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#union-types" rel="noopener ugc nofollow" target="_blank">联合类型</a>，这两种类型反映了我们的组件支持的两种场景:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/a1ad4dca8b239d077e26a3ecd5763381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bhi1WrHFcV0U6uyypowgLA.png"/></div></div></figure><p id="3e8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，如果我们试图同时提供这两个属性，我们将看到一个TypeScript错误:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/e9727fe3fa913345a2abf4829c204664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1ZAot4ItaG9QIa9-5CgwQ.png"/></div></div></figure><p id="d434" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好多了！这里需要注意的一件有趣的事情是我们对<a class="ae mi" href="https://www.typescriptlang.org/docs/handbook/2/narrowing.html#the-never-type" rel="noopener ugc nofollow" target="_blank"> never </a>关键字的使用。TypeScript文档最好地解释了这个关键字:</p><blockquote class="mk ml mm"><p id="7ce2" class="kb kc mn kd b ke kf kg kh ki kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ky im bi translated">TypeScript将使用never类型来表示一个不应该存在的状态。</p></blockquote><p id="c68d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">重申一下，我们为两个场景定义了两种类型，并使用union操作符将它们组合在一起。</p><h1 id="5d92" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">类型变体</h1><p id="4d99" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">让我们从之前的用例开始，构建一个具有不同变体的组件。</p><p id="aeed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设我们正在构建一个通用加载器。我们的加载器可能有三种不同的变体:微调器、文本或进度条。</p><p id="13c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于每个变体，我们都有一套道具。我们希望只有当客户选择了匹配的变体时，才提供这些道具。</p><p id="c34b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要做的是定义一个联合类型，它包含所有三个变量，并具有一个共享的<code class="fe mr ms mt mu b">variant</code>属性:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/1efd16baf26aae4741fe664fb939a22e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OR6lvMwEcVAZmpPNnozkg.png"/></div></div></figure><p id="5c9c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用variant prop来告诉客户端要提供哪些附加属性。如果您将变量设置为<code class="fe mr ms mt mu b">progressBar</code>，您将看到一个错误:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/648d3589dded1a6b90c26735eeebbc95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ln3DTJSPdtQof9wUspQrPQ.png"/></div></div></figure><p id="a44a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦我们将<code class="fe mr ms mt mu b">variant</code>属性设置为<code class="fe mr ms mt mu b">progressBar</code>，TypeScript将组件的类型缩小到进度条，并告诉您需要提供“progress”属性。</p><p id="8564" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最重要的是，如果你试图提供<code class="fe mr ms mt mu b">radius</code>属性，TypeScript会抱怨该属性不是进度条类型的一部分。相当整洁！</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/db31d03bdda2faffac7f9cf683fe5759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxg05lz7FrZKnNKjrQaiSA.png"/></div></div></figure><p id="24e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该技术基于<strong class="kd iu">区别并集</strong>。这有助于我们缩小使用公共财产的联盟成员范围。在我们的案例中，<code class="fe mr ms mt mu b">variant</code>是我们的共同财产。你可以在这里阅读更多关于歧视性结合的内容。</p><h1 id="6b86" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">收藏物品的条件道具</h1><p id="5fa3" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">对于我们的下一个用例，让我们尝试为Select组件定义条件属性。我们的组件需要足够灵活，以便为它的<code class="fe mr ms mt mu b">options</code>属性接受一组字符串或对象。</p><p id="5e7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果组件接收到一个对象数组，我们希望客户端指定我们应该使用这些对象的哪些字段作为标签和值。</p><p id="9af7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是我们如何使用有区别的联合和<code class="fe mr ms mt mu b">never</code>为组件设置类型:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/d34a0fd911e3643d89103febd9bea62b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hExY6DOR--OMPURKsx7lCA.png"/></div></div></figure><h2 id="9752" class="my la it bd lb mz na dn lf nb nc dp lj km nd ne ln kq nf ng lr ku nh ni lv nj bi translated">使用泛型自动完成</h2><p id="7cec" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们可以通过给我们的<code class="fe mr ms mt mu b">labelProp</code>和<code class="fe mr ms mt mu b">valueProp</code>添加一个自动完成特性来改进我们的选择。为此，我们可以在TypeScript中使用<a class="ae mi" href="https://www.typescriptlang.org/docs/handbook/2/generics.html" rel="noopener ugc nofollow" target="_blank">泛型</a>。</p><p id="8442" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们将泛型添加到Select的类型中，如下所示:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/dfb64885d6e05476d5bb356422749f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxjJYUj0ZmPeckJqsiTmKw.png"/></div></div></figure><p id="4daa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的第二种类型中，我们将通用对象的<code class="fe mr ms mt mu b">options</code>属性从<code class="fe mr ms mt mu b">Array&lt;Object&gt;</code>改为<code class="fe mr ms mt mu b">Array&lt;T&gt;</code>。客户端必须提供一个通用对象类型的项目数组。</p><p id="06d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用关键字的<a class="ae mi" href="https://www.typescriptlang.org/docs/handbook/2/keyof-types.html" rel="noopener ugc nofollow" target="_blank">key让TypeScript知道我们期望<code class="fe mr ms mt mu b">labelProp</code>和<code class="fe mr ms mt mu b">valueProp</code>是通用对象的字段。</a></p><p id="b71e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，当您尝试提供<code class="fe mr ms mt mu b">valueProp</code>或<code class="fe mr ms mt mu b">labelProp</code>时，您会看到一个基于选项项字段的漂亮的自动完成建议。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/164c4e8b5182291c91b0b1d70115de96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxYxAPt-lStAWYnKi7_gSg.png"/></div></div></figure><p id="5968" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，如果您提供的值不是选项项的字段，您将会看到一个错误:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/8cdc160a7232cac9548c6c93d79e78bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dQFDl4WDJRHWotsx3qkvSg.png"/></div></div></figure><p id="cfd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">到目前为止一切顺利。</p><p id="6ac6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，我们需要添加一个小的修改来防止某些错误。我们希望确保提供给我们的通用对象是一个自定义对象，而不是像字符串这样的原语:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/2002378068cf6afd80e2308d337cf1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JYMsyfm5pp1Dap3nNRjVRQ.png"/></div></div></figure><p id="ea25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里我们使用一个三元运算符来检查我们的泛型类型是否是一个字符串，基于此，我们将组件的类型设置为适当的选项。</p><p id="7cfb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们的组件的类型定义已经完成，可以发布了！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="58a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我们回顾了一些使用TypeScript构建智能组件API的技术。使用这些技术，您可以编写具有清晰明确的prop需求的组件。它也是构建组件库的强大工具。</p><p id="5383" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你想学习更多编写干净的声明性组件的技术，可以看看我关于React的复合组件模式的帖子。</p><p id="3b58" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里是本教程的<a class="ae mi" href="https://codesandbox.io/s/conditional-props-hvfbo?file=/src/App.tsx" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>的链接。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="9bdc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">原载于2021年4月19日https://isamatov.com</em><a class="ae mi" href="https://isamatov.com/conditional-props-react-typescript/" rel="noopener ugc nofollow" target="_blank"><em class="mn"/></a><em class="mn">。</em></p></div></div>    
</body>
</html>