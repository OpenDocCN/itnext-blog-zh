<html>
<head>
<title>Predicting the price of cryptocurrencies using Fuzzy Time Series in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用模糊时间序列预测加密货币的价格</h1>
<blockquote>原文：<a href="https://itnext.io/predicting-the-price-of-cryptocurrencies-using-fuzzy-time-series-in-r-577cba57d43c?source=collection_archive---------5-----------------------#2018-02-19">https://itnext.io/predicting-the-price-of-cryptocurrencies-using-fuzzy-time-series-in-r-577cba57d43c?source=collection_archive---------5-----------------------#2018-02-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fpredicting-the-price-of-cryptocurrencies-using-fuzzy-time-series-in-r-577cba57d43c" rel="noopener ugc nofollow" target="_blank"> <em class="km">点击这里在LinkedIn </em>上分享这篇文章</a></p><p id="50c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">统计学家、心理学家、数据挖掘者和其他学科对金融一直很感兴趣，原因有很多，比如它的盈利能力、它的混乱和它背后的心理学。老实说，金融市场很难预测。这种不可预测性是由于波动造成的，波动是许多参数的函数，如政府的政治决策、本地和全球新闻等。尽管如此复杂，但还是有可以预见的东西，那就是“市场心理”！根据<a class="ae kl" href="https://en.wikipedia.org/wiki/Elliott_wave_principle" rel="noopener ugc nofollow" target="_blank">艾略特波浪原理</a>等各种研究和原理，金融市场是周期波。在工程中，这被称为周期信号，周期的发生是由于市场背后的心态。举个简单的例子，如果加密货币X变得非常昂贵，每个人都想获利并开始出售他们的加密货币。在某种程度上，几乎每个人都是卖家，所以没有兴趣购买。卖家多，买家少，导致加密货币x的价格下跌。这种心态以各种形式重复，在数据中形成循环模式。</p><p id="f5b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大量研究表明，这些趋势可以通过机器学习来预测；然而，市场中发生的确切价值和异常行为仍然难以预测。另一方面，许多投资者喜欢趋势预测，因为他们想知道何时买入或卖出。大多数投资者都在寻找利润，确切的价值并不是他们的主要兴趣。我相信FTS是趋势预测的好工具，因为其核心的模糊引擎可以处理金融市场主要表现出的不确定性。</p><p id="8844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一点理论应该足以开始尝试！说到这里，让我们遵循<a class="ae kl" href="https://en.wikipedia.org/wiki/Cross-industry_standard_process_for_data_mining" rel="noopener ugc nofollow" target="_blank"> CRISP-DM </a>方法并开始编码。</p><h2 id="821d" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们回顾一下我们正在解决的问题</h2><p id="3e56" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">作为CRISP-DM的第一步，我们需要了解业务/问题。问题是“利用历史数据预测加密价格或趋势”。</p><h2 id="cfe5" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们阅读并理解这些数据</h2><p id="f4c7" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated"><a class="ae kl" href="https://www.cryptocompare.com/api/#-api-data-histoday" rel="noopener ugc nofollow" target="_blank"> Cryptocompare </a>为我们提供了一组丰富的Rest APIs来读取加密货币数据。使用他们的服务，我们可以读取比特币(BTC)对美元的价格:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="f37a" class="kn ko iq lq b gy lu lv l lw lx">library(jsonlite)</span><span id="77ad" class="kn ko iq lq b gy ly lv l lw lx">dataset.btc &lt;- fromJSON("https://min-api.cryptocompare.com/data/histoday?fsym=BTC&amp;tsym=USD&amp;limit=2000&amp;aggregate=1&amp;e=CCCAGG")</span><span id="3613" class="kn ko iq lq b gy ly lv l lw lx"># head is the old data and tail the new data</span><span id="07d1" class="kn ko iq lq b gy ly lv l lw lx">tail(dataset.btc$Data)</span><span id="b678" class="kn ko iq lq b gy ly lv l lw lx">head(dataset.btc$Data)    </span></pre><figure class="ll lm ln lo gt ma gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/4c9b08fc96ad5964ef1882a24436c4f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*f2UPU2oD4RiBkr7sq7hZcg.png"/></div></figure><h2 id="b74d" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们来理解数据</h2><p id="9a8f" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">以下是数据的描述:</p><ul class=""><li id="845a" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated">时间:数据的UNIX时间(它是每日数据)</li><li id="2b6c" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">收盘:一天结束时比特币的价格</li><li id="c801" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">高:特定日期比特币的最高价格</li><li id="659d" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">低:特定日期比特币的最低价格</li><li id="1a94" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">开盘:当天开盘时比特币的价格</li><li id="f974" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">成交量来源:交易量来源</li><li id="a804" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated">交易价值</li></ul><h2 id="901f" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们准备数据</h2><p id="fb5d" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">也许这一步是最重要的一步。<strong class="jp ir">数据准备得越好，预测的质量和准确性就会提高</strong>。我们来看一些可能的数据准备方法:</p><h2 id="3d24" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">趋势计算</h2><p id="b5b1" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">如前所述，在大多数情况下，趋势是更稳定的线，它们的预测更有可能。</p><p id="74f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">r提供了各种软件包和技术来计算趋势，其中我选择了“pracma”软件包和“movavg”函数来平滑信号和计算趋势，如下所示:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6cc5" class="kn ko iq lq b gy lu lv l lw lx">require(pracma)</span><span id="a12f" class="kn ko iq lq b gy ly lv l lw lx">dataset.btc$Data$high_avg&lt;-movavg(dataset.btc$Data$high,7,"w")     </span></pre><figure class="ll lm ln lo gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/ff5dfa0a06c07c0c48830c460f5e38ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ITFZynTHR525yoG95saF4g.png"/></div></div></figure><p id="5d8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的图片中，你可以看到红色的Litecoin日高价格和绿色的平滑信号，这是价格的趋势。</p><h2 id="fdab" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">修复UNIX时间</h2><p id="43a8" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">下面的函数将把UNIX日期转换成人类可读的格式。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="c97a" class="kn ko iq lq b gy lu lv l lw lx">library(dplyr)</span><span id="072d" class="kn ko iq lq b gy ly lv l lw lx">library(lubridate)</span><span id="c7d3" class="kn ko iq lq b gy ly lv l lw lx">convertUnix &lt;- function(datast){</span><span id="3c6a" class="kn ko iq lq b gy ly lv l lw lx"># This function inputs the dataframe discussed above and adds a new column which is conversion of Unix date to human readable dates</span><span id="f56a" class="kn ko iq lq b gy ly lv l lw lx"># Args:</span><span id="94bf" class="kn ko iq lq b gy ly lv l lw lx">#   datast: cryptocurrency dataframe with aforementioned format</span><span id="0cc0" class="kn ko iq lq b gy ly lv l lw lx">#</span><span id="2756" class="kn ko iq lq b gy ly lv l lw lx"># Return:</span><span id="819c" class="kn ko iq lq b gy ly lv l lw lx">#   datast: the same dataset + newly added column</span><span id="ed90" class="kn ko iq lq b gy ly lv l lw lx">data.frame(datast) %&gt;% mutate(date=as.Date(as.POSIXct(time, origin="1970-01-01")))-&gt;datast</span><span id="cb04" class="kn ko iq lq b gy ly lv l lw lx">return(datast)</span><span id="ea11" class="kn ko iq lq b gy ly lv l lw lx">}</span></pre><h2 id="b110" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">差值与实际值</h2><p id="2adb" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">在时间序列预测中，通常的做法是预测变化水平，而不是实际值。这提供了更好的行为洞察力，尤其是在“哪里”或“什么时候”？]实际值超出了界限，达到了以前从未出现过的数字(比如2017年比特币的价格达到了历史数据中从未出现过的18k美元)。如果计算增量，这些极端值仍然是可预测的(增量表示变化水平)。下面的函数计算这些增量。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="5fc4" class="kn ko iq lq b gy lu lv l lw lx">convertPercent &lt;- function(data){</span><span id="470d" class="kn ko iq lq b gy ly lv l lw lx"># This function inputs a vector of numbers and returns a vector that is the differences between ith and (i-1)th element</span><span id="53a2" class="kn ko iq lq b gy ly lv l lw lx"># Args:</span><span id="9efe" class="kn ko iq lq b gy ly lv l lw lx">#   data: the numeric input vector and thus not a dataframe</span><span id="1a2d" class="kn ko iq lq b gy ly lv l lw lx"># Return:</span><span id="1c20" class="kn ko iq lq b gy ly lv l lw lx">#   data: the percentage of the changes</span><span id="c67c" class="kn ko iq lq b gy ly lv l lw lx">data= diff(data)/data[-NROW(data)] * 100</span><span id="e254" class="kn ko iq lq b gy ly lv l lw lx">return(data)</span><span id="43a3" class="kn ko iq lq b gy ly lv l lw lx">}</span></pre><h2 id="3423" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们对数据进行建模</h2><p id="d79a" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">CRISP-DM方法的第四阶段是关于建模和预测。我们使用below函数来传递实际值或趋势值，以预测加密货币的价格并分析其准确性。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="b54f" class="kn ko iq lq b gy lu lv l lw lx">FTS_Predict&lt;- function(data,year,month,day,freq){</span><span id="dfc7" class="kn ko iq lq b gy ly lv l lw lx"># This function builds a time series and predicts the 5 steps ahead</span><span id="b859" class="kn ko iq lq b gy ly lv l lw lx"># Args:</span><span id="8274" class="kn ko iq lq b gy ly lv l lw lx">#   data: the values that should be predicted (trend or actual data)</span><span id="4f63" class="kn ko iq lq b gy ly lv l lw lx">#   year: starting point of the data in terms of year</span><span id="67ef" class="kn ko iq lq b gy ly lv l lw lx">#   month: starting point of the data in terms of month</span><span id="bf6b" class="kn ko iq lq b gy ly lv l lw lx">#   day: starting point of the data in terms of day</span><span id="53e2" class="kn ko iq lq b gy ly lv l lw lx">#   freq: frequency to build the time series</span><span id="7ef8" class="kn ko iq lq b gy ly lv l lw lx">#</span><span id="5af8" class="kn ko iq lq b gy ly lv l lw lx"># Return:</span><span id="0b72" class="kn ko iq lq b gy ly lv l lw lx">#   crypto_predict: the prediction and all attached information (such as accuracy and etc)</span><span id="b4bd" class="kn ko iq lq b gy ly lv l lw lx">#Changing format to TS</span><span id="0f63" class="kn ko iq lq b gy ly lv l lw lx">crypto&lt;-ts(data,start = c(year,month,day),frequency =freq )</span><span id="191f" class="kn ko iq lq b gy ly lv l lw lx"># Finding the best C value by DOC function</span><span id="3476" class="kn ko iq lq b gy ly lv l lw lx"># Abbasov-Mamedova model</span><span id="a463" class="kn ko iq lq b gy ly lv l lw lx">str.C1&lt;-DOC(crypto,n=7,w=7,D1=0,D2=0,CEF="MAPE",type="Abbasov-Mamedova")</span><span id="30e0" class="kn ko iq lq b gy ly lv l lw lx">C1&lt;-as.numeric(str.C1[1])</span><span id="3291" class="kn ko iq lq b gy ly lv l lw lx">crypto_predict&lt;-fuzzy.ts2(crypto,n=7,w=7,D1=0,D2=0,C=C1,forecast=5,type="Abbasov-Mamedova",trace=TRUE,plot=TRUE)</span><span id="9ad5" class="kn ko iq lq b gy ly lv l lw lx">return(crypto_predict)</span><span id="a0de" class="kn ko iq lq b gy ly lv l lw lx">}</span></pre><h2 id="3c18" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">让我们评估一下结果</h2><p id="008c" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">在CRISP-DM方法的第五阶段，我们进行一些(交叉)验证。测试了以下加密货币，并显示了结果。我们在这里可以得出的结论是，趋势预测比实际值预测的误差更小。</p><figure class="ll lm ln lo gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mw"><img src="../Images/5bafeafad9e2363fe98e183eda6a10c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O8PQIS5j30Mzm35P0UuIQw.jpeg"/></div></div></figure><p id="8288" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中:</p><ul class=""><li id="0587" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> ME </em> </strong>(均值误差):<em class="km"> sum(et)/n </em></li><li id="e8c4" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> MAE </em> </strong>(平均绝对误差):<em class="km"> sum(|et|)/n </em></li><li id="b576" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> MPE </em> </strong>(平均百分比误差):<em class="km"> sum((et/Yt)*100)/n </em></li><li id="7820" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"><em class="km"/></strong>(平均绝对百分比误差):<em class="km">总和((|et|/Yt)*100)/n </em></li><li id="87d3" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> MSE </em> </strong>(均方误差):<em class="km"> sum(et*et)/n </em></li><li id="0dee" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> RMSE </em> </strong>(均方根误差):<em class="km"> sqrt(sum(et*et)/n) </em></li><li id="710e" class="md me iq jp b jq mm ju mn jy mo kc mp kg mq kk mi mj mk ml bi translated"><strong class="jp ir"> <em class="km"> U </em> </strong>(泰尔的U统计量):<em class="km">预测的RMSE/天真预测的RMSE</em></li></ul><p id="1145" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km"> Yt </em>是‘观察系列’。<em class="km"> Ft </em>是‘预测系列’。<em class="km"> et </em>为“残差序列”。<em class="km"> n </em>为样品尺寸。]</p><h2 id="c4c6" class="kn ko iq bd kp kq kr dn ks kt ku dp kv jy kw kx ky kc kz la lb kg lc ld le lf bi translated">结论和未来工作</h2><p id="0cd8" class="pw-post-body-paragraph jn jo iq jp b jq lg js jt ju lh jw jx jy li ka kb kc lj ke kf kg lk ki kj kk ij bi translated">在本文中，我使用模糊时间序列(FTS)来预测加密货币的价格。当进入评估领域时，FTS是一种有前途的技术，尤其是预测加密货币的趋势。</p><p id="5b9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章的目标是将FTS引入密码预测领域，以下步骤仍可作为未来的工作:</p><ul class=""><li id="d8a3" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated">参数调整:</li></ul><p id="8db4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在数据准备和建模期间，仍有调整参数的余地。</p><ul class=""><li id="383c" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated">融合和增量:</li></ul><p id="50e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经讨论了增量计算和变更的百分比，但是我们后来从未使用过它们。这是因为这是一个更大的方法的一部分，我想结合更多的数据来源进行预测。这将在我的下一篇文章中讨论。</p></div></div>    
</body>
</html>