<html>
<head>
<title>Testing Vue Components with Mocha and Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Mocha和Webpack测试Vue组件</h1>
<blockquote>原文：<a href="https://itnext.io/testing-vue-components-with-mocha-and-webpack-594a9f7e28b9?source=collection_archive---------2-----------------------#2018-06-10">https://itnext.io/testing-vue-components-with-mocha-and-webpack-594a9f7e28b9?source=collection_archive---------2-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0d951718846fa3da84b854d6d72b7e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkSwF-41U1EePJU5ToNZ8w.png"/></div></div></figure><p id="4509" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我写下了开始使用Vue.js + TDD的所有必要步骤。最少说话，只是代码！🤓</p><h1 id="c85a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">基本设置</h1><p id="aa91" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我们将从在终端中运行以下命令开始:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b83e" class="mi kx iq me b gy mj mk l ml mm">$ mkdir vue-tdd &amp;&amp; cd $_<br/>$ npm init -y</span></pre><p id="a3e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建一个名为<strong class="ka ir"> vue-tdd </strong>的新目录，并在其中搭建一个基本的<code class="fe mn mo mp me b">package.json</code>文件。</p><p id="c48c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要安装Vue并配置Webpack，以便它可以编译<code class="fe mn mo mp me b">.vue</code>文件。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="5f84" class="mi kx iq me b gy mj mk l ml mm">$ npm install vue --save<br/>$ npm install webpack webpack-cli --save-dev</span></pre><p id="837f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要创建一些文件来使用:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8341" class="mi kx iq me b gy mj mk l ml mm">$ touch index.html app.js webpack.config.js</span></pre><p id="bf72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的项目现在看起来像这样:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="4240" class="mi kx iq me b gy mj mk l ml mm">./index.html<br/>./app.js<br/>./package.json<br/>./package-lock.json<br/>./webpack.config.js<br/>./node_modules/</span></pre><p id="8b79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们添加一些基本的样板代码到我们的文件中，让事情开始运行！</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8561" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还没有一个<code class="fe mn mo mp me b">bundle.js</code>文件，但是这个基本的<code class="fe mn mo mp me b">webpack.config.js</code>文件会为我们编译一个:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="7ea7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<code class="fe mn mo mp me b">node_modules/.bin/webpack</code>，让Webpack发挥它的魔力！或者更好的是，将下面的脚本添加到<code class="fe mn mo mp me b">package.json</code></p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a988" class="mi kx iq me b gy mj mk l ml mm">"scripts": {<br/>  "watch": "webpack -w -d"<br/>}</span></pre><p id="9e95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从现在开始，我们只需运行<code class="fe mn mo mp me b">npm run watch</code>，保存后Webpack会自动编译<code class="fe mn mo mp me b">app.js</code>。</p><h1 id="e830" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">编译Vue组件</h1><p id="84a9" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">好了，让我们创建一个简单的Vue组件，让您在输入字段中键入您的姓名，然后打印出来:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="69dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将组件添加到<code class="fe mn mo mp me b">index.html</code>并导入到<code class="fe mn mo mp me b">app.js</code></p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="2eec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了编译Vue组件，需要修改<code class="fe mn mo mp me b">webpack.config.js</code>文件。这可以使用Vue Loader来完成，它是Webpack的一个加载器。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="ffc6" class="mi kx iq me b gy mj mk l ml mm">$ npm install vue-loader --save-dev</span></pre><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="8ae8" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">安装Vue测试工具</h1><p id="90ed" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">随着Webpack的配置和Vue组件的工作，终于到了一些TDD的时候了！我一直在遵循这个关于<a class="ae ms" href="https://vue-test-utils.vuejs.org/guides/#testing-single-file-components-with-mocha-webpack" rel="noopener ugc nofollow" target="_blank">如何使用Mocha和Vue测试工具的指南</a>。</p><p id="5e4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一步当然是多运行几次<code class="fe mn mo mp me b">npm install</code>:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="61a1" class="mi kx iq me b gy mj mk l ml mm">$ npm install --save-dev @vue/test-utils mocha mocha-webpack<br/>$ npm install --save-dev jsdom jsdom-global<br/>$ npm install --save-dev expect</span></pre><p id="1a3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们应该将一个<code class="fe mn mo mp me b">test</code>脚本添加到我们的<code class="fe mn mo mp me b">package.json</code>文件中:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1d2c" class="mi kx iq me b gy mj mk l ml mm">"scripts": {<br/>  "test": "mocha-webpack -w --webpack-config webpack.config.js --require test/setup.js test/**/*.spec.js",<br/>  "watch": "webpack -w -d"<br/>}</span></pre><p id="8b62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个脚本中，您可能会注意到它期望找到一个包含一个<code class="fe mn mo mp me b">setup.js</code>文件和<code class="fe mn mo mp me b">something-something.spec.js</code>文件的<code class="fe mn mo mp me b">test/</code>目录。<br/><code class="fe mn mo mp me b">*.spec.js</code>文件，正如你可能猜到的，是包含我们的测试的文件。但是<code class="fe mn mo mp me b">setup.js</code>文件呢？<br/>这其实很简单，只需要包含这两行:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h2 id="e957" class="mi kx iq bd ky mt mu dn lc mv mw dp lg kj mx my lk kn mz na lo kr nb nc ls nd bi translated">什么都没发生？</h2><p id="c9ed" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">当我自己尝试这个的时候，我遇到了一个问题。好像当我跑的时候什么都没发生。控制台中的输出只显示了类似这样的内容:</p><blockquote class="ne nf ng"><p id="0c79" class="jy jz nh ka b kb kc kd ke kf kg kh ki ni kk kl km nj ko kp kq nk ks kt ku kv ij bi translated"><strong class="ka ir">web pack:</strong>31毫秒内编译成功</p></blockquote><p id="2f02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在向我的朋友谷歌咨询了一下之后，我在GitHub上发现了下面这个帖子:</p><div class="nl nm gp gr nn no"><a href="https://github.com/zinserjan/mocha-webpack/issues/209" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">Mocha-webpack似乎无法与webpack 4问题#209 zinserjan/mocha-webpack一起使用</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">问题使用最新的webpack 4运行mocha-webpack似乎会失败。不显示测试输出。我创建了一个…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc jw no"/></div></div></a></div><p id="5219" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">原来Mocha-Webpack包还不支持Webpack 4。(OMG这个JS生态圈！😅)<br/>但众所周知，一切都可以用<code class="fe mn mo mp me b">npm install</code>解决！</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="98d5" class="mi kx iq me b gy mj mk l ml mm">$ npm install mocha-webpack@next</span></pre><p id="b0c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，如果我们现在再次运行<code class="fe mn mo mp me b">npm run test</code>，您应该会看到类似这样的内容:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/bb95d85ba70438824a31740de47fe1d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2g-SopHXOqRrY81mJfD1LQ.png"/></div></div></figure><h1 id="60e6" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建一个测试</h1><p id="1285" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">最后，是时候真正开始编写测试了。让我们为<code class="fe mn mo mp me b">my-name</code>组件创建一个测试。如果你不记得了，这是它的样子:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="fba3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望测试能证实这三件事是有效的:</p><ol class=""><li id="0d22" class="oe of iq ka b kb kc kf kg kj og kn oh kr oi kv oj ok ol om bi translated">默认情况下，名称值应该是我的名字。</li><li id="320c" class="oe of iq ka b kb on kf oo kj op kn oq kr or kv oj ok ol om bi translated">我可以在输入框中写下我的名字</li><li id="a31f" class="oe of iq ka b kb on kf oo kj op kn oq kr or kv oj ok ol om bi translated">名称值应该已经更改为我写的任何名称</li></ol><p id="3071" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试看起来是这样的:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="30de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们再次运行<code class="fe mn mo mp me b">npm run test</code>时，我们应该会看到测试通过。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/41828298fc0e7eafd6e318106236bfcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YjWtYRpJJfGqEtAeajPCg.png"/></div></div></figure><p id="1e49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！经过一堆<code class="fe mn mo mp me b">npm install</code>和配置，我们的测试环境终于启动并运行了！</p></div></div>    
</body>
</html>