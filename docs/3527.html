<html>
<head>
<title>Kubernetes Monitoring and Logging Solution: EMG and EFK Stack (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes监测和记录解决方案:EMG和EFK叠加(第1部分)</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-monitoring-and-logging-solution-emg-and-efk-stack-part-1-8aa58339e7a4?source=collection_archive---------4-----------------------#2020-01-03">https://itnext.io/kubernetes-monitoring-and-logging-solution-emg-and-efk-stack-part-1-8aa58339e7a4?source=collection_archive---------4-----------------------#2020-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e41bda815458e7719f3cefd87945974b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YohmvaG9xgxaD6y2iCfPNA.jpeg"/></div></div></figure><p id="f1ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">监控和记录系统是DevOps文化的重要组成部分。本文共分3部分，每部分分别为<strong class="ka ir">监控</strong>、<strong class="ka ir">日志记录</strong>、<strong class="ka ir">报警</strong>。在第一部分，我们将讨论如何从Kubernetes集群中收集度量，以及如何可视化它们。在第二部分，我们将讨论如何从运行在Kubernetes上的应用程序中收集日志。最后，我们将学习如何设置警报，例如，如果应用程序产生错误，或者如果内存使用率超过80%。</p><p id="9d41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> EMG STACK </strong></p><p id="af38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为Kubernetes集群设置监控允许您跟踪系统和应用程序资源使用情况。有许多用于Kubernetes监测的替代堆栈，如promethius-Grafana-alert manager、Telegraf-influx db-Chronograf-Kapacitor(TICK堆栈)等。今天，我将介绍一种使用elastic search-metric bate-Grafana(EMG)的不同方法。</p><p id="b3f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">metric bate</strong>是一款轻质公制收集器。它通过各种模块从系统和服务中收集指标。我们可以使用系统模块轻松收集系统指标，使用Kubernetes模块轻松收集Kubernetes指标。在收集并向<strong class="ka ir">弹性搜索</strong>(参见图1)发送度量后，我们可以使用<strong class="ka ir"> Kibana </strong>进行可视化，因为弹性提供了默认的可视化，如下所示。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/806c57fc60543283ee323f2e1296f85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WGNiD-TwBzfdXA6Fvfu5vQ.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lf">kiba na metric bate</strong></figcaption></figure><p id="6603" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用了基巴纳一段时间，然后我决定使用弹性搜索作为数据源在Grafana中构建相同的可视化，因为Grafana为您提供了更好的可视化选项，如下所示。(这当然是我个人的观点)</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/5c9e46f71aff11dee4214a6a355c8d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySZETctFADX5lM5t1XJCEg.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated"><strong class="bd lf">Grafana metric bate</strong></figcaption></figure><p id="5abb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要在Kubernetes群集中的每个节点上安装metricbeat代理，正如您在<strong class="ka ir">图1 </strong>中看到的，这样您就可以收集度量了。使用DaemonSet确保在集群中的每个节点(主节点除外)上运行metricbeat。默认情况下，DaemonSets不在主节点上调度。为了将其安排在主菜单上，您必须在pod规范中添加一个容差。下面是一个示例。</p><pre class="kx ky kz la gt lh li lj lk aw ll bi"><span id="fec8" class="lm ln iq li b gy lo lp l lq lr">tolerations:</span><span id="6189" class="lm ln iq li b gy ls lp l lq lr">- key: node-role.kubernetes.io/master</span><span id="82ae" class="lm ln iq li b gy ls lp l lq lr">operator: Exists</span><span id="71df" class="lm ln iq li b gy ls lp l lq lr">effect: NoSchedule</span><span id="60f5" class="lm ln iq li b gy ls lp l lq lr">- operator: "Exists"</span><span id="9518" class="lm ln iq li b gy ls lp l lq lr">effect: "NoExecute"</span><span id="fd38" class="lm ln iq li b gy ls lp l lq lr">- operator: "Exists"</span><span id="9cec" class="lm ln iq li b gy ls lp l lq lr">effect: "NoSchedule"</span></pre><p id="d7e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以从<a class="ae lt" href="http://www.elastic.co" rel="noopener ugc nofollow" target="_blank"> Elastic </a>提供的<a class="ae lt" href="https://github.com/elastic/beats/tree/master/deploy/kubernetes/metricbeat" rel="noopener ugc nofollow" target="_blank"> github </a>下载官方清单文件。下载并安装metricbeat清单文件后，现在您可以配置您的<strong class="ka ir"> Grafana </strong>仪表盘了。你可以从我在grafana.com分享的<a class="ae lt" href="https://grafana.com/grafana/dashboards/11507" rel="noopener ugc nofollow" target="_blank">示例仪表板</a>开始。metricbeat产生了许多指标，您可以创建与我不同的仪表板。</p></div></div>    
</body>
</html>