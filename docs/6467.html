<html>
<head>
<title>The Definitive Guide for hosting your Wordpress webpage for 0,5 $ / month on the Amazon Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在亚马逊云上以每月0.5美元托管你的Wordpress网页的权威指南</h1>
<blockquote>原文：<a href="https://itnext.io/the-definitive-guide-for-hosting-your-wordpress-webpage-for-0-5-month-on-the-amazon-cloud-54bafd628539?source=collection_archive---------1-----------------------#2021-11-24">https://itnext.io/the-definitive-guide-for-hosting-your-wordpress-webpage-for-0-5-month-on-the-amazon-cloud-54bafd628539?source=collection_archive---------1-----------------------#2021-11-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b3f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">完整的Terraform模板，使用AWS免费层提供托管Wordpress网页的基础设施。</h2></div><p id="1049" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由<a class="lc ld ep" href="https://medium.com/u/3a885b23263a?source=post_page-----54bafd628539--------------------------------" rel="noopener" target="_blank"> Women Decode </a>撰写的文章<a class="ae lb" href="https://medium.com/@womendecode/5-steps-to-create-a-wordpress-site-on-aws-free-tier-5f825195b4a6" rel="noopener">“在AWS Free Tier上创建Wordpress站点的5个步骤”</a>解释了如何使用AWS Free Tier手动设置Wordpress站点，受此启发，我很高兴与您分享我的完整Terraform模板。</p><p id="b239" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，你不仅会得到一个完全可重用的Terraform配置，还会学到一些关于AWS主题的有趣东西，比如弹性IP地址或RDS数据库的动态存储自动缩放，以及如何使用docker-compose在容器中运行Wordpress。</p><p id="cd26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就像我以前关于<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/the-definitive-guide-for-setting-up-a-clean-and-working-aws-eks-kubernetes-infrastructure-for-2d4153d47e20"> Terraform EKS模板</a>的文章一样，我将首先解释目标基础设施和存储库内容，然后是关于配置和使用的AWS服务的一些细节。为了让您尽快入门，本文最后给出了使用该模板的说明。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="e602" class="ll lm iq bd ln lo lp lq lr ls lt lu lv jw lw jx lx jz ly ka lz kc ma kd mb mc bi translated">让我们开始吧。</h1><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi md"><img src="../Images/b399887622816c8a8000c5546b49e5c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*Xn0kTaE7dx47HgcvnfBpmA.png"/></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk translated">运行Wordpress的AWS基础设施</figcaption></figure><p id="9f53" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://aws.amazon.com/free/?nc1=h_ls&amp;all-free-tier.sort-by=item.additionalFields.SortRank&amp;all-free-tier.sort-order=asc&amp;awsf.Free%20Tier%20Types=*all&amp;awsf.Free%20Tier%20Categories=*all" rel="noopener ugc nofollow" target="_blank"> AWS免费层</a>允许您在注册您的AWS帐户后12个月内免费使用特定的<strong class="kh ir">云资源。要部署Wordpress，我们需要一个虚拟机和一个数据库。幸运的是，使用一个<code class="fe mp mq mr ms b">t2.micro</code>或<code class="fe mp mq mr ms b">t3.micro</code> EC2实例第一年是完全免费的，还有一个<code class="fe mp mq mr ms b">db.t2.micro</code> MySQL RDS实例，有高达20GB的SSD存储。托管Wordpress页面的EC2实例应该是公开可用的。我们有多种选择来实现这一点——首选且更安全的方法是在公共子网中部署应用负载平衡器(ALB ),并将流量代理给位于私有子网中的EC2实例。然而，在这种情况下，<strong class="kh ir">我们不希望在我们的账单上看到相当高的负载平衡器</strong>的成本。因此，我们将带有Wordpress的EC2实例放在公共子网中，并将一个静态公共IP地址(“EIP —弹性IP地址”)附加到该实例上，只要它附加到一个实例上，这是免费的→不会引入额外的成本。为了<strong class="kh ir">终止TLS连接</strong>，我们部署了一个<a class="ae lb" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>反向代理，为WordPress实例提供流量。</strong></p><blockquote class="mt"><p id="41a4" class="mu mv iq bd mw mx my mz na nb nc la dk translated">那么50美分/月从何而来？</p></blockquote><p id="fe1c" class="pw-post-body-paragraph kf kg iq kh b ki nd jr kk kl ne ju kn ko nf kq kr ks ng ku kv kw nh ky kz la ij bi translated">我假设托管域，在这种情况下，网页应该可以通过AWS Route53服务的公共托管区域访问。DNS解析必须通过您的域注册管理控制台中的NS记录委派给公共托管区域的AWS DNS服务器。然而，也可以只创建一个DNS A记录来解析EC2实例的公共静态IP地址，这甚至可以节省50美分——我只是更喜欢这样做，它使模板更好地可用和自动化。好吧，让我们来看看存储库。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1f23" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过调用所有子模块来声明整个基础设施的主配置文件是<code class="fe mp mq mr ms b">main.tf</code>，它大量使用由<a class="lc ld ep" href="https://medium.com/u/5312b1f1bba0?source=post_page-----54bafd628539--------------------------------" rel="noopener" target="_blank"> Anton Babenko </a>管理的AWS社区模块:</p><h2 id="99d4" class="nk lm iq bd ln nl nm dn lr nn no dp lv ko np nq lx ks nr ns lz kw nt nu mb nv bi translated">建立工作关系网</h2><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="324b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里没什么特别的。值得一提的是禁用NAT网关(<code class="fe mp mq mr ms b">enable_nat_gateway = false</code>)，因为我们的私有子网中没有需要访问互联网的工作负载。此外，部署NAT网关会带来高成本。</p><h2 id="f942" class="nk lm iq bd ln nl nm dn lr nn no dp lv ko np nq lx ks nr ns lz kw nt nu mb nv bi translated">域名服务器(Domain Name Server)</h2><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="e9e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模块调用<code class="fe mp mq mr ms b">modules/dns-a-record</code>在公共托管区域(<code class="fe mp mq mr ms b">var.dns_zone</code>)中创建一个A记录，它解析为Wordpress EC2实例的弹性IP地址。</p><h2 id="79eb" class="nk lm iq bd ln nl nm dn lr nn no dp lv ko np nq lx ks nr ns lz kw nt nu mb nv bi translated">Wordpress数据库</h2><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="88b6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个RDS MySQL数据库是由<code class="fe mp mq mr ms b">wp-db</code>模块完成的，它还保护创建的RDS实例(只有端口3306是开放的)。通过定义最大分配存储(<code class="fe mp mq mr ms b">var.rds_max_allocated_storage</code>)，RDS的动态存储自动缩放功能被激活。通过将此变量设置为值<code class="fe mp mq mr ms b">20</code>和初始分配存储(<code class="fe mp mq mr ms b">var.rds_allocated_storage</code>)到<code class="fe mp mq mr ms b">5</code>，RDS会自动将存储容量扩展到20GB(这是空闲层存储容量的限制)，以防磁盘变满。</p><p id="e85d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在上面的参数列表中，可以注意到缺少数据库密码的定义。这是因为我们不想将DB-password作为源代码保存在存储库中的某个文件中。而是通过Terraform数据源从文件<code class="fe mp mq mr ms b">modules/wp-db/data.tf</code>中的AWS系统管理器参数存储中读取:</p><pre class="me mf mg mh gt nw ms nx ny aw nz bi"><span id="4157" class="nk lm iq ms b gy oa ob l oc od">data "aws_ssm_parameter" "rds_password" {<br/>  name = "/${var.environment}/database/password"<br/>}</span></pre><p id="2bee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">确保在计划或应用地形配置之前创建参数。</strong></p><h2 id="869b" class="nk lm iq bd ln nl nm dn lr nn no dp lv ko np nq lx ks nr ns lz kw nt nu mb nv bi translated">Wordpress主机</h2><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="70a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，模块<code class="fe mp mq mr ms b">wp-host</code>提供EC2实例和弹性IP地址。值得注意的是TLS-certificate ( <code class="fe mp mq mr ms b">tls_server_crt</code>，<code class="fe mp mq mr ms b">tls_server_key</code>)被传递给模块。这些参数是从<code class="fe mp mq mr ms b">certs</code>目录下的文件中读取的。请确保将您的TLS服务器证书和相应的密钥复制到此目录。</p><p id="1cae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">剩下的最后一个问题是:Wordpress现在是如何在EC2实例上运行的？这是通过“用户数据”脚本→ <code class="fe mp mq mr ms b">modules/wp-host/userdata/userdata.wp.sh</code>完成的。</p><p id="30ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个<code class="fe mp mq mr ms b">userdata</code>-脚本中，安装了运行带有<a class="ae lb" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>的容器化Wordpress所需的工具，并且完成了Traefik反向代理和Wordpress容器的所有配置。如果你有兴趣的话，可以更深入地了解它，或者随时联系我。</p><h1 id="0329" class="ll lm iq bd ln lo oe lq lr ls of lu lv jw og jx lx jz oh ka lz kc oi kd mb mc bi translated">结论和开始</h1><p id="c694" class="pw-post-body-paragraph kf kg iq kh b ki oj jr kk kl ok ju kn ko ol kq kr ks om ku kv kw on ky kz la ij bi translated">为了快速开始使用模板，需要完成以下步骤:</p><ul class=""><li id="f6d3" class="oo op iq kh b ki kj kl km ko oq ks or kw os la ot ou ov ow bi translated">将TLS证书和密钥复制到<code class="fe mp mq mr ms b">certs</code>目录中，并命名为<code class="fe mp mq mr ms b">server.crt</code>和<code class="fe mp mq mr ms b">server.key</code></li><li id="9a5a" class="oo op iq kh b ki ox kl oy ko oz ks pa kw pb la ot ou ov ow bi translated">在Route53中创建一个公共托管区域，并相应地设置变量<code class="fe mp mq mr ms b">dns_zone</code></li><li id="b85f" class="oo op iq kh b ki ox kl oy ko oz ks pa kw pb la ot ou ov ow bi translated">在AWS系统管理器参数存储中的路径<code class="fe mp mq mr ms b">/${var.environment}/database/password</code>处创建数据库密码，因为它是通过Terraform数据源读取的，以设置RDS数据库密码</li><li id="132b" class="oo op iq kh b ki ox kl oy ko oz ks pa kw pb la ot ou ov ow bi translated">修改<code class="fe mp mq mr ms b">envs/example.tfvars</code>中的变量:<code class="fe mp mq mr ms b">aws_accountnumber</code>、<code class="fe mp mq mr ms b">dns_zone</code></li></ul><p id="3548" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe mp mq mr ms b">terraform apply -var-file envs/example.tfvars</code>应用Terraform配置后，Wordpress界面在<code class="fe mp mq mr ms b">https://${var.dns_zone}</code>和<code class="fe mp mq mr ms b">https://${var.subdomain}.${var.dns_zone}</code>都可用。</p><p id="f6cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请随意克隆、贡献或试用它。该存储库可从<a class="ae lb" href="https://github.com/yandok/terraform-aws-wordpress-template" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得:</p><div class="pc pd gp gr pe pf"><a href="https://github.com/yandok/terraform-aws-wordpress-template" rel="noopener  ugc nofollow" target="_blank"><div class="pg ab fo"><div class="ph ab pi cl cj pj"><h2 class="bd ir gy z fp pk fr fs pl fu fw ip bi translated">GitHub-yandok/terraform-AWS-Wordpress-template:Wordpress的完整terra form模板…</h2><div class="pm l"><h3 class="bd b gy z fp pk fr fs pl fu fw dk translated">Wordpress部署的完整Terraform模板-GitHub-yandok/terra form-AWS-Wordpress-template:complete…</h3></div><div class="pn l"><p class="bd b dl z fp pk fr fs pl fu fw dk translated">github.com</p></div></div><div class="po l"><div class="pp l pq pr ps po pt mj pf"/></div></div></a></div></div></div>    
</body>
</html>