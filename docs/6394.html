<html>
<head>
<title>Replacing Docker Desktop with Multipass, to avoid Docker Desktop fees</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Multipass替换Docker桌面，以避免Docker桌面费用</h1>
<blockquote>原文：<a href="https://itnext.io/replacing-docker-desktop-with-multipass-to-avoid-docker-desktop-fees-8cbe57b9037f?source=collection_archive---------2-----------------------#2021-11-06">https://itnext.io/replacing-docker-desktop-with-multipass-to-avoid-docker-desktop-fees-8cbe57b9037f?source=collection_archive---------2-----------------------#2021-11-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="0f1d" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在不需要Docker桌面的情况下，在macOS或Windows上设置Docker的令人惊讶的简单方法</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/7ceff44b812d49922dc7e9963954aebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7iSohO2EY9hB3MNz.jpg"/></div></div></figure><p id="8ec0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv"> Docker是开源软件，Docker Desktop是一个漂亮的GUI应用程序，可以简化在macOS或Windows机器上安装Docker。它值得使用，因为使用Docker非常容易。然而，Docker Inc .已经转向Docker桌面应用的免费增值模式，这将导致一些人避免使用它，而是寻求替代方案来避免支付费用。我们将讨论的是使用Multipass或其他虚拟机来避免这些费用。</strong></p><p id="8429" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在Docker的旧时代，将它安装在macOS或Windows机器上是一项重大成就。由于Docker是在Linux上本地运行的，因此可以在Docker Engine for Linux上安装Linux虚拟机。在过去，这意味着使用VirtualBox，这是一个重量级的虚拟机系统。使用Docker桌面是一个巨大的简化，因为Docker的一切都是作为一个普通的应用程序安装的。它带有一个很好的GUI，可以通过鼠标点击来管理本地Docker实例。</p><p id="c692" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">纵观其历史，Docker Desktop一直是免费的，但在2021年8月，Docker Inc宣布了新的免费增值模式。详情见:<a class="ae lr" href="https://techsparx.com/software-development/docker/docker-desktop/not-free.html" rel="noopener ugc nofollow" target="_blank"> Docker Inc从Docker桌面和其他Docker工具中榨取金钱</a>。简而言之，超过一定规模的组织预计每个开发人员每月支付5美元左右。费用还包括Docker Hub上的服务。</p><p id="8f2a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们中的一些人可能不愿意为Docker桌面每月支付5美元左右。因为Docker提供了极好的商业价值，所以付费是一个很好的理由。但是，我们有些人想知道他们可以用什么来代替Docker桌面。</p><p id="2592" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">需要注意的是Docker并不是不再免费了。Docker仍然是免费的，但是Docker生态系统的一部分需要付费。</p><p id="c9f7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">选择使用Docker桌面受到另一个事实的影响。过去在macOS或Windows上使用虚拟机设置Docker很困难，现在变得非常容易。换句话说，Docker桌面有一个值得替代的东西，值得探索。</p><h1 id="1708" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">不使用Docker桌面在macOS或Windows上运行Docker的策略</h1><p id="f7a3" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">Docker桌面产品内部是一个运行虚拟Linux实例的轻量级管理程序。Linux内部是Docker引擎的Linux版本。Docker Desktop的神奇之处在于，hypervisor对我们来说是不可见的。我们坐在命令行上键入<code class="fe mp mq mr ms b">docker pull</code>或<code class="fe mp mq mr ms b">docker build</code>，并不知道每个命令都到达虚拟Linux实例内部来做所有事情。</p><p id="dad4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">为了避免使用Docker桌面，我们需要回到安装一个运行Linux的虚拟机来安装Docker引擎的基础上，然后用某种方式变变魔术。幸运的是，现在一切都比过去简单了。例如，Multipass是轻量级虚拟机平台，使用它我们可以轻松地设置和运行Ubuntu实例。然后我们可以安装Docker，我们甚至可以配置多个Linux虚拟机，每个虚拟机都有一个Docker实例，这样我们就可以实现一个多节点集群来试验Docker Swarm或Kubernetes。</p><p id="a5ad" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们的计划是这样:</p><ul class=""><li id="cc83" class="mt mu iu kx b ky kz lb lc le mv li mw lm mx lq my mz na nb bi translated">使用Canonical的轻量级虚拟机系统<em class="nc"> Multipass </em>，并在Ubuntu实例中安装Docker引擎。</li><li id="118e" class="mt mu iu kx b ky nd lb ne le nf li ng lm nh lq my mz na nb bi translated">对于macOS，通过MacPorts或HomeBrew安装<code class="fe mp mq mr ms b">docker</code> CLI。</li><li id="e196" class="mt mu iu kx b ky nd lb ne le nf li ng lm nh lq my mz na nb bi translated">对于Windows，通过安装<code class="fe mp mq mr ms b">docker</code> CLI...？看起来Chocolatey包管理器是最好的选择。</li><li id="1fe5" class="mt mu iu kx b ky nd lb ne le nf li ng lm nh lq my mz na nb bi translated">配置Docker上下文，以便与托管在Multipass实例中的Docker引擎进行通信。</li><li id="9a4b" class="mt mu iu kx b ky nd lb ne le nf li ng lm nh lq my mz na nb bi translated">如果我们想要实现Docker Swarm，或者Kubernetes集群，那么可以通过启动多个Multipass实例来实现。</li></ul><p id="0680" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">换句话说，这个计划依赖于托管Docker实例的显式Linux管理程序。这一次更简单了，因为Docker上下文特性，以及Multipass如何使启动轻量级Linux虚拟机变得容易。</p><h1 id="ebe9" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">在Windows或macOS上为Docker设置多通道实例</h1><p id="ed02" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">要安装Multipass，请前往<code class="fe mp mq mr ms b">https://multipass.run</code>并下载适用于您的操作系统的安装程序。运行安装程序，您将有一个新的命令，<code class="fe mp mq mr ms b">multipass,</code>可用。Multipass网站提供了一些命令示例，帮助您熟悉其用法。</p><p id="bbd6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我写过一篇关于使用Multipass设置多个Docker实例的文章，参见:<a class="ae lr" href="https://techsparx.com/software-development/docker/swarm/multipass.html" rel="noopener ugc nofollow" target="_blank">在您的笔记本电脑上使用Multipass和Ubuntu 20.04创建Docker Swarm</a>…我们这里要做的是该过程的精简版本。</p><p id="bd27" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">创建<code class="fe mp mq mr ms b">setup-instance.sh</code>包含:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="37f5" class="nm lt iu ms b gz nn no l np nq">sudo apt-get update <br/>sudo apt-get upgrade -y <br/>sudo apt-get -y install \ <br/>       apt-transport-https \ <br/>       ca-certificates \ <br/>       curl \ <br/>       gnupg-agent \ <br/>       software-properties-common </span><span id="b5a4" class="nm lt iu ms b gz nr no l np nq">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \<br/>       sudo apt-key add - </span><span id="115f" class="nm lt iu ms b gz nr no l np nq">sudo apt-key fingerprint 0EBFCD88 </span><span id="fb67" class="nm lt iu ms b gz nr no l np nq">sudo add-apt-repository \ <br/>     "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" </span><span id="bd2a" class="nm lt iu ms b gz nr no l np nq">sudo apt-get update <br/>sudo apt-get upgrade -y <br/>sudo apt-get install -y docker-ce docker-ce-cli containerd.io sudo groupadd docker <br/>sudo usermod -aG docker ubuntu <br/>sudo systemctl enable docker</span></pre><p id="f46a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个脚本来源于在Ubuntu Linux上安装Docker的官方说明。</p><p id="6380" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">接下来，创建一个名为<code class="fe mp mq mr ms b">init-instance.sh</code>的shell脚本，其中包含:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="6826" class="nm lt iu ms b gz nn no l np nq">NM=$1 </span><span id="43c9" class="nm lt iu ms b gz nr no l np nq">multipass launch --name ${NM} focal <br/>multipass transfer setup-instance.sh ${NM}:/home/ubuntu/setup-instance.sh <br/>multipass exec ${NM} -- sh -x /home/ubuntu/setup-instance.sh</span></pre><p id="d438" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个脚本在Multipass上启动一个新的Ubuntu实例。然后它在新实例中执行<code class="fe mp mq mr ms b">setup-instance.sh</code>。</p><p id="767c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">运行脚本如下:<code class="fe mp mq mr ms b">./init-instance.sh docker1</code></p><p id="17cb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">它设置了Multipass实例，并初始化Docker。要验证Docker是否正在运行，请键入以下命令:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="814b" class="nm lt iu ms b gz nn no l np nq">multipass exec NAME -- docker run hello-world</span></pre><p id="edac" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这为您提供了一个Docker实例。我们可以在Ubuntu实例中运行Docker命令，但是要像Docker桌面一样，需要在我们的主机系统的命令行中运行Docker命令。为此，我们需要对Multipass实例进行无密码的SSH访问，然后设置Docker上下文。</p><h1 id="ec98" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">设置对新创建的Multipass实例的无密码SSH访问</h1><p id="aad4" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">下一步是启用对Multipass实例的无密码SSH访问。我们需要它来设置一个上下文来控制Docker实例。参见:<a class="ae lr" href="https://techsparx.com/linux/multipass/enable-ssh.html" rel="noopener ugc nofollow" target="_blank">如何在Ubuntu 20.04上启用Multipass内的无密码SSH登录</a>如果您设置了远程SSH访问，步骤非常简单。只需将SSH密钥从<code class="fe mp mq mr ms b">~/.ssh</code>(例如<code class="fe mp mq mr ms b">~/.ssh/id_rsa.pub</code>)复制到Ubuntu实例中的<code class="fe mp mq mr ms b">~/.ssh/authorized_keys</code>文件中。</p><p id="9a78" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">一旦这些步骤完成，你应该能够运行<code class="fe mp mq mr ms b">ssh -l ubuntu IP-ADDRESS</code>在Ubuntu实例中得到一个shell提示。而且，你应该能够运行这个:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="473d" class="nm lt iu ms b gz nn no l np nq">$ ssh -l ubuntu  192.168.64.21 docker run hello-world</span></pre><p id="772c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">要了解IP地址，运行<code class="fe mp mq mr ms b">multipass list. </code>我们现在准备设置一个Docker上下文来简化它，但是首先我们需要在您的主机上安装开源Docker命令。</p><h1 id="0cd4" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">在Windows和macOS上安装开源<code class="fe mp mq mr ms b">docker</code>命令</h1><p id="a300" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">我们中有多少人使用Docker桌面GUI？我很少使用它，也不会错过它。命令行<code class="fe mp mq mr ms b">docker</code>命令足以满足我的需求。</p><p id="8813" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">安装Docker Desktop会给你命令行<code class="fe mp mq mr ms b">docker</code>命令。因此，您可能已经安装了它们。但是我们正在探索的是在不依赖Docker桌面的情况下安装<code class="fe mp mq mr ms b">docker</code>命令。</p><p id="0345" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mp mq mr ms b">docker</code>命令是开源的，并将永远保持开源。这意味着可以从包管理系统如MacPorts和HomeBrew获得包，提供<code class="fe mp mq mr ms b">docker</code>命令。</p><p id="8646" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">使用MacPorts:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="e96b" class="nm lt iu ms b gz nn no l np nq">port search docker <br/>... <br/>docker @20.10.9 (devel)<br/>    The open-source application container engine </span><span id="415d" class="nm lt iu ms b gz nr no l np nq">docker-compose @1.29.2 (python, devel)<br/>   Define and run multi-container applications with Docker <br/>... </span><span id="3038" class="nm lt iu ms b gz nr no l np nq">$ sudo port install docker <br/>Password: <br/>---&gt; Fetching archive for docker <br/>---&gt; Attempting to fetch docker-20.10.9_0.darwin_19.x86_64.tbz2 from https://packages.macports.org/docker <br/>---&gt; Attempting to fetch docker-20.10.9_0.darwin_19.x86_64.tbz2.rmd160 from https://packages.macports.org/docker Installing docker @20.10.9_0 <br/>---&gt; Activating docker @20.10.9_0 <br/>---&gt; Cleaning docker <br/>---&gt; Updating database of binaries <br/>---&gt; Scanning binaries for linking errors <br/>---&gt; No broken files found. <br/>---&gt; No broken ports found.</span><span id="1b0c" class="nm lt iu ms b gz nr no l np nq">$ which docker <br/>/opt/local/bin/docker <br/>$ docker container ls <br/>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?<br/>$ /Applications/Docker.app/Contents/Resources/bin/docker --version<br/>Docker version 20.10.8, build 3967b7d <br/>$ /Applications/Docker.app/Contents/Resources/bin/docker container ls <br/>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></pre><p id="d09a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">与MacPorts管理的其他命令一样，<code class="fe mp mq mr ms b">docker</code>命令安装在<code class="fe mp mq mr ms b">/opt/local/bin</code>中。为了比较，我们找到了作为Docker Desktop的一部分安装的<code class="fe mp mq mr ms b">docker</code>命令，并了解到当前版本是20.10.8，而MacPorts安装的版本是20.10.9。</p><p id="3dc4" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当使用自制软件时，基本上是一样的:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="9da9" class="nm lt iu ms b gz nn no l np nq">$ brew install docker <br/>==&gt; Pouring docker--20.10.10.catalina.bottle.tar.gz <br/>Error: The `brew link` step did not complete successfully The formula built, but is not symlinked into /usr/local <br/>Could not symlink bin/docker <br/>Target /usr/local/bin/docker<br/>already exists. You may want to remove it:<br/>  rm '/usr/local/bin/docker'</span><span id="8ac4" class="nm lt iu ms b gz nr no l np nq">To force the link and overwrite all conflicting files: brew link --overwrite docker <br/>... <br/>==&gt; Summary <br/>🍺 /usr/local/Cellar/docker/20.10.10: 12 files, 56.8MB <br/>...<br/>$ /usr/local/Cellar/docker/20.10.10/bin/docker --version<br/>Docker version 20.10.10, build b485636f4b <br/>$ /usr/local/Cellar/docker/20.10.10/bin/docker container ls <br/>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></pre><p id="6425" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">由于Docker Desktop安装了现有的<code class="fe mp mq mr ms b">/usr/local/bin/docker</code>,自制软件安装失败。然而，它仍然被安装在指定位置的地窖中。这与MacPorts版本大致相同。注意，这个安装的版本是20.10.10，这意味着所有三个源代码都是最新的。</p><p id="f0f9" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在Windows上，应该有一个类似的包可以通过WinGet命令获得。WinGet相当于我们刚刚研究过的macOS软件包管理系统。但是，似乎没有合适的<code class="fe mp mq mr ms b">docker</code>包可以通过WinGet获得。然而，Docker桌面和Multipass都是通过WinGet管理的。</p><p id="027d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在Chocolatey存储库中似乎有一个<code class="fe mp mq mr ms b">docker</code>包。你可以在https://chocolatey.org/<a class="ae lr" href="https://chocolatey.org/" rel="noopener ugc nofollow" target="_blank">了解更多</a></p><p id="6ea9" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Windows上的另一个选项是启动一个WSL2实例，并在那里安装<code class="fe mp mq mr ms b">docker</code>命令。</p><h1 id="3b2d" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">设置Docker上下文以控制在Multipass中运行的Docker实例</h1><p id="7570" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">我们现在可以进入本文的要点，即将运行在主机系统上的<code class="fe mp mq mr ms b">docker</code>命令与之前设置的Ubuntu实例内部的Docker实例连接起来。</p><p id="b563" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">2019年，Docker团队增加了一个新功能，<em class="nc"> Docker Context </em>。这是设置Docker实例远程控制的最简单、最安全的方式。传统的方法是公开暴露Docker TCP点，然后设置一些TLS证书和其他复杂的步骤。使用Docker上下文，我们可以使用无密码的SSH连接来连接远程Docker实例。</p><p id="fd39" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">默认情况下，<code class="fe mp mq mr ms b">docker</code>命令试图连接到本地主机上运行的Docker引擎。但是，除非您的主机上运行了活动的Docker桌面，否则以下操作将会失败:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="d9e8" class="nm lt iu ms b gz nn no l np nq">$ docker ps <br/>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></pre><p id="8c9e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mp mq mr ms b">docker</code>命令支持一组连接到远程Docker实例的环境变量。连接远程Docker实例的典型方式是从远程主机公开Docker TCP端口。但这似乎是一个很大的安全问题。</p><p id="4c08" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Docker上下文特性是一种更好的方法。有了Docker Context，我们可以配置到数十或数百个远程Docker实例的连接，甚至可以连接到AWS或Azure上的Docker部署。你可以在我的书<a class="ae lr" href="https://www.amazon.com/Deploying-Docker-Containers-using-Terraform-ebook/dp/B08WG578L1?pd_rd_w=c2QA4&amp;pf_rd_p=c0296674-5a83-4ad6-b035-0702d2b359df&amp;pf_rd_r=RQGPEJ2N7GT6TGRY6ZBA&amp;pd_rd_r=cd10488f-7d6d-4818-9199-9f3dbca9eb7e&amp;pd_rd_wg=BCIlw&amp;pd_rd_i=B08WG578L1&amp;psc=1&amp;linkCode=ll1&amp;tag=thereikipage&amp;linkId=c30a8498d230dfe9af0c9e8f84146512&amp;language=en_US&amp;ref_=as_li_ss_tl" rel="noopener ugc nofollow" target="_blank"> <em class="nc">使用Terraform将Docker容器部署到AWS:在EC2或ECS上以简单的方式运行Docker</em></a>中了解更多关于使用AWS的信息。</p><p id="25a1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">要为在Multipass中运行的Ubuntu设置上下文，请运行以下命令:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="5ee3" class="nm lt iu ms b gz nn no l np nq">$ docker context create docker1 \ <br/>     --docker "host=ssh://ubuntu@192.168.64.21"<br/>docker1 <br/>Successfully created context "docker1"</span></pre><p id="5447" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我们已经创建了一个名为<code class="fe mp mq mr ms b">docker1</code>的上下文，它使用这里显示的SSH URL进行连接。这就是我们设置无密码SSH访问的原因，这样Docker就可以使用这个SSH URL。</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="fc53" class="nm lt iu ms b gz nn no l np nq">$ docker context list <br/>NAME       DESCRIPTION                               DOCKER<br/>default *  Current DOCKER_HOST based configuration   unix:///var/run/docker.sock<br/>docker1                                           ssh://ubuntu@192.168.64.21</span></pre><p id="8bcb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">该命令列出了您系统上当前可用的Docker上下文。<code class="fe mp mq mr ms b">*</code>标记指示哪个上下文当前是活动的。</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="043e" class="nm lt iu ms b gz nn no l np nq">$ docker context use docker1 <br/>docker1 <br/>Current context is now "docker1" <br/>$ docker ps <br/>CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES <br/>$ docker run -it alpine sh <br/>/ # uname -a<br/>Linux a139bc7ff4f4 5.4.0-89-generic <br/>/ #</span></pre><p id="bcbf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这表明我们在Ubuntu的Multipass中运行了Docker，并且我们可以在台式机/笔记本电脑上使用<code class="fe mp mq mr ms b">docker</code>命令来控制Docker实例。</p><p id="2989" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当<code class="fe mp mq mr ms b">docker</code>命令连接到<code class="fe mp mq mr ms b">docker1</code>上下文时，我们这样做了。为了理解这有什么不同，让我们改变我们使用的上下文。</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="c753" class="nm lt iu ms b gz nn no l np nq">$ docker context use default <br/>default <br/>Current context is now "default" <br/>$ docker ps <br/>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></pre><p id="a6b8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mp mq mr ms b">docker context use</code>命令是我们从一个上下文切换到另一个上下文的方式。<code class="fe mp mq mr ms b">default</code>上下文应该在主机上。在我的例子中，我安装了Docker Desktop，但是它目前没有运行。在这种情况下,<code class="fe mp mq mr ms b">default</code>上下文指的是Docker桌面活动时运行的Docker引擎。</p><p id="6d1d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">可以创建其他Docker上下文。例如，我在一家虚拟主机提供商那里有一个虚拟专用服务器(VPS ),我在上面安装了Docker。与Docker实例的交互如下所示:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="3f3a" class="nm lt iu ms b gz nn no l np nq">$ docker context use host001 <br/>host001 <br/>Current context is now "host001"</span></pre><p id="640c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我的名为<code class="fe mp mq mr ms b">host001</code>的上下文提供了对一个VPS的远程控制，我在这个VPS上托管了几个制作网站。这些网站是使用Docker Swarm管理的。这意味着我可以运行这个命令:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="e042" class="nm lt iu ms b gz nn no l np nq">$ docker stack ls <br/>NAME            SERVICES   ORCHESTRATOR <br/>backups         1          Swarm <br/>db              1          Swarm <br/>proxyman        2          Swarm <br/>wordpress-ltp   1          Swarm <br/>...</span></pre><p id="9168" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我可以很容易地用它在那台服务器上运行Docker命令，即使它位于数百英里之外。即使在这个距离上，响应时间也是极好的。</p><p id="faab" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您喜欢总是显式选择上下文，请运行如下命令:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="ac95" class="nm lt iu ms b gz nn no l np nq">$ docker --context CONTEXT-NAME ps</span></pre><p id="3d1b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">然后，如果您想关闭Docker服务(在Multipass中),只需运行以下命令:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="4378" class="nm lt iu ms b gz nn no l np nq">$ multipass stop docker1</span></pre><p id="2564" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">要再次启动，使用<code class="fe mp mq mr ms b">multipass start docker1</code>。</p><h1 id="21e6" class="ls lt iu bd lu lv lw lx ly lz ma mb mc ka md kb me kd mf ke mg kg mh kh mi mj bi translated">摘要</h1><p id="b570" class="pw-post-body-paragraph kv kw iu kx b ky mk jv la lb ml jy ld le mm lg lh li mn lk ll lm mo lo lp lq in bi translated">我们已经了解了一种在macOS或Windows机器上运行Docker的简单方法，无需安装Docker Desktop。正在使用的Docker命令与Docker桌面产品提供的命令一样是最新的。使用基于Multipass的Docker实例和由Docker Desktop管理的实例的命令行用户体验是相同的。</p><p id="6653" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如前所述，Multipass可用于实现多节点Docker设置，比如用Docker Swarm或Kubernetes进行实验。要查看设置Swarm集群的说明，请遵循<a class="ae lr" href="https://techsparx.com/software-development/docker/swarm/multipass.html" rel="noopener ugc nofollow" target="_blank">在您的笔记本电脑上使用Multipass和Ubuntu 20.04创建Docker Swarm】中的其余说明</a></p><p id="e2a0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">前面使用的指令导致在Multipass中安装Ubuntu 20.04。其他操作系统映像也是可用的，您可以使用以下命令列出它们:</p><pre class="kk kl km kn gu ni ms nj nk aw nl bi"><span id="b95d" class="nm lt iu ms b gz nn no l np nq">$ multipass find <br/>Image                  Aliases    Version   Description <br/>18.04                  bionic     20211021  Ubuntu 18.04 LTS <br/>20.04                  focal,lts  20211021  Ubuntu 20.04 LTS <br/>21.04                  hirsute    20211025  Ubuntu 21.04 <br/>21.10                  impish     20211014  Ubuntu 21.10 <br/>anbox-cloud-appliance             latest    Anbox Cloud Appliance <br/>minikube                          latest    minikube is local Kubernetes</span></pre><p id="182b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">请注意，Minikube是可用的。这是一个简化在你的台式机/笔记本电脑上运行Kubernetes的工具。</p><p id="82a8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><a class="ae lr" href="https://techsparx.com/about.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> <em class="nc">大卫·赫伦</em> </strong> </a> <em class="nc">:大卫·赫伦是一名作家和软件工程师，专注于技术的明智使用。他对太阳能、风能和电动汽车等清洁能源技术特别感兴趣。David在硅谷从事了近30年的软件工作，从电子邮件系统到视频流，再到Java编程语言，他已经出版了几本关于Node.js编程和电动汽车的书籍。</em></p></div><div class="ab cl ns nt hy nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="in io ip iq ir"><p id="6356" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="nc">原载于</em><a class="ae lr" href="https://techsparx.com/software-development/docker/docker-desktop/multipass.html" rel="noopener ugc nofollow" target="_blank"><em class="nc">https://techsparx.com</em></a><em class="nc">。</em></p></div></div>    
</body>
</html>