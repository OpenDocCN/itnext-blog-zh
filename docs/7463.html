<html>
<head>
<title>Creating go CLI applications using Cobra</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cobra创建go CLI应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/creating-go-cli-applications-using-cobra-95aa33d64e71?source=collection_archive---------2-----------------------#2022-10-02">https://itnext.io/creating-go-cli-applications-using-cobra-95aa33d64e71?source=collection_archive---------2-----------------------#2022-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5971" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">obra是一个用于创建强大的现代CLI应用程序的库。它正被用于许多流行的开源项目。在本文中，我将探索如何使用Cobra构建一个简单的todo CLI应用程序。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/4cf282864ad86e6b7190b78be4b912d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3bIOztwhrtAc_EJY"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/es/@nivedh_pkt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> NIvedh P </a>在<a class="ae lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="261e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在开始之前，让我们分解一下将要构建的命令。</strong></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ll"><img src="../Images/aa11489b020dc2f847e9e98cdb25b839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1vMUvP0HMLz39l3GEMSWw.png"/></div></div></figure><ul class=""><li id="61e2" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated"><strong class="jp ir"> todo </strong>:这是CLI应用程序名称</li><li id="de8e" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">添加:</strong>todo应用程序子命令下的子命令是嵌套的，这意味着每个命令可以有零到多个子命令</li><li id="6d5a" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir">我的新任务</strong>:这是命令行参数，每个子命令可以有零个参数</li><li id="0f7b" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><strong class="jp ir"> —描述</strong>:这是一个命令行标志，标志有两种类型。持久标志:意味着这个标志将对它所分配到的命令以及该命令下的每个命令可用。另一种类型是本地标志，它只适用于特定的命令。</li></ul><p id="9802" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装:</strong></p><p id="1e19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要安装cobra-cli二进制文件</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="0341" class="mf mg iq mb b gy mh mi l mj mk">go install github.com/spf13/cobra-cli@latest</span></pre><p id="6dbf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Go会自动将它安装到您的<code class="fe ml mm mn mb b">$GOPATH/bin</code>目录中，这个目录应该在您的PATH中。</p><p id="9a78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">构建您的应用程序框架</strong></p><ol class=""><li id="31ef" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk mo ls lt lu bi translated">创建一个新目录“todo”</li><li id="e2de" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk mo ls lt lu bi translated"><code class="fe ml mm mn mb b">cd</code>进入目录</li><li id="e2dd" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk mo ls lt lu bi translated">跑<code class="fe ml mm mn mb b">go mod init github/afarid/todo</code></li></ol><p id="2571" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="271b" class="mf mg iq mb b gy mh mi l mj mk">mkdir todo<br/>cd todo<br/>go mod init github.com/afarid/todo</span></pre><p id="a6d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4-生成基本骨架</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="1792" class="mf mg iq mb b gy mh mi l mj mk">cobra-cli init --viper<br/>cobra-cli add add ## command to add a new todo to todo list<br/>cobra-cli add remove ## command to remove a todo from todo list<br/>cobra-cli add update ## command to update description of a todo<br/>cobra-cli add list ## command to list all todos. optionally, with deadline </span></pre><ul class=""><li id="cc80" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated"><code class="fe ml mm mn mb b">cobra-cli init --viper</code>:创建一个基本的目录结构，并使用viper进行配置管理，稍后，我将解释如何使用viper和cobra</li><li id="6f65" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated"><code class="fe ml mm mn mb b">cobra-cli add &lt;command&gt;</code>:这些都是TODO应用程序下的子命令。</li></ul><p id="1ea5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成这一步后，您的目录结构应该是这样的。</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="ab88" class="mf mg iq mb b gy mh mi l mj mk">todo<br/>|-- LICENSE<br/>|-- cmd<br/>|   |-- add.go<br/>|   |-- list.go<br/>|   |-- remove.go<br/>|   |-- root.go<br/>|   `-- update.go<br/>|-- go.mod<br/>|-- go.sum<br/>`-- main.go</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="38e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">编写第一条命令“添加”:</strong></p><p id="1877" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1-打开<code class="fe ml mm mn mb b">cmd/root.go</code>文件并添加以下代码</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="00e3" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">第1–9行:我们定义了配置文件的结构。</li><li id="b57e" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated">Lind 14–17:将<code class="fe ml mm mn mb b">.todo.yaml</code>的内容赋给变量<code class="fe ml mm mn mb b">todos</code></li></ul><p id="4624" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2-打开<code class="fe ml mm mn mb b">cmd/add.go</code>并添加以下代码行</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="c512" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">第5行:提取todo名称的值作为命令行参数</li><li id="c182" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated">第6:7行提取截止日期和描述的值作为标志</li><li id="37c2" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated">第8行:15将当前待办事项添加到待办事项列表中</li><li id="e400" class="lm ln iq jp b jq lv ju lw jy lx kc ly kg lz kk lr ls lt lu bi translated">第16行，将todos列表写入配置文件，默认为<code class="fe ml mm mn mb b">$HOME/.toddo.yaml</code>，这可以在<code class="fe ml mm mn mb b">root.go</code>文件中覆盖</li></ul><p id="ebb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们尝试执行第一个添加的命令</strong></p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="2ce9" class="mf mg iq mb b gy mh mi l mj mk">touch $HOME/.todos.yaml ## This is for 1st run only<br/>go run main.go add my1stTask --description "Tide my room" --deadline "30-10-2022"<br/>go run main.go add my2ndTask --description "Read xyz book" --deadline "31-10-2022"</span></pre><p id="038a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">执行该命令后,<code class="fe ml mm mn mb b">$HOME/.todos.yaml</code>的内容应该是这样的</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="3976" class="mf mg iq mb b gy mh mi l mj mk">todos:<br/>    - name: my1stTask<br/>      description: Tide my room<br/>      deadline: 30-10-2022<br/>    - name: my2ndTask<br/>      description: Read xyz book<br/>      deadline: 31-10-2022</span></pre></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="c56b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">执行第二个命令“列表”</strong></p><p id="4ec3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1-打开<code class="fe ml mm mn mb b">cmd/list.go</code>，添加下面的代码片段</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mw mx l"/></div></figure><ul class=""><li id="ee94" class="lm ln iq jp b jq jr ju jv jy lo kc lp kg lq kk lr ls lt lu bi translated">第4:9行，只是打印包含待办事项列表的<code class="fe ml mm mn mb b">todos.Todos</code>的内容。</li></ul><p id="e6a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们尝试执行第二个命令</strong></p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="f116" class="mf mg iq mb b gy mh mi l mj mk">go run main.go list</span></pre><p id="8cde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出应该是这样的</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="aabc" class="mf mg iq mb b gy mh mi l mj mk">[<br/>  {<br/>    "Name": "my1stTask",<br/>    "Description": "Tide my room",<br/>    "Deadline": "30-10-2022"<br/>  },<br/>  {<br/>    "Name": "my2ndTask",<br/>    "Description": "Read xyz book",<br/>    "Deadline": "31-10-2022"<br/>  }<br/>]</span></pre><p id="f842" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">执行第三个命令“移除”</strong></p><p id="264c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1-打开<code class="fe ml mm mn mb b">cmd/remove.go</code>，添加以下代码片段</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7634" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第5行:提取todo名称作为参数。</p><p id="be81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Line: 6:12:迭代todos并删除匹配<code class="fe ml mm mn mb b">todoName</code>的那个</p><p id="333c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第13行，将待办事项列表写入配置文件</p><p id="b2ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">现在尝试删除一个之前添加的待办事项。</strong></p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="6e69" class="mf mg iq mb b gy mh mi l mj mk">go run main.go remove my2ndTask</span></pre><p id="59ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打印现有待办事项</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="395c" class="mf mg iq mb b gy mh mi l mj mk">go run main.go list            <br/>[<br/>  {<br/>    "Name": "my1stTask",<br/>    "Description": "Tide my room",<br/>    "Deadline": "30-10-2022"<br/>  }<br/>]</span></pre><p id="db5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会注意到<code class="fe ml mm mn mb b">my2ndTaks</code>被移除了。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="ddd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新现有任务的描述和截止日期</strong></p><p id="7790" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这与前面的命令不同，因为我们需要检查标志是否被传递。我们可以通过使用<code class="fe ml mm mn mb b">Changed()</code>来实现这一点</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="b982" class="mf mg iq mb b gy mh mi l mj mk">if cmd.Flags().Lookup("description").Changed {<br/>   description, _ := cmd.Flags().GetString("description")<br/>   todos.Todos[index].Description = description<br/>}</span></pre><p id="68a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们有条件地更新描述，如果只有<code class="fe ml mm mn mb b">--description</code>通过，与<code class="fe ml mm mn mb b">deadline</code>相同</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="ef51" class="mf mg iq mb b gy mh mi l mj mk">if cmd.Flags().Lookup("deadline").Changed {<br/>   deadline, _ := cmd.Flags().GetString("deadline")<br/>   todos.Todos[index].Deadline = deadline<br/><br/>}</span></pre><p id="6a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新函数的最终代码片段应该是这样的</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="d217" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在尝试更新已添加的待办事项的描述</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="b148" class="mf mg iq mb b gy mh mi l mj mk">go run main.go update my1stTask --description "This is an updated description"</span></pre><p id="439e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后列出所有任务</p><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="70c6" class="mf mg iq mb b gy mh mi l mj mk">go run main.go list<br/>[<br/>  {<br/>    "Name": "my1stTask",<br/>    "Description": "This is an updated description",<br/>    "Deadline": "30-10-2022"<br/>  }<br/>]</span></pre><p id="558c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您会发现描述是唯一更新的字段，因为我们没有通过<code class="fe ml mm mn mb b">--deadline</code>标志</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><p id="2b03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们到达了这篇文章的结尾，希望它是有用的，你可以在这里找到这篇文章中的代码GitHub repo<a class="ae lk" href="https://github.com/afarid/simple-todo-cobra" rel="noopener ugc nofollow" target="_blank">https://github.com/afarid/simple-todo-cobra</a></p></div></div>    
</body>
</html>