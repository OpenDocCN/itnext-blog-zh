<html>
<head>
<title>Observations and thoughts after building 3 kubernetes platforms in Financial Services Industry — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金融服务业三大kubernetes平台建设后的观察与思考(一)</h1>
<blockquote>原文：<a href="https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-6705511c8e9b?source=collection_archive---------0-----------------------#2022-08-15">https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-6705511c8e9b?source=collection_archive---------0-----------------------#2022-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="22dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上周，我在加拿大完成了另一项金融服务/银行业的咨询任务。这结束了我的第三平台构建，以Kubernetes为基础。这些平台可以概括为:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d9362f2daa39e82e3cb52ef469ceb3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1IKeZYjDVD3aq9l2ISN7g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">平台摘要</figcaption></figure><p id="73b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">整个周末，我都在反思这些平台，并开始思考这个领域在过去3年多的时间里发生了多少变化。我还反思了我看到和使用的工具(好的/坏的/难看的)以及在这些平台构建过程中做出的决策。</p><p id="ccbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着我在平台构建之间的进展，我努力确保过去的错误不会重演。我还专注于扩展在之前的迭代中没有做的事情，以扩展我在这个领域的技能(考虑到我在开始第一次构建时在Kubernetes中没有任何经验)</p><p id="ed11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个博客系列中，我将分享我对各个领域的观察和思考。我的观察将通过高度监管的行业和大型组织(加拿大五大)的经验来进行。</p><p id="f262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第1部分(本条目)</p><ul class=""><li id="b8c9" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">Kubernetes PaaS平台</li><li id="fa13" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">网络管理</li><li id="6ae0" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">入口控制器</li></ul><p id="065d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二部分</p><ul class=""><li id="be12" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">工作负载身份</li><li id="d83b" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">秘密管理、静态加密和外部化</li></ul><p id="8c2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三部分</p><ul class=""><li id="d6d2" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">GitOps工具</li><li id="8860" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">云资源管理/资源代理</li></ul><h1 id="e5d2" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Kubernetes平台</h1><p id="7fcd" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">云服务提供商(CSP)将Kubernetes打包到PaaS产品中，并将其集成到他们的生态系统中。在与AKS和GKE合作后，我发现这两家供应商都跟上了上游的步伐，而且AKS发布新版本的速度更快一些。</p><p id="1ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">CSP提供身份和RBAC(云身份，AAD)、网络(网络策略、CNI、伪装、出口管理)、入口(L7负载平衡)和其他插件等集成。</p><p id="b8d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">AKS倾向于从开源产品开始，一直保持这种状态，直到最终决定集成为附加产品(AAD Pod身份和应用程序网关入口控制器)，而GKE则提前采取了集成方法。我更喜欢后一种方法，因为它感觉更好并且提供了支持。</p><h1 id="74e6" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">网络管理</h1><p id="6f5e" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">Kubernetes改变了处理工作负载的模式。在Kubernetes之前，工作负载保持相当静态的地址，L4防火墙是控制流量的方法。在Kubernetes中，工作负载现在是短暂的和可移植的，因此使得L4控制近乎过时。</p><blockquote class="ms mt mu"><p id="6a9e" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">然而，组织还没有完全接受在L4放弃控制权以获得更高级别的控制权。</p></blockquote><p id="bbcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes中，当流量在集群中时，网络策略通过使用标签来控制流量源/目标，从而帮助控制L4的流量。管理进出集群的流量必须借助L4防火墙，如果你喜欢冒险，还可以借助服务网格。</p><p id="d2eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为工作负载的每个实例生成IP地址需要比常规虚拟机工作负载更大的IP空间。</p><blockquote class="ms mt mu"><p id="949b" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">许多组织努力寻找足够的地址空间来满足pod寻址需求。</p></blockquote><p id="c7e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">IP伪装(将pod范围隐藏在节点IP后面)和对pod使用RFC6598范围有助于缓解这一挑战。这种方法在GKE特别有效。</p><h1 id="6dc7" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">入口控制器</h1><p id="64e6" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">许多Kubernetes工作负载都暴露在TLS/HTTPS上。向客户端公开它们需要结合使用L7负载平衡器和入口控制器(最常见的模式)。</p><p id="b711" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">入口控制器是监控入口配置并将该配置转换为L7服务配置的运营商，如nginx、HTTPS负载平衡器(GCP)、应用网关(Azure)等。也就是说，并非所有入口控制器都是相同的。</p><p id="aee9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nginx是最受欢迎的L7负载平衡器之一，它的使用已经很成熟了。然而，要利用高级功能，你必须付费订阅nginx+(我没有用过)。</p><p id="5ae2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在PaaS Kubernetes中执行L7负载平衡时，通常使用云提供商集成。例如，AKS拥有<em class="mv">应用网关入口控制器(AGIC) </em>，它控制着来自Kubernetes的Azure应用网关(AppGw)。就我个人而言，我发现这种解决方案非常有限，性能也很差(入口配置可能需要60秒才能在AppGw中反映出来)。更新&amp;修复AGIC有一个漫长的发布周期&amp;缓慢推出。此外，针对项目记录的问题数量正在增加。TLDR:我不推荐AGIC，这很遗憾，因为现在你失去了利用AppGW的网络应用防火墙和其他安全功能的能力。</p><p id="c9eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我最近使用了Istio入口控制器。Istio引入了额外的资源，如<em class="mv">虚拟服务</em>和<em class="mv">目的规则</em>，这些资源现在扩展了ingress的功能，远远超出了基本ingress控制器的功能。我不会在这里深入研究服务网格能力…但是这为一个巨大的特性集打开了大门。总的来说，我对入口控制器非常满意。</p><p id="20f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了结束这个主题，我们必须讨论TLS证书的使用。对入口控制器使用通配符证书是相当常见的。</p><blockquote class="ms mt mu"><p id="d817" class="jn jo mv jp b jq jr js jt ju jv jw jx mw jz ka kb mx kd ke kf my kh ki kj kk ij bi translated">组织不赞成使用通配符证书；但是也没有简单的解决方案来避免它们的使用</p></blockquote><p id="9aec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，这些组织也还没有准备好/能够在每个工作量的基础上即时颁发证书。当您的工作负载短暂且可移植时，这是一个要求。</p><p id="e3aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">证书生成仍然是一个复杂的手动过程，并且由服务请求和批准来处理。虽然像cert-manager(开源kubernetes工具)和GCP上的Certificate Authority Service这样的工具简化了这项任务，但是管理证书颁发机构和证书生成的团队还没有朝着自动化的方向前进。</p><p id="c35f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主要观察结果:</p><ul class=""><li id="ad01" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">并非所有入口控制器都是相同的</li><li id="5115" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">NGINX是一个被移植到kubernetes的成熟的国王</li><li id="6878" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">Istio入口控制器是一把瑞士刀，功能齐全</li><li id="ef51" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">自动化是关键—对于组织来说，证书集成仍然很困难。利用工具，如证书管理器和认证机构服务是必须的。</li></ul></div></div>    
</body>
</html>