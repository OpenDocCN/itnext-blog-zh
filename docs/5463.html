<html>
<head>
<title>Developers: Stop This Date Mistake!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发商:停止这个日期错误！</h1>
<blockquote>原文：<a href="https://itnext.io/developers-stop-this-date-mistake-e3a30e8c63d1?source=collection_archive---------6-----------------------#2021-03-11">https://itnext.io/developers-stop-this-date-mistake-e3a30e8c63d1?source=collection_archive---------6-----------------------#2021-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90da" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这个著名的数据结构错误让开发人员的生活如同地狱。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/51596defa486750b87f2038417e2addf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DVyjMZZiw0aKSsqt"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@krakenimages?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> krakenimages </a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="87f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们来看看一个著名的数据库结构错误，以及如何避免它。这些错误会使应用程序的维护和进一步开发变得异常困难。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="09e4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">日期和时间</h1><p id="4b9b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">这是开发者最大的挫折。错误构造的时间相关数据会使数据排序、数据转换以及根据用户时区显示正确时间变得困难。让我们一劳永逸地停止这一切。</p><h2 id="37f6" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">日期和时间:问题</h2><p id="06cc" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们来看看下面的数据库表<code class="fe nl nm nn no b">users</code>您发现下面的数据有什么问题吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/4838daaee6ea7e64d2c518bf0d0dd9e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gcjvbLlAGj8TdO9jnCGj-g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">“用户”数据库表示例</figcaption></figure><p id="2790" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">正如你可能猜到的，日期和时间有问题。让我们再深入一点，看看为<code class="fe nl nm nn no b">users</code>定义的表结构。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/7ae7e5a8b3bffe178ea2eda57cf093ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u6lCnCORzQZa2DSJF24Kyw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">“用户”表的表结构</figcaption></figure><p id="46b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有一个列<code class="fe nl nm nn no b">id</code>被定义为主键，自动递增。目前为止一切顺利。一个用户名，定义为<code class="fe nl nm nn no b">varchar(250)</code>，虽然这个<code class="fe nl nm nn no b">varchar</code>的大小对于用户名来说可能太大了，但是<code class="fe nl nm nn no b">varchar</code>仍然是一个合理的选择。然后我们发现存储为<code class="fe nl nm nn no b">text</code>的<code class="fe nl nm nn no b">registration_date</code>列。</p><p id="a426" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于多种原因，这应该会立即敲响警钟。为了存储小字符串，我们应该使用<code class="fe nl nm nn no b">varchar</code>数据结构，它是为更小的文本片段优化的。我们将在下一个主题中更详细地了解这一点。</p><p id="83ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但这还不是全部，假设您是一名开发人员，您希望在网页上显示日期。好，我们可以简单地显示数据库中的原始数据，对吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/6dc7dd29dbd4c261d4bd9394c6ed2063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpAM5FUAA-Wr2mUn1U6QRg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">使用原始文本日期的社交媒体网站示例</figcaption></figure><p id="fb99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">那看起来不太好，是吗？设计团队给了我们下面的设计模型作为要求。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/653da32cd7ce0e49c8eae9424f5514e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTuX0wdQ3OhknEhHWOz0Vg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">幻想UX团队提供的设计模型</figcaption></figure><p id="90a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">基本上，他们不希望我们显示日期，而是显示自消息发出以来已经过去的时间。这意味着我们需要准确理解日期值在我们的前端代码中的含义。让我们继续JavaScript的一些例子。</p><p id="67af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在必须将<code class="fe nl nm nn no b">text</code>日期转换成JavaScript能够理解的<code class="fe nl nm nn no b">Date</code>对象日期。从这个日期开始，我们可以计算从现在到指定时间的差值。让我们使用一个著名的数据库来使我们的生活变得更容易，这个数据库叫做<a class="ae ky" href="https://momentjs.com" rel="noopener ugc nofollow" target="_blank"> MomentJS </a>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9447" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">moment库对于将文本日期转换成真实的javascript对象日期非常有用。然而，你可能已经注意到了，我们的06/01/2021应该是<code class="fe nl nm nn no b">6 January</code>，而不是<code class="fe nl nm nn no b">1 June</code>。那是因为moment认为我们给了它一个<code class="fe nl nm nn no b">month/day/year</code>日期格式，而不是<code class="fe nl nm nn no b">day/month/year</code>格式。</p><p id="cac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没问题！我们可以解决这个问题。让我们使用矩的魔力来解析正确格式的字符串。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="edf3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们拿到了。这确实是两个月前的事了，因为这是一条旧消息。然而，时区现在似乎是错误的。Moment似乎没有获取该时区的格式。Moment确实有一个方法<code class="fe nl nm nn no b">.utcOffset()</code>来处理它，但是它的使用需要更多的手工操作，这是我们首先要避免的！</p><p id="0bb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总之，我们看到，由于保存日期和时间使用了错误的数据结构，要正确显示日期需要花费相当大的努力。</p><h2 id="7689" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">日期和时间:解决方案</h2><p id="d05d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">让我们想办法解决这个问题吧！它可以像定义一个好的数据结构一样简单。不使用字符串日期，为什么不使用Unix时间戳？这是自1970年1月1日午夜(UTC)以来以秒为单位的时间。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="1f2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过一个简单的命令，我们可以获得当前的时间戳。那把它转换回日期呢？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="6056" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这就是我们的JavaScript日期对象！我们甚至不需要任何第三方库，真的很简单。</p><h2 id="2cca" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">日期和时间:日期时间和时间戳</h2><p id="4634" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">一些数据库引擎提供的<code class="fe nl nm nn no b">datetime</code>数据类型呢？它们也工作得很好。然而，时间戳以一种通用的方式工作，并且通常在数据库上更加轻便。在数据库领域，整数是一种非常有效的数据类型。</p><p id="cf1b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">时间戳和日期时间的一个重要区别是<code class="fe nl nm nn no b">datetime</code>也会存储日期的时区。另一方面，时间戳将只存储从epoch开始的秒数，以UTC表示。您将无法计算出保存日期的时间戳。根据您的应用程序，您可以选择DateTime或timestamp。这些都是非常可靠的选择。另一种方法是单独存储时区，如果这样更符合您的要求的话。</p><h2 id="6cda" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">日期和时间:摘要</h2><p id="7e43" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">虽然开发人员可能很难使用文本格式，但还有其他原因不选择文本日期:</p><ul class=""><li id="91be" class="nt nu it lb b lc ld lf lg li nv lm nw lq nx lu ny nz oa ob bi translated">与整数时间戳相比，文本日期需要更多的数据库存储空间</li><li id="b6cb" class="nt nu it lb b lc oc lf od li oe lm of lq og lu ny nz oa ob bi translated">通过文本日期对数据进行排序可能非常棘手和繁重。另一方面，按整数时间戳排序对于数据库来说非常容易</li></ul><p id="a1e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日期时间和时间戳都是有效的选项，而时间戳更简单，日期时间提供了更多的功能，例如存储日期的时区。</p><h2 id="b8fe" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">如果太迟了呢？</h2><p id="a063" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">如果您的应用程序已经使用了错误的数据类型，该怎么办？常见的迁移策略是复制数据列。如果您之前有一个<code class="fe nl nm nn no b">date</code>列，只需添加一个新列，比如<code class="fe nl nm nn no b">timestamp</code>。创建一个脚本，将以前的数据迁移到新格式的新列中。为以前的格式创建转换器可能很麻烦，但至少您可以在将来摆脱旧的数据格式。</p><p id="f78b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">逐步将您的应用程序迁移到新列。一旦确定以前的数据列不再用于任何应用程序，就可以安全地将其删除。当第三方集成到您的API中时，一定要通知他们，或者保持向后兼容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8b00" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">关键要点</h1><p id="e49a" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">处理新数据或旧数据时要三思。考虑一下强加的数据结构将如何影响整个架构，从过滤数据、搜索数据到显示数据的能力。这不仅是关于日期，也适用于其他项目。</p><p id="217c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从长远来看，项目开始时的快速决策对其可维护性有很大的影响。如果以不需要的格式指定一个值，它会给数据库、开发团队和整个项目带来额外的压力。</p><p id="1419" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">重温您的<a class="ae ky" href="https://en.wikipedia.org/wiki/Database_normalization" rel="noopener ugc nofollow" target="_blank">数据库规范化技术</a>以避免陷入这些情况！不要在一个字段中存储多个数据，总是尽可能将字段提取到不同的列中，直到这些列可以独立为止。你的开发伙伴会感谢你的。这正是数据库规范化技术的第一范式或1NF所指示的。确保数据是原子的。</p><p id="0457" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至于日期，您可以使用时间戳或实际日期对象。两者都可以正常工作。根据您的架构和项目，您可能必须使用其中的一种。如果您的应用程序需要知道日期的时区，您将需要使用一个date对象，因为时间戳不包含这个值。</p><p id="7e85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然正确的数据结构设置很重要，但不要忘记数据库的其他方面，如索引和其他性能优化。</p><p id="55c1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保持你的数据整洁，让你的开发伙伴开心！</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e6e1" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">额外资源</h1><p id="4fa5" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Database_normalization" rel="noopener ugc nofollow" target="_blank"> 1NF、2NF和3NF:数据库规范化技术。</a></p><p id="3eb6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日期时间与时间戳:何时应该使用哪个？</p><p id="f843" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://mariadb.com/kb/en/timestamp/" rel="noopener ugc nofollow" target="_blank"> MariaDB时间戳文档</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1665" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://kevinvr.medium.com/membership" rel="noopener">订阅我的媒介</a>到<strong class="lb iu">解锁</strong> <strong class="lb iu">所有</strong> <strong class="lb iu">文章</strong>。通过使用我的链接订阅，你是支持我的工作，没有额外的费用。你会得到我永远的感激。</p></div></div>    
</body>
</html>