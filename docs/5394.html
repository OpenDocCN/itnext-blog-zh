<html>
<head>
<title>Integrate Excel into Your React Application with Microsoft Graph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Microsoft Graph将Excel集成到React应用程序中</h1>
<blockquote>原文：<a href="https://itnext.io/integrate-excel-into-your-react-application-with-microsoft-graph-94e02f71d847?source=collection_archive---------0-----------------------#2021-02-24">https://itnext.io/integrate-excel-into-your-react-application-with-microsoft-graph-94e02f71d847?source=collection_archive---------0-----------------------#2021-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="031f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从您的应用程序创建和编辑在线Excel文件</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2855ef466cd94768ad595361784e63ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBauAgMKP6YKr1NeUPv3Hw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们将使用Excel导出功能创建的示例应用程序</figcaption></figure><p id="c23a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">微软的Excel是商业软件有史以来最大的应用之一。即使在今天，在一个有“大数据”、“数据湖”和更多时髦词汇的世界里，许多公司仍然主要使用Excel进行管理和商业智能。即使像Power BI这样的工具可用，Excel在生成和处理原始数据方面仍然是一个强大的工具。正是由于这个原因，Excel导出是企业软件系统中的一个常见功能，因为它提供了一个从it到您可能想对应用程序中的数据做的任何事情的网关。</p><p id="d543" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，Excel文件的生成总是相对复杂，许多开发人员在他们的应用程序中坚持使用简单得多的csv文件。但是在这个“一切皆有可能”的时代，Excel也只是你正在使用的任何系统的另一个API。在本文中，我将向您展示如何使用Microsoft Graph API处理OneDrive / SharePoint中的Excel文件。</p><h1 id="8b8b" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">我们的示例应用程序</h1><p id="c67a" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">我们将创建的应用程序有一个产品列表，可以选择多个项目并将它们导出到一个在线Excel文件中。主要组件将是一个流畅的UI <code class="fe mo mp mq mr b"><a class="ae ms" href="https://developer.microsoft.com/en-us/fluentui#/controls/web/detailslist/basic" rel="noopener ugc nofollow" target="_blank">DetailList</a></code>，它已经内置了一个非常复杂的多选功能。标题图片的完整组件可以在GitHub 的<a class="ae ms" href="https://gist.github.com/WimJongeneel/7d213259b4164be1affc39ac4bf1fb21" rel="noopener ugc nofollow" target="_blank">这里找到。</a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">我们将使用的基本React组件</figcaption></figure><p id="56e9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe mo mp mq mr b">getAccessToken</code>属性的值来自微软身份实现。如果您从未使用Microsoft Identity设置过SSO，请务必查看相关的<a class="ae ms" href="https://docs.microsoft.com/en-us/graph/tutorials/react" rel="noopener ugc nofollow" target="_blank">文档</a>。这将为您提供一个获取访问令牌的函数，您可以使用这个组件。</p><h1 id="cffe" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">创建一个Excel文件</h1><p id="9061" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">创建导出功能的第一步是在当前用户的OneDrive文件夹中创建一个空的Excel文件。理论上，我们可以向<code class="fe mo mp mq mr b">/me/drive/root/children</code>端点发送一个POST来创建一个新文件。虽然这确实创建了一个文件，但不幸的是，对于Excel文件，它创建了一个无效的Excel文件(对于其他office文件，这确实有效)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">创建文件的HTTP请求，只要它不是。xlsx文件</figcaption></figure><p id="5015" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另一种可行的方法是将一个空的Excel文档上传到OneDrive中的一个路径，然后从那里开始工作。这方面的代码可以在下面找到，它假设您的项目拥有一个<code class="fe mo mp mq mr b">empty.xlsx</code>文件，可以用作创建新Excel文件的模板。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在OneDrive上创建Excel文件</figcaption></figure><h1 id="ddfe" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">向Excel文件添加数据</h1><p id="0980" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">现在我们已经有了一个Excel文件，我们需要开始向其中添加数据。为此，我们可以用我们的数据向工作表中的单元格区域发送一个<code class="fe mo mp mq mr b">PATCH</code>请求。为此，我们需要采取一些步骤来确保我们的JavaScript对象被Excel正确解释:</p><p id="06da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第一步是编写一个函数来计算我们的数据将占用的Excel范围。这由左上角和右下角的坐标定义，例如<code class="fe mo mp mq mr b">A1:F7</code>。左上角很简单，这将始终是<code class="fe mo mp mq mr b">A1</code>单元格。然而，右下角的坐标取决于我们数据的大小。Y分量是我们要插入的行数组的长度。对于X组件，这是单个对象的键的计数(假设我们所有的行都是相同的类型)，转换成一个字母。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">一个简单(有点幼稚)的方法来获取Excel对象数组的范围</figcaption></figure><p id="894f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在将数据发送到Excel之前，我们需要从数据中提取的第二样东西是<em class="mv">数字格式</em>。数字格式告诉Excel如何将数值解释为其内部类型系统。从技术上讲，这是一个可选的东西，但是不提供数字格式意味着，例如，整数“1”在Excel中将作为日期1/1/1900结束。显然不是我们想要的，所以我们必须确保向Excel提供一些关于我们所有值的提示。根据我的经验，你只需要两种格式:<code class="fe mo mp mq mr b">m/d/yyyy</code>表示日期，而<code class="fe mo mp mq mr b">General</code>表示其他日期。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">从对象数组生成数字格式</figcaption></figure><p id="f6bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">API期望的最后一件事是公式，但是这些都可以用于我们的预期目的。只需知道，您还可以用它来添加包含Excel公式而不仅仅是固定值的单元格。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">用数据的形状创建一个空的公式定义</figcaption></figure><p id="af64" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这三样东西，我们就可以将选定的项目发送到我们创建的Excel文档中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">将行发送到工作表中的Excel区域</figcaption></figure><h1 id="3359" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">完成它</h1><p id="04d6" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">为了完成我们的组件，我们必须填充空的<code class="fe mo mp mq mr b">toExcel</code>函数，并实现带有到生成的Excel文件的链接的消息栏。在新的<code class="fe mo mp mq mr b">toExcel</code>函数中，我们创建了一个Excel文件，然后将所有从详细列表中选择的行添加到其中。Excel文件的创建为我们提供了它在SharePoint上的URL，我们将它保存在状态中以备后用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">“导出到Excel”按钮的处理程序</figcaption></figure><p id="30f2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通知是Fluent UI中的一个<code class="fe mo mp mq mr b"><a class="ae ms" href="https://developer.microsoft.com/en-us/fluentui#/controls/web/messagebar" rel="noopener ugc nofollow" target="_blank">MessageBar</a></code>组件，位于命令栏和细节列表之间。这里我们使用创建文档时保存在状态中的URL，并允许用户访问我们刚刚创建的文件。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">当我们成功地将选择导出到Excel时，消息的JSX代码</figcaption></figure><h1 id="1904" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">结论</h1><p id="cbff" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">消息栏完成后，我们现在有了一个完整的列表组件，可以选择将选择的项目导出到Excel。当然，这只是一个可能的例子，通过使用本文中的不同函数，您可以将React应用程序中的任何数据写入Excel工作表。</p><p id="8ab4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你喜欢这篇文章，你可能也想看看我的另一篇关于在React中使用Microsoft Graph的文章:</p><div class="mw mx gp gr my mz"><a rel="noopener  ugc nofollow" target="_blank" href="/create-a-sharepoint-file-picker-in-react-with-microsoft-graph-and-fluent-ui-8653e3342942"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">使用Microsoft Graph和Fluent UI在React中创建SharePoint文件选择器</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">让您的React应用成为微软365生态系统的一部分</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">itnext.io</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn kp mz"/></div></div></a></div></div></div>    
</body>
</html>