<html>
<head>
<title>Migrating a React Native app to TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将React本机应用程序迁移到TypeScript</h1>
<blockquote>原文：<a href="https://itnext.io/migrating-a-react-native-app-to-typescript-21f3a3d5ff57?source=collection_archive---------3-----------------------#2018-03-27">https://itnext.io/migrating-a-react-native-app-to-typescript-21f3a3d5ff57?source=collection_archive---------3-----------------------#2018-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c2785f60bf1061f315d19031e4c954f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yz3hkO3ynHV2qYGARynJg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/photos/b18TRXc8UPQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Artem Sapegin </a>在<a class="ae kc" href="https://unsplash.com/search/photos/react?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="e5d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近开始写React原生app。我创建了一个新项目，写了一些不错的组件，介绍了林挺和一些库，然后用道具类型写了一些道具。但我还是觉得少了点什么。ES6本身很棒，但我真的感觉到缺乏一个全面的打字系统。所以我把我的项目迁移到TypeScript。以下是如何做到这一点:</p><p id="ffb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要的是:</p><ul class=""><li id="5ed4" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">使用Expo的现有React本机项目，使用create-react-native-app脚本创建</li><li id="f6db" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">react-本机类型脚本-转换器</li><li id="6efc" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">以打字打的文件</li><li id="0f77" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">一大堆打字</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="90fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们安装新工具:</p><p id="ab07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lw lx ly lz b">npm i --save-dev react-native-typescript-transformer typescript tslib ts-jest</code></p><p id="4fcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ts-jest只有在您打算使用jest进行测试时才是必要的。如果没有，可以跳过。</p><p id="2b8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我要用tslint替换eslint，这样现在就可以卸载了:</p><p id="865d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lw lx ly lz b">npm uninstall --save-dev babel-eslint eslint eslint-plugin-react</code></p><p id="840e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您有. eslintrc.js文件，您可以删除它，稍后我们将在tslint.json文件中配置林挺规则。</p><p id="1fe7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我将使用TypeScript来键入道具，所以我也不再需要道具类型:</p><p id="cf38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lw lx ly lz b">npm uninstall --save prop-types</code></p><p id="7bfb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我为我正在使用的所有库安装了类型:</p><p id="1d91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lw lx ly lz b">npm install --save-dev @types/jest @types/react @types/react-native @types/react-navigation @types/react-redux @types/react-test-renderer</code></p><p id="c66a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是所有这些更改后我的package.json diff的样子:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="83ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">react-native-typescript-transformer是关键元素。这是我们在构建过程中用来传输代码的。为此，我修改了我的app.json文件，配置Expo在打包时使用react-native-typescript-transformer，如下所示:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="2464" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我创建了一个包含所有编译器选项的tsconfig.json文件:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="dd83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，您可以测试打包程序。运行<code class="fe lw lx ly lz b">npm start</code>并按下<code class="fe lw lx ly lz b">R</code>清除缓存。现在，在您的移动设备上打开Expo中的应用程序。即使我们实际上还没有写任何类型，它也应该正确地构建。这可能看起来很奇怪——TypeScript应该返回一大堆错误。但这实际上是react-native-typescript-transformer做出的设计决定，以在开发期间实现代码的增量构建和快速重载，即使它没有被正确地键入。对于实际的打字检查，你应该依靠<code class="fe lw lx ly lz b">tsc</code>和<code class="fe lw lx ly lz b">tslint</code>。如果您还没有这些软件，您可以全局安装它们:</p><p id="490c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lw lx ly lz b">npm i -g typescript tslint</code></p><p id="1c69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在您的项目目录中执行<code class="fe lw lx ly lz b">tsc</code>现在将通过transpiler运行您的代码，显示您需要修复的任何错误。然而，要让林挺发挥作用，你首先需要有一些规则。您可以使用<code class="fe lw lx ly lz b">tslint --init</code>创建一个新的tslint.json文件，并根据您的喜好进行配置。这是我的最后的样子:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="dc76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了便于比较，下面是我以前的. eslintrc.js文件:</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="5d1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，从你的根目录使用<code class="fe lw lx ly lz b">tslint -p tsconfig.json</code>将检查你的代码并打印所有错误的列表。您还可以在IDE中安装TSLint，它可以在您编写新代码时使用相同的配置文件来显示编辑器中的所有错误。</p><p id="211e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">经过这一切，一切都应该设置正确。现在是困难的部分:使用<code class="fe lw lx ly lz b">tsc</code>和<code class="fe lw lx ly lz b">tslint -p tsconfig.json</code>你可以确定你需要在代码中做的所有改变，所有缺少的类型和分号，所有你需要创建的接口。这需要一段时间。但是，恐怕这部分迁移我帮不了你。但是真的，这是有趣的部分，所以享受吧，祝你好运！</p></div></div>    
</body>
</html>