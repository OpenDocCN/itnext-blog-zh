<html>
<head>
<title>Open Policy Agent (OPA): Up and Running</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开放策略代理(OPA):启动并运行</h1>
<blockquote>原文：<a href="https://itnext.io/open-policy-agent-opa-up-and-running-9220ff591fa1?source=collection_archive---------2-----------------------#2021-02-14">https://itnext.io/open-policy-agent-opa-up-and-running-9220ff591fa1?source=collection_archive---------2-----------------------#2021-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4f18" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">8分钟后你的第一个减压阀节目</h2></div><p id="48e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最新消息:<strong class="kh ir">开放政策代理(OPA)</strong>2021年2月毕业于CNCF。恭喜你，OPA！由此可见OPA的成熟。</p><p id="c481" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://blog.openpolicyagent.org/open-policy-agent-graduates-in-the-cloud-native-computing-foundation-f00145202a99" rel="noopener ugc nofollow" target="_blank">https://blog . openpolicyagent . org/open-policy-agent-graduates-in-the-cloud-native-computing-foundation-f 00145202 a 99</a></p><p id="abe7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个文档是为那些想使用<a class="ae lb" href="https://www.openpolicyagent.org/" rel="noopener ugc nofollow" target="_blank">开放策略代理(OPA) </a>一次的人准备的。这是OPA的“hello world”。</p><p id="ce7c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最快也要8分钟。</p><p id="5db7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">(这是从<a class="ae lb" href="https://github.com/onelittlenightmusic/opa-up-and-running" rel="noopener ugc nofollow" target="_blank"> github </a>、<a class="ae lb" href="https://gist.github.com/onelittlenightmusic/README-jp.md" rel="noopener ugc nofollow" target="_blank">日文版</a>克隆的文章)</p><h1 id="9a0c" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">1.你的第一个编码:试试减压阀游乐场</h1><p id="a718" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">不使用实际的OPA也能掌握OPA是什么。这是尝试OPA最快的方法。方式是<a class="ae lb" href="https://play.openpolicyagent.org/" rel="noopener ugc nofollow" target="_blank">“减压阀游乐场”</a>，承蒙<a class="ae lb" href="https://gist.github.com/onelittlenightmusic/styra.com" rel="noopener ugc nofollow" target="_blank">斯泰拉</a>的好意。</p><ul class=""><li id="075a" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">访问<a class="ae lb" href="https://play.openpolicyagent.org/" rel="noopener ugc nofollow" target="_blank">https://play.openpolicyagent.org/</a></li><li id="e23c" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">点击<code class="fe mn mo mp mq b">Evaluate</code>按钮。</li></ul><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/42b07c55b848703183d6e558c5814835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*21LO_jKSiWEYO_hv.png"/></div></div></figure><h2 id="8ff9" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">先试试你的<strong class="ak">减压阀语</strong>编码。</h2><ul class=""><li id="af62" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">将这些行添加到左窗格的最后一行。</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="c944" class="nd ld iq mq b gy nw nx l ny nz">newdata = msg {<br/>  msg := concat("", ["Received the message: ", input.message])<br/>}</span></pre><p id="dbc6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这几行意味着你要生成一个名为<code class="fe mn mo mp mq b">newdata</code>的新数据。</p><ul class=""><li id="0fe8" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">再次点击<code class="fe mn mo mp mq b">Evaluate</code>。</li><li id="9414" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">您将会看到新的结果<code class="fe mn mo mp mq b">newdata</code>被添加到<code class="fe mn mo mp mq b">OUTPUT</code>窗格中。</li></ul><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/58c8721816802b6d25f3985740c31977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TIQeUnW5bAW777XI.png"/></div></div></figure><p id="496f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果是这样的。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="73e4" class="nd ld iq mq b gy nw nx l ny nz">{<br/>  "hello": true,<br/>  "newdata": "Received the message: world"<br/>}</span></pre><p id="62b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二行<code class="fe mn mo mp mq b">"newdata": ...</code>是你的结果。除此之外，<code class="fe mn mo mp mq b">"hello"</code>是现有代码<code class="fe mn mo mp mq b">hello {...}</code>的结果</p><h2 id="81d5" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">改变<code class="fe mn mo mp mq b">input</code></h2><p id="762c" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">您会在<code class="fe mn mo mp mq b">INPUT</code>窗格中看到<code class="fe mn mo mp mq b">"message":...</code>。</p><p id="6326" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将消息内容更改为<code class="fe mn mo mp mq b">"message": "distopia"</code></p><p id="b558" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次点击<code class="fe mn mo mp mq b">Evaluate</code>。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/37cb607c270e4c3a44172634ca1d7059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fjO85y67lxuOyrfR.png"/></div></div></figure><p id="618f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你会得到这样的新结果。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="a053" class="nd ld iq mq b gy nw nx l ny nz">{<br/>    "hello": false,<br/>    "newdata": "Received the message: distopia"<br/>}<!-- --> </span></pre><p id="ea86" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看<code class="fe mn mo mp mq b">hello</code>结果。结果从<code class="fe mn mo mp mq b">true</code>变为<code class="fe mn mo mp mq b">false</code>。原因如下。</p><ul class=""><li id="1e5b" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated"><code class="fe mn mo mp mq b">hello</code>表示<code class="fe mn mo mp mq b">m == "world"</code>。这意味着如果<code class="fe mn mo mp mq b">message</code>是<code class="fe mn mo mp mq b">"world"</code>，它返回<code class="fe mn mo mp mq b">true</code>。否则返回<code class="fe mn mo mp mq b">false</code>。</li></ul><h2 id="0aa2" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">改变<code class="fe mn mo mp mq b">data</code></h2><p id="4819" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">将这些线插入<code class="fe mn mo mp mq b">data</code>面板。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="df5b" class="nd ld iq mq b gy nw nx l ny nz">{<br/>  "rule": "be good"<br/>}</span></pre><ul class=""><li id="07d1" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">在左窗格的最后添加行。</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="4637" class="nd ld iq mq b gy nw nx l ny nz">importdata = msg {<br/>  msg := concat("", ["Received the static data: ", data.rule])<br/>}</span></pre><ul class=""><li id="2bc6" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">再次点击<code class="fe mn mo mp mq b">Evaluate</code></li></ul><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oa"><img src="../Images/65a5a39d1252fe0075d94c1e40f175dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*orJNc4bJ3sW6k_vf.png"/></div></div></figure><ul class=""><li id="5637" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">结果显示了下面的新行。</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="a69c" class="nd ld iq mq b gy nw nx l ny nz">"importdata": "Received the static data: be good",</span></pre><h2 id="82f3" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">OPA的作用(3分钟)</h2><p id="6892" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">你看OPA在减压阀游乐场做了什么。</p><ol class=""><li id="bb3a" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la ob mf mg mh bi translated"><strong class="kh ir"> OPA了解一些政策文件</strong>。<br/>该策略文件就像<code class="fe mn mo mp mq b">newdata = msg {...}</code>一样用减压阀语言编写。(操场左侧窗格)</li><li id="b198" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la ob mf mg mh bi translated"><strong class="kh ir"> OPA接收</strong> <code class="fe mn mo mp mq b"><strong class="kh ir">input</strong></code>。<br/><code class="fe mn mo mp mq b">input</code>必须是JSON格式。(操场右上窗格)</li><li id="5dc6" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la ob mf mg mh bi translated"><strong class="kh ir"> OPA接收</strong> <code class="fe mn mo mp mq b"><strong class="kh ir">data</strong></code> <strong class="kh ir">太</strong>。<br/><code class="fe mn mo mp mq b">data</code>也必须是JSON格式。(操场的右中窗格。上例中的<code class="fe mn mo mp mq b">data</code>是一个空的JSON对象<code class="fe mn mo mp mq b">{}</code></li><li id="c06f" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la ob mf mg mh bi translated"><strong class="kh ir"> OPA做运算生成</strong> <code class="fe mn mo mp mq b"><strong class="kh ir">output</strong></code> <strong class="kh ir">。</strong><br/><code class="fe mn mo mp mq b">output</code>也是JSON格式。(操场右下角的窗格)</li></ol><p id="a8f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">概要</strong> : OPA读取减压阀文件和2个JSON对象。然后OPA生成JSON输出。</p><p id="a355" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">详细内容见官方<code class="fe mn mo mp mq b">introduction</code>文件<a class="ae lb" href="https://www.openpolicyagent.org/docs/latest/" rel="noopener ugc nofollow" target="_blank">https://www.openpolicyagent.org/docs/latest/</a>。</p><h1 id="b41a" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">2.在您的环境中运行OPA</h1><h2 id="b704" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">2.1.安装OPA(大约5分钟)</h2><ul class=""><li id="5b97" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">对于MacOS，只需运行这个命令。</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="71a0" class="nd ld iq mq b gy nw nx l ny nz">brew install opa</span></pre><ul class=""><li id="f999" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">对于其他环境，按照下面的文档安装<code class="fe mn mo mp mq b">opa</code>命令。</li></ul><div class="oc od gp gr oe of"><a href="https://www.openpolicyagent.org/docs/latest/#running-opa" rel="noopener  ugc nofollow" target="_blank"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">介绍</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">开放策略代理(OPA，发音为“oh-pa”)是一个开源的通用策略引擎，它统一了策略…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">www.openpolicyagent.org</p></div></div><div class="oo l"><div class="op l oq or os oo ot nb of"/></div></div></a></div><h2 id="5d88" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">2.2.检查OPA运行(5分钟)</h2><p id="f1f6" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">运行<code class="fe mn mo mp mq b">opa run</code>测试运算放大器</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="cdd9" class="nd ld iq mq b gy nw nx l ny nz"># add ./data.json to command arguments opa run -s ./example.rego ./data.json</span></pre><p id="b966" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，您可以执行类似<code class="fe mn mo mp mq b">a = 3</code>或<code class="fe mn mo mp mq b">exit</code>的命令来退出。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="0fc7" class="nd ld iq mq b gy nw nx l ny nz">$ opa run<br/>OPA 0.26.0 (commit , built at )<br/><br/>Run 'help' to see a list of commands and check for updates.<br/><br/>&gt; a = 3<br/>Rule 'a' defined in package repl. Type 'show' to see rules.<br/>&gt; x = 3<br/>Rule 'x' defined in package repl. Type 'show' to see rules.<br/>&gt; show<br/>package repl<br/><br/>a = 3<br/><br/>x = 3<br/>&gt; exit</span></pre><h2 id="1473" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">2.3.将OPA作为服务器运行(5分钟)</h2><ul class=""><li id="4c2f" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">创建文件<code class="fe mn mo mp mq b">example.rego</code></li></ul><p id="90db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将以下文件另存为<code class="fe mn mo mp mq b">example.rego</code>。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="fbb2" class="nd ld iq mq b gy nw nx l ny nz">package play<br/><br/>default hello = false<br/><br/>hello {<br/>    m := input.message<br/>    m == "world"<br/>}<br/><br/>newdata = msg {<br/>    msg := concat("", ["Received the message: ", input.message])<br/>}<br/><br/>importdata = msg {<br/>    msg := concat("", ["Received the static data: ", data.rule])<br/>}</span></pre><ul class=""><li id="4d9d" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">创建文件<code class="fe mn mo mp mq b">input.json</code></li></ul><p id="9d12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将以下文件另存为<code class="fe mn mo mp mq b">input.json</code>。</p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="8e2e" class="nd ld iq mq b gy nw nx l ny nz">{<br/>  "input": {<br/>    "message": "world"<br/>  }<br/>}</span></pre><p id="9544" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的例子和第一节完全一样。</p><ul class=""><li id="d288" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">运行此命令来运行服务器</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="b157" class="nd ld iq mq b gy nw nx l ny nz">opa run -s ./example.rego</span></pre><ul class=""><li id="fd94" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">从另一个命令提示符向OPA服务器发送请求</li></ul><ol class=""><li id="4ade" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la ob mf mg mh bi translated"><code class="fe mn mo mp mq b">/v1/data/play</code></li></ol><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="a7af" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play -i -d @input.json -H 'Content-Type: application/json'<br/><br/>{"result":{"hello":true,"newdata":"Received the message: world"}}</span></pre><p id="d6e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.<code class="fe mn mo mp mq b">/v1/data/play/hello</code></p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="acef" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play/hello -i -d @input.json -H 'Content-Type: application/json'<br/><br/>{"result":true}</span></pre><p id="c96b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与第1节中“hello”的值相同。</p><p id="579c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.<code class="fe mn mo mp mq b">/v1/data/play/newdata</code></p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="fa4a" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play/newdata -i -d @input.json -H 'Content-Type: application/json'<br/><br/>{"result":"Received the message: world"}</span></pre><p id="117b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与第1节中“newdata”的值相同。</p><p id="8832" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.<code class="fe mn mo mp mq b">/v1/data/play/importdata</code></p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="2616" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play/importdata -i -d @input.json -H 'Content-Type: application/json'<br/><br/>{}</span></pre><p id="7fac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是未定义的，因为没有导入数据。</p><h2 id="5535" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">2.4.运行OPA服务器并加载数据(5分钟)</h2><ul class=""><li id="2573" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">创建<code class="fe mn mo mp mq b">data.json</code></li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="2e43" class="nd ld iq mq b gy nw nx l ny nz">{<br/>  "rule": "be good"<br/>}</span></pre><ul class=""><li id="94fe" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la me mf mg mh bi translated">运行此命令来运行服务器。</li></ul><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="c4df" class="nd ld iq mq b gy nw nx l ny nz"># add ./data.json to command arguments<br/>opa run -s ./example.rego ./data.json</span></pre><p id="baf1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从另一个命令提示符向OPA服务器发送请求。</p><ol class=""><li id="8269" class="lz ma iq kh b ki kj kl km ko mb ks mc kw md la ob mf mg mh bi translated"><code class="fe mn mo mp mq b">/v1/data/play</code></li></ol><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="96e2" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play -i -d @input.json -H 'Content-Type: application/json'<br/><br/><strong class="mq ir">{"result":{"hello":true,"importdata":"Received the static data: be good","newdata":"Received the message: world"}}</strong></span></pre><p id="aa39" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加了“导入数据”字段。</p><p id="26eb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.<code class="fe mn mo mp mq b">/v1/data/play/importdata</code></p><pre class="ms mt mu mv gt ns mq nt nu aw nv bi"><span id="711e" class="nd ld iq mq b gy nw nx l ny nz">$ curl localhost:8181/v1/data/play/importdata -i -d @input.json -H 'Content-Type: application/json'<br/><br/><strong class="mq ir">{"result":"Received the static data: be good"}</strong><br/># Data was added. Same as the value of "importdata" in section 1.1</span></pre><p id="8616" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据已添加。与第1节中“importdata”的值相同。</p><h2 id="f8ff" class="nd ld iq bd le ne nf dn li ng nh dp lm ko ni nj lo ks nk nl lq kw nm nn ls no bi translated">2.5.OPA服务器的功能(3分钟)</h2><ul class=""><li id="407c" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">OPA服务器运行在您的环境中，等待HTTP请求<br/> HTTP请求应该有JSON主体。<br/> -身体应该是<code class="fe mn mo mp mq b">{"input": ***}</code>的形式。</li><li id="d375" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">OPA服务器有端点<br/> <code class="fe mn mo mp mq b">&lt;server&gt;/v1/api/data/&lt;package name&gt;[/&lt;object name&gt;]</code>。<br/>-rego文件<code class="fe mn mo mp mq b">package play</code>第一行声明<code class="fe mn mo mp mq b">&lt;package name&gt;</code>为<code class="fe mn mo mp mq b">play</code>。<br/>-rego文件中的一个对象声明<code class="fe mn mo mp mq b">hello {...}</code>表示<code class="fe mn mo mp mq b">&lt;object name&gt;</code>是<code class="fe mn mo mp mq b">hello</code>。</li><li id="fb47" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">OPA的返回值是JSON形式的<code class="fe mn mo mp mq b">{"result": ***}</code>。<br/>返回值因请求的端点而异。<br/> -如果<code class="fe mn mo mp mq b">&lt;package name&gt;</code>被请求，响应包括<code class="fe mn mo mp mq b">"result"</code>字段中的所有对象。<br/> -如果<code class="fe mn mo mp mq b">&lt;package name&gt;/&lt;object name&gt;</code>被请求，响应在<code class="fe mn mo mp mq b">"result"</code>字段中包含一个对象输出。</li></ul><h1 id="3042" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">3.参考</h1><ul class=""><li id="30af" class="lz ma iq kh b ki lu kl lv ko np ks nq kw nr la me mf mg mh bi translated">https://play.openpolicyagent.org/减压阀游乐场:<a class="ae lb" href="https://play.openpolicyagent.org/" rel="noopener ugc nofollow" target="_blank"/></li><li id="063c" class="lz ma iq kh b ki mi kl mj ko mk ks ml kw mm la me mf mg mh bi translated">https://github.com/open-policy-agent/opa的Github <code class="fe mn mo mp mq b">OPA</code>仓库:<a class="ae lb" href="https://github.com/open-policy-agent/opa" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>