<html>
<head>
<title>How to understand reduce()?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何理解reduce()？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-understand-reduce-d246b7a70f78?source=collection_archive---------3-----------------------#2018-05-10">https://itnext.io/how-to-understand-reduce-d246b7a70f78?source=collection_archive---------3-----------------------#2018-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a0a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">TypeScript/JavaScript中的函数编程</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/57479ec6f0cd17ffbb6df9dcce620b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzjU4NiyPVgZUzdIRVaCKQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">数百万条银鱼变成了龙卷风</figcaption></figure><p id="7868" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">reduce</code>是另一个函数式编程概念，它在JavaScript中作为数组方法提供:<code class="fe ls lt lu lv b">Array.prototype.reduce()</code>:</p><blockquote class="lw lx ly"><p id="30c0" class="kw kx lz ky b kz la jr lb lc ld ju le ma lg lh li mb lk ll lm mc lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b"><strong class="ky ir">reduce()</strong></code>方法对一个累加器和数组中的每个元素(从左到右)应用一个函数，将它减少到一个值。</p></blockquote><p id="b1b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上<a class="ae md" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce" rel="noopener ugc nofollow" target="_blank"> MDN对方法的解释</a>过于简单，有时会给人造成混乱。事实上，<code class="fe ls lt lu lv b">reduce</code>非常强大，在我看来它有两个用例:折叠列表或转换初始值。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h2 id="4e7d" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">减少的参与者</h2><p id="5aba" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">首先让我们来看看<code class="fe ls lt lu lv b">reduce</code>包含了什么。共有3名参与者:</p><ul class=""><li id="1182" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><strong class="ky ir">列表</strong></li><li id="58ac" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir">减速器</strong>(reduce功能)</li><li id="12d9" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><strong class="ky ir">初始值</strong>(有时可以省略，不存在时，是列表中的第一项)</li></ul><p id="e024" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如:</p><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="7379" class="ml mm iq lv b gy oa ob l oc od">function sum(sum: number, item: number): number {<br/>  return sum + item;<br/>}</span><span id="9a17" class="ml mm iq lv b gy oe ob l oc od">const list = [1,2,3];</span><span id="0269" class="ml mm iq lv b gy oe ob l oc od">const result = Array.prototype.reduce.call(list, sum); // -&gt; 6<br/>const result2 = Array.prototype.reduce.call(list, sum, 1); // -&gt; 7</span></pre><p id="b3af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">列表</strong>是数组。<strong class="ky ir">减速器</strong>为<code class="fe ls lt lu lv b">sum</code>功能，第二种情况下<strong class="ky ir">初始值</strong>为数字1。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h2 id="3876" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">输入/输出形状</h2><p id="5ff5" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">然后，为了更好地理解<code class="fe ls lt lu lv b">reduce</code>，让我们来了解一下输入/输出形状的概念。我们都知道函数接受输入并生成输出。在纯函数中，没有副作用，所以我们可以说，当我们调用纯函数时，它只是把输入转换成输出。</p><p id="cb51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，下面的函数接受两个数字并输出一个数字。看起来是:<code class="fe ls lt lu lv b">[], number -&gt; []</code>。</p><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="69d8" class="ml mm iq lv b gy oa ob l oc od">function sum(a: number[], b: number): number[] { <br/>  return [...a, b]; <br/>}</span></pre><p id="1a48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以想象把一块石头放在一堆石头上面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/381798b51953992133c5f3342f5ed9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ZkLO33jLY3KddeJ2fnTCA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae md" href="https://unsplash.com/photos/70zb7HHhspc" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/70zb7HHhspc</a></figcaption></figure><p id="92bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，记住形状概念，我们可以将<code class="fe ls lt lu lv b">reduce</code>的用法分为两种情况:</p><ol class=""><li id="e5f1" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr og no np nq bi translated">折叠列表，形状看起来是这样的:<code class="fe ls lt lu lv b">Object[] -&gt; Object</code></li><li id="e822" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr og no np nq bi translated">变换初始值，形状看起来是这样的:<code class="fe ls lt lu lv b">Object -&gt; Object</code></li></ol></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h2 id="b1f1" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">1.折叠列表:<code class="fe ls lt lu lv b">Object[] -&gt; Object</code></h2><p id="519d" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">这是为了转换列表中的输入，并输出一个值。</p><p id="fff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你知道<code class="fe ls lt lu lv b">reduce</code>有时也被称为<code class="fe ls lt lu lv b">fold</code>，你可以通过想象将一条长毯子折叠成垫子来得到提示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/52591d25ed421f042db46917cd6785ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hs34wNGS73rK-Y9g5jOc0g.png"/></div></div></figure><p id="533e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">reduce</code>的例子大多属于这一类。</p><h2 id="3414" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">示例:计算数组的和</h2><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="5220" class="ml mm iq lv b gy oa ob l oc od">function sum(sum: number, item: number): number {<br/>  return sum + item;<br/>}</span><span id="e9a0" class="ml mm iq lv b gy oe ob l oc od">const list = [1,2,3];</span><span id="16b5" class="ml mm iq lv b gy oe ob l oc od">const result = Array.prototype.reduce.call(list, sum); // -&gt; 6</span></pre><p id="ddb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它的作用是:</p><ul class=""><li id="9531" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated">将<strong class="ky ir">列表</strong>中的第一项作为<strong class="ky ir">初始值</strong></li><li id="c5e8" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">循环浏览<strong class="ky ir">列表</strong>并</li><li id="4e25" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">逐个应用<strong class="ky ir">减速器函数</strong>，并将结果链接到下一次迭代</li></ul><h2 id="8801" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">示例:查找数组中的最大数字</h2><p id="b855" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">想想输入和输出的形状，它把一个列表转换成一个单一的值，所以我们可以像这样<code class="fe ls lt lu lv b">reduce</code>:</p><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="530d" class="ml mm iq lv b gy oa ob l oc od">function max(a: number, b: number): number {<br/>  return a &gt; b ? a : b;<br/>}</span><span id="775c" class="ml mm iq lv b gy oe ob l oc od">const list = [1,5,3];</span><span id="7e5e" class="ml mm iq lv b gy oe ob l oc od">const result = Array.prototype.reduce.call(list, max); // -&gt; 5</span></pre></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><h2 id="f732" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">2.变换初始值:<code class="fe ls lt lu lv b">Object -&gt; Object</code></h2><p id="58dd" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">除了变换<strong class="ky ir">列表</strong>，我们还可以变换<strong class="ky ir">初始值</strong>。在这种情况下，就像递归地将<strong class="ky ir">缩减器</strong>函数应用于<strong class="ky ir">初始值</strong>并链接输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/9aebabfd258b81a4c59526cf33e7f1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*mAtziDKdCpHJvfJD1LU3XA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae md" href="https://twitter.com/danicapatrick/status/508602513789304832" rel="noopener ugc nofollow" target="_blank">https://twitter.com/danicapatrick/status/508602513789304832</a></figcaption></figure><p id="be78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象你和粉丝击掌，你是<strong class="ky ir">初始值</strong>，粉丝是<strong class="ky ir">单子</strong>击掌动作是<strong class="ky ir">减速器</strong>。</p><h2 id="567c" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated">示例:用替换选项列表替换uri参数:</h2><p id="cf8a" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">假设您有一个uri <code class="fe ls lt lu lv b"><em class="lz">https://abc.com/:id/docs/:docId/history</em></code>，并且您想要将<code class="fe ls lt lu lv b">:id</code>替换为用户id。</p><p id="46d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想想函数的形状是把对象(uri)转换成另一个uri(用参数替换)，所以我们可以这样做:</p><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="cc74" class="ml mm iq lv b gy oa ob l oc od">const replacementOptions = [<br/>  {replace: ‘:id’, to: ‘SJDUEB’}, <br/>  {replace: ‘:docId’, to: ‘12345’}<br/>];</span><span id="3f73" class="ml mm iq lv b gy oe ob l oc od">const uri = ‘https://<a class="ae md" href="http://abc.com/:id/docs/:docId/history" rel="noopener ugc nofollow" target="_blank">abc.com/:id/docs/:docId/history</a>’;</span><span id="0165" class="ml mm iq lv b gy oe ob l oc od">function reduce(uri: string, option: any): string {<br/>  return uri.replace(option.replace, option.to);<br/>}</span><span id="5ea4" class="ml mm iq lv b gy oe ob l oc od">const result = Array.prototype.reduce.call(<br/>  replacementOptions, // list<br/>  reduce, // reducer<br/>  uri // initial value<br/>);</span></pre><p id="17fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们可以看到<strong class="ky ir">初始值</strong> ( <code class="fe ls lt lu lv b">uri</code>)是由<strong class="ky ir">减速器</strong>函数根据<strong class="ky ir">列表</strong> ( <code class="fe ls lt lu lv b">replacementOptions</code>)转换而来的。</p><p id="637b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，它不再转换列表。</p><h2 id="e53c" class="ml mm iq bd kv mn mo dn mp mq mr dp ms lf mt mu mv lj mw mx my ln mz na nb nc bi translated"><strong class="ak">举例:写一个简单的</strong><a class="ae md" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ak">Redux</strong></a><strong class="ak">实现</strong></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/d79097e26caf0204837d9a52ba7b1668.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*XM79CJgVO3TAWgPchUGaHA.png"/></div></figure><p id="c54e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Redux是一个状态管理库。它有一个全局状态对象，每个动作都会减少状态。</p><p id="e463" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们写一个非常简单的Redux实现。</p><pre class="kg kh ki kj gt nw lv nx ny aw nz bi"><span id="a5c7" class="ml mm iq lv b gy oa ob l oc od">const initialState = {sum: 0, history: []};</span><span id="dbda" class="ml mm iq lv b gy oe ob l oc od">function reduce(state: any, action: any) {<br/>  return {<br/>    sum: state.sum + action.n,<br/>    history: [...state.history, action.name]<br/>  };<br/>}</span><span id="1304" class="ml mm iq lv b gy oe ob l oc od">const action1 = {<br/>  name: 'action1',<br/>  n: 1<br/>};</span><span id="5c73" class="ml mm iq lv b gy oe ob l oc od">const action2 = {<br/>  name: 'action2',<br/>  n: 2<br/>};</span><span id="6411" class="ml mm iq lv b gy oe ob l oc od">const list = [action1, action2];</span><span id="4bd0" class="ml mm iq lv b gy oe ob l oc od">const finalState = Array.prototype.reduce.call(<br/>  list, <br/>  reduce,<br/>  initialState<br/>);</span><span id="573f" class="ml mm iq lv b gy oe ob l oc od">console.log(finalState); // {sum: 3, history: ['action1', 'action2']}</span></pre><p id="bd00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，你可以看到我们正在转换<strong class="ky ir">初始值</strong>，而不是<strong class="ky ir">列表</strong>。</p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="e9b2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lz">本文属于TypeScript/JavaScript中</em> <a class="ae md" href="https://medium.com/@hamxiaoz/functional-programming-in-typescript-javascript-d9d79663bc4" rel="noopener"> <em class="lz">函数式编程系列。</em>T56】</a></p></div></div>    
</body>
</html>