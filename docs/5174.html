<html>
<head>
<title>React-static app testing with Cypress — Tutorial Part IV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cypress测试React-static应用程序——教程第四部分</h1>
<blockquote>原文：<a href="https://itnext.io/react-static-app-testing-with-cypress-tutorial-part-iv-ad1ad4612fc1?source=collection_archive---------3-----------------------#2021-01-02">https://itnext.io/react-static-app-testing-with-cypress-tutorial-part-iv-ad1ad4612fc1?source=collection_archive---------3-----------------------#2021-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/906af147ece9a90e40c318dfc413586b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mriRfYOCQhokOEsX0Cc4Q.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马丁·亚当斯在<a class="ae kc" href="https://unsplash.com/s/photos/quality-control?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8b7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们现在已经有了一个漂亮而简单的应用程序，所以每当我们收到一个新的拉取请求时，我们想向它添加一些内容并测试它。</p><p id="7584" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将删除新闻区的旧进度页面。</p><h1 id="f902" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">内容</h1><p id="16dc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将利用react-statics特性在构建期间获取内容，以创建新的路由，包括检索到的每个数据的页面。</p><p id="fd74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据</p><p id="c3c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们以JSON的形式创建一些通用数据，并将它们存储在类似<a class="ae kc" href="https://www.npoint.io/" rel="noopener ugc nofollow" target="_blank"> npoint </a>的服务上，这样我们以后就可以很容易地检索到它们。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1564" class="mn lc iq mj b gy mo mp l mq mr">[<br/>  {<br/>    "userId": 1,<br/>    "id": 2,<br/>    "title": "The App is now live!",<br/>    "body": "This is our first article to tell you about this new wonderful app, it is part of a great tutorial series, on how you can create a beautiful static app, deploy it from Github with CI/CD and last but not least shipping with PWA capabilities to make it installable for end-users."<br/>  },<br/>  {<br/>    "userId": 1,<br/>    "id": 1,<br/>    "title": "ACME Corp acquires Foo Limited",<br/>    "body": "As we reached our first great milestone by releasing our app and building a strong user base we decided to take the next strategic step forward by acquiring Foo Limited. Foo Limited is a constant player in the field with its flagship app Bar. We are happy to streamline our development efforts soon."<br/>  }<br/>]</span></pre><p id="181f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我创建它之后，我将它锁定以保持我们的应用程序处于可演示状态——你可以在<a class="ae kc" href="https://www.npoint.io/docs/af7aa73d0609f820ed5e" rel="noopener ugc nofollow" target="_blank">https://www.npoint.io/docs/af7aa73d0609f820ed5e</a>看到它，并在<a class="ae kc" href="https://api.npoint.io/af7aa73d0609f820ed5e" rel="noopener ugc nofollow" target="_blank">https://api.npoint.io/af7aa73d0609f820ed5e</a>验证原始JSON。</p><p id="a504" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用数据</p><p id="4ddb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用这些数据，我们需要在我们的<em class="ms"> static.config.js </em>中启用getRoutes函数</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9aae" class="mn lc iq mj b gy mo mp l mq mr">import path from "path";<br/>import axios from "axios";</span><span id="92fd" class="mn lc iq mj b gy mt mp l mq mr">export default {<br/>  getRoutes: async () =&gt; {<br/>    const { data: newsItems } = await axios.get(<br/>      "https://api.npoint.io/af7aa73d0609f820ed5e"<br/>    );</span><span id="ebb9" class="mn lc iq mj b gy mt mp l mq mr">    return [<br/>      {<br/>        path: "/news",<br/>        getData: () =&gt; ({<br/>          newsItems,<br/>        }),<br/>        children: newsItems.map((item) =&gt; ({<br/>          path: `/${item.id}`,<br/>          template: "src/containers/Item",<br/>          getData: () =&gt; ({<br/>            item,<br/>          }),<br/>        })),<br/>      },<br/>    ];<br/>  },<br/>  plugins: [<br/>  // ...<br/>  ]<br/>};</span></pre><p id="371f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让这个工作，我们需要再次添加<strong class="kf ir">轴</strong>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="099d" class="mn lc iq mj b gy mo mp l mq mr">$ npm install --save-dev axios<br/># or<br/>$ yarn add -D axios</span></pre><p id="2b38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们可以下载我们的<em class="ms"> dist </em>文件夹的<em class="ms"> news </em>文件夹中的数据，其中每个子文件夹的Id就是包含生成的html的文件夹。</p><p id="e95f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于生成的html，我们使用一个容器模板，它存在于我们的<em class="ms"> src/containers/Item.js </em>中，也在我们的<em class="ms"> getRoutes </em>函数中为每个孩子引用。</p><p id="e179" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来看看我们的<em class="ms"> Item.js </em>文件:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7123" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { useRouteData } from "react-static";<br/>import { Heading, Box, Text } from "grommet";</span><span id="a2ff" class="mn lc iq mj b gy mt mp l mq mr">export default function Item() {<br/>  const { item } = useRouteData();<br/>  return (<br/>    &lt;Box align="center" justify="center" fill pad="medium"&gt;<br/>      &lt;Heading data-test="header"&gt;{item.title}&lt;/Heading&gt;<br/>      &lt;Box align="start" justify="center"&gt;<br/>        &lt;Text data-test="news-body"&gt;{item.body}&lt;/Text&gt;<br/>      &lt;/Box&gt;<br/>    &lt;/Box&gt;<br/>  );<br/>}</span></pre><p id="d7da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我要特别注意下面的部分，因为它为每个孩子获取了之前在我们的<em class="ms"> static.config.js </em>中的<em class="ms"> getRoutes </em>函数中定义的项目。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a067" class="mn lc iq mj b gy mo mp l mq mr">const { item } = useRouteData();</span></pre><p id="df74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要创建新闻的入口文件。这个文件将在我们的<em class="ms"> src/pages/ </em>文件夹中被命名为<em class="ms"> news.js </em>。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="198f" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { useRouteData } from "react-static";<br/>import { Heading, Box, Anchor, Text } from "grommet";</span><span id="6f0d" class="mn lc iq mj b gy mt mp l mq mr">export default function News() {<br/>  const { newsItems } = useRouteData();<br/>  return (<br/>    &lt;Box align="center" justify="center" fill pad="medium"&gt;<br/>      &lt;Heading data-test="header"&gt;News&lt;/Heading&gt;<br/>      &lt;Box align="start" justify="center"&gt;<br/>        {newsItems.map((item) =&gt; (<br/>          &lt;Anchor<br/>            data-test="news-link"<br/>            key={item.id}<br/>            href={`/news/${item.id}/`}<br/>          &gt;<br/>            &lt;Box align="start" justify="center" border={{ side: "bottom" }}&gt;<br/>              &lt;Heading level="3" margin="small"&gt;<br/>                {item.title}<br/>              &lt;/Heading&gt;<br/>              &lt;Text color="dark-6" margin="small"&gt;<br/>                {item.body.substring(0, 70)}...<br/>              &lt;/Text&gt;<br/>            &lt;/Box&gt;<br/>          &lt;/Anchor&gt;<br/>        ))}<br/>      &lt;/Box&gt;<br/>    &lt;/Box&gt;<br/>  );<br/>}</span></pre><p id="2c85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我要特别注意下面的部分，因为它获取了之前在我们的<em class="ms"> static.config.js </em>中的<em class="ms"> getRoutes </em>函数中定义的新闻条目</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c469" class="mn lc iq mj b gy mo mp l mq mr">const { newsItems } = useRouteData();</span></pre><p id="2ca2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们需要用新图标更新导航组件，替换为:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="db14" class="mn lc iq mj b gy mo mp l mq mr">import { Home, Menu, BarChart } from "grommet-icons";<br/>// replace with<br/>import { Home, Menu, Catalog } from "grommet-icons";</span><span id="b906" class="mn lc iq mj b gy mt mp l mq mr">// ... and the second navigation box should be updated to:<br/>    &lt;Box<br/>      align="center"<br/>      justify="center"<br/>      background={{<br/>        color: getNavColor(location, ["/news"]),<br/>      }}<br/>      data-test="nav-news"<br/>      flex="grow"<br/>      onClick={() =&gt; navigate("/news")}<br/>      pad="medium"<br/>      overflow="hidden"<br/>      gridArea="second"<br/>    &gt;<br/>      &lt;Catalog /&gt;<br/>    &lt;/Box&gt;</span></pre><p id="f103" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还要注意，我们已经为元素添加了数据测试属性，以便以后用cypress测试它们。</p><p id="611d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你决定使用jsonbin.io或Contentful之类的服务，你可以设置一个webhook，并在每次内容发生变化时重新构建你的应用程序。</p><h1 id="5510" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试</h1><p id="4ac5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">正如本教程前面提到的，我们将使用cypress进行应用测试。</p><p id="6f52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从安装cypress开始，cypress eslint配置和启动服务器和测试模块。</p><p id="efae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">后者用于启动服务器，检查它何时运行，然后启动一个测试命令，然后再将其全部拆除。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8118" class="mn lc iq mj b gy mo mp l mq mr">yarn add -D cypress eslint-plugin-cypress start-server-and-test</span></pre><p id="d324" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当安装cypress时，它会在你的根目录下创建一个Cypress文件夹，其中包含一些默认文件夹。在运行测试时，cypress还可以在出现问题时进行截图和录音，并将它们存储在<em class="ms"> cypress/videos </em>和<em class="ms"> cypress/recordings </em>中。因为我们将在CI管道中使用cypress，所以我们不需要在git中跟踪它们。让我们在我们的<em class="ms">中添加以下2行。gitignore </em></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="41ef" class="mn lc iq mj b gy mo mp l mq mr">/cypress/videos<br/>/cypress/screenshots</span></pre><p id="31cc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也更新我们的<em class="ms">。eslintrc </em>文件不要让<strong class="kf ir"> eslint </strong>对cypress大喊大叫:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="16af" class="mn lc iq mj b gy mo mp l mq mr">{<br/>  "extends": ["react-app", "plugin:cypress/recommended"]<br/>}</span></pre><h1 id="a4ad" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">最小Cypress设置</h1><p id="a8be" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在根目录下创建一个cypress.json文件，内容如下:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7563" class="mn lc iq mj b gy mo mp l mq mr">{<br/>    "baseUrl": "http://localhost:3000",<br/>    "chromeWebSecurity": false<br/>}</span></pre><p id="ca0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们关闭了chromeWebSecurity，因为它会使我们的测试在CI中崩溃。</p><p id="e828" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们也更新一下我们的<em class="ms"> package.json </em>中的脚本部分，我们可以很容易地调用cypress:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="bf26" class="mn lc iq mj b gy mo mp l mq mr">{<br/>    //...<br/>    scripts: {<br/>        //...<br/>        "serve": "serve dist -p 3000",<br/>        "e2e": "npm run build &amp;&amp; start-server-and-test 'npm run serve' 3000 'cypress run'",<br/>        "e2e:headed": "start-server-and-test 'npm run start' 3000 'cypress open'"<br/>    },<br/>    //...<br/>}</span></pre><p id="c813" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了两个命令，一个用于有头的cypress，这对于调试很有用，另一个是将在CI中使用的无头脚本。</p><h1 id="7d13" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第一个测试案例</h1><p id="dc67" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在这个阶段，我们可以在<em class="ms">cypress/integration/basic . spec . js</em>中创建我们的第一个测试用例:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="46c0" class="mn lc iq mj b gy mo mp l mq mr">describe("Basic", () =&gt; {<br/>  it("Home", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="header"]').should("be.visible");<br/>    cy.get('[data-test="paragraph"]').should("have.length", 2);<br/>  });<br/>});</span></pre><p id="941e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个测试，将只是到我们的应用程序的主页，并测试一个标题和2个段落的存在。</p><p id="969c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们在这个文件中测试应用程序的导航和其他页面:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e091" class="mn lc iq mj b gy mo mp l mq mr">describe("Basic", () =&gt; {<br/>  it("Home", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="header"]').should("be.visible");<br/>    cy.get('[data-test="paragraph"]').should("have.length", 2);<br/>  });<br/>  it("Navigation", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="nav-news"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/news");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("News");<br/>    cy.get('[data-test="nav-more"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/more");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("More");<br/>  });<br/>  it("About Page", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="nav-more"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/more");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("More");<br/>    cy.get('[data-test="more-nav-about"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/about");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("About");<br/>  });<br/>  it("Legal Page", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="nav-more"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/more");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("More");<br/>    cy.get('[data-test="more-nav-legal"]').click();<br/>    cy.location().should((loc) =&gt; {<br/>      expect(loc.pathname).to.eq("/legal");<br/>    });<br/>    cy.get('[data-test="header"]').should("be.visible").contains("Legal");<br/>  });<br/>  it("Not Found Page", () =&gt; {<br/>    cy.visit("/weird", { failOnStatusCode: false });<br/>    cy.get('[data-test="header"]').contains("404");<br/>  });<br/>});</span></pre><p id="11d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">未找到页面测试用例是特殊的，因为路由器将响应404，这将导致cypress失败，但是由于我们想要测试这个特殊的页面，我们需要为cypress提供选项，以避免在更高的状态代码299(<em class="ms">failOnStatusCode:false</em>)上失败</p><p id="2314" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后但同样重要的是，我们还将在下面的测试文件<em class="ms">cypress/integration/news . spec . js</em>中测试我们新创建的新闻部分:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9ae7" class="mn lc iq mj b gy mo mp l mq mr">describe("News", () =&gt; {<br/>  it("News Overview", () =&gt; {<br/>    cy.visit("/news");<br/>    cy.get('[data-test="header"]').should("be.visible").contains("News");<br/>    cy.get('[data-test="news-link"]').should("have.length", 2);<br/>  });<br/>  it("News #1", () =&gt; {<br/>    cy.visit("/news");<br/>    cy.get('[data-test="news-link"]').first().click();<br/>    cy.get('[data-test="header"]').should("be.visible");<br/>    cy.get('[data-test="news-body"]').should("be.visible");<br/>  });<br/>  it("News #2", () =&gt; {<br/>    cy.visit("/");<br/>    cy.get('[data-test="nav-news"]').click();<br/>    cy.get('[data-test="header"]').should("be.visible").contains("News");<br/>    cy.get('[data-test="news-link"]').first().next().click();<br/>    cy.get('[data-test="header"]').should("be.visible");<br/>    cy.get('[data-test="news-body"]').should("be.visible");<br/>  });<br/>});</span></pre><h1 id="764b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">试运转</h1><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/a389805bac93f9574e27097293a9c2f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysjGq-xNeg9Pmxru2gAixg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Cypress UI</figcaption></figure><p id="a436" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行<code class="fe mv mw mx mj b">yarn run e2e</code>将为我们启动cypress，看起来应该是:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2b3f" class="mn lc iq mj b gy mo mp l mq mr">$ yarn run e2e<br/>yarn run v1.22.10<br/>$ npm run build &amp;&amp; start-server-and-test 'npm run serve' 3000 'cypress run'<br/>npm WARN lifecycle The node binary used for scripts is /var/folders/wz/79z_9bgj08n9rccm5y503wxm0000gn/T/yarn--1609592529296-0.9931212812991292/node but npm is using /Users/ckaatz/n/bin/node itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.</span><span id="e172" class="mn lc iq mj b gy mt mp l mq mr">&gt; the-app-tutorial@ build /Users/ckaatz/development/static-app-tutorial<br/>&gt; react-static build &amp;&amp; workbox generateSW</span><span id="b739" class="mn lc iq mj b gy mt mp l mq mr">Bundling application for Production...</span><span id="7aa1" class="mn lc iq mj b gy mt mp l mq mr">Cleaning dist...<br/>[✓] Dist cleaned<br/>Cleaning artifacts...<br/>[✓] Artifacts cleaned<br/>Building Routes...<br/>Importing routes from directory...<br/>{ has404: true }<br/>[✓] Routes Built (0.6s)<br/>Building Templates...<br/>[✓] Templates Built<br/>Copying public directory...<br/>[✓] Public directory copied (0.3s)<br/>Bundling App...<br/>Version: webpack 4.44.2<br/>Time: 7135ms<br/>Built at: 01/02/2021 2:02:20 PM<br/>[✓] App Bundled (7.7s)<br/>Fetching Site Data...<br/>[✓] Site Data Downloaded<br/>Fetching Route Data...<br/>[========] 8/8 100% Infinity/s 0.0s <br/>[✓] Route Data Downloaded<br/>Exporting HTML across 8 threads...<br/>[========] 8/8 100% 13/s 0.0s <br/>[✓] HTML Exported (5.1s)<br/>Generating sitemap.xml...<br/>[✓] sitemap.xml generated</span><span id="c5b9" class="mn lc iq mj b gy mt mp l mq mr">Using configuration from /Users/ckaatz/development/static-app-tutorial/workbox-config.js.<br/>The service worker files were written to:<br/>  • /Users/ckaatz/development/static-app-tutorial/dist/sw.js<br/>  • /Users/ckaatz/development/static-app-tutorial/dist/sw.js.map<br/>  • /Users/ckaatz/development/static-app-tutorial/dist/workbox-e1834b40.js<br/>  • /Users/ckaatz/development/static-app-tutorial/dist/workbox-e1834b40.js.map<br/>The service worker will precache 31 URLs, totaling 556 kB.<br/>1: starting server using command "npm run serve"<br/>and when url "[ 'http://localhost:3000' ]" is responding with HTTP status code 200<br/>running tests using command "cypress run"</span><span id="d58e" class="mn lc iq mj b gy mt mp l mq mr">npm WARN lifecycle The node binary used for scripts is /var/folders/wz/79z_9bgj08n9rccm5y503wxm0000gn/T/yarn--1609592529296-0.9931212812991292/node but npm is using /Users/ckaatz/n/bin/node itself. Use the `--scripts-prepend-node-path` option to include the path for the node binary npm was executed with.</span><span id="30de" class="mn lc iq mj b gy mt mp l mq mr">&gt; the-app-tutorial@ serve /Users/ckaatz/development/static-app-tutorial<br/>&gt; serve dist -p 3000<br/></span><span id="49a8" class="mn lc iq mj b gy mt mp l mq mr">   ┌───────────────────────────────────────────────────┐<br/>   │                                                   │<br/>   │   Serving!                                        │<br/>   │                                                   │<br/>   │   - Local:            http://localhost:3000       │<br/>   │   - On Your Network:  http://192.168.1.109:3000   │<br/>   │                                                   │<br/>   │   Copied local address to clipboard!              │<br/>   │                                                   │<br/>   └───────────────────────────────────────────────────┘<br/></span><span id="1a8f" class="mn lc iq mj b gy mt mp l mq mr">========================================================================================</span><span id="f268" class="mn lc iq mj b gy mt mp l mq mr">  (Run Starting)</span><span id="b85f" class="mn lc iq mj b gy mt mp l mq mr">  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐<br/>  │ Cypress:    6.1.0                                                                              │<br/>  │ Browser:    Electron 87 (headless)                                                             │<br/>  │ Specs:      2 found (basic.spec.js, news.spec.js)                                              │<br/>  └────────────────────────────────────────────────────────────────────────────────────────────────┘<br/></span><span id="7951" class="mn lc iq mj b gy mt mp l mq mr">────────────────────────────────────────────────────────────────────────────────────────────────────<br/>                                                                                                    <br/>  Running:  basic.spec.js                                                                   (1 of 2)<br/></span><span id="cc82" class="mn lc iq mj b gy mt mp l mq mr">  Basic<br/>    ✓ Home (876ms)<br/>    ✓ Navigation (2284ms)<br/>    ✓ About Page (1472ms)<br/>    ✓ Legal Page (1247ms)<br/>    ✓ Not Found Page (602ms)<br/></span><span id="88b6" class="mn lc iq mj b gy mt mp l mq mr">  5 passing (7s)<br/></span><span id="9f59" class="mn lc iq mj b gy mt mp l mq mr">  (Results)</span><span id="1367" class="mn lc iq mj b gy mt mp l mq mr">  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐<br/>  │ Tests:        5                                                                                │<br/>  │ Passing:      5                                                                                │<br/>  │ Failing:      0                                                                                │<br/>  │ Pending:      0                                                                                │<br/>  │ Skipped:      0                                                                                │<br/>  │ Screenshots:  0                                                                                │<br/>  │ Video:        true                                                                             │<br/>  │ Duration:     6 seconds                                                                        │<br/>  │ Spec Ran:     basic.spec.js                                                                    │<br/>  └────────────────────────────────────────────────────────────────────────────────────────────────┘<br/></span><span id="f573" class="mn lc iq mj b gy mt mp l mq mr">  (Video)</span><span id="2f11" class="mn lc iq mj b gy mt mp l mq mr">  -  Started processing:  Compressing to 32 CRF                                                     <br/>  -  Finished processing: /Users/ckaatz/development/static-app-tutorial/cypress/video    (0 seconds)<br/>                          s/basic.spec.js.mp4                                                       <br/></span><span id="c220" class="mn lc iq mj b gy mt mp l mq mr">────────────────────────────────────────────────────────────────────────────────────────────────────<br/>                                                                                                    <br/>  Running:  news.spec.js                                                                    (2 of 2)<br/></span><span id="51d5" class="mn lc iq mj b gy mt mp l mq mr">  News<br/>    ✓ News Overview (697ms)<br/>    ✓ News #1 (581ms)<br/>    ✓ News #2 (883ms)<br/></span><span id="8437" class="mn lc iq mj b gy mt mp l mq mr">  3 passing (2s)<br/></span><span id="5c03" class="mn lc iq mj b gy mt mp l mq mr">  (Results)</span><span id="88d2" class="mn lc iq mj b gy mt mp l mq mr">  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐<br/>  │ Tests:        3                                                                                │<br/>  │ Passing:      3                                                                                │<br/>  │ Failing:      0                                                                                │<br/>  │ Pending:      0                                                                                │<br/>  │ Skipped:      0                                                                                │<br/>  │ Screenshots:  0                                                                                │<br/>  │ Video:        true                                                                             │<br/>  │ Duration:     2 seconds                                                                        │<br/>  │ Spec Ran:     news.spec.js                                                                     │<br/>  └────────────────────────────────────────────────────────────────────────────────────────────────┘<br/></span><span id="0b8f" class="mn lc iq mj b gy mt mp l mq mr">  (Video)</span><span id="0e80" class="mn lc iq mj b gy mt mp l mq mr">  -  Started processing:  Compressing to 32 CRF                                                     <br/>  -  Finished processing: /Users/ckaatz/development/static-app-tutorial/cypress/video    (0 seconds)<br/>                          s/news.spec.js.mp4                                                        <br/></span><span id="57df" class="mn lc iq mj b gy mt mp l mq mr">====================================================================================================</span><span id="e30b" class="mn lc iq mj b gy mt mp l mq mr">  (Run Finished)<br/></span><span id="e02e" class="mn lc iq mj b gy mt mp l mq mr">       Spec                                              Tests  Passing  Failing  Pending  Skipped  <br/>  ┌────────────────────────────────────────────────────────────────────────────────────────────────┐<br/>  │ ✔  basic.spec.js                            00:06        5        5        -        -        - │<br/>  ├────────────────────────────────────────────────────────────────────────────────────────────────┤<br/>  │ ✔  news.spec.js                             00:02        3        3        -        -        - │<br/>  └────────────────────────────────────────────────────────────────────────────────────────────────┘<br/>    ✔  All specs passed!                        00:08        8        8        -        -        -  <br/></span><span id="3a4c" class="mn lc iq mj b gy mt mp l mq mr">INFO: Gracefully shutting down. Please wait...<br/>✨  Done in 46.83s.</span></pre><h1 id="4890" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">在CI中布线</h1><p id="7536" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">最后，我们希望在每个拉请求上挂接我们的测试，为了实现这一点，我们需要更新我们的PR工作流文件(<em class="ms">)。github/workflows/firebase-hosting-pull-request . yml</em></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ccf0" class="mn lc iq mj b gy mo mp l mq mr">name: Run Cypress tests and deploy to Firebase Hosting on PR<br/>'on': pull_request<br/>jobs:<br/>  build_and_preview:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v2<br/>      - uses: cypress-io/github-action@v2<br/>        with:<br/>          install-command: yarn --frozen-lockfile --silent<br/>          build: yarn build<br/>          start: yarn serve<br/>          wait-on: 'http://localhost:3000'<br/>          browser: chrome<br/>          headless: true<br/>      - run: yarn &amp;&amp; yarn build<br/>      - uses: FirebaseExtended/action-hosting-deploy@v0<br/>        with:<br/>          repoToken: '${{ secrets.GITHUB_TOKEN }}'<br/>          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_APP_BOOTSTRAP_TUTORIAL }}'<br/>          projectId: app-bootstrap-tutorial<br/>        env:<br/>          FIREBASE_CLI_PREVIEWS: hostingchannels</span></pre><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/86d1f219fb3269394f26bea0da9f4ba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b5TUvIHaaMsnOr69DjQjUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">成功的带头测试运行</figcaption></figure><h1 id="3a9e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">密码</h1><p id="3131" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">代码可以在Github<a class="ae kc" href="https://github.com/chrkaatz/static-app-tutorial" rel="noopener ugc nofollow" target="_blank">https://github.com/chrkaatz/static-app-tutorial</a>找到，每个教程步骤都有各自的提交和标签与之关联。这款贴有<a class="ae kc" href="https://github.com/chrkaatz/static-app-tutorial/releases/tag/04-React-Static-App-Testing" rel="noopener ugc nofollow" target="_blank">04-反应-静态-App-测试</a>的标签。</p><h1 id="0775" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">辅导的</h1><ol class=""><li id="1e3a" class="mz na iq kf b kg lz kk ma ko nb ks nc kw nd la ne nf ng nh bi translated"><a class="ae kc" href="https://chrkaatz.medium.com/bootstrap-your-app-with-react-static-and-grommet-fac9c137cc31" rel="noopener">第一部分——用react-static和grommet引导您的应用程序</a></li><li id="c09d" class="mz na iq kf b kg ni kk nj ko nk ks nl kw nm la ne nf ng nh bi translated"><a class="ae kc" href="https://github.com/chrkaatz/static-app-tutorial/releases/tag/03-React-Static-PWA" rel="noopener ugc nofollow" target="_blank">第二部分—React-静态应用部署和CI </a></li><li id="11bd" class="mz na iq kf b kg ni kk nj ko nk ks nl kw nm la ne nf ng nh bi translated"><a class="ae kc" href="https://chrkaatz.medium.com/react-static-pwa-tutorial-part-iii-ed91e0fa1d10" rel="noopener">第三部分—反应-静态PWA </a></li><li id="ed93" class="mz na iq kf b kg ni kk nj ko nk ks nl kw nm la ne nf ng nh bi translated"><a class="ae kc" href="https://chrkaatz.medium.com/react-static-app-testing-with-cypress-tutorial-part-iv-ad1ad4612fc1" rel="noopener"> <strong class="kf ir">第四部分—使用Cypress进行React-静态应用程序测试</strong> </a></li></ol></div></div>    
</body>
</html>