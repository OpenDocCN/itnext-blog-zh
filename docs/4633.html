<html>
<head>
<title>LoRa and LoRaWAN for IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向物联网的LoRa和LoRaWAN</h1>
<blockquote>原文：<a href="https://itnext.io/lora-for-iot-1f91085c5917?source=collection_archive---------0-----------------------#2020-08-10">https://itnext.io/lora-for-iot-1f91085c5917?source=collection_archive---------0-----------------------#2020-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f3d1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">面向物联网低功耗广域网的LoRa和LoRaWAN协议入门</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">帖子的音频版本</figcaption></figure><h1 id="3d76" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">介绍</h1><p id="9727" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据<a class="ae mh" href="https://lora-alliance.org/resource-hub/what-lorawanr" rel="noopener ugc nofollow" target="_blank"> LoRa联盟</a>的说法，低功耗广域网(LPWAN)预计将支持预计用于物联网(IoT)的数十亿设备中的大部分。LoRaWAN的设计自下而上地优化了LPWANs的电池寿命、容量、范围和成本。LoRa和LoRaWAN允许不同类型行业的物联网(IoT)设备进行远程连接。根据<a class="ae mh" href="https://en.wikipedia.org/wiki/LoRa" rel="noopener ugc nofollow" target="_blank">维基百科</a>，LoRaWAN定义了网络的通信协议和系统架构，而LoRa物理层则实现了远程通信链路。</p><h2 id="0ce9" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">劳拉</h2><p id="b4c5" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">远程(<a class="ae mh" href="https://en.wikipedia.org/wiki/LoRa" rel="noopener ugc nofollow" target="_blank"> LoRa </a>)，由Semtech开发的低功率广域网(LPWAN)协议，位于计算机网络七层<a class="ae mh" href="https://en.wikipedia.org/wiki/OSI_model" rel="noopener ugc nofollow" target="_blank"> OSI模型</a>(开放系统互连模型)的第一层<a class="ae mh" href="https://en.wikipedia.org/wiki/Physical_layer" rel="noopener ugc nofollow" target="_blank">物理层</a>。物理层定义了通过连接网络节点的物理数据链路传输原始位的方式。LoRa使用免许可证的亚千兆赫射频(RF)频段，包括433 MHz、868 MHz(欧洲)、915 MHz(澳大利亚和北美)和923 MHz(亚洲)。LoRa能够以低功耗实现长距离传输。</p><h2 id="7506" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">洛拉万</h2><p id="2854" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">LoRaWAN是基于云的媒体访问控制(MAC)子层(第2层)协议，但主要作为<a class="ae mh" href="https://en.wikipedia.org/wiki/Network_layer" rel="noopener ugc nofollow" target="_blank">网络层</a>(第3层)协议，用于管理LPWAN网关和终端节点设备之间的通信，作为路由协议，由<a class="ae mh" href="https://lora-alliance.org/resource-hub/what-lorawanr" rel="noopener ugc nofollow" target="_blank"> LoRa联盟</a>维护。MAC子层和逻辑链路控制(LLC)子层一起构成了OSI模型的第2层，即<a class="ae mh" href="https://en.wikipedia.org/wiki/Data_link_layer" rel="noopener ugc nofollow" target="_blank">数据链路层</a>。</p><p id="5b9e" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">LoRaWAN经常被引用为在农村地区具有超过10公里宽的覆盖区域。然而，根据其他消息来源，一般来说更为有限。根据《电子设计》杂志的文章<a class="ae mh" href="https://www.electronicdesign.com/industrial-automation/article/21806072/11-myths-about-lorawan" rel="noopener ugc nofollow" target="_blank"/><em class="mz">关于LoRaWAN的11个误区，一个典型的LoRaWAN网络范围取决于许多因素——室内或室外网关、信息的有效载荷、使用的天线等。平均而言，在拥有室外网关的城市环境中，您可以期望覆盖范围达到2到3公里，而在农村地区，覆盖范围可以超过5到7公里。劳拉的范围取决于“无线电视线”400 MHz至900 MHz范围内的无线电波可能会穿过一些障碍物，这取决于它们的成分，但会被吸收或反射。这意味着，只要没有物理障碍阻挡，信号就有可能最远到达地平线。</em></p><p id="40bd" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">在接下来的实践文章中，我们将探讨如何使用LoRa和LoRaWAN协议在包含多个嵌入式传感器的物联网设备和物联网网关之间远距离传输和接收传感器数据。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/1fc77dc779cf38667f29ef7a1c39197e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fcsyQQPJiUys3BbqMeO-7g.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">物联网网关(LoRa <em class="nh">接收器</em>)从物联网设备(LoRa发射器)接收传感器数据</figcaption></figure><h1 id="3b96" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">推荐的硬件</h1><p id="336a" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">对于这篇文章，我使用了以下硬件。</p><h2 id="6fdb" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">具有嵌入式传感器的物联网设备</h2><p id="039c" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">我使用了一个Arduino单板微控制器作为物联网传感器，实际上是一个传感器阵列。2019年8月发布的3.3V人工智能Arduino Nano 33 BLE感应板(<a class="ae mh" href="https://www.amazon.com/Arduino-Nano-Sense-headers-Mounted/dp/B07WXKDVTL/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:36.00美元)，配备了Nordic Semiconductors的强大<a class="ae mh" href="https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF52840" rel="noopener ugc nofollow" target="_blank"> nRF52840 </a>处理器，一个运行频率为64 MHz的32位ARM Cortex-M4 CPU，1MB的CPU闪存，256KB的SRAM，以及一个<a class="ae mh" href="https://www.u-blox.com/en/product/nina-b3-series-open-cpu" rel="noopener ugc nofollow" target="_blank"> NINA-B306 </a>独立蓝牙5低能耗(低能耗</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ni"><img src="../Images/aeeb2a072f3866a5a2f74d0cfcdc2ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0uU3dH2K_WW9hdFwHANkw.jpeg"/></div></div></figure><p id="4a50" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">Sense还包含一系列令人印象深刻的嵌入式传感器:</p><ul class=""><li id="e023" class="nj nk it ln b lo mu lr mv lu nl ly nm mc nn mg no np nq nr bi translated">9轴惯性传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lsm9ds1.pdf" rel="noopener ugc nofollow" target="_blank"> LSM9DS1 </a> ): 3D数字线加速度传感器、3D数字<br/>角速度传感器、3D数字磁传感器</li><li id="557e" class="nj nk it ln b lo ns lr nt lu nu ly nv mc nw mg no np nq nr bi translated">湿度和温度传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_HTS221.pdf" rel="noopener ugc nofollow" target="_blank"> HTS221 </a>):电容式数字相对湿度和温度传感器</li><li id="1fce" class="nj nk it ln b lo ns lr nt lu nu ly nv mc nw mg no np nq nr bi translated">气压传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lps22hb.pdf" rel="noopener ugc nofollow" target="_blank"> LPS22HB </a> ): MEMS纳米压力传感器:260–1260百帕(hPa)绝对数字输出气压计</li><li id="b2f9" class="nj nk it ln b lo ns lr nt lu nu ly nv mc nw mg no np nq nr bi translated">麦克风(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_mp34dt05-a.pdf" rel="noopener ugc nofollow" target="_blank"> MP34DT05 </a> ): MEMS音频传感器全向数字麦克风</li><li id="0f57" class="nj nk it ln b lo ns lr nt lu nu ly nv mc nw mg no np nq nr bi translated">手势、接近度、光色和光强传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_av02-4191en_ds_apds-9960.pdf" rel="noopener ugc nofollow" target="_blank"> APDS9960 </a>):高级手势检测、接近度检测、数字环境光感测(ALS)和颜色感测(RGBC)。</li></ul><p id="8c02" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">Arduino Sense是一款出色的<a class="ae mh" href="https://www.amazon.com/Arduino-Nano-Sense-headers-Mounted/dp/B07WXKDVTL" rel="noopener ugc nofollow" target="_blank">低成本</a>单板微控制器，用于学习物联网传感器数据的收集和传输。</p><h2 id="4c08" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">物联网网关</h2><p id="2f8c" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据<a class="ae mh" href="https://whatis.techtarget.com/definition/IoT-gateway" rel="noopener ugc nofollow" target="_blank"> TechTarget </a>的说法，物联网网关是一种物理设备或软件程序，充当云与控制器、传感器和智能设备之间的连接点。所有移动到云的数据都要经过网关，反之亦然，网关可以是专用的硬件设备或软件程序。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nx"><img src="../Images/83a240e70dec936dd7c67d25f6bb4d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFgn5VYa7WAx2f0skruiWw.png"/></div></div></figure><p id="b98d" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">我用了一台第三代<a class="ae mh" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 3 Model B+ </a>单板机(SBC)，作为物联网网关。这款Raspberry Pi型号具有1.4GHz Cortex-A53 (ARMv8) 64位四核处理器片上系统(SoC)、1GB LPDDR2 SDRAM、双频无线局域网、蓝牙4.2 BLE和千兆以太网(<a class="ae mh" href="https://www.amazon.com/dp/B085DPFR3N" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:42.99美元)。</p><p id="ea37" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated"><em class="mz">按照本文，您可以用Raspberry Pi代替任何基于Linux的机器来运行包含的示例Python脚本。</em></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ni"><img src="../Images/928586a1a13c28897c4453d959edc5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GRsxsLcm9BvTiZ3dAV7vQ.jpeg"/></div></div></figure><h2 id="71b2" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">LoRa收发器模块</h2><p id="6826" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">为了在包含嵌入式传感器的物联网设备和物联网网关之间传输物联网传感器数据，我使用了REYAX <a class="ae mh" href="http://reyax.com/products/rylr896/" rel="noopener ugc nofollow" target="_blank"> RYLR896 </a> LoRa收发器模块(<a class="ae mh" href="https://www.amazon.com/gp/product/B07NB3BK5H/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:19.50美元x 2)。收发器模块通常被称为<a class="ae mh" href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter" rel="noopener ugc nofollow" target="_blank">通用异步收发器</a> (UART)。UART是用于异步串行通信的计算机硬件设备，其中数据格式和传输速度是可配置的。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ny"><img src="../Images/906fda111b3159b55448ecf59a8a5d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w3XsklxiA1KZyqYPrNdtzg.jpeg"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">RYLR896模块连接到Arduino Sense(前台)和Raspberry Pi(后台)</figcaption></figure><p id="ce4d" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">根据制造商REYAX的说法，<a class="ae mh" href="http://reyax.com/products/rylr896/" rel="noopener ugc nofollow" target="_blank"> RYLR896 </a>包含<a class="ae mh" href="https://www.semtech.com/products/wireless-rf/lora-transceivers/sx1276" rel="noopener ugc nofollow" target="_blank"> Semtech SX1276 </a>远程低功耗收发器。RYLR896模块提供超长距离扩频通信和高抗干扰性，同时最大限度地降低功耗。该收发器工作在868和915 MHz频率范围。在本帖中，我们将以915兆赫向北美发送。每个RYLR896模块包含一个小型PCB集成螺旋天线。</p><h2 id="a396" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">安全性</h2><p id="82b5" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">RYLR896支持AES 128位数据加密。使用<a class="ae mh" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="noopener ugc nofollow" target="_blank">高级加密标准</a> (AES)，我们将使用32位十六进制数字密码(128位/ 4位/十六进制数字= 32位十六进制数字)对从物联网设备发送到物联网网关的数据进行加密。使用十六进制表示法，密码限于数字0-9和字符A-f。</p><h2 id="16fd" class="mi ku it bd kv mj mk dn kz ml mm dp ld lu mn mo lf ly mp mq lh mc mr ms lj mt bi translated">USB到TTL串行转换器适配器</h2><p id="72a7" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">或者，要直接从笔记本电脑上配置、测试和调试RYLR896 LoRa收发器模块，可以使用USB转TTL串行转换器适配器。我目前使用的是IZOKEE <a class="ae mh" href="https://www.ftdichip.com/Products/ICs/FT232R.htm" rel="noopener ugc nofollow" target="_blank"> FT232RL </a> FTDI USB转TTL串行转换器适配器模块，用于3.3V和5V ( <a class="ae mh" href="https://www.amazon.com/gp/product/B085XRMLT3/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>:2个9.49美元)。3.3V RYLR896模块使用TXD/TX、RXD/RX、VDD/VCC和GND引脚轻松连接到USB至TTL串行转换器适配器。我们使用<a class="ae mh" href="https://en.wikipedia.org/wiki/Serial_communication" rel="noopener ugc nofollow" target="_blank">串行通信</a>通过TX(发送)和RX(接收)引脚发送和接收数据。接线如下所示:VDD到VCC，GND到GND，TXD到RX，RXD到TX。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi nz"><img src="../Images/16157636c378e5b0502b9ec3b18c2abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q26RzO4eNHPb5HSLi4CpAg.png"/></div></div></figure><p id="1eb3" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">FT232RL支持高达115，200 bps的波特率，这是我们将用来与RYLR896模块通信的速度。</p><h1 id="7666" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">Arduino草图</h1><p id="c1af" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">对于那些不熟悉Arduino的人来说，一个<a class="ae mh" href="https://www.arduino.cc/en/tutorial/sketch" rel="noopener ugc nofollow" target="_blank">草图</a>是Arduino为一个程序使用的名字。它是上传到非易失性闪存并在Arduino板上运行的代码单元。Arduino语言是一组C和C++函数。所有由<a class="ae mh" href="https://linux.die.net/man/1/avr-g++" rel="noopener ugc nofollow" target="_blank"> avr-g++ </a>编译器支持的标准C和C++结构都应该可以在Arduino中工作。</p><p id="8b7a" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">对于本文，草图<a class="ae mh" href="https://github.com/garystafford/iot-lora-demo/blob/master/lora_iot_demo/lora_iot_demo.ino" rel="noopener ugc nofollow" target="_blank"> lora_iot_demo.ino </a>包含了使用LoRaWAN协议收集和安全传输环境传感器数据所需的所有代码，包括温度、相对湿度、气压、RGB颜色和环境光强度。这篇文章的所有代码，包括草图，可以在<a class="ae mh" href="https://github.com/garystafford/iot-lora-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oa ko l"/></div></figure><h1 id="812a" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">AT命令</h1><p id="d4da" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">与RYLR896远程调制解调器的通信是通过AT命令完成的。AT命令是用于控制调制解调器的指令。AT是ATtention的缩写。每个命令行都以“AT”开头。这就是为什么modem命令被称为at命令，据<a class="ae mh" href="https://www.developershome.com/sms/atCommandsIntro.asp" rel="noopener ugc nofollow" target="_blank">开发者之家</a>介绍。AT命令的完整列表可以从RYLR896产品页面以<a class="ae mh" href="http://reyax.com/wp-content/uploads/2020/01/Lora-AT-Command-RYLR40x_RYLR89x_EN.pdf" rel="noopener ugc nofollow" target="_blank"> PDF </a>格式下载。</p><p id="2302" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">为了有效地将环境传感器数据从物联网传感器传输到物联网网关，草图将传感器值串联成一个字符串。该字符串将包含在AT命令中，以向RYLR896 LoRa收发器模块发送数据。为了更容易解析物联网网关上的传感器数据，我们将使用竖线(|)来分隔传感器值，而不是逗号。有效载荷(<em class="mz">传感器数据</em>)的最大长度为240字节。</p><p id="2883" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">下面，我们将看到一个AT命令的示例，该命令用于发送来自物联网传感器的传感器数据以及物联网网关收到的相应未加密数据。两个字符串都包含LoRa发射器地址ID、有效载荷长度和有效载荷。物联网网关接收的数据还包含<a class="ae mh" href="https://en.wikipedia.org/wiki/Received_signal_strength_indication" rel="noopener ugc nofollow" target="_blank">接收信号强度指标</a> (RSSI)，以及<a class="ae mh" href="https://en.wikipedia.org/wiki/Signal-to-noise_ratio" rel="noopener ugc nofollow" target="_blank">信噪比</a> (SNR)。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ob"><img src="../Images/8f893de2868985f98502e65dd4e318cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8al2Z-RsYIZf1utHME3qw.png"/></div></div></figure><h1 id="f4ed" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">配置、测试和调试</h1><p id="c183" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">如前所述，要在不使用物联网网关的情况下配置、测试和调试RYLR896 LoRa收发器模块，可以使用USB转TTL串行转换器适配器。草图被加载到Arduino Sense ( <em class="mz">物联网设备</em>)上，并通过其中一个RYLR896模块主动传输数据(<em class="mz">显示在右下方</em>)。另一个RYLR896模块通过USB转TTL串行转换器适配器(左下方的<em class="mz">)连接到笔记本电脑的USB端口。使用终端和<a class="ae mh" href="https://linux.die.net/man/1/screen" rel="noopener ugc nofollow" target="_blank">屏幕</a>命令，或者Arduino桌面应用的<a class="ae mh" href="https://learn.sparkfun.com/tutorials/terminal-basics/arduino-serial-monitor-windows-mac-linux" rel="noopener ugc nofollow" target="_blank">串行终端</a>，我们可以从Arduino Sense接收传感器数据。</em></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ni"><img src="../Images/747dd09993bdc60f0c7ccfa11cdb35e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7QeLmw-WNdLbgVaorwnHg.jpeg"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">RYLR896模块连接到USB转TTL串行转换器适配器和Arduino Sense</figcaption></figure><p id="b2f0" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">使用笔记本电脑上的终端，我们首先需要定位正确的<a class="ae mh" href="https://en.wikipedia.org/wiki/Virtual_console" rel="noopener ugc nofollow" target="_blank">虚拟控制台</a> ( <em class="mz">又名虚拟终端</em>)。在Linux或Mac上，虚拟控制台由设备专用文件表示，如<code class="fe oc od oe of b">/dev/tty1</code>、<code class="fe oc od oe of b">/dev/tty2</code>等。要查找插入笔记本电脑的USB到TTL串行转换器适配器的虚拟控制台，请使用以下命令。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="5a4b" class="mi ku it of b gy ok ol l om on">ls -alh /dev/tty.*</span></pre><p id="9512" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">我们应该会看到一个名字类似于<code class="fe oc od oe of b">/dev/tty.usbserial-</code>的虚拟控制台。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="d02b" class="mi ku it of b gy ok ol l om on">... /dev/tty.Bluetooth-Incoming-Port<br/>... /dev/tty.GarysBoseQC35II-SPPDev<br/>... /dev/tty.a483e767cbac-Bluetooth-<br/>... <strong class="of iu">/dev/tty.usbserial-A50285BI</strong></span></pre><p id="b82b" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">为了使用虚拟终端通过USB到TTL串行转换器适配器连接到RYLR896模块，我们使用<code class="fe oc od oe of b">screen</code>命令并以115，200 bps的波特率连接。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="272a" class="mi ku it of b gy ok ol l om on">screen<strong class="of iu">/dev/tty.usbserial-A50285BI</strong> 115200</span></pre><p id="80be" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">如果一切都配置好并正常工作，我们应该会看到数据从Arduino Sense传输过来，并以5秒的间隔被本地机器接收。传输的每一行未加密数据将类似于下面的<code class="fe oc od oe of b">+RCV=116,25,22.18|41.57|99.74|2343|1190|543|4011,-34,47</code>。在下面的示例中，Arduino上尚未启用AES 128位数据加密。加密开启时，传感器数据(<em class="mz">有效载荷</em>)会出现乱码。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/76e5c01fb911a950c855402be063804d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z27b4TVpfjPrNWoFjOl8Bg.png"/></div></div></figure><p id="34ff" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">比<code class="fe oc od oe of b">screen</code>命令更简单的是，我们还可以使用Arduino桌面应用程序的串行终端，如以下简短的屏幕记录所示。从工具菜单中选择正确的端口(<em class="mz">虚拟控制台</em>)并打开串行终端。由于应使用AES 128位数据加密来保护传输的数据，我们需要发送包含收发器模块通用密码的AT命令(<code class="fe oc od oe of b">AT+CPIN</code>)，以在接收设备上正确解密数据(例如<code class="fe oc od oe of b">AT+CPIN=92A0ECEC9000DA0DCF0CAAB0ABA2E0EF</code>)。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oo ko l"/></div></figure><h1 id="7009" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">在物联网网关上接收数据</h1><p id="744e" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">Raspberry Pi将充当物联网网关，从物联网设备Arduino接收环境传感器数据。Raspberry Pi将运行一个Python 3脚本，<a class="ae mh" href="https://github.com/garystafford/iot-lora-demo/blob/master/python_scripts/rasppi_lora_receiver.py" rel="noopener ugc nofollow" target="_blank">rasppi _ lora _ receiver . py</a>，它将接收和解密数据有效载荷，解析传感器值，并在终端中显示这些值。该脚本使用了Python串行端口扩展<a class="ae mh" href="https://pypi.org/project/pyserial/" rel="noopener ugc nofollow" target="_blank"> pyserial </a>。这个Python模块封装了对串行端口的访问。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oa ko l"/></div></figure><p id="6b06" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">在运行Python脚本之前，我们可以使用一个通用应用程序，比如<a class="ae mh" href="https://en.wikipedia.org/wiki/Minicom" rel="noopener ugc nofollow" target="_blank"> Minicom </a>，测试和调试从Arduino Sense到Raspberry Pi的连接。Minicom是一个基于文本的调制解调器控制和终端仿真器程序。要在Raspberry Pi上安装Minicom，请使用以下命令。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="0078" class="mi ku it of b gy ok ol l om on">sudo apt-get install minicom</span></pre><p id="6d48" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">要运行Minicom或Python脚本，我们需要知道串行连接的虚拟控制台(脚本中的<code class="fe oc od oe of b">Serial1</code>),用于与RYLR896模块通信，连接到Raspberry Pi。这可以使用下面的命令找到。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="3fb0" class="mi ku it of b gy ok ol l om on">dmesg | grep -E --color 'serial|tty'</span></pre><p id="8537" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">搜索一行，类似于最后一行，如下所示。注意虚拟控制台的名称，在我的例子中是<code class="fe oc od oe of b">ttyAMA0</code>。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="8c0a" class="mi ku it of b gy ok ol l om on">[ 0.000000] Kernel command line: coherent_pool=1M bcm2708_fb.fbwidth=656 bcm2708_fb.fbheight=416 bcm2708_fb.fbswap=1 vc_mem.mem_base=0x1ec00000 vc_mem.mem_size=0x20000000 dwc_otg.lpm_enable=0 console=tty1 root=PARTUUID=509d1565-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles</span><span id="c685" class="mi ku it of b gy op ol l om on">[ 0.000637] console [tty1] enabled</span><span id="d019" class="mi ku it of b gy op ol l om on">[ 0.863147] uart-pl011 20201000.serial: cts_event_workaround enabled</span><span id="6d27" class="mi ku it of b gy op ol l om on">[ 0.863289] 20201000.serial:<strong class="of iu">ttyAMA0</strong> at MMIO 0x20201000 (irq = 81, base_baud = 0) is a PL011 rev2</span></pre><p id="8323" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">要使用Minicom查看从Arduino Sense接收的数据，请使用以下命令，替换上面找到的虚拟控制台值。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="145f" class="mi ku it of b gy ok ol l om on">minicom -b 115200 -o -D /dev/ttyAMA0</span></pre><p id="80a8" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">如果成功，我们应该会看到类似于右下角终端窗口的输出。Arduino Sense发送数据，Raspberry Pi通过LoRaWAN接收数据。在下面的示例中，Arduino上尚未启用AES 128位数据加密。在加密开启的情况下，传感器数据(<em class="mz">有效载荷</em>)会出现乱码。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/686841cf4b5110adc49c7750f1e5704b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BuY7-wnnwWfzL25E7_4eXA.png"/></div></div></figure><h1 id="ebcd" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">物联网网关Python脚本</h1><p id="3f46" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">要在Raspberry Pi上运行Python脚本，使用以下命令，替换虚拟控制台的名称(例如，<code class="fe oc od oe of b">/dev/ttyAMA0</code>)。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="8e1d" class="mi ku it of b gy ok ol l om on">python3 ./rasppi_lora_receiver.py \<br/>  --tty /dev/ttyAMA0 --baud-rate 115200</span></pre><p id="1339" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">该脚本首先配置RYLR896模块，并将配置输出到终端。如果成功，我们应该会看到以下信息输出。</p><pre class="ki kj kk kl gt og of oh oi aw oj bi"><span id="b008" class="mi ku it of b gy ok ol l om on">Connecting to REYAX RYLR896 transceiver module...</span><span id="cc4d" class="mi ku it of b gy op ol l om on">Address set? +OK<br/>Network Id set? +OK<br/>AES-128 password set? +OK<br/>Module responding? +OK</span><span id="9803" class="mi ku it of b gy op ol l om on">Address: +ADDRESS=116<br/>Firmware version: +VER=RYLR89C_V1.2.7<br/>Network Id: +NETWORKID=6<br/>UART baud rate: +IPR=115200<br/>RF frequency +BAND=915000000<br/>RF output power +CRFOP=15<br/>Work mode +MODE=0<br/>RF parameters +PARAMETER=12,7,1,4<br/>AES-128 password of the network +CPIN=92A0ECEC9000DA0DCF0CAAB0ABA2E0EF</span></pre><p id="74b8" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">配置完成后，脚本将从Arduino Sense接收数据，解密数据，解析传感器值，并在终端中格式化和显示这些值。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/1fc77dc779cf38667f29ef7a1c39197e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fcsyQQPJiUys3BbqMeO-7g.png"/></div></div></figure><p id="42e5" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">以下屏幕记录显示了Arduino串行监视器(<em class="mz">右上角窗口</em>)和Raspberry Pi终端输出(<em class="mz">右下角窗口</em>)的并行视图。Raspberry Pi ( <em class="mz">接收器</em>)从Arduino ( <em class="mz">发送器</em>)接收数据。Raspberry Pi成功读取、解密、解释和显示传感器数据，包括显示RGB和光强度传感器读数的色板。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="oo ko l"/></div></figure><h1 id="f7d1" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">结论</h1><p id="adee" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在本帖中，我们探讨了如何使用LoRa和LoRaWAN协议将环境传感器数据从物联网设备传输到物联网网关。鉴于其低能耗、长距离传输能力和完善的协议，LoRaWAN是物联网设备的理想远程无线协议。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="0676" class="pw-post-body-paragraph ll lm it ln b lo mu ju lq lr mv jx lt lu mw lw lx ly mx ma mb mc my me mf mg im bi translated">本博客代表我自己的观点，不代表我的雇主亚马逊网络服务公司的观点。</p></div></div>    
</body>
</html>