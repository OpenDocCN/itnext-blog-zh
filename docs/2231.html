<html>
<head>
<title>Virtual Kubelet and Managing IoT Edge Devices with Azure Kubernetes Service (AKS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">虚拟Kubelet和使用Azure Kubernetes服务(AKS)管理物联网边缘设备</h1>
<blockquote>原文：<a href="https://itnext.io/virtual-kubelet-and-managing-iot-edge-devices-with-azure-kubernetes-service-aks-97ad531e5ad8?source=collection_archive---------3-----------------------#2019-04-19">https://itnext.io/virtual-kubelet-and-managing-iot-edge-devices-with-azure-kubernetes-service-aks-97ad531e5ad8?source=collection_archive---------3-----------------------#2019-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/4ea7c7ab9853487212920e96a7ce3f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xw_iz0YFC_LIb97K57gxgA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟Kubelet和Azure物联网中心—连接边缘</figcaption></figure><div class=""/><p id="a9fe" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Virtual Kubelet是一个应用程序，它运行在当前集群中的一个容器内，并将自己伪装成一个节点。它通过Kubernetes API创建一个节点资源来实现这一点。然后，它会像实际的Kubelet一样监控预定的pod。这是事情开始不同的地方。虚拟Kubelet不是与主机和主机上的容器运行时交互，而是具有模块化的嵌入式后端，称为提供者。</p><p id="9b8b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每当pod生命周期事件发生时，核心Virtual Kubelet逻辑就调用提供者，以通知提供者它需要处理Pod的创建、更新、删除等。这为Kubernetes集群中的节点提供了多种可能的支持。提供者本身不需要担心注入配置图和秘密，或者实现协调循环来确定是否需要创建、更新或删除某些东西。这都是由Virtual Kubelet处理的，以尽可能无缝地实现提供者。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi la"><img src="../Images/17dceef0cbf5954d9ec05e8bce861eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ANWd4JZQDGIyftU3"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟库伯莱实现</figcaption></figure><h1 id="b49b" class="lf lg jf bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">AKS虚拟Kubelet实现</h1><p id="48fb" class="pw-post-body-paragraph kc kd jf ke b kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz ij bi translated">AKS虚拟节点建立在虚拟Kubelet之上。虚拟Kubelet的Azure容器实例提供程序将ACI实例配置为任何Kubernetes集群中的一个节点。当使用虚拟Kubelet ACI提供程序时，可以在ACI实例上安排pods，就好像ACI实例是标准的Kubernetes节点一样。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/a17f16c96c2f185675915e3be0acb855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/0*HMSRkrymjQ_7b1eV"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AKS虚拟Kubelet实现</figcaption></figure><p id="3888" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当对Azure容器实例使用虚拟Kubelet提供程序时，Linux和Windows容器都可以在容器实例上调度，就像它是一个标准的Kubernetes节点一样。这种配置允许您利用Kubernetes的功能以及容器实例的管理价值和成本优势。Azure容器实例(ACI)为在Azure中运行容器提供了一个托管环境。使用ACI时，不需要管理底层计算基础设施，Azure会为您处理这种管理。</p><p id="785f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，下面显示的三节点Kubernetes集群由三个物理节点(azure虚拟机)组成，并配置有Azure高级网络模式:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/650980ce59b85df5dc4bf6764de7aa83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-NLt90UT-MSJq0JD"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Azure上的AKS集群</figcaption></figure><p id="99c1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用户可以使用Azure CLI或Azure Portal来激活集群上的虚拟节点。该激活在集群上创建了一个虚拟Kubelet节点，如下所示:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mk"><img src="../Images/43f93f29def929dd85a8dbce19d3e90d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y8IJmauJjdXbwCsM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">激活AKS上的虚拟节点</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/b5ab13dfa3b032ca814915666aa6cc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q1OZxg7b5U2n2wcf"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AKS上的虚拟库伯莱</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mm"><img src="../Images/3168ba6d17bc9593186516524a8e0ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9nb6Wn2P-eNZggm6"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">注册为Pod的虚拟Kubelet</figcaption></figure><p id="4059" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，用于基于Linux的实例的Virtual-Kubelet pod被创建为一个pod，它被注册为Kubernetes集群中的一个节点。在清单中部署了一个带有特定节点选择器规范的示例应用程序，允许将工作负载部署在virtual-kubelet节点上。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/ef7086bcc5faea464d667f69595720c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NwQjpnsVRKnZC9Y7"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">节点选择器-在虚拟节点上部署</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/a4a2d4a29e7012800eb657ced4648116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-Dlslep5B43L-e9e"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟Kubelet节点上的pod，具有可公开访问的IP</figcaption></figure><p id="accd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，pod是在virtual-kubelet节点上创建的，高级网络会自动创建连接并为应用程序提供一个public_ip。这种配置允许用户利用Kubernetes的功能以及容器实例的管理价值和成本优势(按使用量收费)。</p><p id="0e69" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">同样被认为是Azure中的容器实例:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/761c90f825e753c2f39a2988e72160b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YQL7UWwiK0qnNBkK"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">容器实例— Azure</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/ae0b77be8b4e73a2eeb42c16f80b392a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bRozAF4TrkbqbzRs"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">容器实例</figcaption></figure><p id="6a70" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用户可以使用高级网络提供的public_ip像所有其他普通应用程序一样访问该应用程序。到目前为止，在虚拟kubelet中创建的pods不共享其他Kubernetes pods的网络空间。这意味着虚拟kubelet中的pods不能与其他节点上的pods对话，反之亦然。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/6a94fe7adfd974b43c2589d681e23686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vihz6Xat9CRI_GJ0"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">虚拟节点上的应用程序</figcaption></figure><p id="84eb" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">借助AKS虚拟节点，用户能够通过准确分配所需的额外容器数量，在几秒钟内对峰值负载做出响应，而不是等待其他基于虚拟机的节点运转。</p><h1 id="3d0c" class="lf lg jf bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">面向Kubernetes的Azure物联网边缘连接器</h1><p id="4051" class="pw-post-body-paragraph kc kd jf ke b kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz ij bi translated">Azure IoT Edge Connector利用Virtual Kubelet来提供由Azure IoT hub支持的虚拟Kubernetes节点。该连接器将Kubernetes对象(pod/deployment)规范转换为物联网边缘部署，并将其提交给后台物联网中心。简单来说，用户可以通过在Kubernetes上部署所需的代码来控制/部署到任何边缘站点。边缘部署包含设备选择器查询，该查询控制部署将应用到边缘设备的哪个子集。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/9bd682a36f5ef00befa6ebf1129d3e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2P2ShRPBSlzb6Elw"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">物联网边缘连接器实施</figcaption></figure><h1 id="b792" class="lf lg jf bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">说明</h1><p id="da2b" class="pw-post-body-paragraph kc kd jf ke b kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz ij bi translated">如下所示，一个名为“aks-iot”的“资源组”包含一个名为“k8s-iot-edge”的单节点AKS (Azure Kubernetes服务)Kubernetes集群和一个名为“k8s-iot-hub”的“IoT Hub”。</p><ol class=""><li id="7cd1" class="ms mt jf ke b kf kg kj kk kn mu kr mv kv mw kz mx my mz na bi translated">AKS Kubernetes单节点集群</li></ol><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/323f168c0d6490e6df9c07bf25247c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aBSWCGHNkWJe7iSf"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AKS单节点集群</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/fc85647cc05a551e8c74826cf0bd8041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0awpoXipQggZimkS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">蓝色库伯内特服务</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/6150ed50306f95fdfe3a3dff97a239a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OKefdPyB11cMMk-N"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AKS集群</figcaption></figure><p id="fd91" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.Azure物联网中心</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/545d95911d0eccc619a89c7da8051ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J1yDlzqOjhl4VImJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Azure物联网中心服务</figcaption></figure><p id="3d13" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如前所述，边缘连接器利用虚拟库伯勒，在这种情况下，边缘连接器本身是一个虚拟库伯勒节点，它使用连接字符串(连接密码)与上面创建的物联网集线器进行交互。</p><p id="a71c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.部署Azure物联网边缘连接器</p><p id="a1fc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下图所示，edge-connector作为一个pod部署在Kubernets集群上，该集群将自己注册为一个虚拟kubelet节点。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/e0a407a824736f4273880faf9020dc3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6vrwVUTZ8oI6R_UM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">物联网边缘连接器部署</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/b44027e47bcd8818d0359f966d37d5a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dkeBbh4j1OsrtVRZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">作为虚拟Kubelet对象的物联网边缘连接器部署</figcaption></figure><p id="fcdd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">edge-connector pod由两个容器“edgeprovider”和“virtualkubelet”本身组成，前者处理物联网集线器连接和转换。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/94a976e5f6ecb4b3193f29023a09c30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*53psqhRqPYFVFF9k"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">边缘容器——虚拟Kubelet和Edgeprovider</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/3eafb3e4e30781b724f8fb752a9b72d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8dD8250763afw2Q4"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">边缘容器—组件/容器</figcaption></figure><p id="69be" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“k8s-iot-hub”的连接字符串作为Kubernetes的秘密提供给edge-connector:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/e330ebfc1f62dbe813631ebe70dd04df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MJk2wEZmYVwgn10J"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">将边缘设备连接到Azure IoT的连接字符串</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/ce6232060fbd9813db0f93f75562a311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-XBiK-IY0vuiVknN"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上作为秘密的连接字符串</figcaption></figure><p id="6235" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.设置边缘设备</p><p id="bf5c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这个例子中，两个基于ARM的设备:一个树莓Pi Model-3和一个香蕉Pi M3被用作边缘设备。这两款设备都使用<a class="ae ni" href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-install-iot-edge-linux-arm" rel="noopener ugc nofollow" target="_blank"> Azure IoT Edge Runtime </a>和Docker来托管应用程序。这两块板具有互联网连接，它们可以通过iotedge.config文件中配置的连接字符串到达上面创建的Azure上的IoT Hub。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/8ddb04b6146dd776a264a40688f8bcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kkvlHIJjUv8YxSOQ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">边缘设备—树莓派和香蕉派</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/5f14b665e63447b557517ae7bcb3793f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lp8eE8mSe_2jLmEp"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">具有物联网边缘运行时的边缘设备</figcaption></figure><p id="ca70" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.向上面创建的k8s-IoT-hub注册设备</p><p id="b45b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用“设备id”创建设备标识，并为两个设备创建单独的标识字符串。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/a9baf45f71d5614cbbaf7ff3cc2e7afc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ckh9MhNcWj0AGrKA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">集线器设备身份创建</figcaption></figure><p id="b7f2" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些标识字符串是在“/etc/iotedge/config.yaml”中配置的:</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/83f983f74cb73f5394cf790e3069c61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Mmv5G96UMQ2t37F2"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">边缘设备配置</figcaption></figure><p id="afb6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">设备注册后，将在设备上安装一个edgeAgent，将设备与Azure IoT Hub联系起来。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/ece62c2b25aa5ef94d53d9d1ff21e7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VlP_ObK8ZNlNyyG7"/></div></div></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/b1f7cb9387e931f44b90fb1ebd1191ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_17LKqwmZNDAJrqe"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">将设备注册到物联网中心</figcaption></figure><p id="7aec" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.使用DeviceID部署到Raspberry-Pi和Banana-Pi</p><p id="8a19" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">示例温度传感器部署在AKS集群的两个边缘站点上，作为pod运行传感器应用程序</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/2bcf5464967934a6c47bd59405eea9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cp0H-dLhExCrK00F"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">从AKS-Kubernetes集群部署到边缘设备</figcaption></figure><p id="c03d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，温度传感器被部署到Raspberry-Pi设备上。一旦这被部署在Kubernetes上，由于清单具有容差和节点选择器集，应用程序将被调度到virtual-kubelet节点(iot-edge-connector-hub0)上，如下所示。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/c92ce97552c27e06dcabfbac67b1b9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8oZT_u6GYMBhG8Mm"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">温度传感器部署示例</figcaption></figure><p id="4cd7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，边缘连接器将活动传递给物联网集线器，物联网集线器进而旋转订阅了“k8s-iot-hub”的raspberry-pi设备上的温度传感器。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/e8a76d6ec2c56b52e643bbb9afe5e2e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wKEdcuAhOyCu2Wxq"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">部署在边缘设备上的应用</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/4ca48831e3e44c228e30b3fa62307e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Id2hOp2JIfHb8c1a"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">部署到边缘设备后显示模块的物联网中心</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/e764d9efd43aa2866ebd34793b2d164a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fI3m2dFOXz1gl5TO"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">物联网集线器上的温度传感器应用示例</figcaption></figure><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/fad432530415d750e01ff9b22314b54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j1fYxqOCY8v-UepH"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">物联网中心上显示的边缘设备</figcaption></figure><p id="660b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">类似地，可以在banana-pi上部署相同的应用程序，在部署规范中更改DeviceID。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/efaebb59dd670483efbc4a3a242dd298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E2BlXNkzSZw-CANh"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">在边缘设备上部署</figcaption></figure><p id="fb5c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，从AKS部署到远程edge_sites的温度传感器应用程序开始根据应用程序设置报告数据。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/fb51db888a0470cac6db73231ee0c5a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*isT0Vo8W-lI654FT"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">从边缘设备报告数据的温度传感器应用示例</figcaption></figure><p id="3071" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有基于Kubernetes的操作，如缩放副本、滚动更新、重新创建和升级，都可以在控制edge_site应用程序的资源上执行。这使得用户能够使用托管在AKS上的单个Kubernetes控制集群来管理和控制多个edge_sites。</p><p id="ee82" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi">*******************************************************************</p><p id="9daa" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Virtual-kubelet带来了巨大的好处，可以跨多个用例使用。Kubernetes环境可以管理多个物联网中心，保持云和边缘软件配置之间的一致性，以及跨不同地理位置的边缘站点的无缝部署。除了物联网之外，带有ACI连接器的virtual-kubelet还可以极大地有益于其他使用情形，例如运行批处理作业——最大限度地降低硬件要求、CI/CD——基于大量提交日的自动扩展、无服务器、突发——自动扩展等。</p><p id="8a26" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当然还有一些有争议的挑战，如网络空间(虚拟kubelet不共享其他kubernetes pods的网络空间)和互操作性(kubectl exec等kube TL命令不能在虚拟kubelet创建的pods上工作)。尽管存在现阶段的不足，但虚拟kubelet是一个很棒的项目，潜力巨大。</p></div></div>    
</body>
</html>