<html>
<head>
<title>Meet NebulaGraph VEditor, an Open-Source Graph Editing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">见见NebulaGraph VEditor，一个开源的图形编辑库</h1>
<blockquote>原文：<a href="https://itnext.io/meet-nebulagraph-veditor-an-open-source-graph-editing-library-626521549ffb?source=collection_archive---------2-----------------------#2022-12-01">https://itnext.io/meet-nebulagraph-veditor-an-open-source-graph-editing-library-626521549ffb?source=collection_archive---------2-----------------------#2022-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/11136c5380d4e9ab61d177af246a819b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwhujQInMRj1VK9Rc_D02A.jpeg"/></div></div></figure><p id="be20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">NebulaGraph VEditor是一个高性能、高度可定制的所见即所得可视化编辑前端库，由NebulaGraph数据库团队开发。NebulaGraph VEditor基于SVG绘图，通过合理抽象代码结构，易于开发和定制绘图。它非常适合WYSIWYG编辑和预览场景，如审批流、工作流、亲属关系、ETL处理和图形查询。您可以使用VEditor可视化地查询、编辑和建模图形。</p><p id="d6e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过不断的迭代和打磨，VEditor已经相对完善，现在其代码已经开源。在这个话题中，我想分享一些关于它的设计的想法和思考。</p><h1 id="d700" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">基本特征</h1><ul class=""><li id="7a53" class="lu lv iq ka b kb lw kf lx kj ly kn lz kr ma kv mb mc md me bi translated">可定制的节点和边缘样式。</li><li id="6f98" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">扁平、简单、清晰的代码结构。</li><li id="0fa2" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">小地图和磁力线。</li><li id="9bbc" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">常见操作的快捷方式。</li><li id="87c4" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">历史管理。</li><li id="fdcd" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">轻量级，压缩前大小只有160 KB。</li></ul><h1 id="c8b4" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设计理念</h1><p id="7d09" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">当我第一次碰到图形编辑器库的时候，我只是想找一个用于定制和动画的。用了很多流程图库，发现大部分设计都有臃肿的接口和复杂的类。作为一名前端开发人员，这违背了我编写简单、精简、低耦合代码的理念。所以我决定自己写一个轻量级的库来满足我的需求。</p><p id="44d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">VEditor的设计理念是让开发者使用起来更轻便，减少学习API，减少对基于可定制性和可理解性的各种库的依赖。</p><h1 id="c197" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">体系结构</h1><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/bfc8931ebecf741ab42643c23c08c6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*e7jllVH5CtqF0FqZ.png"/></div></div></figure><p id="50d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">整体架构主要是通过事件来做实体间的依赖管理，也建议主要通过事件来获取整个流程图的状态变化。</p><p id="4705" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中渲染过程为半自动渲染，更改流程图数据后需要手动触发渲染。画布上的其他状态操作将触发用户定义的形状渲染函数来渲染节点和线条。</p><h1 id="37cd" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">渲染过程</h1><p id="b09d" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">VEditor使用SVG来渲染画布。SVG的声明式使用使得内部结构对外可见，方便开发者自定义渲染。用户可以在外部直接重写相关的SVG样式，并可以直接使用SVG DOM(文档对象模型)来操纵鼠标事件和动画节点。</p><p id="8ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在形状渲染方面，用户自定义的渲染函数主要通过暴露的形状接口进行注册。从这个角度来看，VEditor可以基于任何呈现技术执行呈现，只要呈现接口返回一个SVGDOM，它可以是SVGElement或ForeignObject。我强烈推荐通过DOM框架管理SVC渲染，比如React和Vue。在某些情况下，您甚至可以包装画布来呈现WebGL节点，这极大地扩展了可定制性。</p><p id="6e4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了节点之外，节点锚点和线也支持相应的接口注册为Shape后的对象渲染。在实际的业务场景中，我们使用这个特性来实现算法参数锚的动态添加、删除和更改，OLTP查询的输入和输出锚(图1)，图形可视化中的边过滤，以及步骤呈现(图2)。欢迎您申请Explorer免费试用。只需点击<a class="ae ms" href="https://nebula-graph.com.cn/products/explorer/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/0fb7eda786b0f3acf40425eaf6ba2ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-KGVculGZtNra1js.png"/></div></div></figure><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/93c5168b6236c874a57bbdde3fc7719e.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*QewbInNZamTwiNDj.png"/></div></figure><h1 id="8689" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据结构设计</h1><p id="fa2e" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">VEditor的数据结构与大多数库类似，但不会破坏用户的对象引用，即当用户将相关数据挂载到节点或线对象时，会对其进行对齐和保留，这样在配置完顶点或边后，将方便用户将相关数据挂载到顶点。因此，重做、撤消等。对历史的操作会将用户的数据存储为快照。</p><h1 id="6260" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">性能设计</h1><p id="5eba" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">众所周知，对于小分辨率的渲染，SVG的性能比Canvas差得多，这是随着易用性的提高而带来的一个缺点。这在初始化大量更复杂或动画节点时尤其明显。为了解决这种情况，VEditor的数据呈现部分使用异步过程，将锚点的呈现放入下一个事件循环中，以避免在同步过程中获取大量边界框导致的浏览器强制重绘。绘制完成后，缓存相应的节点，避免重复取数。</p><p id="5dc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在添加节点或线条时，SVG的DOM特性会让浏览器自动做脏渲染，所以增量渲染的性能和Canvas差别不大，主要是交互和动画时比较慢，导致大量的DOM重绘。当前的设计性能目标是1000个具有复杂形状的节点以实现平滑渲染，这在流程图编辑场景中很容易实现。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/3afe2cb3f4f81c47d942824796daf849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tn-3bAYMDP-RlplB.jpeg"/></div></div></figure><h1 id="0d1b" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">交互设计</h1><p id="e342" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">默认情况下，VEdtior提供基于Dagre的有向图布局。在优化和调用Dagre后，它会自动将所有节点居中。同时，它提供了一个自适应的大小函数。与其他库不同，当前节点的坐标会被重置到自适应位置，用户保存当前数据后可以直接恢复自适应位置。</p><p id="213e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">VEditor的小地图采用画布渲染，直接将SVG转换为画布，在保证小地图精度的同时降低了性能损失。在交互方面，VEditor允许你放大和缩小画布，拖放元素。</p><h1 id="709e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">未来计划</h1><p id="52c6" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">通过扩展它可以使用的场景，VEditor有望成为任何领域的数据编辑器和渲染器。此外，我们将继续改进VEditor的性能和用户体验，同时在未来支持以下功能。</p><ul class=""><li id="3076" class="lu lv iq ka b kb kc kf kg kj mu kn mv kr mw kv mb mc md me bi translated">框选择器和多选操作。</li><li id="7128" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">无向图和双箭头</li><li id="9db6" class="lu lv iq ka b kb mf kf mg kj mh kn mi kr mj kv mb mc md me bi translated">进一步的性能优化</li></ul><p id="c3aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">👉GitHub开源地址:<a class="ae ms" href="https://github.com/vesoft-inc/nebulagraph-veditor" rel="noopener ugc nofollow" target="_blank">https://github.com/vesoft-inc/nebulagraph-veditor</a></p><h1 id="7b83" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">你可能也喜欢</h1><p id="ecd8" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated"><a class="ae ms" href="https://www.nebula-graph.io/products/explorer" rel="noopener ugc nofollow" target="_blank">图形数据库可视化:星云图探索者</a></p></div></div>    
</body>
</html>