<html>
<head>
<title>Deploy a NodeJS and ExpressJS App on Digital Ocean with NGINX and Free SSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NGINX和免费SSL在数字海洋上部署NodeJS和ExpressJS应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-a-nodejs-and-expressjs-app-on-digital-ocean-with-nginx-and-free-ssl-edd88a5580fa?source=collection_archive---------1-----------------------#2019-10-05">https://itnext.io/deploy-a-nodejs-and-expressjs-app-on-digital-ocean-with-nginx-and-free-ssl-edd88a5580fa?source=collection_archive---------1-----------------------#2019-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f1fcaeb283108d48f5cc296c452c0883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0q-a6BpgQd26NT918n9dA.jpeg"/></div></div></figure><p id="2c67" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">与Heroku不同，在Heroku中，舞台已经为您搭建好了，您只需推送您的本地Git存储库，数字海洋是一个基础设施即服务。换句话说，数字海洋要求您手动配置和维护虚拟化服务器。然而，这带来了很大的灵活性和自由度。DigitalOcean以其高性能服务器而闻名。他们所有的云服务器都是基于固态硬盘的，启动时间只有55秒！</p><p id="42b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">今天，我们将看看如何使用<strong class="kd iu"> NGINX </strong>作为反向代理，在<strong class="kd iu">数字海洋水滴</strong>上部署<strong class="kd iu"> NodeJS </strong>和<strong class="kd iu"> ExpressJS </strong>应用程序。我们还将在我们的应用程序上设置一个免费的加密SSL证书。这听起来确实令人不知所措，但是我们将详细介绍每一个步骤。我们开始工作吧！</p><h1 id="31fb" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">NodeJS和ExpressJS应用程序概述</h1><p id="0ea9" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在本文中，我们将部署一个简单的NodeJS和ExpressJS应用程序，该应用程序只有一个用简单的HTML文件响应GET请求的路由。您可以在这里 克隆包含项目文件<a class="ae mc" href="https://github.com/abdamin/NodeJS_Deploy_To_DigitalOcean_Tutorial" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">的Github资源库。或者随意使用您自己的项目来遵循这个逐步指南。这就是我们的<strong class="kd iu"> server.js </strong>文件的样子，</strong></a></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0186" class="mm la it mi b gy mn mo l mp mq"><em class="mr">const</em> express = require("express");</span><span id="153b" class="mm la it mi b gy ms mo l mp mq"><em class="mr">const</em> app = express();</span><span id="b848" class="mm la it mi b gy ms mo l mp mq"><em class="mr">const</em> path = require("path");</span><span id="6aeb" class="mm la it mi b gy ms mo l mp mq">app.get("/", (<em class="mr">req</em>, <em class="mr">res</em>) <em class="mr">=&gt;</em> {</span><span id="0b7b" class="mm la it mi b gy ms mo l mp mq">return res.sendFile(path.join(__dirname + "/index.html"));</span><span id="1948" class="mm la it mi b gy ms mo l mp mq">});</span><span id="b9ac" class="mm la it mi b gy ms mo l mp mq"><em class="mr">const</em> PORT = process.env.PORT || 5000;<br/></span><span id="2933" class="mm la it mi b gy ms mo l mp mq">app.listen(PORT, () <em class="mr">=&gt;</em> <em class="mr">console</em>.log(`Server Running on Port ${PORT}`));</span></pre><h1 id="1d89" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设置您的数字海洋水滴</h1><h2 id="ab18" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">在数字海洋上注册</h2><p id="1ed3" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">如果您没有数字海洋帐户，您可以使用此<a class="ae mc" href="https://m.do.co/c/cf15c44eab86" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">链接</strong> </a>进行注册，以获得<strong class="kd iu">50美元的免费信用。</strong></p><h2 id="06a8" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">Droplet设置</h2><p id="707e" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">第一步——进入你的<a class="ae mc" href="https://cloud.digitalocean.com/projects/d0aedabc-1796-4ebe-8dbf-3fef3f6659c9/resources?i=798ce5" rel="noopener ugc nofollow" target="_blank">数字海洋仪表盘</a>并选择<strong class="kd iu">水滴。</strong></p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/383a9b816a1e3c1c924c2f237d760541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO14ikOJ_-jQLIMNpu--9g.png"/></div></div></figure><p id="0fd6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第二步——选择一幅图像和一个计划。</p><p id="6dda" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">出于本文的考虑，我们将选择<strong class="kd iu"> Ubuntu 18.04.3 (LTS) x64 </strong>作为我们的发行版，并为<strong class="kd iu"> $5/mo </strong>选择一个<strong class="kd iu">标准</strong>计划<strong class="kd iu"> </strong>。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/e7f1f35f139176eacf99aa537223da0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIW-0tV3HcX3qgCIUKWGNQ.png"/></div></div></figure><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/8b61b0efbeef71951fd14ada60f450b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6KvBH3cxSpuziBXdcKlqfA.png"/></div></div></figure><p id="ecf0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">步骤3-选择数据中心区域。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/5c373b0a8760983f2668a057d60334db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKzpfC4tyhJX7hYuCv_saA.png"/></div></div></figure><p id="644a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">步骤4 —选择身份验证方法并生成SSH密钥</p><p id="a3c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用<strong class="kd iu"> SSH密钥</strong>来认证并连接到我们的Droplet。如果您没有配置SSH密钥，请选择<strong class="kd iu">新SSH密钥</strong>选项。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/3a1c4c37a0d3681393d7a66b23db6f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HkTeZI53rmc85nSO7n82bg.png"/></div></div></figure><p id="6f3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在终端上使用以下命令生成SSH密钥，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="21e0" class="mm la it mi b gy mn mo l mp mq">ssh-keygen</span></pre><p id="bac7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后将提示您保存并命名该项，如下所示，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a019" class="mm la it mi b gy mn mo l mp mq">Generating public/private rsa key pair. Enter file in which to save the key (/Users/USER/.ssh/id_rsa):</span></pre><p id="7e87" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击<strong class="kd iu">回车或返回</strong>键。</p><p id="8e44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，将要求您创建并确认密钥的密码，如下所示。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="54d7" class="mm la it mi b gy mn mo l mp mq">Enter passphrase (empty for no passphrase): <br/>Enter same passphrase again:</span></pre><p id="5c2f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将生成两个文件，默认情况下名为<code class="fe nf ng nh mi b">id_rsa</code>和<code class="fe nf ng nh mi b">id_rsa.pub</code>。</p><p id="30e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获取您的。pub文件在您的终端中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="cd3a" class="mm la it mi b gy mn mo l mp mq">cat ~/.ssh/id_rsa.pub</span></pre><p id="0379" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制并粘贴您的。在droplet的SSH设置中，命名您的公共SSH密钥并选择<strong class="kd iu">添加SSH密钥</strong>。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/b55659b429a4e4c99989ff810e21f128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bFyDoMXoJdnJsqwm67Bx0A.png"/></div></div></figure><p id="9dfa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">步骤5-为您的Droplet选择一个主机名</p><p id="5c9b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的例子中，我们将其命名为<strong class="kd iu">节点-部署-教程</strong>。随便选个名字。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/039fecdf3b4065a82ab2b4732dec9450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1YE6snUMfYp7h4fti4GSA.png"/></div></div></figure><p id="c9cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将让其余的配置保持默认设置。现在向下滚动并选择<strong class="kd iu">创建水滴。</strong></p><p id="ebf3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的服务器现在已经启动并运行在web上了！</p><h1 id="60e0" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">连接到您的Droplet</h1><p id="1407" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">如前所述，我们将使用<strong class="kd iu"> SSH密钥</strong>连接到我们的Droplet。出于本文的考虑，我们使用根用户<strong class="kd iu">来连接。<em class="mr">(但是，建议您创建一个新用户。)</em></strong></p><p id="536f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在项目的“资源”部分拷贝droplet的公共IP。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/c63fad322ad2a3e5ddc51aab552d8660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SXwuxvTm8ybcFYB5HMWN-A.png"/></div></div></figure><p id="d092" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在您的终端中运行以下命令来连接到您的Droplet，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d675" class="mm la it mi b gy mn mo l mp mq">ssh root@yourpublicipaddress</span></pre><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/189e93b94f1f47497b4c9489c6c6c9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jqj24JFhGR_x-i2mV4yWCw.png"/></div></div></figure><p id="d391" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你现在已经成功地<strong class="kd iu"> SSH到了你的Ubuntu服务器/Droplet！</strong></p><h1 id="92bb" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设置您的服务器</h1><h2 id="b7b1" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">设置节点</h2><p id="63b1" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器的终端中运行以下命令来设置NodeJS，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="561b" class="mm la it mi b gy mn mo l mp mq">curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -<br/><br/>sudo apt install nodejs<br/><br/>node --version</span></pre><h2 id="98d2" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">设置您的项目</h2><p id="86e4" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器的终端中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="702e" class="mm la it mi b gy mn mo l mp mq">sudo mkdir app</span><span id="e2ba" class="mm la it mi b gy ms mo l mp mq">cd app</span><span id="59a2" class="mm la it mi b gy ms mo l mp mq">sudo git clone https://github.com/abdamin/NodeJS_Deploy_To_DigitalOcean_Tutorial.git</span></pre><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/2044b1bce1a089803887a2faed6592d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bBVphF7pVXHJmlxol55fyg.png"/></div></div></figure><p id="2221" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意，这是我们的示例NodeJS和ExpressJS应用程序的Github存储库URL。如果您正在部署自己的应用程序，那么在使用clone命令时，您将使用自己的存储库URL。</p><p id="48e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们将使用以下命令安装项目依赖项，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3bbb" class="mm la it mi b gy mn mo l mp mq">cd {{your cloned repository’s name}}</span><span id="114f" class="mm la it mi b gy ms mo l mp mq">npm install</span></pre><h2 id="97f4" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">设置PM2</h2><p id="0ba8" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">注意，我们不会使用<strong class="kd iu"> <em class="mr"> npm start </em> </strong>命令来运行我们的应用程序。相反，我们使用PM2，这将允许我们的应用程序在后台运行。</p><p id="644d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在您的服务器终端上运行以下命令以全局安装PM2，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="057c" class="mm la it mi b gy mn mo l mp mq">npm install pm2 -g</span></pre><p id="2271" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要使用PM2运行您的应用程序，请在项目目录中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4390" class="mm la it mi b gy mn mo l mp mq">pm2 start server.js</span></pre><p id="0f8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意,<strong class="kd iu"> server.js </strong>是我们应用程序端点的名称。如果您的项目有一个不同的端点，请确保用您的端点名称替换上面命令中的<strong class="kd iu"> server.js </strong>。</p><p id="cd03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要确保PM2在我们的Droplet重启时重启，请在您的服务器终端运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="858d" class="mm la it mi b gy mn mo l mp mq">pm2 startup ubuntu</span></pre><h2 id="0c07" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">防火墙设置</h2><p id="db55" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">运行以下命令来启用防火墙，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b9ad" class="mm la it mi b gy mn mo l mp mq">sudo ufw enable</span></pre><p id="5393" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，你需要配置防火墙来允许<strong class="kd iu"> HTTP，HTTPS </strong>和<strong class="kd iu"> SSH </strong>访问。在服务器的终端中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5d0e" class="mm la it mi b gy mn mo l mp mq">sudo ufw allow http</span><span id="283c" class="mm la it mi b gy ms mo l mp mq">sudo ufw allow https</span><span id="48c7" class="mm la it mi b gy ms mo l mp mq">sudo ufw allow ssh</span></pre><h2 id="54f5" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">设置NGINX</h2><p id="ea1e" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在我们需要安装NGINX来为我们的应用程序配置一个反向代理。</p><p id="a56a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在服务器的终端上运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="13c3" class="mm la it mi b gy mn mo l mp mq">sudo apt install nginx</span></pre><h2 id="d6f5" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">用NGINX链接您的项目</h2><p id="e9a7" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器的终端上运行以下命令，使用Vim打开默认文件，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a4a7" class="mm la it mi b gy mn mo l mp mq">sudo vim /etc/nginx/sites-available/default</span></pre><p id="8a7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您以前没有使用过<strong class="kd iu"> Vim </strong>，请查看关于基本Vim命令的<a class="ae mc" href="https://linuxhandbook.com/basic-vim-commands/" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><p id="118c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在嵌套在<strong class="kd iu">服务器</strong>块中的<strong class="kd iu">位置</strong>块中，删除以下代码行:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c5d8" class="mm la it mi b gy mn mo l mp mq">try_files $uri $uri/ = 404;</span></pre><p id="1335" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，在位置块<strong class="kd iu">中添加以下代码行(使用您的应用程序端口号编辑占位符文本)</strong>，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b3f2" class="mm la it mi b gy mn mo l mp mq"><br/>proxy_pass <a class="ae mc" href="http://localhost:5000;" rel="noopener ugc nofollow" target="_blank">http://localhost:</a>{{YOUR-APP-PORT-IN-YOUR-CODE}}<a class="ae mc" href="http://localhost:5000;" rel="noopener ugc nofollow" target="_blank">;</a> <br/>proxy_http_version 1.1;<br/>proxy_set_header Upgrade $http_upgrade;<br/>proxy_set_header Connection 'upgrade';<br/>proxy_set_header Host $host;<br/>proxy_cache_bypass $http_upgrade;<br/>   </span></pre><p id="0f74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，如果您想要成功地为您的应用程序配置一个SSL证书(我们将在稍后完成)并添加一个自定义域，不要忘记在服务器块内部和位置块之前添加以下代码行。为了本文，我们将使用自定义域<a class="ae mc" href="http://abdullahsumsum.com" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu"/></a><strong class="kd iu"/>。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="79c9" class="mm la it mi b gy mn mo l mp mq">server_name abdullahsumsum.com www.abdullahsumsum.com;</span></pre><p id="d58f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">确保通过按下<strong class="kd iu"> esc </strong>键保存文件，然后键入<strong class="kd iu"> :wq </strong>，然后按下<strong class="kd iu"> return </strong>键保存并关闭vim编辑器。</p><p id="022e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是我们的默认文件中的<strong class="kd iu">服务器块在做了上述更改后的样子，</strong></p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/d01f0d12912fb2c666bf02bf823b56f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6oPoiczu5tW3trX8uXjP4w.png"/></div></div></figure><h2 id="86af" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">运行NGINX</h2><p id="3586" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器的终端中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="fa59" class="mm la it mi b gy mn mo l mp mq">sudo nginx -t</span><span id="0fc8" class="mm la it mi b gy ms mo l mp mq">sudo service nginx restart</span></pre><p id="d141" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您现在应该能够通过在浏览器上键入您的公共IP来访问您的应用程序了！</p><h1 id="11c8" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">自定义域设置</h1><h2 id="0e47" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">将自定域添加到您的Droplet</h2><p id="b396" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">步骤1 —转到<strong class="kd iu">联网</strong>部分。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/72d074a36b39b70ed9583ae533ca8eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dZq4XeNV305AxOjPqAFNA.png"/></div></div></figure><p id="0d78" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">步骤2 —输入域名</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/c87e7da5a831fc8875d4d778737d2ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7zr5UYdIyKZA7dmndudEw.png"/></div></div></figure><p id="11af" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">步骤3 —为您的自定义域添加记录</p><p id="2fe2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">添加两条主机名为<strong class="kd iu"> @ </strong>和<strong class="kd iu"> www </strong>的A记录</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/980a6bf333700bf3decb1674c046536b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzUGAldyX8Sy5ySUe0iHFw.png"/></div></div></figure><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/6389158b88420839cbe9da11a163f721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6uNn6BYxW3jsxTDYaGqNg.png"/></div></div></figure><h2 id="2dac" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">域注册表配置</h2><p id="d656" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我个人更喜欢用<a class="ae mc" href="https://www.shareasale.com/r.cfm?u=2198460&amp;m=46483&amp;b=518798" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> NameCheap </strong> </a>作为我的域名注册商。如果您正在使用Namecheap，您可以使用此<a class="ae mc" href="https://www.shareasale.com/u.cfm?d=491929&amp;m=46483&amp;u=2198460" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">链接</strong> </a>访问他们的最新促销优惠。但是，您可以使用任何注册服务商来遵循本指南。基本上，你所要做的就是配置你的域名指向数字海洋域名服务器。</p><p id="c17e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您需要在DNS管理器中添加以下3个名称服务器，</p><ul class=""><li id="d3c0" class="nl nm it kd b ke kf ki kj km nn kq no ku np ky nq nr ns nt bi translated"><strong class="kd iu">ns1.digitalocean.com</strong></li><li id="1568" class="nl nm it kd b ke nu ki nv km nw kq nx ku ny ky nq nr ns nt bi translated"><strong class="kd iu">ns2.digitalocean.com</strong></li><li id="c385" class="nl nm it kd b ke nu ki nv km nw kq nx ku ny ky nq nr ns nt bi translated">【ns3.digitalocean.com T42】</li></ul><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/d7952aa316646023bfd862b4428e18d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34jGAA_DfySlpHKw49jekA.png"/></div></div></figure><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/0f42c865ca89b6fdb4adbfedcb5102f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhlBGhgrjjXaCE6L9I7T3Q.png"/></div></div></figure><p id="8547" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，传播更改可能需要48小时。然而，这通常需要5-10分钟。</p><p id="cccd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您应该能够使用自定义域名访问您的应用程序了！</p><h1 id="ed1c" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">SSL证书设置</h1><p id="b78e" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们将使用<strong class="kd iu"> Cerbot </strong>为我们的应用程序建立一个<strong class="kd iu">免费的加密</strong> <strong class="kd iu"> SSL证书</strong>。我们还将配置它，以确保它在90天到期后自动续订。</p><h2 id="73b0" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">设置Cerbot</h2><p id="206a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器终端运行以下命令来设置<strong class="kd iu"> cerbot、</strong></p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="3984" class="mm la it mi b gy mn mo l mp mq">sudo add-apt-repository ppa:certbot/certbot</span><span id="8fd9" class="mm la it mi b gy ms mo l mp mq">sudo apt-get update</span><span id="6641" class="mm la it mi b gy ms mo l mp mq">sudo apt-get install python-certbot-nginx</span></pre><h2 id="e152" class="mm la it bd lb mt mu dn lf mv mw dp lj km mx my ln kq mz na lr ku nb nc lv nd bi translated">为您的自定义域颁发证书</h2><p id="72f4" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">在服务器终端中使用您的自定义域名运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5e78" class="mm la it mi b gy mn mo l mp mq">sudo certbot --nginx -d customdomain.com -d www.customdomain.com</span></pre><p id="c1aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后会提示您选择是否要将所有请求重定向到安全HTTPS。在终端中键入<strong class="kd iu"> 2 </strong>将所有请求重定向到HTTPS。否则键入<strong class="kd iu"> 1。</strong></p><p id="2aae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">设置自动续订</strong></p><p id="9e40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于我们的证书每90天过期一次，我们将不得不生成一个脚本来自动更新我们的证书。在服务器的终端中运行以下命令，</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="afc1" class="mm la it mi b gy mn mo l mp mq">certbot renew --dry-run</span></pre><h1 id="185f" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="9518" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">您的NodeJS项目现在已经成功部署了！您应该能够通过安全的SSL连接访问您的Web应用程序！</p><p id="d50d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您有任何问题，请随时发表评论。此外，如果这帮助了你，请喜欢并与他人分享。我定期发表与web开发相关的文章。考虑<a class="ae mc" href="http://abdullahsumsum.com/subscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">在此输入您的电子邮件地址</strong> </a>以便及时了解与web开发相关的文章和教程。你也可以找到更多关于我在abdullahsumsum.com<a class="ae mc" href="http://abdullahsumsum.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu"/></a>所做的事情</p></div></div>    
</body>
</html>