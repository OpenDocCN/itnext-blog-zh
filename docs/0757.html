<html>
<head>
<title>A local Kubernetes with microk8s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个当地的Kubernetes与microk8s</h1>
<blockquote>原文：<a href="https://itnext.io/a-local-kubernetes-with-microk8s-33ee31d1eed9?source=collection_archive---------1-----------------------#2018-05-22">https://itnext.io/a-local-kubernetes-with-microk8s-33ee31d1eed9?source=collection_archive---------1-----------------------#2018-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="be43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我想测试Kubernetes清单或尝试一些新东西时，我遇到的一个常见问题是，要么创建一些LXC机器，启动云实例，要么启动一个虚拟机，然后安装Kubernetes。对我来说，这变成了一个耗时的仪式，没有一个选项可以提供真正快速、经济高效的Kubernetes集群。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/aaff17aadc4d676943edae8908e62e76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*6AJKLT9WXrVBTlLLGhdJbw.jpeg"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">利弊</figcaption></figure><p id="7b1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在后续的帖子中，我将概述GKE、AKS、EKS、CDK、CDK与LXD、kubeadm、minikube、microk8s和其他项目之间的差异，以帮助强调该项目在任何给定工作流中的最佳位置。与此同时，我想快速分享如何开始，以便您可以得出自己的结论:)</p><p id="d6c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还在这篇文章的底部添加了一些常见的故障排除问题，如果你卡住了！</p><h1 id="62af" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是microk8s？</h1><p id="6d21" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">简而言之，microk8s被设计成一个快速、轻量级的上游Kubernetes安装，与您的主机隔离，但不通过虚拟机。这种隔离是通过将Kubernetes、Docker.io、iptables和CNI的所有上游二进制文件打包在单个<a class="ae ma" href="https://snapcraft.io" rel="noopener ugc nofollow" target="_blank"> snap包</a>中实现的。snap包是一个应用程序容器——您可以把它想象成Docker容器的一个轻量级版本。它使用许多相同的底层隔离技术，但没有网络隔离的所有开销。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/a3c6dd198854dd1fb24c21a610c7c54b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRP9o_Ncmk0xl79fO0RYbw.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">microk8s是Kubernetes，本地安装！</figcaption></figure><p id="6149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终结果是一个超越任何一个发行版的软件包格式，因为快照可以安装在大多数Linux操作系统上，同时还利用了原子更新、升级失败时的回滚等功能，并提高了用户主机对软件的限制级别。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/9f7084230ea929e4f2a943cf66162d5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wf_pjSnDzuwFILDiatadjQ.png"/></div></div></figure><p id="722c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过以这种方式安装microk8s，您能够在本地机器上生成最新的上游Kubernetes的干净部署，而没有什么麻烦或开销。</p><h1 id="b9ae" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我如何开始？</h1><p id="461a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">目前我只在Fedora 28、Ubuntu 16.04和Ubuntu 18.04上测试过这个。虽然更多的操作系统支持<a class="ae ma" href="https://docs.snapcraft.io/core/install" rel="noopener ugc nofollow" target="_blank">快照</a>，但您在这些操作系统上的体验可能会有所不同。</p><h2 id="ea4a" class="mh ky iq bd kz mi mj dn ld mk ml dp lh jy mm mn ll kc mo mp lp kg mq mr lt ms bi translated">Fedora 28</h2><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="c5af" class="mh ky iq mu b gy my mz l na nb">sudo dnf install snapd<br/>sudo ln -s /var/lib/snapd/snap /snap</span></pre><h2 id="139f" class="mh ky iq bd kz mi mj dn ld mk ml dp lh jy mm mn ll kc mo mp lp kg mq mr lt ms bi translated">Ubuntu 16.04</h2><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="7be0" class="mh ky iq mu b gy my mz l na nb">sudo apt update<br/>sudo apt install snapd</span></pre><h2 id="3ea4" class="mh ky iq bd kz mi mj dn ld mk ml dp lh jy mm mn ll kc mo mp lp kg mq mr lt ms bi translated">Ubuntu 18.04</h2><p id="f8fa" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Snap是预装的！</p><h1 id="894f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安装microk8s</h1><p id="702a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">microk8s通过一个命令作为单个快照安装。在这篇博文发表的时候，它需要“经典的”坐月子。就快照而言，这意味着快照可以到达比正常情况下主机上更多的位置。这是一个临时措施，用于解决Docker修改某些内核级杠杆的需求。上游公司正努力使快照符合严格的限制。</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="6d8a" class="mh ky iq mu b gy my mz l na nb">sudo snap install microk8s --beta --classic</span></pre><p id="5ae9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从这一点来看，值得一提的是这个项目<strong class="jp ir">已经有三周了</strong>。这就是为什么它是从测试频道获取的。虽然我和开发人员已经做了大量的测试，但事情可能会变得不稳定！如果事情真的发生在❤，我们将非常感谢发布报告</p><p id="8aa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将安装<code class="fe nc nd ne mu b">microk8s</code>命令和一个api-server、控制器-管理器、调度器、etcd、kubelet、cni、kube-proxy和docker。大约30秒后，您应该能够使用<code class="fe nc nd ne mu b">microk8s.kubectl</code>命令检查集群。</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="fe14" class="mh ky iq mu b gy my mz l na nb">microk8s.kubectl get no</span></pre><p id="312a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您将看到您的机器的主机名！默认情况下，没有pod、服务、daemonsets或任何有趣的东西。这是最低限度的Kubernetes。但是，您可以启用某些插件，如<code class="fe nc nd ne mu b">kube-dns</code>和<code class="fe nc nd ne mu b">dashboard</code>！</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="b9e2" class="mh ky iq mu b gy my mz l na nb">microk8s.enable dns dashboard</span></pre><p id="dd34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将需要一些时间来创建和启动必要的吊舱，一旦你从<code class="fe nc nd ne mu b">microk8s.kubectl get po,svc --namespace kube-system</code>那里得到看起来像这样的输出，你就可以进入下一步了！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nf"><img src="../Images/435db5ebe047a5c0ac74e38bab84799c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PWlUu-EF8dKD39KqSWQmgg.png"/></div></div></figure><p id="facd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这是您本地机器上的一个Kubernetes，您可以在您的浏览器中像<code class="fe nc nd ne mu b">service/kubernetes-dashboard</code>一样检查任何这些<code class="fe nc nd ne mu b">CLUSTER-IP</code>地址，并与相关的pod进行交互——完成您的机器到Kubernetes游乐场的转换！</p><h1 id="7e0d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">当我完成的时候呢？</h1><p id="2c1d" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">虽然我愿意相信在我的笔记本电脑上运行Kubernetes集群24/7是真正的梦想，但事实是我并不总是需要它。您可以随时通过发出以下命令来暂停所有正在运行的Kubernetes服务</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="f4f7" class="mh ky iq mu b gy my mz l na nb">snap disable microk8s</span></pre><p id="d09c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不仅会禁用所有正在运行的服务，还会删除<code class="fe nc nd ne mu b">microk8s</code>命令。这实际上与不删除文件的卸载是一样的。当你准备好再次启动时，只需启用microk8s</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="2da4" class="mh ky iq mu b gy my mz l na nb">snap enable microk8s</span></pre><p id="5539" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">豆荚需要一段时间重新稳定下来。值得注意的是，禁用microk8s也会停止所有正在运行的容器:]</p><p id="38c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你真的完成了<code class="fe nc nd ne mu b">microk8s</code>，你可以删除整个包，这将清除所有文件和配置。首先，使用<code class="fe nc nd ne mu b">.disable</code>命令禁用任何用<code class="fe nc nd ne mu b">microk8s.enable</code>创建的插件</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="2ba5" class="mh ky iq mu b gy my mz l na nb">microk8s.disable dashboard dns</span></pre><p id="b5bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像今天这样(一个三周前的项目)，您需要等到所有的容器都停止后才能运行下面的命令。有一个bug是<code class="fe nc nd ne mu b">kube-dns</code> pod移动到终止但没有移除。只要pod计数都是<code class="fe nc nd ne mu b">0</code>，您就可以继续。</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="cd6a" class="mh ky iq mu b gy my mz l na nb">sudo snap remove microk8s</span></pre><p id="3cea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！</p><h1 id="8c20" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">联系我们</h1><p id="9e43" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我个人对microk8s作为替代本地Kubernetes工具的潜力感到非常兴奋。microk8s的贡献者有兴趣听听你的意见——好的、坏的和坏的！你可以在#microk8s 下的<a class="ae ma" href="https://kubernetes.slack.com/messages/CAUNWQ85V" rel="noopener ugc nofollow" target="_blank"> Kubernetes Slack、在</a><a class="ae ma" href="https://github.com/juju-solutions/microk8s" rel="noopener ugc nofollow" target="_blank"> Github </a>以及在<a class="ae ma" href="https://microk8s.io" rel="noopener ugc nofollow" target="_blank"> web </a>上找到我们。</p><h1 id="6e57" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">帮帮我！</h1><p id="6269" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我们已经发现了一些常见问题，所以如果你被困在上面，这里有一些常见的<em class="ng">故障</em>以及如何<em class="ng">解决</em>它们。</p><h2 id="c5b4" class="mh ky iq bd kz mi mj dn ld mk ml dp lh jy mm mn ll kc mo mp lp kg mq mr lt ms bi translated">我不能列出任何节点</h2><p id="546d" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果您已经运行了Docker守护进程，这种情况会在新安装时发生。如果你这样做了，只需简单的<code class="fe nc nd ne mu b">sudo systemctl stop docker</code>或docker守护进程的名称，并重新安装快照</p><h2 id="2eb2" class="mh ky iq bd kz mi mj dn ld mk ml dp lh jy mm mn ll kc mo mp lp kg mq mr lt ms bi translated">microk8s命令不存在！</h2><p id="cfef" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果您没有明确禁用microk8s，请检查以确保它仍然处于启用状态:</p><pre class="km kn ko kp gt mt mu mv mw aw mx bi"><span id="d6ed" class="mh ky iq mu b gy my mz l na nb">snap list</span></pre><p id="b34a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果它已启用，而您看不到该命令，可能是因为<code class="fe nc nd ne mu b">/snap/bin</code>不在您的路径中。验证<code class="fe nc nd ne mu b">/snap/bin/microk8s.kubectl</code>是否在您的系统上，并将<code class="fe nc nd ne mu b">/snap/bin</code>添加到您的系统路径中。</p></div></div>    
</body>
</html>