<html>
<head>
<title>Moving Docker Containers and Images Around</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">四处移动Docker容器和图像</h1>
<blockquote>原文：<a href="https://itnext.io/moving-docker-containers-and-images-around-cf604757d8b9?source=collection_archive---------2-----------------------#2020-08-17">https://itnext.io/moving-docker-containers-and-images-around-cf604757d8b9?source=collection_archive---------2-----------------------#2020-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><a href="http://www.giantswarm.io"><div class="gh gi jn"><img src="../Images/a0e34fec13599cf2d6b30f1899f61a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YekIjL7l31zSlUetbYEjbA.jpeg"/></div></a></figure><p id="eb4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Giant Swarm在<code class="fe kt ku kv kw b">registry.giantswarm.io</code>运行一个<a class="ae ks" href="https://github.com/docker/docker-registry" rel="noopener ugc nofollow" target="_blank"> Docker容器注册表</a>，为已经注册了<a class="ae ks" href="https://giantswarm.io/request-invite/" rel="noopener ugc nofollow" target="_blank">私有alpha测试</a>的用户提供便利。当您注册一个帐户时，您也会在我们托管的注册表中获得一个帐户。您可以使用这个<em class="kx">私有</em>注册表来存储您在Giant Swarm上运行的服务的容器映像。</p><p id="e938" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还不支持的一个功能是从远程<em class="kx">私有</em>注册中心获取图像的能力，比如由<a class="ae ks" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>，CoreOS的<a class="ae ks" href="https://quay.io/" rel="noopener ugc nofollow" target="_blank"> Quay.io </a>或<a class="ae ks" href="https://cloud.google.com/container-registry/" rel="noopener ugc nofollow" target="_blank">Google Container Registry</a>托管的注册中心。存储在这些服务上的公共图像对我们来说很好，我们计划在不久的将来增加对远程私人注册的支持。</p><p id="0b05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在与一个潜在客户合作时，我发现自己需要在Giant Swarm上运行图像，这些图像存储在Docker Hub上的一个私人存储库中。在<a class="ae ks" href="http://stackoverflow.com/questions/26026931/setting-up-a-remote-private-docker-registry" rel="noopener ugc nofollow" target="_blank">和</a> <a class="ae ks" href="http://stackoverflow.com/questions/23935141/how-to-copy-docker-images-from-one-host-to-another-without-via-repository" rel="noopener ugc nofollow" target="_blank">围绕</a> <a class="ae ks" href="http://stackoverflow.com/questions/28734086/how-to-move-docker-containers-between-different-hosts" rel="noopener ugc nofollow" target="_blank">纠结了一会儿</a>之后，我终于想出了解决办法，并想在这里分享一下。</p><h1 id="2a09" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">移动图像回购回购</h1><p id="f30a" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">如果您只是想将图像从一个存储库移动到另一个存储库，最简单的方法就是使用<code class="fe kt ku kv kw b">docker tag</code>和<code class="fe kt ku kv kw b">docker push</code>方法。我们将从Docker Hub中提取一个图像开始，这是<code class="fe kt ku kv kw b">docker</code>使用的默认存储库:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="8fc0" class="mj kz iq kw b gy mk ml l mm mn">$ docker pull ubuntu Using default tag: latest latest: Pulling from library/ubuntu d3a1f33e8a5a: Pull complete c22013c84729: Pull complete d74508fb6632: Pull complete 91e54dfb1179: Already exists library/ubuntu:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security. Digest: sha256:fde8a8814702c18bb1f39b3bd91a2f82a8e428b1b4e39d1963c5d14418da8fba Status: Downloaded newer image for ubuntu:latest</span></pre><p id="3a9b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我们用所需的目标存储库标记图像:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="c9ea" class="mj kz iq kw b gy mk ml l mm mn">$ docker tag ubuntu registry.giantswarm.io/kord/ubuntu</span></pre><p id="9fd2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，我们将映像推送到新的注册表中:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="1ee2" class="mj kz iq kw b gy mk ml l mm mn">$ docker push registry.giantswarm.io/kord/ubuntu The push refers to a repository [registry.giantswarm.io/kord/ubuntu] (len: 1) Sending image list Pushing repository registry.giantswarm.io/kord/ubuntu (1 tags) d3a1f33e8a5a: Image successfully pushed c22013c84729: Image successfully pushed d74508fb6632: Image successfully pushed 91e54dfb1179: Image successfully pushed Pushing tag for rev [91e54dfb1179] on {https://registry.giantswarm.io/v1/repositories/kord/ubuntu/tags/latest}</span></pre><p id="42cd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">注意</strong>:在推送私人回购之前，您需要登录对方注册中心！</p><h1 id="d8bf" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">将图像从主机移动到主机</h1><p id="3a39" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">在上面的例子中，将图像从一个注册表移动到另一个注册表需要通过互联网拉和推图像。如果您只是需要将图像从一台主机移动到另一台主机，就像与办公室中的某个人共享图像一样，您可以在没有上传和下载图像开销的情况下获得类似的结果。</p><h1 id="1cb8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">导出与保存</h1><p id="a163" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">Docker支持两种不同类型的方法将容器图像保存到一个tarball中:</p><ul class=""><li id="3ebc" class="mo mp iq jw b jx jy kb kc kf mq kj mr kn ms kr mt mu mv mw bi translated"><code class="fe kt ku kv kw b">docker export</code> -将容器的运行或暂停的<em class="kx">实例</em>保存到文件中</li><li id="7961" class="mo mp iq jw b jx mx kb my kf mz kj na kn nb kr mt mu mv mw bi translated"><code class="fe kt ku kv kw b">docker save</code> -将未运行的容器<em class="kx">图像</em>保存到文件中</li></ul><h1 id="19f7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用导出</h1><p id="ba2e" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">让我们先来看看<code class="fe kt ku kv kw b">docker export</code>的方法。我们首先让Bob从Docker Hub下载一个Ubuntu图像:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="a02c" class="mj kz iq kw b gy mk ml l mm mn">$ docker pull ubuntu &lt;snip&gt; Status: Downloaded newer image for ubuntu:latest</span></pre><p id="c034" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在鲍勃在交互模式下运行<em class="kx">实例</em>，并在根目录下添加一个名为<code class="fe kt ku kv kw b">this</code>的文件:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="e3f2" class="mj kz iq kw b gy mk ml l mm mn">$ docker run -t -i ubuntu /bin/bash root@defc757ce803:/# ls bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var root@defc757ce803:/# touch this root@defc757ce803:/# ls bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys this tmp usr var</span></pre><p id="150c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果Bob退出这个提示，他的容器将被销毁。因此，在另一个shell中，Bob运行<code class="fe kt ku kv kw b">docker export</code>命令来导出<em class="kx">实例的</em>图像:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="1e25" class="mj kz iq kw b gy mk ml l mm mn">$ # output truncated slightly $ docker ps CONTAINER ID IMAGE COMMAND defc757ce803 ubuntu "/bin/bash" $ docker export defc | gzip &gt; ubuntu.tar.gz $ ls -lah ubuntu.tar.gz -rw-r--r-- 1 bob staff 63M Aug 28 13:56 ubuntu.tar.gz</span></pre><p id="faea" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在可以让Bob使用<a class="ae ks" href="https://en.wikipedia.org/wiki/Sneakernet" rel="noopener ugc nofollow" target="_blank"> sneakernet </a>将他电脑上的<code class="fe kt ku kv kw b">ubuntu.tar.gz</code>文件上传到Alice的电脑上。Bob完成后，Alice可以在图像上使用一个<code class="fe kt ku kv kw b">docker import</code>,并在这个过程中给它一个新的标签:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="5b59" class="mj kz iq kw b gy mk ml l mm mn">$ ls -lah ubuntu.tar.gz -rw-r--r-- 1 alice staff 63M Aug 28 13:56 ubuntu.tar.gz $ gzcat ubuntu.tar.gz | docker import - ubuntu-alice e7a0d776251fb5c7d61a6aa481f1aa8cf6f8c2936e893030ac481ff4499ec129</span></pre><p id="7085" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在Alice可以运行容器并验证Bob的<code class="fe kt ku kv kw b">this</code>文件是完整的:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="22ea" class="mj kz iq kw b gy mk ml l mm mn">$ docker run -t -i ubuntu-alice /bin/bash root@3f7f57eb9959:/# ls bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys this tmp usr var</span></pre><h1 id="3f92" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用保存</h1><p id="654e" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">或者，Bob可以简单地在Ubuntu映像上做一个<code class="fe kt ku kv kw b">docker save</code>来给Alice一个容器的<em class="kx">映像</em>的副本，Alice可以在没有Bob修改的情况下使用它:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="9680" class="mj kz iq kw b gy mk ml l mm mn">$ docker save ubuntu | gzip &gt; ubuntu-golden.tar.gz</span></pre><p id="95dc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后爱丽丝会拿着那个副本<code class="fe kt ku kv kw b">load</code>它，而不是做一个<code class="fe kt ku kv kw b">import</code>:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="bb1d" class="mj kz iq kw b gy mk ml l mm mn">$ gzcat ubuntu-golden.tar.gz | docker load</span></pre><p id="4eba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在Alice运行容器并注意到Bob的<code class="fe kt ku kv kw b">this</code>文件不在那里:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="a651" class="mj kz iq kw b gy mk ml l mm mn">$ docker run -i -t ubuntu /bin/bash root@e11b3abb67de:/# ls bin boot dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</span></pre><p id="6be6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我在这里注意到，如果Alice做了一个<code class="fe kt ku kv kw b">docker import - ubuntu</code>而不是<code class="fe kt ku kv kw b">docker load</code>，那么docker <strong class="jw ir">将存储零投诉的图像</strong>。Docker甚至会尝试启动一个导入的<em class="kx">实例</em>，该实例是用<code class="fe kt ku kv kw b">docker export</code>保存的<em class="kx">。当它这样做时，它将无法运行容器中的任何内容。</em></p><h1 id="3942" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">增加boot2docker的默认磁盘空间</h1><p id="04aa" class="pw-post-body-paragraph ju jv iq jw b jx lw jz ka kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr ij bi translated">在撰写本文的过程中，我遇到了一个关于<code class="fe kt ku kv kw b">boot2docker</code>的<em class="kx">有趣的</em>问题，因为我的虚拟机用完了存储图像的空间。这就造成了拉图的神秘挂。</p><p id="461b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您要移动大量映像，您可能希望增加由<code class="fe kt ku kv kw b">boot2docker</code>分配的虚拟机存储量:</p><pre class="mb mc md me gt mf kw mg mh aw mi bi"><span id="3b3a" class="mj kz iq kw b gy mk ml l mm mn">$ boot2docker init -s 40000</span></pre><p id="b4b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">显示的单位是千兆字节。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><a href="https://www.giantswarm.io/guide-cloud-native-stack?utm_campaign=Blog%20CTA%20Conversion&amp;utm_source=Cloud%20native%20stack%20guide_Blog&amp;utm_medium=Blog%20CTA&amp;utm_term=cloud%20native%20stack%20guide"><div class="gh gi nc"><img src="../Images/ef438cb76c5d031f7368edcbd56d8e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vfUkro8rqoC2M5Qz.jpg"/></div></a></figure></div></div>    
</body>
</html>