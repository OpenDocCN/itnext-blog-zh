<html>
<head>
<title>Laravel and Vue: Creating a Portfolio website with a CRUD admin panel — Chapter Six</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第六章</h1>
<blockquote>原文：<a href="https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-six-6f7ed2b23b42?source=collection_archive---------1-----------------------#2019-11-09">https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-six-6f7ed2b23b42?source=collection_archive---------1-----------------------#2019-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7333" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">前端表单验证和调整图像大小</h2></div><p id="8833" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上一章中，我们讨论了Laravel验证。我们验证了ProfileEditor组件的表单。验证是为了确保至少有一个字段被填充。</p><p id="510d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">现在:</strong>我们想添加<strong class="kk iu">前端表单验证</strong>，我们也想<strong class="kk iu">上传后调整图像大小</strong>。</p><p id="a2dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">前端表单验证原因</strong>:服务器可能反应太慢。如果表单没有通过Laravel验证，我们将不得不等待服务器返回错误。</p><p id="9431" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们的服务器太慢或有其他问题，使返回太慢，我们可能会等待很长时间。</p><p id="3090" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">调整图像大小的原因</strong>:当您上传图像时，它会以上传时的尺寸显示在刊头上。图像大小可能不适合我们的想法。例如，您可能想要200*300的图像，但如果您上传1000*1000的图像，则会显示上传的尺寸。</p><p id="d824" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然你可以使用CSS来调整图像的大小，但那只是在<strong class="kk iu">外观中调整大小</strong>。加载的图像文件仍然很大，需要很长时间才能加载。</p><p id="623b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，调整图像大小是必须的。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="5c03" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">前端表单验证</h1><p id="2a83" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们需要两条验证规则。它们是:</p><ol class=""><li id="7028" class="mi mj it kk b kl km ko kp kr mk kv ml kz mm ld mn mo mp mq bi translated">必须至少填写一个字段</li><li id="bb46" class="mi mj it kk b kl mr ko ms kr mt kv mu kz mv ld mn mo mp mq bi translated">该文件必须是图像</li></ol><p id="9ecf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以有一个按钮，导致一个点击验证方法。让；让提交按钮指向验证方法。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a0ed" class="nf lm it nb b gy ng nh l ni nj">&lt;button <em class="nk">@click.prevent</em>="<strong class="nb iu">validate</strong>"&gt;Submit&lt;/button&gt;</span></pre><p id="2a25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">validate()方法应该是</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="2a72" class="nf lm it nb b gy ng nh l ni nj">validate() {<br/>    <em class="nk">if </em>(<em class="nk">this</em>.name === '' &amp;&amp; <em class="nk">this</em>.file.length &lt;= 0) {<br/>        <em class="nk">alert</em>('at least one field must be filled');<br/>    }<br/>    <em class="nk">if </em>(<em class="nk">this</em>.file.type !== "image/*") {<br/>        <em class="nk">alert</em>('file must be an image')<br/>    }<br/>    <em class="nk">else </em>{<br/>        <em class="nk">this</em>.onSubmit();<br/>    }<br/>},</span></pre><p id="c07c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据应该是</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="fb88" class="nf lm it nb b gy ng nh l ni nj">data() {<br/>    <em class="nk">return </em>{<br/>        name: '',<br/>        file: '',<br/>    }<br/>},</span></pre><blockquote class="nl nm nn"><p id="c7af" class="ki kj nk kk b kl km ju kn ko kp jx kq no ks kt ku np kw kx ky nq la lb lc ld im bi translated"><strong class="kk iu">代码解释</strong>:我们想要的是如果两个字段都是空的，那么<strong class="kk iu">表单就不应该</strong>提交。否则，您可以转到onSubmit方法。</p></blockquote><p id="847f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果我们发布一个空的表单，我们将得到一个JavaScript警告，说<strong class="kk iu">至少有一个字段必须填写。</strong>如果我们输入一个文件而不是一个图像文件，我们会得到一个警告说<strong class="kk iu">文件必须是一个图像</strong>。</p><p id="84d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要一种方法来确定这个消息是来自vue组件还是Laravel验证。</p><p id="7530" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了确保警报来自vue组件，我们可以临时在警报文本中添加单词FRONT END(或任何其他合适的单词)。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="91c3" class="nf lm it nb b gy ng nh l ni nj"><em class="nk">alert</em>("<strong class="nb iu">FRONT END</strong> At least one field must be filled out");</span></pre><p id="9fd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提交空表单，如果出现这样的警告框，则验证正在进行。</p><p id="39b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果有效，请将警报改回:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="75a6" class="nf lm it nb b gy ng nh l ni nj"><em class="nk">alert</em>("At least one field must be filled out");</span></pre><h2 id="2af9" class="nf lm it bd ln nr ns dn lr nt nu dp lv kr nv nw lx kv nx ny lz kz nz oa mb ob bi translated"><strong class="ak">警报问题</strong></h2><p id="477e" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">虽然警告能够通知用户验证，但它们在所有浏览器中看起来并不相同。为了创建跨浏览器的统一外观，我们需要另一种方式来通知用户错误。</p><p id="af9b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建一个显示错误的栏。在我们需要插入的表格下面。确保表单在div/section等中。因为vue模板只接受模板标签内的一个元素。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d729" class="nf lm it nb b gy ng nh l ni nj">&lt;template&gt;<br/>       &lt;div&gt;<br/>          &lt;form&gt;....&lt;/form&gt;<br/>          <strong class="nb iu">&lt;div <em class="nk">id</em>="errorBar"&gt;&lt;/div&gt;</strong><br/>       &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="d131" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了显示错误，我们可以使用一个<strong class="kk iu">计算属性。</strong>计算的属性取决于其他数据。随着其他数据的更改，计算的属性也会相应地更改。</p><p id="78c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以在<code class="fe oc od oe nb b"><strong class="kk iu">errorBar</strong></code> <strong class="kk iu"> </strong>元素中包含<code class="fe oc od oe nb b"><strong class="kk iu">{{validate}}</strong></code>，然后在<code class="fe oc od oe nb b"><strong class="kk iu">computed</strong></code>块而不是方法块中计算<code class="fe oc od oe nb b"><strong class="kk iu">{{validate}}</strong></code>。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="22b4" class="nf lm it nb b gy ng nh l ni nj"><strong class="nb iu">computed</strong> :{<br/>    validate(){<br/>        <em class="nk">if </em>(<em class="nk">this</em>.name === '' &amp;&amp; <em class="nk">this</em>.file.length &lt;= 0) {<br/>            <em class="nk">return </em>'please fill at least one field';<br/>        }<br/>        <em class="nk">if </em>(<em class="nk">this</em>.file &amp;&amp; !<em class="nk">this</em>.file.type.startsWith("image/")) {<br/>            <em class="nk">return </em>'file must be an image';<br/>        }<br/>        <em class="nk">else </em>{<br/>            <em class="nk">this</em>.onSubmit();<br/>        }<br/>    }<br/>},</span></pre><p id="1e41" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在错误信息将出现在<strong class="kk iu">#错误栏中。</strong>但是，我们会在解决第一个错误后立即提交表单。</p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi of"><img src="../Images/ec2ac87838f8a07e2177582890676514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*14LlDeFz2eXWhDC0Uv2J-Q.gif"/></div></div></figure><p id="c7c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们需要找到一种方法将表单提交与计算的属性函数分开。</p><p id="2d9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们能做的是:</p><ul class=""><li id="dc32" class="mi mj it kk b kl km ko kp kr mk kv ml kz mm ld on mo mp mq bi translated">禁用按钮</li><li id="f596" class="mi mj it kk b kl mr ko ms kr mt kv mu kz mv ld on mo mp mq bi translated">解决错误后，启用该按钮</li></ul><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/5cc011db9a5c2736d2a791bb7dce86b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*0fT42oG0yMV7O0jDldlh4g.png"/></div></div></figure><p id="e8df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">禁用很容易。您只需向按钮添加disable属性。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="9e1a" class="nf lm it nb b gy ng nh l ni nj">&lt;button <em class="nk">@click.prevent</em>="onSubmit" <strong class="nb iu"><em class="nk">disabled</em></strong>&gt;Submit&lt;/button&gt;</span></pre><p id="1e2e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，在我们的例子中，我们需要将禁用的属性<strong class="kk iu">绑定到数据属性</strong>。这意味着我们可以打开和关闭禁用属性。</p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi op"><img src="../Images/d891f67dd0532ef5a09c2d2aa52290b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*--IECUJQeoW2W-Yt"/></div></div><figcaption class="oq or gj gh gi os ot bd b be z dk translated">照片由<a class="ae ou" href="https://unsplash.com/@karim_manjra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卡里姆·曼吉拉</a>在<a class="ae ou" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="216f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果submitDisabled为true，则按钮具有Disabled属性。如果submitDisabled为false，按钮将不具有Disabled属性。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="6e02" class="nf lm it nb b gy ng nh l ni nj">&lt;button <em class="nk">@click.prevent</em>="onSubmit" <strong class="nb iu"><em class="nk">:disabled</em>="submitDisabled"</strong>&gt;Submit&lt;/button&gt;</span><span id="93f0" class="nf lm it nb b gy ov nh l ni nj">data() {<br/>    <em class="nk">return </em>{<br/>        name: '',<br/>        file: '',<br/>        <strong class="nb iu">submitDisabled: <em class="nk">true</em>,</strong><br/>    }<br/>},</span></pre><p id="1cc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为默认情况下data属性为true，所以页面将在禁用按钮的情况下加载。</p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oo"><img src="../Images/deb47a5ed0e17a0854efeb87e0869434.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*qKCA-idV_4F-UKsHRhDMNQ.png"/></div></div></figure><p id="cb72" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我们如何启用按钮呢？</p><p id="ca53" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以简单地将else块中的<code class="fe oc od oe nb b"><strong class="kk iu">submitDisabled</strong></code>改为<code class="fe oc od oe nb b"><strong class="kk iu">false</strong></code>。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="9010" class="nf lm it nb b gy ng nh l ni nj">computed :{<br/>    validationErrors(){<br/>        <strong class="nb iu"><em class="nk">this</em>.submitDisabled = <em class="nk">true</em>;</strong><br/>        <em class="nk">if </em>(<em class="nk">this</em>.name === '' &amp;&amp; <em class="nk">this</em>.file.length &lt;= 0) {<br/>            <em class="nk">return </em>'please fill at least one field';<br/>        }<br/>        <em class="nk">if </em>(<em class="nk">this</em>.file &amp;&amp; !<em class="nk">this</em>.file.type.startsWith("image/")) {<br/>            <em class="nk">return </em>'file must be an image';<br/>        }<br/>        <em class="nk">else </em>{<br/>            <strong class="nb iu"><em class="nk">this</em>.submitDisabled = <em class="nk">false</em>;</strong><br/>        }<br/>    }<br/>},</span></pre><p id="8f69" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在<code class="fe oc od oe nb b"><strong class="kk iu">submitDisabled</strong></code>默认为<code class="fe oc od oe nb b"><strong class="kk iu">true</strong></code>，在计算方法的开始处为<code class="fe oc od oe nb b"><strong class="kk iu">true</strong></code>，如果验证通过则为<code class="fe oc od oe nb b"><strong class="kk iu">false</strong></code>。这意味着只有当我们没有任何验证错误时，按钮才被启用。</p><figure class="mw mx my mz gt og gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/09cd802fa76cd42f1940b50fe09bde0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*wrS3N66vXbVt6e8HM1V-EQ.png"/></div></figure><h2 id="38f1" class="nf lm it bd ln nr ns dn lr nt nu dp lv kr nv nw lx kv nx ny lz kz nz oa mb ob bi translated"><strong class="ak">设定误差线的样式</strong></h2><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="514f" class="nf lm it nb b gy ng nh l ni nj">&lt;style <em class="nk">scoped</em>&gt;<br/>    #errorBar {<br/>        background-color: #333;<br/>        color: #fff;<br/>        padding: 16px;<br/>    }<br/>&lt;/style&gt;</span></pre><h2 id="d58f" class="nf lm it bd ln nr ns dn lr nt nu dp lv kr nv nw lx kv nx ny lz kz nz oa mb ob bi translated">重构onSubmit方法</h2><p id="2b1a" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">在onSubmit方法变得太长之前，让我们重构它。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="5771" class="nf lm it nb b gy ng nh l ni nj">onSubmit() {<br/>    <em class="nk">let </em>fd = <em class="nk">new </em>FormData();<br/>    fd.append('name', <em class="nk">this</em>.name);<br/>    fd.append('userpic', <em class="nk">this</em>.file);<br/>    <em class="nk">this</em>.postProfile(fd);<br/>},</span><span id="5746" class="nf lm it nb b gy ov nh l ni nj">postProfile(fd) {<br/>    axios.post('api/profile', fd)<br/>        .then(<em class="nk">this</em>.$parent.getProfile())<br/>        .catch(error =&gt; {<br/>            <em class="nk">let </em>er = error.response.data.errors;<br/>            <em class="nk">let </em>ov = Object.values(er);<br/>            <em class="nk">alert</em>(ov.join(''));<br/>        })<br/>}</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="f07b" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">图像大小调整</h1><p id="6c73" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">目前，如果我们上传一个大图片，它会保持它的大小，这就是页面上显示的内容。这可能不符合网站的设计。我希望用户图片是240像素乘240像素。</p><p id="52ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要图像干预库。我们可以使用terminal/cmd获得这个库</p><p id="0af1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe oc od oe nb b">php composer.phar require intervention/image</code></p><p id="24c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果这在获得干预/图像方面不起作用，我们可以尝试:</p><p id="16f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe oc od oe nb b">composer require intervention/image</code></p><p id="cc66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们必须改变如果<code class="fe oc od oe nb b"><strong class="kk iu">request()</strong></code> <strong class="kk iu"> </strong>有userpic文件会发生什么。</p><p id="ba07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在ProfileController的顶部，导入库</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="a7b5" class="nf lm it nb b gy ng nh l ni nj"><strong class="nb iu"><em class="nk">use </em>Intervention\Image\Facades\Image;</strong></span></pre><p id="b7e7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在官方干预图像网站上，显示的调整图像大小的方法如下:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="fd10" class="nf lm it nb b gy ng nh l ni nj">// open an image file<br/>$img = Image::make('public/foo.jpg');<br/><br/>// now you are able to resize the instance<br/>$img-&gt;resize(320, 240);<br/><br/>// and insert a watermark for example<br/>$img-&gt;insert('public/watermark.png');<br/><br/>// finally we save the image as a new file<br/>$img-&gt;save('public/bar.jpg');</span></pre><p id="e520" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把它应用到我们的案例中。</p><h2 id="ee2c" class="nf lm it bd ln nr ns dn lr nt nu dp lv kr nv nw lx kv nx ny lz kz nz oa mb ob bi translated">干预图像的适应</h2><p id="be0c" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">—我们要打开的图像是来自request() 的<strong class="kk iu"> userpic</strong></p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi ox"><img src="../Images/93edf4fbc054579aa4ff4b5eb944600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvgZWeoSvLq83tY_7S0vVA.png"/></div></div></figure><p id="03ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">—我们想把它调整到<strong class="kk iu">240 px</strong>T15】*<strong class="kk iu">240 px(宽*高)。我们可以将320的宽度改为240。</strong></p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oy"><img src="../Images/3f368863871b7401f01cdeda93885136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7cxG0m4w1pDZ6Zm4fYj39Q.png"/></div></div></figure><p id="7bc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">—我们不想要水印，所以我们可以删除整行(及其前面的注释)。</p><figure class="mw mx my mz gt og gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi oz"><img src="../Images/3daddc39c575be73e8c6ec76502bc16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiRSDzG4j5T2Xn8CGXc4gg.png"/></div></div></figure><p id="3f1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">—对于存储，如果您看一下保存函数，它使用的是<strong class="kk iu">完整路径(目录+文件名)</strong>，这与我们之前使用的不同，即store()函数</p><p id="06a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe oc od oe nb b"><strong class="kk iu">store('/public/userpics')</strong></code> vs <code class="fe oc od oe nb b"><strong class="kk iu">$img-&gt;save('public/bar.jpg');</strong></code></p><p id="4054" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">存储功能只是将上传的文件存储在一个目录中。</p><p id="c465" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe oc od oe nb b"><strong class="kk iu">store()</strong></code>功能不适用于介入图像，您必须使用介入图像的<code class="fe oc od oe nb b"><strong class="kk iu">save()</strong></code>功能。这就带来了一个问题，我们如何使用完整路径进行保存？</p><p id="6fbb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">我们如何使用完整路径进行保存？</strong></p><p id="cde1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以看到在save()中有一个字符串，即<code class="fe oc od oe nb b"><strong class="kk iu">'public/bar.jpg'</strong></code> <strong class="kk iu">。当我们想在数据库中存储一个名字时，我们已经在生成一个hashName。我们可以使用相同的函数替换字符串。</strong></p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="2b8c" class="nf lm it nb b gy ng nh l ni nj"><strong class="nb iu">$hashName = request()-&gt;file('userpic')-&gt;hashName();<br/></strong><strong class="nb iu">$img-&gt;save($hashName);</strong><strong class="nb iu"> </strong></span></pre><p id="1aec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在将创建一个调整过大小的文件，并将其保存在<strong class="kk iu"> public </strong>目录中。</p><p id="630e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望它在一个userpics目录中，因为我们希望有一个专门存储userpics的文件夹。但是，如果我们执行<code class="fe oc od oe nb b"><strong class="kk iu">$img-&gt;save('userpics/'.$hashName);</strong></code> <strong class="kk iu"> </strong>操作，您可能会在网络选项卡中看到以下错误:</p><blockquote class="pa"><p id="810c" class="pb pc it bd pd pe pf pg ph pi pj ld dk translated">消息:无法将图像数据写入路径</p></blockquote><p id="0c22" class="pw-post-body-paragraph ki kj it kk b kl pk ju kn ko pl jx kq kr pm kt ku kv pn kx ky kz po lb lc ld im bi translated">这是因为要使用保存功能，我们必须已经创建了文件夹。我们必须在公共文件夹中创建一个名为userpics的文件夹。</p><p id="a761" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有一种更好的保存方式，您不必创建文件夹。这是用存储门面。记得在顶部导入存储门面<code class="fe oc od oe nb b"><em class="nk">use </em>Illuminate\Support\Facades\Storage;</code></p><p id="eb6e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们要用<code class="fe oc od oe nb b">Storage::put</code>。这可用于在完整路径下存储原始文件内容。</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="bdfd" class="nf lm it nb b gy ng nh l ni nj">Storage::<em class="nk">put</em>($fullpath,$contents);</span></pre><p id="54a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的原始文件内容将被编码成调整大小的文件</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="f66d" class="nf lm it nb b gy ng nh l ni nj"><strong class="nb iu">$img = Image::make($file);<br/>$contents = $img-&gt;resize(240, 240)-&gt;encode();</strong><br/>Storage::<em class="nk">put</em>($fullpath,<strong class="nb iu">$contents</strong>);</span></pre><p id="4a4c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整路径将是directory + hashname。我们可以把<code class="fe oc od oe nb b">request()-&gt;file('userpic')</code>缩短为<code class="fe oc od oe nb b"><strong class="kk iu">request()-&gt;userpic;</strong></code></p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="9e38" class="nf lm it nb b gy ng nh l ni nj"><strong class="nb iu">$file = request()-&gt;userpic;<br/>$dir = 'public/userpics/';<br/>$hashName = $file-&gt;hashName();<br/>$fullpath = $dir.$hashName;</strong></span></pre><p id="b687" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们最终得到以下结果:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="68c8" class="nf lm it nb b gy ng nh l ni nj">if (request()-&gt;hasFile('userpic')) {<br/> $file = request()-&gt;userpic;<br/> $dir = 'public/userpics/';<br/> $hashName = $file-&gt;hashName();<br/> $fullpath = $dir.$hashName;</span><span id="7b03" class="nf lm it nb b gy ov nh l ni nj">$this-&gt;<strong class="nb iu">resizeAndStore</strong>($file, $fullpath);<br/> $profile-&gt;img_path = $hashName;<br/> }</span></pre><p id="bced" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">resizeAndStore()是我们为了重构而必须创建的一个新函数</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="dea9" class="nf lm it nb b gy ng nh l ni nj">private function <strong class="nb iu">resizeAndStore</strong>($file, $fullpath) {<br/> // open an image file<br/> $img = Image::make($file);<br/> // now you are able to resize the instance<br/> $contents = $img-&gt;resize(240, 240)-&gt;encode();<br/> //save<br/> Storage::put($fullpath,$contents);<br/> }</span></pre><p id="0301" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">确保Masthead.vue有这个来显示上传的图像</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="4256" class="nf lm it nb b gy ng nh l ni nj">&lt;img v-bind:src="'storage/userpics/' + profile.img_path"/&gt;</span></pre><p id="f8a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在这将工作，我们将看到一个调整大小的图像，而不是原来的图像。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="cfc2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下一章中，我们将开始投资组合的工作。</p><div class="pp pq gp gr pr ps"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-seven-b473ee1ac816"><div class="pt ab fo"><div class="pu ab pv cl cj pw"><h2 class="bd iu gy z fp px fr fs py fu fw is bi translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第七章</h2><div class="pz l"><h3 class="bd b gy z fp px fr fs py fu fw dk translated">构建投资组合</h3></div><div class="qa l"><p class="bd b dl z fp px fr fs py fu fw dk translated">itnext.io</p></div></div><div class="qb l"><div class="qc l qd qe qf qb qg ol ps"/></div></div></a></div></div></div>    
</body>
</html>