<html>
<head>
<title>Angular ngRx store unit testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular ngRx存储单元测试</h1>
<blockquote>原文：<a href="https://itnext.io/ngrx-store-testing-cheat-sheet-59e069eb47c?source=collection_archive---------0-----------------------#2020-02-20">https://itnext.io/ngrx-store-testing-cheat-sheet-59e069eb47c?source=collection_archive---------0-----------------------#2020-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="86c8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">有角的</h2><div class=""/><div class=""><h2 id="ce6f" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">测试你的角度存储现在变得很容易与这个卑微的手册🧪</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/007be298430d86c7e229914b14a38924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*71jtZpnmYQgQOXJd"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">亚历克斯·康德拉蒂耶夫在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="791f" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">先决条件<a class="ae lh" href="https://emojipedia.org/memo/" rel="noopener ugc nofollow" target="_blank">📝</a></h1><p id="f4ea" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">阅读这篇文章意味着你对Angular、Typescript和NgRx Store有一个基本的了解。另外，你了解通量模式(Redux)。</p><div class="mw mx gp gr my mz"><a href="https://ngrx.io/guide/store" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd jd gy z fp ne fr fs nf fu fw jc bi translated">NgRx文档</h2><div class="ng l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">ngrx.io</p></div></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nh"><img src="../Images/8d140abd2ef1203a7024a8de42183a88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iOC2HaKvG4mb7LwbdxvrFg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">NgRx商店图解(来自<a class="ae lh" href="https://ngrx.io/guide/store" rel="noopener ugc nofollow" target="_blank"> ngrx.io </a></figcaption></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="7b08" class="li lj it bd lk ll np ln lo lp nq lr ls ki nr kj lu kl ns km lw ko nt kp ly lz bi translated">样品商店🏪</h1><p id="b1d0" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为了深入单元测试Angular ngRx存储，我创建了一个简单的存储。我们只有一个<code class="fe nu nv nw nx b">data</code>字段。该属性将通过服务获取。这里没有实现这个服务，但是它可以从REST api中检索数据。</p><p id="c897" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">在我们的商店中，我们将管理两种类型的命令(也称为动作):</p><ul class=""><li id="d1e7" class="od oe it mc b md ny mg nz mj of mn og mr oh mv oi oj ok ol bi translated">一个<strong class="mc jd"> <em class="om"> LoadData </em> </strong>命令来触发检索</li><li id="602a" class="od oe it mc b md on mg oo mj op mn oq mr or mv oi oj ok ol bi translated">一个<strong class="mc jd"> <em class="om"> SetData </em> </strong>动作(带有一个有效载荷)将获取的数据保存到存储器中</li></ul><h2 id="7cb2" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">行动🎬</h2><p id="978b" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这里，我们定义了获取和设置<code class="fe nu nv nw nx b">data</code>的两个动作。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="f95c" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">还原剂🔍</h2><p id="65bb" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我们的缩减器指定了<code class="fe nu nv nw nx b">SetData</code>动作发生时会发生什么。不出所料，它只是设置了<code class="fe nu nv nw nx b">data</code>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="72d1" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">效果🌪️</h2><p id="0037" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这是一个非常常见的效果用例，我们加载数据，就像我们在应用程序引导时所做的那样。</p><p id="f748" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">当<code class="fe nu nv nw nx b">LoadData</code>动作发生时，由于<code class="fe nu nv nw nx b">SetData</code>动作，从服务中获取<code class="fe nu nv nw nx b">data</code>对象并存储在存储中。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="b6eb" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">选择器🎯</h2><p id="b115" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">有点过度设计，但这是测试选择器的好方法:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="4fce" class="li lj it bd lk ll np ln lo lp nq lr ls ki nr kj lu kl ns km lw ko nt kp ly lz bi translated">单元测试我们的商店🧪</h1><p id="c4e3" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">现在是考验的时候了！💥</p><p id="21ee" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">我们将使用Jasmine作为单元测试框架，但这不是强制性的。</p><h2 id="6ed2" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">行动🎬</h2><p id="2307" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">测试动作非常容易，因为我们只需要检查动作对象的良好创建。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="42a6" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">还原剂🔍</h2><p id="07d6" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在我们的reducer中，我们将有2个测试用例:</p><ul class=""><li id="ec8b" class="od oe it mc b md ny mg nz mj of mn og mr oh mv oi oj ok ol bi translated">初始状态</li><li id="1283" class="od oe it mc b md on mg oo mj op mn oq mr or mv oi oj ok ol bi translated"><code class="fe nu nv nw nx b">SetData</code>行动</li></ul><p id="e0aa" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">由于我们将设置数据，我们需要一点配置:从<code class="fe nu nv nw nx b">initialState</code>中重置<code class="fe nu nv nw nx b">data</code>属性，以确保它在每个测试的最开始保持不变。这里，我们使用Jasmine框架中的<code class="fe nu nv nw nx b">afterEach</code>方法。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="81a1" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">Effect️s🌪️</h2><p id="8aa1" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">测试效果需要更多的配置，因为我们需要模拟商店和数据提供者<code class="fe nu nv nw nx b">DataService</code>。为了实现这一点，您可以在测试模块的定义中找到设置(第20–24行)。</p><p id="8340" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">第23–24行允许定义一个包含函数列表的模拟对象<code class="fe nu nv nw nx b">DataService</code>。然后，第29行，我们定义一个函数将返回什么值。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="a726" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">最后，我们必须通过向动作管道<code class="fe nu nv nw nx b">actions$</code>添加动作来触发效果。如第44–45行所述，通过订阅效果来操作检查。</p><h2 id="6c55" class="os lj it bd lk ot ou dn lo ov ow dp ls mj ox oy lu mn oz pa lw mr pb pc ly iz bi translated">选择器🎯</h2><p id="8de5" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">由于选择器只是浏览商店特性的一种方式，我们可以创建一个类似于商店的复杂对象来检查选择器是否获取了正确的属性。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="255a" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">在这里，由于工厂的存在，创建状态和实体变得更加容易，使之更适应每个测试用例。</p><h1 id="b691" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">特性模块状态呢？🤔</h1><p id="225b" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如上所述，可以对每个状态独立地进行单元测试功能模块状态。</p><p id="7249" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">然而，你会面临一些关于特性模块中单元测试选择器的问题。它需要改变状态，将我们的特征状态封装到一个根状态中。</p><h1 id="62ff" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">小费🃏</h1><p id="d30a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated"><code class="fe nu nv nw nx b">MockStore</code>类提供了一个非常有用的属性:<code class="fe nu nv nw nx b">scannedActions$</code> <em class="om">。</em>这是一个可观察对象，我们可以在其上添加一个订户来检查所有调度的操作。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure><p id="ecab" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">当你<strong class="mc jd">在一个效果</strong>中调度几个动作时，这可能是有用的。</p><h1 id="2f4a" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">最后的话🔚</h1><p id="8821" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">对ngRx商店进行单元测试实际上非常容易，对吧！？由于通量模式，商店的每个部分都是自给自足的，可以独立测试。</p><p id="fb7f" class="pw-post-body-paragraph ma mb it mc b md ny kd mf mg nz kg mi mj oa ml mm mn ob mp mq mr oc mt mu mv im bi translated">如果您遇到了本文迄今为止没有涉及的特定案例，请随意发表评论。</p></div></div>    
</body>
</html>