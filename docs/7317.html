<html>
<head>
<title>Observations and thoughts after building 3 kubernetes platforms in Financial Services Industry — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金融服务业三大kubernetes平台建设后的观察与思考(二)</h1>
<blockquote>原文：<a href="https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-158eba494528?source=collection_archive---------2-----------------------#2022-08-19">https://itnext.io/observations-and-thoughts-after-building-3-kubernetes-platforms-in-financial-services-industry-158eba494528?source=collection_archive---------2-----------------------#2022-08-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d504" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个博客系列的第二部分，分享我对工作负载标识的使用以及如何根据我在3个Kubernetes平台上为我们的客户管理秘密的经验的观察。</p><h1 id="91b6" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">工作负载身份</h1><p id="a1da" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">Kubernetes使用服务帐户来表示工作负载。这些帐户仅在集群范围内可见，不与外部系统联合/集成。</p><p id="1b6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes上运行的工作负载通常需要与外部云服务进行交互，例如Bucket/Blob存储、SQL实例、密钥存储。为了允许使用目标服务对工作负载进行身份验证和授权，可以将一个身份(服务主体、服务帐户)附加到您的工作负载pod。从而将kubernetes帐户连接到提供者的身份后端。</p><p id="aadb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一等公民，GKE在这一领域表现出色。AKS有一个名为AAD Pod Identity的开源插件，直到今年1月1日。这是一个很难管理的组件。令人欣慰的是，微软现在已经取代了它的AAD工作负载身份(仍在预览版)。</p><p id="d5f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主要经验教训:</p><ul class=""><li id="375e" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">每当工作负载需要与云服务交互时，使用工作负载标识。它避免了需要轮换帐户密钥或其他共享秘密。</li><li id="a3bb" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">工作负载身份是GKE的核心，并成为AKS上的黄金时段(我从同事那里听说过在AKS上使用工作负载身份的好消息)</li></ul><h1 id="1b63" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">秘密管理/外部化</h1><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/efd34bfe54e93548179a92937e7a98a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*89TlohzB8TnZdORY.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">多租户—每个名称空间有一个SecretStore的外部机密</figcaption></figure><p id="ff1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在与受监管的组织打交道时，秘密管理总是一个热门话题。他们经常被“秘密是用Base64编码的”所困扰，看不到这一点，并立即想将秘密具体化。只是为了将它们与Kubernetes同步到“etcd中的base64”。</p><blockquote class="mt mu mv"><p id="3596" class="jn jo mw jp b jq jr js jt ju jv jw jx mx jz ka kb my kd ke kf mz kh ki kj kk ij bi translated"><em class="iq">向客户解释kubernetes秘密的base64编码和静态数据加密背后的原因总是一件有趣的事情。</em></p></blockquote><p id="f2df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决“base64崩溃”，GKE提供了存储在etcd (BYOK或谷歌管理的密钥)中的数据的应用层加密作为核心功能。AKS终于添加了KMS etcd加密(似乎是在最近2个月)。</p><p id="276c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在来说说秘密外化吧！在过去的三年里，这个领域有了巨大的发展。当时，还没有让安全团队感到惊讶的多租户友好解决方案。这导致组织构建定制解决方案(不推荐)。快进到今天，有大量的选项可用，如外部秘密，标准操作程序，哈希公司保险库代理注射器(VAI)。我个人的选择是外部秘密。它涵盖了所有常见的secret后端，并支持开箱即用的多租户(每个租户配置自己的secret store)。警告，有个比较老的项目叫<em class="mw"> Kubernetes外秘</em>；离远点。我还发现HashiCorp VAI作为最终用户使用起来很糟糕(尽管运行时注入比同步更好)。</p><p id="bc75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主要经验教训:</p><ul class=""><li id="2383" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">准备好解释base64编码，并将其与实际的静态加密分离开来</li><li id="a3a4" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">秘密外化现在盛行。解决方案要么将秘密同步到kubernetes中，要么在实例化时将它们注入到工作负载中。</li><li id="b76f" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated"><a class="ae lo" href="https://external-secrets.io/v0.5.9/" rel="noopener ugc nofollow" target="_blank"> ExternalSecrets </a>是这个领域的绝对赢家。</li><li id="a8da" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">不要定制！有很多比我们聪明得多的公司/项目已经解决了这个问题。</li></ul></div></div>    
</body>
</html>