<html>
<head>
<title>Controlling Paint Worklet with JSON in CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在CSS中用JSON控制画图小工具</h1>
<blockquote>原文：<a href="https://itnext.io/controlling-paint-worklet-with-json-in-css-298a7b10e41c?source=collection_archive---------5-----------------------#2019-04-24">https://itnext.io/controlling-paint-worklet-with-json-in-css-298a7b10e41c?source=collection_archive---------5-----------------------#2019-04-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c30d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是基于我的关于同一主题的波兰博客文章。</p><p id="734b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您关注JavaScript社区，您可能知道JS中的CSS。这是一种将CSS放到JavaScript文件中的方式，而不是单独的CSS文件。我在本文中展示的解决方案是相反的，它是一个放入CSS文件中的JSON对象，用JavaScript进行解析(您可能会将JS放入CSS中，但我没有测试它)。我们这样做的原因是为了控制基于JavaScript的CSS，它是Houdini的一部分。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/0e448e9d23f64efc682e100bab51f233.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0v9e6EDGHxU2VE63UUqX6Q.png"/></div></div></figure><h1 id="6e0b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">乌丹尼</h1><p id="b92c" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Houdini是为一个目的而创建的新API的集合。因此开发人员可以控制CSS引擎的行为。连接到它的内部，让它按照他们想要的那样工作。有些API已经实现，有些计划实现，有些仍在设计过程中，因此可能会有变化。你可以在ishoudinireadyyet.com<a class="ae kl" href="https://ishoudinireadyyet.com/" rel="noopener ugc nofollow" target="_blank">的遗址</a>上看到胡迪尼的地位。</p><h1 id="2491" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">绘画小工具</h1><p id="ee25" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">这个worklet类似于普通的worker(在浏览器中运行的独立线程),但是它允许注册“paint”类，该类可以访问类似canvas的API，可以在CSS中使用该API来呈现事物(例如，使用背景图像)</p><p id="4d96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要注册paint worklet，您需要执行以下代码:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="d5ab" class="mg kz iq mc b gy mh mi l mj mk">CSS.paintWorklet.addModule('plik.js');</span></pre><p id="d5ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在该文件中，您可以创建如下所示特殊类:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="7319" class="mg kz iq mc b gy mh mi l mj mk">class Circle {</span><span id="25a8" class="mg kz iq mc b gy ml mi l mj mk">static get inputProperties() {<br/>        return ['--pointer-x', '--pointer-y', '--pointer-options'];<br/>    }</span><span id="2952" class="mg kz iq mc b gy ml mi l mj mk">paint(context, geom, properties) {<br/>        var x = properties.get('--pointer-x').value || 0;<br/>        var y = properties.get('--pointer-y').value || 0;<br/>        const prop = properties.get('--pointer-options');<br/>        // destructure object props with defaults<br/>        const {<br/>            background,<br/>            color,<br/>            width<br/>        } = Object.assign({<br/>            color: 'white',<br/>            background: 'black',<br/>            width: 10<br/>        }, JSON.parse(prop.toString()));<br/>        // draw circle at point<br/>        context.fillStyle = color;<br/>        console.log({x,y, color, background, width})<br/>        context.beginPath();<br/>        const r = Math.floor(width / 2);<br/>        context.arc(x, y, r, 0, 2 * Math.PI, false);<br/>        context.closePath();<br/>        context.fill();<br/>    }<br/>}</span></pre><p id="bbea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后你可以注册这个类为<strong class="jp ir">画图</strong>:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="12aa" class="mg kz iq mc b gy mh mi l mj mk">registerPaint('circle', Circle);</span></pre><h1 id="ff55" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">CSS中的JSON</h1><p id="96c3" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你看一下这个类的前面的代码，你会看到:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="be9c" class="mg kz iq mc b gy mh mi l mj mk">const prop <strong class="mc ir">=</strong> properties.get('--pointer-options');<br/>JSON.parse(prop.toString());</span></pre><p id="d6b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们从CSS中获取原始数据，并将其解析为JSON。在CSS中，它看起来像这样:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="398e" class="mg kz iq mc b gy mh mi l mj mk">div {<br/>    height: 100vh;<br/>    background-image: paint(circle);<br/>    --pointer-x: 20px;<br/>    --pointer-y: 10px;<br/>    --pointer-options: {<br/>        "color"<strong class="mc ir">:</strong> "rebeccapurple",<br/>        "width"<strong class="mc ir">:</strong> 20<br/>    }<strong class="mc ir">;</strong><br/>}</span></pre><p id="791b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每次你改变自定义属性(前面有两个破折号的那个，也叫CSS变量)，它会重新渲染背景。</p><p id="8c7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>上次我测试这段代码时，CSS变量中间需要有破折号，否则它们就不能使用画图工具。</p><p id="7865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您向CSS添加自定义属性时，您还需要注册它们，因此它们具有类型:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="84df" class="mg kz iq mc b gy mh mi l mj mk">CSS.registerProperty({<br/>    name: '--pointer-x',<br/>    syntax: '&lt;length&gt;',<br/>    inherits: false,<br/>    initialValue: '10px'<br/>});<br/>CSS.registerProperty({<br/>    name: '--pointer-y',<br/>    syntax: '&lt;length&gt;',<br/>    inherits: false,<br/>    initialValue: '10px'<br/>});<br/>CSS.registerProperty({<br/>    name: '--pointer-options',<br/>    inherits: false,<br/>    initialValue: '{}'<br/>});</span></pre><p id="2d8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以做的最后一件事是在鼠标移动时更改CSS属性:</p><pre class="kn ko kp kq gt mb mc md me aw mf bi"><span id="9496" class="mg kz iq mc b gy mh mi l mj mk">document.querySelector('div').addEventListener('mousemove', (e) =&gt; {<br/>    const style = e.target.style;<br/>    style.setProperty('--pointer-x', event.clientX + 'px');<br/>    style.setProperty('--pointer-y', event.clientY + 'px');<br/>});</span></pre><p id="5572" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这个<a class="ae kl" href="https://codepen.io/jcubic/pen/JwVXKe" rel="noopener ugc nofollow" target="_blank"> CodePen demo </a>里查看全部代码。</p><p id="62e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，你可以在Twitter上关注我。</p></div></div>    
</body>
</html>