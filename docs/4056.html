<html>
<head>
<title>About Azure AKS Default Node Pool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Azure AKS默认节点池</h1>
<blockquote>原文：<a href="https://itnext.io/about-azure-aks-default-node-pool-2067d03ef1bc?source=collection_archive---------1-----------------------#2020-04-18">https://itnext.io/about-azure-aks-default-node-pool-2067d03ef1bc?source=collection_archive---------1-----------------------#2020-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b77dce277a488709c3bfb1c008226e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2hxbjBeIgn4J7VFZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">泰勒·维克在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="5e3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您曾经使用过Azure Managed Kubernetes服务，您可能需要至少更改或删除一次默认节点池——这是在创建集群时创建的节点池，本质上是集群中的第一个节点池。如果你没有，那我就告诉你——Azure不会允许你这么做的。让我们深入Azure AKS节点池，看看如果需要的话，如何删除默认节点池。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="3664" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">什么是节点池，为什么需要多个节点池:</strong></p><p id="516c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">顾名思义，节点池将x个节点组成一个逻辑组。每个组都可以有不同的配置，这就是节点池的意义所在。一个池中的节点可以有不同的虚拟机SKU(不同的虚拟机类型)、不同的Kubernetes版本、不同的每节点pod限制等。从Kubernetes的角度来看，默认情况下它们都在同一个篮子里——例如，如果你在Azure中创建3个节点池——你会在<em class="li"> kubectl get nodes的输出中看到所有3个节点池中的所有节点。那还有什么意义呢？我提到了“默认”。但是，通过使用一些Kubernetes <a class="ae kc" href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" rel="noopener ugc nofollow" target="_blank">机制</a>，您可以将不同的节点池用于不同的目的。几个例子:</em></p><ul class=""><li id="5b8e" class="lj lk iq kf b kg kh kk kl ko ll ks lm kw ln la lo lp lq lr bi translated">对您的工作流进行逻辑分组，例如一个节点池用于生产应用程序，另一个节点池用于开发/测试。</li><li id="a7c9" class="lj lk iq kf b kg ls kk lt ko lu ks lv kw lw la lo lp lq lr bi translated">按虚拟机类型对节点池进行分组—一个节点池包含标准计算机，另一个额外节点池包含更大的计算机(更多CPU/RAM) —例如，用于保存需要更多计算能力的特定应用程序。</li><li id="94ea" class="lj lk iq kf b kg ls kk lt ko lu ks lv kw lw la lo lp lq lr bi translated">按“重要性”对节点池进行分组，例如，有一个节点池具有较低的每节点pods限制，并运行较旧的Kubernetes版本以保留最重要的微服务，另一个节点池具有较高的每节点pods限制和最新的Kubernetes版本。</li><li id="cfcc" class="lj lk iq kf b kg ls kk lt ko lu ks lv kw lw la lo lp lq lr bi translated">通过自动扩展限制对节点池进行分组。例如，将一个节点池的自动扩展设置为某个合理的数字，并将所有非关键应用程序保留在该节点池中，而将另一个节点池的自动扩展限制设置为非常高，以用于关键应用程序。通过这种方式，当流量出现峰值时，您的主要微服务(例如运行API的微服务)将相应地扩展，但将系统的非关键部分保留在节点池中，该节点池将在一定范围内扩展，但不会扩展太多以节省成本。</li></ul><p id="b900" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些只是几个例子，说明了为什么您希望AKS集群有多个节点池。这完全取决于您的具体使用情形和需求，但底线是，通常情况下，多节点池是有用的。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="245c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们讨论一下“默认”节点池。它实际上已经不再被官方这样称呼了，但是你可能会找到这个名字的引用。基本上，我们讨论的是在创建AKS集群时创建的节点池。从Azure的角度来看，该节点池被创建为“系统”节点池，每当您添加新的节点池时，它都被创建为“用户”节点池。这两个有什么区别？“系统”节点池只是运行AKS正常工作所需的pods(CoreDNS、Kuberentes Dashboard、tunnelfront、metrics-server、omsagentetc)，而正如您可能猜到的那样，用户节点池在创建后在节点上只有kube-proxy pods，没有其他。</p><p id="96e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，在Azure门户中你不会看到哪个是哪个。从那里看，两者看起来一样:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/fa854c07243d4b8148648d0bba6e1c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLHamkazDxwe_S5Kstf3hw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">“代理池”—默认节点池</figcaption></figure><p id="35da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，如果你试图删除“secondpool”节点池，Azure会很好地删除它，但如果你试图对“agentpool”做同样的事情，Azure会抱怨:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/5f1fd829fb34631fb9b3a064733484f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*zAhvum6gzGfkmp89Z84c7A.png"/></div></figure><p id="8dab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于“系统”节点池包含Azure创建的pods，AKS需要这些pods才能正常工作，因此防止删除该节点池是有意义的，对吗？但有时您确实需要删除该默认节点池(例如，使用不同的每节点pod限制或不同的虚拟机类型来重新创建它)。在这种情况下，你唯一的选择就是使用<a class="ae kc" href="https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank"> Azure命令行工具</a>“az”。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="7871" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我之前提到过，在Azure Portal中，两个节点池看起来是一样的。但是，当使用“az”命令列出节点池时，您会看到哪个是系统，哪个是用户模式:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/0e54f90106ce7f5332c7641804564a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVq0wAf2COuHNB5BLyTJUw.png"/></div></div></figure><p id="0fcd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有两个选择:</p><ol class=""><li id="a2c6" class="lj lk iq kf b kg kh kk kl ko ll ks lm kw ln la me lp lq lr bi translated">将一个现有用户节点池更改为系统节点池，然后删除默认节点池</li><li id="b014" class="lj lk iq kf b kg ls kk lt ko lu ks lv kw lw la me lp lq lr bi translated">创建新的节点池作为系统节点池。</li></ol><p id="8fb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个选项与执行以下命令一样简单:</p><pre class="ly lz ma mb gt mf mg mh mi aw mj bi"><span id="c6f2" class="mk ml iq mg b gy mm mn l mo mp">az aks nodepool update --mode System --name [your_node_pool] --resource-group [resource_group] --cluster-name [cluster_name]</span></pre><p id="b414" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，第二个选项是在创建新节点池时传递相同的“模式”参数:</p><pre class="ly lz ma mb gt mf mg mh mi aw mj bi"><span id="051f" class="mk ml iq mg b gy mm mn l mo mp">az aks nodepool add --mode System --name [your_node_pool] --resource-group [resource_group] --cluster-name [cluster_name]</span></pre><p id="39bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您执行其中一项操作并再次列出您的节点池，您现在应该会看到我们有多个系统节点池:</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/532f31bfeaf2f8696f9fc14f2744f739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNR4Pz1mnXP2UVkLPzZNiA.png"/></div></div></figure><p id="9499" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">…这让我们可以毫无问题地删除默认节点池(通过Azure门户或CLI):</p><figure class="ly lz ma mb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/628f5b55d5d5729f0a369afce8b6e53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wvxHBzNipjRWBh0jNmfRig.gif"/></div></div></figure><p id="0d29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。总结:为了删除AKS默认节点池，您需要创建或指定另一个节点池处于“系统”模式，只要至少有一个系统节点池，那么对于Azure来说，您想要删除哪个节点池就不再重要了。</p></div></div>    
</body>
</html>