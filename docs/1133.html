<html>
<head>
<title>Web app perform zone 1 — lighthouse CI integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Web应用程序执行区域1 — lighthouse CI集成</h1>
<blockquote>原文：<a href="https://itnext.io/web-app-perform-zone-1-lighthouse-ci-integration-3b06841770c2?source=collection_archive---------6-----------------------#2018-07-26">https://itnext.io/web-app-perform-zone-1-lighthouse-ci-integration-3b06841770c2?source=collection_archive---------6-----------------------#2018-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/767cf3c80e4d444bc414c78ca8a24004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frGo6ZKVBvDOrt4jCoJz0Q.png"/></div></div></figure><h1 id="87f2" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">话题之前的废话</h1><p id="b78d" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Web已经从基于知识的网页组装变成了一流的应用平台。<a class="ae lu" href="https://developers.google.com/web/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> Progressive Web App </a> (PWA)填补了移动端Web App和原生App的空白。<a class="ae lu" href="https://en.wikipedia.org/wiki/Single-page_application" rel="noopener ugc nofollow" target="_blank">单页面应用</a> (SPA)已经被业界所接受，一个SPA页面通常包含HTML、CSS、一堆图像和兆比特的Javascript。</p><h1 id="50a6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">问题是</h1><p id="d116" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">你的应用有多“威比”？在有线/ADSL/慢速3G/片状连接/离线时表现/工作良好吗？也许你会说你的网络应用很时尚，功能丰富，但是只能在使用有线/ADSL连接的桌面浏览器上运行良好。如果是这样，坦率地说，你的应用程序不是一个真正的web应用程序。它只是一个需要互联网的桌面应用程序。在移动主导的世界里，一个网络应用程序必须在移动互联网上表现良好。为了定义一个高性能的应用程序，谷歌在2015年发布了<a class="ae lu" href="https://developers.google.com/web/fundamentals/performance/rail?hl=en" rel="noopener ugc nofollow" target="_blank"> RAIL </a>模型。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/c15760afcba4b724ccf9a26d59691376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fivhoOYbs-lC3T-l3UeGvg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">Rail代表性能的主要方面—响应动画空载</figcaption></figure><p id="2abb" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">一个高性能的web应用程序符合<a class="ae lu" href="https://developers.google.com/web/fundamentals/performance/rail?hl=en" rel="noopener ugc nofollow" target="_blank"> RAIL </a>标准，简而言之，这意味着:</p><blockquote class="mj mk ml"><p id="3aca" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">响应:在50毫秒内响应用户操作</p><p id="c3f9" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">动画:在10毫秒内制作一帧动画</p><p id="44cb" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">空闲:最大化空闲时间</p><p id="c2a6" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">加载:借助慢速3G，在不到5秒的时间内交付内容并开始互动</p></blockquote><p id="e3d3" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">让我们只关注最后一个目标。性能是每个应用程序的关键标准，但却没有得到充分的重视。为什么不到5秒？因为每过一秒，用户就会失去对他们正在执行的任务的关注。站点首次加载时，5秒是一个合理的时间窗口。如果你觉得3G网络有点刻薄，<a class="ae lu" href="https://www.gsma.com/mobileeconomy/#techmigration" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> GSMA数据</strong> </a> <strong class="ky ir">显示在被认为是发达地区的欧洲，仍有惊人的37%的移动用户在使用3G网络，而在全球范围内，这个数字是31%。</strong>查<a class="ae lu" href="https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/" rel="noopener ugc nofollow" target="_blank">买得起吗？现实世界的网络性能预算</a>。</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/559bb46dc200e38a8112a8540a315744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xONVxvMLOw2GLn3oXKs9A.png"/></div></div></figure><p id="9391" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">面对3G，在5秒钟内变得互动对大多数澳大利亚网站来说仍然是一个巨大的目标。在Chrome开发工具中打开缓慢的3G节流和移动模拟器后，我对澳大利亚的热门网站进行了审计。</p><p id="ee93" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated"><strong class="ky ir">2018年澳大利亚网站登陆页面加载速度慢于3G</strong></p><p id="4703" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">【www.nab.com.au T4】</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/43b1511f53aeb63c164bb1af7b93c6a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWjc53q1TO1pvQhFphH2oQ.png"/></div></div></figure><p id="48b0" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated"><a class="ae lu" href="http://www.anz.com.au" rel="noopener ugc nofollow" target="_blank">www.anz.com.au</a></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/cae595a2e7fa91d843aa45d11de9dca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5K_iBRM-VHM1YJRA0SLxg.png"/></div></div></figure><p id="fbf2" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated"><a class="ae lu" href="http://www.westpec.com.au" rel="noopener ugc nofollow" target="_blank">www.westpac.com.au</a></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/a09c866415cec28a2c061eba2f91c76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oadxYi5IuggsV98QYlq_ug.png"/></div></div></figure><p id="d0db" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated"><a class="ae lu" href="http://www.commonbank.com.au" rel="noopener ugc nofollow" target="_blank">www.commonbank.com.au</a></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/6f3ee69adb6d44dd710e294560043428.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcJPZqaoxpTiFrZd-CP6FQ.png"/></div></div></figure><p id="2021" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated"><a class="ae lu" href="http://www.seek.com.au" rel="noopener ugc nofollow" target="_blank">www.seek.com.au</a></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/719b97cbd5b6f5b8d84a36ac944b74f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIV--t8ZMqG2UYdWkVfWNg.png"/></div></div></figure><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/289f288bcd19c43bb2fb0c985a6cd851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hezVDNs0R07FPXGhLPbl6w.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">全球移动加载时间</figcaption></figure><p id="1adb" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">有趣但令人尴尬的是，大多数网站都远远超过了5秒的互动基准。相当一部分超过10秒，这意味着许多用户将放弃移动网络选项，开始寻求替代方案。在3G网络条件下，这些网站将成为你想要避开的网站。呆在你的房间和公共中心区澳大利亚人！上面列出的数据显示了两件事:</p><ul class=""><li id="c48d" class="mx my iq ky b kz me ld mf lh mz ll na lp nb lt nc nd ne nf bi translated">首先，初始页面大小至关重要。如果你的页面大小接近1000k，那么在3G网络下你就完了。</li><li id="d412" class="mx my iq ky b kz ng ld nh lh ni ll nj lp nk lt nc nd ne nf bi translated">第二——Javascript很贵。一些站点的DOM加载速度很快，但是需要更长的时间才能准备好(DOMContentLoaded &gt; Load &gt;Finished)。有一篇文章是Addy Osmani写的关于Javascript成本的文章。强烈推荐阅读。</li></ul><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/0927cfc4c52209476b56218509480869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56slsTH0jjktS1Vbqmo34g.png"/></div></div></figure><h1 id="03c1" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">灯塔</h1><p id="86a4" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">从哪里开始提升性能？罗马不是一天建成的。性能改进是系统工程，罗马可以一天比一天好。<strong class="ky ir">要构建和维护一个速度极快的web应用，最好的方法是从一开始就快速构建，并在每次提交时根据性能检查您的更改。我们需要一个扫描工具来评估工作质量，尤其是绩效。性能是一个很大的特性，但易受变化的影响。查看文章<a class="ae lu" href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/" rel="noopener ugc nofollow" target="_blank">为什么性能很重要</a>。</strong></p><p id="ee26" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">让谷歌的灯塔成为你亲密的朋友。作为网络开发人员，你可能以前用过灯塔。</p><blockquote class="mj mk ml"><p id="cb0d" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">Lighthouse是一款<a class="ae lu" href="https://github.com/GoogleChrome/lighthouse" rel="noopener ugc nofollow" target="_blank">开源</a>，用于提高网页质量的自动化工具。你可以在任何网页上运行它，无论是公开的还是需要认证的。它对性能、可访问性、渐进式网络应用等进行审计。</p></blockquote><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/7796e884e73065e568553ffbb9e6c40e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ejx1zAHfSv_ML1YBSPpMg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">灯塔扫描报告给出分数和改进建议</figcaption></figure><p id="98c0" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">Lighthouse给出了提高web性能的可行建议。我假设大多数web开发人员至少尝试过lighthouse。他们可能已经做了扫描，并得到一些惊叹“我应该这样做，那样做…”出来。在许多情况下，他们可能已经摘到了几个唾手可得的果实，报告的其余问题可能是:</p><ul class=""><li id="b1ab" class="mx my iq ky b kz me ld mf lh mz ll na lp nb lt nc nd ne nf bi translated">太难改变了。比如js捆绑包过大，这需要相当大的努力来树抖动和分裂成更小的异步捆绑包。</li><li id="dc08" class="mx my iq ky b kz ng ld nh lh ni ll nj lp nk lt nc nd ne nf bi translated">来不及改变。在后期阶段，他们发现大量表单、框架存在性能缺陷，或者由第三方交付的UI资产性能不佳。</li><li id="c721" class="mx my iq ky b kz ng ld nh lh ni ll nj lp nk lt nc nd ne nf bi translated">太难也太晚了。面对这样一个没人想碰的庞然大物，你只是想零敲碎打地按摩一下客户的痛点。</li></ul><blockquote class="mj mk ml"><p id="55f7" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">没有什么比暂时的入侵更长久的了。—凯尔·辛普森</p></blockquote><p id="cb18" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">如何让业绩一路高歌猛进？就像你每天都在进行的单元测试和端到端测试一样，性能也是你的应用程序的一个同样重要的特性，应该在每次提交的基础上进行测量，并密切监控以防止衰退。如果我知道我的性能在拉取请求期间受到影响，该怎么办？一时兴起，我做了Lighthouse集成演示项目，想在这里分享一下方法:</p><p id="c693" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">我选择了一个“hello world”项目，但并不那么“hello”。这是一个明星项目。是一个52705主演的github名人，叫<a class="ae lu" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">创作反应app </a>。它由脸书维护，是react项目中最受欢迎的发电机之一。我用它创建了这个名为“webnowtalk”的演示项目。</p><p id="2ae1" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">在生成的应用程序中，README.md文件中有完整的启动手册。这不是这里的重点。我们的目标是将Lighthouse scan整合到每个pull请求中。我们将使用<a class="ae lu" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>作为集成工具。看看yaml配置文件和package.json:</p><figure class="lw lx ly lz gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><figure class="lw lx ly lz gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="1917" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">Travis CI简洁优雅。使用两行代码<code class="fe np nq nr ns b">npm run build</code> <code class="fe np nq nr ns b">npm run deploy</code>构建项目代码，并使用名为“deploy-to-gh-pages”的npm模块将其部署到<a class="ae lu" href="https://pages.github.com/" rel="noopener ugc nofollow" target="_blank"> github pages </a>。部署的链接是<a class="ae lu" href="https://hurricanew.github.io/webnowtalk/" rel="noopener ugc nofollow" target="_blank">https://hurricanew.github.io/webnowtalk/</a></p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/fc4f3fc2c53b73eb259673cf8c27e3a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*Fwumziv_AwTGbcM0y6lIDg.jpeg"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">CI流程</figcaption></figure><p id="d0c9" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">好的，上面的过程似乎是标准的。现在是灯塔法力时间。我们使用<a class="ae lu" href="https://github.com/ebidel/lighthouse-ci" rel="noopener ugc nofollow" target="_blank"> lighthouse CI </a>作为集成工具。lighthouse ci将进行扫描，并使用分数来证明build的成功并发布评论。仅当提交是拉请求提交时，扫描才会发生。合并前守住线！</p><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/902fae13d7c323a73323fca135e3a9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ot2oyTSPEyhnT906TSmMCw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">带有灯塔扫描配置项的公关成功</figcaption></figure><figure class="lw lx ly lz gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/db67ca3623c79fc1f2091013faf74958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*4JT5UTejKdBBFroRax_eHA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">lighthouse-ci集成的更新流程图</figcaption></figure><p id="c303" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">乌拉完成了。一千英里的第一步。您可以在这里看到拉动请求链接<a class="ae lu" href="https://github.com/hurricanew/webnowtalk/pull/2" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="mj mk ml"><p id="1b80" class="kw kx mm ky b kz me lb lc ld mf lf lg mn mg lj lk mo mh ln lo mp mi lr ls lt ij bi translated">我无法建造的。我不明白。—理查德·费曼</p></blockquote></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="58b1" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">就是这样。我们以100点的基本项目成绩开始了旅程。稍后，我们将添加功能并见证性能对分数的影响。下一篇文章我将关注图像优化——在保持性能的同时向演示站点添加图像。请继续关注。</p><p id="4038" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">感谢阅读。如果您认为这篇文章让您的开发生活变得更好了，请单击“鼓掌”。</p><p id="b468" class="pw-post-body-paragraph kw kx iq ky b kz me lb lc ld mf lf lg lh mg lj lk ll mh ln lo lp mi lr ls lt ij bi translated">感谢<a class="ae lu" href="https://medium.com/@jhlagado" rel="noopener"> John Hardy </a>和<a class="ae lu" href="https://medium.com/@u_glow" rel="noopener"> Brett Uglow </a>审阅我的草稿并给出反馈。你亲切的支持让我继续写作和分享。</p></div></div>    
</body>
</html>