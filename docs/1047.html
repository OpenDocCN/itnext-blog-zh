<html>
<head>
<title>D3.js in all its glory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">辉煌中的D3.js</h1>
<blockquote>原文：<a href="https://itnext.io/d3-js-in-all-its-glory-7066601aa16b?source=collection_archive---------2-----------------------#2018-07-11">https://itnext.io/d3-js-in-all-its-glory-7066601aa16b?source=collection_archive---------2-----------------------#2018-07-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d96a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">提高普通折线图交互性的一些技巧。</h2></div><p id="e70c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://medium.com/factorymn/%D0%BF%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%BE%D0%B3%D0%BE-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BC%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B2-%D0%B2%D0%B8%D0%B4%D0%B5-%D0%BB%D0%B8%D0%BD%D0%B5%D0%B9%D0%BD%D1%8B%D1%85-%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%BE%D0%B2-%D1%81-d3-js-61ebfa5909dc" rel="noopener"> <em class="lc">见这篇俄文文章(этастатьянарусском</em>🇷🇺<em class="lc">)。</em>T11】</a></p><p id="e259" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将考虑几种技术，如何使用用于数据可视化的JavaScript库<a class="ae lb" href="https://d3js.org/" rel="noopener ugc nofollow" target="_blank"> D3.js </a>使普通的折线图更具信息性和交互性。</p><p id="fd6c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将从俄罗斯开放数据中心获取原始数据，并可视化俄罗斯中央联邦区各地区企业和个人信贷的加权平均利率动态。</p><p id="2afb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将尝试对代码中最重要的部分进行评论。但是，对于一个不熟悉本库基本概念的人来说(比如<a class="ae lb" href="https://github.com/d3/d3-selection" rel="noopener ugc nofollow" target="_blank">选择</a>、<a class="ae lb" href="https://github.com/d3/d3-scale" rel="noopener ugc nofollow" target="_blank">缩放</a>、<a class="ae lb" href="https://github.com/trinary/d3-transform" rel="noopener ugc nofollow" target="_blank">变换</a>、<a class="ae lb" href="https://github.com/d3/d3-zoom" rel="noopener ugc nofollow" target="_blank">缩放</a>、<a class="ae lb" href="https://bl.ocks.org/cmgiven/32d4c53f19aea6e528faf10bfe4f3da9" rel="noopener ugc nofollow" target="_blank">更新图案</a>)，很多事情可能看起来并不明显。我们将使用D3.js库的最后第五个版本，并使用现代ES6语法编写代码。如果您需要将代码的某些部分转移到您自己的项目中，在不支持任何ES6特性的环境中工作，不要忘记使用代码转换器。</p><p id="ec83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">开始之前，让我们看一下初始数据的结构:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/58bff25304dd450fbaaa4792a75f9bc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Y6rFpCIIxpI2uWIUM-X-g.png"/></div></div></figure><p id="3d54" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">csv文件中的行是:地区ID ( <code class="fe lp lq lr ls b">regionId</code>)、地区名称(<code class="fe lp lq lr ls b">regionName</code>)、日期(<code class="fe lp lq lr ls b">date</code>)和利率(<code class="fe lp lq lr ls b">percent</code>)。</p><h1 id="d20c" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">画图表。</h1><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="2c60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe lp lq lr ls b">d3.csv</code>方法加载数据文件，该方法获取源url作为参数并返回一个承诺。文件加载后，将运行<code class="fe lp lq lr ls b">draw</code>功能。</p><p id="4c1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们考虑一下<code class="fe lp lq lr ls b">draw</code>函数本身。首先，定义一些常量(<code class="fe lp lq lr ls b">margins</code>、<code class="fe lp lq lr ls b">width</code>、<code class="fe lp lq lr ls b">height</code>)和我们需要的三个刻度——X轴和Y轴的刻度以及我们将用来设置图表颜色的色标。然后，我们将在<code class="fe lp lq lr ls b">svg</code>变量中存储一个元素，该元素是我们可视化的其他元素的容器。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="4e1f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新源数据数组中每个元素的<code class="fe lp lq lr ls b">date</code>和<code class="fe lp lq lr ls b">percent</code>属性，分别将它们的值从字符串转换为日期对象和从字符串转换为数字。</p><p id="6e32" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后，我们可以为我们的规模设置域。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/239f8514ce8d52262cf459aa5a817659.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*fe2NRaClIyudQ_CvwC65lg.png"/></div></figure><p id="f3ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义X轴和Y轴，并将它们添加到页面中。</p><p id="f6e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我们已经将<code class="fe lp lq lr ls b">tickSize</code>设置为X轴等于图形的宽度，Y轴等于高度。因此，我们在图形区域有网格。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7858" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以在图表上画线了。在对原始数据集进行一些操作后，我们得到一个对象(存储在<code class="fe lp lq lr ls b">regions</code>变量中),其形式为:键——区域id，值——适当区域的数据数组。我们使用区域id数组进行数据绑定。因此，我们可以这样设置<code class="fe lp lq lr ls b">d</code>属性的值:</p><pre class="le lf lg lh gt mo ls mp mq aw mr bi"><span id="4b1f" class="ms lu iq ls b gy mt mu l mv mw">.attr('d', regionId =&gt; lineGenerator(regions[regionId]))</span></pre><p id="8faa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当<a class="ae lb" href="https://codepen.io/levvsha/pen/NwMxNr" rel="noopener ugc nofollow" target="_blank">图表建立</a>时，我们可以看到我们的问题。有许多行，它们相互重叠，所以用户很难从这些混乱的行中获得任何有用的信息。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mx"><img src="../Images/0e49ff9a6f1014dbf1a874371e7713e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s99xrXmOwd-p22QUljfdvA.png"/></div></div></figure><p id="2689" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文的以下部分中，我们将尝试为用户增加最大的机会来解决这个问题，并使图表具有交互性。我们首先添加的是图例。没有它，图表就没有意义。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="964d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面的部分将有这样的结构:在开始，我将把链接放在我们在先前的特性完成之后的代码和我们在当前的特性实现之后的代码之间的差异上。之后，我们将回顾更改/添加的代码的关键片段，最后，您可以启动内置的演示程序，看看它是如何工作的。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="2b9e" class="ms lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">添加图例并能够控制线的可见性</h2><p id="6705" class="pw-post-body-paragraph kf kg iq kh b ki nq jr kk kl nr ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated"><a class="ae lb" href="https://github.com/levvsha/d3-in-all-its-glory-en/commit/b349e66a1201c95140e41b3b444c9e243f2f3ff8?diff=split" rel="noopener ugc nofollow" target="_blank"> <em class="lc">更改了代码</em> </a></p><p id="8a3e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了图例，我们还将实现一个功能，通过单击适当的图例项来控制图表线条的可见性。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7a72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将区域名称保存为值，区域id保存为<code class="fe lp lq lr ls b">regionNamesById</code>变量中的键。</p><p id="1b18" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将改变先前存储在<code class="fe lp lq lr ls b">regions</code>变量中的对象的结构，现在我们不仅存储某个区域的数据数组(<code class="fe lp lq lr ls b">data</code>属性)，还存储该区域的直线在图表上的可见性状态(<code class="fe lp lq lr ls b">enabled</code>属性)。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="30cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在图形的右侧，我们显示了区域列表及其对应的线条颜色。在图例元素上添加点击事件监听器(<code class="fe lp lq lr ls b">clickLegendRectHandler</code>功能)。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8e8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们将更改该区域的<code class="fe lp lq lr ls b">enabled</code>属性的值。然后重新运行渲染图形的功能<code class="fe lp lq lr ls b">redrawChart</code>:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="41e7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过过滤区域的id数组，我们将只得到启用了可见性的区域。</p><p id="edf2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">筛选的数组用于数据绑定。因为图形将被重绘，所以在添加新的DOM节点之前，您应该记住删除旧的DOM节点:<code class="fe lp lq lr ls b">paths.exit().remove()</code>。运行下面的代码笔演示，看看它是如何工作的。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="nv mm l"/></div></figure><p id="b8c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，我们还添加了链接“全部隐藏”和“全部显示”(参见字符串143的源代码)。这个图形对用户来说已经变得更加友好了。我们可以隐藏所有的线条，选择我们感兴趣的区域。但是让我们想想我们还能如何改善用户与图表的交互。</p><p id="77ae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于当前的实现，用户要改变他感兴趣的行的可见性有点困难。他应该在图例中的区域名称中用适当的颜色直观地找到该项目。</p><p id="2463" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，我们能做些什么来帮助用户吗？答案是肯定的。D3.js对此有一个特殊的布局。</p><h2 id="b7a9" class="ms lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">添加Voronoi图</h2><p id="08aa" class="pw-post-body-paragraph kf kg iq kh b ki nq jr kk kl nr ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated"><a class="ae lb" href="https://github.com/levvsha/d3-in-all-its-glory-en/commit/f9dbae0876f9715ba6273072f6f3ba06ca65fd94?diff=split" rel="noopener ugc nofollow" target="_blank"> <em class="lc">修改代码</em> </a></p><blockquote class="nw nx ny"><p id="3c0c" class="kf kg lc kh b ki kj jr kk kl km ju kn nz kp kq kr oa kt ku kv ob kx ky kz la ij bi translated">一组“点”(点)的Voronoi图是划分平面的区域的集合。每个区域对应于其中一个站点，并且一个区域中的所有点都比任何其他站点更靠近相应的站点。</p></blockquote><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi oc"><img src="../Images/1b6be6a1229d2d07e75beec4c10e026c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8ECXHqSAfOHb6rt9_hmJPw.gif"/></div></div></figure><p id="3900" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在这一节的开头添加了一个工作示例的链接，这样您就可以先了解它是如何工作的，然后再关注实现细节。运行以下示例，激活“显示Voronoi”复选框，并尝试通过单击图例项或单击图形区域来更改某些区域的线条可见性。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="nv mm l"/></div></figure><p id="4e15" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，只要鼠标光标在图形区域上，我们就可以将当前光标位置与图表上最近的数据点相关联，并激活一条线(增加粗细)。看例子。如您所见，这极大地简化了图表线的选择。单击后，我们隐藏除活动行之外的所有其他行(再次单击会返回到之前的状态)。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="176e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">库的创建者为我们实现了整个复杂的数学算法。我们只需要定义函数来计算X和Y位置，并将应该发生分区的区域的左上角和右下角的坐标传递给适当的方法。将作为添加多边形容器的元素保存到<code class="fe lp lq lr ls b">voronoiGroup</code>变量。我们将通过切换<code class="fe lp lq lr ls b">voronoi-show</code>类来控制多边形边界的可见性。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="01c5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们可以调用<code class="fe lp lq lr ls b">voronoi.polygons</code>方法，将初始数据作为第一个参数传递。这个调用返回一个绘制多边形的坐标数组。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7c8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在<code class="fe lp lq lr ls b">mouseover</code>事件处理程序中添加<code class="fe lp lq lr ls b">region-hover</code>类(增加线条粗细)并在<code class="fe lp lq lr ls b">mouseout</code>事件处理程序中移除它。在<code class="fe lp lq lr ls b">click</code>事件处理程序中，我们将隐藏除当前行之外的所有行，或者将图表返回到之前的状态。</p><p id="91d9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实现的特性告诉我们如何改进图表。现在，当我们在图表区域上移动时有一个活动的数据点，为什么我们不在图例附近显示每个区域的利率值呢？</p><p id="be53" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，用户只能在心里画一条垂直于Y轴的线来确定近似值。</p><h2 id="8a6a" class="ms lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">将鼠标悬停在图表区域上时显示值。</h2><p id="7801" class="pw-post-body-paragraph kf kg iq kh b ki nq jr kk kl nr ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated"><a class="ae lb" href="https://github.com/levvsha/d3-in-all-its-glory-en/commit/ba98a0b2caee0fd2378ce4148318ccfa723e4605" rel="noopener ugc nofollow" target="_blank"> <em class="lc">更改了代码</em> </a></p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi od"><img src="../Images/7e482ebaca33e9310b269a0c204ac19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*kZb94MrItO0lT4kzpFfobA.png"/></div></figure><p id="4d63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">向每个图例项追加文本元素。我们将在这里显示一个适当的地区利率值。日-月-年格式的相应日期将显示在该列表上方(<code class="fe lp lq lr ls b">legendsDate</code>)。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="68fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">填写<code class="fe lp lq lr ls b">percentsByDate</code>变量，这样我们可以通过以下方式获得给定地区特定日期的利率值:</p><pre class="le lf lg lh gt mo ls mp mq aw mr bi"><span id="3165" class="ms lu iq ls b gy mt mu l mv mw">percentsByDate[/* date */][/* region ID */]</span></pre><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="4753" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在每次光标穿过Voronoi图段时更新这些值。</p><p id="94f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，我们将为显示当前在活动行上高亮显示的日期的点设置偏移量(变量<code class="fe lp lq lr ls b">hoverDot</code>中的元素)。运行下面的例子，看看结果。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="nv mm l"/></div></figure><p id="e2ce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">增加图形交互性的下一项技术是缩放图形的能力。考虑到我们现有的数据密度，这将非常有用。</p><h2 id="2896" class="ms lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">增加缩放图表的能力。</h2><p id="c53b" class="pw-post-body-paragraph kf kg iq kh b ki nq jr kk kl nr ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated"><a class="ae lb" href="https://github.com/levvsha/d3-in-all-its-glory-en/commit/3bcc6b5d1aa65db85557c660f368e71e45d17f34?diff=split" rel="noopener ugc nofollow" target="_blank"> <em class="lc">更改了代码</em> </a></p><p id="f69e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">D3.js的另一个显著特性是缩放特定区域的能力(<code class="fe lp lq lr ls b"><a class="ae lb" href="https://github.com/d3/d3-zoom" rel="noopener ugc nofollow" target="_blank">d3.zoom</a></code>)，它只需要几行代码。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="8749" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建缩放行为，我们应该指定最小和最大允许的缩放因子(<code class="fe lp lq lr ls b">scaleExtent</code>)，限制翻译区域(<code class="fe lp lq lr ls b">translateExtent</code>，并附加<code class="fe lp lq lr ls b">start</code>和<code class="fe lp lq lr ls b">zoom</code>事件监听器。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="ce1a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用<code class="fe lp lq lr ls b"><a class="ae lb" href="http://tutorials.jenkov.com/svg/clip-path.html" rel="noopener ugc nofollow" target="_blank">clipPath</a></code> <a class="ae lb" href="http://tutorials.jenkov.com/svg/clip-path.html" rel="noopener ugc nofollow" target="_blank">来裁剪由于缩放</a>而位于图表区域之外的元素。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="39c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lp lq lr ls b">zoom</code>事件处理程序的函数中，使用事件对象<code class="fe lp lq lr ls b">d3.event.transform</code>的参数，我们获得坐标轴刻度的新值(<code class="fe lp lq lr ls b">rescaledX</code>和<code class="fe lp lq lr ls b">rescaledY</code>)，并使用它们来更新坐标轴上的刻度和绘制图形的刻度线。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1b7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用线生成器的<code class="fe lp lq lr ls b">rescaledX</code>和<code class="fe lp lq lr ls b">rescaledY</code>值，并且在Voronoi多边形的<code class="fe lp lq lr ls b">mouseover</code>事件处理程序中设置指针点的偏移量。</p><p id="1e02" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将添加一个“重置缩放”按钮，以便用户可以通过单击将图形恢复到初始状态。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="nv mm l"/></div></figure><p id="aa9e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在最后一步，让我们修复一个小缺陷，它是由图形的缩放比例引起的。缩放后，用户并不十分了解比例放大了多少，隐藏在缩放部分后面的区域有多大，以及图表在超出缩放部分后的表现如何。</p><h2 id="bdf7" class="ms lu iq bd lv nf ng dn lz nh ni dp md ko nj nk mf ks nl nm mh kw nn no mj np bi translated">添加图表预览</h2><p id="a4b1" class="pw-post-body-paragraph kf kg iq kh b ki nq jr kk kl nr ju kn ko ns kq kr ks nt ku kv kw nu ky kz la ij bi translated"><a class="ae lb" href="https://github.com/levvsha/d3-in-all-its-glory-en/commit/e9195cc192ff02c26e55b12f55ab3d4aa247eebf?diff=split" rel="noopener ugc nofollow" target="_blank"> <em class="lc">改变了代号</em> </a></p><p id="8690" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以gif开始这一部分，展示它是如何工作的:</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi oe"><img src="../Images/53d38ad839890aa67aad65dda9050d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DSUpzKQEK16hCRenP37DgA.gif"/></div></div></figure><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="3d26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图形的预览区域将比区域本身小四倍。将该值保存在一个<code class="fe lp lq lr ls b">ratio</code>变量中。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="55ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义在预览中生成图形线条的比例和功能。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9dcb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，预览将由一行(我们将只显示一行，最后活动的行)和两个<code class="fe lp lq lr ls b">rect</code>元素组成:一个静态背景和一个缩放时将改变其大小的元素(存储在变量<code class="fe lp lq lr ls b">draggedNode</code>中)。我们还将实现用鼠标使用<a class="ae lb" href="https://github.com/d3/d3-drag" rel="noopener ugc nofollow" target="_blank"> d3拖动行为</a>来移动这个元素的能力。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="bb75" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lp lq lr ls b">dragged</code>函数中，我们将更新被拖动元素本身的<code class="fe lp lq lr ls b">x</code>和<code class="fe lp lq lr ls b">y</code>属性的值，并以编程方式为缩放的图表区域设置转换值。</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="3154" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lp lq lr ls b">zoom</code>事件处理函数中，我们将计算并更新<code class="fe lp lq lr ls b">draggedNode</code>元素的<code class="fe lp lq lr ls b">x</code>、<code class="fe lp lq lr ls b">y</code>、<code class="fe lp lq lr ls b">width</code>和<code class="fe lp lq lr ls b">height</code>属性，以确保该元素覆盖预览中的适当区域。</p><p id="f457" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">绘制活动行的预览在<code class="fe lp lq lr ls b">redrawChart</code>和<code class="fe lp lq lr ls b">voronoiMouseover</code>函数中(分别参见第328行和第405行的代码)。</p><p id="a2d5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，是最后一个演示，包括我们在本文中所做的一切:</p><figure class="le lf lg lh gt li"><div class="bz fp l di"><div class="nv mm l"/></div></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="cb7b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完美是不可企及的，我们可以想出几个其他的方法来改善这种形象化。例如，使用<a class="ae lb" href="https://github.com/d3/d3-brush" rel="noopener ugc nofollow" target="_blank"> d3-brush </a>，我们可以实现<a class="ae lb" href="https://bl.ocks.org/mbostock/f48fcdb929a620ed97877e4678ab15e6" rel="noopener ugc nofollow" target="_blank">选择图形的任意区域，随后进行缩放</a>。但是，我们在本文中实现的内容足以看出该库的功能有多广泛。感谢许多基于D3.js的库(如<a class="ae lb" href="http://c3js.org/" rel="noopener ugc nofollow" target="_blank"> C3.js </a>、<a class="ae lb" href="https://emeeks.github.io/semiotic/" rel="noopener ugc nofollow" target="_blank">symbol signal</a>、<a class="ae lb" href="https://naver.github.io/billboard.js/" rel="noopener ugc nofollow" target="_blank"> Billboard.js </a>)，它们简化了创建配置对象定义的可视化任务，我仍然是“纯D3.js”的信徒。我确信，这是那些具有长期支持和开发的潜在高概率的项目取得成功的最可靠的方式。</p></div></div>    
</body>
</html>