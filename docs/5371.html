<html>
<head>
<title>Setup a Private Git-Repository in Kubernetes with Gitea</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Gitea在Kubernetes中设置一个私有的Git库</h1>
<blockquote>原文：<a href="https://itnext.io/setup-a-private-git-repository-in-kubernetes-with-gitea-64f5ea1e5070?source=collection_archive---------3-----------------------#2021-02-19">https://itnext.io/setup-a-private-git-repository-in-kubernetes-with-gitea-64f5ea1e5070?source=collection_archive---------3-----------------------#2021-02-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bd1abee3b82812f45ed9289eca119a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnVTDOIO9UmmshvrArfb3w.png"/></div></div></figure><p id="e497" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您的Kubernetes集群上需要一个私有的Git-repository，那么这里是学习如何设置它的合适地方。</p><p id="5a34" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Gitea将被用作存储库。它带有一个整洁的舵图，使生活变得更加容易。</p><p id="b70b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果还没有完成，首先需要安装头盔。</p><h2 id="c6e6" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">舵安装</h2><p id="54d8" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">有几种方法可以安装头盔。</p><p id="54b2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我在macOS上，可以用脚本安装它:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="c1a9" class="kz la it mc b gy mg mh l mi mj">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3<br/>chmod 700 get_helm.sh<br/>cat get_helm.sh</span></pre><p id="f7ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者使用<code class="fe mk ml mm mc b">homebrew</code>，这是更快的方法:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="e835" class="kz la it mc b gy mg mh l mi mj">brew install helm</span></pre><h2 id="5eaa" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">Gitea安装</h2><p id="a262" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">首先需要添加图表回购:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="6e15" class="kz la it mc b gy mg mh l mi mj">helm repo add gitea-charts <a class="ae mn" href="https://dl.gitea.io/charts/" rel="noopener ugc nofollow" target="_blank">https://dl.gitea.io/charts/</a></span></pre><p id="7c02" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果不需要覆盖默认值，那么安装Gitea就像运行以下命令一样简单:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="b8d9" class="kz la it mc b gy mg mh l mi mj">helm install gitea gitea-charts/gitea</span></pre><p id="aa69" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">默认情况下，Gitea将<a class="ae mn" href="https://stackoverflow.com/q/52707840/1065468" rel="noopener ugc nofollow" target="_blank">配置为无头</a>。但是我需要一个内部IP地址。</p><p id="1d66" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此我创建了文件<code class="fe mk ml mm mc b">gitea-values.yaml</code></p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="8089" class="kz la it mc b gy mg mh l mi mj">service:<br/>  http:<br/>    type: ClusterIP<br/>    port: 3000<br/>    clusterIP:<br/>  ssh:<br/>    type: ClusterIP<br/>    port: 22<br/>    clusterIP:</span></pre><p id="6cc8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用以下命令在这些值被覆盖的情况下运行安装:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="a470" class="kz la it mc b gy mg mh l mi mj">helm install --values gitea-values.yaml gitea gitea-charts/gitea</span></pre><p id="6927" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果应该是这样的:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="df30" class="kz la it mc b gy mg mh l mi mj">NAME: gitea<br/>LAST DEPLOYED: Thu Feb 18 21:30:29 2021<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>NOTES:<br/>1. Get the application URL by running these commands:<br/>  echo "Visit http://127.0.0.1:3000 to use your application"<br/>  kubectl --namespace default port-forward svc/gitea-http 3000:3000</span></pre><p id="f14d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很好，他们甚至提供了如何将pods端口转发到本地机器的命令:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="ff1e" class="kz la it mc b gy mg mh l mi mj">kubectl --namespace default port-forward svc/gitea-http 3000:3000</span></pre><p id="2009" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Gitea已经启动并运行，可以通过<code class="fe mk ml mm mc b">localhost:3000</code>下的本地工作站网络浏览器进行访问。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a9669dbcb80af0388409e2b422991141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJmS8QLL4e7Sb9SrUpBaPQ.png"/></div></div></figure><p id="fa1a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">初始管理员用户<code class="fe mk ml mm mc b">gitea_admin</code>的密码可以在舵图的<code class="fe mk ml mm mc b"><a class="ae mn" href="https://gitea.com/gitea/helm-chart/src/branch/master/values.yaml" rel="noopener ugc nofollow" target="_blank">values.yaml</a></code>中找到:<code class="fe mk ml mm mc b">r8sA8CPHD9!bt6d</code></p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2cb06352a2da6f19f65e8961d6c1903b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OuYDES6LdWTMsROozznAdg.png"/></div></div></figure><h2 id="64fe" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">添加第一个项目</h2><p id="0db4" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">通过按下“+”按钮并选择“新建存储库”来创建新的存储库</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3d672ffa1201e189f1dd86916e498b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNGxWuOVtu3YJhR_CpSlMw.png"/></div></div></figure><p id="f1ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">必须填写几个值，例如，必须选择所有者并提供存储库名称。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/25fd571912eb6f5b9e91be1b2b3be36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GdjrWt-7aRp1xTdKBQ-hkQ.png"/></div></div></figure><p id="ad56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">准备就绪后，按“创建存储库”</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1057a74f2935cf7ddabe5cb413e8b5c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ea5DrUL6rRfc8tenLRBgoQ.png"/></div></div></figure><p id="be74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">存储库已经准备好，可以添加文件了。</p><p id="29da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击存储库名称时，所有步骤都会显示向新存储库添加文件需要完成的工作。</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/96e1f27027f86175154cf5c0b79e7199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qq8G3y5S5cgVkfa6gLi0sg.png"/></div></div></figure><p id="2f03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我在本地工作站上创建了一个新项目</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="1bcc" class="kz la it mc b gy mg mh l mi mj">$ mkdir my-java-project<br/>$ cd my-java-project/<br/>$ touch README.md</span></pre><p id="a1c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">初始化本地存储库</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="99e7" class="kz la it mc b gy mg mh l mi mj">$ git init<br/>Initialized empty Git repository in /Users/username/my-java-project/.git/</span></pre><p id="679d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">添加并提交所有文件:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="20f0" class="kz la it mc b gy mg mh l mi mj">$ git add README.md<br/>$ git commit -m "first commit"<br/>[master (root-commit) 1689222] first commit<br/> 1 file changed, 0 insertions(+), 0 deletions(-)<br/> create mode 100644 README.md</span></pre><p id="7333" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">目前一切都在本地存储库中。为了将所有内容推送到远程私有存储库，必须执行以下命令:</p><pre class="lx ly lz ma gt mb mc md me aw mf bi"><span id="4ce4" class="kz la it mc b gy mg mh l mi mj">$ git remote add origin http://127.0.0.1:3000/gitea_admin/my-java-project.git<br/><br/>$ git push -u origin master<br/><br/>Username for 'http://127.0.0.1:3000': gitea_admin<br/>Password for 'http://gitea_admin@127.0.0.1:3000':<br/>Counting objects: 3, done.<br/>Writing objects: 100% (3/3), 220 bytes | 220.00 KiB/s, done.<br/>Total 3 (delta 0), reused 0 (delta 0)<br/>remote: . Processing 1 references<br/>remote: Processed 1 references in total<br/>To http://127.0.0.1:3000/gitea_admin/my-java-project.git<br/> * [new branch]      master -&gt; master<br/>Branch master set up to track remote branch master from origin.</span></pre><p id="6e96" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">瞧，一切正常！</p><figure class="lx ly lz ma gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bd1abee3b82812f45ed9289eca119a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnVTDOIO9UmmshvrArfb3w.png"/></div></div></figure><p id="23f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢阅读！喜欢吗？<a class="ae mn" href="https://www.buymeacoffee.com/twissmueller" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">给我买杯咖啡！</strong>T11】</a></p><h2 id="43b8" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">资源</h2><ul class=""><li id="a3ed" class="mo mp it kd b ke ls ki lt km mq kq mr ku ms ky mt mu mv mw bi translated">Gitea:喝一杯茶</li><li id="472c" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated"><a class="ae mn" href="https://docs.gitea.io/en-us/install-on-kubernetes/" rel="noopener ugc nofollow" target="_blank">带头盔的安装(在Kubernetes上)</a></li><li id="bbfd" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated"><a class="ae mn" href="https://gitea.com/gitea/helm-chart/#configuration" rel="noopener ugc nofollow" target="_blank"> Gitea舵图</a></li><li id="4051" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated"><a class="ae mn" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">安装舵</a></li></ul></div></div>    
</body>
</html>