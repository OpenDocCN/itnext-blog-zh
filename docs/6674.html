<html>
<head>
<title>Blockchain chat server application written in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Solidity写的区块链聊天服务器应用</h1>
<blockquote>原文：<a href="https://itnext.io/blockchain-chat-server-application-written-in-solidity-5e929c0e4c9f?source=collection_archive---------3-----------------------#2022-01-24">https://itnext.io/blockchain-chat-server-application-written-in-solidity-5e929c0e4c9f?source=collection_archive---------3-----------------------#2022-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c6c31f5c786933a7da6fb81d748eb7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPqgN1MRDhEfrSw7bJZGwA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片<a class="ae kc" href="https://unsplash.com/photos/V5vqWC9gyEU" rel="noopener ugc nofollow" target="_blank">来源</a> | <a class="ae kc" href="https://unsplash.com/@lunarts" rel="noopener ugc nofollow" target="_blank">沃洛季米尔·赫里先科</a></figcaption></figure><h1 id="8d1b" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="f7c4" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在过去的几周里，我想知道如何使用区块链技术来改进聊天应用程序。经过一些研究，我发现了这个叫做<a class="ae kc" href="https://status.im/" rel="noopener ugc nofollow" target="_blank">状态</a>的很酷的项目。</p><p id="4dc1" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">作为一名好奇的开发人员，我想知道智能合约如何充当安全聊天服务器，以及它们如何将该聊天作为前端应用程序的“API”公开。</p><p id="0c73" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">所以我决定开始自己的项目，Solidity中一个非常简单的<strong class="ld ir">聊天服务器应用。</strong></p><h1 id="2b9c" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">编写应用程序</h1><p id="ac9c" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，我们必须了解如何架构应用程序，因为要解决的主要问题是模仿一个带有<strong class="ld ir">智能合约的常规服务器聊天应用程序。</strong></p><p id="a447" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在一个简单的聊天应用程序中，我们有两个用户在单个聊天实例中互相发送文本。这个聊天可以是一个数据库表，在每一行中包含一个带有<code class="fe me mf mg mh b">from</code>、<code class="fe me mf mg mh b">to</code>和<code class="fe me mf mg mh b">message</code>的消息。</p><p id="73cb" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在这种情况下，我们将创建一个智能合同，用合同状态变量替换该数据库，让我们开始吧。</p><h2 id="6062" class="mi ke iq bd kf mj mk dn kj ml mm dp kn lm mn mo kr lq mp mq kv lu mr ms kz mt bi translated">创建合同</h2><p id="9a9e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们从简单的开始，我们应该定义的第一件事是将作为聊天服务器工作的契约。为此，我们可以开始创建一个非常简单的契约，其中我们将定义一个消息结构。</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="c96d" class="mi ke iq bd kf mj mk dn kj ml mm dp kn lm mn mo kr lq mp mq kv lu mr ms kz mt bi translated">接收消息</h2><p id="14ef" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">聊天应用程序通常使用套接字来“监听”服务器应用程序，以防有新消息发送给用户。</p><p id="db32" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在Solidity中，通过事件来告诉前端发生了什么，所以我们将使用它来接收消息。</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="ca84" class="mi ke iq bd kf mj mk dn kj ml mm dp kn lm mn mo kr lq mp mq kv lu mr ms kz mt bi translated">发送消息</h2><p id="bafe" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">对于触发智能合约中的动作，我们可以像在其他编程语言上一样，通过调用函数来完成，因此在这种情况下，我们将调用智能合约中的一个函数来创建新消息并运行<code class="fe me mf mg mh b">sendMessageEvent</code>，以便告诉接收者新消息已经发送。</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="0344" class="mi ke iq bd kf mj mk dn kj ml mm dp kn lm mn mo kr lq mp mq kv lu mr ms kz mt bi translated">列出邮件</h2><p id="aee2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">聊天的一个非常重要的功能是，不仅能够作为用户发送和接收消息，还可以列出我们在对话过程中相互发送的所有旧消息。</p><p id="0187" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为此，Solidity编程语言有一个方便的类型，叫做<code class="fe me mf mg mh b">mapping</code>。使用这种数据类型，我们可以存储由索引映射的数据数组。</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="9094" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">现在的问题是，messageList总是空的，为了加载这个列表，我们需要更改<code class="fe me mf mg mh b">sendMessage </code>函数，以便在每次发送一条消息时在映射中加载新消息。</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="9ada" class="mi ke iq bd kf mj mk dn kj ml mm dp kn lm mn mo kr lq mp mq kv lu mr ms kz mt bi translated">部署合同</h2><p id="cf34" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">这一步超出了本文的范围，但是有许多平台可以让您以一种非常简单的方式针对您的前端应用程序测试您自己的契约。最流行的是<a class="ae kc" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix </a>，你可以写合同，部署到某个测试链，开始玩😄。</p><h1 id="84b6" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="32d2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我对区块链以及它如何被用来重新创造老问题的解决方案感到非常兴奋。增加额外的功能，如安全性，货币化和奖励。</p><p id="8de0" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">区块链最大的好处不仅在于它为存储信息提供了一个巨大的基础设施，而且信息是安全的、可访问的和分散的。</p><p id="e475" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我相信，在不久的将来，没有人会接触到你的私人信息或你与其他人的聊天对话，我们的信息将是真正的私人信息，而这种隐私将只属于我们自己。</p></div></div>    
</body>
</html>