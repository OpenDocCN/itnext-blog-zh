<html>
<head>
<title>Using Consul to configure API Gateway with Envoy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Consul通过Envoy配置API网关</h1>
<blockquote>原文：<a href="https://itnext.io/using-consul-to-configure-api-gateway-with-envoy-89870ea4c67?source=collection_archive---------2-----------------------#2019-08-30">https://itnext.io/using-consul-to-configure-api-gateway-with-envoy-89870ea4c67?source=collection_archive---------2-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="145f" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">API网关是管理云后端访问的一种流行解决方案，但通常受限于它们所支持的环境。入口和API网关的现代解决方案倾向于依赖Kubernetes或特定的云提供商来正常工作。</p><p id="c2d7" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">本文深入探讨Gloo，这是一个基于Envoy的现代API网关，它可以使用Consul代替Kubernetes进行服务发现、配置和访问控制。</p><p id="aa7f" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated"><a class="ae ks" href="https://youtu.be/7Mk5r9P4kb0" rel="noopener ugc nofollow" target="_blank">点击此处</a>跳过阅读，直接进入一个录制的演示，在游牧者、执政官和金库(使用Gloo)上运行Envoy作为API网关。</p></blockquote><p id="e696" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">DataDog在2018年进行的一项研究显示，只有25%的客户工作负载采用了Docker进行容器化，其中不到50%的客户使用了Kubernetes等编排系统。</p><p id="0a46" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">诸如服务网格和API网关等尖端技术正在增强我们协调IT的能力，但它们通常需要以迁移到最新可用技术为代价。这一事实在云生态系统中留下了快速新兴技术与其自身采用挑战之间的鸿沟。</p><p id="e8d3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">但是许多还没有迁移到Kubernetes的工作负载已经远远落在了后面。</p><p id="2eb1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">在<a class="ae ks" href="https://www.solo.io" rel="noopener ugc nofollow" target="_blank"> Solo.io </a>，我们构建软件解决方案，帮助客户从单一/传统架构过渡到现代基础设施。任何特性的首要考虑是我们将如何支持非Kubernetes环境，以及工作负载在Kubernetes上运行和不运行的混合环境。</p><p id="25d2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">这在<strong class="jw iu"> Gloo </strong>中尤为重要，Solo.io的<a class="ae ks" href="https://www.solo.io/" rel="noopener ugc nofollow" target="_blank"> Envoy-Powered API Gateway </a>承诺将分布式应用组件“粘合在一起”，形成商业价值的逻辑单元。原则上，API网关的功能是将独立的后端服务统一到一个面向客户端的入口点。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi kw"><img src="../Images/7edfda123af417cc1e2b0e2d12e96378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/0*SFPTvhal3_h6P_34.jpg"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">API网关图。来源:<a class="ae ks" href="https://microservices.io/patterns/apigateway.html" rel="noopener ugc nofollow" target="_blank">https://microservices.io/patterns/apigateway.html</a></figcaption></figure><p id="0e04" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">当API网关只能在基础设施的一个分区内工作时，它提供的价值是有限的。它的路由能力将受到限制，并且除非基础设施本身全部位于一个环境中，否则不可能创建统一的入口点。</p><p id="4536" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">凭借其<a class="ae ks" href="https://gloo.solo.io/v1/github.com/solo-io/gloo/projects/gloo/api/v1/plugins.proto.sk/" rel="noopener ugc nofollow" target="_blank">插件架构</a>和<a class="ae ks" href="https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc" rel="noopener ugc nofollow" target="_blank">独立的控制平面/数据平面</a>架构，Gloo支持轻松扩展到任何后端，而不管用于部署它的应用程序堆栈或基础架构如何。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi li"><img src="../Images/13898549374dc144d08b14ecb73faaf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*utdDHRSnKjfeLMzK.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">Gloo的API网关插件生态系统</figcaption></figure><p id="0823" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">我们扩展了Gloo作为<a class="ae ks" href="https://consul.io" rel="noopener ugc nofollow" target="_blank">hashi corp consult</a>的API网关，以提供三个特性:</p><ul class=""><li id="9582" class="ln lo it jw b jx jy kb kc kt lp ku lq kv lr kr ls lt lu lv bi translated">服务发现</li><li id="9c2d" class="ln lo it jw b jx lw kb lx kt ly ku lz kv ma kr ls lt lu lv bi translated">配置存储</li><li id="d49f" class="ln lo it jw b jx lw kb lx kt ly ku lz kv ma kr ls lt lu lv bi translated">访问控制</li></ul><p id="45e7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated"><a class="ae ks" href="https://consul.io" rel="noopener ugc nofollow" target="_blank">consult</a>是一个流行的基础设施工具，可以用作分布式键值存储(类似于<a class="ae ks" href="https://github.com/etcd-io/etcd" rel="noopener ugc nofollow" target="_blank"> etcd </a>)，以及服务发现后端，存储IP、端口、健康信息和关于所发现服务的元数据。</p><p id="3555" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Gloo可以直接插入到Consul中，不需要Kubernetes作为配置和服务发现的来源。将Gloo插入Consul时:</p><p id="9e31" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Consul服务目录中的所有服务都成为Gloo的可路由端点:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mb"><img src="../Images/13148b53f7a0f4e773ef0c209663a9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4fdOVXXCxsN6xm2PZX_fw.png"/></div></div></figure><pre class="kx ky kz la gt mc md me mf aw mg bi"><span id="61e3" class="mh mi it md b gy mj mk l ml mm">curl localhost:8080/ -H "Host: petstore"</span><span id="4c0f" class="mh mi it md b gy mn mk l ml mm">[<br/>  {<br/>    "id": 1,<br/>    "name": "Dog",<br/>    "status": "available"<br/>  },<br/>  {<br/>    "id": 2,<br/>    "name": "Cat",<br/>    "status": "pending"<br/>  }<br/>]</span></pre><p id="2b00" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">和Gloo配置可以在Consul键值存储中直接查看和修改:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mo"><img src="../Images/4040eeed5943fffa4e581556196a0f9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8dXs4GWtdY3Gsi97wJpAzw.png"/></div></div></figure><p id="08ea" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Consul配置在数据中心之间复制，允许使用一个Consul代理配置API网关配置，并在任意数量的数据中心之间共享。</p><p id="bd79" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">多租户环境中的管理员可以使用<a class="ae ks" href="https://learn.hashicorp.com/consul/security-networking/production-acls" rel="noopener ugc nofollow" target="_blank"> Consul ACL令牌</a>设置策略和权限，保护对敏感路由配置的访问:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi mp"><img src="../Images/cfe1638ea7cf698da7c94117e7d26baf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpYjGEKiGeEFo-p4V0Ajnw.png"/></div></div></figure><p id="68f5" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">由于没有与应用程序运行时相结合，Consul仍然是Kubernetes内外工作负载的配置、服务发现、健康检查和访问控制的首选。如果你是consult或Gloo的新手，我们鼓励你<a class="ae ks" href="https://gloo.solo.io/installation/gateway/docker-compose-consul/" rel="noopener ugc nofollow" target="_blank">通过consult</a>查看本地运行Gloo API网关的简短教程。不需要minikube！</p><p id="5a9d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">下面是同一个教程的视频:</p><figure class="kx ky kz la gt lb"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="f259" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">在未来的帖子中，我们将介绍Gloo如何利用HashiCorp Nomad进行部署，以及如何利用HashiCorp Vault进行凭证管理。涵盖所有3个组成部分的完整教程可以在这里找到:<a class="ae ks" href="https://gloo.solo.io/installation/gateway/nomad/" rel="noopener ugc nofollow" target="_blank">https://gloo.solo.io/installation/gateway/nomad/</a>。</p><p id="131b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">感谢阅读，敬请关注更多博客和来自<a class="ae ks" href="https://www.solo.io" rel="noopener ugc nofollow" target="_blank"> Solo.io </a>的精彩开源软件！</p></div><div class="ab cl ms mt hx mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="im in io ip iq"><p id="4ead" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">[1]:数据狗。(2018年6月)。<em class="jv">关于真实码头工人收养的8个令人惊讶的事实</em>https://www.datadoghq.com/docker-adoption/ T4</p><p id="8390" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">[2]:不可否认，这是对云技术功能的过度简化。</p></div></div>    
</body>
</html>