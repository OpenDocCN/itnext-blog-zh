<html>
<head>
<title>Kubernetes Journey — Up and running out of the cloud — Linux Image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes之旅—启动并运行云计算— Linux映像</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-linux-image-c51953e50d0e?source=collection_archive---------4-----------------------#2019-10-12">https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-linux-image-c51953e50d0e?source=collection_archive---------4-----------------------#2019-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/71d4d7f50888cacc0dab78443dce5d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilv3FwnewlHaWNqpB1Qd2A.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/photos/KNUp-YBwBSE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">张秀坤·东布罗夫斯基</a>在<a class="ae kc" href="https://unsplash.com/search/photos/reflection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="144f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">欢迎回到我们的<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5"> Kubernetes之旅</a>。我这边的事情真的很忙，自从我发表这个系列的最后一篇文章<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-flannel-c01283308f0e">关于法兰绒</a>已经有一段时间了。对此我很抱歉，我会努力保持良好的状态。</p><p id="4a5d" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在我们继续之前，您可能想回顾一下我们到目前为止所经历的一切。你可以在本文的末尾<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5">找到本系列所有文章的索引。</a></p><p id="2d85" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在我们的第9篇文章中，我们将配置<strong class="km ir">Debian</strong>/<strong class="km ir">Ubuntu</strong>Linux映像，它将作为构成我们技术堆栈的所有其他组件的基础。要了解本系列接下来的文章，请看看我们的第三篇文章，<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-technology-stack-9c472aafac4e">技术栈</a>，在这里我们解释了什么是组件以及它们的用途。</p><p id="dd4e" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">说够了。让我们最后用一些酷的东西弄脏我们的手吧！</p><p id="763c" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">请记住，本主题中提到的信息在你根据需要采取的计划中具有相对重要性，你不一定要用铁腕手段来控制这个主题。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="b11f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">如果你不想等到所有的文章都发表了，又想马上动手，可以随意克隆项目的Github repo。它很实用，文档也在不断改进:</p><div class="li lj gp gr lk ll"><a href="https://github.com/mvallim/kubernetes-under-the-hood" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd ir gy z fp lq fr fs lr fu fw ip bi translated">罩下的姆瓦利姆/库伯内特斯</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">它甚至还包括一张幻灯片，解释了它吸引目标受众的原因…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz jw ll"/></div></div></a></div></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="d67f" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">分割</h1><p id="c13c" class="pw-post-body-paragraph kk kl iq km b kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh ij bi translated">配置Linux时要做的重大决定是如何划分硬盘空间。</p><p id="0ec2" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这里提出的设计允许在需要时进行动态增长和微调。在没有更多可用存储空间的情况下猝不及防，除了删除文件之外没有其他即时选项，这绝不是一种好的体验。必须考虑到系统的长期寿命和增长以及预算问题。</p><p id="43f1" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">隔离根卷，尤其是对于不会随时间增长太多的静态数据来说，是最主要的问题。将其他目录隔离在它们自己的卷中是这里采用的策略，这样它们的动态增长就不会影响根分区。在系统中填充根卷是一件非常糟糕的事情，应该不惜一切代价避免。通过隔离分区，我们有一系列的选项可以选择，例如，增加一个分区和/或减少另一个分区，因为卷不是100%被逻辑卷(分区)占用。</p><p id="7d4a" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">稍后可能会增加分区，但这是我们的卷在系统安装时最初的划分方式:</p><ul class=""><li id="54de" class="nd ne iq km b kn ko kr ks kv nf kz ng ld nh lh ni nj nk nl bi translated"><strong class="km ir"> boot </strong> — 512 Mb —引导加载程序文件(例如:kernel，initrd)。位于逻辑卷管理器(LVM)之外的单个空间</li><li id="7e58" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir">根</strong> — 2 Gb —操作系统(/bin、/lib、/etc、/sbin)</li><li id="8c8b" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir">首页</strong> — 2 Gb —用户目录。</li><li id="da05" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir"> opt </strong> — 1 Gb —静态应用程序包。</li><li id="84de" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir"> tmp </strong> — 1 Gb —临时文件。</li><li id="5929" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir"> usr </strong> — 10 Gb —共享用户数据的二级层次结构，限制只读访问。</li><li id="a18b" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir"> var </strong> — 10 Gb —“可变”文件，如日志、数据库、网页、邮件文件、容器图片等。</li></ul><blockquote class="nr ns nt"><p id="4fe1" class="kk kl nu km b kn ko kp kq kr ks kt ku nv kw kx ky nw la lb lc nx le lf lg lh ij bi translated"><em class="iq">参考:</em><a class="ae kc" href="http://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html" rel="noopener ugc nofollow" target="_blank"><em class="iq">http://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html</em></a></p></blockquote><h1 id="ee83" class="ma mb iq bd mc md ny mf mg mh nz mj mk ml oa mn mo mp ob mr ms mt oc mv mw mx bi translated">软件</h1><p id="caab" class="pw-post-body-paragraph kk kl iq km b kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh ij bi translated">有必要安装构成基本映像的软件包，以避免在基于该映像创建的其他虚拟机中重复工作。</p><p id="5dbd" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">由于我们使用VirtualBox作为我们的虚拟化系统，应该组成每个映像的一个重要软件是<a class="ae kc" href="https://docs.oracle.com/cd/E36500_01/E36502/html/qs-guest-additions.html" rel="noopener ugc nofollow" target="_blank"> VirtualBox访客添加</a>，以及它的依赖项。</p><p id="6818" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">要安装的软件如下:</p><ul class=""><li id="5526" class="nd ne iq km b kn ko kr ks kv nf kz ng ld nh lh ni nj nk nl bi translated">这个包包含了一个包的信息列表，这些包被认为是构建Debian包所必需的。这个包也依赖于列表中的包，这样就可以很容易地安装构建必需的包。</li><li id="764e" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated">模块助手<br/> 模块助手工具(也称为m-a)帮助用户和维护人员管理为Debian打包的外部Linux内核模块。它还包含一些基础设施，供Debian中附带的模块源码包中的构建脚本使用。</li><li id="1e4d" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated">resolvconf是一个框架，用于保持系统关于域名服务器的最新信息。它将自己设置为提供此信息的程序(如ifup和ifdown、DHCP客户端、PPP守护程序和本地名称服务器)和使用此信息的程序(如DNS缓存和解析程序库)之间的中介。</li><li id="5ad5" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated">ntp(网络时间协议)通过互联网或本地网络同步计算机时钟，或者通过遵循解释GPS、DCF-77、NIST或类似时间信号的精确硬件接收器，来保持计算机时钟准确。</li><li id="b17d" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated">sudo是一个允许系统管理员给用户有限的根权限并记录根活动的程序。基本理念是尽可能少地给予特权，但仍然允许人们完成他们的工作。</li><li id="e1cc" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir">Cloud-init<br/></strong>Cloud-init为基础设施即服务(IaaS)云平台提供了配置和定制虚拟机实例的框架和工具。例如，它可以设置默认的语言环境和主机名，生成SSH私有主机密钥，安装SSH公共密钥以便登录到默认帐户，设置临时挂载点，以及运行用户提供的脚本。</li><li id="b0f1" class="nd ne iq km b kn nm kr nn kv no kz np ld nq lh ni nj nk nl bi translated"><strong class="km ir">VirtualBox Guest Additions<br/></strong>VirtualBox Guest Additions由设备驱动程序和系统应用程序组成，可优化操作系统以获得更好的性能和可用性。本指南中要求的可用性功能之一是自动登录，这就是为什么您需要在虚拟机中安装来宾附件。</li></ul><blockquote class="nr ns nt"><p id="a9ea" class="kk kl nu km b kn ko kp kq kr ks kt ku nv kw kx ky nw la lb lc nx le lf lg lh ij bi translated"><em class="iq">参考:</em>apt-缓存显示包名</p></blockquote><h1 id="5f66" class="ma mb iq bd mc md ny mf mg mh nz mj mk ml oa mn mo mp ob mr ms mt oc mv mw mx bi translated">装置</h1><p id="20e1" class="pw-post-body-paragraph kk kl iq km b kn my kp kq kr mz kt ku kv na kx ky kz nb lb lc ld nc lf lg lh ij bi translated">请按照这里的步骤来。</p><p id="c9ab" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在下面的步骤中，我们将不会采用LVM和多卷分区，请再次记住，本主题中提到的信息在您将根据需要采用的计划中具有相对重要性，并且您不一定要用铁腕手段来解决这个问题。</p><h2 id="f8dc" class="od mb iq bd mc oe of dn mg og oh dp mk kv oi oj mo kz ok ol ms ld om on mw oo bi translated">或者，如果您喜欢下载基本映像</h2><h2 id="44f7" class="od mb iq bd mc oe of dn mg og oh dp mk kv oi oj mo kz ok ol ms ld om on mw oo bi translated">一种自由操作系统</h2><pre class="op oq or os gt ot ou ov ow aw ox bi"><span id="5c79" class="od mb iq ou b gy oy oz l pa pb">~$ cd ~/VirtualBox\ VMs/<br/>~$ curl -L --progress-bar "https://vms-image.s3.amazonaws.com/debian-base-image.tar.bz2" -o - | tar xjf -<br/>~$ vboxmanage registervm ~/VirtualBox\ VMs/debian-base-image/debian-base-image.vbox</span></pre><h2 id="89d6" class="od mb iq bd mc oe of dn mg og oh dp mk kv oi oj mo kz ok ol ms ld om on mw oo bi translated">人的本质</h2><pre class="op oq or os gt ot ou ov ow aw ox bi"><span id="3644" class="od mb iq ou b gy oy oz l pa pb">~$ cd ~/VirtualBox\ VMs/<br/>~$ curl -L --progress-bar "https://vms-image.s3.amazonaws.com/ubuntu-base-image.tar.bz2" -o - | tar xjf -<br/>~$ vboxmanage registervm ~/VirtualBox\ VMs/ubuntu-base-image/ubuntu-base-image.vbox</span></pre><p id="a827" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我希望你喜欢这篇文章以及这个系列的其他文章。现在我们已经准备好使用我们的基本映像，在下一篇文章中，我们将通过创建我们的<strong class="km ir">网关</strong>实例和一个<strong class="km ir"> BusyBox </strong>实例来开始部署我们的解决方案，这将帮助我们管理我们所有的实例。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="9cad" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">如果你认为这是有帮助的，请留下你的👏以及下面的反馈。不断完善这个系列的内容非常重要。</p><p id="64f2" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">同样，我强烈建议您在Medium上关注我，这样您就不会错过本系列中发表的任何新文章。如果你错过了这个系列的第一篇文章，你可以在这里查看<a class="ae kc" href="https://medium.com/@mtvallim/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5" rel="noopener"/>。</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="4669" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">回头见！！</p><p id="bc65" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">再见</p></div></div>    
</body>
</html>