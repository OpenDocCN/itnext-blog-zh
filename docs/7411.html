<html>
<head>
<title>Journey Of A Microservice Application In The Kubernetes World</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes世界的微服务应用之旅</h1>
<blockquote>原文：<a href="https://itnext.io/journey-of-a-microservice-application-in-the-kubernetes-world-d9493b19edff?source=collection_archive---------0-----------------------#2022-09-15">https://itnext.io/journey-of-a-microservice-application-in-the-kubernetes-world-d9493b19edff?source=collection_archive---------0-----------------------#2022-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9e45" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用GitOps和Argo CD进行连续部署</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3b2aca5701db84d39b093ebfc3eda82f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0O7VNtg__LIHgU8QjcR-Rg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在<a class="ae ky" href="https://unsplash.com/s/photos/loop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae ky" href="https://unsplash.com/@tine999?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Tine ivani</a>拍摄的照片</figcaption></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="734b" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="701f" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">在<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-e800579f0be3">的上一篇文章</a>中，我们将<a class="ae ky" href="https://webhooks.app/" rel="noopener ugc nofollow" target="_blank"> webhooks </a>应用程序部署到由<a class="ae ky" href="https://civo.com" rel="noopener ugc nofollow" target="_blank"> Civo </a>管理的Kubernetes集群中。我们现在将更接近应用程序工作流，并使用GitOps来设置CI/CD管道的持续部署部分。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="e59e" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">本系列文章</h2><ul class=""><li id="5ba0" class="mv mw it me b mf mg mi mj lp mx lt my lx mz mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-bdfe795532ef">web hooks . app展示</a></li><li id="a9d2" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-3c2a9e701e9f">使用Helm在本地单节点Kubernetes上运行应用</a></li><li id="18d4" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-e800579f0be3#0174-87b0e3c1fcd3">在Civo Kubernetes集群上运行应用</a></li><li id="d179" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated">使用GitOps和Argo CD进行连续部署(本文)</li><li id="3b83" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-876f72ce1681">使用Loki堆栈的可观察性</a></li><li id="cf08" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-e2f6475ddde1">使用Acorn定义应用</a></li><li id="5421" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-6abd625c60fe">安全注意事项:安全相关工具</a></li><li id="7bea" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-eb0fb52e1bf0">安全考虑:修复错误配置</a></li><li id="3c61" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated"><a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/journey-of-a-microservice-application-in-the-kubernetes-world-f760cba7600f">安全考虑:策略实施</a></li><li id="24c3" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated">安全考虑:漏洞扫描(即将推出)</li></ul></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="1cfa" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是GitOps</h2><p id="23a9" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">GitOps的概念是几年前由Weaveworks创建的。此后，它经历了一个日益增长的热潮。</p><blockquote class="nj nk nl"><p id="4dfc" class="mc md nm me b mf nn ju mh mi no jx mk np nq mm mn nr ns mp mq nt nu ms mt mu im bi translated">GitOps是一种持续交付的方式。它通过使用 <strong class="me iu"> <em class="it"> Git作为声明性基础设施和应用程序的真理来源</em> </strong> <em class="it">来工作。当对Git进行更改时，自动化交付管道会对您的基础设施进行更改。</em></p><p id="7fbd" class="mc md nm me b mf nn ju mh mi no jx mk np nq mm mn nr ns mp mq nt nu ms mt mu im bi translated"><em class="it"> —织布</em></p></blockquote><p id="cef2" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated"><strong class="me iu">将更改部署到集群:推vs拉</strong></p><p id="386f" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">在典型的CI/CD管道中，CI工具(可以是GitLab CI、GitHub actions、Tekton等)负责运行测试、构建映像、检查CVE并将新映像重新部署到集群中。因此，配置项需要访问群集。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/80cb736d004ebb6d268ba984b520061f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3cAN4LUoSeVgA6pc.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://gitops.tech" rel="noopener ugc nofollow" target="_blank"> gitops.tech </a>的基于推送的部署</figcaption></figure><p id="049d" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">GitOps方法有所不同，因为部署部分不是由CI工具完成的，而是由操作员完成的，操作员是在Pod中运行的应用程序:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/01cebaa876944eb44fa923a50c807447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VxE2J6wlfsgNYJbt.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来自<a class="ae ky" href="https://gitops.tech" rel="noopener ugc nofollow" target="_blank"> gitops.tech </a>的基于拉的部署</figcaption></figure><p id="1c92" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">在集群内部运行的Pod不断检查Git存储库(通常称为<em class="nm"> config </em> repo)。它比较了应用程序当前运行的方式(<em class="nm">当前状态</em>)和它应该如何运行(<em class="nm">期望状态</em>)。如果它检测到一些差异，它将使应用向<em class="nm">期望状态</em>收敛。</p><p id="d720" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">在GitOps中，没有在集群之外运行的进程与API服务器通信。一切都是在内部完成的，当Git的配置报告发生变化时就会触发。</p><p id="d0e0" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated"><a class="ae ky" href="https://argoproj.github.io/" rel="noopener ugc nofollow" target="_blank"> Argo CD </a>和<a class="ae ky" href="https://fluxcd.io/" rel="noopener ugc nofollow" target="_blank"> Flux </a>是两个众所周知的解决方案，遵循GitOps范例，可用于Kubernetes。</p><p id="131c" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">现在我们对GitOps有了稍微好一点的了解，我们将在集群中安装和配置Argo CD。通过这种方式，我们将确保应用程序始终保持最新的状态<em class="nm">和期望的状态</em>。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="080a" class="lg lh it bd li lj lk dn ll lm ln dp lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Argo光盘安装</h2><p id="d626" class="pw-post-body-paragraph mc md it me b mf mg ju mh mi mj jx mk lp ml mm mn lt mo mp mq lx mr ms mt mu im bi translated">Argo CD可以像我们在Kubernetes中使用的许多应用程序一样安装为舵图。</p><div class="kj kk kl km gt ab cb"><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/23a53e644215f39d6b35a933f036fca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9mbgT_O9WouSgMUXcliamQ.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/cf4707562876a7bdbf6aea39e500dda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*SDLgG25xsGB-2M_W22wibQ.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/7bdd5c90b3db326c9be2fb8d179a18db.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*kss-_KqPb2vlJzqpqr7Jgg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk oc di od oe translated">阿尔戈CD舵图可从<a class="ae ky" href="https://artifacthub.io/" rel="noopener ugc nofollow" target="_blank"> artifacthub </a>获得</figcaption></figure></div><p id="cde2" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">从我们从<a class="ae ky" href="https://artifacthub.io/" rel="noopener ugc nofollow" target="_blank"> artifacthub </a>得到的信息，我们可以创建一个Helmfile，以声明的方式指定应用程序(我真的很喜欢Helmfile BTW)。</p><p id="5694" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">至于webhooks和Traefik应用程序，已经在<em class="nm">配置</em>存储库中创建了一个新的<a class="ae ky" href="https://gitlab.com/web-hook/config/-/tree/main/apps/argocd" rel="noopener ugc nofollow" target="_blank"> argocd文件夹</a>。这个文件夹包含下面的<em class="nm"> helmfile.yaml </em>，它定义了Argo CD Helm chart将被安装到集群中的方式:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="0aaa" class="lg lh it og b gy ok ol l om on"># config/apps/argocd/helmfile.yaml</span><span id="9b97" class="lg lh it og b gy oo ol l om on">repositories:<br/>- name: argo<br/>  url: https://argoproj.github.io/argo-helm</span><span id="fea8" class="lg lh it og b gy oo ol l om on">releases:<br/>- name: argo<br/>  namespace: argo<br/>  labels:<br/>    app: argo<br/>  chart: argo/argo-cd<br/>  version: ~5.4.3<br/>  values:<br/>  - ./values.yaml</span></pre><p id="3193" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">该文件引用了一个包含Argo CD的一些配置选项的<em class="nm"> values.yaml </em>文件:</p><ul class=""><li id="2bdc" class="mv mw it me b mf nn mi no lp op lt oq lx or mu na nb nc nd bi translated">配置库:Argo CD将连接到的Git库</li><li id="d559" class="mv mw it me b mf ne mi nf lp ng lt nh lx ni mu na nb nc nd bi translated">应用:阿尔戈将不断监测的应用的定义。应用程序资源是安装Argo CD时创建的CRD(自定义资源定义)。它基本上告诉Argo观察应用程序定义的<em class="nm"> apps/webhooks </em>文件夹的<em class="nm">配置</em>库的变化。</li></ul><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="aae1" class="lg lh it og b gy ok ol l om on">configs:<br/>  repositories:<br/>    config-repo:<br/>    url: <a class="ae ky" href="https://gitlab.com/web-hook/config.git" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/web-hook/config.git</a><br/>    name: webhooks<br/>    type: git</span><span id="73e4" class="lg lh it og b gy oo ol l om on">extraObjects:<br/>- apiVersion: argoproj.io/v1alpha1<br/>  kind: Application<br/>  metadata:<br/>    name: webhooks<br/>    namespace: argo<br/>  spec:<br/>    project: default<br/>    source:<br/>      repoURL: <a class="ae ky" href="https://gitlab.com/web-hook/config.git" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/web-hook/config.git</a><br/>      targetRevision: main<br/>      path: apps/webhooks<br/>      helm:<br/>        releaseName: webhooks<br/>        valueFiles:<br/>        - "values.yaml"<br/>    destination:<br/>      server: <a class="ae ky" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>      namespace: webhooks<br/>    syncPolicy:<br/>      automated: {}<br/>      syncOptions:<br/>      - CreateNamespace=true</span></pre><p id="5c88" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">从<em class="nm"> config/apps/argocd </em>我们用Helmfile安装argocd舵图:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="07e3" class="lg lh it og b gy ok ol l om on">$ helmfile apply</span></pre><p id="7cab" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">接下来，我们验证Argo CD盒运行正常:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="4a8e" class="lg lh it og b gy ok ol l om on"><strong class="og iu">$ kubectl -n argo get po<br/></strong>NAME                                                     READY   STATUS    RESTARTS   AGE<br/>argo-argocd-applicationset-controller-7bb6b48b75-jrkvp   1/1     Running   0          25s<br/>argo-argocd-redis-8594c4656f-sf7nb                       1/1     Running   0          24s<br/>argo-argocd-notifications-controller-6f7b8cfbf6-f7jqz    1/1     Running   0          25s<br/>argo-argocd-dex-server-77cf4fc7bc-5klcp                  1/1     Running   0          25s<br/>argo-argocd-repo-server-668c7f8cf7-cg4gj                 1/1     Running   0          25s<br/>argo-argocd-server-5687b98d77-z7pqp                      1/1     Running   0          25s<br/>argo-argocd-application-controller-0                     1/1     Running   0          24s</span></pre><p id="1bac" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">为了访问Argo CD仪表板，我们首先需要检索名为<em class="nm">Argo CD-initial-admin-Secret</em>的密码中生成的密码:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="b5ef" class="lg lh it og b gy ok ol l om on">kubectl -n argo get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d</span></pre><p id="7cb2" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">接下来，我们使用<em class="nm">端口转发</em>来公开仪表板:</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="e000" class="lg lh it og b gy ok ol l om on">kubectl port-forward service/argo-argocd-server -n argo 8080:443</span></pre><p id="15c3" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">然后，我们可以使用<em class="nm"> admin </em>作为用户名和上面检索到的密码登录Argo CD web界面:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/7ad515382fde03d992695c978affe5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EPUIpbNIa-nCfvlJaMKfxQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Argo CD登录屏幕</figcaption></figure><p id="b626" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">登录后，我们可以看到webhooks应用程序资源的详细信息:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/d559dec1c648917d98aad3fe8cd29e7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*40l03YDacFrUX4E7asq_jA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">webhooks应用程序是在我们安装Argo CD时创建的</figcaption></figure><p id="40d3" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">Argo认为该应用程序是同步的，因为在当前状态和期望状态之间没有差异。</p><p id="e91b" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">注意:安装完成后，应用程序可能需要几十秒钟才能被认为是同步的。</p><p id="8946" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">单击应用程序，我们可以获得更多详细信息，如所有已创建资源的视图</p><div class="kj kk kl km gt ab cb"><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/a206a99d0d32bd0a81d84797cad71b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*eYhsB20h7qJ3MzaH4dlLzA.png"/></div></figure><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/635d7a10b201faf533f5e5c46e7b88ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ImhrIa3-K6nbp_0cyvNQTA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk ou di ov oe translated">webhooks应用程序当前正在同步</figcaption></figure></div><p id="84cc" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">在下一部分中，我们将对应用程序做一个小小的改动。然后，我们将看到Argo CD检测到应用程序没有同步，并重新同步它。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="b9e1" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">正如我们在左下角看到的，目前web前端运行的版本是1.0.35。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/73620eec557d582a749701f440a56878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R0E-h07WyBy5OAExIL55pA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">www微服务的当前版本</figcaption></figure><p id="a0a4" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">为了简单起见，我们只需稍微修改一下<em class="nm"> www </em>微服务的自述文件，然后提交并推送这一更改。</p><pre class="kj kk kl km gt of og oh oi aw oj bi"><span id="55fb" class="lg lh it og b gy ok ol l om on">$ git add README.md </span><span id="e4dc" class="lg lh it og b gy oo ol l om on">$ git commit -m 'fix: dummy change to see pipeline in action'</span><span id="7ca6" class="lg lh it og b gy oo ol l om on">$ git push</span></pre><p id="e242" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">当新代码被推送到<em class="nm"> www </em>库的主分支时，会发生以下动作(这同样适用于应用的其他微服务，因为它们具有类似的CI/CD管道):</p><ul class=""><li id="6ea2" class="mv mw it me b mf nn mi no lp op lt oq lx or mu na nb nc nd bi translated">创建了一个新的git标记(遵循SemVer格式)。由于提交消息中的“fix”关键字，创建了补丁版本。</li></ul><div class="kj kk kl km gt ab cb"><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/08855b593f79e2beda08a83b09cabddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*96TgpDqEshLQb02CQqd3Gw.png"/></div></figure><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/674fe64a9a50dfeab2f860239753d3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9QCcmNoYqDg8FvXEfvCdsg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk ou di ov oe translated">标签v1.0.36被创建并被推送到www储存库</figcaption></figure></div><ul class=""><li id="e4c6" class="mv mw it me b mf nn mi no lp op lt oq lx or mu na nb nc nd bi translated">使用这个标签构建并标记一个新的容器图像</li></ul><div class="kj kk kl km gt ab cb"><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/bcd7e416086ce43174529b0795695ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*yUR7oZ3y3dpsgsqXdnpNwQ.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/0a08fd6035b4c9a81535a0c7029cba56.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*OgV61eWSPHjRmjHHXqIp3g.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/4cb328ef7ad1de1ec0b3dcd7a670c528.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*fs_Qfk5b00xh3urIrq6tBA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk oc di od oe translated">新标签触发了另一个构建容器映像的管道</figcaption></figure></div><ul class=""><li id="9cfe" class="mv mw it me b mf nn mi no lp op lt oq lx or mu na nb nc nd bi translated"><em class="nm">配置</em>库的<em class="nm"> values.yaml </em>文件用这个新标签更新</li></ul><div class="kj kk kl km gt ab cb"><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/ff1e6fc87d064e145c09a39d8a0eec6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*8_f9C0UDQdO1jqBVi_i_yQ.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/82a623cdac9a2aaf995dc89a947032af.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1OUfiT27Fs_KyuOsVR3AKw.png"/></div></figure><figure class="nw kn nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/fbc0071eff2966cde1a34d17954b0b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*f_-w6lY60u26ND5ku1Z0_Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk oc di od oe translated">vww.tag属性现在是<strong class="bd li"> v1.0.36 </strong></figcaption></figure></div><p id="ed03" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">Argo CD很快注意到应用程序不同步，因为运行的www部署中使用的镜像版本与git存储库中的版本不同。然后，它会触发重新同步过程。</p><div class="kj kk kl km gt ab cb"><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/bd02d72e546240811d0dc2267b802307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*CYvlUQ9fcF2iWQxJwMFnXg.png"/></div></figure><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/d70d507c16883d0b49a30f046ee106c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*mPsKBqcCocUV1bEUoRsgVA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk ou di ov oe translated">Argo CD检测到应用程序不同步，并触发重新同步过程</figcaption></figure></div><p id="9e8d" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">用新的图像标签更新www部署只需要几十秒钟。原<em class="nm"> www </em> Pod运行<em class="nm"> v1.0.35 </em>替换为<em class="nm"> v1.0.36. </em></p><div class="kj kk kl km gt ab cb"><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/df18a49e66b8d5a2bf046c716c2ebcb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Lm6AJWjsQ96ZQKpEbTBW4w.png"/></div></figure><figure class="nw kn ot ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f9a05809f66f03cf1ecde0857dee5d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*6K2m785R5OCDaKKXqogKcA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk ou di ov oe translated">Argo CD使用Helm更新集群中运行的应用程序</figcaption></figure></div><p id="ecb7" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">如果我们刷新web前端，我们会注意到以前的版本已经更新为新版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/274edf03c2b54b7e50d80663cb81fc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lLAbs9fYfaPOHi5r4TBh3A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Web frontend已更新到新版本</figcaption></figure></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="c32f" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">为webhooks应用程序设置Argo CD非常容易。现在，我们可以从GitOps方法中获益，确保应用程序代码中的每个更改都以一种干净、现代的方式触发应用程序的更新。</p><p id="329e" class="pw-post-body-paragraph mc md it me b mf nn ju mh mi no jx mk lp nq mm mn lt ns mp mq lx nu ms mt mu im bi translated">在本系列的下一篇文章中，我们将关注使用Loki堆栈的可观测性。</p></div></div>    
</body>
</html>