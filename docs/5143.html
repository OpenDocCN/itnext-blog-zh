<html>
<head>
<title>Deploying an ExpressJS (Node) web application to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将ExpressJS(节点)web应用程序部署到Heroku</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-an-expressjs-node-web-application-to-heroku-c0f36e5671fd?source=collection_archive---------2-----------------------#2020-12-21">https://itnext.io/deploying-an-expressjs-node-web-application-to-heroku-c0f36e5671fd?source=collection_archive---------2-----------------------#2020-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="383a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">Heroku PaaS</h2><div class=""/><div class=""><h2 id="3d86" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在本课中，我们将使用ExpressJs创建一个示例图像处理web应用程序，并将其托管在Heroku上。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ed5c992dea5fd3e7f3bc4bd2d0ee2d27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w33EYKhAO-z6WnUm10bWlQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(来源:【unsplash.com】<strong class="bd li"/>)</figcaption></figure><p id="613b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><a class="ae lh" href="https://heroku.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> Heroku </strong> </a>是PaaS ( <em class="mf">平台即服务</em>)提供商。使用Heroku，我们可以在几秒钟内在云上部署应用程序。支持Java、Node.js、Python、PHP、Go等多种编程语言。</p><p id="604e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Heroku与AWS、Google Cloud或Azure等其他平台的不同之处在于将应用程序部署到云的便利性。尽管Heroku提供了企业级特性，但它是快速部署和测试应用程序的最简单的平台之一。</p><p id="9069" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">例如，如果您想要部署名为<code class="fe mg mh mi mj b">my-project</code>的开源项目的文档(<em class="mf">作为网站</em>)，您可以简单地创建一个Heroku应用程序，将存储库代码推送到Heroku，您的应用程序将在<code class="fe mg mh mi mj b"><a class="ae lh" href="http://my-project.herokuapp.com." rel="noopener ugc nofollow" target="_blank">http://my-project.herokuapp.com</a></code>部署。就这么简单。</p><p id="fdea" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">最棒的是，你可以在有一些限制的情况下免费将应用程序部署到Heroku <strong class="ll jd">。这些限制将应用于应用程序的正常运行时间、它接收的流量、分配给每个应用程序的内存以及其他次要的事情。要了解更多有关这些限制的信息，请阅读本</strong> 文档。或者你可以获得一份<a class="ae lh" href="https://www.heroku.com/pricing" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">保费计划</strong> </a>。</p><h2 id="248b" class="mk ml it bd li mm mn dn mo mp mq dp mr ls ms mt mu lw mv mw mx ma my mz na iz bi translated">Heroku是如何工作的？</h2><p id="5da4" class="pw-post-body-paragraph lj lk it ll b lm nb kd lo lp nc kg lr ls nd lu lv lw ne ly lz ma nf mc md me im bi translated">Heroku是一个基于容器的平台。每个Heroku应用程序都将被部署为一个容器，您可以在每个应用程序中使用多个这样的容器来扩展您的应用程序。尽管Heroku提供Docker集成，但Heroku默认使用<strong class="ll jd"> Dynos </strong>来运行应用程序。</p><p id="8710" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一个<a class="ae lh" href="https://www.heroku.com/dynos" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> dyno </strong> </a>是一个隔离的、虚拟化的<a class="ae lh" href="https://www.redhat.com/en/topics/containers/whats-a-linux-container" rel="noopener ugc nofollow" target="_blank"> Linux容器</a>运行你的应用程序代码。这个dyno就像一个虚拟机，具有运行我们的应用程序所需的依赖关系。例如，如果我们的源代码包含一个<code class="fe mg mh mi mj b">package.json</code>，那么Heroku用Node.js安装创建一个dyno。</p><p id="55ea" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">Heroku为语言特性和工具使用了一个<strong class="ll jd">构建包</strong>。构建包为构建和运行我们的应用程序提供了必要的依赖。对于Node.js应用程序，Heroku使用了<code class="fe mg mh mi mj b">heroku/nodejs</code>构建包。有关该主题的更多信息，请阅读<a class="ae lh" href="https://devcenter.heroku.com/articles/buildpacks" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">该</strong> </a>文档。</p><blockquote class="ng nh ni"><p id="5208" class="lj lk mf ll b lm ln kd lo lp lq kg lr nj lt lu lv nk lx ly lz nl mb mc md me im bi translated"><em class="it">💡</em>如果你想运行一个用Heroku不支持的语言编写的应用，那么你可以使用一个<a class="ae lh" href="https://devcenter.heroku.com/articles/buildpacks#using-a-third-party-buildpack" rel="noopener ugc nofollow" target="_blank">第三方构建包</a>。如果您的应用程序需要多个buildpacks(对于一个用多种编程语言编写的应用程序)，请遵循<a class="ae lh" href="https://devcenter.heroku.com/articles/using-multiple-buildpacks-for-an-app" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">这个</strong> </a>文档。</p></blockquote><p id="8a6e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一个<strong class="ll jd"> web dyno </strong>是一个运行你的web应用并接收流量的dyno。在这个dyno中，我们可以运行一个HTTP服务器，比如Express application，来接收请求和提供web内容。worker dyno是一个在后台运行的容器，它对于运行后台任务很有用。要了解更多Heroku支持的dyno类型，请阅读本 文档。</p><p id="3437" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一个Heroku应用程序包含了我们想要在web dyno中运行的应用程序的源代码。当我们第一次创建应用程序时，Heroku只获得dyno的源代码和配置。我们需要通过缩放<strong class="ll jd"> web dyno </strong>的数量来手动缩放应用程序。默认情况下，这个数字是<code class="fe mg mh mi mj b">1</code>和自由层帐户给我们一个最大的<code class="fe mg mh mi mj b">1</code>网页动态。</p><p id="837c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">尽管这些信息听起来让人不知所措，但我们真的不需要每天都处理这些信息。Heroku提供了一个CLI ( <strong class="ll jd">命令行界面</strong>)来轻松创建、测试、部署和扩展应用程序。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h1 id="62a2" class="nt ml it bd li nu nv nw mo nx ny nz mr ki oa kj mu kl ob km mx ko oc kp na od bi translated">创建Heroku应用程序</h1><p id="c201" class="pw-post-body-paragraph lj lk it ll b lm nb kd lo lp nc kg lr ls nd lu lv lw ne ly lz ma nf mc md me im bi translated">首先，我们需要一个Heroku账户。要创建免费帐户，请使用<code class="fe mg mh mi mj b"><a class="ae lh" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">signup.heroku.com</a></code> URL并填写必要的详细信息。请确保使用有效的电子邮件地址作为您的用户名。如果您已经有一个帐户，那么您可以使用<code class="fe mg mh mi mj b"><a class="ae lh" href="https://id.heroku.com/login" rel="noopener ugc nofollow" target="_blank">id.heroku.com/login</a></code> URL登录仪表板。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/9317c5c2179bd1a0eb89b1a8104f54be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*lDaGBROhqWFURha3qGa8Ig.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(<a class="ae lh" href="https://dashboard.heroku.com/apps" rel="noopener ugc nofollow" target="_blank">https://dashboard.heroku.com/apps</a>)</figcaption></figure><p id="431f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">登录后，您将被重定向到仪表板页面。这是您将看到Heroku应用程序的地方。你可以点击<code class="fe mg mh mi mj b">Create new app</code>按钮来创建一个新的Heroku应用程序并连接到GitHub库，但是我们将遵循另一种部署Heroku应用程序的方法。</p><h2 id="1959" class="mk ml it bd li mm mn dn mo mp mq dp mr ls ms mt mu lw mv mw mx ma my mz na iz bi translated">应用程序结构</h2><p id="00f8" class="pw-post-body-paragraph lj lk it ll b lm nb kd lo lp nc kg lr ls nd lu lv lw ne ly lz ma nf mc md me im bi translated">我们将使用Node构建一个简单的图像大小调整应用程序。对于图像大小调整，我们可以使用<code class="fe mg mh mi mj b"><a class="ae lh" href="https://sharp.pixelplumbing.com/" rel="noopener ugc nofollow" target="_blank">sharp</a></code>包。我们将创建一个<a class="ae lh" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> Express </strong> </a>服务器，它接受<code class="fe mg mh mi mj b">/resize</code>端点上的请求并返回一个调整过大小的测试PNG图像。默认的<code class="fe mg mh mi mj b">/</code>端点返回<code class="fe mg mh mi mj b">index.html</code>，它包含一些关于<code class="fe mg mh mi mj b">/resize</code>端点使用的信息。</p><p id="bad8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">让我们创建一个名为<code class="fe mg mh mi mj b">heroku-image-resize</code>的项目目录，并运行<code class="fe mg mh mi mj b">$ npm ini -y</code>命令来初始化<code class="fe mg mh mi mj b">package.json</code>文件。然后我们需要安装用于调整图像大小的<code class="fe mg mh mi mj b"><a class="ae lh" href="https://github.com/lovell/sharp" rel="noopener ugc nofollow" target="_blank">sharp</a></code>包和<code class="fe mg mh mi mj b"><a class="ae lh" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank">express</a></code>包。</p><pre class="ks kt ku kv gt of mj og oh aw oi bi"><span id="b806" class="mk ml it mj b gy oj ok l ol om">$ npm install --save sharp express</span></pre><p id="377a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一旦安装了上述依赖项，我们就可以在Express HTTP服务器上工作了。让我们在项目中创建<code class="fe mg mh mi mj b">server.js</code>文件，并编写一个逻辑来处理<code class="fe mg mh mi mj b">/</code>和<code class="fe mg mh mi mj b">/resize</code>端点。对于测试图像，我使用的是<a class="ae lh" href="https://en.wikipedia.org/wiki/Lenna#/media/File:Lenna_(test_image).png" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> Lenna </strong> </a>。让我们下载这个图像，并在我们的项目中将其保存为<code class="fe mg mh mi mj b">lenna.png</code>。</p><pre class="ks kt ku kv gt of mj og oh aw oi bi"><span id="e1ef" class="mk ml it mj b gy oj ok l ol om"><strong class="mj jd">heroku-image-resize/</strong><br/>├── .gitignore<br/>├── LICENSE<br/>├── README.md<br/>├── lenna.png<br/>├── package-lock.json<br/>├── package.json<br/>├── Procfile<br/>├── server.js<br/>└── www<br/>   ├── index.html<br/>   ├── main.js<br/>   └── style.css</span></pre><blockquote class="ng nh ni"><p id="3279" class="lj lk mf ll b lm ln kd lo lp lq kg lr nj lt lu lv nk lx ly lz nl mb mc md me im bi translated"><em class="it">💡</em>你可以在<a class="ae lh" href="https://github.com/course-one/heroku-image-resize" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">这个</strong> </a> GitHub仓库里找到上面的文件。</p></blockquote><p id="6d4e" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我稍后会谈到<code class="fe mg mh mi mj b">Procfile</code>文件，因为它是Heroku使用的。<code class="fe mg mh mi mj b">www</code>目录包含我们的web应用程序的资产，尽管现在您可以忽略<code class="fe mg mh mi mj b">main.js</code>和<code class="fe mg mh mi mj b">style.css</code>中的内容。<code class="fe mg mh mi mj b">index.html</code>从<code class="fe mg mh mi mj b">&lt;img&gt;</code>元素内的<code class="fe mg mh mi mj b">/resize</code>端点呈现样本图像。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(server . js/source:<a class="ae lh" href="https://gist.github.com/thatisuday/005c495b65489c6edbcdc9812a068353" rel="noopener ugc nofollow" target="_blank">T36】gist.github.com</a>)</figcaption></figure><p id="0363" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在上面的<code class="fe mg mh mi mj b">server.js</code>文件中，我们在<code class="fe mg mh mi mj b">/</code>端点上发送<code class="fe mg mh mi mj b">index.html</code>文件，而<code class="fe mg mh mi mj b">/www</code>端点从<code class="fe mg mh mi mj b">www/</code>目录发送资产，如<code class="fe mg mh mi mj b">style.css</code>和<code class="fe mg mh mi mj b">main.js</code>。<code class="fe mg mh mi mj b">/resize</code>端点接收<code class="fe mg mh mi mj b">:size</code>参数，该参数为要调整大小的图像提供尺寸。</p><p id="97aa" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">HTTP服务器在端口<code class="fe mg mh mi mj b">80</code>上启动，除非通过<code class="fe mg mh mi mj b">PORT</code>环境变量提供端口。这是必要的，因为Heroku为应用程序提供了一个端口，它将在这个端口上通过<code class="fe mg mh mi mj b">PORT</code>环境变量接收web流量。让我们通过运行<code class="fe mg mh mi mj b">$ node server.js</code>命令来启动这个服务器，这个命令将为端口<code class="fe mg mh mi mj b">80</code>上的应用程序提供服务。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4aebc8c6009387b5905f064045c7e9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*HQXEkHSRaCgTSNTHcSA-Iw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(<a class="ae lh" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>)</figcaption></figure><p id="300a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一旦服务器启动并运行，您就可以在浏览器中访问<code class="fe mg mh mi mj b"><a class="ae lh" href="http://localhost" rel="noopener ugc nofollow" target="_blank">http://localhost</a></code> URL。这将获取并呈现<code class="fe mg mh mi mj b">index.html</code>,它显示一个调整过大小的图像和一个提供图像大小的输入。当我们点击<code class="fe mg mh mi mj b">SUBMIT</code>按钮时，<code class="fe mg mh mi mj b">main.js</code>内部的一个函数用<code class="fe mg mh mi mj b">/resize/200x200</code>值(<em class="mf"> URL </em>)替换<code class="fe mg mh mi mj b">&lt;img&gt;</code>元素的<code class="fe mg mh mi mj b">src</code>属性。</p><h2 id="33e9" class="mk ml it bd li mm mn dn mo mp mq dp mr ls ms mt mu lw mv mw mx ma my mz na iz bi translated">创建和部署Heroku应用程序</h2><p id="4a52" class="pw-post-body-paragraph lj lk it ll b lm nb kd lo lp nc kg lr ls nd lu lv lw ne ly lz ma nf mc md me im bi translated">首先，我们需要安装Heroku CLI。要安装此CLI，您可以按照这些和说明进行操作。如果您使用的是macOS，那么您可以使用<code class="fe mg mh mi mj b">$ brew install heroku/brew/heroku</code>命令来安装它。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi op"><img src="../Images/53dddc7ae7ef41a7ab7c9b5f808d5f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*dZr1OZ6yfGwEvkOhAm_N3w.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku -版本</figcaption></figure><p id="c607" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">一旦安装了CLI，您可以使用<code class="fe mg mh mi mj b">$ heroku --version</code>命令来检查Heroku CLI版本。您还需要安装<a class="ae lh" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> Git </strong> </a>，因为Heroku CLI使用Git将应用程序代码推送到Heroku服务器。如果您的应用程序目录不是Git存储库，运行<code class="fe mg mh mi mj b">$ git init</code>命令将您的项目转换成Git存储库。</p><p id="772c" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">首先，我们需要从终端登录Heroku。因为我们正在创建和推送一个Heroku应用程序，Heroku需要知道我们是谁。所以使用<code class="fe mg mh mi mj b">$ heroku login</code>命令并提供您的凭证。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/a8a0d6f4f2ffe1acc72fddaefc1af5f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*WXEvxTBtxbG92LT2azv8pA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku登录</figcaption></figure><p id="64e8" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">该命令将打开一个浏览器窗口，您需要在其中提供您的Heroku帐户凭证。一旦您登录，终端将退出并打印您帐户的电子邮件地址。</p><p id="ec71" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">要创建一个Heroku应用程序，我们需要从项目目录运行<code class="fe mg mh mi mj b">$ heroku create</code>命令。但是这个命令创建了一个名为Heroku的项目，这个名字并不理想。要提供自定义应用程序名称，请使用以下命令。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi or"><img src="../Images/830764dc63faea4c6bd6ad26c1132a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NHdkq_hFc7FX7daPTpjqGQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku应用程序:创建</figcaption></figure><p id="50cd" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><code class="fe mg mh mi mj b">$ heroku apps:create --region eu thatisuday-image-resize</code>命令创建一个名为<code class="fe mg mh mi mj b">thatisuday-image-resize</code>的Heroku应用程序。它还生成一个Git <strong class="ll jd"> remote </strong> ( <em class="mf">它将被推送到那里</em>)和一个子域。</p><blockquote class="ng nh ni"><p id="bbe5" class="lj lk mf ll b lm ln kd lo lp lq kg lr nj lt lu lv nk lx ly lz nl mb mc md me im bi translated"><em class="it">💡</em><code class="fe mg mh mi mj b">--region</code>标志设置应用部署的区域。你应该选择一个离你近的地区。要查找Heroku的区域，使用<code class="fe mg mh mi mj b">$ heroku regions</code>命令。</p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f2279d3f02d2101c04c98f36905f9cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*Z1ooBPCxlFpEaGTvRw3suw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(Heroku仪表板)</figcaption></figure><p id="d605" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在，如果您访问Heroku仪表板，您应该能够看到您的应用程序。然而，如果你访问<code class="fe mg mh mi mj b"><a class="ae lh" href="https://thatisuday-image-resize.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://thatisuday-image-resize.herokuapp.com</a></code>网址，你将看不到我们的应用程序，因为我们还没有将应用程序代码推送到<code class="fe mg mh mi mj b"><a class="ae lh" href="https://git.heroku.com/thatisuday-image-resize.git" rel="noopener ugc nofollow" target="_blank">https://git.heroku.com/thatisuday-image-resize.git</a></code>库。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/28a668b51050a055885815118054796f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*yXmzqpyWmft8coDTxiKA4g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ git remote -v</figcaption></figure><p id="22b3" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">当我们创建一个Heroku应用程序时，Heroku将<code class="fe mg mh mi mj b">heroku</code> remote添加到指向<code class="fe mg mh mi mj b">https://git.heroku.com/&lt;app-name&gt;.git</code>的Git存储库中。因为我在做GitHub库，所以我也有一个<code class="fe mg mh mi mj b">origin</code>遥控器。</p><p id="d0ec" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">如果您没有看到<code class="fe mg mh mi mj b">heroku</code> remote，或者您想要将Heroku应用程序远程添加到您的本地存储库中，您可以使用<code class="fe mg mh mi mj b">$ git remote <a class="ae lh" href="https://git-scm.com/docs/git-remote#Documentation/git-remote.txt-emaddem" rel="noopener ugc nofollow" target="_blank">add</a> heroku &lt;app-remote-url&gt;</code>命令。但是我推荐使用<code class="fe mg mh mi mj b">$ heroku git:remote -a &lt;app-name&gt;</code>命令，它从应用程序名称解析远程URL。你可以从Heroku仪表盘上得到<code class="fe mg mh mi mj b">app-name</code>。</p><p id="6473" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">当我们部署应用程序时，Heroku需要知道在<strong class="ll jd"> web dyno </strong>中运行哪个命令。我们在<strong class="ll jd"> Procfile </strong>中指定web dyno ( <em class="mf">和其他dyno</em>)的配置。<code class="fe mg mh mi mj b">Procfile</code>是包含进程信息的文本文件(<em class="mf"> dynos </em>)。它的简单形式如下所示。</p><pre class="ks kt ku kv gt of mj og oh aw oi bi"><span id="9250" class="mk ml it mj b gy oj ok l ol om">&lt;process-name&gt;: &lt;command&gt;</span></pre><p id="497f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">对于我们的应用程序，我们希望在<code class="fe mg mh mi mj b">web</code>进程中运行<code class="fe mg mh mi mj b">node server.js</code>命令(<em class="mf"> dyno </em>)来启动一个web服务器。因此，我们的<code class="fe mg mh mi mj b">Procfile</code>如下所示。如果您需要关于<code class="fe mg mh mi mj b">Procfile</code>的更多信息，请遵循<a class="ae lh" href="https://devcenter.heroku.com/articles/procfile" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd">本</strong> </a>文档。</p><pre class="ks kt ku kv gt of mj og oh aw oi bi"><span id="bc46" class="mk ml it mj b gy oj ok l ol om">web: node server.js</span></pre><p id="b42d" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">当我们部署应用程序时，基于应用程序存储库中的<code class="fe mg mh mi mj b">package.json</code>文件和Heroku使用的其他buildpack检测方法，Heroku使用可用的Node.js 的<strong class="ll jd">最新</strong><a class="ae lh" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"><strong class="ll jd">LTS</strong></a><strong class="ll jd">安装在web dyno中运行<code class="fe mg mh mi mj b">node server.js</code>命令。</strong></p><p id="ca7b" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">但是，我建议设置一个自定义版本的Node.js来运行应用程序。这样，如果我们的应用程序与Node.js的某个版本有不兼容问题，我们可以在本地机器上检测到它。要提供Node.js版本，请使用<code class="fe mg mh mi mj b">package.json</code>文件的<code class="fe mg mh mi mj b">engines</code>属性。</p><pre class="ks kt ku kv gt of mj og oh aw oi bi"><span id="cba1" class="mk ml it mj b gy oj ok l ol om">{<br/>  "name": "myapp",<br/>  "engines": {<br/>    "node": "<strong class="mj jd">12.16.2</strong>"<br/>  }<br/>}</span></pre><p id="f618" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我在这个应用程序中使用Node.js版本<code class="fe mg mh mi mj b">12.16.2</code>,因为它是我安装在本地机器上的版本。您也可以使用<code class="fe mg mh mi mj b">12.x</code>值，在这种情况下Heroku将选择Node.js的最新次要版本。您还可以指定<strong class="ll jd"> NPM </strong>或<strong class="ll jd">纱</strong>版本，如这里的<a class="ae lh" href="https://devcenter.heroku.com/articles/nodejs-support#specifying-a-node-js-version" rel="noopener ugc nofollow" target="_blank"><strong class="ll jd"/></a>所述。</p><p id="4f44" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">在部署应用程序之前，我们想知道我们的本地Heroku设置是否正常。使用<code class="fe mg mh mi mj b">$ heroku local &lt;process&gt;</code>命令，我们可以从<code class="fe mg mh mi mj b">Procfile</code>本地启动一个进程。让我们通过运行<code class="fe mg mh mi mj b">$ heroku local web</code>命令来启动<code class="fe mg mh mi mj b">web</code>进程。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi os"><img src="../Images/921a86a6ed0161c420d56b9e97b40dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*P7ITn3a-AbetbeP5CwsnJA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku本地网站</figcaption></figure><p id="5fc6" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这一次，我们没有运行<code class="fe mg mh mi mj b">$ node server.js</code>命令来启动web服务器，而是让Heroku从<code class="fe mg mh mi mj b">Procfile</code>运行<code class="fe mg mh mi mj b">web</code>进程的命令。现在，如果您在浏览器中打开<code class="fe mg mh mi mj b"><a class="ae lh" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank">http://localhost:5000</a></code> URL，您应该能够看到应用程序正在那里运行。端口<code class="fe mg mh mi mj b">5000</code>由Heroku选择，它将通过<code class="fe mg mh mi mj b">PORT</code>环境变量提供该端口，我们在<code class="fe mg mh mi mj b">server.js</code>中使用的环境变量是可用的。</p><p id="614f" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们的应用程序运行良好，Heroku的设置也完成了，是时候发布应用程序了。如你所知，<strong class="ll jd">我们已经发布了申请</strong>。我们需要做的是将应用程序代码推送到应用程序的Git存储库。因此，让我们创建一个提交，并将这些提交推送到<code class="fe mg mh mi mj b">heroku</code>遥控器。</p><blockquote class="ng nh ni"><p id="995a" class="lj lk mf ll b lm ln kd lo lp lq kg lr nj lt lu lv nk lx ly lz nl mb mc md me im bi translated"><em class="it">💡</em>确保您已经将<code class="fe mg mh mi mj b">node_modules</code>添加到<code class="fe mg mh mi mj b">.gitignore</code>中。您应该避免将应用程序不需要的任何文件推送到应用程序存储库。heroku/nodejs buildpack通过自动运行<code class="fe mg mh mi mj b">$ npm install -y</code>命令安装NPM模块。</p></blockquote><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(来源:<a class="ae lh" href="https://gist.github.com/thatisuday/5a78a93904d5e4f592ba247b612583d8" rel="noopener ugc nofollow" target="_blank"><strong class="ak">gist.github.com</strong></a>)</figcaption></figure><p id="58af" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">我们应该使用<code class="fe mg mh mi mj b">heroku</code>遥控器的<code class="fe mg mh mi mj b">main</code>或<code class="fe mg mh mi mj b">master</code>分支来推送应用程序代码(<em class="mf">提交</em>)。当Heroku接收到这些提交(运行 <code class="fe mg mh mi mj b"><em class="mf">$ git push heroku main</em></code> <em class="mf">命令</em>后的<em class="mf">)时，它识别应用类型(<em class="mf"> buildpack </em>)。可以看到上面日志中的<code class="fe mg mh mi mj b">Node.js app detected</code>行。</em></p><p id="1771" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">然后Heroku安装Node.js和NPM ( <em class="mf">或Yarn</em>)(<code class="fe mg mh mi mj b"><em class="mf">package.json</em></code>中定义的版本的<em class="mf">)并安装<code class="fe mg mh mi mj b">package.json</code>中提到的所有依赖项。一旦安装了这些依赖项，它会将所有内容压缩到一个<a class="ae lh" href="https://devcenter.heroku.com/articles/slug-compiler" rel="noopener ugc nofollow" target="_blank"> <strong class="ll jd"> slug </strong> </a>中，并将其部署到web dyno中。</em></p><blockquote class="ng nh ni"><p id="d4a1" class="lj lk mf ll b lm ln kd lo lp lq kg lr nj lt lu lv nk lx ly lz nl mb mc md me im bi translated"><em class="it">💡有时，Heroku <a class="ae lh" href="https://devcenter.heroku.com/articles/buildpacks#detection-failure" rel="noopener ugc nofollow" target="_blank">检测不到</a>build pack。在部署应用程序时，我们可以在终端中得到<code class="fe mg mh mi mj b">failed to detect set buildpack heroku/nodejs</code>错误。要解决这个问题，您应该使用<code class="fe mg mh mi mj b">$ heroku buildpacks:set heroku/nodejs</code>命令手动设置buildpack，如这里的<a class="ae lh" href="https://devcenter.heroku.com/articles/buildpacks#setting-a-buildpack-on-an-application" rel="noopener ugc nofollow" target="_blank"><strong class="ll jd"/></a>所述。</em></p></blockquote><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/2495ddc287b327bb58e202fbb269563d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*Y4gaRYUhSlS7kCCubTIKsQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(<a class="ae lh" href="https://thatisuday-image-resize.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://thatisuday-image-resize.herokuapp.com</a>)</figcaption></figure><p id="26dc" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在我们可以在浏览器中访问<code class="fe mg mh mi mj b"><a class="ae lh" href="https://thatisuday-image-resize.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://thatisuday-image-resize.herokuapp.com</a></code> URL。我们的应用程序现在运行在Heroku cloud上。要检查应用程序历史记录、活动或删除应用程序，请使用Heroku仪表板。但是，您可以在终端中使用<code class="fe mg mh mi mj b">$ heroku ps</code>命令检查Heroku应用程序的状态。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/197fac7ce21d6c03672531c022af79b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*q3XnYNYtynQmdXBNImeb9Q.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku ps</figcaption></figure><p id="5bc9" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">这个命令显示剩余的空闲配额以及Heroku应用程序的状态。如您所见，<code class="fe mg mh mi mj b">web</code> dyno ( <em class="mf">进程</em>)已经启动并正在运行。如果一个免费的dyno在30分钟内没有收到流量，它将进入睡眠状态以保存资源，但是一旦收到请求，它将立即醒来。</p><p id="da3a" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">对于免费层帐户，您不能扩展应用程序。这意味着您的应用程序只能在1 dyno上工作(<em class="mf">这还不错</em>)。但是，您可以缩小应用程序的规模。例如，您可以使用<code class="fe mg mh mi mj b">$ heroku ps:scale &lt;process&gt;=&lt;size&gt;</code>命令将动态编号设置为<code class="fe mg mh mi mj b">0</code>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/452038916c46cd56d2a09fef5cd535f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*SRm3F-fLrcndHHba-LlmDw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ heroku ps:scale web=0</figcaption></figure><p id="cc96" class="pw-post-body-paragraph lj lk it ll b lm ln kd lo lp lq kg lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">现在，如果您再次访问<code class="fe mg mh mi mj b"><a class="ae lh" href="https://thatisuday-image-resize.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://thatisuday-image-resize.herokuapp.com</a></code> URL，它将显示一条错误消息，因为我们的应用程序不再运行。为了再次放大dynos，我们需要使用与dyno size <code class="fe mg mh mi mj b">1</code>相同的命令。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/9a855e2aa33a739e33ca964bec8c79b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*30yqqDqgmLf47YFNNpfF1g.png"/></div></figure><h2 id="f2c4" class="mk ml it bd li mm mn dn mo mp mq dp mr ls ms mt mu lw mv mw mx ma my mz na iz bi translated">更新应用程序(重新部署)</h2><p id="2c12" class="pw-post-body-paragraph lj lk it ll b lm nb kd lo lp nc kg lr ls nd lu lv lw ne ly lz ma nf mc md me im bi translated">当我们想要修改我们的应用程序并再次部署应用程序时，我们只需要创建一个Git commit并将其推送到<code class="fe mg mh mi mj b">heroku</code> remote的<code class="fe mg mh mi mj b">main</code>分支。要了解更多关于使用Git部署的信息，请阅读本 文档。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/424a2fa7ddd0428d06b59ff94b297782.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*Dz7pWdmDd1A1ybkyG7cPoQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">$ git push heroku main</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/054000a4f1c4d31969462290e3c61650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*l9KGKZe5SMS8wgAwm1Vn5A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(<a class="ae lh" href="https://thatisuday-image-resize.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://thatisuday-image-resize.herokuapp.com</a>)</figcaption></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ou"><img src="../Images/e3da3bf1cee07cd997d46904bbbf70b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t4VSpLEAu4Gmg-GweZ3RvA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">(<a class="ae lh" href="http://thatisuday.com" rel="noopener ugc nofollow" target="_blank"><strong class="bd li">thatisuday.com</strong></a>/<a class="ae lh" href="https://github.com/thatisuday" rel="noopener ugc nofollow" target="_blank">/<strong class="bd li">GitHub</strong></a>/<a class="ae lh" href="https://twitter.com/thatisuday" rel="noopener ugc nofollow" target="_blank"><strong class="bd li">Twitter</strong></a>/<strong class="bd li">stack overflow</strong><strong class="bd li"/>/<a class="ae lh" href="https://www.instagram.com/thatisuday/" rel="noopener ugc nofollow" target="_blank"><strong class="bd li">insta gram</strong></a>)</figcaption></figure></div></div>    
</body>
</html>