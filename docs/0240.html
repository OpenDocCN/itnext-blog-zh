<html>
<head>
<title>Help Keep Angular Forms Type-Safe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">帮助保持角形的类型安全</h1>
<blockquote>原文：<a href="https://itnext.io/help-keep-angular-forms-type-safe-ca35f7b2edf8?source=collection_archive---------2-----------------------#2018-01-23">https://itnext.io/help-keep-angular-forms-type-safe-ca35f7b2edf8?source=collection_archive---------2-----------------------#2018-01-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ab5862316e98d33e8eb94a3e1c958e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTCN2ctKNoZupUCMP0hQuw.png"/></div></div></figure><p id="8ce7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:这篇文章与合并到表单模块中的以下内容不再相关。</strong><a class="ae kw" href="https://github.com/angular/angular/discussions/44513" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/></a></p><p id="f631" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fhelp-keep-angular-forms-type-safe-ca35f7b2edf8" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="6f59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意"</p><p id="062e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">角反应形式很棒，也非常强大，但在我看来，它们有一个明显的缺点，那就是它们不是类型安全的。让我们看一个例子来演示。(我们将在所有示例中使用FormBuilder。)</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="1973" class="lh li iq ld b gy lj lk l ll lm">class MyComponent {<br/>  myForm: FormGroup = this.fb.group({<br/>    firstName: [''],<br/>    lastName: ['']<br/>    email: ['']<br/>  });</span><span id="9128" class="lh li iq ld b gy ln lk l ll lm">  constructor(private fb: FormBuilder) {}</span><span id="ea25" class="lh li iq ld b gy ln lk l ll lm">  onSubmit() {<br/>    console.log(this.myForm.value);<br/>  }<br/>}</span></pre><p id="4928" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面我们可以看到用3个属性定义的简单FormGroup模型，但是如果我们将鼠标悬停在IDE中的“value”属性上，我们会看到类型是“any”！在这个小例子中，这可能没什么大不了的，但是一旦我们进入更大、更动态的表单，就会导致一些难以追踪的错误。</p><p id="5448" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然我的首选解决方案是AbstractControl成为一个泛型，并允许类似这样的事情:(实际上这里有一个关于这个<a class="ae kw" href="https://github.com/angular/angular/issues/13721" rel="noopener ugc nofollow" target="_blank">的问题</a>，所以祈祷吧。)</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2a33" class="lh li iq ld b gy lj lk l ll lm">myForm: FormGroup = this.fb.group&lt;MyFormModel&gt;({<br/>  firstName: [''],<br/>  lastName: ['']<br/>  email: ['']<br/>});</span></pre><p id="8421" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以绕过这个限制，如果不是真正的类型安全，至少使我们的类型安全。我们的解决方案应满足3个标准:</p><ol class=""><li id="1031" class="lo lp iq ka b kb kc kf kg kj lq kn lr kr ls kv lt lu lv lw bi translated">当我们创建一个表单时，我们应该知道表单所期望的对象的形状。</li><li id="996f" class="lo lp iq ka b kb lx kf ly kj lz kn ma kr mb kv lt lu lv lw bi translated">当我们更新一个表单时，我们知道可以更新的属性。</li><li id="dfc6" class="lo lp iq ka b kb lx kf ly kj lz kn ma kr mb kv lt lu lv lw bi translated">当我们得到形状的值时，我们就知道它是形状。</li></ol><p id="b55a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么我们如何开始呢？让我们一步一步来。</p><p id="9c3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们知道我们想要定义一个模型，所以让我们继续这样做。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="ba2a" class="lh li iq ld b gy lj lk l ll lm">interface MyFormModel {<br/>  firstName: string;<br/>  lastName: string;<br/>  email: string;<br/>}</span></pre><p id="3433" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们想告诉我们的表单，它有三个属性是字符串。接下来，我们需要一个返回表单并接受我们的模型作为参数的方法。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="90c1" class="lh li iq ld b gy lj lk l ll lm">private createForm(model: MyFormModel): FormGroup {<br/>  return this.fb.group(model);<br/>}</span></pre><p id="d153" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当我们调用“createForm”时，编译器会告诉我们是否拥有所有的属性。接下来是更新的方法。(Partial内置于TypeScript中，使其参数的每个属性都是可选的)</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="81b1" class="lh li iq ld b gy lj lk l ll lm">private updateForm(model: Partial&lt;MyFormModel&gt;): void {<br/>  this.myForm.patchValue(model)<br/>}</span></pre><p id="a961" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，一个用于查看表单值的属性。这里我们可以使用强制转换来告诉编译器“myForm”的值是MyFormModel</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c436" class="lh li iq ld b gy lj lk l ll lm">get formValue() {<br/>  return this.myForm.value as MyFormModel;<br/>}</span></pre><p id="12b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">把这些放在一起，我们得到…</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2ad4" class="lh li iq ld b gy lj lk l ll lm">import { Component } from '@angular/core';<br/>import { FormGroup, FormBuilder } from '@angular/forms';</span><span id="0d49" class="lh li iq ld b gy ln lk l ll lm">interface MyFormModel {<br/>  firstName: string;<br/>  lastName: string;<br/>  email: string;<br/>}</span><span id="2f47" class="lh li iq ld b gy ln lk l ll lm">@Component(...)<br/>export class MyComponent {<br/>  myForm: FormGroup = this.createForm({<br/>    firstName: '',<br/>    lastName: '',<br/>    email: ''<br/>  });</span><span id="d94a" class="lh li iq ld b gy ln lk l ll lm">  get formValue() {<br/>    return this.myForm.value as MyFormModel;<br/>  }</span><span id="06dc" class="lh li iq ld b gy ln lk l ll lm">  constructor(private fb: FormBuilder) {}<br/>  <br/>  onSubmit() {<br/>    console.log(this.myForm.value);<br/>  }</span><span id="4e2b" class="lh li iq ld b gy ln lk l ll lm">  private createForm(model: MyFormModel): FormGroup {<br/>    return this.fb.group(model);<br/>  }</span><span id="e315" class="lh li iq ld b gy ln lk l ll lm">  private updateForm(model: Partial&lt;MyFormModel&gt;): void {<br/>    this.myForm.patchValue(model)<br/>  }<br/>}</span></pre><p id="0ef5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">仅此而已！现在，当我们更新表单时，我们可以更加自信，当我们必须更改表单的任何内容时，也更加安全。</p><p id="688a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读！如果你有任何关于如何在工作中更安全的想法，请告诉我，我很乐意看到。</p></div></div>    
</body>
</html>