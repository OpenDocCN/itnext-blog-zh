<html>
<head>
<title>Angular-Custom Form Validation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度-自定义表单验证</h1>
<blockquote>原文：<a href="https://itnext.io/angular-custom-form-validation-bc513b45ccfa?source=collection_archive---------3-----------------------#2019-10-02">https://itnext.io/angular-custom-form-validation-bc513b45ccfa?source=collection_archive---------3-----------------------#2019-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0620" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与React和Vue.js等其他框架相比，Angular的一个突出特点是它的内置表单。相对于模板驱动的表单，我个人更喜欢反应式表单，所以本教程将集中于用反应式的方式实现验证器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f02844dd6f8fa1ef33857ad808d1b66a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9r5gxCsClYtofSKpQO39vw.png"/></div></div></figure><h1 id="c2d9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建反应式表单</h1><p id="a122" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我不会花太多时间解释如何创建表单，因为本教程更侧重于验证器本身，但是我会给那些还不熟悉的人一个快速概述。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="4068" class="mf ky iq mb b gy mg mh l mi mj">form: FormGroup;<br/>...</span><span id="af7b" class="mf ky iq mb b gy mk mh l mi mj"><em class="ml">this</em>.<em class="ml">form</em> <em class="ml">=</em> <em class="ml">new</em> FormGroup({<br/>  password: <em class="ml">new</em> FormControl('', [<em class="ml">Validators</em>.<em class="ml">required</em>]),<br/>  confirmPassword: <em class="ml">new</em> FormControl('', [<em class="ml">Validators</em>.<em class="ml">required</em>]),<br/>  phoneNumber: <em class="ml">new</em> FormControl('', [<em class="ml">Validators</em>.<em class="ml">required</em>, <em class="ml">Validators</em>.<em class="ml">pattern</em>(<em class="ml">this</em>.<em class="ml">PHONE_NUMBER_REGEX</em>)]),<br/>  startDate: <em class="ml">new</em> FormControl(null, [<em class="ml">Validators</em>.<em class="ml">required</em>]),<br/>  endDate: <em class="ml">new</em> FormControl(null, [<em class="ml">Validators</em>.<em class="ml">required</em>]),<br/>}, {<br/>  validators: [<br/>    <em class="ml">this</em>.<em class="ml">customValidatorsService</em>.<em class="ml">passwordsMatch</em>('password', 'confirmPassword'),<br/>    <em class="ml">this</em>.<em class="ml">customValidatorsService</em>.<em class="ml">startBeforeEnd</em>('startDate', 'endDate', 'endBeforeStart'),<br/>  ]<br/>});</span></pre><p id="b290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">表单组是表单控件的集合。它本质上收集了所有的验证和表单状态，并将它们组合成一个实体。例如，如果表单控件无效，则整个表单组也无效。这同样适用于原始的/脏的、接触过的/未接触过的等..你可以在这里找到关于表单组<a class="ae mm" href="https://angular.io/guide/reactive-forms#step-1-creating-a-formgroup-instance" rel="noopener ugc nofollow" target="_blank">的更深入的解释。</a></p><h1 id="51ad" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">基本验证器</h1><p id="876f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">从<code class="fe mn mo mp mb b">Validators</code>开始提供了一定数量的验证器，例如<code class="fe mn mo mp mb b">required</code>、<code class="fe mn mo mp mb b">email</code>和<code class="fe mn mo mp mb b">min(#)</code>。可以将它们添加到第二个参数(类型为array)内的表单控件中，并且可以根据需要添加任意多个参数。如果验证器的检查失败，表单控件和组上的<code class="fe mn mo mp mb b">errors</code>对象将获得一个与该错误相关的新键/值(值=真)。默认的基本验证器有默认的键，比如<code class="fe mn mo mp mb b">'required'</code>。</p><h1 id="3072" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">自定义验证程序</h1><p id="b1d4" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">自定义验证器可能非常棘手，但是非常有用。一个相当常见的需求是密码匹配。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="2859" class="mf ky iq mb b gy mg mh l mi mj"><em class="ml">passwordsMatch</em>(passwordKey<em class="ml">:</em> string, confirmPasswordKey<em class="ml">:</em> string)<em class="ml">:</em> ValidatorFn {<br/>  <em class="ml">return</em> (control<em class="ml">:</em> AbstractControl)<em class="ml">:</em> { [key<em class="ml">:</em> string]<em class="ml">:</em> boolean } <em class="ml">|</em> null <em class="ml">=&gt;</em> {<br/>    <em class="ml">if</em> (<em class="ml">!control</em>) { <em class="ml">return</em> null; }<br/>    <em class="ml">const password = control.get(passwordKey)</em>;<br/>    <em class="ml">const confirmPassword = control.get(confirmPasswordKey)</em>;<br/>    <em class="ml">if</em> (<em class="ml">!password</em>.<em class="ml">value</em> <em class="ml">||</em> <em class="ml">!confirmPassword</em>.<em class="ml">value</em>) {<br/>      <em class="ml">return</em> null;<br/>    }<br/>  <br/>    <em class="ml">if</em> (<em class="ml">password</em>.<em class="ml">value</em> <em class="ml">!==</em> <em class="ml">confirmPassword</em>.<em class="ml">value</em>) {<br/>      <em class="ml">return</em> { passwordMismatch: true };<br/>    }<br/>    <em class="ml">return</em> null;<br/>  };<br/>}</span></pre><p id="d677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前几行是简单的空检查，确保控件(也称为表单组)和控件(由键指定)存在。检查每个表单控件是否有值。如果用户还没有在两个字段中输入，我们不想验证。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="3c41" class="mf ky iq mb b gy mg mh l mi mj"><em class="ml">if</em> (<em class="ml">!control</em>) { <em class="ml">return</em> null; }<br/><em class="ml">const password = control.get(passwordKey)</em>;<br/><em class="ml">const confirmPassword = control.get(confirmPasswordKey)</em>;<br/><em class="ml">if</em> (<em class="ml">!password</em>.<em class="ml">value</em> <em class="ml">||</em> <em class="ml">!confirmPassword</em>.<em class="ml">value</em>) {<br/>  <em class="ml">return</em> null;<br/>}</span></pre><p id="5cca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从函数返回<code class="fe mn mo mp mb b">null</code>相当于说没有错误。然后检查两个表单控件值是否相等。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="2430" class="mf ky iq mb b gy mg mh l mi mj"><em class="ml">if</em> (<em class="ml">password</em>.<em class="ml">value</em> <em class="ml">!==</em> <em class="ml">confirmPassword</em>.<em class="ml">value</em>) {<br/>  <em class="ml">return</em> { passwordMismatch: true };<br/>}<br/><em class="ml">return</em> null;</span></pre><p id="4f80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，要简单地使用验证器，您需要做如下工作:</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="4bdd" class="mf ky iq mb b gy mg mh l mi mj"><em class="ml">this</em>.<em class="ml">form</em> <em class="ml">=</em> <em class="ml">new</em> FormGroup({<br/>  ...<br/>}, {<br/>  validators: [<br/>    <em class="ml">this</em>.<em class="ml">customValidatorsService</em>.<em class="ml">passwordsMatch</em>('password', 'c confirmPassword'),<br/>     ...<br/>  ]<br/>});</span></pre><p id="4a20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">…其中<code class="fe mn mo mp mb b">'password'</code>和<code class="fe mn mo mp mb b">'confirmPassword'</code>是我们想要匹配的表单控件的名称。</p><p id="8eb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以在同一个服务文件(<em class="ml">custom-validators . service . ts</em>)中看到日期检查的另一个例子，但是我不会对此进行详细描述。我写这段代码的时候感觉很好，所以对两个验证器函数都有单元测试，你可以用<code class="fe mn mo mp mb b">jest</code>或<code class="fe mn mo mp mb b">npm run test</code>来运行。</p><h1 id="93ae" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="9a24" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">习惯自定义表单验证有点乏味，但是它为您希望完成的任何表单验证提供了无限的支持。永远记住从服务中导出您的定制验证器，这样您就可以在应用程序中的任何地方重用这些验证器。</p><p id="cf15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看我在Github上的例子:<a class="ae mm" href="https://github.com/orange-bees/angular-concepts-tutorials" rel="noopener ugc nofollow" target="_blank">https://github.com/orange-bees/angular-concepts-tutorials</a>。</p><h1 id="b40c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">关于我</h1><p id="e877" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我在南卡罗来纳州格林维尔的软件工程咨询公司<a class="ae mm" href="https://orangebees.com/" rel="noopener ugc nofollow" target="_blank"> Orange Bees </a>担任首席工程师。我写得棱角分明。NET应用，在Azure架构项目(Azure Developer Associate认证)，涉猎ElasticSearch和node . js<br/>你可以在<a class="ae mm" href="https://www.linkedin.com/in/james-l-gross/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找我。</p></div></div>    
</body>
</html>