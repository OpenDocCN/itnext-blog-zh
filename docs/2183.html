<html>
<head>
<title>Part 2: Adding Authentication to your Angular Material &amp; AWS Amplify powered PWA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第2部分:为您的角材料添加认证&amp; AWS Amplify powered PWA</h1>
<blockquote>原文：<a href="https://itnext.io/part-2-adding-authentication-to-your-angular-material-aws-amplify-powered-pwa-2a9d0fbd305a?source=collection_archive---------1-----------------------#2019-04-13">https://itnext.io/part-2-adding-authentication-to-your-angular-material-aws-amplify-powered-pwa-2a9d0fbd305a?source=collection_archive---------1-----------------------#2019-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/65703ae259923340652636d5925cc41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T6p0XP-RWQ0_ZkQ7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/photos/gcsNOsPEXfs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">威廉·艾文</a>在<a class="ae kc" href="https://unsplash.com/search/photos/app-sign-up?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="cb11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个多章节系列的第二部分，概述了为移动和桌面构建一个全功能的多平台渐进式Web应用程序(PWA)。</p><ul class=""><li id="7484" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/part-1-building-a-progressive-web-application-pwa-with-angular-material-and-aws-amplify-5c741c957259">第1部分:使用角度/材料、web应用程序清单、服务人员、图标进行构建，并添加到主屏幕功能。使用AWS Amplify CLI部署到AWS。</a></li><li id="22e6" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><strong class="kf ir">第2部分(你在这里)</strong> : <strong class="kf ir">添加了与Amazon Cognito、Social Federation的认证，并支持个人用户资料存储。</strong></li></ul><p id="062e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您尚未完成<a class="ae kc" href="https://medium.com/p/5c741c957259" rel="noopener">第1部分</a>，您至少需要参考设置部分，以安装Amplify CLI和其他要求。为了开始向我们的PWA添加身份验证，我们将使用Amplify CLI来生成一个使用Amazon Cognito用户池的身份验证配置。我们还将增加亚马逊S3的存储空间，用于存储用户个人资料头像和带有自定义属性的个人资料信息。</p><p id="f2c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本节涉及到相当多的样板代码，因为它涉及到从头创建一个定制的验证器组件。因此，我将介绍如何基于第1部分的代码在Angular中生成组件和服务，然后提供Angular中功能的细节。</p><p id="9dcf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">完整的应用代码可以在开源</strong> <a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Github库</strong> </a> <strong class="kf ir">的</strong> <code class="fe lp lq lr ls b"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">partTwo</strong></a></code> <strong class="kf ir">中找到。</strong></p><p id="008b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">重要提示:</strong>在开始之前，请务必通读aws-amplify文档中“<a class="ae kc" href="https://aws-amplify.github.io/docs/js/authentication#social-provider-setup" rel="noopener ugc nofollow" target="_blank">社交提供者设置</a>”部分的社交联盟部分，并检索CLI所需的社交配置项目。</p><p id="42fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从第一部分中完成的应用程序代码开始，从Angular应用程序的根开始:</p><blockquote class="lt lu lv"><p id="34ea" class="kd ke lw kf b kg kh ki kj kk kl km kn lx kp kq kr ly kt ku kv lz kx ky kz la ij bi translated">如果你是从零开始，你需要先运行<code class="fe lp lq lr ls b">amplify init</code>。关于初始化项目的步骤，参见第一部分的最后一节。</p></blockquote><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="a4c0" class="mi mj iq ls b gy mk ml l mm mn">$ amplify add auth</span><span id="eb1a" class="mi mj iq ls b gy mo ml l mm mn"><strong class="ls ir">❯ Apply default configuration with Social Provider (Federation)</strong></span><span id="686b" class="mi mj iq ls b gy mo ml l mm mn">What do you want to do? Apply default configuration with Social Provider (Federation)<br/> What domain name prefix you want us to create for you? <br/>  <strong class="ls ir">materialpwa</strong><br/> Enter your redirect signin URI : <br/>  <a class="ae kc" href="http://localhost:4200/oauth/" rel="noopener ugc nofollow" target="_blank"><strong class="ls ir">http://localhost:4200/auth/</strong></a><br/>? Do you want to add another redirect signin URI <br/>  <strong class="ls ir">No</strong><br/> Enter your redirect signout URI: <br/>  <a class="ae kc" href="http://localhost:4200/signout/" rel="noopener ugc nofollow" target="_blank"><strong class="ls ir">http://localhost:4200/auth/</strong></a><strong class="ls ir">signin</strong><br/>? Do you want to add another redirect signout URI <br/>  <strong class="ls ir">No</strong><br/> Select the identity providers you want to configure for your user pool: <br/>  <strong class="ls ir">Facebook, Google</strong><br/> <br/> Enter your Facebook App ID for your OAuth flow:  <br/>  <strong class="ls ir">&lt;facebook-app-id&gt;</strong><br/> Enter your Facebook App Secret for your OAuth flow:  <br/>  <strong class="ls ir">&lt;facebook-app-secret&gt;</strong><br/> <br/> Enter your Google Web Client ID for your OAuth flow: <br/>  <strong class="ls ir">&lt;google-client-id&gt;</strong><br/> Enter your Google Web Client Secret for your OAuth flow: <br/>  <strong class="ls ir">&lt;google-client-secret&gt;</strong><br/>Successfully updated resource cognitoXXXXXX locally</span></pre><p id="1116" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将使用AWS CloudFormation引导您的AWS云环境，并使用AWS Amplify团队提供的一些预烤的最佳实践创建Amazon Cognito用户池和联合身份设置。默认设置包括:</p><ul class=""><li id="f269" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">注册时的电子邮件确认(您将通过电子邮件收到一个代码，您将在用户界面中输入该代码)。</li><li id="61fc" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">它不包含多因素身份验证(MFA)。您可以随时通过运行<code class="fe lp lq lr ls b">amplify auth update</code>并选择第二个选项来启用MFA，或者通过AWS控制台启用它(这将导致您的CloudFormation设置漂移，如果您通过CLI更新auth，它可能会被覆盖)。</li><li id="5f09" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">Amazon Cognito用户池的社会联盟将完全由Amplify JS库处理。</li></ul><p id="74b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，添加存储并选择<code class="fe lp lq lr ls b">Content (Images, audio, video, etc.)</code>:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="fb56" class="mi mj iq ls b gy mk ml l mm mn">$ amplify add storage<br/>? Please select from one of the below mentioned services (Use arrow keys)<br/><strong class="ls ir">❯ Content (Images, audio, video, etc.)</strong><br/>  NoSQL Database<br/>? Please provide a friendly name for your resource that will be used to label thi<br/>s category in the project: (...) <strong class="ls ir">&lt;press-enter&gt;</strong><br/>? Please provide bucket name: (...) <strong class="ls ir">&lt;press-enter&gt;<br/></strong>? Who should have access: (Use arrow keys)<br/><strong class="ls ir">❯ Auth users only</strong> <br/>  Auth and guest users<br/>? What kind of access do you want for Authenticated users (Use arrow keys)<br/>  read <br/>  write <br/><strong class="ls ir">❯ read/write</strong></span></pre><p id="2854" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在将您的配置推送到云中。</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="e2cc" class="mi mj iq ls b gy mk ml l mm mn">$ amplify push</span><span id="791d" class="mi mj iq ls b gy mo ml l mm mn">Current Environment: development</span><span id="078a" class="mi mj iq ls b gy mo ml l mm mn">| Category | Resource name   | Operation | Provider plugin   |<br/>| -------- | --------------- | --------- | ----------------- |<br/>| Auth     | cognitoXXXXXXX | Create    | awscloudformation |<br/>| Storage  | sXXXXXXXX      | Create    | awscloudformation |<br/>? Are you sure you want to continue? <strong class="ls ir">Yes</strong></span><span id="0bad" class="mi mj iq ls b gy mo ml l mm mn">...CloudFormation Logs...</span><span id="a7be" class="mi mj iq ls b gy mo ml l mm mn">✔ All resources are updated in the cloud</span></pre><p id="23f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦完成，就会生成一个文件:<code class="fe lp lq lr ls b">src/aws-exports.js </code>，该文件将用于访问我们的Angular应用程序中的Auth和Storage APIs。接下来，从Angular应用程序的根目录安装Amplify JavaScript库:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="1ca1" class="mi mj iq ls b gy mk ml l mm mn">$ npm install --save aws-amplify</span></pre><p id="b555" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使我们正在安装整个库，我们也只会将Auth和Storage模块导入到我们的应用程序中。Amplify提供了<a class="ae kc" href="https://hackernoon.com/modular-imports-with-aws-amplify-daeb387b6985" rel="noopener ugc nofollow" target="_blank">模块化导入</a>，这样你就可以保持你的应用程序较小，并且只访问你将从库中使用的功能。Amplify库在幕后利用了AWS JavaScript SDK。AWS JavaScript SDK使用节点类型，因此您需要将它们添加到typescript配置文件中。</p><p id="274c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编辑<code class="fe lp lq lr ls b">src/tsconfig.app.json</code>并将“节点”添加到编译器选项的<code class="fe lp lq lr ls b">types</code>数组中:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="7486" class="mi mj iq ls b gy mk ml l mm mn">{<br/>  "extends": "../tsconfig.json",<br/>  "compilerOptions": {<br/>    "outDir": "../out-tsc/app",<br/>    <strong class="ls ir">"types": ["node"] // &lt;-- add "node" here</strong><br/>  },<br/>"exclude": [<br/>  "test.ts",<br/>  "**/*.spec.ts"<br/>  ]<br/>}</span></pre><p id="5f90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还需要将polyfill添加到<code class="fe lp lq lr ls b">src/polyfills.ts</code>文件中，因为Angular(在6+中)删除了框架中对<code class="fe lp lq lr ls b">global</code>的引用，(*针对Angular 8进行了更新，也删除了process属性，这是另一个服务器端JavaScript属性)，它被AWS SDK组件引用，因为AWS SDK for JavaScript在node.js环境中也受支持，而Angular不受支持。</p><p id="d111" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编辑<code class="fe lp lq lr ls b">src/polyfills.ts </code>并将以下行添加到文件顶部:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="3316" class="mi mj iq ls b gy mk ml l mm mn">(window <em class="lw">as</em> any).global = window;<br/>(window as any).process = {<br/>    env: { DEBUG: undefined },<br/>};</span></pre><blockquote class="lt lu lv"><p id="674a" class="kd ke lw kf b kg kh ki kj kk kl km kn lx kp kq kr ly kt ku kv lz kx ky kz la ij bi translated">如果您有一个正在运行的live development server，您将需要终止它并在此时重新启动它，以便在此时编译类型。</p></blockquote><p id="3d62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过编辑<code class="fe lp lq lr ls b">src/main.ts</code>文件，在我们的Angular应用程序中导入并配置Amplify框架:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="069a" class="mi mj iq ls b gy mk ml l mm mn"><em class="lw">import</em> 'hammerjs';<br/><em class="lw">import</em> { enableProdMode } <em class="lw">from</em> '@angular/core';<br/><em class="lw">import</em> { platformBrowserDynamic } <em class="lw">from</em> '@angular/platform-browser-dynamic';<br/><em class="lw">import</em> { AppModule } <em class="lw">from</em> './app/app.module';<br/><em class="lw">import</em> { environment } <em class="lw">from</em> './environments/environment';</span><span id="d8ba" class="mi mj iq ls b gy mo ml l mm mn">// Amplify Configuration</span><span id="b438" class="mi mj iq ls b gy mo ml l mm mn">import Auth from '@aws-amplify/auth';<br/>import Storage from '@aws-amplify/storage';<br/>import AWSConfig from './aws-exports';<br/>Storage.configure(AWSConfig);<br/>Auth.configure(AWSConfig);</span><span id="44b6" class="mi mj iq ls b gy mo ml l mm mn">// End Amplify Configuration</span><span id="b48f" class="mi mj iq ls b gy mo ml l mm mn"><em class="lw">if</em> (environment.production) {<br/>  enableProdMode();<br/>}</span><span id="c209" class="mi mj iq ls b gy mo ml l mm mn">platformBrowserDynamic().bootstrapModule(AppModule)<br/>  .catch(err =&gt; console.error(err));</span></pre><p id="c897" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将使用Angular CLI生成一组视图组件，这些组件将用于创建自定义身份验证视图。我们将为用户提供仅使用电子邮件和密码通过Cognito用户池登录的能力，创建新帐户，并验证他们在创建新帐户时使用的电子邮件地址。我们将使用有角度的<a class="ae kc" href="https://angular.io/guide/router#guards" rel="noopener ugc nofollow" target="_blank">路线守卫</a>来锁定我们的认证视图，并且在登录时不显示我们的登录/注册视图。警卫将根据身份验证状态进行适当的重定向。我们还将直接对Amplify中的Hub模块使用Auth API来监听认证状态。</p><p id="2c47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户界面(UI)将利用<a class="ae kc" href="https://angular.io/guide/reactive-forms" rel="noopener ugc nofollow" target="_blank">角度反应表单</a>进行表单验证。表单组件和服务需要添加到<a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/blob/master/partTwo/src/app/app.module.ts#L9" rel="noopener ugc nofollow" target="_blank"> app.modules.ts </a>中。将<code class="fe lp lq lr ls b">FormsModule</code>和<code class="fe lp lq lr ls b">ReactiveFormsModule</code>复制到<code class="fe lp lq lr ls b">imports</code>数组中。</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="fe5f" class="mi mj iq ls b gy mk ml l mm mn">imports: [<br/>  ...<br/>  <strong class="ls ir">FormsModule</strong>,    <br/>  <strong class="ls ir">ReactiveFormsModule,<br/>  ...</strong>],</span></pre><p id="882a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您将生成许多应用程序服务和组件。下面的每个链接/解释都将链接到要复制到您的应用程序中的源代码。</p><p id="6373" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为将在应用程序内跨组件使用的共享服务创建一个目录。然后使用Angular CLI生成服务(从应用程序的根目录):</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="b939" class="mi mj iq ls b gy mk ml l mm mn">mkdir src/app/services<br/>ng g service services/compressor<br/>ng g service services/notification</span></pre><p id="2b3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过每个服务的链接复制GitHub上的代码。<a class="ae kc" href="https://raw.githubusercontent.com/mlabieniec/AngularMaterialPWA/master/partTwo/src/app/services/compressor.service.ts" rel="noopener ugc nofollow" target="_blank">压缩器服务</a>用于在将图像上传到S3之前对其进行压缩。<a class="ae kc" href="https://raw.githubusercontent.com/mlabieniec/AngularMaterialPWA/master/partTwo/src/app/services/notification.service.ts" rel="noopener ugc nofollow" target="_blank">通知服务</a>被用作<a class="ae kc" href="https://material.angular.io/components/snack-bar" rel="noopener ugc nofollow" target="_blank">Angular Material snack bar</a>组件的包装器，以简化API的使用并在应用程序中显示临时通知。</p><p id="ca3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，为应用程序视图生成组件。</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="1011" class="mi mj iq ls b gy mk ml l mm mn">ng g component auth<br/>ng g component loader --entryComponent<br/>ng g service loader/loader <br/>ng g component auth/countryCodeSelect --entryComponent <br/>ng g class auth/country-code-select/countryCodes<br/>ng g pipe auth/country-code-select/filter<br/>ng g component auth/signIn<br/>ng g component auth/signUp<br/>ng g component auth/confirmCode<br/>ng g component auth/profile<br/>ng g component auth/profile/avatar</span></pre><p id="5a19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些组件的源代码可以在GitHub资源库中找到，单击每个组件可以检索其源代码，并将其内容复制/粘贴到您的应用程序组件中。</p><ul class=""><li id="9d77" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth" rel="noopener ugc nofollow" target="_blank"> Auth </a>:处理认证路由和视图的主要组件。auth组件仅充当路由器出口。每个子组件都包含身份验证功能的视图，即登录、注册。</li><li id="0e7a" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/loader" rel="noopener ugc nofollow" target="_blank">加载器</a>:显示模态加载对话框的组件，带有材料进度指示器和显示/隐藏加载器的服务。该服务可以注入到任何组件中，并提供显示UI的视图切换功能。</li><li id="3c89" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">角度环境将用于将确认信息(电子邮件/通行证)传递给确认代码组件。这允许您在确认后自动登录用户。更新<a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/environments" rel="noopener ugc nofollow" target="_blank">环境</a> ts文件以包含以下属性对象:</li></ul><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="befe" class="mi mj iq ls b gy mk ml l mm mn">confirm: {<br/>   email: '',<br/>   password: ''<br/>}</span></pre><ul class=""><li id="94fc" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/confirm-code" rel="noopener ugc nofollow" target="_blank"> confirmCode </a>:注册后确认邮箱地址的界面。</li><li id="4b25" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/sign-in" rel="noopener ugc nofollow" target="_blank">登录</a>:新用户登录界面。<strong class="kf ir">注意:</strong>如果您在这些视图上提供您的应用程序，您将会看到一个错误，直到您实现下一节中的防护。</li><li id="9da3" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/sign-up" rel="noopener ugc nofollow" target="_blank">注册</a>:用户创建新账户的界面。</li><li id="16e4" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/country-code-select" rel="noopener ugc nofollow" target="_blank"> countryCodeSelect </a>:为电话号码选择国家代码的UI组件。该组件包含一个视图和一个<a class="ae kc" href="https://angular.io/guide/pipes" rel="noopener ugc nofollow" target="_blank">角度管道过滤器</a>以及一个国家代码数据的类。</li><li id="e565" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/profile" rel="noopener ugc nofollow" target="_blank"> profile </a>:显示存储为<a class="ae kc" href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html" rel="noopener ugc nofollow" target="_blank"> Cognito自定义属性</a>的用户资料信息的UI。</li><li id="ec80" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/tree/master/partTwo/src/app/auth/profile/avatar" rel="noopener ugc nofollow" target="_blank"> avatar </a>:用于通过文件输入和拖放界面显示和上传图片的UI。该文件以每个用户为基础上传并存储在亚马逊S3，以<a class="ae kc" href="https://aws-amplify.github.io/docs/js/storage#file-access-levels" rel="noopener ugc nofollow" target="_blank"> Cognito身份ID作为前缀</a>。</li></ul><p id="521e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您的应用程序中应该有以下目录结构:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="04ef" class="mi mj iq ls b gy mk ml l mm mn">- src<br/>  - app<br/>    - auth<br/>      - confirm-code<br/>      - country-code-select<br/>      - profile<br/>        - avatar<br/>      - sign-in<br/>      - sign-up<br/>    - home <br/>    - ios-install <br/>    - loader<br/>    - material</span></pre><p id="fb66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用角度防护装置来锁定我们只希望对已登录用户可用的视图，并且在相反的情况下，只锁定对未登录用户可用的视图，即登录/注册视图。从<code class="fe lp lq lr ls b">src/app/auth</code>目录运行以下命令:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="1aee" class="mi mj iq ls b gy mk ml l mm mn">ng generate service auth/auth --module=app.module<br/>ng generate guard auth/auth <br/>? Which interfaces would you like to implement? <br/><strong class="ls ir">❯◉ CanActivate</strong><br/> ◯ CanActivateChild<br/> ◯ CanLoad<br/>ng generate guard auth/unauth<br/>? Which interfaces would you like to implement? <br/><strong class="ls ir">❯◉ CanActivate</strong><br/> ◯ CanActivateChild<br/> ◯ CanLoad</span></pre><p id="761f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些文件的源代码可以在GitHub资源库中找到。单击每个项目以检索其源代码，并将其内容复制/粘贴到您的应用程序组件中。</p><ul class=""><li id="7648" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/blob/master/partTwo/src/app/auth/auth.service.ts" rel="noopener ugc nofollow" target="_blank"> AuthService </a>:包装Amplify SignIn和SignUp APIs并公开与Amplify Hub事件分配器相关的Angular Observable的服务，提供身份验证状态更改事件。</li><li id="8919" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/blob/master/partTwo/src/app/auth/auth.guard.ts" rel="noopener ugc nofollow" target="_blank">auth Guard</a>:Angular Router Guard，用于在激活某些路由之前检查认证会话。在我们的应用程序中，只有根路由器<code class="fe lp lq lr ls b">\</code>需要认证会话才能激活。</li><li id="ca0a" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated"><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/blob/master/partTwo/src/app/auth/unauth.guard.ts" rel="noopener ugc nofollow" target="_blank">un Guard</a>:Angular Router Guard，用于检查认证会话，并在未登录到应用程序时显示登录/注册视图。</li></ul><p id="e38b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要启用路由保护，请在<a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/blob/master/partTwo/src/app/app-routing.module.ts" rel="noopener ugc nofollow" target="_blank"> app-routing.module.ts </a>文件中引用它们:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="50f5" class="mi mj iq ls b gy mk ml l mm mn">const routes: Routes = [  <br/>  { path: 'auth', component: AuthComponent, children: [    <br/>     {      <br/>        path: 'signin',      <br/>        component: SignInComponent,      <br/>        <strong class="ls ir">canActivate: [UnauthGuard] </strong>   <br/>     },    <br/>     {      <br/>        path: 'signup',<br/>        component: SignUpComponent,<br/>        <strong class="ls ir">canActivate: [UnauthGuard]</strong>    <br/>     },    <br/>     {<br/>        path: 'confirm',<br/>        component: ConfirmCodeComponent,<br/>        <strong class="ls ir">canActivate: [UnauthGuard] </strong>   <br/>     },    <br/>     {<br/>        path: 'profile',<br/>        component: ProfileComponent,<br/>        <strong class="ls ir">canActivate: [AuthGuard]</strong><br/>     }  <br/>  ]},  <br/>  { path: '', component: HomeComponent, <strong class="ls ir">canActivate: [AuthGuard]</strong> }];</span></pre><p id="b5be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的应用程序现在应该可以服务了。为了测试PWA，在UI开发过程中运行<code class="fe lp lq lr ls b">ng serve</code>更容易。因为服务人员将缓存这些视图，使得实时重新加载变得困难。立即使用以下工具测试您的应用:</p><pre class="ma mb mc md gt me ls mf mg aw mh bi"><span id="7943" class="mi mj iq ls b gy mk ml l mm mn">ng serve</span></pre><p id="fd54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您的应用程序应该在端口4200上可用。在菜单中点击我的帐户(第2部分)，你应该有一个自定义材料设计的动态表单验证验证器。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/04307aaaaeae0143467d64d836763b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*r8o5JbK7y0fXW4DjKMT4GQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">登录社交提供商</figcaption></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/9874e7edeaf1431ad67f956031d359d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*FaGltTHEUcsLLeTK2qSQOg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带有国家代码选择器的电话</figcaption></figure><p id="4bf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您注册新帐户时，您将收到一个确认屏幕，要求您输入通过电子邮件发送给您的代码。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/bcec1a6047ba38cf62abdb6f0bd743db.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*xDCkuDZ9vIGJVAV1qooMaA.png"/></div></figure><p id="74ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当您输入此代码时，我们使用存储在环境中的信息来让用户自动登录到，这样他们就不必返回到登录屏幕。一旦确认，你应该被直接送到首页查看。</p><p id="7178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当导航到诸如登录或注册之类的内容时。未授权将阻止视图加载，并自动将用户重新路由到纵断面图。profile视图将显示注册时输入的值，并允许对它们进行编辑(Cognito中的自定义资源)。它还将托管用于上传头像图像到S3的头像组件。avatar组件支持使用文件输入，以及将图像拖放到图片画布上。</p><p id="0028" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">感谢查看帖子！如果您遇到问题或bug</strong><a class="ae kc" href="https://github.com/mlabieniec/AngularMaterialPWA/issues/new/choose" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">请在GitHub </strong> </a> <strong class="kf ir">中发帖，也欢迎拉请求。</strong></p></div></div>    
</body>
</html>