<html>
<head>
<title>Spotinfo — a new CLI for AWS Spot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spot info——自动气象站Spot的新命令行界面</h1>
<blockquote>原文：<a href="https://itnext.io/spotinfo-a-new-cli-for-aws-spot-a9748bbe338f?source=collection_archive---------1-----------------------#2021-05-13">https://itnext.io/spotinfo-a-new-cli-for-aws-spot-a9748bbe338f?source=collection_archive---------1-----------------------#2021-05-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0dc7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从命令行浏览AWS spot实例</h2></div><h2 id="b61f" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="a503" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><code class="fe lu lv lw lx b">spotinfo</code>是一个命令行工具，可以用来跨多个AWS区域探索AWS Spot实例。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/b7fe89ac4912c1b587288ba3a2ea0d66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJY37YRDTevS13lXUfAgyQ.jpeg"/></div></div></figure><h2 id="754a" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h2><p id="4e2b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">使用<a class="ae mk" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank"> Amazon EC2 Spot </a>实例是降低EC2随需应变实例成本的一个很好的方法，最多可降低90%。无论何时，如果您的工作负载能够在虚拟机中断后继续运行，或者在不影响业务用例的情况下暂停并恢复运行，那么选择现货定价模式是一个显而易见的选择。</p><p id="557c" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">中断率越低，Spot实例运行的时间就越长。</p><p id="d074" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">Amazon提供了一个优秀的web界面<a class="ae mk" href="https://aws.amazon.com/ec2/spot/instance-advisor/" rel="noopener ugc nofollow" target="_blank"> AWS Spot Instance Advisor </a>来探索可用的Spot实例，并确定中断机会最少的Spot实例池。您还可以查看通过按需费率节省的费用。您还可以查看通过按需费率节省的费用。然后，您应该使用这些度量来选择适当的Spot实例。</p><p id="3032" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">虽然<strong class="ld ir"> AWS Spot Instance Advisor </strong>是一个有价值的工具，但使用它的数据进行脚本编写和自动化并不容易，而且一些用例需要太多的点击。</p><h2 id="bc64" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Spotinfo工具</h2><p id="df3b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">这就是我创建<code class="fe lu lv lw lx b">spotinfo</code>工具的原因。这是一个易于使用的命令行工具(在Apache 2.0许可下开源)，允许您在终端中探索AWS Spot实例，并使用它提供的Spot数据进行脚本编写和自动化。</p><p id="8e0b" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">在引擎盖下，<code class="fe lu lv lw lx b">spotinfo</code>使用AWS提供的两个公共数据源:</p><ol class=""><li id="02fb" class="mq mr iq ld b le ml lh mm ko ms ks mt kw mu lt mv mw mx my bi translated"><strong class="ld ir"> AWS Spot实例顾问</strong> <a class="ae mk" href="https://spot-bid-advisor.s3.amazonaws.com/spot-advisor-data.json" rel="noopener ugc nofollow" target="_blank">数据馈送</a></li><li id="776f" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt mv mw mx my bi translated">AWS现货定价<a class="ae mk" href="http://spot-price.s3.amazonaws.com/spot.js" rel="noopener ugc nofollow" target="_blank">数据馈送</a></li></ol><h2 id="7f47" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">特征</h2><p id="834c" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><code class="fe lu lv lw lx b">spotinfo</code>允许您访问与在<strong class="ld ir"> AWS Spot Instance Advisor </strong>中看到的信息相同的信息，但是是从命令行访问，并且可用于脚本和自动化用例。此外，该工具还提供了一些<strong class="ld ir">AWS Spot Instance Advisor</strong>web界面所没有的有用功能。</p><h2 id="ac7e" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">高级过滤</h2><p id="46c3" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">第一个特点是<em class="ne">高级过滤</em>。您可以通过以下方式过滤定点实例:</p><ul class=""><li id="70e1" class="mq mr iq ld b le ml lh mm ko ms ks mt kw mu lt nf mw mx my bi translated">vCPU—CPU核心的最小数量</li><li id="6bdf" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">内存GiB —最小内存大小</li><li id="39a2" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">操作系统— Linux或Windows</li><li id="6bdc" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">区域—一个或多个AWS区域(或<code class="fe lu lv lw lx b">all</code> AWS区域)</li><li id="c11a" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">节省(与按需相比)</li><li id="dedf" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">中断频率</li><li id="e531" class="mq mr iq ld b le mz lh na ko nb ks nc kw nd lt nf mw mx my bi translated">小时费率(以<code class="fe lu lv lw lx b">USD/hour</code>为单位)</li></ul><p id="fd19" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">按实例类型过滤时，支持<a class="ae mk" href="https://github.com/google/re2/wiki/Syntax" rel="noopener ugc nofollow" target="_blank">正则表达式</a>。这可以帮助您创建高级查询。</p><p id="cebb" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">示例:使用正则表达式过滤</p><p id="bbf9" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">列出(以文本形式)在<code class="fe lu lv lw lx b">us-west-2</code>(俄勒冈州)地区所有可用的由<a class="ae mk" href="https://aws.amazon.com/ec2/graviton/" rel="noopener ugc nofollow" target="_blank"> Graviton2 </a>处理器支持的EC2 Spot实例，至少有八个CPU内核，按现货价格对结果进行排序。</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="52c3" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">现货价格可见性</h2><p id="8fd9" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">使用<strong class="ld ir"> AWS Spot Instance Advisor </strong>，您可以看到相对于按需EC2实例价格的折扣。但是为了找出你将要支付的实际价格，你必须访问不同的<a class="ae mk" href="https://aws.amazon.com/ec2/spot/pricing/" rel="noopener ugc nofollow" target="_blank"> AWS现货定价</a>网页，并再次搜索特定的实例类型。</p><p id="9f97" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><code class="fe lu lv lw lx b">spotinfo</code>节省你的时间，可以显示现货价格和其他信息。如果你愿意，你也可以根据现货价格进行筛选和排序。</p><h2 id="fd59" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">灵活的输出格式</h2><p id="4903" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">在命令行中处理数据以及从脚本和自动化中访问数据需要灵活的输出格式。<code class="fe lu lv lw lx b">spotinfo</code>可以返回多种格式的结果:人性化的格式，如<code class="fe lu lv lw lx b">table</code>和普通的<code class="fe lu lv lw lx b">text</code>，自动化友好的:<code class="fe lu lv lw lx b">json</code>、<code class="fe lu lv lw lx b">csv</code>，或者只是一个保存的数字。选择任何具体用例所需的格式。</p><h2 id="a9ab" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">跨多个区域比较斑点</h2><p id="37e8" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">关于<strong class="ld ir"> AWS Spot实例顾问</strong>的一个恼人的事情是无法跨多个AWS区域比较EC2 spot实例。只有一个区域视图可用，或者您需要打开多个浏览器选项卡并不断地在它们之间切换，以便跨多个AWS区域比较spot实例。</p><p id="9c61" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><code class="fe lu lv lw lx b">spotinfo</code>可以帮助您跨多个AWS区域比较spot实例。您所需要做的就是传递一个<code class="fe lu lv lw lx b">--region</code>命令行标志，并且您可以多次使用这个标志。</p><p id="0d88" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">另一个选项是传递一个特殊的<code class="fe lu lv lw lx b">all</code>值(带有<code class="fe lu lv lw lx b">--region=all</code>标志)来查看所有可用AWS区域中的spot实例。</p><p id="10fd" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">示例:浏览<code class="fe lu lv lw lx b">t4g.small</code> Spot实例</p><p id="ccc6" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">探索<code class="fe lu lv lw lx b">t4g.small</code> spot实例类型的可用性以及在<strong class="ld ir">所有</strong> AWS区域中该实例类型可用的比率。</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="e9f8" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">网络弹性</h2><p id="76b8" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">虽然<code class="fe lu lv lw lx b">spotinfo</code>使用公共AWS数据源，但它也在工具中嵌入了相同的数据。因此，如果数据馈送由于任何原因(没有连接、服务不可用或其他原因)不可用，那么<code class="fe lu lv lw lx b">spotinfo</code>仍然能够返回相同的结果。</p><h2 id="83a1" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">摘要</h2><p id="d22c" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我希望<code class="fe lu lv lw lx b">spotinfo</code>能够成为探索AWS EC2 spot实例的有用工具。我期待着您的评论和任何问题。</p><p id="e0f1" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated">我邀请你为<a class="ae mk" href="https://github.com/alexei-led/spotinfo" rel="noopener ugc nofollow" target="_blank">阿列克谢领导的/spotinfo </a> GitHub项目贡献(问题、功能、拉请求)。</p><p id="9301" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><em class="ne">附言</em>:如果你喜欢<code class="fe lu lv lw lx b">spotinfo</code>工具，可以考虑给GitHub <a class="ae mk" href="https://github.com/alexei-led/spotinfo" rel="noopener ugc nofollow" target="_blank">项目</a>一个⭐️</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="91ea" class="pw-post-body-paragraph lb lc iq ld b le ml jr lg lh mm ju lj ko mn ll lm ks mo lo lp kw mp lr ls lt ij bi translated"><strong class="ld ir"> <em class="ne">感谢阅读！</em> </strong> <em class="ne">要保持联系，请关注我们的</em> <a class="ae mk" href="https://blog.doit-intl.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> DoiT工程博客</em> </a> <em class="ne">，</em> <a class="ae mk" href="https://www.linkedin.com/company/doitintl/" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> DoiT Linkedin频道</em> </a> <em class="ne">，以及</em> <a class="ae mk" href="https://twitter.com/doitint" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> DoiT Twitter频道</em> </a> <em class="ne">。要探索职业机会，请访问https://careers.doit-intl.com</em><a class="ae mk" href="https://careers.doit-intl.com/" rel="noopener ugc nofollow" target="_blank"><em class="ne"/></a><em class="ne">。</em></p></div></div>    
</body>
</html>