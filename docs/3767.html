<html>
<head>
<title>Deploying the Ambassador Edge Stack as an Ingress Controller for Kubernetes with TLS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Ambassador Edge堆栈部署为带TLS的Kubernetes的入口控制器</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-the-ambassador-edge-stack-as-an-ingress-controller-for-kubernetes-with-tls-cdc85495e3ac?source=collection_archive---------3-----------------------#2020-02-20">https://itnext.io/deploying-the-ambassador-edge-stack-as-an-ingress-controller-for-kubernetes-with-tls-cdc85495e3ac?source=collection_archive---------3-----------------------#2020-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e970" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">辅导的</h2><div class=""/><div class=""><h2 id="2678" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">在不到5分钟的时间内将流量引入您的Kubernetes集群</h2></div><p id="46c7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我以前写过如何将外部流量路由到您的Kubernetes集群。在那篇文章中，我定义了<a class="ae lk" href="https://blog.getambassador.io/kubernetes-ingress-nodeport-load-balancers-and-ingress-controllers-6e29f1c44f2d" rel="noopener ugc nofollow" target="_blank">三个主要策略</a>:使用类型为<a class="ae lk" href="https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport" rel="noopener ugc nofollow" target="_blank"> NodePort </a>的Kubernetes服务，使用类型为LoadBalancer的Kubernetes服务，或者使用Kubernetes入口资源。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/febc54b6a48f3626403e6847014e6133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jnawHcWRrrblLbEkqG50g.png"/></div></div></figure><p id="062e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在本教程中，我将展示如何使用Ambassador Edge堆栈作为Kubernetes的入口控制器，并通过TLS自动公开您的应用程序。</p><p id="10e2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">大使边缘堆栈是一个入口控制器(然后一些！)由Envoy代理提供支持，并通过Kubernetes CRDs进行声明式配置。Ambassador Edge堆栈还集成了自动证书管理环境(ACME)支持，<a class="ae lk" href="https://blog.getambassador.io/ambassador-integrates-automatic-https-for-kubernetes-ingress-43e738b48729" rel="noopener ugc nofollow" target="_blank">为每个人实现自动HTTPS</a>。</p><h1 id="44f3" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">大使边缘堆栈作为入口控制器</h1><ol class=""><li id="cd44" class="mp mq iq kq b kr mr ku ms kx mt lb mu lf mv lj mw mx my mz bi translated">安装大使边缘堆栈作为您的入口控制器。</li></ol><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="84e6" class="nf ly iq nb b gy ng nh l ni nj">kubectl apply -f <a class="ae lk" href="https://www.getambassador.io/yaml/aes-crds.yaml" rel="noopener ugc nofollow" target="_blank">https://www.getambassador.io/yaml/aes-crds.yaml</a> &amp;&amp; \ <br/>kubectl wait --for condition=established --timeout=90s crd -lproduct=aes &amp;&amp; \ <br/>kubectl apply -f <a class="ae lk" href="https://www.getambassador.io/yaml/aes.yaml" rel="noopener ugc nofollow" target="_blank">https://www.getambassador.io/yaml/aes.yaml</a> &amp;&amp; \<br/>kubectl -n ambassador wait --for condition=available --timeout=90s deploy -lproduct=aes</span></pre><p id="0990" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">2.我们现在将在Kubernetes中部署一个简单的服务，即<code class="fe nk nl nm nb b">quote</code>服务。将下面的YAML保存到一个名为<code class="fe nk nl nm nb b">quote.yaml</code>的文件中。</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="26d0" class="nf ly iq nb b gy ng nh l ni nj">---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: quote<br/>  namespace: ambassador<br/>spec:<br/>  ports:<br/>  - name: http<br/>    port: 80<br/>    targetPort: 8080<br/>  selector:<br/>    app: quote<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: quote<br/>  namespace: ambassador<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: quote<br/>  strategy:<br/>    type: RollingUpdate<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: quote<br/>    spec:<br/>      containers:<br/>      - name: backend<br/>        image: quay.io/datawire/quote:0.2.7<br/>        ports:<br/>        - name: http<br/>          containerPort: 8080</span></pre><p id="e514" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">3.在集群上部署<code class="fe nk nl nm nb b">quote</code>服务:</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="c587" class="nf ly iq nb b gy ng nh l ni nj">kubectl apply -f quote.yaml</span></pre><p id="fd50" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">4.现在，创建一个入口资源，告诉大使(和我们的外部用户)如何访问<code class="fe nk nl nm nb b">quote</code>服务。将下面的内容保存到一个名为<code class="fe nk nl nm nb b">quote-ingress.yaml</code>的文件中。</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="b39d" class="nf ly iq nb b gy ng nh l ni nj">---<br/>apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  annotations:<br/>    kubernetes.io/ingress.class: ambassador<br/>  name: quote-ingress<br/>  namespace: ambassador<br/>spec:<br/>  rules:<br/>   - http:<br/>       paths:<br/>       - path: /quote/<br/>         backend:<br/>           serviceName: quote<br/>           servicePort: 80</span></pre><p id="c8bd" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">4.将入口资源应用到集群:</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="1a77" class="nf ly iq nb b gy ng nh l ni nj">kubectl apply -f quote-ingress.yaml</span></pre><p id="475f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">5.获取您的群集的IP地址:</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="50d1" class="nf ly iq nb b gy ng nh l ni nj">kubectl get -n ambassador service ambassador -o 'go-template={{range .status.loadBalancer.ingress}}{{print .ip "\n"}}{{end}}</span></pre><p id="264d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">6.Ambassador Edge Stack的一个特性是默认配置TLS。因此，使用上一步中的IP地址，通过<code class="fe nk nl nm nb b">https</code>向您的系统发送一个<code class="fe nk nl nm nb b">curl</code>:</p><pre class="lm ln lo lp gt na nb nc nd aw ne bi"><span id="eba4" class="nf ly iq nb b gy ng nh l ni nj">curl -k <a class="ae lk" href="https://130.211.200.120/quote/" rel="noopener ugc nofollow" target="_blank">https://YOUR_IP_ADDRESS/quote/</a></span></pre><p id="f3b4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">不要忘记<code class="fe nk nl nm nb b">-k</code>选项Ambassador Edge堆栈会自动安装自签名证书，因此我们需要<code class="fe nk nl nm nb b">curl</code>来自动接受证书。</p><p id="f40e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">恭喜你！您已经安装了Ambassador Edge堆栈，并拥有一个成熟的入口控制器。</p><h1 id="6ef9" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">边缘策略控制台</h1><p id="feae" class="pw-post-body-paragraph ko kp iq kq b kr mr ka kt ku ms kd kw kx nn kz la lb no ld le lf np lh li lj ij bi translated">您可以访问大使边缘堆栈边缘策略控制台UI来配置大使的其他方面。例如，UI让您自动从Let's Encrypt获得您自己的证书。</p><p id="53a3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在您的浏览器中，输入与上面相同的IP地址，并按照说明访问UI。同样，在您配置自己的证书之前，您需要确保您的浏览器接受自签名证书。</p><h1 id="c394" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">有问题吗？</h1><p id="a4e0" class="pw-post-body-paragraph ko kp iq kq b kr mr ka kt ku ms kd kw kx nn kz la lb no ld le lf np lh li lj ij bi translated">如果您对本教程或大使边缘堆栈有任何疑问，请<a class="ae lk" href="http://d6e.co/slack" rel="noopener ugc nofollow" target="_blank">加入我们的Slack频道</a>，或<a class="ae lk" href="https://www.getambassador.io/contact" rel="noopener ugc nofollow" target="_blank">联系我们</a>。</p><p id="1752" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果本教程解决了你的需要，我们很乐意听到它。请在下面的评论中给我们留言，或者在Twitter上发<a class="ae lk" href="https://www.twitter.com/getambassadorio?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> @getambassadorio </a>。</p></div></div>    
</body>
</html>