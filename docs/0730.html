<html>
<head>
<title>Deploy JIRA and Confluence on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在库伯内特斯部署JIRA和汇流</h1>
<blockquote>原文：<a href="https://itnext.io/jira-on-kubernetes-by-helm-8a38357da4e?source=collection_archive---------2-----------------------#2018-05-16">https://itnext.io/jira-on-kubernetes-by-helm-8a38357da4e?source=collection_archive---------2-----------------------#2018-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Atlassian JIRA软件和Confluence是一个很好的敏捷管理工具。我们可以在几分钟内开始在Atlassian Cloud上使用JIRA和Confluence，但在某些情况下我们仍然需要一个私有服务器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/11107cf261ecdb808019e7253d128bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6jull6_arv-BjNiDP-9nA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">亚特兰蒂斯JIRA软件公司</figcaption></figure><p id="9dcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我刚刚发表了JIRA和汇流的Kubernetes掌舵图。您可以在Kubernetes集群上轻松部署JIRA和Confluence。</p><h1 id="2b2b" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">入门指南</h1><h2 id="0f5d" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">安装工具</h2><p id="9cbc" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">确保您可以使用<code class="fe mr ms mt mu b">helm</code>命令访问集群。</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="c15a" class="ma ld iq mu b gy mz na l nb nc">brew install kubernetes-helm<br/>helm init</span></pre><p id="8699" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们使用<a class="ae lb" href="https://github.com/roboll/helmfile" rel="noopener ugc nofollow" target="_blank"> Helmfile </a>进行配置管理。</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="162d" class="ma ld iq mu b gy mz na l nb nc">curl -L -o ~/bin/helmfile <a class="ae lb" href="https://github.com/roboll/helmfile/releases/download/v0.17.0/helmfile_darwin_amd64" rel="noopener ugc nofollow" target="_blank">https://github.com/roboll/helmfile/releases/download/v0.17.0/helmfile_darwin_amd64</a><br/>chmod +x ~/bin/helmfile</span></pre><h2 id="126a" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">部署JIRA</h2><p id="94b2" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">获取图表的存储库。</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="44d9" class="ma ld iq mu b gy mz na l nb nc">git clone <a class="ae lb" href="https://github.com/int128/devops-kompose" rel="noopener ugc nofollow" target="_blank">https://github.com/int128/devops-kompose</a><br/>cd devops-kompose</span></pre><p id="6526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为您的集群创建<code class="fe mr ms mt mu b">helmfile.yaml</code>。例如，如果您使用一个<code class="fe mr ms mt mu b">Ingress</code>在<code class="fe mr ms mt mu b">https://jira.example.com</code>上部署JIRA，它将如下所示:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="0f15" class="ma ld iq mu b gy mz na l nb nc">releases:<br/>  - name: atlassian-jira-software<br/>    namespace: devops<br/>    chart: ./atlassian-jira-software<br/>    values:<br/>      - ingress:<br/>          enabled: true<br/>          hosts:<br/>            - jira.example.com<br/>        jira:<br/>          reverseProxyHost: jira.example.com<br/>        resources:<br/>          limits:<br/>            memory: 1536Mi<br/>          requests:<br/>            memory: 1536Mi</span></pre><p id="9ed4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在应用更改。</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="adcd" class="ma ld iq mu b gy mz na l nb nc">helmfile sync</span><span id="86ac" class="ma ld iq mu b gy nd na l nb nc">exec: helm repo update<br/>Hang tight while we grab the latest from your chart repositories...<br/>...<br/>Release "atlassian-jira-software" has been upgraded. Happy Helming!<br/>LAST DEPLOYED: Wed May 16 09:32:11 2018<br/>NAMESPACE: devops<br/>STATUS: DEPLOYED</span><span id="0c86" class="ma ld iq mu b gy nd na l nb nc">RESOURCES:<br/>==&gt; v1/Pod(related)<br/>NAME                                      READY  STATUS       RESTARTS  AGE<br/>atlassian-jira-software-7997fcf5c7-qk84j  1/1    Terminating  0         12h</span><span id="99d8" class="ma ld iq mu b gy nd na l nb nc">==&gt; v1/PersistentVolumeClaim<br/>NAME                     STATUS  VOLUME                                    CAPACITY  ACCESS MODES  STORAGECLASS  AGE<br/>atlassian-jira-software  Bound   pvc-f6a375fc-15e0-11e8-9a6e-06365716f47a  8Gi       RWO           gp2           5d</span><span id="fd94" class="ma ld iq mu b gy nd na l nb nc">==&gt; v1/Service<br/>NAME                     TYPE       CLUSTER-IP     EXTERNAL-IP  PORT(S)   AGE<br/>atlassian-jira-software  ClusterIP  100.68.177.22  &lt;none&gt;       8080/TCP  5d</span><span id="5017" class="ma ld iq mu b gy nd na l nb nc">==&gt; v1beta2/Deployment<br/>NAME                     DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE<br/>atlassian-jira-software  1        0        0           0          5d</span><span id="5149" class="ma ld iq mu b gy nd na l nb nc">==&gt; v1beta1/Ingress<br/>NAME                     HOSTS                     ADDRESS           PORTS  AGE<br/>atlassian-jira-software  jira.example.com          1.2.3.4...  80     5d</span><span id="0e6e" class="ma ld iq mu b gy nd na l nb nc">NOTES:<br/>Atlassian JIRA Software is starting now.</span></pre><p id="8f74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<a class="ae lb" href="https://jira.example.com" rel="noopener ugc nofollow" target="_blank">https://jira.example.com</a>并设置你的JIRA服务器。您可能需要一个外部数据库，如AWS RDS。</p><h2 id="8a6e" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">部署合流</h2><p id="999a" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">您可以用同样的方式部署Confluence。如果您使用<code class="fe mr ms mt mu b">Ingress</code>在<code class="fe mr ms mt mu b">https://wiki.example.com</code>上部署Confluence，您的<code class="fe mr ms mt mu b">helmfile.yaml</code>将如下所示:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="f882" class="ma ld iq mu b gy mz na l nb nc">releases:<br/>  - name: atlassian-confluence<br/>    namespace: devops<br/>    chart: ./atlassian-confluence<br/>    values:<br/>      - ingress:<br/>          enabled: true<br/>          hosts:<br/>            - wiki.example.com<br/>        confluence:<br/>          reverseProxyHost: wiki.example.com<br/>        resources:<br/>          limits:<br/>            memory: 1800Mi<br/>          requests:<br/>            memory: 1800Mi</span></pre><p id="b90e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后应用更改:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="f0fd" class="ma ld iq mu b gy mz na l nb nc">helmfile sync</span></pre><h1 id="04da" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">高级主题</h1><h2 id="c240" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">Helmfile模板</h2><p id="85af" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated"><a class="ae lb" href="https://github.com/roboll/helmfile" rel="noopener ugc nofollow" target="_blank"> Helmfile </a>支持变量替换等模板。您可以创建一个模板，并为您的各种项目分发它。</p><p id="db80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，您可以在<code class="fe mr ms mt mu b">helmfile.yaml</code>中放置一个占位符，如下所示:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="06b3" class="ma ld iq mu b gy mz na l nb nc">- name: atlassian-jira-software<br/>    namespace: devops<br/>    chart: ./atlassian-jira-software<br/>    values:<br/>      - ingress:<br/>          enabled: true<br/>          hosts:<br/>            - jira.{{ requiredEnv "DEVOPS_DOMAIN" }}<br/>        jira:<br/>          reverseProxyHost: jira.{{ requiredEnv "DEVOPS_DOMAIN" }}</span></pre><p id="0867" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用以下变量创建<code class="fe mr ms mt mu b">.env</code>:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="967f" class="ma ld iq mu b gy mz na l nb nc">export DEVOPS_DOMAIN=example.com</span></pre><p id="5db8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用更改。</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="fcf5" class="ma ld iq mu b gy mz na l nb nc">source .env<br/>helmfile sync</span></pre><p id="256b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后JIRA将被部署在<code class="fe mr ms mt mu b">jira.example.com</code>。</p><h2 id="3bf7" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">坚持</h2><p id="2464" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">JIRA/Confluence将数据存储到数据库和持久卷中。如果您使用内部数据库(不推荐)，两者在同一个卷中。</p><p id="7c81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，该图表创建8GB卷。您可以按如下方式更改<code class="fe mr ms mt mu b">helmfile.yaml</code>中的尺寸:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="4666" class="ma ld iq mu b gy mz na l nb nc">releases:<br/>  - name: atlassian-jira-software<br/>    namespace: devops<br/>    chart: ./atlassian-jira-software<br/>    values:<br/>      - ingress:<br/>          enabled: true<br/>          hosts:<br/>            - jira.example.com<br/>        jira:<br/>          reverseProxyHost: jira.example.com<br/>        persistence:<br/>          size: 100Gi</span></pre><p id="bcf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该定期拍摄数据库和卷的快照进行备份。</p><h2 id="02bc" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">记忆</h2><p id="8cec" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">JIRA/汇流需要更多的内存来获得舒适的体验。</p><p id="208c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，一个pod需要1536MB的内存。在大多数情况下，这可能就足够了，但是您可以通过如下更改<code class="fe mr ms mt mu b">helmfile.yaml</code>来增加或减少内存:</p><pre class="km kn ko kp gt mv mu mw mx aw my bi"><span id="961f" class="ma ld iq mu b gy mz na l nb nc">releases:<br/>  - name: atlassian-jira-software<br/>    namespace: devops<br/>    chart: ./atlassian-jira-software<br/>    values:<br/>      - ingress:<br/>          enabled: true<br/>          hosts:<br/>            - jira.example.com<br/>        jira:<br/>          reverseProxyHost: jira.example.com<br/>          javaOptions: -Xmx2g -Xms2g<br/>        resources:<br/>          limits:<br/>            memory: 2560Mi<br/>          requires:<br/>            memory: 2560Mi</span></pre><p id="a1f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你必须同时给<code class="fe mr ms mt mu b">javaOptions</code>和<code class="fe mr ms mt mu b">resources</code>来防止OOM杀手。目前<a class="ae lb" href="https://jira.atlassian.com/browse/JRASERVER-67303" rel="noopener ugc nofollow" target="_blank"> JIRA不支持</a> <code class="fe mr ms mt mu b"><a class="ae lb" href="https://jira.atlassian.com/browse/JRASERVER-67303" rel="noopener ugc nofollow" target="_blank">-XX:+UseCGroupMemoryLimitForHeap</a></code> <a class="ae lb" href="https://jira.atlassian.com/browse/JRASERVER-67303" rel="noopener ugc nofollow" target="_blank">选项</a>。</p><h1 id="88c7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="4448" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">您可以使用Helm charts在Kubernetes集群上轻松部署JIRA和Confluence。</p></div></div>    
</body>
</html>