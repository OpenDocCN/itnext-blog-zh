<html>
<head>
<title>Creating &amp; styling dropdown menus on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上创建和设计下拉菜单</h1>
<blockquote>原文：<a href="https://itnext.io/styling-material-exposed-dropdown-menus-on-android-19c7d21a9fcc?source=collection_archive---------2-----------------------#2021-07-26">https://itnext.io/styling-material-exposed-dropdown-menus-on-android-19c7d21a9fcc?source=collection_archive---------2-----------------------#2021-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/3fe0b9ce569cd23b821f80dfe8011f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJ2206I4BTaZ70hJN1qqzA.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="61e4" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你现在可以在我的子页面<a class="ae la" href="https://thatgreekengineer.substack.com/" rel="noopener ugc nofollow" target="_blank">https://thatgreekengineer.substack.com/</a>找到这篇文章和其他文章！</p></blockquote><p id="8a10" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我最近不得不为我的应用程序实现一个定制的下拉菜单，这花了我很长时间来弄清楚该设计什么样式以及如何正确地完成它，以达到我想要的外观和感觉。因此，在本文中，我将介绍如何使用TextInputLayout和AutoCompleteTextView定制一个公开的下拉菜单。我们将从这里开始:</p><figure class="lf lg lh li gt is gh gi paragraph-image"><div class="gh gi le"><img src="../Images/545c8aaa0cb6f8bd1855c5b3e0fe8f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*l9aefZ743r-H4bftfr_qzQ.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">稍微定制的暴露下拉菜单</figcaption></figure><p id="954a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">对此:</p><figure class="lf lg lh li gt is gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/8dc92b207a81cffa90f4a88d124a2755.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*dJNH4aP1CrbWZ0rYV_iG2Q.jpeg"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">最终显示的下拉菜单</figcaption></figure><h1 id="dd12" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">什么是暴露的下拉菜单？</h1><p id="19ba" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">暴露的下拉菜单在选项列表上方显示当前选定的菜单项。一些变体可以接受用户输入的输入。在Android上，这个功能可以使用一个<code class="fe mr ms mt mu b">TextInputLayout</code>和一个嵌套的<code class="fe mr ms mt mu b">AutocompleteTextView</code>来实现，它们都是Android素材库的组件。让我们将这个库导入到我们的项目中:</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="699a" class="mz lp jb mu b gy na nb l nc nd">implementation ‘com.google.android.material:material:1.4.0’</span></pre><p id="47be" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在本教程中，我还将使用V<strong class="ke jc">view binding</strong>，所以请确保通过添加以下内容在您的模块的build.gradle中启用它:</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="e705" class="mz lp jb mu b gy na nb l nc nd">android {<br/>   ...<br/>   buildFeatures {<br/>       viewBinding <em class="kd">true<br/>   </em>}<br/>}</span></pre><h1 id="455c" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">设计基本布局</h1><p id="c06e" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">让我们从声明一个材料暴露下拉菜单的基本布局开始。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="b574" class="mz lp jb mu b gy na nb l nc nd">&lt;com.google.android.material.textfield.TextInputLayout<br/>    <em class="kd">android:id</em>="@+id/dateFilterContainer" <em class="kd">style</em>="@style/Widget.MaterialComponents.TextInputLayout.FilledBox.ExposedDropdownMenu"<br/>    <em class="kd">android:layout_width</em>="wrap_content"<br/>    <em class="kd">android:layout_height</em>="wrap_content"<br/>    android:hint="<a class="ae la" href="http://twitter.com/string/label" rel="noopener ugc nofollow" target="_blank">@string/label</a>"&gt;<br/><br/>    &lt;AutoCompleteTextView<br/>        <em class="kd">android:id</em>="@+id/datesFilterSpinner"<br/>        <em class="kd">android:layout_width</em>="match_parent"<br/>        <em class="kd">android:layout_height</em>="match_parent"<br/>        <em class="kd">android:inputType</em>="none"<br/>        <em class="kd">tools:text</em>="All Time"" /&gt;<br/>&lt;/com.google.android.material.textfield.TextInputLayout&gt;</span></pre><p id="644f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">这里我们只是添加了一个包含一个<code class="fe mr ms mt mu b">AutoCompleteTextView</code>的<code class="fe mr ms mt mu b">TextInputLayout</code>，它将作为我们的下拉列表。注意<code class="fe mr ms mt mu b">inputType="none"</code>行，因为它告诉AutoCompleteTextView我们不打算手工输入任何文本细节。这与我们分配给TextInputLayout的自定义样式相结合，将允许AutoCompleteTextView在被单击时像一个微调器一样工作。</p><p id="7424" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">要了解更多关于各种可用风格和定制选项的信息，请看一下谷歌的<a class="ae la" href="https://material.io/components/menus/android#dropdown-menus" rel="noopener ugc nofollow" target="_blank">菜单——材料设计</a>文档。</p><h1 id="9c0e" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">给我们的下拉菜单一个更加定制的外观</h1><p id="c1b9" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">让我们从下拉菜单的背景颜色开始。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="e7ee" class="mz lp jb mu b gy na nb l nc nd">&lt;color <em class="kd">name</em>="pastel_orange_light"&gt;#FBE8DF&lt;/color&gt;</span></pre><p id="14a2" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来，我们将创建一个新的<code class="fe mr ms mt mu b">filter_spinner_dropdown_bg.xml</code> drawable，并使用下面的代码来塑造它:</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="8dff" class="mz lp jb mu b gy na nb l nc nd">&lt;?<em class="kd">xml version</em>="1.0" <em class="kd">encoding</em>="utf-8"?&gt;<br/>&lt;shape <em class="kd">xmlns:android</em>="http://schemas.android.com/apk/res/android"&gt;<br/>    &lt;solid <em class="kd">android:color</em>="@color/pastel_orange_light" /&gt;<br/>    &lt;corners <em class="kd">android:radius</em>="20dp" /&gt;<br/>&lt;/shape&gt;</span></pre><p id="4e31" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们需要的最后一件事是一个下拉图标，它将被放置在TextInputLayout的末尾。我使用了<a class="ae la" href="https://feathericons.com/" rel="noopener ugc nofollow" target="_blank">自由羽毛图标包</a>中的向下箭头。好了，现在我们有了所有的资源，让我们进一步设计下拉菜单的样式。</p><p id="0f67" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">首先，我们要将TextInputLayout的<code class="fe mr ms mt mu b">background</code>设置为我们之前创建的drawable。</p><p id="3399" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来，我们将通过改变各个角的<code class="fe mr ms mt mu b">radius</code>来圆化放置在TextInputLayout(由于我们选择的样式)周围的框的角，并且还将<code class="fe mr ms mt mu b">boxStrokeWidth</code>和<code class="fe mr ms mt mu b">boxStrokeWidthFocused</code>设置为<code class="fe mr ms mt mu b">0dp</code>，因为我们不希望我们的下拉菜单上有任何轮廓。</p><p id="8ac5" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">此外，让我们使用<code class="fe mr ms mt mu b">endIconDrawable</code>属性添加自定义下拉箭头图标，并使用<code class="fe mr ms mt mu b">endIconTint</code>将其着色以匹配我们的风格。</p><p id="8ca1" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们现在已经完成了对TextInputLayout的样式化，所以让我们转到AutoCompleteTextView。这里我们设置了<code class="fe mr ms mt mu b">background="@null"</code>,这样它就不会与TextInputLayout的背景重叠。</p><p id="3745" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来，我们指定一个<code class="fe mr ms mt mu b">dropDownSelector</code> drawable，在这种情况下，它将与我们之前创建的drawable相同。</p><blockquote class="jy jz ka"><p id="3c3c" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">dropDownSelector是一个drawable，当你点击它的时候用来高亮显示一个项目。</p></blockquote><p id="ee7f" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">对于我的应用程序，我不希望这样的东西是可见的，所以我只是把它设置成和我们的背景一样可绘制。</p><p id="b456" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">继续，添加下面几行将简单地将文本限制为一行，这样所有内容看起来都是一致的，当文本太长时，将在文本末尾添加省略号(<code class="fe mr ms mt mu b">...</code>)。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="ef21" class="mz lp jb mu b gy na nb l nc nd"><em class="kd">android:ellipsize</em>="end"<br/><em class="kd">android:maxLines</em>="1"<br/><em class="kd">android:singleLine</em>="true"</span></pre><p id="97ed" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我们还将在顶部和底部添加一些填充，因为出于某种原因，TextInputLayout中AutoCompleteTextView的嵌套会导致它在TextInputLayout的边界上裁剪一点。</p><p id="9344" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">最后，我们将我们的文本居中和样式一点，就这样。下面是最后的代码。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="3e82" class="mz lp jb mu b gy na nb l nc nd">&lt;com.google.android.material.textfield.TextInputLayout<br/>    <em class="kd">android:id</em>="@+id/typesFilterContainer" <em class="kd">style</em>="@style/Widget.MaterialComponents.TextInputLayout.FilledBox.ExposedDropdownMenu"<br/>    <em class="kd">android:layout_width</em>="wrap_content"<br/>    <em class="kd">android:layout_height</em>="40dp"<br/>    <em class="kd">android:background</em>="@drawable/filter_spinner_dropdown_bg"<br/>    <em class="kd">app:boxBackgroundColor</em>="@color/pastel_orange_light"<br/>    <em class="kd">app:boxCornerRadiusBottomEnd</em>="20dp"<br/>    <em class="kd">app:boxCornerRadiusBottomStart</em>="20dp"<br/>    <em class="kd">app:boxCornerRadiusTopEnd</em>="20dp"<br/>    <em class="kd">app:boxCornerRadiusTopStart</em>="20dp"<br/>    <em class="kd">app:boxStrokeWidth</em>="0dp"<br/>    <em class="kd">app:boxStrokeWidthFocused</em>="0dp"<br/>    <em class="kd">app:endIconDrawable</em>="@drawable/ic_arrow_down"<br/>    <em class="kd">app:endIconTint</em>="@color/pastel_orange_txt_highlight"&gt;<br/><br/>    &lt;AutoCompleteTextView<br/>        <em class="kd">android:id</em>="@+id/typesFilter"<br/>        <em class="kd">android:layout_width</em>="match_parent"<br/>        <em class="kd">android:layout_height</em>="match_parent"<br/>        <em class="kd">android:background</em>="@null"<br/>        <em class="kd">android:fontFamily</em>="@font/lato"       <em class="kd">android:dropDownSelector</em>="@drawable/filter_spinner_dropdown_bg"<br/>        <em class="kd">android:ellipsize</em>="end"<br/>        <em class="kd">android:inputType</em>="none"<br/>        <em class="kd">android:maxLines</em>="1"<br/>        <em class="kd">android:paddingTop</em>="10dp"<br/>        <em class="kd">android:paddingBottom</em>="10dp"<br/>        <em class="kd">android:singleLine</em>="true"<br/>        <em class="kd">android:text</em>="All Types"<br/>        <em class="kd">android:textAlignment</em>="center"<br/>        <em class="kd">android:textColor</em>="@color/pastel_orange_txt_highlight"<br/>        <em class="kd">tools:ignore</em>="LabelFor" /&gt;<br/>&lt;/com.google.android.material.textfield.TextInputLayout&gt;</span></pre><p id="6b18" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">您现在应该有了类似如下的东西:</p><figure class="lf lg lh li gt is gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/b07c734a7cfedc16f346c7f7c116c546.png" data-original-src="https://miro.medium.com/v2/resize:fit:376/format:webp/1*ue95GRlliROoJETKGG1Asw.jpeg"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">输出</figcaption></figure><p id="b16a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">接下来，让我们看看如何用项目填充下拉列表！</p><h1 id="c042" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">指定下拉项目</h1><p id="79fc" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">为了给我们的菜单设置下拉菜单，我们需要使用一个<code class="fe mr ms mt mu b">ArrayAdapter&lt;&gt;()</code>并传入上下文、项目布局和项目列表。在这种情况下，我们将使用预定义的<code class="fe mr ms mt mu b">android.R.layout.simple_spinner_dropdown_item</code>布局，因为它将满足我们现在的需求，但您也可以使用自定义布局，并在自定义ArrayAdapter子类中进一步自定义它。让我们看看目前为止的代码:</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="9634" class="mz lp jb mu b gy na nb l nc nd">val adapter = ArrayAdapter(<br/>    requireContext(), <!-- -->android.R.layout.simple_spinner_dropdown_item, <em class="kd">arraylistOf("All Types", "Assignments", "Exam", "Lab")</em><br/>)<br/>binding?.typesFilterSpinner?.setAdapter(adapter)<br/>binding?.typesFilterSpinner?.setText("<em class="kd">All Types"</em>)</span></pre><p id="c679" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">很好，现在我们的下拉菜单中已经填充了项目，我们需要定义一个自定义的drawable作为下拉背景，因为现在将使用默认的白色背景。</p><h1 id="5b2f" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">使用自定义下拉背景可绘制</h1><p id="8965" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">我们将再次使用我们的<code class="fe mr ms mt mu b">filter_spinner_dropdown_bg.xml</code> drawable。简单地调用AutoCompleteTextView上的<code class="fe mr ms mt mu b">setDropDownBackgroundDrawable()</code>,这将是它的背景。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="d4fd" class="mz lp jb mu b gy na nb l nc nd">binding?.typesFilterSpinner.setDropDownBackgroundDrawable(<br/>    ResourcesCompat.getDrawable(<br/>        <em class="kd">resources</em>,<br/>        R.drawable.<em class="kd">filter_spinner_dropdown_bg</em>,<br/>        <em class="kd">null<br/>    </em>)<br/>)</span></pre><p id="392c" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">好了，我们终于完成了下拉菜单的样式。它现在应该看起来像这样:</p><figure class="lf lg lh li gt is gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/8dc92b207a81cffa90f4a88d124a2755.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*dJNH4aP1CrbWZ0rYV_iG2Q.jpeg"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">决赛成绩</figcaption></figure><p id="b775" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在我们的最后一部分，我们将看到如何处理项目点击事件！</p><h1 id="70e5" class="lo lp jb bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">处理项目点击事件</h1><p id="b52a" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">为了在下拉项目被点击时得到通知，我们将简单地定义我们自己的<code class="fe mr ms mt mu b">AdapterView.OnItemClickListener</code>并在我们的AutoCompleteTextView中使用它。</p><pre class="lf lg lh li gt mv mu mw mx aw my bi"><span id="9b3b" class="mz lp jb mu b gy na nb l nc nd">binding?.typesFilterSpinner.<em class="kd">onItemClickListener </em>=<br/>    AdapterView.OnItemClickListener <strong class="mu jc">{ </strong>parent, view, position, id<strong class="mu jc">-&gt;<br/>        <em class="kd">// do something with the available information</em></strong><br/>    <strong class="mu jc">}</strong></span></pre><p id="52d9" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">本教程到此结束，你现在应该有一个功能齐全，外观漂亮的下拉菜单/微调。如果您有任何建议、改进或评论，请在评论中告诉我，我会尽最大努力采纳它们。编码快乐！</p><figure class="lf lg lh li gt is gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/af1e3539590375eb8695423c9dafc910.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*m1yw28jUw8pBu0BV3dGbNA.gif"/></div></figure></div></div>    
</body>
</html>