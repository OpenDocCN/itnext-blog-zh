<html>
<head>
<title>Building a space shooter game with HTML5 canvas &amp; Typescript — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HTML5 canvas &amp; Typescript构建一个太空射击游戏—第2部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-space-shooter-game-with-html5-canvas-typescript-part-2-bf39f584c4be?source=collection_archive---------4-----------------------#2020-12-14">https://itnext.io/building-a-space-shooter-game-with-html5-canvas-typescript-part-2-bf39f584c4be?source=collection_archive---------4-----------------------#2020-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="50cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文是由以下作者撰写的系列文章的第二部分:</p><p id="4b54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://andreteixeira.medium.com/building-a-space-shooter-game-with-html5-canvas-typescript-part-1-20663025c7f5" rel="noopener">第一部分——画星星</a>⭐<br/>T3】第二部分——画一艘宇宙飞船并让它旋转🚀<br/> <a class="ae kl" href="https://andreteixeira.medium.com/building-a-space-shooter-game-with-html5-canvas-typescript-part-3-f1b2808e85bd" rel="noopener">第3部分——让飞船移动并拍摄</a>💨<br/>第4部分—为移动🕹️制作操纵杆📱<br/>第5部分——敌舰和碰撞💥</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><h1 id="b716" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi">🚀🚀🚀🚀</h1><p id="61af" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我们需要一个功能游戏的下一件东西是一艘宇宙飞船。在本系列的第1部分中，我们讨论了游戏循环需要注意的3个基本操作:</p><ol class=""><li id="d497" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk mb mc md me bi translated"><strong class="jp ir">读取用户输入</strong></li><li id="720a" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">更新游戏状态</strong></li><li id="055a" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk mb mc md me bi translated"><strong class="jp ir">重新绘制画布</strong></li></ol><p id="da37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文将通过步骤，不一定按照上述顺序。</p><h1 id="cb78" class="kt ku iq bd kv kw mk ky kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq bi translated">在画布上画画</h1><p id="5d46" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">让我们从第三步开始。我们现在需要的是一个飞船类，用一个draw方法来定义它在屏幕上的样子。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/5ac158563cd4650f7a978e27d0dc1953.png" data-original-src="https://miro.medium.com/v2/resize:fit:478/format:webp/1*zEc1UV66ijKLS8KDTwJabw.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">宇宙飞船插图</figcaption></figure><p id="0150" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在左边，你可以看到我想在飞船绘制方法上实现的东西。我已经在一个基本的绘图工具上绘制了插图，以了解在画布上绘制时的比例。</p><p id="754f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它的身体有10个正方形的高度，最宽的宽度大约是3.5个正方形。当使用宽度和高度变量以及画布线条绘制方法时，这个比例将非常有用。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/070423bc4570a135204970b952e72f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*cBX8iYKzM752YEFJi0A31Q.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">宇宙飞船中心</figcaption></figure><p id="def0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，以后当我们开始实现这个宇宙飞船的行为时，我们会希望它绕着自己的中心旋转。</p><p id="a031" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在下一步中让我们的生活更容易，我们已经可以画出围绕中心的形状。在这个例子中，我把它移到了船的后部，靠近引擎。</p><h2 id="aa92" class="nc ku iq bd kv nd ne dn kz nf ng dp ld jy nh ni lh kc nj nk ll kg nl nm lp nn bi translated">宇宙飞船班</h2><p id="ae72" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">这是飞船类最初的样子，cx和cy是飞船中心的坐标:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="6b77" class="nc ku iq bd kv nd ne dn kz nf ng dp ld jy nh ni lh kc nj nk ll kg nl nm lp nn bi translated">绘制零件</h2><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2f99cce3920783e775427a9d798201ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*fUtBHmVp4qnM1WIxwW6D8Q.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">宇宙飞船插图2</figcaption></figure><p id="6828" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过分解插图，我们注意到它由13段组成。我会试着按照显示的顺序画出来。</p><p id="eb5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的要点中，你可以看到表示为<strong class="jp ir"> 1 </strong>的步骤已经包含在绘制方法中了(现在我对飞船的平底很满意)。</p><p id="6d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还要注意，在第一幅太空船插图中，分段1有1平方的宽度，相当于总宽度的30%。因此，我们可以移动到提供的船将被放置的X，Y坐标，并画一条线到<strong class="jp ir"> X + 0.3 *宽</strong>。</p><pre class="mq mr ms mt gt nr ns nt nu aw nv bi"><span id="b6dd" class="nc ku iq ns b gy nw nx l ny nz">ctx.moveTo(bottomCenter.x, bottomCenter.y);</span><span id="19b0" class="nc ku iq ns b gy oa nx l ny nz"><em class="ob">// Half bottom line<br/></em>ctx.lineTo(bottomCenter.x + width * 0.3, bottomCenter.y);</span></pre><p id="20a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二部分没有那么简单。这个<strong class="jp ir">贝齐尔库托</strong>方法<strong class="jp ir"> </strong>应该能帮上忙。它接受2个控制点坐标<strong class="jp ir"> (x，y) </strong>和曲线的最终点坐标。为了以更直观的方式快速找到控制点坐标，我的技巧是观察绘图工具的比例。</p><p id="ba54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是当我选择曲线线段时，曲线在我的绘图工具上的样子:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/24ae712f943d24f598bfd600d7f6f69a.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*WYvvVpwD0ILONnAHQZOpIw.png"/></div></figure><p id="b3d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑到起点是当前路径的第一个点(或前一段的最后一个点)，我们看到第一个控制点靠近<strong class="jp ir"> x = 1.75和y = 2 </strong>，第二个控制点靠近<strong class="jp ir"> x = 1.7 </strong>和<strong class="jp ir"> y = 8 </strong>而终点在x = 0和y = 10。所以飞船绘图的第二步可以是这样的:</p><pre class="mq mr ms mt gt nr ns nt nu aw nv bi"><span id="b918" class="nc ku iq ns b gy nw nx l ny nz">ctx.bezierCurveTo(<br/>  cx + width,<br/>  cy - height * 0.2,<br/>  cx + width,<br/>  cy - height * 0.8,<br/>  cx,<br/>  cy - height<br/>);</span></pre><p id="19b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">曲线贝塞尔</strong>方法<strong class="jp ir"> </strong>在这里很有用，因为这条曲线需要2个控制点，而<strong class="jp ir">四次曲线贝塞尔</strong>方法可用于具有单个控制点的简单曲线，着陆平台<strong class="jp ir">就是这种情况。</strong></p><h2 id="6fa0" class="nc ku iq bd kv nd ne dn kz nf ng dp ld jy nh ni lh kc nj nk ll kg nl nm lp nn bi translated">最终绘制方法</h2><p id="9592" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我重复了这些步骤来构建所有组成飞船的形状。绘制它的最终代码如下:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="5ad6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是目前的情况，我很乐意继续下一步。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi od"><img src="../Images/746bbbda3815b6e6599248273da33dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*p0jGBQB-39v_UWATs5wGpw.png"/></div></figure><h1 id="c2c7" class="kt ku iq bd kv kw mk ky kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq bi translated">更新游戏状态</h1><p id="f8e6" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">为了产生预期的行为，需要进行一些状态改变，例如:</p><ul class=""><li id="946a" class="lw lx iq jp b jq jr ju jv jy ly kc lz kg ma kk oe mc md me bi translated">画宇宙飞船；</li><li id="c073" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk oe mc md me bi translated">旋转飞船；</li><li id="477d" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk oe mc md me bi translated">向前和向后移动它；</li><li id="c2ab" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk oe mc md me bi translated">开枪射击；</li><li id="8c02" class="lw lx iq jp b jq mf ju mg jy mh kc mi kg mj kk oe mc md me bi translated">渲染敌人；</li></ul><p id="58f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">画宇宙飞船</strong></p><p id="3f5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了渲染飞船，我们可以使用我们刚刚创建的draw方法。我们只需要在SpaceshipGame的draw方法中调用它。我是这样称呼它的:</p><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="fc41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">旋转飞船</strong></p><p id="6b3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个预期行为是当用户选择方向控制(左和右)时，让飞船旋转。你可以在spaceship draw方法中看到一个旋转参数。它将绘制旋转到我们在调用时提供的角度的宇宙飞船。</p><p id="4578" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果游戏循环不间断地调用spaceship draw方法并传递一个旋转值，我们所需要的就是读取用户输入并相应地更新游戏状态以进行旋转。</p><p id="3951" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下几行代码让这一切成为现实:</p><pre class="mq mr ms mt gt nr ns nt nu aw nv bi"><span id="c293" class="nc ku iq ns b gy nw nx l ny nz">ctx.translate(cx, cy);<br/>ctx.rotate(this.rotationRadians);<br/>ctx.translate(-cx, -cy);</span></pre><p id="08cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以注意到旋转前后的<code class="fe of og oh ns b">translation</code>，这是因为我们想在飞船的中心旋转。否则，结果将是这样的:</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/ff6605ff861eba248ead0005ec0e897b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/1*P2CbSBe2cOZgquLmggmi6w.gif"/></div></figure><h1 id="68b8" class="kt ku iq bd kv kw mk ky kz la ml lc ld le mm lg lh li mn lk ll lm mo lo lp lq bi translated">读取用户输入</h1><p id="1d03" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">对于这个游戏的实际状态，我们(目前)对箭头键(以及WASD键)的键盘事件感兴趣。因此，让我们向构造函数添加一个eventListener:</p><pre class="mq mr ms mt gt nr ns nt nu aw nv bi"><span id="f77a" class="nc ku iq ns b gy nw nx l ny nz">window.addEventListener("keydown",this.keyboardListener.bind(this));window.addEventListener("keyup", this.keyboardListener.bind(this));</span></pre><figure class="mq mr ms mt gt mu"><div class="bz fp l di"><div class="no np l"/></div></figure><h2 id="85cc" class="nc ku iq bd kv nd ne dn kz nf ng dp ld jy nh ni lh kc nj nk ll kg nl nm lp nn bi translated">此阶段之前的代码标记在:</h2><p id="3f0f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/ateixeira/spaceship-game/releases/tag/part1_final" rel="noopener ugc nofollow" target="_blank">https://github . com/ateixeira/space ship-game/releases/tag/part 2 _ final</a></p><h2 id="e253" class="nc ku iq bd kv nd ne dn kz nf ng dp ld jy nh ni lh kc nj nk ll kg nl nm lp nn bi translated">第2部分最终代码的演示:</h2><p id="b2a2" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="http://spaceship-part2-final.s3-website.eu-central-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://space ship-part 2-final . S3-website . eu-central-1 . Amazon AWS . com</a></p></div></div>    
</body>
</html>