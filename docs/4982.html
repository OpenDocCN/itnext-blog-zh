<html>
<head>
<title>Golang Image Generator in runtime (favicon, watermark, resizing images).</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golang图像生成器在运行时(图标，水印，调整图像大小)。</h1>
<blockquote>原文：<a href="https://itnext.io/golang-image-generator-in-runtime-favicon-watermark-resizing-images-3a298b7b17af?source=collection_archive---------2-----------------------#2020-11-08">https://itnext.io/golang-image-generator-in-runtime-favicon-watermark-resizing-images-3a298b7b17af?source=collection_archive---------2-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7509" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Go，您可以在运行时创建图像文件。找到下面的小列表，观察它可能有用的情况。</p><ol class=""><li id="9e3e" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">Favicon</li><li id="2b9b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">像素跟踪器</li><li id="26aa" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">占位符</li><li id="812a" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">水印</li><li id="aa90" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">图像大小调整</li></ol><h1 id="917c" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak"> 1。图标</strong></h1><p id="5111" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">Go应用程序通常被认为是为内部和/或外部服务提供内容的服务器部分。让一个外部程序(包装器)返回响应是一种很好的做法——一种只给出所需有效负载的逃避，特别是没有特定于web的请求。在从客户端到服务器端的特定于web的请求中，我指的是favicon请求和各种清单，它们通常被认为是“前端”类型的资源。也就是说，在大多数情况下，同样的专家做项目的“前端部分”并对他们的工作负责。</p><p id="819e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，如果你的Go应用程序也能够自己给出图标和清单，那会怎么样呢？不仅仅是静态的favicon和manifest文件，而是在运行时生成/创建这些字节数组。这将允许我们的应用程序不依赖于这些静态文件。</p><p id="d553" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，您可以发送一个静态文件作为响应:</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0258" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是我们想动态地创建一个favicon。至少有两种类似的方法可以动态创建一个favicon:</p><ul class=""><li id="eb87" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">第一种方法</li></ul><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><ul class=""><li id="25b3" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">第二种方法</li></ul><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><h1 id="5496" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak"> 2。像素跟踪器</strong></h1><p id="b8b6" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">像素跟踪器广泛用于交通仲裁。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><h1 id="3175" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak"> 3。占位符</strong></h1><p id="02d7" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">使用占位符的示例</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/adcd9cd82ff54421582750f7d36e01af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*9jnhZDM1amo0brif"/></div></figure><p id="e31f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了生成占位符，我们将使用与固定大小图像相同的方法，但是能够添加文本和改变图像和字体的大小。</p><p id="ff05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们定义需求:</p><ul class=""><li id="d4ee" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">我们收到以下形式的输入请求:</li></ul><pre class="mc md me mf gt mn mo mp mq aw mr bi"><span id="2d9e" class="ms la iq mo b gy mt mu l mv mw">/WIDTH/HEIGHT/COLOR/TEXT/TEXT_COLOR/FONT_SIZE</span><span id="af63" class="ms la iq mo b gy mx mu l mv mw">For example: <br/>/600/200/622E68/Placeholder (stub)/FFFFFF/60</span></pre><ul class=""><li id="acb8" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">文字应该放在图片的中间。</li><li id="de7a" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">文本来自客户端的请求，或者格式为:“宽度x高度”。</li><li id="0e1c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">文本必须是拉丁文和西里尔文字</li><li id="ddf5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">我们提供默认参数</li><li id="6fa7" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">我们输出图片的字节</li></ul><p id="12e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先让我们制作一个颜色解析包。在传入的请求中，color是一个十六进制表示的字符串。其他“颜色格式”是不期望的。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9a08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的图像包:</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="2f5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">地址请求的结果(url)</p><pre class="mc md me mf gt mn mo mp mq aw mr bi"><span id="51cd" class="ms la iq mo b gy mt mu l mv mw"><a class="ae my" href="http://localhost:8080/600/200/622E68/Placeholder%20(%D0%B7%D0%B0%D0%B3%D0%BB%D1%83%D1%88%D0%BA%D0%B0)/FFFFFF" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/600/200/622E68/Placeholder (заглушка)/FFFFFF</a></span></pre><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/a3a0ed77ce52fb18b4fb6af82fe6fc9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*mJDUa-W0uIIOCFGs"/></div></figure><p id="e6b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这种请求:</p><pre class="mc md me mf gt mn mo mp mq aw mr bi"><span id="2e1e" class="ms la iq mo b gy mt mu l mv mw">http://localhost:8080/480/200</span></pre><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/54f4f76b9649f450a99588c4c142f2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*ML_Xz-1zDp1_eRRW"/></div></figure><h1 id="04c6" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak"> 4。水印</strong></h1><p id="0b90" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">水印可能对以下情况有用:</p><ul class=""><li id="9f05" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">在发布的图像上注明版权所有者</li><li id="34e9" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">您可以在图像中添加广告文本</li><li id="2247" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">图像的用途及其使用限制</li></ul><p id="fc79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，指定该图像或照片只能用于特定目的和/或在有限的时间内使用。</p><h1 id="9eb6" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak"> 5。调整图像大小</strong></h1><p id="0a85" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">特别是，该平台需要存储一组不同大小和格式的图像。</p><p id="194c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有时你需要改变尺寸的设置。在这种情况下，您需要调整新尺寸的大小，并可能删除其他尺寸。</p><p id="842e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实现调整大小有两种可能的情况:</p><ul class=""><li id="edb4" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mj kr ks kt bi translated">一次性(按需调整整个集合的大小)</li><li id="3e55" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mj kr ks kt bi translated">动态(运行时调整大小)</li></ul><p id="48db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一次性调整大小有一个难以忍受的优势——我们一次调整所有或部分图像的大小(例如，一天一次)。在这种情况下，我们需要磁盘空间。快速磁盘离客户端和热数据(映像)更近。</p><p id="1336" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">动态图像尺寸调整允许你为所有的“尺寸调整”释放空间，而不用担心它们的相关性。但是在这种情况下，我们需要计算资源，调整“缓存”层的大小可以“转移”到更靠近客户端的位置，并且大小集可以随时更新。</p><p id="f712" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">换句话说，理想的选择(对于资源)是混合调整大小:我们选择需要动态或一次性调整大小的数据。还有，如果你经常改变图片的大小和格式，动态调整大小更适合你(如果你有计算资源的话)。我建议对您计划的需求和容量进行计算。</p><p id="a3c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注</strong></p><p id="c58f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">所有代码示例仅供参考。因此，您需要测试并调整这种方法以适应您的需求和目标。</strong></p></div></div>    
</body>
</html>