<html>
<head>
<title>Two-Phased Canary Rollout with Gloo, Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gloo的两阶段金丝雀展示，第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/two-phased-canary-rollout-with-gloo-part-1-ec5b267cdc9e?source=collection_archive---------5-----------------------#2020-04-21">https://itnext.io/two-phased-canary-rollout-with-gloo-part-1-ec5b267cdc9e?source=collection_archive---------5-----------------------#2020-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b3d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://www.solo.io/" rel="noopener ugc nofollow" target="_blank"> Solo </a>的每一天，我们都在与平台所有者、架构师和工程师交谈，他们使用<a class="ae kl" href="https://www.solo.io/products/gloo/" rel="noopener ugc nofollow" target="_blank"> Gloo </a>作为API网关，向最终用户展示他们的应用。这些应用可能跨越传统的monoliths、微服务、托管云服务和Kubernetes集群。幸运的是，<strong class="jp ir"> Gloo可以轻松设置路由来管理、保护和观察应用流量，同时支持灵活的部署架构，以满足客户不断变化的生产需求</strong>。</p><p id="1bda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了初始设置之外，平台所有者经常要求我们帮助设计他们组织内的运营工作流:我们如何将新的应用程序上线？我们如何升级应用程序？我们如何在平台、运营和开发团队之间划分职责？</p><p id="a8f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，<strong class="jp ir">我们将使用Gloo为应用升级设计一个两阶段canary部署工作流</strong>:</p><ul class=""><li id="26e1" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">在第一阶段，我们将通过将一小部分流量转移到新版本来进行金丝雀测试。这允许您安全地执行冒烟和正确性测试。</li><li id="e0ab" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">在第二阶段，我们将逐步将流量转移到新版本，允许我们在负载下监控新版本，并最终淘汰旧版本。</li></ul><p id="e919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简单起见，我们将专注于使用<a class="ae kl" href="https://github.com/solo-io/gloo" rel="noopener ugc nofollow" target="_blank"> Gloo </a>设计工作流，并将网关和应用程序部署到Kubernetes。最后，我们将讨论一些扩展和高级主题，这些主题在后续的讨论中可能会很有意思。</p><h1 id="84dd" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">初始设置</h1><p id="92aa" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">首先，我们需要一个Kubernetes集群。这个例子没有利用任何特定于云的特性，可以在本地测试集群上运行，比如<a class="ae kl" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank"> minikube </a>。这篇文章假设读者对Kubernetes以及如何使用<code class="fe md me mf mg b">kubectl</code>与它交互有一个基本的了解。</p><p id="4fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将最新的<a class="ae kl" href="https://github.com/solo-io/gloo" rel="noopener ugc nofollow" target="_blank"> Gloo Enterprise </a>安装到<code class="fe md me mf mg b">gloo-system</code>名称空间，并将示例应用程序的版本<code class="fe md me mf mg b">v1</code>部署到<code class="fe md me mf mg b">echo</code>名称空间。我们将通过在Gloo中创建一条路线，在集群外部公开该应用程序，最终得到如下图片:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mh"><img src="../Images/5f1d36173f0fc6803056b48379ae85be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7WXR6eCJ5ZMqDFYa.png"/></div></div></figure><h1 id="acfb" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">部署Gloo</h1><p id="8aea" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们将使用<code class="fe md me mf mg b">glooctl</code>命令行工具安装gloo，我们可以下载该工具，并使用以下命令将其添加到<code class="fe md me mf mg b">PATH</code>:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="1d1e" class="mx lb iq mg b gy my mz l na nb">curl -sL <a class="ae kl" href="https://run.solo.io/gloo/install" rel="noopener ugc nofollow" target="_blank">https://run.solo.io/gloo/install</a> | sh<br/>export PATH=$HOME/.gloo/bin:$PATH</span></pre><p id="a2a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您应该能够运行<code class="fe md me mf mg b">glooctl version</code>来查看它是否被正确安装:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="0c18" class="mx lb iq mg b gy my mz l na nb">➜ glooctl version<br/>Client: {"version":"1.3.17"}<br/>Server: version undefined, could not find any version of gloo running</span></pre><p id="d2b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以用一个简单的命令将网关安装到集群中:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="a5ff" class="mx lb iq mg b gy my mz l na nb">glooctl install gateway enterprise --license-key=$LICENSE_KEY</span></pre><p id="8ee8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">控制台应指示安装成功完成:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="7df5" class="mx lb iq mg b gy my mz l na nb">Creating namespace gloo-system... Done.<br/>Starting Gloo installation...</span><span id="4206" class="mx lb iq mg b gy nc mz l na nb">Gloo was successfully installed!</span></pre><p id="b6a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不久，我们可以看到所有Gloo pods在<code class="fe md me mf mg b">gloo-system</code>名称空间中运行:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="1fa6" class="mx lb iq mg b gy my mz l na nb">➜ kubectl get pod -n gloo-system<br/>NAME                             READY   STATUS    RESTARTS   AGE<br/>discovery-58f8856bd7-4fftg       1/1     Running   0          13s<br/>gateway-66f86bc8b4-n5crc         1/1     Running   0          13s<br/>gateway-proxy-5ff99b8679-tbp65   1/1     Running   0          13s<br/>gloo-66b8dc8868-z5c6r            1/1     Running   0          13s</span></pre><h1 id="1f6f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">部署应用程序</h1><p id="ec33" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们的<code class="fe md me mf mg b">echo</code>应用程序是一个简单的容器(感谢我们在HashiCorp的朋友),它将响应应用程序版本，在我们开始测试并将流量转移到应用程序的<code class="fe md me mf mg b">v2</code>版本时，帮助演示我们的canary工作流。</p><p id="ce69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes在这个应用程序的建模方面给了我们很大的灵活性。我们将采用以下惯例:</p><ul class=""><li id="0278" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">我们将在部署名称中包含版本，这样我们可以并行运行应用程序的两个版本，并以不同的方式管理它们的生命周期。</li><li id="60ff" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">我们将用一个应用标签(<code class="fe md me mf mg b">app: echo</code>)和一个版本标签(<code class="fe md me mf mg b">version: v1</code>)来标记pod，以帮助我们的金丝雀展示。</li><li id="7586" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">我们将为应用程序部署一个Kubernetes <code class="fe md me mf mg b">Service</code>来建立网络。我们将使用Gloo配置来管理首次展示，而不是更新它或使用多个服务来管理到不同版本的路由。</li></ul><p id="be67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们的<code class="fe md me mf mg b">v1</code> echo应用程序，包括名称空间、服务和v1部署定义:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="368b" class="mx lb iq mg b gy my mz l na nb">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: echo<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: echo-v1<br/>  namespace: echo<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: echo<br/>      version: v1<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: echo<br/>        version: v1<br/>    spec:<br/>      containers:<br/>        - image: hashicorp/http-echo<br/>          args:<br/>            - "-text=version:v1"<br/>            - -listen=:8080<br/>          imagePullPolicy: Always<br/>          name: echo-v1<br/>          ports:<br/>            - containerPort: 8080<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: echo<br/>  namespace: echo<br/>spec:<br/>  ports:<br/>    - port: 80<br/>      targetPort: 8080<br/>      protocol: TCP<br/>  selector:<br/>    app: echo</span></pre><p id="8195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将该应用程序部署到您的集群中:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="ed71" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/echo.yaml <!-- --> </span></pre><p id="ae87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待命名空间“echo”中的窗格准备就绪。使用<code class="fe md me mf mg b">kubectl get pods -n echo</code>检查状态。</p><h1 id="887f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用Gloo在群集外部公开</h1><p id="ef12" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们现在可以用Gloo在集群外部公开这个服务。首先，我们将应用程序建模为Gloo <a class="ae kl" href="https://docs.solo.io/gloo/latest/introduction/architecture/concepts/#upstreams" rel="noopener ugc nofollow" target="_blank">上游</a>，这是Gloo对流量目的地的抽象:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="0410" class="mx lb iq mg b gy my mz l na nb">apiVersion: gloo.solo.io/v1<br/>kind: Upstream<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  kube:<br/>    selector:<br/>      app: echo<br/>    serviceName: echo<br/>    serviceNamespace: echo<br/>    servicePort: 8080<br/>    subsetSpec:<br/>      selectors:<br/>        - keys:<br/>            - version</span></pre><p id="d21c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="9b29" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->upstream.yaml</span></pre><p id="8cac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们基于<code class="fe md me mf mg b">version</code>标签设置子集。我们不必在我们的路线中使用它，但是稍后我们将开始使用它来支持我们的canary工作流。</p><p id="6418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在可以通过定义一个<a class="ae kl" href="https://docs.solo.io/gloo/latest/introduction/architecture/concepts/#virtual-services" rel="noopener ugc nofollow" target="_blank">虚拟服务</a>在Gloo中创建一个到这个上游的路由:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="61a9" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      # We'll allow any domain to avoid needing to set up DNS or provide a host header<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system</span></pre><p id="e2e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="40a3" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-1.yaml</span></pre><p id="9cc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们应用了这两个资源，我们就可以开始通过Gloo:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="f343" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><p id="2117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的设置已经完成，我们的集群现在如下所示:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mh"><img src="../Images/ca001036008ff8f87db5075f49f3ac64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4OQzn1b2cPbE_qor.png"/></div></div></figure><h1 id="040b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">两阶段推广战略</h1><p id="d347" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">现在我们有了一个新版本的echo应用程序<code class="fe md me mf mg b">v2</code>,我们希望推出它。我们知道，当<br/>展示完成时，我们会以这张图片结束:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nd"><img src="../Images/354bb3f165ceb6dfb73d0458f490f46a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bz1u1sxHLeA8uuWi.png"/></div></div></figure><p id="41d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，为了达到这个目标，我们可能需要执行几轮测试，以确保新版本的应用程序满足某些正确性和/或性能验收标准。在这篇文章中，我们将介绍一个两阶段的方法来使用Gloo进行金丝雀展示，这可以用来满足绝大多数验收测试。</p><p id="ffb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第一阶段，我们将通过将一小部分流量路由到新版本的应用程序来执行冒烟和正确性测试。在这个演示中，我们将使用一个header <code class="fe md me mf mg b">stage: canary</code>来触发到新服务的路由，尽管实际上可能希望根据请求的另一部分来做出这个决定，比如一个经过验证的JWT中的声明。</p><p id="eeb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第二阶段，我们已经建立了正确性，所以我们准备将所有的流量转移到应用程序的新版本。我们将配置加权目的地，并在监控某些业务指标的同时转移流量，以确保服务质量保持在可接受的水平。一旦100%的流量转移到新版本，旧版本就可以退役。</p><p id="596a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实际上，可能希望只使用其中一个阶段进行测试，在这种情况下，可以跳过另一个阶段。</p><h1 id="8ebf" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">阶段1:v2的初始canary部署</h1><p id="54cf" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">在这个阶段，我们将部署<code class="fe md me mf mg b">v2</code>，然后使用报头<code class="fe md me mf mg b">stage: canary</code>开始将少量特定流量路由到新版本。我们将使用这个标题来执行一些基本的冒烟测试，并确保<code class="fe md me mf mg b">v2</code>按照我们预期的方式工作:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ne"><img src="../Images/6819798f206ca86dd580fcd26fd6d80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dxfmtQOxyAcJwZsX.png"/></div></div></figure><h1 id="ce5e" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">设置子集路由</h1><p id="f87c" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">在部署我们的<code class="fe md me mf mg b">v2</code>服务之前，我们将使用一个名为<a class="ae kl" href="https://docs.solo.io/gloo/latest/guides/traffic_management/destination_types/subsets/" rel="noopener ugc nofollow" target="_blank">子集路由</a>的Gloo特性，更新我们的虚拟服务，以便只路由到具有子集标签<code class="fe md me mf mg b">version: v1</code>的pod。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="dae3" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v1</span></pre><p id="d557" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="26da" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-2.yaml</span></pre><p id="051c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序应该像以前一样继续运行:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="6ec4" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><h1 id="5172" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">部署echo v2</h1><p id="49cb" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">现在我们可以安全地部署echo应用程序的<code class="fe md me mf mg b">v2</code>:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="1e11" class="mx lb iq mg b gy my mz l na nb">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: echo-v2<br/>  namespace: echo<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: echo<br/>      version: v2<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: echo<br/>        version: v2<br/>    spec:<br/>      containers:<br/>        - image: hashicorp/http-echo<br/>          args:<br/>            - "-text=version:v2"<br/>            - -listen=:8080<br/>          imagePullPolicy: Always<br/>          name: echo-v2<br/>          ports:<br/>            - containerPort: 8080</span></pre><p id="0337" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="0460" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->echo-v2.yaml</span></pre><p id="3c91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们的网关被配置为专门路由到<code class="fe md me mf mg b">v1</code>子集，这应该没有影响。然而，如果为路由配置了<code class="fe md me mf mg b">v2</code>子集，它确实使<code class="fe md me mf mg b">v2</code>能够从网关路由。</p><p id="7696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">继续前进之前，确保<code class="fe md me mf mg b">v2</code>正在运行:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="1c1c" class="mx lb iq mg b gy my mz l na nb">➜ kubectl get pod -n echo<br/>NAME                       READY   STATUS    RESTARTS   AGE<br/>echo-v1-66dbfffb79-2qw86   1/1     Running   0          5m25s<br/>echo-v2-86584fbbdb-slp44   1/1     Running   0          93s</span></pre><p id="8244" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序应该像以前一样继续运行:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="f7c5" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><h1 id="8d76" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为canary测试添加到v2的路由</h1><p id="47a2" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">当请求中提供了<code class="fe md me mf mg b">stage: canary</code>头时，我们将路由到<code class="fe md me mf mg b">v2</code>子集。如果没有提供头，我们将像以前一样继续路由到<code class="fe md me mf mg b">v1</code>子集。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="9461" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - headers:<br/>              - name: stage<br/>                value: canary<br/>            prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v2<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v1</span></pre><p id="782e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="0df1" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-3.yaml</span></pre><h1 id="35f0" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">金丝雀测试</h1><p id="0c34" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">现在我们有了这条路线，我们可以做一些测试。首先，让我们确保现有路由按预期工作:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="a5c8" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><p id="5496" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以开始金丝雀测试我们的新应用程序版本:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="382c" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/ -H "stage: canary"<br/>version:v2</span></pre><h1 id="aefb" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">子集路由的高级用例</h1><p id="c7fd" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们可能会认为这种使用用户提供的请求头的方法过于开放。相反，我们可能希望将金丝雀测试限制在已知的授权用户范围内。</p><p id="5ed4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到的一个常见实现是，金丝雀路线需要一个有效的JWT，其中包含一个特定的声明，以表明受试者已被授权进行金丝雀测试。Enterprise Gloo为验证JWT、基于JWT声明更新请求头以及基于更新的头重新计算路由目的地提供了现成的支持。我们将在以后的文章中讨论金丝雀测试中更高级的用例。</p><h1 id="cf83" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">第2阶段:将所有流量转移到v2并停用v1</h1><p id="9770" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">此时，我们已经部署了<code class="fe md me mf mg b">v2</code>，并为金丝雀测试创建了一条路线。如果我们对测试结果满意，我们可以进入阶段2，开始将负载从<code class="fe md me mf mg b">v1</code>转移到<code class="fe md me mf mg b">v2</code>。我们将使用Gloo中的<a class="ae kl" href="https://docs.solo.io/gloo/latest/guides/traffic_management/destination_types/multi_destination/" rel="noopener ugc nofollow" target="_blank">加权目的地</a>来管理迁移期间的负载。</p><h1 id="1e59" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">设置加权目的地</h1><p id="f100" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们可以将Gloo路由更改为通往这两个目的地的路由，并使用权重来决定有多少流量应该流向<code class="fe md me mf mg b">v1</code>和<code class="fe md me mf mg b">v2</code>子集。首先，我们将对其进行设置，以便100%的流量继续被路由到<code class="fe md me mf mg b">v1</code>子集，除非像以前一样提供了<code class="fe md me mf mg b">stage: canary</code>报头。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="48bd" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - headers:<br/>              - name: stage<br/>                value: canary<br/>            prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v2<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          multi:<br/>            destinations:<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v1<br/>                weight: 100<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v2<br/>                weight: 0</span></pre><p id="1b10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="4970" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-4.yaml</span></pre><p id="9f34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，对于任何没有<code class="fe md me mf mg b">stage: canary</code>头的请求，集群看起来像这样:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nf"><img src="../Images/41ae9fb7400bc855bf8a014498199b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4JnHowspYwbYv6jZ.png"/></div></div></figure><p id="f03b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用初始权重，我们应该看到网关继续为所有流量提供<code class="fe md me mf mg b">v1</code>服务。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="e07b" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><h1 id="bc4b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">开始展示</h1><p id="7a54" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">为了模拟负载测试，让我们将一半的流量转移到<code class="fe md me mf mg b">v2</code>:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ng"><img src="../Images/d8e685d632d14d9097ef934bf2abcddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a6GEDP6x0V96a9fr.png"/></div></div></figure><p id="9a03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这可以通过调整权重在我们的虚拟服务中体现出来:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="ef4b" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - headers:<br/>              - name: stage<br/>                value: canary<br/>            prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v2<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          multi:<br/>            destinations:<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v1<br/>                weight: 50<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v2<br/>                weight: 50</span></pre><p id="c8b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="2201" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-5.yaml</span></pre><p id="a9f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们向网关发送流量时，我们应该看到一半的请求返回<code class="fe md me mf mg b">version:v1</code>，另一半返回<code class="fe md me mf mg b">version:v2</code>。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="0621" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v1<br/>➜ curl $(glooctl proxy url)/<br/>version:v2<br/>➜ curl $(glooctl proxy url)/<br/>version:v1</span></pre><p id="8d43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">实际上，在此过程中，您可能会监控一些性能和业务指标，以确保流量转移不会导致整体服务质量下降。我们甚至可以利用像<a class="ae kl" href="https://github.com/weaveworks/flagger" rel="noopener ugc nofollow" target="_blank"> Flagger </a>这样的操作符来帮助自动化这个Gloo工作流。Gloo Enterprise与您的metrics后端集成，并提供现成的、动态的、基于上游的仪表板，可用于监控部署的健康状况。我们将把这些话题留到以后关于Gloo的高级金丝雀测试用例的文章中。</p><h1 id="d61f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">完成展示</h1><p id="0c01" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们将继续调整权重，直到最终所有的流量都被路由到<code class="fe md me mf mg b">v2</code>:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nh"><img src="../Images/a80248f4c6836bebacea5094b8c164c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y0Ejyftl85-xkHM9.png"/></div></div></figure><p id="7f76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的虚拟服务将如下所示:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="071e" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - headers:<br/>              - name: stage<br/>                value: canary<br/>            prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v2<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          multi:<br/>            destinations:<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v1<br/>                weight: 0<br/>              - destination:<br/>                  upstream:<br/>                    name: echo<br/>                    namespace: gloo-system<br/>                  subset:<br/>                    values:<br/>                      version: v2<br/>                weight: 100</span></pre><p id="60e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="c6d8" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-6.yaml</span></pre><p id="ca2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，当我们向网关发送流量时，我们应该看到所有的请求都返回<code class="fe md me mf mg b">version:v2</code>。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="7de6" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v2<br/>➜ curl $(glooctl proxy url)/<br/>version:v2<br/>➜ curl $(glooctl proxy url)/<br/>version:v2</span></pre><h1 id="e903" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">退役v1</h1><p id="08f6" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">此时，我们已经部署了新版本的应用程序，使用子集路由进行了正确性测试，通过逐步将流量转移到新版本进行了负载和性能测试，并完成了部署。唯一剩下的任务是清理我们的<code class="fe md me mf mg b">v1</code>资源。</p><p id="0c31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将清理我们的路线。我们将保留路线上指定的子集，以便为将来的升级做好准备。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="ce76" class="mx lb iq mg b gy my mz l na nb">apiVersion: gateway.solo.io/v1<br/>kind: VirtualService<br/>metadata:<br/>  name: echo<br/>  namespace: gloo-system<br/>spec:<br/>  virtualHost:<br/>    domains:<br/>      - '*'<br/>    routes:<br/>      - matchers:<br/>          - prefix: /<br/>        routeAction:<br/>          single:<br/>            upstream:<br/>              name: echo<br/>              namespace: gloo-system<br/>            subset:<br/>              values:<br/>                version: v2</span></pre><p id="4251" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令将其应用到您的集群:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="1c16" class="mx lb iq mg b gy my mz l na nb">kubectl apply -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->vs-7.yaml</span></pre><p id="795e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以删除<code class="fe md me mf mg b">v1</code>部署，它不再为任何流量提供服务。</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="3163" class="mx lb iq mg b gy my mz l na nb">kubectl delete -f <!-- -->https://raw.githubusercontent.com/solo-io/gloo-ref-arch/blog-21-apr-20/two-phased-canary/part1/<!-- -->echo-v1.yaml</span></pre><p id="48f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的集群看起来像这样:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nd"><img src="../Images/1066abd126393d1c67f4b9b07bbc5c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6NpimUZpduPa61ew.png"/></div></div></figure><p id="2fd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对网关的请求返回:</p><pre class="mi mj mk ml gt mt mg mu mv aw mw bi"><span id="7d35" class="mx lb iq mg b gy my mz l na nb">➜ curl $(glooctl proxy url)/<br/>version:v2</span></pre><p id="6bd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在已经使用Gloo完成了应用程序更新的两阶段canary部署！</p><h1 id="ef15" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">其他高级主题</h1><p id="06ac" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">在这篇文章的过程中，我们收集了一些可以作为高级探索的良好起点的主题:</p><ul class=""><li id="9522" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">使用JWT过滤器来验证jwt，将声明提取到头部，并根据声明值路由到canary版本。</li><li id="4427" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">查看由Gloo创建的Prometheus metrics和Grafana仪表板，以监控部署的健康状况。</li><li id="d925" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">通过集成Flagger和Gloo实现自动化部署</li></ul><p id="8ed2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得进一步探讨的几个其他主题:</p><ul class=""><li id="d32d" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">通过给予团队对其上游和路线配置的所有权来支持自助升级</li><li id="6264" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">利用Gloo的委托功能和Kubernetes RBAC安全地分散配置管理</li><li id="023d" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">通过应用GitOps原则和使用Flux等工具将配置推送到集群，实现连续交付流程的完全自动化</li><li id="1da9" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">通过用不同的部署模式设置Gloo来支持混合或非Kubernetes应用程序用例</li><li id="02d9" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">在将生产流量转移到新版本之前，利用流量阴影开始用真实数据测试新版本</li></ul><h1 id="8b6a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">加入Gloo社区</h1><p id="3334" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">除了企业客户群之外，Gloo还有一个庞大且不断增长的开源用户社区。要了解更多关于Gloo的信息:</p><ul class=""><li id="2aa4" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">查看<a class="ae kl" href="https://github.com/solo-io/gloo" rel="noopener ugc nofollow" target="_blank"> repo </a>，在这里您可以看到代码和文件问题</li><li id="8cd3" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">查看<a class="ae kl" href="https://docs.solo.io/gloo/latest" rel="noopener ugc nofollow" target="_blank">文档</a>，其中有大量的指南和例子</li><li id="9f6f" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">加入<a class="ae kl" href="http://slack.solo.io/" rel="noopener ugc nofollow" target="_blank"> slack频道</a>，开始与Solo工程团队和用户社区聊天</li></ul><p id="07ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想与我联系(反馈总是被感激！)，你可以在Slack上找到我或者发邮件给我<a class="ae kl" href="mailto:rick.ducott@solo.io" rel="noopener ugc nofollow" target="_blank"> rick.ducott@solo.io </a>。</p></div></div>    
</body>
</html>