<html>
<head>
<title>The MicroK8s addons framework is now open to everyone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MicroK8s插件框架现在对所有人开放</h1>
<blockquote>原文：<a href="https://itnext.io/the-microk8s-addons-framework-is-now-open-to-everyone-b8bea5a53a5d?source=collection_archive---------2-----------------------#2022-04-14">https://itnext.io/the-microk8s-addons-framework-is-now-open-to-everyone-b8bea5a53a5d?source=collection_archive---------2-----------------------#2022-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="04fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">插件是MicroK8s Kubernetes发行版中最受欢迎的特性之一，因为它们允许您在相同的同质UX下实现不同的DevOps操作。是否要应用CoreDNS清单，重新配置kubelet并重新启动群集上的节点？<code class="fe kl km kn ko b">microk8s enable dns</code>就是你所说的。是否要安装主机路径存储资源调配器并启动Portainer？<code class="fe kl km kn ko b">microk8s enable portainer</code>正是如此。插件能做什么没有限制，唯一的限制因素是你的想象力！</p><p id="6199" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着即将到来的<em class="kp"> v1.24 </em>发布，我们已经向公众开放了插件框架。我们确保软件供应商和爱好者可以建立他们自己的插件库，并在运行的集群中就地编辑任何可用的插件。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/76b4e4bbf2602119bd470f5fe0b01979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rK8etVxQyL5XxuHGUNBOog.png"/></div></div></figure><p id="d6b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下文中，我们将探讨:</p><ul class=""><li id="3b1e" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">如何使用插件，</li><li id="554b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">如何调整它们来满足你的需求，</li><li id="d1bf" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">创作插件并把它们放到你自己的repo中的过程，</li><li id="afb5" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">如何通过社区插件库推广你的作品？</li></ul><h1 id="c3dc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">使用插件</h1><p id="52e9" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在撰写本文时，<em class="kp"> v1.24 </em>版本还处于测试阶段，因此您需要从最新的/edge渠道安装MicroK8s，以获得addons框架的最新更新:</p><pre class="kr ks kt ku gt mt ko mu mv aw mw bi"><span id="e096" class="mx lr iq ko b gy my mz l na nb">sudo snap install microk8s --classic --channel=latest/edge</span></pre><p id="b072" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用<code class="fe kl km kn ko b">microk8s status</code>你可以看到可用插件的列表:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="28b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要启用一个插件，你需要调用<code class="fe kl km kn ko b">microk8s enable</code>，后跟插件的名字，例如<code class="fe kl km kn ko b">microk8s enable dns</code>。同样，<code class="fe kl km kn ko b">microk8s disable</code>禁用插件。</p><p id="74ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的输出例子中，你可能会注意到每个插件的描述都是以<code class="fe kl km kn ko b">(core)</code>开头的，表示插件是从哪个库获得的。核心插件是由MicroK8s团队维护和支持的。除了核心插件之外，我们还提供了一套由社区维护的插件。要显示这些，您只需<code class="fe kl km kn ko b">microk8s enable community</code></p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="f370" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们将看到的，添加、删除和更新存储库是通过<code class="fe kl km kn ko b">microk8s addons repo</code>命令完成的。<code class="fe kl km kn ko b">microk8s enable community</code>是一种快捷方式，可以让社区贡献可见，而无需知道相应回购的确切URL。</p><h1 id="1dd2" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">根据您的需求就地成型插件</h1><p id="6b62" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">插件库是在<code class="fe kl km kn ko b">/var/snap/microk8s/common/addons</code>下克隆的git项目。例如，<code class="fe kl km kn ko b">core</code>存储库是一个<code class="fe kl km kn ko b">/var/snap/microk8s/common/addons/core</code>目录，其中有一个名为<code class="fe kl km kn ko b">addons</code>的文件夹及其所有附件。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="a1fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意到每个插件上的<code class="fe kl km kn ko b">enable</code>和<code class="fe kl km kn ko b">disable</code>可执行文件了吗？这些是每个插件实现的钩子脚本以及<code class="fe kl km kn ko b">microk8s enable</code>和<code class="fe kl km kn ko b">microk8s disable</code>命令期望找到和调用的。</p><p id="2c59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有可能一个插件做了95%你想要的，但不完全是你需要的。没有什么可以阻止你编辑各自的<code class="fe kl km kn ko b">enable</code>钩子来满足你的需求。尽管对编写这些钩子的语言没有限制，但它们通常以bash或python脚本的形式出现。</p><p id="29f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你自己试试这个。编辑<code class="fe kl km kn ko b">/var/snap/microk8s/common/addons/helm3/enable</code>并将<code class="fe kl km kn ko b">HELM_VERSION</code>设置为<em class="kp">“v 3 . 7 . 0”</em>。保存<code class="fe kl km kn ko b">enable</code>文件，调用<code class="fe kl km kn ko b">microk8s enable helm3</code>。是的，就是这么简单！</p><h1 id="ae26" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">建立你自己的仓库</h1><p id="f77e" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated"><em class="kp"> v1.24版本</em>最激动人心的特性是可以选择将第三方存储库添加到MicroK8s集群中。</p><p id="7f85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了引导存储库创作过程，MicroK8s团队提供了一个带有两个玩具插件(python和bash)的模板存储库。那个仓库可以在https://github.com/canonical/microk8s-addons-repo-template找到。<a class="ae ne" href="https://github.com/canonical/microk8s-addons-repo-template#readme" rel="noopener ugc nofollow" target="_blank"> README.md </a>和<a class="ae ne" href="https://github.com/canonical/microk8s-addons-repo-template/blob/main/HACKING.md" rel="noopener ugc nofollow" target="_blank"> HACKING.md </a>页面将指导您完成这项任务。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nf"><img src="../Images/d64171408d3df3342b82a72c45e909c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OwJq7pSzna9B5mPKEDyxg.png"/></div></div></figure><p id="d80d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们简要介绍一下您需要采取的主要步骤:</p><ul class=""><li id="2d38" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">分叉<a class="ae ne" href="https://github.com/canonical/microk8s-addons-repo-template" rel="noopener ugc nofollow" target="_blank">模板库</a>。如果你登录到Github，只需点击<em class="kp">“使用这个模板”</em>按钮，并填写“新建库”表格。</li><li id="7ab7" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">每个repo顶层的<code class="fe kl km kn ko b">addons.yaml</code>保存着插件列表。用你要运送的附件列表替换这个列表。每个条目都有以下字段:<br/> - <strong class="jp ir">名称:</strong>插件名称<br/> - <strong class="jp ir">描述:</strong>打印在<code class="fe kl km kn ko b">microk8s status</code>输出中<br/> - <strong class="jp ir">版本:</strong>一个字符串，包含你的插件版本<br/>-<strong class="jp ir">check _ status:</strong><code class="fe kl km kn ko b">microk8s status</code>将检查什么来判断插件是否被启用。这可以是Kubernetes中的部署，也可以是主机上充当锁文件的文件。<br/> - <strong class="jp ir">支持的架构:</strong>目前MicroK8s支持AMD64、ARM64和S390x。</li><li id="8b99" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">在<code class="fe kl km kn ko b">addons</code>下创建一个目录，以您将要实现的插件命名。</li><li id="c72f" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">在您创建的目录中添加两个<strong class="jp ir">可执行文件</strong>，分别命名为<em class="kp">启用</em>和<em class="kp">禁用</em>。这些可执行文件可以用任何语言编写，并由<code class="fe kl km kn ko b">microk8s enable/disable</code>命令调用。</li></ul><p id="16e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您可以将您的存储库添加到MicroK8s中，如下所示:</p><pre class="kr ks kt ku gt mt ko mu mv aw mw bi"><span id="068a" class="mx lr iq ko b gy my mz l na nb">sudo microk8s addons repo add fantastic https://github.com/myorg/myrepo</span></pre><p id="2ef3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kl km kn ko b">fantastic</code>是您给存储库的ID。从这一点开始，该ID用于在更新和删除回购时引用回购，例如:</p><pre class="kr ks kt ku gt mt ko mu mv aw mw bi"><span id="8f8f" class="mx lr iq ko b gy my mz l na nb">sudo microk8s addons repo update fantastic<br/>sudo microk8s addons repo remove fantastic</span></pre><p id="11ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">知道了插件是git项目，在开发时就有了许多工作流:</p><ul class=""><li id="af97" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">使用<code class="fe kl km kn ko b">--reference</code>标志，您可以添加一个存储库并指向一个分支/标签:</li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><ul class=""><li id="4c2d" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">您可以添加一个git项目作为您主机上的本地存储库:</li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><ul class=""><li id="a8fb" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">使用<code class="fe kl km kn ko b">microk8s addons repo update</code>获取您正在工作的存储库上的最新变更。或者，您可以直接在<code class="fe kl km kn ko b">/var/snap/microk8s/common/addons/</code>下克隆一个git存储库，MicroK8s会将其作为一个存储库。</li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h1 id="87cb" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">在社区回购中推广您的工作</h1><p id="5e11" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">MicroK8s附带了核心插件和社区插件。为了不扰乱用户输出，社区插件是不可见的。您需要<code class="fe kl km kn ko b">microk8s enable community</code>或者像添加任何其他存储库一样添加社区存储库:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="0764" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了推广你的作品，你可以分叉<a class="ae ne" href="https://github.com/canonical/microk8s-addons.git" rel="noopener ugc nofollow" target="_blank">社区库</a>，添加你的插件，并放置一个针对上游回购的PR。一些你应该知道的事情:</p><ul class=""><li id="5163" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">新插件只在新版本中添加。这意味着一个版本的插件集(例如<em class="kp"> v1.24 </em>)在补丁发布期间不会改变。新合并的插件将在下一个版本中提供。</li><li id="e002" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">每个插件都应该有一个维护者。这些插件不是“捐赠”给MicroK8s团队的。</li><li id="a30b" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">每一个插件都应该有一个测试，以确保它正确部署。此时，测试是基于python的，位于<code class="fe kl km kn ko b">tests</code>目录下。在每个补丁发布之前，我们确保所有的测试都通过了。</li></ul><h1 id="7a9f" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">总结</h1><p id="968f" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">MicroK8s最强大的特性之一，插件，现在对每个人都是免费的。我希望你会享受这种自由，期待看到你会想出什么插件！</p><p id="84e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你在旅途中需要任何帮助，请不要犹豫<a class="ae ne" href="https://microk8s.io/docs/get-in-touch" rel="noopener ugc nofollow" target="_blank">伸出援手</a>。</p><h1 id="fb7a" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">参考</h1><div class="ng nh gp gr ni nj"><a href="https://microk8s.io" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">MicroK8s -面向开发人员、edge和物联网的零运营Kubernetes | MicroK8s</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">面向开发人员、云、集群、工作站、边缘和物联网的低运营成本、最小生产量Kubernetes。取得联系选择…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">microk8s.io</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx la nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://github.com/canonical/microk8s-addons-repo-template" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">GitHub-canonical/micro k8s-addons-repo-Template:micro k8s插件的模板库</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">一个MicroK8s插件库应该对它所包含的插件集合有一个全面的描述。当前…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">github.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx la nj"/></div></div></a></div><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="nz nd l"/></div></figure></div></div>    
</body>
</html>