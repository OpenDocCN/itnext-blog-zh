<html>
<head>
<title>Digging into IO behavior On Azure VM For Oracle DB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入了解Oracle DB Azure VM上的IO行为</h1>
<blockquote>原文：<a href="https://itnext.io/digging-into-io-performance-on-azure-vm-for-oracle-db-fabb3762a0af?source=collection_archive---------4-----------------------#2022-04-27">https://itnext.io/digging-into-io-performance-on-azure-vm-for-oracle-db-fabb3762a0af?source=collection_archive---------4-----------------------#2022-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="547a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是为了理解专门针对Oracle数据库的Azure虚拟机上的IO行为。微软在Azure中提供了关于不同磁盘层的磁盘IO性能的良好文档。我正在执行测试以验证所提供的信息，测试结果将受到我使用的虚拟机SKU和磁盘SKU的限制。让我们看看是否能找到有趣的东西。</p><p id="0d36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试程序很简单，其灵感来自我的前同事Maris在<a class="ae kl" href="https://blog.pythian.com/investigating-io-performance-on-amazon-rds-for-oracle/" rel="noopener ugc nofollow" target="_blank"> AWS RDS和EC2 </a>上的工作。</p><h1 id="a78e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我们有什么？</h1><ol class=""><li id="1634" class="lk ll iq jp b jq lm ju ln jy lo kc lp kg lq kk lr ls lt lu bi translated">具有Sku <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/ev3-esv3-series" rel="noopener ugc nofollow" target="_blank"> Standard_E8s_v3 </a>的Azure虚拟机，即vCPU:8和内存(GiB):64，最大缓存和临时存储吞吐量IOPS/MBps: 16000/128，突发缓存和临时存储吞吐量IOPS/MBps: 16000/400，虚拟机突发默认启用。</li></ol><p id="8274" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.用于Oracle数据库数据文件的磁盘</p><p id="5d37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lv">磁盘大小:512 GiB，磁盘sku: </em> <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/premium-storage-performance#premium-storage-disk-sizes" rel="noopener ugc nofollow" target="_blank"> <em class="lv">高级SSD LRS </em> </a> <em class="lv">，性能层:P30–5000 IOPS，200 MB/s，最大突发IOPS:高达30000，最大突发吞吐量:1000 MB/s </em></p><p id="210a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该磁盘上未启用按需拆分，但启用了只读缓存。</p><p id="d04a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.Oracle数据库19c企业版版本19.15.0.0.0</p><p id="8fde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.不使用ASM的非CDB实例，所有数据文件都在单个Azure磁盘上。</p><p id="afb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在整篇文章中，我没有考虑写io，因为几乎没有任何活动。为了简单起见，我对一些数字进行了四舍五入，并且在某些地方认为KiB等于KB，MiB等于MB。</p><p id="12eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.将IO作为物理IO调用到存储，实际的物理IO可能会有所不同。物理IOPS被称为PIOPS。</p><h1 id="333c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我们在做什么？</h1><p id="8680" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">对于多块读取，数据库(取决于存储)通常会发出大小高达1MB的IO，因此如果使用8K块大小，则表扫描将在单个IO的<em class="lv"> db文件分散读取</em> <strong class="jp ir">或</strong> <em class="lv">直接路径读取中读取多达128个块(默认情况下db _ file _ multi block _ read _ count = 128)。</em></p><p id="ea8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据Azure <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/disks-types#premium-ssd-transactions" rel="noopener ugc nofollow" target="_blank">文档</a></p><p id="9ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lv">对于高级固态硬盘，小于或等于256 KiB吞吐量的每个I/O操作都被视为单个I/O操作。吞吐量大于256 KiB的I/O操作被视为大小为256 KiB的多个I/O。</em></p><p id="b763" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于PIOPS容量消耗的目的，大于<em class="lv"> 256 KiB (262.144 KB) </em>的I/O请求被视为多个I/O。根据上面的陈述，看起来数据库发出的100万个大型IO将被计为4个独立的IO操作，这显然会比预期更快地耗尽分配的IOPS。</p><p id="a121" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的主要目的是验证上述陈述，并在测试时记录任何其他观察结果。</p><p id="e0fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用<a class="ae kl" href="https://asktom.oracle.com/pls/apex/f?p=100:11:0::::P11_QUESTION_ID:9449954200346196651#9487022200346341617" rel="noopener ugc nofollow" target="_blank">康纳·麦克唐纳</a>的帖子创建一个大小为1 GB的表格。</p><p id="599d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试的代码将是:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="79d9" class="mi kn iq me b gy mj mk l ml mm">alter session set "_serial_direct_read"=always;<br/>alter session set db_file_multiblock_read_count=&amp;1;<br/>-- Run FTS against T table forever.<br/>declare<br/>  n number:=1;<br/>begin<br/>  while n&gt;0<br/>  loop<br/>    select /*+ full(t) */ count(*) into n from t;<br/>  end loop;<br/>end;<br/>/</span></pre><p id="a67c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将刷新缓冲区缓存，这将通过将<em class="lv"> _serial_direct_read </em>设置为“ALWAYS”来强制直接路径读取，然后，我将根据我想要发出的IO大小选择<em class="lv">DB _ file _ multi block _ read _ count</em>(默认情况下，<em class="lv">DB _ file _ multi block _ read _ count</em>未设置，它解析为128，因此来自数据库的IO的最大大小为1 MB)，我将使用不同大小的IO进行测试</p><p id="38ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用于收集IOSTAT数据的命令</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8029" class="mi kn iq me b gy mj mk l ml mm"># here sdc is the block device used for datafiles<br/>iostat -d -x 1 300 sdc | awk '{print $4 " "  $6 " " $8}'</span><span id="f527" class="mi kn iq me b gy mn mk l ml mm">output =&gt; r/s rkB/s avgrq-sz</span></pre><p id="a9b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中r/s是每秒读取的io数，rkB/s是每秒读取的kB数，avgrq-sz是以扇区为单位的平均读取请求大小(一个扇区=512字节)</p><h1 id="0980" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">测试结果</h1><p id="cdd7" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">使用1、2、4、8、16、32、64和128的<em class="lv">db _ file _ multi block _ read _ count</em>完成测试。对于每个测试，都会捕获吞吐量和IOPS，并且还会导出有效IO大小。DB实例是空闲的，但是在测试过程中可能会有一些小的IO发生。</p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/61a6391fe8772cc19e1b77f9a284e2b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KdtOALrb18LX1rxbqOQXNQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">IOPS、IO大小和带宽/吞吐量之间的关系</figcaption></figure><p id="9334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.google.com/spreadsheets/d/1kHgjHWoLgmxkbv5vDWBF0I0ytVAF3HspTLITVu6Rz_8/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">链接到IOSTAT数据</a></p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/b207a3c1dc0cbd970110e8c14750183a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*S0u5FqkpuztQWJJyb3-fwg.jpeg"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">Diag1磁盘吞吐量和IOPS:突发</figcaption></figure><ol class=""><li id="3c11" class="lk ll iq jp b jq jr ju jv jy nb kc nc kg nd kk lr ls lt lu bi translated">由于我们没有启用按需猝发，并且磁盘层是P30，因此我<strong class="jp ir">预计不会出现猝发</strong>。关于<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/disk-bursting" rel="noopener ugc nofollow" target="_blank"> <em class="lv">磁盘突发模型</em> </a> <em class="lv"> </em>的微软文档建议必须手动启用按需突发(在我们的示例中未启用)，并且默认情况下，仅针对P20和更小的磁盘层启用基于信用的突发。吞吐量一直增加到400 MB/s的突发阈值，这是在 <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/ev3-esv3-series#esv3-series" rel="noopener ugc nofollow" target="_blank">虚拟机规模调整文档</a>中提到的<em class="lv">突发缓存和临时存储吞吐量IOPS/MBps: 16000/400的限制。根据观察，400 MB/s的吞吐量只能在30分钟的连续时间段内实现，这对于基于信用的突发来说是真实的。<strong class="jp ir">因此，根据实验期间收集的数据，似乎虚拟机突发与基于信用的突发一起发挥作用，吞吐量达到了缓存磁盘的虚拟机阈值。</strong></em></li><li id="5271" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk lr ls lt lu bi translated">对于较小的数据库IO大小，我们达到了最大IOPS，例如<em class="lv">DB _ file _ multi block _ read _ count = 1</em>，数据库IO大小=8 Kb，平均IOPS约为16K，这是缓存存储的虚拟机爆发IOPS阈值</li><li id="40b5" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk lr ls lt lu bi translated">当我们将<em class="lv">DB _ file _ multi block _ read _ count</em>增加到4并将DB IO大小增加到32 Kb时，达到了最大吞吐量(400 MB/s的阈值),并据此调整了IOPS(减少到12500)。随着我们不断增加<em class="lv">DB _ file _ multi block _ read _ count</em>(以及最终的DB IO大小)，IOPS不断减少，直到达到最大IO大小。</li><li id="b736" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk lr ls lt lu bi translated">因此，对于Azure Premium SSDs，它是关于哪个阈值先达到(IOPS或吞吐量)，另一个相应地调整。</li><li id="0ea2" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk lr ls lt lu bi translated">从图2中，我观察到物理IO大小随着我们增加<em class="lv">DB _ file _ multi block _ read _ count</em>而增加，对于<em class="lv">DB _ file _ multi block _ read _ count≤64，它大约等于<em class="lv">DB _ file _ multi block _ read _ count</em>* 8KB(DB IO大小)。</em></li><li id="8130" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk lr ls lt lu bi translated"><strong class="jp ir">物理IO大小不超过512 KB，即当我们将</strong><em class="lv">db _ file _ multi block _ read _ count选择为</em> <strong class="jp ir"> 64、128和256时，选择的PIO大小约为512 KB，这与下面来自</strong> <a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/disks-types#premium-ssd-transactions" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">文档</strong> </a>的陈述相矛盾</li></ol><p id="2095" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lv">吞吐量大于256 KiB的I/O操作被视为大小为256 KiB的多个I/O。</em></p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f770ad2d5ca0e6078d0bc5a13e0e4c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*n0jxdmOG81YmDIUVLpOKmg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">Diag2 PIO大小与数据库IO大小:突发</figcaption></figure><p id="5ce7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">30分钟后，当爆破点数用完时，我又重复了一次测试。</p><ul class=""><li id="2011" class="lk ll iq jp b jq jr ju jv jy nb kc nc kg nd kk nj ls lt lu bi translated">我们对爆裂试验所做的所有观察结果对没有爆裂的试验都是正确的。第2、3、4、5和6点仍然适用。</li><li id="7535" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">30分钟过后，<strong class="jp ir">吞吐量降至128 MBps </strong>，这是虚拟机的最大缓存和临时存储吞吐量IOPS/MBps的值:16000/128。尽管吞吐量下降到128 MBps，但我们注意到，当我们使用大小为8KB的数据库IO进行测试时，IOPS最大值仍达到16000。虽然磁盘目标IOPS是5000，但我们仍然能够达到16000，因此当<strong class="jp ir">基于信用的爆发耗尽时，它会影响吞吐量，但不一定会影响IOPS。</strong></li></ul><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/721036369193cfe8fb69ec28ded8f1c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*f5KEpbIfKuSh72b3AI7xDg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">图表3 IOPS和吞吐量:无突发</figcaption></figure><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/84f8a8d314d140bdaad406a4c6f56e92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*psmQpmyTMThoCkAkmNmjVg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">图4 PIO大小与数据库IO大小的对比:无突发</figcaption></figure><h1 id="447b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结果比较:DB IO与fio</h1><p id="f8be" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">我的同事<a class="ae kl" href="https://blog.gleb.ca" rel="noopener ugc nofollow" target="_blank">格莱布</a>建议我用<a class="ae kl" href="https://docs.oracle.com/en-us/iaas/Content/Block/References/samplefiocommandslinux.htm" rel="noopener ugc nofollow" target="_blank"> fio </a>来对比这些数据。已创建。每个数据块大小的fio文件，即8K、16K、32K、64K、128K、256K、512K、1024K和2048K。</p><p id="bd46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个8K块大小的例子(测试的块设备是/dev/sdc)，假设我们将其命名为fio_8k.fio</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="c643" class="mi kn iq me b gy mj mk l ml mm">[global]<br/>bs=8K<br/>iodepth=64<br/>direct=1<br/>ioengine=libaio<br/>group_reporting<br/>time_based<br/>runtime=120<br/>numjobs=1<br/>name=raw-read<br/>rw=read<br/>[job1]<br/>filename=/dev/sdc</span></pre><p id="15b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后发出以下命令</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1bfb" class="mi kn iq me b gy mj mk l ml mm">fio fio_8k.fio</span></pre><p id="c2bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在fio测试完成时，突发开始生效，因此我们将与具有突发的DB IO测试进行比较。</p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi nm"><img src="../Images/f712c91b686096d6a5546343697ef63c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzpTjkK45CRj4WqlrWRTZw.jpeg"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">fio与DB IO测试</figcaption></figure><p id="d31c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">根据上表，除了块大小(fio io大小)为1024K和2048K的IOPS大约是数据库IO大小为1024K的IOPS的一半和数据库IO大小为2048K的IOPS的1/4之外，其他数字都是一致的。</strong></p><p id="6ad3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">Pio的计算方法是<em class="lv">吞吐量除以IOPS </em>，因此，块大小(fio IO大小)为1024K和2048K的PIO大小分别为1026.6K和2058.3K，但在DB IO测试(上面的第6点)中并非如此，在DB IO测试中，针对DB IO大小512K、1024K和2048K得出的PIO大小为512KB。</strong></p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/06adbb8ff0dade4858ee5a7dfd96c1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*-9gV53FfeED4E7q3pKjvqg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">吞吐量和IOPS比较</figcaption></figure><figure class="lz ma mb mc gt mp gh gi paragraph-image"><div class="gh gi na"><img src="../Images/0b838228a7e22644a8677dd5d0337e4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*C1c1-nr4iKjwgNezYHUyaA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk translated">PIO尺寸比较</figcaption></figure><p id="d328" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当fio测试在一个会话中运行时，我在另一个会话中收集iostat数据，而<strong class="jp ir"> iostat数据与块大小(fio IO大小)为1024K和2048K的fio数据不匹配。iostat数据仍然显示块大小(fio IO大小)为1024K和2048K的PIO大小为512K，与我们预期的一样。</strong></p><p id="ff42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">IO大小为2048K的示例</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3b52" class="mi kn iq me b gy mj mk l ml mm">iostat<br/>r/s rkB/s avgrq-sz<br/>783.00 398416.00 1016.37</span><span id="2edd" class="mi kn iq me b gy mn mk l ml mm">fio<br/> 1 (f=1): [R(1)][13.2%][r=390MiB/s,w=0KiB/s][r=195,w=0 IOPS][eta 01m:45s]</span></pre><ul class=""><li id="6dc0" class="lk ll iq jp b jq jr ju jv jy nb kc nc kg nd kk nj ls lt lu bi translated">Fio报告IOPS为195，而iostat为783(r/s-每秒读取值)。<strong class="jp ir">这归因于内核与用户空间指标的差异。Fio发出2MB的读操作，这些读操作显然在代码路径的某个地方被分解成更小的io，这些io实际上是发送到磁盘的内容。</strong></li><li id="0230" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated"><em class="lv"> avgrq-sz </em>值为1016；这是向设备发出的io的平均大小(以扇区为单位)。</li><li id="4e6f" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">由于磁盘扇区为512字节，读取IO大小为512 x 1016= 508k =大约。512K。因此，fio发出的每个2MB读取在数据块层被分解为4个512k读取，fio发出的每个1MB读取在数据块层被分解为2个512k读取。</li><li id="5ada" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">iostat报告的每秒读取数(783)大约是fio报告的IOPS(195)的4倍。</li></ul><h1 id="014a" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">关键要点</h1><ul class=""><li id="d1bf" class="lk ll iq jp b jq lm ju ln jy lo kc lp kg lq kk nj ls lt lu bi translated">最大物理IO大小不超过512 KB，这与Azure文档中提到的256 KB不符</li><li id="6d82" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">即使对于P30层及更高层的磁盘，默认情况下也会启用基于信用的突发。</li><li id="bce0" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">当基于信用的突发用尽时，它会影响吞吐量，但不一定会影响IOPS。</li><li id="4bf6" class="lk ll iq jp b jq ne ju nf jy ng kc nh kg ni kk nj ls lt lu bi translated">对于尝试的IO大小大于512KB的测试，FIO与IOSTAT的数据差异。这归因于内核和用户空间度量的差异</li></ul><p id="ddc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:这些观察是为磁盘SKU优质SSD，我计划做类似的测试超SSD磁盘SKU。</p><p id="6922" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了上面讨论的观察之外，参考<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/virtual-machines/premium-storage-performance#application-performance-indicators" rel="noopener ugc nofollow" target="_blank"> Azure文档</a>了解其他磁盘性能注意事项。</p><figure class="lz ma mb mc gt mp gh gi paragraph-image"><a href="https://faun.to/bP1m5"><div class="gh gi nn"><img src="../Images/8f497a40fc9423af91397c9e53e5ff35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCiLLad3dvZLwBa-B5cAVQ.png"/></div></a></figure><p id="3652" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">加入牧神:<a class="ae kl" href="https://faun.to/i9Pt9" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">网站</strong> </a> <strong class="jp ir"> </strong>💻<strong class="jp ir">|</strong>|<a class="ae kl" href="https://faun.dev/podcast" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">播客</strong></a><strong class="jp ir"/>🎙️<strong class="jp ir">|</strong><a class="ae kl" href="https://twitter.com/joinfaun" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">推特</strong> </a> <strong class="jp ir"> </strong>🐦<strong class="jp ir"> | </strong> <a class="ae kl" href="https://www.facebook.com/faun.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">脸书</strong> </a> <strong class="jp ir"> </strong>👥<strong class="jp ir">|</strong><a class="ae kl" href="https://instagram.com/fauncommunity/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">insta gram</strong></a><strong class="jp ir"/>📷| <a class="ae kl" href="https://www.facebook.com/groups/364904580892967/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Facebook群</strong></a><strong class="jp ir"/>🗣️<strong class="jp ir">|</strong><a class="ae kl" href="https://www.linkedin.com/company/faundev" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">LinkedIn群</strong> </a> <strong class="jp ir"> </strong>💬<strong class="jp ir"> | </strong> <a class="ae kl" href="https://faun.dev/chat" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">松弛</strong> </a>📱<strong class="jp ir"> | </strong> <a class="ae kl" href="https://thechief.io" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">云原生</strong> <strong class="jp ir">新闻</strong> </a> <strong class="jp ir"> </strong>📰<strong class="jp ir"> | </strong> <a class="ae kl" href="https://linktr.ee/faun.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">更有</strong> </a> <strong class="jp ir">。 </strong></p><p id="3062" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这篇文章有帮助，请点击拍手👏按钮几下，以示你对作者的支持👇</p></div></div>    
</body>
</html>