<html>
<head>
<title>Electron.NET: Save Dialog &amp; File Writing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电子。NET:保存对话框和文件写入</h1>
<blockquote>原文：<a href="https://itnext.io/electron-net-save-dialog-file-writing-6afa20d76c96?source=collection_archive---------5-----------------------#2018-06-03">https://itnext.io/electron-net-save-dialog-file-writing-6afa20d76c96?source=collection_archive---------5-----------------------#2018-06-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b7341d415102c9d243a05bfff4ef0905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HXSbZUZqQ-qkuzGY9ewcmQ.png"/></div></div></figure><p id="7359" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章是我的Electron.NET示例的另一个扩展，展示了如何用保存对话框提示用户并将文件写入磁盘。修改前的示例代码可以在<a class="ae kw" href="https://github.com/elanderson/Electron.NET/tree/3b4e2c3a1d20b1215ea5691730935d922fdc353f" rel="noopener ugc nofollow" target="_blank">这里</a>找到。正如我在Electron.NET发布的所有帖子一样，API演示<a class="ae kw" href="https://github.com/ElectronNET/electron.net-api-demos" rel="noopener ugc nofollow" target="_blank">回购</a>帮了大忙。</p><p id="3599" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于本例，我们将向联系人详细信息页面添加一个导出按钮，将联系人导出为JSON。</p><h2 id="12c2" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">对话控制器</h2><p id="e316" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">按照API演示的设置方式，我添加了一个DialogController，代码如下。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="69a4" class="kx ky iq ma b gy me mf l mg mh">public class DialogsController : Controller<br/>{<br/>    private static bool saveAdded;<br/><br/>    public IActionResult Index()<br/>    {<br/>        if (!HybridSupport.IsElectronActive || saveAdded) return Ok();<br/><br/>        Electron.IpcMain.On("save-dialog", async (args) =&gt;<br/>        {<br/>            var mainWindow = Electron.WindowManager.BrowserWindows.First();<br/>            var options = new SaveDialogOptions<br/>            {<br/>                Title = "Save contact as JSON",<br/>                Filters = new FileFilter[]<br/>                {<br/>                    new FileFilter { Name = "JSON", <br/>                                     Extensions = new string[] {"json" } }<br/>                }<br/>            };<br/><br/>            var result = await <br/>                  Electron.Dialog.ShowSaveDialogAsync(mainWindow, options);<br/>            Electron.IpcMain.Send(mainWindow, "save-dialog-reply", result);<br/>        });<br/><br/>        saveAdded = true;<br/><br/>        return Ok();<br/>    }<br/>}</span></pre><p id="6dd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的设置告诉Electron，当它接收到一个保存对话框请求时，显示操作系统的保存对话框和指定的选项。当用户完成对话交互时，它被设置，因此电子将发送一个保存-对话-回复消息，因此任何列表都可以根据用户的选择进行操作。</p><p id="688f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加了saveAdded是为了解决我遇到的对话框多次显示的问题。关于我的设置有一些问题，我还没有时间去追踪，但我觉得即使有了这个querk，这个帖子仍然是有价值的。</p><p id="329d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我将下面的导入添加到_Layout.cshtml文件中。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="30e2" class="kx ky iq ma b gy me mf l mg mh">&lt;link rel="import" href="Dialogs"&gt;</span></pre><p id="5843" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我写这篇文章时，我想知道这是否是我的多重对话问题的原因？也许这应该只是在联系详情页面？</p><h2 id="d69e" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">联系人详细信息页面更改</h2><p id="3e46" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">其余的更改在Views/Contacts/Details.cshtml中。我做的第一件事是在页面底部添加一个新的div和button。基于现有页面的外观，它不是最漂亮的东西，但UI的外观并不是这篇文章的重点。下面是新div的代码。请注意，按钮有一个特定的ID。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="7376" class="kx ky iq ma b gy me mf l mg mh">&lt;div&gt;<br/>    &lt;button id="save-dialog" class="btn"&gt;Export&lt;/button&gt;<br/>&lt;/div&gt;</span></pre><p id="ffb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，添加了以下脚本部分。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e04a" class="kx ky iq ma b gy me mf l mg mh">&lt;script&gt;<br/>    (function(){<br/>        const { ipcRenderer } = require("electron");<br/>        const fs = require('fs');<br/>        var model = '@Html.Raw(Json.Serialize(@Model))';<br/><br/>        document.getElementById("save-dialog")<br/>                .addEventListener("click", () =&gt; {<br/>            ipcRenderer.send("save-dialog");<br/>        });<br/><br/>        ipcRenderer.on("save-dialog-reply", (sender, path) =&gt; {<br/>            if (!path) return;<br/><br/>            fs.writeFile(path, model, function (err) {<br/>                console.log(err);<br/>                return;<br/>            });<br/>        });<br/>       <br/>    }());<br/>&lt;/script&gt;</span></pre><p id="0081" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在服务器端，模型被转换成JSON并存储起来，在编写文件时会用到。如果有人有更好的方法来完成这一部分，我很乐意在评论中听到。我指的是这段代码。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="6f09" class="kx ky iq ma b gy me mf l mg mh">var model = '@Html.Raw(Json.Serialize(@Model))';</span></pre><p id="6bd5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，一个click事件被添加到export按钮，该按钮被触发时会发送一条消息，显示在控制器中定义的保存对话框。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="3731" class="kx ky iq ma b gy me mf l mg mh">document.getElementById("save-dialog")<br/>        .addEventListener("click", () =&gt; {<br/>                                     ipcRenderer.send("save-dialog");<br/>                                   });</span></pre><p id="c36f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，为用户已经完成所显示的对话框的消息添加一个回调。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="9926" class="kx ky iq ma b gy me mf l mg mh">ipcRenderer.on("save-dialog-reply", (sender, path) =&gt; {<br/>    if (!path) return;<br/><br/>    fs.writeFile(path, model, function (err) {<br/>        console.log(err);<br/>        return;<br/>    });<br/>});</span></pre><p id="a965" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在回调中，如果用户输入了一个路径，那么模型的JSON将被写入所选的路径。</p><h2 id="e0a3" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">包扎</h2><p id="4d8a" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">虽然将联系人写入JSON可能不是世界上最有用的事情，但同样的想法可以用于将信息写入vCard文件。</p><p id="9e01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">做完这个例子后，我终于感觉到我对电子是如何工作的有了更好的理解。希望这个系列能帮助你有同样的感觉。完整的代码可以在这里找到<a class="ae kw" href="https://github.com/elanderson/Electron.NET/tree/07a9faaceae7bd12290094345490990189677a6e" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="8e47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mp">原载于</em> <a class="ae kw" href="https://elanderson.net/2018/06/electron-net-save-dialog-file-writing/" rel="noopener ugc nofollow" target="_blank"> <em class="mp">安德森</em> </a> <em class="mp">。</em></p></div></div>    
</body>
</html>