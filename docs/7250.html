<html>
<head>
<title>Unhandled Exceptions in Kotlin Collections</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin集合中未处理的异常</h1>
<blockquote>原文：<a href="https://itnext.io/unhandled-exceptions-in-kotlin-collections-d3d9459f15de?source=collection_archive---------3-----------------------#2022-07-28">https://itnext.io/unhandled-exceptions-in-kotlin-collections-d3d9459f15de?source=collection_archive---------3-----------------------#2022-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7956" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">你为什么不早点警告我？</h2></div><p id="1ac1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated"><span class="l lf lg lh bm li lj lk ll lm di"> K </span></p><p id="f997" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不幸的是，<strong class="kk iu">这些方法中的一些会抛出异常</strong>。如果您的程序还没有处理这些异常，这是非常不可取的，会导致您的程序在运行时崩溃。恶心。</p><p id="1cf5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我个人遇到过运行时引发的类似<code class="fe lo lp lq lr b">java.lang.<strong class="kk iu">IndexOutOfBoundsException</strong></code>或<code class="fe lo lp lq lr b">java.util.<strong class="kk iu">NoSuchElementException</strong> </code>的异常，那是因为使用了<code class="fe lo lp lq lr b">List::first</code>。(请注意,“不安全”在其他语言中有不同的含义。)</p><p id="a0e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正是因为这个原因，我们应该<strong class="kk iu">更喜欢返回集合中元素的可空类型</strong>的方法。以下是可以抛出的方法列表(左)及其首选的更安全的对应方法(右):</p><ul class=""><li id="8c94" class="ls lt it kk b kl km ko kp kr lu kv lv kz lw ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/component1.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">component1</strong></a></code>、<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/component2.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">component2</strong></a></code>、…——(无)</li><li id="9424" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/element-at.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">elementAt</strong></a></code> — <code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/element-at-or-null.html" rel="noopener ugc nofollow" target="_blank">elementAtOrNull</a></code>，<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/element-at-or-else.html" rel="noopener ugc nofollow" target="_blank">elementAtOrElse</a></code></li><li id="7acd" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/first.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">first</strong></a></code>——<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/first-or-null.html" rel="noopener ugc nofollow" target="_blank">firstOrNull</a></code></li><li id="0b6b" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><strong class="kk iu">get</strong></code>——<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/get-or-else.html" rel="noopener ugc nofollow" target="_blank">getOrElse</a></code>，<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/get-or-null.html" rel="noopener ugc nofollow" target="_blank">getOrNull</a></code>。注意这只适用于<a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/" rel="noopener ugc nofollow" target="_blank">列表界面</a>。对于<a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-map/" rel="noopener ugc nofollow" target="_blank">映射接口</a>,<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/get.html" rel="noopener ugc nofollow" target="_blank">get</a></code>函数已经返回了一个可空类型🤔。</li><li id="cabf" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b">[...]</code>——(同上)</li><li id="e137" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/last.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">last</strong></a></code> — <code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/last-or-null.html" rel="noopener ugc nofollow" target="_blank">lastOrNull</a></code></li><li id="a625" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/random.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">random</strong></a></code>——<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/random-or-null.html" rel="noopener ugc nofollow" target="_blank">randomOrNull</a></code></li><li id="5f3f" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-mutable-list/remove-at.html#kotlin.collections.MutableList$removeAt(kotlin.Int)" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">removeAt</strong></a></code>——(无)</li><li id="2c12" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/remove-first.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">removeFirst</strong></a></code>——<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/remove-first-or-null.html" rel="noopener ugc nofollow" target="_blank">removeFirstOrNull</a></code></li><li id="3546" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/remove-last.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">removeLast</strong></a></code> — <code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/remove-last-or-null.html" rel="noopener ugc nofollow" target="_blank">removeLastOrNull</a></code></li><li id="cda6" class="ls lt it kk b kl mb ko mc kr md kv me kz mf ld lx ly lz ma bi translated"><code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/single.html" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">single</strong></a></code>——<code class="fe lo lp lq lr b"><a class="ae ln" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/single-or-null.html" rel="noopener ugc nofollow" target="_blank">singleOrNull</a></code></li></ul><p id="07b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">旁注——集合方法不是唯一可以无声地抛出异常的方法。还有其他像<code class="fe lo lp lq lr b">String::toInt</code>这样的，但那是以后的事了。</p><p id="8b04" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么为什么编译器没有向我发出这些方法会抛出的警告，而我却没有捕捉到它们呢？为什么<code class="fe lo lp lq lr b">Map::get</code>方法返回一个可空的而不是<code class="fe lo lp lq lr b">List::get</code>？</p><p id="a700" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">TypeScript中的情况类似，运行时的transpiled JavaScript仍然会抛出<code class="fe lo lp lq lr b">Cannot read properties of undefined 'foo'</code>，因为编译器没有警告一些早期的<code class="fe lo lp lq lr b">undefined</code>返回值。另一方面，在Rust中，块上的新kid访问vector的第一个和最后一个元素，返回一个可空值:<a class="ae ln" href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.first" rel="noopener ugc nofollow" target="_blank"> Vec::first </a>和<a class="ae ln" href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.last" rel="noopener ugc nofollow" target="_blank"> Vec::last </a>。麻烦，但是安全。</p><p id="ff74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望团队在未来的版本中删除上面列出的方法(我在最近的调查中提到了这一点)。但是现在，<strong class="kk iu">更喜欢使用</strong> <code class="fe lo lp lq lr b"><strong class="kk iu">xxxOrNull</strong></code> <strong class="kk iu">的变体</strong>。当他们在代码中写<code class="fe lo lp lq lr b">.first()</code>来访问列表的第一个元素时，不要相信你自己或你的同事😉。</p><p id="2224" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在撰写本文时，最新的Kotlin版本是1.7.10。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="67cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我发表关于人工智能、机器学习、编程语言、Web框架、生产力和学习的文章。</p><p id="8480" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mn">如果你喜欢阅读更多关于web框架的内容，你可以通过我的推荐链接</em> <a class="ae ln" href="https://remykarem.medium.com/subscribe" rel="noopener"> <em class="mn">订阅</em> </a> <em class="mn">随时接收更新或者</em> <a class="ae ln" href="https://remykarem.medium.com/membership" rel="noopener"> <em class="mn">注册</em> </a> <em class="mn">！请注意，您的会员费的一部分将作为介绍费分摊给我。</em></p></div></div>    
</body>
</html>