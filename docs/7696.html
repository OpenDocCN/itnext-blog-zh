<html>
<head>
<title>Unleashing the Power of Kubernetes 1.26: Exploring the New ValidatingAdmissionPolicy Feature with CEL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">释放Kubernetes 1.26的威力:探索CEL的新ValidatingAdmissionPolicy特性</h1>
<blockquote>原文：<a href="https://itnext.io/unleashing-the-power-of-kubernetes-1-26-56979ee667fd?source=collection_archive---------4-----------------------#2022-12-21">https://itnext.io/unleashing-the-power-of-kubernetes-1-26-56979ee667fd?source=collection_archive---------4-----------------------#2022-12-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c6e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes工作人员几天前刚刚推出了最新版本k8s 1.26，它包含了一些非常酷的新功能。最吸引我的是用于准入控制的CEL，它允许我们创建ValidatingAdmissionPolicy，将我们的集群安全性提升到一个新的水平。</p><blockquote class="kl km kn"><p id="995d" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><em class="iq">验证准入策略为验证准入webhooks提供了一个声明性的进程内替代方案。</em></p><p id="b16f" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><em class="iq">验证准入策略使用通用表达式语言(CEL)来声明策略的验证规则。</em></p></blockquote><h1 id="bf0d" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">什么是CEL？</h1><blockquote class="kl km kn"><p id="2abb" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><em class="iq">通用表达式语言(CEL)实现了表达式求值的通用语义，使不同的应用程序更容易进行互操作。<br/></em><a class="ae lq" href="https://github.com/google/cel-spec" rel="noopener ugc nofollow" target="_blank"><em class="iq">https://github.com/google/cel-spec</em></a></p></blockquote><p id="decc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是一种编程语言，在Kubernetes中用来创建定制的准入控制策略。它允许创建复杂的细粒度策略，以在集群中实施安全性和合规性。</p><p id="28d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在之前的<a class="ae lq" href="https://dev.to/douglasmakey/implementing-a-simple-k8s-admission-controller-in-go-2dcg" rel="noopener ugc nofollow" target="_blank">文章</a>中，我们探讨了如何使用Kubernetes准入控制器来执行验证，比如防止容器图像使用最新的标签。在这篇文章中，我们将深入研究新的ValidatingAdmissionPolicy特性，它允许我们以一种更简单的方式进一步利用我们的验证功能，而无需处理webhooks！</p><h1 id="9e6b" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">本地测试K8s 1.26</h1><p id="022e" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">对于本地测试，您可以使用类似于<code class="fe lw lx ly lz b">kind</code>或<code class="fe lw lx ly lz b">microk8s</code>的工具。</p><p id="f560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在使用<code class="fe lw lx ly lz b">kind</code>或<code class="fe lw lx ly lz b">microk8s</code>之前，确保启用<code class="fe lw lx ly lz b">ValidatingAdmissionPolicy</code>特征门和<code class="fe lw lx ly lz b">admissionregistration.k8s.io/v1alpha1</code> API。</p><h1 id="d33f" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">micro k8s—<a class="ae lq" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank">https://micro k8s . io</a></h1><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="4ad6" class="mi kt iq lz b be mj mk l ml mm">microk8s install --channel 1.26</span></pre><p id="7223" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要编辑位于下面代码片段中指定的地址的kube-apiserver文件来激活必要的特性。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="aea1" class="mi kt iq lz b be mj mk l ml mm">$ vim /var/snap/microk8s/current/args/kube-apiserver</span></pre><pre class="mn me lz mo mp aw mq bi"><span id="89e1" class="mr kt iq lz b gy ms mt l mu mm">...<br/>--feature-gates=ValidatingAdmissionPolicy=true<br/>--runtime-config=admissionregistration.k8s.io/v1alpha1=true<br/>...</span></pre><p id="bb65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的是Mac并且安装了microk8s，它会将multipass用作虚拟机。要访问虚拟机，请运行以下命令:</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="1216" class="mi kt iq lz b be mj mk l ml mm">$ multipass list<br/>Name                    State             IPv4             Image<br/>microk8s-vm             Running           192.168.64.5     Ubuntu 18.04 LTS</span></pre><pre class="mn me lz mo mp aw mq bi"><span id="f434" class="mr kt iq lz b gy ms mt l mu mm">$ multipass shell microk8s-vm</span></pre><h1 id="b690" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">kind—<a class="ae lq" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank">https://kind . sigs . k8s . io</a></h1><p id="01f0" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">通过kind，您可以使用在YAML编写的包含所有必要设置的配置文件来创建集群。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="34c7" class="mi kt iq lz b be mj mk l ml mm">kind: Cluster<br/>name: demo-cel<br/>apiVersion: kind.x-k8s.io/v1alpha4<br/>featureGates:<br/>  "ValidatingAdmissionPolicy": true<br/>runtimeConfig:<br/>  "admissionregistration.k8s.io/v1alpha1": true<br/>nodes:<br/>- role: control-plane<br/>  image: kindest/node:v1.26.0</span></pre><p id="8cae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">奔跑</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="3aa7" class="mi kt iq lz b be mj mk l ml mm">$ kind create cluster --config=cluster.yaml</span></pre><p id="0ca6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<code class="fe lw lx ly lz b">kind</code>和<code class="fe lw lx ly lz b">microk8s</code>，您可以使用kubectl来检查是否启用了所有必需的特性。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="289c" class="mi kt iq lz b be mj mk l ml mm">$ kubectl api-versions | grep admissionregistration</span></pre><pre class="mn me lz mo mp aw mq bi"><span id="7157" class="mr kt iq lz b gy ms mt l mu mm">admissionregistration.k8s.io/v1alpha1</span><span id="4a4d" class="mr kt iq lz b gy mv mt l mu mm">$ kubectl api-resources | grep ValidatingAdmissionPolicy</span><span id="f399" class="mr kt iq lz b gy mv mt l mu mm">validatingadmissionpolicies                      admissionregistration.k8s.io/v1alpha1   false        ValidatingAdmissionPolicy<br/>validatingadmissionpolicybindings                admissionregistration.k8s.io/v1alpha1   false        ValidatingAdmissionPolicyBinding</span></pre><p id="9137" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您已经设置了集群，您已经准备好开始试验<code class="fe lw lx ly lz b">ValidatingAdmissionPolicy</code>。</p><h1 id="16bd" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">(演奏等的)表现，风格；(乐曲)演奏</h1><p id="64e7" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">要创建策略，您需要创建以下内容:</p><ol class=""><li id="c9ae" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">概述策略抽象逻辑的ValidatingAdmissionPolicy(例如，“此策略确保将特定标签设置为特定值”)。</li><li id="2f05" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">以及将ValidatingAdmissionPolicy连接到特定范围或上下文的ValidatingAdmissionPolicy binding。"</li></ol><p id="3d3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您想要创建一个策略，通过要求最少3个副本来确保生产部署中的高可用性。该政策可使用以下<code class="fe lw lx ly lz b">ValidatingAdmissionPolicy</code>和<code class="fe lw lx ly lz b">ValidatingAdmissionPolicyBinding</code>资源实施:</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="f143" class="mi kt iq lz b be mj mk l ml mm">apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicy<br/>metadata:<br/>  name: "force-ha-in-prod"<br/>spec:<br/>  failurePolicy: Fail<br/>  matchConstraints:<br/>    resourceRules:<br/>    - apiGroups:   ["apps"]<br/>      apiVersions: ["v1"]<br/>      operations:  ["CREATE", "UPDATE"]<br/>      resources:   ["deployments"]<br/>  validations:<br/>    - expression: "object.spec.replicas &gt;= 3"<br/>      message: "All production deployments should be HA with at least three replicas"</span></pre><p id="8632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的YAML显示了如何指定哪些资源和操作将受到策略的影响。在<code class="fe lw lx ly lz b">spect.validations</code>部分中，您可以使用CEL来定义表达式，资源必须满足这些表达式才能被策略接受。如果表达式的计算结果为false，则根据<code class="fe lw lx ly lz b">spec.failurePolicy</code>字段执行验证检查。</p><p id="ced2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据官方的Kubernetes <a class="ae lq" href="https://kubernetes.io/docs/reference/access-authn-authz/validating-admission-policy/#validation-expression" rel="noopener ugc nofollow" target="_blank">文档</a>，CEL表达式可以通过许多变量访问接纳请求和响应的内容:</p><ul class=""><li id="ac5f" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nk nc nd ne bi translated"><strong class="jp ir">对象</strong>:来自传入请求的对象(对于删除请求为空)。</li><li id="b07b" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated"><strong class="jp ir"> oldObject </strong>:现有对象(对于创建请求为空)。</li><li id="dd21" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated"><strong class="jp ir">请求</strong>:准入请求的属性。</li><li id="1798" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated"><strong class="jp ir"> params </strong>:正在评估的策略绑定所引用的参数资源(如果ParamKind未设置，则为null)。</li></ul><p id="cfc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您有了第一个策略，您需要使用<code class="fe lw lx ly lz b">ValidatingAdmissionPolicyBinding</code>来绑定它:</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="26e5" class="mi kt iq lz b be mj mk l ml mm">apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicyBinding<br/>metadata:<br/>  name: "force-ha-in-prod-binding"<br/>spec:<br/>  policyName: "force-ha-in-prod"<br/>  matchResources:<br/>    namespaceSelector:<br/>      matchLabels:<br/>        env: production</span></pre><p id="9649" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lw lx ly lz b">MatchResources</code>根据对象是否满足匹配标准来决定是否对其运行准入控制策略。在这种情况下，您使用<code class="fe lw lx ly lz b">namespaceSelector</code>将策略应用于所有标有<code class="fe lw lx ly lz b">env: production</code>的名称空间。</p><p id="f03b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也许您想使用<code class="fe lw lx ly lz b">objectSelector</code>，它根据对象是否有匹配的标签来决定是否运行验证。它根据对象的旧版本和新版本进行评估，允许您设置验证以确保资源不会以特定方式发生更改。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="1a6e" class="mi kt iq lz b be mj mk l ml mm">apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicyBinding<br/>metadata:<br/>  name: "force-ha-in-prod-object-binding"<br/>spec:<br/>  policyName: "force-ha-in-prod"<br/>  matchResources:<br/>    objectSelector:<br/>      matchLabels:<br/>        from: kungfudev</span></pre><p id="d7df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然也可以用空的<code class="fe lw lx ly lz b">LabelSelector</code>，会匹配所有对象。如果您希望您的策略在所有资源上运行，而不考虑它们的标签，这将非常有用。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="2a03" class="mi kt iq lz b be mj mk l ml mm">apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicyBinding<br/>metadata:<br/>  name: "force-ha-in-prod-for-all-binding"<br/>spec:<br/>  policyName: "force-ha-in-prod"<br/>  matchResources:</span></pre><p id="ec20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要测试该策略，您可以尝试应用以下YAML，其中包括一个命名空间和一个只有两个副本的部署。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="9660" class="mi kt iq lz b be mj mk l ml mm">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: payments-system<br/>  labels:<br/>    env: production<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  namespace: payments-system<br/>  name: payment-gateway<br/>  labels:<br/>    app: nginx<br/>    from: kungfudev<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: nginx<br/>        image: nginx:1.23.3<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="1fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试它:</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="6e6a" class="mi kt iq lz b be mj mk l ml mm">$ kubectl apply -f force-ha-in-prod.yaml<br/>validatingadmissionpolicy.admissionregistration.k8s.io/force-ha-in-prod created</span></pre><pre class="mn me lz mo mp aw mq bi"><span id="838c" class="mr kt iq lz b gy ms mt l mu mm">$ kubectl apply -f force-ha-in-prod-binding.yaml<br/>validatingadmissionpolicybinding.admissionregistration.k8s.io/force-ha-in-prod-binding created</span><span id="c918" class="mr kt iq lz b gy mv mt l mu mm">$ kubectl apply -f payment-deployment.yaml<br/>The deployments "payment-gateway" is invalid: : ValidatingAdmissionPolicy 'force-ha-in-prod' with binding 'force-ha-in-prod-binding' denied request: All production deployments should be HA with at least three replicas</span></pre><p id="d195" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该策略拒绝部署，因为它不符合策略验证中定义的要求。但是，如果您修改部署以使用4个复制副本而不是2个，策略应该允许。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="bd5c" class="mi kt iq lz b be mj mk l ml mm">...<br/>spec:<br/>  replicas: 4<br/>  selector:<br/>    matchLabels:<br/>...</span></pre><pre class="mn me lz mf bn mg mh bi"><span id="19c2" class="mi kt iq lz b be mj mk l ml mm">$ kubectl apply -f payment-deployment.yaml<br/>deployment.apps/payment-gateway created</span></pre><p id="94b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇，我们只需几个简单的动作，就能确保我们所有的生产部署高度可用！目前，我们的策略非常基本，但是没有什么能阻止我们创建更复杂的验证。想象一下，不允许使用“latest”标签，只允许来自我们自己的注册表的图像，或者确保所有容器都设置了CPU限制。有了我们指尖的<code class="fe lw lx ly lz b">ValidatingAdmissionPolicy</code>的力量，可能性是无穷的！</p><p id="5e70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过利用CEL的全部功能，我们可以链接多个表达式来创建更复杂的验证。</p><p id="a165" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解CEL提供的其他特性和功能，请访问此<a class="ae lq" href="https://github.com/google/cel-spec/blob/master/doc/langdef.md" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><pre class="ma mb mc md gt me lz mf bn mg mh bi"><span id="50d0" class="mi kt iq lz b be mj mk l ml mm">apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicy<br/>metadata:<br/>  name: "prod-ready-policy"<br/>spec:<br/>  failurePolicy: Fail<br/>  matchConstraints:<br/>    resourceRules:<br/>    - apiGroups:   ["apps"]<br/>      apiVersions: ["v1"]<br/>      operations:  ["CREATE", "UPDATE"]<br/>      resources:   ["deployments"]<br/>  validations:<br/>    - expression: "object.spec.template.spec.containers.all(c, !c.image.endsWith(':latest'))"<br/>      message: "cannot use the latest tag"<br/>    - expression: "object.spec.template.spec.containers.all(c, c.image.startsWith('myregistry.com/'))"<br/>      message: "image from an untrusted registry"<br/>    - expression: "has(object.metadata.labels.env) &amp;&amp; object.metadata.labels.env in ['prod', 'production']"<br/>      message: "deployment should have an env and have to be prod or production"<br/>    - expression: |<br/>        object.spec.template.spec.containers.all(<br/>          c, has(c.resources) &amp;&amp; has(c.resources.limits) &amp;&amp; has(c.resources.limits.cpu)<br/>        )<br/>      message: "container does not have a cpu limit set"<br/>---<br/>apiVersion: admissionregistration.k8s.io/v1alpha1<br/>kind: ValidatingAdmissionPolicyBinding<br/>metadata:<br/>  name: "prod-reay-policy-binding"<br/>spec:<br/>  policyName: "prod-reay-policy"<br/>  matchResources:<br/>    namespaceSelector:<br/>      matchExpressions:<br/>      - key: "env"<br/>        operator: "In"<br/>        values: [prod, production,]</span></pre><p id="36b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的YAML中，你会注意到我们可以在绑定期间使用<code class="fe lw lx ly lz b">matchExpressions</code>,给我们的策略一个更动态的范围。</p><p id="847b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ValidatingAdmissionPolicy功能还包括参数资源，允许您将策略配置与其定义分开。这意味着，例如，您可以使用一个参数并为不同的环境配置不同的值，而不是在HA策略中为所有命名空间硬编码最小数量的副本。查看官方<a class="ae lq" href="https://kubernetes.io/docs/reference/access-authn-authz/validating-admission-policy/#parameter-resources" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多关于如何使用该功能的信息。</p><h1 id="de07" class="ks kt iq bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">最后</h1><p id="d478" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">有了CEL和k8s 1.26中新的ValidatingAdmissionPolicy特性，我们现在有能力创建定制的复杂策略，以在集群中实施安全性和合规性。</p><p id="6e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们知道开放策略代理(OPA)被广泛使用，但是ValidatingAdmissionPolicy + CEL被设计成比OPA更轻量级，更易于使用。ValidatingAdmissionPolicy与Kubernetes进行了本机集成，这意味着它可以直接在Kubernetes API服务器中使用，而不需要单独的策略引擎。</p><p id="79de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes中使用OPA或ValidatingAdmissionPolicy + CEL来执行策略各有利弊。OPA可能是一个功能更加丰富和强大的策略引擎，但它可能需要更多的设置和维护。ValidatingAdmissionPolicy + CEL更容易使用，与Kubernetes的集成更加无缝，但它可能没有OPA的所有高级功能。最终，选择使用哪个策略引擎将取决于用户的特定需求和偏好。</p><p id="fdce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个<a class="ae lq" href="https://github.com/douglasmakey/k8s-validating-admission-policy" rel="noopener ugc nofollow" target="_blank">库</a>中找到所有的YAML文件甚至更多的例子。</p><p id="0808" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的关注，我希望这篇文章对您有所帮助，并且易于理解。快乐集群建设！</p></div></div>    
</body>
</html>