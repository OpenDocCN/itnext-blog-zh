# 增加 NPM 包的搜索分数

> 原文：<https://itnext.io/increasing-an-npm-packages-search-score-fb557f859300?source=collection_archive---------5----------------------->

## npmjs.com 搜索结果使用一种评分算法，该算法考虑到了包裹质量和维护。作为一个包的维护者，你可以很容易地提高质量分数，并在搜索结果中获得更好的可见性。

![](img/fcd988cd65df3e89174b77af7d0471f6.png)

Krissana Porto 在 [Unsplash](https://unsplash.com/photos/p6gQCmySSO4) 上拍摄的照片

如果你曾经在[npmjs.com](https://npmjs.com)上搜索过，你可能会注意到右边有一个小条形图。条形图有三个指标:p(人气)，q(质量)，m(维护)。每一个都代表一个分数，加权平均总和用于计算最终分数。其中使用的权重为**质量** : 0.3、**维护** : 0.35、**人气** : 0.35。分数和关键字会影响包裹在搜索结果中的位置。也就是说，较高的分数可以将包放在结果的较高位置。

![](img/1b051a26dca16f7fd37ce5c061fa7ffa.png)

nmpjs.com 搜索结果示例:右上角的分数条形图

该搜索实际上是由 [npms.io](https://npms.io) 提供支持的，如果您在那里执行搜索，您将获得一些关于条形图、最终得分的更详细信息，以及软件包是否安全的指示。npms.io 在他们的[网站](https://npms.io/about)上有一些关于分数如何计算的信息。尽管这些信息很笼统。令人高兴的是，他们还开源了用于计算分数的[分析器](https://github.com/npms-io/npms-analyzer)，如果想更好地了解得分实际上是如何完成的，可以更深入地挖掘。例如，在计算最终得分时使用的权重(0.3，0.35，0.35)可以在此处看到[。此外，通过访问 npms.io api: `https://api.npms.io/v2/package/<package-name>`，可以获得 a 分数的详细分析(JSON)。](https://github.com/npms-io/npms-analyzer/blob/master/lib/scoring/score.js#L215)

如果你想提高你的包的最终分数，最容易关注的部分是质量和维护，因为这些部分完全在你的控制之下。受欢迎程度部分主要取决于下载量和 github 明星，所以我不会深入讨论。

## 维护分数

根据我的经验，在维护领域获得高分是非常简单的，尤其是在软件包的初始开发周期。一个正在积极维护和开发的包应该不会有问题获得接近 100%的分数。为了更好地理解，我将在这里详细说明维护分数的子分数是如何计算的，以防您遇到低分数。维护分数由 4 个子分数组成:

**发布频率**:这个分数是根据一个季度的发布次数来计算的。它确实考虑了追溯到 2 年前的发布。长话短说，如果你平均一个季度发布 2 个或更多，那么你会得到满分。

**提交频率**:该分数根据每月提交次数计算得出。它考虑了追溯到 1 年前的承诺。简而言之，如果你平均每月提交 5 次，你将得到 0.9 分，如果超过 10 分，你将得到满分。

**未决问题**:该分数基于未决问题与总问题之间的比率。如果比率小于 0.2，你将得到满分。请注意，如果项目没有问题，它将自动获得 0.7 分。

**发行分布**:这个分数考虑了项目发行的平均开放天数。如果发行时间超过 29 天，它会给出一个额外的标准化权重，如果发行时间超过一年或更长，它会给出 5 倍的权重。简单来说，如果你能保持 5 天或以下的平均开放时间，你会得到满分。如果你保持 30 天的平均值，那么分数将是 0.7。请注意，如果项目没有问题，它将自动获得 0.7 分。

最后，评分算法考虑到一个“已完成”的项目。在这种情况下，每个子分数最低为 0.9。“已完成”项目是指版本等于或高于 1.0.0、未被弃用、未解决的问题少于 15 个、有自述文件并已通过测试的项目。如果您想查看维护评分的代码，可以在[这里](https://github.com/npms-io/npms-analyzer/blob/master/lib/analyze/evaluate/maintenance.js)找到。

## 质量分数

当试图理解它的所有元素时，质量分数可能有点复杂。计算质量分数的代码在[这里](https://github.com/npms-io/npms-analyzer/blob/master/lib/analyze/evaluate/quality.js)可用。该分数分为 4 个子分数:

**健康分数:**健康分数受过期依赖项的数量以及包是否存在漏洞的影响。如果所有的依赖项都是最新的，并且没有已知的漏洞，那么这个包就会得到满分，就像我的示例包一样。保持依赖关系最新并解决漏洞显然是最佳实践，如果做到了这一点，应该会直接获得满分。

**仔细:**根据包中以下元素的存在来评估仔细分数(每个元素的权重):许可证(0.33)、自述文件(0.38)、更改日志(0.08)、linters 的使用(0.13)，并且包具有 npm 忽略部分或显式文件包含(0.08)。但是，这还不是全部。然后，分数会考虑包裹是否被视为“稳定”。其中“稳定”是指大于或等于 1.0.0 的版本。如果包装不“稳定”,分数减半。因此，即使您有上面指定的所有元素，并且您的包版本是 0.x.x，那么您在这一部分中可以得到的最高分数是 0.5。很多时候一个包的版本停留在 0.x.x 版本上，即使它已经可以生产了。如果是这种情况，请考虑将版本移至 1.x.x，因为它会使该部分的分数翻倍。

**测试分数:**根据三个参数评估测试分数:测试文件的存在(0.6)、覆盖率(0.15)和 Github 状态(0.25)。对于测试文件，仅仅有单元测试是不够的。还需要在 package.json 文件中有一个 npm“测试”脚本，测试文件需要大于 400 字节才能获得完整的 0.6 分。覆盖率是相对于项目的报告覆盖率计算的，需要将项目与代码覆盖率报告框架挂钩，如 [coveralls.io](https://coveralls.io/) 。从 Github 的 api 获取状态，并检查每个类别至少有一个成功。Github 状态 api 可以通过访问查询:[https://API . Github . com/repos/:owner/:repo/commits/master/status。](https://api.github.com/repos/:owner/:repo/commits/master/statuses.)

**品牌化:**品牌化得分根据两个参数计算:项目主页(0.4)和项目自述文件上的徽章数量(0.6)。主页需要在 github.com 域之外(如 babeljs.io)。对于徽章来说，拥有 4 个或更多徽章就足以获得 0.6 分。

## 示例包

在这篇文章的剩余部分，我将介绍我为提高我维护的一个小实用程序包的质量分数所采取的步骤:[](https://www.npmjs.com/package/npm-get-version)**(这个包的动机将在另一篇文章中讨论)。这个包的初始质量分数是:76%。我真的不喜欢这个分数(谁想得到 76%的质量分？)，所以我开始增加分数，经过几个简单的步骤后，我能够将分数增加到 100%。**

**![](img/4123fb2e58b3a8cfeab7a07cea539641.png)**

**起始分数截图**

**我从获得这个包的质量子分数开始。这个可以从 npms . io API:【https://api.npms.io/v2/package/npm-get-version[:](https://api.npms.io/v2/package/npm-get-version)**

```
{"carefulness":0.49999999999999994,"tests":0.6,"health":1,"branding":0}
```

**健康得分在开始时是满分 1，因为这个包的所有依赖项都是最新的，没有漏洞。**

**首先，我接近了“测试”分数。分数是 0.6，因为我有单元测试。我也有本地覆盖报告，但是我的项目缺少在线覆盖报告和 Github 状态。改进的方法是将项目添加到一个持续集成系统(Travis-CI)和一个在线覆盖报告工具(coveralls.io)中。我添加了一个简单的 [.travis.yml](https://github.com/glicht/npm-get-version/blob/master/.travis.yml) 文件(不到 10 行),并准备好了我的构建和覆盖率。额外的好处:Travis 现在正在节点 6、8 和 10 上测试我的包(这不是我在本地做的)。在这次更新之后,“测试”分数现在是 1 分，质量分数增加了 6%,达到 82%。**

****重要提示** : npms.io 会在包发布后很快分析包。如果在此期间项目的 Github 状态是“待定”(CI 构建仍在运行)，这将影响“测试”分数。因此，如果您将提交作为发布流程的一部分(通常作为版本增加的一部分)。最好是先提交，等待 CI 完成，看到 Github 状态为“成功”，然后才发布到 npmjs.com。**

**其次是细心度得分。我的分数是 0.49，这是因为我使用了 0.1.x 版本的软件包。我认为这个包是稳定的，并且 CI 和覆盖率报告已经就绪，我决定是时候迁移到 1.0.x 版本了。这次更新后，细心度得分增加到 0.99，总质量得分增加了 8 分，达到 90%。**

**最后，我接近了品牌评分。该软件包的品牌得分为 0，因为该软件包在自述文件中没有任何徽章，也没有自定义主页。我决定在自述文件中添加 4 个标记:npm 包版本、构建状态(travis)、覆盖状态(工作服)和依赖状态(david-dm)。在这次最终更新后，品牌得分增加到 0.6。由于 npms.io 计算最终质量得分的方式，即使品牌得分没有增加到满分 1，总质量得分也达到了 100%。**

**![](img/b943c1532e2b06a8edb6892ef0b2521d.png)**

**最终质量分数为 100%**

**总的来说，经过几个简单的步骤，我成功地将质量分数从 76%提高到了 100%。总分从 58 分增加到 66 分。对于一些直截了当的变化来说，还不算太坏。如果你想看到所采取步骤的确切提交，它们都可以通过 GitHub [这里](https://github.com/glicht/npm-get-version/compare/v0.1.1...v1.0.2)获得。**