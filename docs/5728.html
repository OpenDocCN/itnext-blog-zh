<html>
<head>
<title>Introducing argocd-vault-plugin v1.0!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍argocd-vault-plugin 1.0版！</h1>
<blockquote>原文：<a href="https://itnext.io/introducing-argocd-vault-plugin-v1-0-708433294b2d?source=collection_archive---------4-----------------------#2021-05-11">https://itnext.io/introducing-argocd-vault-plugin-v1-0-708433294b2d?source=collection_archive---------4-----------------------#2021-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/3cf2b76e5591deed974d9e3533b9636c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ZgOSU7IIsZgJllZJPnhjCw.png"/></div></figure><p id="94d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">* *更新:我们已经将argocd-vault-plugin库转移到argoproj-labs组织，您现在可以在这里找到用途<a class="ae ks" href="https://github.com/argoproj-labs/argocd-vault-plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/argoproj-labs/argocd-vault-plugin</a></p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="abc5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">argocd-vault-plugin背后的团队很高兴地宣布我们的1.0版本！在这个版本中，我们添加了几个非常酷的新功能，同时也修复了一些bug。由于这是一个主要版本，有几个突破性的变化，我们将在这里讨论。</p><h1 id="cc6e" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">新的内嵌路径格式</h1><p id="2a18" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">在argocd-vault-plugin之前的版本中，您要么必须指定一个<code class="fe md me mf mg b">PATH_PREFIX</code>环境变量，要么必须设置一个<code class="fe md me mf mg b">avp_path</code>注释。在一个秘密中有许多密钥的情况下，这些方法是有效的，但如果只有一个密钥或者想要将多个秘密组合在一个文件中，这些方法就无效了。使用1.0版，您现在可以在占位符中设置单独的路径。这允许一个Kubernetes秘密文件从多个Vault秘密中提取，并且不需要注释或额外的环境变量。</p><p id="1250" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">内嵌路径的格式是<code class="fe md me mf mg b">&lt;path:your/vault/path#keyname&gt;</code></p><p id="005e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="8a5a" class="mp lb iq mg b gy mq mr l ms mt">apiVersion: v1<br/>kind: Secret<br/>metadata:  <br/>  name: inline-secret<br/>stringData:  <br/>  inlineSecret: &lt;path:path/to/vault#somekey&gt;<br/>  otherInlineSecret: &lt;path:path/to/another/vault#someOtherkey&gt;<br/>type: Opaque</span></pre><p id="4732" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们希望这增加了组织Kubernetes资源的灵活性，以及从Vault后端获取价值的方式。</p><h1 id="2b91" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">支持AWS机密管理器</h1><p id="6804" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">当我们开始构建argocd-vault-plugin时，我想确定的一件事是，我们比HashiCorp Vault支持更多的工具(尽管工具的名称不同)。</p><p id="ec5a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从1.0版开始，您现在可以选择使用AWS Secret Manager和argocd-vault-plugin！</p><p id="da64" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">AWS Secrets Manager的工作方式与任何其他backed一样，在<code class="fe md me mf mg b">argocd-repo-server</code>窗格中设置所需的环境变量:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="58e9" class="mp lb iq mg b gy mq mr l ms mt">AVP_TYPE: awssecretsmanager<br/>AVP_AWS_ACCESS_KEY_ID: Your AWS Access Key ID<br/>AVP_AWS_SECRET_ACCESS_KEY: Your AWS Secret Access Key</span></pre><p id="c27f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后在AWS Secrets Manager中，创建一个新的密钥/值机密:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mu"><img src="../Images/c1d764ea03f7e7e8af542368ba1a58ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O4-NjtR8VHkxewYxT2Z5rQ.png"/></div></div></figure><p id="f0f1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">给这个秘密起个名字:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mz"><img src="../Images/3d622d286d3da959dc7d9209242e08b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3Qjot2Sk6f9tTSUv_iXHQ.png"/></div></div></figure><p id="92e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，您可以像这样引用yaml中的秘密:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="6815" class="mp lb iq mg b gy mq mr l ms mt">apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: example-secret<br/>stringData:<br/>  sample-secret: &lt;path:my-secret-name#example-key&gt;<br/>type: Opaque</span></pre><p id="eed6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们希望继续扩大我们的支持后端列表。如果您希望添加一个后端，您可以在这里提出功能请求<a class="ae ks" href="https://github.com/IBM/argocd-vault-plugin/issues/new?assignees=&amp;labels=&amp;template=feature_request.md&amp;title=" rel="noopener ugc nofollow" target="_blank">。我们也接受贡献，所以请随意为您选择的后端创建一个拉请求！</a></p><h1 id="3d22" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">支持所有HashiCorp Vault环境变量</h1><p id="66cd" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">我们之前看到的一个问题是，用户希望能够使用HashiCorp Vault后端接受的默认环境变量。到目前为止，我们一直在包装某些变量。但是从1.0版开始，如果使用<code class="fe md me mf mg b">vault</code>后端，所有HashiCorp Vault环境变量都被接受！</p><h1 id="4ef8" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">从0.x迁移到1.0</h1><p id="2c11" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">随着主要版本的发布，在升级到1.0版时需要解决一些突破性的变化。</p><p id="d6ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">改变注释</strong></p><p id="631d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在1.0版中，我们更新了注释以适应Kubernetes命名约定。这些变化是:</p><pre class="mh mi mj mk gt ml mg mm mn aw mo bi"><span id="d854" class="mp lb iq mg b gy mq mr l ms mt">avp_path -&gt; avp.kubernetes.io/path<br/>avp_ignore -&gt; avp.kubernetes.io/ignore<br/>kv_version -&gt; avp.kubernetes.io/kv-version</span></pre><p id="47aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">环境变量的AVP前缀</strong></p><p id="47af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在所有与AVP相关的环境变量都需要前缀<code class="fe md me mf mg b">AVP</code>。这不包括Vault环境变量。在0.x版本中，您可以使用配置文件或Kubernetes secret而不使用前缀<code class="fe md me mf mg b">AVP</code>。在1.0版中，即使使用配置文件或密码，也必须使用<code class="fe md me mf mg b">AVP</code>。</p><p id="12ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">弃用路径前缀</strong></p><p id="d031" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从1.0版开始，我们移除了对<code class="fe md me mf mg b">PATH_PREFIX</code>环境变量的支持。升级时，您会希望使用内嵌路径或<code class="fe md me mf mg b">avp.kubernetes.io/path</code>。</p><p id="0c35" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> IBM Secret Manager名称变更</strong></p><p id="36f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因为我们添加了AWS Secrets Manager，所以我们希望更新环境变量中的命名，使其更加一致。对于1.0版，<code class="fe md me mf mg b">secretmanager</code>现在应被称为<code class="fe md me mf mg b">ibmsecretsmanager.</code></p><h1 id="7910" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="d05f" class="pw-post-body-paragraph ju jv iq jw b jx ly jz ka kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ij bi translated">我们非常高兴这个1.0版本，我们希望你也喜欢它！您可以查看<a class="ae ks" href="https://github.com/IBM/argocd-vault-plugin/releases/tag/v1.0.0" rel="noopener ugc nofollow" target="_blank">发行说明</a>和<a class="ae ks" href="https://github.com/IBM/argocd-vault-plugin/blob/main/README.md#0x-to-1x-migration-guide" rel="noopener ugc nofollow" target="_blank">迁移指南</a>以获得关于新版本的更多信息。我们期待您的反馈，并期待未来的新功能！</p></div></div>    
</body>
</html>