<html>
<head>
<title>Discover Iterative DOM, the magic behind Angular Ivy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索迭代DOM，棱角分明的常春藤背后的魔力</h1>
<blockquote>原文：<a href="https://itnext.io/discover-iterative-dom-the-magic-behind-angular-ivy-4ce84123e58e?source=collection_archive---------2-----------------------#2019-09-29">https://itnext.io/discover-iterative-dom-the-magic-behind-angular-ivy-4ce84123e58e?source=collection_archive---------2-----------------------#2019-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/5f42627144e3da9a08e373bac64b5e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UU_wOBPk9ljj1EGNTrXYxw.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">由<a class="ae jd" href="https://unsplash.com/@cedericx?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Cederic X </a>在<a class="ae jd" href="https://unsplash.com/s/photos/magic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="163e" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">Ivy如何减少包的大小和内存占用</h2></div><p id="d079" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">9月18日和19日，我参加了在伦敦举行的AngularConnect会议。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/718b58fe86de888a0ee3b636df32369a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2UfvjDp5pKeQw9-5.png"/></div></div></figure><p id="a24f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一次很棒的经历，不仅是非常有趣的会议，也是与Angular团队进行个人对话的可能性。</p><p id="097f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">今年，两个主要话题是<strong class="kx jh">性能改进</strong>，当然还有<strong class="kx jh"> Ivy </strong>，新的Angular编译和渲染管道。<br/>虽然与Angular 4同时发布的名为<code class="fe lw lx ly lz b">Renderer2</code>的视图引擎并未引起人们的注意，但Ivy激起了更高的兴趣。更受关注的变化是渲染性能的提高和生成包大小的减小。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/6cb2a746782c9a7c1335d1c576e025c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M5WFAOjfK5CBc2QJ.png"/></div></div></figure><p id="1ee2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了实现这些重大改进，有必要对整个编译过程进行彻底的改变。</p><p id="a93c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Angular团队推迟了Ivy的最终发布，以避免对现有应用程序造成任何破坏性影响。目前，Ivy兼容85%的最流行的库，团队正在不断努力增加这个数字。</p><p id="9a3b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">从Angular v9开始，任何项目都会默认启用Ivy。</strong> <br/>(计划11月下旬发布)。</p><p id="15f1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，如果我们在应用程序中发现任何冲突，我们仍然有可能<em class="ma">选择退出</em>，也就是说，通过更改我们的<code class="fe lw lx ly lz b">tsconfig.json</code>文件中的以下属性来禁用Ivy:</p><blockquote class="mb"><p id="8622" class="mc md jg bd me mf mg mh mi mj mk lq dk translated"><em class="ml">用Ivy进行AOT编译比用View Engine要快，可以用于开发。如果您选择退出Ivy，AOT编译将会更慢，并且不应该用于大型项目的开发。<br/>当对大型项目禁用Ivy时，确保该项目配置中的aot构建选项设置为false，并且仅在生产配置中设置为true。</em></p></blockquote><p id="97c3" class="pw-post-body-paragraph kv kw jg kx b ky mm kh la lb mn kk ld le mo lg lh li mp lk ll lm mq lo lp lq ij bi translated">在会议期间，观众被邀请尽快切换到他们的项目常春藤(当然不是生产中的那些😄)以便能够增加测试的场景。</p><p id="c174" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你想创建一个启用了Ivy的新项目(使用Angular &lt; v9), you can run the following command:</p><pre class="ls lt lu lv gt mr lz ms mt aw mu bi"><span id="be17" class="mv mw jg lz b gy mx my l mz na">ng new my-ivy-app --enable-ivy</span></pre><p id="e17c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Or in case of an existing project:</p><pre class="ls lt lu lv gt mr lz ms mt aw mu bi"><span id="ac89" class="mv mw jg lz b gy mx my l mz na">ng update @angular/core@next</span></pre><p id="13c4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">注意</strong>:</p><blockquote class="mb"><p id="d774" class="mc md jg bd me mf mg mh mi mj mk lq dk translated"><em class="ml">要预览Ivy，请使用@ Angular/core @ Angular的下一版本，而不是@angular/core@latest，因为它包含了所有最新的错误修复和改进。</em></p></blockquote><h1 id="1aab" class="nb mw jg bd nc nd ne nf ng nh ni nj nk km nl kn nm kp nn kq no ks np kt nq nr bi translated">团队的目标</h1><p id="5d75" class="pw-post-body-paragraph kv kw jg kx b ky ns kh la lb nt kk ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">目标是开发具有良好性能的角度应用程序，特别是在移动设备上。因此，生成的项目必须具有较小的包大小和较低的内存占用。</p><p id="99e5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，Ivy使用了<strong class="kx jh">迭代DOM </strong>。<br/>我们已经知道了虚拟世界，并因虚拟世界而出名。迭代DOM将极限推得更远。</p><h1 id="e657" class="nb mw jg bd nc nd ne nf ng nh ni nj nk km nx kn nm kp ny kq no ks nz kt nq nr bi translated">虚拟DOM与迭代DOM</h1><p id="ac4f" class="pw-post-body-paragraph kv kw jg kx b ky ns kh la lb nt kk ld le nu lg lh li nv lk ll lm nw lo lp lq ij bi translated">在React中，组件被呈现为DOM树。每次更新它的模型时，都会在内存中生成一个新的虚拟DOM树。新的变化被应用到内存版本，然后与真正的<em class="ma">DOM进行比较。</em></p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/4177a3add7954a7ae8f60e105d0cc982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1-6ys70wxk6_k5pP.png"/></div></div></figure><p id="ab84" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这样做的好处是，只有差异被应用到真正的DOM，从而减少节点更新。</p><p id="7261" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">迭代DOM </strong>有不同的做法。组件被编译成函数(也称为指令):</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/50b16a833e34b687be6c50cd4eeccb36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y2J-Q_ysSxC5S035.png"/></div></div></figure><p id="ba53" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于每种绑定，都会生成一组特定的指令:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/a77daef2a272caad0b1b4418a3f8b43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9J38YB_q1EFkmlir.png"/></div></div></figure><p id="933a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过向我们的模板添加新的绑定，将相应地创建新的指令:</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/4b127a724dff4a7cc1f33a1eda403b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XlBiY_Nsa-yFYflO.png"/></div></div></figure><p id="31b4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有趣的是，只有我们将使用的指令会出现在最终的包中，所有其他的都被<em class="ma">树动摇</em>掉了。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oa"><img src="../Images/d6bc976717bb94cab7de22bb79a3cc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bzticrd0BdycrLJo.png"/></div></div></figure><p id="96c5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是革命性的方面:能够使渲染引擎本身树摇动。如果一个组件没有引用一条指令，它将不会被使用，因此会被从包中排除。</p><p id="a40c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">迭代DOM还有分配更少内存的优势。与虚拟DOM不同，只有在添加或删除DOM节点时才会用到内存。</p><p id="78e9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于值的更改，更新是在树结构中就地完成的。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/22d0a371c3ab8d8fffe0599b19129380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/0*Kh7rUbZsQu4EAtvn.png"/></div></figure><p id="5d8f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于我们通常不会在应用程序模板中添加/删除很多元素(至少在大多数spa情况下)，这转化为显著的内存节省，尤其是对于大型项目。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/ad4b7b8be7dd0bf6488720cd627ea5c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x9n843hHWSsD4OWW.png"/></div></div></figure><p id="05da" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">目前，对于中型应用程序，使用Ivy并没有带来改进，反而增加了整体大小，即使只是少量增加。Igor Minar证实了这一结果，并补充说Angular团队目前正在研究这些值。希望他们能很快找到解决办法。</p><p id="8f58" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你能传给艾薇不兴奋吗？</p><p id="5774" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我计划在这个周末为我的个人角度项目测试它。如果您在使用Ivy时发现任何异常，请添加一个新的(记录完整的😄)问题，这将极大地有助于进一步改进它。</p><p id="4c4b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">就当是感谢Angular团队吧！❤️</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="485b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ma">原发布于2019年9月29日</em><a class="ae jd" href="https://dev.to/paco_ita/discover-iterative-dom-the-magic-behind-angular-ivy-4c6g" rel="noopener ugc nofollow" target="_blank"><em class="ma">https://dev . to</em></a><em class="ma">。</em></p></div></div>    
</body>
</html>