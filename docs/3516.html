<html>
<head>
<title>Command Line Interface(CLI) Application with .NET Core</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命令行界面(CLI)应用程序。网络核心</h1>
<blockquote>原文：<a href="https://itnext.io/command-line-interface-cli-application-with-net-core-75bb5603ee70?source=collection_archive---------1-----------------------#2020-01-02">https://itnext.io/command-line-interface-cli-application-with-net-core-75bb5603ee70?source=collection_archive---------1-----------------------#2020-01-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bf59e55c2a6d41945dad07e6cff0e9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Fc-zuPOewArGA4g3Erijg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">一个终端(照片由<a class="ae kf" href="http://www.columbia.edu/kermit/terminals.html" rel="noopener ugc nofollow" target="_blank"> Kermit Project </a>拍摄)</figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="2bcc" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">命令行界面(<strong class="kp iu"> CLI </strong>)可能看起来很老派，但它是使用应用程序最有用的方式之一。您可以在SSH连接中与他们进行交互。</p><p id="e190" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">CLI无处不在，比较著名的有<a class="ae kf" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>、<a class="ae kf" href="https://cli.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue CLI </a>、<a class="ae kf" href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/dotnet" rel="noopener ugc nofollow" target="_blank">实体框架核心CLI </a>等。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="8de9" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">序言</h2><p id="f80f" class="pw-post-body-paragraph kn ko it kp b kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">在您开始为您的应用程序创建CLI之前，您需要为它设计命令、选项、参数和解释清楚的指南。</p><p id="fc64" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">想想你有一个应用程序转换CSV到Excel文件和反向。</p><p id="b39c" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">命令</strong></p><ul class=""><li id="aff3" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">皈依者</li><li id="8a73" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">打印</li><li id="2c31" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">帮助</li></ul><p id="415e" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">全局选项</strong></p><ul class=""><li id="88d0" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">输入文件</li><li id="d9d2" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">冗长的</li></ul><p id="6034" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">转换子命令选项</strong></p><ul class=""><li id="71df" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">第一行作为标题(仅限CSV)。</li><li id="9f73" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">输出名称。</li></ul><p id="f18d" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">打印子命令选项</strong></p><ul class=""><li id="f295" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">行</li><li id="d9e6" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">尾巴</li></ul><p id="1ac6" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">例题</strong></p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="08ca" class="ll lm it nc b gy ng nh l ni nj"># For converting the CSV/Excel files<br/>csv-util convert --first-row-header --input:file.csv --output:output_file</span><span id="deca" class="ll lm it nc b gy nk nh l ni nj"># For printing only the 10 first rows<br/>csv-util print --rows:10 --input:file.csv</span><span id="4f44" class="ll lm it nc b gy nk nh l ni nj"># For priting only the 10 tailing rows<br/>csv-util print --rows:10 --tail --input:file.csv</span></pre><p id="df9d" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">我们已经为我们的CLI草拟了一份设计方案。是时候让它成真了。</p><h2 id="0619" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">中的CLI应用程序。网</h2><p id="08af" class="pw-post-body-paragraph kn ko it kp b kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">有几个图书馆。用于创建CLI的. NET核心。内特·麦克马斯特的《T21》是我认为最好的一部。CommandLineUtils是<a class="ae kf" href="https://github.com/aspnet/Common" rel="noopener ugc nofollow" target="_blank">微软的一个分支。extensions . command line utils</a>，不再在<a class="ae kf" href="https://github.com/aspnet/Common/issues/257" rel="noopener ugc nofollow" target="_blank">活动开发</a>中。</p><p id="52d2" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated"><strong class="kp iu">为什么是CommandLineUtils库？</strong></p><ul class=""><li id="80f4" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">它支持CLI应用程序中的依赖注入。</li><li id="52c8" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">支持用于创建CLI的属性和API生成器。</li></ul><p id="da0d" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在本文中，我们主要关注这个库来实现<strong class="kp iu"> CSVUtil </strong> CLI。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><h2 id="58ac" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">入门指南</h2><p id="48cb" class="pw-post-body-paragraph kn ko it kp b kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">安装<a class="ae kf" href="https://dotnet.microsoft.com/download" rel="noopener ugc nofollow" target="_blank">。NET Core SDK </a>和<a class="ae kf" href="https://code.visualstudio.com/Download" rel="noopener ugc nofollow" target="_blank"> VSCode </a>如果你还没装的话。用DOTNET创建一个新的控制台项目。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="51b2" class="ll lm it nc b gy ng nh l ni nj">dotnet new console -o CSVUtil</span></pre><p id="2904" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">添加<a class="ae kf" href="https://www.nuget.org/packages/McMaster.Extensions.CommandLineUtils" rel="noopener ugc nofollow" target="_blank"> <strong class="kp iu">麦克马斯特。extensions . command line utils</strong></a><strong class="kp iu"/>n将包获取到项目中。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="4ba5" class="ll lm it nc b gy ng nh l ni nj">dotnet add package McMaster.Extensions.CommandLineUtils</span></pre><p id="42a5" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在Program.cs文件中，初始化您的CLI应用程序，如下例所示。</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="e544" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">在我们的设计草案中，我们有两个全局选项:Verbose和输入文件。这些是所有命令的选项。为了定义一个选项，这个库有方法<code class="fe nn no np nc b">Option</code>。</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><ul class=""><li id="a513" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">每个选项都应该有一个模板。模板被定义为“-i| —输入”。</li><li id="2df3" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">根据选项的不同，它可以有值(或者只有一个值)或者什么都没有，这可以通过<code class="fe nn no np nc b">CommandOptionType</code> enum来配置。</li><li id="6e55" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">如果有任何选项是强制性的，可以根据需要用<code class="fe nn no np nc b">IsRequired</code>方法标记。</li></ul><h2 id="5b86" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">添加命令</h2><p id="da21" class="pw-post-body-paragraph kn ko it kp b kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">添加命令与添加选项相同。<em class="nq">请记住命令是可以嵌套的。</em></p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><ul class=""><li id="7813" class="mj mk it kp b kq kr ku kv ky ml lc mm lg mn lk mo mp mq mr bi translated">可以在命令内部定义与特定命令相关的选项。</li><li id="4c95" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">定义选项时，可以在泛型方法中告知CLI选项值类型。</li><li id="f7d5" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">可以用<strong class="kp iu"> HasValue </strong>方法检查选项是否有值。</li><li id="9b28" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">在使用选项类型的情况下，解析的值可以通过<strong class="kp iu"> ParsedValue </strong>属性访问。</li><li id="f726" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">每个命令都有自己的帮助。</li><li id="e4b7" class="mj mk it kp b kq ms ku mt ky mu lc mv lg mw lk mo mp mq mr bi translated">每个命令都应该有一个执行的方法<strong class="kp iu">，这个方法将在CLI中执行。</strong></li></ul><p id="0db8" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">要让您的CLI准备好执行，您需要通过args参数告诉应用程序执行CLI。</p><figure class="mx my mz na gt ju"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="4321" class="ll lm it bd ln lo lp dn lq lr ls dp lt ky lu lv lw lc lx ly lz lg ma mb mc md bi translated">执行CLI</h2><p id="2169" class="pw-post-body-paragraph kn ko it kp b kq me ks kt ku mf kw kx ky mg la lb lc mh le lf lg mi li lj lk im bi translated">我们有两个全局选项和两种方法。通过运行CSVUtil -h，应用程序将把它打印到控制台:</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="dc75" class="ll lm it nc b gy ng nh l ni nj">CSVUtil -h<br/>Usage:  [command] [options]</span><span id="172a" class="ll lm it nc b gy nk nh l ni nj">Options:<br/>  -i|--input    Input file to convert<br/>  -v|--verbose  Display operation details<br/>  -?|-h|--help  Show help information</span><span id="8c1e" class="ll lm it nc b gy nk nh l ni nj">Commands:<br/>  convert<br/>  print</span><span id="5309" class="ll lm it nc b gy nk nh l ni nj">Run ' [command] -?|-h|--help' for more information about a command.</span></pre><p id="4344" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">因为我们定义了两个全局选项，所以需要在[command]之前调用它们。例如，我想以冗长的方式将CSV文件转换为Excel。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="d15f" class="ll lm it nc b gy ng nh l ni nj">CSVUtil --verbose --input:file.csv convert --first-row-header</span></pre><p id="6fce" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如你所见，<code class="fe nn no np nc b">--verbose</code>和<code class="fe nn no np nc b">--input</code>在任何命令之前输入。</p><figure class="mx my mz na gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/effe4d731a4d015a3093d083aaeff74c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rfN_M6uGBKl1hR86So58Aw.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">现场执行CSVUtil</figcaption></figure></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="24eb" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">CommandLineUtils提供了其他几个特性，比如属性和依赖注入。属性是创建CLI的一个很酷的特性，但是像我这样的一些人更喜欢builder-pattern(我们的例子是在builder-pattern中实现的)。</p><pre class="mx my mz na gt nb nc nd ne aw nf bi"><span id="7d14" class="ll lm it nc b gy ng nh l ni nj">using System;<br/>using McMaster.Extensions.CommandLineUtils;<br/><br/>public class Program<br/>{<br/>    public static int Main(string[] args)<br/>        =&gt; CommandLineApplication.Execute&lt;Program&gt;(args);<br/><br/>   <strong class="nc iu"> [Option(Description = "The subject")]</strong><br/>    public string Subject { get; }<br/><br/>    private void OnExecute()<br/>    {<br/>        var subject = Subject ?? "world";<br/>        Console.WriteLine($"Hello {subject}!");<br/>    }<br/>}</span></pre><p id="d126" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">对于依赖注入，最好阅读项目文档。</p></div><div class="ab cl kg kh hx ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="im in io ip iq"><p id="39d1" class="pw-post-body-paragraph kn ko it kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk im bi translated">如果你喜欢完整的工作示例，你可以在<a class="ae kf" href="https://gist.github.com/0x414c49/818c681e0ab7b5a5bb89350652c65568" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div></div>    
</body>
</html>