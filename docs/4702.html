<html>
<head>
<title>Kubernetes: Virtual Clusters For CI/CD &amp; Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:用于CI/CD和测试的虚拟集群</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-virtual-clusters-for-ci-cd-testing-ccc3664d21e0?source=collection_archive---------4-----------------------#2020-08-26">https://itnext.io/kubernetes-virtual-clusters-for-ci-cd-testing-ccc3664d21e0?source=collection_archive---------4-----------------------#2020-08-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="de0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虚拟Kubernetes集群如何解决当前在CI/CD和测试流程中集成Kubernetes的问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4f7e8e407c69b7bed0742139ccf213f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8jRqawqV_SG0tgN2"/></div></div></figure><p id="ee0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes 中使用<a class="ae kx" href="https://loft.sh/blog/introduction-into-virtual-clusters-in-kubernetes/" rel="noopener ugc nofollow" target="_blank">虚拟集群(vClusters)，即在物理集群内运行虚拟集群，有可能会破坏Kubernetes在各种环境中的使用，从云原生开发到机器学习实验。(有关虚拟集群的一般优势及其使用案例的概述，请参考</a><a class="ae kx" href="https://loft.sh/blog/virtual-clusters-for-kubernetes-benefits-use-cases/" rel="noopener ugc nofollow" target="_blank">本文</a>)。其中一个设置是持续集成/部署(CI/CD)和相关的软件测试。在这篇文章中，我将描述虚拟集群如何用于CI/CD和测试，以及它们对这个用例的好处。</p><h1 id="82f6" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">现状</h1><p id="b514" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">要了解CI/CD和测试虚拟集群的案例，需要了解当前的技术水平和基本挑战:</p><p id="cfd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如今，许多公司已经在其开发过程中实现了CI/CD管道，以使工程师能够在现实环境中简单地运行他们开发的软件。这对于正确测试软件也很重要，因为只有在真实的环境中，真实的测试才是可能的。这种基于管道的方法的好处是，工程师不需要关心管道另一端的软件运行环境，也不需要成为这方面的专家。</p><p id="c633" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，甚至可以使用最真实的环境，即实际运行系统的环境，也在管道后面运行测试。对于许多公司来说，这种环境就是现在的Kubernetes环境。</p><p id="c34a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管如此，仍有一个问题需要回答:这种环境来自哪里？通常有两种方法可以解决这个问题:工程师可以共享一个由管理员集中管理的环境，或者他们可以使用单独的Kubernetes集群。有时，当微型团队共享集群时，方法也是混合的。不幸的是，所有的方法都有一些缺点:</p><h2 id="950e" class="mb kz iq bd la mc md dn le me mf dp li jy mg mh lm kc mi mj lq kg mk ml lu mm bi translated">共享环境</h2><ul class=""><li id="29a6" class="mn mo iq jp b jq lw ju lx jy mp kc mq kg mr kk ms mt mu mv bi translated"><strong class="jp ir">一刀切/缺乏灵活性。</strong>当所有工程师使用相同的环境时，这个环境需要适用于所有情况。然而，情况并非总是如此，因为有时需要更改配置。由于这些更改会影响整个环境，所有其他工程师也会受到影响，这就是为什么工程师不允许进行任何配置更改。这使得共享环境的使用非常不灵活。</li><li id="5a4c" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">不稳定性/脆弱性。即使不允许工程师修改集群配置，集群也可能崩溃。在这些情况下，所有的工程师都会同时受到影响。这意味着这种偶然的崩溃通常会完全停止软件开发团队，因此使得共享系统变得非常关键。这可能导致推迟更新以防止与此类更新相关的任何风险。反过来，如果一些工程师不得不等待必要的更新，这可能会导致工作流中断。此外，为了首先使CI/CD和测试的共享环境变得可行，工程师需要被隔离，这通常是通过提供相当弱的隔离形式的名称空间来完成的。</li></ul><h2 id="e8a1" class="mb kz iq bd la mc md dn le me mf dp li jy mg mh lm kc mi mj lq kg mk ml lu mm bi translated">单个集群</h2><ul class=""><li id="25e8" class="mn mo iq jp b jq lw ju lx jy mp kc mq kg mr kk ms mt mu mv bi translated"><strong class="jp ir">成本低效/昂贵。</strong>对开发人员来说，使用单独的集群是一种更加安全和灵活的解决方案。然而，它也非常昂贵并且成本效率低。由于大多数CI/CD管道都是按分钟定价的，因此通常不可能在管道过程中按需启动集群，因为这样会阻塞管道并增加成本。出于这一点以及一般的方便，用于CI/CD和测试的集群通常会一直运行，不管它们是否被使用。考虑到计算资源的高成本，特别是在公共云中，这是一种非常浪费的提供执行环境的方式。</li><li id="048e" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><strong class="jp ir">复杂/没有监督。</strong>此外，集群通常只能由拥有更广泛权限的管理员创建，这些权限允许他们启动或关闭集群。随着大量集群的出现，特别是对于大型团队，这些管理员很难保持控制，因为不太容易确定哪些集群仍在使用，哪些集群处于空闲状态，应该关闭。由于工程师往往会不时地要求新的集群，随着时间的推移，这个问题会变得更糟，导致许多未使用的集群的情况，没有人真正了解这些集群，但仍然会产生成本。</li></ul><blockquote class="nb nc nd"><p id="26a6" class="jn jo ne jp b jq jr js jt ju jv jw jx nf jz ka kb ng kd ke kf nh kh ki kj kk ij bi translated">将仅在非常小的团队中共享的许多集群的两种方法结合起来甚至会更糟。这只会增加对哪些集群仍然需要的困惑，因为不是每个工程师都确切知道他们的队友在做什么，甚至可能从未使用过其他人仍然需要的集群。在这些情况下，管理员可能会经常听到类似“什么集群？”，“我不知道XYZ是否还需要这个”，或者“哦，是的，你可以删除它”(当集群实际上仍然需要时)。</p></blockquote><h1 id="85bc" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用于CI/CD和测试的虚拟集群</h1><p id="30b0" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">如果你对这些问题中的任何一个听起来很熟悉，你应该看看<a class="ae kx" href="https://loft.sh/blog/introduction-into-virtual-clusters-in-kubernetes/" rel="noopener ugc nofollow" target="_blank"> vClusters </a>。虚拟集群有一些优势，可以解决在CI/CD和测试中使用Kubernetes的挑战:</p><ul class=""><li id="dc27" class="mn mo iq jp b jq jr ju jv jy ni kc nj kg nk kk ms mt mu mv bi translated"><strong class="jp ir">快速启动:</strong>虚拟集群的一个好处是它们只需3-5秒就可以使用。这使得有可能在真正需要时启动新的vClusters，例如当CI/CD管道被触发时。为此，您将不再需要任何一直运行的备用集群，即使在未使用时也是如此，这将节省大量时间和成本，同时还可以完美地集成到工程工作流中。</li><li id="3180" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><strong class="jp ir">易于清理和恢复:</strong>由于vClusters可以轻松启动，因此也可以清理或丢弃它们，例如在测试完成后。如果工程师再次需要群集，他们可以使用完全相同的规范恢复或重新创建它。因此，当以后再次需要相同的配置时，甚至不需要备用集群。</li><li id="afe8" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><strong class="jp ir">共享物理集群:</strong>由于虚拟集群只是一个抽象概念，所以仍然只需要一个物理集群，尽管工程师们拥有独立集群的经验。物理集群甚至不需要大量的安装，可以非常“纯粹”和简单。因为管理和监督一个简单的集群要容易得多，所以管理员的管理工作大大减少了。</li><li id="9a2e" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><strong class="jp ir">强隔离:</strong>虚拟集群类似于物理集群，因此提供了比名称空间更强的隔离。因此，工程师在封装的环境中工作和测试，感觉就像单独的集群，因此脱离vCluster的可能性要小得多。</li><li id="0eda" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated"><strong class="jp ir">单独配置:</strong>在虚拟集群中，工程师可以根据需要自由配置一切，因为它们不会影响其他虚拟集群。为此，例如，工程师甚至可以在共享物理集群上的虚拟集群中使用不同的Kubernetes版本。这还允许他们试验配置，即使他们犯了错误，他们也可以立即使用全新的vCluster从头开始。</li></ul><p id="0b49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，虚拟集群解决了Kubernetes访问和CI/CD及测试环境配置的所有当前问题。</p><p id="72c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">从管理员的角度来看</strong>，虚拟集群设置易于管理和维护，因为只存在一个简单的物理集群，该集群也是稳定的，因为每个工程师都封装在单独的沙盒环境中。要完成这个设置，管理员只需创建一个Kubernetes集群并安装一个虚拟集群软件，例如<a class="ae kx" href="https://loft.sh/docs/introduction" rel="noopener ugc nofollow" target="_blank"> loft </a>，这样整个设置过程不到一个小时就可以完成。</p><p id="6a50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">从工程师的角度来看</strong>，虚拟集群感觉就像物理集群一样，如果需要和期望，它们可以自由地进行实验和配置更改。他们在工作流程中也不会中断等待新配置的集群，因为他们可以根据需要轻松创建虚拟集群，特别是在针对这些用例的解决方案中，甚至提供工程友好的GUI，如<a class="ae kx" href="https://loft.sh/" rel="noopener ugc nofollow" target="_blank"> loft </a>。</p><p id="bebe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">从业务角度来看</strong>，虚拟集群解决方案可最大限度地降低计算资源成本，因为它消除了闲置的备用集群。此外，随着Kubernetes环境问题通过标准化解决方案得到解决，工程团队的生产力有望提高。</p><h1 id="58c8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="1ed4" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">总的来说，虚拟集群有可能中断Kubernetes在CI/CD和测试中的使用，因为它们通过为这些情况提供Kubernetes环境解决了所有当前的挑战。通过同时消除对成本、稳定性和生产效率的担忧，所有相关利益方都可以从引入虚拟Kubernetes集群中受益。这同样有助于推动Kubernetes在许多组织中的采用，这些组织仍然怀疑Kubernetes是否应该集成到当前的CI/CD和测试流程中。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="bd72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">照片由<a class="ae kx" href="https://www.pexels.com/@jacp?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">提供，只有几张照片</a>来自<a class="ae kx" href="https://www.pexels.com/photo/gray-and-yellow-metal-pipes-3421636/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">像素</a></p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="d13b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ne">原发布于</em><a class="ae kx" href="https://loft.sh/blog/kubernetes-virtual-clusters-for-ci-cd-testing/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://loft . sh</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>