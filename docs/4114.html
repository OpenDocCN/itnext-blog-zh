<html>
<head>
<title>Fleet Management of Kubernetes Clusters at Scale — Rancher’s Fleet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大规模库伯内特集群的车队管理——牧场主车队</h1>
<blockquote>原文：<a href="https://itnext.io/fleet-management-of-kubernetes-clusters-at-scale-ranchers-fleet-de161cc52325?source=collection_archive---------1-----------------------#2020-04-29">https://itnext.io/fleet-management-of-kubernetes-clusters-at-scale-ranchers-fleet-de161cc52325?source=collection_archive---------1-----------------------#2020-04-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e5f8b8f9ec5d0b5a53e8d83156d658a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZcViIhoZ0aVoUT2I30yxlA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes集群车队控制器</figcaption></figure><div class=""/><p id="5acc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将独立的Kubernetes集群部署到边缘位置、异构云平台、本地数据中心等。如今，一种常见的模式是提供一个统一的平台来运行边缘、物联网和多云空间中的应用和服务。此外，在物联网世界中，边缘在空间上分布在内部和云环境中，还有更复杂的运输软件用例。</p><p id="f717" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rancher的多集群管理已经支持在多个集群上同时部署和管理应用程序，用户必须从UI中专门选择目标集群/站点，这在管理1000个集群时无法扩展。现在，随着fleet的引入，这种配置可以是无缝的，可以使用部署规范中的配置将群集作为目标。</p><p id="e96c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://github.com/rancher/fleet" rel="noopener ugc nofollow" target="_blank"> Rancher's fleet </a>使用户能够像管理一个集群一样轻松地管理多个集群。用户可以从一个中心Kubernetes集群跨集群部署捆绑包(资源集合),并使用粒度目标/分组配置控制部署。捆绑包不仅包括应用程序部署清单，还包括任何可以被描述为Kubernetes资源的东西。</p><p id="0a37" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Rancher已经支持导入已经由任何安装工具设置好的Kubernetes集群，方法是部署Rancher代理来实现服务器和集群之间的通信。集群所有者可以启用监控和日志记录、启用Istio for service mesh、配置管道、管理访问等。在导入的集群上。v2.4.0中增加了将K3s Kubernetes集群导入Rancher的功能，导入的K3s集群可以通过在Rancher UI中编辑K3s集群规范进行升级，该UI提供了从中央控制平面对大量K3s集群的集群级管理。Fleet与Rancher和K3s相结合，可在集群和应用部署级别提供真正的车队管理。</p><h1 id="1f05" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">架构和组件</h1><p id="70cf" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">车队由两个主要部分组成。车队控制器和集群代理。在Kubernetes集群上部署了一个fleet-controller以及所需的Fleet-CRD，用户可以从这里在组成fleet-agent的所有其他注册集群上操作部署(使用传统API或GitOps)。Fleet是轻量级的，足以在最小的部署上运行，甚至在只管理自身的单节点集群中也有优势。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/a6fe1844be50c8311f880e815a244edd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iowtFih77lSgBMIL"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主的舰队——建筑</figcaption></figure><h1 id="297c" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">车队经理/管理员:</h1><p id="283e" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">机群控制器是一组跟踪所有相关机群资源类型的<a class="ae la" href="https://kubernetes.io/docs/concepts/architecture/controller/" rel="noopener ugc nofollow" target="_blank"> Kubernetes控制器</a>，可以在任何标准Kubernetes集群上运行。车队管理器公开的唯一API是Kubernetes API，没有为车队控制器定制的API。车队管理员包括管理Kubernetes集群车队所需的CRD。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/453bdb985dd09cc5f5634fd97121ad26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*asNWKE1KMk_kfDoc"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队管理员——库伯内特斯·CRD</figcaption></figure><p id="e0c6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">资源类型:</strong></p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mj"><img src="../Images/c538891b048f93ee45feceda1ccdc766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5g6WKPAarB4um4DJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队控制器—资源类型</figcaption></figure><h1 id="886d" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">车队集群代理:</h1><p id="ce73" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">从车队控制器到成员集群的所有通信都是通过部署在相应集群上的车队代理进行的。每个集群中运行一个集群代理，负责与群控制器通信，所有群代理都应该能够访问群控制器(Kubernetes API)以获取和推送更新，所有受管集群都可以在专用网络(NAT后)中运行，因为群控制器不访问成员集群(只需要连接:代理— -&gt;控制器)。</p><h1 id="be56" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">聚类注册</h1><p id="b7c0" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">各个集群上的所有机群代理使用集群组令牌安全地注册到机群控制器，并且所有注册的集群拉和推期望的状态，将状态推回控制器。车队控制器动态创建服务帐户，管理它们的RBAC，然后将令牌分配给集群。必须生成集群组令牌才能将集群注册到群组控制器。默认情况下，此令牌将在1周后过期。TTL是可以改变的。生成的集群组令牌可以在注册新集群仍然有效时反复使用。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mk"><img src="../Images/c8455b1983838d4140f47a2362df797c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pWIdYXhIdv2vNcIc"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群注册</figcaption></figure><p id="b048" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">集群注册涉及多个控制器，为集群组创建集群组令牌，并且集群组(包含使用公共集群组令牌注册的集群组)可以包含具有不同标签的多个站点(标签可以用于特定于集群的选择)。通过在捆绑包中提供所需的配置，用户可以在ClusterGroup(在组中的所有单个集群上部署资源)或ClusterSelector(在组中的单个集群上部署资源)或两者上将集群作为部署资源的目标。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/3e6709832698ad620eb0b3ab2545b4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pq5tPxwbZ4y5-sOC"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-样本集群对象</figcaption></figure><p id="dd1d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">样本对象:</strong></p><p id="8304" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，为两个'<em class="ml">cluster group ' s '</em>edge-us-east和edge-us-west创建了两个'<em class="ml"> clustergrouptokens' </em>。每个集群组包括具有不同标签的两个单独的集群，这些集群使用各自的集群组令牌进行注册。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mm"><img src="../Images/1c68dba6148ee931e11cdaf11b3ca79a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Mhv5M5PrLjs_DAmy"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-样本集群对象</figcaption></figure><h1 id="91ee" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">束</h1><p id="94df" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">捆绑包是资源的集合，包括附加的特定于部署的信息，可以部署到多个集群。每个包都是一个定制资源，完全封装了所有的部署规范。Fleet使用捆绑包将磁盘上的捆绑包(一组文件)表示为一系列单独的文件，而不是管理一个嵌套了YAML文件的大型YAML文件，fleet apply将构建捆绑包资源并将其部署到fleet controller。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/02d16c3c50fffad8426322bcd60f94a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8JF6OmY7wB8neust"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队—捆绑规格</figcaption></figure><p id="6b6a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">捆绑包利用多种方式将YAML渲染到Kubernetes资源:基于Kubernetes YAML、Helm或Kustomize的方法，以及组合这三种方法的选择。</p><h1 id="9021" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">捆绑布局:</h1><p id="6857" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">捆绑包布局用于在磁盘上供舰队命令读取，也是捆绑包自定义资源中嵌入资源的预期结构。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/70bceb5ccfebf967ac9a922c32deb4f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4G2_0Q00HXVt_PZS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队—管束布局/组件</figcaption></figure><h1 id="2787" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">捆绑策略:</h1><p id="0fd8" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">用户可以选择使用普通Kubernetes YAML，头盔，Kustomize，或三者的组合。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/9fb7d17b1c256853b75342a1a511368d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cOhaF_qEkpWIPJtU"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队捆绑策略</figcaption></figure><p id="327b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kustomize与头盔和覆盖可以提供一个配置，可以跨地区分布，而不必改变标准/基本配置。将Kubernetes清单与Kustomize和Overlay相结合的典型示例如下所示:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/16469bcd0bfaf202fcef36727c50c324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SoG6ZtZFcf3s6r8L"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kustomize —示例配置</figcaption></figure><h1 id="9691" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">配置选项— bundle.yaml:</h1><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/eac4340c343e2f0b281cd4f7ae2238e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4OevLmrh0rInujmo"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队—捆绑包配置选项</figcaption></figure><h1 id="f112" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">集群目标匹配</h1><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/42b2902cece55113b88c0132deb57c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0eQbJhCcDL1UPWHL"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">舰队—集群目标配置选项</figcaption></figure><p id="9fb8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">相同名称空间中所有集群组中的所有集群都被认为是针对所有集群目标评估的。逐一评估目标列表，第一个匹配的目标将用于该集群的捆绑包。如果不匹配，该包将不会部署到集群。有三种匹配聚类的方法。可以使用集群选择器、集群组选择器或显式集群组名称。</p><h1 id="4c37" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">试用</h1><p id="7d4f" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">下面拓扑包含三个集群组，每个集群组有两个集群。集群组'<em class="ml"> edge-us-west' </em>和'<em class="ml"> edge-us-east </em>'包含两个运行k3的集群，每个集群在Vultr上跨区域的单个虚拟机上启动。集群组'<em class="ml"> edge-onprem-arm64' </em>包含两个在Raspberry Pi-4上运行K3s的集群，这是为了表明成员集群可以通过专用网络在NAT后运行。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/bc1b9884e361b70f53e8c125356881ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kHHpP2SgFWzBGoZ_"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队—测试拓扑</figcaption></figure><p id="dbaf" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">基于云的K3s集群:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/4de3b48fbb5850a36420ccfd3b64f01a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_7D6B9fk6umSfwT"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队—测试拓扑—基于云的集群</figcaption></figure><h1 id="a497" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用clusterGroupSelector部署软件包</h1><p id="8197" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">bundle配置中的'<em class="ml"> clusterGroupSelector </em>'允许用户根据集群组标签或集群组名称来匹配集群。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/842ac78cdecda8639d1c7a51a3efd9c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UXFFBym_GswAbmJX"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群组选择器规范</figcaption></figure><p id="65a5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用Helm和Kustomize(包括清单/模板中的YAML)的示例捆绑包配置如下所示，使用fleet部署，fleet使用标签和名称分别选择每个集群组。由于拓扑中的每个集群组都有两个集群，因此将跨所有集群创建6个pod，每个pod一个。如下所示，kustomize目录对每种集群类型都有单独的配置，其中添加了带有集群区域的名称前缀。Helm包含一个样本pod模板:“名称:应用程序pod”。bundle.yaml由目标部分中的匹配器组成，这些匹配器使用“cluster group selector”(metadata . labels . region)和“cluster group”(metadata . name)对集群组进行分组。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/b70ef94c7b656d79feb3e8f14d9d6855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x-7blWhEPb6Dlkru"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">机群—集群组选择器捆绑包配置</figcaption></figure><p id="5692" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，每个集群组都有一个唯一的名称和与之关联的标签(在本场景中为region)。最初，在部署以上捆绑包之前，机群显示了所有三个集群组，每个集群上有两个捆绑包(代理相关的控制平面)。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/563da7e8150dd8ba55c4037704b28425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CI2oDeFv2SAh80B9"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群组选择器</figcaption></figure><p id="5307" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">部署捆绑包“target-clustergroups”在所有集群上部署了该捆绑包。如下所示，一个捆绑包被添加到设备输出中的所有集群，“clusters-desired”显示所有6个集群都具有配置中提供的部署，“bundle-deployments”显示每个集群都有一个使用唯一名称(命名空间-集群组名称-集群-**)部署的捆绑包。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/c95737d4ca36ae963d73bf505c689d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tfD4UgCkrR6BrvOt"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群组选择器</figcaption></figure><p id="09ce" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，使用配置中的Helm图表将一个pod ( <region> -application-pod)部署到所有三个集群组(每个集群有2个集群)，并且所提供的Kustomize配置为每个pod添加了一个名称前缀。类似地，用户可以使用'<em class="ml"> clusterGroupSelector' </em>'来控制跨异构环境(边缘站点、云、专用网络中的设备等)的特定集群上的部署。)基于集群组标签和名称。</region></p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/6768846d62818ed4764c4e32b018bb0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qgcu0DDGZwXnteun"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Fleet- clusterGroupSelector示例部署</figcaption></figure><p id="38a4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">可以在目标配置中使用标志“clusterGroup: {}”来在向控制器注册的所有集群上部署应用程序。</p><h1 id="d565" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用clusterSelector部署包</h1><p id="261b" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">bundle配置中的'<em class="ml"> clusterSelector </em>'允许用户匹配集群组中的各个集群。此标志使用户能够使用集群注册期间提供的标签唯一匹配/定位分布在集群组中的各个集群。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/86ddaf3f887d08dfead1c3b2eeb51fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9UD5fKg4m-GCLNXK"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群组选择器规范</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/cf078d00b299bb7c9fc5a9838f5c4ac7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6SKndDIRqBLaWhFG"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队分类标签</figcaption></figure><p id="2cc0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用Helm和Kustomize(包括清单/模板中的YAML)的示例包配置如下所示，使用fleet部署，fleet使用标签分别选择集群组的每个集群部分。如下所示，kustomize目录对每种集群类型都有单独的配置，其中添加了带有集群区域的名称前缀。Helm包含一个样本pod模板:“名称:应用程序pod”。bundle.yaml由target部分中的匹配器组成，这些匹配器将使用标签的集群与使用“cluster selector”(metadata . labels . env)注册的集群关联起来。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/0125caf40bd48e443ea115c2caf4c098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CLH7SbxjjC1fOcNb"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">车队-集群选择器示例捆绑配置</figcaption></figure><p id="c8eb" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">部署捆绑包“target-clusters”将该捆绑包部署在三个不同集群组的三个集群部分上。如下所示，一个捆绑包仅添加到在目标配置中选择的三个集群中，“clusters-desired”显示6个集群中的3个具有配置中提供的部署，“bundle-deployments”显示三个集群具有使用唯一名称(命名空间-集群组名称-集群-**)部署的捆绑包。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/470a08927e8c586703b0bcb91b4b62d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WN9BkqgzUT2iZuP3"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">舰队集群选择器示例部署</figcaption></figure><p id="c3de" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，一个pod ( <region> -application-pod)部署在三个不同集群组的三个集群上。用户可以使用“集群选择器”来选择特定的/单个的集群来部署资源。</region></p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/28513700a4d00fc884f679d66ca0d5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lrle_sbFF_JAGIwJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">舰队集群选择器示例部署</figcaption></figure><p id="512f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">可以在目标配置中使用标志“clusterSelector: {}”来在向控制器注册的所有集群上部署应用程序。</p><h1 id="99e4" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">可视化—牧场主用户界面</h1><p id="c0c1" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">有了Rancher新的<a class="ae la" href="https://github.com/rancher/dashboard" rel="noopener ugc nofollow" target="_blank">仪表板UI </a>，用户可以导入车队控制器集群，仪表板从UI提供了成熟的车队对象可视化和编辑功能。除了设备级别的可视化，仪表盘还为用户提供了添加监控和日志记录的选项。K3s群集也可以导入，如下所示:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/cbdcd1bc9760508620964bc9207868db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2DgE8Y7eTWuZIFTb"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Rancher UI —导入的车队控制器集群和K3s集群</figcaption></figure><p id="d6ad" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">车队控制器集群:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/21786129cc45a392ed09fd1655a0bca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OzHERxyIWNT3f6NJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主用户界面—车队控制器集群</figcaption></figure><p id="a805" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为所有三个集群组生成的令牌:</p><p id="0d87" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">添加替代文本</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/117c320ba1a89bcdd616f0c83e6d4114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N_7Cpp9PT_HWfy7-"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主车队UI —集群组令牌</figcaption></figure><p id="7f58" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">三个集群组，每个组有两个集群，以及已部署的捆绑包的就绪/所需状态:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/7fd65425dde9265d55f57f7a7f011d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pqYYfmEHtvNelTAA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主车队UI-集群组</figcaption></figure><p id="c156" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">集群组式集群注册请求及其各自的标签:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/70f0958b2bf8929b63022df1f6b58031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nvjBiLfbX-xAUxIM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主车队UI —集群注册请求</figcaption></figure><p id="ce98" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在集群组下分组的各个集群以及在集群级别部署的捆绑包的就绪/所需状态:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/37958b702ee19833d936805f059bff87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dvxOecUn8rSzKpwy"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主车队UI —集群</figcaption></figure><p id="56c6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">已部署的捆绑包和可用性状态:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/22f6dbee0458444a3d60d998d06487f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mxBK-iSIPO3T2oPQ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场主车队UI —捆绑包</figcaption></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="b9d5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因为Fleet是作为标准的Kubernetes API实现的，所以它应该能够很好地集成到现有的生态系统中。随着多集群应用部署，可以容易地实施标准“每个集群必须安装X安全工具”或“特定集群组应该具有GDPR使能的服务”或“集群组中的特定集群应该具有唯一的应用”等。</p><p id="9f37" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">部署在机群控制器集群中的ArgoCD或Flux等工具可以将资源从Git复制到机群控制器，然后由机群控制器管理代理集群上的部署，从而实现一个成熟的应用部署管道，该管道可以覆盖数十到数千个集群。</p><p id="6444" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为每个存在点或每个监控摄像头运行Kubernetes集群的零售商，或在每辆联网汽车上运行集群的汽车公司，或在联网工业机器人、fleet以及Rancher和K3s上运行基于小尺寸ARM设备的集群的制造公司，都可以通过将集群管理提升到一个全新的水平，在边缘计算中发挥显著作用。</p></div></div>    
</body>
</html>