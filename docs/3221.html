<html>
<head>
<title>Laravel and Vue: Creating a Portfolio website with a CRUD admin panel — Chapter Four</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第四章</h1>
<blockquote>原文：<a href="https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-four-db24fed8db50?source=collection_archive---------3-----------------------#2019-10-28">https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-four-db24fed8db50?source=collection_archive---------3-----------------------#2019-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d818" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">更新报头并重构代码</h2></div><p id="48b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">总结:</strong>为了创建和显示概要文件，我们在create route上发布了一个表单。</p><p id="8e4e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">现在— : </strong></p><p id="dc61" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们能否创建一个更新表单并将其发布到更新路线？<strong class="kk iu">是的，但是……</strong></p><p id="668e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一定要吗？<strong class="kk iu">否</strong></p><p id="a3bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有一种更有效的方法来更新配置文件数据。我们可以保留和使用<strong class="kk iu">相同的表单</strong>用于创建和更新功能。我们必须改变控制器的功能。</p><p id="4949" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要在<strong class="kk iu">Api.php</strong>中更改post配置文件路由，以运行ProfileController的store()函数，而不是create()函数。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4599" class="ln lo it lj b gy lp lq l lr ls">R̶o̶u̶t̶e̶:̶:̶p̶o̶s̶t̶(̶'̶/̶p̶r̶o̶f̶i̶l̶e̶'̶,̶ ̶'̶P̶r̶o̶f̶i̶l̶e̶C̶o̶n̶t̶r̶o̶l̶l̶e̶r̶@̶c̶r̶e̶a̶t̶e̶'̶)̶;̶<br/>Route::<em class="lt">post</em>('/profile', 'ProfileController@<strong class="lj iu">store</strong>');</span></pre></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="42a8" class="mb lo it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">构建商店功能</h1><h2 id="f683" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated"><strong class="ak">我们想从商店得到什么()功能</strong>:</h2><ol class=""><li id="33c8" class="nd ne it kk b kl nf ko ng kr nh kv ni kz nj ld nk nl nm nn bi translated">检查一下我们的数据库中是否有数据。</li><li id="5ccd" class="nd ne it kk b kl no ko np kr nq kv nr kz ns ld nk nl nm nn bi translated">如果数据库中没有任何数据，请将表单数据输入到数据库中。</li><li id="4d2c" class="nd ne it kk b kl no ko np kr nq kv nr kz ns ld nk nl nm nn bi translated">如果我们已经有数据，改变数据库中的数据。</li></ol><h2 id="2fe3" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated"><strong class="ak"> 1。让我们检查是否有任何档案数据</strong></h2><p id="3932" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">这里我们必须收集一组数据。<code class="fe nw nx ny lj b">Profile::all()</code>从概要文件模型(App\Profile.php)中收集所有数据，您可以使用<code class="fe nw nx ny lj b"><strong class="kk iu">isEmpty()</strong></code>来检查这个数据集合是否为空。</p><p id="a8cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里需要的是<code class="fe nw nx ny lj b">Profile::all()-&gt;isEmpty()</code>；不过也可以把<strong class="kk iu"> Profile::all() </strong>缩写成<strong class="kk iu"> $profile </strong>然后用<code class="fe nw nx ny lj b"><strong class="kk iu">$profile-&gt;isEmpty()</strong></code>。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="2fe5" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    <strong class="lj iu">$profile = Profile::<em class="lt">all</em>();</strong><br/>    <em class="lt">if </em>(<strong class="lj iu">$profile-&gt;isEmpty()</strong>) {<br/>        return 'profile is empty';<br/>    } <em class="lt">else </em>{<br/>        return 'profile is not empty';<br/>    }<br/>}</span></pre><p id="d581" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">状态200 </strong> —如果您清空表格，发布到路线将会显示:</p><figure class="le lf lg lh gt oa gh gi paragraph-image"><div role="button" tabindex="0" class="ob oc di od bf oe"><div class="gh gi nz"><img src="../Images/1e60ce3a70302a4dd1af39b02a0ec7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALRWXV4CStsnHHz5IJUlsw.png"/></div></div></figure><p id="05b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">状态500 </strong> :—关于获取配置文件数据，如果您清空表格，您将没有任何数据可呈现，因此在网络选项卡中会出现500错误:</p><blockquote class="oh"><p id="f9b2" class="oi oj it bd ok ol om on oo op oq ld dk translated"><strong class="ak">消息:</strong> <strong class="ak">未定义的偏移量:0 </strong></p></blockquote><blockquote class="or os ot"><p id="4de8" class="ki kj lt kk b kl ou ju kn ko ov jx kq ow ox kt ku oy oz kx ky pa pb lb lc ld im bi translated">如果您访问api/profile路径，您会得到同样的错误。</p></blockquote><figure class="le lf lg lh gt oa gh gi paragraph-image"><div role="button" tabindex="0" class="ob oc di od bf oe"><div class="gh gi pc"><img src="../Images/2d5aaeff60603b4c9b986583450804e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2rp6wgngHlTaVP3YMlitYg.png"/></div></div></figure><p id="4e21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个错误是因为我们在配置文件表中没有任何数据，这意味着<code class="fe nw nx ny lj b">Profile::all()</code>将产生一个<strong class="kk iu">空数组</strong> []。</p><p id="c13f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而如果<code class="fe nw nx ny lj b">Profile::all()</code>会产生一个空数组，那么<strong class="kk iu">在</strong>T6肯定会没有数据</p><h2 id="725b" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated">2.如果数据库中没有任何数据，请将表单数据输入到数据库中。</h2><p id="f954" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">我们可以简单地从create函数中复制代码</p><figure class="le lf lg lh gt oa gh gi paragraph-image"><div role="button" tabindex="0" class="ob oc di od bf oe"><div class="gh gi pd"><img src="../Images/8944a821adb5066328c7375738661706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwCKxxtoS_xX0b7a0KBjbg.png"/></div></div></figure><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="f512" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <strong class="lj iu">$profile = <em class="lt">new </em>Profile();<br/>        $profile-&gt;name = request()-&gt;name;<br/>        $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>        $profile-&gt;save();<br/>        <em class="lt">return </em>request()-&gt;file('userpic')-&gt;store('/public/userpics');</strong><br/>    } <em class="lt">else </em>{<br/>        <em class="lt">return </em>'profile is not empty';<br/>    }<br/>}</span></pre><p id="e460" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然这可以工作，但是代码很难看。</p><figure class="le lf lg lh gt oa gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/b5634a279bb8edced20ae2bde7f99b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*-aZC2_BvcUT3Bbe3MamupQ.jpeg"/></div></figure><p id="c9b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你必须这样对待你的眼睛，你需要做一些叫做<strong class="kk iu">重构的事情。这会减轻你的眼疲劳。</strong></p><h2 id="fbe7" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated">重构</h2><p id="752d" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">重构就是当你改变代码<strong class="kk iu"> <em class="lt">的样子</em> </strong>但它有<strong class="kk iu">同样的效果</strong>。</p><p id="1c21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<code class="fe nw nx ny lj b"><strong class="kk iu">$this-&gt;create()</strong></code>运行create()函数</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="78f3" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <strong class="lj iu"><em class="lt">$this</em>-&gt;create();</strong><br/>    } <em class="lt">else </em>{<br/>        <em class="lt">return </em>'profile is not empty';<br/>    }<br/>}</span></pre><blockquote class="or os ot"><p id="2ff1" class="ki kj lt kk b kl km ju kn ko kp jx kq ow ks kt ku oy kw kx ky pa la lb lc ld im bi translated">代码解释:</p><p id="9980" class="ki kj lt kk b kl km ju kn ko kp jx kq ow ks kt ku oy kw kx ky pa la lb lc ld im bi translated"><code class="fe nw nx ny lj b">$this</code>指向同一控制器内的事物。</p><p id="ef48" class="ki kj lt kk b kl km ju kn ko kp jx kq ow ks kt ku oy kw kx ky pa la lb lc ld im bi translated"><code class="fe nw nx ny lj b">create()</code>是create函数(我们在第三章中创建了)。</p></blockquote><p id="da20" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果profile::all()中没有数据，store()函数将运行create()函数。</p><blockquote class="or os ot"><p id="708c" class="ki kj lt kk b kl km ju kn ko kp jx kq ow ks kt ku oy kw kx ky pa la lb lc ld im bi translated"><strong class="kk iu">测试:</strong>截断表格，填写名称字段，选择一个文件并单击提交按钮。如果您在network选项卡中看到200，则重构的store方法正在工作。</p></blockquote><h2 id="19f1" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated">3.如果我们已经有数据，改变数据库中的数据。</h2><p id="3710" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">指向else {}中的<strong class="kk iu"> update() </strong>函数</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="2ffe" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <em class="lt">$this</em>-&gt;create();<br/>    } <em class="lt">else </em>{<br/>        <strong class="lj iu"><em class="lt">$this</em>-&gt;update();</strong><br/>    }<br/>}</span></pre><p id="712b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用更新功能，我们只需重新发布表单并插入数据。</p><p id="8d18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我们只是简单地<strong class="kk iu">重新发布表单</strong>，我们可以使用与创建函数中的代码相同的代码来更新函数，只有一个<strong class="kk iu">异常</strong>。</p><p id="c4e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例外是create()代码以<code class="fe nw nx ny lj b">$profile = new Profile()</code>开始，而update()代码以<code class="fe nw nx ny lj b"><strong class="kk iu">Profile::findOrFail(1)</strong></code>开始</p><p id="45a4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nw nx ny lj b"><strong class="kk iu">findOrFail(1);</strong></code>查找id为1的数据库表记录。接下来的几行代码将把数据设置到那个特定的行。</p><p id="c07d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nw nx ny lj b"><strong class="kk iu">findOrFail(2);</strong></code>会查找id为2的数据库表记录，其他数字依此类推。</p><p id="0eb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望更改id为1的行，因为这是该行显示在网站上的数据。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="f87c" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>update(Request $request, $id)<br/>{<br/>    $profile = <strong class="lj iu">Profile::<em class="lt">findOrFail</em>(1);</strong><br/>    $profile-&gt;name = request()-&gt;name;<br/>    $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>    $profile-&gt;save();<br/>    <em class="lt">return </em>request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>}</span></pre><p id="709f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在发布表单将在网络选项卡中获得500状态，并显示以下消息:</p><blockquote class="oh"><p id="e49b" class="oi oj it bd ok ol om on oo op oq ld dk translated">消息:函数App \ Http \ Controllers \ profile controller::update()的参数太少，传入了0个…而实际应为2个</p></blockquote><p id="2029" class="pw-post-body-paragraph ki kj it kk b kl ou ju kn ko ov jx kq kr ox kt ku kv oz kx ky kz pb lb lc ld im bi translated">让我们检查一下函数的顶部🔎</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="6c27" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>update(<strong class="lj iu">Request $request, $id</strong>)</span></pre><p id="b906" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在()内，它表示<code class="fe nw nx ny lj b"><strong class="kk iu">Request $request, $id</strong></code>。</p><p id="dc75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是500条信息中提到的两个论点。</p><p id="ca26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">错误解释</strong>:如果一个函数在()括号中有$variables，那么当代码运行时，它将保存$variables/ <strong class="kk iu">参数</strong>。人工翻译:</p><p id="d251" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nw nx ny lj b">public function speak($aStick)</code>表示<strong class="kk iu">拿着棍子说话</strong></p><p id="b9e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是</p><p id="eb9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe nw nx ny lj b">public function speak()</code>只是表示<strong class="kk iu">说话</strong></p><p id="4d7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个人拿着棍子不能说话，除非有人递给他一根棍子。</p><p id="004d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就像这样，<code class="fe nw nx ny lj b"><strong class="kk iu">public function update(Request $request, $id)</strong></code> <em class="lt"> </em>不能工作，直到$request和$id被<strong class="kk iu">传递给</strong>它。</p><h2 id="e324" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated"><strong class="ak">传递参数</strong></h2><p id="1f5d" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">如果查看store()函数，可以看到它在持有$request的同时运行。因此，您只需通过在括号内编写$request将$request传递给更新函数</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="89df" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <em class="lt">$this</em>-&gt;create();<br/>    } <em class="lt">else </em>{<br/>        <em class="lt">$this</em>-&gt;update(<strong class="lj iu">$request</strong>);<br/>    }<br/>}</span></pre><p id="1dcc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您将获得一个带有类似消息的500状态。这条消息将会说</p><blockquote class="oh"><p id="d8da" class="oi oj it bd ok ol om on oo op oq ld dk translated">通过1个，预期正好2个</p></blockquote><p id="7dd6" class="pw-post-body-paragraph ki kj it kk b kl ou ju kn ko ov jx kq kr ox kt ku kv oz kx ky kz pb lb lc ld im bi translated">另一个参数是$id。我们可以简单地在<code class="fe nw nx ny lj b">else{}</code>中声明$id，就像这样:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="6dca" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <em class="lt">$this</em>-&gt;create();<br/>    } <em class="lt">else </em>{<br/>        <strong class="lj iu">$id = 1;</strong><br/>        <em class="lt">$this</em>-&gt;update($request, <strong class="lj iu">$id</strong>);<br/>    }<br/>}</span></pre><p id="cec4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">填写表格，点击提交，网络选项卡将显示状态200。</p><p id="6389" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">刷新页面，您将看到使用表单所做的更改。</p><p id="bea9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们当前重构的代码正在工作👍 😃这意味着我们的Store()函数正在工作👍 😄</p><p id="7b2f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然而，create()函数和update()函数的最后4行是相同的。如果这对你来说是个问题，你需要<strong class="kk iu">更多的重构</strong>。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h2 id="5cf4" class="ln lo it bd mc ms mt dn mg mu mv dp mk kr mw mx mm kv my mz mo kz na nb mq nc bi translated">更多重构</h2><p id="b68f" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">这两个函数的最后4行执行与<code class="fe nw nx ny lj b"><strong class="kk iu">$profile</strong></code>相同的<strong class="kk iu">操作</strong>，因此我们应该将这两个函数的<code class="fe nw nx ny lj b">$profile </code>传递给一个包含这四行的新函数。</p><p id="c945" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们创建一个名为insertData的函数，它接受$profile作为参数。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4544" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>create()<br/>{<br/>    $profile = <em class="lt">new </em>Profile();<br/>    <em class="lt">$this</em>-&gt;insertData($profile);<br/>}</span><span id="e365" class="ln lo it lj b gy pf lq l lr ls"><em class="lt">public function </em>update(Request $request, $id)<br/>{<br/>    <strong class="lj iu">$profile</strong> = Profile::<em class="lt">findOrFail</em>(1);<br/>    <em class="lt">$this</em>-&gt;insertData(<strong class="lj iu">$profile</strong>);<br/>}<br/><br/><em class="lt">public function </em><strong class="lj iu">insertData</strong>(<strong class="lj iu">$profile</strong>) {<br/>    $profile-&gt;name = request()-&gt;name;<br/>    $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>    $profile-&gt;save();<br/>    <em class="lt">return </em>request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>}</span></pre><p id="94ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以通过提交表单并重新加载页面来测试更新功能。</p><p id="abf6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以通过首先截断表，然后提交和重新加载来测试create()函数。</p><p id="1088" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当我们想要创建或更新时，我们总共使用了3个函数:</p><ul class=""><li id="f251" class="nd ne it kk b kl km ko kp kr pg kv ph kz pi ld pj nl nm nn bi translated">为了创建，我们必须通过store()，create()和insertData()</li><li id="a59a" class="nd ne it kk b kl no ko np kr nq kv nr kz ns ld pj nl nm nn bi translated">为了更新，我们必须通过store()，update()和insertData()</li></ul><p id="53df" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想消除中间人，你可以第三次重构。</p></div><div class="ab cl lu lv hx lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="im in io ip iq"><h1 id="a737" class="mb lo it bd mc md me mf mg mh mi mj mk jz ml ka mm kc mn kd mo kf mp kg mq mr bi translated">消除中间功能</h1><p id="659b" class="pw-post-body-paragraph ki kj it kk b kl nf ju kn ko ng jx kq kr nt kt ku kv nu kx ky kz nv lb lc ld im bi translated">如果您觉得中间函数太短，不值得存在，您可以删除调用这些函数运行的代码行，并简单地复制和粘贴内部代码，如下所示:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="cec8" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        $̶t̶h̶i̶s̶-̶&gt;̶c̶r̶e̶a̶t̶e̶(̶)̶;̶<br/>        <strong class="lj iu">$profile = <em class="lt">new </em>Profile();<br/>        <em class="lt">$this</em>-&gt;insertData($profile);</strong><br/>    } <em class="lt">else </em>{<br/>        $̶i̶d̶ ̶=̶ ̶1̶;̶<br/>        $̶t̶h̶i̶s̶-̶&gt;̶u̶p̶d̶a̶t̶e̶(̶$̶r̶e̶q̶u̶e̶s̶t̶,̶ ̶$̶i̶d̶)̶;̶<br/>        <strong class="lj iu">$profile = Profile::<em class="lt">findOrFail</em>(1);<br/>        <em class="lt">$this</em>-&gt;insertData($profile);</strong><br/>    }<br/>}</span></pre><p id="a6f9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不再需要create()和update()函数。</p><ul class=""><li id="cdf4" class="nd ne it kk b kl km ko kp kr pg kv ph kz pi ld pj nl nm nn bi translated">您可以在没有create()函数的情况下使用CRUD的create功能。</li></ul><p id="64fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">和</p><ul class=""><li id="5a3d" class="nd ne it kk b kl km ko kp kr pg kv ph kz pi ld pj nl nm nn bi translated">您可以在没有update()函数的情况下使用CRUD的更新功能。</li></ul><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="f8d8" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        $profile = <em class="lt">new </em>Profile();<br/>        <em class="lt">$this</em>-&gt;insertData($profile);<br/>    } <em class="lt">else </em>{<br/>        $profile = Profile::<em class="lt">findOrFail</em>(1);<br/>        <em class="lt">$this</em>-&gt;insertData($profile);<br/>    }<br/>}</span></pre><p id="0864" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在括号()中设置$变量的含义，这样就可以进行更多的重构:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="7805" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">public function </em>store(Request $request)<br/>{<br/>    $profile = Profile::<em class="lt">all</em>();<br/>    <em class="lt">if </em>($profile-&gt;isEmpty()) {<br/>        <strong class="lj iu"><em class="lt">$this</em>-&gt;insertData($profile = <em class="lt">new </em>Profile());</strong><br/>    } <em class="lt">else </em>{<br/>        <strong class="lj iu"><em class="lt">$this</em>-&gt;insertData($profile = Profile::<em class="lt">findOrFail</em>(1));</strong><br/>    }<br/>}</span></pre><blockquote class="or os ot"><p id="ebde" class="ki kj lt kk b kl km ju kn ko kp jx kq ow ks kt ku oy kw kx ky pa la lb lc ld im bi translated">记得在剪切和粘贴时去掉末尾的分号</p></blockquote><p id="585a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过所有这些重构，我们在store()函数中使用<code class="fe nw nx ny lj b">$profile</code>的次数从10次减少到了4次。</p><p id="3a2e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下一章，我们将会看到<strong class="kk iu">表单验证</strong>。</p><div class="pk pl gp gr pm pn"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-five-d4c6ceeff93c"><div class="po ab fo"><div class="pp ab pq cl cj pr"><h2 class="bd iu gy z fp ps fr fs pt fu fw is bi translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第五章</h2><div class="pu l"><h3 class="bd b gy z fp ps fr fs pt fu fw dk translated">Laravel表单验证、错误消息和处理成功</h3></div><div class="pv l"><p class="bd b dl z fp ps fr fs pt fu fw dk translated">itnext.io</p></div></div><div class="pw l"><div class="px l py pz qa pw qb of pn"/></div></div></a></div></div></div>    
</body>
</html>