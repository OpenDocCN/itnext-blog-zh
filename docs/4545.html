<html>
<head>
<title>Security Zones in OpenShift worker nodes — Part I — Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OpenShift工作节点中的安全区域—第一部分—简介</h1>
<blockquote>原文：<a href="https://itnext.io/security-zones-in-openshift-worker-nodes-part-i-introduction-4f85762962d7?source=collection_archive---------2-----------------------#2020-07-21">https://itnext.io/security-zones-in-openshift-worker-nodes-part-i-introduction-4f85762962d7?source=collection_archive---------2-----------------------#2020-07-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f2c3004f4e383bf7c062e83c8c8a92b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YRyNkeWj2JBFiDiW"/></div></div></figure><p id="fcb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个系列文章中，您将看到如何将OpenShift工作人员分成多个安全区域。</p><p id="634c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不想这篇文章成为“快速指南”。我会解释很多细节，选项，解释，技巧和窍门，最坏的情况，警告，测试，第二天的操作等等…这就是为什么它这么长…</p><p id="02d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这本书更适合那些以在worker节点中创建安全区域为借口，想要了解更多关于Kubernetes/OpenShift基础设施的人，而不是那些想要快速查看如何执行实际配置的人。<a class="ae kw" href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-iv-user-restrictions-and-recap-5ec0ba7bdaf9" rel="noopener">如果你属于第二组，请直接进入文章的最后部分，我将在那里总结配置过程中完成的步骤。</a></p><p id="ac47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要知道一些OpenShift/Kubernetes的基本概念，但我会尽可能地涵盖更多内容，而不是写一本完整的书来解释一切。</p><p id="d9bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，如果您认为使用多个OpenShift集群来覆盖此用例比使用单个大型OpenShift集群更容易、更干净，我不会不同意，但这取决于您的具体情况，因为多个OpenShift集群意味着您需要考虑多个API和应用入口点，以及更多的控制平面节点，管理和配置成倍增加，但老实说，由于有了像<a class="ae kw" href="https://www.redhat.com/en/technologies/management/advanced-cluster-management" rel="noopener ugc nofollow" target="_blank">高级集群管理</a>这样的产品，最后一部分越来越不是问题。正如我告诉你的，这将取决于你和你的需求，但是对于这篇文章，这个主题更多的是解释一些基础设施概念的借口，而不是推荐的架构。</p><p id="e76c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到主题，为什么在你的工人中设置安全区域是有用的？因为您可以涵盖一些用例，例如:</p><ul class=""><li id="18c8" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">创建一个安全区域，您可以在其中运行最明智的应用程序，并且只有一部分用户可以部署工作负载</li></ul><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="b512" class="lp lq iq ll b gy lr ls l lt lu">Workloads:      Trusted<br/>OCP Users:      Trusted<br/>Management:     Restricted to some users/projects</span></pre><ul class=""><li id="6779" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">创建一个DMZ，用于放置面向用户的应用程序，这些应用程序更容易受到外部入侵的攻击，并且只有一部分用户可以创建资源</li></ul><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="67db" class="lp lq iq ll b gy lr ls l lt lu">Workloads:      Untrusted (they can be compromised)<br/>OCP Users:      Trusted<br/>Management:     Restricted to some users/projects</span></pre><ul class=""><li id="7b02" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">创建一个区域，在该区域中强制运行来自集群中不可信(或不太可信)用户的应用程序。这些用户将无法访问或使用其他区域中的资源。</li></ul><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="a739" class="lp lq iq ll b gy lr ls l lt lu">Workloads:      Untrusted (they can be compromised)<br/>OCP Users:      Untrusted<br/>Management:     Enforced (users only have access to those resources)</span></pre><blockquote class="lv lw lx"><p id="c31f" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">这种方法使用单个OpenShift集群，因此所有pod都连接到同一个SDN，即使我们包括“安全区域”。我们可以使用网络策略阻止SDN内部的连接，但这些策略在第3/4层工作，因此，如果您需要完全隔离，您将需要部署单独的OpenShift集群。</p></blockquote><p id="eb55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将重点关注第一个用例(创建一个安全区域)，但我会对您尝试创建DMZ(与安全区域相反)时的差异进行一些评论。</p><p id="6ac1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何定义一个安全区域？我们需要:</p><ol class=""><li id="85eb" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv mc ld le lf bi translated">为新区域创建一组节点</li><li id="ea6d" class="kx ky iq ka b kb md kf me kj mf kn mg kr mh kv mc ld le lf bi translated">为区域配置特定的网络规则</li><li id="ff4e" class="kx ky iq ka b kb md kf me kj mf kn mg kr mh kv mc ld le lf bi translated">在新区域上配置使用限制</li></ol><p id="d9bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每篇文章都将涵盖上述观点中的一个，在最后一篇文章中，我将包括所有内容的回顾。如果你想直接跳到任何一篇文章:</p><div class="mi mj gp gr mk ml"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-ii-grouping-workers-8e97f1d601ba" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">OpenShift工人节点中的安全区域—第二部分—工人分组</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">这是本系列的第二部分，我们将配置两组不同的工作人员。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz jw ml"/></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-iii-network-configuration-3a887854a4d" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">OpenShift工作节点中的安全区域—第三部分—网络配置</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">在本帖中，我们将重点讨论在我们的安全系统中分离入站和出站流量所需的网络配置…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="na l mw mx my mu mz jw ml"/></div></div></a></div><div class="mi mj gp gr mk ml"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-iv-user-restrictions-and-recap-5ec0ba7bdaf9" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">OpenShift工作节点中的安全区域—第四部分—用户限制和概述</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">这是关于如何在你的OpenShift workers中配置安全区域的最后一篇文章。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="nb l mw mx my mu mz jw ml"/></div></div></a></div><p id="7ccb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为我们目标的总结，我们希望:</p><ul class=""><li id="a352" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">拥有两组工作人员，一组用于“常规应用程序”，另一组用于“安全应用程序”</li><li id="b0e8" class="kx ky iq ka b kb md kf me kj mf kn mg kr mh kv lc ld le lf bi translated">要有两组用户，一组可以根据需要在安全区域部署工作负载，而另一组在任何情况下都不允许。</li><li id="f2ce" class="kx ky iq ka b kb md kf me kj mf kn mg kr mh kv lc ld le lf bi translated">在区域之间分割网络流量，包括入口和出口。</li><li id="080e" class="kx ky iq ka b kb md kf me kj mf kn mg kr mh kv lc ld le lf bi translated">防止常规区域中的应用程序与安全区域中的应用程序进行交互(如果群集管理员没有明确允许)。</li></ul><h1 id="38d9" class="nc lq iq bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated">我们从哪里开始，向哪里去？</h1><p id="0feb" class="pw-post-body-paragraph jy jz iq ka b kb nz kd ke kf oa kh ki kj ob kl km kn oc kp kq kr od kt ku kv ij bi translated">在默认设置中，我们有如下所示的OpenShift架构，其中我们使用负载平衡器来访问OpenShift API和工作节点上运行的工作负载，并且应用出口流量默认使用工作接口IP来访问外部系统(但是<a class="ae kw" href="https://docs.openshift.com/container-platform/4.5/networking/openshift_sdn/assigning-egress-ips.html" rel="noopener ugc nofollow" target="_blank">您可以将IP池分配给某些项目</a>)。</p><p id="aed9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还可以将一些VLANs直接连接到我们的工作人员<a class="ae kw" href="https://www.openshift.com/blog/demystifying-multus" rel="noopener ugc nofollow" target="_blank">以供PODs(使用Multus) </a>使用，例如，如果我们有隔离的网络(未连接到任何路由器),其服务必须由我们的应用程序访问，或者如果我们需要使用不同于HTTP/HTTPS的协议，并且我们不想/可以使用Kubernetes服务类型，如NodePort、ExternalIP、LoadBalancer等，或者即使我们希望提高网络性能，这也是有用的。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/e1f89221ff70f68f5dd6558d35f787d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*GgmFoMNrBo6MwLhrk0Q4Og.png"/></div></figure><p id="754b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，本帖中我们的安全区域配置的想法将类似于下面的架构(这不是一个首选架构，它只是我在创建工作者组时用来展示OpenShift功能的一个示例)，其中我们添加工作者节点，连接到不同的网络，但我们将添加阻止用户和工作负载在其上运行的配置。</p><p id="8fd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想要配置DMZ而不是安全区域，设置将是相同的，但是如果您想要将不受信任的用户限制在节点的子集内，我将包括一些更改(不同之处在于，在DMZ设置中，我们信任Openshift用户，但是我们担心那里的工作负载受到损害)。</p><p id="e6b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，在不可信用户的情况下，我将尽可能地保护API和“常规区域”应用程序，在访问前放置L7防火墙或代理，阻止那些不可信用户真正需要的URL(即OpenShift APIs和web控制台)。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/de94912dfe42ff5a224722a2bc2b96ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BoBba9RZvIoduN9nsiqaog.png"/></div></div></figure><p id="6c97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以向默认架构添加一些额外的配置，通过为基础架构添加<a class="ae kw" href="https://access.redhat.com/solutions/5034771" rel="noopener ugc nofollow" target="_blank">个专用节点、添加一个新的接入网络以及为节点使用不同的L3网络来稍微改善组件之间的隔离(如下所示)</a></p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/2c45fd44197c130475d2b4a21fed9d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUVpnw7EWfRVEARgu7D44w.png"/></div></div></figure><p id="97ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们将这些概念应用到我们的安全区域架构中，我们可以添加一个工作人员子集，在其中添加一个作为访问网络连接的额外NIC，并强制运行我们的专用安全区域路由器。</p><p id="774d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一次，我们没有将节点专用于“基础架构”(不允许其他类型的应用程序在其上运行)，因为位于这些基础架构节点上的唯一工作负载是路由器/入口。我们将在这里创建两组工作人员，一组有接入网络，另一组没有接入网络(这可以被视为更加“安全”)，但他们都将能够托管工作负载，尽管首选的是没有外部访问的节点(如果它们有运行应用程序的空间)。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/31c2a4911c8ed242012e0dd852dde8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQlR8BXVZJd4BTKhiys4dA.png"/></div></div></figure><blockquote class="lv lw lx"><p id="bee1" class="jy jz ly ka b kb kc kd ke kf kg kh ki lz kk kl km ma ko kp kq mb ks kt ku kv ij bi translated">同样，这是一个架构示例，用于展示OpenShift/Kubernetes创建不同工作节点组的能力，而不是用于创建安全区域的OpenShift参考架构，因为设计将取决于多种因素，包括用例、拓扑限制、内部安全策略等。</p></blockquote><p id="df9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">这些帖子中使用的实验室设置</strong></p><p id="1fb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我试图尽可能地接近上面显示的架构。</p><p id="5016" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的实验室中，我部署了3个主节点、2个普通工作节点(没有基础节点)、2个安全工作节点+访问节点和1个安全工作节点。</p><p id="9360" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我使用我的<a class="ae kw" href="https://github.com/luisarizmendi/ocp-kvm-bm-upi" rel="noopener ugc nofollow" target="_blank"> ansible行动手册进行安装，这些行动手册“模拟”了虚拟机</a>上的裸机UPI安装，但我手动进行了一些更改，以获得类似于上图所示的拓扑。</p><p id="ded2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在常规区域中，节点连接了两个网络:OpenShift SDN网络和用于Multus的VLAN。在新的安全区域中，节点具有用于OpenShift SDN的不同网络和不同的Multus网络(在这种情况下是隔离的，这意味着无法使用任何路由器到达该网络。我这样做是为了模拟一个孤立的网络，在这个网络中，人们过去常常包括安全的后端。安全区域中用于接入的节点具有额外的网络来充当接入网络。</p><p id="6ce9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个帖子系列中，我们不会讨论防火墙配置、路由和其他网络方面，因为我想展示的是如何从OpenShift的角度配置架构，所以我配置了从我的路由器(我的KVM主机)到所有网络的直接连接，没有安全规则。</p><p id="87f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">DNS已配置为使用默认入口路由(在常规区域中)和新入口路由(将位于安全区域入口的access+worker节点中)来访问该区域上的应用程序。配置了两个不同的负载平衡器，一个用于常规和API访问，另一个用于安全应用程序。</p><h1 id="66c7" class="nc lq iq bd nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw nx ny bi translated"><strong class="ak">你准备好了吗？</strong></h1><p id="2f3f" class="pw-post-body-paragraph jy jz iq ka b kb nz kd ke kf oa kh ki kj ob kl km kn oc kp kq kr od kt ku kv ij bi translated">如果您准备好了，让我们从配置中的第一点开始，创建两组工作人员，让用户在部署他们的工作负载时选择一个或另一个</p><div class="mi mj gp gr mk ml"><a href="https://medium.com/@luis.ariz/security-zones-in-openshift-worker-nodes-part-ii-grouping-workers-8e97f1d601ba" rel="noopener follow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd ir gy z fp mq fr fs mr fu fw ip bi translated">OpenShift工人节点中的安全区域—第二部分—工人分组</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">这是本系列的第二部分，我们将配置两组不同的工作人员。</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">medium.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz jw ml"/></div></div></a></div></div></div>    
</body>
</html>