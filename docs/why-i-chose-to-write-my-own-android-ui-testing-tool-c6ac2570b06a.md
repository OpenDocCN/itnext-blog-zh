# 为什么我选择编写自己的 Android UI 测试工具

> 原文：<https://itnext.io/why-i-chose-to-write-my-own-android-ui-testing-tool-c6ac2570b06a?source=collection_archive---------2----------------------->

![](img/9e49a890d4ce5ce7d54fa021c9fd221d.png)

在 2018 年底，我再次与破碎的浓缩咖啡测试做斗争。挫败感占据了我，我意识到我与测试、测试自动化和测试框架的关系一直不好。

现在，两年过去了，我几乎全职处理最不喜欢的软件开发话题。为什么？因为我决定自己写一个 Android 测试工具。

# 我不喜欢传统测试自动化的地方

不要误解我，我不想提出“你做错了”的论点。[工具](http://appium.io/) [out](http://robolectric.org/) [there](https://site.mockito.org/) 是我们目前拥有的最好的工具，它们对我们很多人来说都非常好用。但是我并不是唯一一个对测试自动化现状感到沮丧的人。在我为许多机构和创业公司做 Android 自由职业者的 8 年里，我发现一个**“移动测试自动化没有回报”的态度是相当标准的**。

## Android 测试困难的 10 个原因:

1.  **测试自动化的设置并不简单。**对于一个非常基础的应用程序来说，可能是这样。但通常情况并非如此([空闲资源](https://www.repeato.app/espresso-wait-for-netowork-call/)、 [Dagger2、Retrofit2、RxJava2 和 MockWebServer](https://android.jlelse.eu/instrumentation-testing-with-dagger2-retrofit2-mockwebserver-android-4cca7cb7373c) ←这篇文章写得非常好，它的长度告诉了你很多关于设置的复杂性)
2.  如果不马上修复，修复测试是很难的。我经常发现一个失败的测试为时已晚→费力寻找问题。因此，需要一个过程来确保测试的定期执行
3.  通常对以上观点的回答是:“**持续集成**”。如果你试图在你自己的服务器上设置 CI、模拟器、测试自动化、通知和报告，你就会知道:这并不容易。这是一项巨大的投资
4.  测试很容易出错，而且经常出错。随着更短的发布周期和不断的设计调整，软件产品一直在变化→持续的努力来维护测试。对于每隔一周就进行一次转型的早期创业公司来说，这一点尤其正确
5.  **id 是唯一的对吗？** Turn's out 他们往往不是→破测试
6.  尽管**id 不应该改变**，但它们经常会改变→失败的测试
7.  编写测试时查找 id 可能**非常耗时**。
    特别是当你没有开发自己的应用程序，你不知道你的应用程序的布局文件
8.  当测试中断时，找出问题所在通常非常耗时。通常你得到的只是一堆东西
9.  **有些东西几乎不可能测试**:导航或小部件以不同的方式呈现
    (c++内容、3D 内容、Webview、动画、地图等等)
10.  第三次重写一个测试是非常乏味的

“测试自动化过敏”——对软件开发人员来说，这是迄今为止最危险的过敏

## 测试自动化框架是愚蠢的

大胆的声明对不对？我知道在 Appium 的 [7200 次提交中体现了很多脑力。然而:需要进行大量的开发来提供一个基本的测试基础(比如与测试主体进行交流的方法以及不同平台的](https://github.com/appium/appium)[细节](https://github.com/appium/appium-espresso-driver/blob/master/lib/commands/idling-resources.js))。
所以我想说的是:框架的实现可能很复杂，但本质上大多数测试框架的原则仍然是这样的:

1.  通过单个“不变属性”(如 ID)查找元素
2.  与元素互动
3.  查找其他元素
4.  检查该元素的属性 x 是否如您所期望的那样

因此，我们开发人员仍有许多智能工作要做。比如:

*   模仿对象(这需要智能布局的软件架构)
*   同步进程，如后台任务或网络请求
*   将测试执行集成到 CI 中，[通过 API](https://plugins.jenkins.io/slack/)等报告测试结果
*   修复 ID 查找等(见上文)

# 现状

在我看来，软件测试的**现状是:**

1.  测试创建是复杂的(需要高技能的人)💰
2.  测试维护非常耗时💰
3.  设置测试自动化过程既耗时又复杂💰

结果是，许多**机构**(尤其是那些构建较小应用的机构)和**初创公司**(尤其是那些仍在大量转向的公司)**倾向于手动测试。**

# 为什么手工软件测试仍然是一个好的选择

1.  一个**流程**很容易建立，并且有一个人负责执行该流程👍
2.  负责人可以使用**基本工具**如电子表格👍
3.  这个人甚至不需要有 IT 知识👍
4.  **测试结果可信度高**:无嘲讽、无剥落、无测试环境。所见即所得👍

**那么手工测试是正确的方式吗？**当然不是。我已经见过很多次了:功能每天都在增加，测试成为软件开发工作流程的瓶颈只是时间问题。

# 单元测试呢？

我上面写的大部分都和 **Android UI 测试**有关。但是很多也适用于单元测试。它很复杂(架构，需要训练有素的人员)，测试更容易出错，测试结果的可信度比 UI 测试低。我不反对单元测试。这是必要的，你可能知道它不能代替 UI 测试。
为了完整起见，我想加入这条推文:

# 我们能够构建更智能的 ANDROID UI 测试工具吗？

早在 2018 年，我就在想:如果一个随机的学生甚至可以在*不知道*[*kotlin*](https://kotlinlang.org/)*，*一个单词的情况下测试我们的应用程序，为什么没有这样的软件呢？我的意思是，我们即将拥有自动驾驶汽车和无人驾驶飞机，对吗？

所以我坐下来，试着想象一个软件测试人员的认知工作:

1.  对智能手机用户界面(屏幕、过渡、列表、历史回顾)有一些基本的了解
2.  对他们正在测试的应用类型有一些基本的了解
3.  对要检查的东西有一些说明(用例)
4.  了解应用程序应该如何理想地工作
5.  如果应用程序没有显示预期的行为，知道如何制作截图和报告

听起来很简单，对吧？至少我当时是这么想的。我甚至没有检查现有的 AI 测试框架(如果你感兴趣，这里有[一篇关于 AI 测试的好文章](https://medium.com/@foohm71/the-case-for-ai-in-software-testing-5aba64e62d0f))。

所以我想如果没有我的天真，我不会开始这个项目。不过，还有一个激励因素:在我写第一行代码之前，我在维也纳安排了 10 次与不同移动应用代理和初创公司的会议。我问他们关于测试自动化的体验，以及他们是否感受到同样的痛苦。我从那些采访中得到的结果非常有说服力。

所以现在我已经花了大约 18 个月的时间来开发 Android UI 测试工具，它叫做 [Repeato](https://www.repeato.app/) 。

Repeato 试图像人类一样操作:它看着你的设备屏幕，试图识别视觉元素，在执行下一步之前等待过渡动画完成，就像普通用户
会做的一样。而且它不关心你的 IDs 或者正在使用的框架。

该软件的许多人工智能部分仍在开发中，但 Repeato 已经被快乐的客户🥳卓有成效地使用

我计划写另一篇文章，给那些对实现的技术方面感兴趣的人。

感谢阅读！

*原载于 2020 年 9 月 16 日*[*https://www . repeato . app*](https://www.repeato.app/write-android-ui-testing-tool/)*。*