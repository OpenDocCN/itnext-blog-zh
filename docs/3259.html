<html>
<head>
<title>Simplifying Microservices on Kubernetes with Microsoft’s Dapr (Distributed Application Runtime)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用微软的Dapr(分布式应用运行时)简化Kubernetes上的微服务</h1>
<blockquote>原文：<a href="https://itnext.io/simplifying-microservices-on-kubernetes-with-microsofts-dapr-distributed-application-runtime-9aece5723484?source=collection_archive---------0-----------------------#2019-11-07">https://itnext.io/simplifying-microservices-on-kubernetes-with-microsofts-dapr-distributed-application-runtime-9aece5723484?source=collection_archive---------0-----------------------#2019-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7338828d79502a956820a34dd6f217b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8SYa_g4PD8jakYh9sJB9Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用于在云和边缘上构建微服务应用的开源运行时</figcaption></figure><div class=""/><p id="2b4b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如今，Kubernetes和微服务几乎是同义词，微服务将应用程序的功能分成可独立部署的块。开发人员在为边缘或云开发微服务时经常遇到的大多数问题都围绕着事件驱动的需求。他们需要管理诸如事件和响应触发器之类的事情，这需要应用程序代码之外的额外逻辑。多个微服务之间的通信目前要求使用gRPC、API、pub/sub等。此外，开发人员还必须进行“服务发现”和“状态管理”。这两个实例涉及几个参数。此外，根据它是无状态还是有状态应用程序，开发人员必须使用不同的SDK和编程模型。</p><p id="d499" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr (分布式应用程序运行时)使用一个side-car模式，类似于服务网格架构中的side-car实现，其中本地代理用于路由请求。Dapr中的Side-cars用于在运行时与编译时集成微服务构建模块。Dapr将其API公开为sidecar架构，作为容器或进程，不需要应用程序代码包含任何Dapr运行时代码。这带来了Dapr与通过标准HTTP/gRPC接口操作的现有和遗留代码集成的优势。这有助于企业开发人员体验微服务开发的好处，而不必重写他们的应用程序。</p><p id="e49c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr的一个关键特性是它完全不受平台和语言的限制，这意味着它可以在任何平台、任何Kubernetes部署、云中或内部甚至任何物联网设备上运行。</p><p id="2b96" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr为<a class="ae la" href="https://github.com/dapr/go-sdk" rel="noopener ugc nofollow" target="_blank"> Go </a>、<a class="ae la" href="https://github.com/dapr/java-sdk" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae la" href="https://github.com/dapr/js-sdk" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>、<a class="ae la" href="https://github.com/dapr/dotnet-sdk" rel="noopener ugc nofollow" target="_blank">提供语言特定的SDK。NET </a>和<a class="ae la" href="https://github.com/dapr/python-sdk" rel="noopener ugc nofollow" target="_blank"> Python </a>。开发人员可以通过类型化的语言API来公开Dapr构建块中的众多功能，如保存状态、发布事件或创建参与者，而不是为每个服务实现http/gRPC API，这有助于开发人员使用他们选择的语言开发无状态&amp;有状态函数和参与者的组合。</p><h1 id="bf2f" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Dapr — Kubernetes</h1><p id="658d" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Dapr控制平面组件部署为Kubernetes部署。可以使用Dapr-CLI在Kubernetes集群上轻松初始化Dapr，也可以使用Helm进行部署。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div class="gh gi me"><img src="../Images/d2fa0e475f3347cda6469882f1bb7b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/0*N3VEdl2eKFeoWy3B"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr——Kubernetes上的组件</figcaption></figure><p id="2f2a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr控制平面由三部分组成。<em class="mj"> dapr-sidecar-injector </em>和<em class="mj"> dapr-operator </em>服务提供一流的集成，在与服务相同的pod中将dapr作为sidecar容器启动，并提供dapr组件更新的通知。</p><ul class=""><li id="b7c3" class="mk ml jf ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">dapr-operator:监视来自kube-apiserver的服务(kubernetes pods)的创建、删除和更新事件，并带有注释“dapr.io/enabled: true”。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/86ed96e2a6e6c32ef620c8e02095de21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xip8usOHy6UXevzr"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr-运营商— Kubernetes</figcaption></figure><ul class=""><li id="fddb" class="mk ml jf ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">dapr-sidecar-injector:用注释“dapr.io/enabled: true”将Dapr sidecar注入到所有服务中。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/f74ef8e648100267e6f630a997e5ca84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qaFESUAyG-OMDadx"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr-边车注射器Kubernetes</figcaption></figure><ul class=""><li id="1163" class="mk ml jf ke b kf kg kj kk kn mm kr mn kv mo kz mp mq mr ms bi translated">dapr-placement:连接所有注入到Kubernetes pods的dapr边车，并添加IP地址来路由通信。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/a827ba06379cd4c8a05697268ba81a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qPpMBuV2O8zOouMI"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr-安置Kubernetes</figcaption></figure><p id="a9e1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr使用许多不同的州存储Redis、CosmosDB、DynamoDB、Cassandra等提供站点管理。保持和检索状态。状态存储是可插拔的，可以包括Redis、Azure Cosmos等。在上面的部署中，具有持久卷的Redis被用作状态存储。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/c969070b7c1c7448800586cd3592fc1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gVBPgPfiWMwxWnvz"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Redis —国营商店— Dapr</figcaption></figure><h1 id="7632" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Dapr —概念</h1><p id="8809" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated"><a class="ae la" href="https://github.com/dapr/docs/tree/master/concepts" rel="noopener ugc nofollow" target="_blank"> Dapr概念</a></p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/fb797787b0d809e0395b1022c8f0cafc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c-LokAsPwXBlWIrZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —概念</figcaption></figure><h1 id="c592" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Dapr —规格</h1><h1 id="3865" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">服务调用</h1><p id="4804" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">使用户能够使用唯一的id调用其他应用程序。通过命名标识符促进应用程序之间的交互，并将服务发现的负担放在Dapr运行时上。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/9e46f569771f82fbe7341eb4908db3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qwIDAkxNf4QqSV-u"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —服务调用</figcaption></figure><h1 id="f248" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">粘合剂</h1><p id="fa84" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">促进应用程序的双向绑定功能，以便与不同的云/本地服务或系统进行交互。开发人员可以使用Dapr API调用输出绑定，并让Dapr运行时用输入绑定触发应用程序。</p><p id="a4bc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输入绑定:</p><p id="260d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当来自外部/其他资源的事件发生时触发应用程序。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/a27cb95fe5e654cba003801de531953f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kko26uF9l7BHC1Dh"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —输入绑定</figcaption></figure><p id="03b0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">输出绑定:</p><p id="cd02" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">调用外部资源。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/ea407c1684a197442777513f412c19f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oP5ru5sqEsKEcb9y"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —输出绑定</figcaption></figure><h1 id="7e39" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">公共订阅和广播</h1><p id="29be" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">便于将有效负载发布给正在收听某个主题的多个消费者。Dapr保证这个端点至少有一次语义。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/557db8f8efa9300d8ad94067867d50a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UEMUi95O2IJWuVxD"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —发布订阅</figcaption></figure><h1 id="9ac0" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">状态管理</h1><p id="eed8" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">允许开发人员通过API保存和检索状态。Dapr有一个可插拔的架构，允许绑定到大量的云/本地状态存储。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/673c7bbfef22a878fd9be4fa7f2edba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YcuBoJLu_KXpt_pI"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —现场管理</figcaption></figure><h1 id="5c4a" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">演员</h1><p id="5197" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Dapr具有原生、跨平台和跨语言的虚拟演员能力。除了特定于语言的Dapr SDKs，开发人员还可以使用下面的API端点来调用actor。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/c60514587cb2ca50257ee2db2116252b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xSHBAFRBJwLSIj9l"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —演员</figcaption></figure><h1 id="1643" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">试验</h1><p id="0d2b" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">从Dapr示例中选取一个示例计算器应用程序。这里的计算器应用程序是一个多语言程序，其中每个操作——加法、减法、乘法和除法使用不同的编程语言——Go Mux、Python Flask、Node Express。Net核心，并作为单独的微服务部署在Kubernetes上，一起用于一个更大的计算器应用程序。用React编写的带有服务器和客户端的前端应用程序使用Dapr调用每个服务。每个Kubernetes pod/应用程序/服务由两个容器组成:一个应用程序容器和一个Dapr sidecar容器。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/2d3ff3a11fd26773420e2c4b9f183645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XFJwSrd3cjZRzsdY"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —示例计算器应用程序</figcaption></figure><p id="5d05" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，每个微服务都服务于不同的操作。redis集群用于管理应用程序的状态。</p><h1 id="21ae" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">应用代码</h1><p id="8153" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">如下所示，每个应用程序都是用不同的语言/框架编写的。该逻辑只涉及一个服务端点，没有任何依赖代码，以便与其他应用程序或Dapr一起工作。更简单地说，每个微服务逻辑没有额外的代码来通过RPC或API与其他逻辑进行通信。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/754ba9e5d4c84820a7aea476cede1af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UL0WxMHbFsgW3NSS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —计算器应用</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/ef5c4d1e95d3296e55ecddb9f7f2c0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5izI5TLpLinh5jsJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —计算器应用</figcaption></figure><p id="48a8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">基于React的前端充当所有其他应用程序的前端服务器和客户端，如下所示。Routes ('calculate/add '，'/calculate/subtract '，'/calculate/divide '，'/calculate/multiply ')将来自React客户端的请求转发到所有启用了dapr的服务(启用Dapr将在下一节介绍)。</p><p id="c9d1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr sidecar服务于本地主机:<daprport>。所有Dapr服务都是通过调用:</daprport></p><pre class="mf mg mh mi gt nb nc nd ne aw nf bi"><span id="42f9" class="ng lc jf nc b gy nh ni l nj nk">/v1.0/invoke/&lt;DAPR_ID&gt;/method/&lt;SERVICE'S_ROUTE&gt;</span></pre><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/248c6bcb1225413362be5b7a12ba6ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fv_3ow90kDr4t3o7"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —计算器—反应前端</figcaption></figure><h1 id="553f" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Kubernetes部署—计算器应用程序</h1><p id="fb33" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">上面提到的每个应用程序都被部署为一个Kubernetes pod(技术上来说是一个微服务),带有特定的Dapr注释，如下所示:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/394d6e9e20828e2b4e7489d41f9a5c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U0WvAZNu-6JaTe8m"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr — Kubernetes计算器应用</figcaption></figure><p id="8b45" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当上述应用程序部署在Kubernetes上时，监听来自Kube-API服务器的事件的Dapr-Operator获得关于启用Dapr的应用程序的更新，并且Dapr-Sidecar-Injector将一个Dapr sidecar容器注入到带有注释“dapr.io/enabled: true”的所有pod中。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/0ab488104eb1a268483f0b59b35843c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1WLuXAGq8Jj47nBm"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —计算器Kubernetes部署</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/33e01c53946aa132f08a744963660bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PhBTcvGnyNM4lXN4"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —操作员</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/8aecb6cc5aceb57c805e1db130d069de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lw2JbUObhUYHquKM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —边车注射器</figcaption></figure><p id="24a9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下图所示，上面部署的所有Kubernetes pods包括两个容器“app”和“daprd”。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/ae87dbaed4f167b2653b6d8b0eab1514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*05iM9TX4ohJ4LFfL"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Daprd — Kubernetes应用程序</figcaption></figure><p id="5429" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有应用程序单元都有一个到redis-master和dapr-placement以及redis的出站连接，用于状态管理。所有基于Dapr的连接信息都由sidecar (Dapr)容器配置为Application-Kubernetes Pod spec中的环境变量，这使得不同的微服务应用程序能够通过Dapr相互发现并识别通道以相互通信，而无需任何额外的代码来执行发现和服务调用。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/1cce19d53e680eb46dbfe29a08af7b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TcSShCwAC4Ui83nR"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —容器环境变量</figcaption></figure><p id="bf62" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr放置组件识别所有Kubernetes pods/微服务应用程序的IP地址信息，并基于前端计算器应用程序执行的操作实现相互之间的无缝API路由。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/07ec6059675fae0bd813916bc67c425b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_QiUjDgKwqihpj-y"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —放置</figcaption></figure><p id="220c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用基于React的前端应用程序执行不同的数学运算，React应用程序应根据所选的运算到达特定的微服务。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/628d5b823fbe997a5c4739050a461be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4AvXkAlJSBMMDvkl"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —前端反应应用—计算器</figcaption></figure><p id="cd49" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">添加“3+3”，此操作无缝调用基于Go Mux的加法应用程序。从上面的应用程序代码中可以看出，没有额外的逻辑来调用服务。Dapr使用路径和dapr-id根据操作选择的路径无缝调用不同的服务。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/540d0ffa5b8ac0003cf10f3449068ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e9aHIdOBjQVkGrIb"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">计算器—加法应用</figcaption></figure><p id="273e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">乘法“3*3”，此操作无缝调用基于Python Flask的乘法应用程序。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/f08a5f43d3eb9b6e025b9ba974e202eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_OtehNtW67qIVoOw"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">计算器—乘法应用</figcaption></figure><p id="1525" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">划分“3%3”时，此操作无缝调用基于节点的划分应用程序。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/b8b46d13e055bc622006c356984e8d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CePIPwwxZNsQXhfA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">计算器—除法应用</figcaption></figure><p id="0d79" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所述，来自前端的操作被无缝地引导到不同的微服务，应用程序代码中没有任何额外的逻辑。对于来自前端计算器应用程序的每个事务，使用Dapr将状态无缝地持久存储到Redis。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/3add18da23c7b8ec89f66023979094ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RIKO1GXNUX2ys3jW"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —状态持久性</figcaption></figure><p id="c638" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">处于持续状态的total、next和operation反映了计算器需要操作的三种状态。通过持久化这些，用户可以刷新页面或取下前端窗格，并仍然可以跳回到原来的位置。对唯一服务的每个交易也被记录在“调用多个服务”等状态中。</p><p id="2fac" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，完成了“10+10”的加法运算，页面被刷新。如下所示，状态通过从状态存储(redis)中检索的事务信息进行了重新组合:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/b15cef84eb486b7465d90b09eca49d83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zMFsNaxekQj_wZ8k"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —状态持久性</figcaption></figure><p id="2b39" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">应用程序窗格中的所有Dapr sidecars都连接到Redis以保持状态。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/f4a3729f9effee8e2fe4097632ffbd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pCH5kirGYXwCpoMz"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr — Redis StateStore —状态持久性</figcaption></figure><p id="5167" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面列出了上述示例和dapr控制平面组件中涉及的所有Kubernetes部署和服务:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/91273d35b70274e10ea2d8b780121237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FDzdC_lx-4zq1BV-"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr—Kubernetes上的示例计算器应用程序</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/57a4d54e309cf5de62bee167713b1d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1WDjR8CkjyKkmyW3"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">dapr—Kubernetes上的示例计算器应用程序</figcaption></figure><p id="a17c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上图展示了如何将Dapr用作简化分布式系统开发的编程模型。Dapr方便用户将它作为一个可插拔的架构来使用，以提供诸如多语言编程、服务发现和简化的状态管理等功能。这使得开发人员能够使用最适合工作或特定开发团队的语言来构建他们想要的任何服务。</p><p id="4314" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所述，当用户从前端服务器调用相应的操作时，不需要他们居住的任何IP地址，也不需要使用任何语言/版本来对他们进行编程。相反，它通过名称调用本地dapr side-car，dapr side-car知道如何调用服务上的方法，利用平台的服务发现机制，在本例中是Kubernetes DNS解析。</p><p id="edd5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">例如，如果用户从前端应用程序调用“添加”操作，通过Dapr URLs的服务如下所示:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/8bcbcb488076dc6415013f16bef2ff3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A6ejci-1P_q7ehYl"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —操作模式</figcaption></figure><p id="e718" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr使用户能够使用一致的URL语法调用服务端点，利用托管平台的服务发现功能来解析端点位置。除了服务调用，Dapr side-car还提供无缝状态管理。应用程序使用嵌入式状态管理的唯一要求是对其Dapr sidecar的状态端点进行GET或POST。客户端通过简单地发布JSON键值对来持久化状态，如下所示:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/31e57187c08f3e28bcc3a9feb77ee84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0dSttxf9BrIfPKZW"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Dapr —操作模式</figcaption></figure><p id="4133" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除了服务调用和状态管理之外，Dapr今天还提供了一组广泛的构建模块，如:服务间的发布和订阅消息、事件驱动的资源绑定、虚拟角色、服务间的分布式跟踪等。Dapr本身就是用Go写的。它不依赖于K8s，可以在其他环境中运行，尽管Windows巨人在这个项目中确实考虑了K8s。</p><p id="2dbe" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Dapr的构建模块为开发人员提供了业内公认的最佳实践，每个构建模块都是独立的；其中用户可以在应用程序中使用它们中的一个、一些或全部。Dapr抽象了微服务应用开发中涉及的许多复杂性，使开发人员只需关注应用逻辑。微软表示，“随着这一转变，微服务架构已成为构建云原生应用的标准，预计到2022年，90%的新应用将采用微服务架构。”。</p><p id="a533" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">总之，增加微服务的采用以解决边缘和云上应用和服务开发的爆炸式增长，超敏捷应用技术、部署速度和规模可以利用Dapr来简化基于微服务的应用开发。</p></div></div>    
</body>
</html>