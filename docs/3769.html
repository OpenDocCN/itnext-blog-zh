<html>
<head>
<title>How to use Open Application Model to run applications on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用开放应用模型在Kubernetes上运行应用</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-open-application-model-to-run-applications-on-kubernetes-fb6b5ebb9f56?source=collection_archive---------5-----------------------#2020-02-20">https://itnext.io/how-to-use-open-application-model-to-run-applications-on-kubernetes-fb6b5ebb9f56?source=collection_archive---------5-----------------------#2020-02-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://oam.dev/" rel="noopener ugc nofollow" target="_blank">开放应用模型</a> (OAM)是构建云原生应用的规范，以<code class="fe km kn ko kp b"><a class="ae kl" href="https://github.com/oam-dev/rudr" rel="noopener ugc nofollow" target="_blank">Rudr</a></code>作为其<a class="ae kl" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>的具体实现。在这篇博客中，我们将通过几个例子来强化前一篇博客中提到的与<code class="fe km kn ko kp b">OAM</code>和<code class="fe km kn ko kp b">Rudr</code>相关的概念。</p><div class="kq kr gp gr ks kt"><a href="https://medium.com/@abhishek1987/building-cloud-native-apps-intro-to-open-application-model-and-rudr-bd1b55df9bf3" rel="noopener follow" target="_blank"><div class="ku ab fo"><div class="kv ab kw cl cj kx"><h2 class="bd ir gy z fp ky fr fs kz fu fw ip bi translated">构建云原生应用:开放应用模型和Rudr简介</h2><div class="la l"><h3 class="bd b gy z fp ky fr fs kz fu fw dk translated">生产级分布式云原生微服务通常由多个合作伙伴构建和运营…</h3></div><div class="lb l"><p class="bd b dl z fp ky fr fs kz fu fw dk translated">medium.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh li kt"/></div></div></a></div><p id="de2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从使用<code class="fe km kn ko kp b">Rudr</code>组件在Kubernetes上运行一个简单的应用程序开始，然后看一个如何使用<code class="fe km kn ko kp b"><a class="ae kl" href="https://github.com/oam-dev/rudr/blob/master/docs/concepts/traits.md" rel="noopener ugc nofollow" target="_blank">Rudr</a></code> <a class="ae kl" href="https://github.com/oam-dev/rudr/blob/master/docs/concepts/traits.md" rel="noopener ugc nofollow" target="_blank">特征</a>的例子。</p><blockquote class="lj lk ll"><p id="a3f4" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"><em class="iq">代码在</em> <a class="ae kl" href="https://github.com/abhirockzz/rudr-k8s-sample" rel="noopener ugc nofollow" target="_blank"> <em class="iq"> GitHub </em> </a>上有</p></blockquote></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="88d2" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">先决条件</h1><p id="e86e" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在其核心，<code class="fe km kn ko kp b">Rudr</code>是一个定制控制器，作为Kubernetes <code class="fe km kn ko kp b">Deployment</code>运行。要安装Rudr，您将需要一个版本为<code class="fe km kn ko kp b">1.15.x</code>或<code class="fe km kn ko kp b">1.16.x</code>的Kubernetes集群(在撰写本文时这些是受支持的版本)。任何集群都可以工作，但是我在这篇博客中使用了<a class="ae kl" href="https://docs.microsoft.com/azure/aks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Kubernetes服务</a>作为例子。</p><p id="d67a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想使用AKS，你只需要一个Azure订阅(<a class="ae kl" href="https://azure.microsoft.com/free/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">在这里抢一个免费账号！</a>)和<a class="ae kl" href="https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>来使用<code class="fe km kn ko kp b"><a class="ae kl" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-create" rel="noopener ugc nofollow" target="_blank">az aks create</a></code>命令设置一个托管的Kubernetes集群。</p><p id="a659" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个运行Kubernetes版本<code class="fe km kn ko kp b">1.15.7</code>的单节点集群的例子</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="a703" class="ni ly iq kp b gy nj nk l nl nm">az aks create --resource-group &lt;AZURE_RESOURCE_GROUP&gt; --name &lt;AKS_CLUSTER_NAME&gt; --kubernetes-version 1.15.7 --node-count 1 --node-vm-size Standard_B2s --node-osdisk-size 30 --generate-ssh-keys</span><span id="814d" class="ni ly iq kp b gy nn nk l nl nm">//point kubectl to AKS<br/>az aks get-credentials --resource-group &lt;AZURE_RESOURCE_GROUP&gt; --name &lt;AKS_CLUSTER_NAME&gt;</span><span id="465d" class="ni ly iq kp b gy nn nk l nl nm">//confirm<br/>kubectl get nodes</span></pre><p id="4373" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://helm.sh/docs/intro/" rel="noopener ugc nofollow" target="_blank">安装</a> <code class="fe km kn ko kp b"><a class="ae kl" href="https://helm.sh/docs/intro/" rel="noopener ugc nofollow" target="_blank">Helm 3</a></code>后，您可以继续进行<code class="fe km kn ko kp b">Rudr</code>的设置</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="c922" class="ni ly iq kp b gy nj nk l nl nm">//clone the repo<br/>git clone https://github.com/oam-dev/rudr.git</span><span id="21ce" class="ni ly iq kp b gy nn nk l nl nm">//install it using Helm<br/>helm install rudr ./charts/rudr --wait</span><span id="713f" class="ni ly iq kp b gy nn nk l nl nm">//confirm Rudr Deployment<br/>kubectl get deployment rudr</span><span id="0b75" class="ni ly iq kp b gy nn nk l nl nm">//check Rudr CRDs<br/>kubectl get crds -l app.kubernetes.io/part-of=core.oam.dev</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="3aa5" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">用Rudr部署一个简单的应用</h1><p id="0270" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">我们将从一个使用以下Rudr对象部署简单应用程序的基本示例开始:<code class="fe km kn ko kp b">ComponentSchematic</code>和<code class="fe km kn ko kp b">ApplicationConfig</code>。</p><p id="cf74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个应用程序非常简单——它是一个容器化的应用程序，公开了一个端点，默认情况下用<code class="fe km kn ko kp b">Hello World!</code>响应，如果设置了<code class="fe km kn ko kp b">GREETING</code>环境变量，则用<code class="fe km kn ko kp b">Hello &lt;greeting&gt;</code>响应。要在Kubernetes中运行这个，显而易见的方法是使用一个<code class="fe km kn ko kp b">Deployment</code>对象。相反，我们将创建<code class="fe km kn ko kp b">Rudr</code>自定义资源定义(CRD)来表示我们的应用程序，将它们提交给Kubernetes，并让<code class="fe km kn ko kp b">Rudr</code>控制器/操作员负责处理特定的Kubernetes资源。</p><h2 id="e600" class="ni ly iq bd lz no np dn md nq nr dp mh jy ns nt ml kc nu nv mp kg nw nx mt ny bi translated">部署Rudr CRDs</h2><p id="2cb9" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">我们将从创建一个<code class="fe km kn ko kp b">ComponentSchematic</code>开始。我们来自省一下:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="0f2c" class="ni ly iq kp b gy nj nk l nl nm">apiVersion: core.oam.dev/v1alpha1<br/>kind: ComponentSchematic<br/>metadata:<br/>  name: greeter-component<br/>spec:<br/>  workloadType: core.oam.dev/v1alpha1.Server<br/>  containers:<br/>    - name: greeter<br/>      image: abhirockzz/greeter-go<br/>      env:<br/>        - name: GREETING<br/>          fromParam: greeting<br/>      ports:<br/>        - protocol: TCP<br/>          containerPort: 8080<br/>          name: http<br/>      resources:<br/>        cpu:<br/>          required: 0.1<br/>        memory:<br/>          required: "128"<br/>  parameters:<br/>    - name: greeting<br/>      type: string<br/>      default: abhi_tweeter</span></pre><p id="b41e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个名为<code class="fe km kn ko kp b">greeter-component</code>的<code class="fe km kn ko kp b">ComponentSchematic</code>，它的<code class="fe km kn ko kp b">workloadType</code>是<code class="fe km kn ko kp b">core.oam.dev/v1alpha1.Server</code>——它决定了为处理这个组件而创建的Kubernetes资源的类型。它有一个单独的<code class="fe km kn ko kp b">container</code>引用Docker Hub上的<code class="fe km kn ko kp b">abhirockzz/greeter-go</code>图像。<code class="fe km kn ko kp b">parameters</code>部分定义了一个名为<code class="fe km kn ko kp b">greeting</code>的可配置属性，其默认值为<code class="fe km kn ko kp b">abhi_tweeter</code>。该参数在<code class="fe km kn ko kp b">containers</code>部分的<code class="fe km kn ko kp b">env</code>属性中作为环境变量被引用。</p><p id="4377" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如此创建<code class="fe km kn ko kp b">ComponentSchematic</code>:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="987c" class="ni ly iq kp b gy nj nk l nl nm">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/rudr-k8s-sample/master/deploy/component.yaml</span><span id="0617" class="ni ly iq kp b gy nn nk l nl nm">//output</span><span id="6479" class="ni ly iq kp b gy nn nk l nl nm">componentschematic.core.oam.dev/greeter-component created</span></pre><p id="06b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在Kubernetes中创建一个<code class="fe km kn ko kp b">ComponentSchematic</code>对象——您可以使用<code class="fe km kn ko kp b">kubectl get components</code>来确认。单靠自己真的做不了多少事情。它需要另一个<code class="fe km kn ko kp b">Rudr</code>实体与之合作——即<code class="fe km kn ko kp b">ApplicationConfig</code>。让我们看看这种情况下是什么样的:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="2f2a" class="ni ly iq kp b gy nj nk l nl nm">apiVersion: core.oam.dev/v1alpha1<br/>kind: ApplicationConfiguration<br/>metadata:<br/>  name: greeter-app-config<br/>spec:<br/>  components:<br/>    - componentName: greeter-component<br/>      instanceName: greeter-app</span></pre><p id="195d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">ApplicationConfig</code>是一个<code class="fe km kn ko kp b">ComponentSchematic</code>的实例——在这种情况下，它指的是<code class="fe km kn ko kp b">greeter-component</code>T3。</p><p id="2127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创造了<code class="fe km kn ko kp b">ApplicationConfig</code>:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="4652" class="ni ly iq kp b gy nj nk l nl nm">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/rudr-k8s-sample/master/deploy/app-config.yaml</span><span id="41e7" class="ni ly iq kp b gy nn nk l nl nm">//output<br/>applicationconfiguration.core.oam.dev/greeter-app-config configured</span></pre><p id="e834" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要确认:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="7bc0" class="ni ly iq kp b gy nj nk l nl nm">kubectl get applicationconfiguration.core.oam.dev/greeter-app-config -o yaml</span></pre><p id="98b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仔细查看<code class="fe km kn ko kp b">status</code>部分——您应该会看到类似这样的内容:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="b74b" class="ni ly iq kp b gy nj nk l nl nm">apiVersion: core.oam.dev/v1alpha1<br/>kind: ApplicationConfiguration<br/>...<br/>status:<br/>  components:<br/>    greeter-component:<br/>      deployment/greeter-app: running<br/>      service/greeter-app: created<br/>  phase: synced<br/>  phase: synced</span></pre><h2 id="063a" class="ni ly iq bd lz no np dn md nq nr dp mh jy ns nt ml kc nu nv mp kg nw nx mt ny bi translated">检查Kubernetes对象</h2><p id="8a68" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated"><code class="fe km kn ko kp b">Rudr</code>为我们创造了一堆Kubernetes资源- <code class="fe km kn ko kp b">Deployment</code>、<code class="fe km kn ko kp b">Pod</code>和<code class="fe km kn ko kp b">Service</code></p><p id="60b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查<code class="fe km kn ko kp b">Deployment</code></p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="6121" class="ni ly iq kp b gy nj nk l nl nm">kubectl get deployment/greeter-app</span><span id="e954" class="ni ly iq kp b gy nn nk l nl nm">NAME          READY   UP-TO-DATE   AVAILABLE   AGE<br/>greeter-app   1/1     1            1           42s</span></pre><p id="4893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查<code class="fe km kn ko kp b">Pod</code></p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="a0c2" class="ni ly iq kp b gy nj nk l nl nm">kubectl get pod -l=app.kubernetes.io/name=greeter-app-config</span><span id="b599" class="ni ly iq kp b gy nn nk l nl nm">NAME                           READY   STATUS    RESTARTS   AGE<br/>greeter-app-586b5d4ddc-wrqtb   1/1     Running   0          2m30s</span></pre><p id="6ef9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，Kubernetes <code class="fe km kn ko kp b">Service</code>资源</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="d704" class="ni ly iq kp b gy nj nk l nl nm">kubectl get service/greeter-app</span><span id="175d" class="ni ly iq kp b gy nn nk l nl nm">NAME          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE<br/>greeter-app   ClusterIP   10.0.135.117   &lt;none&gt;        8080/TCP   4m15s</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="1b25" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">测试应用程序</h1><p id="8a0b" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">访问应用程序最简单的方法是使用端口转发</p><blockquote class="lj lk ll"><p id="ce71" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"><em class="iq">确保你替换了</em>的名字<code class="fe km kn ko kp b"><em class="iq">Pod</em></code></p></blockquote><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="f0e5" class="ni ly iq kp b gy nj nk l nl nm">kubectl port-forward pod/&lt;pod name&gt; 9090:8080</span><span id="6847" class="ni ly iq kp b gy nn nk l nl nm">Forwarding from 127.0.0.1:9090 -&gt; 8080<br/>Forwarding from [::1]:9090 -&gt; 8080</span></pre><p id="e55c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可以简单地<code class="fe km kn ko kp b"><a class="ae kl" href="https://curl.haxx.se/" rel="noopener ugc nofollow" target="_blank">curl</a></code>终点</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="7275" class="ni ly iq kp b gy nj nk l nl nm">curl localhost:9090</span><span id="9910" class="ni ly iq kp b gy nn nk l nl nm">//output<br/>Hello abhi_tweeter!</span></pre><p id="8247" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样。这是一个在Kubernetes中运行的应用程序的非常简单的例子，它仅使用Rudr构造创建。</p><p id="b0f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为练习，您可以尝试创建下面的<code class="fe km kn ko kp b">ApplicationConfig</code>并按照上面概述的步骤来访问应用程序以及结果是什么</p><blockquote class="lj lk ll"><p id="815e" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"><em class="iq">注意，这个</em> <code class="fe km kn ko kp b"><em class="iq">ApplicationConfig</em></code> <em class="iq">使用</em> <code class="fe km kn ko kp b"><em class="iq">parameterValues</em></code> <em class="iq">段来覆盖</em> <code class="fe km kn ko kp b"><em class="iq">parameters</em></code> <em class="iq">中定义的</em> <code class="fe km kn ko kp b"><em class="iq">ComponentSchematic</em></code> <em class="iq">。</em></p></blockquote><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="0952" class="ni ly iq kp b gy nj nk l nl nm">apiVersion: core.oam.dev/v1alpha1<br/>kind: ApplicationConfiguration<br/>metadata:<br/>  name: greeter-app-config-2<br/>spec:<br/>  components:<br/>    - componentName: greeter-component<br/>      instanceName: greeter-app-2<br/>      parameterValues:<br/>        - name: greeting<br/>          value: foobar</span></pre></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="b6f7" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">利用特质</h1><p id="ce74" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在前面的示例中，创建的部署对象有一个Pod(单个应用程序实例)。您可以使用<code class="fe km kn ko kp b">kubectl scale</code>命令来扩展它，但是我认为您现在已经得到了流程——我们不会这样做！让我们利用Rudr中的手动缩放器特性来实现这一点。</p><p id="83d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将继续使用相同的<code class="fe km kn ko kp b">ComponentSchematic</code>，并引入一个新的<code class="fe km kn ko kp b">ApplicationConfig</code>定义，以确保我们的应用程序有两个副本。我们将借助手动定标器特性来实现这一点</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="0f53" class="ni ly iq kp b gy nj nk l nl nm">apiVersion: core.oam.dev/v1alpha1<br/>kind: ApplicationConfiguration<br/>metadata:<br/>  name: greeter-app-config-3<br/>spec:<br/>  components:<br/>    - componentName: greeter-component<br/>      instanceName: scalable-greeter-app<br/>      parameterValues:<br/>        - name: greeting<br/>          value: scalable<br/>      traits:<br/>        - name: manual-scaler<br/>          properties:<br/>            replicaCount: 2</span></pre><p id="cf8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">greeter-app-config-3ApplicationConfiguration</code>引用了<code class="fe km kn ko kp b">greeter-component</code> <code class="fe km kn ko kp b">ComponentSchematic</code>。注意<code class="fe km kn ko kp b">traits</code>部分，这里我们使用了一个<code class="fe km kn ko kp b">manual-scaler</code>，并将<code class="fe km kn ko kp b">replicaCount</code>指定为<code class="fe km kn ko kp b">2</code>。为了确保我们能够将它与前面的应用程序区分开来，我们重写了paramater，将<code class="fe km kn ko kp b">greeting</code>的值作为<code class="fe km kn ko kp b">scalable</code>传入</p><p id="67b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建<code class="fe km kn ko kp b">ApplicationConfiguration</code></p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="359e" class="ni ly iq kp b gy nj nk l nl nm">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/rudr-k8s-sample/master/deploy/manual-scaler-trait/app-config.yaml</span><span id="f46a" class="ni ly iq kp b gy nn nk l nl nm">//output<br/>applicationconfiguration.core.oam.dev/greeter-app-config-3 created</span></pre><p id="158b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待几秒钟，确认Rudr已经触发了<code class="fe km kn ko kp b">Kubernetes</code>对象的创建:</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="2ff3" class="ni ly iq kp b gy nj nk l nl nm">kubectl get applicationconfiguration.core.oam.dev/greeter-app-config-3 -o yaml</span></pre><p id="3c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到一个<code class="fe km kn ko kp b">status</code>部分</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="9b87" class="ni ly iq kp b gy nj nk l nl nm">status:<br/>  components:<br/>    greeter-component:<br/>      deployment/scalable-greeter-app: running<br/>      service/scalable-greeter-app: created<br/>  phase: synced</span></pre><blockquote class="lj lk ll"><p id="fb88" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"><em class="iq">如果</em> <code class="fe km kn ko kp b"><em class="iq">deployment/scalable-greeter-app</em></code> <em class="iq">处于</em> <code class="fe km kn ko kp b"><em class="iq">unavailable</em></code> <em class="iq">状态，请在10秒左右后重试</em></p></blockquote><p id="b5e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确认<code class="fe km kn ko kp b">Deployment</code>对象</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="a943" class="ni ly iq kp b gy nj nk l nl nm">kubectl get deployment/scalable-greeter-app</span><span id="3d40" class="ni ly iq kp b gy nn nk l nl nm">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE<br/>scalable-greeter-app   2/2     2            2           4m</span></pre><p id="a5b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">也检查单个的<code class="fe km kn ko kp b">Pod</code></p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="a802" class="ni ly iq kp b gy nj nk l nl nm">kubectl get pods -l=app.kubernetes.io/name=greeter-app-config-3</span><span id="7b0f" class="ni ly iq kp b gy nn nk l nl nm">NAME                                    READY   STATUS    RESTARTS   AGE<br/>scalable-greeter-app-6488f64cb4-mj6nw   1/1     Running   0          5m<br/>scalable-greeter-app-6488f64cb4-rpfvp   1/1     Running   0          5m</span></pre><p id="7e1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要访问该应用程序，只需运行安装有<code class="fe km kn ko kp b">curl</code>的一次性<code class="fe km kn ko kp b">Pod</code>即可。一旦进入Pod，您可以简单地使用<code class="fe km kn ko kp b">curl $SCALABLE_GREETER_APP_SERVICE_HOST:$SCALABLE_GREETER_APP_SERVICE_PORT</code>来调用应用程序的端点。</p><pre class="na nb nc nd gt ne kp nf ng aw nh bi"><span id="3353" class="ni ly iq kp b gy nj nk l nl nm">kubectl run curl --image=radial/busyboxplus:curl -i --tty --rm</span><span id="d304" class="ni ly iq kp b gy nn nk l nl nm">[ root@curl-6bf6db5c4f-5hw6t:/ ]$ curl $SCALABLE_GREETER_APP_SERVICE_HOST:$SCALABLE_GREETER_APP_SERVIC<br/>E_PORT<br/>Hello scalable!</span></pre><blockquote class="lj lk ll"><p id="2a65" class="jn jo lm jp b jq jr js jt ju jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj kk ij bi translated"> <code class="fe km kn ko kp b"><em class="iq">Rudr</em></code> <em class="iq">创建的</em> <code class="fe km kn ko kp b"><em class="iq">ClusterIP</em></code> <em class="iq"> </em> <code class="fe km kn ko kp b"><em class="iq">Service</em></code> <em class="iq">使<code class="fe km kn ko kp b"><em class="iq">SCALABLE_GREETER_APP_SERVICE_HOST</em></code> <em class="iq">和</em> <code class="fe km kn ko kp b"><em class="iq">SCALABLE_GREETER_APP_SERVICE_PORT</em></code> <em class="iq">成为环境变量。</em></em></p></blockquote><p id="af00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预期的响应是<code class="fe km kn ko kp b">Hello scalable!</code>，因为我们已经覆盖了<code class="fe km kn ko kp b">ApplicationConfiguraton</code>中的<code class="fe km kn ko kp b">greeting</code> <code class="fe km kn ko kp b">parameter</code></p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><h1 id="7971" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">打扫</h1><p id="25d0" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">您可以使用<code class="fe km kn ko kp b"><a class="ae kl" href="https://docs.microsoft.com/cli/azure/aks?view=azure-cli-latest&amp;WT.mc_id=medium-blog-abhishgu#az-aks-delete" rel="noopener ugc nofollow" target="_blank">az aks delete</a></code>命令删除整个AKS集群或者删除单个的<code class="fe km kn ko kp b">ApplicationConfiguration</code>来触发级联删除所有与它相关的Kubernetes资源(<code class="fe km kn ko kp b">Deployment</code>等)。).要删除<code class="fe km kn ko kp b">Rudr</code>部署，如果您还想删除<code class="fe km kn ko kp b">Rudr</code> CRDs ( <code class="fe km kn ko kp b">components</code>、<code class="fe km kn ko kp b">configurations</code>等)，只需使用<code class="fe km kn ko kp b">helm delete rudr</code>和<code class="fe km kn ko kp b">kubectl delete crd -l app.kubernetes.io/part-of=core.oam.dev</code>即可。)</p></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="8b89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是这个关于<code class="fe km kn ko kp b">Open Application Model</code>和<code class="fe km kn ko kp b">Rudr</code>的两部分系列的全部内容，还有一个实际操作的例子，让你感受一下如何在Kubernetes上实际使用它。如果你觉得这篇文章有帮助，请喜欢并关注🙌很高兴通过<a class="ae kl" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank"> Twitter </a>获得反馈，或者随时发表评论。</p></div></div>    
</body>
</html>