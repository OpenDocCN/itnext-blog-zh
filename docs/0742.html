<html>
<head>
<title>Tutorial Part 1: Kubernetes up and running on LXC/LXD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程第1部分:在LXC/LXD运行Kubernetes</h1>
<blockquote>原文：<a href="https://itnext.io/tutorial-part-1-kubernetes-up-and-running-on-lxc-lxd-b760c79cd53f?source=collection_archive---------1-----------------------#2018-05-20">https://itnext.io/tutorial-part-1-kubernetes-up-and-running-on-lxc-lxd-b760c79cd53f?source=collection_archive---------1-----------------------#2018-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e35711d13a2063d969e687510a676cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qklMJNbxFRexwd571afm0g.png"/></div></div></figure><p id="d587" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将使用<a class="ae kw" href="https://conjure-up.io/" rel="noopener ugc nofollow" target="_blank">召唤</a>在<a class="ae kw" href="https://linuxcontainers.org/" rel="noopener ugc nofollow" target="_blank"> Linux容器</a> (LXC/LXD)上部署Kubernetes。</p><p id="3792" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">请注意，本教程仅供学习之用。</strong></p><p id="08f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。</p><ul class=""><li id="3ce7" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">旋转AWS EC2 Ubuntu 16.04 LTS“T2 . x large”因为我有AWS信用点可以花。(你可以在笔记本电脑或云上启动Ubuntu VM)。</li><li id="8708" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">在安全组中允许HTTP、HTTPS、TCP:8443、SSH</li></ul><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/5e1885941dfa6567630ec1e7a805e8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_SiEbFynkSj6fX5zmh-8w.png"/></div></div></figure><ul class=""><li id="aee4" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">SSH到EC2实例并验证预安装的LXD版本。然后安装变戏法。</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="0d34" class="lv lw iq lr b gy lx ly l lz ma">$ ssh -i aws.pem ubuntu@13.250.45.177</span><span id="d56d" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxd --version<br/>2.0.11</span><span id="5d00" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ which lxd<br/>/usr/bin/lxd</span><span id="75ed" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ sudo snap install conjure-up --classic --edge</span><span id="e65d" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ conjure-up</span></pre><p id="2690" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">变戏法让我们部署软件-stack suck作为bigdata，kubernetes，openstack作为一个“咒语”。</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="60fd" class="lv lw iq lr b gy lx ly l lz ma"><em class="mc"># conjure-up usage (bigdata, kubernetes, openstack)</em><br/>$ conjure-up<br/><em class="mc"># or</em><br/>$ conjure-up kubernetes<br/><em class="mc"># or</em><br/>$ conjure-up openstack<br/><em class="mc"># or</em><br/>$ conjure-up bigdata</span></pre><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/201ebc8886cf1a392e0700adffa0ad78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WD2ArXz1Lt8AVRbnlrUH7Q.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">$变戏法</figcaption></figure><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/ea372dc324960b89dc912ea9ead7a97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DCA0bdJjw6Ae7Sk81dUCJA.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">$召唤库伯内特斯</figcaption></figure><p id="5fc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以在公共云、私有云或本地云上部署“咒语”。(在本教程中，虽然AWS EC2实例是“本地”的，但是Kubernetes部署需要LXD版本3.0.0或更高版本)。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/00e6d576e476ebf578f8426c9a9e1e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S_jFqLV94wipnebRQCXmuQ.png"/></div></div></figure><ul class=""><li id="20a1" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">让我们卸载内置的LXD 2 . 0 . 11版本，安装LXD 3.0.0或更高版本。请注意<a class="ae kw" href="https://snapcraft.io/" rel="noopener ugc nofollow" target="_blank">卡扣</a>将是安装和使用LXD的唯一推荐方式。</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="0493" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ sudo apt-get remove lxd lxd-client</span><span id="3a08" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ sudo snap install lxd<br/>lxd 3.0.0 from 'canonical’ installed</span><span id="dc21" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ which lxd<br/>/snap/bin/lxd</span></pre><ul class=""><li id="fd58" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">让我们在需要设置存储、网络等的地方进行LXD初始配置。请仔细地一行一行地检查设置。</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="c106" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ /snap/bin/lxd init<br/>Would you like to use LXD clustering? (yes/no) [default=no]: <br/>Do you want to configure a new storage pool? (yes/no) [default=yes]: <br/>Name of the new storage pool [default=default]: <br/>Name of the storage backend to use (btrfs, ceph, dir, lvm) [default=btrfs]: <strong class="lr ir">dir</strong><br/>Would you like to connect to a MAAS server? (yes/no) [default=no]: <br/>Would you like to create a new local network bridge? (yes/no) [default=yes]: <br/>What should the new bridge be called? [default=lxdbr0]: <br/>What IPv4 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: <strong class="lr ir">auto</strong><br/>What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: <strong class="lr ir">none</strong><br/>Would you like LXD to be available over the network? (yes/no) [default=no]: <strong class="lr ir">yes</strong><br/>Address to bind LXD to (not including port) [default=all]:<br/>Port to bind LXD to [default=8443]:<br/>Trust password for new clients:<br/>Again:<br/>Would you like stale cached images to be updated automatically? (yes/no) [default=yes] <br/>Would you like a YAML "lxd init" preseed to be printed? (yes/no) [default=no]:</span></pre><ul class=""><li id="2434" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">LXD初始配置完成，并检查我们的主机上运行的LXD容器(当然，我们目前没有任何东西)</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="3b5c" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxc list<br/>If this is your first time running LXD on this machine, you should also run: lxd init<br/>To start your first container, try: lxc launch ubuntu:16.04<br/><br/>+<em class="mc">------+-------+------+------+------+-----------+</em><br/>| NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS |<br/>+<em class="mc">------+-------+------+------+------+-----------+</em></span></pre><ul class=""><li id="bc05" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">使用ubuntu image发布我们的第一个LXD容器。(点击此处查看当前可用图片:<a class="ae kw" href="https://uk.images.linuxcontainers.org/" rel="noopener ugc nofollow" target="_blank">https://uk.images.linuxcontainers.org/</a>)</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="cde5" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxc launch ubuntu:16.04 webserver<br/>Creating webserver<br/>Starting webserver<br/><br/>Now we have our first LXD container running.<br/>ubuntu@ip-172-31-1-4:~$ lxc list<br/>+-----------+---------+---------------------+------+------------+-----------+<br/>|   NAME    |  STATE  |        IPV4         | IPV6 |    TYPE    | SNAPSHOTS |<br/>+-----------+---------+---------------------+------+------------+-----------+<br/>| webserver | RUNNING | 10.217.72.74 (eth0) |      | PERSISTENT | 0         |<br/>+-----------+---------+---------------------+------+------------+-----------+</span><span id="4fae" class="lv lw iq lr b gy mb ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxc info webserver<br/>Name: webserver<br/>Remote: unix:<em class="mc">//</em><br/>Architecture: x86_64<br/>Created: 2018/05/20 03:52 UTC<br/>Status: Running<br/>Type: persistent<br/>Profiles: default<br/>Pid: 14296<br/>Ips:<br/>  eth0:inet10.217.72.74vethJS9UBV<br/>  eth0:inet6fe80::216:3eff:fea5:e984vethJS9UBV<br/>  lo:inet127.0.0.1<br/>  lo:inet6::1<br/>Resources:<br/>  Processes: 28<br/>  CPU usage:<br/>    CPU usage (in seconds): 4<br/>  Memory usage:<br/>    Memory (current): 34.40MB<br/>    Memory (peak): 155.04MB<br/>  Network usage:<br/>    eth0:<br/>      Bytes received: 276.12kB<br/>      Bytes sent: 9.75kB<br/>      Packets received: 131<br/>      Packets sent: 120<br/>    lo:<br/>      Bytes received: 0B<br/>      Bytes sent: 0B<br/>      Packets received: 0<br/>      Packets sent: 0</span></pre><ul class=""><li id="712d" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">让我们使用alpine image启动另一个容器。</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="4a28" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxc launch images:alpine/3.7 my-alpine-lxd-container<br/>Creating my-alpine-lxd-container<br/>Starting my-alpine-lxd-container<br/><br/>ubuntu@ip-172-31-1-4:~$ lxc list<br/>+-------------------------+---------+----------------------+------+------------+-----------+<br/>|          NAME           |  STATE  |         IPV4         | IPV6 |    TYPE    | SNAPSHOTS |<br/>+-------------------------+---------+----------------------+------+------------+-----------+<br/>| <strong class="lr ir">my-alpine-lxd-container</strong> | RUNNING | 10.217.72.102 (eth0) |      | PERSISTENT | 0         |<br/>+-------------------------+---------+----------------------+------+------------+-----------+<br/>| <strong class="lr ir">webserver</strong>               | RUNNING | 10.217.72.74 (eth0)  |      | PERSISTENT | 0         |<br/>+-------------------------+---------+----------------------+------+------------+—————+</span><span id="9ab5" class="lv lw iq lr b gy mb ly l lz ma"><strong class="lr ir">ubuntu@ip-172-31-1-4</strong>:<strong class="lr ir">~</strong>$ lxc image list</span><span id="a5f3" class="lv lw iq lr b gy mb ly l lz ma">+-------+--------------+--------+---------------------------------------------+--------+----------+------------------------------+</span><span id="55e4" class="lv lw iq lr b gy mb ly l lz ma">| ALIAS | FINGERPRINT  | PUBLIC |                 DESCRIPTION                 |  ARCH  |   SIZE   |         UPLOAD DATE          |</span><span id="b483" class="lv lw iq lr b gy mb ly l lz ma">+-------+--------------+--------+---------------------------------------------+--------+----------+------------------------------+</span><span id="d015" class="lv lw iq lr b gy mb ly l lz ma">|       | 09ef606a183d | no     | ubuntu 16.04 LTS amd64 (release) (20180509) | x86_64 | 156.99MB | May 20, 2018 at 3:52am (UTC) |</span><span id="8e38" class="lv lw iq lr b gy mb ly l lz ma">+-------+--------------+--------+---------------------------------------------+--------+----------+------------------------------+</span><span id="a0ae" class="lv lw iq lr b gy mb ly l lz ma">|       | 9a8851d41d04 | no     | Alpine 3.7 amd64 (20180519_17:50)           | x86_64 | 1.80MB   | May 20, 2018 at 4:00am (UTC) |</span><span id="1ec3" class="lv lw iq lr b gy mb ly l lz ma">+-------+--------------+--------+---------------------------------------------+--------+----------+------------------------------+</span></pre><ul class=""><li id="4085" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">让我们对web服务器容器进行shell访问。</li></ul><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="7abe" class="lv lw iq lr b gy lx ly l lz ma">ubuntu@ip-172-31-1-4:~$ lxc exec webserver /bin/bash<br/>root@webserver:~<em class="mc">#</em><br/>root@webserver:~<em class="mc"># ls -la</em><br/>total 20<br/>drwx------  3 root root 4096 May 20 03:52 .<br/>drwxr-xr-x 22 root root 4096 May  9 01:53 ..<br/>-rw-r--r--  1 root root 3106 Oct 22  2015 .bashrc<br/>-rw-r--r--  1 root root  148 Aug 17  2015 .profile<br/>drwx------  2 root root 4096 May 20 03:52 .ssh</span></pre><p id="e517" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！！！现在，我们可以推出LXD集装箱，并发挥左右。</p><p id="03af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请继续<a class="ae kw" href="https://bit.ly/2IugrDX" rel="noopener ugc nofollow" target="_blank">教程第二部分</a>我们将在Linux容器上部署Kubernetes(LXC/LXD)。</p></div></div>    
</body>
</html>