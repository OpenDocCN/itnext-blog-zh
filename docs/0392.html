<html>
<head>
<title>Building A Node CMS With KeystoneJS, Mongo DB, React and Redux — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第一部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-i-ae5958496df2?source=collection_archive---------3-----------------------#2018-03-04">https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-i-ae5958496df2?source=collection_archive---------3-----------------------#2018-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d8c1eec721ec30f0f4d9225a10dd75b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ScO7c5j0QG09a3cEA2NHmg.jpeg"/></div></div></figure><p id="d1ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fbuilding-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-i-ae5958496df2" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn </em>上分享这篇文章</a></p><p id="d368" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">如果你想看这个项目的最终版本，你可以从</em> <a class="ae kw" href="https://github.com/Colour-Full/medium-keystone-react-cms" rel="noopener ugc nofollow" target="_blank"> <em class="kx"> github </em> </a>获得回购</p><p id="d057" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装Keystone并创建我们的第一个数据模型</p><p id="115f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个系列中，我们将看看如何使用Node和KeystoneJs作为基础构建一个纯JavaScript的CMS，并添加一些令人兴奋的技术，如React和Redux，使其真正成为下一代。</p><p id="5b6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但首先什么是KeystoneJs？</p><p id="d6ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">KeystoneJs网站称:“Node.js中用于开发数据库驱动网站、应用和API的开源框架，建立在Express和MongoDB之上。”</p><p id="bc25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将需要什么:</p><p id="fa41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开始之前，确保您的机器上已经安装了NodeJs和MongoDb。我不会详细说明你如何做到这一点，如果你还没有安装它们，他们的网站上有一些非常好的安装指南:</p><div class="ky kz gp gr la lb"><a href="https://nodejs.org/en/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">节点. js</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">Node.js是基于Chrome的V8 JavaScript引擎构建的JavaScript运行时。Node.js使用事件驱动的非阻塞I/O…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">nodejs.org</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><div class="ky kz gp gr la lb"><a href="https://docs.mongodb.com/manual/installation/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">安装MongoDB - MongoDB手册3.6</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">对已填充集合的索引生成操作</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">docs.mongodb.com</p></div></div><div class="lk l"><div class="lq l lm ln lo lk lp jw lb"/></div></div></a></div><p id="e13f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们为新项目创建一个文件夹</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="64fa" class="ma mb iq lw b gy mc md l me mf">mkdir keystone<br/>cd keystone</span></pre><p id="e9f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在如果你已经安装了Node和Mongo，是时候进入有趣的部分了。</p><p id="1e91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们将安装KeystoneJs。根据keystone网站上的指南</p><div class="ky kz gp gr la lb"><a href="http://keystonejs.com/docs/getting-started/" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">KeystoneJS</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">在您需要的功能上领先一步。KeystoneJS是构建动态网站、应用程序和…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">keystonejs.com</p></div></div></div></a></div><p id="0fc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有两种选择。简单使用KeystoneJS生成器和一个灵活的选项给你更多的控制。由于我们不会使用很多默认选项，我们将选择灵活的安装过程。</p><p id="d615" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们进入我们的项目文件夹，运行npm init，随意添加你喜欢的任何东西，你唯一需要留意的是启动脚本，它需要指向我们的应用入口点。如果您想继续，这是我的package.json在这一步之后的样子:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="6022" class="ma mb iq lw b gy mc md l me mf">{<br/>  "name": "keystone",<br/>  "version": "1.0.0",<br/>  "description": "Keystone JS CMS with React and Redux",<br/>  "main": "index.js",<br/>  "scripts": {<br/>  "start": "node index.js",<br/>  "test": "test"<br/>  },<br/>  "author": "Velizar Mihaylov",<br/>  "license": "ISC"<br/>}</span></pre><p id="5e9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在我们有了package.json fail，我们可以安装keystone了。Keystone还需要下划线Js库，所以让我们也添加它。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="368a" class="ma mb iq lw b gy mc md l me mf">npm install keystone@^4.0.0-beta.8 underscore --save</span></pre><p id="b5f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">！！！重要！！！</strong></p><p id="a4f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文是在Keystone 4的测试版是最新版本的时候写的。Keystone目前是第5版，这是非常不同的。因此，我们需要专门安装正确的版本，所以请确保您在安装keystone软件包时没有遗漏“@^4.0.0-beta.8”部分。</p><p id="888b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">！！！重要！！！</strong></p><p id="9c9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们继续keystone设置之前，让我们花点时间为我们的应用程序创建文件夹。Keystone团队推荐了一个文件结构，但是因为我们要在混合中加入一些react和redux magic，所以我们将使用一个自定义的文件结构。</p><p id="4a3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们要做的是将应用程序的客户端和服务器端分开。我们所有的react组件和相关文件都将保存在客户端文件夹中，而所有与服务器相关的代码都将保存在服务器文件夹中。</p><figure class="lr ls lt lu gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/e8456ad8565a69bfa2c0160d30028480.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/1*uGUMEIbHFnd1CxNJQo1mKw.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">我们应用程序的文件夹结构</figcaption></figure><p id="44c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们把客户机文件夹留为空，让我们把注意力集中在服务器端。在我们的服务器文件夹中，我们将有一个公共文件夹，我们编译的JavaScript文件将在那里结束。我们还将为静态和样式文件添加一个img和css文件夹。我们还需要一个模型文件夹来存放我们的数据模型，还需要一个路由文件夹来为我们的网站建立快速路由。</p><figure class="lr ls lt lu gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/9322f1f9fbf92f5f23b0b90361ffc09b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Ziu848ZJJiW5jiKApfn7eg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">这是我们的服务器文件夹应该有的样子</figcaption></figure><p id="4f23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">设置梯形失真</p><p id="d0b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当我们有了出路，让我们建立Keystone。为此，转到您的根文件夹并创建一个index.js文件。您可以将该文件命名为您喜欢的任何名称。index.js只是一个旧习惯，您可以随意将其替换为您认为合适的名称。只是不要忘记也指向package.json中的那个文件名。</p><p id="48eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在index.js中，我们希望添加以下内容。</p><figure class="lr ls lt lu gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="97fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将足以在本地运行keystone。但在此之前，我们需要登录系统。实际上，如果您现在尝试运行您的脚本，您将会得到以下错误:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="1ccb" class="ma mb iq lw b gy mc md l me mf">KeystoneJS Update Error:</span><span id="a3ee" class="ma mb iq lw b gy mo md l me mf">An updates folder must exist in your project root to use automatic updates.<br/>If you want to use a custom path for your updates, set the `updates` option.<br/>If you don't want to use updates, set the `auto update` option to `false`.<br/>See <a class="ae kw" href="http://keystonejs.com/docs/configuration/#updates" rel="noopener ugc nofollow" target="_blank">http://keystonejs.com/docs/configuration/#updates</a> for more information.</span></pre><p id="f8b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，要解决这个问题，我们首先需要建立一个数据模型来存储我们的用户。让我们转到模型文件夹，创建一个新文件users.js，现在为我们的用户添加字段。</p><figure class="lr ls lt lu gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="358c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是现在我们有用户模型，但如果我们试图运行我们的脚本，我们会看到同样的错误。我们实际上从未创建过更新文件夹，对吗？好的，那么让我们开始吧，我们也将通过创建一个<a class="ae kw" href="https://gist.github.com/Colour-Full/b3916362ac2a0903da66040bcff91d13#file-0-0-1-admin-js" rel="noopener ugc nofollow" target="_blank"> 0.0.1-admin.js </a>文件并添加以下内容来手动创建我们的管理员用户:</p><figure class="lr ls lt lu gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="d43c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在如果你启动mongo并在你的终端上运行<code class="fe mp mq mr lw b">npm start</code>,你应该会看到下面的消息:</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="053e" class="ma mb iq lw b gy mc md l me mf">------------------------------------------------<br/>KeystoneJS Started:<br/>Keystone CMS is ready on <a class="ae kw" href="http://0.0.0.0:3000" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:3000</a><br/>------------------------------------------------</span></pre><p id="2e85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你跟踪那个链接，你会发现那里什么也没有。这很正常，我们实际上没有添加任何页面。你可以登录Keystone管理面板。为此，您需要访问<a class="ae kw" href="http://0.0.0.0:3000" rel="noopener ugc nofollow" target="_blank">http://0 . 0 . 0 . 0:3000</a>/keystone/sign in，并为您的管理员用户添加凭证。</p><figure class="lr ls lt lu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/7362f74a1565cbac168ad7c3b2eb960d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2bq9jN3LIwZnvN85WReo_A.jpeg"/></div></div></figure><p id="a874" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是我们现在启动并运行Keystone的原因，但是除了添加一些额外的用户之外，我们实际上没有什么可以做的。</p><p id="4c8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们通过创建另一个模型来解决这个问题，这个模型将保存一些数据…好了，让我们来做食谱</p><figure class="lr ls lt lu gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="5d78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果有些代码没有意义，可以直接跳到Keystone Js<a class="ae kw" href="http://keystonejs.com/docs/database/" rel="noopener ugc nofollow" target="_blank">database</a>guide来获得更多的信息。</p><p id="bd7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们再次登录，我们可以看到现在我们可以添加食谱，就是这么简单。</p><figure class="lr ls lt lu gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/5bf3b2025e5b4d6c761f9b88df195d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XrHokaE6lHdD_Fr_UKYleg.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">释放你内心的厨师，你现在可以在你的网站上添加食谱</figcaption></figure><p id="ede2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我认为这将是这个系列的第一部分。下一次我们将看到如何使用react和redux在前端展示我们的食谱。</p><h1 id="1959" class="mu mb iq bd mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-ii-842a85ebd9f7">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第二部分</a></h1><h1 id="6b97" class="mu mb iq bd mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-iii-4c8b991cc3f">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第三部分</a></h1></div></div>    
</body>
</html>