<html>
<head>
<title>Kubernetes OWASP Top 10: Intro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes OWASP十大:简介</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-owasp-top-10-intro-73943be7add2?source=collection_archive---------2-----------------------#2022-07-25">https://itnext.io/kubernetes-owasp-top-10-intro-73943be7add2?source=collection_archive---------2-----------------------#2022-07-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5460" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，<a class="ae kl" href="https://owasp.org" rel="noopener ugc nofollow" target="_blank"> OWASP基金会</a>介绍了他们在采用和实施Kubernetes时的最新十大风险。这个列表是一个很好的切入点，可以确保在Kubernetes上部署工作负载时引入的风险可以从一开始就得到缓解，从而实现安全的设计架构。</p><p id="f33b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本系列将贯穿前10大风险，更详细地介绍每个突出的风险，这些风险对您的应用程序和整体业务意味着什么，并提供一些模式和实践作为如何最好地减轻所呈现的风险的示例，从本简介和前10大风险的概述开始。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/c6f3ffdfb817a3138a4eb08323dcc51f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SVo0l2NSvsRXiLmj"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由<a class="ae kl" href="https://unsplash.com/@thomasbormans?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">托马斯·博曼斯</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="7461" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">OWASP Kubernetes十大</h1><h2 id="f111" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">不安全的工作负载配置</h2><p id="b176" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">默认情况下，Kubernetes清单旨在确保在尽可能短的时间内启动并运行所需的最少配置，从而降低准入门槛。跟随许多在线教程，甚至许多开源项目和舵图，许多基础知识已经完成，跳过了一些重要的安全考虑。一旦事情启动并运行，安全性通常是事后的想法，因此这些控制可能会被忽略，并且在初始开发后不会返回。</p><p id="1950" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例:</p><ul class=""><li id="2d70" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated"><a class="ae kl" href="https://docs.microsoft.com/en-us/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/build-aspnet-core-applications-linux-containers-aks-kubernetes#deploy-webapiyml" rel="noopener ugc nofollow" target="_blank"> AKS容器示例</a></li><li id="b8c6" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated"><a class="ae kl" href="https://docs.aws.amazon.com/eks/latest/userguide/sample-deployment.html" rel="noopener ugc nofollow" target="_blank"> EKS样本部署</a></li><li id="3197" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated"><a class="ae kl" href="https://github.com/Kong/charts/blob/e9c77a52a7ef4f90128ebff4d0fef6600fa6eda7/charts/kong/values.yaml#L757" rel="noopener ugc nofollow" target="_blank">空有证券的孔掌舵图</a></li></ul><p id="49c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦建立了安全基准，例如不应以root用户身份运行或不具有特权权限的pod，使用集中策略管理可以实施基准并拒绝未能遵守基准的部署。</p><h2 id="bd3d" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">供应链漏洞</h2><p id="8d60" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">软件供应链漏洞是整个开发者生态系统的一大风险，Kubenetes和containers对此也不例外。使用可能来自众多第三方来源的分层映像可能包括数百个第三方软件依赖项，每个依赖项都存在潜在风险。</p><p id="a594" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有多个步骤可以降低容器化应用程序中的这种风险，例如，图像签名(确保容器图像来自预期的作者)，针对容器和代码使用漏洞扫描器，如Snyk或Trivy或Clair等开源项目可以融入安全软件设计生命周期，并限制仅使用已知或专业的小型基础图像，如Scratch。</p><h2 id="71ca" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">过度宽松的RBAC配置</h2><p id="e35a" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">在任何Kubernetes部署中创建的第一个帐户是集群管理员。这实际上是超级用户，可以不受限制地访问集群的所有组件。限制集群管理的使用是减少攻击面和集群完整性风险的第一步。</p><p id="06c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其他缓解措施包括:仅在需要时而非默认情况下挂载服务帐户令牌，尽可能在ClusterRoleBindings上使用RoleBindings来限制访问范围，以及审核外部包以确保它们不会授予比所需更多的权限。</p><h2 id="e1ed" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">缺乏集中的政策执行</h2><p id="6c8f" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Kubernetes环境中可以采用的定制数量和密度为开发人员提供了极大的灵活性，可以充分利用容器化他们的应用程序。然而，这对于管理、审计和实施任何可能定义的安全设计模式来说会变得极其笨拙。</p><p id="e87c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes集群中，有可能从Docker Hub等公共存储库中提取数百个不同的图像，有些图像比其他图像更安全。如果群集资源受损，攻击者还可能会下载易受攻击的映像来建立权限提升或持久性。使用开源项目，如云提供商提供的网关守护设备或中央安全策略(例如Azure Defender for Containers策略)，可以强制要求仅从受信任的或由组织管理的内部注册表下载图像。</p><p id="04ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Gatekeeper之类的工具利用Kubernetes准入控制器来确保资源不会部署到不符合策略的集群。这是非常可扩展的，可以应用于任何可能存在风险的错误配置。</p><h2 id="6d4a" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">记录和监控不足</h2><p id="6be5" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Kubernetes部署上的日志记录和监控不足或过多会导致无法了解集群的各个组件级别发生了什么，或者暴露了敏感信息。</p><ul class=""><li id="0af8" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">Kubernetes审计日志——记录针对Kubernetes API的操作，包括登录尝试。</li><li id="3eb0" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">容器日志—应用程序级日志记录，通常会暴露敏感信息。使用安全的日志传送方法有助于降低这种风险。</li><li id="eac6" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">主机级日志—单个群集节点可以为其他日志提供更多上下文信息，对于调查至关重要。</li></ul><h2 id="7535" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">被破坏的身份验证方法</h2><p id="45e4" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Kubernetes中有两种主要的认证类型</p><ul class=""><li id="350b" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">操作员身份验证—用户登录并针对API执行手动交互</li><li id="7905" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">服务帐户身份验证—针对API的自动化任务</li></ul><p id="d7b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在任何环境中，身份验证都是一个复杂的话题，Kubernetes有自己的一些细微差别。通常，当用户第一次在集群中配置时，他将是集群管理员，并使用证书身份验证进行设置。但是，Kubernetes没有证书撤销的概念，因此如果证书泄漏，没有简单的方法可以在不重新发布集群中的整个证书链的情况下拒绝访问。</p><p id="7574" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用众所周知的身份标准(如OIDC ),可以将身份认证卸载给群集外的身份提供商，并允许使用MFA等附加控制来帮助降低风险。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/c29e54d8b4aac506aa6abb7f4980d1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hHjyIhmvnM2iyw10"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@flyd2069?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">飞:D </a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><h2 id="35f3" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">缺少网络分段控制</h2><p id="6db7" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Kubernetes网络的一个核心概念是，所有的pod都接收一个唯一的集群范围的IP地址，并且它们应该能够与任何主机上的任何其他pod通信，而不需要NAT。这简化并允许向后兼容，但是在安全性方面，默认情况下在网络级别没有工作负载隔离。这带来了风险，如容器之间的横向移动，或在违规情况下访问内部API。</p><p id="b724" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据工作负载和集群架构的类型，有多种创建网段的方式。</p><ul class=""><li id="b73c" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">多集群—这并不总是可行的，尤其是在微服务架构中，但是在多租户情况下，利用多个集群作为网络边界可以隔离工作负载。</li><li id="06c4" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">network policies——一种本地的Kubernetes类型，可以利用标签在pod和名称空间之间充当防火墙规则。但是，应该注意，为了能够实施网络策略，在大多数情况下需要使用CNI(容器网络接口)插件，例如Cilium或Project Calico。</li><li id="4ef2" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">服务网格—服务网格是Kubernetes网络的覆盖层，支持服务发现、mTLS和安全规则等可扩展功能。</li></ul><h2 id="41c4" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">机密管理失败</h2><p id="c715" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Kubernetes有一个本地秘密类型，这允许细粒度的访问控制，并确保只有需要访问适当秘密的实体才可以访问。Kubernetes的秘密是以base64编码存储的，<strong class="jp ir">而不是</strong>加密，这意味着任何有权读取特定秘密的人都可以解码它，并以明文形式查看它。这意味着需要小心确保秘密保密。</p><p id="e0de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes使用etcd作为其配置存储，并且能够对特定的对象类型进行加密。加密的使用意味着用户无意中获得了他们不应该看到的秘密，也需要有解密的能力。此外，应尽可能使用全磁盘加密对etcd实例进行静态加密，并注意确保备份时保持加密。</p><p id="e62b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes利用两种方法将秘密类型注入到容器中，作为环境变量或作为文件挂载。这两种方法各有利弊，但是使用环境变量意味着存在应用程序崩溃的风险，会将环境变量的详细信息(包括机密)以明文形式发送到日志中。</p><p id="4c41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">理想情况下，机密将在第三方secrets vault(如Azure KeyVault或Hashicorp Vault)中进行管理，并在运行时尽可能地注入，以便机密在不使用时不会存储在磁盘上。</p><h2 id="7fe0" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">错误配置的集群组件</h2><p id="f55e" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">像Kubernetes对象一样，集群组件是高度可配置的，并且通过一些额外的努力可以变得更加安全。Kubernetes由4种主要成分组成。</p><ul class=""><li id="bb1f" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">Kube-APIServer</li><li id="0767" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">Kube代理</li><li id="665e" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">库伯莱</li><li id="d0b4" class="mr ms iq jp b jq na ju nb jy nc kc nd kg ne kk mw mx my mz bi translated">etcd</li></ul><p id="cf40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些组件中的每一个都有由CIS(互联网安全中心)设定的最佳配置实践。这些基准可以针对集群运行，评估每个组件并给出如何使其更加安全的建议。</p><h2 id="de82" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">过时和易受攻击的Kubernetes组件</h2><p id="74c9" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">像所有软件一样，Kubernetes和外部集成组件容易受到攻击。补丁管理至关重要，不仅对Kubernetes和节点主机如此，对入口控制器和服务网格等其他附加组件也是如此，应在企业内使用的其他补丁管理程序中进行管理。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="e45d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，有很多东西需要发掘和消化。在这个系列中，我将更详细地讨论每一部分，强调风险和减轻这些风险的方法。</p></div></div>    
</body>
</html>