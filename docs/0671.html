<html>
<head>
<title>Building RESTful Web APIs with Node.js, Express, MongoDB and TypeScript — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js、Express、MongoDB和TypeScript构建RESTful Web APIs第3部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-3-d545b243541e?source=collection_archive---------0-----------------------#2018-05-03">https://itnext.io/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-3-d545b243541e?source=collection_archive---------0-----------------------#2018-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/6f6e6758220da47de8657a6864fa0ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*851XUx3o4XZaT-CC7MFkzw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">(图片来自OctoPerf)</figcaption></figure><p id="71f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一个关于<a class="ae kw" href="https://www.lynda.com/Node-js-tutorials/Next-steps/633869/671263-4.html" rel="noopener ugc nofollow" target="_blank">如何在Lynda </a>上构建Web APIs的课程，但是他们没有使用TypeScript。所以我决定用TypeScript做一个。这个项目中有许多需要改进的地方。如果你找到了，请留下评论。我很感激。)</p><p id="3fd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-1-2-195bdaf129cf" rel="noopener"> <strong class="ka ir">第一部分:设置项目</strong> </a></p><p id="4cf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-2-98c34e3513a2" rel="noopener"> <strong class="ka ir">第二部分:实现路由和CRUD </strong> </a></p><p id="2ebf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-3-d545b243541e" rel="noopener"> <strong class="ka ir">第3部分:为Web APIs使用控制器和模型</strong> </a></p><p id="7273" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4" rel="noopener"> <strong class="ka ir">第4部分:将Web APIs连接到MongoDB或其他</strong> </a></p><p id="fcc3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-5-a80e5a7f03db" rel="noopener"> <strong class="ka ir">第5部分:我们的Web APIs的安全性</strong> </a></p><p id="20e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-a-serverless-restful-api-with-cloud-functions-firestore-and-express-f917a305d4e6"> <strong class="ka ir">奖励:用云函数、Firestore和Express </strong> </a>构建“无服务器”RESTful API</p><p id="326f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/handling-long-running-api-requests-in-nodejs-403bd566d47"> <strong class="ka ir">奖励:在Nodejs </strong> </a>中处理长时间运行的API请求</p><p id="c74a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一部分中，我将向您展示如何使用控制器和模型来创建、保存、编辑和删除数据。记得在你前进之前阅读前面的部分。</p><p id="6390" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第一步:为您的数据创建模型</strong></p><p id="18f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有模型文件将保存在<strong class="ka ir"> /lib/models </strong>文件夹中。我们将通过使用来自mongose的<a class="ae kw" href="http://mongoosejs.com/docs/guide.html" rel="noopener ugc nofollow" target="_blank">模式来定义联系人的结构。</a></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="698e" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/models" rel="noopener ugc nofollow" target="_blank">models</a>/crmModel.ts</span><span id="3dd7" class="lg lh iq lc b gy lm lj l lk ll">import * as mongoose from 'mongoose';<br/><br/>const Schema = mongoose.Schema;<br/><br/>export const ContactSchema = new Schema({<br/>    firstName: {<br/>        type: String,<br/>        required: 'Enter a first name'<br/>    },<br/>    lastName: {<br/>        type: String,<br/>        required: 'Enter a last name'<br/>    },<br/>    email: {<br/>        type: String            <br/>    },<br/>    company: {<br/>        type: String            <br/>    },<br/>    phone: {<br/>        type: Number            <br/>    },<br/>    created_date: {<br/>        type: Date,<br/>        default: Date.now<br/>    }<br/>});</span></pre><p id="7239" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个模型将在我们将创建数据的控制器内部使用。</p><p id="68a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二步:创建你的第一个控制器</strong></p><p id="a5ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记得在<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-2-98c34e3513a2">第2部分</a>中，我们创建了CRUD占位符用于与服务器通信。现在我们将把真正的逻辑应用到路由和控制器上。</p><ol class=""><li id="a2ad" class="ln lo iq ka b kb kc kf kg kj lp kn lq kr lr kv ls lt lu lv bi translated"><strong class="ka ir">创建新联系人(发布请求)</strong></li></ol><p id="9263" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有的逻辑都会保存在<strong class="ka ir">/</strong><a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">lib</strong></a><strong class="ka ir">/</strong><a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">控制器</strong></a><strong class="ka ir">/CRM controller . ts</strong>中</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="aa02" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank">controllers</a>/crmController.ts</span><span id="2a60" class="lg lh iq lc b gy lm lj l lk ll">import * as mongoose from 'mongoose';<br/>import { ContactSchema } from '../models/crmModel';<br/>import { Request, Response } from 'express';<br/><br/>const Contact = mongoose.model('Contact', ContactSchema);</span><span id="74fd" class="lg lh iq lc b gy lm lj l lk ll">export class ContactController{<br/>...</span><span id="f8a7" class="lg lh iq lc b gy lm lj l lk ll">public addNewContact (req: Request, res: Response) {                <br/>        let newContact = new Contact(req.body);<br/>    <br/>        newContact.save((err, contact) =&gt; {<br/>            if(err){<br/>                res.send(err);<br/>            }    <br/>            res.json(contact);<br/>        });<br/>    }</span></pre><p id="1c26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在路线中，我们不必通过任何东西。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="e9fb" class="lg lh iq lc b gy li lj l lk ll"><br/>// /lib/routes/crmRoutes.ts</span><span id="3652" class="lg lh iq lc b gy lm lj l lk ll">import { ContactController } from "../controllers/crmController";</span><span id="d506" class="lg lh iq lc b gy lm lj l lk ll">public contactController: ContactController = new ContactController();</span><span id="ca08" class="lg lh iq lc b gy lm lj l lk ll">// Create a new contact<br/>app.route('/contact')<br/>   .post(this.contactController.addNewContact);</span></pre><p id="df1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。获取所有联系人(获取请求)</strong></p><p id="368e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有的逻辑都会保存在<strong class="ka ir">/</strong><a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">lib</strong></a><strong class="ka ir">/</strong><a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">控制器</strong></a><strong class="ka ir">/CRM controller . ts</strong>中</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="4419" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank">controllers</a>/crmController.ts</span><span id="93b8" class="lg lh iq lc b gy lm lj l lk ll">...</span><span id="8392" class="lg lh iq lc b gy lm lj l lk ll">public getContacts (req: Request, res: Response) {           <br/>        Contact.find({}, (err, contact) =&gt; {<br/>            if(err){<br/>                res.send(err);<br/>            }<br/>            res.json(contact);<br/>        });<br/>    }<br/>}</span></pre><p id="7b69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们将导入<strong class="ka ir"> ContactController </strong>并应用<strong class="ka ir"> getContacts </strong>方法。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0c7c" class="lg lh iq lc b gy li lj l lk ll">// /lib/routes/crmRoutes.ts</span><span id="4cf0" class="lg lh iq lc b gy lm lj l lk ll">// Get all contacts<br/>app.route('/contact')<br/>   .get(this.contactController.getContacts)</span></pre><p id="a212" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。查看单个联系人(获取方法)</strong></p><p id="ba63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要联系人的ID才能查看联系信息。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="ddf7" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank">controllers</a>/crmController.ts</span><span id="93ec" class="lg lh iq lc b gy lm lj l lk ll">public getContactWithID (req: Request, res: Response) {           <br/>        Contact.findById(req.params.contactId, (err, contact) =&gt; {<br/>            if(err){<br/>                res.send(err);<br/>            }<br/>            res.json(contact);<br/>        });<br/>    }</span></pre><p id="d82d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在路由中，我们简单地通过<strong class="ka ir"> '/contact/:contactId' </strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="913d" class="lg lh iq lc b gy li lj l lk ll">// /lib/routes/crmRoutes.ts</span><span id="2bf6" class="lg lh iq lc b gy lm lj l lk ll">// get a specific contact<br/>app.route('/contact/:contactId')<br/>   .get(this.contactController.getContactWithID)</span></pre><p id="d6a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4。更新单个联系人(PUT方法)</strong></p><p id="bda2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住，如果没有{new: true}，更新的文档将不会被返回。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="18e9" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank">controllers</a>/crmController.ts</span><span id="c354" class="lg lh iq lc b gy lm lj l lk ll">public updateContact (req: Request, res: Response) {           <br/>        Contact.findOneAndUpdate({ _id: req.params.contactId }, req.body, { new: true }, (err, contact) =&gt; {<br/>            if(err){<br/>                res.send(err);<br/>            }<br/>            res.json(contact);<br/>        });<br/>    }</span></pre><p id="564f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在路线中，</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="de38" class="lg lh iq lc b gy li lj l lk ll">// /lib/routes/crmRoutes.ts</span><span id="13d6" class="lg lh iq lc b gy lm lj l lk ll">// update a specific contact<br/>app.route('/contact/:contactId')<br/>   .put(this.contactController.updateContact)</span></pre><p id="57dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5。删除单个联系人(删除方法)</strong></p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0e6e" class="lg lh iq lc b gy li lj l lk ll">//   /<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib" rel="noopener ugc nofollow" target="_blank">lib</a>/<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript/tree/master/lib/controllers" rel="noopener ugc nofollow" target="_blank">controllers</a>/crmController.ts</span><span id="e46f" class="lg lh iq lc b gy lm lj l lk ll">public deleteContact (req: Request, res: Response) {           <br/>        Contact.remove({ _id: req.params.contactId }, (err, contact) =&gt; {<br/>            if(err){<br/>                res.send(err);<br/>            }<br/>            res.json({ message: 'Successfully deleted contact!'});<br/>        });<br/>    }</span></pre><p id="bfe7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在路线中，</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c4ef" class="lg lh iq lc b gy li lj l lk ll">// /lib/routes/crmRoutes.ts</span><span id="cf42" class="lg lh iq lc b gy lm lj l lk ll">// delete a specific contact<br/>app.route('/contact/:contactId')<br/>   .delete(this.contactController.deleteContact)</span></pre><p id="807e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">*请记住，您不必每次都调用app.route('/contact/:contactId ')来获取、放置或删除单个联系人。你可以把它们结合起来</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0aeb" class="lg lh iq lc b gy li lj l lk ll">// /lib/routes/crmRoutes.ts</span><span id="927c" class="lg lh iq lc b gy lm lj l lk ll">app.route('/contact/:contactId')<br/>   // edit specific contact<br/>   .get(this.contactController.getContactWithID)<br/>   .put(this.contactController.updateContact)<br/>   .delete(this.contactController.deleteContact)</span></pre><p id="3def" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，你的模型和控制器已经准备好了。我们将挂钩到MongoDB并测试Web APIs。这是<a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-3-d545b243541e" rel="noopener"> <strong class="ka ir">的结尾第三部</strong> </a>。我将很快更新<a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4" rel="noopener"> <strong class="ka ir">第四部</strong> </a> <strong class="ka ir">和</strong> <a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-5-a80e5a7f03db" rel="noopener"> <strong class="ka ir">第五部</strong> </a> <strong class="ka ir"> </strong>。以防你需要跳过一个头。请访问我的<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript" rel="noopener ugc nofollow" target="_blank"> github库</a>获取完整代码。</p><div class="lw lx gp gr ly lz"><a href="https://github.com/dalenguyen/rest-api-node-typescript" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">GitHub-dalen guyen/rest-API-node-typescript:用Node.js构建RESTful Web APIs，Express…</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">这是一个简单的API，保存人们的联系信息。这个项目有两个版本。1.0.0版:您可以…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn js lz"/></div></div></a></div><p id="6c91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://twitter.com/dale_nguyen" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">在Twitter上关注我</strong> </a>了解Angular、JavaScript &amp; WebDevelopment的最新内容👐</p></div></div>    
</body>
</html>