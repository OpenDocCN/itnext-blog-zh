<html>
<head>
<title>AWS EKS 101: Creating a Cluster and Deploying an App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS EKS 101:创建集群和部署应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/aws-eks-101-creating-a-cluster-and-deploying-an-app-9608a1cac016?source=collection_archive---------6-----------------------#2022-12-11">https://itnext.io/aws-eks-101-creating-a-cluster-and-deploying-an-app-9608a1cac016?source=collection_archive---------6-----------------------#2022-12-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0548aa3da901be6a369e4b7099f18ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y7CePJQsE9tLjTB-asoYew.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">AWS CDK</figcaption></figure><p id="e32e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本文中，我将向您展示如何使用AWS CDK创建AWS EKS集群并在其上部署应用程序。我们将为我们的EKS集群使用Fargate启动类型，这允许我们运行我们的容器，而不必管理底层EC2实例。</p><p id="6646" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，我们将从AWS CDK导入必要的库，包括<code class="fe ld le lf lg b">aws_eks</code>和<code class="fe ld le lf lg b">core</code>模块。然后，我们将创建一个新的CDK堆栈，并为我们的EKS集群定义一个新的VPC。这个VPC将为我们的集群提供网络基础设施，并允许我们的容器相互通信以及与外界通信。</p><p id="2727" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来，我们将创建EKS集群本身，指定Kubernetes版本和我们刚刚创建的VPC。我们还将为集群创建一个新的Fargate概要文件，它将指定集群中的哪些名称空间能够运行Fargate任务。</p><p id="6e84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦我们的集群建立起来，我们将使用<code class="fe ld le lf lg b">eks_patterns.Deployment</code>类在集群上创建一个新的部署。这个部署将基于我们将指定的Docker映像，并且我们还将为我们的容器设置内存限制。</p><p id="0387" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，我们将把部署公开为负载平衡服务，这将允许客户端通过网络访问我们的应用程序。该服务将自动向负载平衡器注册，并可通过AWS CDK为我们生成的DNS名称进行访问。</p><p id="1222" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">该代码将创建一个新的EKS VPC集群、Fargate概要文件以及集群上的部署。然后，它会将部署公开为一个负载平衡的服务，可供客户端访问。</p><pre class="lh li lj lk gt ll lg lm bn ln lo bi"><span id="0610" class="lp lq it lg b be lr ls l lt lu"># Import the necessary libraries<br/>from aws_cdk import (<br/>    aws_eks as eks,<br/>    core<br/>)<br/><br/># Create a new CDK stack<br/>class MyStack(core.Stack):<br/>    def __init__(self, scope: core.Construct, id: str, **kwargs):<br/>        super().__init__(scope, id, **kwargs)<br/><br/>        # Create a new VPC for the EKS cluster<br/>        vpc = ec2.Vpc(self, "MyVpc",<br/>            cidr="10.0.0.0/16",<br/>            max_azs=2<br/>        )<br/><br/>        # Create the EKS cluster<br/>        cluster = eks.EksCluster(self, "MyEksCluster",<br/>            vpc=vpc,<br/>            version=eks.KubernetesVersion.V1_18<br/>        )<br/><br/>        # Create a new Fargate profile for the EKS cluster<br/>        fargate_profile = cluster.add_fargate_profile("MyFargateProfile",<br/>            selectors=[{<br/>                "namespace": "default"<br/>            }]<br/>        )<br/><br/>        # Create a new deployment with the specified image<br/>        app = eks_patterns.Deployment(self, "MyApp",<br/>            cluster=cluster,<br/>            image=ecr_assets.DockerImageAsset(self, "MyImage",<br/>                directory="path/to/image/directory"<br/>            ),<br/>            memory_limit_mib=256<br/>        )<br/><br/>        # Expose the deployment as a load-balanced service<br/>        service = app.expose_as_load_balanced_service(<br/>            self, "MyService",<br/>            port=80,<br/>            target_port=8080<br/>        )</span></pre><p id="96fc" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦您创建了一个EKS集群，您也可以使用Kubernetes <code class="fe ld le lf lg b">kubectl</code>命令行工具将您的应用程序部署到其上。</p><p id="6b48" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，您需要将<code class="fe ld le lf lg b">kubectl</code>命令行工具认证到您的EKS集群。您可以通过运行以下命令来做到这一点，将<code class="fe ld le lf lg b">CLUSTER_NAME</code>替换为您的EKS集群的名称，将<code class="fe ld le lf lg b">REGION</code>替换为您的集群所在的区域:</p><pre class="lh li lj lk gt ll lg lm bn ln lo bi"><span id="073d" class="lp lq it lg b be lr ls l lt lu">aws eks --region REGION update-kubeconfig --name CLUSTER_NAME</span></pre><p id="e165" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦<code class="fe ld le lf lg b">kubectl</code>通过了EKS集群的认证，就可以使用<code class="fe ld le lf lg b">kubectl apply</code>命令将应用程序部署到集群。例如，如果您有一个名为<code class="fe ld le lf lg b">deployment.yaml</code>的Kubernetes部署配置文件，您可以通过运行以下命令将您的应用程序部署到EKS集群:</p><pre class="lh li lj lk gt ll lg lm bn ln lo bi"><span id="e5e0" class="lp lq it lg b be lr ls l lt lu">kubectl apply -f deployment.yaml</span></pre><p id="dd90" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">运行该命令后，您的应用程序应该已经部署并运行在您的EKS集群上。您可以通过使用<code class="fe ld le lf lg b">kubectl get</code>命令查看您的部署状态来验证这一点。例如，您可以运行以下命令来查看EKS集群中所有部署的状态:</p><pre class="lh li lj lk gt ll lg lm bn ln lo bi"><span id="be19" class="lp lq it lg b be lr ls l lt lu">kubectl get deployments</span></pre><p id="8060" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">总之，我们已经看到了使用AWS CDK创建AWS EKS集群并在其上部署应用程序是多么容易。通过使用Fargate启动类型，我们能够运行我们的容器，而不必管理底层EC2实例。我们还了解了如何使用kubectl命令行工具对EKS集群进行身份验证，并在其上部署我们的应用程序。</p><p id="bd4b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">借助EKS，您可以在AWS上轻松构建和运行可伸缩、安全的容器化应用程序。如果您不熟悉EKS和Kubernetes，我希望这篇文章为您提供了一个使用这些技术的良好起点。感谢您的阅读！</p><p id="5eb3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你喜欢这篇文章，我想你会想看看我的另一篇也与这个话题相关的文章:</p><p id="a290" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae lv" href="https://medium.com/itnext/how-to-create-a-multiple-stacks-aws-cdk-python-infrastructure-as-code-iac-project-e8a8defcd209" rel="noopener">如何创建多堆栈AWS CDK (Python)基础设施代码(IaC)项目| mer KARABACAK | it next(medium.com)</a></p><p id="56a2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">支持媒体和我:)</strong>T5】https://omerkarabacak.medium.com/membership</p></div></div>    
</body>
</html>