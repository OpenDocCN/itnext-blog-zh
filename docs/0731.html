<html>
<head>
<title>Simple Pattern for Paging or Looping Through Requests with Async/Await in Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript中使用Async/Await对请求进行分页或循环的简单模式</h1>
<blockquote>原文：<a href="https://itnext.io/simple-pattern-for-paging-or-looping-through-requests-with-async-await-in-javascript-4089f93678f8?source=collection_archive---------3-----------------------#2018-05-16">https://itnext.io/simple-pattern-for-paging-or-looping-through-requests-with-async-await-in-javascript-4089f93678f8?source=collection_archive---------3-----------------------#2018-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ad9ced3ebc4e80c7ee136481fe983521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TpX3qCEjOkm4WyOV."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kc" href="https://unsplash.com/@beccatapert?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Becca Tapert </a>拍摄的照片</figcaption></figure><p id="c87c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为提供一些Api用法示例的一部分，我编写了一个示例，包括如何使用async/await在API中分页。因为模式本身就说明了问题，所以我在这里就不赘述了。</p><p id="0597" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码可以被压缩和改进，但是为了清楚起见，我没有赘述，这不是重点。例如，不做:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="f603" class="lk ll iq lg b gy lm ln l lo lp">let response = await reqUsers(token, offset)<br/>records.push.apply(records, response)</span></pre><p id="4fb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以这样重构:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="0335" class="lk ll iq lg b gy lm ln l lo lp">records.push.apply(records, await reqUsers(token, offset))</span></pre><p id="83d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果不使用Async/Await，你将需要一个更沉闷的模式或递归。否则，您将会以并发的方式无休止地调用API。</p><p id="4c43" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更多的注释可以在文章的底部找到。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lq lr l"/></div></figure><h2 id="53e1" class="lk ll iq bd ls lt lu dn lv lw lx dp ly ko lz ma mb ks mc md me kw mf mg mh mi bi translated">注意事项:</h2><ul class=""><li id="bb04" class="mj mk iq kf b kg ml kk mm ko mn ks mo kw mp la mq mr ms mt bi translated">示例代码包括一个获取oAuth令牌的请求。这并不是示例的主要部分，但是我决定保留它，以防有人发现它有用。</li><li id="4857" class="mj mk iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">Go函数启动程序并填充顶部的users数组。如果这对您不起作用，您可以在函数的底部添加一个简单的return语句，并将users数组封装在函数中。</li></ul><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="b938" class="lk ll iq lg b gy lm ln l lo lp">const go = async () =&gt; {</span><span id="ed79" class="lk ll iq lg b gy mz ln l lo lp">let users = []</span><span id="4732" class="lk ll iq lg b gy mz ln l lo lp">// .... clipped for brevity<br/>// we're all done.  return the users array.</span><span id="c010" class="lk ll iq lg b gy mz ln l lo lp">return users;<br/>}</span></pre><ul class=""><li id="8d8c" class="mj mk iq kf b kg kh kk kl ko na ks nb kw nc la mq mr ms mt bi translated">不包括错误处理。在实际应用程序中，您可能希望用try/catch块来捕获错误。</li></ul><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2980" class="lk ll iq lg b gy lm ln l lo lp">try {<br/>   let payload = await request(userReq)</span><span id="1089" class="lk ll iq lg b gy mz ln l lo lp">} catch(err) {<br/>    // handle err  </span><span id="6bb0" class="lk ll iq lg b gy mz ln l lo lp">}</span></pre></div></div>    
</body>
</html>