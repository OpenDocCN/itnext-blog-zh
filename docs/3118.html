<html>
<head>
<title>Automate your integration tests and semantic releases with GitHub actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub动作自动化您的集成测试和语义发布</h1>
<blockquote>原文：<a href="https://itnext.io/automate-your-integration-tests-and-semantic-releases-with-github-actions-43875ad83092?source=collection_archive---------3-----------------------#2019-10-07">https://itnext.io/automate-your-integration-tests-and-semantic-releases-with-github-actions-43875ad83092?source=collection_archive---------3-----------------------#2019-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="31f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我最近将我的一个开源项目的CI/CD管道从Travis CI迁移到GitHub actions。我是较早获得GitHub Actions测试版的成员之一，作为回报，我愿意与社区分享我的迁移经验。</p><p id="ccd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank">本文所涉及的项目</a>和示例基于<strong class="jp ir"> node.js </strong>、<strong class="jp ir"> eslint </strong>、<strong class="jp ir"> TypeScript </strong>、<strong class="jp ir"> Jest、semantic-release </strong>和<strong class="jp ir"> npm </strong>栈。这些原则对于任何其他技术堆栈都是一样的，所以您应该也能够在自己的项目中使用类似的流程。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ae06dfe08fdb6ff4e9f4995b6fe671a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyJxyt62mr5Rbqw6C-houA.jpeg"/></div></div></figure><p id="24b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将重点构建两条管道；</p><ul class=""><li id="376e" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated"><strong class="jp ir"> CI </strong> —构建TypeScript node.js项目，链接代码并对项目运行测试</li><li id="69eb" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">发布</strong> —构建项目，并使用<a class="ae kl" href="https://semantic-release.gitbook.io/semantic-release/" rel="noopener ugc nofollow" target="_blank">语义发布</a>将npm包部署到npm存储库</li></ul><p id="ea10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无论您是<strong class="jp ir">从Travis CI迁移到GitHub actions </strong>还是<strong class="jp ir">从CircleCI迁移到GitHub actions </strong>还是<strong class="jp ir">在GitHub上开始一个新的开源项目</strong>，这篇文章都会让您的CI/CD之旅有一个良好的开端。</p><h1 id="9326" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">关于GitHub动作</h1><p id="ae06" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">GitHub宣布了自己的持续集成服务，作为Travis CI、Circle CI等服务的替代方案。</p><p id="3df1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它像Travis CI和Circle CI一样对开源项目是免费的，并且它与GitHub生态系统集成得很好。</p><p id="7e82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitHub在其持续集成环境中引入了一些概念。工作流、工作、步骤、动作、运行者、事件和工件等核心概念记录在<a class="ae kl" href="https://help.github.com/en/articles/about-github-actions#core-concepts-for-github-actions" rel="noopener ugc nofollow" target="_blank"> GitHub动作文档</a>中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/94f7dfc8f108f3d5d08d4672345fa084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kZWV710jWJOn0gKH4MS6qg.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">GitHub动作核心概念概述</figcaption></figure><p id="69a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想总结一下我们将在CI和CD渠道中使用的概念，以便更好地了解我们所处的生态系统。</p><h2 id="338f" class="mt ln iq bd lo mu mv dn ls mw mx dp lw jy my mz ma kc na nb me kg nc nd mi ne bi translated">工作流程</h2><p id="b8c0" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">工作流<strong class="jp ir"> </strong>基本都是管道，可以<strong class="jp ir"> </strong>在GitHub上构建、测试、打包、发布，或者部署任何项目。它们由一个或多个作业组成，可以通过事件来安排或激活。每个工作流必须由存储库中<code class="fe nf ng nh ni b">.github/workflows</code>文件夹下的YAML文件声明。</p><p id="c7b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nj">例如；</em> <code class="fe nf ng nh ni b">ci.yml</code> <em class="nj">表示配置项工作流，或者</em> <code class="fe nf ng nh ni b">release.yml</code> <em class="nj">表示发布工作流。</em></p><h2 id="fad1" class="mt ln iq bd lo mu mv dn ls mw mx dp lw jy my mz ma kc na nb me kg nc nd mi ne bi translated">乔布斯</h2><p id="2155" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">作业基本上是由步骤组成的任务。为每个作业创建一个全新的虚拟环境。工作的依赖关系和配置在工作流文件中声明。</p><p id="ce00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nj">例如；</em> <code class="fe nf ng nh ni b">build</code>作业<em class="nj">用于编译您的项目，或者</em> <code class="fe nf ng nh ni b">test</code> <em class="nj">作业用于执行单元/集成测试。</em></p><h2 id="f754" class="mt ln iq bd lo mu mv dn ls mw mx dp lw jy my mz ma kc na nb me kg nc nd mi ne bi translated">行动</h2><p id="5e55" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">动作基本上是任务，您可以将它们组合成创建作业的步骤。它们是工作流中最小的可移植构件。它提供了一个灵活的架构，因为您可以基于docker图像创建自己的操作，使用开源社区共享的操作，以及定制公共操作。为了在工作流中使用，操作必须作为一个步骤包含在内。</p><p id="8aa6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nj">例如；</em> <code class="fe nf ng nh ni b">actions/checkout</code>上一步<em class="nj">动作用于检查你的项目，或者</em>上一步<code class="fe nf ng nh ni b">actions/setup-node</code>动作<em class="nj">用于设置节点依赖。</em></p><h1 id="c203" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建集成工作流— CI</h1><p id="f634" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">在我们的环境中，我们将创建一个集成工作流，目标是:</p><ol class=""><li id="544f" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk nk le lf lg bi translated"><strong class="jp ir">安装</strong>我们的项目依赖关系到<em class="nj">安装并设置我们的工具集，以进行后续步骤</em>。</li><li id="683c" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk nk le lf lg bi translated"><strong class="jp ir">编译</strong>我们的类型脚本代码到<em class="nj">保证我们没有任何编译问题。</em></li><li id="2981" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk nk le lf lg bi translated"><strong class="jp ir">我们的打字稿代码的林挺</strong>用eslint对<em class="nj">保证我们维护特定的代码质量。</em></li><li id="802b" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk nk le lf lg bi translated"><strong class="jp ir">使用Jest对<em class="nj">的单元和集成测试对</em></strong>的功能进行测试，以确保我们的产品质量。</li></ol><p id="2456" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现我们的目标，我们需要在存储库的<code class="fe nf ng nh ni b">.github/workflows</code>文件夹下创建一个新的工作流文件。姑且称之为<code class="fe nf ng nh ni b">CI.yml</code>，用以下内容创建这个文件。</p><pre class="kn ko kp kq gt nl ni nm nn aw no bi"><span id="52d4" class="mt ln iq ni b gy np nq l nr ns">name: CI<br/><br/>on: [push]<br/><br/>jobs:<br/>  test:<br/>    name: Test on node ${{ matrix.node }} and ${{ matrix.os }}<br/><br/>    runs-on: ${{ matrix.os }}<br/><br/>    strategy:<br/>      matrix:<br/>        node: [8, 10, 12]<br/>        os: [ubuntu-latest, macOS-latest, <!-- -->windows-latest<!-- -->]<br/><br/>    steps:<br/>      - uses: actions/checkout@v1</span><span id="36a3" class="mt ln iq ni b gy nt nq l nr ns">      - name: Use node ${{ matrix.node }}<br/>        uses: actions/setup-node@v1<br/>        with:<br/>          node-version: ${{ matrix.node }}<br/>          registry-url: <a class="ae kl" href="https://registry.npmjs.org" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org</a></span><span id="3432" class="mt ln iq ni b gy nt nq l nr ns">      - name: install<br/>        run: npm install</span><span id="5210" class="mt ln iq ni b gy nt nq l nr ns">      - name: lint<br/>        run: npm run lint</span><span id="cfc5" class="mt ln iq ni b gy nt nq l nr ns">      - name: build<br/>        run: npm run build</span><span id="9074" class="mt ln iq ni b gy nt nq l nr ns">      - name: test<br/>        run: npm test</span></pre><blockquote class="nu"><p id="7259" class="nv nw iq bd nx ny nz oa ob oc od kk dk translated">您可能已经注意到，我为我正在使用的操作设置了特定的版本——actions/check out @ v1。当你在测试阶段处理一个工具时，这是一个好主意，否则它可能会引入突破性的变化。</p></blockquote><figure class="of og oh oi oj kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oe"><img src="../Images/f938894701c6444fd1941fc1a2322500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yc3d1FxkBi1gS2F3us_aQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated"><a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator/commit/fbd628d86a9b4f9839a5bb13699925ffc9a2e7bc/checks?check_suite_id=297499835" rel="noopener ugc nofollow" target="_blank"> pwa-asset-generator的CI运行演示——您可以在此处查看详细信息</a></figcaption></figure><p id="cb8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它为管道引入了节点和操作系统矩阵，这意味着测试作业将在3 x 3 = 9个环境中运行，即:</p><ul class=""><li id="9b74" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated"><strong class="jp ir">对node 8和ubuntu-latest的测试</strong></li><li id="d841" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在节点8和macOS上的测试-最新</strong></li><li id="c28c" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在node 8和windows上测试-最新</strong></li><li id="a57f" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">测试node 10和ubuntu-latest </strong></li><li id="cf9f" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在node 10和macOS上测试-最新</strong></li><li id="da5c" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在节点10和windows上的测试-最新</strong></li><li id="7d8a" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">对节点12和ubuntu-latest的测试</strong></li><li id="296c" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在节点12和macOS上的测试-最新</strong></li><li id="a7b6" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated"><strong class="jp ir">在节点12和windows上测试-最新</strong></li></ul><p id="7f28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此查看GitHub操作支持的环境的完整列表:<a class="ae kl" href="https://help.github.com/en/articles/virtual-environments-for-github-actions" rel="noopener ugc nofollow" target="_blank">https://help . GitHub . com/en/articles/virtual-environments-for-GitHub-actions</a></p><blockquote class="nu"><p id="ab70" class="nv nw iq bd nx ny ok ol om on oo kk dk translated">测试作业中的步骤也可以是单独的作业，但最好承认这将需要更多的时间来执行，因为我们需要剥离一个新的环境并为每个作业安装依赖项。</p></blockquote><blockquote class="op oq or"><p id="261a" class="jn jo nj jp b jq os js jt ju ot jw jx ou ov ka kb ow ox ke kf oy oz ki kj kk ij bi translated">您还可以基于cron安排您的运行，例如<strong class="jp ir">每夜构建</strong>。要了解更多关于工作流程的其他配置选项，请访问<a class="ae kl" href="https://help.github.com/en/articles/configuring-a-workflow" rel="noopener ugc nofollow" target="_blank">配置工作流程</a>文档。</p></blockquote><h1 id="2f15" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">使用语义发布创建自动化发布工作流— CD</h1><p id="3a3d" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我非常喜欢一键式部署，也就是持续部署。使用<a class="ae kl" href="https://semantic-release.gitbook.io" rel="noopener ugc nofollow" target="_blank">语义发布</a>为部署到npm的node.js项目设置CD管道非常容易。</p><p id="5519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们将创建一个发布工作流，目标是:</p><ol class=""><li id="d4f6" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk nk le lf lg bi translated"><strong class="jp ir">安装</strong>我们的项目依赖关系到<em class="nj">安装并设置我们的工具集，以进行后续步骤</em>。</li><li id="f406" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk nk le lf lg bi translated"><strong class="jp ir">将我们的类型脚本代码编译</strong>到<em class="nj">以确保我们已经准备好构建工件——我们上下文中的dist文件夹。</em></li><li id="c788" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk nk le lf lg bi translated"><strong class="jp ir">发布我们的工件的</strong>和语义——发布到<em class="nj">自动化发布我们主分支上的每个代码推送。</em></li></ol><p id="fac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现我们的目标，我们需要在存储库的<code class="fe nf ng nh ni b">.github/workflows</code>文件夹下创建一个新的工作流文件。姑且称之为<code class="fe nf ng nh ni b">release.yml</code>，用以下内容创建这个文件。</p><pre class="kn ko kp kq gt nl ni nm nn aw no bi"><span id="b6cb" class="mt ln iq ni b gy np nq l nr ns">name: Release<br/><br/>on:<br/>  push:<br/>    branches:<br/>      - master<br/><br/>jobs:<br/>  publish:<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v1</span><span id="f674" class="mt ln iq ni b gy nt nq l nr ns">      - uses: actions/setup-node@v1<br/>        with:<br/>          node-version: 12<br/>          registry-url: <a class="ae kl" href="https://registry.npmjs.org" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org</a></span><span id="82aa" class="mt ln iq ni b gy nt nq l nr ns">      - run: npm install</span><span id="b3df" class="mt ln iq ni b gy nt nq l nr ns">      - run: npm run build</span><span id="f134" class="mt ln iq ni b gy nt nq l nr ns">      - run: npx semantic-release<br/>        env:<br/>          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}<br/>          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}<br/>          GH_TOKEN: ${{ secrets.GH_TOKEN }}</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pa"><img src="../Images/1e308a79042eda97a6e9400ff23524d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUXXbUusH-_YKEOg_qcdmQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">在<a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator/commit/19cc7c446b5a1731a0c41bc1b300820f501d70da/checks?check_suite_id=240127658" rel="noopener ugc nofollow" target="_blank"> pwa-asset-generator上运行发布的演示——您可以在这里看到详细信息</a></figcaption></figure><h2 id="2c58" class="mt ln iq bd lo mu mv dn ls mw mx dp lw jy my mz ma kc na nb me kg nc nd mi ne bi translated">设置秘密</h2><p id="8d36" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">正如你可能已经注意到的，这里有为语义发布设置的秘密环境变量，这些变量是<em class="nj">将我们的包部署到npm </em>和<em class="nj">在我们的GitHub repo </em>上创建自动任务提交所必需的。</p><p id="7b05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在GitHub设置中设置这些机密，并在您的工作流程文件中以以下格式使用它们:${{ secrets。SECRET_NAME }}设置秘密；</p><ol class=""><li id="b60d" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk nk le lf lg bi translated">导航到GitHub repo的<strong class="jp ir">设置</strong>，点击左边栏的<strong class="jp ir">秘密</strong>菜单。然后点击<strong class="jp ir">添加新的秘密</strong>链接。</li></ol><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pb"><img src="../Images/abe2e956b865557dd38c151990cf5fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnHteYac7HxG5pFYLC3XgA.png"/></div></div></figure><p id="5c9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为您的秘密输入一个名称，稍后您将使用它作为工作流文件中的环境变量。</p><p id="1311" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.对<strong class="jp ir">NPM _令牌</strong>和<strong class="jp ir">GH _令牌</strong>机密重复同样的操作，这两个机密都是语义发布在NPM上自动发布和在GitHub上管理repo所必需的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pc"><img src="../Images/9c728d508a0602c332066bf98269c913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*406HPH2dq46VSnezOrCJcg.png"/></div></div></figure></div><div class="ab cl pd pe hu pf" role="separator"><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi pj"/><span class="pg bw bk ph pi"/></div><div class="ij ik il im in"><p id="afff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在你的npm控制台上创建你的npm令牌:<a class="ae kl" href="https://www.npmjs.com/settings/username/tokens" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/settings/username/tokens</a></p><p id="4a04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在您的GitHub个人资料上创建您的GitHub令牌:<a class="ae kl" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">https://github.com/settings/tokens</a></p><blockquote class="op oq or"><p id="44b5" class="jn jo nj jp b jq jr js jt ju jv jw jx ou jz ka kb ow kd ke kf oy kh ki kj kk ij bi translated">注意，典型的语义发布设置需要GitHub令牌上的这些权限:<em class="iq"> read:org，read:packages，repo，user:email，write:packages，write:repo_hook </em></p></blockquote><h1 id="9670" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">跳过日常工作提交的工作流运行</h1><p id="cadb" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">语义发布库在每个成功的发布之后自动执行一系列的任务提交。这些提交由<a class="ae kl" href="https://github.com/semantic-release/release-notes-generator" rel="noopener ugc nofollow" target="_blank">发布说明生成器</a>和<a class="ae kl" href="https://github.com/semantic-release/github" rel="noopener ugc nofollow" target="_blank"> github </a>插件自动完成，但不限于此——参见<a class="ae kl" href="https://semantic-release.gitbook.io/semantic-release/extending/plugins-list" rel="noopener ugc nofollow" target="_blank">插件完整列表</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pk"><img src="../Images/6ba4c8adbdfb639a65d28b8de717d2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrE0--AOFpoMymkR_CBZfg.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">在pwa-asset-generator中查看<a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator/search?q=chore&amp;type=Commits" rel="noopener ugc nofollow" target="_blank">所有标记有苦差事</a>的提交</figcaption></figure><p id="c84c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在repo中提交杂务之后，GitHub actions会运行一个额外的工作流，因为任何提交都会触发CI工作流的运行。</p><p id="81d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，没有必要运行额外的工作流，最好跳过由任何杂务提交导致的CI运行。正如您在上面可能注意到的，任务提交消息包括<strong class="jp ir">【skip ci】</strong>文本，由语义发布为每个任务提交添加。</p><p id="2c2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过在<strong class="jp ir">粗体</strong>中添加以下配置，我们可以配置GitHub动作来跳过包括<strong class="jp ir">【跳过ci】</strong>消息在内的所有杂务提交的运行；</p><pre class="kn ko kp kq gt nl ni nm nn aw no bi"><span id="ef09" class="mt ln iq ni b gy np nq l nr ns">name: Release<br/><br/>on:<br/>  push:<br/>    branches:<br/>      - master<br/><br/>jobs:<br/>  <strong class="ni ir">prepare:<br/>    runs-on: ubuntu-latest<br/>    if: "! contains(github.event.head_commit.message, '[skip ci]')"<br/>    steps:<br/>      - run: echo "${{ github.event.head_commit.message }}"</strong><br/><br/>  publish:<br/><strong class="ni ir">    needs: prepare</strong><br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v1</span><span id="30ef" class="mt ln iq ni b gy nt nq l nr ns">      - uses: actions/setup-node@v1<br/>        with:<br/>          node-version: 12<br/>          registry-url: <a class="ae kl" href="https://registry.npmjs.org" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org</a></span><span id="8b07" class="mt ln iq ni b gy nt nq l nr ns">      - run: npm install</span><span id="96ea" class="mt ln iq ni b gy nt nq l nr ns">      - run: npm run build</span><span id="8c42" class="mt ln iq ni b gy nt nq l nr ns">      - run: npx semantic-release<br/>        env:<br/>          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}<br/>          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}<br/>          GH_TOKEN: ${{ secrets.GH_TOKEN }}</span></pre><p id="9694" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的配置示例是针对<em class="nj">发布</em>工作流的，您也可以对您的<em class="nj"> CI </em>工作流使用相同的方法。</p><h1 id="b2e0" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">添加工作流程的状态徽章</h1><p id="7711" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">现在是有趣的部分了。每一个开源项目都应该得到一个徽章/盾牌，向他们的用户展示它得到了很好的维护。开源项目最受欢迎的标志之一是构建状态标志。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/a7d849a81cb7f790de7953e122b66e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*uGyivZ2sNwGw2oF0SOgJSg.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">你可以在这里找到很多不同厂商的盾牌:<a class="ae kl" href="https://shields.io/category/build" rel="noopener ugc nofollow" target="_blank">https://shields.io/category/build</a></figcaption></figure><p id="719b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GitHub动作为每个工作流提供了自己的状态徽章。正如你在我的项目<a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank"> pwa-asset-generator </a>上看到的，在<a class="ae kl" href="https://github.com/onderceylan/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank"> GitHub </a>和<a class="ae kl" href="https://www.npmjs.com/package/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank"> npm </a>上，它使用CI工作流徽章向用户显示所有集成测试都通过了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi pm"><img src="../Images/e0b6e82a39d3f8ac67abfca3e6c8e85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzT1hXu7ipxmLjq_w6e1WQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">在<a class="ae kl" href="https://www.npmjs.com/package/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank">pwa-asset-generator</a>readme上演示GitHub actions CI工作流徽章</figcaption></figure><p id="8b87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在项目中使用SVG图像链接，以此模式显示GitHub操作工作流程的徽章:</p><p id="e4fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://github . com/{ username }/{ repo }/workflows/{ workflow name }/badge . SVG</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/d5070e77daa1b4e6515d39586f81a581.png" data-original-src="https://miro.medium.com/v2/resize:fit:392/format:webp/1*8lbEwWMaJeY6uoaw8-j5gg.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">SVG链接显示您的工作流状态以及您的工作流名称</figcaption></figure><p id="9723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是badge的减价，您可以在项目的自述文件中使用它；</p><pre class="kn ko kp kq gt nl ni nm nn aw no bi"><span id="07cf" class="mt ln iq ni b gy np nq l nr ns">![Build Status](https://github.com/{username}/{repo}/workflows/{workflowname}/badge.svg)</span></pre><p id="2671" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是徽章的降价，并链接到您的共同行动；</p><pre class="kn ko kp kq gt nl ni nm nn aw no bi"><span id="4527" class="mt ln iq ni b gy np nq l nr ns">[![Build Status](https://github.com/{username}/{repo}/workflows/{workflowname}/badge.svg)](https://github.com/{username}/{repo}/actions)</span></pre><blockquote class="op oq or"><p id="13b3" class="jn jo nj jp b jq jr js jt ju jv jw jx ou jz ka kb ow kd ke kf oy kh ki kj kk ij bi translated">GitHub actions目前有一个问题，如果最近运行被跳过，在您的状态徽章上显示最新的工作流状态。</p><p id="6d8b" class="jn jo nj jp b jq jr js jt ju jv jw jx ou jz ka kb ow kd ke kf oy kh ki kj kk ij bi translated">我向GitHub 报告了<a class="ae kl" href="https://github.community/t5/GitHub-Actions/Badge-shows-no-status-when-latest-run-is-skipped/m-p/36710#M2660" rel="noopener ugc nofollow" target="_blank">这个问题。如果你和我一样，认为状态徽章应该在跳过的跑步之前显示最近一次跑步的状态，请随意对这个问题给予表扬。</a></p></blockquote><h1 id="103b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">恭喜你！</h1><p id="682a" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">你成功了！现在您有了一个在GitHub actions上运行的项目的自动化集成和部署管道。</p><p id="61ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你需要任何关于CI/CD设置的帮助，你可以在推特上给我留言。干杯！</p></div></div>    
</body>
</html>