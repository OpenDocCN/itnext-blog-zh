<html>
<head>
<title>Tutorial: Build a React, Firebase and Google Cloud Vision machine learning API app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:构建一个React、Firebase和谷歌云视觉机器学习API应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/tutorial-build-a-react-firebase-and-google-cloud-vision-machine-learning-api-app-in-1-hour-e7eb7584aed4?source=collection_archive---------0-----------------------#2018-06-10">https://itnext.io/tutorial-build-a-react-firebase-and-google-cloud-vision-machine-learning-api-app-in-1-hour-e7eb7584aed4?source=collection_archive---------0-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2213" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将学习哪些技术/库？</p><ul class=""><li id="a8c0" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">Firebase (Firestore、功能、存储、谷歌认证、托管、数据库安全、存储安全)</li><li id="c510" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">谷歌云视觉机器学习API</li><li id="60fb" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使用Firebase的谷歌认证</li><li id="9f46" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">反应(创建-反应-应用程序)</li><li id="8e84" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">无服务器功能(使用Firebase功能)</li><li id="956b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">异步/等待</li></ul><p id="19b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我将建造什么？</strong></p><p id="6776" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">演示:【http://doppelganger-app.firebaseapp.com/ T4】</p><p id="63ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代号:<a class="ae kz" href="https://bitbucket.org/bochrane/doppel-app" rel="noopener ugc nofollow" target="_blank">https://bitbucket.org/bochrane/doppel-app</a></p><p id="453c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">designs:<a class="ae kz" href="https://drive.google.com/file/d/1H_c7IBZG5Ggvns1MmPPQn5Tqik5w3Cfb/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">https://drive . Google . com/file/d/1H _ c 7 ibzg 5 ggvns 1 mppqn 5 tqik 5 w3 CFB/view？usp =分享</a></p><p id="6ec2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的视频展示了我们将要建造的东西</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">这是您将要构建和部署的内容(29秒的剪辑)</figcaption></figure><p id="7abe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你将使用firebase函数创建一个react应用程序，上传你自己的照片，然后返回一个长得像你的人的图像列表——根据谷歌认为你长得像谁:)</p><p id="f545" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这个教程有多长？</strong>如果你独自编码，1-2个小时，如果你只是想阅读，大约20-30分钟</p><p id="5071" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我刚刚构建了一个企业应用程序，它使用Firebase为一家建筑公司预订建筑设备，它所提供的东西给我留下了深刻的印象，我想展示一些Firebase在几年前可能需要几个月才能完成的东西。</p><p id="85b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:如果你希望看到与Google Cloud Vision API对话的完整工作的无服务器函数，你需要在教程的后面输入一个有效的信用卡到Firebase——不要担心，虽然你不会被收费，除非你使用大量的函数调用，我们在本教程中不会接近这些函数调用。</strong></p><p id="8c86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，我们如何构建这个应用程序，这些二重身图像来自哪里？</p><p id="d95f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">下面是我们将要使用的:</strong></p><ul class=""><li id="22a9" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">Google Cloud Vision API(图像的机器学习API)将提供一个预先训练的模型，分析我们上传的任何图像，并提供一个与我们上传的图像相似的图像列表——非常整洁！</li><li id="299b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Firebase函数(是的，我们也将在本教程中学习无服务器函数——如果你还没有遇到它们，我们很快就会知道它们是什么)</li><li id="45a9" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Firebase Storage(用于存储我们上传的图像)和Firebase Firestore(Firebase的新实时非sql数据库)</li><li id="a4a3" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">为前端应用做出反应</li><li id="463a" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Google登录(使用Firebase内置的Google认证)</li></ul><p id="5402" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还包含了草图设计文件和Invision可点击原型——我发现使用这两个工具来提前设计和制作我想要构建的原型要容易得多。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/3af0c774d201e601c0121ad1228b5dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:134/format:webp/1*-3uAZ1kgLFYxCmyf0Ch4uQ.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><a class="ae kz" href="https://drive.google.com/file/d/1H_c7IBZG5Ggvns1MmPPQn5Tqik5w3Cfb/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">草图文件</a></figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/dcebc75ed37351c9e771d9d7d40fd032.png" data-original-src="https://miro.medium.com/v2/resize:fit:110/format:webp/1*XvAbh8WXSwYhllmJ26YuHg.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><a class="ae kz" href="https://projects.invisionapp.com/share/W2JK3G9AZXP#/299468172_My_Doppels" rel="noopener ugc nofollow" target="_blank">视觉可点击原型</a></figcaption></figure><div class="lp lq gp gr lr ls"><a href="https://projects.invisionapp.com/share/W2JK3G9AZXP#/screens/299468172_My_Doppels" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab fo"><div class="lu ab lv cl cj lw"><h2 class="bd ir gy z fp lx fr fs ly fu fw ip bi translated">点击此处查看“二重身”项目</h2><div class="lz l"><h3 class="bd b gy z fp lx fr fs ly fu fw dk translated">这个由InVisionApp带给你的原型</h3></div><div class="ma l"><p class="bd b dl z fp lx fr fs ly fu fw dk translated">projects.invisionapp.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg lm ls"/></div></div></a></div><p id="dcd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，在本教程中我们会涉及到很多内容，我很高兴能与您分享这些内容。制作这个应用程序后，我最大的体会是，使用机器学习API创建大规模应用程序的能力变得非常简单。现在来看教程…</p><p id="9bc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我们将把教程分解如下:</strong></p><ol class=""><li id="fcd6" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mh kr ks kt bi translated">设置react应用程序(我们将使用create-react-app)</li><li id="52ce" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">配置我们的Firebase应用程序</li><li id="b203" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">设置Google身份验证</li><li id="bd4b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">设置Firebase存储、Firestore和添加映像</li><li id="cd79" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">设置Firebase函数，允许在我们上传新图像时触发无服务器函数</li><li id="5ba4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">在Firebase函数中设置Google Vision API，从它的API中请求类似的图像</li><li id="e7cf" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">用我们的应用程序测试我们的Google Vision API</li><li id="50b4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk mh kr ks kt bi translated">部署到Firebase的一个实时工作的应用程序-哇！</li></ol><h1 id="28db" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated"><strong class="ak"> 1。设置react应用程序</strong></h1><p id="3f41" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">首先，确保您已经安装了<a class="ae kz" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>(至少版本6)</p><p id="63b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用脸书的<a class="ae kz" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>来构建react应用程序。</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="c5d7" class="nq mj iq nm b gy nr ns l nt nu">npm install -g yarn<br/>npx create-react-app my-doppelganger-app<br/>cd my-doppelganger-app<br/>yarn start</span></pre><p id="89c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行“npm start”后，您应该会看到这个屏幕</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/10988ac5588df915e3cdfba09d45ab2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jb4vw9KKy74inoiTmT3ojQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">运行npm start后，您应该会看到此屏幕</figcaption></figure><p id="6bc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在src文件夹中创建3个文件夹，如下所示:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="926c" class="nq mj iq nm b gy nr ns l nt nu">mkdir src/features src/config src/helpers</span></pre><p id="0ed3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后让我们为登录、主页和相册设置一些虚拟组件</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="ee40" class="nq mj iq nm b gy nr ns l nt nu">cd features</span><span id="f675" class="nq mj iq nm b gy oa ns l nt nu">touch Login.js Home.js</span></pre><p id="cdb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在src/features/Login.js中添加一个虚拟组件:</p><p id="efeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Login.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="aa04" class="nq mj iq nm b gy nr ns l nt nu">import React, { Component } from 'react';</span><span id="e60f" class="nq mj iq nm b gy oa ns l nt nu">export default class Login extends Component {<br/> render() {<br/>  return (<br/>   &lt;div&gt;this is my Login component&lt;/div&gt;<br/>  );<br/> }<br/>}</span></pre><p id="cbc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对Home组件进行同样的操作:</p><p id="f8df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="d1c7" class="nq mj iq nm b gy nr ns l nt nu">import React, { Component } from 'react';</span><span id="b9ee" class="nq mj iq nm b gy oa ns l nt nu">export default class Home extends Component {<br/> render() {<br/>  return (<br/>   &lt;div&gt;this is my Home component&lt;/div&gt;<br/>  );<br/> }<br/>}</span></pre><p id="78ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们为应用程序设置路线。首先我们将安装<a class="ae kz" href="https://github.com/ReactTraining/react-router/tree/master/packages/react-router" rel="noopener ugc nofollow" target="_blank"> react-router </a>和<a class="ae kz" href="https://github.com/ReactTraining/react-router/tree/master/packages/react-router-dom" rel="noopener ugc nofollow" target="_blank"> react-router-dom </a>:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="301c" class="nq mj iq nm b gy nr ns l nt nu">yarn add react-router react-router-dom</span></pre><p id="af18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在src/index.js中，我们将添加它们并设置我们的路线:</p><p id="6dd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/index.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="a85f" class="nq mj iq nm b gy nr ns l nt nu">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import registerServiceWorker from './registerServiceWorker';</span><span id="915f" class="nq mj iq nm b gy oa ns l nt nu">import { Redirect, Route, Switch } from 'react-router';<br/>import { Router } from 'react-router-dom';<br/>import createBrowserHistory from 'history/createBrowserHistory';</span><span id="cf09" class="nq mj iq nm b gy oa ns l nt nu">import Login from './features/Login';<br/>import Home from './features/Home';</span><span id="570c" class="nq mj iq nm b gy oa ns l nt nu">const customHistory = createBrowserHistory();</span><span id="1c95" class="nq mj iq nm b gy oa ns l nt nu">const Root = () =&gt; {<br/> return (<br/>  &lt;Router history={customHistory}&gt;<br/>   &lt;Switch&gt;<br/>    &lt;Route path="/login" component={Login} /&gt;<br/>    &lt;Route path="/app/home" component={Home} /&gt;<br/>    &lt;Redirect from="/" to="/login" /&gt;<br/>   &lt;/Switch&gt;<br/>  &lt;/Router&gt; <br/> )<br/>}</span><span id="d975" class="nq mj iq nm b gy oa ns l nt nu">ReactDOM.render(&lt;Root /&gt;, document.getElementById('root'));<br/>registerServiceWorker();</span></pre><p id="b14a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在应该在浏览器中看到登录组件:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/019a31e741d4ba3243df1d49b6815fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*eMEL-WykE5EsCwqvSxcboA.png"/></div></figure><p id="40e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们可以通过手动转到主路由来测试我们的路由工作，以确保它们正常工作:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oc"><img src="../Images/5f2894bfab695d1860ffecd42c5c8b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dReJK2Hnn2x0y4e7bySPDA.png"/></div></div></figure><p id="bbff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们的路由已经工作了，我们可以开始设计我们的登录组件了:</p><p id="5b4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将<a class="ae kz" href="https://firebasestorage.googleapis.com/v0/b/doppelganger-app.appspot.com/o/google-icon-white.png?alt=media&amp;token=ff891c5f-f2a4-441e-b457-d71b9b21762f" rel="noopener ugc nofollow" target="_blank">使用这个png </a>作为按钮。</p><p id="9f27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将把这个png文件上传到Firebase存储器。因此，首先，我们需要用谷歌帐户登录firebase，然后创建一个新的Firebase应用程序</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi od"><img src="../Images/f41b6244c033e1b3c63d392da5ee6db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Tvs83Q2shrvM4PgpPT89g.png"/></div></div></figure><p id="f00c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后转到左侧导航栏上的“存储”,按“开始”。然后，您将看到您的存储桶的默认安全性规则—下面显示默认安全性是只要用户登录就允许访问任何文档。出于我们的目的，我们想让一些图像允许注销用户查看我们的谷歌登录按钮和背景图像的登录页面。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oe"><img src="../Images/3a02bfdebddcb05d1d72de5b40f3a7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yngPYuohoqRrji1AbqHD7w.png"/></div></div></figure><p id="11af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们改变这些规则，允许任何人查看任何图像(我们稍后将锁定它)。</p><p id="fac0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在“存储”的“规则”选项卡中，按如下方式更改规则:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="51b2" class="nq mj iq nm b gy nr ns l nt nu">service firebase.storage {<br/>  match /b/{bucket}/o {<br/>    match /{allPaths=**} {<br/>      allow read, write;<br/>    }<br/>  }<br/>}</span></pre><p id="589e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，将按钮图像上传到存储器</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi of"><img src="../Images/916ac439509697f93adc9055f2c5fc6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oApp0knTCEkqtNvwK63aVA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">单击存储中的文件，然后按上传文件</figcaption></figure><p id="b7eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在单击图像行后，通过单击文件位置下拉菜单，复制刚刚上传的图像的下载URL</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi og"><img src="../Images/b90022cc739c7a003dddc5e375a237b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LavVzX8s1ZH0J2l7UK5IRw.png"/></div></div></figure><p id="c9b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以将将要制作的div的背景图像设置为Google图像，如下所示:</p><p id="29c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Login.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="a5ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面，我们已经包含了一个使用firebaseAuth()的loginWithGoogle helper方法。firebase为我们提供了signInWithRedirect(googleProvider)方法，传递给该方法的Google provider位于config.constants.js中，它只是firebase . auth . Google auth provider()的一个新实例。</p><p id="d122" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们使用localStorage登录Google时，我们还展示了一个简单的加载屏幕。</p><p id="8f69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> index.css </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="4bae" class="nq mj iq nm b gy nr ns l nt nu">html {<br/> margin: 0;<br/> width: 100%;<br/>}</span><span id="3f8f" class="nq mj iq nm b gy oa ns l nt nu">body {<br/>  margin: 0;<br/>  padding: 0;<br/>  font-family: sans-serif;<br/>  max-width: 768px;<br/>  margin: 0 auto;<br/>  height: 100vh;<br/>  width: 100%;<br/>}</span><span id="b057" class="nq mj iq nm b gy oa ns l nt nu">.login-button {<br/> height: 100px;<br/> width: 100%;<br/> position: fixed;<br/> bottom: 0;<br/> background: black;<br/> max-width: 768px;<br/> margin: 0 auto;<br/>}</span><span id="5606" class="nq mj iq nm b gy oa ns l nt nu">.login-container { <br/> background: #FFC107;<br/> width: 100%;<br/> height: 100vh;<br/>}</span><span id="8a39" class="nq mj iq nm b gy oa ns l nt nu">.button-text {<br/> position: relative;<br/> font-size: 25px;<br/> color: white;<br/> line-height: 50px;<br/> left: 90px;<br/>}</span><span id="06ec" class="nq mj iq nm b gy oa ns l nt nu">.google-logo {<br/> height: 50px;<br/> float: left;<br/> background-size: contain;<br/> background-repeat: no-repeat; <br/> margin: 25px 20px;<br/>}</span><span id="31a1" class="nq mj iq nm b gy oa ns l nt nu">#root {<br/> width: 100%;<br/> height: 100vh;<br/>}</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oi"><img src="../Images/e5f6e391618d9e5a53d53a83ea0f91e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BaeCyK8KXoGPP_k2D0mQsQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">对于登录组件，我们现在应该看到类似这样的内容</figcaption></figure><p id="4394" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将在归途中创建虚拟数据，以显示我们的doppelgnger feed将会是什么样子</p><p id="1760" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将把react-bootstrap用于我们的网格系统</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="8e37" class="nq mj iq nm b gy nr ns l nt nu">yarn add react-bootstrap</span></pre><p id="9f05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将以下内容添加到src/features/Home.js中</p><p id="4c78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="b577" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的Home.js中，你会看到我们添加了React Bootstrap，包括图像、网格、行和列组件。我们现在还添加了一组虚拟图像，并将其设置为“所有照片”的初始状态。</p><p id="fd84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们最终的return语句之前，我们使用build it JavaScript“map”方法遍历我们在初始状态下设置的所有照片。每次我们遍历一张照片时，我们都会创建一个html片段，其中动态地包含了这张照片的细节。</p><p id="2e29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并将这个css添加到index.css(这将是我们的应用程序需要的所有css)</p><p id="0870" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> index.css </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="ba3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让图标和react-bootstrap正常工作，我们需要添加材质图标cdn和react-bootstrap css文件。</p><p id="2f81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">index.html</strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="ba79" class="nq mj iq nm b gy nr ns l nt nu">&lt;link rel="manifest" href="%PUBLIC_URL%/manifest.json"&gt;<br/>&lt;link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico"&gt;</span><span id="f015" class="nq mj iq nm b gy oa ns l nt nu">...</span><span id="a623" class="nq mj iq nm b gy oa ns l nt nu">&lt;link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"&gt;</span><span id="cc79" class="nq mj iq nm b gy oa ns l nt nu">&lt;link rel="stylesheet" href="<a class="ae kz" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css</a>" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"&gt;</span><span id="4583" class="nq mj iq nm b gy oa ns l nt nu">...</span></pre><p id="ed20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在应该看到我们的虚拟照片列表以及底部的导航栏，如下所示:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oj"><img src="../Images/3077c542d467c3f234cd55cda79a8ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*34B1WfAr_BZAIEf6JaOYUA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">添加我们的虚拟图像后，我们应该在/app/home route中看到这个——不要担心——我们很快会用自己的照片去掉Phil Murray的脸</figcaption></figure><p id="fa4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的index.html现在应该是这样的:</p><p id="c80c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> public/index.html </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><h1 id="8f48" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">2.配置我们的Firebase应用程序</h1><p id="2225" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">接下来，让我们在React应用程序中设置Firebase应用程序。</p><p id="b114" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，转到firebase控制台，单击左上角导航栏中的“项目概述”。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ok"><img src="../Images/cf152775f80dd4ba57ad008effc85d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*55_1VUcQI-XeW5Mr-I3wiA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">您的Firebase控制台</figcaption></figure><p id="bc20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后单击“将Firebase添加到您的web应用程序”按钮，并复制在模式弹出窗口中弹出的代码。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ol"><img src="../Images/b9de7ce5e4dc1358d955e13dc5bf75a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1YVhugQRwcDSGPmar2B0dw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">按“将Firebase添加到您的web应用程序”将您的Firebase详细信息复制并粘贴到React应用程序中</figcaption></figure><p id="8c3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在src/config/constants.js中创建一个配置文件</p><p id="b49e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/config/constants.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="a019" class="nq mj iq nm b gy nr ns l nt nu">import firebase from 'firebase';</span><span id="446c" class="nq mj iq nm b gy oa ns l nt nu">const config = {<br/>    apiKey: "AIzaSyBBaJIkRtF3jgzFF7BC83G6nI9joZKxezg",<br/>    authDomain: "doppelganger-app.firebaseapp.com",<br/>    databaseURL: "https://doppelganger-app.firebaseio.com",<br/>    projectId: "doppelganger-app",<br/>    storageBucket: "doppelganger-app.appspot.com",<br/>    messagingSenderId: "115334021919"<br/>};</span><span id="78de" class="nq mj iq nm b gy oa ns l nt nu">firebase.initializeApp(config);</span><span id="9d31" class="nq mj iq nm b gy oa ns l nt nu">export const googleProvider = new firebase.auth.GoogleAuthProvider();<br/>export const firebaseAuth = firebase.auth;<br/>export const db = firebase.firestore().settings({ timestampsInSnapshots: true });</span></pre><p id="b3da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面，我们使用了firebase应用程序的配置细节。我们还添加了来自firebase的Google Auth provider，它将允许我们通过Google登录。最后，我们建立了Firebase数据库—在这种情况下，我们将使用Firestore，这是一个新的实时文档存储库。我们在firestore设置中添加了一个设置，它将create_at时间戳保存为firestore时间戳，而不是常规的日期对象。</p><p id="0c3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要安装firebase以及firebase CLI (firebase-tools)，如下所示(我选择了Firebase tools的特定版本，以确保该应用程序为您工作，就像它为我工作一样，但如果您愿意，可以随意使用最新版本):</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="968f" class="nq mj iq nm b gy nr ns l nt nu">npm install -g firebase-tools@3.17.4</span></pre><p id="e933" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还将在我们的应用程序中本地安装firebase:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="eaec" class="nq mj iq nm b gy nr ns l nt nu">yarn add firebase@5.0.2</span></pre><p id="b047" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们在终端中本地设置firebase:</p><p id="6f08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(注意:我在我的终端上使用了<a class="ae kz" href="https://github.com/robbyrussell/oh-my-zsh" rel="noopener ugc nofollow" target="_blank"> Oh-My-Zsh </a>，这使得语法更好，我在Mac上的标准终端应用程序上使用了绿色主题，只需进入终端- &gt;首选项- &gt;选择草地，然后点击默认使用该主题)</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="8e87" class="nq mj iq nm b gy nr ns l nt nu">firebase login</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi om"><img src="../Images/822cd2364db4387f3dedb1b66e3dc2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NffAGX0mHtDZ0rNshZbuSA.png"/></div></div></figure><p id="009c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后你会在一个新的浏览器中看到一个谷歌登录弹出窗口——继续使用你注册Firebase时使用的gmail帐户进行验证。</p><p id="2f01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您通过终端登录，我们可以设置此应用程序为Firebase应用程序，如下所示:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="cd23" class="nq mj iq nm b gy nr ns l nt nu">firebase init</span></pre><p id="bf2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">系统会提示您回答几个问题，请使用这些答案:</p><ol class=""><li id="8d30" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mh kr ks kt bi translated">你会看到5个选项，勾选我们想要的，按空格键和上下移动到我们想要的选项。按空格键为Firestore，功能，主机和存储(我们将不需要数据库，因为这是旧的实时数据库，我们将使用Firestore数据库)</li></ol><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi on"><img src="../Images/3cab9e027c580d89c09fbffe57bb0fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SGS26SdgSq0Prnq5Srd-Hw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">在上面选择的选项上按空格键来选择它们。</figcaption></figure><p id="40b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.假设我们已经登录，我们现在可以在下一个问题的列表中找到我们在Firebase中创建的项目:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oo"><img src="../Images/cd5b6d8049d0ae65544a47333c850b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pgmEQLeEwNN4pDkbCXk4A.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">向下箭头指向Firebase中您想要使用的项目，然后按Enter键</figcaption></figure><p id="60d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.按Enter键接受以下步骤的默认设置(下图看起来相似，但对于我们的Firebase应用程序来说是不同的设置问题:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi op"><img src="../Images/d20dbe01c39b4dc2189776c91406cf22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ior_E3onqGLuQ9jQ1nrhrQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">按Enter键接受此默认值</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oo"><img src="../Images/ec0eb9f9ff6630f16b310f9235e4f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lbie2MdmD-OBQFU2S1CEpg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">按Enter键接受此默认值</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oq"><img src="../Images/c7df1811a16f0590963c65fb7fde8a37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHcCnmY5etDsxTcT5DzwDA.png"/></div></div></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi or"><img src="../Images/40f3164f17727b397b91b625b5e54450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEaWuMa5G3uMLBtM6994wQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">我不会使用ESLint，所以我会选择n并按回车键，但您也可以按Y并按回车键来使用它</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi os"><img src="../Images/f94ecc64fe0a06003038afd354bdefe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G0q2Cvta7gS4sn1pWF1laQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">y并回车安装软件包</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oq"><img src="../Images/0372c95a3bad8bec27b1096c68811630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMOCxxRTjRus4SpuqDJ0tA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">键入build将我们的应用程序发送到一个名为build的目录，firebase将为我们部署这个目录</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ot"><img src="../Images/526f4d8b2657ab7a55f200a2da55a2cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5DyLpclif1u7_n8g5EVpQ.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">按Enter键接受默认值</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi or"><img src="../Images/e739069752f0a053f308f0372daffff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8I66qUvd3snfjhf24oQ8w.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">按Enter键接受默认值</figcaption></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ou"><img src="../Images/3ed3762ae6a749831b2c9f27f2991cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMRZNuXV6hxKHyVzPUOy2g.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">我们被设置为Firebase应用程序！</figcaption></figure><p id="f32a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们被设置为Firebase应用程序——哇哦！</p><p id="c6cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会注意到添加了许多新的文件和文件夹。这些文件的简要概述如下:</p><p id="211e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">a.。firebaserc文件——这允许firebase知道使用哪个应用程序，并将给出一个类似default的名称，该名称将指向您在firebase控制台中命名的firebase应用程序</p><p id="9c38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">b.firebase.json —这使firebase知道在哪里可以找到我们可以在应用程序中定义的规则文件，我们创建的数据库索引(firebase预先索引我们的数据库以使过滤更快—我们将在本教程的后面介绍这一点)以及firebase将部署到web的构建文件夹的位置—使用create-react-app，我们稍后将运行npm run build的一个命令，该命令将使用webpack生成一个构建文件夹。</p><p id="0cc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">c.firestore . indexes . JSON——如前所述，这是我们定义数据库索引的地方，这样可以更快地过滤各种预索引的集合</p><p id="8703" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">d.storage . rules——我们已经在线更改了firebase控制台中的存储规则，但是一旦我们部署了该应用程序，它们将被该文件中的存储规则覆盖，因此现在让我们更改该文件以反映我们在firebase控制台中所做的事情。只需确保您的storage.rules文件如下所示:</p><p id="180b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">存储规则</strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="9845" class="nq mj iq nm b gy nr ns l nt nu">service firebase.storage {<br/>  match /b/{bucket}/o {<br/>    match /{allPaths=**} {<br/>      allow read, write;<br/>    }<br/>  }<br/>}</span></pre><p id="0ac4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">e.您还会看到一个名为functions的新文件夹。这就是我们无服务器功能的发展方向——激动人心的时刻！我们将在后面的教程中讨论这些。</p><p id="2991" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是新的文件和文件夹，现在我们将设置Firebase存储，以便保存一些图像。</p><p id="7685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要提示:在我们继续之前，如果您使用Github或Bitbucket等git源代码控件来保存您的工作，请确保您将/functions/node_modules添加到您的。gitignore文件如下:</p><p id="5494" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">。gitignore </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="eeaa" class="nq mj iq nm b gy nr ns l nt nu">...</span><span id="1d26" class="nq mj iq nm b gy oa ns l nt nu"># dependencies<br/>/node_modules<br/><strong class="nm ir">/functions/node_modules</strong></span><span id="8250" class="nq mj iq nm b gy oa ns l nt nu"># testing<br/>/coverage</span><span id="1af4" class="nq mj iq nm b gy oa ns l nt nu">...</span></pre><h1 id="c9da" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">3.设置Google身份验证</h1><p id="4531" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">接下来，我们将设置能够使用Firebase的内置<a class="ae kz" href="https://firebase.google.com/docs/auth/web/google-signin" rel="noopener ugc nofollow" target="_blank">谷歌认证提供商</a>登录和注销我们的应用程序。</p><p id="f9d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将设置我们的auth.js助手文件:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="d781" class="nq mj iq nm b gy nr ns l nt nu">touch src/helpers/auth.js</span></pre><p id="7b10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/helpers/auth.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="0be2" class="nq mj iq nm b gy nr ns l nt nu">import { firebaseAuth, googleProvider } from '../config/constants';</span><span id="8a20" class="nq mj iq nm b gy oa ns l nt nu">export function loginWithGoogle() {<br/> return firebaseAuth().signInWithRedirect(googleProvider);<br/>}</span><span id="afdd" class="nq mj iq nm b gy oa ns l nt nu">export function logout() {<br/> return firebaseAuth().signOut();<br/>}</span></pre><p id="b315" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的auth.js文件将创建两个登录Firebase的Google auth provider和注销的方法。</p><p id="3c6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将更新Login.js文件，如下所示:</p><p id="3e30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Login.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="588b" class="nq mj iq nm b gy nr ns l nt nu">import React, { Component } from 'react';<br/>import { loginWithGoogle } from '../helpers/auth';<br/>import { firebaseAuth } from '../config/constants';</span><span id="88f3" class="nq mj iq nm b gy oa ns l nt nu">const firebaseAuthKey = 'firebaseAuthInProgress';<br/>const appTokenKey = 'appToken';</span><span id="4da9" class="nq mj iq nm b gy oa ns l nt nu">export default class Login extends Component {</span><span id="f0c0" class="nq mj iq nm b gy oa ns l nt nu">constructor(props) {<br/>        super(props);<br/>        this.state = { splashScreen: false };<br/>        this.handleGoogleLogin = this.handleGoogleLogin.bind(this);<br/>    }</span><span id="f5e8" class="nq mj iq nm b gy oa ns l nt nu">handleGoogleLogin() {<br/>     loginWithGoogle()<br/>     .catch(err =&gt; {<br/>      localStorage.removeItem(firebaseAuthKey)<br/>     });</span><span id="d33d" class="nq mj iq nm b gy oa ns l nt nu">// this will set the splashscreen until its overridden by the real firebaseAuthKey<br/>     localStorage.setItem(firebaseAuthKey, '1');<br/>    }</span><span id="94f6" class="nq mj iq nm b gy oa ns l nt nu">componentWillMount() {</span><span id="e269" class="nq mj iq nm b gy oa ns l nt nu">// checks if we are logged in, if we are go to the home route<br/>        if (localStorage.getItem(appTokenKey)) {<br/>            this.props.history.push('/app/home');<br/>            return;<br/>        }</span><span id="6d8c" class="nq mj iq nm b gy oa ns l nt nu">firebaseAuth().onAuthStateChanged(user =&gt; {<br/>         if (user) {<br/>          localStorage.removeItem(firebaseAuthKey);<br/>          localStorage.setItem(appTokenKey, user.uid);<br/>          this.props.history.push('/app/home')<br/>         }<br/>        })<br/>    }</span><span id="dd3a" class="nq mj iq nm b gy oa ns l nt nu">render() {</span><span id="00d4" class="nq mj iq nm b gy oa ns l nt nu">if (localStorage.getItem(firebaseAuthKey) === '1') <br/>   return &lt;Splashscreen /&gt;;<br/>  return &lt;LoginPage handleGoogleLogin={this.handleGoogleLogin} /&gt;;</span><span id="31f3" class="nq mj iq nm b gy oa ns l nt nu">}<br/>}</span><span id="275f" class="nq mj iq nm b gy oa ns l nt nu">// this is the URL we copied from firebase storage<br/>const loginButtonUrl = '<a class="ae kz" href="https://firebasestorage.googleapis.com/v0/b/doppelganger-app.appspot.com/o/google-icon-white.png?alt=media&amp;token=ff891c5f-f2a4-441e-b457-d71b9b21762f'" rel="noopener ugc nofollow" target="_blank">https://firebasestorage.googleapis.com/v0/b/doppelganger-app.appspot.com/o/google-icon-white.png?alt=media&amp;token=ff891c5f-f2a4-441e-b457-d71b9b21762f'</a>;</span><span id="f3f9" class="nq mj iq nm b gy oa ns l nt nu">const styles = {<br/> backgroundImage: `url(${loginButtonUrl})`<br/>}</span><span id="8537" class="nq mj iq nm b gy oa ns l nt nu">const LoginPage = ({ handleGoogleLogin }) =&gt; (</span><span id="0f29" class="nq mj iq nm b gy oa ns l nt nu">&lt;div className="login-container"&gt;<br/>  &lt;div onClick={handleGoogleLogin} className="login-button"&gt;<br/>   &lt;div style={styles} className="google-logo"&gt;<br/>    &lt;span className="button-text"&gt;Sign In With Google&lt;/span&gt;<br/>   &lt;/div&gt;<br/>  &lt;/div&gt;<br/> &lt;/div&gt;</span><span id="20eb" class="nq mj iq nm b gy oa ns l nt nu">)</span><span id="c2a7" class="nq mj iq nm b gy oa ns l nt nu">const Splashscreen = () =&gt; (&lt;p&gt;Please Wait Loading...&lt;/p&gt;);</span></pre><p id="fff2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这里添加了很多代码，所以让我们一步步来。</p><ul class=""><li id="3193" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">我们导入了loginWithGoogle helper方法</li><li id="7eab" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">在我们的构造函数中，我们最初隐藏了闪屏，我们还绑定了handleGoogleLogin函数，这样我们就可以在组件中使用它，而不需要从组件内部绑定它</li><li id="a6de" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">handleGoogleLogin函数调用我们导入的预构建的loginWithGoogle函数(我们对成功结果不感兴趣，因为无论如何它都会成功地转到主页，所以我们现在只是捕捉错误)</li><li id="2795" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们使用componentDidMount React生命周期方法来监听组件何时挂载，因为我们需要知道是否有登录的用户。我们还使用Firebase内置的onAuthStateChanged方法，该方法检查页面重新加载等情况何时发生，并返回当前登录的用户</li><li id="5fdd" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们使用localStorage来检查登录是否正在加载，在这种情况下显示闪屏组件，否则显示登录组件</li><li id="db0c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们为LoginPage使用了一个功能组件，并且我们还向该组件传递了一个参数，这是handleGoogleLogin方法，当我们单击Login按钮时，它可以使用该方法</li></ul><p id="1a02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们对此进行测试之前，我们需要转到Firebase控制台，打开Google作为应用程序的身份验证选项。</p><p id="e193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经在应用程序中尝试了Google auth，但它卡在闪屏上，请进入浏览器的控制台，删除刚刚设置的localStorage项目:</p><p id="21a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在你的浏览器控制台上运行这个，如果它卡在闪屏上:</strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="e430" class="nq mj iq nm b gy nr ns l nt nu">localStorage.removeItem("firebaseAuthInProgress")</span></pre><p id="9f70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Firebase控制台中，转到“身份验证”,然后单击“设置登录方法”</p><p id="a986" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Firebase控制台&gt;身份验证&gt;登录方法&gt; Google</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ov"><img src="../Images/35d1ee5f5c7fda3d357660a605688a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iedv6yeaLPxOFjRMA9t97Q.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">允许身份验证方法的Firebase身份验证区域</figcaption></figure><p id="6008" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后点击谷歌并将启用切换到开，然后<strong class="jp ir">按保存</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ow"><img src="../Images/a366f7e94685c426bf2938d8e8a89bf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwigFL9fT8RZw783lZ1BAw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">在Firebase的身份验证区域启用Google auth</figcaption></figure><p id="bca0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你现在应该在按下你的谷歌登录按钮时得到一个谷歌认证屏幕——哇哦！</p><p id="a24b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们也开始工作吧。</p><p id="7d16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在src/features/Home.js中，在整个代码中添加以下内容:</p><p id="2a66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="cd24" class="nq mj iq nm b gy nr ns l nt nu">...<br/>import { logout } from '../helpers/auth';<br/>...</span><span id="8181" class="nq mj iq nm b gy oa ns l nt nu">// inside of the constructor<br/>constructor() {</span><span id="2d57" class="nq mj iq nm b gy oa ns l nt nu">   ...<br/>   this.handleLogout = this.handleLogout.bind(this);<br/>   ...</span><span id="86f9" class="nq mj iq nm b gy oa ns l nt nu">}</span><span id="d549" class="nq mj iq nm b gy oa ns l nt nu">handleLogout() {<br/>        logout()<br/>        .then(() =&gt; {<br/>            localStorage.removeItem(appTokenKey);<br/>            this.props.history.push("/login");<br/>            console.log("user signed out from firebase");            <br/>        }.bind(this));<br/>}</span><span id="1f48" class="nq mj iq nm b gy oa ns l nt nu"><br/>// then in the logout icon (the final Col in the Grid of icons) add a logout method like this:</span><span id="7c24" class="nq mj iq nm b gy oa ns l nt nu">...<br/>&lt;Col onClick={this.handleLogout} xs={4} className="col-bottom"&gt;<br/>          &lt;i className="bottom-icon material-icons"&gt;assignment_return&lt;/i&gt;<br/>&lt;/Col&gt;<br/>...</span></pre><p id="d851" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以Home.js应该是这样的:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="8f61" class="nq mj iq nm b gy nr ns l nt nu">import React, { Component } from 'react';<br/>import { Image, Grid, Row, Col } from 'react-bootstrap';<br/>import { Link } from 'react-router-dom';<br/>import { logout } from '../helpers/auth';</span><span id="7bf9" class="nq mj iq nm b gy oa ns l nt nu">const appTokenKey = "appToken";<br/>export default class Home extends Component {</span><span id="7dab" class="nq mj iq nm b gy oa ns l nt nu">constructor(props) {<br/>        super(props);</span><span id="8814" class="nq mj iq nm b gy oa ns l nt nu">const allPhotos = [<br/>         {<br/>          id: 'randomstringimadeup43454356546',<br/>          url: '<a class="ae kz" href="http://fillmurray.com/200/200'" rel="noopener ugc nofollow" target="_blank">http://fillmurray.com/200/200'</a><br/>         },<br/>         {<br/>          id: 'randomstringimadeup43523526534565',<br/>          url: '<a class="ae kz" href="http://fillmurray.com/200/200'" rel="noopener ugc nofollow" target="_blank">http://fillmurray.com/200/200'</a><br/>         },<br/>         {<br/>          id: 'randomstringimadeup433245234534',<br/>          url: '<a class="ae kz" href="http://fillmurray.com/200/200'" rel="noopener ugc nofollow" target="_blank">http://fillmurray.com/200/200'</a><br/>         }                  <br/>        ]</span><span id="0eca" class="nq mj iq nm b gy oa ns l nt nu">this.state = {<br/>          allPhotos<br/>        };</span><span id="09b0" class="nq mj iq nm b gy oa ns l nt nu">this.handleLogout = this.handleLogout.bind(this);</span><span id="78ca" class="nq mj iq nm b gy oa ns l nt nu">}</span><span id="1244" class="nq mj iq nm b gy oa ns l nt nu">handleLogout() {<br/>        logout()<br/>        .then(() =&gt; {<br/>            localStorage.removeItem(appTokenKey);<br/>            this.props.history.push("/login");<br/>            console.log("user signed out from firebase");            <br/>        });<br/>    }</span><span id="9084" class="nq mj iq nm b gy oa ns l nt nu">render() {</span><span id="9384" class="nq mj iq nm b gy oa ns l nt nu">// our doppelganger images<br/>        const allImages = this.state.allPhotos.map(photo =&gt; {</span><span id="4d7f" class="nq mj iq nm b gy oa ns l nt nu">return (<br/>            &lt;div key={photo.id}&gt;<br/>              &lt;div style={{minHeight: '215px'}}&gt;<br/>                &lt;i className="bottom-icon material-icons main-close"&gt;close&lt;/i&gt;<br/>                &lt;Image style={{ width: '100%' }} src={photo.url} responsive /&gt;<br/>              &lt;/div&gt;<br/>            &lt;/div&gt;<br/>          );<br/>        })</span><span id="2f25" class="nq mj iq nm b gy oa ns l nt nu">return (<br/>   &lt;div&gt;<br/>    {allImages}</span><span id="90f3" class="nq mj iq nm b gy oa ns l nt nu">&lt;Grid className="bottom-nav"&gt;<br/>      &lt;Row className="show-grid"&gt;<br/>        &lt;Col xs={4} className="col-bottom"&gt;<br/>            &lt;Link to="/app/album"&gt;&lt;i className="bottom-icon material-icons"&gt;collections&lt;/i&gt;&lt;/Link&gt;<br/>        &lt;/Col&gt;<br/>        &lt;Col xs={4} className="col-bottom"&gt;<br/>            &lt;i className="bottom-icon material-icons"&gt;camera_alt&lt;/i&gt;<br/>        &lt;/Col&gt;<br/>        &lt;Col onClick={this.handleLogout} xs={4} className="col-bottom"&gt;<br/>          &lt;i className="bottom-icon material-icons"&gt;assignment_return&lt;/i&gt;<br/>        &lt;/Col&gt;<br/>      &lt;/Row&gt;<br/>    &lt;/Grid&gt;</span><span id="3756" class="nq mj iq nm b gy oa ns l nt nu">&lt;/div&gt;<br/>  );<br/> }<br/>}</span></pre><p id="f0ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你应该可以使用Google auth登录和注销你的应用了——干得好——你知道吗…</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/76d8d15b030b1d954236a8d3f4070830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*kkykhuqe_iC7kM3TsimnoQ.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">菲尔·默里是这么说的:)</figcaption></figure><h1 id="7644" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">4.设置Firebase存储、Firestore和添加映像</h1><p id="f6f8" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">在这一节中，我们将底部导航栏中的中间按钮，当按下时，会提示我们上传图像，该图像将保存到Firebase存储中。我们走吧！</p><p id="bb18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在将使用一个名为<a class="ae kz" href="https://github.com/fris-fruitig/react-firebase-file-uploader" rel="noopener ugc nofollow" target="_blank">react-firebase-file-uploader</a>的文件上传器包，所以让我们先安装它:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="9c7b" class="nq mj iq nm b gy nr ns l nt nu">yarn add react-firebase-file-uploader</span></pre><p id="79d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们安装好了，把文件上传器JSX添加到Home.js，你的中间导航栏按钮的位置如下:</p><p id="1685" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">文件上传者JSX片段</strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="918f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还将创建“handleUploadSuccess”函数(我们可以看到，当文件成功上传时，该函数在上面的FileUploader代码片段中执行。它将返回刚刚上传到Firebase Storage的图像的一系列详细信息，我们将把这个图像url保存到我们即将在Firebase Firestore数据库(也称为文档存储)中创建的名为“照片”的新集合中。</p><p id="196a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">handleUploadSuccess函数将如下所示:</p><p id="dd61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> handleUploadSuccess.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="9e0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过上面的2处修改后，我们的Home.js文件现在应该是这样的:</p><p id="951a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="276c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们解释一下“handleUploadSuccess”方法(或函数——无论你想怎么称呼它)以及文件上传器JSX片段。</p><ol class=""><li id="4880" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk mh kr ks kt bi translated">HandleUploadSuccess</li></ol><ul class=""><li id="9075" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">handleUploadSuccess方法是从FileUploader jsx代码片段上名为“onUploadSuccess”的prop中启动的</li><li id="378b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们使用ES7 async-await语法，这是一种更好的承诺方式。现在，我们可以在函数前面加上“async”这个词，在我们通常想要添加的任何东西前面加上“await”这个词，而不是“then-ing”和“catch-ing”。然后“到。这对于清理我们的代码，而不是到处都是承诺是很棒的</li><li id="4632" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">有了async-await语法，我们现在可以使用try-catch块来检查错误。try块包装了我们所有的async-await代码，如果任何一段await代码有错误，它将把这个错误和发生的错误一起扔进catch块，在这个例子中我称之为“err”</li><li id="37cf" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我还使用了来自ES6的<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank">析构语法</a>，它允许我提取一个对象的特定部分，你可以看到我在上面的代码片段中使用它来获得<strong class="jp ir">桶</strong>和<strong class="jp ir">完整路径</strong>值。(存储桶和完整路径是照片上的元数据，描述照片在我们的存储桶中的位置，这对于了解从哪里访问我们的照片以在我们的应用程序中显示照片非常重要)</li><li id="e9df" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">有了照片信息和用户信息，我们就可以创建一个“新照片”对象来保存到我们的Firestore集合中，这个集合叫做“照片”</li></ul><p id="3183" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">需要采取的行动:</strong></p><p id="933e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让我们的应用程序运行并将这张新照片不仅保存到Firestore存储中，还将其作为条目添加到我们数据库中的照片集合中，我们需要从Firebase控制台设置Firestore，如下所示:</p><p id="0815" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到Firebase控制台&gt;数据库</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oy"><img src="../Images/72590e8f87e226828d9b6c7618a63eed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*duAiZZvVBhrw4-0hncL9tg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">单击左边的云Firestore Beta入门(实时数据库是Firebase的旧文档存储，Firestore在查询文档的速度和能力方面有了显著的改进)</figcaption></figure><p id="daf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将询问您想要什么样的数据库安全设置—选择“在测试模式下启动”,然后按“启用”。这将允许未经认证的用户进行读写操作——但鉴于这是一个测试应用程序，我们现在就让它保持原样。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi oz"><img src="../Images/c1e496facd2aff7cba50a73f48f97b99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N36cE-Wnvw1wW3T3WgIYwQ.png"/></div></div></figure><p id="7511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经启用了数据库，让我们通过按下底部导航中的中间按钮来测试上传照片到应用程序。</p><p id="fd29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果成功，您应该会看到一些控制台日志，并且能够查看Firebase中的存储和数据库，看到如下内容:</p><p id="0161" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">浏览器控制台日志:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pa"><img src="../Images/93fedb6debc02b8cf235ab215f047230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5RGR6o4JZdzMu-0x1tjgA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">如果您保留了上面示例片段中的控制台日志，您可能会看到这些控制台日志，显示我们成功地将照片添加到存储中，并在我们的照片数据库列表中使用了该照片的url</figcaption></figure><p id="5d9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">存储:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pb"><img src="../Images/debe53c1202f611e13a5a4202230b67a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8DtfuFNnWq7ooTLk_D59g.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">您应该可以在存储区的列表中看到您刚刚上传的照片的名称</figcaption></figure><p id="4168" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Firestore照片系列:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi nv"><img src="../Images/c8cefc438096b9b8f7eb291e80494a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EdyvmeBHCciNYMdomUWOTg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">您应该能够在Firestore中看到您添加到照片收藏中的新照片的详细信息</figcaption></figure><p id="4511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干得好！</p><p id="c7be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本节的最后一部分是获取我们保存在数据库中的照片列表，并在屏幕上显示它们。我们目前正在使用一组模拟图像(感谢Phil Murray——但你在我们的应用程序中的时间到了)。</p><p id="fb86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们使用componentDidMount React生命周期方法从我们的Firebase Firestore照片集合中获取图像。</p><p id="a4af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了获得一组初始照片，我们将使用。get方法(稍后对于实时更新，我们也将包括Firestore的onSnapshot方法)</p><p id="15d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> componentDidMount方法:</strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="5ee7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们的应用程序应该能够显示我们像这样上传的图像(在重新加载后，当然这是我们接下来要修复的):</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pc"><img src="../Images/3eaf01c307b91b8d6441454d083792f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-zXIvBo7_EU1C6YGS61Vg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">到目前为止，这是我们的应用程序，我们可以上传图像，但仍然需要刷新才能看到它们，接下来我们来解决这个问题</figcaption></figure><p id="0fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您会注意到，在我们的componentDidMount方法中，我们使用了另一个名为getInitial的方法，它将为我们获取所有的照片。getInitial的好处在于它是一个倾听者，而不是一次性获取照片。因此，每当我们对照片集合进行更改时，它也会自动更新我们的前端照片列表。我们正在使用Firestore的内置<a class="ae kz" href="https://firebase.google.com/docs/firestore/query-data/listen?authuser=2" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">快照</strong> </a>方法来允许实时更新——哇！</p><p id="00b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还会注意到，在getInitial方法中，我们确保在请求照片之前有一个登录的用户。我们使用内置的Firebase auth方法<a class="ae kz" href="https://firebase.google.com/docs/auth/web/manage-users" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">onAuthStateChanged</strong></a>来确保有人登录。</p><p id="f727" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尝试添加另一个——这一次，一旦它到达数据库，它应该会出现在应用程序中——很好！</p><p id="72fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干得好！我们就要有一个可以工作的二重身应用程序了。现在让我们让无服务器功能工作起来，然后将它们连接到Google Vision API——这样我们就完成了。</p><p id="6590" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的Home.js文件现在应该如下所示:</p><p id="d384" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">这就是我们的src/features/Home.js现在的样子</figcaption></figure><h1 id="4d7e" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">5.设置Firebase函数，允许在我们上传新图像时触发无服务器函数</h1><p id="4f75" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">我们现在将使用无服务器功能，允许我们编写服务器端代码，这些代码将连接到Google Vision API，以检查谁看起来像我们。</p><p id="4273" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你还没有了解无服务器运动，https://serverless.com/learn/<a class="ae kz" href="https://serverless.com/learn/" rel="noopener ugc nofollow" target="_blank">的一些优秀的初学者可以帮助你开始。</a></p><p id="3e5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，无服务器运动不仅仅是编写无服务器功能，它还允许开发人员更多地关注业务逻辑，而不是基础设施和设置。无服务器是一个有点误导的名字，因为仍然有服务器支持你的应用。只是作为一名开发人员，很多设置和扩展工作都要处理好(无论如何，在早期——无服务器有很多功能，但也有自己隐藏的缺陷，如监控和冷启动，这些功能每天都在改进)。</p><p id="353e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢把无服务器函数想象成我们可能编写的任何后端函数。只是这些功能都有自己的小服务器，等待运行。</p><p id="bc91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您运行这些函数时，它们会旋转自己的各种迷你容器，通常持续几毫秒到6秒，有时甚至更长，这取决于您的函数。一旦您完成了该函数的执行，微型容器就会关闭。您需要为使用的内存量和毫秒执行时间付费。你可能会听到人们谈论Lambda的无服务器功能，因为AWS Lambda是第一批让无服务器功能成为开发人员主流的产品之一(尽管不是第一个)。</p><p id="c7ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Firebase函数是另一个使用谷歌云平台的无服务器函数。</p><p id="b097" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，关于无服务器函数已经说得够多了，本，让我们只写一些…</p><p id="cc81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等等，为什么我们又要写一个无服务器函数？</p><p id="5a61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们希望与Google Vision API进行对话，以提供一个图像列表，该列表看起来像我们上传到照片集合的任何图像。</p><p id="6ebc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们开始吧…</p><p id="c262" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">消防基地功能</strong></p><p id="c0fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你在主应用程序中还看不到函数文件夹，那么让我们从firebase函数文档<a class="ae kz" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank">https://firebase.google.com/docs/functions/get-started</a>中为你设置一个如下的函数文件夹(如果你在本教程的早些时候就开始学习并在设置中要求函数，这将不会适用)</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="cc0a" class="nq mj iq nm b gy nr ns l nt nu">firebase init functions</span></pre><p id="97c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们应该会看到一个名为<strong class="jp ir"> functions </strong>的文件夹，里面有一个名为<strong class="jp ir"> index.js </strong>的文件</p><p id="8170" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这个index.js文件中还看不到太多东西，但是在这里我们可以编写所有将部署到Google云平台的无服务器函数。</p><p id="f36a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的应用程序有一个package.json。我们的函数文件夹也有自己的package.json，它也是独立的，是我们将要编写的服务器端代码需要的节点模块。让我们设置无服务器功能所需的节点模块:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="41f6" class="nq mj iq nm b gy nr ns l nt nu">cd functions</span></pre><p id="c616" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，添加必要的节点模块，包括<a class="ae kz" href="https://github.com/googleapis/nodejs-vision" rel="noopener ugc nofollow" target="_blank">谷歌云视觉API节点模块</a></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="ad2e" class="nq mj iq nm b gy nr ns l nt nu">yarn add firebase-functions firebase-admin promise <a class="ae kz" href="http://twitter.com/google" rel="noopener ugc nofollow" target="_blank">@google</a>-cloud/vision</span></pre><p id="857c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后安装所有已有的模块和新模块:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="5dde" class="nq mj iq nm b gy nr ns l nt nu">yarn</span></pre><p id="e7b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将添加<a class="ae kz" href="https://github.com/then/promise" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">promise</strong></a><strong class="jp ir"/>库，因为所有的函数都要求它们被promise化(那是一个我发誓的词？).</p><p id="f6bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在functions/index.js中，我们将设置我们的无服务器函数文件:</p><p id="0774" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> functions/index.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="6e5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面，我们看到我们已经导入了刚刚安装的模块，还启动了我们的Firestore数据库，我们将需要更新从Google Vision API中获取的图像。</p><p id="6f78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们编写一个名为<strong class="jp ir"> addSimilarImages </strong>的函数，它将把来自Google Vision API的相似图像添加到一个图像URL列表中，我们将根据刚刚保存在Firestore中的照片保存该列表。</p><p id="26bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Firestore有一个很棒的特性，允许监听数据库事件。下面，您将通过<strong class="jp ir">functions . firestore . document(' photos/{ document } ')<br/>看到它的使用。onCreate </strong>方法如下:</p><p id="edf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> functions/index.js </strong>(带设置和功能的完整版)</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="e915" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在上面看到以下内容:</p><ul class=""><li id="f31b" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">Firestore使用了一个<strong class="jp ir"> onCreate </strong>监听器，它允许在向收藏中添加新照片这样的事件发生时调用一个函数</li><li id="2463" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">该语法允许我们通过添加。文档('照片/{文档}</li><li id="4c74" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">快照返回添加的数据的快照，在本例中是添加到数据库的照片文档，上下文让我们知道使用了什么类型的方法，例如创建、读取、更新和销毁等元数据</li><li id="4563" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们通过重新创建一个名为<strong class="jp ir"> photoUrl </strong>的Google存储风格的url来创建一个Google Vision API能够理解的完整的照片url</li><li id="618c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">然后，我们在使用谷歌视觉实例(visionClient)并使用<strong class="jp ir"> webDetection </strong>方法后返回一个承诺(在这个API上有很多方法，比如labelDetection、faceDetection，你可以在这里找到一些你可能喜欢使用的方法，如https://cloud.google.com/vision/docs/all-samples<a class="ae kz" href="https://cloud.google.com/vision/docs/all-samples" rel="noopener ugc nofollow" target="_blank"/></li><li id="5c2e" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">在本教程中，我们使用的是webDetection方法，该方法拾取与上传的图片具有相似属性的图片(我们称之为<strong class="jp ir">图片链接</strong>)</li><li id="2962" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们将这个图片Url通过Vision API，它返回一个图片URL列表——我们对视觉上相似的图片感兴趣</li><li id="f37d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们创建这些视觉上相似的图像的数组，并用<strong class="jp ir">相似图像</strong>图像更新照片集合中的文档</li></ul><p id="c421" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>在上面的功能为我们工作之前，我们现在需要在我们的帐户上启用Google Cloud API</p><h1 id="18c8" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated"><strong class="ak"> 6。在Firebase函数中设置Google Vision API，从其API中请求类似的图像</strong></h1><p id="5217" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">现在我们正在进入真正令人兴奋的部分，我们将使用机器学习服务来帮助我们找出世界上还有谁看起来和我们相似，反正据谷歌称。</p><p id="54be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步:在这里进入谷歌云控制台</strong><a class="ae kz" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/</a>并登录(不要担心——你已经有一个帐户——你只需要使用与你的Firebase帐户相同的gmail帐户登录)</p><p id="c061" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:点击选择一个项目，然后点击新建项目</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pd"><img src="../Images/4a78ec527d0c873c5e71422ef9b0afa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9TOhxhu86xEJB9snylriXg.png"/></div></div></figure><p id="38d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第三步:命名你的项目(我刚刚选择了和我的firebase项目相同的名字，但是如果不同也没关系)</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pe"><img src="../Images/77ebe711569acc7467bf38af573dcb1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9tGoAI7nV7p7he1eR6Nuw.png"/></div></div></figure><p id="7495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第四步:选择你刚刚做的项目(这里有个窍门)</strong></p><p id="f969" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您创建了项目，我们将再次回到主控制台页面，但是在左上方，我们刚刚创建的项目没有被选中，因此我们需要选择它。</p><p id="8995" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能认为这很简单，但是如果您已经有了以前的项目，单击选择一个项目可能不会在列表中显示您新创建的项目—您需要单击“最近的项目”选项卡旁边的<strong class="jp ir">所有项目</strong>选项卡来找到它。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pf"><img src="../Images/cea60bc028fe7c0c14ae592e715d7330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zD5GCxvA7FWcICAkog-Wxg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">我们可能需要跳转到All选项卡来找到我们刚刚创建的项目</figcaption></figure><p id="efd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第五步:启用谷歌视觉应用编程接口</strong></p><p id="3105" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到API和服务仪表板—从控制台转到API和服务&gt;仪表板，如下所示</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pg"><img src="../Images/7c43d262034e0e229b00b598188a4f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sy5U7AZ8O3--NR5DRtVadg.png"/></div></div></figure><p id="d98d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后单击启用API和服务，如下所示</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi ph"><img src="../Images/e786dba689a9b4347c476a9c8891df4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QL8wOGfwa0f1IfffjuhpAA.png"/></div></div></figure><p id="47e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在下面这个页面的搜索中输入“视觉”</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pi"><img src="../Images/5d2ac1dc1402bbdf1b957af20cb2aefb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KbGOBJiaRzPP8fK8GEyHkA.png"/></div></div></figure><p id="bb25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并单击Vision API</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pj"><img src="../Images/002709389e619525cd4112b10a47ce23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q4XuitXrl3bLb7srdp9UGA.png"/></div></div></figure><p id="f2ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，点击启用，如下所示</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pk"><img src="../Images/308b3615529d3d0853f055e49ee79099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0s8GNml3JCILbVwvVsz-g.png"/></div></div></figure><p id="2c79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哇——这话有点道理！我们现在准备开始实际使用一个预先训练好的机器学习API——哇！</p><h1 id="4d8f" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">7.用我们的应用程序测试我们的Google Vision API，并将相似的图像添加到我们的应用程序中</h1><p id="ca18" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">这就是我们为之奋斗的时刻，无论你在公交车上、火车上、家里的沙发上还是在工作中读到这篇文章有多长时间了:)</p><p id="ccc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了测试这是否有效，我们需要上传一张图片，然后查看Firebase函数的日志，看看我们是否成功了。您会注意到，我有意在函数中留下了一堆控制台日志，以便我们可以看到我们正在获取哪些数据。</p><p id="de25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们走吧！</p><p id="9b85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要将我们的函数部署到firebase，以便它能够识别我们刚刚编写的函数。我们还不会部署前端，只部署我们的服务器端代码。</p><p id="ec09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">部署Firebase功能:</strong></p><p id="f575" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从终端中应用程序的主目录:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="da6a" class="nq mj iq nm b gy nr ns l nt nu">firebase deploy --only functions</span></pre><p id="78af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将<strong class="jp ir">只</strong>部署功能文件夹。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pl"><img src="../Images/b8bc30f0b3de07f47575c27ace15f328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7n1A6wxmjApdLg4nZWd7A.png"/></div></div></figure><p id="ea56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你能看到这样的确认:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pm"><img src="../Images/42f75935a29dd2581006a55a3d84865d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OH7zQjwZpJ_Kr_U8i5DLfg.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">有时我会得到一个错误，就像这个图片的顶部，我能说的就是尝试，再试一次:)</figcaption></figure><p id="34a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您遇到任何错误，只需确保您使用firebase注销功能登录到firebase，然后登录firebase(然后使用正确的gmail帐户登录)并运行firebase use default(在您的。firebaserc文件——很可能您没有更改这个文件，所以您应该在那里看到一个默认的密钥。还要确保您已经在functions文件夹中运行了yarn，因为该模块必须在部署到Firebase之前安装。如果你得到一个像上面图片顶部的错误，就再试一次。魔法。</p><p id="8c0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">允许云视觉工作需要添加计费</strong></p><p id="5ec2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我在教程开始时提到的，如果你想看到你的函数工作，我们需要在你的Firebase控制台中包含一个有效的信用卡。不过不用担心，在谷歌开始向你收费之前，免费层已经有了巨大的月使用量。你可以点击查看<a class="ae kz" href="https://firebase.google.com/pricing/" rel="noopener ugc nofollow" target="_blank"> Firebase的定价，点击</a>查看<a class="ae kz" href="https://cloud.google.com/vision/#cloud-vision-api-pricing" rel="noopener ugc nofollow" target="_blank"> Cloud Vision的定价。<strong class="jp ir">简而言之，我们需要每天进行超过12.5万次函数调用，或者托管超过5GB的照片，或者每天对照片集进行超过2万次写操作，或者每月在谷歌云视觉上分析超过1000张图像，才能开始收费。</strong></a></p><p id="2984" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Firebase控制台的左下方，单击“升级”,然后选择“随用随付”计划。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pn"><img src="../Images/1774cf0b7984117d533053d75fb4db07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJbiEPI4WMDu7aKOfSe_eA.png"/></div></div></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi po"><img src="../Images/0cda9fa4d4497c54d3e190bba0db62b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4lvuEvtBj8kHVN_9fFgVg.png"/></div></div></figure><p id="400a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，让我们进入Firebase控制台中的功能页面，检查一切是否正常…</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pp"><img src="../Images/a37900b664895ad02de12be72dca619b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xA3bKd1JaSVxSAatbKjHjw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">我们部署的第一个无服务器功能。不错！</figcaption></figure><p id="9f88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在上面看到，我们称为addSimilarImages的函数现在在firebase控制台的函数列表中。</p><p id="7551" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，接下来让我们通过上传图像来测试我们的功能，然后我们将检查这个无服务器功能的日志，看看发生了什么…</p><p id="2566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我刚上传了一张照片。现在，让我们在Firebase功能控制台中单击查看日志，如下所示:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pn"><img src="../Images/022dbd024ae8a2e23c625a41147de9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbOUCnffQGjHjcbYynkvrw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">在右侧查看日志</figcaption></figure><p id="828c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们的照片上传一切顺利，在您的功能日志中，您应该会看到如下内容:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pq"><img src="../Images/e8b71c8f52d1791b1d3c5fee0fa15be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncNnSqy9ksYsGABTQozltQ.png"/></div></div></figure><p id="2f43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在上面看到，该函数执行了5553毫秒，并从谷歌云视觉API获取了一系列类似的图像——如果你仔细查看上面的日志，谷歌会建议我看起来像Stripe团队中一个叫Edwin的人！</p><p id="ae65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">教程的最后一部分是在我们的应用程序的前端显示这些类似的图像。让我们看看根据谷歌我们看起来像谁…</p><p id="f76d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将添加一些加载微调器，让用户知道我们正在等待一些二重身图像从Google Vision API返回。我们将使用react-spinners:</p><p id="9653" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从应用程序的根目录，在您的终端中运行:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="0e30" class="nq mj iq nm b gy nr ns l nt nu">yarn add react-spinners</span></pre><p id="f977" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将在Home.js的顶部导入它，并从react-bootstrap导入模型。当有人点击二重身的图像时，我们将使用模态，这将打开一个包含该图像的模态。</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="aea1" class="nq mj iq nm b gy nr ns l nt nu">...</span><span id="3cde" class="nq mj iq nm b gy oa ns l nt nu">import { Image, Grid, Row, Col, Modal } from 'react-bootstrap';</span><span id="6c79" class="nq mj iq nm b gy oa ns l nt nu">...</span><span id="745c" class="nq mj iq nm b gy oa ns l nt nu">import { ScaleLoader } from 'react-spinners';</span></pre><p id="2188" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将会做一些小的改动，下面我会一一介绍。更改结束时，Home.js文件应该是这样的:</p><p id="36cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> src/features/Home.js </strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="a815" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们浏览一下我们添加的内容:</p><ul class=""><li id="9266" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">我们已经添加了一行加载器，以显示我们何时刚刚上传了一张图像，并等待二重身图像从Google Cloud Vision返回。我们遍历一个“similarImages”数组，该数组附加到我们之前创建的index.js中firebase函数的photo文档中</li><li id="927f" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们现在还在每个有相似图像的图像下面添加了一个二重身列表，并且我们使用了一些css来为这些图像创建一个水平滚动条</li><li id="067b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们还添加了一个模态，这样当一个二重身图像被点击时，我们可以看到图像的放大视图</li><li id="f369" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们在每张图片的左上方还有一个删除处理程序，允许我们删除每张图片</li><li id="bbcb" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们在图片列表中添加了一个where语句，这样我们只能看到上传的图片。在firebase中，我们可以在前端使用。集合调用中的where('userId '，' == '，user.uid)。在下一节中，我们还将在后端添加Firestore规则，这将增加复制前端内容的安全性。</li><li id="0637" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们还添加了一个小助手功能来检查我们是否在移动设备上，因为我还没有解决从移动设备上传时的旋转问题——解决方法是将您的设备转向横向，这样当在桌面上查看图像时，图像可以正确显示</li><li id="66d5" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">我们还添加了一个imageRef状态——这对以后在Firebase存储上设置安全规则很重要——它允许我们将用户上传的图像匹配到特定的文件位置</li></ul><p id="0058" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在有了一个可用的应用程序——至少在本地。让我们把这个东西部署到网络上，完成这个教程！</p><h1 id="74bf" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated"><strong class="ak"> 8。部署到Firebase的一个实时工作的应用程序-哇！</strong></h1><p id="761d" class="pw-post-body-paragraph jn jo iq jp b jq ng js jt ju nh jw jx jy ni ka kb kc nj ke kf kg nk ki kj kk ij bi translated">最后一部分—部署！</p><p id="1714" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步:在我们部署之前添加安全规则</strong></p><p id="4443" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的firestore.rules文件中，我们将添加以下内容，以确保只有您可以读取、写入和删除您的照片。</p><p id="4524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">火焰杯</strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="ced2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">存储规则</strong></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="oh lg l"/></div></figure><p id="25b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每当我们上传一张图片时，我们保存路径以包含用户的auth id(又名userId)。</p><p id="27f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们试图在未登录的情况下请求上传图像，或者另一个已登录的用户试图上传引用您的用户Id的照片，它会拒绝上传，如下所示:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pb"><img src="../Images/82641e4f7855e01bc3a421360f0ce669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CG7RY55-RqKdi01D8t1Dwg.png"/></div></div></figure><p id="3536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的规则是实现基于属性的访问控制的一种很好的方式——简单地说，能够定义允许用户做什么类型的操作(创建、读取等),以及在什么集合中(例如照片集合)。这些规则也是功能性的，即您可以在service cloud.firestore块外部创建功能，也可以在内部引用它们。</p><p id="e5fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于我们的目的，我们在上面说过，只有照片集合被授予任何访问权限，对于照片集合中的任何照片，如果您的firebase身份验证的用户Id与我们保存的照片文档的用户id属性相同，我们将允许读取或删除。</p><p id="e216" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，对于写入对象，只有当您的用户id与photos collection文档有效负载上的user id属性相同时，您才能将文档保存到数据库。我觉得很不错。</p><p id="b0fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步:创建react应用的构建版本</strong></p><p id="9d45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的终端中，运行:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="292d" class="nq mj iq nm b gy nr ns l nt nu">yarn build</span></pre><p id="d000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果构建正确，您应该会看到如下消息:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="gh gi pr"><img src="../Images/580872bcf13e9158a4c4d50176602cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNoFkvfxpjKS5n4Iawlpag.png"/></div></div></figure><p id="306b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> **重要** </strong></p><p id="bc59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在应用程序根目录下的firebase.json文件中，我们将告诉firebase在哪个文件夹中找到react应用程序。您会注意到已经创建了一个构建文件夹来存放我们的react应用程序，因此我们需要将"<strong class="jp ir"> public </strong>"更改为"<strong class="jp ir"> build </strong>",如下所示:</p><p id="0e25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> firebase.json </strong></p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="3b4b" class="nq mj iq nm b gy nr ns l nt nu">{<br/>  "firestore": {<br/>    "rules": "firestore.rules",<br/>    "indexes": "firestore.indexes.json"<br/>  },<br/>  "hosting": {<br/>    "<strong class="nm ir">public</strong>": "<strong class="nm ir">build</strong>",<br/>    "rewrites": [ {<br/>      "source": "**",<br/>      "destination": "/index.html"<br/>    }],    <br/>    "ignore": [<br/>      "firebase.json",<br/>      "**/.*",<br/>      "**/node_modules/**"<br/>    ]<br/>  },<br/>  "storage": {<br/>    "rules": "storage.rules"<br/>  }<br/>}</span></pre><p id="1155" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">步骤2:将完整的应用程序部署到Firebase</p><p id="5783" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您的终端中，运行:</p><pre class="la lb lc ld gt nl nm nn no aw np bi"><span id="73a1" class="nq mj iq nm b gy nr ns l nt nu">firebase deploy</span></pre><p id="53ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将部署您的前端应用程序以及firebase functions文件夹。</p><p id="e4bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运气好的话，你的应用程序已经部署好了，而且你还有一个可以运行的二重身应用程序！呜！</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="lf lg l"/></div></figure><div class="lp lq gp gr lr ls"><a href="https://doppelganger-app.firebaseapp.com" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab fo"><div class="lu ab lv cl cj lw"><h2 class="bd ir gy z fp lx fr fs ly fu fw ip bi translated">重身幽灵应用——React、Firebase、GoogleCloudVision</h2><div class="lz l"><h3 class="bd b gy z fp lx fr fs ly fu fw dk translated">重身幽灵应用程序——查看谷歌认为你长得像谁</h3></div><div class="ma l"><p class="bd b dl z fp lx fr fs ly fu fw dk translated">doppelganger-app.firebaseapp.com</p></div></div></div></a></div><p id="121f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干得好，走到了这一步！我们已经谈了很多。</p><p id="5424" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总而言之，你刚刚学会了如何:</p><ul class=""><li id="c900" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">创建一个react应用程序并使用react-router-dom</li><li id="216b" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">Firebase Firestore数据库和Firebase存储的安全规则</li><li id="9576" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">react和firebase应用程序的部署</li><li id="f883" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">通过谷歌云视觉与机器学习API进行交互</li><li id="35a9" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">使用Firebase函数与Google Cloud Vision API对话的无服务器函数</li><li id="a2dc" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">最重要的是……</li><li id="49e3" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">你已经知道谷歌认为你长得像谁了！</li></ul><p id="03e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请留下任何意见，问题和任何你想在本教程中看到的改进。</p><p id="c0c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如有任何问题，请随时<a class="ae kz" href="https://au.linkedin.com/in/benjamincochrane" rel="noopener ugc nofollow" target="_blank">通过LinkedIn联系我</a></p></div></div>    
</body>
</html>