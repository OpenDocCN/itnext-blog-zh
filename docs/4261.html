<html>
<head>
<title>Azure DevOps Pipelines: PowerShell Task</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps管道:PowerShell任务</h1>
<blockquote>原文：<a href="https://itnext.io/azure-devops-pipelines-powershell-task-4031bc18abe0?source=collection_archive---------7-----------------------#2020-05-25">https://itnext.io/azure-devops-pipelines-powershell-task-4031bc18abe0?source=collection_archive---------7-----------------------#2020-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="46d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是一个展示在管道中使用PowerShell任务的快速帖子。帖子中没有什么是真正针对我们在过去几周使用的Azure DevOps项目的，但以防万一你对Azure DevOps和/或本系列完全陌生，你可以使用以下帖子开始。</p><p id="b6ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2020/02/getting-started-with-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS入门</a><br/><a class="ae kl" href="https://elanderson.net/2020/03/pipeline-creation-in-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS中的管道创建</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-publish-asp-net-core/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps为ASP.NET核心发布工件</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-pipelines-multiple-jobs-in-yaml/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:YAML的多个作业</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-pipelines-reuseable-yaml/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:可重用的YAML </a> <br/> <a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-use-yaml-across-repos/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:跨Repos使用YAML</a><br/><a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-conditionals-in-yaml/" rel="noopener ugc nofollow" target="_blank">Azure devo PS管道:YAML的条件</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-naming-and-tagging/" rel="noopener ugc nofollow" target="_blank"/></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/80f42590e7beded1705152cfc55b9616.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*Adjn2arEMxND7EJh.png"/></div></figure><h2 id="0936" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">PowerShell任务</h2><p id="56c2" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">PowerShell任务将允许您做几乎任何事情。如果没有现有的DevOps任务更符合您的需求，您可以找到一种方法，使用PowerShell任务在运行该任务的计算机甚至外部计算机的上下文中完成您的需求，这取决于您的网络和安全设置。下面是我添加到管道中的一个示例任务，它将所有环境变量输出到日志中。这是一个内联脚本，但是您也可以从文件运行脚本。另外，请注意，这在Windows和Linux代理上都有效。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="c2ac" class="ku kv iq lt b gy lx ly l lz ma">- task: PowerShell@2<br/>  inputs:<br/>    targetType: 'inline'<br/>    script: 'Get-ChildItem -Path Env:\'</span></pre><p id="394c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这个脚本对于生产管道不是非常有用，但我经常在设置管道时使用它，以便更好地了解变量方面的可用内容。此外，请记住，根据运行的触发条件，这些变量可能会有所不同。例如，如果一个运行是由一个拉请求触发的，那么您将拥有许多与拉请求相关的变量。下面是这个命令在我的测试项目上的输出，它是通过一个pull请求触发的，因此包含了一组SYSTEM_PULLREQUEST_x变量，这些变量包含了关于pull请求的信息。代理运行的是Linux。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="d4aa" class="ku kv iq lt b gy lx ly l lz ma">Name                           Value<br/>----                           -----<br/>AGENT_ACCEPTTEEEULA            True<br/>AGENT_BUILDDIRECTORY           /home/vsts/work/1<br/>AGENT_DISABLELOGPLUGIN_TESTFI… true<br/>AGENT_DISABLELOGPLUGIN_TESTRE… true<br/>AGENT_HOMEDIRECTORY            /home/vsts/agents/2.165.2<br/>AGENT_ID                       9<br/>AGENT_JOBNAME                  Build WebApp1<br/>AGENT_JOBSTATUS                Succeeded<br/>AGENT_MACHINENAME              fv-az563<br/>AGENT_NAME                     Hosted Agent<br/>AGENT_OS                       Linux<br/>AGENT_OSARCHITECTURE           X64<br/>AGENT_READONLYVARIABLES        true<br/>AGENT_RETAINDEFAULTENCODING    false<br/>AGENT_ROOTDIRECTORY            /home/vsts/work<br/>AGENT_TEMPDIRECTORY            /home/vsts/work/_temp<br/>AGENT_TOOLSDIRECTORY           /opt/hostedtoolcache<br/>AGENT_VERSION                  2.165.2<br/>AGENT_WORKFOLDER               /home/vsts/work<br/>agent.jobstatus                Succeeded<br/>ANDROID_HOME                   /usr/local/lib/android/sdk<br/>ANDROID_SDK_ROOT               /usr/local/lib/android/sdk<br/>ANT_HOME                       /usr/share/ant<br/>AZURE_EXTENSION_DIR            /opt/az/azcliextensions<br/>AZURE_HTTP_USER_AGENT          VSTS_08ccc6b2-4e5e-4621-8f5b-3fe0de2efa22_build…<br/>BOOST_ROOT_1_69_0              /usr/local/share/boost/1.69.0<br/>BOOST_ROOT_1_72_0              /usr/local/share/boost/1.72.0<br/>BUILD_ARTIFACTSTAGINGDIRECTORY /home/vsts/work/1/a<br/>BUILD_BINARIESDIRECTORY        /home/vsts/work/1/b<br/>BUILD_BUILDID                  73<br/>BUILD_BUILDNUMBER              merge_20200422.1<br/>BUILD_BUILDURI                 vstfs:///Build/Build/73<br/>BUILD_CONTAINERID              3453972<br/>BUILD_DEFINITIONNAME           Playground<br/>BUILD_DEFINITIONVERSION        4<br/>BUILD_QUEUEDBY                 Microsoft.VisualStudio.Services.TFS<br/>BUILD_QUEUEDBYID               00000002-0000-8888-8000-000000000000<br/>BUILD_REASON                   PullRequest<br/>BUILD_REPOSITORY_CLEAN         False<br/>BUILD_REPOSITORY_GIT_SUBMODUL… False<br/>BUILD_REPOSITORY_ID            ff7a6325-1129-42e3-b095-6a39ef6a6bd3<br/>BUILD_REPOSITORY_LOCALPATH     /home/vsts/work/1/s<br/>BUILD_REPOSITORY_NAME          Playground<br/>BUILD_REPOSITORY_PROVIDER      TfsGit<br/>BUILD_REPOSITORY_URI           https://ericlanderson@dev.azure.com/ericlanders…<br/>BUILD_REQUESTEDFOR             Eric Anderson<br/>BUILD_REQUESTEDFOREMAIL        ericlanderson@outlook.com<br/>BUILD_REQUESTEDFORID           45247cb1-8f49-4c03-a4c5-b03ac3286c99<br/>BUILD_SOURCEBRANCH             refs/pull/10/merge<br/>BUILD_SOURCEBRANCHNAME         merge<br/>BUILD_SOURCESDIRECTORY         /home/vsts/work/1/s<br/>BUILD_SOURCEVERSION            3e2b77c27f31a4c729a5f195b49d2e108500399d<br/>BUILD_SOURCEVERSIONAUTHOR      Eric Anderson<br/>BUILD_SOURCEVERSIONMESSAGE     Merge pull request 10 from docChanges into mast…<br/>BUILD_STAGINGDIRECTORY         /home/vsts/work/1/a<br/>BUILDCONFIGURATION             Release<br/>BUILDWEBAPP2                   false<br/>CHROME_BIN                     /usr/bin/google-chrome<br/>CHROMEWEBDRIVER                /usr/local/share/chrome_driver<br/>COMMON_TESTRESULTSDIRECTORY    /home/vsts/work/1/TestResults<br/>CONDA                          /usr/share/miniconda<br/>DEBIAN_FRONTEND                noninteractive<br/>DOTNET_SKIP_FIRST_TIME_EXPERI… 1<br/>ENDPOINT_URL_SYSTEMVSSCONNECT… <a class="ae kl" href="https://dev.azure.com/ericlanderson/" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/ericlanderson/</a><br/>GECKOWEBDRIVER                 /usr/local/share/gecko_driver<br/>GIT_TERMINAL_PROMPT            0<br/>GOROOT                         /usr/local/go1.14<br/>GOROOT_1_11_X64                /usr/local/go1.11<br/>GOROOT_1_12_X64                /usr/local/go1.12<br/>GOROOT_1_13_X64                /usr/local/go1.13<br/>GOROOT_1_14_X64                /usr/local/go1.14<br/>GRADLE_HOME                    /usr/share/gradle<br/>HOME                           /home/vsts<br/>ImageOS                        ubuntu18<br/>ImageVersion                   20200406.2<br/>INPUT_ARGUMENTS                <br/>INVOCATION_ID                  3e6abb812a484ab39fadc9e8721258ee<br/>JAVA_HOME                      /usr/lib/jvm/zulu-8-azure-amd64<br/>JAVA_HOME_11_X64               /usr/lib/jvm/zulu-11-azure-amd64<br/>JAVA_HOME_12_X64               /usr/lib/jvm/zulu-12-azure-amd64<br/>JAVA_HOME_7_X64                /usr/lib/jvm/zulu-7-azure-amd64<br/>JAVA_HOME_8_X64                /usr/lib/jvm/zulu-8-azure-amd64<br/>JOURNAL_STREAM                 9:30085<br/>LANG                           C.UTF-8<br/>LEIN_HOME                      /usr/local/lib/lein<br/>LEIN_JAR                       /usr/local/lib/lein/self-installs/leiningen-2.9…<br/>M2_HOME                        /usr/share/apache-maven-3.6.3<br/>MSDEPLOY_HTTP_USER_AGENT       VSTS_08ccc6b2-4e5e-4621-8f5b-3fe0de2efa22_build…<br/>PATH                           /opt/microsoft/powershell/7:/usr/share/rust/.ca…<br/>PIPELINE_WORKSPACE             /home/vsts/work/1<br/>POWERSHELL_DISTRIBUTION_CHANN… Azure-DevOps-ubuntu18<br/>PSModulePath                   /home/vsts/.local/share/powershell/Modules:/usr…<br/>RUNNER_TOOLSDIRECTORY          /opt/hostedtoolcache<br/>SELENIUM_JAR_PATH              /usr/share/java/selenium-server-standalone.jar<br/>SWIFT_PATH                     /usr/share/swift/usr/bin<br/>SYSTEM                         build<br/>SYSTEM_ARTIFACTSDIRECTORY      /home/vsts/work/1/a<br/>SYSTEM_COLLECTIONID            08ccc6b2-4e5e-4621-8f5b-3fe0de2efa22<br/>SYSTEM_COLLECTIONURI           <a class="ae kl" href="https://dev.azure.com/ericlanderson/" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/ericlanderson/</a><br/>SYSTEM_CULTURE                 en-US<br/>SYSTEM_DEFAULTWORKINGDIRECTORY /home/vsts/work/1/s<br/>SYSTEM_DEFINITIONID            5<br/>SYSTEM_DEFINITIONNAME          Playground<br/>SYSTEM_ENABLEACCESSTOKEN       SecretVariable<br/>SYSTEM_HOSTTYPE                build<br/>SYSTEM_ISSCHEDULED             False<br/>SYSTEM_JOBATTEMPT              1<br/>SYSTEM_JOBDISPLAYNAME          Build WebApp1<br/>SYSTEM_JOBID                   98395c9e-7365-5c3f-03de-ec42b09a8a98<br/>SYSTEM_JOBIDENTIFIER           WebApp1.__default<br/>SYSTEM_JOBNAME                 __default<br/>SYSTEM_JOBPARALLELISMTAG       Private<br/>SYSTEM_JOBPOSITIONINPHASE      1<br/>SYSTEM_PHASEATTEMPT            1<br/>SYSTEM_PHASEDISPLAYNAME        Build WebApp1<br/>SYSTEM_PHASEID                 a142d6c6-ff80-5cff-8292-5044e2c5b0ef<br/>SYSTEM_PHASENAME               WebApp1<br/>SYSTEM_PIPELINESTARTTIME       2020-04-22 06:11:44-05:00<br/>SYSTEM_PLANID                  726fda14-a3a2-45b1-b745-bef8cf17bdaa<br/>SYSTEM_PULLREQUEST_ISFORK      False<br/>SYSTEM_PULLREQUEST_PULLREQUES… 10<br/>SYSTEM_PULLREQUEST_PULLREQUES… 1<br/>SYSTEM_PULLREQUEST_SOURCEBRAN… refs/heads/docChanges<br/>SYSTEM_PULLREQUEST_SOURCECOMM… ba11cb768bc75ae65ff6b7ac6afb8a2950063f07<br/>SYSTEM_PULLREQUEST_SOURCEREPO… https://ericlanderson@dev.azure.com/ericlanders…<br/>SYSTEM_PULLREQUEST_TARGETBRAN… refs/heads/master<br/>SYSTEM_SERVERTYPE              Hosted<br/>SYSTEM_STAGEATTEMPT            1<br/>SYSTEM_STAGEDISPLAYNAME        __default<br/>SYSTEM_STAGEID                 96ac2280-8cb4-5df5-99de-dd2da759617d<br/>SYSTEM_STAGENAME               __default<br/>SYSTEM_TASKDEFINITIONSURI      <a class="ae kl" href="https://dev.azure.com/ericlanderson/" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/ericlanderson/</a><br/>SYSTEM_TASKDISPLAYNAME         PowerShell<br/>SYSTEM_TASKINSTANCEID          6417fa85-e8cf-55f9-817e-d698bd79d6f7<br/>SYSTEM_TASKINSTANCENAME        PowerShell<br/>SYSTEM_TEAMFOUNDATIONCOLLECTI… <a class="ae kl" href="https://dev.azure.com/ericlanderson/" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/ericlanderson/</a><br/>SYSTEM_TEAMFOUNDATIONSERVERURI <a class="ae kl" href="https://dev.azure.com/ericlanderson/" rel="noopener ugc nofollow" target="_blank">https://dev.azure.com/ericlanderson/</a><br/>SYSTEM_TEAMPROJECT             Playground<br/>SYSTEM_TEAMPROJECTID           7550ca2f-9ffe-45b7-abd5-c4e92a4a5f4e<br/>SYSTEM_TIMELINEID              726fda14-a3a2-45b1-b745-bef8cf17bdaa<br/>SYSTEM_TOTALJOBSINPHASE        1<br/>SYSTEM_WORKFOLDER              /home/vsts/work<br/>TASK_DISPLAYNAME               PowerShell<br/>TF_BUILD                       True<br/>USER                           vsts<br/>VCPKG_INSTALLATION_ROOT        /usr/local/share/vcpkg<br/>VSTS_AGENT_PERFLOG             /home/vsts/perflog<br/>VSTS_PROCESS_LOOKUP_ID         vsts_54420f58-c41f-4a43-8ce8-bbbac5023620</span></pre><p id="7215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不知道你是怎么想的，但是能够看到内置路径变量实际映射到什么路径对我很有帮助，特别是当文件需要移动的时候。</p><h2 id="c757" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="5b4b" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">如上所述，您可以使用PowerShell任务做任何事情。从读取JSON文件到为QA构建VM，我已经用它做了很多事情。如果你以前没有使用过这个任务，我希望这篇文章可以帮助你开始，让你看到PowerShell任务可以做的大量事情。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="69fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mi">原载于</em><a class="ae kl" href="https://elanderson.net/2020/05/azure-devops-pipelines-powershell-task/" rel="noopener ugc nofollow" target="_blank"><em class="mi"/></a><em class="mi">。</em></p></div></div>    
</body>
</html>