<html>
<head>
<title>How to Schedule Tasks using Chrono in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Golang中使用Chrono安排任务</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-schedule-tasks-using-chrono-in-golang-16a39b14a79a?source=collection_archive---------0-----------------------#2021-05-30">https://itnext.io/how-to-schedule-tasks-using-chrono-in-golang-16a39b14a79a?source=collection_archive---------0-----------------------#2021-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/f2471a544158a35ea8da3adfe97decd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*A2KoLjWvIEy39wDbHyjDsw.png"/></div></figure><p id="f2fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，您将学习如何使用<a class="ae ks" href="https://github.com/procyon-projects/chrono" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir"> Chrono </strong> </a> <strong class="jw ir"> </strong>调度任务和取消已调度的任务，这是一个调度程序库，允许您定期运行任务和代码。</p><p id="bd19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">借助Chrono库，在Golang中安排任务非常容易。</p><p id="958f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在让我们跳到例子中，看看它有多简单。</p><h1 id="c090" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">安排一次性任务</h1><p id="a43e" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated"><strong class="jw ir"> Schedule </strong>方法帮助我们安排任务在指定的时间运行一次。在下面的示例中，任务将在当前时间1秒后首先执行。</p><blockquote class="lw lx ly"><p id="ac0b" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated"><code class="fe md me mf mg b">WithStartTime</code>选项用于指定执行时间。</p></blockquote><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="306a" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">以固定速率调度任务</h1><p id="8cd4" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">让我们安排一个任务以固定的秒速率运行。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="0911" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">无论前一个任务的状态如何，下一个任务总是在5秒钟后运行，前一个任务可能仍在运行。因此，即使上一个任务没有完成，下一个任务也会运行。</p><p id="79c4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还可以使用<code class="fe md me mf mg b">WithStartTime</code>选项来指定任务期望的第一次执行时间。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="f1b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我们使用这个选项时，任务将在指定的执行时间运行，随后在给定的时间内运行。在上面的例子中，任务将首先在当前时间之后2秒执行。</p><p id="735b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">根据我们的要求，我们也可以将这个选项与<code class="fe md me mf mg b">WithLocation</code>结合起来。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="2a89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的示例中，任务将首先在美国/纽约时间当前日期的18:45执行。</p><blockquote class="lw lx ly"><p id="c074" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated"><strong class="jw ir">如果开始时间已经过去，任务将立即执行。</strong></p></blockquote><h1 id="efa5" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">调度具有固定延迟的任务</h1><p id="8659" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">让我们调度一个任务，使其在上次执行任务的结束时间和下次执行任务的开始时间之间有一个固定的延迟。</p><p id="b1dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">固定延迟计算最后一次执行完成后的延迟。</p><p id="0703" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">考虑下面的例子:</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9d5e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">由于任务本身需要3秒钟才能完成，并且我们已经指定了任务上一次执行的完成时间和任务下一次执行的开始时间之间的5秒钟延迟，因此两次执行之间将有8秒钟的延迟。</p><blockquote class="lw lx ly"><p id="0d9d" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated"><code class="fe md me mf mg b">WithStartTime</code>和<code class="fe md me mf mg b">WithLocation</code>选项可以与此结合。</p></blockquote><h1 id="57ad" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">使用Cron表达式调度任务</h1><p id="85c8" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">有时固定速率和固定延迟不能满足您的需求，我们需要cron表达式的灵活性来调度您的任务的执行。借助提供的<strong class="jw ir"><em class="lz">ScheduleWithCron</em></strong>方法，我们可以基于Cron表达式调度任务。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="35ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这种情况下，我们将任务安排在每月第10天的18:45执行。</p><p id="c641" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">默认情况下，cron表达式使用本地时间。然而，我们可以使用<code class="fe md me mf mg b">WithLocation</code>选项来改变这一点。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="56a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的示例中，任务将被安排在美国/纽约时间每月第10天的18:45执行。</p><blockquote class="lw lx ly"><p id="0fbc" class="ju jv lz jw b jx jy jz ka kb kc kd ke ma kg kh ki mb kk kl km mc ko kp kq kr ij bi translated"><code class="fe md me mf mg b">WithStartTime</code>选项不能与<strong class="jw ir"> ScheduleWithCron一起使用。</strong></p></blockquote><h1 id="391d" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">取消计划任务</h1><p id="fe3d" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">调度方法返回一个类型为<strong class="jw ir"> ScheduledTask </strong>的实例，它允许我们取消一个任务或者检查任务是否被取消。<strong class="jw ir"> <em class="lz">取消</em> </strong> <em class="lz"> </em>方法取消已调度的任务，但不会中断正在运行的任务。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="59a3" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">关闭调度程序</h1><p id="e0d0" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated"><strong class="jw ir"><em class="lz">shut down()</em></strong><em class="lz"/>方法不会导致<em class="lz">调度器</em>立即关闭并返回一个通道。它将使<em class="lz">调度器</em>停止接受新任务，并在所有正在运行的任务完成当前工作后关闭。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><h1 id="85d0" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="d17d" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">在本文中，您了解了如何使用Chrono来安排和取消任务。</p><p id="20d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">感谢您的阅读。我希望你喜欢它。</p><p id="22bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下一篇文章再见。</p><div class="mn mo gp gr mp mq"><a href="https://github.com/procyon-projects/chrono" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">procyon项目/chrono</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">Chrono是一个调度程序库，可以让你运行你的任务和代码，定期调度一个任务，在一个固定的延迟可以…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne js mq"/></div></div></a></div></div></div>    
</body>
</html>