<html>
<head>
<title>Getting Started with ASP.NET Core 3.1, Entity Framework Core with PostgreSQL database (code first approach)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NET核心3.1入门，PostgreSQL数据库实体框架核心(代码优先方法)</h1>
<blockquote>原文：<a href="https://itnext.io/asp-net-core-3-1-entity-framework-core-with-postgresql-with-code-first-approach-33b102e1734f?source=collection_archive---------0-----------------------#2020-05-23">https://itnext.io/asp-net-core-3-1-entity-framework-core-with-postgresql-with-code-first-approach-33b102e1734f?source=collection_archive---------0-----------------------#2020-05-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="b6d7" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">PostgreSQL是什么？</h1><p id="2314" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">PostgreSQL是一个强大的开源对象关系数据库系统，它使用并扩展了SQL语言，并结合了许多功能，可以安全地存储和扩展最复杂的数据工作负载。你可以在这里获得更多细节<a class="ae lj" href="https://www.postgresql.org/about/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="499d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">如何安装？</h1><p id="ff30" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">你可以从<a class="ae lj" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装PostgreSQL。</p><h1 id="0227" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">。核心网(3.1)</h1><p id="255b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">可以下载。微软网站<a class="ae lj" href="https://dotnet.microsoft.com/download/dotnet-core/3.1" rel="noopener ugc nofollow" target="_blank">的NET Core SDK这里</a>。</p><p id="3b50" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我将在这篇文章中使用下面的内容，</p><blockquote class="lp lq lr"><p id="b7b0" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">微软Visual Studio代码(开源)</p><p id="248e" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">。NET Core 3.1 SDK</p><p id="6eef" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">PostgreSQL 12</p><p id="4088" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">pg admin 4——它是PostgreSQL的开源管理工具。您可以在安装PostgreSQL时通过选中复选框来安装它。</p></blockquote><p id="191d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在撰写本文时，最新版本的。网芯是3.1。我们将在中创建ASP.NET Web API。网芯3.1。</p><p id="7405" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这篇文章将向您展示如何创建ASP.NET Web API项目与点网CLI和使用代码优先的方法连接到PostgreSQL数据库。在这篇文章中，我将使用Windows 10，但是下面的代码将适用于任何操作系统，如果你有的话。安装了NET Core 3.1 SDK和PostgreSQL。</p><p id="bd55" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">考虑到您已经安装了上述所需的工具和SDK，我们将继续创建ASP.NET核心Web API 3.1项目。</p><h1 id="4ce8" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">使用dotnet CLI创建WebAPI项目</h1><p id="918d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">打开命令提示符或power shell。并导航到要在其中创建项目的目录。在我的例子中，我在C:/ drive中创建了目录<em class="ls"> ASPNetCoreAndPostgresql </em>。</p><p id="f81d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">确保你有。已安装NET Core 3.1版本。</p><p id="1483" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在命令下运行。它将在中创建WebAPI项目。网芯3.1版本。</p><blockquote class="lp lq lr"><p id="d957" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir"> dotnet新WebAPI -n ArticleApp。API </strong></p><p id="06c6" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">使用-n为您的API项目提供名称。在我的例子中，它是ArticleApp.API。</p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/226d443145eed6466b31fc2ca8a3e113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*OR5m1vYWDu1x2coyM6sqzw.png"/></div></figure><p id="7012" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">如果您想查看不同的可用项目选项。</p><blockquote class="lp lq lr"><p id="f37a" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir">运行dotnet new -h </strong></p></blockquote><p id="1e80" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">它将列出所有可用的模板和短名称，您可以使用dotnet new命令来创建项目。</p><p id="93de" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">要在Visual Studio代码中打开项目，您可以编写下面的命令，它将在Visual Studio代码中打开当前目录。</p><blockquote class="lp lq lr"><p id="aa05" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">代码。</p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi me"><img src="../Images/3efabb92cb29a260617622dcf0f0498f.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/1*GXGhU98xsRAcYP57ySRfNQ.png"/></div></figure><p id="0e41" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">打开Visual Studio代码后，您会在Visual Studio代码的底部看到一个小弹出窗口，单击“是”。它将安装构建我们的项目所需的必要资产。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/0b17194b7263416397d87a20554ebf98.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*72Nfx1ZwzoT1z86DvGvnkg.png"/></div></figure><h1 id="0a2c" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">扩展ˌ扩张</h1><p id="3329" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在继续之前，请确保您已经在Visual Studio代码中安装了以下两个必需的扩展。安装visual studio代码后，您可能需要重新启动它们。</p><blockquote class="lp lq lr"><p id="17da" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">Visual Studio代码的C#(由OmniSharp提供支持)</p><p id="8af3" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">NuGet包管理器</p></blockquote><p id="1336" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><em class="ls">其他扩展是可选的。</em></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/4cfefbbdb691f953dea09e1a42c59c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*tga5CbO0Zr1PrOBs3pIRGQ.png"/></div></figure><p id="e0f8" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">您的Visual Studio代码应该如下所示，</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/a12f5ab1ee7db9929b1651c7fde2a4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*Yl0q41GK6cut-I30Dyg-Wg.png"/></div></figure><p id="e0a7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">Program.cs -程序类有main方法。这是应用程序的起点。<strong class="kn ir"><em class="ls"/>【CreateHostBuilder()】方法创建通用主机。更多详情，请访问<a class="ae lj" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/?view=aspnetcore-3.1&amp;tabs=windows" rel="noopener ugc nofollow" target="_blank">本。</a></strong></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/8d29b010408460c26de3be895a6e7a5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*gNQtODcy-D6d_b-OhdI_0Q.png"/></div></figure><p id="47aa" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在Startup类中，我们配置应用程序中需要的服务。此外，我们可以定义应该如何处理HTTP请求管道。欲了解更多信息，请访问<a class="ae lj" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/?view=aspnetcore-3.1&amp;tabs=windows" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="329d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们不需要默认创建<strong class="kn ir"><em class="ls">WeatherForecastController</em></strong>和<strong class="kn ir"><em class="ls">WeatherForecast</em></strong>类。我们可以删除它们。</p><p id="79b7" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">下面我们将创建简单的模型。我不会深入模型和其他实体框架细节。本文的主要目的是了解如何使用实体框架核心来连接PostgreSQL。网芯3.1。</p><p id="f175" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在根目录中添加文件夹模型。并将下面的类添加到模型文件夹中。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/86f28d5527ee3358797eee70a3a5d120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w5AbVEkK9dUSXm3yYs6tUw.png"/></div></div></figure><p id="6447" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在下一步是创建数据上下文类。</p><p id="fa50" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">添加名为Data的新文件夹，并在其中添加以下类。</p><p id="946c" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">当我们添加新类并试图从DbContext继承它时，我们将得到下面的错误。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mo"><img src="../Images/2e93ff26de38e1db0b6cd9ac2a0be63f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5U6OJO0J8b-89Svws_xuaw.png"/></div></div></figure><p id="5912" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们需要向我们的应用程序添加实体框架核心包。从。NET Core 3.0，EntityFrameworkCore不是默认添加到我们的项目中的。请访问<a class="ae lj" href="https://docs.microsoft.com/en-us/ef/core/what-is-new/ef-core-3.0/breaking-changes#no-longer" rel="noopener ugc nofollow" target="_blank">本</a>了解更多详情。</p><h1 id="22df" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">添加EntityFrameworkCore包引用</h1><p id="8bbf" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">按Ctrl + Shift + P并选择Nuget包管理器。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/c9d9d089b06262a45addd9c98e414c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VB736OCnsLyJ1Gz4-IZgPg.png"/></div></div></figure><p id="9bbf" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">输入微软。EntityFrameworkCore并按enter键。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/f0f98e878b0f49310759e63cb0ad6534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*6wSqHb-4YtbXyAnonEnnbQ.png"/></div></figure><p id="b73d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">它会显示以下选项。首先选择Microsoft.EntityFrameworkCore。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/07cc2154d4ec7b060f988ad34c13c31a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*5qWR7MhgwoiTwvZezx75_w.png"/></div></figure><p id="611d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">选择当前稳定版本，即3.1.4</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/cabf4e950c7d1c6583b65232e64b62d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*4TBZ_vlPcpw42Rb3J7YZqQ.png"/></div></figure><p id="7aa0" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">一旦安装成功，它会显示下面的确认。请点击恢复按钮。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d56346aa2805e48452f382efa6628d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*kyRIqoXU_9VS4FsNDzHbvw.png"/></div></figure><p id="ad76" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">要确认所有安装是否正确，您可以打开项目文件，即ArticleApp.API.csproj。它应该具有EntityFrameworkCore版本3.1.4的PackageReference条目。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/d082121cbf97859c9b196865ca2d4a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3LWmwppy7u6oEeBE6UrxQ.png"/></div></div></figure><p id="da2f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在要解决DataContext错误，请单击show fixes或Ctrl +。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/e21226d44e8e7dcfdec861010b35afa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*wEwkHIBPv1LsSMsL9ZItNg.png"/></div></figure><p id="7592" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">请选择using Microsoft . entityframeworkcore。它应该可以解决该错误。在为文章实体添加构造函数和DbSet属性之后，我们最终的DataContext类应该如下所示:</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mu"><img src="../Images/1c9bed743853578f2b8271c7f4bb8e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SkOzXcIXp8rcvZie7atN6Q.png"/></div></div></figure><p id="f8cf" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在使用代码优先的方法，我们需要连接到PostgreSQL并创建带有文章表的数据库。</p><p id="e91d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们需要添加连接字符串。打开Appsettings.json并添加以下连接字符串。</p><p id="5748" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">请注意，我使用非常简单的密码，但在实际的生产代码，你应该加密它，并确保密码是复杂的。</p><blockquote class="lp lq lr"><p id="093b" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">"连接字符串":{</p><p id="24fc" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">" default connection ":" Server = 127 . 0 . 0 . 1；端口= 5432；用户id =文章-用户；密码= 12345；database = ArticleDB汇集=真"</p><p id="c0e8" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi">},</p></blockquote><p id="6ddc" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">文件应该是这样的。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/1b34fdc438f5123fa8b6cc5929ee7033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PeMfdPC-qDh0VttlHtipbQ.png"/></div></div></figure><p id="383d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">确保您已经创建了具有适当访问权限的用户文章-用户。</p><p id="0eb5" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">注:</strong></p><blockquote class="lp lq lr"><p id="f6a1" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">对于本文，我使用我的本地主机(127.0.0.1)。</p><p id="2e84" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">如果您不知道PostgreSQL的端口号是什么。打开C:\ Program Files \ PostgreSQL \ 12 \ data并编辑postgresql.conf文件。请不要修改任何东西。你可以看到港口入口。如果您使用的不是12版本，那么您必须用您的版本号替换12。</p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/9aecab211ff0243ef6240bf70913917d.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*RV3jsnaw1ZTijwY6jW0qEg.png"/></div></figure><p id="2c86" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在我们需要在启动类中添加和配置EntityFrameworkCore服务。</p><p id="7f73" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们需要更新ConfigureServices方法。我们可以通过添加服务来添加EntityFrameworkCore服务。AddDbContext <datacontext> (…)如下图。但是我们需要配置PostgreSQL数据库连接。</datacontext></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/5062d7a9ef03694ff88a15901d6aaf15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*WZHGb_smDsin0D4Tu0kdgg.png"/></div></figure><p id="f869" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们出现上述错误是因为我们尚未添加EntityFrameworkCore使用PostgreSQL所需的包。</p><p id="c945" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">更多信息请访问<a class="ae lj" href="https://www.nuget.org/packages/Npgsql.EntityFrameworkCore.PostgreSQL/" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f65633858eb3d88613551e6a4ea0caf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*eTfH7K_iFkFHLnEc_V5Ahg.png"/></div></figure><p id="149e" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们需要安装Npgsql 4 . 1 . 3版和npg SQL。EntityFrameworkCore.PostgreSQL版本3.1.3。我们只考虑稳定版本。</p><p id="483d" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">要安装它们，我们将执行与安装EntityFrameworkCore相同的步骤，检查上面的<strong class="kn ir"> <em class="ls">添加EntityFrameworkCore包引用</em> </strong>部分。</p><p id="bdb4" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">或者，您可以复制下面的内容并添加到文章中。API.csproj文件。它应该会在您保存项目文件后更新项目中的包。</p><blockquote class="lp lq lr"><p id="9ab2" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><packagereference include="”Npgsql”" version="”4.1.3&quot;/"/></p><p id="36de" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><packagereference include="”Npgsql.EntityFrameworkCore.PostgreSQL”" version="”3.1.3&quot;/"/></p></blockquote><p id="1679" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">更新的项目文件</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/e0554c934160838eb6f30d0a3c5476b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5NVnJ7l1FFMyNbTSZH35g.png"/></div></div></figure><p id="cb4a" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">若要修复该错误，请使用语句添加以下内容。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/c9d6e90f140a71a326c5fbfcc2de70e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7XzvCJM5QAh66619U_avw.png"/></div></div></figure><p id="aa8f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在“终端”窗口中，导航到您的项目ArticleApp。API和类型</p><p id="49de" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir"> <em class="ls"> dotnet ef </em> </strong>命令。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi my"><img src="../Images/77603ae0595d4a0a1e971ec9681a07d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*bjIIx33ipI7TvPqFa74MRQ.png"/></div></figure><p id="0a16" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在代码优先的方法中，我们需要添加迁移。为此，请键入以下命令，</p><blockquote class="lp lq lr"><p id="01dc" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir">点网ef迁移添加初始创建</strong></p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/61104fe0dd73b5444ae620e3754fa6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9K_YXmOlEVA0zLsTpsWd0g.png"/></div></div></figure><p id="ab24" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">当我们尝试上述命令时，dotnet抱怨缺少对EntityFrameworkCore.Design的引用。请更新项目文件并添加以下包引用。</p><blockquote class="lp lq lr"><p id="2cda" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><packagereference include="”Microsoft.EntityFrameworkCore.Design”" version="”3.1.4&quot;/"/></p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/1bf7d1340c11727ec9cfdf35213ab430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4UWOVpCR3B4QATirrIGIrA.png"/></div></div></figure><p id="e760" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在运行下面的命令，</p><blockquote class="lp lq lr"><p id="03ba" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir">net ef迁移添加初始创建</strong></p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/de177d19fd79d2d2bd5006ca149e9f6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*OgCsHUKtz_nJKYyvjsRzMw.png"/></div></figure><p id="1048" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">现在，您应该会看到Done消息，将会创建带有默认三个文件的迁移文件夹。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c2764874a602f2b9f8591c3eb9f2c9ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*Cvbw9Wc0gC7EYm1freY-fQ.png"/></div></figure><h1 id="5b33" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">PostgreSQL —下面是pgAdmin 4管理工具</h1><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/1475e4ebacb9827f0f1c103a8a4b3323.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*6_3eQEej2s2pk6PJTYRz_Q.png"/></div></figure><p id="4d7a" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">若要在数据库中创建文章表，请运行以下命令，</p><blockquote class="lp lq lr"><p id="e3c0" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir">点网ef数据库更新</strong></p></blockquote><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0070567fdfa21607c5ac7958e9bc4063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*px7hZkn5Y5KyStALffiS4A.png"/></div></figure><p id="737c" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">上述命令成功运行后。我们应该看到创建了Articles表的新数据库ArticleDB。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7292dc46db22df098a8f0188081e0be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*4N5dPNCcaMMRczIDsDcMyQ.png"/></div></figure><p id="f775" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在表格中插入一些虚拟数据。</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/d59032b9564aec23498a92364d4b6c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*3Ek0p8cC21ZyGeQViISlZA.png"/></div></figure><p id="eeb2" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">在下面添加ArticleController.cs</p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/f42f974df81231ff4a0c24343e5b870c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*RAZHgFZlDr5vhGFFICesxA.png"/></div></figure><p id="ebe1" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">使用以下命令运行应用程序，</p><blockquote class="lp lq lr"><p id="a882" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated"><strong class="kn ir">点网运行</strong></p></blockquote><p id="3d82" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">导航到<a class="ae lj" href="https://localhost:5001/api/article" rel="noopener ugc nofollow" target="_blank">https://localhost:5001/API/article</a></p><figure class="lx ly lz ma gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mp"><img src="../Images/47f1cd89b5286764ab37ff52b19a7c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulouQ3rdx02WSePd4oEtRw.png"/></div></div></figure><p id="7baa" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我们成功连接到PostgreSQL，并能够显示数据库表中的数据。</p><p id="c007" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">几个要点-</p><blockquote class="lp lq lr"><p id="fd24" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">请确保使用正确版本的EntityFrameworkCore、Npgsql和npg SQL . EntityFrameworkCore . PostgreSQL。否则，在运行迁移命令时可能会出现错误。</p><p id="e181" class="kl km ls kn b ko lk kq kr ks ll ku kv lt lm ky kz lu ln lc ld lv lo lg lh li ij bi translated">确保在PostgreSQL中创建具有适当访问权限的用户。在我的例子中，我已经创建了用户article-user，并将他添加到admin membership下。您不必将他添加到管理员成员下，但用户应该拥有数据库和表创建权限。</p></blockquote><p id="f3e3" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">如果您在阅读本文时遇到任何问题，请告诉我。如果您能提供任何反馈或改进，我将不胜感激。</p><p id="719b" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>