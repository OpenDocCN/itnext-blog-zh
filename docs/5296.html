<html>
<head>
<title>You don’t need a Dockerfile to build a Go Container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Go容器不需要docker文件</h1>
<blockquote>原文：<a href="https://itnext.io/you-dont-need-a-dockerfile-to-build-a-go-container-a511617235bf?source=collection_archive---------1-----------------------#2021-02-04">https://itnext.io/you-dont-need-a-dockerfile-to-build-a-go-container-a511617235bf?source=collection_archive---------1-----------------------#2021-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/d98867c419be8aecafd297ee3f76cf31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ce-EzUUeUHoYR485q6o4Q.png"/></div></div></figure><div class=""/><p id="6282" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当在<a class="ae kw" href="https://flowup.cz/en/homepage" rel="noopener ugc nofollow" target="_blank"> FlowUp </a>入职并培训新工程师时，我开始意识到深入理解Dockerfiles如何工作需要花费多少时间。同时，我们总是为我们所有的项目维护单一的“最佳实践”docker文件。在可能的情况下清除docker文件突然变得有意义了。</p><p id="7c9f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们仍然使用<strong class="ka jc"> Dockerfiles用于特定案例</strong>。然而，我想确定的是，部署到云环境(Kubernetes、<a class="ae kw" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank"> Cloud Run </a>或其他容器环境)不需要高深的知识作为基础知识。</p><h1 id="a2ff" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">🐋使Dockerfiles文件变得多余</h1><p id="728b" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">有几个项目提供了从语言或语言框架构建容器的标准方法。基本上，<strong class="ka jc">你不需要知道引擎盖下发生了什么</strong>。如果你使用语言或框架的标准方式，你就可以开始了。最值得注意的是:</p><ul class=""><li id="f145" class="ma mb jb ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated"><a class="ae kw" href="https://github.com/google/ko" rel="noopener ugc nofollow" target="_blank"> ko </a>，由谷歌开发维护。它有助于构建和无缝部署到Kubernetes环境。</li><li id="78bd" class="ma mb jb ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><a class="ae kw" href="https://buildpacks.io/" rel="noopener ugc nofollow" target="_blank"> Buildpacks </a>，一个现在位于CNCF名下的项目，有多种Go实现，如<a class="ae kw" href="https://github.com/heroku/heroku-buildpack-go" rel="noopener ugc nofollow" target="_blank"> heroku-buildpack-go </a>或<a class="ae kw" href="https://github.com/GoogleCloudPlatform/buildpacks" rel="noopener ugc nofollow" target="_blank">Google cloud platform/build packs</a></li></ul><p id="5c9f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我已经写了一篇关于NoOps Go on Cloud Run的文章，你可以在下面查看。它展示了我们如何用<em class="mo"> ko构建容器。</em></p><div class="ip iq gp gr ir mp"><a href="https://medium.com/@peter.malina/noops-go-on-cloud-run-689d92215c5c" rel="noopener follow" target="_blank"><div class="mq ab fo"><div class="mr ab ms cl cj mt"><h2 class="bd jc gy z fp mu fr fs mv fu fw ja bi translated">🔧NoOps上云运行</h2><div class="mw l"><h3 class="bd b gy z fp mu fr fs mv fu fw dk translated">每隔一段时间，就有一件简单的事情(然后变得很可怕，完全消耗了我两天的工作…</h3></div><div class="mx l"><p class="bd b dl z fp mu fr fs mv fu fw dk translated">medium.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd ix mp"/></div></div></a></div><h1 id="cc8b" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">🔧使用构建包</h1><p id="d469" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">这次我将重点介绍如何使用<strong class="ka jc">构建包</strong>，准确地说，是使用<a class="ae kw" href="https://github.com/GoogleCloudPlatform/buildpacks" rel="noopener ugc nofollow" target="_blank">谷歌云构建包</a>。首先，您需要安装<code class="fe ne nf ng nh b">pack</code>实用程序。然后，该实用程序可以使用与标准兼容的构建包。</p><p id="170b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你是一个自制软件用户:</p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="c76b" class="nq ky jb nh b gy nr ns l nt nu">brew install buildpacks/tap/pack</span></pre><p id="1272" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于不使用自制软件的Arch Linux用户，请使用以下方法之一:</p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="f09e" class="nq ky jb nh b gy nr ns l nt nu">pack-cli<br/>pack-cli-bin</span></pre><p id="4a29" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果以上都不行，进入<a class="ae kw" href="https://buildpacks.io/docs/tools/pack/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka jc">安装页面，安装</strong> </a>。有更多的安装选项。</p><h1 id="cdf3" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">📦构建Go应用程序</h1><p id="53d7" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在到了有趣的部分。让我们构建我们的应用程序。如果您正在使用Go模块(我相信每个人都应该这样做)，buildpack将在您的目录中搜索模块，<strong class="ka jc">下载依赖项，并编译它</strong>。此外，它使用根证书构建<strong class="ka jc">最小映像。</strong></p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="6eef" class="nq ky jb nh b gy nr ns l nt nu">pack build &lt;app-name&gt; --builder gcr.io/buildpacks/builder:v1</span></pre><p id="421d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后可以在上面命令中提供的<code class="fe ne nf ng nh b">&lt;app-name&gt;</code>下找到结果容器。您可以像运行任何Docker图像一样运行它。</p><p id="2155" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">如果我在一个存储库/目录中有多个目标怎么办？</strong></p><p id="5bd1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以将一个环境变量<code class="fe ne nf ng nh b">GOOGLE_BUILDABLE</code>直接传递给您想要构建的main。如果您不这样做(并使用多目标源)，构建将会失败，并告诉您可以构建多个源。</p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="26c2" class="nq ky jb nh b gy nr ns l nt nu">pack build<br/>  --env GOOGLE_BUILDABLE=./cmd/service<br/>  --builder gcr.io/buildpacks/builder:v1<br/>  &lt;app-name&gt;</span></pre><p id="8e0c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的命令将告诉buildpack，即使您的目录中有多个目标，您也希望在<code class="fe ne nf ng nh b">./cmd/service</code>中构建一个。</p><p id="8a0d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">我可以将图像直接发布到容器注册表中吗？</strong></p><p id="4468" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个很简单。只要确保您提供了<code class="fe ne nf ng nh b">&lt;app-name&gt;</code>作为您想要发布的图像的名称。接下来，您只需添加<code class="fe ne nf ng nh b">--publish</code>标志，buildpack就会自动为您推送图像。例如，如果我想发布到<code class="fe ne nf ng nh b">gcr</code>，我会使用这个:</p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="469f" class="nq ky jb nh b gy nr ns l nt nu">pack build<br/>  --env GOOGLE_BUILDABLE=./cmd/service<br/>  --builder gcr.io/buildpacks/builder:v1<br/>  --publish<br/>  gcr.io/&lt;my-project&gt;/&lt;app-name&gt;</span></pre><p id="b5c2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令将构建和发布容器，并使其在您的机器上可用。</p><h1 id="58c4" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">🚀额外收获:在<a class="ae kw" href="https://cloud.google.com/cloud-build" rel="noopener ugc nofollow" target="_blank">云构建</a>配置项中使用相同的代码</h1><p id="32b3" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我附上一个简单的构建和发布脚本，如果你在Google Cloud上构建Go应用程序，你可以直接在Cloud Build中使用。</p><pre class="ni nj nk nl gt nm nh nn no aw np bi"><span id="151a" class="nq ky jb nh b gy nr ns l nt nu">steps:<br/>  - name: 'gcr.io/k8s-skaffold/pack'<br/>    entrypoint: 'pack'<br/>    dir: 'user'<br/>    args: [<br/>        'build',<br/>        '--builder=gcr.io/buildpacks/builder',<br/>        '--env', 'GOOGLE_BUILDABLE=./cmd/service',<br/>        '--publish',<br/>        'gcr.io/&lt;project&gt;/&lt;image&gt;'<br/>    ]</span></pre><h1 id="7fd9" class="kx ky jb bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">就是这样！</h1><p id="7763" class="pw-post-body-paragraph jy jz jb ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我希望我让你的围棋冒险变得更简单了。如果你有任何问题，请在这里留言，给我发消息<a class="ae kw" href="https://twitter.com/petomalina" rel="noopener ugc nofollow" target="_blank">🐦Twitter </a>，或ping我<a class="ae kw" href="https://www.linkedin.com/in/petomalina/" rel="noopener ugc nofollow" target="_blank">🔗领英</a>。</p><p id="6bca" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">干杯，</p></div></div>    
</body>
</html>