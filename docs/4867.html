<html>
<head>
<title>Git - Revert The Revert</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git - Revert恢复</h1>
<blockquote>原文：<a href="https://itnext.io/git-revert-the-revert-88b1e66d71d4?source=collection_archive---------0-----------------------#2020-10-12">https://itnext.io/git-revert-the-revert-88b1e66d71d4?source=collection_archive---------0-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="e9f1" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><em class="iq">TL；DR——如果你认为“恢复”就是“撤销”,那么你将永远错过恢复的这一部分。是的，它撤销数据，但不，它不撤销历史。</em>本文基于Linus Torvalds&amp;Junio C Hamano<a class="ae kp" href="https://opensource.apple.com/source/Git/Git-26/src/git-htmldocs/howto/revert-a-faulty-merge.txt" rel="noopener ugc nofollow" target="_blank">文章</a>。</p></blockquote><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="kv kw l"/></div></figure><h1 id="fbb2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">场景</h1><p id="691d" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">你正和你的团队成员在一个<code class="fe md me mf mg b">master</code>分支上工作。<br/>你的任务是开发一个新功能，所以你创建了一个名为“<strong class="jt ir"> Our-Feature </strong>”的全新分支。🤓<br/>花了你一段时间，最后你把它合并到主:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/9a471dfd71e151bdcaf85e08804e29f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOcdUGXHFstevd7UsE2G9A.png"/></div></div></figure><p id="b233" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">然后……<strong class="jt ir">瞧！</strong> <br/> <strong class="jt ir">等等</strong>，你只是注意到我们的功能中有一个影响整个app的bug！<br/>你的团队成员被卡住了，错误代码已经被推送，他们无法继续工作，<strong class="jt ir">你会怎么做</strong>？</p><p id="64b0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">要摆脱这个麻烦，你需要做2个步骤。<strong class="jt ir">撤销</strong>——将<code class="fe md me mf mg b">master</code>分支变回原来的状态，或者换句话说，<strong class="jt ir">撤销</strong> <code class="fe md me mf mg b">Our-Feature</code>合并到<code class="fe md me mf mg b">master</code>。<br/> 2。<strong class="jt ir">固定</strong>——固定<code class="fe md me mf mg b">Our-Feature</code>分支，合并回<code class="fe md me mf mg b">master</code>。</p><h1 id="2e20" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">1.取消</h1><p id="c8cc" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated"><strong class="jt ir"> <em class="js">注意:</em> </strong> <em class="js">这一步开始很重要。有时候会出现bug，并不意味着一定要影响整个团队运作。</em></p><p id="3f76" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">在谷歌上快速搜索了一下<a class="ae kp" href="https://www.atlassian.com/git/tutorials/undoing-changes" rel="noopener ugc nofollow" target="_blank">如何在git </a>中撤销事情之后，你决定使用<code class="fe md me mf mg b">git revert</code>命令。</p><p id="5fb6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">与<code class="fe md me mf mg b">git reset</code>不同的是，<code class="fe md me mf mg b">git revert</code>不会从项目历史中删除提交，而是<strong class="jt ir">反转</strong>由所选提交引入的更改，并且<strong class="jt ir">会向</strong>追加一个新的提交，其中包含最终的反转内容。在与其他人协作时，<code class="fe md me mf mg b">git revert</code>比<code class="fe md me mf mg b">git reset</code>更安全，因为它<strong class="jt ir">不会改变存储库历史。</strong>您的团队成员将能够使用“撤销”不需要的提交的回复提交来拉动分支。</p><h2 id="d818" class="mo ky iq bd kz mp mq dn ld mr ms dp lh lx mt mu ll lz mv mw lp mb mx my lt mz bi translated">我们来还原一下！</h2><p id="8174" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">你输入<code class="fe md me mf mg b">$ git revert 1da79d8 -m 1</code>，结果是:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/c08d5001fdad3ad7891ec263ceecd9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2rLhr503M4ISWM5l_9XbA.png"/></div></div></figure><p id="3bf0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">看起来不错！<br/>从<code class="fe md me mf mg b">master</code>移除<code class="fe md me mf mg b">Our-Feature</code>分支的所有变更。</p><h1 id="9b22" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">2.固定</h1><p id="5315" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">你回到<code class="fe md me mf mg b">Our-Feature</code>分支，修复那个烦人的bug。您检查了一千次，以确保我们没有引起更多的麻烦，提交更改，并将其合并到<code class="fe md me mf mg b">master</code>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/07e3d64a73be192f080814e5622d588c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wfxn6I3L--jKSRc4E-x-3w.png"/></div></div></figure><h1 id="a1e6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">有些东西工作不正常😩</h1><p id="b8a7" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">你检查了一下<code class="fe md me mf mg b">master</code>，注意到<strong class="jt ir"> </strong> <code class="fe md me mf mg b">Our-Feature</code> <strong class="jt ir"> </strong>分支<strong class="jt ir">的一些<strong class="jt ir"> </strong>文件和<strong class="jt ir"> </strong>变更少了</strong>，检查回<code class="fe md me mf mg b">Our-Feature</code>，看到所有变更都在。<br/>git怎么了？！为什么有些变更合并了，有些没有？<br/>你再次尝试将<code class="fe md me mf mg b">Our-Feature</code>分支合并到<code class="fe md me mf mg b">master</code>，看看遗漏的变更现在会不会出现，但是git告诉你:<br/> <code class="fe md me mf mg b">Already up to date.</code></p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="na kw l"/></div></figure><h1 id="8354" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发生了什么事？！</h1><p id="3a61" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">所以，你需要做三个步骤来摆脱这个麻烦。把你生活中的所有麻烦都归咎于git，用这样的句子:<em class="js">“bug不是我的——git有一个疯狂的bug，它决定忽略文件。”<br/> 2。冷静下来，明白你戏剧性的行为对你没有帮助。你可能用错了git。<br/> 3。了解哪里出了问题并解决它。👌</em></p><h1 id="28c4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">那么…哪里出了问题？</h1><p id="2d05" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">您试图找到导致这种行为的线索，并注意到丢失的更改是在合并恢复之前<strong class="jt ir">发生的。然而，我们看到的所有变化都起源于</strong>合并恢复(提交<code class="fe md me mf mg b">3d0074a</code>)之后的<strong class="jt ir">。</strong></p><p id="c208" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">让我们记住，<code class="fe md me mf mg b">git revert</code> <em class="js">反转由选择提交</em>引入的变更，在我们的例子中，反转由合并引入的所有变更，以及其中的所有变更。这意味着只要合并的恢复在git存储库中，来自该合并的数据将被反转。</p><p id="e6ae" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">主节点实际上是<code class="fe md me mf mg b">Already up to date</code>并且<code class="fe md me mf mg b">Our-Feature</code>分支完全合并到主节点，问题是我们为撤销git合并所做的恢复仍然在我们的git存储库中，并且仍然反转在合并之前源于<strong class="jt ir">的变更。我们可以在<code class="fe md me mf mg b">Our-Feature</code>中看到变化，因为这个分支中的数据不包含revert commit。</strong></p><blockquote class="jn jo jp"><p id="ff11" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">因此“恢复”撤销了数据更改，但它很大程度上是<strong class="jt ir">而不是</strong>一个<br/>的“撤销”，因为它没有撤销提交对<br/>存储库历史的影响。<strong class="jt ir"> <em class="iq"> </em> </strong> ( <a class="ae kp" href="https://opensource.apple.com/source/Git/Git-26/src/git-htmldocs/howto/revert-a-faulty-merge.txt" rel="noopener ugc nofollow" target="_blank">参考</a>)</p></blockquote><p id="c909" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">在历史上的某个时刻，由于一个错误，恢复是必要的。但是现在我们不希望这些改变被逆转，所以……<br/>我们如何<strong class="jt ir">撤销这种逆转</strong>？</p><h1 id="a3d6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">回复回复</h1><p id="cb26" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">当恢复时，不像<code class="fe md me mf mg b">git reset</code>命令，我们不改变git历史，而是在我们的git存储库时间线上创建一个新的提交。这个提交现在是我们的存储库历史的一部分，因此，我们反转的更改将保持不变，直到我们<strong class="jt ir">撤销</strong>Revet提交，或者换句话说，<strong class="jt ir">恢复Revet </strong>。虽然听起来很奇怪，但这是解决我们问题的简单方法。<br/> <strong class="jt ir">反转</strong>将<strong class="jt ir">反转</strong>并将<strong class="jt ir">撤销</strong>反转。</p><p id="0546" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">结帐至主并输入:<br/> <code class="fe md me mf mg b">$ git revert 3d0074a -m 1</code></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nb"><img src="../Images/348029cc87150e6e3324c779de38c5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LI4wCv_3OX0652_coxffMQ.png"/></div></div></figure><p id="35b4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lx kd ke kf lz kh ki kj mb kl km kn ko ij bi translated">然后……<strong class="jt ir">瞧！所有丢失的文件和更改都回来了！</strong></p><h1 id="f4ad" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="b000" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb lx ly ke kf lz ma ki kj mb mc km kn ko ij bi translated">有时在开发过程中，一个有问题的分支会合并到主分支。<br/>要撤消合并，请执行以下步骤:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nc"><img src="../Images/81f34c507b6cf35affaf7e9ae8948e43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhRhiIkFjE-no7Y27qvWkw.png"/></div></div></figure></div></div>    
</body>
</html>