<html>
<head>
<title>Tutorial: Node 12 LTS + Gulp 4 + VS2019</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:节点12 LTS + Gulp 4 + VS2019</h1>
<blockquote>原文：<a href="https://itnext.io/tutorial-node-12-lts-gulp-4-visual-studio-vs2019-85af5179f193?source=collection_archive---------0-----------------------#2019-10-31">https://itnext.io/tutorial-node-12-lts-gulp-4-visual-studio-vs2019-85af5179f193?source=collection_archive---------0-----------------------#2019-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/f07564694bf75ffcecf74b6eca341aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7WqQ5BzYXpEHEJ80V-8o8g.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="6f7b" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">就像撕掉石膏一样。痛苦，但值得脱发。</h2></div><p id="7139" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi lm translated">他的教程将带你更新你的项目，使用最新版本的Node，Gulp和Visual Studio 2019。我将一起谈论它们，因为这是一个常见的配方，经过几个小时的血汗和stackoverflow/gitrepo搜索，你可以从我的痛苦中学习。</p><p id="a04a" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">通过学习本教程，您将能够在Visual Studio 2019的任务运行器资源管理器中运行您的项目。我们走吧。</p><blockquote class="lv lw lx"><p id="d937" class="kq kr ly ks b kt ku kc kv kw kx kf ky lz la lb lc ma le lf lg mb li lj lk ll ij bi translated">警告:如果你正处于冲刺阶段，也许现在不是更新的时候。你将需要一个小时的时间来确保一切顺利运行，并且你有时间修复错误</p></blockquote><h1 id="0429" class="mc md jb bd me mf mg mh mi mj mk ml mm kh mn ki mo kk mp kl mq kn mr ko ms mt bi translated">节点12</h1><p id="475f" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">万岁万岁，随着<a class="ae mz" href="https://medium.com/@nodejs/node-js-12-to-lts-and-node-js-13-is-here-e28d6a4a2bd" rel="noopener"> NodeJs最近宣布Node 12击中LTS </a>，很值得重新审视遗留项目。长期支持本质上意味着这个版本的Node将在很长一段时间内获得错误和安全修复。在v12的情况下，使用<strong class="ks jc">直到2022年4月</strong>都是安全的，这意味着在接下来的两年多时间里，你只需要更新它。</p><figure class="nb nc nd ne gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/e1045621f8e7ec991e64dd04e53b9d1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpm0MNoIK4BbNhX58UaI9w.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">当前发布窗口</figcaption></figure><p id="ca41" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">如果你在Node 10 上运行你的项目，你还可以再用一年，所以不要急着更新，特别是如果你使用容易发生冲突的旧包。</p><p id="1785" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">然而，如果你在<a class="ae mz" href="https://nodejs.org/en/about/releases/" rel="noopener ugc nofollow" target="_blank">节点8或更低的</a>😬，您必须在2019年新年前夕之前进行升级，以维护您项目的安全性。</p><p id="6193" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">节点13也出了。为什么不更新到那个？</strong></p><p id="d6fb" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">奇数个节点版本是不会得到长期支持的实验分支。如果您想使用node提供的最新版本，请务必在Node 13上运行您的项目(当然，一定要考虑nvm)。如果你正在为一个客户或企业运行一个生产项目，坚持使用LTS版本。</p><h2 id="c409" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">安装节点12</h2><p id="468b" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">选择您的装置风格:</p><p id="4281" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc"> A)标准安装(无nvm) </strong>只需<a class="ae mz" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">下载并安装</a></p><p id="9956" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc"> B) nvm安装</strong>假设你已经在使用<a class="ae mz" href="https://github.com/nvm-sh/nvm/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> nvm </a>(没有的话安装链接里的说明)，添加节点12还是一个简单的过程:</p><pre class="nb nc nd ne gt nv nw nx ny aw nz bi"><span id="fb0b" class="nj md jb nw b gy oa ob l oc od">nvm list available </span></pre><figure class="nb nc nd ne gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/c257c1b2a2028fb06cba765b7a85ee43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9rnAOkIIcrRt4CDoCTf4Q.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated"><a class="ae mz" href="https://nodejs.org/download/release" rel="noopener ugc nofollow" target="_blank">完整发布列表</a></figcaption></figure><p id="1710" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在“长期支持”行中，请记住最新的12个版本，因此在上面的示例中，它是<code class="fe of og oh nw b">12.13.0</code></p><pre class="nb nc nd ne gt nv nw nx ny aw nz bi"><span id="5533" class="nj md jb nw b gy oa ob l oc od">nvm install 12.13.0<br/>// make yourself a cuppa</span><span id="4b77" class="nj md jb nw b gy oi ob l oc od">nvm use 12.13.0</span></pre><p id="bc32" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">🎉你现在是一个节点的骄傲用户。JS 12实例🎉</strong></p><p id="2c26" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">太好了，但这是第一次打嗝，吞咽3将开始出错</p><pre class="nb nc nd ne gt nv nw nx ny aw nz bi"><span id="0e61" class="nj md jb nw b gy oa ob l oc od">const { Math, Object, Reflect } = primordials;<br/>                                  ^<br/><br/>ReferenceError: primordials is not defined</span></pre><p id="33e3" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Gulp 3具有节点12无法处理的依赖性。所以下一步，是让gulp升级到版本4，这是Gulp最新最棒的版本。</p><h2 id="2e26" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">吞咽4——依赖地狱</h2><p id="9ae8" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated"><strong class="ks jc">最新最棒，但确实需要一点争论</strong></p><p id="55c8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">所以，为你的项目打开你的<code class="fe of og oh nw b">package.json</code>，在写它的<code class="fe of og oh nw b">^4.0.2</code>的时候，用最新稳定的gulp release替换你当前的gulp ( <code class="fe of og oh nw b">3.x.x</code></p><p id="0fab" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">如果你想在visual studio 2019中通过任务管理器资源管理器使用Gulp 4，那么你<strong class="ks jc">也需要通过<code class="fe of og oh nw b">npm install gulp@4.0.2 -g</code>全局安装</strong>如果你不这样做，Visual studio 2019将无法检测Gulp，并且不会显示可用的任务。</p><p id="b3d0" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">一旦我们做到了这一点，我们需要更新我们的吞咽依赖，这是一个完全不同的球赛。每一个依赖都有它自己的地狱要经历，但是快速检查一下互联网会对你的特定模块有所帮助。</p><p id="4c2c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">然而..这里有两个给了我最大的悲痛:</p><h2 id="d623" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated"><a class="ae mz" href="https://github.com/dlmanning/gulp-sass" rel="noopener ugc nofollow" target="_blank">大口喘气</a></h2><p id="8c94" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">尽管SASS和Gulp都很棒，但我想不出有哪一次gulp-sass/node-sass的新安装进展顺利。在这个过程中保持冷静，你最终会让它运转起来。我能给的最好建议是:</p><p id="8721" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">1.用核武器摧毁你的节点模块目录。删除它，移除它，清除它。如果它的一丝一毫存在，它就会缠着你，让你失败。</p><p id="b51f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">2.在我使用<code class="fe of og oh nw b">^4.0.2</code>的时候，用你的<code class="fe of og oh nw b">package.json</code>中的新版本替换，它和你正在使用的Gulp版本是一样的，而且我假设已经连接上了。</p><p id="8e4f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">3.如果仍然出现错误，请确保您是从具有管理员权限的控制台运行gulp。</p><p id="b496" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">4.仔细阅读错误，它可能看起来像一堵文字墙，但会有线索表明消息中缺少什么。</p><h2 id="303f" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">吞咽-msbuild</h2><p id="1a9f" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">这是一个有点奇怪的依赖关系，实际上只适用于使用特殊框架的项目，如。NET，所以一般人可以跳过。然而，如果你正在使用<code class="fe of og oh nw b">gulp-msbuild</code>，我有一个简单的提示:删除它，用 <code class="fe of og oh nw b"><a class="ae mz" href="https://github.com/jhaker/nodejs-msbuild" rel="noopener ugc nofollow" target="_blank">msbuild</a></code>替换<a class="ae mz" href="https://github.com/jhaker/nodejs-msbuild" rel="noopener ugc nofollow" target="_blank">。这是一个更快乐、更干净的包，它更有意义，而且似乎失败得更少。</a></p><figure class="nb nc nd ne gt is"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">gulp 4中的msbuild任务示例</figcaption></figure><p id="6da6" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">将所有这些添加到package.json之后，您应该可以运行<code class="fe of og oh nw b">npm install</code>了。如果一切都运行得很好，你应该没有错误，更好的是，你应该没有漏洞。</p><h1 id="1e9f" class="mc md jb bd me mf mg mh mi mj mk ml mm kh mn ki mo kk mp kl mq kn mr ko ms mt bi translated">将你的吞咽任务转换成吞咽任务</h1><p id="0be2" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">根据上面的建议，你应该会受益匪浅，基本的迁移并不太难，因为它更多的是一种语法转换，而不是完全重写。如果你发现一个特殊的gulp插件有问题，通常情况下你需要用一个更现代的gulp插件来替换它。<code class="fe of og oh nw b">gulp-util</code>已经被弃用，取而代之的是个人插件，所以当你运行gulp时，只要留意控制台，它会告诉你需要修复什么。</p><h2 id="cd05" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">示例更新</h2><figure class="nb nc nd ne gt is"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="07a5" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">它有点罗嗦，但总体感觉更整洁，更现代。Gulp 4有关于这个过程的很棒的文档，你可以用各种方式让Gulp知道你的任务什么时候完成。</p><p id="f692" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">一切正常，你现在应该能够打开Visual Studio 2019，看到任务运行器快乐地运行:</p><figure class="nb nc nd ne gt is gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/8ff703175edf98af0c46d2e5583cb615.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*JWOpmywoNkD8TjqmTUF4uA.png"/></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">这就是我们这样做的原因。</figcaption></figure><p id="55b3" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">有时最费力不讨好的任务是最难的，但是为了可维护性、安全性和进度，它们是最令人满意的。现在向前迈进，伙伴节点12er…并建立创新的东西。</p><h1 id="9b09" class="mc md jb bd me mf mg mh mi mj mk ml mm kh mn ki mo kk mp kl mq kn mr ko ms mt bi translated">进一步故障排除</h1><h2 id="a9ae" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">npm包脆弱性</h2><p id="5fcc" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">如果你确实有漏洞，运行一个<code class="fe of og oh nw b">npm audit fix</code>应该可以解决绝大部分漏洞。任何其他易受攻击的东西都需要一些手动调整，通常是更新软件包或用更现代的对等物替换它们。你可以用<code class="fe of og oh nw b">npm audit</code>找到这些不正确的包，然后追溯到你的麻烦包。</p><h2 id="234c" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated">Visual Studio 2019任务运行器资源管理器</h2><p id="8a82" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">要让任务运行器资源管理器与Gulp一起工作，有相当多的事情需要正确设置:</p><ol class=""><li id="22bf" class="om on jb ks b kt ku kw kx kz oo ld op lh oq ll or os ot ou bi translated">在项目的根目录下应该有一个名为<code class="fe of og oh nw b">gulpfile.js</code>的文件。</li><li id="efac" class="om on jb ks b kt ov kw ow kz ox ld oy lh oz ll or os ot ou bi translated">您应该有一个带有依赖项或devDependencies的<code class="fe of og oh nw b">package.json</code></li><li id="2050" class="om on jb ks b kt ov kw ow kz ox ld oy lh oz ll or os ot ou bi translated">Gulp需要在全球和本地安装(如您的<code class="fe of og oh nw b">package.json</code>中所述)</li><li id="d990" class="om on jb ks b kt ov kw ow kz ox ld oy lh oz ll or os ot ou bi translated">你的gulp文件中提到的任何模块都应该在你的<code class="fe of og oh nw b">package.json</code>中，输出控制台会告诉你出了什么问题。同样，它可能看起来像一堵文字墙，但在里面会有丢失什么的线索。</li></ol><h2 id="abdb" class="nj md jb bd me nk nl dn mi nm nn dp mm kz no np mo ld nq nr mq lh ns nt ms nu bi translated"><strong class="ak"> Visual Studio 2019仍然认为它使用的是Node的旧版本</strong></h2><p id="1301" class="pw-post-body-paragraph kq kr jb ks b kt mu kc kv kw mv kf ky kz mw lb lc ld mx lf lg lh my lj lk ll ij bi translated">这是由于VS2019找不到新节点造成的，所以需要将其路径直接添加到VS中。</p><ol class=""><li id="3414" class="om on jb ks b kt ku kw kx kz oo ld op lh oq ll or os ot ou bi translated">打开VS2019，点击<code class="fe of og oh nw b">Tools</code>标签，然后导航到选项。</li><li id="6e7a" class="om on jb ks b kt ov kw ow kz ox ld oy lh oz ll or os ot ou bi translated">在选项中找到<code class="fe of og oh nw b">External Web Tools</code>，并在<code class="fe of og oh nw b">$(PATH)</code>变量下添加节点路径。节点的默认路径是<code class="fe of og oh nw b">.\node_modules\.bin</code></li></ol><figure class="nb nc nd ne gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pa"><img src="../Images/eee0d4fd5237408e8277443defcb68a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4yJXx0IpgtgDF6T4s2jlAg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">您的位置应该包括node_modules引用，如so ^</figcaption></figure></div></div>    
</body>
</html>