<html>
<head>
<title>Automate JavaScript deployment of npm packages with Github actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github动作自动执行npm包的JavaScript部署</h1>
<blockquote>原文：<a href="https://itnext.io/automate-javascript-deployment-of-npm-packages-with-github-actions-ad82e2acb075?source=collection_archive---------4-----------------------#2020-04-21">https://itnext.io/automate-javascript-deployment-of-npm-packages-with-github-actions-ad82e2acb075?source=collection_archive---------4-----------------------#2020-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/12c9586f688efcec0284d65467ff27b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3b2NmMkfl33e1VSGs9eQA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Factorio和CI/CD管道有什么共同点？</figcaption></figure><h2 id="4b45" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用Github操作构建和发布npm包</h2><p id="1e1e" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">面对现实吧，手动的、通常非常繁琐的任务可以通过Github Actions等现代工具轻松实现自动化。当与私有注册中心结合时，我们可以通过更好地跟踪我们的代码供应管道来促进协作和提高质量。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="94af" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">全面披露:我是bytes safe(https://bytesafe.dev/)产品的创始人之一，该产品提供免费、安全和高度可用的私人NPM注册。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="1ef8" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">下面我将一步一步地描述一个简单的工作流程，用于构建和发布Javascript npm包。我们将使用一个私有注册表，在将代码释放到野外之前，它可以被用作沙箱。通过这种方式，您可以在最终用户之前发现潜在的错误。我们将使用Github动作来自动化构建</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/8496a691e9fbea22b5ee162ef2e219b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*HBWDSy6V4lie8jCI9NtVjQ.gif"/></div></figure><h2 id="160c" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">运送什么，嗯…当然是一个包裹！</h2><p id="99ef" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">因此，您可能需要为您的工作流构建一些更有趣的东西，但是在这篇文章中，我们将创建一个名为“@niclas-test/test”的新的空包，下面的package.json描述了这个包。</p><h2 id="0172" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第一步。定义包</h2><p id="0beb" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">我们将用一些基本信息、包名、git位置等设置package.json。</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="5303" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">让我们给这个包添加一些有趣的东西:</p><p id="e9c7" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated"><strong class="la ir"> index.js </strong></p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="011a" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">很好，我们的包完成了，让我们去Github并定义我们的Github动作工作流，我们将留在本地环境中，用代码定义工作流。</p><h2 id="7575" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第二步。定义Github操作工作流的构建过程</h2><p id="4108" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">Github动作驻留在专用目录<em class="mf"> github/workflows </em></p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="165b" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">在上面的片段中需要指出一些事情</p><ol class=""><li id="4cff" class="mn mo iq la b lb ma lf mb kl mp kp mq kt mr ls ms mt mu mv bi translated"><strong class="la ir">触发</strong>，即启动包的构建和部署，“on: push: branches: master”告诉Github在所有提交给master的基础上构建，但也许你也在构建特性分支，只需根据你的需要进行相应的更改。</li><li id="8abf" class="mn mo iq la b lb mw lf mx kl my kp mz kt na ls ms mt mu mv bi translated">注册表的<strong class="la ir">端点</strong>，也就是我们将工件发送到哪里</li><li id="54bb" class="mn mo iq la b lb mw lf mx kl my kp mz kt na ls ms mt mu mv bi translated">向注册中心认证所需的<strong class="la ir">凭证</strong>，</li></ol><h2 id="8521" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第三步。建立一个私有注册表</h2><p id="a624" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">在这篇文章中，我们将把我们的包发布到一个<a class="ae nb" href="https://bytesafe.dev" rel="noopener ugc nofollow" target="_blank">字节安全私有注册表</a>。注册和使用都是免费的，现在就去注册并建立你自己的私人注册吧，只需要不到一分钟的时间。我会在这里等。</p><p id="3454" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">(当然还有其他选项，工作流程应该是相似的)</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="0b13" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">完成了吗？太好了！</p><p id="b1bd" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">在Github工作流脚本中，我们提到了npm向私有注册中心进行身份验证时使用的密码:</p><pre class="mh mi mj mk gt nc nd ne nf aw ng bi"><span id="29d8" class="kc kd iq nd b gy nh ni l nj nk">NODE_AUTH_TOKEN: ${{secrets.npm_token}}</span></pre><p id="1fc0" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">您在Github存储库中配置这个秘密。正是这个访问令牌使您能够将包上传/发布到注册表。</p><p id="8de5" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">在同一个帐户中额外设置Bytesafe注册表是微不足道的，但是我们将满足于在创建帐户时提供的“默认”注册表。</p><p id="3e1b" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">此注册表的凭据显示在注册表详细信息页面下的<a class="ae nb" href="https://bytesafe.dev/" rel="noopener ugc nofollow" target="_blank">https://bytes safe . dev</a>上:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/d87024326fef13fa9d05d794af27334e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqXKIAQY7IEAua4LJHHnyQ.png"/></div></div></figure><p id="9250" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">为了获取所需的令牌，我们使用以下选项运行标准的NPM命令进行登录:</p><pre class="mh mi mj mk gt nc nd ne nf aw ng bi"><span id="f4a5" class="kc kd iq nd b gy nh ni l nj nk">$ npm --registry https://&lt;<strong class="nd ir">account</strong>&gt;.bytesafe.dev/r/&lt;<strong class="nd ir">registry</strong>&gt; login<br/>Username: bytesafe<br/>Password: ****** <br/>Email: (this IS public) user<a class="ae nb" href="mailto:niclas@bitfront.se" rel="noopener ugc nofollow" target="_blank">@yourdoma.in</a><br/>Logged in as bytesafe on https://&lt;<strong class="nd ir">account</strong>&gt;.bytesafe.dev/r/&lt;<strong class="nd ir">registry</strong>&gt;</span></pre><h2 id="d2ac" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第四步。获取用于自动构建管道的API令牌</h2><p id="1d6b" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">成功登录后，您可以使用以下命令获得令牌:</p><pre class="mh mi mj mk gt nc nd ne nf aw ng bi"><span id="b210" class="kc kd iq nd b gy nh ni l nj nk">$ npm --registry https://&lt;<strong class="nd ir">account</strong>&gt;.bytesafe.dev/r/&lt;<strong class="nd ir">registry</strong>&gt; token create<br/>npm password: <br/>┌────────────────┬────────────────────────────┐<br/>│ token          │ 01E54TK8T🤐🤐🤐🤐🤐🤐B0TQ│<br/>├────────────────┼────────────────────────────┤<br/>│ readonly       │ false                      │<br/>├────────────────┼────────────────────────────┤<br/>│ cidr_whitelist │ null                       │<br/>├────────────────┼────────────────────────────┤<br/>│ created        │ 2020-04-05T09:26:26Z       │<br/>└────────────────┴────────────────────────────┘</span></pre><h2 id="0138" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第五步。向Github操作添加令牌</h2><p id="ac2e" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">接下来，将令牌添加到Github存储库中，单击<strong class="la ir">设置</strong>-&gt;-<strong class="la ir">秘密</strong> - &gt; " <strong class="la ir">添加新的秘密</strong>，并将其命名为"<strong class="la ir"> npm_token </strong>"，输入上面令牌行中的数据。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/5e2f28cd0ff31ed1adaba179d9185559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*HbumYJSN4wsiGBa2BVlZfg.png"/></div></figure><h2 id="ab3d" class="kc kd iq bd ke kf kg dn kh ki kj dp kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">第六步…你就完成了。</h2><p id="318d" class="pw-post-body-paragraph ky kz iq la b lb lc ld le lf lg lh li kl lj lk ll kp lm ln lo kt lp lq lr ls ij bi translated">继续做:</p><pre class="mh mi mj mk gt nc nd ne nf aw ng bi"><span id="237a" class="kc kd iq nd b gy nh ni l nj nk">$ git push</span></pre><p id="8087" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">前往GitHub和你的库的<strong class="la ir"> actions标签</strong>并查看构建进度，很可能你来晚了，构建通常很快:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/808454faafa12926b9e70aaba9352da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*Z56UYPNFlnHPuzMd09jg1A.png"/></div></figure><p id="2874" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">对于验证:返回Bytesafe web控制台并验证该包是否已发货:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/a0f955c3b2ee06f3af7b7d3a3d5970a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*S6hKb8k-ZHYnBcsx_5Nxtg.png"/></div></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><p id="99cf" class="pw-post-body-paragraph ky kz iq la b lb ma ld le lf mb lh li kl mc lk ll kp md ln lo kt me lq lr ls ij bi translated">现在，您已经有了一个(非常)基本的管道，它将在提交的基础上构建您的代码，以控制和部署软件包到您的私有npm注册表，准备好供您和您的团队的应用程序使用。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/701bd7d0a65f31340c9aaf68fc71792d.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*eKl7KB0K0am7Q6Kw8YhUvA.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">基础管道？</figcaption></figure></div></div>    
</body>
</html>