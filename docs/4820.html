<html>
<head>
<title>Can your API Gateway Tango to Open API Spec?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的API网关能打开API规范吗？</h1>
<blockquote>原文：<a href="https://itnext.io/can-your-api-gateway-tango-to-open-api-spec-9e97347739f8?source=collection_archive---------3-----------------------#2020-09-26">https://itnext.io/can-your-api-gateway-tango-to-open-api-spec-9e97347739f8?source=collection_archive---------3-----------------------#2020-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/205a353eb268f5cf51e3134491120260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--MP7ZM8qJrF2bG0UxpsXw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">通用API网关插入OpenAPI规范</figcaption></figure><h1 id="41d0" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">开放API规范——API优先的方法</h1><p id="cebb" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">当今的企业使用API优先的方法来开发应用程序和共享数据。这种基于API的方法在多种场景下使用，如将一个整体拆分成微服务、采用云以及采用Kubernetes。</p><p id="5fe1" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">API也是采用面向服务的架构方法的流行选择。API也是支持数据共享和逻辑重用的关键租户。应用程序中的API可以比作命令式编程范例中的函数。</p><p id="7269" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">开放API规范是利益相关者创建和交付API的关键机制。通常，规范形成了定义应用程序的蓝图，如何访问它，以及谁可以访问它。开放API规范是一种跨SOA架构中不同角色(服务提供者、服务代理和服务消费者)共享信息的机制。每个角色都可以从API的清晰规范中受益。</p><h1 id="cd78" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">交付和使用您的API</h1><p id="a68c" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">以开放API规范形式创建的规范也可以用于为客户端和服务器自动生成代码。规范本身是语言不可知的，生成器有助于用选择的实现语言创建客户机/服务器。</p><p id="5ed6" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">但是交付和使用一个API也经常涉及一个中间组件——API网关。很多时候，API网关提供API特性，如速率限制、认证和授权、API使用的遥测。然而，API网关必须针对所服务的API进行编程。这通常是一个耗时的过程，并且容易出错。</p><p id="5eb1" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">如果您的API网关的声明性配置可以用与您的客户机和服务器相同的方式从Open API spec生成，那会怎么样？？然后，可以使用这种声明性配置对API网关进行编程。更好的是，如果开放api规范可以被接受并用于编程API网关。更进一步，如果开放api规范可用于编程您的API网关，使其独立运行或作为Kubernetes入口运行，会怎么样？</p><h1 id="8c8a" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">途中通用API网关中的开放API支持</h1><p id="7aa4" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">当在软件开发过程中推动自动化时，网络基础设施可能是最难自动化的部分之一。<a class="ae md" href="https://getenroute.io/cookbook/openapi-swagger-spec-autoprogram-api-gateway-30-seconds-no-code/" rel="noopener ugc nofollow" target="_blank">使用开放API规范</a>对API网关进行编程提供了这种自动化能力，从而在组织中进一步推动自动化。</p><p id="9232" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">当一个开放的API规范可用时，我们可以自动编程<a class="ae md" href="https://getenroute.io/" rel="noopener ugc nofollow" target="_blank">途中API网关</a>。这种自动化极大地提高了生产率，并且消除了配置API网关的容易出错的手动过程。它还提供了一种保持API网关与规范同步的机制。</p><h1 id="da6f" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">通用API网关编程的CLI工具</h1><p id="8cb1" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">我们快速展示了如何使用<code class="fe me mf mg mh b">enroutectl</code>对独立的API网关进行编程。对于Enroute Kubernetes Ingress API网关，也可以采用类似的方法。</p><p id="1401" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">以下是该命令的高级用法-</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="56fc" class="mq kd iq mh b gy mr ms l mt mu">$ ./enroutectl</span><span id="3086" class="mq kd iq mh b gy mv ms l mt mu">enroutectl can be used to generate declarative configuration <strong class="mh ir">for</strong></span><span id="ea49" class="mq kd iq mh b gy mv ms l mt mu">- Enroute Standalone Gateway<br/>- Kubernetes Ingress Gateway</span><span id="7d3e" class="mq kd iq mh b gy mv ms l mt mu">enroutectl can also read openapi spec to generate config <strong class="mh ir">for</strong> gateway</span><span id="1c10" class="mq kd iq mh b gy mv ms l mt mu">Usage:<br/>enroutectl <strong class="mh ir">[</strong>flags<strong class="mh ir">]</strong><br/>enroutectl <strong class="mh ir">[</strong>command<strong class="mh ir">]</strong></span><span id="151d" class="mq kd iq mh b gy mv ms l mt mu">Available Commands:<br/>help Help about any command<br/>init Initialize enroutectl<br/>openapi Automatically program Enroute Universal API Gateway using OpenAPI Spec</span><span id="c063" class="mq kd iq mh b gy mv ms l mt mu">Flags:<br/>--enroutectl-config string config <strong class="mh ir">for</strong> enroutectl <strong class="mh ir">if</strong> no enroutectl.yaml <strong class="mh ir">(</strong>or enroutectl.json<strong class="mh ir">)</strong> found in current OR home directory<br/>-h, --help help <strong class="mh ir">for</strong> enroutectl<br/>--verbose be verbose when running</span><span id="6764" class="mq kd iq mh b gy mv ms l mt mu">Use "enroutectl [command] --help" <strong class="mh ir">for</strong> more information about a command.</span></pre><p id="c543" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">在本地运行API网关-</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0691" class="mq kd iq mh b gy mr ms l mt mu">$ sudo docker run --net=host saarasio/enroute-gw:v0.4.1</span></pre><p id="f7f0" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">使用Petstore openapi规范对本地运行的<a class="ae md" href="https://getenroute.io/reference/getting-started/getting-started-enroute-standalone-gateway/" rel="noopener ugc nofollow" target="_blank">途中独立网关</a>实例进行编程-</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="46df" class="mq kd iq mh b gy mr ms l mt mu">$ ./enroutectl openapi --openapi-spec petstore.json --to-standalone-url <a class="ae md" href="http://localhost:1323/" rel="noopener ugc nofollow" target="_blank">http://localhost:1323/</a></span></pre><p id="1a3b" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">本地运行的途中API网关的转储配置-</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f201" class="mq kd iq mh b gy mr ms l mt mu">curl -s localhost:1323/proxy/dump/gw | jq</span></pre><p id="fb4e" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">通过API网关访问Petstore应用程序-</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4082" class="mq kd iq mh b gy mr ms l mt mu">$ curl -s -k http://localhost:8080/v2/pet/findByStatus?status=available | wc 0 2 107446</span></pre><p id="1c26" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">有关<code class="fe me mf mg mh b">enroutectl</code>的更详细描述，请参考文章- <a class="ae md" href="https://getenroute.io/cookbook/openapi-swagger-spec-autoprogram-api-gateway-30-seconds-no-code/" rel="noopener ugc nofollow" target="_blank">如何使用开放API规范对独立Api网关进行编程</a></p><h1 id="8392" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">API的遥测技术</h1><p id="f0e9" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><a class="ae md" href="https://getenroute.io/blog/telemetry/" rel="noopener ugc nofollow" target="_blank">途中独立API网关提供遥测</a>以了解其执行情况。Envoy proxy提供了丰富的遥测技术。</p><p id="ab5b" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">Enroute预装了开源的Grafana工具，该工具为遥测接口提供了可编程性。</p><p id="f857" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">对于我们上面讨论的petstore示例，这里有一个grafana屏幕。</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e7ff31e00cd18f8809b3026b5cf20eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*scTmMvfuBW4IRJa2.png"/></div></div></figure><p id="631c" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">请注意，这是如何可视化API网关正在做什么的一个例子。左上角是请求的延迟直方图。下面显示了swagger上游的特使集群的状态。下面是API网关的运行状态。</p><p id="78ea" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">右边是请求统计，包括请求速率、请求响应和到上游的连接数。</p><p id="5350" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">Grafana上的可编程性允许根据你的需要调整这个屏幕，这是另一个例子——(例如:Enovy Grafana仪表板)</p><figure class="mi mj mk ml gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/05002ae5dd1a64d04ba4779b3c5fb9bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JZ-IZUIzVhzknzNC.png"/></div></div></figure><h1 id="18ea" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">表演</h1><p id="8ce6" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">Envoy是用C++编写的高性能代理，提供运行需要高吞吐量和低延迟的应用程序所需的原始性能。Enroute的数据路径是从Envoy代理构建的，这使得为API网关用例部署/配置Enroute变得很容易。</p><h1 id="2c1a" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">使用高级速率限制保护您的API</h1><p id="ad1c" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">在途中，网关附带了<a class="ae md" href="https://getenroute.io/reference/plugins/advanced-rate-limiting/" rel="noopener ugc nofollow" target="_blank">高级限速</a>。保护API资源对于内部和外部使用都至关重要。途中还可以根据用户是通过<a class="ae md" href="https://getenroute.io/cookbook/getting-started-advanced-rate-limiting" rel="noopener ugc nofollow" target="_blank">认证还是未通过认证的用户</a>来实施不同的速率限制。关于在通用网关上的高级速率限制的更多信息可以在文章中找到— <a class="ae md" href="https://getenroute.io/blog/why-every-api-needs-a-clock/" rel="noopener ugc nofollow" target="_blank">为什么每个API都需要一个时钟</a></p><h1 id="6dd9" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">到处跑</h1><p id="7521" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">Enroute的独特架构允许它既作为独立网关运行，也作为Kubernetes入口网关运行。所有可以在<a class="ae md" href="https://getenroute.io/categories/getting-started/" rel="noopener ugc nofollow" target="_blank">独立网关上配置的功能也可以在Kubernetes入口上运行。</a></p><p id="3485" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">这一点至关重要，因为应用程序跨Kubernetes等平台部署，部署在云中或本地数据中心。</p><h1 id="6c0c" class="kc kd iq bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="6799" class="pw-post-body-paragraph la lb iq lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">自动化您的网络基础设施有助于提高开发周期的速度，从而节省在配置和管理API网关等网络基础设施上花费的宝贵时间。</p><p id="5ed0" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">对API网关使用声明性配置、对其进行更改、使API网关配置成为版本控制和CI/CD过程一部分的能力，允许您像管理代码一样轻松地管理基础设施。</p><p id="a692" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">开放API规范是构建API的蓝图，API网关应该能够与该规范协同工作，允许操作自动化。</p><p id="af8e" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated"><a class="ae md" href="https://getenroute.io" rel="noopener ugc nofollow" target="_blank"> Enroute通用API网关</a>为独立API网关和Kubernetes入口网关提供该功能。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><p id="3f4d" class="pw-post-body-paragraph la lb iq lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated"><em class="ne">最初发布于</em><a class="ae md" href="https://getenroute.io/blog/can-your-api-gateway-tango-to-openapi-swagger-spec/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://geten route . io</em></a><em class="ne">。</em></p></div></div>    
</body>
</html>