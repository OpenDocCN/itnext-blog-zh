<html>
<head>
<title>Support Multiple versions of a Service in Kubernetes using Helm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Helm支持Kubernetes中服务的多个版本</h1>
<blockquote>原文：<a href="https://itnext.io/support-multiple-versions-of-a-service-in-kubernetes-using-helm-ce26adcb516d?source=collection_archive---------1-----------------------#2018-06-17">https://itnext.io/support-multiple-versions-of-a-service-in-kubernetes-using-helm-ce26adcb516d?source=collection_archive---------1-----------------------#2018-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6416" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated"><span class="l km kn ko bm kp kq kr ks kt di"> T </span>这里有许多场景，人们希望在产品中保留一个服务多个版本。一些典型的使用案例包括:</p><ul class=""><li id="64e9" class="ku kv iq jp b jq jr ju jv jy kw kc kx kg ky kk kz la lb lc bi translated">特性的A/B测试。</li><li id="38ca" class="ku kv iq jp b jq ld ju le jy lf kc lg kg lh kk kz la lb lc bi translated">生产环境中的测试。</li><li id="d5ef" class="ku kv iq jp b jq ld ju le jy lf kc lg kg lh kk kz la lb lc bi translated">中断服务更改的迁移路径。例如API的变化——但是旧的客户端需要支持一段时间，直到它们被升级。</li><li id="c819" class="ku kv iq jp b jq ld ju le jy lf kc lg kg lh kk kz la lb lc bi translated">在广泛提供之前，为早期客户推出该功能。</li><li id="15d3" class="ku kv iq jp b jq ld ju le jy lf kc lg kg lh kk kz la lb lc bi translated">还有更多..</li></ul><p id="1010" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这些情况下，路由到特定版本的服务通常是基于请求头来完成的。</p><p id="965d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用传统方式支持多个版本需要为每个服务版本创建多个清单yamls。这给保持不同版本的同步带来了挑战。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h2 id="c41d" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated"><strong class="ak">拯救舵图模板</strong></h2><p id="9012" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">在这里，我将演示如何使用舵图以声明的方式实现对服务的多版本支持。</p><p id="a990" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">舵模板引擎支持<a class="ae mn" href="https://github.com/kubernetes/helm/blob/master/docs/chart_template_guide/control_structures.md" rel="noopener ugc nofollow" target="_blank">流量控制</a>。我们可以使用范围结构来提供“for-each”样式的循环。以下是示例<code class="fe mo mp mq mr b">values.yaml</code>文件:</p><figure class="ms mt mu mv gt mw"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="2eed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，versions是一个数组，数组中的每一项都包含特定于服务版本的变量。在上面的例子中，我有一个<code class="fe mo mp mq mr b">stable</code>版本和另一个<code class="fe mo mp mq mr b">next-gen</code>版本。</p><p id="424d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下代码片段显示了相应的部署规范:</p><figure class="ms mt mu mv gt mw"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="0bd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个部署模板文件遍历Values.yaml中定义的所有版本，并创建相应的部署和RouteRule规范。我正在利用Istio进行基于标题的路由。该规则指定，如果请求包含版本头，则将其路由到相应的服务版本。</p><p id="3b9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，一个版本可以根据需要与另一个版本相似或不同。在这方面不做任何假设。每个服务版本都可以通过更新<code class="fe mo mp mq mr b">values.yaml</code>的版本数组中相应的配置来更新。</p><p id="a0cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个技巧——多版本服务可以以声明性的代码配置方式得到支持。希望你觉得有用。</p><p id="e91c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快乐驾驶！！！</p></div></div>    
</body>
</html>