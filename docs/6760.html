<html>
<head>
<title>Pulsar or Kafka? And the lessons from doing our own testing!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脉冲星还是卡夫卡？以及从我们自己的测试中得到的教训！</h1>
<blockquote>原文：<a href="https://itnext.io/pulsar-or-kafka-and-the-lessons-from-doing-our-own-testing-a0180dfc4582?source=collection_archive---------1-----------------------#2022-02-20">https://itnext.io/pulsar-or-kafka-and-the-lessons-from-doing-our-own-testing-a0180dfc4582?source=collection_archive---------1-----------------------#2022-02-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/24265155ed5ffcbf9cd7ad711cf627a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mS6EXAGdxMy8IFgh"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">蒂莫西·艾伦在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="fccf" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">一点历史</h1><p id="411b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">对于那些读过我的其他文章的人来说，你知道我们正在改造推动业务发展的整个平台。该平台基于我们当前所基于的以前的解决方案。我们正在慢慢地重构或刷新几乎所有的组件，重新审视过去做了什么，并决定它是否真的是正确的解决方案。</p><h1 id="c3d0" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">当前的解决方案</h1><p id="e654" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">之前的平台用的是阿帕奇Pulsar。老实说，我们在Pulsar上取得了巨大的成功，它确实已经为我们的需要设置好了。我没有参与选择Pulsar的决定，所以不知道是什么推动了这个决定，但Pulsar就在这里。</p><p id="4336" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们有Pulsar Express/Manager设置，因此我们可以查看正在发生的事情，也有Prometheus scraping metrics，因此我们可以很好地了解每天发生的事情。</p><h1 id="1dd6" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">我们的使用案例</h1><p id="05d9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">老实说，我们的用例非常简单明了。我们使用消息总线在微服务之间传递消息。事件通过多个服务传入，被放到总线上，并由多个使用者根据消息类型进行处理。我们目前使用的主题不到10个。这些消息需要尽可能快地处理，尽可能接近实时。</p><p id="ecc9" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们还希望在我们的数据中心运行，因此目前如此受欢迎的SaaS产品并不相关。如果你最近与供应商交谈，了解他们的产品，让他们明白你不想要他们的云托管平台，至少可以说是很有趣的。看着你汇合，即使我们一次又一次地说，我们不想要SaaS，他们一直试图出售它，这真的让我们远离他们！</p><p id="b329" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">考虑到我们的用例，我们开始回顾Kafka vs Pulsar。</p><h1 id="de04" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">汇编我们的利弊</h1><p id="b41c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">作为所有解决方案回顾的一部分，我们想更深入地了解Pulsar和Kafka。</p><p id="6ef9" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们的类别包括:行业支持/社区、谈论使用其中一个或另一个的大公司、对我们正在使用的应用程序/工具的支持、招聘时找到专业人员的便利性、可扩展性。</p><p id="7471" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在我们考察的几乎所有类别中，卡夫卡要么是赢家，要么是平手。我们使用的几乎所有工具都已经内置了Kafka支持，这将是一个简单的切换。</p><p id="c3a2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们唯一担心的领域是可伸缩性。评估小组的一名成员在以前的工作中与卡夫卡有过一些经验，他津津乐道于他的经历，这让我们所有人都感到担忧。根据他的经验，当增加一个新的消费者时，这是一个停止世界的场景，而卡夫卡会进行分区重新平衡。这让我们很担心，但这是几年前的事了，所以肯定会更好，对吗？</p><p id="487c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">所以我们决定深入研究这个话题。</p><p id="b297" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在这一点上，我们95%确定卡夫卡是正确的选择，我当然希望它是！</p><h2 id="a0ef" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">Kafka可扩展性和我们的用例</h2><p id="ac1e" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">所有大公司似乎都在使用卡夫卡，并通过它处理大量数据。LinkedIn每天传递“数万亿”条消息！如果这么多大公司都在使用Kafka，那么可扩展性就不是问题了，对吗？我们决定做一个概念验证来确定它是否是真的。</p><p id="64a7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在我们的测试中，我们在一些开发人员的笔记本电脑上使用了合流docker容器，然后转移到Kubernetes部署，就像我们在生产中使用它一样。</p><p id="07bd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在测试进行的同时，我们几个人继续研究，看看我们能在互联网上找到什么。我们找到了Strimzi，它有很多内置功能，比如巡航控制，这似乎是我们需要的东西。所以我们也部署了这个，以确保我们在几个不同的场景下进行测试。</p><p id="8eeb" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在设置好测试工具之后，我们对所有3个Kafka安装(local docker、k8s、Strimzi)和Pulsar (local docker和k8s)运行了测试工具。我们试图使这些部署尽可能接近，以确保公平竞争。</p><h2 id="daf5" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">我们发现了什么？</h2><p id="28d8" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我的希望破灭了，分区重新平衡更好，但不是很好！它不像以前那样是一个“停止世界”的场景，但它确实是一个东西。将消费者添加到主题中会导致速度大幅下降。</p><p id="3f8a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这真的是一个问题吗？对我们来说，在小规模测试中，这似乎是一个很大的问题，当我们达到满负荷生产时，它会放大更多。一旦我们全面铺开，我们预计每天会有超过180亿个事件，所以任何大规模的放缓都会被感觉到。</p><p id="08fe" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">当您添加代理时，巡航控制将有助于扩展集群本身，但不会修复消费者/生产者添加时的分区重新平衡。</p><h2 id="0cee" class="mh kh it bd ki mi mj dn km mk ml dp kq lp mm mn ku lt mo mp ky lx mq mr lc ms bi translated">我们决定了什么？</h2><p id="4a62" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在回顾了利弊以及我们的测试结果后，我们决定继续使用Pulsar。虽然这不是我们任何人的决定。我们都一致希望卡夫卡能赢，但没有人能对测试结果提出异议。我们都对我们的决定感到高兴，因为我们有经验证据证明我们的决定，对此我们都很满意。</p><p id="e18a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们错过了什么吗？我们是否遗漏了某个配置项目，也许！卡夫卡和脉冲星都有很多旋钮可以转动！如果你有不同的经历，请告诉我！</p><h1 id="03ae" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">一个忙</h1><p id="c70c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果你喜欢这个，哪怕是一点点，请给我一个关注！</p></div></div>    
</body>
</html>