<html>
<head>
<title>You probably need a build toolchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您可能需要一个构建工具链</h1>
<blockquote>原文：<a href="https://itnext.io/you-probably-need-a-build-toolchain-88ed311c3476?source=collection_archive---------3-----------------------#2019-01-02">https://itnext.io/you-probably-need-a-build-toolchain-88ed311c3476?source=collection_archive---------3-----------------------#2019-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="98a1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">假设您想使用最新的语言功能</h2></div><h2 id="c0ae" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">TL；速度三角形定位法(dead reckoning)</h2><ul class=""><li id="c7a6" class="lb lc iq ld b le lf lg lh ko li ks lj kw lk ll lm ln lo lp bi translated">您可能希望使用新的JavaScript语言特性</li><li id="ebfd" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">你可能想要支持传统的浏览器，比如IE11，和古怪的Android/IOS浏览器</li><li id="c661" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">你可能希望你的网站是高性能的(CSS/JavaScript的捆绑)</li><li id="d1b2" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">通过使用像热模块重装(HMR)这样的插件，你可以成为一个更有效率的开发者</li><li id="0d85" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">我们将讨论如何在零配置的情况下使用Webpack和Webpack开发服务器</li><li id="952d" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">我们支持使用Babel进行编译，增加了对HMR、SCSS、图像处理和开发/生产版本的支持</li></ul><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi lv"><img src="../Images/ae24ddcf8cd9bcff75ac72dd39fa790a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*whHR8Ubsz12Zyp1W"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">马克斯·尼尔森在<a class="ae ml" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="91e0" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">需要构建工具链的主要原因是什么？</strong></h2><p id="b6c3" class="pw-post-body-paragraph mm mn iq ld b le lf jr mo lg lh ju mp ko mq mr ms ks mt mu mv kw mw mx my ll ij bi translated">在之前的一篇文章中，我们讨论了如何使用React构建一个web应用程序，使用当前的JavaScript语法和功能，而不必编译/传输代码，即使对于遗留浏览器也是如此(这是在运行时而不是在构建时完成的)。</p><p id="a558" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">然而，实际上，您可能想要使用某种类型的构建工具链。</p><p id="04f3" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">让我们讨论一下拥有构建工具链的一些好处。</p><p id="3731" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">新的语言语法/功能</strong></p><p id="1304" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">您可能希望使用JavaScript的新语法/功能，这还不是规范的正式部分。官方的ECMAScript标准通常远远落后于开发人员在该领域中可以使用的标准。这是由设计决定的，因为在一个新兴标准被批准之前，它必须首先被多个供应商(例如Node、Chromium)积极使用和实现。目前有许多流行的插件正在使用，它们还没有成为ECMAScript标准的正式组成部分，但是随着时间的推移，它们可以显著提高代码的可读性/可维护性。</p><p id="d271" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">对传统浏览器的最大支持</strong></p><p id="c17e" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">你可能想要最大化跨浏览器支持。浏览器是古怪的，尤其是IE和其他老浏览器。虽然我们能够相对容易地在IE11中运行简单的计数器应用程序(使用Traceur ),但我们不可避免地会遇到这种情况。当我们遇到问题时，我们可以自己实现一个多填充或某种解决方法，但是为什么要将这个不必要的任务添加到我们已经繁忙的工作量中呢？开源社区已经用(优雅的)解决方案解决了这些问题，那么为什么不利用这一点，让我们自己省心呢？</p><p id="88b4" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">性能是您网站的核心</strong></p><p id="bc55" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">你可能希望性能成为你网站的核心。网络用户是一群善变的人，如果你的网站需要一段时间来加载，流量会很快下降，导致可能的业务损失。如果你的网站加载速度慢，特别是在移动设备上，你的网站也会在搜索引擎结果中被扣分。如前所述，当前确保网站加载更快的最佳实践是将相关资源捆绑到单个文件中(例如，将所有JavaScript模块合并到单个JavaScript文件中)。这是一个令人惊讶的复杂过程，可能不是您想要手动完成的事情。像这样重复而复杂的任务非常适合构建工具。</p><p id="477d" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">你想成为一名高效的开发人员</strong></p><p id="a65a" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">你可能需要效率工具，比如热模块重装(HMR)。HMR使您无需刷新页面就能实时看到代码的变化。在我们的无构建工具链的例子中，每次我们对代码进行修改时，我们都必须刷新页面。这对于我们简单的应用程序来说没问题，但是随着应用程序变得越来越复杂，这将变得更有问题。在我们的例子中，我们可以增加和减少一个计数器，并立即看到效果。在我们的代码中，我们使用本地状态来保存计数器的当前值。如果我们更改代码并刷新页面，本地状态将会丢失并重置为默认值(当然，除非我们将它存储在数据库或本地存储或其他地方！).HMR通过根据需要动态“刷新”我们的组件来解决这个问题。状态通常可以为我们维护，以便我们可以从停止的地方继续。整洁吧？我现在还不知道没有某种构建工具的HMR(如果我错了，请纠正我！).</p><h2 id="d10e" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated"><strong class="ak">使用Webpack从头开始构建一个简单的React工具链</strong></h2><p id="266d" class="pw-post-body-paragraph mm mn iq ld b le lf jr mo lg lh ju mp ko mq mr ms ks mt mu mv kw mw mx my ll ij bi translated">Webpack是我最喜欢的工具之一，用来建立一个生产就绪的网站。Webpack在配置方面可能会有复杂性，但是只要稍加小心和预先规划，这些复杂性通常是可以减轻的。</p><p id="1cce" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">Webpack有一个零配置模式，我们可以利用它来开始，我们可以使用命令行参数和插件来进一步增强它。</p><p id="8020" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们将很快触及这种方法的一些限制，但是我们将在本系列的后续文章中探索一个更复杂的基于配置的Webpack工具链。</p><p id="256b" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">为什么是Webpack？</strong></p><p id="ac94" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">多年来，已经有许多工具可以用来建立网站。我最近最喜欢的是<a class="ae ml" href="https://gulpjs.com/" rel="noopener ugc nofollow" target="_blank"> Gulp </a>，一个流构建系统。Gulp失去了开源社区的青睐，因为调试、文档以及启动和运行基本功能所需的大量代码和第三方插件非常复杂。</p><p id="84ae" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">坦率地说，在我看来，Webpack没有解决这些问题。Webpack运行起来很棒，但调试可能是一场噩梦，文档是我见过的最糟糕的。我迫切需要一个像样的工具来代替它。手指交叉，2019年将产生替代。</p><p id="c4b8" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">那么，为什么选择Webpack呢？简短的回答很简单，每个人都使用它。我工作的每家公司都使用Webpack，所以定期使用Webpack非常重要，这样我就可以帮助解决出现的问题。当我工作的公司开始使用不同的工具时，我也会开始使用它们。这是今天作为一名开发人员的现实，你并不总是能够使用你想要使用的工具，你也几乎从来没有在绿地项目上工作过，所以你必须处理已经存在的东西。</p><p id="dc12" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">安装和配置Webpack </strong></p><p id="6f20" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们将利用Webpack的零配置模式快速入门，然后添加配置以增强构建的有用性。</p><p id="7633" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">新建一个文件夹，添加一个<code class="fe ne nf ng nh b">package.json</code>文件，如下:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="aca5" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们将使用React和ReactDOM，因此我们将在这里将它们添加为<code class="fe ne nf ng nh b">dependencies</code>。</p><p id="b108" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">要使用Webpack，我们只需要将<code class="fe ne nf ng nh b">webpack</code>和<code class="fe ne nf ng nh b">webpack-cli</code>列为<code class="fe ne nf ng nh b">devDependencies</code>。</p><p id="e5b2" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我加了两个脚本，<code class="fe ne nf ng nh b">build:dev</code>和<code class="fe ne nf ng nh b">build:prod</code>。区别很简单，<code class="fe ne nf ng nh b">build:prod</code>脚本将<em class="nk">丑化</em>代码(缩小它)。</p><p id="face" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">创建一个新文件，名为<code class="fe ne nf ng nh b">index.html</code>。添加以下内容；</p><p id="2de2" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">当我们很快运行Webpack时，它将捆绑我们所有的JavaScript并将其转储到一个名为<code class="fe ne nf ng nh b">main.js</code>的文件夹<code class="fe ne nf ng nh b">dist</code>中。我们可以使用一个配置文件来覆盖它，但是这超出了本文的范围。</p><p id="bd51" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在让我们继续创建我们的应用程序，一个简单的带有递增和递减按钮的计数器应用程序。</p><p id="fd9c" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">创建一个名为<code class="fe ne nf ng nh b">src</code>的新文件夹和一个名为<code class="fe ne nf ng nh b">index.js</code>的新文件，并添加以下内容:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="8881" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">创建<code class="fe ne nf ng nh b">app.js</code>并添加以下内容:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1e3a" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">最后，创建<code class="fe ne nf ng nh b">counter.js</code>并添加以下内容；</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="93a2" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这是我们的基本应用程序编码和准备就绪。</p><p id="289a" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">从命令行运行以下命令；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="18e6" class="kf kg iq nh b gy np nq l nr ns">npm run build:dev &amp;&amp; npm start</span></pre><p id="f47b" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们没有讨论<code class="fe ne nf ng nh b">npm start</code>。运行<code class="fe ne nf ng nh b">npm start</code>将运行一个非常基本的web服务器，这样我们可以在浏览器中看到我们的应用程序运行。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nt"><img src="../Images/10ad9955f48a5bc50b0b1903b9f70b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*72Vd_aiFpO9-aaIDAwDBdg.png"/></div></div></figure><p id="67fb" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">如果你打开开发者工具，看看网络选项卡，你可能会看到一些令人惊讶的东西，可能相当令人震惊。我们的小应用程序重达862KB。那么是哪里出了问题呢？</p><p id="9654" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">当我们使用<code class="fe ne nf ng nh b">npm run build:dev</code>运行开发构建时，我们的包包含以下所有内容(以及我们的代码)；</p><ul class=""><li id="55fc" class="lb lc iq ld b le mz lg na ko nu ks nv kw nw ll lm ln lo lp bi translated">空白。</li><li id="0980" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">评论。</li><li id="f5b2" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">长变量名。</li><li id="c94e" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">重复代码/没有树抖动。</li><li id="414f" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">以上都是React &amp; ReactDOM的。</li></ul><p id="a98f" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">当我们运行<code class="fe ne nf ng nh b">npm run build:prod</code>时，我们获得了上述所有好处，并且我们的包大小下降到了<strong class="ld ir"> 111KB </strong>。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nx"><img src="../Images/53d2c0d14d5f24dc11a5c73549f67e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGKr41nSBoHLd2XCkVoF1w.png"/></div></div></figure><p id="374a" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">仍然很大，但明显比以前好。</p><p id="b896" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">添加巴别塔以增加跨浏览器支持并启用JSX </strong></p><p id="09a1" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在，我们没有编译/传输任何代码。我们写的代码包含了析构，新的ES6关键字，类等等。在不支持ES6的浏览器中运行代码会导致很多问题。</p><p id="7ee8" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">同时，代码又长又难看，因为我们还没有JSX的支持。</p><p id="6424" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">让我们同时解决这两个问题。</p><p id="ef7c" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">使用此命令添加下列包；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="2873" class="kf kg iq nh b gy np nq l nr ns">npm install --save-dev @babel/core @babel/preset-env @babel/preset-react babel-loader</span></pre><p id="636e" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这些包裹是干什么用的？</p><ul class=""><li id="a4db" class="lb lc iq ld b le mz lg na ko nu ks nv kw nw ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">@babel/core</code>是巴别塔编译器的核心。</li><li id="26e0" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">@babel/preset-env</code>是一个预置，允许您使用最新的JavaScript，而无需担心浏览器支持需要什么转换/聚合填充。</li><li id="73a1" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">@babel/preset-react</code>是几个转换的包装器，支持JSX等等。</li><li id="779f" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">babel-loader</code>是Webpack的一个插件。我们将需要指示网络包使用巴别塔不久。</li></ul><p id="3747" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">要使Webpack能够使用Babel，请如下更新您的构建脚本(添加<code class="fe ne nf ng nh b">— module-bind</code>标志)；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="355d" class="kf kg iq nh b gy np nq l nr ns">"build:dev": "webpack --mode development --module-bind js=babel-loader",</span><span id="007f" class="kf kg iq nh b gy ny nq l nr ns">"build:prod": "webpack --mode production --module-bind js=babel-loader",</span></pre><p id="098b" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">最后一件事，我们需要告诉巴贝尔使用我们的预置。创建一个名为<code class="fe ne nf ng nh b">.babelrc</code>的新文件，并添加以下代码；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="e977" class="kf kg iq nh b gy np nq l nr ns">{</span><span id="951c" class="kf kg iq nh b gy ny nq l nr ns">"presets": ["@babel/preset-env", "@babel/preset-react"]</span><span id="2a80" class="kf kg iq nh b gy ny nq l nr ns">}</span></pre><p id="6f30" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">Babel运行时会寻找<code class="fe ne nf ng nh b">.babelrc</code>并自动使用它们。</p><p id="aaa6" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在有了这些变化，我们可以如下更新我们的<code class="fe ne nf ng nh b">counter.js</code>;</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a991" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这样就减少了18行代码，这是一个不错的胜利。我们也可以高枕无忧，因为我们知道坚持使用传统浏览器的用户在使用我们的网站时也会得到全面支持。赢赢。</p><p id="0239" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">使用Webpack重新加载热模块</strong></p><p id="bb7e" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">使用Webpack这样的工具的一个致命原因是热模块重载(HMR)。HMR使您能够在做出更改时几乎立即在浏览器中看到这些更改，通常不需要刷新页面或丢失应用程序状态。</p><p id="3e4f" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">要配置HMR，我们必须执行以下操作:</p><ul class=""><li id="2171" class="lb lc iq ld b le mz lg na ko nu ks nv kw nw ll lm ln lo lp bi translated">切换到Webpack开发服务器(<code class="fe ne nf ng nh b">http-server</code>在这里没有用)</li><li id="ce4d" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">安装<code class="fe ne nf ng nh b">react-hot-loader</code>，并在我们的应用程序中使用它</li><li id="5dc4" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">配置我们的脚本，使它们在运行时注入到我们的HTML中，并解决Webpack零配置模式的一些限制</li></ul><p id="1989" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们有很多事要做，让我们开始吧。</p><p id="5dd6" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们需要更多的包，所以运行下面的命令；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="e430" class="kf kg iq nh b gy np nq l nr ns">npm install --save-dev common-config-webpack-plugin html-webpack-plugin react-hot-loader webpack-dev-server</span></pre><p id="da08" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这些包裹是干什么用的？</p><ul class=""><li id="370f" class="lb lc iq ld b le mz lg na ko nu ks nv kw nw ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">common-config-webpack-plugin</code>包含了一堆<em class="nk">标准的</em> Webpack配置，这样我们就不必编写自己的配置了(这样我们就可以在零配置的列车上多待一会儿了！)</li><li id="8db7" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">html-webpack-plugin</code>我们将使用它来生成一个HTML文件，并将我们的资产注入其中</li><li id="3f7e" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">react-hot-loader</code>允许用户修改我们的React组件并实时查看变化</li><li id="3bf9" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated"><code class="fe ne nf ng nh b">webpack-dev-server</code>是一个类似<code class="fe ne nf ng nh b">http-server</code>的网络服务器，但是它也支持HMR</li></ul><p id="6ad4" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们首先将<code class="fe ne nf ng nh b">react-hot-loader</code>作为插件添加到Babel中。如下更新<code class="fe ne nf ng nh b">.babelrc</code>(添加<code class="fe ne nf ng nh b">plugins</code>键/值)；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="2b61" class="kf kg iq nh b gy np nq l nr ns">{</span><span id="a330" class="kf kg iq nh b gy ny nq l nr ns">"presets": ["@babel/preset-env", "@babel/preset-react"],</span><span id="5dda" class="kf kg iq nh b gy ny nq l nr ns">"plugins": ["react-hot-loader/babel"]</span><span id="4242" class="kf kg iq nh b gy ny nq l nr ns">}</span></pre><p id="8aa8" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">然后，让我们更新我们的应用程序，以利用HMR。打开<code class="fe ne nf ng nh b">app.js</code>，按如下方式更改代码；</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="dabe" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们使用<code class="fe ne nf ng nh b">hot</code>高阶函数来启用HMR。</p><p id="15ea" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在我们遇到了一点麻烦。我们不再能控制我们的HTML文件了。事实上，我们在根文件夹中的那个将不再被使用。由于我们使用HMR，我们需要在运行时注入我们的脚本，这将是<code class="fe ne nf ng nh b">html-webpack-plugin</code>的工作。</p><p id="4f5d" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">打开<code class="fe ne nf ng nh b">index.js</code>，更新代码如下:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="0620" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">请注意，我们现在不再以id为<code class="fe ne nf ng nh b">root</code>的<code class="fe ne nf ng nh b">div</code>为目标。我们现在改为瞄准<code class="fe ne nf ng nh b">body</code>。这是因为，据我所知，使用这种零配置方法，没有办法在构建时注入容器<code class="fe ne nf ng nh b">div</code>(如果我错了，请在下面的评论中纠正我！).</p><p id="e46a" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">React在浏览器控制台中会有一点抱怨，但一切仍将正常工作。我们将在后续文章中解决这个问题(<strong class="ld ir">剧透</strong>:你需要一个配置文件)。</p><p id="03bd" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">最后，我们必须更新我们的NPM脚本来使用<code class="fe ne nf ng nh b">webpack-dev-server</code>。打开<code class="fe ne nf ng nh b">package.json</code>并添加以下脚本(保留原来的脚本):</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="d7ae" class="kf kg iq nh b gy np nq l nr ns">"start:hmr": "webpack-dev-server --hot --mode=development --module-bind js=babel-loader --port=5589 --plugin common-config-webpack-plugin --plugin html-webpack-plugin"</span></pre><p id="24d7" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这里发生了很多事情，但应该是不言自明的；</p><ul class=""><li id="41a3" class="lb lc iq ld b le mz lg na ko nu ks nv kw nw ll lm ln lo lp bi translated">在开发模式下，在端口<code class="fe ne nf ng nh b">5589</code>上运行Webpack Dev Server，并启用HMR</li><li id="523a" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">使用巴别塔</li><li id="2e5d" class="lb lc iq ld b le lq lg lr ko ls ks lt kw lu ll lm ln lo lp bi translated">使用已经讨论过的<code class="fe ne nf ng nh b">common-config-webpack-plugin</code>和<code class="fe ne nf ng nh b">html-webpack-plugin</code></li></ul><p id="7dc9" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在所有的部分都应该就位了。如果您运行<code class="fe ne nf ng nh b">npm run start:hmr</code>并打开浏览器到<code class="fe ne nf ng nh b"><a class="ae ml" href="http://localhost:5589" rel="noopener ugc nofollow" target="_blank">http://localhost:5589</a></code>，您应该看到您的应用程序正在运行。前往<code class="fe ne nf ng nh b">counter.js</code>，进行更改，您应该会立即看到屏幕上反映的更改。</p><p id="d680" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated"><strong class="ld ir">增加对SCSS和图像的支持</strong></p><p id="75fe" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">由于我们正在使用<code class="fe ne nf ng nh b">common-config-webpack-plugin</code>，我们已经支持SCSS文件和SCSS模块，以及图像，所以不需要进一步的配置。</p><p id="d88d" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">要为我们的<code class="fe ne nf ng nh b">Counter</code>组件使用SCSS模块，只需创建一个名为<code class="fe ne nf ng nh b">counter.module.scss</code>的新文件并添加一个样式；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="b331" class="kf kg iq nh b gy np nq l nr ns">.button {</span><span id="d507" class="kf kg iq nh b gy ny nq l nr ns">background-color: yellow;</span><span id="078a" class="kf kg iq nh b gy ny nq l nr ns">}</span></pre><p id="e50c" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">并将文件直接导入<code class="fe ne nf ng nh b">counter.js</code>如下:</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="3914" class="kf kg iq nh b gy np nq l nr ns">import styles from "./counter.module.scss";</span></pre><p id="e9d0" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">我们称我们的样式为<code class="fe ne nf ng nh b">.button</code>，所以我们用<code class="fe ne nf ng nh b">styles.button</code>来引用它。</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5e95" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">当我们回到浏览器时，按钮现在应该有一个黄色的背景。</p><p id="fc56" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">对于图像来说，过程是相同的。</p><p id="92df" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">在<code class="fe ne nf ng nh b">src</code>中创建一个名为<code class="fe ne nf ng nh b">img</code>的新文件夹，并在其中添加一张图片。</p><p id="7a30" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">现在转到<code class="fe ne nf ng nh b">app.js</code>导入图像；</p><pre class="lw lx ly lz gt nl nh nm nn aw no bi"><span id="ca43" class="kf kg iq nh b gy np nq l nr ns">import img from "./img/jonpreece-square.png";</span></pre><p id="a248" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">然后，您可以通过设置<code class="fe ne nf ng nh b">img</code>标签的<code class="fe ne nf ng nh b">src</code>来使用图像，如下所示:</p><figure class="lw lx ly lz gt ma"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="ab16" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这是我们完成的应用程序；</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/ba0c4a9902c142a5ef5cd163df5bc23d.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*38rmImObQRBw15px6Ew71g.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk translated">使用零配置webpack完成应用程序</figcaption></figure><p id="2e6b" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">这个项目的代码可以在<a class="ae ml" href="https://github.com/jpreecedev/simple-react-pipeline-webpack" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><h2 id="0794" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">摘要</h2><p id="0fad" class="pw-post-body-paragraph mm mn iq ld b le lf jr mo lg lh ju mp ko mq mr ms ks mt mu mv kw mw mx my ll ij bi translated">您可能需要一个构建工具链，因为您可能希望支持最新的语言特性、传统浏览器、拥有一个高性能的网站，并使用热模块重装(HMR)等工具来减少开发时间。Webpack是现在快速启动和运行的最佳选择。更复杂的构建需要一个配置文件，这可能很难管理。</p><h2 id="1c30" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">取得联系</h2><p id="2982" class="pw-post-body-paragraph mm mn iq ld b le lf jr mo lg lh ju mp ko mq mr ms ks mt mu mv kw mw mx my ll ij bi translated">你喜欢这个故事还是想和我进一步讨论？为什么不在Twitter上给我发消息呢！</p><div class="oa ob gp gr oc od"><a href="https://twitter.com/jpreecedev" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">乔恩·普利斯(@jpreecedev) |推特</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">Jon Preece的最新推文(@jpreecedev)。合同网页开发商，设计师和软件开发商。沃林顿…</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">twitter.com</p></div></div><div class="om l"><div class="on l oo op oq om or mf od"/></div></div></a></div><p id="abda" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">或者看看我的个人博客</p><div class="oa ob gp gr oc od"><a href="https://developerhandbook.com/" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd ir gy z fp oi fr fs oj fu fw ip bi translated">DeveloperHandbook.com-更干净的代码，更好的代码。</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">这里通过全面有趣的教程来帮助你写更干净的代码，更好的代码</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">developerhandbook.com</p></div></div><div class="om l"><div class="os l oo op oq om or mf od"/></div></div></a></div><p id="8ede" class="pw-post-body-paragraph mm mn iq ld b le mz jr mo lg na ju mp ko nb mr ms ks nc mu mv kw nd mx my ll ij bi translated">谢谢大家！</p></div></div>    
</body>
</html>