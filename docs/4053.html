<html>
<head>
<title>The Path Towards Enterprise Level AWS Infrastructure — Architecture Scaffolding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迈向企业级AWS基础设施的道路——架构脚手架</h1>
<blockquote>原文：<a href="https://itnext.io/the-path-towards-enterprise-level-aws-infrastructure-architecture-scaffolding-d244d0c80364?source=collection_archive---------2-----------------------#2020-04-17">https://itnext.io/the-path-towards-enterprise-level-aws-infrastructure-architecture-scaffolding-d244d0c80364?source=collection_archive---------2-----------------------#2020-04-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7d41b66a80f2f5849d033888a74e5806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6sivZ6HHJV3mCkXaQvWtg.jpeg"/></div></div></figure><blockquote class="jy"><p id="8b34" class="jz ka iq bd kb kc kd ke kf kg kh ki dk translated">正如曾经在<em class="kj">硅谷</em>电视连续剧中所解释的，云是“这个正在变得超级重要的小领域，在许多方面是计算的未来。”这将是准确的，除了事实上它并不那么小，未来就是现在。因此，让我们深入研究云计算领域，了解如何构建高可用性、安全和容错的云系统，如何利用AWS平台实现这一目标，其关键组件是什么，以及如何在AWS上部署应用程序。</p></blockquote><p id="624f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg ki ij bi translated"><strong class="km ir"> <em class="lh">目录:</em> </strong></p><ol class=""><li id="3279" class="li lj iq km b kn lk kr ll kv lm kz ln ld lo ki lp lq lr ls bi translated">介绍</li><li id="ad93" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki lp lq lr ls bi translated">云计算</li><li id="c540" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki lp lq lr ls bi translated">基础设施概述</li><li id="4313" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki lp lq lr ls bi translated">AWS免费层票据</li><li id="1687" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki lp lq lr ls bi translated">AWS理论</li></ol><p id="0902" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— 4.1 VPC</p><p id="2dc0" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— 4.2子网</p><p id="0848" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— 4.3网络地址转换网关</p><p id="2865" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— 4.4弹性IP</p><p id="0d61" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— 4.5 AWS区域</p><p id="f664" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">5.实践</p><p id="6260" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">6.摘要</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="3ab0" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">介绍</h1><p id="da64" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated">本文是迷你系列的第一篇，将引导您完成创建企业级AWS基础架构的过程。在本系列的最后，我们将创建一个由VPC组成的基础架构，该基础架构在两个不同的可用性区域中有四个子网，其中部署了客户端应用程序、后端服务器和数据库。我们的架构将能够提供现代云系统所需的可扩展性和可用性。在此过程中，我们将解释亚马逊网络服务平台的基本概念和组件。在本文中，我们将讨论我们的架构框架，具体来说就是虚拟私有云(VPC)、子网、弹性IP地址、NAT网关和路由表。整个系列包括:</p><ul class=""><li id="e8cc" class="li lj iq km b kn lk kr ll kv lm kz ln ld lo ki nl lq lr ls bi translated">第1部分-体系结构框架(VPC，子网，弹性IP，NAT)</li><li id="252b" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated"><a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/the-path-towards-enterprise-level-aws-infrastructure-part-2-ec2-ami-bastion-host-rds-3109c73dc913#437b-bdb048487397">第2部分-EC2和数据库配置(EC2，AMI，Bastion Host，RDS) </a></li><li id="3c02" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated"><a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/the-path-towards-enterprise-level-aws-infrastructure-load-balancing-and-application-deployment-47c48e4c343d">第3部分-负载平衡和应用部署(弹性负载平衡器)</a></li></ul></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="ceef" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">云计算</h1><p id="b064" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated">在过去的几年里，IT行业经历了一场重大变革，在这场变革中，大多数全球企业都从传统的IT基础架构转向了云计算。背后的主要原因是云计算带来的灵活性和可扩展性，云计算被理解为提供计算服务，如服务器、存储、数据库、网络、分析服务等。通过互联网(<em class="lh">云</em>)。在这种模式下，组织只需为他们实际使用的云资源付费，不需要管理云资源背后的物理基础设施。市场上有许多云平台提供商，主要是亚马逊网络服务(AWS)、微软Azure和谷歌云。本文主要关注AWS上可用的服务，但是请记住，这里解释的大多数概念在其他平台上都有对应的概念。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="d362" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">基础设施概述</h1><p id="8ae8" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated">让我们从我们将在本系列中构建的内容开始。目标是创建一个真实的企业级AWS基础设施，它将能够托管一个用户管理系统，该系统由一个React.js web应用程序、Java Spring Boot服务器和一个关系数据库组成。架构图如图1所示。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/7374d22b052f5a07cc0270bdb53f4e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Badysbx-qlUq7cxENZqZfg.jpeg"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图1</figcaption></figure><p id="d337" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">它包括一个VPC，有四个子网(2个公共子网和2个私有子网)，分布在两个不同的可用性区域。在公共子网中托管着一个客户端应用程序、一个NAT网关和一个堡垒主机(稍后会详细介绍)，而我们的私有子网包含后端服务器和数据库实例。该基础设施还包括互联网网关，以便从我们的VPC和负载平衡器访问互联网。将后端服务器和数据库放在私有子网中的原因是为了保护这些实例不直接暴露在互联网上，因为它们可能包含敏感数据。相反，它们将只有私有IP地址，位于NAT网关和面向公众的弹性负载平衡器之后。通过引入在两个不同的可用性区域中部署实例的冗余，以及使用提供系统的自动扩展和健康管理的自动扩展组，所呈现的基础设施提供了高级别的可扩展性和可用性。</p><p id="2b0b" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">图2展示了我们将在AWS上托管的用户管理web应用程序系统的视图。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/872cd15f24422449fd0447bee446d029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lv1pp9wMWWFoinmylApD5A.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图2</figcaption></figure><p id="7a26" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">这些应用程序可以在GitHub上找到。</p><p id="6c7e" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><a class="ae nm" href="https://github.com/mkapiczy/react-user-manager" rel="noopener ugc nofollow" target="_blank">客户端应用</a></p><p id="b0a2" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><a class="ae nm" href="https://github.com/mkapiczy/user-manager-service" rel="noopener ugc nofollow" target="_blank">服务器</a></p><p id="bb7e" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">在本系列文章的这一部分中，我们将重点关注基础设施的搭建，即分配弹性IP地址、设置VPC、创建子网、配置NAT网关和路由表。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="f0dd" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">AWS自由层注释</h1><p id="7264" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated">AWS为其新用户提供了12个月的免费等级，使客户能够免费使用他们的服务，直至达到指定的限制。这些限制包括每月750小时的t2.micro大小的EC2实例、5GB的亚马逊S3存储、每月750小时的亚马逊RDS等等。在AWS管理控制台中，Amazon通常提供哪些资源选择属于免费层的指示，在本系列中，我们将坚持使用这些指示。如果您想确保不会超出空闲层限制，那么每当您完成AWS上的工作时，请记住停止EC2和RDS实例。您还可以设置一个计费提醒，当您超出指定的限额时，它会通知您。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="c7aa" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">AWS理论</h1><ol class=""><li id="9822" class="li lj iq km b kn ng kr nh kv nx kz ny ld nz ki lp lq lr ls bi translated"><strong class="km ir"><em class="lh"/>VPC</strong></li></ol><p id="905c" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">我们进入AWS基础设施广阔世界的第一步是了解亚马逊虚拟私有云(VPC)。VPC允许开发人员创建一个虚拟网络，他们可以在其中启动资源，并将它们与其他VPC和外部世界进行逻辑隔离。在VPC中，您的资源拥有私有IP地址，可以通过这些地址相互通信。您可以控制对VPC内部所有这些资源的访问，并随意路由传出流量。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/566d49c4074e6ca856b09e9e1068b569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GMGIGyLUZToui-YhEIUMA.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图3</figcaption></figure><p id="b74b" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">使用几个关键结构来配置对VPC的访问:</p><p id="01ea" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">安全组—它们基本上像迷你防火墙一样工作，定义允许的传入和传出IP地址和端口。它们可以在实例级别附加，在多个实例之间共享，并提供允许其他安全组而不是IP进行访问的可能性。</p><p id="c931" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">路由表—路由表负责确定来自子网或网关的网络流量应该定向到哪里。有一个主路由表与您的VPC相关联，您可以为您的子网和网关定义自定义路由表。</p><p id="2b36" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">网络访问控制列表(网络ACL) —它充当传入和传出流量的IP过滤表，并可用作安全组之上的附加安全层。网络ACL的作用类似于安全组，但它们不是在实例级别应用规则，而是将规则应用于整个VPC或子网。</p><p id="260e" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir">2<em class="lh">。子网</em> </strong></p><p id="21b9" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">实例不能直接启动到VPC中。它们需要生活在子网内。子网是一个额外的隔离区域，拥有自己的CIDR块、路由表和网络访问控制列表。子网允许您在同一个VPC中创建不同的行为。例如，您可以创建一个可以访问公共互联网的公共子网和一个不能通过互联网访问并且必须通过NAT(网络地址转换)网关才能访问外部世界的私有子网。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/a8f1b6ae35c60629411cac2f88377d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pe60_2DGuhPfiE7TrKwfIQ.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图4</figcaption></figure><p id="1d5a" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 3。NAT(网络地址转换)网关</em> </strong></p><p id="4af4" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">使用NAT网关是为了使位于私有子网中的实例能够连接到Internet或其他AWS服务，同时仍然阻止从Internet到这些实例的直接连接。例如，当您需要在私有子网中运行的EC2实例上安装或升级软件或操作系统时，NAT可能会很有用。AWS提供NAT网关管理的服务，只需要很少的管理工作。我们将在建立基础设施时使用它。</p><p id="abf9" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 4。弹性IP</em>T3】</strong></p><p id="7793" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">AWS提供了弹性IP地址的概念，用于促进动态云计算的管理。弹性IP地址是一个公共的静态IP地址，它与您的AWS帐户相关联，可以很容易地分配给您的EC2实例之一。其背后的想法是，地址与您的实例没有很强的关联，而是地址的弹性允许在系统出现任何故障的情况下，快速地将地址重新映射到您帐户中的另一个健康实例。</p><p id="8eb2" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 5。AWS区域</em> </strong></p><ul class=""><li id="4bf9" class="li lj iq km b kn lk kr ll kv lm kz ln ld lo ki nl lq lr ls bi translated">邻近性—出于延迟或法规方面的原因，您通常希望您的应用程序部署在靠近您的操作区域。</li><li id="9308" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">成本——不同地区有不同的定价。</li><li id="b74e" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">功能选择—并非所有地区都提供所有服务，尤其是新推出的功能。</li><li id="d8d9" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">几个可用区域—所有地区至少有2个AZ，但有些地区有更多。根据您的需求，这可能是一个关键因素。</li></ul><p id="39ec" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">AWS区域是AWS拥有数据中心的地理区域。区域被划分为可用性区域(AZ ),这些区域是彼此相对靠近的独立数据中心。可用性区域用于提供冗余和数据复制。在为您的基础架构选择AWS区域时，应考虑以下因素:</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="a097" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">实践</h1><ol class=""><li id="3f85" class="li lj iq km b kn ng kr nh kv nx kz ny ld nz ki lp lq lr ls bi translated"><strong class="km ir"> <em class="lh"> AWS区域</em> </strong></li></ol><p id="785a" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">让我们从选择要运营的AWS区域开始。在AWS管理控制台的右上角，您可以选择一个区域。此时，您选择哪个区域并不重要(如前所述，这可能对您的组织有影响)。但是，请务必注意，您将始终只查看在当前选定区域启动的资源。</p><p id="defc" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 2。弹性IP </em> </strong></p><p id="7559" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">下一步是分配一个弹性IP地址。为此，进入AWS管理控制台，找到VPC服务。在左侧菜单栏中的虚拟私有云部分下，您应该会看到弹性IPs链接。在那里，你可以分配一个属于你自己的新地址，或者从亚马逊的可用地址池中分配。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/2a333cd3107a8d97190e99592fed20b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZ4GdJnkzhdYoK8GwRjTqw.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图5</figcaption></figure><p id="a4cf" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 3。可用性区域A配置</em> </strong></p><p id="58b8" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">接下来，让我们创建VPC和子网。目前，我们将只设置可用性区域A，在创建VPC后，我们将致力于高可用性。因此，再次进入VPC服务仪表板，点击<em class="lh">启动VPC向导</em>按钮。你将被带到一个屏幕，在那里你可以选择你希望亚马逊为你设置哪种VPC配置。为了尽可能匹配我们的目标架构，我们将选择具有公共和私有子网的<em class="lh">VPC</em>。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/adcfcef7a01ee7bc5a40f23ee085e0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l66zZOL6--atHLgHdptmrQ.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图6</figcaption></figure><p id="5789" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">下一个屏幕允许您设置VPC配置详细信息，例如:</p><ul class=""><li id="53fd" class="li lj iq km b kn lk kr ll kv lm kz ln ld lo ki nl lq lr ls bi translated">姓名，</li><li id="3b64" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">CIDR街区，</li><li id="fb84" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">子网的详细信息:</li></ul><p id="8014" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">—姓名，</p><p id="d688" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">— IP地址范围，</p><p id="c573" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">—VPC·CIDR系列的一个子集，</p><p id="7627" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">—可用性区域，</p><p id="721a" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">如架构图(图1)所示，我们需要2个不同可用性区域中的4个子网。因此，让我们将VPC CIDR设置为10.0.0.0/22，并使我们的子网如下所示:</p><ul class=""><li id="059d" class="li lj iq km b kn lk kr ll kv lm kz ln ld lo ki nl lq lr ls bi translated">公共子网A:10 . 0 . 0 . 0/24(A区)</li><li id="94d3" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">专用子网A:10 . 0 . 1 . 0/24(A区)</li><li id="af45" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">公共子网B:10 . 0 . 2 . 0/24(B区)</li><li id="d08f" class="li lj iq km b kn lt kr lu kv lv kz lw ld lx ki nl lq lr ls bi translated">专用子网B:10 . 0 . 3 . 0/24(B区)</li></ul><p id="5c4c" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">如图7所示设置好一切。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/35798c76fe1cc2651526ab0e8dd419d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQ_SQWH2p-SZz3rzREu-wg.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图7</figcaption></figure><p id="ffb3" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">这里要注意的重要方面是为公共和私有子网选择相同的可用性区域，以及Amazon将自动为我们设置NAT网关的事实，我们只需为其指定之前分配的弹性IP地址。现在，点击<em class="lh">创建VPC </em>按钮，亚马逊将配置你的VPC。</p><p id="eb9f" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 4。NAT网关-AZ A</em>T9】</strong></p><p id="86e0" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">当VPC创建完成后，转到NAT网关部分，您应该看到AWS为您创建的网关。为了更容易识别，让我们将它的名称标签编辑为<em class="lh"> nat-a </em>。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/ba3772f77f8e9a0f720cded88f04965c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eo0BAbgWM6FA_WZYU75ARg.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图8</figcaption></figure><p id="b860" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 5。路由表-AZ A</em>T15】</strong></p><p id="ab15" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">亚马逊还为你的VPC配置了路由表。转到<em class="lh">路由表</em>部分，您应该有两个与您的VPC相关联的路由表。其中一个是您的VPC的主路由表，第二个当前与您的公共子网a相关联。我们将稍微修改一下该设置。</p><p id="1739" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">首先，选择主路由表，进入路由选项卡，点击<em class="lh">编辑路由</em>。目前有两个条目。第一个意思是<em class="lh">任何引用本地VPC CIDR的IP地址都应该本地解析</em>，我们不应该修改它。第二个指向NAT网关，但我们将更改它来配置VPC的Internet网关，以便让传出流量到达外部世界。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/1728bdffc6e60f93b43b4aba3eb3c4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2iTzcgbVXDr2-oRaBQ6DVA.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图9</figcaption></figure><p id="2609" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">接下来，转到<em class="lh">子网关联</em>选项卡，将主路由表与public-subnet-a相关联。您还可以将其名称标签编辑为<em class="lh"> main-rt </em>。然后，选择与您的VPC相关联的第二个路由表，编辑其路由，将每个传出的Internet请求路由到nat-a网关，如图10所示。将该路由表与private-subnet-a相关联，并将其名称标签编辑为<em class="lh"> private-a-rt </em>。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/58cd258ea2615a50791ce79dac71ff24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BTLtSr-K6fg0iFF3.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图10</figcaption></figure><p id="f6c5" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 6。可用性区域B配置</em> </strong></p><p id="f40f" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">干得好，可用性区域A已配置完毕。为了提供高可用性，我们还需要在第二个可用性区域中设置一切。第一步是创建子网。再次转到AWS管理控制台中的VPC仪表板，在左侧菜单栏中找到<em class="lh">子网</em>部分。现在，点击<em class="lh">创建子网</em>按钮，如图11和12所示进行配置。</p><p id="d3f9" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><em class="lh">公共子网b </em></p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/2a31ca04cc256f316fae4c34a9e13ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1uQB3qWnH7WCIGIGQaMwg.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图11</figcaption></figure><p id="1d4b" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><em class="lh">私有子网b </em></p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/be332db0a94007b928dd998c7a1a86e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iWz6cd3lk0efm0Ve.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图12</figcaption></figure><p id="4155" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir"> <em class="lh"> 7。NAT网关- AZ B </em> </strong></p><p id="3832" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">对于可用性区域B，我们需要手动创建NAT网关。为此，在VPC仪表板的左侧菜单栏中找到NAT网关部分，并点击<em class="lh">创建NAT网关</em>。选择<em class="lh"> public-subnet-b </em>，分配EIP，添加一个Name tag，值为<em class="lh"> nat-b </em>。</p><p id="8860" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><strong class="km ir">T29】8。路由表-AZ BT31】</strong></p><p id="f0d4" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">最后一步是为可用性区域b中的子网配置路由表。为此，请再次转到<em class="lh">路由表</em>部分。我们的public-subnet-b将与public-subnet-a具有相同的路由规则，因此让我们为public-subnet-b的main-rt表添加一个新的关联。然后，单击<em class="lh">创建路由表</em>按钮，将其命名为<em class="lh"> private-b-rt </em>，选择我们的VPC并单击<em class="lh">创建</em>。接下来，选择新创建的表，将其与private-subnet-b相关联，并通过与private-a-rt表类似的方式<em class="lh">编辑其路由</em>。不同之处在于，不是将每一个外出请求定向到nat-a网关，而是将其路由到nat-b(图13)。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/242dbb12182671ea0c43ad94fa2d9c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R19X8XF-V3mb8-gIDCntMw.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图13</figcaption></figure><p id="0087" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated">最后，您应该有三个与您的VPC相关联的路由表，如图14所示。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oh"><img src="../Images/8ef85f9d13d5418d0bf535d0f4700035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*byMxOIyAKmxLWA9Q.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图14</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="3cce" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">摘要</h1><p id="dcb5" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated">就这样，我们VPC的脚手架准备好了。图15所示的图表展示了所创建的基础设施的视图。现在可以创建所需的EC2实例、堡垒主机和RDS数据库的配置了。我们将在<a class="ae nm" rel="noopener ugc nofollow" target="_blank" href="/the-path-towards-enterprise-level-aws-infrastructure-part-2-ec2-ami-bastion-host-rds-3109c73dc913">系列的下一部分</a>中完成。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/63188f9a7d4290d2c4b3488c2e632f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X97dHGJBtlBcZkJXbwXe0g.jpeg"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">图15</figcaption></figure><h1 id="d56e" class="mi mj iq bd mk ml om mn mo mp on mr ms mt oo mv mw mx op mz na nb oq nd ne nf bi translated">来源:</h1><p id="8527" class="pw-post-body-paragraph kk kl iq km b kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld nk lf lg ki ij bi translated"><a class="ae nm" href="https://azure.microsoft.com/en-us/overview/what-is-cloud-computing/" rel="noopener ugc nofollow" target="_blank">https://azure . Microsoft . com/en-us/overview/what-is-cloud-computing/</a><br/>T3】https://aws.amazon.com/what-is-aws/<br/><a class="ae nm" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS sec 2/latest/user guide/elastic-IP-addresses-EIP . html</a><br/><a class="ae nm" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/VPC/latest/user guide/VPC _ Route _ tables . html</a><br/><a class="ae nm" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#DefaultSecurityGroup" rel="noopener ugc nofollow" target="_blank">https</a></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="d187" class="pw-post-body-paragraph kk kl iq km b kn lk kp kq kr ll kt ku kv ly kx ky kz lz lb lc ld ma lf lg ki ij bi translated"><em class="lh">原载于2020年4月16日</em><a class="ae nm" href="https://grapeup.com/blog/read/the-path-towards-enterprise-level-aws-infrastructure-architecture-scaffolding-77" rel="noopener ugc nofollow" target="_blank"><em class="lh">【https://grapeup.com】</em></a><em class="lh">。</em></p></div></div>    
</body>
</html>