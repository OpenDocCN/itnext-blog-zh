<html>
<head>
<title>How to Use Native Image and Iframe Lazy-Loading in Websites</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在网站中使用原生图像和Iframe延迟加载</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-native-image-and-iframe-lazy-loading-in-website-2109d577f7b1?source=collection_archive---------2-----------------------#2020-08-31">https://itnext.io/how-to-use-native-image-and-iframe-lazy-loading-in-website-2109d577f7b1?source=collection_archive---------2-----------------------#2020-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c333a9db2c39b330a8b2e2877643c426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UViV2WBT4Z9TXMDu"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">查尔斯·德鲁维奥在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="4860" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">通过延迟加载提高你的网站加载速度</h2></div><p id="83e5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为web和移动开发人员，我们经常试图交付这些应用程序的最终包大小。这包括缩小HTML、样式表、字体和脚本等东西，这对交付快速应用程序和网站有很大帮助。像Lighthouse这样的工具可以用来审计网站。</p><p id="4b50" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一方面，图片占了网站的很大一部分。根据<a class="ae jg" href="https://httparchive.org/reports/page-weight" rel="noopener ugc nofollow" target="_blank"> HTTP Archive </a>的说法，图片可以占到网页总权重的50%。对于某些站点，这个数字可能更高。想想亚马逊或易贝这样的电子商务平台和脸书或Twitter这样的社交媒体平台:如果你提供产品或让人们分享图片，那么图片将对页面大小和加载性能产生很大影响。</p><figure class="lv lw lx ly gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lu"><img src="../Images/8de5152cf6c5c0c12be0111ca9fc570f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp76_p71af1WaeBCwclvAw.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">易贝上的商品通常有好看的图片来增加销量</figcaption></figure><p id="68f7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并非所有的图像都同样重要。虽然网站顶部的网站徽标应该立即出现在页面加载中，但页面底部的图像不一定需要立即加载。想想易贝上提供的大量产品:如果你只看易贝向你展示的前10条建议，你真的需要加载所有交易的图片吗？</p><p id="7747" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">即使你不在这些图像密集型行业工作，增加网站的加载时间也是非常容易的。我们可以优化和压缩我们的脚本和字体，但如果营销部门的人在你的网站上随意放一些高分辨率的未压缩图像，而不问后果，这一切都是徒劳的。这就是你的好的<a class="ae jg" href="https://developers.google.com/web/tools/lighthouse" rel="noopener ugc nofollow" target="_blank">灯塔</a>排名(如果你一开始就有)。</p><p id="01a5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">有多种方法可以减少图片对网站性能的负面影响:</p><ul class=""><li id="1411" class="lz ma jj la b lb lc le lf lh mb ll mc lp md lt me mf mg mh bi translated">有一些服务或软件库可以压缩图像以减小尺寸</li><li id="4cdc" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">您可以以多种分辨率存储同一幅图像，并根据网络速度或屏幕大小等因素提供合适的图像</li><li id="b758" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">可以缓存图像和其他资源。这不会改善初始加载时间，但后续加载时间会更好，因为缓存的图像会被提供。请小心，因为您可能不想对所有内容都进行缓存！</li><li id="5e81" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">您可以使用无限滚动或虚拟滚动等技术。这最适合基于列表或网格的布局。因为用户需要进一步滚动才能看到更多的内容，所以你永远不要一次渲染超过两张图片。然而，这些方法也有缺点(例如易访问性问题)，它们不能适用于所有情况。</li><li id="3afa" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">你可以告诉浏览器只在用户将要看到图片的时候加载图片。例如:如果用户访问你的网站，从来没有向下滚动到页面的末尾，那么你的网站末尾的图片将永远不会被加载！</li></ul><p id="918e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们仔细看看上面提到的最后一个建议，以及我们如何应用它来减少网站的加载时间。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="c4ce" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">嗯，解决起来不会那么难吧？</h2><p id="e774" class="pw-post-body-paragraph ky kz jj la b lb nn kk ld le no kn lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">对于图像的延迟加载，已经提出了多种解决方案。如果您简单地思考一下，这个问题一开始似乎很容易解决:</p><ul class=""><li id="5915" class="lz ma jj la b lb lc le lf lh mb ll mc lp md lt me mf mg mh bi translated">像图片这样的资源，如果有<code class="fe ns nt nu nv b">src</code>属性，浏览器会自动下载。因此，在元素上设置了一个值为URL的自定义HTML属性(如<code class="fe ns nt nu nv b">data-src</code>)。代替指定一个</li><li id="37c0" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">添加一个事件侦听器来侦听滚动事件。</li><li id="31a2" class="lz ma jj la b lb mi le mj lh mk ll ml lp mm lt me mf mg mh bi translated">如果用户将要滚动到图像:使用自定义HTML属性设置HTML元素的<code class="fe ns nt nu nv b">src</code>属性，让浏览器知道它应该请求图像</li></ul><p id="ce28" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，一些缺点可以立即被注意到。如果不去抖滚动事件监听，该功能将被触发很多次，这可能导致更差的性能。当然，也有一些开源库，比如<a class="ae jg" href="https://github.com/verlok/vanilla-lazyload" rel="noopener ugc nofollow" target="_blank"> vanilla-lazyload </a>承诺可以轻松地在所有浏览器中运行。</p><p id="4326" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最近，现代浏览器开始支持一个易于使用和向后兼容的解决方案，我觉得很有趣。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="c749" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">如何延迟加载只有一个HTML属性的图像</h2><p id="049d" class="pw-post-body-paragraph ky kz jj la b lb nn kk ld le no kn lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">有一个<code class="fe ns nt nu nv b"><a class="ae jg" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/loading" rel="noopener ugc nofollow" target="_blank">loading</a></code> HTML属性。通过设置<code class="fe ns nt nu nv b">loading="lazy"</code>，只有当用户在图片附近滚动时，图片才会被下载。没有比这更容易的了。如果图像立即可见(例如，因为它在顶部导航栏中)，图像仍将照常显示。</p><p id="485f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">看看下面的例子。我使用了Chrome开发者工具，这样你就能看出区别了。如果没有延迟加载，那么在加载页面时所有的图像都会被请求。但是对于延迟加载，我们只加载我们实际上可以看到的图像。只有当我们进一步向下滚动到接近页面末尾时，底部的图像才会被请求。</p><div class="lv lw lx ly gt ab cb"><figure class="nw iv nx ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/abc927dbc3cf2ffcdba44c792add7885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*7k1n9UOpOgDrUXaIgrJpkw.png"/></div></figure><figure class="nw iv oc ny nz oa ob paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/f8da597da1fa8c263ff3ceba05c202e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*AB9SvCJTZHr4qEaOuOLz0w.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk od di oe of translated">左:初始页面加载。右:向下滚动到页面末尾。</figcaption></figure></div><p id="805e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">目前，这种方法并不适用于所有的浏览器(看看你，IE11)。然而，最近版本的Chrome、Firefox和基于Chrome的Edge已经支持它了。这就是渐进增强的概念:使用现代网络浏览器的用户正从这一功能中受益，而网站仍然适用于尚不支持它的浏览器。</p><p id="71ea" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了支持尽可能多的浏览器，你也可以使用第三方的解决方案来支持不支持本地延迟加载的浏览器。</p><pre class="lv lw lx ly gt og nv oh oi aw oj bi"><span id="e780" class="mu mv jj nv b gy ok ol l om on">if(!('loading' in HTMLImageElement.prototype)) {<br/>  // apply fallback solution for older browsers<br/>}</span></pre><p id="01b2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Pro提示:为惰性加载的元素提供<code class="fe ns nt nu nv b">width</code>和<code class="fe ns nt nu nv b">height</code>是有意义的。即使你不知道确切的尺寸，至少提供一些<code class="fe ns nt nu nv b">min-height</code>和<code class="fe ns nt nu nv b">min-width</code>也是一个好主意，以避免加载图像时出现大的布局偏移。Chrome Developer Tools或Firefox DevTools允许您模拟较慢的网络速度，这可以帮助您在不太理想的条件下测试您的网站。</p></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="f893" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">如何实现iframes的延迟加载</h2><p id="914f" class="pw-post-body-paragraph ky kz jj la b lb nn kk ld le no kn lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">除了图片，许多网站使用<code class="fe ns nt nu nv b"><a class="ae jg" href="http://iframe" rel="noopener ugc nofollow" target="_blank">iframe</a></code>在你的网站上嵌入外部网站。例如，一个Twitter feed或者你在谷歌地图上的办公室位置可以很容易地嵌入到任何使用<code class="fe ns nt nu nv b">iframe</code>的网站上。你实际上是在你的网站中加载一个网站。</p><p id="c256" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">iframe的本地延迟加载会延迟屏幕外iframe的加载，直到用户滚动到它们附近。这样可以保存数据，加快页面其他部分的加载速度，并减少内存使用。</p><pre class="lv lw lx ly gt og nv oh oi aw oj bi"><span id="1f5d" class="mu mv jj nv b gy ok ol l om on">&lt;iframe src="https://example.com"<br/>        loading="lazy"<br/>        width="600"<br/>        height="400"&gt;&lt;/iframe&gt;</span></pre></div><div class="ab cl mn mo hx mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="im in io ip iq"><h2 id="1fe4" class="mu mv jj bd mw mx my dn mz na nb dp nc lh nd ne nf ll ng nh ni lp nj nk nl nm bi translated">结论</h2><p id="46b4" class="pw-post-body-paragraph ky kz jj la b lb nn kk ld le no kn lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">感谢您阅读这篇短文。如您所见，现代浏览器允许延迟加载图像和iframes，而没有任何明显的缺点。由开发人员决定是否应该延迟加载特定的图像或iframe。你是如何在你的网站中实现延迟加载的？请在评论中告诉我。</p></div></div>    
</body>
</html>