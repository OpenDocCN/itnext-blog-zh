<html>
<head>
<title>Flutter + Stripe Connect + 3DSecure (SCA)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤动+条带连接+3d安全(SCA)</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-stripe-connect-3dsecure-sca-ab8fd364ca1e?source=collection_archive---------0-----------------------#2020-08-03">https://itnext.io/flutter-stripe-connect-3dsecure-sca-ab8fd364ca1e?source=collection_archive---------0-----------------------#2020-08-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9370" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何将Stripe Connect \w 3DSecure (SCA)集成到基于Flutter的应用程序中！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/98def264f6b338eaa5613153889b6dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AHiyxR0qlInbqdEr"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@othentikisra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> israel palacio </a>拍摄</figcaption></figure><p id="7ad3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最近，我不得不在一个基于Flutter的应用程序中实现一个支付系统。</p><p id="598b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">特别是，应用程序业务遵循这个简单的方案:</p><blockquote class="ls lt lu"><p id="5922" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">有一个商人不得不在网上出售他们的商品。该应用程序支持向该商家进行在线销售。</p><p id="aed0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">在这种情况下，应用程序充当这个商家和他们的客户之间的中介。因为这项服务，App向商家收取费用。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/5c4be8120df8e4b7597ac7fbc89a470a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYzhnomfmiX-TQu_aNgiDg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">商业模式</figcaption></figure><h1 id="cf5d" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">条带连接</h1><p id="fd46" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">有不同的解决方案，经过一些研究，我发现<strong class="ky ir">条纹连接</strong>最适合我的具体情况。</p><div class="mx my gp gr mz na"><a href="https://stripe.com/connect" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">Stripe Connect:面向市场和平台的支付平台</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">使用Stripe Connect为市场和平台设置支付。Connect可在任何平台内快速集成…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">stripe.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no kp na"/></div></div></a></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/c1b049d181a2ac22708eae0742450a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDB4O8HIawoH78-mgHd7Sg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><strong class="bd mc">从</strong>到<a class="ae kv" href="https://stripe.com/docs/connect/enable-payment-acceptance-guide" rel="noopener ugc nofollow" target="_blank">条纹</a></figcaption></figure><h2 id="66f5" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated"><strong class="ak">谁是谁？</strong></h2><p id="f1e6" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">应用条带的术语，我们有:</p><ol class=""><li id="1841" class="oc od iq ky b kz la lc ld lf oe lj of ln og lr oh oi oj ok bi translated"><strong class="ky ir">平台账号</strong> = <em class="lv"> App </em></li><li id="75c0" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><strong class="ky ir">关联账户</strong> = <em class="lv">商户</em></li></ol></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="d982" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我开始工作，开始阅读API文档…</p><ul class=""><li id="e790" class="oc od iq ky b kz la lc ld lf oe lj of ln og lr ox oi oj ok bi translated"><em class="lv">* *拜托！求你了。支持颤振！** </em></li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><blockquote class="pa"><p id="43e4" class="pb pc iq bd pd pe pf pg ph pi pj lr dk translated"><strong class="ak">无颤振</strong>。</p></blockquote><figure class="pl pm pn po pp kk gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/aedfe28d34d83f154eef05a51e046e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*wdtJ65oLb7bI9Eo5RhfWog.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">支持的库</figcaption></figure><p id="8c44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，我有两个选择:</p><ol class=""><li id="3f3e" class="oc od iq ky b kz la lc ld lf oe lj of ln og lr oh oi oj ok bi translated">自己包装REST API。</li><li id="5d75" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated">找一个已经做过这项工作的人。❤ </li></ol><p id="4aee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">猜猜我的选择是什么。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="pq oz l"/></div></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="6a03" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">酒吧开发</h1><p id="81c4" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">经过一些包装测试，我发现以下一个最有希望:</p><div class="mx my gp gr mz na"><a href="https://pub.dev/packages/stripe_sdk" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">stripe_sdk | Flutter包</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">条纹的原生dart包。有各种各样的其他flutter插件包装现有的条带库，但是这个…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">公共开发</p></div></div><div class="nj l"><div class="pw l nl nm nn nj no kp na"/></div></div></a></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi px"><img src="../Images/32723e5dadde17ef84e3052138eb19df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPxRE3tFJolP1H0wrgEorQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://pub.dev/packages/stripe_sdk" rel="noopener ugc nofollow" target="_blank">颤振条纹SDK </a></figcaption></figure><h1 id="fb2c" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">开始之前:条纹中的一些关键词</strong></h1><ol class=""><li id="33f8" class="oc od iq ky b kz ms lc mt lf py lj pz ln qa lr oh oi oj ok bi translated"><em class="lv">付款方式</em></li><li id="8d6a" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><em class="lv">可发布/保密API密钥</em></li><li id="f762" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><em class="lv">账户ID </em></li><li id="b21e" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><em class="lv">付款意向</em></li><li id="ace2" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><em class="lv">客户端秘密</em></li></ol><h2 id="cf6c" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">付款方式</h2><blockquote class="ls lt lu"><p id="2d6d" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">PaymentMethod对象代表客户的支付工具。</p></blockquote><p id="06ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">例如客户的卡。</em></p><h2 id="e973" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">可发布/保密API密钥</h2><blockquote class="ls lt lu"><p id="5cf0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">P <strong class="ky ir">可公开的</strong> API密匙仅仅是为了用Stripe来识别<strong class="ky ir">你的</strong>账户，它们不是秘密的。换句话说，它们可以安全地发布在Stripe.js JavaScript代码或Android或iPhone应用程序中。(来自<a class="ae kv" href="https://stripe.com/docs/keys" rel="noopener ugc nofollow" target="_blank">条纹</a>)</p><p id="e66b" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">API密匙应该保密，只存储在你自己的服务器上。您帐户的秘密API密钥可以不受限制地执行任何API请求。(来自<a class="ae kv" href="https://stripe.com/docs/keys" rel="noopener ugc nofollow" target="_blank">条纹</a>)</p></blockquote><p id="97e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Stripe提供了两对不同的可发布/保密API密钥:</p><ol class=""><li id="455c" class="oc od iq ky b kz la lc ld lf oe lj of ln og lr oh oi oj ok bi translated"><strong class="ky ir">测试</strong>:使用这一对来测试你的代码。每笔付款都是假的。Stripe提供了一套测试卡<a class="ae kv" href="https://stripe.com/docs/testing" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="a68d" class="oc od iq ky b kz ol lc om lf on lj oo ln op lr oh oi oj ok bi translated"><strong class="ky ir">现场</strong>:制作时使用这对。</li></ol><p id="4346" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">您可以在条纹仪表盘中找到这些钥匙。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/7003704a855c68e650dd16b47400d9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89-At2nJ0YH5Ladg4RMfVw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">可公布/秘密密钥</figcaption></figure><h2 id="7b15" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">帐户ID</h2><blockquote class="ls lt lu"><p id="dba0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">账户ID代表<strong class="ky ir">商户磁条关联账户</strong>。由于这个ID，Stripe知道谁发送支付的金额。</p></blockquote><h2 id="9aae" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">如何添加关联账户？</h2><p id="0d4d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated"><em class="lv">仪表盘&gt;关联账户&gt;创建(标准账户应该足够)</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qb"><img src="../Images/383f6f5fea403ff480acd0dcc4ec0227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TuwqW3_KLbYkD-3zBchRAw.png"/></div></div></figure><p id="7d1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在Stripe仪表盘的<strong class="ky ir"> <em class="lv">关联账户</em> </strong> <em class="lv">下找到账户ID。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qc"><img src="../Images/9b213958f09640cdd4ca6b42275ff9d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_4itLlEKlJ3gRTnU-wBFXA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi qc"><img src="../Images/663f93967a3970e424d660042f8d2648.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0UyLs1THorl4zoZDvEJPjg.png"/></div></div></figure><h2 id="de16" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">付款意向</h2><blockquote class="ls lt lu"><p id="69f1" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">付款意向指导您完成向客户收款的过程。(来自<a class="ae kv" href="https://stripe.com/docs/api/payment_intents" rel="noopener ugc nofollow" target="_blank">条纹</a>)</p></blockquote><p id="1e64" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">特别地，一个<strong class="ky ir"> <em class="lv">支付意图</em> </strong> <em class="lv"> </em> <strong class="ky ir"> <em class="lv">对象</em> </strong>定义了顾客购买商家出售的商品必须花费的金额($)。</p><p id="19d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于App对提供给商家的服务收取一些费用，所以在支付意向中，需要定义<strong class="ky ir"> <em class="lv">申请_费用_金额</em> </strong>(即我每笔交易赚多少钱)。</p><p id="20b0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了<strong class="ky ir"> <em class="lv">金额</em> </strong>和<strong class="ky ir"> <em class="lv">申请_费用_金额</em> </strong>之外，还需要定义使用哪种支付方式(即客户的卡数据如<em class="lv">卡号</em>、<em class="lv">到期日</em>和、<em class="lv"> CVC </em>)以及商户账号ID。</p><p id="18d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在付款意向中有几个其他的参数需要配置，但目前来说，还可以。把握住思路就好。我们将在编码部分对此进行更深入的探讨。</p><h2 id="c418" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">客户机密</h2><blockquote class="ls lt lu"><p id="3f1c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">PaymentIntent的客户端密码是一个唯一的密钥，允许您在客户端确认支付和更新卡的详细信息，而不允许操纵敏感信息，如支付金额。(来自<a class="ae kv" href="https://stripe.com/docs/connect/enable-payment-acceptance-guide" rel="noopener ugc nofollow" target="_blank">条纹</a></p></blockquote><p id="84ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦创建了支付意图对象，就返回客户秘密。</p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><blockquote class="pa"><p id="5510" class="pb pc iq bd pd pe qd qe qf qg qh lr dk translated">解决这个问题:</p><p id="405b" class="pb pc iq bd pd pe qd qe qf qg qh lr dk translated">可发布密钥标识谁接收“<strong class="ak">申请_费用_金额”</strong>(即应用)</p><p id="d993" class="pb pc iq bd pd pe qd qe qf qg qh lr dk translated">账户ID标识谁接收“金额”(即商家)</p></blockquote></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="d935" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">相关数据存储在哪里？</h1><p id="c05b" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">让我们看看哪些数据必须存储在应用程序中，哪些数据必须存储在服务器中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/301ecf4d6e15a9df62df5dcfda20a0cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*SuinyBQuW3oPSXl0ZU4ZTg.png"/></div></figure><p id="7b3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于<strong class="ky ir"> <em class="lv">密钥</em> </strong>能够验证支付请求，您必须将其存储在远离应用程序的安全位置(例如，在服务器中)。</p><p id="e7d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，<strong class="ky ir"> <em class="lv">账户ID </em> </strong>标识了向其发送顾客消费金额的商家。由于应用程序需要知道帐户ID，你必须找到一种方法来传达给应用程序这个信息。一个合理的选择是将帐户ID存储在服务器中，然后应用程序将根据请求从服务器中检索这些数据(例如，在支付时)。</p><p id="4914" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> <em class="lv">金额</em> </strong>和<strong class="ky ir"><em class="lv">application _ fee _ Amount</em></strong>应该在服务器创建的支付意向中“硬编码”。</p><h2 id="e519" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated"><strong class="ak"> <em class="qj">为什么？</em> </strong></h2><blockquote class="ls lt lu"><p id="3bbc" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">假设在app端存储<strong class="ky ir"> <em class="iq">金额</em> </strong>和<strong class="ky ir"> <em class="iq">申请_费用_金额</em> </strong> <em class="iq">。有人可以手动改变他们，并设置每一个为零，所以…没有收入，无论是你还是商人！</em></p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qk oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">免费地</figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="3640" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">商业逻辑</h1><p id="0d01" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">下面的序列图应该有助于您理解代码执行流程。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lz"><img src="../Images/f8f23f5bc5566995dcc5c6245362359e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xCFzIEBKnJDl7FYc5hBZQ.png"/></div></div></figure><h2 id="f656" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated"><strong class="ak">但是等等，什么是3D安全(SCA)？</strong></h2><blockquote class="ls lt lu"><p id="8b8c" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">为了提供额外的欺诈保护，3D Secure要求客户在支付时与发卡机构完成额外的验证步骤。通常，您会将客户引导至其银行网站上的认证页面，然后他们输入与卡相关的密码或发送至其手机的代码。通过信用卡网络的品牌名称，如Visa Secure和Mastercard Identity Check，客户对这一过程很熟悉。(<a class="ae kv" href="https://stripe.com/docs/payments/3d-secure#three-ds-cards" rel="noopener ugc nofollow" target="_blank">条纹</a>)</p></blockquote><h2 id="e4c8" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated"><strong class="ak">有必要吗？</strong></h2><p id="8696" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated"><strong class="ky ir">绝对是的</strong>。如果一些客户卡启用了3D secure，而您没有提供正确的代码来处理它，则交易将被拒绝。</p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="5752" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">最后:让我们编码</h1><h2 id="24fc" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">服务器端</h2><p id="1139" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">您需要在服务器上安装条带包。</p><p id="6349" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为我决定用python编码:</p><pre class="kg kh ki kj gt ql qm qn qo aw qp bi"><span id="48f0" class="nq mb iq qm b gy qq qr l qs qt">pip3 install stripe</span></pre><p id="b762" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我用过AWS Lambda服务，但是你可以用你喜欢的方式实现下面的<em class="lv"> POST </em>方法。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div></figure><h2 id="5275" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">金额/申请费用金额</h2><p id="76e3" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">你已经知道这些参数是什么了。只想澄清一件事:</p><pre class="kg kh ki kj gt ql qm qn qo aw qp bi"><span id="ca29" class="nq mb iq qm b gy qq qr l qs qt">amount = 1000</span></pre><p id="76f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它代表10.00€。(如果您设置<em class="lv">货币=‘欧元’</em>)</p><p id="ab6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样适用于<em class="lv">申请_费用_金额，140代表1.40€ </em></p><h2 id="23de" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">收据_电子邮件</h2><blockquote class="ls lt lu"><p id="2f3f" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">在“receipt_email”中指定客户电子邮件，一旦交易处理完毕，Stripe将向客户发送一封关于交易状态的电子邮件。</p></blockquote><p id="fc0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个参数不是必需的，但是，我发现这个参数对反馈客户非常有用。万一有任何问题，顾客可以给你看收据，你们可以一起找到解决办法。</p><h2 id="0851" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">确认</h2><blockquote class="ls lt lu"><p id="9dc0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">设置为<code class="fe qv qw qx qm b">true</code>以尝试立即确认该支付内容。(<a class="ae kv" href="https://stripe.com/docs/api/payment_intents/confirm" rel="noopener ugc nofollow" target="_blank">条纹</a>)</p></blockquote><blockquote class="pa"><p id="8796" class="pb pc iq bd pd pe pf pg ph pi pj lr dk translated">服务器端部分结束。很简单，不是吗？</p></blockquote><figure class="pl pm pn po pp kk"><div class="bz fp l di"><div class="qy oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">他妈的是啊</figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="a095" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">应用程序端</h1><p id="21b6" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">您可以在此处找到Flutter SDK条带包:</p><div class="mx my gp gr mz na"><a href="https://pub.dev/packages/stripe_sdk" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">stripe_sdk | Flutter包</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">条纹的原生dart包。有各种各样的其他flutter插件包装现有的条带库，但是这个…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">公共开发</p></div></div><div class="nj l"><div class="pw l nl nm nn nj no kp na"/></div></div></a></div><p id="a965" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的Flutter项目的pubspec.yaml中添加以下依赖项。</p><pre class="kg kh ki kj gt ql qm qn qo aw qp bi"><span id="ccc9" class="nq mb iq qm b gy qq qr l qs qt">dependencies:<br/>  <strong class="qm ir">stripe_sdk: ^3.0.1+1</strong></span></pre><h2 id="4be9" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated"><a class="ae kv" href="https://pub.dev/packages/stripe_sdk" rel="noopener ugc nofollow" target="_blank"> 3D安全设置</a></h2><p id="ebba" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">现在让我们设置<code class="fe qv qw qx qm b">AndroidManifest.xml</code> (Android)和<code class="fe qv qw qx qm b">Info.plist</code> (iOS)文件来处理3D Secure (SCA)。</p><blockquote class="ls lt lu"><p id="f5a5" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">库“stripe_sdk”在iOS和Android上提供了对SCA的完整支持。它处理所有类型的SCA，包括3DS、3DS2、BankID等。它通过在web浏览器中启动身份验证流来处理SCA，并将结果返回给应用程序。如以下步骤所示，<code class="fe qv qw qx qm b">returnUrlForSca</code>参数必须与您的<code class="fe qv qw qx qm b">AndroidManifest.xml</code>和<code class="fe qv qw qx qm b">Info.plist</code>的配置相匹配。</p></blockquote><h2 id="e30d" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">机器人</h2><p id="0d4f" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">您需要在<code class="fe qv qw qx qm b">android/app/src/main/AndroidManifest.xml</code>中声明以下意图过滤器。这个例子是针对URL <code class="fe qv qw qx qm b">stripesdk://3ds.stripesdk.io</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">演职员表:<a class="ae kv" href="https://pub.dev/packages/stripe_sdk" rel="noopener ugc nofollow" target="_blank">颤动条纹SDK </a></figcaption></figure><h2 id="0a00" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">ios</h2><p id="e04d" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">对于iOS，您需要在<code class="fe qv qw qx qm b">ios/Runner/Info.plist</code>中声明方案(或者通过Xcode的目标信息编辑器，在URL类型下)。这个例子针对的是URL <code class="fe qv qw qx qm b">stripesdk://3ds.stripesdk.io</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">演职员表:<a class="ae kv" href="https://pub.dev/packages/stripe_sdk" rel="noopener ugc nofollow" target="_blank">颤动条纹SDK </a></figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h2 id="aeab" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">颤动前端</h2><p id="9f86" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">让我们对信用卡小部件和购买按钮进行编码，以提交交易。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">小工具</figcaption></figure><h2 id="120d" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">遵循预期结果:</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qz"><img src="../Images/cd4d81a9bdb41f54ed63ec4692180de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*2T2IrvCBhEYki6rciXI9Zw.png"/></div></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="fbf6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成上一步后，让我们编写<code class="fe qv qw qx qm b">buy()</code>函数。</p><p id="d18e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lv">不要忘记添加对CVC、Date和CardNumber有效性的检查。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">购买功能</figcaption></figure><p id="d08c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe qv qw qx qm b">createPaymentIntent() </code>创建一个<em class="lv">支付方法</em>，并通过<code class="fe qv qw qx qm b">postPaymentIntent()</code>将支付方法提交给服务器(连同顾客的电子邮件)。它返回<em class="lv"> clientSecret。</em></p><p id="8ae7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后<code class="fe qv qw qx qm b">retrievePaymentIntent()</code>被调用，它返回<em class="lv"> paymentIntentRes。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">CretePaymentIntent和postCreatePaymentIntent函数</figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="26f3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下函数处理启用3D安全的卡。如果卡未启用3D secure，则不会调用此功能，支付过程会顺利进行。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">3D安全处理器功能</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qz"><img src="../Images/e4ea4c0f1bc1265c2f5bc0a726f221ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*vyMyKfIGTcrPHn8vi8BmXA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">3D安全Webhook</figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="d1e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">遵循完整的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="qu oz l"/></div></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h2 id="2da2" class="nq mb iq bd mc nr ns dn mg nt nu dp mk lf nv nw mm lj nx ny mo ln nz oa mq ob bi translated">测试</h2><p id="1dfb" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">现在你可以自己测试卡片了。使用条纹提供的<a class="ae kv" href="https://stripe.com/docs/testing" rel="noopener ugc nofollow" target="_blank">该卡组</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi qz"><img src="../Images/5a437f84491078c666f568a2df26f61b.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*_iExtRwrDH6pYEQmNWyl0w.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">成功！</figcaption></figure></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><h1 id="2d04" class="ma mb iq bd mc md pr mf mg mh ps mj mk jw pt jx mm jz pu ka mo kc pv kd mq mr bi translated">那都是乡亲们！</h1><p id="a4d0" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">给出的代码是一个基本的例子，但它是可行的！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ra oz l"/></div></figure><p id="ccfe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的<a class="ae kv" href="https://github.com/Brotherhood94/FlutterWithStripeExample" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> GitHub </strong> </a>上有项目资源库！</p><div class="mx my gp gr mz na"><a href="https://github.com/Brotherhood94/FlutterWithStripeExample/tree/master/medium_stripe" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">brotherhood 94/flutter with tripe示例</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">本报告展示了一个集成示例Flutter+Stripe connect+3d secure(SCA)-brotherhood 94/Flutter with Stripe示例</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">github.com</p></div></div><div class="nj l"><div class="rb l nl nm nn nj no kp na"/></div></div></a></div><p id="50ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">欢迎任何建议！</p><h1 id="9bdd" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">再见！</strong></h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="rc oz l"/></div></figure></div></div>    
</body>
</html>