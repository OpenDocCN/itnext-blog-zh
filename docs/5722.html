<html>
<head>
<title>Rendering performance demo: 20.000 delta updates per second</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">渲染性能演示:每秒20.000次增量更新</h1>
<blockquote>原文：<a href="https://itnext.io/rendering-performance-demo-20-000-delta-updates-per-second-6f527d8eb8f5?source=collection_archive---------6-----------------------#2021-05-10">https://itnext.io/rendering-performance-demo-20-000-delta-updates-per-second-6f527d8eb8f5?source=collection_archive---------6-----------------------#2021-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3209" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了更好地了解作为主角的应用程序工作人员有多强大，我增强了helix演示，为您提供了一个可视化的反馈。</p><h1 id="0b99" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">内容</h1><ol class=""><li id="62e1" class="lj lk iq jp b jq ll ju lm jy ln kc lo kg lp kk lq lr ls lt bi translated">介绍</li><li id="e9e4" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">螺旋DOM结构</li><li id="42e6" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">滚动时内部会发生什么？</li><li id="5cab" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">检查控制台内部的增量</li><li id="4a8e" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">视频来展示它的作用</li><li id="49b1" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">在线演示</li><li id="b533" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">更新:有33k更新的新演示</strong></li><li id="e460" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">最后的想法</li></ol><h1 id="c2d5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">1.介绍</h1><p id="fad7" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在<a class="ae mc" href="https://github.com/neomjs/neo" rel="noopener ugc nofollow" target="_blank"> neo.mjs </a>中，您的应用程序和组件存在于应用程序工作器中:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi md"><img src="../Images/4f4de4856c9b31ee6737b88937a9ad95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*zCl0yTiHZn58EoUTDf9L1g.png"/></div></figure><p id="b753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最令人印象深刻的性能演示之一是helix组件。我给这个增加了一个视觉反馈，这样你就可以实时看到数字:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/bddc9e07ac0010ca7dec896f3867a40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2IVreJk_C7rxs_zk73vjw.png"/></div></div></figure><p id="8e88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在还有一个“logDeltaUpdates”复选框，它将把增量记录到您的开发人员工具控制台中。</p><h1 id="1b30" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">2.螺旋DOM结构</h1><p id="3c20" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">这个演示是为了给你的浏览器增加压力而设计的。我们不使用WebGL、SVG或Canvas，只使用DOM节点。</p><p id="6fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以检查控制台内的螺旋项目:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mq"><img src="../Images/f6201c622e8f798f91c09d8366fdf684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Do80zr9FmqNaKlSPWQtl8A.png"/></div></div></figure><p id="ea27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用鼠标滚轮滚动(水平→旋转、垂直→缩放)将更新所有222个螺旋项目的<code class="fe mr ms mt mu b">transform: matrix3d()</code>值。</p><h1 id="47f0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">3.滚动时内部会发生什么？</h1><p id="616c" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">如上所述，helix组件直接存在于专用的或共享的应用程序工作器中。因为这个例子不是一个多窗口应用程序，“普通”的工作人员就足够了。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mv"><img src="../Images/ccf7813de6a9ee333d7fc578a874bd60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4qX8IMpvsIt6XQsdHwUrg.png"/></div></div></figure><p id="4370" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mc" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/wheel_event" rel="noopener ugc nofollow" target="_blank">轮事件</a>显然发生在主线程内部，并且它非常频繁地触发。对于每个事件，主线程将发送一个<a class="ae mc" href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage" rel="noopener ugc nofollow" target="_blank"> postMessage </a>给应用工作器。</p><p id="67e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序工作人员将把事件委托给我们的helix实例。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8fcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看<code class="fe mr ms mt mu b">refresh()</code>方法:</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e467" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在迭代所有的螺旋项目，并使用一点数学来计算新的旋转矩阵。</p><p id="4487" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里重要的部分是第75行:在vdom worker中使用虚拟dom引擎是可选的。我们可以将所有更改应用到vdom对象，并将其传递给引擎，以计算出我们需要的增量更新，但由于我们确实知道应该更改什么，我们可以简单地自行手动构建增量。这样肯定更快。</p><p id="62a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们有了所有helix项的新转换值，我们就向main发送一个postMessage，将我们的deltas应用到真正的DOM。</p><p id="ffcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在主线程内部，我们的增量将被推入一个队列，该队列将使用<a class="ae mc" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank"> requestAnimationFrame() </a>处理每个增量更新。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a7dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要的是要知道，增量更新可以比真正的DOM操作多得多。人眼和屏幕都有其局限性。例如，使用60 FPS的屏幕将增量更新的数量限制为60次屏幕刷新(使用每个节点的最后“状态”)。</p><p id="c5c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了显示增量的数量，我每250毫秒刷新一次内容div。一秒钟感觉太慢了。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="9eeb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">4.检查控制台内部的增量</h1><p id="9bd4" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">helix演示现在有以下复选框:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi my"><img src="../Images/57905f6eb46486f7df477952ff3fc2d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*_qU24hlSZ1yw_RfvxHgwHg.png"/></div></figure><p id="1c73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查它会给你关于正在发生的事情的详细日志。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/84e9fd8237bece6c29cc0886d36835fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*1ToqIAeqFiAXUSfWwtvzDg.png"/></div></figure><h1 id="5387" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">5.视频来展示它的作用</h1><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="na mx l"/></div></figure><p id="6a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">录制视频已经降低了性能。我在谷歌Chrome本地获得的最大值是每秒20.472次增量更新。</p><p id="61ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">公平地说，我有一台非常快的电脑。</p><p id="1692" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在Safari中获得了更高的数字，但实际性能感觉更慢。</p><p id="5348" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想知道这是不是我们能得到的最高数字:</p><p id="04c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是<strong class="jp ir">不是</strong>。</p><p id="5524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我用更多的螺旋项目或一些表格单元更新演示得到了更大的数字。</p><h1 id="4ef2" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">6.在线演示</h1><p id="e3fa" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">请使用<strong class="jp ir">桌面</strong>浏览器。这真的很重要。大多数neo.mjs演示尚未针对移动设备进行优化。</p><p id="6008" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">伙计们，我真的只说桌面。如果你使用移动设备，你会毁了你的第一印象。我们可以在某些时候调整演示(例如添加<a class="ae mc" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/scroll_event" rel="noopener ugc nofollow" target="_blank">滚动</a>监听器)。</p><p id="7a44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">分发/制作:</strong> <br/>适用于所有主流浏览器(基于webpack的输出)</p><p id="eba8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mc" href="https://neomjs.github.io/pages/node_modules/neo.mjs/dist/production/examples/component/coronaHelix/index.html" rel="noopener ugc nofollow" target="_blank">neo . mjs/dist/production/examples/component/corona helix/index . html</a></p><p id="bb4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> devmode: </strong> <br/>在Chrome和Safari Tech预览版中工作。</p><p id="29de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mc" href="https://neomjs.github.io/pages/node_modules/neo.mjs/examples/component/coronaHelix/index.html" rel="noopener ugc nofollow" target="_blank">neo.mjs/examples/component/coronaHelix/index.html</a></p><p id="dbe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在devmode版本中，你可以看到真正的代码(没有构建或编译，没有源代码图)。</p><h1 id="3df0" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">7.更新:33k更新的新演示</h1><p id="3a70" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">现在我很好奇，想更进一步。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="na mx l"/></div></figure><p id="0269" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请使用<strong class="jp ir">桌面</strong>浏览器。这真的很重要。大多数neo.mjs演示尚未针对移动设备进行优化。</p><p id="8da0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">地区/生产:</strong><br/><a class="ae mc" href="https://neomjs.github.io/pages/node_modules/neo.mjs/dist/production/examples/component/helix/index.html" rel="noopener ugc nofollow" target="_blank">neo.mjs/dist/production/examples/component/helix/index.html</a></p><p id="b9c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">devmode:</strong><br/><a class="ae mc" href="https://neomjs.github.io/pages/node_modules/neo.mjs/examples/component/helix/index.html" rel="noopener ugc nofollow" target="_blank">neo.mjs/examples/component/helix/index.html</a></p><h1 id="c230" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">8.最后的想法</h1><p id="68a2" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">您可以在此处找到该项目:</p><div class="nb nc gp gr nd ne"><a href="https://github.com/neomjs/neo" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">近地天体</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">neo.mjs使您能够使用一个以上的CPU创建可扩展的高性能应用程序，而无需使用…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">github.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns mj ne"/></div></div></a></div><p id="274f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">剧透</strong> : neo.mjs刚刚获得了“2021年最令人兴奋的技术应用”的提名，这是一个你绝对熟悉的奖项。我会随时通知你这件事。</p><p id="c030" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，我真的很好奇你能在你的机器上得到的增量更新的最高数量。欢迎将数字作为评论发布！</p><p id="6896" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您自己制作性能演示来强调引擎，那就更好了。我仍然没有弄清楚真正的极限。</p><p id="b0b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢并致以最诚挚的问候，<br/>托拜厄斯</p></div></div>    
</body>
</html>