<html>
<head>
<title>Why You Should Not Neglect Your Developer’s Kubernetes Clusters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么您不应该忽视您的开发人员的Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/why-you-should-not-neglect-your-developers-kubernetes-clusters-a658c8ca0e78?source=collection_archive---------1-----------------------#2018-10-04">https://itnext.io/why-you-should-not-neglect-your-developers-kubernetes-clusters-a658c8ca0e78?source=collection_archive---------1-----------------------#2018-10-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/b11210f76c273276e789425d7f3be41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*ZbMKp2Rtn4lTJnciDUWAeg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><a class="ae jy" href="https://xkcd.com/303/" rel="noopener ugc nofollow" target="_blank">原图</a>由XKCD的兰道尔·门罗创作。在<a class="ae jy" href="https://creativecommons.org/licenses/by-nc/2.5/" rel="noopener ugc nofollow" target="_blank">知识共享署名-非商业性2.5许可</a>下发布。</figcaption></figure><p id="ce3c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">所以你最终成功地说服了你的组织使用Kubernetes，你甚至在生产中获得了第一批服务。恭喜你！</p><p id="09d1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">您知道生产工作负载的正常运行时间至关重要，因此您设置了尽可能可靠的生产集群。您添加了各种监控和警报功能，这样，如果您的SREs出现问题，就会得到通知，并以最高优先级修复它。</p><p id="4f9f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">但是这是昂贵的，并且你也想要有暂存和开发集群——甚至可能一些操场。由于预算总是紧张，您开始考虑…</p><p id="db2a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><code class="fe kx ky kz la b">DEV</code>是怎么回事？肯定不可能有<code class="fe kx ky kz la b">PROD</code>那么重要吧？不对！</p><p id="0b6a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">所有这些漂亮的新技术和过程的主要目标是开发人员的生产力。我们希望增强开发者的能力，让他们能够更快地发布更好的软件。</p><p id="d9d7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">但是如果你不太重视你的<code class="fe kx ky kz la b">DEV</code>集群的可靠性，你基本上是在说“阻止我的开发人员是可以的”，这间接地转化为“付给开发人员(内部和外部)很多钱，让他们无所事事半天而不能高效工作是可以的”。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="0e5c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">此外，没有一个开发者喜欢听到他们没有你的客户重要。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h1 id="2f00" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">什么会出错？</h1><p id="dfdd" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">让我们来看看当不重视开发时，您可能会遇到的一些问题，以及它们可能产生的影响。</p><p id="a936" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这些不是我想出来的。在过去两年多的时间里，我们见证了所有这些事情的发生。</p><h1 id="d4d2" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">场景1:开发集群的K8s API关闭</h1><p id="50da" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">您精心构建的CI/CD管道现在正在产生大量错误。几乎所有的开发人员现在都被封锁了，因为他们不能部署和测试他们正在构建的任何东西。</p><p id="13d5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这实际上在<code class="fe kx ky kz la b">DEV</code>比在<code class="fe kx ky kz la b">PROD</code>的生产集群中影响更大，因为你最重要的资产是你的工作负载，当Kubernetes API关闭时，它们应该还在运行。也就是说，如果您没有在API上构建任何强依赖性。您可能无法部署新版本，但是您的工作负载很好。</p><h1 id="27d6" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">场景2:集群已满/资源压力</h1><p id="0760" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">一些开发者现在被禁止部署他们的应用。如果他们尝试(或者管道只是推出新版本)，他们可能会增加资源压力。</p><p id="ed4e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">豆荚开始被杀死。现在，您的优先级和QoS类开始生效——您确实记得设置它们，对吗？还是说这在<code class="fe kx ky kz la b">DEV</code>中并不重要？希望您至少保护了您的Kubernetes组件和关键附加组件。否则，您将看到节点停止运行，这又会增加资源压力。以为<code class="fe kx ky kz la b">DEV</code>集群可以用更少的缓冲？再想想。</p><p id="193f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">不幸的是，这种情况在<code class="fe kx ky kz la b">DEV</code>发生得更多，原因有二:</p><ol class=""><li id="5e27" class="mk ml iq kb b kc kd kg kh kk mm ko mn ks mo kw mp mq mr ms bi translated">重型CI正在运行<code class="fe kx ky kz la b">DEV</code></li><li id="b962" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw mp mq mr ms bi translated">不太强调资源、优先级和QoS类别的清晰定义。</li></ol><h1 id="ebcb" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">场景3:关键附加组件失败</h1><p id="b027" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">在大多数集群中，CNI和DNS对您的工作负载至关重要。如果您使用入口控制器来访问它们，那么这也很重要。你真的很前卫，已经在运营一个服务网络了？恭喜你，你添加了另一个关键组件(或者说是一大堆组件——看着你Istio)。</p><p id="ba1e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在，如果上述任何一项开始出现问题(并且它们确实在一定程度上相互依赖)，您将开始看到工作负载左右分散，或者，对于入口控制器，它们在群集外部不再可达。这在影响尺度上听起来可能很小，但只要看看我们过去的事后分析，我必须说入口控制器(我们运行社区NGINX变体)拥有最大的份额。</p><h1 id="c6ec" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">发生了什么事？</h1><p id="f759" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">许多可以想象和不可想象的事情都可能发生，并导致上述情景之一。</p><p id="e42e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们经常看到由于工作负载的错误配置而产生的问题。也许你已经看到了下面的一个(列表不是决定性的)。</p><ul class=""><li id="752e" class="mk ml iq kb b kc kd kg kh kk mm ko mn ks mo kw my mq mr ms bi translated">CI正在疯狂运行，让您的集群充满了没有任何限制的pod</li><li id="5ca5" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">CI为您的API“添加剂量”</li><li id="d27c" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">错误的TLS证书搞乱了你的入口控制器</li><li id="7040" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">Java容器接管整个节点并杀死它们</li><li id="3dc8" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi">…</li></ul><p id="9ab1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">和很多团队共享<code class="fe kx ky kz la b">DEV</code>？给了每个团队<code class="fe kx ky kz la b">cluster-admin</code>的权利？你会很开心的。我们已经看到了很多事情，从对入口控制器模板文件的“小”编辑，到有人意外删除整个集群。</p><h1 id="4991" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="6c04" class="pw-post-body-paragraph jz ka iq kb b kc mf ke kf kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw ij bi translated">如果上面没有说清楚:<code class="fe kx ky kz la b">DEV</code>集群很重要！</p><p id="345d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请考虑一下:如果您使用集群来高效地工作，那么就可靠性而言，它应该被认为与<code class="fe kx ky kz la b">PROD</code>同样重要。</p><p id="f97d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">集群通常需要始终可靠。让他们只在工作时间可靠是很棘手的。首先，你可能有分散的团队和外部人员在非正常时间工作。其次，在非工作时间发生的问题可能会变得更大，一旦工作时间开始，需要更长时间才能解决。后者是我们始终提供24/7支持的原因之一，即使我们只能以更低的价格提供工作时间支持。</p><p id="12a8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">你应该考虑的一些事情(不仅仅是针对<code class="fe kx ky kz la b">DEV</code>):</p><ul class=""><li id="7e90" class="mk ml iq kb b kc kd kg kh kk mm ko mn ks mo kw my mq mr ms bi translated">确定集群规模时，请注意资源压力问题。包括缓冲剂。</li><li id="24e8" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">使用名称空间分隔团队(使用访问控制！)或者甚至不同的簇，以减小误用的爆炸半径。</li><li id="d681" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">使用正确的请求和限制配置您的工作负载(尤其是CI作业！).</li><li id="b6e2" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">强化您的Kubernetes和附加组件以应对资源压力。</li><li id="dafe" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">限制对关键组件的访问，不要给出<code class="fe kx ky kz la b">cluster-admin</code>凭证。</li><li id="886a" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">让你的特工待命。这意味着人们将在<code class="fe kx ky kz la b">DEV</code>被呼叫。</li><li id="988c" class="mk ml iq kb b kc mt kg mu kk mv ko mw ks mx kw my mq mr ms bi translated">如果可能的话，让您的开发人员能够轻松地重建<code class="fe kx ky kz la b">DEV</code>或<a class="ae jy" href="https://blog.giantswarm.io/how-giant-swarm-enables-a-new-workflow/" rel="noopener ugc nofollow" target="_blank">自己开发集群</a>。</li></ul><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="f149" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如果你真的需要省钱，你可以尝试在下班时间缩减开支。如果你真的擅长启动或重建<code class="fe kx ky kz la b">DEV</code>，即从集群创建到应用部署都实现自动化，那么你可以尝试“丢弃集群”，即在一天结束时丢弃的集群，并在工作时间前不久开始新的集群。</p><p id="f5ee" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">无论你决定什么，请，请，请，不要阻止你的开发者，他们会更高兴，你会得到更好的软件，相信我。</p><p id="906a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">由<a class="ae jy" href="https://twitter.com/puja108" rel="noopener ugc nofollow" target="_blank"> Puja Abbassi </a>撰写——开发者倡导者@ <a class="ae jy" href="https://giantswarm.io/" rel="noopener ugc nofollow" target="_blank">巨型蜂群</a></p><div class="mz na gp gr nb nc"><a href="https://twitter.com/puja108" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">Puja Abbassi (@puja108) |推特</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">Puja Abbassi的最新推文(@puja108)。开发者倡导者@ GiantSwarm &amp; Researcher主题:码头工人…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">twitter.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq js nc"/></div></div></a></div></div></div>    
</body>
</html>