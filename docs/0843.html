<html>
<head>
<title>OutSystems Deployment Rollbacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">外部系统部署回滚</h1>
<blockquote>原文：<a href="https://itnext.io/outsystems-deployment-rollbacks-8b3c010f5f90?source=collection_archive---------3-----------------------#2018-06-07">https://itnext.io/outsystems-deployment-rollbacks-8b3c010f5f90?source=collection_archive---------3-----------------------#2018-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3ee4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事情发生了，有时我们需要回滚已部署的代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6ed59d2c2040e74d3bbbba13e2de9160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OlZ0ru2QYO_2MDr3k-msQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">嘘！让这张图实际上很好看的Photoshop滤镜呢？谁说iPhones有好的摄像头，一定没有我的！</figcaption></figure><p id="90b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提前计划是成功回滚部署的关键，如果您需要这样做的话。一些初步提示:</p><ul class=""><li id="efbd" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">练习！在开发或QA、测试等中尝试它。环境。实践每一种技术，以准确理解去哪里以及如何去做。</li><li id="cbc0" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">制作一个完整环境的解决方案，并在进行部署之前使用它的“创建版本”(然后下载该包),可以在情况变得非常糟糕时为您提供可靠的回滚故障保护。</li><li id="a686" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">使用生命周期进行部署让生活变得更加美好。</li><li id="3b6a" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">了解部署和回滚如何影响外部系统数据模型。</li><li id="7935" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">提前计划失败:我的意思是，要了解什么情况会导致回滚，以及在什么情况下需要什么类型的回滚。例如，在备份和恢复数据库之间的这段时间内，您愿意在什么时候进行完整的数据库回滚，并丢失输入到系统中的任何数据？</li><li id="f244" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">就您所执行的谨慎和准备程度而言，回滚应该像部署一样处理。</li><li id="2aec" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">至少，在执行回滚时让应用程序脱机。</li><li id="30d4" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">执行数据库回滚时，请务必对数据库进行完整备份！按照您喜欢的方式进行数据库备份。</li><li id="f4e7" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">你不<em class="lp">不</em>需要拍摄你的虚拟机的快照，备份你的应用服务器，等等。一般来说，恢复应用服务器不是很有用；任何部署(在所有回滚场景中都会发生)都会将正确的代码推送到服务器。</li></ul><h1 id="a13f" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">回滚触发器</h1><p id="77c1" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">回滚部署并不是因为一个小错误就想做的事情。回滚应该保存到以下情况:</p><ul class=""><li id="4d7c" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">这个应用程序(或者它的大部分)是不起作用的，你不能通过快速修复让它上线。</li><li id="a9c9" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">数据正在损坏，修复将需要一些时间(否则，方法应该是离线并部署修复程序，然后再恢复在线)。</li></ul><p id="308a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终客户应该高度参与回滚决策。它们也应该是初始规划的一部分，在初始规划中，您可以决定在什么情况下使用哪个回滚计划。您绝不会希望您的客户对回滚的结果感到惊讶！这也是你应该提前练习的原因。</p><p id="5687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑到需要执行回滚的情况，快速决策是必须的。同样，提前计划和记录何时需要回滚以及执行哪种回滚是快速做出决策的关键。记住，坏代码运行的时间越长，客户发现问题的时间就越长(或者更糟，导致数据问题)。</p><h1 id="6f7b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">最佳选择:终生</h1><p id="a029" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果您使用Lifetime(您应该这样做！)，<a class="ae mt" href="https://www.outsystems.com/forums/discussion/15466/preparing-for-an-application-version-rollback-scenario-in-production/" rel="noopener ugc nofollow" target="_blank">使用它来执行回滚</a>绝对是最简单、最好的方法。</p><h1 id="a8ea" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">更好的选择:解决方案</h1><p id="d65c" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果您在部署之前制定了环境的解决方案，并使用了“创建版本”，则可以使用它来回滚(只需从服务中心发布以前的版本)。在事情变得非常糟糕的罕见情况下(例如，您可能希望在没有数据来隔离问题的新环境中发布代码)，拥有该解决方案版本的下载副本会很有用，所以不要忘记获得它的副本。</p><h1 id="d7ba" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">OK选择:单个模块回滚</h1><p id="4b9c" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">如果您的解决方案回滚由于任何原因无法工作，您可以转到每个模块并重新发布以前的版本。要做到这一点，您需要在依赖关系树中从“底部”到“顶部”进行工作。只有当解决方案回滚失败，或者问题只出现在一个或两个几乎没有依赖关系的模块中时，才应该考虑这一点。</p><h1 id="3a57" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">最后一招:数据库恢复</h1><p id="c25f" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">这是“从轨道上起飞并摧毁它们”的选择。保证有效，但是很痛苦。还记得在部署代码之前进行的完整数据库备份吗？将其恢复到您的环境中，然后转到服务中心并重新发布所有模块。当然，您将丢失自上次备份以来的所有数据。这里的最佳方法是:</p><ol class=""><li id="2c0d" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk mu lh li lj bi translated">让应用程序离线，在外部系统(停止计时器)以及防火墙上。</li><li id="b868" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">对数据库进行备份。</li><li id="e923" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">从部署前备份中还原数据库。</li><li id="50a1" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">重新发布所有模块。</li><li id="2d02" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">将应用程序联机(仅在外部系统中)，进行检查和冒烟测试。</li><li id="3867" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">让应用程序在防火墙处联机。</li><li id="887a" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk mu lh li lj bi translated">构建一个并行环境来生产。还原回滚前的数据库。如果可能，使用此功能将在部署和回滚之间创建/修改的数据迁移回生产环境。您还可以使用这个并行环境进行调试和故障排除。</li></ol><h1 id="dd8e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">回滚和前滚的副作用</h1><ul class=""><li id="d3d6" class="lb lc iq jp b jq mo ju mp jy mv kc mw kg mx kk lg lh li lj bi translated">回滚发生后，部署版本中添加的模式(表和列)仍然存在。如果您在DEV中的修复从部署到PROD的版本开始，当您部署它们时，回滚的部署中添加的表/列将仍然存在，回滚前输入的数据也将仍然存在。</li><li id="edb6" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">如果数据损坏发生在回滚之前，您将需要一个计划来修复该数据。</li></ul><p id="ebf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何修复和前滚:</p><ul class=""><li id="b3b0" class="lb lc iq jp b jq jr ju jv jy ld kc le kg lf kk lg lh li lj bi translated">从部署到PROD的版本开始。</li><li id="5ef4" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">在并行环境中使用数据库备份，找出如何修复任何数据损坏问题。您可以创建一个完全并行的生产环境，或者将您的QA/测试应用程序服务器指向生产数据库的恢复。</li><li id="3cd4" class="lb lc iq jp b jq lk ju ll jy lm kc ln kg lo kk lg lh li lj bi translated">当部署正确的代码时，像对待任何其他部署一样对待它。</li></ul><p id="a13c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">J.是</p></div></div>    
</body>
</html>