<html>
<head>
<title>Stay safe with your units! Advanced units of measure in .NET.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">和你的部队保持安全！. NET中的高级度量单位。</h1>
<blockquote>原文：<a href="https://itnext.io/stay-safe-with-your-units-advanced-units-of-measure-in-net-f7d8b02af87e?source=collection_archive---------1-----------------------#2021-12-22">https://itnext.io/stay-safe-with-your-units-advanced-units-of-measure-in-net-f7d8b02af87e?source=collection_archive---------1-----------------------#2021-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4b6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇小文章展示了高级度量单位的概念，完全类型安全，自动单位转换，没有运行时调度，由泛型数学驱动！(给不耐烦的人:<a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure" rel="noopener ugc nofollow" target="_blank"> github </a>)</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/c07b4cda98b9e235bba73400cdd779de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZ1lFDyOld1etNTvm5Wxuw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">工作示例</figcaption></figure><p id="60e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可能是最受欢迎的图书馆之一。NET是<a class="ae kl" href="https://github.com/angularsen/UnitsNet" rel="noopener ugc nofollow" target="_blank"> UnitsNet </a>。它为很多很多情况提供了很多API，可能很棒(我自己还没试过)。还有<a class="ae kl" href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/units-of-measure" rel="noopener ugc nofollow" target="_blank"> F#的测量单位</a>。它不提供额外的API或类型转换，但是它提供了编译时安全性(对于F#消费者)并且没有开销。</p><p id="36fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，为什么不尝试开发我们自己的可互操作的(同样适用于F#和C#开发人员)度量单位系统呢？这样任何人都可以添加他们自己的单位！一个没有太多运行时间开销的。同时完全编译时安全！也可以使用任意类型(而不是双精度/浮点)。最后是类型转换。</p><h1 id="9433" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创造现实</h1><p id="4abe" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">这里的想法是，我们并不真正关心“尺寸”，不管是长度、质量还是其他什么。我们只是忘记了那些存在。然而，我们要记住的是每个单位都有自己的基本单位。</p><p id="47fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">什么是基本单位？理论上它可以是任何单位。为了简单起见，我将SI的单位作为基础。例如，千米的基本单位是米(1千米等于1000米)。英里的基本单位也是米(大约1600米)。最后，米的基本单位是它自己(1米中有1米)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mf"><img src="../Images/9c3333e2f83419908922ad10f3e700b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSqw6GY4hvq1zwZT6xx7Qw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">我们的基本单元接口</figcaption></figure><p id="3b4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本属性提供您的单位中的基本单位的数量。例如，下面是基本类型为秒的分钟的样子:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mg"><img src="../Images/7c03e7b9e4d67d9d8eb8a73f635ce12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qyc-2in5sq1LscT92o2EA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">分钟实现IBaseUnit接口</figcaption></figure><p id="38ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TNumber在那里是因为我们在做一般的数学运算，所以它可以是任何实体(对应于一些约束)。Number60有点难看，但是你不能从一个泛型类型中得到60。</p><p id="f033" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么，算术运算呢？例如，对于<a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure/blob/296c8e3846de47dd5b695df120ca76da9e73942f/Sources/UnitsOfMeasure/PredefinedUnits.Arithmetics.cs#L14" rel="noopener ugc nofollow" target="_blank">部门</a>，我们也创建一个单元。记得我说过每个单位都有它的基本单位吗？组织也是。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/d82ca04603374cfe6e2e1df80814f4c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3U8U7-bLGoGmG0rqWDGE9g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Div单元的实现</figcaption></figure><p id="209b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它看起来有点冗长，因为有一大堆泛型类型约束。但这里的关键是它也有基本单位。它是分子和分母基数的除法。例如，km/min将有一个基本单位m/s。这意味着我们可以很容易地转换我们的类型，我们所需要的就是检查它们是否有相同的基本类型。让我们来看看我们可以进行的转换:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mi"><img src="../Images/996224cd062c5dd87e065272387b8f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4pBxG42-PpIiJ4mjAG1NA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">实施单位转换</figcaption></figure><p id="24c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为都是通用约束，所以不可能转换不兼容的单元，但是转换兼容的单元非常容易:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mj"><img src="../Images/3fc645f227990b6b3a63adfff155edc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AN0TWscSfm8rNvtFyoiXng.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">将米转换为秒会产生编译错误</figcaption></figure><p id="f524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，我们实现编译时安全的<a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure/blob/296c8e3846de47dd5b695df120ca76da9e73942f/Sources/UnitsOfMeasure/Operations.cs#L19" rel="noopener ugc nofollow" target="_blank"> Add </a>。注意，我们没有泛型操作符，所以在我们的例子中不可能实现+。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mk"><img src="../Images/76407d7b61ca085a1a3cf331dd0ab9e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K97bT5zXuDCZu_M2Ex-OWw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Add方法的实现</figcaption></figure><p id="92a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它看起来有点大。但这里的关键是，我们有不同的单位，但相同的基本单位。例如，您可以添加秒和分钟(20秒+1分钟= 80秒)。可以加上公里和英里(1公里+ 1英里= 2.6公里)。但是不能添加秒和米。因此添加的单元必须共享同一个基本单元。</p><p id="4907" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，让我演示几个结果。</p><h1 id="65a4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">作品展示</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ml"><img src="../Images/ce62d0499e4a57eca0a8e4a57607be2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KM8IkdUZHgYCEi3mq9vUMA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">工作演示</figcaption></figure><p id="8742" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">F#有泛型运算符。我无法以我想要的方式获得它们，但为了验证概念，我们还有一些东西:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mm"><img src="../Images/58a8eefe0e6181a80b6cd0b2dcd65515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHccBUHl5GcG1jraAiZONQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">F#在我的计量单位上的视点</figcaption></figure><p id="1adc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住，这是<a class="ae kl" href="https://devblogs.microsoft.com/dotnet/preview-features-in-net-6-generic-math/" rel="noopener ugc nofollow" target="_blank">通用数学</a>。这意味着我们实际上可以做任何实现一些接口的类型。例如，我们可以尝试使用<a class="ae kl" href="https://www.nuget.org/packages/AngouriMath.Experimental" rel="noopener ugc nofollow" target="_blank">安哥拉数学。实验包</a>，它是<a class="ae kl" href="https://github.com/asc-community/AngouriMath" rel="noopener ugc nofollow" target="_blank"> AngouriMath </a>的一个版本，实现了通用的数学接口。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mn"><img src="../Images/502a42b3477dd3699e1bcdf8a6948456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zcAMx7yJbJO9e8ENWLoSA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">用作单位值的符号代数示例</figcaption></figure><h1 id="e240" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">效率</h1><p id="3f9a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">效率呢？这还不算太坏，因为你不需要在运行时调度任何东西。因此，如果单位相同，这只是一个浮点加法，但如果单位不相同，就要多做几次运算。<a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure#efficiency" rel="noopener ugc nofollow" target="_blank">更多信息</a>。</p><h1 id="7ca1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="b5ea" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">最后，它可能比你已经在使用的单位(如果有的话)更好或更差。参见比较表(🥇意味着最好，🥉意味着最坏的情况，🥈是中间的某个位置):</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mo"><img src="../Images/72d182e015f64281035af5899aa4dada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ueawjflUCYiUkULGmmD-Dg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">比较不同的度量单位</figcaption></figure><p id="223c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">*分机。就是可扩展性(能够扩展内置的东西)。单位的可扩展性意味着你可以添加更多的单位。尺寸的可扩展性意味着您可以添加“尺寸”(例如长度、质量等。).</p><p id="008d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于表格可能会更改，请参见此处的相关值<a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure/blob/main/README.md#other-solutions" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3572" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/WhiteBlackGoose/UnitsOfMeasure" rel="noopener ugc nofollow" target="_blank">概念回购的Github </a>。我的<a class="ae kl" href="https://github.com/WhiteBlackGoose" rel="noopener ugc nofollow" target="_blank"> github </a>，<a class="ae kl" href="https://twitter.com/WhiteBlackGoose" rel="noopener ugc nofollow" target="_blank"> twitter </a>。</p><p id="6504" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的关注！</p></div></div>    
</body>
</html>