<html>
<head>
<title>How to use your C++ muscle using TensorFlow 2.0 and XCode (without using Bazel builds)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用TensorFlow 2.0和XCode使用您的C++ muscle(不使用Bazel构建)</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-your-c-muscle-using-tensorflow-2-0-and-xcode-without-using-bazel-builds-9dc82d5e7f80?source=collection_archive---------1-----------------------#2019-04-16">https://itnext.io/how-to-use-your-c-muscle-using-tensorflow-2-0-and-xcode-without-using-bazel-builds-9dc82d5e7f80?source=collection_archive---------1-----------------------#2019-04-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/63879cfe8195b03e52de8c1c7856e622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WGmNiI2E9sBXfL6wBI3gg.png"/></div></div></figure><div class=""/><p id="3369" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章将描述如何在Mac上使用TensorFlow用C++编写代码，同时绕过Bazel builds，我觉得Bazel builds用起来太麻烦了。</p><h1 id="4cb1" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">首先，坦白一点:</h1><p id="e0be" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我在90年代学的是计算机科学。因此，我的编程思想深受C++的影响，c++是我喜欢和偏爱的语言。当每个人都开始用Java编写代码时，我已经进入了管理岗位，所以我没有经历迁移到大多数人所说的第三代语言(指的是在内部建立一个框架)的过程。我喜欢C++的美学，随着它最近的发展(主要是将STD作为语言的一部分)，我认为它也克服了指针相关错误的缺点，这些错误过去常常导致崩溃和内存泄漏。</p><p id="a073" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据T2 Stack Overflow最近的调查，Python是发展最快的主流编程语言。它不在列表的顶端，但是超过40%的开发者在使用它。C++正在被23.5%的人使用。也许我是守旧的。好了，我说了。</p><p id="ca93" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我对机器学习产生兴趣的时候，我不得不学习Python。这是必须的，因为大多数框架不支持任何其他语言，这使得Python成为该领域事实上的语言。Python不错，不要误会。它还包含一些来自C++的概念，其内部也是用C++ (AFAIK)编写的。然而，空白和缩进对我来说很难理解。因此，当我听说TensorFlow 2.0将在c++ API中包含一些重大改进时，我不得不去了解一下。</p><p id="e77d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我用苹果电脑，我猜你们中的一些人也用。这仍然不是主流，但它更容易弥合Windows和Linux之间的差距。</p><h1 id="d6f3" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">没有巴泽尔怎么办</h1><p id="fae3" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><strong class="kd jf">这篇文章将解释如何在Mac上开始使用TensorFlow 2.0 Alpha，使用一个可以使用XCode的独立项目，而不使用终端中的Bazel builds。</strong></p><p id="4e82" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在网上找到的大多数说明都是关于Bazel构建的。我发现Bazel有点麻烦，不太直观，所以我将向您展示如何从Bazel开始构建基本框架，然后如何继续用XCode开发C++代码，而不需要每一步都使用终端。</p><h1 id="6ebf" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">开始吧！</h1><p id="0c6c" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">要实现这一目标，您需要完成以下工作:</p><blockquote class="me"><p id="5137" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.安装一些先决条件</p><p id="3091" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">2.从源代码构建TensorFlow 2.0 Alpha</p><p id="96e2" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">3.构建一些其他依赖项</p><p id="9a05" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">4.创建一个XCode项目并配置它</p><p id="d95b" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">5.编译一个测试项目来验证所有的东西都正确安装了</p></blockquote><p id="0213" class="pw-post-body-paragraph kb kc je kd b ke mo kg kh ki mp kk kl km mq ko kp kq mr ks kt ku ms kw kx ky im bi translated">这里的一些说明摘自<a class="ae md" href="https://www.tensorflow.org/install/source" rel="noopener ugc nofollow" target="_blank"> TensorFlow安装指南页面</a>。</p><p id="0a2f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">开始时的要求:</p><blockquote class="me"><p id="b07a" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.XCode 9.2及以上(我有10.2)</p><p id="a78e" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">2.<a class="ae md" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank">自制</a></p><p id="4309" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">3.Python 2或3(我有3.6.5)</p><p id="2806" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">4.Pip(如果您没有pip，请运行“sudo easy_install pip”)</p></blockquote><h1 id="f161" class="la lb je bd lc ld le lf lg lh li lj lk ll mt ln lo lp mu lr ls lt mv lv lw lx bi translated">先决条件</h1><p id="e991" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">打开终端窗口并开始安装:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="8e14" class="nf lb je nb b gy ng nh l ni nj">pip install -U --user pip six numpy wheel setuptools mock</span><span id="ba2d" class="nf lb je nb b gy nk nh l ni nj">pip install -U --user keras_applications==1.0.6 --no-deps</span><span id="ebde" class="nf lb je nb b gy nk nh l ni nj">pip install -U --user keras_preprocessing==1.0.5 --no-deps</span></pre><h1 id="c25d" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">安装Bazel:</h1><p id="69de" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">遵循这里的说明<a class="ae md" href="https://docs.bazel.build/versions/master/install.html" rel="noopener ugc nofollow" target="_blank"/>，但是如果你使用MAC OS——继续这个:</p><h2 id="31ed" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">安装XCode命令行工具:</h2><blockquote class="me"><p id="fb74" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.前往https://developer.apple.com/download/<a class="ae md" href="https://developer.apple.com/download/" rel="noopener ugc nofollow" target="_blank"/>，向下滚动并点击查看更多下载。</p><p id="c56b" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">2.在左边的小搜索框中，写下“命令行”,然后按回车键。</p><p id="da5e" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">3.选择适当的XCode版本，然后点按+号。</p><p id="decb" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">4.单击链接下载并安装dmg文件。</p></blockquote><h2 id="84f5" class="nf lb je bd lc nl nw dn lg nn nx dp lk km ny nq lo kq nz ns ls ku oa nu lw nv bi translated">接受许可协议</h2><p id="a1ee" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">这是一个棘手的部分。说明说你只需要运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="344c" class="nf lb je nb b gy ng nh l ni nj">sudo xcodebuild -license accept</span></pre><p id="e901" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是这对我不起作用。环顾四周，这是最安全的顺序，可以帮助你通过这一部分:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="497f" class="nf lb je nb b gy ng nh l ni nj">sudo xcode-select -s /Applications/Xcode.app/Contents/Developer</span><span id="b0ae" class="nf lb je nb b gy nk nh l ni nj">sudo xcodebuild -license</span></pre><p id="3b70" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在输入您的本地密码，应该会显示许可协议。</p><p id="44c8" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用空格键向下滚动(如果你喜欢，可以读出来)，最后输入“同意”并按回车键。</p><h2 id="1205" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">安装bazel</h2><blockquote class="me"><p id="fc47" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.转到这个<a class="ae md" href="https://github.com/bazelbuild/bazel/releases" rel="noopener ugc nofollow" target="_blank"> URL </a>并搜索您拥有的相关操作系统。对于MacOS，这应该是bazel-0.24.1-installer-Darwin-x86 _ 64 . sh(或者是一个更新的版本，这意味着0 . 24 . 1会有所不同)</p><p id="fd17" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">2.将此文件下载到您的个人目录并打开终端</p><p id="cbb6" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">3.运行以下两个命令(假设您是主目录，并且sh文件在那里):</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="9a4c" class="nf lb je nb b gy ng nh l ni nj">chmod +x bazel-0.24.1-installer-darwin-x86_64.sh</span><span id="63ec" class="nf lb je nb b gy nk nh l ni nj">./bazel-0.24.1-installer-darwin-x86_64.sh — user</span></pre><blockquote class="me"><p id="20db" class="mf mg je bd mh mi og oh oi oj ok ky dk translated">(同样，如果您有不同的版本，请更改命令)</p><p id="4267" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">4.检查bazel是否正常工作:</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="1f6a" class="nf lb je nb b gy ng nh l ni nj">bazel version</span></pre><blockquote class="me"><p id="b93d" class="mf mg je bd mh mi og oh oi oj ok ky dk translated">如果不是，请检查您的路径，它可能缺少$(HOME)/bin</p></blockquote><h1 id="3e69" class="la lb je bd lc ld le lf lg lh li lj lk ll mt ln lo lp mu lr ls lt mv lv lw lx bi translated">再安装几个包:</h1><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="6b1c" class="nf lb je nb b gy ng nh l ni nj">Brew install autoconf automake libtool cmake</span></pre><h1 id="d4f5" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">下载并安装TensorFlow</h1><p id="3f35" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先创建一个保存所有代码的文件夹。我将向你展示如何将你的项目从框架中分离出来，所以选择一个不会让你困惑的结构。</p><p id="a061" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我家下面有一个主文件夹，我把它命名为“Code ”,在它下面有我的项目。我在它下面新建了一个文件夹，名为Tensorflow2。这是框架代码。</p><h2 id="e4a2" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">下载框架代码</h2><blockquote class="me"><p id="0116" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.打开终端和cd到目录</p><p id="e28c" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">2.下载源文件:</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="d32b" class="nf lb je nb b gy ng nh l ni nj">git clone <a class="ae md" href="https://github.com/tensorflow/tensorflow.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/tensorflow.git</a></span><span id="07ad" class="nf lb je nb b gy nk nh l ni nj">cd tensorflow</span></pre><blockquote class="me"><p id="9207" class="mf mg je bd mh mi og oh oi oj ok ky dk translated">3.这会让你从主人那里得到代码。如果您想要一个发布分支(目前还不是一个发布)，您可以查看它。示例:</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="e433" class="nf lb je nb b gy ng nh l ni nj">git checkout v2.0.0-alpha0</span></pre><h2 id="a707" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">安装ˌ使成形</h2><blockquote class="me"><p id="cd24" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">1.在“终端”中的相同位置(在tensorflow目录下，这是您的根文件夹)，运行</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="d0a2" class="nf lb je nb b gy ng nh l ni nj">./configure</span></pre><blockquote class="me"><p id="251a" class="mf mg je bd mh mi og oh oi oj ok ky dk translated">2.现在到了脚本向您提问的部分，您需要回答</p><p id="75b2" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">3.它会告诉你是否找到了bazel以及版本，并询问python的位置。</p><p id="f398" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">4.找到它的最简单的方法是打开一个新的终端窗口并键入</p></blockquote><pre class="ob oc od oe of na nb nc nd aw ne bi"><span id="4068" class="nf lb je nb b gy ng nh l ni nj">which python3</span></pre><blockquote class="me"><p id="e1fa" class="mf mg je bd mh mi og oh oi oj ok ky dk translated">(用你用来运行python的任何东西替换python3，运行“python 3–version”来查看它是什么版本)</p><p id="6c60" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">5.然后它会问你一堆关于各种特性的特殊支持的其他问题。我为除了一个之外的所有选择了默认。</p><p id="b26a" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">6.那个是关于CPU特性的。它会要求你用bazel提供“编译时使用的优化标志”。这很重要，原因有二:</p><p id="c740" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">a.它会让你的模型跑得更快</p><p id="98a6" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">b.它将消除每次运行代码时显示的一些警告。</p><p id="640e" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">7.我是在能够运行我的项目之后才发现这一点的，所以我不得不返回并再次运行configure，并在提示输入这些标志时键入“-mavx -mavx2 -mfma -msse4.2”。不确定你如何能在前面找到，试着看这里的或这里的的<a class="ae md" href="https://github.com/lakshayg/tensorflow-build" rel="noopener ugc nofollow" target="_blank">。因此，我建议首先将它保留为默认设置，如果您收到运行时警告，请返回并再次进行配置，然后再次编译框架。</a></p><p id="ae9f" class="mf mg je bd mh mi mj mk ml mm mn ky dk translated">8.完成配置过程，如果你有一个GPU阅读<a class="ae md" href="https://www.tensorflow.org/install/source#configuration_options" rel="noopener ugc nofollow" target="_blank">这个</a>。</p></blockquote><h2 id="edd5" class="nf lb je bd lc nl nw dn lg nn nx dp lk km ny nq lo kq nz ns ls ku oa nu lw nv bi translated">编译框架</h2><p id="686c" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">最后，我们到了可以开始建造东西的时候了。让我们构建稍后将链接到项目中的框架库。</p><p id="2574" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要构建C++ API和框架。</p><p id="c134" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">重要提示:接下来的两个命令需要几个小时才能完成。它会最大化你的CPU使用率，耗尽你的电池。一定要勾搭上，好好休息。</p><p id="fe6b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在根文件夹中运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="58c8" class="nf lb je nb b gy ng nh l ni nj">bazel build -c opt — verbose_failures //tensorflow:libtensorflow_cc.so</span></pre><p id="3679" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来编译框架:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="aca7" class="nf lb je nb b gy ng nh l ni nj">bazel build -c opt — verbose_failures //tensorflow:libtensorflow_framework.so</span></pre><p id="8fe4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果这两个成功而没有错误(有很多警告，这是正常的)，您将在文件夹(根文件夹)/bazel-bin/tensorflow/中找到这两个库。我们将需要这些与我们的项目联系起来。</p><p id="ddc7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您还记得，我们首先配置了CPU特性，这应该会使这个版本针对您的个人情况进行优化。但是，如果您遇到CPU特性错误，比如下面的故障排除部分，请尝试使用与您需要的标志相匹配的命令行bazel选项重新运行框架构建。在我的情况下，我应该运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="58b8" class="nf lb je nb b gy ng nh l ni nj">bazel build -c opt — copt=-mavx — copt=-mavx2 — copt=-mfma — copt=-msse4.2 — verbose_failures //tensorflow:libtensorflow_framework.so</span></pre><h1 id="3f2a" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">获取和构建依赖项</h1><p id="b63e" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在创建项目之前，我们还需要下载一些东西。</p><p id="13eb" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从根文件夹运行:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="4b68" class="nf lb je nb b gy ng nh l ni nj">tensorflow/contrib/makefile/download_dependencies.sh</span></pre><p id="f002" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它会将文件下载到tensor flow/contrib/makefile/downloads/</p><h2 id="37be" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">构建protobufs</h2><p id="6fa2" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">运行以下命令:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d237" class="nf lb je nb b gy ng nh l ni nj">cd tensorflow/contrib/makefile/downloads/protobuf/</span><span id="dcf4" class="nf lb je nb b gy nk nh l ni nj">./autogen.sh</span><span id="6506" class="nf lb je nb b gy nk nh l ni nj">./configure</span><span id="4132" class="nf lb je nb b gy nk nh l ni nj">make</span><span id="5b03" class="nf lb je nb b gy nk nh l ni nj">make install</span></pre><h1 id="551a" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">创建XCode项目</h1><p id="3d7c" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">现在打开XCode并创建一个C++项目。我在我家下面的代码文件夹中创建我的。</p><p id="bb18" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我把我的项目叫做“TF2example”。我将在home下有一个文件夹:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="3e6a" class="nf lb je nb b gy ng nh l ni nj">~/Code/TF2example/TF2example/</span></pre><p id="45b5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">(main.cpp文件将位于该位置)。</p><p id="4972" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在该目录下创建两个子文件夹:include和lib。</p><p id="495e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们希望将头文件复制到include，将库文件复制到lib。</p><p id="e0b3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的文件夹是这样构建的:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d3ea" class="nf lb je nb b gy ng nh l ni nj">~/Code/</span><span id="facc" class="nf lb je nb b gy nk nh l ni nj"> Tensorflow2/tensorflow/</span><span id="9448" class="nf lb je nb b gy nk nh l ni nj"> tensorflow/</span><span id="6c44" class="nf lb je nb b gy nk nh l ni nj"> bazel-bin</span><span id="33eb" class="nf lb je nb b gy nk nh l ni nj">TF2example/TF2example/</span><span id="2d92" class="nf lb je nb b gy nk nh l ni nj"> include/</span><span id="8b95" class="nf lb je nb b gy nk nh l ni nj"> lib/</span></pre><p id="f822" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们复制库文件(您可能需要在cp命令之前执行sudo):</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="d885" class="nf lb je nb b gy ng nh l ni nj">cd ~/Code</span><span id="b2a4" class="nf lb je nb b gy nk nh l ni nj">cp Tensorflow2/tensorflow/bazel-bin/tensorflow/libtensorflow_cc.so TF2example/TF2example/lib/</span><span id="0d4e" class="nf lb je nb b gy nk nh l ni nj">cp Tensorflow2/tensorflow/bazel-bin/tensorflow/libtensorflow_framework.so TF2example/TF2example/lib/</span><span id="bd16" class="nf lb je nb b gy nk nh l ni nj">cp /usr/local/lib/libprotobuf.a TF2example/TF2example/lib/</span></pre><p id="c3a7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在复制标题:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="0bdd" class="nf lb je nb b gy ng nh l ni nj">cp -r Tensorflow2/tensorflow/bazel-genfiles/* TF2example/TF2example/include</span><span id="bde3" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/tensorflow/cc TF2example/TF2example/include/tensorflow</span><span id="6f16" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/tensorflow/core TF2example/TF2example/include/tensorflow</span><span id="26c0" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/third_party TF2example/TF2example/include</span><span id="3ce9" class="nf lb je nb b gy nk nh l ni nj">cp -r /usr/local/include/google TF2example/TF2example/include</span><span id="89c5" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/tensorflow/contrib/makefile/downloads/absl/absl TF2example/TF2example/include</span><span id="ec78" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/bazel-tensorflow/external/eigen_archive/unsupported TF2example/TF2example/include</span><span id="58be" class="nf lb je nb b gy nk nh l ni nj">cp -r Tensorflow2/tensorflow/bazel-tensorflow/external/eigen_archive/Eigen TF2example/TF2example/include</span></pre><h1 id="dedc" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">测试项目代码</h1><p id="d5d8" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，让我们复制tensorflow 2.0附带的示例代码:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="31e3" class="nf lb je nb b gy ng nh l ni nj">cp Tensorflow2/tensorflow/tensorflow/cc/tutorials/example_trainer.cc TF2example/TF2example/</span></pre><p id="23b2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在回到XCode，用我们刚刚复制的example_trainer.cc替换你的main.cpp。</p><h1 id="daa4" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">测试项目配置</h1><p id="6d3f" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在XCode中，在左侧的项目导航器中选择项目名称。主屏幕将显示项目设置。确保您选择的是项目，而不是目标。</p><p id="9457" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">选择“构建设置”选项卡并滚动到“搜索路径”。</p><p id="8899" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在“标题搜索路径”中添加$(PROJECT _ DIR)/tf2 example/include(如果有不同的名称，请更改)。</p><p id="1f98" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您没有看到该项目，您可能处于“基本”视图。改为“全部”。</p><p id="38cc" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在“库搜索路径”中添加$(PROJECT_DIR)/TF2example/lib</p><p id="aeb7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在“链接”下搜索“运行路径搜索路径”并添加$(PROJECT_DIR)/TF2example/lib</p><p id="893e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">转到“构建阶段”选项卡(如果需要，根据您的视图切换到目标)并打开“将二进制文件与库链接”部分。两者相加。所以我们之前复制的文件(libtensorflow_cc.so和libtensorflow_framework.so)。</p><p id="7181" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，您需要单击“添加其他…”按钮，并选择lib下的文件。</p><p id="71e2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在尝试构建项目并运行它。</p><p id="7dd1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切正常，您应该在输出窗口中看到一串x和y值，它们是由示例程序创建的多线程写入的。</p><p id="1b26" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您有编译错误、链接错误或运行时错误，请尝试在下面的故障排除部分或文章评论中寻找帮助，这样我可以看看我是否能有所帮助。</p><h1 id="b1a9" class="la lb je bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">解决纷争</h1><h2 id="18d0" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">苹果十字工具</h2><p id="a7aa" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果您得到一个关于“Apple CROSSTOOL”的错误，这意味着您没有成功接受命令行工具的许可协议。</p><p id="40c2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在根文件夹中运行以下命令:</p><pre class="mw mx my mz gt na nb nc nd aw ne bi"><span id="513f" class="nf lb je nb b gy ng nh l ni nj">bazel clean — expunge</span><span id="9c85" class="nf lb je nb b gy nk nh l ni nj">sudo xcode-select -s /Applications/Xcode.app/Contents/Developer</span><span id="2898" class="nf lb je nb b gy nk nh l ni nj">sudo xcodebuild -license</span><span id="5ee7" class="nf lb je nb b gy nk nh l ni nj">bazel clean –expunge</span></pre><p id="60cf" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">再次运行巴泽尔构建。</p><h2 id="f65d" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">CPU特性</h2><p id="aa0d" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">运行项目时，您会得到类似“TensorFlow库不是</p><p id="97a6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">已编译为使用SSE4.2指令，但这些指令在您的计算机和</p><p id="39e4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以加快中央处理器的运算速度。"</p><p id="659b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这意味着您需要再次运行configure并设置您在消息中看到的正确标志。我加了“-mavx -mavx2 -mfma -msse4.2”。</p><p id="5244" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">文档显示您也可以将它添加到bazel build命令中，但这对我没有用，我必须再次进行配置并重新构建框架。所以归档吧。</p><p id="76b3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还要注意，如果您选择了错误的标志，您可能会得到一个运行时错误，该错误不会表明它与CPU特性有关。安全总比后悔好。</p><h2 id="8174" class="nf lb je bd lc nl nm dn lg nn no dp lk km np nq lo kq nr ns ls ku nt nu lw nv bi translated">动态库加载程序</h2><p id="a8ac" class="pw-post-body-paragraph kb kc je kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果在运行时出现“dyld library not loaded”错误，请检查您是否正确设置了Runpath搜索路径，如果设置了，您可能需要使用install_name_tool命令来使其工作。</p></div></div>    
</body>
</html>