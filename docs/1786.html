<html>
<head>
<title>Keep calm and handle Forms in React.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持冷静，处理React.js中的表单</h1>
<blockquote>原文：<a href="https://itnext.io/keep-calm-and-handle-forms-in-react-js-52c67eea340e?source=collection_archive---------1-----------------------#2019-01-29">https://itnext.io/keep-calm-and-handle-forms-in-react-js-52c67eea340e?source=collection_archive---------1-----------------------#2019-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="9dc6" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">在大多数应用程序中，表单是不可避免的。我说邪恶是因为它通常是一场斗争，让他们按照你想要的方式行事，让他们尽可能地灵活。我们通常求助于使用库，因为面对它，表单通常不是那么有趣。</p></blockquote><p id="cde9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">下面的图片代表了我希望你读完这篇文章后的平静心态，所以我希望你能喜欢它:)</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/df08cb3b5f458ba3e6831582890a2001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CM2C8W0kCk_ZTqLEPgLuBA.jpeg"/></div></div></figure><p id="728d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">当用户与表单交互时，表单的反应会有所不同，这里没有什么灵丹妙药，但是我见过的变体有:</p><ul class=""><li id="49bd" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated"><strong class="jt ir">即时验证</strong>，一旦你输入，一个元素的内容就会被验证，如果有任何错误，就会被立即指出</li><li id="d397" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">焦点丢失</strong>，当你移动到另一个元素时，一个元素首先被验证，这比第一个版本稍微少一些</li><li id="8500" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">依赖验证</strong>，一个元素的值依赖于一个或多个其他元素的值</li><li id="95e0" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">服务器端验证</strong>，输入元素的有效性无法确定，除非你调用一个端点并得到一个响应</li><li id="95e2" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">禁用提交</strong>，在这种情况下，如果一个或多个元素无效，您不能按提交按钮，因为它已被禁用</li><li id="cfaa" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">隐藏提交</strong>，在这个场景中，提交按钮根本不显示</li><li id="99e3" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">正在提交</strong>，在这种情况下，你必须按下提交按钮才能发现你有验证错误，有点像老虎机:)</li></ul><p id="356d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">上面并不是一个详尽的列表，但是它显示了表单和输入元素可以以完全不同的方式运行。</p><h1 id="be2f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">建筑方法</h1><p id="40ef" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">您可以将所有元素及其验证放在一个巨大的组件中，该组件由表单及其所有输入元素组成，但是通常最好为表单和输入元素创建专用的组件。让我们来讨论一下表单中的输入元素:</p><p id="4d2a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">它应该具有以下属性:</p><ul class=""><li id="ebe8" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated"><strong class="jt ir">呈现元素本身</strong>，这意味着该组件将作为实际HTML输入元素的包装器，这将使我们能够更好地控制元素的呈现方式</li><li id="f19f" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">应该输出验证错误</strong>，是的，你可以在表单的底部收集所有的错误，但是通常更好的方法是在元素旁边用红色边框和错误消息来指示，这样用户就知道他们需要修复什么元素</li><li id="98cb" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">监听变化</strong>，元素应该能够捕捉击键或知道元素何时失去焦点，这样它的内容可以被验证</li><li id="aff0" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">向表单报告</strong>，元素应该能够向表单报告，并说明哪个元素在验证中失败了，以及失败的方式，因此表单可以采取适当的措施，例如禁用或隐藏提交按钮</li></ul><h1 id="a0bf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">使用输入元素</h1><p id="1a23" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">好的，我们说过我们需要创建一个组件来包装HTML元素。这样做很简单:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="43ad" class="na lt iq mw b gy nb nc l nd ne">import React from 'react'; </span><span id="530d" class="na lt iq mw b gy nf nc l nd ne">class Input extends React.Component { <br/>  render() { <br/>    return ( <br/>      &lt;input { ...this.props} /&gt; <br/>    ); <br/>  } <br/>}</span></pre><p id="56e6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">正如你在上面看到的，我们让<code class="fe ng nh ni mw b">Input</code>组件呈现一个<code class="fe ng nh ni mw b">input</code>元素标签。我们还通过键入<code class="fe ng nh ni mw b">{ ...this.props}</code>来确保组件上设置的所有属性都进入底层输入。最后一种更为人工的版本是键入:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="e085" class="na lt iq mw b gy nb nc l nd ne">&lt;input title={this.props.title} value={this.props.value} ... &gt;</span></pre><p id="f9c7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">根据我们想要发送给底层输入的属性数量，可能需要大量的输入。</p><p id="b516" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">因为我们现在控制了<code class="fe ng nh ni mw b">input</code>的渲染方式，我们可以做各种各样的事情，比如添加<code class="fe ng nh ni mw b">div</code>元素，给它填充、边距、边框等等。最棒的是，我们可以在很多地方重用这个组件，我们所有的输入看起来都很好而且一致。</p><h2 id="fbe2" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">添加验证</h2><p id="d227" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">现在我们将看到将我们的<code class="fe ng nh ni mw b">input</code>元素包装在一个组件中是值得的。向我们的元素添加验证非常简单:</p><ul class=""><li id="6e01" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated"><strong class="jt ir">添加一个错误占位符</strong>，这只是在我们的组件中添加一个应该显示错误的地方</li><li id="71c9" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated">添加验证输入值的函数</li><li id="48d3" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated">验证每一个值的变化，我们需要添加一个回调到<code class="fe ng nh ni mw b">onChange</code></li></ul><h2 id="6123" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">渲染错误</h2><p id="ff5a" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">将<code class="fe ng nh ni mw b">render()</code>方法更改如下:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="476b" class="na lt iq mw b gy nb nc l nd ne">render() { <br/>  const { error, data } = this.state;<br/>  const { desc } = this.props;</span><span id="d9e5" class="na lt iq mw b gy nf nc l nd ne">  return ( <br/>  &lt;InputContainer&gt; <br/>    {error &amp;&amp; <br/>    &lt;ErrorMessage&gt;{error}&lt;/ErrorMessage&gt; <br/>    } <br/>    &lt;div&gt; <br/>    {desc} <br/>    &lt;/div&gt; <br/>    &lt;InnerInput <br/>      value={data} <br/>      onChange={this.handleChange} {...this.props} <br/>    /&gt; <br/>  &lt;/InputContainer&gt; <br/>  ); <br/>}</span></pre><p id="85a1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这里，我们有条件地显示错误消息，假设它处于以下状态:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="903b" class="na lt iq mw b gy nb nc l nd ne">{error &amp;&amp; <br/>  &lt;ErrorMessage&gt;{error}&lt;/ErrorMessage&gt; <br/>}</span></pre><p id="3d7b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们还将一个<code class="fe ng nh ni mw b">handleChange()</code>方法连接到<code class="fe ng nh ni mw b">onChange</code>。</p><h2 id="ecca" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">添加验证功能</h2><p id="1d8d" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">下一步是添加我们的验证功能:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="dbd4" class="na lt iq mw b gy nb nc l nd ne">const validate = (val, errMessage, pattern) =&gt; { <br/>  const valid = new RegExp(pattern).test(val); <br/>  return valid ? '' : errMessage; <br/>};</span></pre><p id="ae77" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">上面的函数只是测试我们的输入值是否匹配一个正则表达式模式，如果匹配，那么它是有效的，如果不匹配，那么我们返回错误消息。</p><h2 id="380e" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">管理国家</h2><p id="ae1e" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">那么是谁在调用这个函数呢？嗯，<code class="fe ng nh ni mw b">handleChange()</code>方法是这样的:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="d5f8" class="na lt iq mw b gy nb nc l nd ne">handleChange = (ev) =&gt; { <br/>  const { errMessage } = this.props; <br/>  const error = validate(ev.target.value, errMessage);</span><span id="6cc7" class="na lt iq mw b gy nf nc l nd ne">  this.setState({ data: ev.target.value, error, }); <br/>}</span></pre><p id="3935" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们在这里做两件事，首先我们调用<code class="fe ng nh ni mw b">validate()</code>来查看是否有错误，其次我们设置状态，这是我们的值和错误。如果错误为空字符串，则计为<code class="fe ng nh ni mw b">falsy</code>。因此，我们总是可以安全地设置错误属性，任何错误消息只有在应该可见的时候才是可见的。</p><p id="5a3f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">到目前为止，我们组件的完整代码如下所示:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="bfa2" class="na lt iq mw b gy nb nc l nd ne">// Input.js</span><span id="8909" class="na lt iq mw b gy nf nc l nd ne">import React from 'react'; <br/>import styled from 'styled-components'; <br/>import PropTypes from 'prop-types'; </span><span id="4fec" class="na lt iq mw b gy nf nc l nd ne">const InnerInput = styled.input`<br/>  font-size: 20px; <br/>`; </span><span id="2322" class="na lt iq mw b gy nf nc l nd ne">const InputContainer = styled.div` <br/>  padding: 20px; <br/>  border: solid 1px grey; <br/>`; </span><span id="7186" class="na lt iq mw b gy nf nc l nd ne">const ErrorMessage = styled.div` <br/>  padding: 20px; <br/>  border: red; <br/>  background: pink; <br/>  color: white; <br/>`; </span><span id="f271" class="na lt iq mw b gy nf nc l nd ne">const validate = (val, errMessage, pattern) =&gt; { <br/>  const valid = new RegExp(pattern).test(val); <br/>  return valid ? '' : errMessage; <br/>}; </span><span id="d27c" class="na lt iq mw b gy nf nc l nd ne">class Input extends React.Component { <br/>  static propTypes = { <br/>    name: PropTypes.string, <br/>    desc: PropTypes.string, <br/>    errMessage: PropTypes.string, <br/>    pattern: PropTypes.string,<br/>  }; </span><span id="cd6c" class="na lt iq mw b gy nf nc l nd ne">  state = { <br/>    error: '', <br/>    data: '', <br/>  } </span><span id="bbfa" class="na lt iq mw b gy nf nc l nd ne">  handleChange = (ev) =&gt; { <br/>    const { <br/>      errMessage, <br/>      name, <br/>      pattern <br/>    } = this.props; </span><span id="46f2" class="na lt iq mw b gy nf nc l nd ne">   const error = validate(ev.target.value, errMessage, pattern);<br/> <br/>   this.setState({ data: ev.target.value, error, }); <br/>  } </span><span id="5ba9" class="na lt iq mw b gy nf nc l nd ne">  render() { <br/>    const { error, data } = this.state;<br/>    const { desc } = this.props;</span><span id="6c93" class="na lt iq mw b gy nf nc l nd ne"><br/>    return ( <br/>    &lt;InputContainer&gt; <br/>      {error &amp;&amp; <br/>      &lt;ErrorMessage&gt;{error}&lt;/ErrorMessage&gt; <br/>      } <br/>      &lt;div&gt; {desc} &lt;/div&gt; <br/>      &lt;InnerInput <br/>        value={data} <br/>        onChange={this.handleChange} {...this.props} <br/>      /&gt; <br/>    &lt;/InputContainer&gt; ); <br/>  } <br/>} </span><span id="b809" class="na lt iq mw b gy nf nc l nd ne">export default Input;</span></pre><h1 id="a1af" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">与表单交流</h1><p id="091d" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">通常，当您将输入元素放入表单时，您希望能够告诉表单存在一个或多个无效输入，并且您希望阻止表单被提交。为此，我们需要在每次值改变时向表单发送一条消息，如果有验证错误，表单会知道。为此，我们需要做到以下几点:</p><ul class=""><li id="34cf" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated">添加一个<code class="fe ng nh ni mw b">notify</code>输入属性，这将是一个函数，一旦我们验证了最新的更改，我们就可以调用它</li><li id="e729" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated">调用<code class="fe ng nh ni mw b">notify</code>函数</li></ul><p id="fd54" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">因此，我们更新了我们的<code class="fe ng nh ni mw b">handleChange()</code>方法，现在调用我们传入的<code class="fe ng nh ni mw b">notify()</code>函数，就像这样:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="3eac" class="na lt iq mw b gy nb nc l nd ne">handleChange = (ev) =&gt; { <br/>  const { errMessage, name, notify, pattern } = this.props; <br/>  const error = validate(ev.target.value, errMessage, pattern); <br/>  <br/>  notify(name, error === ''); <br/>  this.setState({ data: ev.target.value, error, }); <br/>}</span></pre><p id="c63e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe ng nh ni mw b">notify()</code>用两个参数调用，<code class="fe ng nh ni mw b">name</code>和是否有效。</p><h2 id="d3b9" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">设置表单</h2><p id="14b7" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">好极了，我们有一种方法将错误反馈给表单，那么表单本身呢，它需要做些什么才能工作呢？它需要以下内容:</p><ul class=""><li id="7f46" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated"><strong class="jt ir">一个方法</strong>，它可以挂接<code class="fe ng nh ni mw b">notify</code>属性</li><li id="5257" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">确定如何处理</strong>，如果一个或多个元素<em class="js">无效</em>，例如禁用提交按钮</li></ul><p id="bcf2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们还决定为我们的表单创建一个专用组件:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="531e" class="na lt iq mw b gy nb nc l nd ne">// Form.js</span><span id="3e15" class="na lt iq mw b gy nf nc l nd ne">import React from 'react'; <br/>import styled from 'styled-components'; <br/>import Input from './Input'; </span><span id="8d9f" class="na lt iq mw b gy nf nc l nd ne">const FormContainer = styled.form` <br/>  border: solid 2px; <br/>  padding: 20px; <br/>`; </span><span id="02a0" class="na lt iq mw b gy nf nc l nd ne">class Form extends React.Component { <br/>  state = { isValid: true, } </span><span id="63f3" class="na lt iq mw b gy nf nc l nd ne">  notify = (name, isValid) =&gt; { /* to be defined */ }<br/> <br/>  render() { <br/>    return ( <br/>      &lt;FormContainer&gt; <br/>        &lt;div&gt; <br/>          &lt;Input <br/>            errMessage="Must contain 2-3 digits"<br/>            pattern="<!-- -->^[0-9]{2,3}$<!-- -->" <br/>            desc="2-3 characters" <br/>            name="first-name" <br/>            notify={this.notify} <br/>            title="I am a custom inbox" /&gt; <br/>       &lt;/div&gt; <br/>       &lt;button&gt;<br/>       Submit<br/>       &lt;/button&gt; <br/>      &lt;/FormContainer&gt; <br/>    ); <br/>  } <br/>}</span><span id="ad0f" class="na lt iq mw b gy nf nc l nd ne">export default Form;</span></pre><p id="9c0b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">此时，我们已经将notify <code class="fe ng nh ni mw b">input</code>属性连接到组件上名为<code class="fe ng nh ni mw b">notify()</code>的方法，如下所示:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="6ece" class="na lt iq mw b gy nb nc l nd ne">&lt;Input <br/>  errMessage="Must contain 2-3 digits"<br/>  pattern="<!-- -->^[0-9]{2,3}$<!-- -->" <br/>  desc="2-3 characters" <br/>  name="first-name" <br/>  notify={this.notify} <br/>  title="I am a custom inbox" <br/>/&gt;</span></pre><p id="9bcb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">如您所见，我们的<code class="fe ng nh ni mw b">notify()</code>方法还没做多少，但它会:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="477d" class="na lt iq mw b gy nb nc l nd ne">notify = (name, isValid) =&gt; { /* to be defined */}</span></pre><p id="5fdc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">那么我们需要通过调用<code class="fe ng nh ni mw b">notify()</code>来完成什么呢？我们需要完成的第一件事是告诉表单您的一个输入无效。另一种是将整个表单设置为无效。基于此，我们将<code class="fe ng nh ni mw b">notify()</code>代码定义如下:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="c1c9" class="na lt iq mw b gy nb nc l nd ne">notify = (name, isValid) =&gt; { <br/>  this.setState(<br/>    { [name]: isValid, }, <br/>    () =&gt; { <br/>      this.setState({ <br/>        isValid: this.validForm(), <br/>      }); <br/>    }); <br/>}</span></pre><p id="0bb1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们在上面看到，在更新了输入元素的状态之后，我们为<code class="fe ng nh ni mw b">isValid</code>设置了状态，并调用方法<code class="fe ng nh ni mw b">validForm()</code>来确定它的值。这样设置<code class="fe ng nh ni mw b">isValid</code>状态的原因是<code class="fe ng nh ni mw b">setState()</code>不会立即发生，所以只有在回调时我们才能保证它的状态已经更新。</p><p id="1be0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><code class="fe ng nh ni mw b">isValid</code>是我们将在标记中用来确定表单是否有效的属性。接下来让我们定义方法<code class="fe ng nh ni mw b">validForm()</code>:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="6dd6" class="na lt iq mw b gy nb nc l nd ne">validForm = () =&gt; { <br/>  const keys = Object.keys(this.state); <br/>  for (let i = 0; i &lt; keys.length; i++) { <br/>    if (keys[i] === 'isValid') { <br/>      continue; <br/>    } <br/>    if (!this.state[keys[i]]) { <br/>      return false; <br/>    } <br/>  } <br/>  return true; <br/>}</span></pre><p id="bdbb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">上面我们循环了我们的状态，并寻找是否有一个输入元素无效。我们跳过<code class="fe ng nh ni mw b">isValid</code>，因为它不是元素状态。</p><h2 id="0bd9" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">确定表单状态</h2><p id="975a" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">我们现在已经做好了一切准备，以便于指示表单是否可以提交。我们可以用两种方式处理:</p><ul class=""><li id="5428" class="le lf iq jt b ju jv jy jz kp lg kq lh kr li ko lj lk ll lm bi translated"><strong class="jt ir">禁用</strong>，提交按钮</li><li id="23fc" class="le lf iq jt b ju ln jy lo kp lp kq lq kr lr ko lj lk ll lm bi translated"><strong class="jt ir">提交并验证</strong>，让用户按下提交按钮，但阻止提交通过</li></ul><p id="567e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">如果我们执行第一个变体，我们只需要将标记更改为以下内容:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="bda3" class="na lt iq mw b gy nb nc l nd ne">render() { <br/>  return ( <br/>    &lt;FormContainer onSubmit={this.handleSubmit}&gt; <br/>     &lt;div&gt; <br/>       &lt;Input <br/>         errMessage="Must contain 2-3 digits"<br/>         pattern="<!-- -->^[0-9]{2,3}$<!-- -->" <br/>         desc="2-3 characters" <br/>         name="first-name" <br/>         notify={this.notify} <br/>         title="I am a custom inbox" <br/>       /&gt; <br/>     &lt;/div&gt; <br/>     &lt;button disabled={!this.state.isValid}&gt;Submit&lt;/button<br/>    &lt;/FormContainer&gt; <br/>  ); <br/>}</span></pre><p id="093f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">让我们放大有趣的部分:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="d8bc" class="na lt iq mw b gy nb nc l nd ne">&lt;button disabled={!this.state.isValid}&gt;Submit&lt;/button&gt;</span></pre><p id="4dcb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我们从我们的<code class="fe ng nh ni mw b">isValid</code>属性中读取数据，并在需要时禁用我们的按钮。</p><p id="ffe5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">阻止提交的另一个版本涉及到我们向方法<code class="fe ng nh ni mw b">handleSubmit()</code>添加一些逻辑:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="2613" class="na lt iq mw b gy nb nc l nd ne">handleSubmit = (ev) =&gt; { <br/>  ev.preventDefault(); <br/>  if (!this.state.isValid) { <br/>    console.log('form is NOT valid'); <br/>  } else { <br/>    console.log('valid form') <br/>  } <br/>}</span></pre><h1 id="a7a4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">完整的代码和结果</h1><p id="3539" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">如果您成功地正确输入了所有内容，您应该会看到以下外观:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nu"><img src="../Images/8f29de41c543f4f177c6ae2967b5a3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSchdg5TcLxxp2o_cpu-Tg.png"/></div></div></figure><p id="0366" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">完整的代码如下所示:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="320b" class="na lt iq mw b gy nb nc l nd ne">// Form.js</span><span id="9566" class="na lt iq mw b gy nf nc l nd ne">import React from 'react';</span><span id="9696" class="na lt iq mw b gy nf nc l nd ne">import styled from 'styled-components';</span><span id="89b2" class="na lt iq mw b gy nf nc l nd ne">import Input from './Input';</span><span id="02bb" class="na lt iq mw b gy nf nc l nd ne">const FormContainer = styled.form`</span><span id="55e7" class="na lt iq mw b gy nf nc l nd ne">  border: solid 2px;</span><span id="3e53" class="na lt iq mw b gy nf nc l nd ne">  padding: 20px;</span><span id="a547" class="na lt iq mw b gy nf nc l nd ne">`;<br/></span><span id="a02e" class="na lt iq mw b gy nf nc l nd ne">class Form extends React.Component {</span><span id="eeaf" class="na lt iq mw b gy nf nc l nd ne">  state = {</span><span id="d225" class="na lt iq mw b gy nf nc l nd ne">    isValid: true,</span><span id="737d" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="bef6" class="na lt iq mw b gy nf nc l nd ne">  validForm = () =&gt; {</span><span id="806e" class="na lt iq mw b gy nf nc l nd ne">    const keys = Object.keys(this.state);</span><span id="081f" class="na lt iq mw b gy nf nc l nd ne">    for (let i = 0; i &lt; keys.length; i++) {</span><span id="123b" class="na lt iq mw b gy nf nc l nd ne">      if (keys[i] === 'isValid') { <br/>// filtering away `isValid`, this belongs to the form, as we only want to look at input elements</span><span id="af0f" class="na lt iq mw b gy nf nc l nd ne">        continue;</span><span id="a70f" class="na lt iq mw b gy nf nc l nd ne">      }</span><span id="97db" class="na lt iq mw b gy nf nc l nd ne">      if (!this.state[keys[i]]) {</span><span id="0a0c" class="na lt iq mw b gy nf nc l nd ne">        return false;</span><span id="b3cc" class="na lt iq mw b gy nf nc l nd ne">      }</span><span id="8d3f" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="5d3b" class="na lt iq mw b gy nf nc l nd ne">  return true;</span><span id="b22a" class="na lt iq mw b gy nf nc l nd ne">}</span><span id="5a67" class="na lt iq mw b gy nf nc l nd ne">  notify = (name, isValid) =&gt; {</span><span id="db2b" class="na lt iq mw b gy nf nc l nd ne">    this.setState(<br/>      { [name]: isValid, },</span><span id="2cb5" class="na lt iq mw b gy nf nc l nd ne">      () =&gt; { // this happens after the first `setState`</span><span id="1451" class="na lt iq mw b gy nf nc l nd ne">        this.setState({</span><span id="c4ca" class="na lt iq mw b gy nf nc l nd ne">          isValid: this.validForm(),</span><span id="c731" class="na lt iq mw b gy nf nc l nd ne">        });</span><span id="4aaf" class="na lt iq mw b gy nf nc l nd ne">     });</span><span id="ff6f" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="2d1f" class="na lt iq mw b gy nf nc l nd ne">  render() {</span><span id="1a40" class="na lt iq mw b gy nf nc l nd ne">    return (<br/>     &lt;FormContainer onSubmit={this.handleSubmit}&gt;</span><span id="bea8" class="na lt iq mw b gy nf nc l nd ne">       &lt;div&gt;</span><span id="25d1" class="na lt iq mw b gy nf nc l nd ne">         &lt;Input <br/>           pattern="^[0-9]{2,3}$" <br/>           errMessage="Must contain 2-3 digits" <br/>           desc="2-3 characters" <br/>           name="first-name" <br/>           notify={this.notify} <br/>           title="I am a custom inbox" <br/>         /&gt;</span><span id="b229" class="na lt iq mw b gy nf nc l nd ne">         &lt;Input <br/>           pattern="^[0-9]{2,10}$" <br/>           errMessage="Must contain 2-10 <br/>           digits" desc="2-10 <br/>           characters" <br/>           name="last-name" <br/>           notify={this.notify} <br/>           title="I am a custom inbox" <br/>         /&gt;</span><span id="ea9c" class="na lt iq mw b gy nf nc l nd ne">       &lt;/div&gt;</span><span id="a3e6" class="na lt iq mw b gy nf nc l nd ne">       &lt;button disabled={!this.state.isValid}&gt;Submit&lt;/button&gt;</span><span id="4d80" class="na lt iq mw b gy nf nc l nd ne">     &lt;/FormContainer&gt;<br/>    );</span><span id="7b17" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="af15" class="na lt iq mw b gy nf nc l nd ne">}</span><span id="e376" class="na lt iq mw b gy nf nc l nd ne">export default Form;</span></pre><p id="feb0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">以及输入组件:</p><pre class="kt ku kv kw gt mv mw mx my aw mz bi"><span id="38b0" class="na lt iq mw b gy nb nc l nd ne">// Input.js</span><span id="4746" class="na lt iq mw b gy nf nc l nd ne">import React from 'react';</span><span id="6ecf" class="na lt iq mw b gy nf nc l nd ne">import styled from 'styled-components';</span><span id="2898" class="na lt iq mw b gy nf nc l nd ne">import PropTypes from 'prop-types';</span><span id="1b3b" class="na lt iq mw b gy nf nc l nd ne">const InnerInput = styled.input`</span><span id="0ec5" class="na lt iq mw b gy nf nc l nd ne">font-size: 20px;</span><span id="f09f" class="na lt iq mw b gy nf nc l nd ne">`;</span><span id="0383" class="na lt iq mw b gy nf nc l nd ne">  const InputContainer = styled.div`</span><span id="43ce" class="na lt iq mw b gy nf nc l nd ne">  padding: 20px;</span><span id="2c14" class="na lt iq mw b gy nf nc l nd ne">  border: solid 1px grey;</span><span id="3a59" class="na lt iq mw b gy nf nc l nd ne">`;</span><span id="1bd1" class="na lt iq mw b gy nf nc l nd ne">const ErrorMessage = styled.div`</span><span id="053c" class="na lt iq mw b gy nf nc l nd ne">  padding: 20px;</span><span id="e081" class="na lt iq mw b gy nf nc l nd ne">  border: red;</span><span id="960b" class="na lt iq mw b gy nf nc l nd ne">  background: pink;</span><span id="b00d" class="na lt iq mw b gy nf nc l nd ne">  color: white;</span><span id="b14b" class="na lt iq mw b gy nf nc l nd ne">`;</span><span id="f2f7" class="na lt iq mw b gy nf nc l nd ne">const validate = (val, errMessage, pattern) =&gt; {</span><span id="d4e7" class="na lt iq mw b gy nf nc l nd ne">  const valid = new RegExp(pattern).test(val);</span><span id="73c3" class="na lt iq mw b gy nf nc l nd ne">  return valid ? '' : errMessage;</span><span id="18ba" class="na lt iq mw b gy nf nc l nd ne">};<br/></span><span id="5220" class="na lt iq mw b gy nf nc l nd ne">class Input extends React.Component {</span><span id="d856" class="na lt iq mw b gy nf nc l nd ne">  static propTypes = {</span><span id="3df3" class="na lt iq mw b gy nf nc l nd ne">    name: PropTypes.string,</span><span id="075b" class="na lt iq mw b gy nf nc l nd ne">    desc: PropTypes.string,</span><span id="8c95" class="na lt iq mw b gy nf nc l nd ne">    errMessage: PropTypes.string,</span><span id="f714" class="na lt iq mw b gy nf nc l nd ne">  };</span><span id="8c98" class="na lt iq mw b gy nf nc l nd ne">  state = {</span><span id="54ea" class="na lt iq mw b gy nf nc l nd ne">    error: '',</span><span id="9440" class="na lt iq mw b gy nf nc l nd ne">    data: '',</span><span id="fbe6" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="a564" class="na lt iq mw b gy nf nc l nd ne">  handleChange = (ev) =&gt; {</span><span id="e20f" class="na lt iq mw b gy nf nc l nd ne">    const { errMessage, name, notify, pattern } = this.props;</span><span id="c4db" class="na lt iq mw b gy nf nc l nd ne">    const error = validate(ev.target.value, errMessage, pattern);</span><span id="f8a2" class="na lt iq mw b gy nf nc l nd ne">  notify(name, error === '');</span><span id="a485" class="na lt iq mw b gy nf nc l nd ne">    this.setState({ data: ev.target.value, error, });</span><span id="1781" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="9d4c" class="na lt iq mw b gy nf nc l nd ne">  render() {</span><span id="416f" class="na lt iq mw b gy nf nc l nd ne">    const { error, data } = this.state;</span><span id="1087" class="na lt iq mw b gy nf nc l nd ne">    const { desc } = this.props;</span><span id="8d2c" class="na lt iq mw b gy nf nc l nd ne">    return (</span><span id="9eb2" class="na lt iq mw b gy nf nc l nd ne">      &lt;InputContainer&gt;</span><span id="d685" class="na lt iq mw b gy nf nc l nd ne">        {error &amp;&amp;</span><span id="5f1c" class="na lt iq mw b gy nf nc l nd ne">        &lt;ErrorMessage&gt;{error}&lt;/ErrorMessage&gt;</span><span id="b138" class="na lt iq mw b gy nf nc l nd ne">        }</span><span id="d48b" class="na lt iq mw b gy nf nc l nd ne">        &lt;div&gt; {desc} &lt;/div&gt;</span><span id="6e90" class="na lt iq mw b gy nf nc l nd ne">        &lt;InnerInput</span><span id="213e" class="na lt iq mw b gy nf nc l nd ne">          value={data}</span><span id="6d60" class="na lt iq mw b gy nf nc l nd ne">          onChange={this.handleChange} {...this.props}</span><span id="6c7f" class="na lt iq mw b gy nf nc l nd ne">        /&gt;</span><span id="28a7" class="na lt iq mw b gy nf nc l nd ne">      &lt;/InputContainer&gt;);</span><span id="5767" class="na lt iq mw b gy nf nc l nd ne">  }</span><span id="7c88" class="na lt iq mw b gy nf nc l nd ne">}</span><span id="a077" class="na lt iq mw b gy nf nc l nd ne">export default Input;</span></pre><p id="4ded" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">此时，您可能会想，复选框元素、单选按钮、下拉框、异步验证呢？我只想用一个更小的例子来描述这个想法。请在评论中告诉我，我会把它添加到项目中，但希望我能传达这个想法:)</p><h1 id="f8c8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">摘要</h1><p id="7a68" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">我们开始描述一种处理表单的方法。这包括围绕HTML输入元素和表单本身创建包装组件。此后，我们展示了如何将任何验证错误报告回表单，以便它能够以合适的方式进行操作。我确信有比这个更好的解决方案，但是希望你能理解如何处理表单。</p><h2 id="42f3" class="na lt iq bd lu nj nk dn ly nl nm dp mc kp nn no mg kq np nq mk kr nr ns mo nt bi translated">进一步阅读</h2><p id="60b5" class="pw-post-body-paragraph jq jr iq jt b ju mq jw jx jy mr ka kb kp ms ke kf kq mt ki kj kr mu km kn ko ij bi translated">如果你正在做表单并且使用Redux，我推荐你看一看Redux表单库</p><p id="2e81" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">我还建议你看一下表格上的官方文件，写得很好</p><p id="6125" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">下面是一个运行上面代码的<a class="ae nv" href="https://github.com/softchris/react-forms-demo" rel="noopener ugc nofollow" target="_blank">示例项目</a></p><p id="e7e8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated"><a class="ae nv" href="https://twitter.com/chris_noring" rel="noopener ugc nofollow" target="_blank">我的推特</a></p></div></div>    
</body>
</html>