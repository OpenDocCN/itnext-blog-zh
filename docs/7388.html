<html>
<head>
<title>Automating API Testing with Portman, Postman and Newman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Portman、Postman和Newman实现API测试自动化</h1>
<blockquote>原文：<a href="https://itnext.io/automating-api-testing-with-portman-postman-and-newman-ec1a869cbc99?source=collection_archive---------2-----------------------#2022-09-08">https://itnext.io/automating-api-testing-with-portman-postman-and-newman-ec1a869cbc99?source=collection_archive---------2-----------------------#2022-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/1e67ef1b0099a0db6422126ada16eeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xeJ7u84qD5bP7lP-MfXYuw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来自波特曼博客</figcaption></figure><p id="acf2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">几个月前，我换了工作和公司，这是一个受欢迎的变化，但肯定是喝了消防水管！现在事情已经稍微安定下来，我可以回到我喜欢的事情上来了。</p><p id="6754" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我现在工作的团队是一个新团队，我们正在努力找出我们的流程，并尽可能多地实现自动化。为此，我承担了API测试的自动化。</p><p id="2b4a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我知道我想要遵循和上次一样的蓝图，通过CI/CD使用Newman，正如我在“<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/automating-api-testing-with-newman-1e5d0aabcec">用Newman </a>自动化API测试”中所写的那样。但是我遇到了一个有趣的工具，叫做<a class="ae ld" href="https://github.com/apideck-libraries/portman" rel="noopener ugc nofollow" target="_blank">波特曼</a>，我想试试。我上次做的真的很好，但我们必须通过邮递员维护邮递员集合，这有点痛苦。这也将允许我们更接近规范驱动的开发，其中OpenAPI规范将驱动一切。</p><p id="5ef7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用Portman，我们不仅可以生成供Newman使用的Postman集合，还可以包括我们所有的合同、内容和模糊测试，以及处理身份验证的预请求脚本。</p><h1 id="1a06" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">需要配置文件</h1><p id="08f7" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">Portman使用了一些文件，您需要配置这些文件来将所有这些结合在一起。波特曼可以被设置为与邮差团队/工作区同步您的收藏，我正在这样做。关键文件是，名字可以根据你的需要更改，我的名字是基于我在GitHub 的<a class="ae ld" href="https://github.com/apideck-libraries/portman/tree/main/examples" rel="noopener ugc nofollow" target="_blank">波特曼例子中找到的:</a></p><h2 id="5b8a" class="mh lf it bd lg mi mj dn lk mk ml dp lo kq mm mn ls ku mo mp lw ky mq mr ma ms bi translated">波特曼-cli-options.json</h2><p id="9265" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">这个文件只是让您在调用Portman时不必在命令行中添加任何内容。您当然可以选择将所有内容传递给Portman，但是将所有内容指定在一个位置并存储在您的repo中会更干净一些</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><h2 id="3b0d" class="mh lf it bd lg mi mj dn lk mk ml dp lo kq mm mn ls ku mo mp lw ky mq mr ma ms bi translated">邮递员-config.api.json</h2><p id="1bc0" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">邮递员解析值的选项。为了更好地理解选项是什么，请看<a class="ae ld" href="https://github.com/postmanlabs/openapi-to-postman/blob/develop/OPTIONS.md" rel="noopener ugc nofollow" target="_blank">这里</a>。我把这个文件和例子中提供的保持一致。</p><h2 id="5693" class="mh lf it bd lg mi mj dn lk mk ml dp lo kq mm mn ls ku mo mp lw ky mq mr ma ms bi translated">。环境-邮递员</h2><p id="2fa4" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">如果你正在同步到Postman cloud，你将把你的API密匙放在这个文件中。这个文件对我来说有一个单独的KVP POSTMAN _ API _ KEY =<key/></p><h2 id="76fd" class="mh lf it bd lg mi mj dn lk mk ml dp lo kq mm mn ls ku mo mp lw ky mq mr ma ms bi translated">波特曼-配置. api.json</h2><p id="30d0" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">这是我们将要配置的主文件，在这里您将定义任何全局设置，如预请求脚本、特定测试(内容、合同、模糊化等)或Portman的许多其他功能。</p><p id="336b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们要做的第一件事是设置预请求脚本，该脚本将处理从登录服务获取JWT，然后在每个后续请求中使用它。有关创建这个脚本的更多信息，请看我以前写的一篇文章，标题是“<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/getting-a-bearer-token-in-postman-newman-automatically-for-a-collection-d3001a0dc1ea">在Postman / Newman中自动为集合</a>获取不记名令牌”</p><p id="374e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这将在“全局”部分定义。请注意，如果您有多行，您将需要包括“；”在《邮差》里你不会。波特曼也接受代码，这将需要在一个单一的行中看到的要点</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="d11e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来我们要定义的是测试，这是一个同时使用内容测试和契约测试的例子。这些都是非常简单的测试，但是你可以扩展很多，看看波特曼的<a class="ae ld" href="https://github.com/apideck-libraries/portman/tree/main/examples/testsuite-contract-tests" rel="noopener ugc nofollow" target="_blank">合同测试</a>和<a class="ae ld" href="https://github.com/apideck-libraries/portman/tree/main/examples/testsuite-content-tests" rel="noopener ugc nofollow" target="_blank">内容测试</a>的例子来更好地了解你能做什么。</p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><h1 id="932d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">运行波特曼</h1><p id="dbdb" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">现在您已经配置了所有的文件，您可以运行OpenAPI yaml/json文件到postman集合的转换。</p><p id="9ae0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">因为您设置了CLI选项文件，所以您可以只向portman命令行传递一个选项，即“CLI Options file<options file="">, Portman会处理其余的。</options></p><figure class="mt mu mv mw gt ju"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="69b2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在您可以<a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/automating-api-testing-with-newman-1e5d0aabcec">将它添加到您的CI/CD管道</a>中，以动态创建您的测试，并确保您在每次构建时都充分测试了您的API。</p><h1 id="0326" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">离别的思绪</h1><p id="44fa" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">看看<a class="ae ld" href="https://github.com/apideck-libraries/portman/tree/main/examples" rel="noopener ugc nofollow" target="_blank">波特曼的例子</a>，里面有很多很好的信息！文档很不错，但并不是都在同一个地方，所以可能有点难找到，但通过示例工作将提供很多见解！</p><p id="27ea" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对于我的设置，我将它同步到一个邮递员团队，以便我们可以通过邮递员应用程序查看邮递员集合。如果你这样做，请记住，虽然该选项被称为同步，但它实际上只是从波特曼到邮递员的覆盖。在我最初的测试中，由于没有将我在Postman中对集合所做的编辑保存到portman-config文件中，然后运行portman，这让我很苦恼。</p><p id="703e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有一个很好的YouTube视频，我是通过<a class="mz na ep" href="https://medium.com/u/cb4ccf78bf8e?source=post_page-----ec1a869cbc99--------------------------------" rel="noopener" target="_blank"> Mostafa Moradian </a>的一篇文章偶然发现的，其中Tim Haselaars(波特曼的创始人之一)讲述了他如何使用Portman、Postman和K6执行完整的API和负载测试，所有这些都来自OpenAPI规范。这真的让我大开眼界，看到了我们可以通过自动化流程实现的所有可能性。它有点长，但是如果你对自动化你的测试流程感兴趣的话，确实值得一看。</p><p id="6c14" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你喜欢这篇文章或者我以前写过的任何一篇，请鼓掌或者跟我来。感谢您的阅读！</p></div></div>    
</body>
</html>