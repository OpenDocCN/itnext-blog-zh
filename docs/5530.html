<html>
<head>
<title>Real-Time Search and Analytics with Confluent, Azure, Redis, and Spring Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Confluent、Azure、Redis和Spring Cloud进行实时搜索和分析</h1>
<blockquote>原文：<a href="https://itnext.io/real-time-search-and-analytics-with-confluent-azure-redis-and-spring-cloud-3b0d2881e18c?source=collection_archive---------3-----------------------#2021-03-25">https://itnext.io/real-time-search-and-analytics-with-confluent-azure-redis-and-spring-cloud-3b0d2881e18c?source=collection_archive---------3-----------------------#2021-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1aed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">原载于2021年3月25日</em><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://www . confuent . io</em></a><em class="kl">。</em></p><p id="8b89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自我管理一个像Apache Kafka这样的分布式系统，以及构建和操作Kafka连接器，是非常复杂和耗费资源的。它要求您组织的开发和运营团队具备丰富的Kafka技能和专业知识。此外，您处理的实时数据量越大，确保所有基础架构高效扩展和可靠运行的挑战就越大。</p><p id="c427" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Confluent和微软正在共同努力，通过缓解典型的基础设施管理需求，使采用事件流的过程比以往任何时候都更容易，这种需求通常会使开发人员远离构建关键应用程序。通过Azure和Confluent的无缝集成，您可以实时收集、存储、处理事件流，并将它们提供给多个Azure数据服务。这种集成有助于减轻Azure和Confluent之间管理资源的负担。</p><p id="f1cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://www.confluent.io/azure/" rel="noopener ugc nofollow" target="_blank">与汇流</a>的统一集成使您能够:</p><ul class=""><li id="fdbd" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">从Azure客户端界面(如Azure Portal/CLI/SDK)调配新的融合云资源，并提供完全托管的基础架构</li><li id="374c" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">利用您现有的Azure Active Directory (AAD)身份，简化从Azure到融合云的单点登录(SSO)</li><li id="6258" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">通过Azure订阅发票获得对您的融合云服务使用的统一计费，并可选择使用Azure commits融合的云消费费用只是作为Azure月账单上的一个项目出现</li><li id="4b9b" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">从Azure门户管理融合的云资源，并在“所有资源”页面中跟踪它们，以及你的Azure资源</li></ul><p id="1257" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Confluent开发了一个预建连接器的<a class="ae km" href="https://www.confluent.io/azure/" rel="noopener ugc nofollow" target="_blank">扩展库</a>,可以无缝集成来自许多不同环境的数据。通过融合，Azure客户可以访问完全托管的连接器，这些连接器将低延迟、实时分析的数据流传输到Azure和微软服务，如<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-functions-sink.html" rel="noopener ugc nofollow" target="_blank"> Azure Functions </a>、<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-blob-sink.html" rel="noopener ugc nofollow" target="_blank"> Azure Blob Storage </a>、<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-event-hubs-source.html" rel="noopener ugc nofollow" target="_blank"> Azure Event Hubs </a>、<a class="ae km" href="https://docs.confluent.io/5.5.0/cloud/connectors/cc-azure-datalakeGen2-storage-sink.html" rel="noopener ugc nofollow" target="_blank">Azure Data Lake Storage(ADLS)gen 2</a>和<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-microsoft-sql-server-source.html" rel="noopener ugc nofollow" target="_blank"> Microsoft SQL Server </a>。现在，更多实时数据可以轻松地流向应用程序，以实现更智能的分析和更丰富的上下文体验。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="b0a7" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">实时搜索用例</h1><p id="f1d4" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在当今快速发展的业务生态系统中，组织必须创建新的业务模式，提供卓越的客户体验，并提高运营效率，以保持相关性和竞争力。技术在这一旅程中扮演着关键角色，新的当务之急是构建可扩展、可靠、持久的实时系统。以较低成本和风险处理大量数据的实时基础设施在这一演变中发挥了关键作用。</p><p id="9576" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Apache Kafka经常在现代数据架构中扮演关键角色，其他系统向它生成数据/从它消费数据。这些可能是客户订单、金融交易、点击流事件、日志、传感器数据和数据库更改事件。正如您可能想象的那样，Kafka中有大量数据(主题)，但只有在经过处理(例如，使用Azure Spring Cloud或ksqlDB)或被其他系统接收时，这些数据才有用。</p><p id="91cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们研究一种将现有的传统事务系统转换为实时数据处理系统的架构模式。我们将描述一个在MySQL和RediSearch之间同步数据的数据管道，由Azure上的融合云提供支持。这个场景适用于许多用例，但是我们将专门讨论下游系统必须接近实时地获得批处理数据以满足搜索需求的场景。数据可以进一步传输到ADLS商店，以便关联实时和历史数据、进行分析和可视化。这为通过API驱动业务的重要部分的其他服务提供了基础，例如面向客户的网站，它可以提供关于产品、可用性等的最新信息。</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ml"><img src="../Images/5398db26e93b8b4cfac2bb0fe7f49c9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eR0INKulKGmYrHz3.png"/></div></div></figure><p id="7ac6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是上述体系结构的关键要素和功能:</p><ul class=""><li id="3aa1" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">构成架构基础的基础设施组件</li><li id="8d21" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-datalakeGen2-storage-sink.html#az-data-lake-storage-gen2-sink-connector-for-ccloud" rel="noopener ugc nofollow" target="_blank"> ADLS第二代接收器连接器</a>,用于将数据从Kafka topics导出到ADLS</li><li id="1443" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/en-us/azure/storage/blobs/create-data-lake-storage-account" rel="noopener ugc nofollow" target="_blank"> ADLS数据存储</a>用于实时和历史数据的关联以及进一步的分析和可视化</li><li id="bc78" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">应用组件:这些是运行在Azure Spring Cloud上的服务</li><li id="3a69" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">使用<a class="ae km" href="https://spring.io/projects/spring-kafka" rel="noopener ugc nofollow" target="_blank"> Spring进行Apache Kafka集成的</a><a class="ae km" href="https://spring.io/projects/spring-boot" rel="noopener ugc nofollow" target="_blank"> Java Spring Boot应用程序</a>是一个消费者应用程序，它通过创建所需的索引定义来处理从Kafka主题到Redis的事件；它通过创建所需的索引定义和添加新的产品信息作为重新搜索文档(当前表示为Redis hash ),将记录作为重新搜索文档添加</li><li id="a651" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">搜索应用程序是另一个Spring Boot应用程序，它使再搜索数据作为REST API可用；它允许您按照<a class="ae km" href="https://oss.redislabs.com/redisearch/Query_Syntax/" rel="noopener ugc nofollow" target="_blank">重新搜索查询语法</a>执行查询</li></ul><p id="134c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述服务使用JRediSearch库与RediSearch接口，以便创建索引、添加文档和查询。</p><p id="b0b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多亏了JDBC源连接器，MySQL(产品表)中的数据被发送到Kafka主题。以下是JSON有效负载的样子:</p><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mx"><img src="../Images/7afdb7e14af22777dc46a624a7388d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s2mBYdUiVL0dkihb.png"/></div></div></figure><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi my"><img src="../Images/ba7604fef214a692ec2cf2f0851d50f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9YPRa6HgrhhLmh1P.png"/></div></div></figure></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="7c53" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">目标</h1><p id="c353" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">数据可以上传到Azure Database for MySQL上的关系数据库中，在这种情况下，通过应用程序或批处理。这些数据将从Azure上的Confluent Cloud同步到Redis企业服务Azure Cache中的RediSearch模块。这将使您能够以灵活的方式对数据执行实时搜索。实时数据也被传输到ADLS的一家商店。所有的服务组件都可以部署到一个Azure区域，以获得低延迟和低性能。此外，这些服务组件部署在单个Azure订阅中，以通过Azure订阅发票对您的融合云使用进行统一计费。</p><h2 id="eb9e" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated">先决条件</h2><ol class=""><li id="abf7" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated">一个Azure账户</li><li id="5519" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/cli/azure/install-azure-cli?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank">安装Azure CLI </a>来部署和管理基础架构组件</li><li id="9e81" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated">JDK 11或以上为例<a class="ae km" href="https://openjdk.java.net/projects/jdk/11/" rel="noopener ugc nofollow" target="_blank">开JDK </a></li><li id="9b40" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated">最近的一个Maven版本</li><li id="5fb6" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated">安装<a class="ae km" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank"> Git </a></li></ol><h2 id="ac87" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated"><a class="ae km" href="https://github.com/Azure-Samples/mysql-kafka-redis-integration#set-up-the-base-infrastructure-components" rel="noopener ugc nofollow" target="_blank">设置Azure云环境</a></h2><ol class=""><li id="4150" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/azure/mysql/quickstart-create-mysql-server-database-using-azure-cli?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank">为MySQL服务器创建Azure数据库</a></li><li id="8c74" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/en-us/azure/partner-solutions/apache-kafka-confluent-cloud/create" rel="noopener ugc nofollow" target="_blank">在融合云上创建Apache Kafka的实例</a></li><li id="67b9" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/azure/azure-cache-for-redis/quickstart-create-redis-enterprise?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank">创建一个Redis企业缓存实例</a>，启用Redis搜索模块</li><li id="23ca" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/azure/spring-cloud/spring-cloud-quickstart?tabs=Azure-CLI&amp;pivots=programming-language-java&amp;WT.mc_id=data-14444-abhishgu#provision-an-instance-of-azure-spring-cloud" rel="noopener ugc nofollow" target="_blank">提供Azure Spring Cloud的一个实例</a></li></ol><h2 id="a625" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated"><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud#azure-spring-cloud" rel="noopener ugc nofollow" target="_blank">构建并部署应用到Azure Spring Cloud </a></h2><ol class=""><li id="7518" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated">设置消费者应用程序来处理从Kafka主题到Redis的事件</li><li id="e617" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated">设置搜索应用程序以查询来自重新搜索的记录</li><li id="63d2" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk no kt ku kv bi translated">构建并部署应用程序JAR文件</li></ol><h2 id="120c" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated"><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud#in-action" rel="noopener ugc nofollow" target="_blank">使用搜索应用程序查询数据</a></h2><ol class=""><li id="0820" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated">使用<code class="fe np nq nr ns b">curl</code>或HTTP客户端来调用搜索API</li></ol><h2 id="6863" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated"><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud#azure-data-lake" rel="noopener ugc nofollow" target="_blank">将数据导出到Azure Data Lake </a></h2><ol class=""><li id="5ef9" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated">设置ADLS Gen 2连接器以从Kafka主题导出数据</li></ol><h2 id="5db2" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated"><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud#delete-resources" rel="noopener ugc nofollow" target="_blank">清理</a></h2><ol class=""><li id="beef" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk no kt ku kv bi translated">单独删除资源(MySQL、融合云组织、Redis和您的Azure Spring云实例)或删除资源组</li></ol><h1 id="7aa9" class="li lj iq bd lk ll nt ln lo lp nu lr ls lt nv lv lw lx nw lz ma mb nx md me mf bi translated">在Azure上配置MySQL和融合云</h1><h2 id="0f99" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated">Azure上的MySQL实例</h2><p id="364e" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">使用Azure CLI 为MySQL服务器创建一个<a class="ae km" href="https://docs.microsoft.com/azure/mysql/quickstart-create-mysql-server-database-using-azure-cli?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure数据库(或者使用</a><a class="ae km" href="https://docs.microsoft.com/azure/mysql/quickstart-create-mysql-server-database-using-azure-portal?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure门户</a>，如果您喜欢的话):</p><h2 id="d526" class="mz lj iq bd lk na nb dn lo nc nd dp ls jy ne nf lw kc ng nh ma kg ni nj me nk bi translated">融合云中的卡夫卡星团</h2><ul class=""><li id="6322" class="kn ko iq jp b jq mg ju mh jy nl kc nm kg nn kk ks kt ku kv bi translated"><a class="ae km" href="https://portal.azure.com/#create/confluentinc.confluent-cloud-azure-prod" rel="noopener ugc nofollow" target="_blank">在融合云上设置并订阅</a>Apache Kafka，您可以通过Azure Marketplace轻松找到它</li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ny"><img src="../Images/c7b440273bf149d71570d2c9f2870e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UmpGZI6v26u-ZDvc.png"/></div></div></figure><ul class=""><li id="4616" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><strong class="jp ir">提供在Azure上创建融合云组织的配置细节</strong></li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nz"><img src="../Images/a60733d16e159920f25f111acf8b83ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PIFu7zkfYmFNU7RC.png"/></div></div></figure><ul class=""><li id="8a58" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><strong class="jp ir">Azure中的供应:</strong>通过Azure门户无缝供应融合的组织</li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oa"><img src="../Images/f963d2fe0c4344b6d390dbf19f5399c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k82PluH3-AJJSZX9.png"/></div></div></figure><ul class=""><li id="601a" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><strong class="jp ir">单点登录融合云:</strong>直接登录融合云</li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ob"><img src="../Images/051f733edeae0ee9ceb2e98af95bf436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qK1u_S56iuDF3UOX.png"/></div></div></figure><ul class=""><li id="53a2" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><strong class="jp ir">创建融合云完全受管资源</strong>，如集群、主题和连接器</li></ul><figure class="mm mn mo mp gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi oc"><img src="../Images/cbb2d480baacaf9d947cc85399e8f6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CtLKe_rULGuX671N.png"/></div></div></figure><ul class=""><li id="d00f" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><strong class="jp ir">创建主题(可选):</strong>连接器自动创建主题(基于默认约定)；如果您想要覆盖其默认设置，请手动创建主题，但是要确保在配置连接器时使用相同的主题名称</li><li id="1060" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-mysql-source.html#step-2-add-a-connector" rel="noopener ugc nofollow" target="_blank">使用门户</a>配置并启动MySQL源连接器</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="a6ff" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">将应用程序构建和部署到Azure Spring Cloud</h1><p id="d9c7" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">从克隆<a class="ae km" href="https://github.com/Azure-Samples/mysql-kafka-redis-integration" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>开始，进入<code class="fe np nq nr ns b">mysql-kafka-redis-integration</code>目录:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="fa09" class="mz lj iq ns b gy oh oi l oj ok">git clone <a class="ae km" href="https://github.com/Azure-Samples/mysql-kafka-redis-integration" rel="noopener ugc nofollow" target="_blank">https://github.com/Azure-Samples/mysql-kafka-redis-integration</a> </span><span id="a97c" class="mz lj iq ns b gy ol oi l oj ok">cd mysql-kafka-redis-integration</span></pre><p id="5dd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这两个服务，用Redis的Azure Cache和融合云集群的连接细节更新<code class="fe np nq nr ns b">src/main/resources</code>文件夹中的<code class="fe np nq nr ns b">application.yaml</code>文件。</p><p id="95d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是变更事件处理器服务的精简版本:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="c89b" class="mz lj iq ns b gy oh oi l oj ok">redis:<br/>  host: &lt;enter redis host&gt;<br/>  port: &lt;enter redis port&gt;<br/>  password: &lt;enter redis access key&gt; <br/>topic:<br/>  name: &lt;topic name e.g. myserver.products&gt;<br/>  partitions-num: 6<br/>  replication-factor: 3<br/>spring:<br/>  kafka:<br/>    bootstrap-servers:<br/>      - &lt;enter Confluent Cloud bootstrap server&gt;<br/>    properties:<br/>      ssl.endpoint.identification.algorithm: https<br/>      sasl.mechanism: PLAIN<br/>      request.timeout.ms: 20000<br/>      retry.backoff.ms: 500<br/>      sasl.jaas.config: org.apache.kafka.common.security.plain.PlainLoginModule required username="&lt;enter Confluent Cloud API key&gt;" password="&lt;enter Confluent Cloud API secret&gt;";<br/>      security.protocol: SASL_SSL<br/>...</span></pre><p id="ccdf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索API服务的配置非常紧凑:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="c796" class="mz lj iq ns b gy oh oi l oj ok">redis:<br/>  host: &lt;enter redis host&gt;<br/>  port: &lt;enter redis port&gt;<br/>  password: &lt;enter redis access key&gt;</span></pre><p id="68ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为Spring应用程序构建JAR文件:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="cf4f" class="mz lj iq ns b gy oh oi l oj ok">export JAVA_HOME=&lt;enter path to JDK e.g. /Library/Java/JavaVirtualMachines/zulu-11.jdk/Contents/Home&gt;<br/><br/># Change Events Processor service<br/>mvn clean package -f change-events-processor/pom.xml<br/><br/># Search API service<br/>mvn clean package -f search-api/pom.xml</span></pre><p id="26c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为Azure CLI 安装Azure Spring Cloud <a class="ae km" href="https://docs.microsoft.com/cli/azure/extension?view=azure-cli-latest&amp;WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank">扩展:</a></p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="8ae0" class="mz lj iq ns b gy oh oi l oj ok">az extension add --name spring-cloud</span></pre><p id="2633" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://docs.microsoft.com/cli/azure/ext/spring-cloud/spring-cloud/app?view=azure-cli-latest&amp;WT.mc_id=data-14444-abhishgu#ext_spring_cloud_az_spring_cloud_app_create" rel="noopener ugc nofollow" target="_blank">创建与两个服务对应的Azure Spring云应用</a>:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="6dd0" class="mz lj iq ns b gy oh oi l oj ok"># Change Events Processor service<br/>az spring-cloud app create -n change-events-processor -s &lt;enter the name of Azure Spring Cloud service instance&gt; -g &lt;enter azure resource group name&gt; --runtime-version Java_11<br/><br/># Search API service<br/>az spring-cloud app create -n search-api -s &lt;enter the name of Azure Spring Cloud service instance&gt; -g &lt;enter azure resource group name&gt; --runtime-version Java_11 --is-public true</span></pre><p id="c031" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://docs.microsoft.com/cli/azure/ext/spring-cloud/spring-cloud/app?view=azure-cli-latest&amp;WT.mc_id=data-14444-abhishgu#ext_spring_cloud_az_spring_cloud_app_deploy" rel="noopener ugc nofollow" target="_blank">为您刚刚创建的各个应用程序部署JAR文件</a>:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="7b54" class="mz lj iq ns b gy oh oi l oj ok"># for the Change Events Processor service<br/>az spring-cloud app deploy -n change-events-processor -s &lt;enter the name of Azure Spring Cloud service instance&gt; -g &lt;enter azure resource group name&gt; --jar-path change-events-processor/target/change-events-processor-0.0.1-SNAPSHOT.jar<br/><br/># for the Search API service<br/>az spring-cloud app deploy -n search-api -s &lt;enter the name of Azure Spring Cloud service instance&gt; -g &lt;enter azure resource group name&gt; --jar-path search-api/target/search-api-0.0.1-SNAPSHOT.jar</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="eab9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">是时候看看实时搜索了！</h1><p id="c34d" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">现在我们已经有了所有的组件，我们可以测试端到端的功能。我们将从向MySQL数据库添加新产品数据开始，并使用搜索应用程序来确保它已经传播到Redis。</p><p id="f284" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">插入以下示例数据:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="5f0d" class="mz lj iq ns b gy oh oi l oj ok">INSERT INTO `products` VALUES (42, 'Outdoor chairs', NOW(), '{"brand": "Mainstays", "description": "Mainstays Solid Turquoise 72 x 21 in. Outdoor Chaise Lounge Cushion", "tags": ["Self ties cushion", "outdoor chairs"], "categories": ["Garden"]}');<br/><br/>INSERT INTO `products` VALUES (43, 'aPhone', NOW(), '{"brand": "Orange", "description": "An inexpensive phone", "tags": ["electronics", "mobile phone"], "categories": ["Electronics"]}');</span></pre><p id="a832" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用门户或<a class="ae km" href="https://docs.microsoft.com/cli/azure/ext/spring-cloud/spring-cloud/app?view=azure-cli-latest&amp;WT.mc_id=data-14444-abhishgu#ext_spring_cloud_az_spring_cloud_app_show" rel="noopener ugc nofollow" target="_blank"> CLI </a>获取搜索API服务的URL:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="5657" class="mz lj iq ns b gy oh oi l oj ok">az spring-cloud app show -n search-api -s &lt;enter the name of Azure Spring Cloud service instance&gt; -g &lt;enter azure resource group name&gt;</span></pre><p id="d48d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe np nq nr ns b">curl</code>或另一个HTTP客户端来调用搜索API。每个查询都将以JSON有效负载的形式返回结果，如下所示:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="269a" class="mz lj iq ns b gy oh oi l oj ok">[<br/>    {<br/>        "created": "1614235666000",<br/>        "name": "Outdoor chairs",<br/>        "description": "Mainstays Solid Turquoise 72 x 21 in. Outdoor Chaise Lounge Cushion",<br/>        "id": "42",<br/>        "categories": "Garden",<br/>        "brand": "Mainstays",<br/>        "tags": "Self ties cushion, outdoor chairs"<br/>    },<br/>    {<br/>        "created": "1614234718000",<br/>        "name": "aPhone",<br/>        "description": "An inexpensive phone",<br/>        "id": "43",<br/>        "categories": "Electronics",<br/>        "brand": "Orange",<br/>        "tags": "electronics, mobile phone"<br/>    }<br/>]</span></pre><p id="ebb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有几个例子可以帮助你开始。注意，查询参数<code class="fe np nq nr ns b">q</code>用于指定<a class="ae km" href="https://oss.redislabs.com/redisearch/Query_Syntax/" rel="noopener ugc nofollow" target="_blank">重新搜索查询</a>。</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="3ed3" class="mz lj iq ns b gy oh oi l oj ok"># search for all records<br/>curl &lt;search api URL&gt;/search?q=*<br/><br/># search for products by name<br/>curl &lt;search api URL&gt;/search?q=@name:Outdoor chairs<br/><br/># search for products by category<br/>curl &lt;search api URL&gt;/search?q=@categories:{Garden | Electronics}<br/><br/># search for products by brand<br/>curl &lt;search api URL&gt;/search?q=@brand:Mainstays<br/><br/># apply multiple search criteria<br/>curl &lt;search api URL&gt;/search?q=@categories:{Electronics} @brand:Orange</span></pre><p id="34f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe np nq nr ns b">redis-cli</code>连接到Redis实例的Azure缓存:</p><pre class="mm mn mo mp gt od ns oe of aw og bi"><span id="aacc" class="mz lj iq ns b gy oh oi l oj ok">redis-cli -h &lt;enter host name&gt; -p &lt;enter port i.e. 10000&gt; -a &lt;enter redis password/access key&gt; --tls</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="9b81" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">将数据导出到Azure数据湖</h1><p id="e04a" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果你想将这些数据长期存储在Azure Data Lake Storage(冷存储)中，Confluent的<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-datalakeGen2-storage-sink.html" rel="noopener ugc nofollow" target="_blank"> ADLS Gen2连接器</a>可以满足你。在我们的场景中，我们已经有产品数据流入Azure上的Confluent Cloud中的Kafka主题——我们需要做的只是配置连接器来完成工作。</p><p id="f738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">猜猜看，这也是一种完全托管的产品！</p><p id="01c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你需要做的是:</p><ul class=""><li id="bde3" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><a class="ae km" href="https://docs.microsoft.com/azure/storage/blobs/create-data-lake-storage-account?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank">创建存储账户</a></li><li id="a00b" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">配置连接器并启动它；确保使用与之前相同的主题名称(如<code class="fe np nq nr ns b">myserver.products</code>)</li><li id="762d" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">确认数据已导出到ADLS帐户中的Azure存储容器</li></ul><p id="f79d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如需逐步指南，<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-datalakeGen2-storage-sink.html#quick-start" rel="noopener ugc nofollow" target="_blank">请遵循文档</a>。</p><h1 id="570a" class="li lj iq bd lk ll nt ln lo lp nu lr ls lt nv lv lw lx nw lz ma mb nx md me mf bi translated">删除Azure资源</h1><p id="dc25" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">完成后，删除这些服务，这样你就不会产生不必要的费用。如果它们在同一个资源组中，简单地<a class="ae km" href="https://docs.microsoft.com/azure/azure-resource-manager/management/delete-resource-group?tabs=azure-portal&amp;WT.mc_id=data-14444-abhishgu#delete-resource-group" rel="noopener ugc nofollow" target="_blank">删除资源组</a>就足够了。还可以单独删除资源(MySQL、Confluent Cloud organization、Redis和Azure Spring Cloud实例)。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="dc56" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">摘要</h1><p id="f266" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">随着越来越多的企业进行数字化转型，实时应用的紧迫性将呈指数级增长。通过Confluent和Azure之间的新集成，以及可用于将数据导出和来源到Azure数据和存储服务的完全托管的Kafka连接器，您将能够更快地处理大量数据，简化集成，并避免设置和维护复杂的分布式系统的挑战。</p><p id="6067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这份完整的指南向您展示了如何基于托管PaaS服务在Azure上运行该解决方案的高级架构。这样做的好处是，您不必设置和维护复杂的分布式系统，如数据库、事件流平台和Spring Boot Java应用程序的运行时基础设施。</p><p id="9827" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，这只是一个潜在的更大用例的一部分。多亏了Kafka，您还可以扩展该解决方案，以与其他系统集成，如<a class="ae km" href="https://docs.microsoft.com/azure/storage/blobs/data-lake-storage-introduction?WT.mc_id=data-14444-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Data Lake </a>，使用另一个完全托管的<a class="ae km" href="https://docs.confluent.io/cloud/current/connectors/cc-azure-datalakeGen2-storage-sink.html" rel="noopener ugc nofollow" target="_blank"> ADLS Gen2连接器</a>。</p><h1 id="6fb4" class="li lj iq bd lk ll nt ln lo lp nu lr ls lt nv lv lw lx nw lz ma mb nx md me mf bi translated">想了解更多？</h1><p id="e72b" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">如果您想了解更多信息，请<a class="ae km" href="https://ms.portal.azure.com/#create/confluentinc.confluent-cloud-azure-prod/preview" rel="noopener ugc nofollow" target="_blank">通过Azure Marketplace开始使用融合云上的Apache Kafka</a>并<a class="ae km" href="https://docs.microsoft.com/en-us/azure/partner-solutions/apache-kafka-confluent-cloud/overview" rel="noopener ugc nofollow" target="_blank">跟随快速入门</a>。注册后，前三个月你将每月获得200美元的免费使用权。使用促销代码<code class="fe np nq nr ns b">CL60BLOG</code>额外获得60美元的免费使用权。<a class="ae km" href="https://www.confluent.io/confluent-cloud-promo-disclaimer/" rel="noopener ugc nofollow" target="_blank"> * </a></p><p id="6f49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://ms.portal.azure.com/#create/confluentinc.confluent-cloud-azure-prod/preview" rel="noopener ugc nofollow" target="_blank">开始使用</a></p><p id="bb33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> Ramya Oruganti是微软的高级产品经理。她在Azure开发者体验团队工作，专注于构建Azure和融合云之间的集成服务。她已经在云和数据领域工作了十多年。从工程到解决方案架构，Ramya在IBM、Oracle以及现在的微软等组织中担任职务，对于云产品有着丰富的实践经验。</em></p><p id="6ed5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Abhishek Gupta是微软的一名高级开发人员，他帮助开发人员在Azure平台上取得成功。他的主要关注领域包括卡夫卡、数据库和Kubernetes。Abhishek也是一个开源贡献者和融合的社区催化剂。此前，作为一名产品经理，他帮助构建和倡导以开发者为中心的PaaS产品。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="0a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">原载于2021年3月25日</em><a class="ae km" href="https://www.confluent.io/blog/real-time-search-and-analytics-with-confluent-cloud-azure-redis-spring-cloud" rel="noopener ugc nofollow" target="_blank"><em class="kl">https://www . confluent . io</em></a><em class="kl">。</em></p></div></div>    
</body>
</html>