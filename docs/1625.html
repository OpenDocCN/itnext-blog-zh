<html>
<head>
<title>Understanding Swift Optional Via ? And ! Operator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解Swift可选Via？还有！操作员</h1>
<blockquote>原文：<a href="https://itnext.io/understanding-swift-optionals-via-and-operator-4055333e59f?source=collection_archive---------0-----------------------#2018-12-14">https://itnext.io/understanding-swift-optionals-via-and-operator-4055333e59f?source=collection_archive---------0-----------------------#2018-12-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="578c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">初学者概述；专业版快速参考。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/36ebc041df93e03275a3072c75244633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LoVCoRxQBamxz5xRTYaXeA.jpeg"/></div></div></figure><p id="8c95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">【swiftsenpai.com】<em class="ln">更新注</em>  <em class="ln">:本文更新版本已发布至</em><a class="ae lo" href="https://swiftsenpai.com/swift/making-sense-of-swift-operators/" rel="noopener ugc nofollow" target="_blank"><em class="ln"/></a><em class="ln">。</em></p><p id="307b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在选择Swift时，挑战之一是了解可选方案的工作方式。新学习者在处理可选项目时，通常会弄不清是应该使用<code class="fe lp lq lr ls b">?</code>还是<code class="fe lp lq lr ls b">!</code>。</p><p id="de19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我将通过探索<code class="fe lp lq lr ls b">?</code>和<code class="fe lp lq lr ls b">!</code>操作符的用法来帮助您理解optional背后的概念。如果您是Swift的初学者，这篇文章应该能让您很好地了解optional是如何工作的。</p><p id="1e3f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于有经验的Swift开发人员来说，当您在处理可选操作员时有疑问时，可以将此作为快速参考。</p><p id="08e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">话虽如此，我们还是开始吧！🚀</p><h1 id="5da0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">申报</h1><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="bc11" class="mp lu iq ls b gy mq mr l ms mt">var myVariable: MyType</span></pre><ul class=""><li id="fd03" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">声明<code class="fe lp lq lr ls b">myVariable</code>为非可选类型<code class="fe lp lq lr ls b">MyType</code>。</li><li id="f9e2" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated"><code class="fe lp lq lr ls b">myVariable</code>不会是<code class="fe lp lq lr ls b">nil</code>的整个生命周期。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="5483" class="mp lu iq ls b gy mq mr l ms mt">var myVariable: MyType<strong class="ls ir">?</strong></span></pre><ul class=""><li id="eecc" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">将<code class="fe lp lq lr ls b">myVariable</code>声明为可选<code class="fe lp lq lr ls b">MyType</code>。</li><li id="67ac" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated"><code class="fe lp lq lr ls b">myVariable</code>可以是<code class="fe lp lq lr ls b">nil</code>在其生命周期的某个点。</li><li id="384d" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">通过使用可选绑定或强制解包，只能访问<strong class="kt ir">的<code class="fe lp lq lr ls b">myVariable</code>值。<em class="ln">(继续阅读关于可选绑定和强制解包的更多信息)</em></strong></li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="9b60" class="mp lu iq ls b gy mq mr l ms mt">var myVariable: MyType<strong class="ls ir">!</strong></span></pre><ul class=""><li id="161f" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">将<code class="fe lp lq lr ls b">myVariable</code>声明为隐式展开的可选<code class="fe lp lq lr ls b">MyType</code>。</li><li id="8b1f" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated"><code class="fe lp lq lr ls b">myVariable</code>可以是<code class="fe lp lq lr ls b">nil</code>在其生命周期的某个点。</li><li id="cfa6" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">使用可选绑定，有或没有都可以访问<code class="fe lp lq lr ls b">myVariable</code>的值。</li><li id="5cf8" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">如果<code class="fe lp lq lr ls b">myVariable</code>为<code class="fe lp lq lr ls b">nil</code>并且是在没有使用可选绑定的情况下被访问，<strong class="kt ir">运行时错误</strong> <strong class="kt ir">将触发</strong>。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h2 id="ef4d" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">重要注意事项</h2><ul class=""><li id="242a" class="mu mv iq kt b ku oa kx ob la oc le od li oe lm mz na nb nc bi translated">始终将变量声明为非可选类型。</li><li id="d476" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">仅当您不能在变量的类或结构初始化期间初始化变量时，使用可选类型，和/或它可能在初始化后的某个时间点变成<code class="fe lp lq lr ls b">nil</code>。</li><li id="fa5c" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">尽量避免使用隐式展开的可选类型，因为这可能会导致运行时错误<strong class="kt ir"/>。仅当我们无法在变量的类或结构初始化期间初始化变量，但我们确信变量在初始化后的整个生命周期内不会被初始化时，才使用隐式展开的可选类型。隐式展开可选类型的最好例子是为视图控制器创建的IBOutlets。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="e4a5" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">打开</h1><p id="b3cb" class="pw-post-body-paragraph kr ks iq kt b ku oa jr kw kx ob ju kz la ok lc ld le ol lg lh li om lk ll lm ij bi translated">在这里，我们将研究访问可选类型值的基本概念和方法，主要是可选绑定和强制解包。</p><h2 id="a68b" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">可选绑定</h2><ul class=""><li id="9356" class="mu mv iq kt b ku oa kx ob la oc le od li oe lm mz na nb nc bi translated">当试图访问带有<code class="fe lp lq lr ls b">nil</code>值可选变量时，代码将正常失败，不会触发运行时错误。</li><li id="1023" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">下面的代码片段演示了可选绑定是如何工作的。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">可选绑定</figcaption></figure><ul class=""><li id="f9b3" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">请注意，可选绑定也可以用于隐式取消包装的可选类型。然而，这是相当罕见的，相当多余的。</li></ul><h2 id="4c7f" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">强制展开</h2><ul class=""><li id="a2f9" class="mu mv iq kt b ku oa kx ob la oc le od li oe lm mz na nb nc bi translated">使用<code class="fe lp lq lr ls b">!</code>运算符强制访问可选类型的值。</li><li id="7fff" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">当可选变量为<code class="fe lp lq lr ls b">nil</code>时，将触发<strong class="kt ir">运行时错误</strong>。</li><li id="3a3e" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">下面是如何使用<code class="fe lp lq lr ls b">!</code>操作符来强制展开一个可选变量。</li></ul><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="06ae" class="mp lu iq ls b gy mq mr l ms mt">let myString: String? = “test”<br/>let value = myString<strong class="ls ir">!</strong> // Forced unwrapping</span></pre><h2 id="5042" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">重要注意事项</h2><ul class=""><li id="ff7f" class="mu mv iq kt b ku oa kx ob la oc le od li oe lm mz na nb nc bi translated">与强制解包相比，可选绑定是一种更优雅的解包可选变量的方式，总是使用可选绑定来解包可选值。</li><li id="ed9a" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">强制解包使用起来很危险，如果可能的话尽量避免使用。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="84f8" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">向下铸造</h1><p id="8f2b" class="pw-post-body-paragraph kr ks iq kt b ku oa jr kw kx ob ju kz la ok lc ld le ol lg lh li om lk ll lm ij bi translated">在Swift中处理向下转换时，<code class="fe lp lq lr ls b">?</code>和<code class="fe lp lq lr ls b">!</code>操作符都非常重要。然而，开发人员有时可能会搞不清楚在执行向下转换时，他或她应该使用<code class="fe lp lq lr ls b">as</code>、<code class="fe lp lq lr ls b">as!</code>还是<code class="fe lp lq lr ls b">as?</code>。</p><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="97e6" class="mp lu iq ls b gy mq mr l ms mt">as</span></pre><ul class=""><li id="d7b4" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated"><code class="fe lp lq lr ls b">as</code>当编译器保证强制转换成功时，运算符用于将一种类型转换为另一种类型。</li><li id="020a" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">常见的用例是从<code class="fe lp lq lr ls b">String</code>到<code class="fe lp lq lr ls b">NSString</code>、<code class="fe lp lq lr ls b">NSDate</code>到<code class="fe lp lq lr ls b">Date</code>的造型，或者将对象造型回其父类类型。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="f54e" class="mp lu iq ls b gy mq mr l ms mt">as?</span></pre><ul class=""><li id="65e4" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated">当铸造操作可能失败时，使用<code class="fe lp lq lr ls b">as?</code>操作符。我们称之为条件强制转换。</li><li id="5d30" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">条件强制转换将产生所需类型的可选形式。</li><li id="f2f8" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">强制转换操作失败时返回<code class="fe lp lq lr ls b">nil</code>。</li><li id="2b97" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">由于转换结果是可选类型，我们可以使用可选绑定来访问转换结果的值。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><pre class="kg kh ki kj gt ml ls mm mn aw mo bi"><span id="87a5" class="mp lu iq ls b gy mq mr l ms mt">as!</span></pre><ul class=""><li id="7dac" class="mu mv iq kt b ku kv kx ky la mw le mx li my lm mz na nb nc bi translated"><code class="fe lp lq lr ls b">as!</code>是强制强制转换运算符。</li><li id="52a5" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">强制转换将生成所需类型的非可选形式。</li><li id="6ccc" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">当cast操作失败时，<strong class="kt ir">运行时错误</strong>将被触发。</li><li id="d3e4" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">由于转换结果是非可选类型，我们可以在不使用可选绑定的情况下访问转换结果值。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="1690" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你发现上面的解释有点难以理解。让我们看看下面的代码片段，它演示了如何使用每个<code class="fe lp lq lr ls b">as</code>操作符执行向下转换，以及每种情况下的结果是什么，这应该会让你明白一些事情…</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">向下投射演示</figcaption></figure><p id="850e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请随意将上面的代码复制到您的Xcode playground中，并亲自尝试一下。</p><h2 id="6dcf" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">向下转换为可选类型</h2><p id="9a5b" class="pw-post-body-paragraph kr ks iq kt b ku oa jr kw kx ob ju kz la ok lc ld le ol lg lh li om lk ll lm ij bi translated">基于上面讨论，我们可以通过尝试向下转换到可选类型来探索更多。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">向下转换为可选类型</figcaption></figure><p id="c03b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不要被每个造型末尾的<code class="fe lp lq lr ls b">?</code>和<code class="fe lp lq lr ls b">!</code>符号弄糊涂了，如果你仔细观察，它们都有与前面例子相同的行为，即使期望的造型类型是可选类型。</p><p id="1639" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，向下转换为隐式取消包装的可选类型已被否决，并将在未来的版本中被移除。这确实有意义，因为向下转换为隐式展开的可选类型与向下转换为可选类型是一样的，它们都产生相同的结果。<em class="ln">(可以查看</em><code class="fe lp lq lr ls b"><em class="ln">chicken4</em></code><em class="ln"/><code class="fe lp lq lr ls b"><em class="ln">chicken5</em></code><em class="ln"/><code class="fe lp lq lr ls b"><em class="ln">chicken8</em></code><em class="ln"/><code class="fe lp lq lr ls b"><em class="ln">chicken9</em></code><em class="ln">)</em></p><h2 id="e03f" class="mp lu iq bd lv np nq dn lz nr ns dp md la nt nu mf le nv nw mh li nx ny mj nz bi translated">重要注意事项</h2><ul class=""><li id="a3a6" class="mu mv iq kt b ku oa kx ob la oc le od li oe lm mz na nb nc bi translated">总是使用可选绑定来检查条件转换结果。</li><li id="002d" class="mu mv iq kt b ku nd kx ne la nf le ng li nh lm mz na nb nc bi translated">避免使用可能触发<strong class="kt ir">运行时错误</strong>的强制绑定。</li></ul></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><h1 id="9bbd" class="lt lu iq bd lv lw of ly lz ma og mc md jw oh jx mf jz oi ka mh kc oj kd mj mk bi translated">初始化</h1><p id="d57c" class="pw-post-body-paragraph kr ks iq kt b ku oa jr kw kx ob ju kz la ok lc ld le ol lg lh li om lk ll lm ij bi translated">接下来，我们将研究故障初始化器。当对象初始化可能失败时，我们需要一个失败的初始化器。如果初始化失败，可失败的初始化器将返回<code class="fe lp lq lr ls b">nil</code>。我们使用<code class="fe lp lq lr ls b">?</code>操作符将初始化器标记为故障。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="on oo l"/></div></figure></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="5f6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这篇文章能帮助你更清楚地了解如何以及何时使用<code class="fe lp lq lr ls b">?</code>和<code class="fe lp lq lr ls b">!</code>操作符。如果你有任何意见或问题，请写在下面的评论区。请随意点击👏按钮或分享这篇文章如果你喜欢它。</p><p id="4f5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你想在以后读到更多这样的文章，请在<strong class="kt ir">媒体</strong>或<a class="ae lo" href="https://twitter.com/Lee_Kah_Seng" rel="noopener ugc nofollow" target="_blank">推特 </a>上关注我。</p><p id="3d8f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有兴趣的，下面是我的<a class="ae lo" href="https://www.linkedin.com/in/lee-kah-seng-55720645/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> LinkedIn </strong> </a> <strong class="kt ir"> </strong>和<strong class="kt ir"/><a class="ae lo" href="https://github.com/LeeKahSeng" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir">Github</strong></a><strong class="kt ir">。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/ac1700eaa9da7ccdc090ca65d354f4aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SBI7x5xTXLapLNke1bXKhw.jpeg"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><a class="ae lo" href="http://kahseng.lee123@gmail.com" rel="noopener ugc nofollow" target="_blank">kahseng.lee123@gmail.com</a></figcaption></figure></div></div>    
</body>
</html>