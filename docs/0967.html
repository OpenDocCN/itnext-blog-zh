<html>
<head>
<title>Hidden methods and data in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中隐藏的方法和数据</h1>
<blockquote>原文：<a href="https://itnext.io/controlling-access-to-data-in-javascript-903e80213168?source=collection_archive---------6-----------------------#2018-06-25">https://itnext.io/controlling-access-to-data-in-javascript-903e80213168?source=collection_archive---------6-----------------------#2018-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/3a09301af2266fcac42e0d9ad25f1470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SH25vme7rcZp9HecL-DboA.jpeg"/></div></div></figure><div class=""/><p id="4e9e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于阻止访问我们代码中的某些方法以及为什么这是一件好事的咆哮。</p><h1 id="9b73" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h1><p id="4b65" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">如果你曾经编写过一个软件，打算供其他开发人员共享和使用，那么你可能已经有了一些内部功能或数据，这些功能或数据是代码运行所必需的，但不应该被其他人直接访问、修改或使用。</p><p id="c27e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想要限制函数或变量的可见性或可访问性的主要原因是，我们想要为能够重构该功能敞开大门。举下面这个过于简化的例子:</p><p id="5a17" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您编写了一个JavaScript库，它监听用户按键并跟踪最后一次按下的键，以便考虑修饰符和特殊行为。您保留了一个内部变量<code class="fe lz ma mb mc b">_lastKeyDown</code>，它保存了触发<code class="fe lz ma mb mc b">keydown</code>事件的最后一个键的键码。你甚至用一个前导下划线来命名它，以此来提醒人们不要使用它，甚至在它旁边添加了一个注释，要求他们不要使用它。</p><p id="a4e3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果人们开始依赖代码中的内部变量，而你后来决定通过查看<code class="fe lz ma mb mc b">keyup</code>事件来处理关键事件会更好，你会发现重构代码很可能会破坏用户的代码！现在你剩下的要么是不可重构的代码，糟糕命名的变量/函数，要么破坏你亲爱的用户的集成。这可能会令人沮丧！</p><blockquote class="md"><p id="152e" class="me mf jb bd mg mh mi mj mk ml mm kv dk translated">如果他们访问了不该访问的内容，这不是我的错！都怪无视我规则的用户！</p></blockquote><p id="23b9" class="pw-post-body-paragraph jy jz jb ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">良好的..是和<strong class="ka jc">否</strong>。</p><p id="bf73" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为软件的作者，你必须记住，用户将你的软件集成到他们的软件中，会以对他们来说最方便或最容易的方式进行。如果你公开了一个功能或数据，并且对他们来说很方便，你不能期望他们不使用它。</p><p id="4bdd" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以记录限制，但是如果限制存在，并且他们需要它，他们就会访问它。</p><h1 id="cb64" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">一个解决方案</h1><p id="8c12" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">你能做的是用某种方式包装你的功能，防止他们访问它，而你自己的代码不会失去对那些私有部分的访问。我们可以用几种不同的方式做到这一点，但就个人而言，我喜欢创建一个限制封装我们所有功能和数据的块，然后返回一个公共API供用户集成和访问。</p><p id="e256" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用一个更简单的片段来说明这一点</p><pre class="mt mu mv mw gt mx mc my mz aw na bi"><span id="9ddd" class="nb kx jb mc b gy nc nd l ne nf">let myFantasticJSLibrary = (function internalName(){<br/>    var myPrivateVar = 42;<br/>    <br/>    return {<br/>        myPublicMethod : function() { return myPrivateVar; }<br/>    }<br/>})();</span></pre><p id="900b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意当访问<code class="fe lz ma mb mc b">myFantasticJSLibrary</code>时，用户不知道<code class="fe lz ma mb mc b">myPrivateVar</code>的存在，但会看到<code class="fe lz ma mb mc b">myPublicMethod</code>。这允许我们在未来的版本中保持对私有部分的控制，以实现无痛苦的重构。我们并不试图掩盖我们正在做的事情，我们试图阻止用户依赖明天就会消失的东西。</p><p id="3ab1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，任何可以接触到源代码的人都可以看到它的存在，并可以修改它，但这是一个完全不同的问题。他们修改了我们的软件，维护或解决这样做可能产生的问题不是我们的问题。</p><p id="69a3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总之，任何没有直接包含在返回对象中的东西对于集成开发人员来说都是不可见的。然而，由于javascript的封闭性，我们自己返回的对象可以访问<code class="fe lz ma mb mc b">internalName</code>中引用的任何内容。这是JavaScript中一个非常强大但经常被忽视的行为。</p></div></div>    
</body>
</html>