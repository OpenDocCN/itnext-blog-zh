<html>
<head>
<title>Multi-tenant Rancher Kubernetes cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多租户牧场主Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/multi-tenant-rancher-kubernetes-cluster-dbac3d739b1c?source=collection_archive---------3-----------------------#2020-05-17">https://itnext.io/multi-tenant-rancher-kubernetes-cluster-dbac3d739b1c?source=collection_archive---------3-----------------------#2020-05-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a931" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">探索如何扩展Rancher项目网络隔离以构建安全的多租户Kubernetes集群</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0462586b06c287e0b3b46370f7322004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k33oHXWC9x0hhTzySSvp2w.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/photos/KZa4fREZoKk" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/KZa4fREZoKk</a></figcaption></figure><p id="51b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们探索使用牧场主、牧场主项目和项目网络隔离来创建多租户Kubernetes集群的想法。</p><p id="18b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">我们将调查一些安全和使用问题</strong>。</p><p id="f3d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想创建一个多租户Kubernetes集群，或者只是想获得更多关于Kubernetes安全性的知识，您可能会感兴趣。</p><h2 id="0b0c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">问题</h2><p id="198b" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们能否创建一个(大型)Kubernetes集群，并在不同的用户甚至不同的组织之间共享？当我们这样做时，我们希望用户之间有某种程度的隔离。如果用户来自同一家公司的不同部门，那么与来自不同公司的用户相比，隔离可能不那么严格。</p><h2 id="e7e5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="b2ab" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这是可能的，但需要很大的努力。根据用例，维护多个Kubernetes集群可能更好。</p><h1 id="b3f9" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">先决条件</h1><h2 id="e42a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">库伯内特斯</h2><p id="f922" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">你应该知道Kubernetes是什么:)</p><h2 id="6cc5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">服务</h2><p id="bcd8" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">你应该了解<a class="ae ky" href="https://medium.com/swlh/kubernetes-services-simply-visually-explained-2d84e58d70e5?source=friends_link&amp;sk=49a5e832662a689111a6087e1fe1232a" rel="noopener"> Kubernetes服务</a>。</p><h2 id="a10b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">服务DNS名称解析</h2><p id="47b2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一个Kubernetes集群通常包含一个DNS服务器，它允许通过服务名称联系服务，而不是直接使用IP。因为服务属于某个特定的名称空间，所以不同名称空间中的两个服务可能具有相同的名称。</p><p id="bb68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与服务在同一名称空间中的资源可以简单地使用服务名通过DNS检索IP。不同名称空间中的资源作为服务也需要以格式<code class="fe ne nf ng nh b">&lt;service-name&gt;.&lt;namespace&gt;</code>指定名称空间。</p><h2 id="fa6c" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">网络策略</h2><p id="20d2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">网络策略资源可以与防火墙规则相比较，防火墙规则允许或拒绝对某些pod或来自某些pod的访问。也可以控制对整个名称空间或IP地址CIDRs的访问。</p><blockquote class="ni nj nk"><p id="b1c7" class="kz la nl lb b lc ld ju le lf lg jx lh nm lj lk ll nn ln lo lp no lr ls lt lu im bi translated">网络策略是一种规范，规定了允许多组pod如何相互通信以及如何与其他网络端点通信。网络策略资源使用标签来选择pod和dene规则，这些规则指定允许哪些trac访问选定的pod。(<a class="ae ky" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></blockquote><h1 id="3bc3" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">大牧场主</h1><blockquote class="ni nj nk"><p id="0064" class="kz la nl lb b lc ld ju le lf lg jx lh nm lj lk ll nn ln lo lp no lr ls lt lu im bi translated">Rancher是为采用容器的团队提供的一个完整的软件栈。它解决了跨任何基础设施管理多个Kubernetes集群的运营和安全挑战，同时为DevOps团队提供了运行容器化工作负载的集成工具(<a class="ae ky" href="https://rancher.com/what-is-rancher/overview" rel="noopener ugc nofollow" target="_blank"> source </a>)</p></blockquote><p id="444d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它提供了一个web界面和一个REST API，用户可以通过它来管理可访问的资源。一方面，Rancher允许跨各种云提供商和自托管连接创建和管理多个Kubernetes集群。它为所有集群提供集中的身份验证和访问控制。</p><p id="b023" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另一方面，它提供了对单个Kubernetes集群的扩展管理，例如，提供了将名称空间捆绑到Rancher项目中的能力。</p><h2 id="ab84" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">项目</h2><p id="e11c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Rancher项目是在Kubernetes名称空间之上构建的。一个集群包含多个项目，一个项目可以包含多个命名空间，一个命名空间最多可以属于一个项目。</p><p id="b287" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rancher项目允许将规则(如资源配额)应用于项目中的所有名称空间，只需在项目级别进行一次必要的配置。仅使用Kubernetes，大多数规则定义不能应用于许多名称空间，并且需要多次创建。</p><blockquote class="ni nj nk"><p id="e543" class="kz la nl lb b lc ld ju le lf lg jx lh nm lj lk ll nn ln lo lp no lr ls lt lu im bi translated">一个[Rancher]项目是一个集群中的一组多个名称空间和访问控制策略。项目是由Rancher引入的概念，而不是Kubernetes，它允许您将多个名称空间作为一个组进行管理，并在其中执行Kubernetes操作。(<a class="ae ky" href="https://rancher.com/docs/rancher/v2.x/en/cluster-admin/projects-and-namespaces/" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><h2 id="6b7b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">项目网络隔离</h2><p id="c5a5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">牧场主项目网络隔离限制了项目之间的通信。它是在Kubernetes网络策略资源的基础上实现的，在network policy一节中有描述。因此所使用的CNI必须实现网络策略的使用，这里选择<a class="ae ky" href="https://kubernetes.io/docs/concepts/cluster-administration/networking/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5932" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每当在一个项目中创建一个名称空间时，Rancher都会给它分配带有project-ID的Kubernetes标签。基于这些标签，Rancher实现了网络策略，该策略只允许该名称空间的pod拥有来自属于同一项目的名称空间的pod的传入连接。</p><h1 id="ca1b" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">多租户集群</h1><blockquote class="ni nj nk"><p id="36aa" class="kz la nl lb b lc ld ju le lf lg jx lh nm lj lk ll nn ln lo lp no lr ls lt lu im bi translated">多租户集群由多个用户和/或工作负载共享，这些用户和/或工作负载称为租户。多租户集群的操作员必须将租户相互隔离，以最大限度地减少受损或恶意租户对集群和其他租户造成的损害。(<a class="ae ky" href="https://cloud.google.com/kubernetes-engine/docs/concepts/multitenancy-overview" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></blockquote><p id="ca74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行多个用户一起使用的多租户集群的优势在于共享资源，从而节省CPU或内存等资源。也可以在一个中心位置向所有租户提供服务，比如NFS储物。</p><p id="b06a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主要的挑战是在安全性和可用性之间找到一个好的平衡。不同组织的用户应该相互隔离，尽管使用集群环境的体验不应该与拥有完全访问权限有太大区别。</p><p id="11e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Rancher通过实施(隔离的)项目来提供Kubernetes的扩展管理。使用Rancher项目作为不同团队或组织的代表，允许每个团队或组织控制多个名称空间。</p><h1 id="4079" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">安全考虑</h1><p id="3389" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">应该注意的是，这个列表可能不完整。欢迎评论补充或讨论。</p><h2 id="23b1" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">可以停用项目网络隔离</h2><p id="0b0a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">网络策略资源是在命名空间中创建的，并且可以由有权访问该命名空间所属的Rancher项目的用户删除。通过这种方式，用户可以取消他/她的项目的隔离，并允许其他项目的pod与其项目中的pod进行通信。</p><p id="8fbc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可以通过利用RBAC(基于角色的访问控制)实现特定的Kubernetes角色来限制。</p><h2 id="21f4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">节点端口和负载平衡器服务打破了隔离</h2><p id="ef57" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了确保正确的项目隔离，需要禁止NodePort和LoadBalancer类型的服务。这是因为两种服务类型都在每个Kubernetes节点的外部和内部IP地址上打开一个TCP端口。一个项目中的pod可以连接到节点的IP地址，并与创建服务的另一个项目中的pod通信。</p><p id="1405" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">牧场主项目隔离的目的只是为了控制豆荚间的直接接触。一旦用户使用服务暴露了pod，Rancher项目网络隔离不会提供保护(<a class="ae ky" href="https://github.com/rancher/rancher/issues/15250" rel="noopener ugc nofollow" target="_blank">来源</a>)。</p><p id="d770" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这些服务也需要被禁止，因为在相同或不同的项目中，没有两个服务可以打开同一个节点端口。这将在创建过程中导致Kubernetes错误，因此是一个跨项目关联。可以使用Kubernetes资源配额禁止NodePort和LoadBalancer服务类型。</p><h2 id="3f53" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">优先</h2><p id="4b91" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">可以通过分配优先级来区分pod的优先级。通过优先级，Kubernetes规定当可用集群资源不足时，哪些pod被调度，哪些被终止[ <a class="ae ky" href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/" rel="noopener ugc nofollow" target="_blank">来源</a> ]。但是因为Kubernetes优先级类资源是全局的，没有绑定到名称空间，所以访问特定项目的Rancher用户没有创建新项目的权限。</p><p id="2d67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，系统内部优先级类system-cluster-critical和system-node-critical只能分配给Kubernetes内部名称空间中的pod。考虑到这一点，不应该有用户使用优先级来强制其他项目的pod终止的可能性。</p><h2 id="5c9f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">强力集群信息收集</h2><p id="9177" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">蛮力是尝试各种不同组合的过程，希望最终猜对。</p><p id="a8b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因为名称空间需要在Rancher项目中是唯一的，所以用户可以通过尝试创建具有不同名称的名称空间来找出其他项目的名称空间名称。如果Kubernetes API或kubectl返回一个错误，说名称空间已经存在，那么用户知道它的存在。</p><p id="106c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这个过程，用户可以找出所有项目中所有可用命名空间的所有名称。Kubernetes DNS在“服务DNS名称解析”一节中进行了描述，它适用于整个集群。每个Kubernetes服务都可以通过一个IP地址和一个DNS名称到达。一旦用户获得了关于集群中现有名称空间的信息，他们就可以通过使用强力方法找出所有的服务名称。</p><p id="a617" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用户仍然不能连接到另一个项目的pod，但是用户将能够找到在特定名称空间中运行的服务的名称。没有解决方案可以防止使用Kubernetes默认资源进行强力名称空间或服务DNS名称检查，但这可以通过异常检测来识别。</p><p id="9131" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">保护DNS解析的一个解决方案可能是利用纤毛作为CNI:</p><blockquote class="ni nj nk"><p id="aa91" class="kz la nl lb b lc ld ju le lf lg jx lh nm lj lk ll nn ln lo lp no lr ls lt lu im bi translated">Cilium 1.4扩展了现有的DNS安全策略模型，可以识别各个pod发出的DNS请求以及它们收到的DNS响应。(<a class="ae ky" href="https://cilium.io/blog/2019/02/12/cilium-14/" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></blockquote><h2 id="744a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">Pod安全策略</h2><p id="7757" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Rancher提供了两种默认的pod安全策略，受限和无限制。无限制对集群中部署的pod没有限制。另一方面，Restricted被描述为“显著限制可以部署到集群或项目的pod类型”<a class="ae ky" href="https://rancher.com/docs/rancher/v2.x/en/admin-settings/pod-security-policies" rel="noopener ugc nofollow" target="_blank">来源</a>，例如“防止pod作为特权用户运行，并防止特权升级。”【<a class="ae ky" href="https://rancher.com/docs/rancher/v2.x/en/admin-settings/pod-security-policies" rel="noopener ugc nofollow" target="_blank">来源</a>】。</p><p id="43d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这意味着牧场主项目应该要么有受限的默认pod安全策略，要么分配一个更严格的自定义策略。</p><h2 id="baf5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">读取其他项目中容器的日志</h2><p id="f832" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">用户可以创建一个pod，甚至可以设置一个守护进程在每个节点上创建一个pod，它使用host path provider[<a class="ae ky" href="https://v1-15.docs.kubernetes.io/docs/concepts/storage/volumes/" rel="noopener ugc nofollow" target="_blank">source</a>]挂载它所调度的节点的本地文件夹。</p><p id="cbf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果一个pod挂载了该节点的文件夹<code class="fe ne nf ng nh b">/var/lib/docker</code>，它就可以访问该节点上运行的所有容器的docker日志。这提供了跨项目的信息交换。应该可以使用pod安全策略和AllowedHostPaths选项，或者通过完全禁止卷类型hostpath[<a class="ae ky" href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/" rel="noopener ugc nofollow" target="_blank">源</a> ]来对此进行限制。这种用户行为也可以使用异常检测来识别。</p><h2 id="57e3" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">异常检测</h2><p id="66ac" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">异常检测，或异常值检测，“旨在识别数据库中不寻常的对象，即不同于大多数数据，因此由污染、错误或欺诈导致的可疑对象”[Zimek A .，Schubert E. (2017)异常值检测。载于:刘主编的《数据库系统百科全书》。纽约州纽约市斯普林格】。</p><p id="4b55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Kubernetes中，可以使用审计来实现，审计“提供了一组与安全相关的按时间顺序排列的记录，记录了个人用户、管理员或系统的其他组件影响系统的一系列活动”。</p><p id="4fe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Falco是一个开源应用程序，它利用Kubernetes审计，并为常见情况提供预先配置的规则，如集群内资源的权限提升尝试[ <a class="ae ky" href="https://v1-15.docs.kubernetes.io/docs/tasks/debug-application-cluster/falco/" rel="noopener ugc nofollow" target="_blank"> source </a> ]。</p><h1 id="cad1" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">使用注意事项</h1><p id="930e" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">本节列出了在运行共享的Rancher Kubernetes集群时，在使用和管理体验方面需要考虑的几点。</p><h2 id="0e43" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">名称空间</h2><p id="3eb4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">名称空间需要在Rancher项目中是唯一的，这意味着没有两个项目可以包含同名的名称空间。Rancher不提供配置自动命名空间名称前缀的能力，例如项目名称。</p><p id="7725" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现有的Kubernetes应用程序通常将资源安装在以应用程序命名的名称空间中，比如包含MySQL数据库的名称空间<code class="fe ne nf ng nh b">mysql</code>。这意味着两个用户将无法一步一步地遵循相同的安装说明，而是必须调整他们的名称空间名称。这可以通过向用户传达强制使用名称空间前缀的规则来解决。</p><p id="7cc8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当用户使用kubectl或Kubernetes API创建名称空间时，它不会被分配给项目。它处于浮动状态，只能由管理员分配给项目。这意味着用户只需使用Rancher web界面创建名称空间。在线分步安装指南通常会使用kubectl来创建必要的名称空间。使用de时，不可能完全遵循说明。NBI共享集群。</p><h2 id="20c9" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">不常见的用法</h2><p id="c766" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">与完全集群访问相比，使用kubectl或Kubernetes API会有所不同。用户不能查询他/她有权访问的所有可用名称空间。这只有使用web界面或Rancher API才有可能。</p><p id="6aa1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现有的Kubernetes应用程序或Helm charts可能无法开箱即用，因为它们使用节点端口或负载平衡器服务。用户需要将它们转换成ClusterIP类型的服务。</p><p id="e906" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">牧场主集群需要所有的pod来定义资源限制。这导致用户不得不为他们或现有的Kubernetes应用程序创建的每个pod取消资源限制。这在完全访问集群中是不需要的。尽管Rancher允许为某个项目中创建的每个容器定义默认资源限制。</p><h2 id="008b" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">维护可能会影响许多用户</h2><p id="e0f0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Kubernetes集群维护可能需要关闭或重启特定的节点。如果某个节点的Kubernetes版本需要更新，首先要将其标记为不可用于安排任何pods。这将启动将该节点上运行的所有pod重新调度到其他节点。只有由其他资源(如部署)控制的单元可以重新计划。未经管理直接创建的pod无法自动重新创建[ <a class="ae ky" href="https://v1-15.docs.kubernetes.io/docs/tasks/administer-cluster/safely-drain-node/" rel="noopener ugc nofollow" target="_blank"> source </a> ]。</p><p id="1983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">必须考虑这一点，这意味着单个节点的维护可能会影响不同项目和组织的众多用户，因为所有用户在某种程度上都可能共享同一个节点。</p><h2 id="58bc" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">在共享环境中工作的知识</h2><p id="8df0" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在完成完全隔离之前，需要通知用户他们正在使用一个共享的Kubernetes环境，其中可能只应用了有限的隔离。</p><h1 id="ee01" class="mt lw it bd lx mu mv mw ma mx my mz md jz na ka mg kc nb kd mj kf nc kg mm nd bi translated">概述</h1><p id="faee" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">可以创建一个多租户Kubernetes集群(使用Rancher)，但是隔离很困难。根据不同的用例，创建和维护多个Kubernetes集群可能更容易，每个租户一个集群。Rancher允许并提供了以更简单的方式管理多个集群的工具。</p></div></div>    
</body>
</html>