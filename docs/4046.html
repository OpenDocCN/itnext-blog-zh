<html>
<head>
<title>Introducing List Comprehension for TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript列表理解简介</h1>
<blockquote>原文：<a href="https://itnext.io/introducing-list-comprehension-for-typescript-6204d9b1003e?source=collection_archive---------0-----------------------#2020-04-16">https://itnext.io/introducing-list-comprehension-for-typescript-6204d9b1003e?source=collection_archive---------0-----------------------#2020-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aae9ee68fa1f0728b4e9bf616e9858b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJLV1Bc0pKLyRz6Xph5Fjg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@chrisliverani?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae kc" href="https://unsplash.com/s/photos/math-notation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="bf62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">列表理解是数学中的一种方法，以一种非常简洁优雅的方式描述一组值。这种符号已经被许多语言实现，主要用于在一个表达式中构造和填充一个列表，而不是用大量的循环和if语句填充一个空列表。由于它与数学和基于表达式的自然列表理解的联系，它在函数式编程中工作得非常好。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Haskell中列表理解的一个例子</figcaption></figure><p id="3244" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，像Haskell和F#这样的语言提供了这种技术的丰富而完整的实现就不足为奇了，而且像Python和R这样受数据科学家欢迎的语言也提供了列表理解这一语言特性。这是因为它在编程数学公式时非常好用，例如基于矩阵或集合的数学公式。</p><h1 id="30a3" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">什么是列表理解？</h1><p id="0035" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">关于编程语言已经谈得够多了，什么是列表理解，它是如何工作的？List comprehension允许您用一个由三部分组成的表达式创建集合:输出表达式、输入集和过滤输入集的谓词。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Python中列表理解的一个例子</figcaption></figure><p id="a957" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的<code class="fe mk ml mm mn b">var * 2</code>是在列表中创建值的表达式。该表达式将用于输入列表中的每一项。但是这个列表会被if: <code class="fe mk ml mm mn b">var % 2 == 0</code>后面的表达式过滤掉。对于小列表，这可能看起来像一些语法糖，但是对于大的多维集合，这种符号将成为真正的救命稻草！列表理解不仅仅适用于列表，它还可以用于从键值对快速创建映射。</p><p id="9888" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但这并不是一切。随着花式集合语法也来了一个丰富的标准库，从范围，重复序列，字符，字符串，合并集合等创建集合。这两者的结合使得列表理解成为现代(函数式)编程语言中的一个强大工具。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在Haskell中创建填充列表的一些方法</figcaption></figure><p id="6fda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将带您浏览我为TypeScript创建的列表理解库。它允许您使用常规的TypeScript代码，同时仍然享受列表理解的所有优点。我将主要关注api在使用多个输入集创建多维集合时如何保证类型安全。结果将如下所示:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h1 id="6f0d" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">设计界面</h1><p id="3bec" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">我们将从设置<code class="fe mk ml mm mn b">array</code>函数的类型开始，该函数将执行实际的列表理解。为此，我将使用一个所谓的可调用接口，因为它们允许我们使用类型系统提供的所有功能相关的特性。对于列表理解表达式，我们需要三样东西:输入集、创建条目的函数和过滤输入条目的谓词。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="ec0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我改变了标准顺序，因为如果我们提供输入集合，那么第一个TypeScript可以使用它来推断<code class="fe mk ml mm mn b">out</code>函数的参数的泛型类型<code class="fe mk ml mm mn b">i</code>，它可以推断泛型<code class="fe mk ml mm mn b">o</code>。有了这个小小的改变，我们可以更容易地使用这个库，因为你不必显式地提供泛型类型参数。对于谓词，我使用了一个rest参数，因此我们可以定义任意数量的谓词(或者一个也不定义)。</p><h1 id="348f" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">使用多个输入源</h1><p id="3b6c" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">当用于多输入时，列表理解变得非常强大。如果我们想在我们的库中允许多个输入，我们必须在外部API的定义上有点创造性。我将使用我们的<code class="fe mk ml mm mn b">array</code>函数的重载来创建两个或更多输入的理解定义。在本文中，我将把所有的代码样本限制在三个输入，以保持它的简短，但是库达到了十个。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">我们函数的额外重载</figcaption></figure><p id="b80c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这些重载，你可以从给函数你想要的所有数据源开始，然后它就会知道<code class="fe mk ml mm mn b">out</code>和<code class="fe mk ml mm mn b">predicate</code>函数将要得到多少个参数。虽然这在类型推断方面很有意思，但是编写一个实现这个接口的函数有点麻烦。记住，TypeScript中的重载只存在于编译时！在运行时，我们只有一个实现需要执行运行时类型检查，以确定我们当前的重载。</p><p id="616a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了实现这一点，我决定将所有的参数作为一个非类型化的数组。在这个数组中，我们可以搜索函数的第一个索引。我们知道这是<code class="fe mk ml mm mn b">out</code>函数。基于这些信息，我们可以将<code class="fe mk ml mm mn b">args</code>数组分成一个带有输入的数组、<code class="fe mk ml mm mn b">out</code>函数和一个带有谓词的数组。这有点麻烦，但仍然完全节省，因为我们的接口保证了我们所做的最正确的假设。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图像必须弄清楚这个函数期望什么作为没有类型的参数…</figcaption></figure><p id="ab19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们如何将输入源组合成<code class="fe mk ml mm mn b">out</code>函数的参数集呢？有两种方法可以做到这一点:压缩输入或执行交叉连接。如果我们压缩输入，我们会将所有输入的第一项组合在一起，将所有数组的第二项组合在一起，依此类推。如果我们交叉连接，我们将第一个数组的所有元素与第二个数组的所有元素组合在一起，第一个数组的第二项与第二个数组的所有元素组合在一起，依此类推。所以交叉连接产生的线对比拉链多得多。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">zip与以[ 1，2，3 ]和[ 4，5，6 ]作为输入的交叉连接</figcaption></figure><p id="b94c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我决定使用交叉连接技术，因为它是列表理解中最常用的技术。与命令式编程相比，它的工作原理与嵌套for循环相同。如果您想使用zip技术，您可以使用库中的zip函数首先压缩输入，并将结果作为单个输入提供。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用于从数组的数组中创建交叉连接的代码，该代码遵循输入的顺序</figcaption></figure><h1 id="cb43" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">不仅仅是数组</h1><p id="c047" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">在这篇文章的开始，我已经提到了列表理解不仅仅局限于列表。在图书馆里也有集合和地图理解，以便于地图和集合的构建。映射理解与数组和集合理解有些不同，因为您的out函数必须返回将用于构造映射的键值对。这意味着重复的键会互相覆盖。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h1 id="4020" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">创建正确的输入</h1><p id="73a1" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">列表理解的可用性非常依赖于语言在创建所需输入集合时的灵活性。大多数内置了列表理解功能的语言还提供了生成范围、重复序列和其他可能的列表定义的详尽功能。</p><p id="1941" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些特性是图书馆提供的第二个东西。有许多函数可以创建可使用的填充数组。前两个是众所周知的范围和重复:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="df7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当谈到交叉连接和压缩之间的区别时，我保证有一个压缩函数，所以它在这里。这也是一个函数，它使用重载来确保元组的类型正确，并且TypeScript知道哪个索引具有哪个类型，而不是合并类型并使其成为单一类型的数组:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="9534" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个是字符范围。此函数使用带有字母表的映射，根据字符在字母表中的顺序创建字符范围:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="a9bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这些函数和正确的谓词，您可以充分利用列表理解在TypeScript中创建数组、映射和集合。</p><h1 id="31f4" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">实际例子</h1><p id="d3c9" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">最后，我会用两个实际的例子来告诉你如何在实践中运用列表理解。我将展示一个使用交叉连接技术的例子和一个使用zip技术的例子。两个例子都表明理解代码尊重输入的顺序是很重要的。</p><p id="0ee8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">比方说，我们想将一个标题列表按其开头字母分组，并按字母表中的位置排序。这可以用在一个<a class="ae kc" href="https://www.diakonessenhuis.nl/aandoeningen" rel="noopener ugc nofollow" target="_blank">概览页面上，以一种清晰的方式显示一个大的链接列表</a>。</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="bedd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建坐标矩阵是何时使用嵌套for循环的经典例子。但是通过list comprehension，可以使用range和zip函数以一种完全实用的方式来实现这一点:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h1 id="47dd" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="ed79" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">在本文中，我们探讨了什么是列表理解，以及如何在TypeScript中实现它。完整库的源代码可以在<a class="ae kc" href="https://github.com/WimJongeneel/ts-comprehension" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到，并在<a class="ae kc" href="https://www.npmjs.com/package/ts-list-comprehension" rel="noopener ugc nofollow" target="_blank"> npm </a>上发布。你认为list comprehension给TypeScript增加了一些新东西吗？或者你完全满意基于<code class="fe mk ml mm mn b">Array.from({ length: N }).map(x =&gt; ...)</code>的一切吗？</p></div></div>    
</body>
</html>