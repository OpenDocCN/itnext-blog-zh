<html>
<head>
<title>Create your first NFT Marketplace for selling cars in PHP Laravel and web3.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PHP Laravel和web3.js中创建第一个销售汽车的NFT市场</h1>
<blockquote>原文：<a href="https://itnext.io/create-your-first-nft-marketplace-for-selling-cars-in-php-laravel-and-web3-js-abcb3a027a1e?source=collection_archive---------1-----------------------#2021-09-16">https://itnext.io/create-your-first-nft-marketplace-for-selling-cars-in-php-laravel-and-web3-js-abcb3a027a1e?source=collection_archive---------1-----------------------#2021-09-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0531973f54cf7b59b7b0af86e2343fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ObJOmQP3DN1973bM.png"/></div></div></figure><p id="0f2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对加密感兴趣，那么你很可能听说过NFT，尤其是在发生了像<a class="ae kw" href="https://www.theverge.com/2021/3/11/22325054/beeple-christies-nft-sale-cost-everydays-69-million" rel="noopener ugc nofollow" target="_blank">比普尔以6900万美元</a>卖掉他的艺术品或者这个<a class="ae kw" href="https://www.dawn.com/news/1638372" rel="noopener ugc nofollow" target="_blank">友谊迷妹</a>这样的事件之后。</p><p id="312f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">人们通常认为NFT只适合绘画之类的艺术，但事实并非如此。NFT是独一无二的，权威的，所有权的转移。<strong class="ka ir"> <em class="kx">我们打算用NFT来卖车。</em> </strong></p><p id="ea52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将讨论如何铸造ERC721 NFT令牌，然后将它们与新的或现有的网站相结合。购买汽车的用户将支付购买汽车的金额和铸造费。我遇到了许多关于NFT或ERC721令牌的教程，但没有一个真正提供了端到端的解决方案。这非常令人沮丧，因为NFT本身什么都不是，除非它与一个应用程序集成在一起。在这篇文章中，我提出了一个用PHP Laravel和web3.js开发的虚构的汽车销售门户网站。正如我在之前的<a class="ae kw" href="http://blog.adnansiddiqi.me/build-your-first-solidity-dapp-with-web3-js-and-metamask/" rel="noopener ugc nofollow" target="_blank">文章</a>中所说，后端框架或语言并不重要。我将会以突出NFT功能及其集成的方式来编写本教程。如果你想知道为什么我使用PHP而不是Python，那么，<strong class="ka ir"> <em class="kx">这只是试图打破区块链编程完全基于Javascript技术的禁忌。</em>T13】</strong></p><h1 id="3ce9" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">什么是NFT？</h1><p id="6743" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">根据<a class="ae kw" href="https://en.wikipedia.org/wiki/Non-fungible_token" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="mb mc md"><p id="991a" class="jy jz kx ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated"><strong class="ka ir">不可替代令牌(NFT)是存储在称为区块链的数字分类账上的数据单位，它证明数字资产是唯一的，因此不可互换。</strong> [1] NFTs可用于表示照片、视频、音频和其他类型的数字文件。然而，对原始文件的任何副本的访问不限于NFT的买方。虽然任何人都可以获得这些数字项目的副本，但NFT在区块链上被跟踪，以向所有者提供独立于版权的所有权证明。</p></blockquote><p id="ce8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前NFT很受欢迎。虽然大多数NFT都是建立在以太坊基础上的区块链，但并不局限于此。区块链像索拉纳和许多其他人也在他们各自的平台上提供NFT。</p><p id="d697" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不打算讨论Laravel代码本身，因为这不是本文的范围，我也不打算通过web3.js讨论Truffle/Ganache和智能合约集成。你可以在这里阅读<a class="ae kw" href="http://blog.adnansiddiqi.me/tag/blockchain-programming/" rel="noopener ugc nofollow" target="_blank"/>。最终的网站将看起来如下(<em class="kx">请忽略蹩脚的前端，因为我更后端的家伙！</em>)</p><figure class="mh mi mj mk gt jr"><div class="bz fp l di"><div class="ml mm l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">dCars演示</figcaption></figure><h1 id="757a" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">网站开发</h1><p id="adfd" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">网站的后台是用Laravel开发的。MySQL已经被用来存储所有的数据，IPFS是一个分散的图像CDN。<a class="ae kw" href="https://www.pinata.cloud/" rel="noopener ugc nofollow" target="_blank"> Pinata Cloud </a>提供<em class="kx"> pinning </em>服务，实际上是用来上传IPFS上的所有图片。网站的流程非常简单。目前，dApps被认为本质上是混合的，也就是说，一些功能在区块链，尤其是支付功能，其余的信息在集中的系统中。用户注册并上传他想要出售的汽车的详细信息。图像通过Pinata API上传，用于固定。API返回一个散列，它和其他信息一起存储在MySQL数据库中。<code class="fe mr ms mt mu b">cars</code>表格结构如下图所示:</p><pre class="mh mi mj mk gt mv mu mw mx aw my bi"><span id="7c70" class="mz kz iq mu b gy na nb l nc nd">CREATE TABLE `cars` (</span><span id="b950" class="mz kz iq mu b gy ne nb l nc nd">`id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><span id="912d" class="mz kz iq mu b gy ne nb l nc nd">`name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,</span><span id="5314" class="mz kz iq mu b gy ne nb l nc nd">`user_id` int(10) unsigned NOT NULL DEFAULT '0',</span><span id="9147" class="mz kz iq mu b gy ne nb l nc nd">`vin` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,</span><span id="8b77" class="mz kz iq mu b gy ne nb l nc nd">`price` double(8,2) NOT NULL,</span><span id="c45f" class="mz kz iq mu b gy ne nb l nc nd">`url` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,</span><span id="9bb9" class="mz kz iq mu b gy ne nb l nc nd">`status` tinyint(4) NOT NULL,</span><span id="a34a" class="mz kz iq mu b gy ne nb l nc nd">`created_at` timestamp NULL DEFAULT NULL,</span><span id="c456" class="mz kz iq mu b gy ne nb l nc nd">`updated_at` timestamp NULL DEFAULT NULL,</span><span id="cf7a" class="mz kz iq mu b gy ne nb l nc nd">PRIMARY KEY (`id`)</span><span id="f29e" class="mz kz iq mu b gy ne nb l nc nd">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span></pre><p id="e749" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上传清单的功能如下所示:</p><pre class="mh mi mj mk gt mv mu mw mx aw my bi"><span id="85a4" class="mz kz iq mu b gy na nb l nc nd">public function addedCar( Request $request ) {<br/>  $url                = $request-&gt;file( 'url' );<br/>  $name               = $request-&gt;get( 'name' );<br/>  $vin                = $request-&gt;get( 'vin' );<br/>  $price              = $request-&gt;get( 'price' );<br/>  $uploaded_file_hash = '';</span><span id="55f1" class="mz kz iq mu b gy ne nb l nc nd">if ( $request-&gt;hasFile( 'url' ) ) {<br/>   $url                = $request-&gt;file( 'url' );<br/>   $uploaded_file_name = strtolower( str_replace( ' ', '_', $name ) );</span><span id="7343" class="mz kz iq mu b gy ne nb l nc nd">$response = Http::withHeaders( [<br/>    'pinata_api_key'        =&gt; '72a94c9c71e9e91de6e3',<br/>    'pinata_secret_api_key' =&gt; '19e64398c5ef83b27374ebc0984befb15510cb1b7bea63faa7db0277398cb194'<br/>   ] )-&gt;attach( 'file', file_get_contents( $url ), $uploaded_file_name )<br/>                   -&gt;post( '<a class="ae kw" href="https://api.pinata.cloud/pinning/pinFileToIPFS'" rel="noopener ugc nofollow" target="_blank">https://api.pinata.cloud/pinning/pinFileToIPFS'</a>, [<br/>                   ] );<br/>   $data     = $response-&gt;json();</span><span id="9c7c" class="mz kz iq mu b gy ne nb l nc nd">if ( array_key_exists( 'IpfsHash', $data ) ) {<br/>    $uploaded_file_hash = $data['IpfsHash'];<br/>    $size               = $data['PinSize'];</span><span id="55a3" class="mz kz iq mu b gy ne nb l nc nd">if ( $size &gt; 0 ) {<br/>     // It is time to upload it<br/>     $car = Car::create( [<br/>      'name'   =&gt; $name,<br/>      'vin'    =&gt; $vin,<br/>      'url'    =&gt; $uploaded_file_hash,<br/>      'price'  =&gt; $price,<br/>      'status' =&gt; 1,<br/>     ] );</span><span id="7ccf" class="mz kz iq mu b gy ne nb l nc nd">if ( $car-&gt;id &gt; 0 ) {<br/>      return redirect()-&gt;route( 'dashboard' );<br/>     }</span><span id="f6f8" class="mz kz iq mu b gy ne nb l nc nd">}<br/>   }<br/>  }<br/> }</span></pre><p id="1703" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要高兴，因为这些钥匙已经不存在了😉</p><p id="8cb3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上传后的汽车如下图所示:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/b231985fbf85b278c96ea3122ab953ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sHvWxAIViX5TnJp-.png"/></div></div></figure><p id="6d0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我在这里使用了VIN。使用它的原因是为产品带来独特性，因为NFT就是关于独特性的。</p><h1 id="8a48" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">NFT智能合同</h1><p id="04a8" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">目前，以太坊提供了两种智能合约标准:<em class="kx"> ERC721 </em>和<em class="kx"> ERC1155 </em>。我用的是非常基本的ERC721，因为它很好地满足了这个目的。我用的是<a class="ae kw" href="https://docs.openzeppelin.com/contracts/2.x/erc721" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin </a>提供的。使用现有的模板可以避免你自己想出错误的实现，而另一方面，OZ家伙的智能合同已经被安全公司彻底审计了。<em class="kx"> dCars </em> NFT智能合约如下图所示:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/8bd7301c9734d91acac5a47ec4976e65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ecxlQR3-P0JrwVwU.png"/></div></div></figure><p id="e921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意<code class="fe mr ms mt mu b">dCars</code>正在继承OZ guys提供的<code class="fe mr ms mt mu b">ERC721</code>合同。出于所有权和授权的目的，我也继承了<code class="fe mr ms mt mu b">Ownable</code>,从而使它更安全。你可以在这里了解更多。</p><p id="5309" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我只实现了<em class="kx"> minting </em>特性，因为我通过引入<code class="fe mr ms mt mu b">Counters</code>改变了默认实现，其余的功能我们已经可以使用。感谢我们的朋友<em class="kx">传承</em>。</p><p id="c24c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mr ms mt mu b">mintNFT</code>函数接受一个<code class="fe mr ms mt mu b">tokenURI</code>参数，该参数实际上指向单个NFT的元数据。元数据如下所示。这实际上是帮助你在像<em class="kx"> Openseas </em>这样的NFT市场上发现NFT的元数据。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/0f44359e0dd8fdf8d9c1d430a6d50fce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FBG1WVC_rGq8051_.png"/></div></div></figure><h1 id="1bb8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Web3js集成</h1><p id="c2fd" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">这里使用web3.js有两个原因:第一，要求用户支付汽车本身的价格，第二，用于造币的汽油费。我不会详细讨论从你的用户的元掩码收费ETH，因为我在这里<a class="ae kw" href="http://blog.adnansiddiqi.me/develop-your-first-decentralized-ecommerce-application-with-python-flask-and-metamask/" rel="noopener ugc nofollow" target="_blank">讨论过</a>和铸造NFT，它实际上是调用我在这里讨论过的<code class="fe mr ms mt mu b">mintNFT</code>函数。<code class="fe mr ms mt mu b">payEther</code>功能看起来如下图。</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/f4c4c229ad4cd1b1f159f787c260c16e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z1lsS8GTuEGUu6d2.png"/></div></div></figure><p id="d0f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而<code class="fe mr ms mt mu b">createNFT</code> JS函数实际上是调用智能合约函数，如下图所示:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/9f085f85e7831469931913ccd4687ddc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fzTdrPN4e64JoSx-.png"/></div></div></figure><p id="e71b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两个函数实际上都是通过BUY按钮的click事件调用的，在交易成功后，它将信息存储在相关的DB表中。此后，详细信息页面将如下所示:</p><figure class="mh mi mj mk gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/314d9a90a1cbc2c9230bd5c0262a7a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZPNPGv8Nziil4Ltp.png"/></div></div></figure><p id="953b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参观者可以看到这辆车现在的主人是谁，以及它的历史。很有可能是所有者把它转卖给他人，因为这个<code class="fe mr ms mt mu b">transferFrom</code>智能合同函数将被调用，但这里没有实现。</p><h1 id="ddd8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="ec60" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">因此，在这篇文章中，你将了解什么是NFT，以及作为一名开发者，你如何在现有的或新的web应用中实现它。这是一个不完整的项目，像倒卖功能还没有在其中实施。像往常一样，代码可以在Github上找到。</p></div><div class="ab cl ni nj hu nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ij ik il im in"><p id="44cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">原载于2021年9月16日</em><a class="ae kw" href="http://blog.adnansiddiqi.me/create-your-first-nft-market-place-for-selling-cars-in-php-laravel-and-web3-js/" rel="noopener ugc nofollow" target="_blank"><em class="kx">http://blog . adnansiddiqi . me</em></a><em class="kx">。</em></p></div></div>    
</body>
</html>