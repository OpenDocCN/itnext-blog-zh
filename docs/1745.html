<html>
<head>
<title>Practical TDD — Lesson 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实用TDD —第2课</h1>
<blockquote>原文：<a href="https://itnext.io/practical-tdd-lesson-2-d9d48283b0c4?source=collection_archive---------0-----------------------#2019-01-17">https://itnext.io/practical-tdd-lesson-2-d9d48283b0c4?source=collection_archive---------0-----------------------#2019-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/eb8de494e344506f285f30eb1768b162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IVmxQk8nIcC_qJ4n2fWBw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://www.pexels.com/@olly?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">布鲁斯·马斯</a>从<a class="ae kf" href="https://www.pexels.com/photo/photo-of-a-woman-thinking-941555/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</figcaption></figure><p id="241a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<a class="ae kf" href="https://medium.com/@raphaelyoshiga/practical-tdd-first-lesson-1c689fffe4ec" rel="noopener">的最后一篇文章</a>，我们用TDD做了FizzBuzz形。我觉得我展示了相当多的开发过程，但没有解释一些背景概念。在这篇文章中，我将后退几步，用例子展示理论和技巧。</p><h2 id="5046" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">测试结构</h2><p id="3076" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">一般来说，测试通常由三个阶段组成:</p><ul class=""><li id="02e2" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">安排(给定)-设置事物，准备依赖关系，等等。</li><li id="766c" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">动作(何时)—正在测试的动作</li><li id="736e" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">断言(Then) —验证结果</li></ul><p id="0a5b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当编写测试时，将测试分成这些步骤是很有用的。例如:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a923" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将有助于可读性和你写测试时的心态。</p><blockquote class="mw mx my"><p id="101e" class="kg kh mz ki b kj kk kl km kn ko kp kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">这些部分的注释仅供学习之用，不包括实际生产代码中的注释，仅使用空格进行逻辑分隔，如下所示:</p></blockquote><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="3f8c" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">红色、绿色、重构</h2><p id="7a36" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">当实践TDD时，你将进入一个循环，你编写测试，运行预期的失败，你使它通过，然后你重构它。可视化:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="ab gu cl nd"><img src="../Images/3f8d39ccb3d4d05df3dca419465dbd52.png" data-original-src="https://miro.medium.com/v2/0*hF_-I5PS2qghRrBa.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">TDD周期—图像<a class="ae kf" href="http://hanwax.github.io/assets/tdd_flow.png" rel="noopener ugc nofollow" target="_blank">源</a></figcaption></figure><p id="48ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以我开始的<a class="ae kf" href="https://github.com/garora/TDD-Katas/blob/master/KatasReadme.md" rel="noopener ugc nofollow" target="_blank">弦计算器形</a>为例</p><blockquote class="mw mx my"><p id="6f9f" class="kg kh mz ki b kj kk kl km kn ko kp kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">字符串计算器要求:</p><p id="bf5a" class="kg kh mz ki b kj kk kl km kn ko kp kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">用int Add(字符串数字)方法创建一个简单的字符串计算器。该方法可以接受0、1或2个数字，并将返回它们的总和(对于空字符串，它将返回0)。例如“1”或“1，2”</p></blockquote><p id="4b0b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当测试一个简单的场景时，一个位数返回其解析为整数的值。</p><p id="23bc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">过程是这样的:</p><ul class=""><li id="5249" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">测试“1”返回1，失败&gt;硬编码条件并返回1 &gt;通过</li><li id="ba25" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">测试“155”是否返回155 &gt;失败&gt;硬编码155 &gt;通过</li><li id="b667" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">测试“9”是否返回9 &gt;失败&gt;硬编码9 &gt;通过</li></ul><p id="d64b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后代码看起来像这样:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="a56f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以在这一点上，重构对我来说是完美的，我得到了很好的覆盖，一切都是绿色的，重构让我:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="13fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管一般来说你想尽可能经常地做这三个阶段，但是在这种情况下，我不能重构太多，直到我在抽象之前得到模式三次。</p><p id="d89c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记得试着做3个阶段，TDD初学者往往会进入红&gt;绿，红&gt;绿，红&gt;绿&gt;大规模重构的很多循环。</p><p id="d932" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了对抗以前的习惯，我通常将devs放入:</p><h2 id="82f0" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">TDD时钟游戏</h2><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/56d3e9e5075b953892db40e3c5a3bcd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LscpE-wN0xrisk5qDuKQTw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://www.pexels.com/@bentonphotocinema?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">乔丹本顿</a>从<a class="ae kf" href="https://www.pexels.com/photo/shallow-focus-photography-of-hourglass-1095602/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</figcaption></figure><p id="1ed7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个游戏是一场简单的时间赛跑，开发者有几分钟的时间来思考他们下一步要做什么，他们可以选择:</p><ul class=""><li id="4cdf" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">添加更多的测试用例并继续实现</li><li id="4781" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">重构</li></ul><p id="a547" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦他们开始编码，我们就给他们设置一个计时器，(2-5分钟待定)如果他们决定添加更多的测试用例，他们需要:</p><ul class=""><li id="3863" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated">要添加测试，失败它</li><li id="1271" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated">实现它，让它通过。</li></ul><p id="b83f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果他们不能按时完成并提交，我们可以:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="86c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，开发人员只能在测试通过的情况下提交。</p><p id="55da" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个游戏很好地让开发人员想到小而简单，足以将问题分解成如此小的任务，以至于他们可以有如此短的迭代。此外，它拒绝大规模重构，因为如果你做了大规模的改变，你很可能会打破东西，超时运行。</p><h2 id="63fe" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">测试也值得小心</h2><p id="e71f" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">有时会发生这种情况，TDD的3个周期被应用到产品代码中，但是测试从来没有看到重构周期。测试代码和产品代码一样重要，它是文档，是你重构的安全网。如果测试变得臃肿，你可能会到了不理解和不信任它们的地步，那么很多TDD的好处就失去了。</p><p id="67a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我使用字符串计算器的过程中，我的测试看起来是这样的，你能看出它有什么问题吗？</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="8908" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">主要的事情是设置中的重复，例如，初始化StringCalculator。有了Xunit，我们可以做到:</p><figure class="mq mr ms mt gt ju"><div class="bz fp l di"><div class="mu mv l"/></div></figure><blockquote class="mw mx my"><p id="86bc" class="kg kh mz ki b kj kk kl km kn ko kp kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">对于像行为和断言这样的小事，我甚至不介意不把它们分开。</p></blockquote><h2 id="358d" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">的奖金。net开发人员</h2><p id="7163" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我希望在这之前，你已经养成了运行测试以使它失败的习惯，实现它，然后运行它们以使它们通过。</p><p id="5d3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你学会了键盘快捷键，这应该不会太难，但是…让我向你介绍一下实时单元测试:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/864701206eab283ea246f0bdee6955a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*PthhHcFOsFdovnDB9OwsDw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在visual studio中启用实时单元测试</figcaption></figure><p id="5117" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">实时单元测试是让IDE在每次检测到代码变化时自动运行测试。这3个周期仍然存在，唯一的区别是IDE将为您运行测试。这就是测试失败的原因:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/1a5144f7c53e67091cab388faca8cd39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3cLFkjmXNKUf3LYbVL91w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Visual Studio live单元测试测试失败</figcaption></figure><p id="57d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当他们经过的时候:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/0032d408e79169cc5d4688338143de95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhFcHZY9Dmru-RnSuYQtSQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Visual Studio live单元测试通过测试</figcaption></figure><p id="0a31" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可以大大加快你的发展。</p><h1 id="fa2e" class="ni lf it bd lg nj nk nl lj nm nn no lm np nq nr lp ns nt nu ls nv nw nx lv ny bi translated">结论</h1><p id="6ebc" class="pw-post-body-paragraph kg kh it ki b kj lx kl km kn ly kp kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">关于这篇文章，我希望给你更多的理论知识，以及如何应用到实践中。我们讨论了测试结构的理论，TDD循环，重构测试的重要性，以及。网芯。</p><p id="e5a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以从<a class="ae kf" href="https://github.com/RaphaelYoshiga/TDD/blob/master/Outside.Tdd.1FizzBuzz/StringCalculatorShould.cs" rel="noopener ugc nofollow" target="_blank">这里</a>下载字符串计算器。</p><p id="d794" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你正在阅读这个系列，我很乐意帮助你学习卡塔，把GitHub库发给我，我可以查看它们，看看我是否能给出什么好的见解。干杯。</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="2f1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个TDD资源:</p><ul class=""><li id="630d" class="mc md it ki b kj kk kn ko kr me kv mf kz mg ld mh mi mj mk bi translated"><a class="ae kf" href="https://medium.com/@raphaelyoshiga/why-tdd-will-change-your-developer-life-b0bf234e15ac" rel="noopener">为什么TDD会改变你的开发者生活</a></li><li id="40f8" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated"><a class="ae kf" href="https://medium.com/@raphaelyoshiga/practical-tdd-first-lesson-1c689fffe4ec" rel="noopener">实用TDD —第一课</a></li><li id="8ccc" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated"><a class="ae kf" href="https://medium.com/@raphaelyoshiga/practical-tdd-3-9a76b3e045d8" rel="noopener">实用TDD——第三课课堂协作</a></li><li id="e0e4" class="mc md it ki b kj ml kn mm kr mn kv mo kz mp ld mh mi mj mk bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/acceptance-test-driven-development-in-net-core-with-specflow-dcb17fb7a893">验收测试驱动开发用。net core和Specflow </a></li></ul></div></div>    
</body>
</html>