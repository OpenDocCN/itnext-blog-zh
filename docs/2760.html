<html>
<head>
<title>Running Express.js on Firebase Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Firebase云函数上运行Express.js</h1>
<blockquote>原文：<a href="https://itnext.io/running-express-js-on-firebase-cloud-functions-a20b536c6aec?source=collection_archive---------1-----------------------#2019-07-29">https://itnext.io/running-express-js-on-firebase-cloud-functions-a20b536c6aec?source=collection_archive---------1-----------------------#2019-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/58e056956c82ab5f048c2e917300e1df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCXz8NDNo1xmxagF4HMtIQ.png"/></div></div></figure><p id="4de1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">firebase的云函数是运行后端代码以响应Firebase事件和HTTP请求的绝佳解决方案。<br/>您不需要管理您的服务器:只需部署JavaScript代码，让Google来完成剩下的工作。这样，即使没有HTTP请求，你也不需要为一个24/7运行的服务器付费；您只需为每个<strong class="kd iu">功能执行</strong>支付固定金额的费用，这要便宜得多！</p><h1 id="0f41" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">你能用Firebase云函数做什么？</h1><p id="7ee5" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">正如我们之前所说的，您可以运行后端代码来响应Firebase事件或HTTP请求。<br/>例如，假设一个用户正在上传一张图片到Firebase存储器。您可以轻松地从该图像生成缩略图，并将它们的路径存储在NoSQL实时数据库Firebase Firestore中！</p><p id="64d3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您还可以用Express.js编写一个<strong class="kd iu">无服务器REST API </strong>并在几秒钟内完成部署…这就是我们今天将看到的！</p><h1 id="6e20" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">引导函数</h1><p id="8461" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">首先让我们进入<a class="ae mc" href="https://console.firebase.google.com/u/0/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> Firebase管理控制台</strong> </a>，让我们添加一个<strong class="kd iu">新项目</strong>。</p><p id="371c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，让我们在您的机器上安装<strong class="kd iu"> Firebase工具</strong>:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/2037e9d900481512a4980516e873ee74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9Vi8iZrT2T7ssw1xV0p3A.png"/></div></div></figure><p id="bd28" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！现在让我们从命令行登录到您的Firebase帐户:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/b2535c184d3e67803efe54ae5ecd8c54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*roB1LtGoilE32YWVNSCnQQ.png"/></div></div></figure><p id="f7cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在你已经准备好启动你的函数了！这就是你要做的:</p><figure class="me mf mg mh gt ju"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="cf35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您应该拥有以下文件夹结构:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/a66bb26953adc56d7dc7ea78828067bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lTImwj0WK-9kx37krc7yaw.png"/></div></div></figure><p id="71ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们准备好编写我们的REST API了！<br/>让我们进入<code class="fe mk ml mm mn b">functions</code>目录并安装所需的依赖项:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/4c35d2ab513b453ed1bdbf218b0c8ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqtI6eBXZITXiZCdXDP3KA.png"/></div></div></figure><p id="b440" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们打开<code class="fe mk ml mm mn b">functions/index.js</code>文件，写下我们的<strong class="kd iu"> Firebase云函数</strong>！</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/1482d9b8ea29a48d1efaf4dbd863a4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOTLke7NjytYkcEsrO39eg.png"/></div></div></figure><p id="f327" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们来分析一下上面的代码:</p><ol class=""><li id="62b1" class="mo mp it kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">我们需要<code class="fe mk ml mm mn b">firebase-functions</code>模块。</li><li id="4823" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">我们需要一个<code class="fe mk ml mm mn b">server</code>模块。这里我们将编写我们的REST服务器。</li><li id="3bd1" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">我们声明一个新的<code class="fe mk ml mm mn b">api</code>常量，它是Firebase Cloud函数处理程序:每次我们得到一个HTTP请求，我们将分配2GB的内存和最多120秒的时间来执行函数。<br/>我们还声明它将在HTTP下服务，请求将由<code class="fe mk ml mm mn b">server</code>模块处理。</li><li id="e1d6" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">我们只是导出了<code class="fe mk ml mm mn b">api</code>函数。它将可以通过<code class="fe mk ml mm mn b">https://&lt;your-project&gt;/api</code>端点到达。</li></ol><p id="63c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们进入我们的<code class="fe mk ml mm mn b">server</code>模块:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/866602c31573b2712979db6e117ce00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUoNNcSc43WazZvRPzN8TA.png"/></div></div></figure><p id="fdf7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，我们正在创建一个标准的Express.js应用程序，其中我们基本上只声明了一个端点(<code class="fe mk ml mm mn b">/languages</code>)和一个<code class="fe mk ml mm mn b">*</code>通配符，它将响应一个404状态页面。</p><p id="8534" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们看看我们的<code class="fe mk ml mm mn b">/lib/languages/route.js</code>文件中有什么:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/1f278368117a1b2bffebae20899e85c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6qMePSOuvzL0BRhXl86Z5g.png"/></div></div></figure><p id="90c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">只是路线！我们将把这两条路线的处理程序委托给我们的<code class="fe mk ml mm mn b">/lib/languages/controller.js</code>文件:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/64e470d1dcac8239c543d4b54e495f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zO93YIqhw2Bo7GCKNW1T7w.png"/></div></div></figure><p id="ee39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，我们只是创建了两个控制器，它们从本地JSON文件中获取数据，但也可能是数据库调用或任何其他数据源。</p><p id="0758" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<code class="fe mk ml mm mn b">getAllLanguages</code>函数中，我们只是从<code class="fe mk ml mm mn b">languages.json</code>文件发回一组编程语言。<br/>在<code class="fe mk ml mm mn b">getLanguage</code>函数中，我们做了一些更复杂的事情:</p><ol class=""><li id="8fd7" class="mo mp it kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">我们将所需的编程语言作为Express.js参数(<code class="fe mk ml mm mn b">/languages/:language</code>)。</li><li id="d900" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">我们从JSON文件中获取该语言</li><li id="0eff" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">我们在控制<code class="fe mk ml mm mn b">lang</code>变量是否用一个元素的数组来赋值。</li><li id="9818" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">现在我们向用户发回一个响应:如果我们的JSON文件中存在所需的语言，我们将发回一个200状态代码。否则，我们将发送404。</li><li id="1580" class="mo mp it kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">然后，我们发送回所需的语言(如果存在)或友好的错误消息。</li></ol><h1 id="eb96" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">测试功能</h1><p id="15e3" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们现在准备在本地测试我们的功能Firebase让测试变得很容易！让我们转到<code class="fe mk ml mm mn b">/functions</code>目录并键入:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/0029378dea549067e86eb0f36dbc8b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1g6YaAu3bN7Xu5vORx7Efg.png"/></div></div></figure><p id="d221" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将引导一个本地服务器，其端点如下:<strong class="kd iu">http://localhost:5000/js Monday-CMS/us-central 1/api</strong>，您可以在这里测试您的API！试着去下面的网址看看你能得到什么:</p><p id="59dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae mc" href="http://localhost:5000/jsmonday-cms/us-central1/api/all" rel="noopener ugc nofollow" target="_blank">T12】http://localhost:5000/js Monday-CMS/us-central 1/API/allT14】</a></p><h1 id="8825" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">部署功能</h1><p id="8fbb" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">如果在本地测试功能很容易…部署它就更容易了！只需键入以下命令:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/a704e29cbbb2c66471c4f69b8503a328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DaqZZ9p8OF0TpwXD5n7rw.png"/></div></div></figure><p id="a721" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的函数现在可以从整个互联网上调用了！</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><a href="https://github.com/sponsors/micheleriva"><div class="gh gi ne"><img src="../Images/e05f00ed2cddfd2907284cb397168c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAIiY1uBKSNdw12oq2BbjA.png"/></div></a></figure></div></div>    
</body>
</html>