<html>
<head>
<title>KubeKey: A Game Changer for the Installation of Kubernetes and Cloud-Native Plugins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">KubeKey:安装Kubernetes和云原生插件的游戏改变者</h1>
<blockquote>原文：<a href="https://itnext.io/kubekey-a-game-changer-for-the-installation-of-kubernetes-and-cloud-native-plugins-b8f2edcfafcc?source=collection_archive---------2-----------------------#2021-01-15">https://itnext.io/kubekey-a-game-changer-for-the-installation-of-kubernetes-and-cloud-native-plugins-b8f2edcfafcc?source=collection_archive---------2-----------------------#2021-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="715e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于Kubernetes是容器编排的事实上的标准，Kubernetes的安装仍然是Kubernetes用户面临的最大挑战之一，尤其是新手。除了Kubernetes本身，他们还需要弄清楚如何安装安装所需的不同工具，比如kubelet、kubeadm和kubectl。他们一直想知道是否有一个包含所有堆栈的工具，这样他们就可以只运行几个安装命令。</p><p id="5f36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将演示如何使用KubeKey建立一个三节点Kubernetes集群。</p><h1 id="7769" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">什么是KubeKey</h1><p id="a7d2" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">KubeKey 在Go中开发，提供了一种简单、快速和灵活的方式来安装Kubernetes和任何可以部署为YAML或图表文件的附加组件。KubeKey使用kubeadm在节点上尽可能并行地安装Kubernetes集群，以便降低安装复杂度，提高效率。与其他安装方法相比，它大大节省了安装时间。</p><p id="88e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">众所周知，Kubernetes集群可以跨内部环境、公共云、私有云或裸机进行部署。因此，它可以作为部署云原生应用的综合平台。然而，每个环境可能需要不同的配置和设置。事实上，这就是KubeKey改变游戏的地方，因为您可以使用它在任何环境中部署Kubernetes。</p><p id="a64f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用KubeKey安装Kubernetes的一般步骤:</p><ol class=""><li id="e039" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">下载KubeKey。</li><li id="7c3a" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">创建包含群集信息的配置文件，如主机和附加组件。</li><li id="d64f" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">应用配置文件，安装将自动开始。docker等工具都将自动安装。</li></ol><h1 id="7ef5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">准备主机</h1><p id="5935" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我将在云上创建一个包含三个节点的集群。以下是我的机器配置供你参考:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/1b11fec9522bfef84a686bc546736e97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FryH90ngXLQNDnHiTwqEQQ.png"/></div></div></figure><p id="7218" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">注</em></p><ul class=""><li id="063d" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mq lv lw lx bi translated"><em class="mp">路径</em> <code class="fe mr ms mt mu b"><em class="mp">/var/lib/docker</em></code> <em class="mp">主要用于存储容器数据，在使用和运行过程中会逐渐变大。在生产环境中，建议</em> <code class="fe mr ms mt mu b"><em class="mp">/var/lib/docker</em></code> <em class="mp">单独挂载一个驱动器。</em></li><li id="584d" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated">建议您的操作系统保持干净(不安装任何其他软件)。否则，可能会有冲突。</li></ul><h1 id="7d7e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">节点要求</h1><ul class=""><li id="6a43" class="lp lq iq jp b jq lj ju lk jy mv kc mw kg mx kk mq lv lw lx bi translated">所有节点必须可以通过<code class="fe mr ms mt mu b">SSH</code>访问。</li><li id="83cb" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated">所有节点的时间同步。</li><li id="6915" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated">所有节点都应使用<code class="fe mr ms mt mu b">sudo</code> / <code class="fe mr ms mt mu b">curl</code> / <code class="fe mr ms mt mu b">openssl</code>。</li><li id="cc72" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated">你可以预先在所有节点上安装docker。或者，KubeKey会在安装Kubernetes的同时自动安装docker。如果从<code class="fe mr ms mt mu b">dockerhub.io</code>下载图像有困难，建议准备一个镜像。更多信息，请参见<a class="ae lo" href="https://docs.docker.com/registry/recipes/mirror/#configure-the-docker-daemon" rel="noopener ugc nofollow" target="_blank">为Docker守护进程</a>配置注册表镜像。</li></ul><h1 id="9cc3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">依赖性要求</h1><p id="05fe" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">您可以使用KubeKey来安装指定的Kubernetes版本。根据要安装的Kubernetes版本，需要安装的依赖项可能会有所不同。您可以参考下面的列表，看看是否需要提前在您的所有节点上安装相关的依赖项。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi my"><img src="../Images/99fc0fdf81d181ad98c56517b64d56b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZilUfrfDgMYzmQafj9h2uw.png"/></div></div></figure><h1 id="83e5" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">网络和DNS要求</h1><ul class=""><li id="11fb" class="lp lq iq jp b jq lj ju lk jy mv kc mw kg mx kk mq lv lw lx bi translated">确保<code class="fe mr ms mt mu b">/etc/resolv.conf</code>中的DNS地址可用。否则，可能会导致集群中的DNS出现一些问题。</li><li id="672f" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated">如果您的网络配置使用防火墙规则或安全组，您必须确保基础架构组件可以通过特定端口相互通信。建议您关闭防火墙。更多信息，请参见<a class="ae lo" href="https://github.com/kubesphere/kubekey/blob/master/docs/network-access.md" rel="noopener ugc nofollow" target="_blank">网络访问</a>。</li></ul><h1 id="c544" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">安装Kubernetes</h1><ol class=""><li id="defb" class="lp lq iq jp b jq lj ju lk jy mv kc mw kg mx kk lu lv lw lx bi translated">从其<a class="ae lo" href="https://github.com/kubesphere/kubekey/releases" rel="noopener ugc nofollow" target="_blank"> GitHub发布页面</a>下载KubeKey，或者使用以下命令下载KubeKey版本1.0.1。您只需要将KubeKey下载到您的一台作为<strong class="jp ir">任务盒</strong>进行安装的机器上，例如主节点。</li></ol><p id="d829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">curl -sfL https://get-kk.kubesphere.io | VERSION=v1.0.1 sh -</code></p><p id="ff14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">注</em></p><p id="d0b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">您可以在命令中更改版本号，以下载特定版本</em>。</p><p id="135b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.上面的命令下载KubeKey并解压文件。您的文件夹现在包含一个名为<code class="fe mr ms mt mu b">kk</code>的文件。使其可执行:</p><p id="bb4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">chmod +x kk</code></p><p id="3316" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.现在KubeKey已经准备好了，我可以开始创建配置文件来指定集群信息。下面是创建配置文件的命令模板，它允许您使用定制的名称和路径安装指定的Kubernetes版本:</p><p id="a903" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">./kk create config [--with-kubernetes version] [(-f | --file) path]</code></p><p id="ce7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认的Kubernetes版本是v1.17.9。有关受支持的Kubernetes版本的更多信息，请参见此<a class="ae lo" href="https://github.com/kubesphere/kubekey/blob/master/docs/kubernetes-versions.md" rel="noopener ugc nofollow" target="_blank">文件</a>。以执行以下命令为例:</p><p id="c637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">./kk create config --with-kubernetes v1.17.9</code></p><p id="82e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.如果您不自定义名称，将会创建一个默认文件<code class="fe mr ms mt mu b">config-sample.yaml</code>。编辑文件。</p><p id="6eb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">vi config-sample.yaml</code></p><p id="5b7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.您将看到文件中预先填充了一些值。以下是我的配置供你参考:</p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="9ff6" class="nd km iq mu b gy ne nf l ng nh">apiVersion: kubekey.kubesphere.io/v1alpha1<br/>kind: Cluster<br/>metadata:<br/>  name: sample<br/>spec:<br/>  hosts:<br/>  - {name: master, address: 192.168.0.2, internalAddress: 192.168.0.2, user: root, password: Testing123}<br/>  - {name: worker1, address: 192.168.0.3, internalAddress: 192.168.0.3, user: root, password: Testing123}<br/>  - {name: worker2, address: 192.168.0.4, internalAddress: 192.168.0.4, user: root, password: Testing123}<br/>  roleGroups:<br/>    etcd:<br/>    - master<br/>    master:<br/>    - master<br/>    worker:<br/>    - worker1<br/>    - worker2<br/>  controlPlaneEndpoint:<br/>    domain: lb.kubesphere.local<br/>    address: ""<br/>    port: "6443"<br/>  kubernetes:<br/>    version: v1.17.9<br/>    imageRepo: kubesphere<br/>    clusterName: cluster.local<br/>  network:<br/>    plugin: calico<br/>    kubePodsCIDR: 10.233.64.0/18<br/>    kubeServiceCIDR: 10.233.0.0/18<br/>  registry:<br/>    registryMirrors: []<br/>    insecureRegistries: []<br/>  addons: []</span></pre><p id="0c9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个示例文件中，在<code class="fe mr ms mt mu b">hosts</code>下面列出您的所有机器，并添加它们的详细信息。</p><ul class=""><li id="8bbc" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">name</code>:实例的主机名。</li><li id="bb74" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">address</code>:通过SSH连接taskbox和其他实例的IP地址。这可以是公共IP地址，也可以是私有IP地址，具体取决于您的环境。例如，一些云平台为每个实例提供一个公共IP地址，您可以使用该地址通过SSH访问实例。在这种情况下，您可以为该字段输入公共IP地址。</li><li id="3528" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">internalAddress</code>:实例的私有IP地址。</li><li id="f681" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">user</code>和<code class="fe mr ms mt mu b">password</code>字段表示您用来连接到实例的用户和密码。对于使用SSH密钥的无密码登录，您需要提供您的私钥路径，如下所示:</li></ul><p id="7d59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">hosts: - {name: master, address: 192.168.0.2, internalAddress: 192.168.0.2, privateKeyPath: "~/.ssh/id_rsa"}</code></p><ul class=""><li id="ec23" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">etcd</code> : etcd节点名称。</li><li id="0149" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">master</code>:主节点名称。</li><li id="ebf3" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mq lv lw lx bi translated"><code class="fe mr ms mt mu b">worker</code>:工作者节点名称。</li></ul><p id="62b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这个配置文件中提供更多的值，比如<code class="fe mr ms mt mu b">addons</code>。KubeKey可以安装所有可以作为YAML文件或图表文件安装的<a class="ae lo" href="https://github.com/kubesphere/kubekey/blob/release-1.0/docs/addons.md" rel="noopener ugc nofollow" target="_blank">插件</a>。例如，KubeKey在默认情况下不会为Kubernetes安装任何存储插件，但是您可以<a class="ae lo" href="https://kubesphere.io/docs/installing-on-linux/introduction/storage-configuration/" rel="noopener ugc nofollow" target="_blank">添加自己的存储系统</a>，包括NFS客户端、Ceph和Glusterfs。有关配置文件的更多信息，请参见<a class="ae lo" href="https://kubesphere.io/docs/installing-on-linux/introduction/vars/" rel="noopener ugc nofollow" target="_blank"> Kubernetes集群配置</a>和<a class="ae lo" href="https://github.com/kubesphere/kubekey/blob/release-1.0/docs/config-example.md" rel="noopener ugc nofollow" target="_blank">该文件</a>。</p><p id="33a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.完成编辑后保存文件，并执行以下命令来安装Kubernetes:</p><p id="66df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">./kk create cluster -f config-sample.yaml</code></p><p id="de3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.安装完成后，您可以看到如下输出。</p><p id="d2cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">Congratulations! Installation is successful.</code></p><p id="5b85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.执行以下命令来检查名称空间的状态。</p><p id="5547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl get pod --all-namespaces</code></p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="01d9" class="nd km iq mu b gy ne nf l ng nh">NAMESPACE     NAME               READY   STATUS    RESTARTS   AGE<br/>kube-system   calico-kube-<br/>              controllers-<br/>              59d85c5c84-mqk9g   1/1     Running   0         2m56s<br/>kube-system   calico-node-hp6b5  1/1     Running   0         2m56s<br/>kube-system   calico-node-stxj8  1/1     Running   0         2m55s<br/>kube-system   calico-node-wzjn9  1/1     Running   0         2m55s<br/>kube-system   coredns-74d59cc5c6<br/>              -dkpq4             1/1     Running   0         3m5s<br/>kube-system   coredns-74d59cc5c6<br/>              -v2bvx             1/1     Running   0         3m5s<br/>kube-system   kube-apiserver<br/>              -master            1/1     Running   0         3m22s<br/>kube-system   kube-controller<br/>             -manager-master     1/1     Running   0         3m22s<br/>kube-system   kube-proxy-5h6bv   1/1     Running   0         2m55s<br/>kube-system   kube-proxy-btfxl   1/1     Running   0         3m5s<br/>kube-system   kube-proxy-rht2m   1/1     Running   0         2m55s<br/>kube-system   kube-scheduler<br/>              -master            1/1     Running   0         3m22s<br/>kube-system   nodelocaldns-2fkqb 1/1     Running   0         2m55s<br/>kube-system   nodelocaldns-5gzmn 1/1     Running   0         2m55s<br/>kube-system   nodelocaldns-mggpb 1/1     Running   0         3m5s</span></pre><h1 id="1877" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">访问Kubernetes仪表板</h1><ol class=""><li id="a747" class="lp lq iq jp b jq lj ju lk jy mv kc mw kg mx kk lu lv lw lx bi translated">为了更直观地查看集群资源，可以访问基于web的Kubernetes用户界面。默认情况下，KubeKey不会安装它。要部署它，请运行以下命令:</li></ol><p id="6a40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl apply -f <a class="ae lo" href="https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</a></code></p><p id="8681" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.要访问Kubernetes仪表板，您可以运行<code class="fe mr ms mt mu b">kubectl proxy</code>,如其官方文档<a class="ae lo" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/#accessing-the-dashboard-ui" rel="noopener ugc nofollow" target="_blank">所述，而仪表板只能从执行命令的机器上访问。执行以下命令，您可以看到仪表板服务类型是<code class="fe mr ms mt mu b">ClusterIP</code>。</a></p><p id="e93e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl get svc -n kubernetes-dashboard</code></p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="0b9a" class="nd km iq mu b gy ne nf l ng nh">NAME        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><span id="0713" class="nd km iq mu b gy ni nf l ng nh">dashboard-<br/>metrics-<br/>scraper    ClusterIP   10.233.45.187   &lt;none&gt;      8000/TCP   5m51s</span><span id="2d13" class="nd km iq mu b gy ni nf l ng nh">kubernetes-<br/>dashboard   ClusterIP   10.233.62.52    &lt;none&gt;      443/TCP    5m51s</span></pre><p id="4a9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.由于我的机器都在云上，我需要通过<code class="fe mr ms mt mu b">NodePort</code>公开仪表板服务，这样我就可以在集群之外访问它。运行以下命令:</p><p id="e4ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl edit svc kubernetes-dashboard -o yaml -n kubernetes-dashboard</code></p><p id="c64d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.导航至<code class="fe mr ms mt mu b">.spec.type</code>并将<code class="fe mr ms mt mu b">ClusterIP</code>更改为<code class="fe mr ms mt mu b">NodePort</code>。</p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="55ee" class="nd km iq mu b gy ne nf l ng nh">spec:<br/>  clusterIP: 10.233.62.52<br/>  ports:<br/>  - port: 443<br/>    protocol: TCP<br/>    targetPort: 8443<br/>  selector:<br/>    k8s-app: kubernetes-dashboard<br/>  sessionAffinity: None<br/>  type: NodePort  # Change ClusterIP to NodePort.</span></pre><p id="944a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.保存文件并再次检查仪表板服务。您可以看到仪表板服务是公开的。</p><p id="0a02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl get svc -n kubernetes-dashboard</code></p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="4d3e" class="nd km iq mu b gy ne nf l ng nh">NAME     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)      AGE</span><span id="8743" class="nd km iq mu b gy ni nf l ng nh">dashboard-<br/>metrics-<br/>scraper   ClusterIP   10.233.45.187   &lt;none&gt;      8000/TCP       12m<br/>kubernetes<br/>-dashboard   NodePort    10.233.62.52    &lt;none&gt;  443:31259/TCP   12m</span></pre><p id="5e34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.由于端口<code class="fe mr ms mt mu b">31259</code>在本例中是公开的，所以我可以在<code class="fe mr ms mt mu b"><a class="ae lo" href="https://IP:31259." rel="noopener ugc nofollow" target="_blank">https://IP:31259</a></code> <a class="ae lo" href="https://IP:31259." rel="noopener ugc nofollow" target="_blank">访问仪表板。</a></p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/98ba21227838921304467296fbbd669a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G1lDf0ED9g3EqkXE.png"/></div></div></figure><p id="e42e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">注</em></p><p id="c8c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">根据您的环境，您可能需要在安全组中配置端口转发规则并打开端口。</em></p><p id="a9b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.要登录到仪表板，您需要创建一个ServiceAccount对象和一个ClusterRoleBinding对象。在名称空间<code class="fe mr ms mt mu b">kubernetes-dashboard</code>中创建名为<code class="fe mr ms mt mu b">admin-user</code>的帐户。</p><p id="be4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">cat &lt;&lt;EOF | kubectl apply -f - apiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard EOF</code></p><p id="6bf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建ClusterRoleBinding对象。</p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="6ce7" class="nd km iq mu b gy ne nf l ng nh">cat &lt;&lt;EOF | kubectl apply -f -<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: admin-user<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: cluster-admin<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: admin-user<br/>  namespace: kubernetes-dashboard<br/>EOF</span></pre><p id="6060" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.执行以下命令以获取不记名令牌来登录仪表板。</p><p id="2f81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Bash:</p><p id="b1a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')</code></p><p id="8ceb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于Powershell:</p><p id="2db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt mu b">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | sls admin-user | ForEach-Object { $_ -Split '\s+' } | Select -First 1)</code></p><p id="ba98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预期产出:</p><pre class="me mf mg mh gt mz mu na nb aw nc bi"><span id="8dc5" class="nd km iq mu b gy ne nf l ng nh">Name:         admin-user-token-flkqz<br/>Namespace:    kubernetes-dashboard<br/>Labels:       &lt;none&gt;<br/>Annotations:  kubernetes.io/service-account.name: admin-user<br/>              kubernetes.io/service-account.uid: 78870e66-89c1-4750-915d-b147dbba66cb<br/>   <br/>Type:  kubernetes.io/service-account-token<br/>   <br/>Data<br/>====<br/>ca.crt:     1025 bytes<br/>namespace:  20 bytes<br/>token:      eyJhbGciOiJSUzI1NiIsImtpZCI6Im9EaXNLOWUyV21UcDhOVzFUanl6bnRzdHBocWF6bjhLcXltSGM1Ulc5aVUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWZsa3F6Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI3ODg3MGU2Ni04OWMxLTQ3NTAtOTE1ZC1iMTQ3ZGJiYTY2Y2IiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.SKseCm1u7Yga0jx2nFf5x4FoHgOONWQ8S1yDdPGXoZpuUShCr8b6ofmISHDi_Tsk3qQfwlMA99NWkLKeM6ijktULIbk9Y11GjMh0-rWjdxQPbxB6Bh0LGYh4SGLl_hNkYOVxd_1r8H-hddRHbkfs8t4eH-pUjQewC7LrCG5SQNrHtQnyuDleQQdSq1TNtDviCA17cL_XFomRkomqi4Vy7QExwEDYaNy7-9c_C-59Hh5QexZ4MoR8WsZewR-uXr_z2RmbTnuXaK-1wkIHt-niFdgxozGg4tcPvlIQ7XvJGMKXcSnrqnaieImUY_Y_6_Z8wm6LJl4XaypjhnYqJZD3wA</span></pre><p id="a045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">9.复制令牌并将其粘贴到<strong class="jp ir">输入令牌</strong>字段，点击<strong class="jp ir">登录</strong>。现在，您可以在仪表板上查看节点信息和编辑资源。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/2f700535a6d5fc0b2da42fbde1a47bea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aPaT4TZdYsZgT4mW.png"/></div></div></figure><h1 id="8b06" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">KubeSphere及其图形仪表盘</h1><p id="c07b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><a class="ae lo" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> KubeSphere </a>是一个<strong class="jp ir">分布式操作系统，管理以Kubernetes为内核的云原生应用</strong>。作为一个开源的企业级容器平台，它拥有全栈自动化it操作、多集群管理和简化的DevOps工作流。这是KubeSphere的建筑。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nk"><img src="../Images/228a3ad78ee40aabe1c233850ee5a9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xg6oYH_xuPcnD91q.png"/></div></div></figure><p id="0d50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，KubeSphere还拥有自己的基于网络的响应控制台，比Kubernetes仪表板更加强大和全面。拥有必要权限的用户可以直接在控制台上操作资源，同时他们还可以选择使用内置的web工具kubectl。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nj"><img src="../Images/7e4142c8df95e0e6daabae3ba482f9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BFb3xZBxAgeeT5Wz.png"/></div></div></figure><p id="7859" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实上，您可以使用KubeKey同时安装Kubernetes和KubeSphere。这个过程基本上是一样的，只是你需要在运行命令<code class="fe mr ms mt mu b">./kk create config</code>时添加标志<code class="fe mr ms mt mu b">--with-kubesphere [version]</code>。有关更多信息，请查看KubeSphere文档。</p><p id="21cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请观看此视频，了解实际操作教程:</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">在Google Cloud上安装一个多节点Kubernetes和KubeSphere集群</figcaption></figure><h1 id="3d59" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">摘要</h1><p id="dbc4" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我在本文中演示的安装过程只是KubeKey所能做到的一小部分。除了安装Kubernetes和KubeSphere之外，您还可以使用它来扩展和升级您的集群。它还支持<a class="ae lo" href="https://kubesphere.io/docs/installing-on-linux/introduction/air-gapped-installation/" rel="noopener ugc nofollow" target="_blank">气隙安装</a>，只要你提前下载安装镜像。</p><p id="b489" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇文章能对那些长期以来一直在寻找安装方法的人有所帮助。我认为，有了KubeKey，Kubernetes社区在安装效率和用户体验方面向前迈进了一大步。</p><h1 id="d3cf" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">参考</h1><p id="b32a" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><a class="ae lo" href="https://github.com/kubesphere/kubekey" rel="noopener ugc nofollow" target="_blank">库伯基</a></p><p id="4abd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lo" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" rel="noopener ugc nofollow" target="_blank"> Kubernetes仪表盘</a></p><p id="a817" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lo" href="https://kubesphere.io/docs/installing-on-linux/introduction/multioverview/" rel="noopener ugc nofollow" target="_blank">多节点安装</a></p></div></div>    
</body>
</html>