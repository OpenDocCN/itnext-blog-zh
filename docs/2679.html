<html>
<head>
<title>How to use Knative Pipelining Component to automate an Application Build and Deployment on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Knative管道组件在Kubernetes上自动构建和部署应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-knative-pipelining-component-to-automate-an-application-build-and-deployment-on-442b0b1bebf?source=collection_archive---------6-----------------------#2019-07-09">https://itnext.io/how-to-use-knative-pipelining-component-to-automate-an-application-build-and-deployment-on-442b0b1bebf?source=collection_archive---------6-----------------------#2019-07-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c69371141ad9289c73eac0fdf1e22234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mk54eDy-AKFUejva8HOz4A@2x.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来自<a class="ae kf" href="https://pixabay.com/de/photos/person-wandern-rohrleitung-rohr-731319/" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae kf" href="https://pixabay.com/de/users/free-photos-242387/" rel="noopener ugc nofollow" target="_blank">自由照片</a>的照片</figcaption></figure><p id="27e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现代应用程序的生命周期管理的特点是使用持续集成和持续交付(CI/CD)构建链。这些通过标准化和明确定义的流程实现了应用程序的加速部署。</p><p id="7720" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Knative提供流水线组件<a class="ae kf" href="https://github.com/tektoncd/pipeline" rel="noopener ugc nofollow" target="_blank"> Tekton </a>构建模块，用于提供CI/CD系统。Tekton框架包括所有必要的模块构建、测试和部署。通过将它集成到Knative中，还可以在多云环境中运行管道。</p><p id="048e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我展示了如何使用Tekton基于我以前的文章构建一个完全自动化的容器映像。</p><h1 id="9011" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Tekton基础知识</h1><p id="aa34" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Tekton Pipeline项目通过五个额外的自定义资源定义(CRD)扩展了Kubernetes API:</p><ul class=""><li id="1b71" class="mh mi it ki b kj kk kn ko kr mj kv mk kz ml ld mm mn mo mp bi translated"><code class="fe mq mr ms mt b">tasks</code></li><li id="a51a" class="mh mi it ki b kj mu kn mv kr mw kv mx kz my ld mm mn mo mp bi translated"><code class="fe mq mr ms mt b">taskrun</code></li><li id="f345" class="mh mi it ki b kj mu kn mv kr mw kv mx kz my ld mm mn mo mp bi translated"><code class="fe mq mr ms mt b">pipeline</code></li><li id="5708" class="mh mi it ki b kj mu kn mv kr mw kv mx kz my ld mm mn mo mp bi translated"><code class="fe mq mr ms mt b">pipelinerun</code></li><li id="155d" class="mh mi it ki b kj mu kn mv kr mw kv mx kz my ld mm mn mo mp bi translated"><code class="fe mq mr ms mt b">pipelineresource</code></li></ul><p id="7c51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe mq mr ms mt b">Tasks</code>描述可以有输入和输出的单个作业，即所谓的<code class="fe mq mr ms mt b">pipelineresources</code>。使用<code class="fe mq mr ms mt b">taskrun</code>可以执行单个任务。它也将任务的输入和输出绑定到<code class="fe mq mr ms mt b">pipelineresources</code>。一个<code class="fe mq mr ms mt b">pipeline</code>描述了一个<code class="fe mq mr ms mt b">tasks</code>的列表，也可以由<code class="fe mq mr ms mt b">pipelinerun</code>执行。输入和输出也绑定到<code class="fe mq mr ms mt b">pipelineresources</code>。</p><h1 id="6ead" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">要求</h1><p id="7d1f" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">根据我以前的文章<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/deploy-a-kubernetes-cluster-on-openstack-using-kubespray-39b230b13d62">使用Kubespray </a>在OpenStack上部署Kubernetes集群和<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-knative-on-kubernetes-to-deploy-a-serverless-application-582d62fa2a9f">如何使用Knative在Kubernetes上部署无服务器应用</a>我们将向集群添加Tekton Pipelines组件。</p><h1 id="7167" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">安装Tekton管道组件</h1><p id="c401" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">组件的安装非常简单，我们需要用当前版本的yaml文件运行<code class="fe mq mr ms mt b">kubectl apply</code>命令。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/08b5f326066eee402fc97e3040d4e7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4fRRNgNcfv8A7RDJMVJsw.png"/></div></div></figure><p id="a870" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装创建了两个pod，可通过如下的<code class="fe mq mr ms mt b">kubectl get</code>命令进行检查。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/0004cbe50a688b7227e1fa0635dcd970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P8Zqc0DB8P6YV5RNYVq9OQ.png"/></div></div></figure><p id="655e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">等待pod处于运行状态很重要，如下图所示。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/33d7e5bf0b33572d1feefd72c98c1227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OrqnD2mepPSx7v2GL6GriQ.png"/></div></div></figure><h1 id="2a86" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">任务和管道准备</h1><p id="4827" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在这个例子中，我们使用了前面文章中已经使用过的<a class="ae kf" href="https://github.com/knative/docs/tree/master/docs/serving/samples/hello-world/helloworld-go" rel="noopener ugc nofollow" target="_blank">kna tive“hello world-go”</a>例子。为此，我们需要创建两个管道资源。首先，Git资源定义了Helloworld源文件所在的Git存储库。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/76a037746799c1d416efda4cc229396a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpwAxpMLGU-arRU1HTENuA.png"/></div></div></figure><p id="406c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且还需要图像资源。这描述了构建后将提供图像的注册表。对于这个例子，我使用了开放的Telekom云图像注册表。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/6816122daf46e0eebf9ba54248a103a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gLzlncnpmSkZaiRywiFwyA.png"/></div></div></figure><p id="da1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图像注册中心的凭证将由ServiceAccount提供，在<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-knative-to-automate-an-application-build-on-kubernetes-904034341f9f">如何使用Knative在Kubernetes </a>上自动构建应用程序的文章中的“构建准备”一节中有描述。</p><h2 id="3368" class="ni lf it bd lg nj nk dn lk nl nm dp lo kr nn no ls kv np nq lw kz nr ns ma nt bi translated">任务内容</h2><p id="a5ce" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">准备工作完成后，我们可以定义映像构建和上传任务。它包括两个主要部分。首先是输入，它描述了构建所需的输入类型以及相关的参数。第二，步骤。这些都包括Kaniko图像的路径、Executor命令和要传递的参数。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/d10622729cfde1ca8f77688604c5b82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_iYe6dbpDU_N1sh2lH9vQ.png"/></div></div></figure><p id="3a64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个任务描述构建映像的部署过程。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/fd7a6f8f54c247d9c81a5a63ae00150b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZ0XGgoUQCaJzsHFH8AQ3g.png"/></div></div></figure><h2 id="290f" class="ni lf it bd lg nj nk dn lk nl nm dp lo kr nn no ls kv np nq lw kz nr ns ma nt bi translated">管道定义</h2><p id="1dfd" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">下面的YAML文件定义了包括PipelineResources和上面的任务的管道。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/59055da9e3b50112597c04885d26bd5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wJk4nrvq8bVOPHWB4t1Etw.png"/></div></div></figure><h2 id="9083" class="ni lf it bd lg nj nk dn lk nl nm dp lo kr nn no ls kv np nq lw kz nr ns ma nt bi translated">管道运行</h2><p id="d8f3" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">运行管道需要PipelineRun。这将为各个任务创建必要的任务运行。并作为任务结果的收集点。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/362e7f7de0f339801097571b261e7cf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSRLcaqvk4uegnseGs8nVA.png"/></div></div></figure><p id="37cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要启动管道，必须使用以下命令按照文章的顺序执行所有创建的YAML文件。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/4e5802a63e1f5b1f3c3b0be3bc665ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ws0l4EdHHM0wWvxVnxyb8Q.png"/></div></div></figure><p id="8d44" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，以下命令显示了PipelineRun的输出。单个任务的状态类型“成功”应该是“真”，这表明任务被成功执行。</p><figure class="na nb nc nd gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/3e0c145f95e5dd4aec71960344390d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5mC_q4vlH49u1GhFCCguOA.png"/></div></div></figure><h1 id="2eab" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="0a3e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">本文展示了如何使用tecton构建一个容器映像，使其在映像注册中心可用并进行部署。Tekton目前正在开发中，并在不断扩展。2019年的路线图包括用Git事件触发管道等功能，以及工作流的扩展。由于这些原因，不时访问项目网站是值得的。</p><p id="309b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[1]泰克顿。<em class="nz"> Tekton管道</em>:<a class="ae kf" href="https://github.com/tektoncd/pipeline/blob/master/docs/README.md" rel="noopener ugc nofollow" target="_blank">https://github . com/tek toncd/pipeline/blob/master/docs/readme . MD</a></p><p id="44cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2]泰克顿。<em class="nz"> Tekton教程</em>:<a class="ae kf" href="https://github.com/tektoncd/pipeline/blob/master/docs/tutorial.md" rel="noopener ugc nofollow" target="_blank">https://github . com/tektoncd/pipeline/blob/master/docs/Tutorial . MD</a></p><p id="db99" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[3]泰克顿。<em class="nz"> Tekton路线图2019</em>:<a class="ae kf" href="https://github.com/tektoncd/pipeline/blob/master/roadmap-2019.md" rel="noopener ugc nofollow" target="_blank">https://github . com/tek toncd/pipeline/blob/master/Roadmap-2019 . MD</a></p></div></div>    
</body>
</html>