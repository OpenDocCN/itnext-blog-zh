<html>
<head>
<title>Vue + Firebase + Google Cloud: How to set up your CI/CD pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue + Firebase + Google Cloud:如何建立你的CI/CD管道</h1>
<blockquote>原文：<a href="https://itnext.io/vue-firebase-google-cloud-how-to-set-up-your-ci-cd-pipeline-3b309ef37015?source=collection_archive---------3-----------------------#2019-08-20">https://itnext.io/vue-firebase-google-cloud-how-to-set-up-your-ci-cd-pipeline-3b309ef37015?source=collection_archive---------3-----------------------#2019-08-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5ca1cdc859b4e777f54dcada851b189d.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*Urodh3rKzpwtZtRpozVpHw.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">Vue、Firebase和谷歌云</figcaption></figure><p id="20b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将向您展示如何使用Google Cloud Build创建一个简单的CI/CD管道。这将执行以下操作:</p><ul class=""><li id="e23b" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">测试您的代码</li><li id="aa40" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用云构建构建您的应用</li><li id="0908" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">部署firebase功能和Vue应用程序</li><li id="d3f5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">安全地配置环境变量</li></ul><h1 id="cd11" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">先决条件</h1><ul class=""><li id="3e47" class="kw kx iq ka b kb mi kf mj kj mk kn ml kr mm kv lb lc ld le bi translated">安装<a class="ae mn" href="https://github.com/firebase/firebase-tools" rel="noopener ugc nofollow" target="_blank">消防基础工具</a></li><li id="e688" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">安装<a class="ae mn" href="https://cloud.google.com/sdk/gcloud/" rel="noopener ugc nofollow" target="_blank">谷歌云</a></li></ul><p id="a26d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将使用<a class="ae mn" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>来创建我的前端应用程序，你可以在这里看到结果<a class="ae mn" href="https://ci-app-c24b6.web.app/" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="d5ab" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">建立一个Firebase项目</h1><ul class=""><li id="e65b" class="kw kx iq ka b kb mi kf mj kj mk kn ml kr mm kv lb lc ld le bi translated">如果您没有帐户，请注册<a class="ae mn" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> firebase </a></li><li id="3213" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">导航到firebase控制台并创建一个新项目</li><li id="b1e2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">在测试模式下创建一个新的<a class="ae mn" href="https://firebase.google.com/docs/firestore" rel="noopener ugc nofollow" target="_blank"> firestore </a>数据库</li><li id="8d36" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">为您的项目启用计费。您每天将获得120分钟的免费构建时间，因此无需付费，但是必须启用计费才能使用云构建</li></ul><p id="268e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将能够从firebase控制台管理您的项目，因此请保持选项卡打开。</p><h1 id="db95" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">配置谷歌云平台</h1><p id="24f6" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">首先，我们<a class="ae mn" href="https://cloud.google.com/apis/docs/getting-started" rel="noopener ugc nofollow" target="_blank">启用云构建API </a>。确保您已启用计费</p><p id="92cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们授予云构建对我们项目的访问权</p><ul class=""><li id="d403" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">导航至IAM &amp; admin</li><li id="814d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">向@ cloud services . gserviceaccount . com添加角色</li><li id="cc28" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">云功能开发人员、Firebase管理员、服务帐户用户和API密钥管理员</li></ul><p id="6238" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有这些角色，构建管道将无法工作。因此，请仔细检查您是否已将它们全部添加。</p><h1 id="64d9" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">部署firebase docker容器</h1><p id="e916" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">为了部署我们的应用程序，我们需要一个可以运行firebase的远程环境。我们可以使用<a class="ae mn" href="https://github.com/GoogleCloudPlatform/cloud-builders-community" rel="noopener ugc nofollow" target="_blank">社区构建者</a> firebase图像。</p><h2 id="d25d" class="mr ll iq bd lm ms mt dn lq mu mv dp lu kj mw mx ly kn my mz mc kr na nb mg nc bi translated">如果您使用的是windows，在运行下面的代码之前，请将“firebase.bash”的行尾改为LF。</h2><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="3433" class="mr ll iq ni b gy nm nn l no np">git clone <a class="ae mn" href="https://github.com/GoogleCloudPlatform/cloud-builders-community" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/cloud-builders-community</a></span><span id="81bc" class="mr ll iq ni b gy nq nn l no np">cd cloud-builders-community/firebase</span><span id="d688" class="mr ll iq ni b gy nq nn l no np">gcloud builds submit --config cloudbuild.yaml .</span></pre><p id="9a6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要切换项目运行</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="46fa" class="mr ll iq ni b gy nm nn l no np">gcloud config set project &lt;project-id&gt;</span></pre><p id="49c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过导航到Google Cloud Platform <a class="ae mn" href="https://console.cloud.google.com/home/" rel="noopener ugc nofollow" target="_blank">控制台</a>中的容器注册表，检查您的容器是否已经部署。</p><h1 id="c5ae" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建应用程序</h1><p id="3e43" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我已经创建了应用程序，因此我们可以只关注CI/CD。</p><p id="f197" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">分叉<a class="ae mn" href="https://github.com/llewellyn1411/vue_gcp_ci_app" rel="noopener ugc nofollow" target="_blank"> app </a>运行</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="35a4" class="mr ll iq ni b gy nm nn l no np">npm i<br/>cd functions<br/>npm i</span></pre><h1 id="f21e" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建一个. env文件</h1><p id="b276" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">在根文件夹中创建一个. env文件</p><p id="2ff9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如下设置你的Firebase配置。您可以在Firebase控制台中获得Firebase应用程序配置</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="437b" class="mr ll iq ni b gy nm nn l no np">VUE_APP_FIREBASE_API_KEY=<br/>VUE_APP_FIREBASE_AUTH_DOMAIN=<br/>VUE_APP_FIREBASE_DATABASE_URL=<br/>VUE_APP_FIREBASE_PROJECT_ID=<br/>VUE_APP_FIREBASE_STORAGE_BUCKET=<br/>VUE_APP_FIREBASE_MESSAGE_SENDER_ID=<br/>VUE_APP_FIREBASE_APP_ID=</span></pre><p id="4823" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不想公开Firebase API，所以添加。env到你的。gitignore文件。</p><h1 id="1a27" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建云构建文件</h1><p id="6d7e" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">在根文件夹中创建cloudbuild.yaml</p><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nr"><img src="../Images/890116a5629fa7d07f2d18cd44a461fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwnZmcxupWHNb44_pC743Q.jpeg"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">cloudbuild.yaml</figcaption></figure><h1 id="64c8" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建Git触发器</h1><p id="d391" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">现在我们已经创建了管道，我们需要在回购发生变化时执行它。</p><ol class=""><li id="6139" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nw lc ld le bi translated">导航至谷歌云平台&gt;云构建&gt;触发器</li><li id="32f2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nw lc ld le bi translated">“添加触发器”并按照提示操作</li><li id="241b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nw lc ld le bi translated">设置名称</li><li id="e47b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nw lc ld le bi translated">将构建配置设置为云构建</li><li id="67c3" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nw lc ld le bi translated">添加Vue替代变量，与本地. env中设置的变量相同。</li></ol><figure class="nd ne nf ng gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ns nt di nu bf nv"><div class="gh gi nx"><img src="../Images/1a4f770dd73ae38a7c39c0e07b07cf93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sx8agm2BFxgQ_xEgobirOg.jpeg"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">云构建触发器</figcaption></figure><p id="9448" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<a class="ae mn" href="https://cloud.google.com/cloud-build/docs/configuring-builds/substitute-variable-values" rel="noopener ugc nofollow" target="_blank">替换</a>意味着我们不必担心加密。env并可以通过GCP触发器更改密钥。</p><p id="988d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">摆弄扳机设置，让它在你想要的时候准确地开火</p><h1 id="342d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">把所有的放在一起</h1><p id="9dfa" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">我们到目前为止所做工作的快速总结:</p><ul class=""><li id="2a72" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">配置了一个Firebase项目</li><li id="1849" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">已配置的GCP和云构建</li><li id="9ed2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">创建了Git触发器</li><li id="b06a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用客户端和服务器代码创建和应用程序</li><li id="22dc" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">创建了一个云构建管道来测试和部署我们的代码</li></ul><p id="cda1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在剩下要做的就是提交和推送您的代码。导航到云构建仪表板以监控您的构建。希望所有的步骤都能成功执行。现在应该已经部署了您的函数和客户机。</p><h1 id="1fb9" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">感谢</h1><p id="4b4f" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">本文灵感来自火船<a class="ae mn" href="https://fireship.io/lessons/ci-cd-with-google-cloud-build/" rel="noopener ugc nofollow" target="_blank">教程</a>。我已经把它改成更适合Vue和windows的了。我还使用了不同的部署方法。如果你没有看过Fireships的作品，我强烈推荐你去看看他的<a class="ae mn" href="https://www.youtube.com/channel/UCsBjURrPoezykLs9EqgamOA" rel="noopener ugc nofollow" target="_blank"> youtube频道</a>。</p><p id="6866" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在推特上关注我</p></div></div>    
</body>
</html>