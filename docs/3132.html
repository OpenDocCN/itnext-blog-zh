<html>
<head>
<title>Reverse-engineer docker files and visualize docker-compose files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反向工程docker文件和可视化docker-compose文件</h1>
<blockquote>原文：<a href="https://itnext.io/reverse-engineer-docker-files-and-visualize-docker-compose-files-80a86c33e031?source=collection_archive---------4-----------------------#2019-10-09">https://itnext.io/reverse-engineer-docker-files-and-visualize-docker-compose-files-80a86c33e031?source=collection_archive---------4-----------------------#2019-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6ed4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Docker-compose文件可能会变得非常复杂，在某些情况下，您不仅希望记录docker-compose.yml内容，还希望可视化不同的docker-compose服务如何通信。此外，对docker文件进行逆向工程，以便更好地理解它们是由什么构成的，这可能非常有趣。</p><p id="604f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有不同的方法可以做到这一点，我想深入探讨一些最流行的方法。</p><p id="3b6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从dfimage开始，这是一个Docker文件的逆向工程项目，它大大简化了这项任务。</p><p id="47bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您愿意，您可以简单地使用可用的dockerhub映像，当然也可以自己构建项目。</p><p id="777a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要针对本地(已经提取的)docker映像运行映像，只需执行:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="9eb8" class="ku kv iq kq b gy kw kx l ky kz">docker images <br/># to pick your image id # or pull an image </span><span id="e4d2" class="ku kv iq kq b gy la kx l ky kz">docker pull grafana/grafana #as an example </span><span id="43bc" class="ku kv iq kq b gy la kx l ky kz"># docker run -v /var/run/docker.sock:/var/run/docker.sock laniksj/dfimage imageID </span><span id="d694" class="ku kv iq kq b gy la kx l ky kz">docker run -v /var/run/docker.sock:/var/run/docker.sock laniksj/dfimage 808a15f85914</span></pre><p id="5d57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该项目需要访问docker.sock来访问图像细节，因此使用-v /var/run/docker.sock运行它…</p><p id="a719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Grafana图像的输出看起来就像这样，可以让您很好地了解图像是如何构建的:</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lb"><img src="../Images/4c2a84a2a70d67475e402a972c418e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jy7gnumH7J0JemJA6TCRNQ.png"/></div></div></figure><p id="65e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目可以在这里找到:<a class="ae lj" href="https://github.com/LanikSJ/dfimage" rel="noopener ugc nofollow" target="_blank">https://github.com/LanikSJ/dfimage</a></p><h1 id="ee67" class="lk kv iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">跳水</h1><p id="3294" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">dive是一个探索docker图像每一层的工具。它不仅有助于审核docker图像，还可以找到缩小图像大小的方法。</p><p id="d057" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和往常一样，你可以构建dive命令，下载一个版本或者使用docker容器。在这个例子中，我使用了debian版本0.8.1:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="9dcb" class="ku kv iq kq b gy kw kx l ky kz">wget <a class="ae lj" href="https://github.com/wagoodman/dive/releases/download/v0.8.1/dive_0.8.1_linux_amd64.deb" rel="noopener ugc nofollow" target="_blank">https://github.com/wagoodman/dive/releases/download/v0.8.1/dive_0.8.1_linux_amd64.deb</a> </span><span id="c8c7" class="ku kv iq kq b gy la kx l ky kz">sudo dpkg -i dive_0.8.1_linux_amd64.deb </span><span id="d060" class="ku kv iq kq b gy la kx l ky kz"># check the Grafana image <br/>dive 808a15f85914 <br/>Fetching image... (this can take a while with large images) <br/>Parsing image... <br/>Analyzing image... <br/>Building cache...</span></pre><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mm"><img src="../Images/8fd42c35524843e60dac3b0126e93ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bXpMirH1gd_kLWud.gif"/></div></div></figure><p id="1193" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目演示视频</p><p id="a68b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的Grafana图像看起来更像这样</p><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mn"><img src="../Images/2190ef00c8207a38819bd6f307e14c1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LG7pIQpuxV5izPM9uVsNkw.png"/></div></div></figure><p id="4824" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个不错的dive特性是通过将CI变量设置为true来集成到CI构建过程中</p><p id="409f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">CI =真潜&lt;your-image&gt;T3】</strong></p><p id="3f9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">发布下载可以在这里找到:【https://github.com/wagoodman/dive/releases/tag/v0.8.1 T4】</p><p id="c513" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">潜水项目可以在这里找到:</p><p id="90bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lj" href="https://github.com/wagoodman/dive" rel="noopener ugc nofollow" target="_blank">https://github.com/wagoodman/dive</a></p><h1 id="fe22" class="lk kv iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Docker-Compose-Viz</h1><p id="dcc2" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我想介绍的最后一个项目是docker-compose文件的可视化。当您想要在docker-compose文件中可视化端口或不同服务之间的通信时，这非常方便。它使用graphviz项目创建一个图像文件。请确保您在docker-compose.yml文件所在的目录下运行以下命令，并确保您拥有写权限。</p><p id="ec03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行该命令后，您也将在该目录中找到docker-compose.png文件。</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="d88a" class="ku kv iq kq b gy kw kx l ky kz">docker run --rm -it --name dcv -v $(pwd):/input pmsipilot/docker-compose-viz render -m image docker-compose.yml</span></pre><p id="04db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个例子是一个简单的<a class="ae lj" href="https://github.com/prest/prest" rel="noopener ugc nofollow" target="_blank"> prest/postgres </a>项目，基于以下docker-compose.yml文件:</p><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="4111" class="ku kv iq kq b gy kw kx l ky kz">version: "3"<br/>services:<br/>    prest:<br/>        image: prest/prest<br/>        links:<br/>            - "postgres:postgres"<br/>        environment:<br/>            - PREST_DEBUG=true # remove comment for enable DEBUG mode (disable JWT)<br/>            - PREST_PG_HOST=postgres<br/>            - PREST_PG_USER=prest<br/>            # - PREST_PG_PASS=prest<br/>            - PREST_PG_DATABASE=prest<br/>            - PREST_PG_PORT=5432<br/>            - PREST_JWT_DEFAULT=false # remove if need jwt<br/>        depends_on:<br/>            - postgres<br/>        ports:<br/>            - "13000:3000"<br/>    postgres:<br/>        image: postgres:latest<br/>        volumes:<br/>            - "./data:/var/lib/postgresql/data"<br/>        environment:<br/>            - POSTGRES_USER=prest<br/>            - POSTGRES_DB=prest<br/>            # - POSTGRES_PASSWORD=prest<br/>        ports:<br/>            - "15432:5432"</span></pre><figure class="kl km kn ko gt lc gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b253893e4ece91d910babb4d0d1d73b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*2CIPaqS-Li8DgBKP.png"/></div></figure><pre class="kl km kn ko gt kp kq kr ks aw kt bi"><span id="3a59" class="ku kv iq kq b gy kw kx l ky kz">version: "3.2"<br/>services:<br/>  zero:<br/>    image: dgraph/dgraph:latest<br/>    volumes:<br/>      - type: volume<br/>        source: dgraph<br/>        target: /dgraph<br/>        volume:<br/>          nocopy: true<br/>    ports:<br/>      - 5080:5080<br/>      - 6080:6080<br/>    restart: on-failure<br/>    command: dgraph zero --my=zero:5080<br/>  server:<br/>    image: dgraph/dgraph:latest<br/>    volumes:<br/>      - type: volume<br/>        source: dgraph<br/>        target: /dgraph<br/>        volume:<br/>          nocopy: true<br/>    ports:<br/>      - 18080:8080<br/>      - 19080:9080<br/>    restart: on-failure<br/>    command: dgraph alpha --my=server:7080 --lru_mb=2048 --zero=zero:5080<br/>  ratel:<br/>    image: dgraph/dgraph:latest<br/>    volumes:<br/>      - type: volume<br/>        source: dgraph<br/>        target: /dgraph<br/>        volume:<br/>          nocopy: true<br/>    ports:<br/>      - 8000:8000<br/>    command: dgraph-ratel</span><span id="4485" class="ku kv iq kq b gy la kx l ky kz">volumes:<br/>  dgraph:</span></pre><figure class="kl km kn ko gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mp"><img src="../Images/252f2156400a1bac459b36dd14218243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6bGTqKNQOQUmeUnh.png"/></div></div></figure><p id="c7cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据服务的数量和复杂程度，你可以生成一些大小合适的图像——所以一定要有一个大屏幕。</p><p id="6cb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker-compose viz项目可以在这里找到:<a class="ae lj" href="https://github.com/pmsipilot/docker-compose-viz" rel="noopener ugc nofollow" target="_blank">https://github.com/pmsipilot/docker-compose-viz</a></p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="a01c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mx">原载于2019年10月9日</em><a class="ae lj" href="https://www.opvizor.com/reverse-engineer-docker-files-and-visualize-docker-compose-files" rel="noopener ugc nofollow" target="_blank"><em class="mx">【https://www.opvizor.com】</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>