<html>
<head>
<title>CSV or JSON export with Firebase Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Firebase函数的CSV或JSON导出</h1>
<blockquote>原文：<a href="https://itnext.io/csv-or-json-export-with-firebase-functions-fa4a4b1416aa?source=collection_archive---------3-----------------------#2018-02-28">https://itnext.io/csv-or-json-export-with-firebase-functions-fa4a4b1416aa?source=collection_archive---------3-----------------------#2018-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4c161f1fc512a9a6dfbb7a64de7de297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGLVD4OsDN2aO8B979sh_g.png"/></div></div></figure><blockquote class="jy jz ka"><p id="f1a3" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fcsv-or-json-export-with-firebase-functions-fa4a4b1416aa%3Futm_source%3Dmedium_sharelink%26utm_medium%3Dsocial%26utm_campaign%3Dbuffer" rel="noopener ugc nofollow" target="_blank">点击这里在LinkedIn上分享这篇文章</a></p></blockquote><p id="c753" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我花时间使用firebase函数已经有一段时间了，我非常喜欢使用它。</p><p id="f05f" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">从更新数据到生成报告，几乎所有事情都可以通过它实现自动化。几天前，我的客户向我要一份Firestore的excel报告，所以我写了一个函数，帮助他们随时生成新的报告。</p><p id="a5cd" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">基本上，它的工作原理是一个HTTP GET请求将发送并触发firebase运行一个特定的功能。之后，每当他们打开那个特定的URL，一个JSON将被返回到屏幕或者一个CSV文件将被直接下载。</p><p id="9327" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">我假设你知道如何写一个firebase函数。如果没有，请阅读本<a class="ae la" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank">入门指南</a>。</p><p id="a916" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">下面是HTTP请求函数的结构:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="3f39" class="ln lo iq lj b gy lp lq l lr ls">exports.csvJsonReport = functions.https.onRequest((request, response) =&gt; {<br/>   // Your code goes here<br/>   var report = {'a': 0, 'b': 1}; // your object</span><span id="fefb" class="ln lo iq lj b gy lt lq l lr ls">})</span></pre><p id="3c3c" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">您应该知道如何操作firestore或实时数据库来获取JSON格式的数据。之后，如果您愿意，可以通过使用以下代码将对象返回到屏幕上</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="dc67" class="ln lo iq lj b gy lp lq l lr ls">// Return JSON to screen<br/>  response.status(200).json(report);</span></pre><p id="a4c7" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果你想在每次调用这个函数的时候得到CSV，那么你可以使用这个代码</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="da4c" class="ln lo iq lj b gy lp lq l lr ls">// Remember to install json2csv package before you can use it<br/>const json2csv = require("json2csv").parse;</span><span id="5743" class="ln lo iq lj b gy lt lq l lr ls">// If you want to download a CSV file, you need to convert the object to CSV format<br/>// Please read this for other usages of json2csv - <a class="ae la" href="https://github.com/zemirco/json2csv" rel="noopener ugc nofollow" target="_blank">https://github.com/zemirco/json2csv</a></span><span id="d5ff" class="ln lo iq lj b gy lt lq l lr ls">  const csv = json2csv(report)</span><span id="9772" class="ln lo iq lj b gy lt lq l lr ls">  response.setHeader(<br/>    "Content-disposition",<br/>    "attachment; filename=report.csv"<br/>  )</span><span id="424a" class="ln lo iq lj b gy lt lq l lr ls">  response.set("Content-Type", "text/csv")<br/>  response.status(200).send(csv)</span></pre><p id="3717" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">通过这样做，你可以将URL直接复制并粘贴到你的浏览器中，或者将其嵌入到你的应用程序中的一个按钮中。无论哪种方式，您都可以获得您喜欢的数据类型。</p><p id="4728" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">请检查Firebase函数片段的存储库。我会经常更新它；)</p><p id="2bb3" class="pw-post-body-paragraph kb kc iq ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">【https://github.com/dalenguyen/firebase-functions-snippets T4】</p></div></div>    
</body>
</html>