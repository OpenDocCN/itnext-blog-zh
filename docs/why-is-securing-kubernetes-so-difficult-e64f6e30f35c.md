# 为什么保护 Kubernetes 如此困难？

> 原文：<https://itnext.io/why-is-securing-kubernetes-so-difficult-e64f6e30f35c?source=collection_archive---------3----------------------->

![](img/c131c5a58910d760b0a28c969dd99a21.png)

如果你已经熟悉 Kubernetes，标题中的问题可能会在你内心深处引起共鸣。如果你刚刚开始你的[云原生](https://container-solutions.com/what-is-cloud-native/)之旅，而 Kubernetes 代表着一座即将征服的山峰，你会很快意识到这个问题的相关性。

在最好的情况下，安全性是很难的，但是当您的软件应用程序由大量运行在容器中的小型、动态、可伸缩、分布式微服务组成时，它会变得更加困难。不仅仅是环境的短暂性增加了困难，新工作流和工具链的采用也带来了新的安全考虑。

让我们再深入一点。

# 技能

首先，Kubernetes 和容器化微服务交付管道中使用的一些其他工具很复杂。他们有一个陡峭的学习曲线，受制于频繁变化的激进发布周期，并且需要相当大的努力来保持平台安全性的所有细微方面的顶部。如果负责安全的团队成员不知道应该如何保护平台，或者更糟糕的是，没有人被分配责任，那么可以想象，平台中可能存在明显的安全漏洞。往好的方面说，这可能会让[尴尬](https://arstechnica.com/information-technology/2018/02/tesla-cloud-resources-are-hacked-to-run-cryptocurrency-mining-malware/)，往坏的方面说，可能会产生有害的后果。

# 焦点

为了成为所选市场的创新者，或者更灵活地响应外部市场力量(例如，客户需求或竞争对手活动)，新老组织、小组织和大组织都在忙于采用 DevOps 实践。重点是新功能和修复的交付速度，开发和运营之间的传统界限变得模糊。当我们开发和定义我们的集成、测试和交付管道时，我们考虑操作方面是很好的，但是安全性呢？安全不应该是事后的想法；它需要成为软件开发生命周期不可分割的一部分，在过程的每一步都要考虑。遗憾的是，情况往往并非如此，但人们越来越认识到安全性需要“左移”，并在交付渠道中得到满足。这种做法被称为[持续安全。](https://www.csoonline.com/article/3245748/devops/what-is-devsecops-developing-more-secure-applications.html)

# 复杂性

我们已经提到了 Kubernetes 和它的共生工具在本质上很复杂，有点难以掌握。但是情况变得更糟，因为 Kubernetes 堆栈中有多个层，每个层都有自己的安全考虑。仅仅锁定一层而忽略组成堆栈的其他层是不够的。这有点像锁上门，而让窗户大开着。

不得不考虑和实现多层安全性会增加复杂性。但它也有一个有益的副作用；它提供了“T0”深度防御，这样，如果一个安全机制被潜在攻击者绕过，同一层或另一层中的另一个机制可以介入并使攻击无效。

# 保护所有层

那么，在 Kubernetes 平台中需要保护哪些层呢？

首先，有一个基础设施层，由机器和它们之间的网络连接组成。这些机器可能由物理或抽象的硬件组件组成，并且将运行操作系统和(通常)Docker 引擎。

其次，还有一个由 Kubernetes 集群组件组成的基础设施层；主节点上运行的控制平面组件，以及与工作节点上运行的容器工作负载交互的组件。

下一层处理对 Kubernetes 应用各种安全控制，以便控制集群内部的访问，定义运行容器工作负载的策略，并提供工作负载隔离。

最后，工作负载安全层处理容器工作负载本身的安全性、来源和完整性。该安全层不仅应该处理有助于管理工作负载安全性的工具，还应该处理如何将这些工具整合到端到端工作流中。

# 一些常见的主题

了解一些贯穿大多数需要我们考虑的层的常见安全主题是很有用的。提前认识到它们，并在它们的应用中采取一致的方法，可以极大地帮助实施安全策略。

*   **最小特权原则** —在更广泛的 IT 安全中普遍应用的原则，它关注的是限制用户和应用服务对可用资源的访问，以使提供的访问仅足以执行分配的功能。这有助于防止特权升级；例如，如果一个容器工作负载受到损害，并且它的部署权限仅够执行其任务，那么损害的后果仅限于分配给该工作负载的权限。
*   **软件货币** —保持软件最新对于保持平台安全至关重要。不言而喻，应尽可能快地应用与安全相关的补丁，其他软件组件在应用于生产服务之前，应在测试环境中进行彻底的测试。在部署全新的主要版本(例如 2.0)时，需要注意一些事项，一般来说，在生产环境中部署 alpha、beta 或发布候选版本是不明智的。有趣的是，这并不一定适用于与 Kubernetes 对象相关的 API 版本。例如，常用的入口对象的 API 从 Kubernetes v1.1 开始就已经是版本`v1beta1`了。
*   **日志&审计**——能够回头查看是什么或谁发起了特定的动作或动作链，这对于维护平台的安全性非常有价值。应该在平台堆栈的所有层中配置审计事件的日志记录，包括使用审计策略对 Kubernetes 集群活动的审计。审计日志应该使用日志运送器(如 [Fluentd](https://www.fluentd.org/) 或 [Filebeat](https://www.elastic.co/products/beats/filebeat) )收集并运送到中央存储库，在那里可以使用 [Elasticsearch](https://www.elastic.co/products/elasticsearch) 或公共云等工具存储日志以供后续分析。
*   **安全性与工作效率的权衡** —在某些情况下，安全性可能会被视为工作效率的障碍；尤其是开发人员的生产力。例如，如果允许开发团队以更快的速度前进，那么允许特权容器的执行所带来的风险可能是可以接受的。对于开发环境、生产环境，甚至是用于学习和尝试的操场环境，安全性和生产力(以及其他因素)之间的权衡是不同的。在一种环境下不可接受的，在另一种环境下可能完全可以接受。然而，与放松安全限制相关的风险不应被忽视；应该仔细计算，并尽可能减轻。例如，特权容器的使用可以通过使用 Kubernetes-native 安全控制(如 RBAC 和 Pod 安全策略)来缓解。

# 系列大纲

在 Kubernetes 平台上配置安全性很困难，但并非不可能！这是名为 ***保护 Kubernetes for Cloud Native Applications***的系列文章中的一篇介绍性文章，旨在揭示 Kubernetes 平台的安全性。我们不可能涵盖每个主题和每个方面，但我们的目标是提供每个层的安全要求的良好概述，以及我们为客户运行生产级 Kubernetes 集群的经验中的一些见解。

该系列文章包括以下内容:

*   为什么保护 Kubernetes 如此困难？(本文)
*   保护 Kubernetes 集群的基础设施
*   保护 Kubernetes 集群组件的配置
*   对 Kubernetes 集群应用最佳实践安全控制
*   管理 Kubernetes 容器工作负载的安全性

由[Puja Abbas si](https://twitter.com/puja108)——开发者倡议@ [巨型群体](https://giantswarm.io/)撰写

[](https://twitter.com/puja108) [## Puja Abbassi (@puja108) |推特

### Puja Abbassi 的最新推文(@puja108)。开发者倡导者@ GiantSwarm & Researcher 主题:码头工人…

twitter.com](https://twitter.com/puja108)