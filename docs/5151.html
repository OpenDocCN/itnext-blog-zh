<html>
<head>
<title>Network Connectivity in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振中的网络连通性</h1>
<blockquote>原文：<a href="https://itnext.io/network-connectivity-in-flutter-15e16c2598f?source=collection_archive---------0-----------------------#2020-12-24">https://itnext.io/network-connectivity-in-flutter-15e16c2598f?source=collection_archive---------0-----------------------#2020-12-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fdb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一篇关于如何在Flutter中检查网络连接的快速文章。我们将看到在Flutter中检查网络连通性的三种方法。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/289eb9a2c5b9e995d975d8b4008f676a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SLCJeRLl26EhCxY65EdZw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">颤振中的网络连通性</figcaption></figure><h1 id="6640" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">视频教程</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">颤振中的网络连通性</figcaption></figure><h1 id="c3bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加依赖关系</h1><p id="013b" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">我们将使用下面的依赖关系来实现这一点。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="3f0d" class="ml lc iq mh b gy mm mn l mo mp">connectivity 2.0.2<br/>provider 4.3.2+3</span></pre><p id="b239" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mq" href="https://pub.dev/packages/connectivity" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/connectivity</a></p><h1 id="8773" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">方法1</h1><p id="36c2" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">我将从代码本身开始</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="f93e" class="ml lc iq mh b gy mm mn l mo mp">String _networkStatus1 = '';<br/> <br/>Connectivity connectivity = Connectivity();<br/> <br/>void checkConnectivity1() async {<br/>    var connectivityResult = await connectivity.checkConnectivity();<br/>    var conn = getConnectionValue(connectivityResult);<br/>    setState(() {<br/>      _networkStatus1 = 'Check Connection:: ' + conn;<br/>    });<br/>}<br/> <br/>// Method to convert the connectivity to a string value<br/>String getConnectionValue(var connectivityResult) {<br/>  String status = '';<br/>  switch (connectivityResult) {<br/>    case ConnectivityResult.mobile:<br/>      status = 'Mobile';<br/>      break;<br/>    case ConnectivityResult.wifi:<br/>      status = 'Wi-Fi';<br/>      break;<br/>    case ConnectivityResult.none:<br/>      status = 'None';<br/>      break;<br/>    default:<br/>      status = 'None';<br/>      break;<br/>  }<br/>  return status;<br/>}</span></pre><p id="a96d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这真的很简单。</p><p id="7190" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们创建一个连接对象，并对其调用checkConnectivity，并根据返回值确定它是否连接到WiFi、移动设备或未连接。</p><h1 id="300b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">方法2</h1><p id="1ae4" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">使用订阅，我们可以订阅网络变更事件。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="dad4" class="ml lc iq mh b gy mm mn l mo mp">String _networkStatus2 = '';<br/> <br/>Connectivity connectivity = Connectivity();<br/>StreamSubscription&lt;ConnectivityResult&gt; subscription;<br/> <br/><a class="ae mq" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>void initState() {<br/>  super.initState();<br/>  checkConnectivity2();<br/>}<br/> <br/>// Method2 - Using Subscription<br/>void checkConnectivity2() async {<br/>  // Subscribe to the connectivity change<br/>  subscription =<br/>      connectivity.onConnectivityChanged.listen(<br/>    (ConnectivityResult result) {<br/>    var conn = getConnectionValue(result);<br/>    setState(() {<br/>      _networkStatus2 = '&lt;Subscription&gt; :: ' + conn;<br/>    });<br/>  });<br/>}</span></pre><p id="d6a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是另一个使用订阅的简单解决方案。</p><p id="56aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们创建一个S <em class="mr">流订阅</em>来监听它，然后我们在方法1上使用相同的getConnectionValue来确定连接性。</p><p id="a16b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<em class="mr"> onConnectivityChanged </em>”就是我们正在收听的流。</p><h1 id="6793" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">方法3</h1><p id="9f40" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">如果你想通过应用程序<br/>收听网络变化，当网络变化时，小工具会自动更新..<br/>为此，我们在应用程序的根级别使用stream provider<br/>在整个应用程序中传播更改。为此，我们将使用提供商。让我们创建一个新的类来管理它。<br/>从您想要监听更改的位置转到根小部件<br/>让我们打开添加了该类的<em class="mr"> main.dart </em>文件。<br/>每当连接改变时，小组件将会更新…</p><p id="26a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建新的类连接服务。创建一个构造函数，将连接更改的值添加到流提供者，这将导致主小部件更新。</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="6c92" class="ml lc iq mh b gy mm mn l mo mp">import 'dart:async';<br/>import 'package:connectivity/connectivity.dart';<br/> <br/>class ConnectivityService {<br/>  //<br/>  StreamController&lt;ConnectivityResult&gt; connectionStatusController =<br/>      StreamController&lt;ConnectivityResult&gt;();<br/>  // Stream is like a pipe, you add the changes to the pipe, it will <br/>  // come out on the other side.<br/>  // Create the Constructor<br/> <br/>  ConnectivityService() {<br/>    // Subscribe to the connectivity changed stream<br/>    Connectivity().onConnectivityChanged.listen(<br/>      (ConnectivityResult result) {<br/>       connectionStatusController.add(result);<br/>    });<br/>  }<br/>}void checkConnectivity3() async {<br/>    var connectivityResult = Provider.of&lt;ConnectivityResult&gt;.    (context);<br/>    var conn = getConnectionValue(connectivityResult);<br/>    setState(() {<br/>        _networkStatus3 = '&lt;Provider&gt; :: ' + conn;<br/>    });<br/>}</span></pre><p id="b4bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mr"> main.dart </em>会是这样的</p><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="7284" class="ml lc iq mh b gy mm mn l mo mp">import 'package:connectivity/connectivity.dart';<br/>import 'package:flutter/material.dart';<br/>import 'widgets/Connectivity/ConnectivityDemo.dart';<br/>import 'widgets/Connectivity/ConnectivityService.dart';<br/>import 'package:provider/provider.dart';<br/> <br/>void main() {<br/>  runApp(<br/>    new HomeApp(),<br/>  );<br/>}<br/> <br/>// Wrap main widget inside the StreamProvider<br/>class HomeApp extends StatelessWidget {<br/>  <a class="ae mq" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return StreamProvider&lt;ConnectivityResult&gt;(<br/>      builder: (context) =&gt;  ConnectivityService().connectionStatusController,<br/>      child: MaterialApp(<br/>        debugShowCheckedModeBanner: false,<br/>        title: 'Flutter Tutorials',<br/>        home: new ConnectivityDemo(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><h1 id="a3be" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">完全码</h1><pre class="km kn ko kp gt mg mh mi mj aw mk bi"><span id="8e67" class="ml lc iq mh b gy mm mn l mo mp">import 'dart:async';<br/>import 'package:connectivity/connectivity.dart';<br/> <br/>class ConnectivityService {<br/>  //<br/>  StreamController&lt;ConnectivityResult&gt; connectionStatusController =<br/>      StreamController&lt;ConnectivityResult&gt;();<br/>  // Stream is like a pipe, you add the changes to the pipe, it will come<br/>  // out on the other side.<br/>  // Create the Constructor<br/> <br/>  ConnectivityService() {<br/>    // Subscribe to the connectivity changed stream<br/> <br/>    Connectivity().onConnectivityChanged.listen((ConnectivityResult result) {<br/>      connectionStatusController.add(result);<br/>    });<br/>  }<br/>}<br/> <br/> <br/>import 'package:flutter/material.dart';<br/>import 'package:flutter/widgets.dart';<br/>import 'dart:async';<br/>import 'package:connectivity/connectivity.dart';<br/>import 'package:provider/provider.dart';<br/> <br/>class ConnectivityDemo extends StatefulWidget {<br/>  ConnectivityDemo() : super();<br/> <br/>  final String title = "Connectivity Demo";<br/> <br/>  <a class="ae mq" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  ConnectivityDemoState createState() =&gt; ConnectivityDemoState();<br/>}<br/> <br/>class ConnectivityDemoState extends State&lt;ConnectivityDemo&gt; {<br/>  // In this video we will see 3 different ways to check network connectivity in Flutter.<br/>  // So Let's Start...<br/>  // First add the plugin..go to pubspec.yaml file and add.<br/>  // The Plugin link is available in the description.<br/> <br/>  // To keep it simple lets create 3 different varaibles to identify each<br/>  // import the needed pacakges<br/> <br/>  String _networkStatus1 = '';<br/>  String _networkStatus2 = '';<br/>  String _networkStatus3 = '';<br/> <br/>  Connectivity connectivity = Connectivity();<br/>  StreamSubscription&lt;ConnectivityResult&gt; subscription;<br/> <br/>  <a class="ae mq" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  void initState() {<br/>    super.initState();<br/>    checkConnectivity2();<br/>  }<br/> <br/>  // Method1<br/>  void checkConnectivity1() async {<br/>    var connectivityResult = await connectivity.checkConnectivity();<br/>    var conn = getConnectionValue(connectivityResult);<br/>    setState(() {<br/>      _networkStatus1 = 'Check Connection:: ' + conn;<br/>    });<br/>  }<br/> <br/>  // Method2 - Using Subscription<br/>  void checkConnectivity2() async {<br/>    // Subscribe to the connectivity change<br/>    subscription =<br/>        connectivity.onConnectivityChanged.listen((ConnectivityResult result) {<br/>      var conn = getConnectionValue(result);<br/>      setState(() {<br/>        _networkStatus2 = '&lt;Subscription&gt; :: ' + conn;<br/>      });<br/>    });<br/>  }<br/> <br/>  // Method3 - Using Providers<br/> <br/>  void checkConnectivity3() async {<br/>    var connectivityResult = Provider.of&lt;ConnectivityResult&gt;(context);<br/>    var conn = getConnectionValue(connectivityResult);<br/>    setState(() {<br/>      _networkStatus3 = '&lt;Provider&gt; :: ' + conn;<br/>    });<br/>  }<br/> <br/>  // Method to convert the connectivity to a string value<br/>  String getConnectionValue(var connectivityResult) {<br/>    String status = '';<br/>    switch (connectivityResult) {<br/>      case ConnectivityResult.mobile:<br/>        status = 'Mobile';<br/>        break;<br/>      case ConnectivityResult.wifi:<br/>        status = 'Wi-Fi';<br/>        break;<br/>      case ConnectivityResult.none:<br/>        status = 'None';<br/>        break;<br/>      default:<br/>        status = 'None';<br/>        break;<br/>    }<br/>    return status;<br/>  }<br/> <br/>  <a class="ae mq" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    // Update widget whenever connection changes<br/>    checkConnectivity3();<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(widget.title),<br/>      ),<br/>      body: Container(<br/>        padding: EdgeInsets.all(10.0),<br/>        child: Column(<br/>          crossAxisAlignment: CrossAxisAlignment.stretch,<br/>          children: &lt;Widget&gt;[<br/>            Text(_networkStatus1),<br/>            SizedBox(height: 20.0),<br/>            OutlineButton(<br/>              child: Text('Check Connection'),<br/>              onPressed: () {<br/>                checkConnectivity1();<br/>              },<br/>            ),<br/>            SizedBox(height: 20.0),<br/>            // This string will be updated automatically when the <br/>            // connection changes<br/>            Text(_networkStatus2),<br/>            SizedBox(height: 20.0),<br/>            Text(_networkStatus3),<br/>            SizedBox(height: 20.0),<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="383b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mr">就这样。</em></p><p id="eb1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mr">感谢阅读。请在这篇文章下面留下你的宝贵意见。</em></p></div></div>    
</body>
</html>