<html>
<head>
<title>Vue tricks: smart api module for VueJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue技巧:VueJS的智能api模块</h1>
<blockquote>原文：<a href="https://itnext.io/vue-tricks-smart-api-module-for-vuejs-b0cae563e67b?source=collection_archive---------0-----------------------#2020-10-25">https://itnext.io/vue-tricks-smart-api-module-for-vuejs-b0cae563e67b?source=collection_archive---------0-----------------------#2020-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2a26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗨，花儿们！</p><p id="973b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的朋友菲利普和他的面包店的故事之后，我们终于打开了坚实的原则的话题。为了继续提高我们的VueJS技能，我想开始一个新的部分，我称之为“Vue tricks ”,在这里我将分享我在工作中与惊人的VueJS的一些有趣的时刻。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/407d44a0b872b9dc79414ef5ba95574d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3ODlZMsFN3uCmnTY3smaA.png"/></div></figure><p id="ca53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上次，Philipp在他的面包店连接API服务时遇到了一些困难。今天我想谈谈Vue和Vuex的智能API模块。或许，有时或经常，你会注意到你的api连接代码不一致，看起来一团糟。在这篇文章中，我将分享如何创建一个新的API模块，您可以轻松地在您的Vue组件和Vuex操作中使用，只需输入</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="39b7" class="ky kz iq ku b gy la lb l lc ld">this.$api.tasks.fetch()</span></pre><p id="62e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有(在这种情况下)任务都将被提取到您的组件或存储中。</p><p id="bef0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个项目中，我决定不使用我最喜欢的TypeScript，因为，我想，许多人不会在VueJS中使用它，而只是专注于纯JavaScript。我们开始吧！</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="c534" class="ll kz iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">先决条件</h1><p id="e737" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">让我们使用vue CLI<a class="ae mn" href="https://cli.vuejs.org/" rel="noopener ugc nofollow" target="_blank"><em class="mo"/></a>开始并创建一个新的Vue项目</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="bd5a" class="ky kz iq ku b gy la lb l lc ld">vue create vue-api-module</span></pre><p id="78e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我们来说，你使用哪个版本的Vue并不重要。您可以选择Vue2+或Vue3+</p><p id="3d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应该删除项目中不用的文件。清理之后(不要忘记删除App.vue中的所有导入),源目录如下所示:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="dcd5" class="ky kz iq ku b gy la lb l lc ld">--src<br/>----store<br/>------index.js<br/>----App.vue<br/>----main.js</span></pre></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="bb7b" class="ll kz iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建API模块</h1><p id="243e" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">让我们从创建主API模块开始。</p><p id="1622" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的源文件夹中创建一个目录“<em class="mo"> services </em>”，并将文件“<em class="mo"> api.js </em>”放入其中:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="dbcc" class="ky kz iq ku b gy la lb l lc ld">--src<br/>----services<br/>------api.js<br/>----store<br/>------index.js<br/>----App.vue<br/>----main.js</span></pre><p id="a621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从创建基类开始:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><p id="5b5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个项目中，我们将使用免费的API服务<a class="ae mn" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/</a></p><p id="dfdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意阅读如何使用该服务的文档。</p><p id="dd4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我解释一下我们的基类属性和方法。</p><h2 id="84be" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">baseUrl</h2><p id="c62f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">我们所有资源的基本url。在您的项目中，您可能想要使用自己的api服务。良好的做法是使用。存储基本url的env文件。阅读更多关于。env这里:<a class="ae mn" href="https://cli.vuejs.org/guide/mode-and-env.html" rel="noopener ugc nofollow" target="_blank">https://cli.vuejs.org/guide/mode-and-env.html</a></p><h2 id="721b" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">资源</h2><p id="b2f9" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">特定资源，如用户、帖子、评论等。</p><h2 id="a6b8" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">getUrl</h2><p id="171d" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">一个助手函数，用于粘合基本url、资源和(可选)id。</p><h2 id="eea7" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">处理错误</h2><p id="76e8" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">负责错误处理的功能。</p><p id="fb2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们创建两个子类:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><p id="99e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们之间的区别在于<em class="mo">readonlyaspiservice</em>将用于我们不想写入数据的只读资源。它只有两种方法:</p><h2 id="9eb5" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">取得</h2><p id="ea26" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">去取许多物品</p><h2 id="8444" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">得到</h2><p id="51ac" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">通过id获取单个对象</p><p id="0996" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo"> ModelApiService </em>可以读写数据。它具有与<em class="mo"> ReadOnlyApiService </em>相同的方法，但是在写入数据方面多了三种方法:</p><h2 id="2e4f" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">邮政</h2><p id="4380" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">创建资源实体。</p><h2 id="c583" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">放</h2><p id="07eb" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">更新资源实体。</p><h2 id="0484" class="ky kz iq bd lm mv mw dn lq mx my dp lu jy mz na ly kc nb nc mc kg nd ne mg nf bi translated">删除</h2><p id="7b26" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">删除资源实体。</p><p id="e2a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们开始创建一个资源类。在这个项目中，出于不同的目的，我们将使用三种资源:用户、帖子和相册。</p><p id="ab89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的用户资源将是只读的。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><p id="f0f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只需要做两个动作:<br/> 1。在构造函数中指定资源的名称(在本例中为用户)。</p><p id="5f04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.继承我们想要使用的类。可能是<em class="mo"> ReadOnlyApiService </em>或者<em class="mo"> ModelApiService </em>。</p><p id="0b9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo"> UserApiService </em>包含两个<em class="mo">只读</em>方法:<em class="mo">获取</em>和<em class="mo">获取</em>。无法使用写方法:<em class="mo">贴</em>，<em class="mo">贴</em>或<em class="mo">删</em>。</p><p id="a437" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一个是<em class="mo"> PostsApiService </em></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><p id="4d12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个服务既能读又能写，并且有全部五种方法。</p><p id="aa51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以使用自定义方法轻松扩展您的服务。在<em class="mo"> AlbumsApiService </em>中，我们将创建另外两个自定义方法:<em class="mo"> uploadImage </em>和<em class="mo"> triggerError </em></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure><p id="6059" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">AlbumApiService现在有七种方法:五种基本方法和两种自定义方法。</p><p id="6cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在"<em class="mo"> api.js </em>"文件的结尾，我们将导出我们的服务:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">服务/api.js</figcaption></figure></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><h1 id="21ae" class="ll kz iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">将API服务与商店和组件连接</h1><p id="b089" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">是时候将我们的新api服务与Vue应用程序连接起来了。我们只需要把它注入到存储和组件中。</p><p id="b825" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先说Vuex店。</p><p id="6e67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个新的目录“<em class="mo">plugins”</em>，并在里面放入文件“<em class="mo"> storePlugins.js </em>”。</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="5b22" class="ky kz iq ku b gy la lb l lc ld">--src<br/>----plugins<br/>------storePlugins.js<br/>----services<br/>------api.js<br/>----store<br/>------index.js<br/>----App.vue<br/>----main.js</span></pre><p id="c2a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在"<em class="mo"> storePlugins.js </em>"中，我们将把我们的api模块注入到商店中</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">插件/storePlugins.js</figcaption></figure><p id="03e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并在<em class="mo"> src/store/index.js </em>中导入这些插件到Vuex实例中</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">商店/索引. js</figcaption></figure><p id="ef8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用全局混合对vue组件做同样的工作。</p><p id="0090" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在"<em class="mo">插件"</em>目录下新建一个文件"<em class="mo"> mixins.js" </em></p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="590e" class="ky kz iq ku b gy la lb l lc ld">--src<br/>----plugins<br/>------mixins.js<br/>------storePlugins.js<br/>----services<br/>------api.js<br/>----store<br/>------index.js<br/>----App.vue<br/>----main.js</span></pre><p id="6955" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个全局mixin $api</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">插件/mixins.js</figcaption></figure><p id="5104" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并导入到"<em class="mo"> main.js" </em>中的vue实例中</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="d3b3" class="ky kz iq ku b gy la lb l lc ld"><em class="mo">...</em><br/><em class="mo">import </em>"@/plugins/mixins";</span><span id="c788" class="ky kz iq ku b gy ng lb l lc ld">...</span></pre><p id="6f17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瞧，现在我们可以使用相同的语法在商店和组件中使用我们的$api服务了</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">使用</figcaption></figure><p id="054e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个如何在组件中使用API模块的例子</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">App.vue</figcaption></figure><p id="d604" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Vuex商店内</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mp mq l"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">存储/索引/js</figcaption></figure><p id="f98d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在我的github账户中找到所有带我评论的代码—<a class="ae mn" href="https://github.com/NovoManu/vue-api-module" rel="noopener ugc nofollow" target="_blank">https://github.com/NovoManu/vue-api-module</a></p><p id="4a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您对本文或我的其他文章感兴趣，请随时关注我:</p><p id="4048" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">github:<a class="ae mn" href="https://github.com/NovoManu" rel="noopener ugc nofollow" target="_blank">https://github.com/NovoManu</a></p><p id="2317" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推特:<a class="ae mn" href="https://twitter.com/ManuSEngineer" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ManuSEngineer</a></p><p id="0346" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想对我的同事雅各布·斯卡莱基(【https://twitter.com/jskalc】)和塞尔吉·希林戈(<a class="ae mn" href="https://twitter.com/s_shilingov" rel="noopener ugc nofollow" target="_blank">【https://twitter.com/s_shilingov】</a>)说“<em class="mo">谢谢”</em>，他们给了我一些有趣的想法来写这篇文章。</p><p id="9763" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在接下来的文章中，我想涵盖更多有趣的话题。<br/>就这些了，乡亲们！</p></div></div>    
</body>
</html>