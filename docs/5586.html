<html>
<head>
<title>Publishing a Progressive Web App (PWA) in the PlayStore – What works and what doesn’t (in 2021)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在PlayStore中发布渐进式网络应用程序(PWA)——什么可行，什么不可行(2021年)</h1>
<blockquote>原文：<a href="https://itnext.io/publishing-a-progressive-web-app-pwa-on-the-playstore-what-works-and-what-doesnt-in-2021-c4cfea5a7601?source=collection_archive---------1-----------------------#2021-04-10">https://itnext.io/publishing-a-progressive-web-app-pwa-on-the-playstore-what-works-and-what-doesnt-in-2021-c4cfea5a7601?source=collection_archive---------1-----------------------#2021-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="920c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的一年里，我一直在开发一款微日志应用程序(PWA ),我以为只要有一点点缺陷，用户就会习惯于直接从他们的浏览器安装应用程序，但是，呃……</p><p id="db43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明他们没有。还没有。</p><p id="9452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以当我意识到通过谷歌的<a class="ae kl" href="https://developer.chrome.com/docs/android/trusted-web-activity/overview/" rel="noopener ugc nofollow" target="_blank">可信网络活动(TWA) </a>你可以在PlayStore上发布一个PWA时，我很兴奋。</p><p id="cdb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果实际上非常棒，你可以在这里查看:<a class="ae kl" href="https://play.google.com/store/apps/details?id=com.journalisticapp.twa" rel="noopener ugc nofollow" target="_blank">Google Play上的新闻应用</a>。它像鸭子一样嘎嘎叫，主要是…</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/a8e25aa88bbc1b6ab89fb2a113c7c218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8GAEv2Fn7BYAzDPsXOxF0g.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">新闻TWA截图:文本输入，列表，图表，菜单</figcaption></figure><p id="be94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">新闻纸后面的栈是<a class="ae kl" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>和<a class="ae kl" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> Nuxt </a>。<a class="ae kl" href="https://pwa.nuxtjs.org/" rel="noopener ugc nofollow" target="_blank"> nuxt/pwa </a>模块负责app端与pwa相关的一切:清单、服务人员等。很简单。</p><p id="03c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你使用<a class="ae kl" href="https://github.com/GoogleChromeLabs/bubblewrap" rel="noopener ugc nofollow" target="_blank"> bubblewrap </a>的话，生成app包也差不多是简单明了的。这个应用程序的签名诡计有一些陷阱，但几个小时后，我设法有了一个工作包，它直接进入了PlayStore的审查过程。</p><p id="3905" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实证明，周六是值得的，现在超过80%的新注册来自PlayStore，没有任何美元或分钟用于推广上市(除了谷歌开发者账户的25€一次性费用)。</p><p id="d6d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要让web应用程序真正表现得像本地应用程序一样，需要相当多的黑客攻击，特别是在CSS方面，但这可以更好地完成。由于已经有很多关于这个话题的帖子，我就不在这里赘述了。让我们来看看(目前)哪些地方做得不好。</p><h1 id="e273" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">扫兴的人</h1><h2 id="5416" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">导航栏颜色</h2><p id="b6ff" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">您可以在应用程序清单中自定义导航栏颜色，但只能是静态的。对于许多应用程序来说，这可能已经足够了，但如果你有一个黑暗模式，并希望用户能够通过应用程序中的设置手动打开/关闭它，你就有问题了。我已经向bubblewrap开发者提出了这个问题，这个问题显然是Chrome方面缺乏支持。</p><p id="38e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经在一定程度上解决了这个问题，方法是检测并使用默认的系统主题(你可以为亮暗模式指定颜色)。在用户决定手动选择一个主题之前，这样做很有效。如果设备处于黑暗模式，选择的主题是“光”，事情没有那么糟糕，你在底部得到一个黑条，不理想，但也不太坏。但如果设备处于亮模式，用户选择了暗主题，他们会得到一个底部有白条的暗应用，这真的不酷。</p><h2 id="4fc3" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">状态栏颜色</h2><p id="4790" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">你也可以自定义状态栏的颜色，甚至动态地，直到再次，黑暗模式。当设备处于黑暗模式时，它总是使用奇怪的深灰色作为状态栏的背景，这就产生了一个问题:“为什么？！!"。同样的问题，局限在Chrome这边。</p><h2 id="1ff1" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">表演</h2><p id="d650" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Javascript是单线程的。您可以使用web workers实现多线程，但是对于大多数用例来说，它们不会带来任何好处，对于其他人来说，实现起来相当棘手。因此，与原生应用程序相比，TWA会感觉笨拙，反应较慢。尤其是滚动动画、图表渲染、aso。可以引进相当一些滞后和妥协的UX。</p><h2 id="c173" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">文本输入</h2><p id="e37a" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">文本输入通常是移动设备上的一个大问题，如果你在浏览器中，这个问题会变得更糟。虽然你对原生应用中的输入元素有一些控制，但处理<code class="fe mr ms mt mu b">&lt;textarea/&gt;</code>简直是一场噩梦。最重要的是，你无法控制甚至不知道软键盘在做什么。最终你将不得不调整(并且可能妥协)你的设计来应对这种怪异。</p><p id="e247" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">啊，对了，如果你在底部有一个导航条，那你就完蛋了。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mv"><img src="../Images/09ae362a6496d857d6bd17143e8c892d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYi03naPkCqHhOUZSkQjBw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">使用控件进行文本输入的新闻UX示例</figcaption></figure><h2 id="eb5f" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">货币铸造</h2><p id="1d90" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated"><a class="ae kl" href="https://developer.chrome.com/docs/android/trusted-web-activity/play-billing/" rel="noopener ugc nofollow" target="_blank">谷歌目前正在Chrome (88和89) </a>进行测试，通过<a class="ae kl" href="https://developers.google.com/web/fundamentals/payments" rel="noopener ugc nofollow" target="_blank">支付请求</a>和<a class="ae kl" href="https://github.com/WICG/digital-goods/blob/master/explainer.md" rel="noopener ugc nofollow" target="_blank">数字商品</a>API整合播放计费。这无疑是朝着正确方向迈出的一大步，但在得到完全支持之前，可能还需要一点时间。</p><p id="686b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想让你的应用程序赚钱，这可能是交易的破坏者，即使Play Billing最终完全可用，你仍然必须承担整合两个不同支付系统的负担，谷歌的一个和你用于网络应用程序的一个(<a class="ae kl" href="https://stripe.com/" rel="noopener ugc nofollow" target="_blank"> Stripe </a>或其他)。</p><h2 id="ef6f" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">数据存储</h2><p id="41bc" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">你当然可以使用本地存储，就像在浏览器中一样，但如果用户删除了他们的Chrome存储，也会删除你应用程序的数据，这是大多数用户肯定不会想到的。到目前为止，我还没有找到一种方法来解决这个问题，但tbh也没有寻找很多。</p><h2 id="c8ea" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">恼人的“在Chrome中运行”横幅</h2><p id="b785" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">当第一次打开应用程序时，TWA将显示一个横幅，通知用户它正在哪个浏览器中运行。这在我看来完全没有必要，也很烦人。它只是混淆了用户，给人一种“假”应用的印象。更好的选择是，如果应用程序安装的浏览器不是默认浏览器，则只显示横幅。</p><h2 id="87eb" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">设备API</h2><p id="1af8" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">Chrome已经支持了很多设备API(例如，远远超过Safari ),但是仍然缺少一些重要的API，而且有些API的UX非常糟糕。例如，如果你想通过BLE接入蓝牙，Chrome会在配对过程中弹出一个难看的浏览器菜单。</p><h1 id="d8b3" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">总而言之</h1><p id="2993" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">总而言之，根据您的使用情况，您已经可以获得非常接近本地的体验。大多数悬而未决的问题都很烦人，但都是小问题，在Chrome上很容易解决。可悲的是，这里的进展相当缓慢。</p><p id="aab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从长远来看，我认为上述性能问题是pwa相对于其本地同行的最大限制，问题是web技术和框架方面的进步是否能够缩小差距。</p><h1 id="7917" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">白日梦</h1><h2 id="16d5" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">谷歌浏览器</h2><p id="4a72" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">我希望在未来Chrome将支持状态的动态主题化——以及通过meta标签(文本和背景颜色)的导航栏，并摆脱黑暗模式中的怪异行为。</p><p id="f921" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">移除“在Chrome中运行”的横幅或者为它引入一个更加用户友好的UX也将是令人惊叹的。</p><p id="24e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不确定这是否可能，但是给TWAs他们自己的本地存储和cookies，独立于Chrome，将是完全病态的。</p><h2 id="9af8" class="ma ld iq bd le mb mc dn li md me dp lm jy mf mg lq kc mh mi lu kg mj mk ly ml bi translated">支付</h2><p id="4bd4" class="pw-post-body-paragraph jn jo iq jp b jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg mq ki kj kk ij bi translated">难道就不能有一个你可以集成的API，当有人买东西时，它自动计算出谁得到他们的那份？💭</p></div></div>    
</body>
</html>