<html>
<head>
<title>How to Monitor and Track Errors in Your Apps with Sentry (Angular)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Sentry (Angular)监控和跟踪应用程序中的错误</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-monitor-and-track-errors-in-your-apps-with-sentry-angular-7ef9d9b73a2a?source=collection_archive---------2-----------------------#2019-10-26">https://itnext.io/how-to-monitor-and-track-errors-in-your-apps-with-sentry-angular-7ef9d9b73a2a?source=collection_archive---------2-----------------------#2019-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/eaee07a21152bd26af08a3876fd44dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lnBSH75uHlApvEPTfLDeXA.png"/></div></div></figure><p id="adef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一下，你刚刚完成并发布了你令人惊叹的应用程序。你确定它是防错的吗？客户可能会遭受一个你从来不知道的错误，他们会徒劳地尖叫。这完全是一片混乱——我有点夸张了。</p><p id="e469" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，如果你不知道并改正错误，你的企业肯定会失去客户。没有一个适当的错误跟踪系统，你永远不会知道为什么。顾客甚至懒得让你知道。他们只是关闭它并使用其他服务。</p><p id="9e21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将向您展示如何使用Sentry为您的Angular应用程序设置一个跟踪系统，Sentry是一个开源的托管错误监控工具，可以帮助所有软件团队实时发现、分类和优先处理错误。</p><p id="0a0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第一步:你需要一个来自哨兵(开发者免费)的帐户</strong></p><p id="048e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这很简单，Sentry支持多种框架和语言。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/62cf1f12ac34dff1848b30c46d9f7c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5ezd4AWx0P-DSk5W_GFLA.png"/></div></div></figure><p id="9618" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你点击你选择的语言，你会看到一个帮助你设置系统的指南。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/3e74406594c9819eb0f0353591c493da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwVic1fVZeoj3WfXnR__zw.png"/></div></div></figure><p id="3ed0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">第二步:给你的项目添加哨兵(Angular) </strong></p><p id="8db3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在NPM设置岗哨</p><pre class="kx ky kz la gt lc ld le lf aw lg bi"><span id="5d2e" class="lh li iq ld b gy lj lk l ll lm">npm install @sentry/browser<br/>npm install @sentry/integrations</span></pre><p id="9525" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在你的<strong class="ka ir"> app.module.ts </strong>上添加initiate Sentry。该版本将帮助您连接Github commits。如果您使用TypeScript，RewriteFrames配置将帮助Sentry<a class="ae ln" href="https://docs.sentry.io/platforms/node/typescript/" rel="noopener ugc nofollow" target="_blank">使用正确的源文件</a>链接堆栈跟踪。</p><pre class="kx ky kz la gt lc ld le lf aw lg bi"><span id="cc7a" class="lh li iq ld b gy lj lk l ll lm">// app.module.ts</span><span id="3ff2" class="lh li iq ld b gy lo lk l ll lm">import * as Sentry from '<a class="ae ln" href="http://twitter.com/sentry/browser" rel="noopener ugc nofollow" target="_blank">@sentry/browser</a>'<br/>import { RewriteFrames } from '<a class="ae ln" href="http://twitter.com/sentry/integrations" rel="noopener ugc nofollow" target="_blank">@sentry/integrations</a>'</span><span id="c64e" class="lh li iq ld b gy lo lk l ll lm">Sentry.init({<br/>  dsn: &lt;your-sentry-dsn&gt;,<br/>  release: &lt;should be the same with the deployed code&gt;,<br/>  integrations: [<br/>    new RewriteFrames(),<br/>  ],<br/>})</span><span id="c639" class="lh li iq ld b gy lo lk l ll lm"><a class="ae ln" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>()<br/>export class SentryErrorHandler implements ErrorHandler {<br/>  constructor() {}<br/>  handleError(error) {<br/>    Sentry.captureException(error.originalError || error);<br/>    console.error(error)<br/>  }<br/>}</span><span id="aaa7" class="lh li iq ld b gy lo lk l ll lm"><a class="ae ln" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  providers: [{ provide: ErrorHandler, useClass: SentryErrorHandler }]<br/>})</span></pre><p id="8b7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤3:测试配置</strong></p><p id="2fe2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以在本地测试配置。你需要做的是在你的代码中调用一个未知的函数并运行它。</p><pre class="kx ky kz la gt lc ld le lf aw lg bi"><span id="9ad3" class="lh li iq ld b gy lj lk l ll lm">myUndefinedFunction()</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/a2045b85819f0f2c0c071b2af05eb05e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbmVhXG9ichLGhQqzruvgg.png"/></div></div></figure><p id="941b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将收到一封关于错误的电子邮件通知，您可以在Sentry仪表板上查看它。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lq"><img src="../Images/18ee5725f9d2f74c3a04cd4263dbf394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pksLfBcSoaB6Jmg_REaqGQ.png"/></div></div></figure><p id="93ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着从现在开始，如果客户与您的应用程序交互时出现问题，您将会知道。</p><p id="0626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤4:创建发布</strong></p><p id="cf09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发布是部署到环境中的代码版本。你应该在哨兵平台上阅读更多关于这个<a class="ae ln" href="https://docs.sentry.io/workflow/releases/?platform=browser" rel="noopener ugc nofollow" target="_blank">的内容。在创建发布之前，您应该将Sentry与您的Git存储库集成在一起。</a></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lr"><img src="../Images/f9f88a6e8faac30e27b0263492de146f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zi3bQo2Z-ZjjeOK9CcrhiA.png"/></div></div></figure><p id="5ed1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我准备了一个脚本，在你完成开发后，你可以用它来部署一个版本到Sentry。</p><pre class="kx ky kz la gt lc ld le lf aw lg bi"><span id="8c69" class="lh li iq ld b gy lj lk l ll lm">// sentry-deploy.sh</span><span id="8e7d" class="lh li iq ld b gy lo lk l ll lm">#!/bin/sh<br/>export SENTRY_AUTH_TOKEN=xxx<br/>export SENTRY_ORG=dalenguyen<br/>export SENTRY_PROJECT=dalenguyen-me</span><span id="e0cc" class="lh li iq ld b gy lo lk l ll lm"># Version from git<br/>REVISION=$(git rev-parse --short HEAD)</span><span id="b7cf" class="lh li iq ld b gy lo lk l ll lm">sentry-cli releases new -p $SENTRY_PROJECT "$SENTRY_PROJECT@$REVISION"</span><span id="597b" class="lh li iq ld b gy lo lk l ll lm">sentry-cli releases set-commits "$SENTRY_PROJECT@$REVISION" --auto</span><span id="4dc6" class="lh li iq ld b gy lo lk l ll lm"># Upload source maps<br/>sentry-cli releases files "$SENTRY_PROJECT@$REVISION" upload-sourcemaps ./dist --rewrite</span><span id="82e9" class="lh li iq ld b gy lo lk l ll lm"># Finalize<br/>sentry-cli releases finalize "$SENTRY_PROJECT@$REVISION"</span></pre><p id="abaf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住app.module.ts中的版本，它应该与sentry-deploy.sh相同。</p><pre class="kx ky kz la gt lc ld le lf aw lg bi"><span id="270a" class="lh li iq ld b gy lj lk l ll lm">git rev-parse --short HEAD</span></pre><p id="6b5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">源地图上传是非常重要的，因为在生产中你的资产是缩小的。当查看缩小的JavaScript代码时，调试您的错误会非常困难。</p><p id="3917" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，如果您准备好了源地图，您将知道哪一行代码导致了问题。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ls"><img src="../Images/734b453ebbdc7a6ac6121152bb677f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bOk8q07IoEnv8VCnW3AU2g.png"/></div></div></figure><p id="25db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有任何问题或建议，请留下评论。希望这有所帮助；)</p></div></div>    
</body>
</html>