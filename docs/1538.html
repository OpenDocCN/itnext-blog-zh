<html>
<head>
<title>Azure Pipelines: Release to Azure App Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Pipelines:发布到Azure应用服务</h1>
<blockquote>原文：<a href="https://itnext.io/azure-pipelines-release-to-azure-app-service-9068a7236d6?source=collection_archive---------4-----------------------#2018-11-18">https://itnext.io/azure-pipelines-release-to-azure-app-service-9068a7236d6?source=collection_archive---------4-----------------------#2018-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e614" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将使用上周<a class="ae kl" href="https://elanderson.net/2018/11/azure-repos-and-azure-pipelines/" rel="noopener ugc nofollow" target="_blank"> Azure Repos和Azure Pipelines </a>文章中使用的相同Azure DevOps项目，该项目有一个构建管道，并添加了一个部署到Azure应用服务的发布管道。</p><p id="aaf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本演练将假设您已经使用与Azure DevOps相同的电子邮件地址设置了一个Azure帐户。如果你没有Azure账户，就注册一个<a class="ae kl" href="https://azure.microsoft.com/en-us/free/" rel="noopener ugc nofollow" target="_blank"> Azure免费账户</a>。</p><h2 id="ebe7" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">构建更改</h2><p id="59a2" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在上周的帖子中建立的构建证明了代码已经构建，但是它实际上并没有对构建的结果做任何事情。为了使用构建的结果，我们需要发布结果文件。稍后在设置发布管道时需要用到它。</p><p id="2501" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了得到我们正在寻找的结果，一些步骤必须添加到我们的建设。所有的变化都发生在<strong class="jp ir"> azure-pipelines.yml </strong>中。以下是我关于新任务的完整yaml文件。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="573e" class="km kn iq lp b gy lt lu l lv lw">pool:<br/>  vmImage: 'Ubuntu 16.04'<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>steps:<br/>- task: DotNetCoreCLI@2<br/>  displayName: Build<br/>  inputs:<br/>    projects: '**/EfSqlite.csproj'<br/>    arguments: '--configuration $(BuildConfiguration)'<br/>- task: DotNetCoreCLI@2<br/>  displayName: Publish<br/>  inputs:<br/>    command: publish<br/>    publishWebProjects: True<br/>    arguments: '--configuration $(BuildConfiguration) --output $(build.artifactstagingdirectory)'<br/>- task: PublishBuildArtifacts@1<br/>  displayName: 'Publish Artifact'<br/>  inputs:<br/>    PathtoPublish: '$(build.artifactstagingdirectory)'</span></pre><p id="b7f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在上面的yaml中看到的，这个构建现在有三个不同的步骤。构建(这相当于上周的帖子所做的)和发布(这将所有文件放在正确的位置)任务都是使用<strong class="jp ir"> DotNetCoreCLI@2 </strong>任务来处理的。最后，<strong class="jp ir"> PublishBuildArtifacts@1 </strong>获取发布的结果，并将它们压缩到工件暂存目录中，在那里可以在发布管道中使用它们。</p><h2 id="cfd2" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建Azure应用服务</h2><p id="9a4c" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">如果您有现有的应用程序服务可以使用，请随意跳过这一部分。要创建新的应用服务，请打开<a class="ae kl" href="https://portal.azure.com" rel="noopener ugc nofollow" target="_blank"> Azure门户</a>并从左侧导航中选择<strong class="jp ir">应用服务</strong>。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/b2392a9eb425304e27d9563575c90193.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/0*pS3b1gCGlCiTPX3M.png"/></div></figure><p id="d64a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，点击<strong class="jp ir">添加</strong>按钮。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/ebb771743b6b3cbc6d9304eeb0b892e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/0*tqSPCcXXXwAMrqTw.png"/></div></figure><p id="f0bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一页，我们将选择<strong class="jp ir"> Web App </strong>。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/e93838067391dfe67dad19e9c956ff9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XbUf-Nf_9mrRPXCu.png"/></div></div></figure><p id="36f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在点击<strong class="jp ir">创建</strong>按钮。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/9703c87e47efc8692b537389127a131f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/0*0N39SpTGe2xWJy_E.png"/></div></figure><p id="799a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一页你需要输入一个<strong class="jp ir">应用名</strong>，选择<strong class="jp ir">操作系统</strong>，以及<strong class="jp ir">运行时堆栈</strong>，然后点击<strong class="jp ir">创建</strong>按钮。操作系统和运行时堆栈应该与应用程序的目标相匹配。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/ea14ffa6a2949fbf8789a3785b3b3912.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/0*VP7WvKr0WdKOS2jn.png"/></div></figure><h2 id="85ea" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建发布管道</h2><p id="6902" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在您的项目上，从左侧导航中选择<strong class="jp ir">管道&gt;释放</strong>，然后点击<strong class="jp ir">新建管道</strong>按钮。如果您已经有一个发布管道设置，此页面将看起来不同。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mj"><img src="../Images/f91a165a59dee10d0c67da60bcb4e12c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IawJ-iCMCFumqInR.png"/></div></div></figure><p id="9ef8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一页有一个模板列表，您可以从中选择。在本例中，我们将选择<strong class="jp ir"> Azure App服务部署</strong>，然后单击<strong class="jp ir">应用</strong>按钮。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/32a6772c41fcf8b44f7e812553ccd51b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/0*W24TEK5x0gIYSgF5.png"/></div></figure><h2 id="87a6" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">神器设置</h2><p id="3160" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">点击<strong class="jp ir">应用</strong>后，您将进入包含多组信息的管道概览页面。第一个是<strong class="jp ir">工件</strong>，对我们来说，这将是我们在上周的帖子中建立的构建管道的结果。点击<strong class="jp ir">添加工件</strong>框。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/fa912cfd48dacb7bbbcfa248b849dc69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*A_ySVQJkLyWXOsy-.png"/></div></figure><p id="9841" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Add an artifact对话框中，您可以选择发布将在哪里获得它的构建工件表单。我们将使用构建的源类型，并选择我们现有的构建管道。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/fa933b339601acc38c9af81982eaa52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/0*ebr7g80FuCONJY3O.png"/></div></figure><p id="4858" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦您选择您的构建管道作为<strong class="jp ir">源</strong>，就会出现更多的控件。我接受了所有的默认值。请注意截图中突出显示的框，因为如果您的构建缺少工件，它会向您发出警告。点击<strong class="jp ir">添加</strong>按钮完成。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/610b6a9f6bba74db85cf6eab28f154c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/0*_GGBLQMoQlQAIt_q.png"/></div></figure><h2 id="2307" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">舞台设置</h2><p id="2b9e" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">上面我们选择了Azure应用服务模板，它现在是我们的第一阶段。请注意红色的感叹号，这意味着stage在使用之前有一些问题需要解决。单击舞台框将其打开。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/9cf4e0f0389031d7d679bfd0e7d653f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/0*0CQf0CVP808HPbH_.png"/></div></figure><p id="ec0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如你在下面的截图中看到的，在<strong class="jp ir">部署Azure应用服务</strong>任务中缺少的设置以红色突出显示。在阶段1点击<strong class="jp ir">解除所有</strong>按钮并确认。这样做意味着在<strong class="jp ir">部署Azure应用服务</strong>任务上有更多的设置，但这是唯一可以使用的方法。NET Core 2.1。出于某种原因，Linux在Stage级别可用的最高版本是。网芯2.0。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mp"><img src="../Images/294e6ace22899763d3d4e8cd68ddcd3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UARujf6A4OXkK4-i.png"/></div></div></figure><p id="a390" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“取消链接”后，除阶段名称之外的所有选项都将被删除。接下来，点击<strong class="jp ir"> Deploy Azure App Service </strong>任务，该任务处理将为该管道放置的大量工作。这项任务有很多设定。这是我的设置的截图，我会在后面标出重要的部分。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mq"><img src="../Images/604db4c6f83d5fc09b1f05af43df70ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-33-ZYsvliunPs8L.png"/></div></div></figure><p id="81e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，选择您的<strong class="jp ir"> Azure订阅</strong>。您可能需要授权您的帐户，因此如果您看到一个<strong class="jp ir">授权</strong>按钮，请单击它并完成您的Azure帐户的登录步骤。</p><p id="cf93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">特别注意<strong class="jp ir"> App类型</strong>。在本例中，我们使用的是Linux，因此从下拉列表中选择<strong class="jp ir"> Linux应用</strong>很重要，而不仅仅是使用Web应用。</p><p id="efc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择Azure订阅和应用类型后，<strong class="jp ir">应用服务名称</strong>下拉列表应仅允许您选择订阅中存在的基于Linux的应用服务。</p><p id="cd31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<strong class="jp ir">图像源</strong>，我选择了内置图像，但是如果内置图像不能满足您的需求，它可以选择从注册表中输入使用容器。</p><p id="87d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于<strong class="jp ir">包或者文件夹</strong>，如果你只有一个单独的项目，默认应该可以。由于这一点，我有两个项目，我使用文件浏览器(……按钮)来选择我想要部署的特定zip文件。</p><p id="bc50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">运行时栈</strong>需要被。此应用程序的NET Core 2.1。</p><p id="573b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">需要设置启动命令</strong>来告诉。NET CLI来运行作为应用程序入口点的程序集。在这个例子中，这个结果是<strong class="jp ir">网络EfSqlite.dll</strong>。</p><p id="6c81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入所有设置后，点击屏幕右上角的<strong class="jp ir">保存</strong>按钮。</p><h2 id="30b9" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">执行发布管道</h2><p id="5b54" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">导航回管道&gt;发布，并选择要运行的发布。然后点击<strong class="jp ir">创建释放</strong>按钮。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mr"><img src="../Images/51bad0005311ce0ded65eb83b3856c5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OX34yWdXbEuPNX7y.png"/></div></div></figure><p id="9a27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一页，您所要做的就是选择您想要部署的工件，然后点击<strong class="jp ir"> Create </strong>按钮。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi ms"><img src="../Images/f6b1495b5b3aa6b1dc9b076b97a62473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/0*Ur4o1SjkB3qX_eUK.png"/></div></div></figure><p id="0980" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“创建”将启动发布过程，并返回到主发布页面。在发布页面的顶部会有一个链接，你可以点击它来查看发布的状态。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/e162da0ed5dae4f535a03db0b2cb684c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/0*_CnIakfBzRwlUoc2.png"/></div></figure><p id="4cca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是我发布完成后的结果。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/032c63a778f1bd6ae2fb48e7e903d883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/0*octWokt6vJObG28Y.png"/></div></figure><h2 id="b5e1" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="a849" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我花了更多的试验和错误来让这个设置运行起来，这是我所希望的，但是一旦所有的部分都运行起来，结果是令人敬畏的。最起码，我建议花时间至少建立一个当代码被签入到你的repos时触发的构建。当代码一进入回购阶段，就有一个构建被破坏的反馈，而不是发现你什么时候需要一个可交付的产品，这将为你内心的平静创造奇迹。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="0b24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nc">原载于</em><a class="ae kl" href="https://elanderson.net/2018/11/azure-pipelines-release-to-azure-app-service/" rel="noopener ugc nofollow" target="_blank"><em class="nc"/></a><em class="nc">。</em></p></div></div>    
</body>
</html>