<html>
<head>
<title>Pulsar Advantages Over Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脉冲星优于卡夫卡</h1>
<blockquote>原文：<a href="https://itnext.io/pulsar-advantages-over-kafka-7e0c2affe2d6?source=collection_archive---------0-----------------------#2020-11-10">https://itnext.io/pulsar-advantages-over-kafka-7e0c2affe2d6?source=collection_archive---------0-----------------------#2020-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ce720a2f99f5c50bf755ccb5b5c9e34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eK_A0KXNk52ukSXQ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">迈克尔·克里斯滕森在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="498d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="d35b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">最近，我一直在看<a class="ae kf" href="https://pulsar.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">脉冲星</strong> </a> <strong class="lg iu"> </strong>以及它与<a class="ae kf" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">卡夫卡</strong> </a> <strong class="lg iu">的对比。</strong>快速搜索一下，你会发现两个最著名的开源消息系统之间正在进行一场<em class="mc">战争</em>。</p><p id="91f5" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">作为一名Kafka用户，我确实为Kafka的一些问题感到困惑，我对Pulsar非常感兴趣。所以最后，我设法有一些时间来玩它，我做了相当多的研究。在这篇文章中，我将重点关注<strong class="lg iu">脉冲星的优势</strong>，并给你一些你应该考虑它而不是卡夫卡的理由。但是让我们明确一下，在生产使用、支持、社区、文档等方面；Kafka明显优于Pulsar，只有当本文中讨论的大多数优势符合您的用例时，我才会考虑Pulsar。让我们开始吧！</p><h1 id="ff19" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">《果壳中的卡夫卡》</h1><p id="736b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">卡夫卡是信息系统之王。它由LinkedIn于2011年创建，由于得到了<a class="ae kf" href="https://www.confluent.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Confluent </strong> </a>的支持而得以广泛传播，后者向开源社区发布了许多新功能和附加组件，如用于模式进化的<strong class="lg iu">模式注册表</strong>、用于从数据库等其他数据源轻松传输到Kafka的<strong class="lg iu"> Kafka Connect </strong>、用于分布式流处理的<strong class="lg iu"> Kafka Streams </strong>以及最近用于执行SQL的<strong class="lg iu"> KSQL </strong>它也有许多到许多系统的连接器，检查<a class="ae kf" href="https://de.confluent.io/product/confluent-platform/platform-ecosystem/" rel="noopener ugc nofollow" target="_blank">汇合<strong class="lg iu">平台</strong> </a>了解更多细节。</p><p id="466d" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated"><strong class="lg iu"> Kafka速度快，易于设置，非常受欢迎</strong>，可用于广泛的范围或用例。虽然从开发人员的角度来看，Apache Kafka一直很友好，但它在操作上却是一个大杂烩。所以，让我们回顾一下卡夫卡的一些痛点。</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/49a0a9fd89eba26f5b8b0aa0e1138f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xmrlLf45M19YQIrx"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">卡夫卡的例子。来源:<a class="ae kf" href="https://talks.rmoff.net/pZC6Za/slides" rel="noopener ugc nofollow" target="_blank">https://talks.rmoff.net/pZC6Za/slides</a></figcaption></figure><h2 id="f84e" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated">卡夫卡的痛点</h2><ul class=""><li id="bdb2" class="mz na it lg b lh li ll lm lp nb lt nc lx nd mb ne nf ng nh bi translated"><strong class="lg iu">扩展Kafka很棘手，</strong>这是由于耦合架构，其中代理也存储数据。剥离另一个代理意味着它必须复制主题分区和副本，这非常耗时。</li><li id="ca76" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">没有租户完全隔离的本机多租户。</li><li id="0897" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">存储可能会变得非常昂贵，尽管您可以长时间存储数据，但由于成本问题，很少使用它。</li><li id="372f" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">如果副本不同步，可能会丢失消息。</li><li id="de49" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">你必须提前计划和计算代理、主题、分区和副本的数量(适应计划的未来使用增长)以避免扩展问题，<strong class="lg iu">这是极其困难的。</strong></li><li id="d5c0" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">如果您只需要一个消息传递系统，那么使用偏移量可能会很复杂。</li><li id="bfd5" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">集群再平衡可以影响连接的生产者和消费者的性能。</li><li id="f76b" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><a class="ae kf" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=27846330" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> MirrorMaker </strong> </a> Geo复制机制有问题。像优步这样的公司已经创造了他们自己的解决方案来克服这些问题。</li></ul><p id="0b80" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">如你所见，大多数问题都与<strong class="lg iu">操作方面</strong>有关。虽然Kafka的设置相对容易，但它很难管理和调整。此外，它并不像它应该的那样灵活和有弹性。</p><h1 id="89c4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">一言以蔽之，脉冲星</h1><p id="b9df" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="lg iu"> Pulsar </strong>由<strong class="lg iu">雅虎</strong>于2013年创建，并于2016年捐赠给阿帕奇基金会。Pulsar现在是Apache的顶级项目。雅虎、威瑞森、推特以及其他公司在生产中使用它来处理数百万条信息。它有许多功能，而且非常灵活。它声称比卡夫卡更快，因此运行起来更便宜。它旨在解决Kafka的大部分痛点，使其更容易扩展。</p><p id="7af5" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">脉冲星非常灵活；它可以像<strong class="lg iu">卡夫卡</strong>一样充当分布式日志，也可以像<a class="ae kf" href="https://www.rabbitmq.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> RabbitMQ </strong> </a>一样充当纯消息传递系统。它有多种类型的订阅、多种交付保证、保留策略和多种处理模式演变的方法。它还有一大堆功能…</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/c15b04c45a0093c78202cfdcc96e5d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UA4KocXz88DHu4ky"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Pulsar架构:<a class="ae kf" href="https://pulsar.apache.org/docs/en/concepts-architecture-overview/" rel="noopener ugc nofollow" target="_blank">https://pulsar . Apache . org/docs/en/concepts-architecture-overview/</a></figcaption></figure><h2 id="6d21" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated"><a class="ae kf" href="https://pulsar.apache.org/docs/en/concepts-overview/" rel="noopener ugc nofollow" target="_blank">脉冲星特征</a></h2><ul class=""><li id="a63d" class="mz na it lg b lh li ll lm lp nb lt nc lx nd mb ne nf ng nh bi translated"><strong class="lg iu">多租户</strong>内置，不同的团队可以使用同一个集群，并被隔离。这解决了许多管理难题。它支持隔离、认证、授权和配额。</li><li id="58c0" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">多层架构</strong> : Pulsar将所有主题数据存储在由<a class="ae kf" href="https://bookkeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu">Apache BookKeeper</strong></a><strong class="lg iu"/>提供支持的专门数据层中，作为数据分类账。存储和消息传递的分离解决了扩展、重新平衡和维护集群的许多问题。它还提高了可靠性，使数据几乎不可能丢失。此外，在读取数据时，您可以直接连接到<strong class="lg iu"> Bookeeper </strong>而不影响实时接收。例如，您可以使用<strong class="lg iu"> Presto </strong>对您的主题执行SQL查询，类似于KSQL，但是不会影响实时数据处理。</li><li id="541a" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">虚拟话题</strong>。由于n层架构，主题数量没有限制，主题与其存储解耦。您还可以创建非持久性主题。</li><li id="3c5e" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu"> N层存储</strong>。卡夫卡的一个问题是，存储会变得昂贵。因此它很少用于存储“冷”数据，消息经常被删除。Apache Pulsar通过分层存储，可以自动将较旧的数据移动到亚马逊S3，或者其他任何深度存储系统；并且仍然向客户端呈现透明的视图；客户端可以从头开始读取，就好像所有消息都出现在日志中一样。</li><li id="0368" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><a class="ae kf" href="https://pulsar.apache.org/docs/en/functions-overview" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">脉冲星功能</strong> </a> <strong class="lg iu">。易于部署、轻量级计算流程、开发人员友好的API，无需像Kafka那样运行自己的流处理引擎。</strong></li><li id="f631" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">安全:它有一个内置的代理，多租户安全，可插入的认证等等。</li><li id="702e" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">快速重平衡</strong>。分区被分割成易于重新平衡的段。</li><li id="d885" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">服务器端去重和死字</strong>。无需在客户端执行此操作，也可以在压缩期间执行重复数据消除。</li><li id="6c21" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">内置于模式注册表</strong>。支持多种策略，非常容易使用。</li><li id="71b0" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">地理复制和内置发现。</strong>将集群复制到多个区域非常容易。</li><li id="0728" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">集成负载平衡器和普罗米修斯指标</strong>。</li><li id="222b" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">多重整合</strong>:卡夫卡，RabbitMQ等等。</li><li id="d734" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><a class="ae kf" href="https://pulsar.apache.org/docs/en/security-encryption/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">加密</strong> </a>支持。</li><li id="a920" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">支持许多编程语言，如GoLang，Java，Scala，Node，Python…</li><li id="ed66" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">客户端不需要知道碎片和数据分区，这是在服务器端透明完成的。</li></ul><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/43ce345289a25a50151e68172e34f0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ISCks4NkfD7ym1R0a_BCdg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">功能列表:<a class="ae kf" href="https://pulsar.apache.org/" rel="noopener ugc nofollow" target="_blank">https://pulsar.apache.org/</a></figcaption></figure><p id="9447" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">如你所见，<strong class="lg iu">脉冲星有很多有趣的特征。</strong></p><h1 id="fba0" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">脉冲星手动操作</h1><p id="7a06" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Pulsar的<a class="ae kf" href="https://pulsar.apache.org/docs/en/standalone/" rel="noopener ugc nofollow" target="_blank">入门</a>相当容易。确保你已经安装了<strong class="lg iu"> JDK </strong>！</p><ol class=""><li id="565a" class="mz na it lg b lh md ll me lp np lt nq lx nr mb ns nf ng nh bi translated">下载Pulsar并解压:</li></ol><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="231e" class="mn kh it nu b gy ny nz l oa ob">$ wget https://archive.apache.org/dist/pulsar/pulsar-2.6.1/apache-pulsar-2.6.1-bin.tar.gz</span></pre><p id="d0d9" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">2.下载连接器(可选):</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="ed16" class="mn kh it nu b gy ny nz l oa ob">$ wget https://archive.apache.org/dist/pulsar/pulsar-2.6.1/connectors/{connector}-2.6.1.nar</span></pre><p id="c062" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">3.下载nar文件后，将文件复制到pulsar目录中的<code class="fe oc od oe nu b">connectors</code>目录</p><p id="8e47" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">4.启动脉冲星！</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="2f54" class="mn kh it nu b gy ny nz l oa ob">$ bin/pulsar standalone</span></pre><p id="f95b" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">Pulsar提供了一个名为<code class="fe oc od oe nu b"><a class="ae kf" href="https://pulsar.apache.org/docs/en/reference-cli-tools#pulsar-client" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu">pulsar-client</strong></a></code>的CLI工具，我们可以用它来与集群交互。</p><p id="95ba" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">要生成消息:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="0aa6" class="mn kh it nu b gy ny nz l oa ob">$ bin/pulsar-client produce my-topic --messages "hello-pulsar"</span></pre><p id="60a5" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">要阅读邮件:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="bfaa" class="mn kh it nu b gy ny nz l oa ob">$ bin/pulsar-client consume my-topic -s "first-subscription"</span></pre><h2 id="aa04" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated">Akka流示例</h2><p id="e946" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">作为客户端示例，让我们使用<a class="ae kf" href="https://github.com/sksamuel/pulsar4s#akka-streams" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Pulsar4s </strong> </a>和<a class="ae kf" href="https://akka.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Akka </strong> </a>！</p><p id="c53e" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">首先，我们需要创建一个<strong class="lg iu">源</strong>来消费数据流，所需要的只是一个函数，它将按需创建一个消费者和要寻找的消息id:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="49d1" class="mn kh it nu b gy ny nz l oa ob">val topic = Topic("persistent://standalone/mytopic")<br/>val consumerFn = () =&gt; client.consumer(ConsumerConfig(topic, subscription))</span></pre><p id="5e48" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">然后，我们通过<code class="fe oc od oe nu b">consumerFn </code>函数来创建源:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="ac82" class="mn kh it nu b gy ny nz l oa ob">import com.sksamuel.pulsar4s.akka.streams._<br/>val pulsarSource = source(consumerFn, Some(MessageId.earliest))</span></pre><p id="2af1" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">Akka源的物化值是一个<code class="fe oc od oe nu b">Control</code>的实例，该对象提供了一个方法“<em class="mc"> close </em>”，该方法可用于停止使用消息。现在，我们可以像往常一样用<a class="ae kf" href="https://doc.akka.io/docs/akka/current/stream/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Akka Streams </strong> </a>处理数据。</p><p id="8bbf" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">要创建<strong class="lg iu">水槽</strong>:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="ba6c" class="mn kh it nu b gy ny nz l oa ob">val topic = Topic("persistent://standalone/mytopic")<br/>val producerFn = () =&gt; client.producer(ProducerConfig(topic))</span><span id="c938" class="mn kh it nu b gy of nz l oa ob">import com.sksamuel.pulsar4s.akka.streams._<br/>val pulsarSink = sink(producerFn)</span></pre><p id="ebe5" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">完整示例摘自<a class="ae kf" href="https://github.com/sksamuel/pulsar4s/blob/master/pulsar4s-akka-streams/src/test/scala/com/sksamuel/pulsar4s/akka/streams/Example.scala" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> Pulsar4s </strong> </a>:</p><figure class="mj mk ml mm gt ju"><div class="bz fp l di"><div class="og oh l"/></div></figure><h2 id="8d7f" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated">脉冲星函数示例</h2><p id="e6d6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Pulsar函数处理来自一个或多个主题的消息，对其进行转换，并将结果输出到不同的主题:</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/761750eb278d75bf3057928e30b2c372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TOBi1cLt1Uj06zz5.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">脉冲星功能。来源:https://pulsar.apache.org/docs/en/functions-overview/</figcaption></figure><p id="60fc" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">您可以在两个接口之间选择来编写您的函数:</p><ul class=""><li id="9ff9" class="mz na it lg b lh md ll me lp np lt nq lx nr mb ne nf ng nh bi translated"><strong class="lg iu">语言本地接口</strong>:不需要特定于Pulsar的库或特殊依赖。您无法访问上下文。仅支持<strong class="lg iu"> Java </strong>和<strong class="lg iu"> Python </strong>。</li><li id="767c" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu"> Pulsar函数SDK </strong>:可用于Java/Python/Go，提供更多功能，包括访问上下文对象。</li></ul><p id="8a4d" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">使用语言的本地接口非常容易，你只需编写一个简单的函数来转换消息:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="339c" class="mn kh it nu b gy ny nz l oa ob">def process(input):<br/>    return "{}!".format(input)</span></pre><p id="a855" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">这个用<strong class="lg iu"> Python </strong>编写的简单函数只是给所有传入的字符串添加一个感叹号，并将结果字符串发布到一个主题。</p><p id="46d2" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">要使用SDK，您需要导入依赖项，例如在<strong class="lg iu"> Go </strong>中，我们将编写:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="f41a" class="mn kh it nu b gy ny nz l oa ob">package main<br/><br/>import (<br/>    "context"<br/>    "fmt"<br/><br/>    "github.com/apache/pulsar/pulsar-function-go/pf"<br/>)<br/><br/>func HandleRequest(ctx context.Context, in []byte) error{<br/>    fmt.Println(string(in) + "!")<br/>    return nil<br/>}<br/><br/>func main() {<br/>    pf.Start(HandleRequest)<br/>}</span></pre><p id="91a2" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">为了发布无服务器功能并将其部署到集群，我们使用<em class="mc"> pulsar-admin </em> CLI，对于Python，我们将使用:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="b248" class="mn kh it nu b gy ny nz l oa ob">$ bin/pulsar-admin functions create \   <br/>--py ~/router.py \   <br/>--classname router.RoutingFunction \   <br/>--tenant public \   <br/>--namespace default \   <br/>--name route-fruit-veg \   <br/>--inputs persistent://public/default/basket-items</span></pre><p id="77e3" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">Pulsar函数的一个很大的特点就是可以在发布函数的时候设置交付保证:</p><pre class="mj mk ml mm gt nt nu nv nw aw nx bi"><span id="4b10" class="mn kh it nu b gy ny nz l oa ob">$ bin/pulsar-admin functions create \   <br/>--name my-effectively-once-function \   <br/>--processing-guarantees EFFECTIVELY_ONCE </span></pre><p id="542e" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">您有以下选择:</p><figure class="mj mk ml mm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/d0c4f45e28b8744dcd0219ce1f27ffd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJn4QGy6jqBSfIhc_tj-bA.png"/></div></div></figure><p id="c746" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">Pulsar函数在Pulsar集群上运行，因此您不必像Kafka Streams应用程序那样管理它们的部署。</p><h1 id="933e" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">脉冲星的优势</h1><p id="7834" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们回顾一下相对于卡夫卡的主要优势:</p><ul class=""><li id="4c6c" class="mz na it lg b lh md ll me lp np lt nq lx nr mb ne nf ng nh bi translated"><strong class="lg iu">更多功能</strong> : Pulsar功能、多租户、模式注册、n层存储、多消费模式、持久化模式等。</li><li id="f72b" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">更灵活</strong> : 3种订阅类型(独占、共享、故障转移)，一次订阅可以听多个话题。持久性选项:非持久(快速)、持久、压缩(每条消息只有最后一个密钥)。你可以选择送货担保，它有服务器端的重复数据删除和死字。许多保留策略和TTL。</li><li id="fba6" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">无需提前定义您的扩展需求。</strong></li><li id="2414" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">支持<strong class="lg iu">排队和分流</strong>。所以它可以像RabbitMQ或者卡夫卡一样。</li><li id="6b23" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">因为存储与代理分离，所以它的伸缩性更好。再平衡更快更可靠。</li><li id="65fd" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">更容易</strong> <a class="ae kf" href="https://pulsar.apache.org/docs/en/admin-api-overview/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">操作</strong> </a>:得益于de耦合和n层存储。另外，admin REST API也很棒。</li><li id="f93f" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu"> SQL与Presto </strong>集成，直接查询存储而不影响代理。</li><li id="0200" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">更便宜的存储</strong>得益于n层自动化存储选项。</li><li id="f773" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">更快</strong>:许多<a class="ae kf" href="https://medium.com/swlh/performance-comparison-between-apache-pulsar-and-kafka-latency-79fb0367f407" rel="noopener">性能指标评测</a>显示出在各种场景下都有更好的性能。Pulsar声称具有更低的延迟和更好的扩展能力。然而，这正受到<a class="ae kf" href="https://www.kai-waehner.de/blog/2020/06/09/apache-kafka-versus-apache-pulsar-event-streaming-comparison-features-myths-explored/" rel="noopener ugc nofollow" target="_blank">汇流</a>的挑战，所以对此持保留态度，做你自己的基准。</li><li id="e8ee" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu"> Pulsar功能</strong>为您的信息平台带来无服务器计算。无需管理部署。</li><li id="5dcf" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">集成的<strong class="lg iu">模式注册中心</strong>支持简单的模式进化</li><li id="df4b" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">集成负载平衡器和普罗米修斯指标。</li><li id="f604" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><a class="ae kf" href="https://pulsar.apache.org/docs/en/security-encryption/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">加密</strong> </a>支持。</li><li id="8e98" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated"><strong class="lg iu">地理复制</strong>效果更好，也更容易设置。脉冲星也有内在的发现能力。</li><li id="7532" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">您可以创建的主题数量没有限制。</li><li id="b4b4" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">兼容卡夫卡，易于集成。</li></ul><h2 id="cb63" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated">脉冲星星座</h2><p id="10e6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">脉冲星并不完美，卡夫卡受欢迎是有原因的，它做一件事，而且做得很好。Pulsar试图解决太多的领域，但没有一个领域能超越。让我们总结一下脉冲星的一些问题:</p><ul class=""><li id="d768" class="mz na it lg b lh md ll me lp np lt nq lx nr mb ne nf ng nh bi translated"><strong class="lg iu">人气</strong>:脉冲星没那么受欢迎。它缺乏支持、文档和真实世界的使用。这是大组织的一个主要问题。</li><li id="ac33" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">因为n层架构，它需要更多的组件:<a class="ae kf" href="https://bookkeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">记账员</strong> </a> <strong class="lg iu">。</strong></li><li id="f306" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">平台内没有对流式应用程序的适当支持。Pulsar函数与Kafka流不同，它们要简单得多，不适合实时流处理。您不能进行有状态处理。</li><li id="9f0e" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">与卡夫卡相比，插件和客户端更少。此外，掌握Pulsar技能的人越来越少，需要在内部学习。</li><li id="8b2f" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">它在云中的支持<strong class="lg iu">较少</strong>。汇合有托管<a class="ae kf" href="https://confluent.cloud/login" rel="noopener ugc nofollow" target="_blank">云</a>祭品。</li></ul><p id="3b1d" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated"><strong class="lg iu">汇合</strong>，已经把脉冲星和卡夫卡的<a class="ae kf" href="https://www.confluent.io/kafka-vs-pulsar/" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu"/></a>进行了比较，在这里你可以更详细地了解。这篇<a class="ae kf" href="https://www.kai-waehner.de/blog/2020/06/09/apache-kafka-versus-apache-pulsar-event-streaming-comparison-features-myths-explored/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu">博客</strong> </a>也回答了一些关于卡夫卡和脉冲星的问题，但是要注意他们可能有偏见。</p><h1 id="52e6" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">Pulsar用例</h1><p id="6a41" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Pulsar可用于广泛的用例:</p><ul class=""><li id="10a0" class="mz na it lg b lh md ll me lp np lt nq lx nr mb ne nf ng nh bi translated">发布/订阅队列消息传递</li><li id="3d2d" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">分布式日志</li><li id="14f3" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">永久事件存储的事件源壁架</li><li id="c601" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">微服务</li><li id="6fee" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">SQL分析</li><li id="37a5" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">无服务器功能</li></ul><h2 id="8b23" class="mn kh it bd ki mo mp dn km mq mr dp kq lp ms mt ku lt mu mv ky lx mw mx lc my bi translated">什么时候应该考虑脉冲星</h2><ul class=""><li id="4af9" class="mz na it lg b lh li ll lm lp nb lt nc lx nd mb ne nf ng nh bi translated">你既需要RabbitMQ这样的队列，也需要Kafka这样的流处理。</li><li id="144d" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">你需要简单的地理复制。</li><li id="1fb8" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">多租户是必须具备的，您希望确保每个团队的访问安全。</li><li id="5529" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">您需要长时间保存所有消息，并且您不想将它们卸载到另一个存储中。</li><li id="b2f3" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">性能对您至关重要，您的基准测试表明Pulsar提供了更低的延迟和更高的吞吐量。</li><li id="9365" class="mz na it lg b lh ni ll nj lp nk lt nl lx nm mb ne nf ng nh bi translated">您在本地运行，没有设置Kafka的经验，但有Hadoop经验。</li></ul><p id="64c4" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">注意<strong class="lg iu">如果你在云中，考虑基于云的解决方案</strong>。云提供商有不同的服务，涵盖了一些使用案例。例如，对于队列消息，云提供商提供许多类似<a class="ae kf" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu">Google pub/sub</strong></a>的服务。对于分布式日志，你有<strong class="lg iu">汇合</strong>云或者<a class="ae kf" href="https://aws.amazon.com/kinesis/" rel="noopener ugc nofollow" target="_blank"> <strong class="lg iu"> AWS Kinesis </strong> </a>。云提供商也提供了非常好的安全性。Pulsar的优势在于它在一个平台上提供了许多功能。一些团队可能将它用作微服务的消息传递系统，而其他团队则将其用作数据处理的分布式日志。</p><h1 id="4031" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="0bfb" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我是卡夫卡的忠实粉丝，这就是我对脉冲星如此感兴趣的原因。竞争是好事，它推动创新。</p><p id="7c60" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">Kafka是一个成熟的、有弹性的、经过战斗考验的产品，在世界各地都获得了巨大的成功。我无法想象没有它的公司。然而，我确实认为<strong class="lg iu"> Kafka是其自身成功的受害者</strong>，巨大的增长减缓了功能开发，因为他们需要支持如此多的大玩家。像解除对T2动物园管理员T3的依赖这样的重要功能耗时太长。这为Pulsar等工具的蓬勃发展创造了空间；修正了Kafka的一些问题，并增加了更多的功能。</p><p id="6cdf" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated">然而，<strong class="lg iu"> Pulsar仍然很不成熟</strong>，我会在投入生产之前小心谨慎。在将Pulsar整合到您的组织之前，执行分析、进行基准测试、研究并撰写概念证明。从小处着手，在从Kafka迁移之前进行概念验证，并在决定执行完整迁移之前衡量影响。</p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="5a51" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated"><em class="mc">记得来</em> <strong class="lg iu"> <em class="mc">拍拍</em> </strong> <em class="mc">如果你喜欢这篇文章还有</em> <a class="ae kf" href="https://javier-ramos.medium.com/subscribe" rel="noopener"> <em class="mc"> </em> <strong class="lg iu"> <em class="mc">关注</em> </strong> <em class="mc"> </em> <strong class="lg iu"> <em class="mc">我</em> </strong> </a> <em class="mc">或者</em> <a class="ae kf" href="https://javier-ramos.medium.com/membership" rel="noopener"> <strong class="lg iu"> <em class="mc">订阅</em> </strong> </a> <em class="mc">获取更多更新！</em></p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="065a" class="pw-post-body-paragraph le lf it lg b lh md lj lk ll me ln lo lp mf lr ls lt mg lv lw lx mh lz ma mb im bi translated"><a class="ae kf" href="https://javier-ramos.medium.com/subscribe" rel="noopener"> <strong class="lg iu">订阅</strong> </a>在我发表文章时获得<strong class="lg iu">通知</strong>和<a class="ae kf" href="https://javier-ramos.medium.com/membership" rel="noopener"> <strong class="lg iu">加入Medium.com</strong></a>访问百万或文章！</p></div></div>    
</body>
</html>