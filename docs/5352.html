<html>
<head>
<title>K8s Deployments &amp; Replicasets — Part2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K8s部署和副本集—第2部分</h1>
<blockquote>原文：<a href="https://itnext.io/k8s-deployments-replicasets-part2-3d9284f72429?source=collection_archive---------5-----------------------#2021-02-14">https://itnext.io/k8s-deployments-replicasets-part2-3d9284f72429?source=collection_archive---------5-----------------------#2021-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/118e5ce42b73fa4bc8d46ac6ad66efaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/0*vvrbbRmPOAvxPn3-.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.freepik.com/free-vector/programmers-working-project-illustration_10780467.htm#page=1&amp;query=deployments&amp;position=2" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="4d7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/k8s-deployments-replicasets-part1-babdb0215156">在我们之前的帖子</a>中，我们看到了什么是<a class="ae kc" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank">复制集</a>；在本帖中，让我们试着用一些实际的例子一步步理解什么是K8s <a class="ae kc" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">部署</a>对象。</p><p id="cc3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在K8s中，pod是部署在集群中的基本单元。K8s部署是pod的抽象层。部署K8s对象的主要目的是帮助维护部署配置中声明的所需状态资源。</p><blockquote class="lb lc ld"><p id="a963" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">但是等等，你刚才不是说<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/k8s-deployments-replicasets-part1-babdb0215156"> Replicaset </a>也是这么做的吗，那我们为什么还需要另外一个K8s对象部署呢？</p></blockquote><p id="043d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们假设在生产环境中；我们在版本为1的POD中运行一个应用程序。开发人员已经为这个版本开发了代码，并在pod上部署了相同的代码。</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/1dfde088f86b380453d8ba4863ca4863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*91RIYehrXl9I8kOf3j6Yww.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">部署应用程序版本1的开发人员</figcaption></figure><p id="2295" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们说，当版本1在生产中运行时，开发团队有一个可用的版本2，并且现在想要在生产中运行相同的版本；他们将如何用第一版取代豆荚？</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/02200de982bd3d4932fbd2b23b178e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9dBH5uTGTba0-WVe_OYzNg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">部署应用程序版本2的开发人员</figcaption></figure><p id="def1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，如果版本2不能像预期的那样工作，回滚到其他版本或类似的东西怎么样？<a class="ae kc" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank"> Replicasets </a>也能做到吗？不完全是。</p><p id="6a05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是K8s部署对象的用处。部署对象还可以做许多其他事情；让我们看看它是如何帮助我们的。</p><blockquote class="lb lc ld"><p id="1ca3" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">在上面的例子中，当我们用版本2替换版本1时，你认为我们应该用版本2一次替换所有的pod吗？</p></blockquote><p id="ebe1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这可能不是一个好主意，因为如果版本2变坏了怎么办？这意味着如果版本1没有了，而版本2有问题，我们的整个应用程序可能会遇到问题，因为我们一次替换了所有的pod。其中一种更新策略是Rollingupdate，其中pod可以批量升级；这样，如果升级因任何原因失败，我们可以停下来检查。这也防止了应用程序的停机，因为在少数pod停机的情况下，那些仍未更新的pod仍在为应用程序请求提供服务。滚动更新意味着每次我们更新X%的pod时，如果它们不能按预期工作或升级失败，我们就停止更新。这保证了应用程序将在v1或v2上运行，因此避免了停机。</p><p id="c567" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还可以暂停、恢复、回滚等。，带部署。</p><blockquote class="lb lc ld"><p id="2f35" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">这很好，但是部署如何与Replicaset联系起来呢？看起来两者做了相似的事情，例如部署吊舱</p></blockquote><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ln"><img src="../Images/8bf8bcd5f839a3e102a53d9b36558ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5BhhIKnBqQqsngJG6EtQw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">部署、副本集和POD之间的关系</figcaption></figure><p id="eddc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">K8s部署对象包含Replicaset K8s对象。通过在不同的Replicaset版本之间移动，部署有助于在上图中不同版本的应用程序之间移动。这些对象中的每一个都是具有不同职责的抽象；大多数时候，我们处理K8s管理工作的部署对象。</p><blockquote class="lb lc ld"><p id="fe5d" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">但是从用户的角度来看，这意味着什么呢？例如，图中的哪一块是面向用户的？管理人员到底在处理什么？</p></blockquote><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/9e1261a077e974565defd447db20c8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yv8mmKiLxCwvQMIrAkNBUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">K8对象的管理员和用户视角</figcaption></figure><p id="a16f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从用户的角度来看，他们大多会接触到一个<a class="ae kc" href="https://medium.com/swlh/kubernetes-services-part-1-399a0dd05211" rel="noopener">服务</a>，而管理员会处理部署、<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/k8s-deployments-replicasets-part1-babdb0215156">复制集</a> &amp;容器。现在，让我们通过动手来更好地理解这一点。我强烈推荐使用K8s 的<a class="ae kc" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">文档；很有描述性。另外，如果你需要小而精确的笔记，K8s文档</a>中的<a class="ae kc" href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" rel="noopener ugc nofollow" target="_blank">备忘单非常棒。</a></p><p id="65ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们先从验证初始状态开始；看起来我们现在没什么事情要做，所以我们从头开始。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="5ce1" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>No resources found in default namespace.<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get replicaset</strong><br/>No resources found in default namespace.<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get pods</strong><br/>No resources found in default namespace.</span></pre><p id="b6c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从文档<a class="ae kc" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment" rel="noopener ugc nofollow" target="_blank">创建一个部署K8s对象。让我们使用下面的YAML文件。</a></p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="3658" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ cat <strong class="lq ir">deployment.yml</strong><br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: webtesting-deployment<br/>  labels:<br/>    app: webtesting<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: webtesting<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: webtesting<br/>    spec:<br/>      containers:<br/>      - name: webtesting<br/>        image: sandeepbaldawa/webserver-testing:v1<br/>        ports:<br/>        - containerPort: 80<br/>        imagePullPolicy: Always</span></pre><p id="6449" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们创建一个部署对象，我们会看到它创建了一个<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/k8s-deployments-replicasets-part1-babdb0215156"> Replicaset </a>对象，该对象反过来又派生出pod。如果您注意到，这些对象的名称还显示了特定部署、<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/k8s-deployments-replicasets-part1-babdb0215156">、复制集</a>和pod之间的关系。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="9218" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl create -f deployment.yml</strong><br/>deployment.apps/webtesting-deployment created<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   1/2     2            1           3s<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get rs</strong><br/>NAME                              DESIRED   CURRENT   READY   AGE<br/>webtesting-deployment-c496c4dc9   2         2         2       7s<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get pods</strong><br/>NAME                                     READY   STATUS        RESTARTS   AGE<br/>webtesting-deployment-6447659c7d-q572j   0/1     Terminating   0          97s<br/>webtesting-deployment-c496c4dc9-bjw7m    1/1     Running       0          10s<br/>webtesting-deployment-c496c4dc9-d5sz4    1/1     Running       0          10s</span></pre><p id="a140" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个<a class="ae kc" href="https://medium.com/swlh/kubernetes-services-part-1-399a0dd05211" rel="noopener">服务</a>来使用这个部署对象；如果我们看到尝试访问<a class="ae kc" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>的输出，我们可以看到我们的服务输出显示<strong class="kf ir">“这是一个简单的静态网站版本1”，</strong>显示应用程序网页的版本1。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="b335" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   2/2     2            2           41s<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl expose deployments webtesting-deployment --name=webtesting-svc</strong><br/>service/webtesting-svc exposed<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get svc</strong><br/>NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE<br/>kubernetes       ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP   53m<br/>webtesting-svc   ClusterIP   10.106.31.41   &lt;none&gt;        80/TCP    8s<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">curl </strong><a class="ae kc" href="http://10.106.31.41" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">http://10.106.31.41</strong></a><br/>&lt;html&gt;<br/>&lt;h1&gt;Hello World!&lt;/h1&gt;<br/>  &lt;p&gt;This is a simple static website version1!&lt;/p&gt;<br/>&lt;/html&gt;</span></pre><p id="0aa9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们看到上面使用的deployment.yml，我们在pod中使用的图像是<strong class="kf ir">“sandeepbaldawa/web server-testing:v1。”</strong></p><blockquote class="lb lc ld"><p id="6900" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">如果我们想升级pod以使用image v2，该怎么办？</p></blockquote><p id="19c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以像下面这样运行，其中</p><ol class=""><li id="7546" class="ma mb iq kf b kg kh kk kl ko mc ks md kw me la mf mg mh mi bi translated"><strong class="kf ir">web testing-deployment</strong>=&gt;部署对象名称</li></ol><p id="e9d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.<strong class="kf ir">web server-testing:v2</strong>=&gt;要升级到的映像版本2的名称</p><p id="27c2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.<strong class="kf ir"> webtesting </strong> = &gt;该命令适用的容器的名称</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="9522" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl set image deployment/webtesting-deployment webtesting=sandeepbaldawa/webserver-testing:v2</strong><br/>deployment.apps/webtesting-deployment image updated</span></pre><p id="0041" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有趣的是，在我们运行上面的代码后，我们看到一个新的副本集被创建，旧的副本集被关闭。这个新的副本集应该包含应用程序版本2的所有窗格。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="1830" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get rs</strong><br/>NAME                               DESIRED   CURRENT   READY   AGE<br/>webtesting-deployment-6447659c7d   2         2         2       3m46s<br/>webtesting-deployment-c496c4dc9    0         0         0       12m</span></pre><p id="bd9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更有趣的是，该服务现在使用的是POD的最新版本，这意味着升级不会使试图访问该服务的客户端请求停机。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="7144" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">curl </strong><a class="ae kc" href="http://10.106.31.41" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">http://10.106.31.41</strong></a><br/>&lt;html&gt;<br/>&lt;h1&gt;Hello World!&lt;/h1&gt;<br/>  &lt;p&gt;This is a simple static website <strong class="lq ir">version2</strong>!&lt;/p&gt;<br/>&lt;/html&gt;</span></pre><blockquote class="lb lc ld"><p id="2ffe" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">如果我们希望扩展部署以拥有更多单元，该怎么办？</p></blockquote><p id="24a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们尝试将部署从2个副本扩展到5个副本；现在，创建了5个pod。此外，我们可以通过使用curl命令来访问服务。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="b097" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   2/2     2            2           17m<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl scale deployment webtesting-deployment --replicas=5</strong><br/>deployment.apps/webtesting-deployment scaled<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments<br/></strong>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   2/5     5            2           17m<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get pods</strong><br/>NAME                                     READY   STATUS    RESTARTS   AGE<br/>webtesting-deployment-6447659c7d-5lb6l   1/1     Running   0          84s<br/>webtesting-deployment-6447659c7d-h9phk   1/1     Running   0          84s<br/>webtesting-deployment-6447659c7d-wb8p2   1/1     Running   0          9m52s<br/>webtesting-deployment-6447659c7d-xmvxn   1/1     Running   0          9m55s<br/>webtesting-deployment-6447659c7d-zrrsz   1/1     Running   0          84s</span></pre><blockquote class="lb lc ld"><p id="5aa1" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">现在，如果我们想恢复到应用程序的版本1，该怎么办呢？</p></blockquote><p id="3f4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过运行撤销命令，我们回到应用程序的v1。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="f0a6" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   5/5     5            5           21m<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl rollout undo deployment/webtesting-deployment</strong><br/>deployment.apps/webtesting-deployment rolled back<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">curl </strong><a class="ae kc" href="http://10.106.31.41" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir">http://10.106.31.41</strong></a><br/>&lt;html&gt;<br/>&lt;h1&gt;Hello World!&lt;/h1&gt;<br/>  &lt;p&gt;This is a simple static website version1!&lt;/p&gt;<br/>&lt;/html&gt;</span></pre><blockquote class="lb lc ld"><p id="1421" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">如果我们想尝试对部署进行滚动更新，该怎么办？</p></blockquote><p id="1f29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">升级期间，部署当前正在重新创建所有单元；在这里，所有的pod在新的pod被提出之前被终止。让我们尝试执行<a class="ae kc" href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/" rel="noopener ugc nofollow" target="_blank"> Rollingupdate </a>，这将允许我们通过编辑当前使用的部署来升级一批pod。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="2c2f" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   5/5     5            5           27m<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl edit deployments webtesting-deployment</strong><br/>deployment.apps/webtesting-deployment edited</span></pre><p id="a08b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在执行上面的编辑命令时，我们更改了下面的，表明我们的策略是一次升级两个(<strong class="kf ir"> maxSurge </strong> : 2)。我们绝不能有任何吊舱不可用(<strong class="kf ir"> maxUnavailable </strong> : 0)。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="5310" class="lu lv iq lq b gy lw lx l ly lz">strategy:<br/>     rollingUpdate:<br/>       maxSurge: 2<br/>       maxUnavailable: 0<br/>     type: RollingUpdate</span></pre><p id="a74f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们尝试重新运行升级，我们可以看到升级是以两个为一批进行的。</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="cad2" class="lu lv iq lq b gy lw lx l ly lz">vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl set image deployment/webtesting-deployment webtesting=sandeepbaldawa/webserver-testing:v2</strong><br/>deployment.apps/webtesting-deployment image updated<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl get deployments</strong><br/>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE<br/>webtesting-deployment   5/5     5            5           32m<br/>vagrant@k8s-m-1:~/kubernetes$ <strong class="lq ir">kubectl describe deployment webtesting-deployment | tail -10</strong><br/>  Normal  ScalingReplicaSet  11m (x5 over 11m)  deployment-controller  (combined from similar events): Scaled down replica set webtesting-deployment-6447659c7d to 0<br/>  Normal  ScalingReplicaSet  32s (x2 over 23m)  deployment-controller  Scaled up replica set webtesting-deployment-6447659c7d to 2<br/>  Normal  ScalingReplicaSet  29s                deployment-controller  Scaled down replica set webtesting-deployment-c496c4dc9 to 4<br/>  Normal  ScalingReplicaSet  29s                deployment-controller  Scaled up replica set webtesting-deployment-6447659c7d to 3<br/>  Normal  ScalingReplicaSet  28s                deployment-controller  Scaled up replica set webtesting-deployment-6447659c7d to 4<br/>  Normal  ScalingReplicaSet  28s                deployment-controller  Scaled down replica set webtesting-deployment-c496c4dc9 to 3<br/>  Normal  ScalingReplicaSet  26s (x2 over 15m)  deployment-controller  Scaled up replica set webtesting-deployment-6447659c7d to 5<br/>  Normal  ScalingReplicaSet  26s                deployment-controller  Scaled down replica set webtesting-deployment-c496c4dc9 to 2<br/>  Normal  ScalingReplicaSet  25s (x2 over 23m)  deployment-controller  Scaled down replica set webtesting-deployment-c496c4dc9 to 1<br/>  Normal  ScalingReplicaSet  24s (x2 over 23m)  deployment-controller  Scaled down replica set webtesting-deployment-c496c4dc9 to 0</span></pre><p id="4cf2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，该服务指向版本2:</p><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="52ae" class="lu lv iq lq b gy lw lx l ly lz">curl <a class="ae kc" href="http://10.106.31.41" rel="noopener ugc nofollow" target="_blank">http://10.106.31.41</a><br/>&lt;html&gt;<br/>&lt;h1&gt;Hello World!&lt;/h1&gt;<br/>  &lt;p&gt;This is a simple static website version2!&lt;/p&gt;<br/>&lt;/html&gt;</span></pre><blockquote class="lb lc ld"><p id="b4d0" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">我们如何检查版本首次展示历史？</p></blockquote><pre class="lj lk ll lm gt lp lq lr ls aw lt bi"><span id="6f5e" class="lu lv iq lq b gy lw lx l ly lz"><strong class="lq ir">kubectl rollout history deployment/webtesting-deployment</strong></span></pre><p id="bbd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署可以执行大量的操作；他们中的大多数在这里被标注为<a class="ae kc" href="http://kubectl rollout history deployment/webtesting-deployment" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="a955" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望这能让您了解什么是K8s部署对象及其功能。下次见，再见！注意安全。</p></div></div>    
</body>
</html>