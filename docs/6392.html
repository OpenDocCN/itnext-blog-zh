<html>
<head>
<title>Kubernetes Storage — Part 2 — GlusterFS complete tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes储物——第2部分——GlusterFS完整教程</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-storage-part-2-glusterfs-complete-tutorial-77542c12a602?source=collection_archive---------0-----------------------#2021-11-06">https://itnext.io/kubernetes-storage-part-2-glusterfs-complete-tutorial-77542c12a602?source=collection_archive---------0-----------------------#2021-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/296896c9a8d85cbb833ce443b93a066f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5Tp6PHEccn70-4NDRe5ww.jpeg"/></div></div></figure><p id="9b64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对Kubernetes储物感兴趣，这一系列文章正适合你。在这一部分，我将解释如何启动和运行GlusterFS并在Kubernetes中使用它。那么，我们开始吧。</p><p id="2ab7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-storage-part-1-nfs-complete-tutorial-75e6ac2a1f77"> Kubernetes存储—第1部分— NFS完整教程</a></p><h1 id="0918" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">所需资源:</h1><ul class=""><li id="3b28" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated">运行中的Kubernetes星团。建议1.18+。</li><li id="b6f7" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">三个节点用于启动和运行带复制的GlusterFS。</li></ul><p id="a551" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将在基于<strong class="ka ir"> Ubuntu </strong>的系统上运行这些步骤。我建议你也这样做。</p><p id="c3af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">提示:k3s不支持GlusterFS卷。</strong></p><p id="f4e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">三节点Kubernetes集群:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1c0d" class="mu ky iq mq b gy mv mw l mx my">Node1<br/>OS: Ubuntu 20.04<br/>Kubernetes: 1.20.7 (installed via kubespray)<br/>FQDN: node001.b9tcluster.local<br/>IP Address: 192.168.12.4</span><span id="1b52" class="mu ky iq mq b gy mz mw l mx my">Node2<br/>OS: Ubuntu 20.04<br/>Kubernetes: 1.20.7 (installed via kubespray)<br/>FQDN: node002.b9tcluster.local<br/>IP Address: 192.168.12.5</span><span id="9e77" class="mu ky iq mq b gy mz mw l mx my">Node3<br/>OS: Ubuntu 20.04<br/>Kubernetes: 1.20.7 (installed via kubespray)<br/>FQDN: node003.b9tcluster.local<br/>IP Address: 192.168.12.6</span></pre><p id="c426" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">【GlusterFS的三个节点:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1b05" class="mu ky iq mq b gy mv mw l mx my">Storage1<br/>OS: Ubuntu 20.04<br/>FQDN: node004.b9tcluster.local<br/>IP Address: 192.168.12.7<br/>Storage: /dev/sdb1 mounted on /gluster/volume<br/>Storage: /dev/sdb2 mounted on /gluster/heketi (Heketi)<br/>Role: Replica</span><span id="ae69" class="mu ky iq mq b gy mz mw l mx my">Storage2<br/>OS: Ubuntu 20.04<br/>FQDN: node005.b9tcluster.local<br/>IP Address: 192.168.12.8<br/>Storage: /dev/sdb1 mounted on /gluster/volume<br/>Storage: /dev/sdb2 mounted on /gluster/heketi (Heketi)<br/>Role: Replica</span><span id="081b" class="mu ky iq mq b gy mz mw l mx my">Storage3<br/>OS: Ubuntu 20.04<br/>FQDN: node006.b9tcluster.local<br/>IP Address: 192.168.12.9<br/>Storage: /dev/sdb1 mounted on /gluster/volume<br/>Storage: /dev/sdb2 mounted on /gluster/heketi (Heketi)<br/>Role: Arbiter</span></pre><p id="7626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面为GlusterFS集群考虑的配置中，<strong class="ka ir">仲裁器</strong>节点不是真正复制数据的节点！它保存的不是数据，而是文件的元数据。我们用它来防止存储<strong class="ka ir">裂脑</strong>正好只有两个副本。</p><h1 id="23ce" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">1-启动并运行GlusterFS集群:</h1><p id="c9e1" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">要安装和配置GlusterFS，请执行以下步骤:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="5fc7" class="mu ky iq mq b gy mv mw l mx my"># Install GlusterFS server on all STORAGE nodes.</span><span id="5b7e" class="mu ky iq mq b gy mz mw l mx my">apt install -y glusterfs-server</span><span id="a338" class="mu ky iq mq b gy mz mw l mx my">systemctl enable --now glusterd.service</span></pre><p id="9fdc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用2个副本和1个仲裁器设置Gluster卷:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="542e" class="mu ky iq mq b gy mv mw l mx my"># Only on Node1 of STORAGE nodes.</span><span id="5a43" class="mu ky iq mq b gy mz mw l mx my">gluster peer probe node005.b9tcluster.local</span><span id="0cd3" class="mu ky iq mq b gy mz mw l mx my">gluster peer probe node006.b9tcluster.local</span><span id="c2ba" class="mu ky iq mq b gy mz mw l mx my">gluster volume create k8s-volume replica 2 arbiter 1 transport tcp \<br/>  node004:/gluster/volume \<br/>  node005:/gluster/volume \<br/>  node006:/gluster/volume</span><span id="dbbe" class="mu ky iq mq b gy mz mw l mx my">gluster volume start k8s-volume</span></pre><p id="b8ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看卷信息，请运行以下命令:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d36c" class="mu ky iq mq b gy mv mw l mx my">gluster volume info k8s-volume</span><span id="c657" class="mu ky iq mq b gy mz mw l mx my">Volume Name: k8s-volume<br/>Type: Replicate<br/>Volume ID: dd5aac80-b160-4281-9b22-00ae95f4bc0c<br/>Status: Started<br/>Snapshot Count: 0<br/>Number of Bricks: 1 x (2 + 1) = 3<br/>Transport-type: tcp<br/>Bricks:<br/>Brick1: node004:/gluster/volume<br/>Brick2: node005:/gluster/volume<br/>Brick3: node006:/gluster/volume (arbiter)<br/>Options Reconfigured:<br/>transport.address-family: inet<br/>storage.fips-mode-rchecksum: on<br/>nfs.disable: on<br/>performance.client-io-threads: off</span></pre><h1 id="a4b7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">2-准备Kubernetes工作节点:</h1><p id="4fec" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">现在，为了使Kubernetes workers能够连接和使用GlusterFS卷，您需要在WORKER节点中安装glusterfs-client。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1020" class="mu ky iq mq b gy mv mw l mx my">apt install glusterfs-client</span></pre><p id="4e46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要提示！</strong>每个存储解决方案可能需要客户端包来连接到存储服务器。您应该将它们安装在所有Kubernetes worker节点中。对于GlusterFS，需要<strong class="ka ir"> glusterfs-client </strong>包。</p><h1 id="be97" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">3-在Kubernetes发现GlusterFS:</h1><p id="0a6d" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">GlusterFS星团应该在Kubernetes星团中被发现。为此，您需要添加一个指向GlusterFS集群服务器的端点对象。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6c8c" class="mu ky iq mq b gy mv mw l mx my">apiVersion: v1<br/>kind: Endpoints<br/>metadata:<br/>  name: glusterfs-cluster<br/>  labels:<br/>    storage.k8s.io/name: glusterfs<br/>    storage.k8s.io/part-of: kubernetes-complete-reference<br/>    storage.k8s.io/created-by: ssbostan<br/>subsets:<br/>  - addresses:<br/>      - ip: 192.168.12.7<br/>        hostname: node004<br/>      - ip: 192.168.12.8<br/>        hostname: node005<br/>      - ip: 192.168.12.9<br/>        hostname: node006<br/>    ports:<br/>      - port: 1</span></pre><h1 id="6ecb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">4-在Kubernetes中使用GlusterFS:</h1><h2 id="1f77" class="mu ky iq bd kz nd ne dn ld nf ng dp lh kj nh ni ll kn nj nk lp kr nl nm lt nn bi translated">方法1 —通过Pod清单直接连接到GlusterFS:</h2><p id="8f96" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">要使用Pod清单直接连接到GlusterFS卷，请在Pod中使用GlusterfsVolumeSource。这里有一个例子:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6932" class="mu ky iq mq b gy mv mw l mx my">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: test<br/>  labels:<br/>    app.kubernetes.io/name: alpine<br/>    app.kubernetes.io/part-of: kubernetes-complete-reference<br/>    app.kubernetes.io/created-by: ssbostan<br/>spec:<br/>  containers:<br/>    - name: alpine<br/>      image: alpine:latest<br/>      command:<br/>        - touch<br/>        - /data/test<br/>      volumeMounts:<br/>        - name: glusterfs-volume<br/>          mountPath: /data<br/>  volumes:<br/>    - name: glusterfs-volume<br/>      glusterfs:<br/>        endpoints: glusterfs-cluster<br/>        path: k8s-volume<br/>        readOnly: no</span></pre><h2 id="60cf" class="mu ky iq bd kz nd ne dn ld nf ng dp lh kj nh ni ll kn nj nk lp kr nl nm lt nn bi translated">方法2 —使用PersistentVolume资源进行连接:</h2><p id="766a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">要为GlusterFS卷创建PersistentVolume对象，请使用以下清单。存储大小没有任何影响。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="0778" class="mu ky iq mq b gy mv mw l mx my">apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:<br/>  name: glusterfs-volume<br/>  labels:<br/>    storage.k8s.io/name: glusterfs<br/>    storage.k8s.io/part-of: kubernetes-complete-reference<br/>    storage.k8s.io/created-by: ssbostan<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>    - ReadOnlyMany<br/>    - ReadWriteMany<br/>  capacity:<br/>    storage: 10Gi<br/>  storageClassName: ""<br/>  persistentVolumeReclaimPolicy: Recycle<br/>  volumeMode: Filesystem<br/>  glusterfs:<br/>    endpoints: glusterfs-cluster<br/>    path: k8s-volume<br/>    readOnly: no</span></pre><h2 id="902b" class="mu ky iq bd kz nd ne dn ld nf ng dp lh kj nh ni ll kn nj nk lp kr nl nm lt nn bi translated">方法3 —使用存储类进行动态资源调配:</h2><p id="19a8" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">是时候解释最难的部分了，GlusterFS与Kubernetes StorageClass一起实现动态存储供应。为了实现这个模型，除了GlusterFS集群，我们还需要Heketi。Heketi是基于RESTful的GlusterFS卷管理。我们必须使用Heketi，因为Kubernetes需要访问它来动态创建卷。</p><p id="88ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">要求:</strong></p><ul class=""><li id="b06d" class="lv lw iq ka b kb kc kf kg kj no kn np kr nq kv mc md me mf bi translated">用于存储Heketi数据库的运行GlusterFS。</li><li id="9a25" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">GlusterFS集群节点上可用的原始存储设备。</li><li id="cfd1" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">将Heketi连接到GlusterFS节点的SSH密钥。</li></ul><p id="5f3d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">架构和场景:</strong></p><p id="e2b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了构建卷，Kubernetes部署的Heketi必须与GlusterFS节点连接。这种通信应该使用SSH来完成。因此，我们需要一个在GlusterFS节点上授权的私钥。另一方面，Heketi应该知道哪些原始设备可用于创建分区和GlusterFS块。拓扑文件应该包含一个群集节点列表以及一个可访问的原始存储列表。赫克提有自己的数据库来保存所有关于创造砖。为了保存Heketi数据，我使用了我们在前面几节中部署的现有GlusterFS集群。</p><p id="cb5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们假设一些现有的材料:</p><ul class=""><li id="053c" class="lv lw iq ka b kb kc kf kg kj no kn np kr nq kv mc md me mf bi translated">通过SSH连接GlusterFS节点的私钥:<strong class="ka ir"> heketi-ssh-key </strong></li><li id="373a" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">所有GlusterFS节点上可用的原始设备:<strong class="ka ir"> /dev/sdc (100GB) </strong></li></ul><p id="cfbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.1:创建一个GlusterFS卷来存储Heketi数据库:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="05cd" class="mu ky iq mq b gy mv mw l mx my">gluster volume create <strong class="mq ir">heketi-db-volume</strong> replica 3 transport tcp \<br/>  node004:/gluster/heketi \<br/>  node005:/gluster/heketi \<br/>  node006:/gluster/heketi</span><span id="7862" class="mu ky iq mq b gy mz mw l mx my">gluster volume start heketi-db-volume</span></pre><p id="d036" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.2:创建一个Kubernetes秘密来存储SSH私有密钥:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="fdea" class="mu ky iq mq b gy mv mw l mx my">kubectl create secret generic <strong class="mq ir">heketi-ssh-key-file</strong> \<br/>  --from-file=<strong class="mq ir">heketi-ssh-key</strong></span></pre><p id="fd9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.3:创建heke ti“config . JSON”文件:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="daf6" class="mu ky iq mq b gy mv mw l mx my">{<br/>  "_port_comment": "Heketi Server Port Number",<br/>  "port": "8080",<br/>  "_use_auth": "Enable JWT authorization.",<br/>  "use_auth": true,<br/>  "_jwt": "Private keys for access",<br/>  "jwt": {<br/>    "_admin": "Admin has access to all APIs",<br/>    "admin": {<br/>      "key": "<strong class="mq ir">ADMIN-HARD-SECRET</strong>"<br/>    }<br/>  },<br/>  "_glusterfs_comment": "GlusterFS Configuration",<br/>  "glusterfs": {<br/>    "executor": "<strong class="mq ir">ssh</strong>",<br/>    "_sshexec_comment": "SSH username and private key file",<br/>    "sshexec": {<br/>      "keyfile": "<strong class="mq ir">/heketi/heketi-ssh-key</strong>",<br/>      "user": "root",<br/>      "port": "22"<br/>    },<br/>    "_db_comment": "Database file name",<br/>    "db": "<strong class="mq ir">/var/lib/heketi/heketi.db</strong>",<br/>    "loglevel" : "debug"<br/>  }<br/>}</span></pre><p id="2394" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.4:创建集群“topology.json”文件:</strong></p><p id="abd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以使用多个原始设备。赫克提人知道如何管理他们。此外，Heketi可以同时管理几个集群。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="080c" class="mu ky iq mq b gy mv mw l mx my">{<br/>  "clusters": [<br/>    {<br/>      "nodes": [<br/>        {<br/>          "node": {<br/>            "hostnames": {<br/>              "manage": [<br/>                "node004.b9tcluster.local"<br/>              ],<br/>              "storage": [<br/>                "192.168.12.7"<br/>              ]<br/>            },<br/>            "zone": 1<br/>          },<br/>          "devices": [<br/>            "<strong class="mq ir">/dev/sdc</strong>"<br/>          ]<br/>        },<br/>        {<br/>          "node": {<br/>            "hostnames": {<br/>              "manage": [<br/>                "node005.b9tcluster.local"<br/>              ],<br/>              "storage": [<br/>                "192.168.12.8"<br/>              ]<br/>            },<br/>            "zone": 1<br/>          },<br/>          "devices": [<br/>            "<strong class="mq ir">/dev/sdc</strong>"<br/>          ]<br/>        },<br/>        {<br/>          "node": {<br/>            "hostnames": {<br/>              "manage": [<br/>                "node006.b9tcluster.local"<br/>              ],<br/>              "storage": [<br/>                "192.168.12.9"<br/>              ]<br/>            },<br/>            "zone": 1<br/>          },<br/>          "devices": [<br/>            "<strong class="mq ir">/dev/sdc</strong>"<br/>          ]<br/>        }<br/>      ]<br/>    }<br/>  ]<br/>}</span></pre><p id="768b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.5:创建Heketi配置和拓扑的Kubernetes配置图:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c6c5" class="mu ky iq mq b gy mv mw l mx my">kubectl create configmap <strong class="mq ir">heketi-config</strong> \<br/>  --from-file=heketi.json \<br/>  --from-file=topology.json</span></pre><p id="cbff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.6:启动并运行Kubernetes中的heke ti:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="fd65" class="mu ky iq mq b gy mv mw l mx my">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: heketi<br/>  labels:<br/>    app.kubernetes.io/name: heketi<br/>    app.kubernetes.io/part-of: glusterfs<br/>    app.kubernetes.io/origin: kubernetes-complete-reference<br/>    app.kubernetes.io/created-by: ssbostan<br/>spec:<br/>  type: NodePort<br/>  selector:<br/>    app.kubernetes.io/name: heketi<br/>    app.kubernetes.io/part-of: glusterfs<br/>    app.kubernetes.io/origin: kubernetes-complete-reference<br/>    app.kubernetes.io/created-by: ssbostan<br/>  ports:<br/>    - port: 8080<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: heketi<br/>  labels:<br/>    app.kubernetes.io/name: heketi<br/>    app.kubernetes.io/part-of: glusterfs<br/>    app.kubernetes.io/origin: kubernetes-complete-reference<br/>    app.kubernetes.io/created-by: ssbostan<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app.kubernetes.io/name: heketi<br/>      app.kubernetes.io/part-of: glusterfs<br/>      app.kubernetes.io/origin: kubernetes-complete-reference<br/>      app.kubernetes.io/created-by: ssbostan<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app.kubernetes.io/name: heketi<br/>        app.kubernetes.io/part-of: glusterfs<br/>        app.kubernetes.io/origin: kubernetes-complete-reference<br/>        app.kubernetes.io/created-by: ssbostan<br/>    spec:<br/>      containers:<br/>        - name: heketi<br/>          image: heketi/heketi:10<br/>          ports:<br/>            - containerPort: 8080<br/>          volumeMounts:<br/>            - name: ssh-key-file<br/>              mountPath: /heketi<br/>            - name: config<br/>              mountPath: /etc/heketi<br/>            - name: data<br/>              mountPath: /var/lib/heketi<br/>      volumes:<br/>        - name: ssh-key-file<br/>          secret:<br/>            secretName: <strong class="mq ir">heketi-ssh-key-file</strong><br/>        - name: config<br/>          configMap:<br/>            name: <strong class="mq ir">heketi-config</strong><br/>        - name: data<br/>          glusterfs:<br/>            endpoints: glusterfs-cluster<br/>            path: <strong class="mq ir">heketi-db-volume</strong></span></pre><p id="b111" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.7:将集群拓扑加载到Heketi: </strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ebd6" class="mu ky iq mq b gy mv mw l mx my">kubectl exec <strong class="mq ir">POD-NAME</strong> -- heketi-cli \<br/>  --user admin \<br/>  --secret <strong class="mq ir">ADMIN-HARD-SECRET</strong> \<br/>  topology load --json /etc/heketi/topology.json</span></pre><p id="5c41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将<strong class="ka ir">POD-的名字</strong>替换为你的赫克梯吊舱的名字。</p><p id="e078" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切顺利，您应该能够从Heketi获得集群id。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="4226" class="mu ky iq mq b gy mv mw l mx my">kubectl exec <strong class="mq ir">POD-NAME</strong> -- heketi-cli \<br/>  --user admin \<br/>  --secret <strong class="mq ir">ADMIN-HARD-SECRET</strong> \<br/>  cluster list</span><span id="b952" class="mu ky iq mq b gy mz mw l mx my">Clusters:<br/>Id:<strong class="mq ir">c63d60ee0ddf415097f4eb82d69f4e48</strong> [file][block]</span></pre><p id="fa8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.8:获取赫克提节点端口信息:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d939" class="mu ky iq mq b gy mv mw l mx my">kubectl get svc</span><span id="b2da" class="mu ky iq mq b gy mz mw l mx my">heketi NodePort 10.233.29.206 &lt;none&gt; 8080:<strong class="mq ir">31310</strong>/TCP 41d</span></pre><p id="d960" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.9:创建赫克提“管理员”用户的秘密:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="425a" class="mu ky iq mq b gy mv mw l mx my">kubectl create secret generic <strong class="mq ir">heketi-admin-secret</strong> \<br/>  --type=kubernetes.io/glusterfs \<br/>  --from-literal=key=<strong class="mq ir">ADMIN-HARD-SECRET</strong></span></pre><p id="2acb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.10:为GlusterFS动态预配置创建存储类:</strong></p><p id="0d7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用你自己的信息替换需要的信息。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="39eb" class="mu ky iq mq b gy mv mw l mx my">apiVersion: storage.k8s.io/v1<br/>kind: StorageClass<br/>metadata:<br/>  name: glusterfs<br/>  labels:<br/>    storage.k8s.io/name: glusterfs<br/>    storage.k8s.io/provisioner: heketi<br/>    storage.k8s.io/origin: kubernetes-complete-reference<br/>    storage.k8s.io/created-by: ssbostan<br/>provisioner: kubernetes.io/glusterfs<br/>parameters:<br/>  resturl: http://127.0.0.1:<strong class="mq ir">31310</strong><br/>  clusterid: <strong class="mq ir">c63d60ee0ddf415097f4eb82d69f4e48</strong><br/>  restauthenabled: !!str true<br/>  restuser: admin<br/>  secretNamespace: default<br/>  secretName: <strong class="mq ir">heketi-admin-secret</strong><br/>  volumetype: replicate:3</span></pre><p id="a589" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3.11:创建PersistentVolumeClaim以测试动态预配置:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c603" class="mu ky iq mq b gy mv mw l mx my">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: testvol<br/>  labels:<br/>    storage.k8s.io/name: glusterfs<br/>    storage.k8s.io/provisioner: heketi<br/>    storage.k8s.io/origin: kubernetes-complete-reference<br/>    storage.k8s.io/created-by: ssbostan<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  storageClassName: <strong class="mq ir">glusterfs</strong><br/>  resources:<br/>    requests:<br/>      storage: 10Gi # Storage size takes effect.</span></pre><h1 id="d217" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">4- Kubernetes和GlusterFS存储规格:</h1><p id="3c4a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">使用GlusterFS前，请考虑以下提示:</p><ul class=""><li id="1e81" class="lv lw iq ka b kb kc kf kg kj no kn np kr nq kv mc md me mf bi translated"><strong class="ka ir">读写一次</strong>、<strong class="ka ir">只读多次</strong>、<strong class="ka ir">读写多次</strong>访问模式。</li><li id="99f6" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">GlusterFS卷可以用隔板和砖块隔离。</li><li id="9d5b" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">GlusterFS也可以像本地存储一样部署在Kubernetes上。</li></ul><h1 id="7e5c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后一句话:</h1><p id="b02c" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">恭喜你！你已经通过了所有关于Kubernetes和GlusterFS。要了解关于Kubernetes的更多信息，请访问这个GitHub资源库。这个完整的Kubernetes参考将很快丰富。欢迎所有的贡献。如果您发现这篇文章有用，请查看项目GitHub资源库。</p><p id="453e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae kw" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p><div class="nr ns gp gr nt nu"><a href="https://github.com/ssbostan/kubernetes-complete-reference" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">GitHub-ssbo stan/Kubernetes-complete-reference:Kubernetes reference，awesome，cheatsheet…</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">Kubernetes容器编排引擎的最完整参考。由ssbostan和贡献者创建…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jw nu"/></div></div></a></div></div></div>    
</body>
</html>