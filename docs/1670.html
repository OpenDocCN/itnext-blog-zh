<html>
<head>
<title>Controlling Web Audio With React and Redux Middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React和Redux中间件控制网络音频</h1>
<blockquote>原文：<a href="https://itnext.io/controlling-web-audio-with-react-and-redux-middleware-39b1a4b0c2ba?source=collection_archive---------0-----------------------#2018-12-28">https://itnext.io/controlling-web-audio-with-react-and-redux-middleware-39b1a4b0c2ba?source=collection_archive---------0-----------------------#2018-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/868d7552ee1d971748ed5c72889a50bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TlHgsDUiRKZ936a2HB2FTg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">乔·豪普特在Flickr上拍摄的经典老款手机照片</figcaption></figure><h1 id="c9fc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">让我们建立一个按键键盘！</h1><p id="6371" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果您以前构建过React/Redux应用程序，您会知道单向数据流有一个标准模式。用户界面调度一个动作。一个reducer处理动作，返回一个新的应用程序状态。用户界面会相应地进行自我重组。</p><p id="72ec" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">但是，如果您需要一个Redux动作来触发与复杂系统的交互，该怎么办呢？比如，用于创建或分析声音的网络音频组件的集合。这些不是可序列化的对象。它们不应该被减速器管理。UI组件也不应该管理它们，因为它可能会在运行时被卸载，导致音频系统丢失。</p><p id="8d12" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">相反，我们使用中间件，这是本文的重点。</p><p id="c908" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">中间件是长寿的，因此可以期望它在应用程序的生命周期内维护我们构建的任何音频系统。此外，它可以访问存储，因此它可以检查应用程序状态，响应于来自它所负责的事件(例如，Web音频系统)分派动作，并且可以响应指示它与这样的系统交互的动作。</p><p id="6c7b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在这个演示中，我们将保持简单，只触发一些声音来响应一个动作。目标只是演示如何使用中间件将Web Audio API系统适配到Redux应用程序。</p><p id="682f" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为了庆祝我在12年后于本月抛弃了我的固定电话，(将号码转移到令人敬畏的openphone.co<a class="ae kc" href="https://openphone.co" rel="noopener ugc nofollow" target="_blank">在线服务)，我们将模拟一个电话按键键盘。</a></p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">如果你对此感兴趣，这里有一个快速视频教程…</figcaption></figure><h1 id="e07e" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">研究问题领域</h1><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/eefbaa55ed4870ccc9073beb541a317e.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/0*-EkUw4Br4fd8sOkE.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">DTMF——神奇的频率</figcaption></figure><p id="0adc" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">按键式电话使用一种叫做<a class="ae kc" href="https://en.wikipedia.org/wiki/Dual-tone_multi-frequency_signaling" rel="noopener ugc nofollow" target="_blank"> DTMF </a>(双音多频)的信号系统，当一个按键被按下时会触发两个独立的频率。</p><p id="5f30" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">链接的维基百科文章包含了更多的琐事，比如“#”符号被最初的工程师称为“<a class="ae kc" href="https://en.wikipedia.org/wiki/Octothorpe" rel="noopener ugc nofollow" target="_blank">八叉图</a>”。但是，在大多数情况下，我们需要知道的信息都包含在您在这里看到的表格中。</p><p id="3775" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在我们的应用程序中，一个小型Web Audio API系统中的两个振荡器可以产生这些频率，我们将使用一个Redux中间件函数作为中间人。</p><h1 id="fb7d" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">代表域</h1><p id="6125" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，我们只需要对这个神奇的频率表进行编码，这样我们就可以轻松地创建一个使用该信息的键盘。</p><p id="7c16" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">强力方法是分别声明每个按钮，并在每个按钮的点击处理程序中硬编码适当的频率。然而，最佳的方法是整理数据，以便我们可以从中实际生成密钥板。不用说，我们在这里将选择后者。</p><p id="00db" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我们首先定义行频率和列频率，然后用每个键的行和列位置的频率常数为每个键创建一个数组。最后，构建表示键盘行的数组，每个键由包含该键的标签和音调数组的数组表示。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/32af7b3fd930329dfb037b8e12635dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*absApd6yu16N9IZX-j55Vw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf"> dtmf.js </strong></figcaption></figure><h1 id="ad43" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">UI到中间件消息传递</h1><p id="71ff" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在我们进入表示键盘的UI或播放DTMF音的中间件之前，让我们快速浏览一下将在两者之间发送的消息。</p><p id="48ce" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">动作创建者<code class="fe mm mn mo mp b">playDTMFPair</code>将接受上面<code class="fe mm mn mo mp b">KEY_</code>常量中定义的一对音调，并返回一个<code class="fe mm mn mo mp b">PLAY_DTMF_PAIR</code>类型的动作，每次按下一个键时，音调可以通过该动作从UI发送到中间件。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/95f61e9e18bec3eae26c4f2ec021d6ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CW_5IRQuIlFqFvGWZlPbRQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf"> actions.js </strong></figcaption></figure><h1 id="685d" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">创建用户界面</h1><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/0c44e7a222f1c2ca35348ca729fe2eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/1*3x5F5oWoxrrXmZ1OjpY7wA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">哔哔哔——哔哔哔哔</figcaption></figure><p id="7091" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">该演示是一个标准的React/Redux设置。此外，它使用<a class="ae kc" href="https://react-bootstrap.github.io/" rel="noopener ugc nofollow" target="_blank"> React Bootstrap </a>和<a class="ae kc" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank">风格的组件</a>来实现典型的按键键盘的外观和感觉，这些按键键盘具有紧密排列的大方形阴影按钮。您可以查看样式方面的<a class="ae kc" href="https://github.com/cliffhall/react-dtmf-dialer" rel="noopener ugc nofollow" target="_blank">项目代码</a>，但下面是用于呈现小键盘的两个主要React组件。</p><p id="a685" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">和往常一样，<code class="fe mm mn mo mp b">App</code>组件是主容器。在它的<code class="fe mm mn mo mp b">render</code>方法中，它创建了一个<code class="fe mm mn mo mp b">StyledKeypad</code>，它基本上是一个柱状flexbox，内容居中，有一些上边距。在里面，它为键盘的每一行呈现一个<code class="fe mm mn mo mp b">StyledKeypadRow</code>容器(你猜对了，一个面向行的flexbox)。最后，在其中的每一个中，它为行中的每个键呈现一个<code class="fe mm mn mo mp b">KeypadKey</code>组件，传递一个标签、键需要触发的音调和一个动作调度器。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/3eaaeaafaa64b4c016fc3fb078cb0495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8Z7OLFEci0csscMuoemmw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf"> App.js </strong></figcaption></figure><p id="a0d4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe mm mn mo mp b">KeypadKey</code>组件是一个简单的功能组件，它接受我们作为道具传递的<code class="fe mm mn mo mp b">label</code>、<code class="fe mm mn mo mp b">tones</code>和<code class="fe mm mn mo mp b">handleClick</code>函数。它返回一个<code class="fe mm mn mo mp b">StyledKeypadButton</code>，这只是一个没有轮廓的大方形引导按钮，一个可读的字体大小，以及一个调用<code class="fe mm mn mo mp b">handleClick</code>函数的<code class="fe mm mn mo mp b">onClick</code>处理程序，传递<code class="fe mm mn mo mp b">tones</code>数组。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/54f7b76ff1cb62be37045cdba55d3d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNF0Ifxc8duVytjjAHbrXQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf"> KeypadKey.js </strong></figcaption></figure><h1 id="7568" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">网络音频API</h1><p id="cca9" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">完整的复音合成器<a class="ae kc" href="https://webaudiodemos.appspot.com/midi-synth/index.html" rel="noopener ugc nofollow" target="_blank">已经使用网络音频API构建，这是其实现的惊人广度。为您的整个应用程序框架选择React/Redux是开始这样一个项目的好方法。相比之下，我们的演示将是微不足道的，架构可以很容易地适应这样一个宏伟的目标。</a></p><p id="c564" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如果你是新手，css-tricks上有一个关于网络音频API的精彩介绍。事实上，它的一个部分构成了我们的类的基础。主要区别在于，我们在构造函数中获取音频上下文，而不是将其作为参数接受，我们创建两个振荡器，而不是一个，我们立即开始声音，而不是接受时间，我们在半秒钟后立即关闭声音，而不是以指数方式关闭。</p><p id="07ae" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">因为我们的重点是使音频系统适应Redux，所以我将让css-tricks文章描述这里提到的Web音频API的细节。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/128cda71c3a63305df83733fa5cf9433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uM3bMEIXNy002lTBHKERQg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf">touch one . js</strong></figcaption></figure><h1 id="8179" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Redux中间件</h1><p id="14df" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当你第一次阅读Redux中间件的官方介绍时，它会很容易地扭曲你的瓜。这是因为他们在找到解决方案之前经历了一大堆“错误的方法”来做事。这就是为什么我认为有一个非常简单的例子来帮助你开始的原因。</p><p id="621c" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">真的一点都没那么复杂。一个简单的函数接受Redux存储，并返回一个接受链回调中的下一个中间件的函数。该回调接受一个动作。在该函数中，我们可以处理或忽略任何通过的动作，但是当我们完成时，我们需要调用中间件的下一个回调，将动作传递给它。</p><p id="74f5" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要记住的关键事情是，它将存在于应用程序的生命周期中，并且它将有机会处理任何分派的动作。这使得它成为与应用程序中不可序列化的部分(如套接字或音频组件)进行交互的完美中介。它将可以访问存储，因此您可以引用状态，并且如果需要的话，您可以从中调度操作。在我们的例子中，我们只对键盘发出的单个动作做出响应。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/bf8403c3e5a339ddaf1f6298d576462f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jAIofvyJ8BWhk79i9MT7fQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd kf"> middleware.js </strong></figcaption></figure><h1 id="73c3" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="f52f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">显然，使用不同的接口和音频系统，这个应用程序可以实现一个音乐设备，触发比DTMF更令人愉快的音调。主要的焦点是如何适应这样一个系统。</p><p id="c34b" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在React/Redux应用程序中，使用中间件来控制Web Audio API非常容易，并且在架构上是正确的。因此，如果您从未构建过中间件，不要让Redux网站上令人费解的文档让您分心。</p><p id="ea61" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">中间件中可能发生的更有雄心的事情是，它可以响应来自<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/AudioListener" rel="noopener ugc nofollow" target="_blank">音频监听器</a>或<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode" rel="noopener ugc nofollow" target="_blank">脚本处理器节点</a>的事件，并通过调用<code class="fe mm mn mo mp b">store.dispatch()</code>来分派动作。这将允许应用程序执行音频空间化或可视化。</p><p id="3469" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">你可以从GitHub下载这个项目:<a class="ae kc" href="https://github.com/cliffhall/react-dtmf-dialer" rel="noopener ugc nofollow" target="_blank">https://github.com/cliffhall/react-dtmf-dialer</a></p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="46af" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><em class="nc">原载于2018年12月28日</em><a class="ae kc" href="http://cliffordhall.com/2018/12/controlling-web-audio-with-react-and-redux-middleware/" rel="noopener ugc nofollow" target="_blank"><em class="nc">cliffordhall.com</em></a><em class="nc">。</em></p></div></div>    
</body>
</html>