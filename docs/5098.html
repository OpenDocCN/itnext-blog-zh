<html>
<head>
<title>Build a Serverless app using Go and Azure Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Go和Azure函数构建一个无服务器应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-serverless-app-using-go-and-azure-functions-c4475398f4ab?source=collection_archive---------0-----------------------#2020-12-10">https://itnext.io/build-a-serverless-app-using-go-and-azure-functions-c4475398f4ab?source=collection_archive---------0-----------------------#2020-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="962a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何实现一个作为无服务器后端的Slack应用程序</h2></div><p id="5d11" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Webhook后端是FaaS(功能即服务)平台的一个流行用例。它们可以用于许多用例，比如发送客户通知，用有趣的gif来响应！使用无服务器函数，封装webhook功能并以HTTP端点的形式公开它是非常方便的。在本教程中，你将学习如何使用<a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure函数</a>和<a class="ae kf" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go </a>实现一个<a class="ae kf" href="https://api.slack.com/start/overview#apps" rel="noopener ugc nofollow" target="_blank"> Slack应用</a>作为无服务器后端。您可以扩展Slack平台，并通过实现自定义应用或工作流来集成服务，这些应用或工作流可以访问平台的所有范围，从而让您在Slack中构建强大的体验。</p><p id="b09b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这是用于Slack 的<a class="ae kf" href="https://get.slack.help/hc/en-us/articles/204714258-Giphy-for-Slack" rel="noopener ugc nofollow" target="_blank"> Giphy的更简单版本。最初的Giphy Slack应用程序通过响应多个gif来响应搜索请求。为了简单起见，本文中演示的函数应用程序只使用</a><a class="ae kf" href="https://developers.giphy.com/docs/#operation--gifs-random-get" rel="noopener ugc nofollow" target="_blank"> Giphy随机API </a>返回与搜索关键字相对应的单个(随机)图像。这篇文章提供了一步一步的指导，让应用程序部署到<a class="ae kf" href="https://azure.microsoft.com/en-in/services/functions/?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Functions </a>并将其集成到您的Slack workspace中。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/bff66a8e2cf2e6aec41d7585d137d2df.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*CqlXvUqd5fG2xq_e4ovqTw.jpeg"/></div></figure><p id="a6f3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在这篇文章中，你将:</p><ul class=""><li id="e1c0" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated">获得Azure函数中<a class="ae kf" href="https://techcommunity.microsoft.com/t5/apps-on-azure/azure-functions-in-any-language-with-custom-handlers/ba-p/1942744" rel="noopener ugc nofollow" target="_blank"> <strong class="ki ir">自定义处理程序</strong>的概述</a></li><li id="8941" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">通过简短的代码演示了解幕后发生的事情</li><li id="9a6b" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">了解如何使用配置Azure功能和Slack设置解决方案</li><li id="d4d7" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">当然，在工作区运行你的Slack应用程序！</li></ul><p id="5fe2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">后端功能逻辑用Go编写(代码是GitHub 上可用的<a class="ae kf" href="https://github.com/abhirockzz/abhirockzz-serverless-go-slack-app" rel="noopener ugc nofollow" target="_blank">)。那些使用过Azure函数的人可能还记得，Go是默认支持的语言处理程序中的<em class="ly">而不是</em>。这就是</a><a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank">自定义处理程序</a>的作用！</p><h1 id="47bd" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是自定义处理程序？</h1><p id="58dc" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">简而言之，自定义处理程序是一个轻量级web服务器，它从函数主机接收事件。在您最喜欢的运行时/语言中，您唯一需要实现的定制处理程序是:HTTP支持！这并不意味着定制处理程序仅限于<a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=csharp&amp;WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank"> HTTP触发器</a>——您可以通过扩展包自由使用<a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings?tabs=csharp&amp;WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank">其他触发器以及输入和输出绑定</a>。</p><p id="5aa4" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">下面是自定义处理程序如何工作的概要(下图摘自文档)</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/8aebf2f3091cf2e9dd956e3e22872b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bxT8lcXMsio5BSx9.png"/></div></div></figure><p id="f3e6" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">事件触发器(通过HTTP、存储、事件中心等。)调用函数主机。自定义处理程序与传统函数的不同之处在于，函数主机充当中间人:它向自定义处理程序(函数)的web服务器发出请求有效负载，以及包含触发器、输入绑定数据和函数的其他元数据的<em class="ly">有效负载</em>。函数将响应返回给函数宿主，宿主将响应中的数据传递给函数的输出绑定进行处理。</p><h1 id="c419" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">概观</h1><p id="23ac" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">在我们深入其他领域之前，通过探索代码(顺便说一下，这相对简单)来理解本质可能会有所帮助</p><h1 id="4c82" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">应用程序结构</h1><p id="7ac0" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">让我们看看应用程序是如何设置的。这在文档中有定义</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="131c" class="ng ma iq nc b gy nh ni l nj nk">.<br/>├── cmd<br/>│   └── main.go<br/>├── funcy<br/>│   └── function.json<br/>├── go.mod<br/>├── host.json<br/>└── pkg<br/>    └── function<br/>        ├── function.go<br/>        ├── giphy.go<br/>        └── slack.go</span></pre><ul class=""><li id="4b63" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated"><code class="fe nl nm nn nc b">function.json</code>文件位于一个文件夹中，该文件夹的名称使用了函数名(<a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=data-9656-abhishgu#application-structure" rel="noopener ugc nofollow" target="_blank">这是惯例</a>)</li></ul><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="a9c3" class="ng ma iq nc b gy nh ni l nj nk">{<br/>    "bindings": [<br/>        {<br/>            "type": "httpTrigger",<br/>            "direction": "in",<br/>            "name": "req",<br/>            "methods": [<br/>                "get",<br/>                "post"<br/>            ]<br/>        },<br/>        {<br/>            "type": "http",<br/>            "direction": "out",<br/>            "name": "res"<br/>        }<br/>    ]<br/>}</span></pre><ul class=""><li id="e37d" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated"><code class="fe nl nm nn nc b">host.json</code>通过指向能够处理HTTP事件的web服务器，告知函数主机向何处发送请求。注意<code class="fe nl nm nn nc b">customHandler.description.defaultExecutablePath</code>，它定义了<code class="fe nl nm nn nc b">go_funcy</code>是用于运行web服务器的可执行文件的名称。<code class="fe nl nm nn nc b">"enableForwardingHttpRequest": true</code>确保原始HTTP数据不加任何修改地发送给定制处理程序</li></ul><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="4460" class="ng ma iq nc b gy nh ni l nj nk">{<br/>    "version": "2.0",<br/>    "extensionBundle": {<br/>        "id": "Microsoft.Azure.Functions.ExtensionBundle",<br/>        "version": "[1.*, 2.0.0)"<br/>    },<br/>    "customHandler": {<br/>        "description": {<br/>            "defaultExecutablePath": "go_funcy"<br/>        },<br/>        "enableForwardingHttpRequest": true<br/>    },<br/>    "logging": {<br/>        "logLevel": {<br/>            "default": "Trace"<br/>        }<br/>    }<br/>}</span></pre><ul class=""><li id="f9d9" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated"><code class="fe nl nm nn nc b">cmd</code>和<code class="fe nl nm nn nc b">pkg</code>目录包含Go源代码。让我们在下一小节中探讨这个问题</li></ul></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="f300" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">代码遍历</h1><p id="ddcb" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated"><code class="fe nl nm nn nc b">cmd/main.go</code>设置并启动HTTP服务器。注意，<code class="fe nl nm nn nc b">/api/funcy</code>端点是函数主机向定制处理程序HTTP服务器发送请求的端点。</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="6099" class="ng ma iq nc b gy nh ni l nj nk">func main() {<br/> port, exists := os.LookupEnv("FUNCTIONS_CUSTOMHANDLER_PORT")<br/> if !exists {<br/>   port = "8080"<br/> }<br/> http.HandleFunc("/api/funcy", function.Funcy)<br/> log.Fatal(http.ListenAndServe(":"+port, nil))<br/>}</span></pre><p id="e441" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">所有繁重的工作都在<code class="fe nl nm nn nc b">function/function.go</code>中完成。</p><p id="7e15" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">第一部分是读取请求体(从Slack中)并通过基于Slack 定义的<a class="ae kf" href="https://api.slack.com/docs/verifying-requests-from-slack#a_recipe_for_security" rel="noopener ugc nofollow" target="_blank">这个配方的签名验证过程来确保其完整性。</a></p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="3fee" class="ng ma iq nc b gy nh ni l nj nk">signingSecret := os.Getenv("SLACK_SIGNING_SECRET")<br/>	apiKey := os.Getenv("GIPHY_API_KEY")</span><span id="6539" class="ng ma iq nc b gy oa ni l nj nk">	if signingSecret == "" || apiKey == "" {<br/>		http.Error(w, "Failed to process request. Please contact the admin", http.StatusUnauthorized)<br/>		return<br/>	}</span><span id="d9d8" class="ng ma iq nc b gy oa ni l nj nk">	slackTimestamp := r.Header.Get("X-Slack-Request-Timestamp")</span><span id="d8c0" class="ng ma iq nc b gy oa ni l nj nk">	b, err := ioutil.ReadAll(r.Body)<br/>	if err != nil {<br/>		http.Error(w, "Failed to process request", http.StatusBadRequest)<br/>		return<br/>	}<br/>	slackSigningBaseString := "v0:" + slackTimestamp + ":" + string(b)<br/>	slackSignature := r.Header.Get("X-Slack-Signature")</span><span id="9f13" class="ng ma iq nc b gy oa ni l nj nk">	if !matchSignature(slackSignature, signingSecret, slackSigningBaseString) {<br/>		http.Error(w, "Function was not invoked by Slack", http.StatusForbidden)<br/>		return<br/>	}</span></pre><p id="773e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦我们确认该函数确实通过Slack被调用，下一步就是提取(Slack)用户输入的搜索词</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="267f" class="ng ma iq nc b gy nh ni l nj nk">vals, err := parse(b)<br/>	if err != nil {<br/>		http.Error(w, "Failed to process request", http.StatusBadRequest)<br/>		return<br/>	}<br/>	giphyTag := vals.Get("text")</span></pre><p id="8cde" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">通过调用GIPHY REST API，使用搜索词查找gif</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="1ee1" class="ng ma iq nc b gy nh ni l nj nk">giphyResp, err := http.Get("http://api.giphy.com/v1/gifs/random?tag=" + giphyTag + "&amp;api_key=" + apiKey)<br/>	if err != nil {<br/>		http.Error(w, "Failed to process request", http.StatusFailedDependency)<br/>		return<br/>	}</span><span id="dfcd" class="ng ma iq nc b gy oa ni l nj nk">	resp, err := ioutil.ReadAll(giphyResp.Body)<br/>	if err != nil {<br/>		http.Error(w, "Failed to process request", http.StatusInternalServerError)<br/>		return<br/>	}</span></pre><p id="c15d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">解编由GIPHY API发回的响应，将其转换成Slack能够理解的形式并返回。就是这样！</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="de22" class="ng ma iq nc b gy nh ni l nj nk">var gr GiphyResponse<br/>json.Unmarshal(resp, &amp;gr)<br/>title := gr.Data.Title<br/>url := gr.Data.Images.Downsized.URL</span><span id="b642" class="ng ma iq nc b gy oa ni l nj nk">slackResponse := SlackResponse{Text: slackResponseStaticText, Attachments: []Attachment{{Text: title, ImageURL: url}}}</span><span id="7620" class="ng ma iq nc b gy oa ni l nj nk">w.Header().Set("Content-Type", "application/json")<br/>json.NewEncoder(w).Encode(slackResponse)<br/>fmt.Println("Sent response to Slack")</span></pre><blockquote class="ob oc od"><p id="dcd2" class="kg kh ly ki b kj kk jr kl km kn ju ko oe kq kr ks of ku kv kw og ky kz la lb ij bi translated"><em class="iq">如果您对检查签名验证过程感兴趣，请检查</em> <code class="fe nl nm nn nc b"><em class="iq">matchSignature</em></code> <em class="iq">函数，并查看slack.go、giphy.go(在</em> <code class="fe nl nm nn nc b"><em class="iq">function</em></code> <em class="iq">目录中)以查看所使用的go结构表示在各个组件之间交换的信息(JSON)。为了保持这篇文章的简洁，这里没有包括这些内容。</em></p></blockquote><p id="973e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">好吧！到目前为止，我们已经介绍了很多理论和背景信息。是时候把事情做好了！在您继续之前，请确保您考虑了下面提到的先决条件。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="2c31" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">先决条件</h1><ul class=""><li id="da6d" class="lk ll iq ki b kj mr km ms kp oh kt oi kx oj lb lp lq lr ls bi translated"><a class="ae kf" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank">下载并安装Go </a>如果你还没有的话</li><li id="af40" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">安装<a class="ae kf" href="https://docs.microsoft.com/azure/azure-functions/functions-run-local?tabs=macos%2Ccsharp%2Cbash&amp;WT.mc_id=data-9656-abhishgu#v2" rel="noopener ugc nofollow" target="_blank"> Azure functions核心工具</a>——这将允许您使用CLI部署功能(并在本地运行测试和调试)</li><li id="7b2a" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated"><a class="ae kf" href="https://slack.com/create" rel="noopener ugc nofollow" target="_blank">如果你没有空余的工作空间，就去创建一个空余的工作空间</a>。</li><li id="a7d1" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">获取GIPHY API密钥—您需要创建GIHPY帐户(这是免费的！)和<a class="ae kf" href="https://developers.giphy.com/dashboard/?create=true" rel="noopener ugc nofollow" target="_blank">创建一个应用</a>。您创建的每个应用程序都将有自己的API密钥。</li></ul><blockquote class="ob oc od"><p id="61bc" class="kg kh ly ki b kj kk jr kl km kn ju ko oe kq kr ks of ku kv kw og ky kz la lb ij bi translated"><em class="iq">请记下你的GIPHY API密钥，因为你以后会用到它</em></p></blockquote><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ok"><img src="../Images/3e685fb673a341cc744fbd6448845b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GxYwuD1mmPk7oDgYgXAzA.png"/></div></div></figure><p id="2231" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">接下来的部分将指导您完成部署Azure函数和为Slash命令配置Slack的过程。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="4fbc" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">Azure Functions设置</h1><p id="ff55" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">首先创建一个<a class="ae kf" href="https://docs.microsoft.com/azure/azure-resource-manager/management/manage-resource-groups-portal?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank">资源组</a>，以托管解决方案的所有组件。</p><h2 id="4896" class="ng ma iq bd mb ol om dn mf on oo dp mj kp op oq ml kt or os mn kx ot ou mp ov bi translated">创建函数应用程序</h2><p id="746b" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">首先在Azure门户中搜索<strong class="ki ir">功能应用</strong>，点击<strong class="ki ir">增加</strong></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ow"><img src="../Images/f7bea0d82b5c82509f0a56412dd0cf9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgZYCBb7eWj3r1-uGeOwHA.png"/></div></div></figure><p id="6fa9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">输入所需的详细信息:选择<strong class="ki ir">自定义处理程序</strong>作为<strong class="ki ir">运行时堆栈</strong></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ox"><img src="../Images/c8502026cee1125c3559a6e5f0dac3cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D979WcTvmDK5eA_ZIGwGjw.png"/></div></div></figure><p id="8dee" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在<strong class="ki ir">托管</strong>部分，选择<strong class="ki ir"> Linux </strong>和<strong class="ki ir">消费(无服务器)</strong>分别为<strong class="ki ir">操作系统</strong>和<strong class="ki ir">计划类型</strong>。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oy"><img src="../Images/0e3daa705e4b4e6efff61ec1141ffcef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrVzUqSuGJeOov0wx1ACng.png"/></div></div></figure><p id="e278" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">启用应用洞察(如果需要)</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi oz"><img src="../Images/a44c52da8c4cdec1f4b73b5e48d94fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ZRoY8MT7aXan8R1Rz9tIw.png"/></div></div></figure><p id="d3ab" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">查看最终设置并点击<strong class="ki ir">创建</strong>继续</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pa"><img src="../Images/3abeb30c29762904f2e3b62bf3e16e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hVCgWgc2xke-WURLDADzpA.png"/></div></div></figure><p id="2453" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">流程完成后，还将创建以下资源以及Function App:</p><ul class=""><li id="48df" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated"><a class="ae kf" href="https://docs.microsoft.com/azure/app-service/overview-hosting-plans?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank"> App服务计划</a>(本例中为消费/无服务器计划)</li><li id="a09b" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">一个<a class="ae kf" href="https://docs.microsoft.com/azure/storage/common/storage-account-overview?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Storage账户</a></li><li id="0117" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">an<a class="ae kf" href="https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview?WT.mc_id=data-9656-abhishgu" rel="noopener ugc nofollow" target="_blank">Azure Application Insights</a>功能)</li></ul><h2 id="0c5b" class="ng ma iq bd mb ol om dn mf on oo dp mj kp op oq ml kt or os mn kx ot ou mp ov bi translated">部署功能</h2><p id="dcca" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">克隆GitHub回购并构建该函数</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="30c8" class="ng ma iq nc b gy nh ni l nj nk">git clone https://github.com/abhirockzz/serverless-go-slack-app<br/>cd serverless-go-slack-app</span><span id="b83f" class="ng ma iq nc b gy oa ni l nj nk">GOOS=linux go build -o go_funcy cmd/main.go</span></pre><blockquote class="ob oc od"><p id="0538" class="kg kh ly ki b kj kk jr kl km kn ju ko oe kq kr ks of ku kv kw og ky kz la lb ij bi translated"><em class="iq">是用来构建</em>的<em class="iq">可执行程序，因为我们选择了</em>T2<em class="iq">操作系统作为我们的功能App </em></p></blockquote><p id="96b9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">要进行部署，请使用Azure Functions核心工具</p><pre class="ld le lf lg gt nb nc nd ne aw nf bi"><span id="fbff" class="ng ma iq nc b gy nh ni l nj nk">func azure functionapp publish &lt;enter name of the function app&gt;</span></pre><p id="5e63" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">部署完成后，复制命令返回的函数URL您将在后续步骤中使用它</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pb"><img src="../Images/d3ac6e0ef9e65780666a6ce00c900870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGlRzAn4w5IHdqO-aa5_yg.png"/></div></div></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="be48" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">配置Slack</h1><p id="cfa4" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">本节将介绍在工作区中设置Slack应用程序(Slash命令)所需执行的步骤:</p><ul class=""><li id="8a23" class="lk ll iq ki b kj kk km kn kp lm kt ln kx lo lb lp lq lr ls bi translated">创建一个Slack应用程序</li><li id="f639" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">创建斜线命令</li><li id="857e" class="lk ll iq ki b kj lt km lu kp lv kt lw kx lx lb lp lq lr ls bi translated">将应用程序安装到您的工作区</li></ul><h2 id="da2b" class="ng ma iq bd mb ol om dn mf on oo dp mj kp op oq ml kt or os mn kx ot ou mp ov bi translated">创建一个Slack应用程序和斜杠命令</h2><p id="ccc0" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">登录到你的<a class="ae kf" href="https://slack.com/signin" rel="noopener ugc nofollow" target="_blank"> Slack Workspace </a>，开始<a class="ae kf" href="https://api.slack.com/apps/new" rel="noopener ugc nofollow" target="_blank">创建一个新的Slack应用</a></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pc"><img src="../Images/1d1cddb0fe564d749178b60bf0de3c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rfa532wyJ97nLXph-V2Oxw.jpeg"/></div></div></figure><p id="b6aa" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">点击<em class="ly">创建新命令</em>，用所需信息定义新的<em class="ly">斜线命令</em>。请注意，在<strong class="ki ir">请求URL </strong>字段中，您将输入函数的HTTP端点，它只不过是您在上一节中部署函数后获得的URL。完成后，点击<strong class="ki ir">保存</strong>完成。</p><h2 id="a5cb" class="ng ma iq bd mb ol om dn mf on oo dp mj kp op oq ml kt or os mn kx ot ou mp ov bi translated">将应用程序安装到您的工作区</h2><p id="c3e7" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">创建完Slash命令后，转到应用程序的设置页面，在导航菜单中单击<em class="ly">基本信息</em>功能，选择<em class="ly">将应用程序安装到工作区</em>并单击<em class="ly">将应用程序安装到工作区</em> —这将把应用程序安装到Slack工作区，以测试应用程序并生成与Slack API交互所需的令牌。一旦你安装完应用程序，<em class="ly">应用程序凭证</em>就会出现在同一个页面上。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pd"><img src="../Images/e02ccba9129176a76a731fe524269804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsvJuvkA1JwkyxqhvcObMQ.png"/></div></div></figure><blockquote class="ob oc od"><p id="8bd8" class="kg kh ly ki b kj kk jr kl km kn ju ko oe kq kr ks of ku kv kw og ky kz la lb ij bi translated"><em class="iq">记下您的应用程序</em> <strong class="ki ir"> <em class="iq">签名密码</em> </strong> <em class="iq">，因为您稍后会用到它</em></p></blockquote><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pe"><img src="../Images/92309fef6d6efb95d57a5032b80e3337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSCHS83F7sG2R3KuYqM94Q.jpeg"/></div></div></figure><h2 id="1e79" class="ng ma iq bd mb ol om dn mf on oo dp mj kp op oq ml kt or os mn kx ot ou mp ov bi translated">在进入有趣的部分之前…</h2><p id="6b9d" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">…确保更新函数应用配置，以添加松弛签名密码(<code class="fe nl nm nn nc b">SLACK_SIGNING_SECRET</code>)和Giphy API密钥(<code class="fe nl nm nn nc b">GIPHY_API_KEY</code> ) -它们将作为函数中的环境变量。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi pf"><img src="../Images/97a5a3a82f71d9cb495b24105b7592fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3BeH36rWFzFpmpKvKRzqw.png"/></div></div></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><h1 id="e5d6" class="lz ma iq bd mb mc nv me mf mg nw mi mj jw nx jx ml jz ny ka mn kc nz kd mp mq bi translated">欢乐时光！</h1><p id="e6af" class="pw-post-body-paragraph kg kh iq ki b kj mr jr kl km ms ju ko kp mt kr ks kt mu kv kw kx mv kz la lb ij bi translated">从您的松弛工作区，调用命令<code class="fe nl nm nn nc b">/funcy &lt;search term&gt;</code>。例如，尝试<code class="fe nl nm nn nc b">/funcy dog</code>。你应该得到一个随机的GIF作为回报！</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/54bd80b108268b2de28c5b2adf522f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/0*mJoyLpcPriVb0SKV.gif"/></div></figure><p id="d2db" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">简单回顾一下正在发生的事情:当你在Slack中调用<code class="fe nl nm nn nc b">/funcy</code>命令时，它调用函数，然后函数与Giphy API交互，最后将GIF返回给用户(如果一切顺利的话！)</p><p id="6eed" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">第一次调用后，您可能会从Slack中看到<code class="fe nl nm nn nc b">timeout error</code>。这很可能是由于<code class="fe nl nm nn nc b">cold start</code>，当你第一次调用它时，函数需要几秒钟来引导。这与<a class="ae kf" href="https://api.slack.com/slash-commands#responding_basic_receipt" rel="noopener ugc nofollow" target="_blank"> Slack期望在3秒内得到响应</a>的事实相结合——因此产生了错误消息。</p><p id="fc60" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">没什么好担心的。你需要做的就是再次尝试，一切都会好的！</p><blockquote class="ob oc od"><p id="0479" class="kg kh ly ki b kj kk jr kl km kn ju ko oe kq kr ks of ku kv kw og ky kz la lb ij bi translated"><em class="iq">清理:一旦完成，不要忘记</em> <a class="ae kf" href="https://docs.microsoft.com/azure/azure-resource-manager/management/delete-resource-group?tabs=azure-powershell&amp;WT.mc_id=data-9656-abhishgu#delete-resource-group" rel="noopener ugc nofollow" target="_blank"> <em class="iq">删除资源组</em> </a> <em class="iq">，这将依次删除之前创建的所有资源(功能app、App服务计划等。)</em></p></blockquote></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="6ddc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">现在，没有什么可以阻止你在Azure上使用Go实现无服务器功能！我希望这将是一种尝试定制处理程序的有趣方式。让我们知道你的想法。</p></div></div>    
</body>
</html>