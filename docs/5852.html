<html>
<head>
<title>Which Container Images To Use — Distroless Or Alpine?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用哪个容器图像—distroles还是Alpine？</h1>
<blockquote>原文：<a href="https://itnext.io/which-container-images-to-use-distroless-or-alpine-96e3dab43a22?source=collection_archive---------0-----------------------#2021-06-11">https://itnext.io/which-container-images-to-use-distroless-or-alpine-96e3dab43a22?source=collection_archive---------0-----------------------#2021-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ffca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这里有一个实验来更好地理解这一点</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/186a336f7bf6e6b3f2fdfe64dad4dc59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebZDQ3Ad_8WgDfh-QjivRA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://unsplash.com/@carrier_lost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">伊恩·泰勒</a>在<a class="ae ky" href="https://unsplash.com/s/photos/docker-container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="a869" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated">如今，使用容器进行应用程序开发和部署非常普遍。</p><p id="60f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">虽然容器确实带来了很多价值，但它们也带来了一些挑战，比如—</p><ul class=""><li id="a6d0" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">更大的图像意味着构建时间的增加，以及成本的增加</li><li id="852a" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">映像中包含的更多库可以扩大漏洞扫描工具的范围</li><li id="443c" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">等等。</li></ul><p id="b2ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个问题最常见的解决方案是——使用更小的发行版！</p><p id="6c03" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用像Alpine这样的轻量级发行版是开发人员避免容器映像变得庞大的一种非常常见的技术。即使您可以实现这一点，也总是存在由底层库导致的公开漏洞的风险。</p><p id="d8a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谷歌通过引入无发行版图像解决了这个问题。</p><blockquote class="ms mt mu"><p id="94a4" class="kz la mv lb b lc ld ju le lf lg jx lh mw lj lk ll mx ln lo lp my lr ls lt lu im bi translated">“发行版”映像只包含您的应用程序及其运行时依赖项。它们不包含包管理器、shells或任何其他您期望在标准Linux发行版中找到的程序。</p></blockquote><p id="c511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在阅读了Gaurav Agarwal关于如何用Distroless Docker镜像来加固你的容器的故事后，我决定尝试一下，获得第一手经验。</p><p id="56ca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将使用Distroless和Alpine image创建一个Java应用程序容器，对两者运行漏洞扫描，并比较构建时间、映像大小等。</p><p id="d654" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以让我们开始吧。</p></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="9b90" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">使用发行版图像</h2><p id="6d19" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">我为这个实验创建了一个简单的Hello World Spring Boot Java应用程序。</p><p id="c603" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我用Distroless图像创建了一个<code class="fe og oh oi oj b">Dockerfile</code>，如下所示</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="4d97" class="ni nj it oj b gy oo op l oq or">FROM maven:3.5-jdk-8 AS build</span><span id="0ee8" class="ni nj it oj b gy os op l oq or">COPY src /usr/src/app/src</span><span id="6290" class="ni nj it oj b gy os op l oq or">COPY pom.xml /usr/src/app</span><span id="8088" class="ni nj it oj b gy os op l oq or">RUN mvn -f /usr/src/app/pom.xml clean package</span><span id="a8ee" class="ni nj it oj b gy os op l oq or">FROM <!-- -->gcr.io/distroless/java:8</span><span id="ea7c" class="ni nj it oj b gy os op l oq or">ARG DEPENDENCY=/usr/src/app/target/dependency</span><span id="09d3" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/BOOT-INF/lib /app/lib</span><span id="8ee3" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/META-INF /app/META-INF</span><span id="a6a6" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/BOOT-INF/classes /app</span><span id="b9f6" class="ni nj it oj b gy os op l oq or">ENTRYPOINT ["java","-cp","app:app/lib/*","DemoApplication.Application"]</span></pre><p id="e8a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">构建完成了，如下所示—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/9576a9c064cc68e05c626efe7c8b9e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1GYaW27KDhYAiIugiv0bA.png"/></div></div></figure><p id="0ddc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我用<a class="ae ky" href="https://github.com/aquasecurity/trivy" rel="noopener ugc nofollow" target="_blank"> Trivy </a>运行了一个图像扫描。结果如下所示—</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/c743722b5a31e28576d4fb264daa2d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AffmZypYjhYoaCsxlF-cw.png"/></div></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="5e45" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">使用阿尔卑斯山图像</h2><p id="243c" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">接下来，我用阿尔卑斯山的图像重复了这个实验。本实验的<code class="fe og oh oi oj b">Dockerfile</code>如下所示—</p><pre class="kj kk kl km gt ok oj ol om aw on bi"><span id="d520" class="ni nj it oj b gy oo op l oq or">FROM maven:3.5-jdk-8 AS build</span><span id="a4c3" class="ni nj it oj b gy os op l oq or">COPY src /usr/src/app/src</span><span id="03e4" class="ni nj it oj b gy os op l oq or">COPY pom.xml /usr/src/app</span><span id="8a73" class="ni nj it oj b gy os op l oq or">RUN mvn -f /usr/src/app/pom.xml clean package</span><span id="2c3f" class="ni nj it oj b gy os op l oq or">FROM openjdk:8-jre-alpine</span><span id="84b1" class="ni nj it oj b gy os op l oq or">ARG DEPENDENCY=/usr/src/app/target/dependency</span><span id="599e" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/BOOT-INF/lib /app/lib</span><span id="2099" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/META-INF /app/META-INF</span><span id="8c28" class="ni nj it oj b gy os op l oq or">COPY --from=build ${DEPENDENCY}/BOOT-INF/classes /app</span><span id="b3bc" class="ni nj it oj b gy os op l oq or">ENTRYPOINT ["java","-cp","app:app/lib/*","DemoApplication.Application"]</span></pre><p id="6fd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">建造成功完成——</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/967705e0b0cd331995baffc9af1e48cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-8abr0Bz6FG23kImqme5w.png"/></div></div></figure><p id="6e1e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后我对这张图片进行了一次简单的扫描，得到了以下结果</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/276da027889edb56ce0f405ee872df53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CWe01bN4hxNNpIStc3BDFA.png"/></div></div></figure></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h2 id="dcc2" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">面对面比较</h2><p id="1594" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">基于这个实验，这是我在我的环境中观察到的—</p><ul class=""><li id="b517" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated"><strong class="lb iu">图像大小</strong> —使用Alpine base图像编译的图像为<strong class="lb iu"> 93.5 MB </strong>，而distroless图像为<strong class="lb iu"> 139 MB </strong>。所以阿尔卑斯山的图像比distroless的图像要亮。</li><li id="af71" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><strong class="lb iu">漏洞数量</strong> — Alpine image共有:<strong class="lb iu"> 216个</strong>漏洞(未知:0，低:106，中:79，高:27，严重:4)，而Distroless Image共有:<strong class="lb iu"> 50个</strong>漏洞(未知:0，低:30，中:6，高:9，严重:5)</li></ul><blockquote class="ox"><p id="915e" class="oy oz it bd pa pb pc pd pe pf pg lu dk translated">总之，如果你更关心安全性，那么当然推荐使用无发行版映像。如果你担心大小，那么阿尔卑斯山可能是一个更好的选择。</p></blockquote><p id="87e7" class="pw-post-body-paragraph kz la it lb b lc ph ju le lf pi jx lh li pj lk ll lm pk lo lp lq pl ls lt lu im bi translated">你可以在这里找到这个实验的完整代码—</p><div class="pm pn gp gr po pp"><a href="https://github.com/deshpandetanmay/distroless" rel="noopener  ugc nofollow" target="_blank"><div class="pq ab fo"><div class="pr ab ps cl cj pt"><h2 class="bd iu gy z fp pu fr fs pv fu fw is bi translated">deshpendatanmay/distroles</h2><div class="pw l"><h3 class="bd b gy z fp pu fr fs pv fu fw dk translated">在GitHub上创建一个帐户，为deshpendanmay/distrolles的发展做出贡献。</h3></div><div class="px l"><p class="bd b dl z fp pu fr fs pv fu fw dk translated">github.com</p></div></div><div class="py l"><div class="pz l qa qb qc py qd ks pp"/></div></div></a></div></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi qe"><img src="../Images/9b217f0a9f1d151d6681462994c8f1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/0*GmJKW4Pdf2C3FC1Y.png"/></div></figure><h1 id="76b2" class="qf nj it bd nk qg qh qi nn qj qk ql nq jz qm ka nt kc qn kd nw kf qo kg nz qp bi translated">嘿，如果你喜欢这个故事，看看<a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">中级会员</a>！只要5美元/月！</h1><p id="a88c" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated"><em class="mv">你的会员费直接支持我和你看的其他作家。你也可以在媒体上看到所有的故事。</em></p><h1 id="5943" class="qf nj it bd nk qg qh qi nn qj qk ql nq jz qm ka nt kc qn kd nw kf qo kg nz qp bi translated"><a class="ae ky" href="https://deshpandetanmay.medium.com/membership" rel="noopener">现在就成为中等会员吧！</a></h1></div></div>    
</body>
</html>