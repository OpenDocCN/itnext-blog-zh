<html>
<head>
<title>Master Lists in React Native : A New Hope</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native中的主列表:新的希望</h1>
<blockquote>原文：<a href="https://itnext.io/master-lists-in-react-native-54b485de56f5?source=collection_archive---------4-----------------------#2019-07-10">https://itnext.io/master-lists-in-react-native-54b485de56f5?source=collection_archive---------4-----------------------#2019-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d1db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">年轻的程序员…初级工程师，欢迎来到列表圣殿，在这里你将学习如何为你的应用程序建立完美的列表。要成为一名反应原生艺人，你必须掌握两件事:<em class="kl">列表</em>和<em class="kl">形式</em>。今天你将掌握列表。</p><p id="51d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">列表就像一只九头蛇，它们起初看起来很容易掌握，你甚至相信你可以用几行代码来创建一个列表，但是不要被欺骗了，它们可以长很多个头，并且有不可预见的状态要处理。</p><p id="0f33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天你将学习列表的方式，列表可以转换成的各种状态，你如何从概念上模拟这些不同的状态来构建处理不确定数据的抗错列表，并在你的应用中达到平衡。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/aaf5f76856063e6431ed8b8571846a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRYaEw6wVsvUltKjmS58ww.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae lc" href="https://unsplash.com/@sakulich?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">谢尔盖·阿库利奇</a>在<a class="ae lc" href="https://unsplash.com/search/photos/snake-monument?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="bf47" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">列表的状态</h1><p id="67e5" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">当我们在构建我们的列表时，四种状态浮现在脑海中；<em class="kl">空</em>、<em class="kl">数据</em>、<em class="kl">错误</em>和<em class="kl">加载</em>，但是当我们进一步调解这些状态时，我们发现我们的列表有一个更好的模型。</p><p id="e34c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图显示了列表的传统模型。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mg"><img src="../Images/10ce336005be848e9f456c538da882a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKvl3Oic_enOpMnKkADrMQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在“<a class="ae lc" href="https://rewardmenow.co.uk/" rel="noopener ugc nofollow" target="_blank">立即奖励我</a>”中的常规列表状态</figcaption></figure><p id="fe87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个列表需要所有这些状态是正确的，但是我们思考这些状态的方式导致了问题；我们认为这些状态都属于同一抽象层次。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/20550c3c37f4ad331b969cdd96947dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/1*IydpHHqdnOLL3R1y_KocmA.gif"/></div></figure><p id="0d5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实是，一个列表只有两个状态，还有多个子状态。列表的两个顶级状态是<strong class="jp ir">数据</strong> <em class="kl">(数据可用)</em> <strong class="jp ir"> </strong>和<strong class="jp ir">空</strong> <em class="kl">(数据不可用)</em> <strong class="jp ir">。</strong></p><p id="8f4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只有这两种状态，而没有混合的<em class="kl">错误</em>和<em class="kl">加载</em>状态，因为首先我们不希望错误和加载超过我们的数据。其次，在我们的列表中有多种类型的<em class="kl">错误</em>和<em class="kl">加载</em>状态<em class="kl"> </em>，根据我们的数据是否可用，我们以不同的方式处理错误和加载。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mi"><img src="../Images/cd802d0d13296d516b5ba8506f4feccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*giahA_cwQqCo-vzrmLHOKA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">传统模式与开明模式</figcaption></figure><p id="9bae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">* <em class="kl">本条中的</em> <strong class="jp ir"> <em class="kl">数据</em> </strong> <em class="kl">是指数据可用时的列表状态。*本条中的</em> <strong class="jp ir"> <em class="kl">空</em> </strong> <em class="kl">一词是指当</em> <strong class="jp ir"> <em class="kl">数据不可用</em> </strong> <em class="kl">时列表的状态。</em></p><h1 id="95d8" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">数据(有数据可查)</strong></h1><p id="2d86" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">顶级数据状态具有最高优先级，如果其数据可用，它将始终显示在列表中。</p><p id="a754" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的代码可能如下所示:</p><pre class="kn ko kp kq gt mj mk ml mm aw mn bi"><span id="9d9c" class="mo le iq mk b gy mp mq l mr ms">if(!_.isEmpty(data)){ // We have data, always display the list<br/>   // Display List <br/>   &lt;FlatList ... /&gt;<br/>} else {<br/>   // Handle errors, loading when our list is empty</span></pre><p id="e037" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不希望分页、刷新和交互的错误停止列表中的数据显示，扰乱用户体验…那将是不好的因果报应。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/acfc8e38de955106738bdc8d3b914cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0TCTRaG5u2IV_nhU93yqA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">列表中的项目(数据可用)</figcaption></figure><h2 id="f431" class="mo le iq bd lf mu mv dn lj mw mx dp ln jy my mz lr kc na nb lv kg nc nd lz ne bi translated"><strong class="ak">错误</strong></h2><p id="15f1" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">在我们的数据列表中可能会出现两种类型的错误；<strong class="jp ir">网络错误</strong>和<strong class="jp ir">处理错误</strong>。这些错误可能发生在多个维度上，它们可能发生在整个列表上，例如刷新错误，也可能发生在单个列表项上，例如删除了单个项目并导致网络错误。</p><p id="9e31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">网络错误</strong></p><p id="3aa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网络错误意味着某个API级别出现了问题；API中存在语法错误，没有网络连接，存在服务器错误。等等。</p><p id="368b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当数据存在于我们的列表中时，我们不希望网络错误中断数据的显示，在这种情况下，我们需要向用户显示警告，通知他们他们与列表或项目的交互导致了错误，而不会中断列表。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/6a25558db8e3bd79534209b125a7b855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmTvDfbdWtWmFFIk5kFDUg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">数据时出现网络错误</figcaption></figure><p id="b00b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">加工错误</strong></p><p id="3f09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当列表或条目中的计算出错并导致我们的应用程序崩溃时，就会发生处理错误，这是因为来自API的数据可能是不确定的，任何带有不确定数据的计算都可能失败。</p><p id="5249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，我们用一个<a class="ae lc" href="https://reactjs.org/docs/error-boundaries.html" rel="noopener ugc nofollow" target="_blank"> ErrorBoundary </a>包装列表，并提供一个回退UI来防止应用程序崩溃。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/949441eeb2849657d9f647471684cf29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cm79e0CSU99412K63HF0NQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">列表处理错误</figcaption></figure><p id="f152" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不处理这些错误会使你的应用程序崩溃，破坏你精心制作的用户体验，并破坏你的应用程序的平衡。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/c7041caa82c594d2f76e7653b55c7a35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trMy7RfO6pI9GxzxmJU72w.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">我们项目中的例外</figcaption></figure><p id="7a17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">处理错误也可能发生在我们的列表项中，作为完美用户体验的大师，我们不希望这些错误破坏我们的完整列表。我们还必须将每个列表项包装在一个<a class="ae lc" href="https://reactjs.org/docs/error-boundaries.html" rel="noopener ugc nofollow" target="_blank"> ErrorBoundary </a>中，这样做的好处是允许每个列表项独立处理错误。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/0befe71a17b91ddac863a8e6a5ef0396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQhpIgkYTmn15ZCIhBJ3nA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">我们的两个项目已经崩溃的列表</figcaption></figure><h2 id="0caa" class="mo le iq bd lf mu mv dn lj mw mx dp ln jy my mz lr kc na nb lv kg nc nd lz ne bi translated"><strong class="ak">装载</strong></h2><p id="531d" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">当数据在我们的列表中可用时，网络请求的状态不应该影响数据的显示，我们不能在每次用户刷新或分页我们的列表时都显示全屏加载指示器。在这种情况下，我们可能希望列表在数据旁边显示一个加载指示器。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/c197e373fcd8dcd3e1cf81c9138d5021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dqm7f5B80YiXl_qpWyvHsA.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">刷新列表</figcaption></figure><p id="a37b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这可以是整个列表的加载指示符，也可以是单个项目的加载指示符，这取决于用户所做的动作类型。</p><p id="d684" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用该模型可以从现有数据中导出<code class="fe ng nh ni mk b">isRefreshing</code>变量(其中<code class="fe ng nh ni mk b">isLoading</code>是表示X网络请求正在进行中的布尔值):</p><pre class="kn ko kp kq gt mj mk ml mm aw mn bi"><span id="0fc4" class="mo le iq mk b gy mp mq l mr ms">const <!-- -->isRefreshing = !_.isEmpty(data) &amp;&amp; isLoading;</span></pre><p id="3d8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重要的是，我们的加载状态不会破坏我们的数据。</p><blockquote class="nj"><p id="2a5d" class="nk nl iq bd nm nn no np nq nr ns kk dk translated"><strong class="ak">显示数据永远是重中之重</strong>。</p></blockquote></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="dab1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以随意向这个模型添加更多的状态，最重要的是要注意到<em class="kl">数据</em>(数据可用)是所有这些子状态的顶级状态。其中<em class="kl"> empty </em>(数据不可用)将有它自己的子状态，接下来您会发现。</p><h1 id="0a2d" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">空(数据不可用)</h1><p id="32b5" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">当没有可用数据时，我们可以更加灵活地处理页面并显示给用户。这通常包括显示一个回退，提示用户采取行动。吸引用户在这些<em class="kl">空</em>状态下采取行动是一个很好的模式。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/d908f959150a297e6fbb9dd7551af85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fgy_qxltrXCLw34B3k7inQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">没有可用的卡(<em class="oa">空</em>状态)</figcaption></figure><p id="ad6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要注意的是，对于<em class="kl">空</em>状态，错误<em class="kl">需要优先于我们的<em class="kl">空</em>状态，就像网络请求中发生了错误一样，我们不能假设用户没有X资源。</em></p><h2 id="2575" class="mo le iq bd lf mu mv dn lj mw mx dp ln jy my mz lr kc na nb lv kg nc nd lz ne bi translated"><strong class="ak">错误</strong></h2><p id="a1fb" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">在<em class="kl">空的</em>顶级状态中，列表级没有计算，所以唯一可用的错误是网络错误，这可能有很多种；API问题(500)、无权限(422)或无互联网连接等。</p><p id="d9ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以实现基于错误类型显示不同用户界面的逻辑；422 -&gt;提示用户登录，500 -&gt;重试请求，没有互联网-&gt;提示连接到互联网等。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mt"><img src="../Images/6b2b8d6489222bf8471c3c6a04f9c528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37sX_AEPmoAHd_oFmeknNw.png"/></div></div></figure><p id="683b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在这个<em class="kl">错误</em>状态中添加子状态，例如一个刷新控件，这样用户就可以下拉这个页面并尝试刷新，就好像它是一个列表一样。该子状态将是<em class="kl">空- &gt;错误- &gt;加载。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ob"><img src="../Images/5d95f8d8efdd995d8bbc933cda67c5c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRZPfoCivzeBNhzwTTAoxg.png"/></div></div></figure><p id="2e41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用这个模型，我们可以添加子状态到我们的状态中，并构建一个更有深度的用户体验。</p><h2 id="86ff" class="mo le iq bd lf mu mv dn lj mw mx dp ln jy my mz lr kc na nb lv kg nc nd lz ne bi translated"><strong class="ak">装载</strong></h2><p id="92e1" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">这是列表的初始加载状态，列表为<em class="kl">空</em>，列表为<em class="kl">加载</em>。我们可以安全地显示列表的全尺寸加载器，因为还没有发生任何有趣的事情。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/0337fea9082164863fcec39c19348821.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*OIQ282QRQQmwO8eHVX3a7w.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">装载指示器</figcaption></figure><p id="7f94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个模型可以以各种方式扩展，主要的一点是，如果我们想提供优雅的用户体验，激发用户的喜悦，现在是时候停止在平面状态下考虑列表，并转向多维状态模型。</p><p id="2ae8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喜欢这些想法吗？<a class="ae lc" rel="noopener ugc nofollow" target="_blank" href="/master-lists-in-react-native-beyond-the-list-3a80dcd85522">检验部分2 </a>。</p></div></div>    
</body>
</html>