<html>
<head>
<title>Kotlin: Wrapping your head around LiveData, MutableLiveData, Coroutine Networking and ViewModel using MVVM — A Practical Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">科特林:用MVVM来思考实时数据、可变实时数据、协同程序网络和视图模型——一个实际的例子</h1>
<blockquote>原文：<a href="https://itnext.io/kotlin-wrapping-your-head-around-livedata-mutablelivedata-coroutine-networking-and-viewmodel-b552c3a74eec?source=collection_archive---------1-----------------------#2019-06-17">https://itnext.io/kotlin-wrapping-your-head-around-livedata-mutablelivedata-coroutine-networking-and-viewmodel-b552c3a74eec?source=collection_archive---------1-----------------------#2019-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ef790c307bfda54c21f22b474d153079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvC9GaNmmbw_Il7yFi086g.jpeg"/></div></div></figure><p id="e790" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated"><span class="l la lb lc bm ld le lf lg lh di"> L </span> <a class="ae li" href="https://developer.android.com/topic/libraries/architecture/livedata#java" rel="noopener ugc nofollow" target="_blank"> iveData </a>被创建为一个<strong class="kd iu">生命周期感知数据</strong> <strong class="kd iu">容器，并考虑了观察者<br/>模式。</strong>所以基本上当数据改变时它会自动通知视图并改变它。当我们创建一个LiveData对象时，我们的视图，无论是活动还是片段，都将作为这个数据的观察者，然后更新，但仍然考虑生命周期状态。使用LiveData，我们可以编写代码来观察这些数据变化，并相应地更新视图。</p><p id="0c62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">使用LiveData的优势如</strong> <a class="ae li" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">此处:</strong> </a></p><blockquote class="lj lk ll"><p id="390b" class="kb kc lm kd b ke kf kg kh ki kj kk kl ln kn ko kp lo kr ks kt lp kv kw kx ky im bi translated"><strong class="kd iu"> -确保您的用户界面与您的数据状态相匹配<br/> -无内存泄漏<br/> -不会因停止的活动而崩溃<br/> -不再需要手动处理生命周期<br/> -始终保持最新数据<br/> -适当的配置更改<br/> -共享资源<br/></strong>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</p></blockquote><p id="4994" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated"><span class="l la lb lc bm ld le lf lg lh di"> L </span>让我们从<em class="lm"> Kotlin </em> 中的一个<strong class="kd iu">简单演示项目开始深入了解LiveData、ViewModel、MutableLiveData和Coroutines。</strong></p><p id="ba94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用Retrofit2进行Rest API调用，该调用将从服务器获取数据，并在ViewModel和LiveData的帮助下显示在RecyclerView上。</p><p id="33b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个示例应用程序将演示以下组件。</p><ul class=""><li id="4527" class="lq lr it kd b ke kf ki kj km ls kq lt ku lu ky lv lw lx ly bi translated">LiveData</li><li id="6f99" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">可变数据</li><li id="eebf" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">视图模型</li><li id="bee0" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">翻新2</li><li id="a528" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">魔石</li><li id="1ee1" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">协程网络</li><li id="5cd6" class="lq lr it kd b ke lz ki ma km mb kq mc ku md ky lv lw lx ly bi translated">滑音</li></ul><h2 id="e440" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">创建新项目:</h2><p id="d900" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">在Android Studio中使用EmptyActivity模板创建一个新项目，并将其命名为LiveDataExample。现在将这些依赖项添加到app/build.gradle文件中。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/76975c33f896a547158c5f67df8482ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyALm4y0eEV0FKIIXRfspA.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">MVVM图</figcaption></figure><h2 id="238e" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">创建您的包/文件夹MVVM架构:</h2><p id="e2e8" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">我们正在创建一个<a class="ae li" href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> MVVM架构</strong> </a>，因此为我们的REST API接口创建如下的文件夹结构<em class="lm">模型、视图、视图模型</em>和<em class="lm">网络</em>。</p><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/56e14b04dd764435e6e6b6007a939e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIFTKv3sNrPyxOiPoJycnw.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">体系结构</figcaption></figure><h2 id="296c" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">创建您的模型:</h2><p id="8e8d" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">我们将创建两个数据模型来匹配我们的<a class="ae li" href="https://androidwave.com/api/feed.json" rel="noopener ugc nofollow" target="_blank">端点</a>，即Blog和BlogWrapper。将这些放入您的模型文件夹包中:</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="1800" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">创建Rest API接口服务:</h2><p id="ec64" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">将Retrofit2实例与协程端点设置为一体(为简单起见)。我们已经为okHttp客户端添加了一个超时，还注意到了Moshi转换器。:)</p><p id="8497" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建完成后，将它放入你的<em class="lm">网络</em>包文件夹。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="f5e6" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">为LiveData交互创建存储库:</h2><p id="2db2" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">把这个放到你的<em class="lm">视图模型</em>包文件夹中。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="8842" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">创建您的视图模型:</h2><p id="078a" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">我们的viewmodel初始化我们的BlogRepository，并用getter检索我们的blog数据。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="f247" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">现在让我们开始创建我们需要的所有UI:</h2><p id="169b" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">我们将创建blog_item和activity_main.xml。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="bd3c" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">添加我们的BlogAdapter:</h2><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="48e5" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">最后，我们的主要活动:</h2><p id="ffe0" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">现在，让我们将整个应用程序整合在一起。</p><figure class="nc nd ne nf gt ju"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9faa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如您所看到的，LiveData和MutableData处理数据在UI上显示的方式，并被动更新，这是一种比以前更好的处理API数据的方式。</p><p id="e706" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望你喜欢这个教程，并对谷歌的架构组件有了更好的理解。</p><p id="620c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在这里查看和下载最终完成的项目<a class="ae li" href="https://github.com/rgodlontonshaw/Kotlin-Live-Data-MVVM-Example" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="4256" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编码快乐！:)</p><div class="no np gp gr nq nr"><a href="https://github.com/rgodlontonshaw/Kotlin-Live-Data-MVVM-Example" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">rgodlontonshaw/kot Lin-实时数据-MVVM-示例</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">演示应用程序，展示协程，实时数据和可变实时数据的使用…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div></div></a></div></div></div>    
</body>
</html>