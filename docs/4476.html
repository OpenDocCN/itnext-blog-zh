<html>
<head>
<title>Sending notifications to mobile devices using Azure Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure功能向移动设备发送通知</h1>
<blockquote>原文：<a href="https://itnext.io/sending-notifications-to-mobile-devices-using-azure-functions-4322771ee6e1?source=collection_archive---------3-----------------------#2020-07-07">https://itnext.io/sending-notifications-to-mobile-devices-using-azure-functions-4322771ee6e1?source=collection_archive---------3-----------------------#2020-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a7f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将了解Azure Cosmos数据库、Azure函数、Azure Notification Hub以及如何在各种用例中利用这些服务来通知用户。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/cafae32a55b3a8833ed877b0c71400ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*_GyxLAS71DKOCiPrnRf34Q.png"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">推送通知:通知中心+ Azure功能+ Cosmos数据库</figcaption></figure><h1 id="304c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">介绍</h1><p id="77f8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这篇文章是关于建立一个azure函数，它将监听Azure Cosmos数据库中发生的事件，并使用Azure Notification Hub向用户发送通知。</p><p id="9c06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章不仅仅是关于发送通知，还涵盖了一个企业级的集成方法，即处理Azure Cosmos数据库的更改，并使用Notification Hub将更改通知给消费者。</p><p id="7a94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们使用Flutter开发应用程序或原型时，首选的云服务是Firebase。我们可以设置Firestore数据库、Firebase云功能和Firebase云消息来实现我们将在本文中讨论的完全相同的功能。</p><p id="e3d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个场景。假设有一家电子商务公司，他们在网上销售一些产品。他们希望开展促销活动，并为此向用户发送销售通知。在本例中，假设有一个后端应用程序，营销经理或业务用户将介绍一个促销活动。通过API和数据将被存储在数据库中的代表。从这里，相关系统可以得到通知，如定价或产品服务，用户也将获得有关销售的通知。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ma"><img src="../Images/efceee85410ba00e4cd162f6798e0985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYxW08-fsktJrhtdddV8_A.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">示例场景:促销通知</figcaption></figure><h1 id="fce9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后结局</h1><p id="5e9b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">每当数据保存在宇宙数据库，用户将得到通知。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/9dea828d7a839811fd1bc606b95a9dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*8aKoR2H3-8KcB-1QvpoIRw.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">基于数据库中的更改通知用户</figcaption></figure><h1 id="2fe4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="7aa9" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要实现这种集成，你需要一个Azure订阅，你可以<a class="ae mg" href="https://azure.microsoft.com/en-gb/free/" rel="noopener ugc nofollow" target="_blank">注册</a>并获得免费积分来学习和体验Azure的各种产品。</p><h1 id="45ac" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤1:设置通知中心</h1><p id="7aa1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">您需要从Azure门户创建一个通知中心组件，或者您可以使用Azure cli或ARM模板来完成。创建中心后，需要设置要使用的notification services。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/21607effa9120f3e2cb0cfe129f80ecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*MeV-1fIaGQHN-U8ndBtsTQ.png"/></div></figure><p id="0996" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在这里看到的，有许多提供者可用。我们可以根据目标受众来配置它们。</p><p id="95fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一般我们为iOS设备配置苹果(APNs)，为安卓设备配置谷歌(FCM)。</p><p id="7d33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于苹果APN，你需要一个开发者账户。您可以从开发人员控制台创建证书或密钥。</p><p id="90c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于谷歌FCM，你需要有一个新的Firebase项目。转到Firebase Cloud messaging并进行设置。</p><h1 id="174f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤2:设置Azure Cosmos数据库</h1><p id="0643" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在这里，我们将只使用一个容器来设置cosmos数据库。我们将使用它来存储促销或优惠数据。为简单起见，这将包含只有两个字段ID和Text的文档。</p><h1 id="1349" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤3:设置Azure功能</h1><p id="ecf6" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">您可以从visual studio创建Azure函数，也可以从azure portal创建它。Cosmos数据库中也有一个选项，它将创建具有所有必要的连接字符串和设置的函数。</p><p id="0db7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置好这些资源后，您应该拥有类似下图的资源组结构。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/dea6574a8cdfb8eeb9f97a2c2f4ec457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*yHDIrkS6Zfpqw3-Q4HDzsQ.png"/></div></figure><h1 id="5638" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤4:实现Azure函数来发送通知</h1><p id="2578" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在Azure Cosmos数据库中，您可以选择创建一个由数据库中发生的任何事件触发的函数。或者您可以使用Visual Studio创建一个函数。</p><p id="75d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为azure functions创建一个新项目，并选择CosmosDb trigger。一旦设置好，我们将有一个类，我们将添加代码发送通知。</p><p id="ee81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于通知中心，我们需要安装一个nuget包。</p><blockquote class="mj mk ml"><p id="85f1" class="jn jo mm jp b jq jr js jt ju jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj kk ij bi translated">安装包微软。azure . notification hubs-版本3.3.0</p></blockquote><p id="3499" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出于演示目的，我们将编写非常简单的代码，为通知中心创建一个客户端，生成通知负载并将其发送到android设备。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="6d6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦代码准备就绪，我们就可以使用cli或从Visual Studio将其部署到Azure。</p><h1 id="502f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">步骤5:集成Flutter移动应用程序以接收来自Azure Notification Hub的通知</h1><p id="93df" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在我们已经准备好了所有的基础设施。接下来是创建一个接收通知的移动应用程序。我们正在使用flutter创建android和ios应用程序。</p><p id="aa75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于通知中心，您需要按照这里的说明设置一个包:<a class="ae mg" href="https://pub.dev/packages/azure_notificationhubs_flutter" rel="noopener ugc nofollow" target="_blank">https://pub.dev/packages/azure_notificationhubs_flutter</a></p><p id="f1c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个应用程序中，我们将创建一个主页和一个按钮来订阅Azure Notification Hub。订阅后，我们可以在通知中心查看已注册的设备。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="7486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">做完这些，接下来是测试。</p><p id="f984" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了模拟用户添加促销的场景，现在，我们将在azure cosmos数据库中手动创建一个新文档。一旦我们更新了文档，它将触发功能，向通知中心发送请求，移动设备将收到通知。</p><h1 id="06cd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">包扎</h1><p id="a681" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在本文中，我们看到了促销通知的一个简单用例。这里我们已经介绍了azure提供的服务，以实现我们需要的功能。当您在azure中设置了所有基础设施，并且不想为一个需求使用不同的提供者时，这可能会很有用。</p><p id="85c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想参考本文中使用的代码，请随意查看这个资源库。</p><div class="ms mt gp gr mu mv"><a href="https://github.com/iqans/pushnotifications-demo" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">iqans/push notifications-演示</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj kr mv"/></div></div></a></div><h1 id="e310" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">参考</h1><div class="ms mt gp gr mu mv"><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-cosmos-db-triggered-function" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">创建由Azure Cosmos DB触发的函数</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">了解如何创建在Azure Cosmos DB中添加或更改数据时触发的函数。要了解有关Azure的更多信息…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">docs.microsoft.com</p></div></div><div class="ne l"><div class="nk l ng nh ni ne nj kr mv"/></div></div></a></div><div class="ms mt gp gr mu mv"><a href="https://docs.microsoft.com/en-us/azure/notification-hubs/android-sdk" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">使用Azure通知中心和Firebase SDK版本向Android发送推送通知…</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">本教程展示了如何使用Azure通知中心和Firebase云消息(FCM)的更新版本…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">docs.microsoft.com</p></div></div><div class="ne l"><div class="nl l ng nh ni ne nj kr mv"/></div></div></a></div><p id="57ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读。</p><p id="8413" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你有美好的一天:)</p></div></div>    
</body>
</html>