<html>
<head>
<title>Build A Group-Chat App in 30 Lines Using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js构建一个30行的群聊应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-group-chat-app-in-30-lines-using-node-js-15bfe7a2417b?source=collection_archive---------0-----------------------#2019-02-18">https://itnext.io/build-a-group-chat-app-in-30-lines-using-node-js-15bfe7a2417b?source=collection_archive---------0-----------------------#2019-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2519" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这是一个简单的(希望)切中要点的教程，用不到30行代码就可以使用Node.js构建您的第一个群聊应用程序。</h2></div><p id="c604" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Node.js 可以说是当今大多数人用来构建服务器端应用程序的最强大的JavaScript运行时环境之一。Node.js建立在<a class="ae lb" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> Google V8 JavaScript引擎</a>之上，这是一个开源的高性能JavaScript和WebAssembly引擎。V8实现了<a class="ae lb" href="https://tc39.github.io/ecma262/" rel="noopener ugc nofollow" target="_blank"> ECMAScript </a>和<a class="ae lb" href="https://webassembly.github.io/spec/core/" rel="noopener ugc nofollow" target="_blank"> WebAssembly </a>，可以在使用x64、IA-32、ARM或MIPS处理器的Windows 7或更高版本、macOS 10.12+和Linux系统上运行。V8可以独立运行，也可以嵌入到任何C++应用中。</p><p id="a4b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢社区，有很多Node.js模块我们可以免费使用，它们将帮助(而不是加速)你完成任务。你可以使用强大的<code class="fe lc ld le lf b">npm install</code>来安装所有你需要的模块，在这里你可以浏览它们<a class="ae lb" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank">这里</a>。本文不会讨论如何在你的本地机器上安装Node.js和NPM，现在已经有数百万的教程了，<a class="ae lb" href="http://lmgtfy.com/?q=how+to+install+node+js" rel="noopener ugc nofollow" target="_blank">去找一个适合你的吧</a>。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/aa2915f532fc270e34f5b88e00df2311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbUnoSGU8X7ifNX_VEHxDQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">NPM官方网站</figcaption></figure><p id="931b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我将展示如何使用Node.js和Socket.io模块构建您的第一个简单群聊。<a class="ae lb" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank"> Socket.io </a>是一个Node.js模块，支持实时、双向和基于事件的通信。它可以在任何平台、浏览器或设备上运行，同样注重可靠性和速度。一些Socket.io使用示例:</p><ul class=""><li id="2f39" class="lw lx iq kh b ki kj kl km ko ly ks lz kw ma la mb mc md me bi translated">实时分析</li><li id="4679" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">二进制流</li><li id="4589" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">即时消息和聊天</li><li id="0569" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">文档协作(想想谷歌文档)</li></ul><h1 id="01a4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们开始吧！</h1><p id="801f" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated"><em class="nh">注意:所有这些代码都在我的GitHub上，你可以在这里克隆它们:</em><a class="ae lb" href="https://github.com/dkhd/node-group-chat" rel="noopener ugc nofollow" target="_blank">https://github.com/dkhd/node-group-chat</a></p><p id="071b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们开始之前，我假设您已经理解并熟悉了<em class="nh">命令行界面(CLI) </em>，因为我们将在本教程中使用它。如果你觉得不舒服，我告诉你，这是值得学习的。</p><h2 id="885e" class="ni ml iq bd mm nj nk dn mq nl nm dp mu ko nn no mw ks np nq my kw nr ns na nt bi translated">1.创建工作目录</h2><p id="1e1c" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">首先，让我们创建我们的工作目录，在那里我们将放置我们所有的代码和资产。使用此命令创建我们的工作目录:</p><p id="371e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ mkdir node-group-chat</code></p><p id="b988" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">..然后将我们的目录更改为新创建的工作目录:</p><p id="3232" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ cd node-group-chat</code></p><h2 id="c751" class="ni ml iq bd mm nj nk dn mq nl nm dp mu ko nn no mw ks np nq my kw nr ns na nt bi translated">2.启动项目</h2><p id="835b" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">通过使用<code class="fe lc ld le lf b">npm</code>命令，我们可以轻松地启动我们的项目，创建一个名为<code class="fe lc ld le lf b">package.json</code>的文件。如果您想知道什么是<code class="fe lc ld le lf b">package.json</code>，它是一个项目清单文件，将存储项目相关信息，如作者姓名、版本等。</p><p id="484c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以通过键入以下命令启动项目:</p><p id="da91" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ npm init</code></p><p id="8741" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">..并按照终端上显示的指南进行操作。</p><h2 id="0526" class="ni ml iq bd mm nj nk dn mq nl nm dp mu ko nn no mw ks np nq my kw nr ns na nt bi translated">3.安装模块</h2><p id="f56d" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">在这个项目中，我们将使用至少两个Node.js模块，我们可以使用NPM轻松安装它们。</p><ul class=""><li id="eef8" class="lw lx iq kh b ki kj kl km ko ly ks lz kw ma la mb mc md me bi translated"><strong class="kh ir"><em class="nh">Express</em></strong>—Express是Node.js的轻量级web应用框架，对于这个简单的群聊来说，没有必要使用Express，但是如果你打算继续开发的话，有这个就不错了。</li><li id="d380" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated"><strong class="kh ir"><em class="nh">socket . io</em></strong>—socket . io是本教程中实现客户端与服务器实时通信的关键模块。</li><li id="d0ec" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated"><strong class="kh ir"><em class="nh">EJS</em></strong>——EJS(嵌入式JavaScript)是一种简单的模板语言，可以让你为你的前端生成HTML标记。</li></ul><p id="1be1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以使用以下命令安装这些模块:</p><p id="9b9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ npm install express</code></p><p id="be8a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和</p><p id="b1f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ npm install socket.io</code></p><p id="fc19" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">和</p><p id="93f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ npm install ejs</code></p><p id="c006" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这些过程完成后，你的模块将位于<code class="fe lc ld le lf b">node_modules/</code>目录下。</p><h2 id="784d" class="ni ml iq bd mm nj nk dn mq nl nm dp mu ko nn no mw ks np nq my kw nr ns na nt bi translated">4.做代码</h2><p id="c86c" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">让我们把手弄脏吧。</p><p id="b5a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个名为<code class="fe lc ld le lf b">index.js</code>的文件(或者您在<code class="fe lc ld le lf b">package.json</code>中定义的任何文件)，并开始导入所需的模块:<code class="fe lc ld le lf b">express</code>、<code class="fe lc ld le lf b">http</code>和<code class="fe lc ld le lf b">socket.io</code>。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="41e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成模块导入后，下一步是提供前端代码，并确保Node.js正在运行，我们可以从浏览器访问它(在这种情况下，我将使用端口<code class="fe lc ld le lf b">8080</code>)。</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="eb12" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该功能..</p><pre class="lh li lj lk gt nw lf nx ny aw nz bi"><span id="4517" class="ni ml iq lf b gy oa ob l oc od">app.get('/', function(req, res) {<br/>    res.send('Hello world!');<br/>});</span></pre><p id="1442" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">..用于在用户每次访问我们的应用程序时为他们提供服务，并在他们的浏览器中显示<code class="fe lc ld le lf b">Hello world!</code>。</p><p id="52ed" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要启动该应用程序，您可以在终端中键入以下内容，然后点击enter按钮:</p><p id="8a6f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ node index.js</code></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/797954514a5363006108ea032a045758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*Ay-eFrm1N_ZkzeAeG061lA.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">这是我们运行应用程序时在终端中看到的内容</figcaption></figure><p id="4826" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过web浏览器访问我们的应用程序，网址是:<code class="fe lc ld le lf b">http://localhost:8080</code></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi of"><img src="../Images/e3a16f32526dc2f63cfaa9d0be0a3e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*roeyWk9sL_yGDkbIvDEkUQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">从浏览器访问我们的应用程序</figcaption></figure><p id="9c57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是在下一行代码中，我们将使用类似于<code class="fe lc ld le lf b">res.render('index.ejs');</code>的东西来代替<code class="fe lc ld le lf b">res.send('Hello World!');</code>，并且我们将使用EJS来构建我们的前端视图</p><p id="ef90" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，创建一个名为<code class="fe lc ld le lf b">views/</code>的新目录，并在<code class="fe lc ld le lf b">views/</code>目录中创建一个名为<code class="fe lc ld le lf b">index.ejs</code>的空文件。现在您可以将这几行代码放入新的<code class="fe lc ld le lf b">index.ejs</code>文件中。</p><blockquote class="og oh oi"><p id="96dd" class="kf kg nh kh b ki kj jr kk kl km ju kn oj kp kq kr ok kt ku kv ol kx ky kz la ij bi translated">不要忘记将<code class="fe lc ld le lf b">index.js</code>中的<code class="fe lc ld le lf b">res.send('Hello World!');</code>行改为<code class="fe lc ld le lf b">res.render('index.ejs');</code>，否则您的代码将无法运行。</p></blockquote><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="8fae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码什么也没做，只是为我们提供了这样的基本聊天用户界面。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi of"><img src="../Images/7b7b999c28bfdc695abb1541efdfc596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*jNKcJg0XZoGRNZvK5hmQMQ.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">我们的聊天用户界面仍然不工作</figcaption></figure><p id="7fe5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在处理Socket.io时，我们同时处理两个文件:</p><ul class=""><li id="9a31" class="lw lx iq kh b ki kj kl km ko ly ks lz kw ma la mb mc md me bi translated">服务器应用程序文件(例如index.js)</li><li id="08c9" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">客户端前端文件(例如index.ejs)</li></ul><p id="3c69" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用Socket.io，基本上我们在服务器和客户端之间创建了一个持续实时连接的“隧道”。在服务器文件中，只需输入以下代码:</p><pre class="lh li lj lk gt nw lf nx ny aw nz bi"><span id="2ea3" class="ni ml iq lf b gy oa ob l oc od">io.sockets.on('connection', function(socket) {<br/>    // write all the realtime communication functions here<br/>});</span></pre><p id="244f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们的完整<code class="fe lc ld le lf b">index.js</code>看起来是这样的:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9b23" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nh">服务器端Node.js代码不超过30行吧？</em>😉</p><p id="2da5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而现在，我们要修改我们的前端文件，所以它会在用户打开页面时询问用户名，并打开与服务器app的通信套接字。</p><p id="ba9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们的<code class="fe lc ld le lf b">index.ejs</code>看起来是这样的:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="1701" class="ni ml iq bd mm nj nk dn mq nl nm dp mu ko nn no mw ks np nq my kw nr ns na nt bi translated">5.结果呢</h2><p id="7d0b" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">如果您已经完成了代码，请尝试使用以下代码运行您的代码:</p><p id="f5af" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">$ node index.js</code></p><p id="f6d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开浏览器，打开<code class="fe lc ld le lf b">http://localhost:8080</code>。您可以打开多个标签来查看它是如何工作的，或者查看下面的GIF:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi om"><img src="../Images/d664ec6da93deb36959f71cf027e19a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-xhfPgug9unmGFE85KNrLg.gif"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">群聊应用的结果</figcaption></figure></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="78e4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据这一经验，您现在应该理解了使用Node.js和Socket.io的聊天应用程序的基础。您可以做许多事情来改进此代码，例如:</p><ul class=""><li id="7e84" class="lw lx iq kh b ki kj kl km ko ly ks lz kw ma la mb mc md me bi translated">添加打字通知(<em class="nh">有人正在打字… </em>)</li><li id="06c5" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">添加表情符号或表情</li><li id="ccff" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">将其保存到数据库中</li><li id="f569" class="lw lx iq kh b ki mf kl mg ko mh ks mi kw mj la mb mc md me bi translated">等等。极限是你的想象力。</li></ul><p id="4cf2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你怎么想呢?请在下面留下您的评论。</p><p id="f26b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GitHub上的完整源代码:<a class="ae lb" href="https://github.com/dkhd/node-group-chat" rel="noopener ugc nofollow" target="_blank">https://github.com/dkhd/node-group-chat</a></p></div></div>    
</body>
</html>