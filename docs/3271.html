<html>
<head>
<title>Getting Started With NATS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NATS入门</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-nats-b752cbb17f74?source=collection_archive---------2-----------------------#2019-11-10">https://itnext.io/getting-started-with-nats-b752cbb17f74?source=collection_archive---------2-----------------------#2019-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7348" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">高性能消息系统和CNCF项目</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/b3da38eca269cbe907bd7f54188c64f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*ZmBWab8bx1zexvLdyuV6Mw.png"/></div></figure><h1 id="9d71" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">温和的介绍</h1><p id="3cf6" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">NATS(https://NATs . io)是一款面向云原生应用、物联网设备消息传递和微服务架构的高性能消息传递系统。</p><p id="94d0" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">它已经存在很长时间了，我们可以从它的<a class="ae me" href="https://github.com/nats-io" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中看到，0.5.1版本已经于2014年6月发布。这是Go中实现的第一个版本，因为NATS起源于Ruby，在2010年10月首次发布<a class="ae me" href="https://github.com/nats-io/nats.rb/commits/master?after=77d8a8e1d5e6ea081086718a6c565642a197ab5f+699" rel="noopener ugc nofollow" target="_blank">！</a></p><p id="f940" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">在过去的几年里，NATS作为CNCF的项目获得了更多的关注。正如我们在下面的列表中所看到的，它目前正处于其他非常有前途的项目的孵化阶段。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/adf37bb0e3d2b68bb9c86bc7a86e7499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gh0BBNaAbaVlnp_aK_1N9A.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">CNCF的孵化项目</figcaption></figure><p id="036c" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">NATS是关于发布和订阅信息的。消息发布在s<em class="mt">subject上，</em>subject是包含由点('.'分隔的标记的字符串)，它定义了一种沟通渠道。收听关于给定主题的传入消息的订户将接收到关于该主题发布的每条消息。</p><p id="cb90" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">可以使用特殊字符，以便订阅者可以同时监听一组主题的传入消息，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5b17007492a4aad478786b43496b7ac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*N8VqHLv6JWUigA30ju1UiQ.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">来源:https://nats.io</figcaption></figure><ul class=""><li id="cece" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">给定标记的通配符*</li><li id="2bc2" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">&gt;'允许收听层次结构中的所有主题</li></ul><h1 id="857b" class="kq kr it bd ks kt ku kv kw kx ky kz la jz lb ka lc kc ld kd le kf lf kg lg lh bi translated">运行NATS服务器</h1><p id="abcc" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在下一部分的例子中，我们将从Go版本运行NATS服务器。一旦我们下载了<a class="ae me" href="https://golang.org/dl/" rel="noopener ugc nofollow" target="_blank"> Go </a>，就可以使用以下命令启动服务器:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="a5dc" class="no kr it nk b gy np nq l nr ns">$ go get github.com/nats-io/nats-server<br/>$ nats-server</span></pre><p id="1360" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">Docker镜像也是可用的，可以用下面的命令运行(Alpine磁偏角通常是一个好的选择，因为它的小尺寸限制了攻击面)</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="60fb" class="no kr it nk b gy np nq l nr ns">$ docker run -p 4222:4222 -p 8222:8222 nats:alpine3.10</span></pre></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h1 id="c00c" class="kq kr it bd ks kt oa kv kw kx ob kz la jz oc ka lc kc od kd le kf oe kg lg lh bi translated">模式</h1><p id="c885" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">NATS实现了几种模式:</p><ul class=""><li id="0a1a" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">发布/订阅</li><li id="99dd" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">相互竞争的消费者</li><li id="fdcc" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">请求/答复</li></ul><p id="0f0f" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">下面我们将逐一说明。</p><h2 id="9dc9" class="no kr it bd ks of og dn kw oh oi dp la lr oj ok lc lv ol om le lz on oo lg op bi translated">发布订阅</h2><p id="6dd0" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">发布者发送关于给定主题的消息，一个或几个订阅者收听该主题。每个订阅者都会收到发布者发送的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/3bf4e878c8f2b5ea49ea542fefa29d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_rmebLptfIR_nq8BS0_f5w.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">来源:https://nats.io</figcaption></figure><p id="9b3f" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">为了说明这种模式，我们将使用在<a class="ae me" href="https://github.com/nats-io/go-nats-examples/tree/master/tools" rel="noopener ugc nofollow" target="_blank"> NATS范例库</a>中可用的发布者和订阅者Go客户端，它们可以用以下命令安装:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="57dc" class="no kr it nk b gy np nq l nr ns">$ go get github.com/nats-io/go-nats-examples/tools/nats-sub<br/>$ go get github.com/nats-io/go-nats-examples/tools/nats-pub</span></pre><p id="153e" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">动画按以下方式分割:</p><ul class=""><li id="0f26" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">顶部窗格:NATS服务器使用调试和跟踪标志启动</li><li id="d539" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">左下面板:订户等待来自<em class="mt"> nats.demo </em>主题的消息</li><li id="777a" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">右下面板:发布者发送关于<em class="mt"> nats.demo </em>主题的<em class="mt"> Hi </em>字符串</li></ul><p id="8762" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">订阅者接收发布者发送的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oq"><img src="../Images/58d377e8ec8bbea194f44d30ababdfbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IE0-egc83uBgbdrbDPoXWA.gif"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">具有单个订户的发布-订阅示例</figcaption></figure><p id="6984" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">从服务器的日志(顶部面板)中，我们可以看到一些有趣的事情:</p><ul class=""><li id="eeb4" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">一个id与每个客户端相关联:订阅者的<em class="mt"> cid:1 </em>，发布者的<em class="mt"> cid:2 </em></li><li id="224a" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated"><em class="mt"> nats-sub </em>客户端的订阅:[SUB nats.demo 1]</li><li id="76d0" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">nats-pub客户端的发布:[PUB nats.demo 2]</li><li id="a71e" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">用户对消息的接收:[MSG nats.demo 1 2]</li><li id="1558" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">用于验证客户端状态的运行状况检查:[PING]、[PONG]</li></ul><p id="194b" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">以下示例与上一个示例类似，只是有几个订户在等待关于<em class="mt"> nats.demo </em>主题的传入消息。</p><p id="962a" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">每个订阅者都会收到发布者发送的消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oq"><img src="../Images/37ac6663edcedececcaea31406b9dc30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7OFXQSyJ87xfQp64VYZEoA.gif"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">有几个订阅者的发布-订阅示例</figcaption></figure><h2 id="6551" class="no kr it bd ks of og dn kw oh oi dp la lr oj ok lc lv ol om le lz on oo lg op bi translated">相互竞争的消费者</h2><p id="a918" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一个发布者就一个给定的主题发送几个消息，几个订阅者(定义为一个公共组的一部分)监听这个主题。发布者发送的每条消息只由组中的一个订阅者处理。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/081233ea4502ad4a0094900f58dedfe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ubh7GofE-BL7OU3ePEUWqQ.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">来源:<a class="ae me" href="https://nats.io)" rel="noopener ugc nofollow" target="_blank"> https://nats.io </a></figcaption></figure><p id="8ce5" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">为了说明这种模式，我们将使用与上面相同的发布者(nats-pub)和在<a class="ae me" href="https://github.com/nats-io/go-nats-examples/tree/master/tools" rel="noopener ugc nofollow" target="_blank"> NATS的示例存储库</a>中可用的队列订阅者客户端。该命令允许将订户定义为组的一部分，并且可以使用以下命令进行安装:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="e7f3" class="no kr it nk b gy np nq l nr ns">$ go get github.com/nats-io/go-nats-examples/tools/nats-qsub</span></pre><p id="1430" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">动画按以下方式分割:</p><ul class=""><li id="29ef" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">顶部窗格:NATS服务器使用调试和跟踪标志启动</li><li id="363d" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">左下/上面板:在<em class="mt">我的群组</em>中的用户等待来自<em class="mt"> nats.demo </em>主题的消息</li><li id="951a" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">左下方/下方面板:我的群组中的另一个用户正在等待主题为nats.demo的消息</li><li id="62b2" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">右下面板:发布者发送关于主题<em class="mt"> nats.demo </em>的<em class="mt"> Hello </em>字符串</li></ul><p id="c096" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">在<em class="mt"> nats.demo </em> subject上发送的每条消息只被群组中的一个用户接收。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oq"><img src="../Images/2961df7978115ffa10f1de86086ea72b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*S9KaJLdchcsQxjkJ6gax7w.gif"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">竞争消费者:消费者组中只有一个人处理每个传入的消息</figcaption></figure><h2 id="3a53" class="no kr it bd ks of og dn kw oh oi dp la lr oj ok lc lv ol om le lz on oo lg op bi translated">请求-回复</h2><p id="3cdc" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">发布者发送关于给定主题的消息，并等待来自该主题的订阅者之一的回复。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/18b629dc2d853b9001a35066f1017563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ZiHkhfs3ulPpuj33JSXKxw.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">来源:<a class="ae me" href="https://nats.io)" rel="noopener ugc nofollow" target="_blank"> https://nats.io </a></figcaption></figure><p id="a474" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">为了说明这种模式，我们将使用在<a class="ae me" href="https://github.com/nats-io/go-nats-examples/tree/master/tools" rel="noopener ugc nofollow" target="_blank"> NATS的示例库</a>中可用的nats-req和nats-rply客户端，它们可以用以下命令安装:</p><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="a3ba" class="no kr it nk b gy np nq l nr ns">$ go get github.com/nats-io/go-nats-examples/tools/nats-req<br/>$ go get github.com/nats-io/go-nats-examples/tools/nats-rply</span></pre><p id="8719" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">动画按以下方式分割:</p><ul class=""><li id="6af0" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">顶部面板:NATS服务器使用调试和跟踪标志启动</li><li id="0b81" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">左下方:用户等待来自<em class="mt"> nats.demo </em>主题的消息。该订户将使用字符串“我的回复”来回复收到的每条消息</li><li id="9bd3" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">右下:发布者在<em class="mt"> nats.demo </em>主题上发送“<em class="mt">我的请求”</em>字符串，并等待回复</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oq"><img src="../Images/b6ea71135041080064216818d5a53cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aKlqTAIiL_JE-MWKwSAIaw.gif"/></div></div></figure><p id="a0bb" class="pw-post-body-paragraph li lj it lk b ll mf ju ln lo mg jx lq lr mh lt lu lv mi lx ly lz mj mb mc md im bi translated">这里要注意一件有趣的事情:</p><ul class=""><li id="058f" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated">在发送“我的请求”有效负载之前，请求者订阅_INBOX.IohkarytGfOpCy6i.* <em class="mt">，</em>一个接收回复的特定主题(下面代码片段的第一行)</li><li id="5655" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">当订阅者收到“我的请求”有效负载时，它同时收到了应该回复的主题(第5行)</li><li id="8a79" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">订户发送关于该主题的回复(第7行)</li><li id="980f" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">请求者收到了回复(第9行)</li><li id="b68b" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated">请求者取消订阅<em class="mt">_ inbox . iohkarytgfopcy 6 I . *</em>主题</li></ul><pre class="kj kk kl km gt nj nk nl nm aw nn bi"><span id="51e5" class="no kr it nk b gy np nq l nr ns">1  cid:2 — &lt;&lt;- [SUB _INBOX.IohkarytGfOpCy6i.* 1]<br/>2  cid:2 — &lt;&lt;- [PUB nats.demo _INBOX.IohkarytGfOpCy6i.eFeQJZ65 10]<br/>3  cid:2 — &lt;&lt;- MSG_PAYLOAD: [“my request”]<br/>4  cid:1 — -&gt;&gt; [PING]<br/>5  cid:1 — -&gt;&gt; [MSG nats.demo 1 _INBOX.IohkarytGfOpCy6i.eFeQJZ65 10]<br/>6  cid:1 — &lt;&lt;- [PONG]<br/>7  cid:1 — &lt;&lt;- [PUB _INBOX.IohkarytGfOpCy6i.eFeQJZ65 11]<br/>8  cid:1 — &lt;&lt;- MSG_PAYLOAD: [“my response”]<br/>9  cid:2 — -&gt;&gt; [MSG _INBOX.IohkarytGfOpCy6i.eFeQJZ65 1 11]<br/>10 cid:2 — &lt;-&gt; [DELSUB 1]</span></pre><h2 id="c8e3" class="no kr it bd ks of og dn kw oh oi dp la lr oj ok lc lv ol om le lz on oo lg op bi translated">摘要</h2><p id="2fe5" class="pw-post-body-paragraph li lj it lk b ll lm ju ln lo lp jx lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这篇文章中，我们简要介绍了NATS，并举例说明了它提供的不同模式。NATS系列中的其他几篇文章更深入地探讨了细节:</p><ul class=""><li id="cc1b" class="mv mw it lk b ll mf lo mg lr mx lv my lz mz md na nb nc nd bi translated"><a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/secure-pub-sub-with-nats-fcda983d0612">通过NATS设置安全发布/订阅</a></li><li id="fbf7" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated"><a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/setting-up-a-nats-cluster-92ca8fd6a6e1">NATS集群的设置</a></li><li id="f837" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated"><a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/overview-of-nats-streaming-ea0e80449507">NATS流媒体概述</a></li><li id="4ca2" class="mv mw it lk b ll ne lo nf lr ng lv nh lz ni md na nb nc nd bi translated"><a class="ae me" rel="noopener ugc nofollow" target="_blank" href="/jetstream-the-next-generation-of-nats-persistence-engine-cb6c2c80dd20"> JetStream:下一代NATS持久引擎</a></li></ul></div></div>    
</body>
</html>