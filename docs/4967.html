<html>
<head>
<title>Kubecost + Rancher = $$$ saved</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubecost + Rancher = $$$节省</h1>
<blockquote>原文：<a href="https://itnext.io/kubecost-rancher-saved-df30fe77135b?source=collection_archive---------2-----------------------#2020-11-04">https://itnext.io/kubecost-rancher-saved-df30fe77135b?source=collection_archive---------2-----------------------#2020-11-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/53431a4b54a2360328f7efd0c103208f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ONgv3n7EXEboEQVc04Vr-w.png"/></div></div></figure><div class=""/><p id="a341" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我<a class="ae la" href="https://medium.com/@jyeee/kubernetes-on-your-macos-laptop-with-multipass-k3s-and-rancher-2-4-6e9cbf013f58" rel="noopener">写了</a>几篇<a class="ae la" href="https://medium.com/@jyeee/rancher-2-4-14c31af12b7a" rel="noopener">文章</a>，讲述<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/rancher-2-4-kubernetes-on-your-macos-laptop-with-docker-k3d-b578b1c7568b">牧场主集群经理</a>(来自被SuSE收购的<a class="ae la" href="https://rancher.com/" rel="noopener ugc nofollow" target="_blank">牧场主</a>)对我们的DevOps团队有多好。它使我们能够管理多个集群的资源，并控制其用户的权限。Rancher Cluster Manager已经被证明对新接触k8s的开发人员是一个巨大的帮助，它具有可视化和使用kubectl、部署/排除工作负载故障以及从浏览器装入pods <em class="lb">的能力。</em></p><figure class="ld le lf lg gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj lc"><img src="../Images/e900a9b510bd4896c7a74789dcb5db63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*kJtUDTvi-pIXnDNm-vvqaA.gif"/></div></div></figure><p id="edc4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在k8s中仍然很难做到的是项目成本。尽管Rancher为我们提供了一个<em class="lb"> Rancher项目</em>的构造，它通过允许我们设置配额和分组名称空间/用户/秘密来帮助我们…</p><ul class=""><li id="197b" class="lh li jf ke b kf kg kj kk kn lj kr lk kv ll kz lm ln lo lp bi translated">我们不知道每个命名空间的每个pod正在使用的节点的百分比</li><li id="d6bb" class="lh li jf ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">这变得更加复杂，因为一些团队将有不止一个名称空间用于开发或测试。</li><li id="901d" class="lh li jf ke b kf lq kj lr kn ls kr lt kv lu kz lm ln lo lp bi translated">我们可以尝试使用<code class="fe lv lw lx ly b">kubectl top</code>或者尝试用普罗米修斯/格拉法纳的指标做我们自己的核算，但这仍然是一个棘手的问题</li></ul><p id="cc0e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">谢天谢地(<a class="ae la" href="https://opsmatters.com/events/rancher-kubernetes-master-class-kubernetes-cost-allocation-visibility-feat-kubecost" rel="noopener ugc nofollow" target="_blank">部分来自牧场主网络研讨会</a>)，我们发现了<a class="ae la" href="https://medium.com/kubecost" rel="noopener"> Kubecost，这是一款出色的开源产品</a>，安装简单，提供了<a class="ae la" href="https://medium.com/kubecost/introducing-kubecost-a-better-approach-to-kubernetes-cost-monitoring-b5450c3ae940" rel="noopener">更好的Kubernetes成本监控方法</a>！他们在Medium上有一些很棒的文章，他们的Slack社区非常有帮助。</p><figure class="ld le lf lg gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj lz"><img src="../Images/5bd2a3397aa725864ac2a3c0ac8ed171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rc0ncdUCD6i4tus1.png"/></div></div><figcaption class="ma mb gk gi gj mc md bd b be z dk translated">按名称空间分组的成本，如<a class="ae la" href="http://docs.kubecost.com/cost-allocation.html" rel="noopener ugc nofollow" target="_blank">http://docs.kubecost.com/cost-allocation.html</a>所示</figcaption></figure><p id="af11" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">更好的是，Kubecost和Rancher项目彼此配合得非常好——如果您将“产品”字段设置为<code class="fe lv lw lx ly b">field.cattle.io/projectId</code>,就大功告成了！</p><figure class="ld le lf lg gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj me"><img src="../Images/411f9bda11129994714805e531da85ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M55XIhgbiKmHQL97vZHyWg.png"/></div></div><figcaption class="ma mb gk gi gj mc md bd b be z dk translated"><a class="ae la" href="https://kubecost.itss.forcenex.us/settings.html" rel="noopener ugc nofollow" target="_blank">https://kube cost/settings . html</a></figcaption></figure><figure class="ld le lf lg gu iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj mf"><img src="../Images/7491a8e5f437a0123318dfda13fe805e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ByeumSeVDKk26WJe8BUQHA.png"/></div></div><figcaption class="ma mb gk gi gj mc md bd b be z dk translated">谢谢Kubecost！！🙏🙌</figcaption></figure><p id="9c83" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这个数据也可以通过API获得，因此您可以在这个端点显示带有人类可读名称的Rancher项目:</p><p id="ed52" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><a class="ae la" href="https://kubecost.itss.forcenex.us/model/aggregatedCostModel?window=1d&amp;offset=1m&amp;aggregation=label&amp;allocateIdle=false&amp;timeSeries=true&amp;efficiency=true&amp;aggregationSubfield=field.cattle.io/projectId&amp;sharedNamespaces=&amp;sharedSplit=weighted&amp;sharedLabelNames=&amp;sharedLabelValues=&amp;sharedSplit=weighted" rel="noopener ugc nofollow" target="_blank">https://kube cost/model/aggregatedCostModel？window = 1d&amp;offset = 1m&amp;aggregation = label&amp;allocate idle = false&amp;time series = true&amp;efficiency = true&amp;aggregation subfield = field .黄牛. io/project id&amp;shared namespaces =&amp;shared split = weighted&amp;shared label names =&amp;shared label values =&amp;shared split = weighted</a></p><p id="059f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">现在我们已经获得了这些数据，我们可以对我们的开发团队进行更好的估计，并对我们的云支出进行更好的预测。Kubecost甚至提供了关于<a class="ae la" href="https://medium.com/kubecost/find-an-optimal-set-of-nodes-for-a-kubernetes-cluster-751e4c3b40b7" rel="noopener">如何节省额外成本和基于使用优化集群节点数量的建议</a>！</p></div></div>    
</body>
</html>