<html>
<head>
<title>Handling AngularJS Routing with UI-Router</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用UI-Router处理AngularJS布线</h1>
<blockquote>原文：<a href="https://itnext.io/handling-angularjs-routing-with-ui-router-34010f4870a5?source=collection_archive---------1-----------------------#2018-08-08">https://itnext.io/handling-angularjs-routing-with-ui-router-34010f4870a5?source=collection_archive---------1-----------------------#2018-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cfcf9f1f3183ac9af67cb4de4583cc70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0K_WccaSKUUadNhlGQ4zg.png"/></div></div></figure><p id="ad8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是从Angular 2+开始的，但是我现在的公司有一些项目需要AngularJS 1x。所以，我们到了！</p><p id="fc83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将向你展示如何使用<a class="ae kw" href="https://github.com/angular-ui/ui-router" rel="noopener ugc nofollow" target="_blank"> UI-Router </a>来处理AngularJS 1x路由。还有一个帖子，我将使用<a class="ae kw" href="https://docs.angularjs.org/api/ngRoute" rel="noopener ugc nofollow" target="_blank"> Angular-Route (ngRoute) </a>来处理AngularJS路由。</p><blockquote class="kx ky kz"><p id="a3bf" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">两者的不同之处在于UI-Router是一个第三方模块，使用不同的方法来管理路由，UI-Router具有额外的功能，适合更复杂的项目。</p></blockquote><p id="cd7f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解更多他们之间的不同，请查看<a class="ae kw" href="https://github.com/angular-ui/ui-router" rel="noopener ugc nofollow" target="_blank">这篇来自stackoverflow </a>的帖子。</p><p id="bd62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在这篇文章中使用的AngularJS版本是<em class="la"> 1.7.2 </em>，如果你使用旧版本，它可能会有所不同。</p><p id="f709" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在这篇文章中使用的UI路由器版本是v1.0.19。</p><p id="630e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开始之前，你可以从<a class="ae kw" href="https://next.plnkr.co/plunk/ylSeK9M5V7ugNDF6" rel="noopener ugc nofollow" target="_blank"> Plunker </a>看一下这个项目。</p><div class="le lf gp gr lg lh"><a href="https://next.plnkr.co/plunk/ylSeK9M5V7ugNDF6" rel="noopener  ugc nofollow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd ir gy z fp lm fr fs ln fu fw ip bi translated">AngularJS-Routing-UI-Router</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">手柄-角度-布线</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">next.plnkr.co</p></div></div></div></a></div><p id="ad39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">启动AngularJS项目</strong></p><p id="b6f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很容易建立一个AngularJS项目，你只需要在头部嵌入angular文件。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="a733" class="lz ma iq lv b gy mb mc l md me">// index.html</span><span id="c3ca" class="lz ma iq lv b gy mf mc l md me">&lt;html <strong class="lv ir">ng-app="angularRouting"</strong>&gt;<br/>...</span><span id="22f3" class="lz ma iq lv b gy mf mc l md me">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.2/angular.min.js"&gt;&lt;/script&gt;</span><span id="4baf" class="lz ma iq lv b gy mf mc l md me">&lt;script src="https://unpkg.com/@uirouter/angularjs@1.0.19/release/angular-ui-router.min.js"&gt;&lt;/script&gt;</span><span id="7f98" class="lz ma iq lv b gy mf mc l md me">&lt;script src="app.js"&gt;&lt;/script&gt;</span><span id="afa3" class="lz ma iq lv b gy mf mc l md me">...</span><span id="b21f" class="lz ma iq lv b gy mf mc l md me">// Navigation Menu</span><span id="cd54" class="lz ma iq lv b gy mf mc l md me">&lt;ul class="uk-nav uk-nav-default"&gt;<br/> &lt;li class="uk-active"&gt;<br/>  &lt;a ui-sref="home"&gt;Menu&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  <strong class="lv ir">&lt;a ui-sref="home" ui-sref-active="active"&gt;Home&lt;/a&gt;</strong><br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  <strong class="lv ir">&lt;a ui-sref="about" ui-sref-active="active"&gt;About&lt;/a&gt;</strong><br/> &lt;/li&gt;<br/>&lt;/ul&gt;</span><span id="4679" class="lz ma iq lv b gy mf mc l md me">// Content will go here<br/><strong class="lv ir">&lt;ui-view&gt;&lt;/ui-view&gt;</strong></span></pre><p id="eedf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你的主要逻辑会在app.js里面。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="8f80" class="lz ma iq lv b gy mb mc l md me">var app = angular.module('angularRouting', ['<strong class="lv ir">ui.router</strong>']);</span></pre><p id="f960" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">让我们开始路由工作</strong></p><p id="d833" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了管理路由，我们需要添加<strong class="ka ir"> $stateProvider </strong>。下面的代码显示了主页和about页面的路由。您现在可以在浏览器中测试它。</p><p id="dcf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">带有<strong class="ka ir"> $urlRouterProvider </strong>的<strong class="ka ir">否则</strong>会将所有其他路由重定向到主页。实际上，您将为此展示一个404模板。如果你想分离HTML模板，可以用<strong class="ka ir"> tempateUrl </strong>代替<strong class="ka ir">模板</strong>。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="2460" class="lz ma iq lv b gy mb mc l md me">// app.js</span><span id="8aa1" class="lz ma iq lv b gy mf mc l md me">app.config(function(<strong class="lv ir">$stateProvider</strong>, <strong class="lv ir">$urlRouterProvider</strong>){<br/>  var states = [<br/>    {<br/>      name: 'home',<br/>      url: '/',<br/>      template: '&lt;h1&gt;This is home&lt;/h1&gt;'<br/>    },<br/>    {<br/>      name: 'about',<br/>      url: '/about',<br/>      template: '&lt;h1&gt;This is about&lt;/h1&gt;'<br/>    }<br/>  ];</span><span id="922d" class="lz ma iq lv b gy mf mc l md me">  states.forEach((state) =&gt; $stateProvider.state(state));<br/>  $urlRouterProvider.otherwise('/');<br/>});</span></pre><p id="81f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">从URL获取参数</strong></p><p id="f3a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我创建了一个带参数的菜单。在您的应用程序中，该参数将通过<strong class="ka ir"> {{ id }} </strong>动态填充。在这个例子中，我将使用数字1作为params路由的额外参数。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="c996" class="lz ma iq lv b gy mb mc l md me">// index.html</span><span id="7216" class="lz ma iq lv b gy mf mc l md me">&lt;ul class="uk-nav uk-nav-default"&gt;<br/> &lt;li class="uk-active"&gt;<br/>  &lt;a ui-sref="home"&gt;Menu&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="home" ui-sref-active="active"&gt;Home&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="about" ui-sref-active="active"&gt;About&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="<strong class="lv ir">params({id: 1})</strong>" ui-sref-active="active"&gt;Params&lt;/a&gt;<br/> &lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="c3f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要在app.js中配置路由。我将使用ParamsController来获取参数并将其显示给模板。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="7037" class="lz ma iq lv b gy mb mc l md me">// app.js</span><span id="8d18" class="lz ma iq lv b gy mf mc l md me">app.config(function($stateProvider, $urlRouterProvider){<br/>  var states = [<br/>    {<br/>      name: 'home',<br/>      url: '/',<br/>      template: '&lt;h1&gt;This is home&lt;/h1&gt;'<br/>    },<br/>    {<br/>      name: 'about',<br/>      url: '/about',<br/>      template: '&lt;h1&gt;This is about&lt;/h1&gt;'<br/>    },<br/>    {<br/>      name: 'params',<br/>      url: '/params/<strong class="lv ir">{id}</strong>',<br/>      template: '&lt;h1&gt;Param value: {{ <strong class="lv ir">paramId</strong> }}&lt;/h1&gt;',<br/>      controller: function($scope, <strong class="lv ir">$stateParams</strong>) {<br/>        $scope.<strong class="lv ir">paramId</strong> = <strong class="lv ir">$stateParams.id</strong>;<br/>      }<br/>    }<br/>  ];</span><span id="096e" class="lz ma iq lv b gy mf mc l md me">  states.forEach((state) =&gt; $stateProvider.state(state));<br/>  $urlRouterProvider.otherwise('/');<br/>});</span></pre><p id="1d5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如何守护你的路线</strong></p><p id="1ab2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，有些页面是你不想给公众看的。用户必须登录才能查看它们。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="5b70" class="lz ma iq lv b gy mb mc l md me">// index.html</span><span id="7b46" class="lz ma iq lv b gy mf mc l md me">&lt;ul class="uk-nav uk-nav-default"&gt;<br/> &lt;li class="uk-active"&gt;<br/>  &lt;a ui-sref="home"&gt;Menu&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="home" ui-sref-active="active"&gt;Home&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="about" ui-sref-active="active"&gt;About&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  &lt;a ui-sref="params({id: 1})" ui-sref-active="active"&gt;Params&lt;/a&gt;<br/> &lt;/li&gt;<br/> &lt;li&gt;<br/>  <strong class="lv ir">&lt;a ui-sref="auth" ui-sref-active="active"&gt;You shall not pass!&lt;/a&gt;</strong><br/> &lt;/li&gt;<br/>&lt;/ul&gt;</span><span id="ee95" class="lz ma iq lv b gy mf mc l md me"><strong class="lv ir">{{ message }} //</strong>show authentication message<br/>&lt;main ng-view&gt;&lt;/main&gt;</span></pre><p id="4bbb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您将在app.js中添加路由和身份验证服务。如果用户没有查看该页面的权限，他们将被重定向到主页。</p><p id="8c78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将利用<a class="ae kw" href="https://ui-router.github.io/guide/transitionhooks" rel="noopener ugc nofollow" target="_blank">转换挂钩</a>来管理路由。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="22dd" class="lz ma iq lv b gy mb mc l md me">// app.js</span><span id="ef28" class="lz ma iq lv b gy mf mc l md me">// Handle authentication error<br/>app.run(['$rootScope', '$transitions', '$state', '$trace', function($rootScope, $transitions, $state, $trace){<br/>  $transitions.<strong class="lv ir">onError</strong>({}, function(transition) {        <br/>    if(transition.to().name === 'auth' &amp;&amp; transition.error().detail === '<strong class="lv ir">AUTH_REQUIRED</strong>') {<br/>      $rootScope.message = 'You need to login in order to view that page!';<br/>        $state.go('home');<br/>    }<br/>  });<br/>}]);</span><span id="93bf" class="lz ma iq lv b gy mf mc l md me">app.config(function($stateProvider, $urlRouterProvider){<br/>  var states = [<br/>    {<br/>      name: 'home',<br/>      url: '/',<br/>      template: '&lt;h1&gt;This is home&lt;/h1&gt;'<br/>    },<br/>    {<br/>      name: 'about',<br/>      url: '/about',<br/>      template: '&lt;h1&gt;This is about&lt;/h1&gt;'<br/>    },<br/>    {<br/>      name: 'params',<br/>      url: '/params/{id}',<br/>      template: '&lt;h1&gt;Param value: {{ paramId }}&lt;/h1&gt;',<br/>      controller: function($scope, $stateParams) {<br/>        $scope.paramId = $stateParams.id;<br/>      }<br/>    },<br/>    {<br/>      name: 'auth',<br/>      url: '/auth',<br/>      template: '&lt;h1&gt;Success&lt;/h1&gt;',<br/>      <strong class="lv ir">resolve: {<br/>        auththenticate: ['$q', function($q) {<br/>          if(true) { // user is not logged in<br/>            return $q.reject("AUTH_REQUIRED");<br/>          }<br/>        }]<br/>      }      </strong><br/>    }<br/>  ];</span><span id="8bc0" class="lz ma iq lv b gy mf mc l md me">  states.forEach((state) =&gt; $stateProvider.state(state));<br/>  $urlRouterProvider.otherwise('/');<br/>});</span></pre><p id="ce52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我假设用户没有权限查看页面，它将返回一个“AUTH_REQUIRED”错误。</p><p id="6e0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从现在开始，你知道如何用UI-Router处理AngularJS路由。您还可以使用<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/handling-angularjs-routing-with-angular-route-ngroute-a8e6facaf3f9">角度路线(ngRoute)来管理您的路线</a>。</p><p id="f398" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这有所帮助:)</p></div></div>    
</body>
</html>