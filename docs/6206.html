<html>
<head>
<title>Kubexpose: A Kubernetes Operator, for fun and profit!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubexpose:一个Kubernetes运营商，为了乐趣和利润！</h1>
<blockquote>原文：<a href="https://itnext.io/kubexpose-a-kubernetes-operator-for-fun-and-profit-f528586eee07?source=collection_archive---------3-----------------------#2021-09-19">https://itnext.io/kubexpose-a-kubernetes-operator-for-fun-and-profit-f528586eee07?source=collection_archive---------3-----------------------#2021-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e8b5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过互联网访问您的Kubernetes部署</h2></div><p id="dca7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您有一个作为Kubernetes <code class="fe lb lc ld le b">Deployment</code>运行的web服务。有很多方法可以通过公共URL访问它，但是Kubexpose使这变得很容易。这是一个由<a class="ae lf" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" rel="noopener ugc nofollow" target="_blank">自定义资源定义</a>和相应的控制器实现支持的<a class="ae lf" href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" rel="noopener ugc nofollow" target="_blank"> Kubernetes操作符</a>。</p><blockquote class="lg lh li"><p id="fc00" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><code class="fe lb lc ld le b"><em class="iq">Kubexpose</em></code> <em class="iq">是使用</em><a class="ae lf" href="https://kubebuilder.io/" rel="noopener ugc nofollow" target="_blank"><em class="iq">kubebuilder</em></a><em class="iq">和</em> <a class="ae lf" href="https://github.com/abhirockzz/kubexpose-operator" rel="noopener ugc nofollow" target="_blank"> <em class="iq">构建的，可在GitHub </em> </a> <em class="iq">上获得。</em></p></blockquote><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/6a58bbe4fbe7ba0c1c0ab8c5e3958136.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*37nSw5Kd1ABoZ2Rd"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated"><a class="ae lf" href="https://unsplash.com/@thomasjsn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">托马斯·詹森</a>在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><p id="f46c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要试用它，请跳到下一部分或向下滚动到<strong class="kh ir">它是如何工作的？</strong>了解更多</p><h1 id="078f" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">快速启动</h1><p id="ba99" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">任何Kubernetes集群都可以工作(<code class="fe lb lc ld le b">minikube</code>、<code class="fe lb lc ld le b">kind</code>、Docker桌面、云等等)...).</p><p id="ef41" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署操作员和其他组件(CRD等。):</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="77d6" class="nl ml iq le b gy nm nn l no np">kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/kubexpose-all-in-one.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/kubexpose-all-in-one.yaml</a></span></pre><p id="f778" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保操作员已启动并正在运行:</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="09db" class="nl ml iq le b gy nm nn l no np">export OPERATOR_NAMESPACE=kubexpose-operator-system</span><span id="37bd" class="nl ml iq le b gy nq nn l no np"># check Pods<br/>kubectl get pods -n $OPERATOR_NAMESPACE</span><span id="4332" class="nl ml iq le b gy nq nn l no np"># check logs<br/>kubectl logs -f $(kubectl get pods --namespace $OPERATOR_NAMESPACE -o=jsonpath='{.items[0].metadata.name}') -c manager -n $OPERATOR_NAMESPACE</span></pre><p id="b2cb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个<code class="fe lb lc ld le b">nginx</code>部署来进行测试——这是您希望通过公共URL在互联网上公开的部署。</p><p id="762e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">与此同时，创建一个<code class="fe lb lc ld le b">kubexpose</code>资源——它将帮助您通过互联网访问<code class="fe lb lc ld le b">ngnix</code>部署！</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="540c" class="nl ml iq le b gy nm nn l no np">kubectl apply -f https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/quickstart/nginx.yaml</span><span id="6716" class="nl ml iq le b gy nq nn l no np">kubectl apply -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/quickstart/kubexpose.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/quickstart/kubexpose.yaml</a></span></pre><p id="67c7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">等待几秒钟，检查可以访问nginx <code class="fe lb lc ld le b">Deployment</code>的公共URL:</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="151e" class="nl ml iq le b gy nm nn l no np">kubectl get kubexpose/kubexpose-test -o=jsonpath='{.status.url}'</span></pre><blockquote class="lg lh li"><p id="148c" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><em class="iq">使用浏览器访问公共URL或使用</em> <code class="fe lb lc ld le b"><em class="iq">curl</em></code>进行测试</p></blockquote><p id="b539" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确认相应的<code class="fe lb lc ld le b">Service</code>和<code class="fe lb lc ld le b">Deployment</code>也已创建:</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="137c" class="nl ml iq le b gy nm nn l no np">kubectl get svc/nginx-test-svc-kubexpose-test<br/>kubectl get deployment/nginx-test-expose-kubexpose-test</span></pre><blockquote class="lg lh li"><p id="721d" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><em class="iq">您可以尝试其他场景，例如尝试</em> <code class="fe lb lc ld le b"><em class="iq">Deployment</em></code> <em class="iq">和/或</em><code class="fe lb lc ld le b"><em class="iq">Service</em></code><em class="iq">——操作员将协调或使事物回到资源中指定的状态。</em></p></blockquote><p id="7022" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要删除<code class="fe lb lc ld le b">kubexpose</code>资源:</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="65c5" class="nl ml iq le b gy nm nn l no np">kubectl delete kubexpose/kubexpose-test</span></pre><blockquote class="lg lh li"><p id="b813" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><em class="iq">这也将删除为此资源</em>创建的 <code class="fe lb lc ld le b"><em class="iq">Service</em></code> <em class="iq">和</em> <code class="fe lb lc ld le b"><em class="iq">Deployment</em></code> <em class="iq"/></p></blockquote><p id="b609" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要卸载操作员:</p><pre class="lo lp lq lr gt nh le ni nj aw nk bi"><span id="deb4" class="nl ml iq le b gy nm nn l no np">kubectl delete -f <a class="ae lf" href="https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/kubexpose-all-in-one.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/abhirockzz/kubexpose-operator/master/kubexpose-all-in-one.yaml</a></span></pre><blockquote class="lg lh li"><p id="b3ce" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><em class="iq">这将删除【CRD】、</em>、<code class="fe lb lc ld le b"><em class="iq">kubexpose</em></code>、<em class="iq">运算符等资源。</em></p></blockquote></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="9bfa" class="mk ml iq bd mm mn nr mp mq mr ns mt mu jw nt jx mw jz nu ka my kc nv kd na nb bi translated">它是如何工作的？</h1><p id="7b46" class="pw-post-body-paragraph kf kg iq kh b ki nc jr kk kl nd ju kn ko ne kq kr ks nf ku kv kw ng ky kz la ij bi translated">在幕后，<code class="fe lb lc ld le b">Kubexpose</code>使用令人敬畏的<a class="ae lf" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>项目来完成工作！当您创建一个<code class="fe lb lc ld le b">kubexpose</code>资源时，操作员:</p><ul class=""><li id="3bdd" class="nw nx iq kh b ki kj kl km ko ny ks nz kw oa la ob oc od oe bi translated">为您想要访问的<code class="fe lb lc ld le b">Deployment</code>创建一个<code class="fe lb lc ld le b">ClusterIP</code>类型<code class="fe lb lc ld le b">Service</code>(命名格式:<code class="fe lb lc ld le b">&lt;deployment name&gt;-svc-&lt;kubexpose resource name&gt;</code>)</li><li id="ab76" class="nw nx iq kh b ki of kl og ko oh ks oi kw oj la ob oc od oe bi translated">创建一个运行<code class="fe lb lc ld le b">ngrok</code>的<code class="fe lb lc ld le b">Deployment</code>(使用这个<a class="ae lf" href="https://hub.docker.com/r/wernight/ngrok/" rel="noopener ugc nofollow" target="_blank"> ngrok Docker映像</a>)，它被配置为指向<code class="fe lb lc ld le b">Service</code>(命名格式:<code class="fe lb lc ld le b">&lt;deployment name&gt;-expose-&lt;kubexpose resource name&gt;</code>)。这样相当于启动<code class="fe lb lc ld le b">ngrok</code>:<code class="fe lb lc ld le b">ngrok http foo-svc-bar 80</code></li></ul><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ok"><img src="../Images/a78b6240c09e03e6404dd17e27d428ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C3Eu4v8-72Icj8Yf.jpeg"/></div></div></figure><blockquote class="lg lh li"><p id="ae12" class="kf kg lj kh b ki kj jr kk kl km ju kn lk kp kq kr ll kt ku kv lm kx ky kz la ij bi translated"><em class="iq"/><code class="fe lb lc ld le b"><em class="iq">Deployment</em></code><em class="iq">和</em> <code class="fe lb lc ld le b"><em class="iq">Service</em></code> <em class="iq">由Kubexpose资源实例拥有和管理。</em></p></blockquote><p id="581b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p></div></div>    
</body>
</html>