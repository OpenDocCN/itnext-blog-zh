<html>
<head>
<title>Terraform — Enforcing doc generation and code formatting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform —强制文档生成和代码格式化</h1>
<blockquote>原文：<a href="https://itnext.io/terraform-enforcing-doc-generation-and-code-formatting-e7dc6098b3a0?source=collection_archive---------2-----------------------#2020-05-18">https://itnext.io/terraform-enforcing-doc-generation-and-code-formatting-e7dc6098b3a0?source=collection_archive---------2-----------------------#2020-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/20fe4e5c80913c173189dd5bb6685849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9jYOdA5dT_FWzPgwXptf8A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">生成的文档</figcaption></figure><p id="88b7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我最近开始使用Terraform，我非常喜欢它；几乎到了再也不想碰一个手臂模板的地步。我的初步印象肯定会导致许多博客帖子！</p><p id="2eb9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我一直在编写多个模块来部署和管理AKS基础设施。在这个过程中，我想标准化模块接口文档的生成。我还想加强使用地形林挺/格式化。</p><p id="97ba" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">粗略的搜索让我找到了<a class="ae la" href="https://github.com/segmentio/terraform-docs" rel="noopener ugc nofollow" target="_blank"> terraform-docs </a>项目。该项目是一个单独的可执行文件，它将生成包含在模块文档中的元数据。可以灵活地用markdown、ascii、json等语言生成它。然而，我的Terraform文档超越了系统生成的数据(概述、限制、已知问题、示例等)。Terraform-docs将其输出生成到stdout，您可以将其重定向到文件。我需要一个解决方案，除了系统生成的元数据之外，它还允许我拥有自定义文档。我打算把一些东西放到CI管道中，直到我找到了<a class="ae la" href="https://github.com/antonbabenko/pre-commit-terraform" rel="noopener ugc nofollow" target="_blank">预提交平台</a>开源项目。</p><p id="1611" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Pre-commit-terraform创建git挂钩，无论何时进行本地提交，它都会运行。我不会进入所有的设置步骤，因为该项目做得很好。安装好先决条件后，添加一个名为<em class="lb">的配置。将pre-commit-config.yaml </em>提交到存储库中。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="d825" class="ll lm iq lh b gy ln lo l lp lq">repos:</span><span id="c98d" class="ll lm iq lh b gy lr lo l lp lq">- repo: git://github.com/antonbabenko/pre-commit-terraform</span><span id="089a" class="ll lm iq lh b gy lr lo l lp lq">rev: v1.30.0 # Get the latest from: https://github.com/antonbabenko/pre-commit-terraform/releases</span><span id="129a" class="ll lm iq lh b gy lr lo l lp lq">hooks:</span><span id="d6e3" class="ll lm iq lh b gy lr lo l lp lq">- id: terraform_fmt</span><span id="1ff4" class="ll lm iq lh b gy lr lo l lp lq">- id: terraform_docs</span></pre><p id="a7db" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此配置将触发格式化脚本，该脚本在后台执行terraform fmt，并使用terraform-docs生成文档。文档生成具有上游项目中没有的附加功能。它允许您将系统生成的数据嵌入到您的markdown <em class="lb"> README.md </em>中。下面是一个利用这个特性的样本模板。特别注意标记；这是元数据将被插入的位置</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="74cb" class="ll lm iq lh b gy ln lo l lp lq"><strong class="lh ir"># Overview<br/></strong></span><span id="d045" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir"># Limitations<br/></strong></span><span id="6553" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir"># Known Issues<br/></strong></span><span id="49f7" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir"># Usage</strong></span><span id="206e" class="ll lm iq lh b gy lr lo l lp lq">&lt;!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK --&gt;</span><span id="f752" class="ll lm iq lh b gy lr lo l lp lq">&lt;!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK --&gt;</span></pre><p id="7800" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在提交期间，降价将如下所示呈现。它包括模块需求、提供者、输入和输出。请记住，文档的质量取决于输入和输出中描述属性的使用。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3a4b" class="ll lm iq lh b gy ln lo l lp lq">&lt;!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK --&gt;</span><span id="4b5c" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir">## Requirements</strong></span><span id="ddb5" class="ll lm iq lh b gy lr lo l lp lq">| Name | Version |</span><span id="1652" class="ll lm iq lh b gy lr lo l lp lq">|------|---------|</span><span id="b9d3" class="ll lm iq lh b gy lr lo l lp lq">| azurerm | ~&gt;2.0 |</span><span id="ba41" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir">## Providers</strong></span><span id="31ec" class="ll lm iq lh b gy lr lo l lp lq">| Name | Version |</span><span id="74f1" class="ll lm iq lh b gy lr lo l lp lq">|------|---------|</span><span id="b5c7" class="ll lm iq lh b gy lr lo l lp lq">| azurerm | ~&gt;2.0 |</span><span id="e623" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir">## Inputs</strong></span><span id="b06c" class="ll lm iq lh b gy lr lo l lp lq">| Name | Description | Type | Default | Required |</span><span id="a1d6" class="ll lm iq lh b gy lr lo l lp lq">|------|-------------|------|---------|:--------:|</span><span id="3a04" class="ll lm iq lh b gy lr lo l lp lq">| app\_name | Application nam. | `string` | n/a | yes |</span><span id="8bf4" class="ll lm iq lh b gy lr lo l lp lq">| base\_cidr\_block | Address range for the virtual network in CIDR notation. CIDR must be a /21. | `string` | n/a | yes |</span><span id="23f1" class="ll lm iq lh b gy lr lo l lp lq">| dns\_servers | List of DNS servers. | `list(string)` | `[]` | no |</span><span id="f467" class="ll lm iq lh b gy lr lo l lp lq">| location | Location where the resources will be created. | `string` | n/a | yes |</span><span id="9deb" class="ll lm iq lh b gy lr lo l lp lq">| next\_hop\_egress\_ip | IP address of NVA/Azure Firewall for default route egress. | `string` | n/a | yes |</span><span id="f551" class="ll lm iq lh b gy lr lo l lp lq">| tier\_name | Service tier the application will run. | `string` | n/a | yes |</span><span id="fa68" class="ll lm iq lh b gy lr lo l lp lq"><strong class="lh ir">## Outputs</strong></span><span id="5282" class="ll lm iq lh b gy lr lo l lp lq">| Name | Description |</span><span id="2d92" class="ll lm iq lh b gy lr lo l lp lq">|------|-------------|</span><span id="7645" class="ll lm iq lh b gy lr lo l lp lq">| id | Resource id for the virtual network. |</span><span id="28b2" class="ll lm iq lh b gy lr lo l lp lq">| name | Virtual Network name. |</span><span id="3868" class="ll lm iq lh b gy lr lo l lp lq">| rg\_name | Resource group name containing the resources |</span><span id="b3b6" class="ll lm iq lh b gy lr lo l lp lq">&lt;!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK --&gt;</span></pre><p id="ed96" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">pre-commit-terraform项目有一些额外的挂钩，我还没有进行评估。总的来说，这些钩子有助于确保我的模块文档总是最新的，并且我的代码格式良好。</p><p id="83de" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">希望你喜欢这次保存博文的时间。敬请关注更多Terraform内容。</p></div></div>    
</body>
</html>