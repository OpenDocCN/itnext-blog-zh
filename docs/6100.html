<html>
<head>
<title>AWS: Lambda functions — an overview, and integration with AWS API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS: Lambda函数—概述，以及与AWS API网关的集成</h1>
<blockquote>原文：<a href="https://itnext.io/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway-ee0bc795a143?source=collection_archive---------2-----------------------#2021-08-18">https://itnext.io/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway-ee0bc795a143?source=collection_archive---------2-----------------------#2021-08-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4116eb2906df88b0d6fcf1c7806264e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*6dXEkU-sfm3IrnC9WoL1QA.png"/></div></figure><p id="e8cb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>允许在不需要创建和管理服务器的情况下运行代码，也被称为<em class="kt">无服务器方法。</em></p><p id="03aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">AWS Lambda将确定运行一个函数需要多少CPU和内存，必要时它会执行自动缩放。</p><p id="9c8f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要运行的代码被组织在<em class="kt">λ函数</em>中，并且可以用<em class="kt">触发器</em>来触发。可以使用CloudWatch日志来检查结果。</p><p id="6a95" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为触发器，您可以使用几乎任何AWS服务，如API Gateway、SQS、应用负载平衡器、CloudFront、Kinesis或外部事件，例如Github的webhook。</p><p id="d98b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本文中，我们将创建一个简单的AWS Lambda函数，检查它的控制面板、可用选项和功能，然后创建一个AWS API网关，将HTTP请求转发给AWS Lambda函数。</p><h1 id="6d68" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">内容</h1><ul class=""><li id="a86d" class="ls lt iq jw b jx lu kb lv kf lw kj lx kn ly kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#AWS_Lambda_-_use_cases" rel="noopener ugc nofollow" target="_blank"> AWS Lambda —使用案例</a></li><li id="64ba" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Components_and_concepts" rel="noopener ugc nofollow" target="_blank">组件和概念</a></li><li id="fd5c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Creating_a_Hello_World_Lambda_function" rel="noopener ugc nofollow" target="_blank">创建“Hello，World”Lambda函数</a></li><li id="66e6" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Create_a_function" rel="noopener ugc nofollow" target="_blank">创建功能</a></li><li id="8f8c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Monitoring" rel="noopener ugc nofollow" target="_blank">监控</a></li><li id="ad89" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Configuration" rel="noopener ugc nofollow" target="_blank">配置</a></li><li id="9efe" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#General_configuration" rel="noopener ugc nofollow" target="_blank">总体配置</a></li><li id="2ac5" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Triggers" rel="noopener ugc nofollow" target="_blank">触发器</a></li><li id="bf1c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Permissions" rel="noopener ugc nofollow" target="_blank">权限</a></li><li id="2c11" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Destinations" rel="noopener ugc nofollow" target="_blank">目的地</a></li><li id="9c46" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Environment_variables" rel="noopener ugc nofollow" target="_blank">环境变量</a></li><li id="cdda" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#VPC" rel="noopener ugc nofollow" target="_blank"> VPC </a></li><li id="0402" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Monitoring_and_operations_tools" rel="noopener ugc nofollow" target="_blank">监控和操作工具</a></li><li id="b93e" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Concurrency" rel="noopener ugc nofollow" target="_blank">并发</a></li><li id="ccc2" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Asynchronous_invocation" rel="noopener ugc nofollow" target="_blank">异步调用</a></li><li id="d001" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Database_proxies" rel="noopener ugc nofollow" target="_blank">数据库代理</a></li><li id="4e91" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#File_system" rel="noopener ugc nofollow" target="_blank">文件系统</a></li><li id="66f7" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Aliases" rel="noopener ugc nofollow" target="_blank">别名</a></li><li id="7cff" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Versions" rel="noopener ugc nofollow" target="_blank">版本</a></li><li id="cf55" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#AWS_Lambda_and_AWS_API_Gateway_-_an_integration_example" rel="noopener ugc nofollow" target="_blank"> AWS Lambda和AWS API网关——集成示例</a></li><li id="2837" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Create_a_Lambda_function" rel="noopener ugc nofollow" target="_blank">创建一个Lambda函数</a></li><li id="b08f" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/#Create_an_AWS_API_Gateway" rel="noopener ugc nofollow" target="_blank">创建一个AWS API网关</a></li></ul><h1 id="bbd4" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">AWS Lambda —使用案例</h1><p id="193d" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">一般来说，AWS中的Lambda可以做很多事情。这样的“银弹”，允许做AWS控制台本身无法实现的事情。</p><p id="5e3a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">示例用例可能是:</p><ul class=""><li id="4f88" class="ls lt iq jw b jx jy kb kc kf ml kj mm kn mn kr lz ma mb mc bi translated">一个网站:一个基于javascript的静态托管的AWS S3前端，前端将通过一个Lambda函数接收通过AWS API网关到数据库的请求</li><li id="60eb" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">日志分析:一个很好的例子是<a class="ae ks" href="https://aws.amazon.com/ru/solutions/implementations/aws-waf-security-automations/" rel="noopener ugc nofollow" target="_blank"> AWS WAF安全自动化</a>，当所有传入的HTTP请求被发送到AWS Kinesis时，它会将它们转发到Lambda，它会执行一些检查，如果需要，会阻止客户端的IP</li><li id="d5c7" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">备份自动化:AWS SNS可以向Lambda函数发送一个事件，例如当AWS S3存储桶中使用了太多的磁盘空间时，这将删除一些旧的备份</li><li id="dbf7" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">数据处理:例如，当一个新文件上传到AWS S3时，它将生成一个事件，该事件将触发一个Lambda函数，该函数将执行视频文件编码</li><li id="9a75" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">无服务器cronjobs:使用CloudWatch Events按时间表生成一个事件，这将触发一个Lambda函数</li></ul><h1 id="379b" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">组件和概念</h1><p id="7031" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">让我们简要概述一下AWS Lambda的主要概念:</p><ul class=""><li id="5d01" class="ls lt iq jw b jx jy kb kc kf ml kj mm kn mn kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">函数</em> </strong> <em class="kt"> : </em>是运行在函数中的代码。可以作为zip文件或Docker镜像(<em class="kt">部署包)。</em>参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-functions.html" rel="noopener ugc nofollow" target="_blank">配置AWS Lambda功能</a>。</li><li id="0a7c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">触发器</em> </strong>:将触发一个函数的AWS资源。这种事件包括AWS服务和<em class="kt">事件映射</em>。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-invocation.html" rel="noopener ugc nofollow" target="_blank">调用AWS Lambda函数</a> и <a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html" rel="noopener ugc nofollow" target="_blank">使用AWS Lambda和其他服务</a>。</li><li id="42ae" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">事件</em> </strong>:一个JSON对象，包含Lambda函数的数据进行处理</li><li id="9998" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">执行环境</em> </strong> <em class="kt"> : </em>执行功能的安全环境。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-context.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda执行环境</a>。</li><li id="5316" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">部署包</em> </strong> <em class="kt"> : </em>要运行的Lambda功能代码。可以是zip存档或Docker图像。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-package.html" rel="noopener ugc nofollow" target="_blank"> Lambda部署包</a>。</li><li id="8b9c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">运行时</em> </strong>:运行一个功能的工作环境。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html" rel="noopener ugc nofollow" target="_blank">λ运行时间</a></li><li id="b49c" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">层</em> </strong>:一个zip存档文件，其中包含运行某个函数的附加代码，例如——外部库。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">创建和共享Lambda层</a>。</li><li id="aae1" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">扩展</em> </strong> : AWS Lambda允许使用扩展，这些扩展可用于将功能与外部服务(如监控)集成。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/using-extensions.html" rel="noopener ugc nofollow" target="_blank">使用Lambda扩展</a>。</li><li id="7c08" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">并发</em> </strong>:多个Lambda函数实例同时运行，处理传入的数据。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html" rel="noopener ugc nofollow" target="_blank">管理Lambda函数的并发性</a>。</li><li id="f56d" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">限定词</em> </strong>:指向版本或别名的“指针”。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-versions.html" rel="noopener ugc nofollow" target="_blank">λ函数版本</a>。</li><li id="6186" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"> <em class="kt">目的地</em> </strong>:一个AWS资源，函数将在其中发送处理后的数据。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html#invocation-async-destinations" rel="noopener ugc nofollow" target="_blank">配置异步调用的目的地</a>。</li></ul><h1 id="0991" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">创建“Hello，World”Lambda函数</h1><p id="86a6" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">首先，让我们创建一个最简单的Lambda函数，看看它是如何工作的，我们有什么。</p><h2 id="ca7e" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">创建一个函数</h2><p id="f6c4" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">转到AWS Lambda，点击<em class="kt">创建功能</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi na"><img src="../Images/92ac09d6c86068536d3a0b65cb106814.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v9Y6u3Mv_P4mhKZ4.png"/></div></div></figure><p id="3962" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们使用一个现有的模板。选择<em class="kt">使用蓝图</em>，找到<em class="kt"> hello-world-python </em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nj"><img src="../Images/77eac64ae20b38de0d5c34e145f95a1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hh1Mg9nOM9mHiXT_.png"/></div></div></figure><p id="2a3a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击<em class="kt">配置</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi na"><img src="../Images/fee46a77a72c862f3cd3371cc52ae5d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CQtYQ7ikSUeiuHd1.png"/></div></div></figure><p id="26f2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">设置一个函数的名称，例如<em class="kt"> example-hello </em>，保留一个默认的IAM角色——它将允许我们的函数使用CloudWatch日志，并检查将要使用的代码:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nk"><img src="../Images/2d4606646c4c29c6839b3e8d234c87c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IRcu5HPJGyEI4kmP.png"/></div></div></figure><p id="ed23" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击<em class="kt">创建功能</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nl"><img src="../Images/cb852942dc8c1666d52812871354753f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Ykanr-0rSlSLRrF.png"/></div></div></figure><p id="a831" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">切换到<em class="kt">测试</em>标签:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nm"><img src="../Images/fc273e870aa2daaee3d5c366c8882d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9WeMBmBg_f_XWxut.png"/></div></div></figure><p id="81ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，我们可以传递一个JSON，其中包含要由我们的函数处理的数据。</p><p id="d45d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">运行它:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nn"><img src="../Images/4452e554066ce6b363bf06df3d509a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lYtlS0Jp9ol2QgT7.png"/></div></div></figure><p id="47fe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们来看看AWS控制台建议使用什么来进行Lambda函数管理。</p><h2 id="6ef9" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">监视</h2><p id="c6dc" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">首先是监控。在这里，我们可以使用AWS CloudWatch指标和日志，通过AWS X-Ray、Lambda insights和AWS CodeGuru进行调用跟踪:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi no"><img src="../Images/b7ddf05ea1bc9db10bacab69560ec401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZD5eUg8atqb6b195.png"/></div></div></figure><h2 id="320e" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">配置</h2><h2 id="a2fe" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">一般配置</h2><ul class=""><li id="1ee7" class="ls lt iq jw b jx lu kb lv kf lw kj lx kn ly kr lz ma mb mc bi translated">内存设置:运行一个函数时允许使用的最大内存。此外，根据内存设置，Lambda将提供一个CPU限制:对于每1769 MB，将有一个vCPU。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-function-common.html#configuration-memory-console" rel="noopener ugc nofollow" target="_blank">配置功能存储器(控制台)</a>。</li><li id="8dc0" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">执行超时:最大值可以设置为900秒，在此之后，函数执行将被停止。请记住，这将影响成本。参见<a class="ae ks" href="https://docs.aws.amazon.com/whitepapers/latest/serverless-architectures-lambda/timeout.html" rel="noopener ugc nofollow" target="_blank">超时</a>。</li><li id="53e6" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated">IAM角色:包括具有AWS资源权限的IAM策略</li></ul><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi np"><img src="../Images/c6954fa0222b6fb6d9d4c749a19c6a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_75cHkiYPIgjtsTY.png"/></div></div></figure><h2 id="4b73" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">扳机</h2><p id="a7b2" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">触发我们功能的触发器。</p><p id="a8b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">几乎可以是任何AWS服务:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi np"><img src="../Images/1b7641423546639f2d252e03ccb098d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zm7yg-NaeoAJ4P9S.png"/></div></div></figure><p id="9043" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，我们可以从AWS应用程序负载平衡器创建一个触发器，该触发器将接受到特定URI的连接，并将其转发给Lambda函数:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nq"><img src="../Images/4695646c816dac14a7e8fba512e9be11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*97y7G5nBBWO4DCSm.png"/></div></div></figure><h2 id="0286" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">许可</h2><p id="9589" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">在这里，您可以查看和调整将配置功能权限的IAM角色和策略:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nr"><img src="../Images/95be974e6deba7499d39f87712833903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FLBEiTI1yy4yfAI0.png"/></div></div></figure><h2 id="e4aa" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">目的地</h2><p id="f809" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">向何处发送函数的执行结果。</p><p id="ecaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，可以是一个AWS SNS主题，该主题会将其转发给Opsgenie，ops genie会将消息发送到一个松弛通道:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ns"><img src="../Images/dbfe7c31c2f9b83995af185a8957b652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PkgSc8u6zxJ1Ez7h.png"/></div></div></figure><h2 id="f4db" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">环境变量</h2><p id="6078" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">可以在函数中使用的变量。敏感数据可以使用AWS密钥管理服务(KMS)进行加密:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nt"><img src="../Images/e15d8eb8adb9c5db7e1a5eada395ff06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MiNHMGUMn6IZO-51.png"/></div></div></figure><h2 id="c506" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">VPC</h2><p id="f104" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">可以在专用AWS虚拟私有云上放置一个功能来限制其网络访问:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nt"><img src="../Images/bd37485989ee8f0d9c7cc5499b64f30c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*msnk5vkRv8nRLq_K.png"/></div></div></figure><h2 id="e6aa" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">监控和操作工具</h2><p id="c093" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">监控设置，您可以在其中启用或禁用附加服务，如AWS X-Ray、CloudWatch Lambda Insights和Amazon CodeGuru Profiler:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nu"><img src="../Images/7318771b8b9aa5b6ecc8f7aee526bef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2uFHihqpyeS9kXnD.png"/></div></div></figure><p id="56c0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<em class="kt">扩展中，</em>您可以从现有解决方案列表中选择，也可以创建自己的解决方案:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nv"><img src="../Images/3b67b3864618cfcfee7e832fd11f5a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kLKO_248Kc13Pj8T.png"/></div></div></figure><h2 id="a1ee" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">并发</h2><p id="72c1" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">可以同时运行的函数实例的最大数量。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-concurrency.html" rel="noopener ugc nofollow" target="_blank">管理Lambda函数的并发性</a>。</p><p id="6e7f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">可以是以下两种类型之一:</p><ul class=""><li id="b8a6" class="ls lt iq jw b jx jy kb kc kf ml kj mm kn mn kr lz ma mb mc bi translated"><strong class="jw ir"/></li><li id="d816" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr lz ma mb mc bi translated"><strong class="jw ir"/></li></ul><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nw"><img src="../Images/791026198958c9dc048be40ab2b3ec18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BDtz6bObh0E3lA9W.png"/></div></div></figure><h2 id="21d8" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">异步调用</h2><p id="21be" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">事件队列的设置—生存期、出错时的重试次数、错误通知等。</p><p id="0a54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html?icmpid=docs_lambda_help" rel="noopener ugc nofollow" target="_blank">异步调用</a>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nx"><img src="../Images/07ef0fa1d097207d04f306981991cea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QIhHI2Ih8Ev7ZYaN.png"/></div></div></figure><p id="5f25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-sync.html" rel="noopener ugc nofollow" target="_blank">同步调用</a>和<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html" rel="noopener ugc nofollow" target="_blank">异步调用</a>。</p><h2 id="0b4f" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">数据库代理</h2><p id="3f78" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">一个<a class="ae ks" href="https://aws.amazon.com/ru/rds/proxy/" rel="noopener ugc nofollow" target="_blank"> Amazon RDS代理</a>配置用于您的功能。用于减少数据库服务器连接数量的RDS代理:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nx"><img src="../Images/96b0c1198d2f2741b6952823f936b777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6auM_fX1glBwqrfZ.png"/></div></div></figure><h2 id="a066" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">文件系统</h2><p id="4fd6" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">您可以在函数中挂载一个AWS弹性文件系统目录:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ny"><img src="../Images/487c37cfef75c92ded6d4164cc10fcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DIG93NK9Ek9xQ9Lk.png"/></div></div></figure><h2 id="83bb" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">别名</h2><p id="dd32" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">别名是一种指针，指向函数代码的特定版本，以后可以在它的ARN中使用。</p><p id="0988" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，您可以有几个别名，并在它们之间分配请求。参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-aliases.html" rel="noopener ugc nofollow" target="_blank">λ函数别名</a>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nz"><img src="../Images/5fd8d0f1bef1736890c55b37c4eaee7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*09jcm3by31_EEhsJ.png"/></div></div></figure><h2 id="9b75" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">版本</h2><p id="5fb5" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">AWS Lambda允许使用代码和部分设置版本。在开发环境中测试新代码时会很有用，例如通过创建专用的<em class="kt">别名</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oa"><img src="../Images/551bdba7f6d7ac591a513202bb6b5ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kDZ7jfu2Lwbv4UGU.png"/></div></div></figure><h1 id="53f1" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">AWS Lambda和AWS API网关—集成示例</h1><p id="4544" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">因此，我们已经检查了什么是AWS Lambda以及它的设置中有什么。</p><p id="9701" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们创建一个AWS API网关，它将请求转发给AWS Lambda函数。</p><p id="6d97" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">API网关将接受对<em class="kt"> /test </em> URI的请求，并使用其事件将请求发送给我们的Lambda。</p><h2 id="61a6" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">创建Lambda函数</h2><p id="4013" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">这时，从头选择<em class="kt">作者</em>，在运行时使用<em class="kt"> Python </em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ob"><img src="../Images/d7f7f39cab128a44f5932c80ebda5b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uJUgjqlWjO2pmepc.png"/></div></div></figure><p id="2ffd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保留默认代码:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oc"><img src="../Images/6e02a0e288203d19dfe49a64ae4e5992.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LoCxT1PgOOUgnMhp.png"/></div></div></figure><p id="2ce3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里，<code class="fe od oe of og b">lambda_handler()</code>是调用函数时要调用的默认函数。它接受两个参数:</p><ol class=""><li id="a9a4" class="ls lt iq jw b jx jy kb kc kf ml kj mm kn mn kr oh ma mb mc bi translated"><code class="fe od oe of og b">event</code>:API网关事件，参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-services.html" rel="noopener ugc nofollow" target="_blank">使用AWS Lambda和其他服务</a></li><li id="df3f" class="ls lt iq jw b jx md kb me kf mf kj mg kn mh kr oh ma mb mc bi translated"><code class="fe od oe of og b">context</code>:运行函数所允许的方法和参数，参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/python-context.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda上下文对象中的Python </a></li></ol><h2 id="c8f8" class="mo kv iq bd kw mp mq dn la mr ms dp le kf mt mu li kj mv mw lm kn mx my lq mz bi translated">创建AWS API网关</h2><p id="704c" class="pw-post-body-paragraph ju jv iq jw b jx lu jz ka kb lv kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ij bi translated">创建一个新的网关，将其类型设置为<em class="kt"> HTTP API </em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oi"><img src="../Images/a2a927efa835e320bf5e32ecbc96146c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z4fkGqy8SifHIWSC.png"/></div></div></figure><p id="daf7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加集成:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oj"><img src="../Images/041a78231a9ea72c491c1696bb331244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jPZAoxwODR_9qqKl.png"/></div></div></figure><p id="c213" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择Lambda、AWS区域和要调用的函数:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ok"><img src="../Images/f9ba8bb519509d6e52c2499dc5376893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a4Kjp214dLzpWgpA.png"/></div></div></figure><p id="2176" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将URI设置为<em class="kt">/测试</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ol"><img src="../Images/756b5004e2b0c8b40fdb5206fd24075a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7oqKFxsZ-q4hTxu6.png"/></div></div></figure><p id="002c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">离开默认<a class="ae ks" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/stages.html" rel="noopener ugc nofollow" target="_blank">阶段</a>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ol"><img src="../Images/fb229260e0b3f29eb82314e5c7f6c845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*798HA4_2vOxnHo4r.png"/></div></div></figure><p id="42bd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不到一分钟，您的网关就准备好了。复制其URL:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi om"><img src="../Images/2d37c0344641fff5f13d4393ad6860c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3WMtdCNiUKAl-mHO.png"/></div></div></figure><p id="153e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用<code class="fe od oe of og b">curl</code>试试:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="d21f" class="mo kv iq og b gy or os l ot ou">$ curl <a class="ae ks" href="https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test</a><br/>“Hello from Lambda!”</span></pre><p id="6db9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要检查事件的全部内容，用<code class="fe od oe of og b"><a class="ae ks" href="https://docs.python.org/3/library/json.html" rel="noopener ugc nofollow" target="_blank">json.dumps()</a></code>打印出来:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="7dab" class="mo kv iq og b gy or os l ot ou">import json<br/><br/>def lambda_handler(event, context):<br/>    return {<br/>        'statusCode': 200,<br/>        'body': json.dumps(event)<br/>    }</span></pre><p id="a2fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更改密码后，按下<em class="kt">展开</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/d8d21f35c01186abd6b1cc451806f24a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/0*5tl_XBNqVpoh1dFx.png"/></div></figure><p id="b1cd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">试试看:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="2a35" class="mo kv iq og b gy or os l ot ou">$ curl <a class="ae ks" href="https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test</a><br/>{“version”: “2.0”, “routeKey”: “ANY /test”, “rawPath”: “/test”, “rawQueryString”: “”, “headers”: {“accept”: “*/*”, “content-length”: “0”, “host”: “fwu399qo70.execute-api.us-east-2.amazonaws.com”, “user-agent”: “curl/7.78.0”, “x-amzn-trace-id”: “Root=1–611bbaa4–3cb7c28e4e3181dd647f1030”, “x-forwarded-for”: “194.***.***.29”, “x-forwarded-port”: “443”, “x-forwarded-proto”: “https”}, “requestContext”: {“accountId”: “534***385”, “apiId”: “fwu399qo70”, “domainName”: “fwu399qo70.execute-api.us-east-2.amazonaws.com”, “domainPrefix”: “fwu399qo70”, “http”: {“method”: “GET”, “path”: “/test”, “protocol”: “HTTP/1.1”, “sourceIp”: “194.***.***.29”, “userAgent”: “curl/7.78.0”}, “requestId”: “ENoZriIrCYcEPWg=”, “routeKey”: “ANY /test”, “stage”: “$default”, “time”: “17/Aug/2021:13:33:24 +0000”, “timeEpoch”: 1629207204179}, “isBase64Encoded”: false}</span></pre><p id="ffba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们看看如何在函数中使用环境变量。</p><p id="41ba" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加一个新的:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ow"><img src="../Images/d7ab492f3253d3c92d3c45328b9644cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IOBmNPAkNV-OPplT.png"/></div></div></figure><p id="5dd7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并用<code class="fe od oe of og b">os.getenv()</code>打印其值:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="8853" class="mo kv iq og b gy or os l ot ou">import os<br/>import json<br/><br/>def lambda_handler(event, context):<br/>    return {<br/>        'statusCode': 200,<br/>        'body': os.getenv('Env')<br/>    }</span></pre><p id="1cbd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查一下:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="129a" class="mo kv iq og b gy or os l ot ou">$ curl <a class="ae ks" href="https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test</a><br/>test</span></pre><p id="fd30" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，您可以更改默认的处理程序。</p><p id="acb8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将<code class="fe od oe of og b">lambda_handler</code>更名为<code class="fe od oe of og b">main_handler</code>:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="2c1b" class="mo kv iq og b gy or os l ot ou">import os<br/>import json<br/><br/>def main_handler(event, context):<br/>    return {<br/>        'statusCode': 200,<br/>        'body': os.getenv('Env')<br/>    }</span></pre><p id="641c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您现在尝试访问该函数，您将得到<strong class="jw ir"> <em class="kt">内部服务器错误</em> </strong>:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="805d" class="mo kv iq og b gy or os l ot ou">$ curl <a class="ae ks" href="https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test</a><br/>{“message”:”Internal Server Error”}</span></pre><p id="1a01" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">向下滚动到<em class="kt">运行时设置</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ox"><img src="../Images/5b6db36feb45e9c5d4339c672f5ab82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sDfO2UUC15Mm3GGA.png"/></div></div></figure><p id="f213" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并更换<em class="kt">手柄</em>:</p><figure class="nb nc nd ne gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oy"><img src="../Images/cb3efa864c466092053d4f940622620d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dzg6Aek33qJQ_MhH.png"/></div></div></figure><p id="9f46" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">再次运行:</p><pre class="nb nc nd ne gt on og oo op aw oq bi"><span id="faf1" class="mo kv iq og b gy or os l ot ou">$ curl <a class="ae ks" href="https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test" rel="noopener ugc nofollow" target="_blank">https://fwu399qo70.execute-api.us-east-2.amazonaws.com/test</a><br/>test</span></pre><p id="a217" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p></div><div class="ab cl oz pa hu pb" role="separator"><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe pf"/><span class="pc bw bk pd pe"/></div><div class="ij ik il im in"><p id="9d64" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="kt">最初发布于</em> <a class="ae ks" href="https://rtfm.co.ua/en/aws-lambda-functions-and-overview-and-integration-with-aws-api-gateway/" rel="noopener ugc nofollow" target="_blank"> <em class="kt"> RTFM: Linux、DevOps、系统管理</em> </a> <em class="kt">。</em></p></div></div>    
</body>
</html>