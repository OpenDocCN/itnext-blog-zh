<html>
<head>
<title>Building An End-to-end Application with LoopBack &amp; React.js — Part 1: Creating DataSource to GitHub API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用LoopBack &amp; React.js构建端到端应用程序—第1部分:创建GitHub API的数据源</h1>
<blockquote>原文：<a href="https://itnext.io/building-an-end-to-end-application-with-loopback-react-js-7a22d726c35d?source=collection_archive---------3-----------------------#2021-06-15">https://itnext.io/building-an-end-to-end-application-with-loopback-react-js-7a22d726c35d?source=collection_archive---------3-----------------------#2021-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/97d4f2f4e5151922d3f513e30e244549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QEVg4vwQPLqEWY0m4PPLg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.pexels.com/photo/flight-sky-earth-space-2159/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/flight-sky-earth-space-2159/</a></figcaption></figure><p id="84b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能已经知道了，我已经在<a class="ae kc" href="https://loopback.io/" rel="noopener ugc nofollow" target="_blank"> LoopBack </a>上写了<a class="ae kc" href="https://mobilediana.medium.com/" rel="noopener">几篇博文</a>，这些博文大多是基于<a class="ae kc" href="https://loopback.io/doc/en/lb4/todo-tutorial.html" rel="noopener ugc nofollow" target="_blank"> Todo教程</a>之上的。这是因为这些博客的主要目的是展示如何添加某些功能，而不是基础应用程序本身。</p><p id="d40c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一系列的博客文章中，我将创建一个端到端的应用程序——一个使用React的前端应用程序和一个带有LoopBack的API层，该API层与GitHub APIs进行交互。目的是在这个过程中深入一些特定的领域，所以如果你是环回的新手，我建议你看一看适合初学者的<a class="ae kc" href="https://loopback.io/doc/en/lb4/todo-tutorial.html" rel="noopener ugc nofollow" target="_blank"> Todo教程</a>。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="2d9c" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">申请是关于什么的？</h1><p id="8a47" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在这个应用程序中，我希望能够通过调用一些<a class="ae kc" href="https://docs.github.com/en/rest" rel="noopener ugc nofollow" target="_blank">GitHub REST API</a>并进行一些操作来对GitHub repo进行一些报告/度量。整个应用程序可在<a class="ae kc" href="https://github.com/dhmlau/loopback4-example-github" rel="noopener ugc nofollow" target="_blank">本报告</a>中找到。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/c255c13cfab9cece8174d49ceb6b9007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*cboYQ-xn2dbSCRvC55Jr9w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">应用概述</figcaption></figure><h1 id="740c" class="li lj iq bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">在这个博客中</h1><p id="6364" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在LoopBack应用程序中，涉及到几个组件——控制器、服务代理、数据源和连接器。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/7e9078f8f6cb05147422877a0d0dc11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7lKHf0rzxSspWj_TnbNlAg.png"/></div></div></figure><p id="88e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇博客中，我们将首先关注访问GitHub APIs。我们将创建一个连接到GitHub APIs的数据源，如下图所示。我将介绍一些配置数据源的细节。</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/34c717a3416aac838ea19a9c4c6c585a.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Ym7hwvTB2pBgOcG_Vd-2aw.png"/></div></figure><h1 id="fdb1" class="li lj iq bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">开始之前</h1><p id="62f8" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">使用<code class="fe mx my mz na b">lb4 app</code>命令搭建回送应用程序。我通常保留所有默认选项。</p><p id="0aa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nb">提示:只需运行</em> <code class="fe mx my mz na b"><em class="nb">lb app &lt;appName&gt; --yes</em></code> <em class="nb">即可。它会让你跳过所有的提示！</em></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="77c9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我们开始吧！</h1><p id="b798" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">使用<code class="fe mx my mz na b">lb4 datasource</code>命令创建一个数据源。按照下面的提示操作:</p><pre class="mm mn mo mp gt nc na nd ne aw nf bi"><span id="25bf" class="ng lj iq na b gy nh ni l nj nk">$ lb4 datasource<br/>? Datasource name: githubds<br/>? Select the connector for githubds: REST services (supported by StrongLoop)<br/>? Base URL for the REST service: <a class="ae kc" href="https://api.github.ibm.com" rel="noopener ugc nofollow" target="_blank">https://api.github.ibm.com</a><br/>? Default options for the request:<br/>? An array of operation templates:<br/>? Use default CRUD mapping: No<br/> create src/datasources/githubds.datasource.ts</span></pre><p id="da8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们仔细看看我们在提示中选择了什么。</p><ul class=""><li id="005d" class="nl nm iq kf b kg kh kk kl ko nn ks no kw np la nq nr ns nt bi translated"><strong class="kf ir">选择githubds的连接器</strong>:因为我们将调用一些GitHub REST APIs，所以选择<code class="fe mx my mz na b">REST services</code>。在幕后，这个数据源将使用<a class="ae kc" href="https://github.com/strongloop/loopback-connector-rest" rel="noopener ugc nofollow" target="_blank"> LoopBack REST连接器</a>来调用GitHub APIs。如果你想了解关于这个REST数据源配置的更多细节，你可以去<a class="ae kc" href="https://github.com/strongloop/loopback-connector-rest" rel="noopener ugc nofollow" target="_blank">https://github.com/strongloop/loopback-connector-rest</a>。</li><li id="5409" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated">REST服务的基本URL:我认为这是不言自明的。</li><li id="30c6" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><strong class="kf ir">请求的默认选项</strong>:这是关于你可以为请求设置的选项，例如表头信息。我更喜欢让它为空(通过按Enter键)，因为在。ts文件以后。</li><li id="f4fd" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><strong class="kf ir">一组操作模板:</strong>这是指您希望应用程序的其余部分调用的操作。再说一次，我更喜欢让它暂时空着。</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="1fcb" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">填写详细信息—选项</strong></h1><p id="065c" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">运行CLI命令后，数据源文件<code class="fe mx my mz na b">githubds.datasource.ts</code>中的<code class="fe mx my mz na b">config</code>应该类似于:</p><pre class="mm mn mo mp gt nc na nd ne aw nf bi"><span id="9fed" class="ng lj iq na b gy nh ni l nj nk">const config = {<br/>  name: 'githubds',<br/>  connector: 'rest',<br/>  baseURL: '<a class="ae kc" href="https://api.github.ibm.com'" rel="noopener ugc nofollow" target="_blank">https://api.github.ibm.com'</a>,<br/>  crud: false<br/>};</span></pre><p id="72be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将在之前跳过的<code class="fe mx my mz na b">options</code>属性中添加标题信息。在<code class="fe mx my mz na b">config</code>常量中添加以下代码片段。</p><pre class="mm mn mo mp gt nc na nd ne aw nf bi"><span id="b874" class="ng lj iq na b gy nh ni l nj nk">options: {<br/>    headers: {<br/>      accept: 'application/json',<br/>      Authorization: process.env.TOKEN,<br/>      'User-Agent': 'loopback4-example-github',<br/>      'X-RateLimit-Limit': 5000,<br/>      'content-type': 'application/json'<br/>    }<br/>  },</span></pre><p id="0f84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里需要注意一些事情:</p><ul class=""><li id="670d" class="nl nm iq kf b kg kh kk kl ko nn ks no kw np la nq nr ns nt bi translated"><code class="fe mx my mz na b">Authorization: process.env.TOKEN</code>:如果有密码、访问令牌等值，可以设置为环境变量。</li><li id="b096" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><code class="fe mx my mz na b">'User-Agent': 'loopback4-example-github'</code>:调用GitHub APIs时，这是必须的。</li></ul></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="4530" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">填写细节—操作</h1><p id="c9e5" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在<code class="fe mx my mz na b">operations</code>属性中，可以添加一组<code class="fe mx my mz na b">template</code>和<code class="fe mx my mz na b">functions</code>。<code class="fe mx my mz na b">template</code>定义API结构，而<code class="fe mx my mz na b">functions</code>定义应用程序的其余部分可以调用的TypeScript函数。</p><p id="1380" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将下面的片段添加到与我们刚刚创建的<code class="fe mx my mz na b">options</code>处于同一级别的<code class="fe mx my mz na b">config</code>常量中。</p><pre class="mm mn mo mp gt nc na nd ne aw nf bi"><span id="a251" class="ng lj iq na b gy nh ni l nj nk">operations: [<br/>    {<br/>      template: {<br/>        method: 'GET',<br/>        fullResponse: true,<br/>        url: '<a class="ae kc" href="https://api.github.com/search/issues?q=repo:{repo}+label:{label}'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/search/issues?q=repo:{repo}+label:"{label}"'</a><br/>      },<br/>      functions: {<br/>        getIssuesByLabel: ['repo','label']<br/>      }<br/>    }, {<br/>      template: {<br/>        method: 'GET',<br/>        fullResponse: true,<br/>        url: '{url}'<br/>      },<br/>      functions: {<br/>        getIssuesByURL: ['url']<br/>      }<br/>    }, {<br/>      template: {<br/>        method: 'GET',<br/>        fullResponse: true,<br/>        url: '<a class="ae kc" href="https://api.github.com/search/issues?q=repo:{repo}+{querystring}'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/search/issues?q=repo:{repo}+{querystring}'</a><br/>      },<br/>      functions: {<br/>        getIssuesWithQueryString: ['repo','querystring']<br/>      }<br/>    }<br/>  ]</span></pre><p id="c6ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，上面有3个功能:</p><ul class=""><li id="8d19" class="nl nm iq kf b kg kh kk kl ko nn ks no kw np la nq nr ns nt bi translated"><strong class="kf ir"> getIssuesByLabel </strong>:通过指定GH org+repo和一个标签来获取GitHub问题</li><li id="78a4" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated">getIssuesByURL :你可以在这里调用任何你想调用的东西。我们可能希望以后对它进行改进，但是为了节省一些工作，我们让它保持原样。稍后我将向您展示为什么我们要这样做(提示:分页！)</li><li id="bc88" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><strong class="kf ir">getissuesswithquerystring</strong>:通过指定GH org+repo和查询字符串获取GitHub问题。“查询字符串”可以是在<a class="ae kc" href="https://docs.github.com/en/rest/reference/search" rel="noopener ugc nofollow" target="_blank"> GitHub搜索API </a>中指定的任何内容。</li></ul><p id="de21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们仔细看看第一组，看看我们在这里要做什么:</p><pre class="mm mn mo mp gt nc na nd ne aw nf bi"><span id="56af" class="ng lj iq na b gy nh ni l nj nk">{<br/>      template: {<br/>        method: 'GET',<br/>        fullResponse: true,<br/>        url: '<a class="ae kc" href="https://api.github.com/search/issues?q=repo:{repo}+label:{label}'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/search/issues?q=repo:{repo}+label:{label}'</a><br/>      },<br/>      functions: {<br/>        getIssuesByLabel: ['repo','label']<br/>      }<br/>    }</span></pre><ul class=""><li id="d22c" class="nl nm iq kf b kg kh kk kl ko nn ks no kw np la nq nr ns nt bi translated"><code class="fe mx my mz na b">url</code>:<code class="fe mx my mz na b">{repo}</code>和<code class="fe mx my mz na b">{label}</code>代表url的参数。确保函数具有匹配的参数名。</li><li id="2918" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><code class="fe mx my mz na b">fullResponse</code>:我在这里将它设置为<code class="fe mx my mz na b">true</code>，因为我需要响应头来知道我是否需要为GitHub API检索其他页面的结果。根据API和您的使用情况，您可能只需要获得响应体。</li><li id="6773" class="nl nm iq kf b kg nu kk nv ko nw ks nx kw ny la nq nr ns nt bi translated"><code class="fe mx my mz na b">headers</code>:上面的片段里没有<code class="fe mx my mz na b">headers</code>。所有GitHub API调用都需要授权令牌和其他头信息。但既然已经有了顶层，这里就不需要赘述了。</li></ul><p id="de02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您要添加不使用相同url“模板”的其他功能，您可以在<code class="fe mx my mz na b">operations</code>下添加另一组。</p><p id="99b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还可以找到<code class="fe mx my mz na b">template</code>的其他属性以及更多细节:<a class="ae kc" href="https://github.com/strongloop/loopback-connector-rest#defining-a-custom-method-using-a-template" rel="noopener ugc nofollow" target="_blank">https://github . com/strong loop/loopback-connector-rest # defining-a-custom-method-using-a-template</a>。</p><h1 id="cca9" class="li lj iq bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">当它完成时…</h1><p id="0bed" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">最后，您的<code class="fe mx my mz na b">config</code>常量应该如下所示:</p><figure class="mm mn mo mp gt jr"><div class="bz fp l di"><div class="nz oa l"/></div></figure><h1 id="fc33" class="li lj iq bd lk ll mq ln lo lp mr lr ls lt ms lv lw lx mt lz ma mb mu md me mf bi translated">下一步是什么？</h1><p id="b366" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">在这篇博客中，我浏览了应用程序概述，并讨论了创建可以与GitHub APIs交互的数据源时的一些细节。接下来，我们将创建一个服务代理来公开这些功能。</p></div></div>    
</body>
</html>