<html>
<head>
<title>DevTools protocol in Selenium 4.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Selenium 4中的DevTools协议。</h1>
<blockquote>原文：<a href="https://itnext.io/devtools-protocol-in-selenium-4-6acf89ecb84d?source=collection_archive---------1-----------------------#2021-03-27">https://itnext.io/devtools-protocol-in-selenium-4-6acf89ecb84d?source=collection_archive---------1-----------------------#2021-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb4a43dd78917518d9607a00d96a5917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2oqCHASguH6jvbOtwPCFw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">塞缪尔·伯克的照片</figcaption></figure><p id="568a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最流行的UI自动化工具之一是Selenium Webdriver。在撰写本文时，第二个beta 4版本已经发布。</p><p id="7e8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该版本包括一个通过CDP (Chrome DevTools协议)使用DevTools的API，将与浏览器的交互提升到一个新的水平。</p><p id="8f4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">Chrome dev tools协议</strong>允许工具对Chrome、Chrome和其他基于Blink的浏览器进行检测、检查、调试和分析。许多现有项目目前使用该协议。Chrome DevTools使用这个协议，团队维护它的API。</p><p id="ba28" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DevTools工具包分为几个块(DOM、调试器、网络等。)，其中每一个都定义了支持的命令和生成的事件的列表。</p><p id="2603" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Selenium允许您直接与每个人一起工作，这使得:</p><ul class=""><li id="f632" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">使用浏览器缓存。</li><li id="5052" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">拦截和修改请求。</li><li id="8ebe" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">模拟网络状态。</li><li id="5370" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">设置地理位置。</li><li id="2e05" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">绕过安全限制。</li><li id="927b" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">读取浏览器指标。</li></ul><p id="f0b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">支持使用开发人员工具的驱动程序实现了<strong class="kf ir"> getDevTools () </strong>方法，您可以通过使用<strong class="kf ir"> DevTools </strong>对象直接执行CDP命令。</p><p id="885a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为每个命令块提供了包装类。要发送命令，只需创建一个会话并调用DevTools。发送(<strong class="kf ir">命令&lt; X &gt;命令</strong>)。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/b39312cab5d66fb06ec61849c9b228e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*b1fsVGML3xVdBNSocwgg-Q.png"/></div></figure><p id="75b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种方法是调用executeCdpCommand()方法，该方法由ChromiumDriver继承者实现，不使用包装器，而是使用原始命令。方法参数—操作的名称和参数列表。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/1ee5624f64ed647d4d0619f4ef007987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*gXDkgDhFWjy3oWRNZ10UHg.png"/></div></figure><p id="6c60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">新功能。</strong></p><ul class=""><li id="4b6a" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><strong class="kf ir">重新定义用户代理。</strong>在Selenium 4之前，在创建驱动程序对象之前，只能通过功能安装UserAgent。<br/> <strong class="kf ir">网络。setUserAgentOverride </strong>在运行时模式下设置新的UserAgent值。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/e9a17e7d8df6191da2a4a98d7f7084c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*ICTdW4qaVxs67scvpeDepA.png"/></div></figure><ul class=""><li id="3d30" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><strong class="kf ir">权利授予。</strong>对于某些操作，浏览器会请求用户的许可，例如，访问剪贴板或麦克风。您可以使用<strong class="kf ir"> Browser授予权限。通过向</strong>传递所需权限类型的列表来授予权限。例如，让我们允许浏览器捕获音频。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/c39f3a2699a7d5106cb15a3c871339fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*oBK104VS2A1m0oRuwmKTSA.png"/></div></figure><ul class=""><li id="4cb8" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated"><strong class="kf ir">给请求添加标题。</strong> <strong class="kf ir">网络。setExtraHTTPHeaders </strong>允许您为请求添加自定义头。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/942db68fdf579ca0636e2ba95157ea39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*HTUIWYJYHVDGFd3kHbnwNA.png"/></div></figure><ul class=""><li id="a0f2" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">请求的拦截和修改。<strong class="kf ir"> Fetch.enable </strong>使能拦截，每个请求都会停止，直到客户端调用failRequest、<strong class="kf ir">full request</strong>或<strong class="kf ir"> continue request </strong>。<br/>您可以拦截所有请求并根据条件修改它们，或者通过指定RequestPattern只处理目标请求，下面列出了两个选项。修改URL，例如，将/v1/users请求重定向到/v2/users后端的新版本。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/8f44d9a94998fb75da76e3e3c4f7dddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*ulI8XqXZrCrERuIqEkZzIQ.png"/></div></figure><p id="daf5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以类似的方式模拟失败的请求。例如，测试集成失败的应用程序的操作。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/87f46220ec33655ec921fdaa198a8dad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*axALpbUL607HgvWqBHW2Bg.png"/></div></figure><ul class=""><li id="53bf" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">互联网连接仿真。<strong class="kf ir">network . emulatenetworkconditions</strong>允许您设置连接参数，例如，测试3G信号弱或无网络时的行为。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/ffc842845f8c30909f7f7b401c5018c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*OIN90SgvA4DayE-ZB6wzzA.png"/></div></figure><ul class=""><li id="1c5a" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">清除缓存。<strong class="kf ir">network . clearbrowsercache</strong>清除浏览器缓存。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/dddfdfb1010b41a89b1b9ef859499eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*gmXAAsZJ7Jz-5bu78OOK0g.png"/></div></figure><ul class=""><li id="3fb9" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">阻止资源加载。使用<strong class="kf ir"> Network.setBlockedURLs </strong>，您可以通过模式限制资源加载。例如，阻止下载。挽救（saving的简写）</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/77656d05a2d5e510d2e36137809bcf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*wsAHwxInNv_Lj9mpEQ7jYA.png"/></div></figure><ul class=""><li id="fcb8" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">设置时区和地理位置。<strong class="kf ir">emulation . settimezoneoverride</strong>覆盖浏览器的时区，而<strong class="kf ir">emulation . setgeolocationoverride</strong>覆盖地理位置。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/0f7d41b01b8c6e2fe35125825d8a1c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*oPu-7mHpvTBYt5aKgQRB5A.png"/></div></figure><ul class=""><li id="47ba" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">绕过安全限制。<strong class="kf ir">security . setignorecertificateerrors</strong>将解决SSL证书的问题。我注意到，我并不呼吁采取这样的行动，而是展示机会的可用性。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/e406e34c1a3eeac8cf779be639402701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*9-her9lOmQf7cdvKym6dOg.png"/></div></figure><ul class=""><li id="53b7" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">度量标准。<strong class="kf ir"> Performance.enable </strong>支持收集指标(资源、文档、JSHeapUsedSize等。)，并且<strong class="kf ir"> Performance.getMetrics </strong>返回当前值。</li></ul><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/2097bbe308e6e18e48fae2c97b929888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*yrklHvzoCMZPExPrzGkpfQ.png"/></div></figure><h1 id="94b7" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">结论。</h1><p id="54e3" class="pw-post-body-paragraph kd ke iq kf b kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw mz ky kz la ij bi translated">本文只考察了使用DevTools编写自动化脚本的一些可能性，其用途仅限于想象和一系列命令。</p><p id="7292" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用于开发人员工具的API使得Selenium Webdriver更加强大，为设置、定制、仿真、流量拦截、事件跟踪和指标提供了可能性。</p><p id="8733" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DevTools功能将为您的测试增加灵活性。DevTools将使预处理变得更容易，报告和崩溃原因变得更有用。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/37405c6bd9906e7572c1b5d0f490ca04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*Lu3G8OVrxTr-BOSOHvP5Gw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://test-engineer.site/" rel="noopener ugc nofollow" target="_blank">https://test-engineer.site/</a></figcaption></figure><h1 id="c397" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">作者<a class="ae kc" href="https://www.linkedin.com/in/vaskocuturilo/" rel="noopener ugc nofollow" target="_blank">安东·斯米尔诺夫</a></h1></div></div>    
</body>
</html>