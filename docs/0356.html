<html>
<head>
<title>How to package your React Component for distribution via NPM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何打包React组件以便通过NPM分销</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-package-your-react-component-for-distribution-via-npm-d32d4bf71b4f?source=collection_archive---------0-----------------------#2018-02-26">https://itnext.io/how-to-package-your-react-component-for-distribution-via-npm-d32d4bf71b4f?source=collection_archive---------0-----------------------#2018-02-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/33ebd57f70328ebadae739f6909af91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bgw7iiA_Yss4WBdY."/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">"几个不同颜色的热气球飞上了古老的天空."由<a class="ae jd" href="https://unsplash.com/@sveninho?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯文·舍尔梅尔</a>上<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">的Unsplash </a></figcaption></figure><div class=""/><p id="6c47" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我编写了一个React组件，使用Babel进行传输，使用Webpack进行捆绑和构建。我想通过NPM在另一个应用程序中使用它。我的NPM发布包需要包括组件行为，风格和图像。那么，将我的React组件打包以便通过NPM销售有多难呢？一个小时左右的工作对吗？</p><p id="1597" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为下面的减速带，我花了很长时间才弄明白。<br/>–对版本冲突做出反应<br/>–如何从组件中捆绑和使用样式<br/>–如何包含和捆绑图像</p><p id="f2ef" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是步骤。</p><h1 id="02ee" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.使包NPM可发布</h1><p id="c869" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">npm init</code></p><p id="d6a3" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">package.json</code>中，确保填写了这些字段:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cb80" class="mq lc jg mh b gy mr ms l mt mu">package.json</span><span id="7d1d" class="mq lc jg mh b gy mv ms l mt mu">{<br/>    "name": "myUnflappableComponent",<br/>    "version": "0.0.29",<br/>    "main": "dist/index.js",<br/>    "publishConfig": {<br/>       "access": "restricted"<br/>    },<br/>    ...<br/>}</span></pre><h1 id="d0df" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.不要捆绑反应。使用父级的REACT和REACT-DOM。</h1><p id="db3d" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在<code class="fe me mf mg mh b">package.json</code>中，在项目的<code class="fe me mf mg mh b">peerDependencies</code>中添加<code class="fe me mf mg mh b">React</code>和<code class="fe me mf mg mh b">react-dom</code>(并从<code class="fe me mf mg mh b">dependencies</code>中移除，但添加到devDependencies进行开发)</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3ff0" class="mq lc jg mh b gy mr ms l mt mu">...</span><span id="cf09" class="mq lc jg mh b gy mv ms l mt mu">"peerDependencies": {      <br/>    "react": "&gt;=15.0.1",<br/>    "react-dom": "&gt;=15.0.1"<br/>},<br/> "devDependencies": {      <br/>    "react": "&gt;=15.0.1",      <br/>    "react-dom": "&gt;=15.0.1"  <br/>},  <br/>...</span></pre><p id="68cf" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在webpack配置中，创建一个UMD包</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c06b" class="mq lc jg mh b gy mr ms l mt mu">...<br/>module.exports = {  <br/>    ...  <br/>    output: {      <br/>        path: path.join(__dirname, './dist'),      <br/>        filename: 'myUnflappableComponent.js',      <br/>        library: libraryName,      <br/>        libraryTarget: 'umd',      <br/>        publicPath: '/dist/',      <br/>        umdNamedDefine: true  <br/>    },  <br/>    plugins: {...}, <br/>    module: {...},  <br/>    resolve: {...},  <br/>    externals: {...} <br/>}</span></pre><p id="a586" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最重要的是，不要捆绑反应</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="2b19" class="mq lc jg mh b gy mr ms l mt mu">module.exports = {  <br/>    output: {...},  <br/>    plugins: {...},  <br/>    module: {...},  <br/>    resolve: {      <br/>        alias: {          <br/>            'react': path.resolve(__dirname, './node_modules/react'),<br/>          'react-dom': path.resolve(__dirname, './node_modules/react-dom'),      <br/>        }  <br/>    },  <br/>    externals: {      <br/>        // Don't bundle react or react-dom      <br/>        react: {          <br/>            commonjs: "react",          <br/>            commonjs2: "react",          <br/>            amd: "React",          <br/>            root: "React"      <br/>        },      <br/>        "react-dom": {          <br/>            commonjs: "react-dom",          <br/>            commonjs2: "react-dom",          <br/>            amd: "ReactDOM",          <br/>            root: "ReactDOM"      <br/>        }  <br/>    } <br/>}</span></pre><h1 id="6f07" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.设置您的。NPMIGNORE文件</h1><p id="b2e6" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果你不设置一个. npmignore文件，npm使用你的<code class="fe me mf mg mh b">.gitignore</code>文件，不好的事情就会发生。允许空的<code class="fe me mf mg mh b">.npmignore</code>文件。这是我的样子:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="bcf9" class="mq lc jg mh b gy mr ms l mt mu">webpack.local.config.js<br/>    webpack.production.config.js<br/>    .eslintrc<br/>    .gitignore</span></pre><h1 id="8948" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">4.将“预发布”脚本添加到您的<code class="fe me mf mg mh b">PACKAGE.JSON</code></h1><p id="05ae" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">发布前生成。</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="afac" class="mq lc jg mh b gy mr ms l mt mu">"scripts": {<br/>     "prepublish": "rm -rf ./dist &amp;&amp; npm run build",<br/>    ...<br/>}</span></pre><h1 id="6dba" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">5.提取你的CSS文件以供使用</h1><p id="9c77" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们使用SCSS文件作为我们的风格。这些被编译成css，由Webpack提取出来。</p><p id="2a59" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装以下组件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f517" class="mq lc jg mh b gy mr ms l mt mu">npm install --save-dev extract-text-webpack-plugin node-sass style-loader css-loader sass-loader</span></pre><p id="fd9f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">更新你的<code class="fe me mf mg mh b">webpack.config</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7456" class="mq lc jg mh b gy mr ms l mt mu">const ExtractTextPlugin = require('extract-text-webpack-plugin');</span><span id="2667" class="mq lc jg mh b gy mv ms l mt mu">module.exports = {<br/>    ...<br/>    plugins:[<br/>        new ExtractTextPlugin({<br/>            filename: 'myUnflappableComponent.css',<br/>        }),<br/>    ],<br/>    module:{<br/>        rules:[<br/>            {<br/>                test: /\.*css$/,<br/>                use : ExtractTextPlugin.extract({<br/>                    fallback : 'style-loader',<br/>                    use : [<br/>                        'css-loader',<br/>                        'sass-loader'<br/>                    ]<br/>                })<br/>            },<br/>            ....<br/>        ]<br/>    }<br/>}</span></pre><h1 id="776b" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">6.CSS中的图像</h1><p id="bc8a" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">您在组件中包含图像的方式将决定您的组件的消费者是否会得到它们。</p><p id="ad97" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/CSS/content" rel="noopener ugc nofollow" target="_blank">内容属性</a>将它们包含在css文件中。例如</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="faf1" class="mq lc jg mh b gy mr ms l mt mu">.mySky{<br/>    width: 20px;<br/>    height: 20px;<br/>    content: url('../assets/images/thunderSky.png');<br/>}</span></pre><h1 id="5ac2" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">7.确保您的图像在组件外部可用</h1><p id="7e28" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我遇到的问题是发布的CSS文件中图像的相对路径被打乱了。经过大量的搜索，<a class="ae jd" href="https://shakacode.gitbooks.io/react-on-rails/content/docs/additional-reading/rails-assets-relative-paths.html" rel="noopener ugc nofollow" target="_blank">这篇文章</a>(也在下面的链接中)帮了大忙。</p><p id="6a15" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装以下组件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="39d0" class="mq lc jg mh b gy mr ms l mt mu">npm install --save-dev file-loader url-loader</span></pre><p id="ebb0" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">像这样更新你的<code class="fe me mf mg mh b">webpack.config</code>:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6964" class="mq lc jg mh b gy mr ms l mt mu">module.exports = {<br/>    ...<br/>    module: {<br/>        rules: [<br/>            {<br/>                test: /\.(png|svg|jpg|gif)$/,<br/>                use: [<br/>                    {<br/>                        loader: 'url-loader',<br/>                        options:{<br/>                            fallback: "file-loader",<br/>                            name: "[name][md5:hash].[ext]",<br/>                            outputPath: 'assets/',<br/>                            publicPath: '/assets/'<br/>                        }<br/>                    }<br/>                ]<br/>            },<br/>            ...<br/>            resolve: {<br/>                alias:{<br/>                    ...<br/>                    'assets': path.resolve(__dirname, 'assets')<br/>                }<br/>            }<br/>        ]<br/>    }<br/>}</span></pre><h1 id="18e6" class="lb lc jg bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">销售和推荐人:</h1><ol class=""><li id="cc6b" class="mw mx jg kf b kg lz kk ma ko my ks mz kw na la nb nc nd ne bi translated"><a class="ae jd" href="https://hackernoon.com/how-to-publish-your-package-on-npm-7fc1f5aae600" rel="noopener ugc nofollow" target="_blank">如何在npm上发布您的包(关于</a> <code class="fe me mf mg mh b"><a class="ae jd" href="https://hackernoon.com/how-to-publish-your-package-on-npm-7fc1f5aae600" rel="noopener ugc nofollow" target="_blank">package.json</a></code> <a class="ae jd" href="https://hackernoon.com/how-to-publish-your-package-on-npm-7fc1f5aae600" rel="noopener ugc nofollow" target="_blank"> ) </a></li><li id="bb9f" class="mw mx jg kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><a class="ae jd" href="https://maxisam.github.io/2017/03/29/publish-beta-to-npm/" rel="noopener ugc nofollow" target="_blank">向NPM发布测试版</a></li><li id="22c9" class="mw mx jg kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><a class="ae jd" href="https://shakacode.gitbooks.io/react-on-rails/content/docs/additional-reading/rails-assets-relative-paths.html" rel="noopener ugc nofollow" target="_blank">通过webpack导出图像(</a> <code class="fe me mf mg mh b"><a class="ae jd" href="https://shakacode.gitbooks.io/react-on-rails/content/docs/additional-reading/rails-assets-relative-paths.html" rel="noopener ugc nofollow" target="_blank">webpack.config.js</a></code> <a class="ae jd" href="https://shakacode.gitbooks.io/react-on-rails/content/docs/additional-reading/rails-assets-relative-paths.html" rel="noopener ugc nofollow" target="_blank"> ) </a></li><li id="b3a1" class="mw mx jg kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated">我的完整webpack配置:</li></ol><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7bd4" class="mq lc jg mh b gy mr ms l mt mu">const webpack = require('webpack');<br/>const ExtractTextPlugin = require('extract-text-webpack-plugin');<br/>const pkg = require('./package.json');<br/>const path = require('path');</span><span id="5eb6" class="mq lc jg mh b gy mv ms l mt mu">const libraryName= pkg.name;</span><span id="8f7b" class="mq lc jg mh b gy mv ms l mt mu">module.exports = {<br/>    entry: path.join(__dirname, "./src/index.js"),<br/>    output: {<br/>        path: path.join(__dirname, './dist'),<br/>        filename: 'myUnflappableComponent.js',<br/>        library: libraryName,<br/>        libraryTarget: 'umd',<br/>        publicPath: '/dist/',<br/>        umdNamedDefine: true<br/>    },<br/>    plugins: [<br/>        new ExtractTextPlugin({<br/>            filename: 'myUnflappableComponent.css',<br/>        }),<br/>    ],<br/>    node: {<br/>      net: 'empty',<br/>      tls: 'empty',<br/>      dns: 'empty'<br/>    },<br/>    module: {<br/>        rules : [<br/>            {<br/>            test: /\.(png|svg|jpg|gif)$/,<br/>            use: [<br/>                {<br/>                    loader: 'url-loader',<br/>                    options:{<br/>                        fallback: "file-loader",<br/>                        name: "[name][md5:hash].[ext]",<br/>                        outputPath: 'assets/',<br/>                        publicPath: '/assets/'<br/>                    }<br/>                }    <br/>            ]<br/>        },<br/>        {<br/>            test: /\.*css$/,<br/>            use : ExtractTextPlugin.extract({<br/>                fallback : 'style-loader',<br/>                use : [<br/>                    'css-loader',<br/>                    'sass-loader'<br/>                ]<br/>            })<br/>        },<br/>        {<br/>            test: /\.(js|jsx)$/,<br/>            use: ["babel-loader"],<br/>            include: path.resolve(__dirname, "src"),<br/>            exclude: /node_modules/,<br/>        },<br/>        {<br/>            test: /\.(eot|ttf|woff|woff2)$/,<br/>            use: ["file-loader"],<br/>        },<br/>        {<br/>            test: /\.(pdf|doc|zip)$/,<br/>            use: ["file-loader"],<br/>        }]<br/>    },<br/>    resolve: { <br/>        alias: { <br/>            'react': path.resolve(__dirname, './node_modules/react') ,<br/>            'react-dom': path.resolve(__dirname, './node_modules/react-dom'),<br/>            'assets': path.resolve(__dirname, 'assets')<br/>        } <br/>    },<br/>    externals: {<br/>        // Don't bundle react or react-dom<br/>        react: {<br/>            commonjs: "react",<br/>            commonjs2: "react",<br/>            amd: "React",<br/>            root: "React"<br/>        },<br/>        "react-dom": {<br/>            commonjs: "react-dom",<br/>            commonjs2: "react-dom",<br/>            amd: "ReactDOM",<br/>            root: "ReactDOM"<br/>        }<br/>    }<br/>};</span></pre></div></div>    
</body>
</html>