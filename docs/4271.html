<html>
<head>
<title>How to run HashiCorp Vault for $1 Month</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何运行1个月的哈希公司保险库</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-hashicorp-vault-for-1-month-71f3f87d01d8?source=collection_archive---------1-----------------------#2020-05-27">https://itnext.io/how-to-run-hashicorp-vault-for-1-month-71f3f87d01d8?source=collection_archive---------1-----------------------#2020-05-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="faeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近开始调查为一些个人项目跑<a class="ae kl" href="https://www.vaultproject.io/" rel="noopener ugc nofollow" target="_blank"> HashiCorp金库</a>。问题是；我很贱。我想在CI管道内部使用Vault进行秘密管理，所以典型的“我的笔记本电脑上的开发集群”不会工作得很好。我需要一个持续运行的实例，但不想为一天只有几次点击的东西付费。此外，我讨厌修补系统。我不擅长跟上它。解决方案:<a class="ae kl" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">谷歌云运行</a>。</p><p id="6d70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Google Cloud Run是什么？—“全面管理的计算平台，用于快速、安全地部署和扩展容器化应用”。基本上，我可以给GCP一个容器映像，他们给我一个完全安全的https端点，我“只在你的代码运行时付费，计费精确到100毫秒。”</p><p id="be5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这正是我所需要的。HashiCorp提供了<a class="ae kl" href="https://hub.docker.com/_/vault" rel="noopener ugc nofollow" target="_blank">容器映像</a>，我启动并运行了不到1个月(YMMV)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e48c53ea7ae57ca3fe52f475de34ef9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hu4I1XsVOmWdFFZY98Xdzg.png"/></div></div></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="f3aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要做一些事情来实现这个目标。</p><ul class=""><li id="ef67" class="lf lg iq jp b jq jr ju jv jy lh kc li kg lj kk lk ll lm ln bi translated"><a class="ae kl" href="https://cloud.google.com/storage/docs/creating-buckets" rel="noopener ugc nofollow" target="_blank"> Google存储桶</a> —用于持久数据。</li><li id="172e" class="lf lg iq jp b jq lo ju lp jy lq kc lr kg ls kk lk ll lm ln bi translated"><a class="ae kl" href="https://cloud.google.com/kms" rel="noopener ugc nofollow" target="_blank">谷歌KMS </a> —用于<a class="ae kl" href="https://learn.hashicorp.com/vault/operations/autounseal-gcp-kms" rel="noopener ugc nofollow" target="_blank">自动解封保险库</a>。</li></ul><p id="df80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我喜欢代码的一致性和基础设施，所以我去寻找一种方法，用<a class="ae kl" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>把这一切放在一起。我在GitHub 上发现了这个<a class="ae kl" href="https://github.com/mbrancato/terraform-google-vault" rel="noopener ugc nofollow" target="_blank">由</a><a class="ae kl" href="https://github.com/mbrancato" rel="noopener ugc nofollow" target="_blank"> Mike Brancato </a>完成的精彩项目。他将所有这些元素以一种快速的方式组合在一起，构建了一个完全自动扩展的Google Cloud Run实例，并使用KMS自动解封。</p><p id="ee43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个小警告——冷启动需要一点时间来开启保险库。我没有计时，但是非常快。但是，这将导致对Vault的第一次调用失败。我的解决方法是尽早调用<code class="fe lt lu lv lw b">vault status</code>来触发第一个容器，解封，并在管道的其余部分需要它时做好准备。这是一个非常可以接受的解决方法，因为我没有持续的流量。</p><p id="d547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对我如何将Vault添加到我的GitLab CI/CD管道感兴趣，请查看下面的视频。在那里，我使用按需JWT令牌进行身份验证，以存储和提取我的秘密到我的管道中。视频描述中的代码。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lx ly l"/></div></figure></div></div>    
</body>
</html>