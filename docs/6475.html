<html>
<head>
<title>Fine Control Over SpringBoot's Properties And Profiles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对SpringBoot属性和轮廓的精细控制</h1>
<blockquote>原文：<a href="https://itnext.io/fine-control-over-springboots-properties-and-profiles-25068bf25f1f?source=collection_archive---------1-----------------------#2021-11-28">https://itnext.io/fine-control-over-springboots-properties-and-profiles-25068bf25f1f?source=collection_archive---------1-----------------------#2021-11-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/58220e29b8ebfa91d26c40a1dffb64c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIBD-NEIdbC_hHyKzoDNkg.jpeg"/></div></div></figure><p id="f07e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SpringBoot为您提供了对应用程序属性的大量控制。使用概要文件，您可以轻松地切换这些属性，而无需接触您的代码。</p><p id="abeb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是有时我们希望对每个概要文件中的活动属性有更多的控制。</p><p id="ddfc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一个奇特的代码，其中您需要一个来自(外部)配置的属性，如下所示:</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="794b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简洁起见，我使用<code class="fe lc ld le lf b">@Value</code>。使用<code class="fe lc ld le lf b"><a class="ae lg" href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config.typesafe-configuration-properties" rel="noopener ugc nofollow" target="_blank">@ConfigurationProperties</a></code>是在应用程序内部使用外部属性的一种更安全的方式(感谢<a class="ae lg" href="https://medium.com/@matthenry87" rel="noopener"> @matthenry87 </a>指出这一点)。</p><p id="2d2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了给这个<code class="fe lc ld le lf b">property</code>提供一个值，您可以在您的<code class="fe lc ld le lf b">application.properties</code>文件中指定它，如下所示:</p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="c13e" class="ll lm iq lf b gy ln lo l lp lq"># application.properties</span><span id="4dd4" class="ll lm iq lf b gy lr lo l lp lq">property=default</span></pre><p id="bd59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你的代码打印出来<code class="fe lc ld le lf b">default</code>。🎉</p><p id="a70a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:有几种其他的方法来设置属性值，但是为了这篇文章，我总是使用一个. properties文件。</p><p id="9749" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过指定想要使用的配置文件来基于您的配置文件更改属性(这也可以通过几种方式来完成，但我将只在<code class="fe lc ld le lf b">application.properties</code>文件中指定它)。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="c6bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们使用一个具有不同值的<code class="fe lc ld le lf b">dev</code>配置文件:</p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="e77c" class="ll lm iq lf b gy ln lo l lp lq"># application.properties</span><span id="b46a" class="ll lm iq lf b gy lr lo l lp lq">property=default<br/>spring.profiles.active=dev</span></pre><p id="1f94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们为<code class="fe lc ld le lf b">dev</code>概要文件定义一个. properties文件:</p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="e66f" class="ll lm iq lf b gy ln lo l lp lq"># application-dev.properties</span><span id="dbf6" class="ll lm iq lf b gy lr lo l lp lq">property=dev</span></pre><p id="c4eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你的代码打印出来了<code class="fe lc ld le lf b">dev</code>。🎉🎉</p><p id="a100" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以创建几个配置文件，并为每个配置文件创建一个. properties文件。那对你有很大帮助。</p><p id="c338" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是想象一下，例如，您想在除一个之外的所有配置文件中设置一个属性。据我所知，没有办法只是取消一个属性。所以不能在你的默认中声明。属性，并在不需要的地方重写。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1b86" class="lz lm iq bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">多文档文件</h1><p id="3103" class="pw-post-body-paragraph jy jz iq ka b kb mw kd ke kf mx kh ki kj my kl km kn mz kp kq kr na kt ku kv ij bi translated">使用<a class="ae lg" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.external-config.files.multi-document" rel="noopener ugc nofollow" target="_blank">多文档文件</a>，您可以将. properties文件的内容分成几个逻辑部分。使用<a class="ae lg" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.external-config.files.activation-properties" rel="noopener ugc nofollow" target="_blank">激活属性</a>，您可以添加逻辑来启用/禁用每个部分。</p><p id="2107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以定义一个。像这样的属性文件:</p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="4fb0" class="ll lm iq lf b gy ln lo l lp lq"># application.properties</span><span id="4ab7" class="ll lm iq lf b gy lr lo l lp lq">property=default<br/>spring.profiles.active=unique<br/>#---<br/>spring.config.activate.on-profile=unique<br/>property=unique</span></pre><p id="fb6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，这是一个单独的<code class="fe lc ld le lf b">application.properties</code>文件。</p><p id="b611" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而现在你的花式代码打印<code class="fe lc ld le lf b">unique</code>。🎉🎉🎉</p><p id="b1d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你把你的<code class="fe lc ld le lf b">spring.profiles.active</code>改成<code class="fe lc ld le lf b">dev</code>，你的代码就会打印出<code class="fe lc ld le lf b">default</code>。🎉🎉🎉🎉</p><h2 id="e3ca" class="ll lm iq bd ma nb nc dn me nd ne dp mi kj nf ng mm kn nh ni mq kr nj nk mu nl bi translated">这里发生了什么事？</h2><p id="b504" class="pw-post-body-paragraph jy jz iq ka b kb mw kd ke kf mx kh ki kj my kl km kn mz kp kq kr na kt ku kv ij bi translated">那个<code class="fe lc ld le lf b">#---</code>真的<strong class="ka ir">重要吗</strong>。它表示这是一部分的结束和下一部分的开始。在每个部分的开始，你可以告诉哪个概要文件使用它(用<code class="fe lc ld le lf b">spring.config.activate.on</code>属性)。</p><p id="bc7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个简单的例子，但是你可以想象这个特性的威力。</p><p id="6de9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在你的<code class="fe lc ld le lf b">spring.config.activate.on-profile</code>财产上使用更多花哨的东西。</p><p id="7678" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想在几个配置文件中激活它，您可以这样定义它:</p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="4059" class="ll lm iq lf b gy ln lo l lp lq">spring.config.activate.on-profile=local | dev</span></pre><p id="ae59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您<strong class="ka ir">不想在特定的个人资料中激活它，您可以这样做:</strong></p><pre class="kw kx ky kz gt lh lf li lj aw lk bi"><span id="ea42" class="ll lm iq lf b gy ln lo l lp lq">spring.config.activate.on-profile=<strong class="lf ir">!</strong>unique</span></pre><p id="76f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">给你。现在你可以用你的属性做真正复杂的逻辑了！如果你应该做，那是另一回事。😈</p><p id="ca14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有几件事需要注意:</p><ul class=""><li id="db59" class="nm nn iq ka b kb kc kf kg kj no kn np kr nq kv nr ns nt nu bi translated">对于YAML文件，分隔符只是<code class="fe lc ld le lf b">---</code>。这是标准的YAML风格。</li><li id="2c66" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated">您<strong class="ka ir">不能</strong>在分隔符前后使用注释。</li><li id="565b" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated">始终避免部署包含不同概要文件配置的. properties文件。您可能会意外地启用或禁用一个概要文件，而您应用程序仍然可能会在带有错误概要文件的环境中意外地运行。您不希望您的生产环境使用开发数据库。(不，这种事从未发生在我身上。😐好的。确实发生过一次。😢)</li><li id="09c7" class="nm nn iq ka b kb nv kf nw kj nx kn ny kr nz kv nr ns nt nu bi translated">在代码中引入复杂和不寻常的语法之前，一定要彻底考虑你的问题。</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="dbf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在某些边缘情况下，这给了我很大的帮助。我希望它也能帮助你。了解你手中所有的武器总是好的。</p><h1 id="ef16" class="lz lm iq bd ma mb oa md me mf ob mh mi mj oc ml mm mn od mp mq mr oe mt mu mv bi translated">链接</h1><div class="of og gp gr oh oi"><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">Spring Boot参考文献</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">导入org . spring framework . boot . spring application；导入org . spring framework . boot . spring boot configuration；导入…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">docs.spring.io</p></div></div></div></a></div><div class="of og gp gr oh oi"><a href="https://spring.io/blog/2020/08/14/config-file-processing-in-spring-boot-2-4" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">Spring Boot 2.4中的配置文件处理</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">Spring Boot 2.4.0.M2刚刚发布，它带来了一些有趣的变化</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">spring.io</p></div></div><div class="or l"><div class="os l ot ou ov or ow jw oi"/></div></div></a></div></div></div>    
</body>
</html>