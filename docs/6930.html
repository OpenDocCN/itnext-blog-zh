<html>
<head>
<title>Provisioning Freeform Configuration via AWS AppConfig &amp; CloudFormation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过AWS AppConfig和CloudFormation提供自由配置</h1>
<blockquote>原文：<a href="https://itnext.io/provisioning-freeform-configuration-via-aws-appconfig-cloudformation-faed56b9e9f4?source=collection_archive---------0-----------------------#2022-04-16">https://itnext.io/provisioning-freeform-configuration-via-aws-appconfig-cloudformation-faed56b9e9f4?source=collection_archive---------0-----------------------#2022-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/29023dbc6873a04c3e655492f5f60545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3t-XfMuvMqhja9lUl1iPg.png"/></div></div></figure><p id="53ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自由形式配置是为运行时需要动态行为切换的应用程序定义<a class="ae kw" href="https://medium.com/@ac052790/an-introduction-to-feature-toggles-aws-appconfig-aa6351872fd6" rel="noopener">特性切换</a>的另一种方式。与显式特征标志定义相比，自由形式配置提供了一种更灵活、更具表现力的方式来定义流行文件格式中的配置，如<code class="fe kx ky kz la b">text/plain</code>、<code class="fe kx ky kz la b">application/json</code>、<code class="fe kx ky kz la b">text/yaml</code>，这使得开发运维工程师更容易定义配置。</p><p id="338e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将探索一种自动配置自由形式配置的方法，应用程序可以使用这种方法来动态切换机器学习例程。</p><p id="d5fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用CloudFormation作为表达AppConfig资源的媒介。请注意，CloudFormation只是自动提供AWS AppConfig资源的几种方法之一。我们将在本文中提供的任何资源也可以通过使用其他工具来提供，如Terraform、AWS CDK、AWS SDK、AWS CLI等。</p><h1 id="d641" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">目的计算机</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8b82df10d0b9f9e218b7da80d9aa518b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfstrXrNVBtVxVib7KbSCg.png"/></div></div></figure><p id="70c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本供应教程的最终目标是产生一个表示上图的配置支架。基本上，我们的目标是创建一个包含三种环境(dev、uat和prd)的AppConfig应用程序资源。每一个都有自己的自由形式的配置文件，其中将用于切换机器学习推理例程。</p><h1 id="17eb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">应用</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/0a57ff8a2e532924e542aec4f61832d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MfbRG6-s-SkvmChJzmwfcQ.png"/></div></div></figure><p id="e651" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS AppConfig应用程序是一种组织结构，它将几个相关的设置和环境组合在一起，这些设置和环境可以与一个有限的上下文、微服务或整个应用程序相关联。</p><h1 id="0a03" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">环境</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/293c14032d76ae87019e3e26a7b2f91c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJdWNRI-IkJB-AmJj90XMQ.png"/></div></div></figure><p id="fa5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在AWS AppConfig的上下文中，环境构造表示单个部署环境的相关配置的逻辑分组。在我们的项目中，我们将创建三个AppConfig环境，它们代表我们的业务应用程序的dev、uat和prd环境。它们都通过ApplicationId属性链接到父AppConfig应用程序。</p><h1 id="8efa" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">配置描述文件</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/043ed83f0d0cf92b6ae53067f4919e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t28zhQHuVggI3-YpRPiULw.png"/></div></div></figure><p id="a467" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置概要文件是AWS AppConfig用来标识配置数据位置的构造。在我们的例子中，我们通知AppConfig，我们的配置数据在AppConfig本身内部。</p><p id="9307" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，我们还有两个配置概要文件，分别代表ML推理功能的<code class="fe kx ky kz la b">enabled</code> &amp; <code class="fe kx ky kz la b">disabled</code>模式。</p><h1 id="37d4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">托管配置版本</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/a93c278f1806987cd1ae7616c2036eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*km9j49ETQcFHHuGcROrt4Q.png"/></div></div></figure><p id="c92a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">托管配置版本是用于定义AppConfig托管自由形式配置数据的构造。在我们的例子中，我们使用的是<code class="fe kx ky kz la b">application/json</code>格式，但是应该注意也可以使用<code class="fe kx ky kz la b">text/plain</code> &amp; <code class="fe kx ky kz la b">text/yaml</code>格式。</p><p id="9687" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自由形式配置的更高级变体可能包含更多元数据，如版本、类型、算法、超参数值等。</p><h1 id="4526" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">定制部署策略</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/02a13613bf5f8ec2641e73953b5ac15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_4YGb329ew2mcqLCh1DMA.png"/></div></div></figure><p id="ef36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署策略构造用于定义配置部署策略的属性，如类型、增长因素、总部署时间、烘烤时间。我们将创建一个定制的，立即传播自由形式的配置，而不使用烘焙时间，以保持事情更简单。</p><h1 id="6335" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">AppConfig部署</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/ea9404b5eecbaecff6a8c2f932936971.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYDzQH9LCxhhyciYeJjlcw.png"/></div></div></figure><p id="10be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的供应模板中包含的最后一个构造是AWS AppConfig部署<code class="fe kx ky kz la b">(AWS::AppConfig::Deployment)</code>。这个构造基本上缝合了我们模板中定义的先前资源(应用程序、环境、配置文件、配置版本和部署策略)。)这个构造负责调用发布到目标环境的配置。</p><h1 id="57e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">全云形成模板</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/105c0d1d303b606cedf1c51412fc512b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmISopyu3jyyoiadHlRhcQ.png"/></div></div></figure><p id="4e71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完整的CloudFormation模板可以在这个<a class="ae kw" href="https://github.com/allanchua101/aws-appconfig-freeform-cloudformation" rel="noopener ugc nofollow" target="_blank"> Github库</a>上找到，它包含了关于如何在自己的AWS帐户上部署CloudFormation堆栈的附加信息。</p><h1 id="fcc9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">部署云架构堆栈</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi md"><img src="../Images/16d07125dddd474539499228341cf1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FmBeIcS5MEzA0VC4KknIcg.png"/></div></div></figure><p id="f749" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了部署您的CloudFormation堆栈，请使用上面的shell脚本，并根据您的个人目标替换参数。</p><h1 id="c374" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">决赛成绩</h1><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/5ab5d016cb2580fc6364d8d0bebfa78c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKp0nvsyv1-fElR3wV61iQ.png"/></div></div></figure><p id="4f8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果，根据我们定义的CloudFormation模板创建了一个AWS AppConfig应用程序。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/7a1881069d63a135557232ccd5455b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PiWt_X1yk-Yx_R2BnbArzQ.png"/></div></div></figure><p id="fc83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该应用程序下还提供了三种环境。每一个都代表了我们每个测试环境的配置的逻辑分组。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/7928874c2af18fc58a39d921fac37fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wvNN8BZNQOT4vBIksFlZkA.png"/></div></div></figure><p id="2f10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有两种不同的配置文件用于切换消费应用程序的ML推理功能。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/6533d2efb1e91d0c90c410a34da6f28e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*wLsye8bppz435iagkOc4Mg.png"/></div></figure><p id="ae48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还设法在AWS提供的预配置策略的基础上创建了一个定制的部署策略。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/427ebab842593a51771c55423af1240c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wck4qUFiEpNzC_Ghi5gnkA.png"/></div></div></figure><p id="83b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最终结果是，我们的每个环境现在都支持通过自由配置进行功能切换。它可以在运行时改变我们的ML推理能力，而不需要额外的部署工作。</p><h1 id="212d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">对应用程序管理的影响</h1><p id="9470" class="pw-post-body-paragraph jy jz iq ka b kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">使用基于自由形式配置的功能切换，工程团队现在可以:</p><ul class=""><li id="b19f" class="mp mq iq ka b kb kc kf kg kj mr kn ms kr mt kv mu mv mw mx bi translated">在不中断现有应用流程的情况下，抢先部署机器学习功能。</li><li id="9f20" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">在运行时动态改变机器学习推理功能，而无需努力重构代码和运行另一组部署。</li><li id="fd9d" class="mp mq iq ka b kb my kf mz kj na kn nb kr nc kv mu mv mw mx bi translated">通过禁用损坏的模块，降低与应用程序停机或错误部署相关的风险。</li></ul><h1 id="212f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">下一步是什么</h1><p id="60e7" class="pw-post-body-paragraph jy jz iq ka b kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">既然我们有了一种自动提供自由形式的基于配置的特性切换的方法，我们就可以开始在NodeJS和Python环境中使用这种配置了。</p><h1 id="a042" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ca83" class="pw-post-body-paragraph jy jz iq ka b kb mk kd ke kf ml kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">使用CloudFormation，可以在AWS AppConfig上自动提供自由形式的配置。使用这种方法的动态特性切换使工程团队受益匪浅，这在以前是很难实现的，因为需要管理应用程序。</p></div></div>    
</body>
</html>