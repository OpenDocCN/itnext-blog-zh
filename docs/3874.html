<html>
<head>
<title>Azure Functions tip: making sense of GSON JsonSyntaxException</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure函数提示:理解GSON JsonSyntaxException</h1>
<blockquote>原文：<a href="https://itnext.io/azure-functions-tip-making-sense-of-gson-jsonsyntaxexception-45d7039338c9?source=collection_archive---------7-----------------------#2020-03-16">https://itnext.io/azure-functions-tip-making-sense-of-gson-jsonsyntaxexception-45d7039338c9?source=collection_archive---------7-----------------------#2020-03-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/be6d9eccd3f739cf2e9e8216780902e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sll2fYXkkP_IL9sm6dPWzA.png"/></div></div></figure><p id="337e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我正在使用<a class="ae kw" href="https://docs.microsoft.com/azure/event-hubs/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Event Hubs </a> trigger开发<a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure函数</a>，突然出现了这个错误:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="797d" class="lg lh iq lc b gy li lj l lk ll">Result: Failure<br/>Exception: IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $<br/>Stack: <strong class="lc ir">com.google.gson.JsonSyntaxException</strong>: java.lang.IllegalStateException: Expected BEGIN_OBJECT but was BEGIN_ARRAY at line 1 column 2 path $<br/>	at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:226)<br/>	at com.google.gson.Gson.fromJson(Gson.java:927)<br/>	at com.google.gson.Gson.fromJson(Gson.java:892)<br/>	at com.google.gson.Gson.fromJson(Gson.java:841)</span><span id="fda5" class="lg lh iq lc b gy lm lj l lk ll">.... //omitted for brevity</span></pre><h1 id="2bd0" class="ln lh iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">会出什么问题呢？</h1><h2 id="63f0" class="lg lh iq bd lo mk ml dn ls mm mn dp lw kj mo mp ma kn mq mr me kr ms mt mi mu bi translated"><strong class="ak">TL；博士</strong></h2><p id="54e8" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">当使用Azure函数的<a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">事件中心触发器时，请不要忘记使用正确的基数，如果你这样做了，希望你偶然看到这篇博文，如果你<code class="fe na nb nc lc b">Google it on Bing!</code>；-)</a></p><h2 id="7768" class="lg lh iq bd lo mk ml dn ls mm mn dp lw kj mo mp ma kn mq mr me kr ms mt mi mu bi translated">(稍微)长一点的版本…</h2><p id="ac96" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">这个错误对我来说是新的。经过进一步反省，我意识到这个问题与Azure Functions平台不能调用函数方法本身有关(也就是说，它与函数逻辑本身无关)</p><blockquote class="nd ne nf"><p id="bc24" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">顺便说一句，有很多特性可以让Azure函数的故障排除变得更容易</p><p id="82f6" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated"><a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-monitoring?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">内置监控</a>和<a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-monitor-log-analytics?tabs=csharp&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">日志分析</a></p><p id="7d8a" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated"><a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-diagnostics?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">诊断</a></p><p id="a244" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">使用VS代码进行远程调试<a class="ae kw" href="https://code.visualstudio.com/docs/java/" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="007f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Azure Functions使用<code class="fe na nb nc lc b"><a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-reference-java?WT.mc_id=medium-blog-abhishgu#pojos" rel="noopener ugc nofollow" target="_blank">gson</a></code> <a class="ae kw" href="https://docs.microsoft.com/azure/azure-functions/functions-reference-java?WT.mc_id=medium-blog-abhishgu#pojos" rel="noopener ugc nofollow" target="_blank">库来序列化/反序列化有效负载</a></p><p id="f5d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是该方法的一个片段:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="53ed" class="lg lh iq lc b gy li lj l lk ll">@FunctionName("processData")<br/>public void process(<br/>    @EventHubTrigger(name = "event", eventHubName = "", connection = "EventHubConnectionString") <br/>    Data data, final ExecutionContext context) {<br/>        //implementation<br/>    }</span></pre><p id="3f89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，它无法将Event Hubs有效负载转换为该方法所期望的<code class="fe na nb nc lc b">Data</code> POJO。</p><p id="5678" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我查看了Azure Functions Java API文档，以确认我是否正确地使用了<code class="fe na nb nc lc b"><a class="ae kw" href="https://docs.microsoft.com/java/api/com.microsoft.azure.functions.annotation.eventhubtrigger?view=azure-java-stable&amp;WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">@EventHubTrigger</a></code>。而我偶然发现了<code class="fe na nb nc lc b"><a class="ae kw" href="https://docs.microsoft.com/java/api/com.microsoft.azure.functions.annotation.eventhubtrigger.cardinality?view=azure-java-stable&amp;WT.mc_id=medium-blog-abhishgu#com_microsoft_azure_functions_annotation_EventHubTrigger_cardinality__" rel="noopener ugc nofollow" target="_blank">cardinality</a></code> <a class="ae kw" href="https://docs.microsoft.com/java/api/com.microsoft.azure.functions.annotation.eventhubtrigger.cardinality?view=azure-java-stable&amp;WT.mc_id=medium-blog-abhishgu#com_microsoft_azure_functions_annotation_EventHubTrigger_cardinality__" rel="noopener ugc nofollow" target="_blank">属性</a></p><p id="cd8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">定义如下:</p><blockquote class="nd ne nf"><p id="86b6" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">触发器输入的基数。如果输入是一条消息，请选择“一”；如果输入是一组消息，请选择“多”。如果未指定，则默认为“多”..它的默认值是<code class="fe na nb nc lc b">Cardinality.MANY</code></p></blockquote><p id="722d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">啊哈时刻！现在理解错误消息<code class="fe na nb nc lc b">Expected BEGIN_OBJECT but was BEGIN_ARRAY</code>并不太难——因为<code class="fe na nb nc lc b">Cardinality</code>，平台试图序列化一个<code class="fe na nb nc lc b">Data</code>POJO的列表/数组，但是方法只期望一个。显式包含<code class="fe na nb nc lc b">cardinality</code>(<code class="fe na nb nc lc b">Cardinality.ONE</code>)是解决方案，即</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d432" class="lg lh iq lc b gy li lj l lk ll">@EventHubTrigger(<br/>    name = "event", <br/>    eventHubName = "", <br/>    connection = "EventHubConnectionString",<br/>    <strong class="lc ir">cardinality = Cardinality.ONE</strong>)</span></pre><blockquote class="nd ne nf"><p id="b1b7" class="jy jz ng ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated"><em class="iq">另一种方法是将签名改为接受</em> <code class="fe na nb nc lc b"><em class="iq">List&lt;Data&gt;</em></code> <em class="iq">并选择列表中的第一项，例如</em> <code class="fe na nb nc lc b"><em class="iq">data.get(0)</em></code></p></blockquote><p id="d646" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前就这些。如果你觉得这很有帮助，展示一些:心:并继续关注更多🙌！</p></div></div>    
</body>
</html>