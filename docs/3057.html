<html>
<head>
<title>Auth with NodeJS, Express, Mongoose and JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJS、Express、Mongoose和JWT进行验证</h1>
<blockquote>原文：<a href="https://itnext.io/auth-with-nodejs-express-mongoose-and-jwt-577aa3f2f707?source=collection_archive---------1-----------------------#2019-09-24">https://itnext.io/auth-with-nodejs-express-mongoose-and-jwt-577aa3f2f707?source=collection_archive---------1-----------------------#2019-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e192" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据库的安全性是构建新项目时要考虑的最重要的因素之一。</p><p id="2503" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有几种方法可以实现可靠的<strong class="jp ir">认证</strong>系统。<br/>在这篇文章中，我将向你展示如何使用JWT，完全从零开始，不需要使用第三方服务。</p><h1 id="54a3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">我们将使用哪些技术？</h1><ul class=""><li id="f491" class="lj lk iq jp b jq ll ju lm jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir"> NodeJS </strong>:服务器端执行JavaScript代码的工具。</li><li id="1e3e" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir"> Express </strong>:让服务器开发更快的微框架。</li><li id="a9b0" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir">mongose</strong>:帮助我们连接到MongoDB实例的库。</li><li id="bd04" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir"> JWT </strong> (JSON Web Token):由服务器生成并由客户端存储的加密字符串。对于每个请求，该字符串将由客户端发送，并由服务器验证。</li><li id="1357" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir"> Bcrypt </strong>:我们将用来<a class="ae lz" href="https://www.quora.com/What-is-a-hashed-password" rel="noopener ugc nofollow" target="_blank">散列</a>我们的密码的库。</li><li id="a98b" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated"><strong class="jp ir"> BodyParser </strong>:将帮助我们在处理请求时检索主体参数。</li></ul><h1 id="84f9" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">设置我们的环境</h1><p id="4eaf" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">首先，一定要安装NodeJS。如果你还没有，看看这个链接。然后，创建一个新的MongoDB实例。你可以在这里免费创建一个<a class="ae lz" href="https://cloud.mongodb.com" rel="noopener ugc nofollow" target="_blank"/>。<br/>最后，通过命令行在我们的项目文件夹中安装NPM包。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5fc5" class="mm km iq mi b gy mn mo l mp mq">npm install express jsonwebtoken body-parser bcryptjs</span></pre><h1 id="8014" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">准备编码！</h1><p id="2006" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">现在，我们需要创建我们的服务器脚本:</p><ul class=""><li id="6ae4" class="lj lk iq jp b jq jr ju jv jy mr kc ms kg mt kk lq lr ls lt bi translated">app.js ，我们将在其中处理所有的服务器请求。</li><li id="9d03" class="lj lk iq jp b jq lu ju lv jy lw kc lx kg ly kk lq lr ls lt bi translated">db.js ，它将包含我们的数据库模型。</li></ul><p id="a7fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建一个非常简单的<strong class="jp ir"> Express </strong>应用程序:它将是我们应用程序的基本结构。</p><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/5832d998f3f2ca342e145dc097ba257a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5bKgTvhOBEZLpfMZtbRigw.png"/></div></div></figure><p id="1b41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“秘密JWT代码”是我们在生成令牌时将使用的加密密钥。</p><p id="c5ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在继续实现我们的端点之前，我们应该看一下<strong class="jp ir"> db.js </strong>文件。</p><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nc"><img src="../Images/2890c852fb4f3f55ebf149224a66b682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSSIZPURiS4yNuIPjQ9LYg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated"><strong class="bd kn"> db.js </strong></figcaption></figure><p id="1707" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个文件实际上创建了我们的DB模型模式。这意味着每个用户相关的数据将被保存在一个名为“用户”的文档(集合)下，并具有两个属性，“电子邮件”和“密码”。当然，你可以创建任意数量的<em class="nh">模型</em>，以及任意数量的<em class="nh">属性</em>。</p><p id="d78f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要实现我们的<strong class="jp ir">路由</strong>系统。该应用程序本质上将有两个端点，第一个用于注册<strong class="jp ir">的</strong>，第二个用于登录<strong class="jp ir"/>。</p><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ni"><img src="../Images/f0b8a2065570898a29754d09319b7f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sDzQtoNGIMCMHEo2flKVaw.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated"><strong class="bd kn"> app.js —报名</strong></figcaption></figure><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nj"><img src="../Images/c512ea555cd657e2c28e6d096e0ec091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9QzSOO1WQRcieTg4Y1xPg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated"><strong class="bd kn"> app.js —登录</strong></figcaption></figure><h1 id="5122" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">有用！</h1><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nk"><img src="../Images/8d60f71913b11f42e1ed4e392f8ea756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLjkykt-bTAFO3Y3gOyzSw.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">在呼叫我们的/user/signup端点之后，保存在我们的DB上的数据的屏幕截图</figcaption></figure><h1 id="f596" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">最后的步骤</h1><p id="b4dd" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">我们成功地实现了我们的认证系统。现在，客户端应该在登录后<strong class="jp ir">保存</strong>令牌，并且<strong class="jp ir">在每次发出新请求时将令牌发送回</strong>。</p><p id="9b53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住Json Web令牌有一个<strong class="jp ir">到期</strong>时间。有许多方法可以让用户保持登录状态。例如，每当发生这种情况，<strong class="jp ir">客户端</strong>可以<strong class="jp ir">刷新</strong>令牌，进行新的登录调用。</p><p id="5e99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">后端</strong>，您可以通过以下方式检查令牌是否<strong class="jp ir">有效</strong>:</p><figure class="md me mf mg gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nl"><img src="../Images/de25d9f4cbb54f20e0bb3c52b94da320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9MPFmKIULTPRsk3zNahHg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated"><strong class="bd kn"> app.js </strong></figcaption></figure><figure class="md me mf mg gt mv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/479c60205f599a9fdb4339b0d6f217a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*rJTj7rP0x1iZqwyYQiczNw.png"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated"><strong class="bd kn"> app.js </strong></figcaption></figure><p id="aa95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里找到Github要点<a class="ae lz" href="https://gist.github.com/lobellomatteo/8bd2840160c55b7739ef88af7389cbe6" rel="noopener ugc nofollow" target="_blank"/>！😊</p></div></div>    
</body>
</html>