<html>
<head>
<title>Deploying The VotingApp On Shipa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Shipa上部署VotingApp</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-the-votingapp-on-shipa-2af9c6097bb3?source=collection_archive---------3-----------------------#2021-04-19">https://itnext.io/deploying-the-votingapp-on-shipa-2af9c6097bb3?source=collection_archive---------3-----------------------#2021-04-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf58" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">专注于应用，忘记Kubernetes的内部</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/650a4755a98b6073bec998191de9c36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZk0Zee2kLp0fis1eoF_Hg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">琼·加梅尔在<a class="ae ky" href="https://unsplash.com/s/photos/application?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="7b53" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您是一名开发人员，您可能已经被要求在Kubernetes集群上部署您的应用程序。你可能已经意识到这不是一件容易的事情，尤其是如果你对Kubernetes了解不多的话。Kubernetes是一个庞然大物，知道如何定义(一路YAML)和操作它提供的基本资源(Pod、部署、服务、配置图、机密等)并不简单，更不用说更高级的资源(网络策略、RBAC相关资源等)。</p><p id="58c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天，Kubernetes无疑是运行容器化应用程序的首选解决方案。但是，作为开发者，大部分时候你不需要(也不想？)来了解它所有的内部细节。这就是创建Shipa的原因:让开发人员无需学习Kubernetes就可以轻松地在Kubernetes上部署应用程序。</p><p id="de7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将展示如何通过使用Shipa在Kubernetes中部署VotingApp的版本1，这是一个演示微服务应用程序。</p><p id="9471" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ℹ️如果你不知道VotingApp，请查看<a class="ae ky" href="https://lucjuggery.medium.com/the-votingapp-reloaded-e4f237b8f3bf" rel="noopener">这篇介绍该应用程序及其不同版本的短文</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1ece" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">关于Shipa</h1><p id="451b" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">Shipa被定义为“以开发者为中心的应用管理框架”。它抽象了底层云和Kubernetes基础设施，以便开发人员可以忘记集群和对象，而专注于应用程序部署。简而言之，Shipa旨在使开发人员在生产中无需了解Kubernetes就可以简单地在Kubernetes上运行他们的代码。</p><p id="a4fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Shipa引入了称为<strong class="lb iu">框架</strong>的登陆平台的概念，代表CI/CD管道(或从命令行手动推送的代码)交付应用程序代码的目的地。当代码到达Shipa时，这些框架跨多个Kubernetes集群创建必要的应用程序对象。它们还运行安全扫描、附加策略、管理资源限制、生成应用程序指标等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/f85f20691f9acc7a15ef647851761ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*30hvx0XiG2xRA_Ie"/></div></div></figure><p id="63b9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Shipa需要安装在Kubernetes集群上，目前支持以下集群:</p><ul class=""><li id="163f" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">内部</li><li id="8965" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">迷你库贝</li><li id="fe5d" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">GKE(谷歌Kubernetes引擎)</li><li id="906c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Azure Kubernetes服务</li><li id="07f4" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">EKS(亚马逊弹性Kubernetes服务)</li><li id="ac89" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Oracle Kubernetes引擎</li><li id="cd40" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">RKE(牧场主Kubernetes发动机)</li></ul><p id="3a44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们不会深入介绍配置集群的过程，也不会在集群上安装Shipa，因为已经有几篇文章详细介绍了这些不同的步骤。我们将假设我们可以访问配置了上述列表中的解决方案的集群，并在该集群上安装和配置了Shipa。</p><p id="77ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个<strong class="lb iu">平台</strong>是另一个Shipa概念，它被定义为“一个定义良好的包，为一种语言或框架安装了依赖关系”。每个微服务都需要在一个平台内运行，这个平台可以看作是一个包含应用程序运行时及其所有依赖项的环境(定义为Dockerfile)。Shipa已经预建了以下平台:</p><ul class=""><li id="bb09" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">去</li><li id="9a0c" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Java 语言(一种计算机语言，尤用于创建网站)</li><li id="bc0e" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">节点. js</li><li id="2ee4" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">服务器端编程语言（Professional Hypertext Preprocessor的缩写）</li><li id="adde" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">计算机编程语言</li><li id="aa1b" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">红宝石</li><li id="d37a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">静态</li><li id="e05a" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">。网</li></ul><p id="1824" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:Shipa还允许创建额外的平台。例如，如果预构建平台中提供的运行时版本与“旧”应用程序所需的版本不匹配，则可能需要这样做。</p><p id="787f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在接下来的部分，我们将展示如何直接使用各个微服务的源代码在Shipa上部署投票App。它们中的每一个都将被视为Shipa中的一个<strong class="lb iu">应用</strong>，并将运行在一个<strong class="lb iu">平台</strong>之上。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="5554" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">投票应用的部署</h1><p id="48c6" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">假设您是VotingApp的开发人员，现在还负责在Kubernetes集群上部署该应用的所有微服务。但是(有一个但是)你不知道Kubernetes是如何工作的，现在肯定没有时间去学习它。</p><p id="a33e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你真的很幸运，因为:</p><ul class=""><li id="3b98" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">Kubernetes管理员已经在集群上安装了Shipa，所以您根本不需要学习Kubernetes，因为Shipa会为您处理所有的部署工作</li><li id="a458" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">数据库管理员已经在集群中部署了一个Redis和一个Postgres实例(通过Kubernetes部署和它们各自的服务)，因此您不必管理应用程序不依赖的那些组件</li><li id="f342" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">Shipa管理员将您添加到shipa-admin-team中(在真实的生产环境中，您可能会被添加到开发团队专用的组中)</li></ul><p id="0aa8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于每个微服务，您需要遵循以下步骤:</p><ul class=""><li id="0dce" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">启用包含应用程序所需运行时的平台(与开发微服务所用的语言相关)</li><li id="f7a6" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">向Shipa提供一些信息，以便它知道如何构建这段代码(以防您使用的结构不那么通用)</li><li id="e369" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">提供Shipa运行应用程序所需的命令</li><li id="3702" class="na nb it lb b lc nj lf nk li nl lm nm lq nn lu nf ng nh ni bi translated">发送代码，让Shipa为您管理部署</li></ul><p id="e858" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">听起来很简单，对吗？实际上，你会发现事情就是这么简单！</p><p id="8132" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:您将使用Shipa CLI客户机手动部署整个应用程序，以便了解整个过程。在现实世界中，您可能需要自动化CI/CD管道中的一切(这可能是未来文章的主题)。</p><p id="fb92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先要做的是使用命令行登录，提供管理员给你的凭证。</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2609" class="nt md it np b gy nu nv l nw nx">$ shipa login</span></pre><p id="74f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">登录后，您就可以使用Shipa CLI部署您已经开发了很久的VotingApp了。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="bd66" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">投票微服务</h1><p id="4c1d" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">首先，你会考虑投票微服务。这个是用Python开发的(顺便说一下，这是个不错的选择)，所以第一步是在Shipa中启用Python <strong class="lb iu">平台</strong>。</p><p id="a486" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:这个微服务的代码可以在库【https://gitlab.com/voting-application/vote.git<a class="ae ky" href="https://gitlab.com/voting-application/vote.git" rel="noopener ugc nofollow" target="_blank">的<strong class="lb iu"> v1 </strong>分支中找到</a></p><p id="cc11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下命令为python应用程序创建平台:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e1c8" class="nt md it np b gy nu nv l nw nx">$ shipa platform add python<br/>Platform successfully added!</span></pre><p id="2304" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，在python平台中创建一个投票应用程序:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="c905" class="nt md it np b gy nu nv l nw nx">$ shipa app create vote python -t shipa-admin-team<br/>App “vote” has been created!<br/>Use app-info to check the status of the app and its units.</span></pre><p id="2125" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在将应用程序代码推送到Shipa之前，您需要提供一些附加信息，以便Shipa知道如何按照您需要的方式运行应用程序。这些信息可以通过Procfile提供。</p><p id="7582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在投票微服务的根文件夹中添加一个名为<strong class="lb iu"> Procfile </strong>的文件，其内容如下:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="15ed" class="nt md it np b gy nu nv l nw nx">web: gunicorn app:app -b 0.0.0.0:$PORT --log-file —-access-logfile —-workers 4 --keep-alive 0</span></pre><p id="1301" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:<strong class="lb iu"> web </strong>关键字在这里很重要，因为它确保Shipa创建一个端点来向外界公开应用程序</p><p id="aee3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，使用以下命令在<em class="ny"> vote </em>文件夹中部署代码:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="dc9e" class="nt md it np b gy nu nv l nw nx">$ shipa app deploy -a vote -f .</span></pre><p id="4bbd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在幕后，Shipa使用这个Python应用程序的requirement.txt来安装所需的依赖项。然后，它使用Procfile中定义的命令运行应用程序。部署应用程序只需要几十秒钟。</p><p id="7336" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:Shipa还允许立即部署Docker映像，而不是应用程序的代码。投票应用程序可在<a class="ae ky" href="http://registry.gitlab.com/voting-application/vote:v1" rel="noopener ugc nofollow" target="_blank">registry.gitlab.com/voting-application/vote:v1</a>使用以下命令可以轻松部署图像:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="4807" class="nt md it np b gy nu nv l nw nx">$ shipa app deploy -a vote \<br/>  -i registry.gitlab.com/voting-application/vote:v1</span></pre><p id="50c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您运行<em class="ny"> shipa app-list </em>，您将获得投票应用程序可用的URL，在本例中，该URL为<a class="ae ky" href="http://vote.51.159.113.19.shipa.cloud" rel="noopener ugc nofollow" target="_blank">http://vote . 51 . 159 . 113 . 19 . shipa . cloud</a>。然后，您将能够访问<em class="ny">投票</em>仪表盘并选择一个项目:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/c7b6482ebe78f6af98e54680778b8a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7mTue5viaCfESt0P"/></div></div></figure><p id="ae33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:因为Redis已经部署在集群中，所以投票微服务使用它来持久化投票</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9dc5" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结果微服务</h1><p id="c363" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如您对投票微服务所做的那样，您首先需要为这个使用Node.Js开发的应用程序启用一个<strong class="lb iu">平台</strong>。</p><p id="f24e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:这个微服务的代码可以在库【https://gitlab.com/voting-application/result.git<a class="ae ky" href="https://gitlab.com/voting-application/result.git" rel="noopener ugc nofollow" target="_blank">的<strong class="lb iu"> v1 </strong>分支中找到</a></p><p id="81f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用以下命令为python应用程序创建平台:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="c38a" class="nt md it np b gy nu nv l nw nx">$ shipa platform add nodejs<br/>Platform successfully added!</span></pre><p id="2f70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您创建将部署在这个新平台上的<strong class="lb iu">应用程序</strong></p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="5899" class="nt md it np b gy nu nv l nw nx">$ shipa app create result nodejs -t shipa-admin-team<br/>App “result” has been created!<br/>Use app-info to check the status of the app and its units.</span></pre><p id="2288" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在推送应用程序代码之前，您需要添加一个<strong class="lb iu"> Procfile </strong>，它指示运行应用程序的命令和需要创建的端点，以便向外部世界公开接口。不需要提供如何构建应用程序的信息，因为Shipa已经知道它需要从一个<em class="ny"> package.json </em>文件安装所有的应用程序依赖项。</p><p id="361c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个Procfile需要添加到结果微服务的根文件夹中，它包含以下指令:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2292" class="nt md it np b gy nu nv l nw nx">web: node server.js</span></pre><p id="86c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您可以在<em class="ny">结果</em>文件夹中部署运行以下命令的代码:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="3008" class="nt md it np b gy nu nv l nw nx">$ shipa app deploy -a result -f .</span></pre><p id="84cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在幕后，Shipa使用这个Node.js应用程序的<em class="ny"> package.json </em>文件来安装所需的依赖项。然后，它使用Procfile中定义的命令运行应用程序。部署应用程序只需要几十秒钟。</p><p id="727e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用<em class="ny"> shipa app-list </em>命令，您将获得结果应用程序可用的URL，在本例中，URL为<a class="ae ky" href="http://result.51.159.113.19.shipa.cloud" rel="noopener ugc nofollow" target="_blank">http://result . 51 . 159 . 113 . 19 . shipa . cloud</a>。然后您将能够访问<em class="ny">结果</em>仪表板:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/0a163bc9b7704bffb9c3c2ff0662e58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zWcU4PzqkihiGKH5"/></div></div></figure><p id="5477" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:由于当前没有部署worker，投票不会在投票应用程序和结果应用程序之间传播。为了使整个流可用，您还需要部署worker应用程序。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="8e70" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">工人微服务</h1><p id="2357" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">工人在发展。Net和Java，下面我们将展示如何依次部署每个版本。</p><p id="e86d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:这个微服务的代码可以在https://gitlab.com/voting-application/worker.git的资源库中找到</p><h2 id="bb31" class="nt md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">工人进来了。网</h2><p id="7a58" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">就像你之前做的几次一样，你首先需要创建一个<strong class="lb iu">平台</strong>来处理。NET应用程序。</p><p id="095a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个有趣的事情:默认预建。NET平台基于版本5.0.4，但是由于VotingApp相当旧，它不能在那个版本上工作，需要dotnet 3.1来代替。这不成问题，因为也可以在Shipa中添加特定的平台(在预构建的平台之上)。</p><p id="85bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢Shipa团队专门为这个演示创建了一个. NET 3.1平台，这个新平台打包在<a class="ae ky" href="https://hub.docker.com/r/shipasoftware/dotnet-3.1" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>中的<em class="ny">Shipa software/dot NET-3.1:v 1.2</em>容器映像中。</p><p id="30e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下命令启用。NET 3.1平台:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e867" class="nt md it np b gy nu nv l nw nx">$ shipa platform add dotnet-31 \<br/>  -i docker.io/shipasoftware/dotnet-3.1:v1.2</span><span id="465f" class="nt md it np b gy ok nv l nw nx">Platform successfully added!</span></pre><p id="f721" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您创建将与该平台一起部署的<strong class="lb iu">应用程序</strong>:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="8400" class="nt md it np b gy nu nv l nw nx">$ shipa app create worker-dotnet dotnet-31 -t shipa-admin-team<br/>App “worker-dotnet” has been created!<br/>Use app-info to check the status of the app and its units.</span></pre><p id="b4ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您需要提供一些附加信息来告诉Shipa如何构建和运行这个新的应用程序。这是通过两个附加文件完成的:</p><ul class=""><li id="7f16" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">yml:它告诉shipa需要如何构建应用程序。对于没有通用结构的应用程序，Shipa不可能知道默认情况下如何处理应用程序源代码。该步骤中使用的shipa.yml文件定义了。NET app需要搭建:</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="506d" class="nt md it np b gy nu nv l nw nx">hooks:<br/>  build:<br/>  - dotnet restore<br/>  - dotnet publish -c Release -o out Worker.csproj</span></pre><ul class=""><li id="1ae4" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">Procfile定义了运行。NET版的worker</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2e6f" class="nt md it np b gy nu nv l nw nx">worker: dotnet out/Worker.dll</span></pre><p id="89ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将这两个额外的文件添加到存储库中后，您就可以使用从<em class="ny"> worker </em>文件夹运行的以下命令来部署代码了:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="e005" class="nt md it np b gy nu nv l nw nx">$ shipa app deploy -a worker-dotnet -f ./dotnet</span></pre><p id="4bc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:也可以直接部署容器映像，而不是代码。</p><p id="826b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经部署了投票、结果和工作者微服务，就可以从投票界面投票并查看结果了。</p><div class="kj kk kl km gt ab cb"><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/f69cb553da65a6e7cf2040d69b276519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*o-DvddgwU0i4_076"/></div></figure><figure class="ol kn om on oo op oq paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><img src="../Images/c0232d938e313bc8f03230c40a5f9d00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*kvfMfVWZFNkjmJdd"/></div></figure></div><p id="50b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一步中，我们将展示如何部署Java版本的worker，而不是。网一。</p><h2 id="75f4" class="nt md it bd me nz oa dn mi ob oc dp mm li od oe mo lm of og mq lq oh oi ms oj bi translated">Java中的工人</h2><p id="5337" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">正如您对其他微服务所做的那样，您首先需要为这个java应用程序启用一个<strong class="lb iu">平台</strong>:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2eec" class="nt md it np b gy nu nv l nw nx">$ shipa platform add java</span></pre><p id="c559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后创建一个将使用该平台的应用程序<strong class="lb iu"/></p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="1f77" class="nt md it np b gy nu nv l nw nx">$ shipa app create worker-java java -t shipa-admin-team</span></pre><p id="ff76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就像你所做的一样。NET版本，在部署应用程序代码之前，您需要使用两个附加文件向Shipa提供信息:</p><ul class=""><li id="16ea" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">yml:它定义了如何调用maven来编译工作者的Java代码</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="2602" class="nt md it np b gy nu nv l nw nx">hooks:<br/>  build:<br/>    - mvn dependency:resolve &amp;&amp; mvn verify &amp;&amp; mvn package</span></pre><ul class=""><li id="37e3" class="na nb it lb b lc ld lf lg li nc lm nd lq ne lu nf ng nh ni bi translated">Procfile:它告诉Shipa需要调用哪个命令来运行应用程序</li></ul><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="f766" class="nt md it np b gy nu nv l nw nx">worker: java ./target/worker-jar-with-dependencies.jar</span></pre><p id="210a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建了这两个附加文件后，您可以在<em class="ny"> worker </em>文件夹中部署运行以下命令的代码</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="31b1" class="nt md it np b gy nu nv l nw nx">$ shipa app deploy -a worker-java -f ./java</span></pre><p id="3289" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">既然已经部署了投票、结果和工作人员微服务，就可以从投票界面投票并查看结果，就像我们为。网络版。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3910" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">删除应用程序</h1><p id="b117" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">为了从Shipa中删除VotingApp，您需要使用以下命令删除每个应用程序:</p><pre class="kj kk kl km gt no np nq nr aw ns bi"><span id="1499" class="nt md it np b gy nu nv l nw nx">$ shipa app remove -a vote</span><span id="ad18" class="nt md it np b gy ok nv l nw nx">$ shipa app remove -a result</span><span id="6844" class="nt md it np b gy ok nv l nw nx">$ shipa app remove -a worker</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6122" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">关键外卖</h1><p id="08eb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">着眼于开发人员方面，我们通过Shipa展示了一个示例微服务应用程序在Kubernetes集群上的部署。我们给出了需要提供给Shipa(通过Procfile和/或shipa.yaml文件)的额外信息/元数据的示例，以便它知道如何构建和运行每个微服务，而无需更改代码。</p><p id="5af4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个开发人员不必关心幕后发生了什么，他/她只需要推送代码，让Shipa处理所有其他的事情。平台管理员负责通过Shipa配置每个应用程序，提供附加配置，定义图像扫描、网络策略等</p><p id="75dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们使用Shipa CLI来部署代码，这很方便，有助于理解核心组件，但这是一个手动过程。由于GitLab用于管理VotingApp的代码并定义每个微服务的持续集成(CI)管道，下一步将是让该管道负责在自动化持续部署(CD)步骤中将应用程序发送到Shipa。这可能是另一篇文章的目的。</p></div></div>    
</body>
</html>