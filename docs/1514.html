<html>
<head>
<title>React global state by Context API for TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过TypeScript的上下文API反应全局状态</h1>
<blockquote>原文：<a href="https://itnext.io/react-global-state-by-context-api-for-typescript-eaf9f4cf1381?source=collection_archive---------2-----------------------#2018-11-08">https://itnext.io/react-global-state-by-context-api-for-typescript-eaf9f4cf1381?source=collection_archive---------2-----------------------#2018-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="32e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个微型库，帮助在React中存储JavaScript和TypeScript的全局状态。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a8b31cae0635d45724270d9324f682e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvo23DAnKA0HDvlMFUHMtQ.png"/></div></div></figure><p id="1722" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="la">注意:本帖与React Hooks API无关。</em></p><p id="7001" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我之前的文章中，我介绍了一个名为react-context-global-state的库。过了一段时间，我对打字稿有了更好的了解(是的，我是初学者！)，并提出相当好的类型定义。我刚刚发布了一个新版本。</p><div class="lc ld gp gr le lf"><a href="https://www.npmjs.com/package/react-context-global-state" rel="noopener  ugc nofollow" target="_blank"><div class="lg ab fo"><div class="lh ab li cl cj lj"><h2 class="bd iu gy z fp lk fr fs ll fu fw is bi translated">反应-上下文-全局-状态</h2><div class="lm l"><h3 class="bd b gy z fp lk fr fs ll fu fw dk translated">上下文API反应的简单全局状态</h3></div><div class="ln l"><p class="bd b dl z fp lk fr fs ll fu fw dk translated">www.npmjs.com</p></div></div><div class="lo l"><div class="lp l lq lr ls lo lt ky lf"/></div></div></a></div><h2 id="918f" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">TypeScript中的示例代码</h2><p id="d492" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">让我简要地展示一下代码在TypeScript中的样子。</p><p id="ba90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在一个名为state.ts的文件中，我们定义了一个全局状态并导出函数组件。<code class="fe ms mt mu mv b">State</code>类型也被导出。</p><pre class="kp kq kr ks gt mw mv mx my aw mz bi"><span id="2db9" class="lu lv it mv b gy na nb l nc nd">import { createGlobalState } from 'react-context-global-state';<br/><br/>const initialState = {<br/>  counter1: 0,<br/>  person: {<br/>    age: 0,<br/>    firstName: '',<br/>    lastName: '',<br/>  },<br/>};<br/><br/>export type State = typeof initialState;<br/><br/>export const { StateProvider, StateConsumer } = createGlobalState(initialState);</span></pre><p id="ad1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在App.tsx中，我们使用上下文提供状态。</p><pre class="kp kq kr ks gt mw mv mx my aw mz bi"><span id="899a" class="lu lv it mv b gy na nb l nc nd">import * as React from 'react';<br/><br/>import { StateProvider } from './state';<br/><br/>import Counter from './Counter';<br/><br/>const App = () =&gt; (<br/>  &lt;StateProvider&gt;<br/>    &lt;h1&gt;Counter&lt;/h1&gt;<br/>    &lt;Counter /&gt;<br/>    &lt;Counter /&gt;<br/>  &lt;/StateProvider&gt;<br/>);<br/><br/>export default App;</span></pre><p id="8611" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Counter.tsx中，我们通过指定名称来使用状态的一部分。</p><pre class="kp kq kr ks gt mw mv mx my aw mz bi"><span id="bda4" class="lu lv it mv b gy na nb l nc nd">import * as React from 'react';<br/><br/>import { StateConsumerType } from 'react-context-global-state';<br/><br/>import { State, StateConsumer } from './state';<br/><br/>const Counter1StateConsumer = StateConsumer as StateConsumerType&lt;State, 'counter1'&gt;;<br/><br/>const Counter = () =&gt; (<br/>  &lt;Counter1StateConsumer name="counter1"&gt;<br/>    {(value, update) =&gt; (<br/>      &lt;div&gt;<br/>        &lt;span&gt;<br/>          Count:<br/>          {value}<br/>        &lt;/span&gt;<br/>        &lt;button type="button" onClick={() =&gt; update(v =&gt; v + 1)}&gt;+1&lt;/button&gt;<br/>        &lt;button type="button" onClick={() =&gt; update(v =&gt; v - 1)}&gt;-1&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )}<br/>  &lt;/Counter1StateConsumer&gt;<br/>);<br/><br/>export default Counter;</span></pre><p id="d81f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意上面是如何定义<code class="fe ms mt mu mv b">Counter1StateConsumer</code>的。我不太确定这是不是打字稿中最好的方式。或许，如果它能被<code class="fe ms mt mu mv b">name="counter1"</code>道具所约束就更理想了。</p><p id="9b26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">资源库中提供了完整的示例代码。</p><div class="lc ld gp gr le lf"><a href="https://github.com/dai-shi/react-context-global-state/tree/master/examples/02_typescript" rel="noopener  ugc nofollow" target="_blank"><div class="lg ab fo"><div class="lh ab li cl cj lj"><h2 class="bd iu gy z fp lk fr fs ll fu fw is bi translated">代时/反应-语境-全局-状态</h2><div class="lm l"><h3 class="bd b gy z fp lk fr fs ll fu fw dk translated">上下文API反应的简单全局状态。通过创造……为Dai-Shi/react-context-global-state的发展做出贡献</h3></div><div class="ln l"><p class="bd b dl z fp lk fr fs ll fu fw dk translated">github.com</p></div></div><div class="lo l"><div class="ne l lq lr ls lo lt ky lf"/></div></div></a></div><p id="d635" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并且，您可以像下面这样运行它，并在浏览器中打开<a class="ae lb" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>来查看它的工作情况。</p><pre class="kp kq kr ks gt mw mv mx my aw mz bi"><span id="d571" class="lu lv it mv b gy na nb l nc nd">git glone <a class="ae lb" href="https://github.com/dai-shi/react-context-global-state.git" rel="noopener ugc nofollow" target="_blank">https://github.com/dai-shi/react-context-global-state.git</a><br/>npm install<br/>npm run examples:typescript</span></pre><h2 id="fb2f" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">一些想法</h2><p id="b794" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">虽然全局状态很方便，但最好不要过度使用它。它本质上是一个全局变量，通常应该避免使用。在React中，我们应该首先考虑使用本地状态，并在组件树中传递它。如果树中相距很远的两个组件需要共享一个值，那么全局状态肯定是有用的。在这种情况下，上下文API可能非常合适。这个库是为相当小的应用程序设计的，在这些应用程序中使用Redux或类似的东西需要太多的工作。</p></div></div>    
</body>
</html>