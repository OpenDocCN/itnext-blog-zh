<html>
<head>
<title>Simple Firebase/Redux Integration in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native中简单的Firebase/Redux集成</h1>
<blockquote>原文：<a href="https://itnext.io/simple-firebase-redux-integration-in-react-native-32f848deff3a?source=collection_archive---------1-----------------------#2018-03-14">https://itnext.io/simple-firebase-redux-integration-in-react-native-32f848deff3a?source=collection_archive---------1-----------------------#2018-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7d6cadab144da06d53b471edc64339c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVzwGLvNK8Il14IP7ACUYw.jpeg"/></div></div></figure><p id="8994" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fsimple-firebase-redux-integration-in-react-native-32f848deff3a" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="951f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将学习如何将Redux添加到React本机应用程序中，以及如何将其与Firebase集成。</p><p id="ae0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程结束时，您应该能够将数据从Firebase提取到Redux中，实时更新这些数据，并在屏幕和组件中显示这些数据。</p><h1 id="e318" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置</h1><p id="a971" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">要使用本教程，您应该有一个正在运行的React本地应用程序，并且已经初始化了Firebase。</p><h1 id="b6e2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安装库</h1><p id="ea78" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我们将使用3个Redux库，您可以通过在项目目录的终端中键入以下命令来安装它们:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="29eb" class="mk kz iq mg b gy ml mm l mn mo">npm install -S redux react-redux redux-thunk</span></pre><h1 id="d1a7" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建一些示例数据</h1><p id="89f0" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">前往<a class="ae kw" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>并添加一些样本数据。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/522298d3208d980d4782a2580a8cfac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*ThCWxudz7_ceAZKoiKbwZw.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk translated">如果已经有数据，可以使用现有数据！</figcaption></figure><h1 id="41d8" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">基本冗余基础设施</h1><p id="dc0a" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">声明:这是我个人为简单应用程序设置Redux的方式。其他教程通常说要把不同的部分分成单独的文件。为了方便起见，我喜欢把所有东西都放在一个文件里。</p><h2 id="3d65" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">创建Redux文件:</h2><p id="b451" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">创建一个名为<code class="fe nf ng nh mg b">redux</code>的新文件夹，并在其中创建一个名为<code class="fe nf ng nh mg b">app-redux.js</code>的文件。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d2b0439cb59bdb482b984c2b7423ada4.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*P9J0QVJJgRBQimAsBU1hgw.png"/></div></figure><h2 id="35ba" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">导入库:</h2><p id="4e29" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在<code class="fe nf ng nh mg b">app-redux.js</code>里面，导入几个我们很快会用到的Redux库。把火焰基地也扔进去，因为我们最终会需要它的。:)</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="65e6" class="mk kz iq mg b gy ml mm l mn mo">import { createStore, applyMiddleware } from 'redux';<br/>import thunkMiddleware from 'redux-thunk';<br/>import * as firebase from 'firebase';</span></pre><h2 id="5500" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">设置初始状态:</h2><p id="2dca" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在那下面，为你的<em class="kx">初始状态</em>创建一小段代码:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="94cb" class="mk kz iq mg b gy ml mm l mn mo">//<br/>// Initial State...<br/>//</span><span id="1f23" class="mk kz iq mg b gy nj mm l mn mo">const initialState = {<br/>  personData: { },<br/>}</span></pre><p id="7b60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个数据结构代表了应用程序的初始状态。通常情况下，您会希望它为空或填充默认值。在我们的例子中，我们将从Firebase加载数据，所以我们只需要一个空对象作为开始。</p><h2 id="d0f3" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">设置减速器:</h2><p id="0804" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">为您的<em class="kx">减速器</em>创建另一段代码:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="fbfe" class="mk kz iq mg b gy ml mm l mn mo">//<br/>// Reducer...<br/>//</span><span id="4e2d" class="mk kz iq mg b gy nj mm l mn mo">const reducer = (state = initialState, action) =&gt; {<br/>  return state;<br/>}</span></pre><p id="987a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">减速器将接受一个<code class="fe nf ng nh mg b">action</code>，并根据动作告诉它做的事情返回一个新的<code class="fe nf ng nh mg b">state</code>。现在，由于我们没有任何动作，我们将返回原来的状态。</p><h2 id="1478" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">安装存储:</h2><p id="9e07" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">为您的<em class="kx">商店</em>创建另一段代码:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="2e1d" class="mk kz iq mg b gy ml mm l mn mo">//<br/>// Store...<br/>//</span><span id="4d62" class="mk kz iq mg b gy nj mm l mn mo">const store = createStore(reducer, applyMiddleware(thunkMiddleware));<br/>export { store };</span></pre><p id="1f3e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">store</code>是一个数据存储库，可以记录你的所有数据。注意，我们传入了之前创建的<code class="fe nf ng nh mg b">reducer</code>。我们也在应用<code class="fe nf ng nh mg b">thunkMiddleware</code>，稍后会有用。最后，我们<code class="fe nf ng nh mg b">export</code>了<code class="fe nf ng nh mg b">store</code>，这样我们就可以在其他文件中使用它。</p><h1 id="6fda" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">将你的应用连接到Redux</h1><p id="99db" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在我们有了基本的Redux框架设置，我们需要将它连接到我们的应用程序。打开您的<code class="fe nf ng nh mg b">App.js</code>并导入以下内容。注意，我们正在导入刚刚创建的<code class="fe nf ng nh mg b">store</code>。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="bb7f" class="mk kz iq mg b gy ml mm l mn mo">import { Provider } from 'react-redux'<br/>import { store } from './redux/app-redux';</span></pre><p id="ab1c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe nf ng nh mg b">Provider</code>组件包围你的应用程序内容，并用我们的<code class="fe nf ng nh mg b">store</code>提供给它。这是我的样子:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="7c1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将使您的应用程序可以访问我们创建的Redux商店。</p><h1 id="29f2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">将您的屏幕连接到Redux</h1><p id="cb29" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在，我们需要将我们各自的屏幕连接到Redux。您不必对所有的屏幕都这样做，只需要对那些您想访问Redux数据的屏幕这样做。</p><h2 id="47f1" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">导入库:</h2><p id="7ca4" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">首先，从<code class="fe nf ng nh mg b">react-redux</code>导入<code class="fe nf ng nh mg b">connect</code>:</p><p id="3575" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">import { connect } from 'react-redux';</code></p><h2 id="1312" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">创建存根函数:</h2><p id="e24d" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">然后，创建这两个函数(我们将在后面填充):</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="c61b" class="mk kz iq mg b gy ml mm l mn mo">const mapStateToProps = (state) =&gt; {<br/> return { };<br/>}</span><span id="5625" class="mk kz iq mg b gy nj mm l mn mo">const mapDispatchToProps = (dispatch) =&gt; {<br/> return { };<br/>}</span></pre><h2 id="b818" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">更改导出:</h2><p id="a821" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我的屏幕都被设置成这样导出:</p><p id="09e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">export default class HomeScreen extends React.Component {</code></p><p id="51a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们需要移除<code class="fe nf ng nh mg b">export default</code>来得到这个(我们将把它导出到其他地方):</p><p id="80ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">class HomeScreen extends React.Component {</code></p><h2 id="351e" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">通过连接导出:</h2><p id="8dd8" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">最后，在文件的最底部，像这样导出您的类:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a800" class="mk kz iq mg b gy ml mm l mn mo">export default connect(mapStateToProps, mapDispatchToProps)(HomeScreen);</span></pre><p id="019e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们调用<code class="fe nf ng nh mg b">connect</code>并传入我们创建的两个函数。然后我们将屏幕传递给那个调用的结果。</p><h2 id="078e" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">最终屏幕:</h2><p id="d20b" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">作为参考，我的屏幕看起来是这样的:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9f39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您的屏幕已经连接到Redux，但是我们稍后会回来检索并显示数据。</p><h1 id="d19d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">行动</h1><p id="c2fc" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在，我们将创建一些可以在Redux中使用的动作来更新我们的数据。</p><h2 id="1866" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">标准操作:</h2><p id="1a5a" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">回到<code class="fe nf ng nh mg b">app-redux.js</code>，为<code class="fe nf ng nh mg b">Action Creators</code>创建另一段代码。<code class="fe nf ng nh mg b">Action creators</code>发送到您的<code class="fe nf ng nh mg b">reducer</code>并包含有关如何更新<code class="fe nf ng nh mg b">state</code>的信息。这里我们将创建一个可以更新我们的<code class="fe nf ng nh mg b">state.personData</code>对象的<code class="fe nf ng nh mg b">action creator</code>。我们还将<code class="fe nf ng nh mg b">export</code>它，以便在其他文件中可以访问它。</p><p id="d0f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:你可以在返回对象中放入任何你想要的数据。但是总是有一个<code class="fe nf ng nh mg b">type</code>属性是一个Redux约定。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="5f5c" class="mk kz iq mg b gy ml mm l mn mo">//<br/>// Action Creators<br/>//</span><span id="e88f" class="mk kz iq mg b gy nj mm l mn mo">const setPersonData = (personData) =&gt; {<br/>  return {<br/>    type: "setPersonData",<br/>    value: personData<br/>  };<br/>};</span><span id="2376" class="mk kz iq mg b gy nj mm l mn mo">export { setPersonData };</span></pre><p id="1771" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于<code class="fe nf ng nh mg b">action creators</code>被发送到<code class="fe nf ng nh mg b">reducer</code>，我们需要更新减速器来处理这个动作。向上滚动到您的<code class="fe nf ng nh mg b">reducer</code>并像这样更新它:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="b009" class="mk kz iq mg b gy ml mm l mn mo">const reducer = (state = initialState, action) =&gt; {<br/>  switch(action.type) {<br/>    case "setPersonData": <br/>      return { ...state, personData: action.value };</span><span id="72c4" class="mk kz iq mg b gy nj mm l mn mo">    default: <br/>      return state;<br/>  }<br/>}</span></pre><p id="754c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看我们在<code class="fe nf ng nh mg b">action.type</code>上<code class="fe nf ng nh mg b">switch-ing</code>怎么样？这就是为什么我们应该在我们的<code class="fe nf ng nh mg b">action creators</code>中包含一个<code class="fe nf ng nh mg b">type</code>酒店。</p><p id="049c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，当<code class="fe nf ng nh mg b">type</code>为<code class="fe nf ng nh mg b">"setPersonData"</code>时，我们返回一个新的<code class="fe nf ng nh mg b">state</code>，其中<code class="fe nf ng nh mg b">personData</code>变为<code class="fe nf ng nh mg b">action.value</code>。这将更新我们的状态和应用程序中访问该数据的任何地方。</p><h2 id="fbb5" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">Thunk:</h2><p id="4c62" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">按说，<code class="fe nf ng nh mg b">action creators</code>只能返回对象。但是既然我们应用了<code class="fe nf ng nh mg b">thunkMiddleware</code>，我们也可以有返回函数的<code class="fe nf ng nh mg b">action creators</code>。这对于没有立即可用数据的操作(例如异步网络调用)或实时更新的数据(例如Firebase实时更新)来说至关重要。</p><p id="ba48" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们创建另一个动作来实时观察我们的Firebase数据。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="dfed" class="mk kz iq mg b gy ml mm l mn mo">const watchPersonData = () =&gt; {<br/>  return function(dispatch) {<br/>    firebase.database().ref("person").on("value", function(snapshot)<br/>    { <br/>        var personData = snapshot.val();<br/>        var actionSetPersonData = setPersonData(personData);<br/>        dispatch(actionSetPersonData);</span><span id="db4b" class="mk kz iq mg b gy nj mm l mn mo">    }, function(error) { console.log(error); });<br/>  }<br/>};</span></pre><p id="63fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们返回一个作为参数给出的<code class="fe nf ng nh mg b">dispatch</code>的<code class="fe nf ng nh mg b">function</code>。在函数内部，我们为数据库中的<code class="fe nf ng nh mg b">"person"</code>节点调用Firebase的实时函数<code class="fe nf ng nh mg b">.on("value")</code>。任何时候该函数成功(我们的数据被更新的时候)，我们将从<code class="fe nf ng nh mg b">snapshot.val()</code>获取数据，得到一个<code class="fe nf ng nh mg b">setPersonData</code>动作创建器，然后<code class="fe nf ng nh mg b">dispatch</code>该动作到我们的<code class="fe nf ng nh mg b">reducer</code>(它将更新<code class="fe nf ng nh mg b">state</code>)。如果函数失败，我们只需在控制台中记录错误。</p><p id="4348" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">听起来很多吗？的确如此，但是在下一节中看看它们是如何联系在一起的。</p><p id="4b2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PS:别忘了<code class="fe nf ng nh mg b">export</code>你的新动作创作者！</p><p id="cf0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">export { setPersonData, watchPersonData };</code></p><h1 id="3a90" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">在屏幕上查看数据</h1><p id="c7f2" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">回到我们的<code class="fe nf ng nh mg b">HomeScreen.js</code>，我们需要更新我们最初创建的那些函数，<code class="fe nf ng nh mg b">mapStateToProps</code>和<code class="fe nf ng nh mg b">mapDispatchToProps</code>。这些函数实际上会将<code class="fe nf ng nh mg b">props</code>添加到您的屏幕/组件中，因此您可以访问它们来呈现数据。</p><p id="8987" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在更新它们之前，让我们先<code class="fe nf ng nh mg b">import</code>一下我们刚刚创建的<code class="fe nf ng nh mg b">watchPersonData</code>动作创建器。</p><p id="1764" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nf ng nh mg b">import { watchPersonData } from './../redux/app-redux';</code></p><h2 id="39b2" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">mapStateToProps:</h2><p id="073f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在更新<code class="fe nf ng nh mg b">mapStateToProps</code>，让您的屏幕可以访问<code class="fe nf ng nh mg b">state.personData</code>:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a71b" class="mk kz iq mg b gy ml mm l mn mo">const mapStateToProps = (state) =&gt; {<br/>  return { <br/>    personData: state.personData<br/>  };<br/>}</span></pre><p id="7d3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将获取<code class="fe nf ng nh mg b">state</code>(来自Redux)并在您的屏幕中创建一个名为<code class="fe nf ng nh mg b">personData</code>的属性，其值来自<code class="fe nf ng nh mg b">state.personData</code>。现在，在你屏幕的任何地方，你都可以显示<code class="fe nf ng nh mg b">personData</code>。试试吧！</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="3ed8" class="mk kz iq mg b gy ml mm l mn mo">&lt;Text&gt;{this.props.personData.firstName}&lt;/Text&gt;<br/>&lt;Text&gt;{this.props.personData.lastName}&lt;/Text&gt;</span></pre><h2 id="774d" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">mapDispatchToProps:</h2><p id="09a8" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在唯一的问题是，我们从来没有开始观察数据！</p><p id="8d8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更新您的<code class="fe nf ng nh mg b">mapDispatchToProps</code>函数，向您的屏幕添加一个名为<code class="fe nf ng nh mg b">watchPersonData</code>的属性。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="fb80" class="mk kz iq mg b gy ml mm l mn mo">const mapDispatchToProps = (dispatch) =&gt; {<br/>  return { <br/>    watchPersonData: () =&gt; dispatch(watchPersonData())<br/>  };<br/>}</span></pre><p id="20d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这现在向您的屏幕添加了一个名为<code class="fe nf ng nh mg b">watchPersonData</code>的函数属性，当被调用时，它将<code class="fe nf ng nh mg b">dispatch</code>执行<code class="fe nf ng nh mg b">watchPersonData</code>操作(然后调用Firebase API来观察我们的<code class="fe nf ng nh mg b">"person"</code>节点中的数据。</p><p id="c8cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在屏幕的构造函数中，调用<code class="fe nf ng nh mg b">this.props.watchPersonData()</code>。</p><h2 id="5a11" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">测试:</h2><p id="c365" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">通过运行您的应用程序来测试它。您现在应该会看到屏幕上显示的<code class="fe nf ng nh mg b">personData</code>。进入Firebase并更改数据，然后返回到您的应用程序。您应该会看到更新的数据！</p><h1 id="c5c1" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">完整代码参考</h1><h2 id="0ca3" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">App.js</h2><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="f6b0" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">HomeScreen.js</h2><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h2 id="db0f" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">app-redux.js</h2><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="6d65" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">参考</h1><h2 id="87bc" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">视频教程:</h2><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="nm nl l"/></div></figure><h2 id="d3a1" class="mk kz iq bd la mu mv dn le mw mx dp li kj my mz lm kn na nb lq kr nc nd lu ne bi translated">Redux库:</h2><div class="nn no gp gr np nq"><a href="https://redux.js.org/" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">读我</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">如果不使用模块捆绑器，也没问题。npm包包括预编译的生产和开发…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">redux.js.org</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe jw nq"/></div></div></a></div><div class="nn no gp gr np nq"><a href="https://github.com/reactjs/react-redux" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">reactjs/react-redux</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">react-Redux-Redux的官方React绑定</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="of l ob oc od nz oe jw nq"/></div></div></a></div><div class="nn no gp gr np nq"><a href="https://github.com/gaearon/redux-thunk" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ir gy z fp nv fr fs nw fu fw ip bi translated">gaearon/redux-thunk</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">redux-thunk - Thunk中间件</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="og l ob oc od nz oe jw nq"/></div></div></a></div></div></div>    
</body>
</html>