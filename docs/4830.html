<html>
<head>
<title>Redis: running Master-Slave replication in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redis:在Kubernetes中运行主从复制</h1>
<blockquote>原文：<a href="https://itnext.io/redis-running-master-slave-replication-in-kubernetes-327776a37918?source=collection_archive---------0-----------------------#2020-09-29">https://itnext.io/redis-running-master-slave-replication-in-kubernetes-327776a37918?source=collection_archive---------0-----------------------#2020-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/23c6c90ae3811873cdac3b872c12308a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhdhG6g9cJRKcGcZnUa-kA.png"/></div></div></figure><p id="93e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">任务是在Kubernetes集群中运行Redis实例。</p><p id="8575" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将使用主从复制设置和Sentinels进行监控和故障转移操作。</p><p id="9e75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">查看<a class="ae kz" href="https://rtfm.co.ua/en/redis-replication-part-2-master-slave-replication-and-redis-sentinel/" rel="noopener ugc nofollow" target="_blank"> Redis: replication，part 2-Master-Slave replication和Redis Sentinel </a>帖子了解更多详细信息。</p><h1 id="2b6a" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Redis集群与Redis复制</h1><p id="57ad" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">参见<a class="ae kz" href="https://rtfm.co.ua/en/redis-replication-part-1-overview-replication-vs-sharding-sentinel-vs-cluster-redis-topology/" rel="noopener ugc nofollow" target="_blank"> Redis:复制，第1部分——概述。复制与分片。哨兵vs集群。Redis拓扑。</a>和<a class="ae kz" href="https://github.com/bitnami/charts/tree/master/bitnami/redis#choose-between-redis-helm-chart-and-redis-cluster-helm-chart" rel="noopener ugc nofollow" target="_blank">在Redis掌舵图和Redis集群掌舵图</a>之间选择。</p><p id="c9cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简而言之:</p><ul class=""><li id="49c0" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><em class="mm">副本</em> —包括一个Redis主实例，该实例执行读写操作，并将数据复制到它的Redis从实例，该实例提供只读操作。在此期间，如果主人失败，这样的奴隶可以提升到主人的角色。</li><li id="0b12" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated"><em class="mm">集群</em> —当你的Redis拥有的数据超过你服务器的RAM时，你会感觉到。集群可以使用<a class="ae kz" href="https://rtfm.co.ua/redis-replikaciya-chast-1-obzor-replication-vs-sharding-sentinel-vs-cluster-topologiya-redis/#Sharding" rel="noopener ugc nofollow" target="_blank">分片</a>，请求数据的客户端将被重定向到保存该数据的节点。</li></ul><h1 id="697b" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">在Kubernetes运行Redis的方法</h1><p id="ca8a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">让我们看看如何执行这个任务——在Kubernetes集群中运行带有复制功能的Redis。</p><ul class=""><li id="3fca" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">手动设置—参见<a class="ae kz" href="https://tech.ringieraxelspringer.com/blog/cloud/how-to-create-a-primary-replica-redis-cluster-in-kubernetes/r8lt028" rel="noopener ugc nofollow" target="_blank">如何在Kubernetes中创建主副本Redis集群</a></li><li id="e8a7" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">Redis运算符— <a class="ae kz" href="https://github.com/spotahome/redis-operator" rel="noopener ugc nofollow" target="_blank"> redis运算符</a></li><li id="1351" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">雷迪斯星团的掌舵图—<a class="ae kz" href="https://bitnami.com/stack/redis-cluster" rel="noopener ugc nofollow" target="_blank">https://bitnami.com/stack/redis-cluster</a></li><li id="1ce2" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">带Redis主从复制的掌舵人—<a class="ae kz" href="https://bitnami.com/stack/redis" rel="noopener ugc nofollow" target="_blank">https://bitnami.com/stack/redis</a>(本帖我们的选择)</li></ul><p id="41c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们目前的情况下，我们不需要担心数据的持久性，因为我们的Redis将仅用作缓存服务，所以我们不需要<a class="ae kz" href="https://rtfm.co.ua/kubernetes-persistentvolume-i-persistentvolumeclaim-obzor-i-primery/" rel="noopener ugc nofollow" target="_blank">Kubernetes persistent volume</a>。</p><h1 id="b2a5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">舵图展开</h1><p id="0815" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，我们将从图表中运行Redis服务，简单查看一下，然后继续查看可用的<a class="ae kz" href="https://github.com/bitnami/charts/tree/master/bitnami/redis#parameters" rel="noopener ugc nofollow" target="_blank">参数</a>。</p><p id="fe76" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将Bitnami存储库添加到您的头盔中:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b340" class="nb lb it mx b gy nc nd l ne nf">$ helm repo add bitnami <a class="ae kz" href="https://charts.bitnami.com/bitnami" rel="noopener ugc nofollow" target="_blank">https://charts.bitnami.com/bitnami</a><br/>“bitnami” has been added to your repositories</span></pre><p id="d7fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">部署Redis图表:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d46f" class="nb lb it mx b gy nc nd l ne nf">$ helm install backend-redis bitnami/redis<br/>NAME: backend-redis<br/>LAST DEPLOYED: Tue Sep 22 14:48:02 2020<br/>NAMESPACE: default<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None<br/>NOTES:</span><span id="1185" class="nb lb it mx b gy ng nd l ne nf">** Please be patient while the chart is being deployed **</span><span id="a674" class="nb lb it mx b gy ng nd l ne nf">Redis can be accessed via port 6379 on the following DNS names from within your cluster:</span><span id="8de8" class="nb lb it mx b gy ng nd l ne nf">backend-redis-master.default.svc.cluster.local for read/write operations<br/>backend-redis-slave.default.svc.cluster.local for read-only operations</span><span id="0936" class="nb lb it mx b gy ng nd l ne nf">To get your password run:</span><span id="137f" class="nb lb it mx b gy ng nd l ne nf">export REDIS_PASSWORD=$(kubectl get secret — namespace default backend-redis -o jsonpath=”{.data.redis-password}” | base64 — decode)</span><span id="5800" class="nb lb it mx b gy ng nd l ne nf">To connect to your Redis server:</span><span id="640e" class="nb lb it mx b gy ng nd l ne nf">1. Run a Redis pod that you can use as a client:</span><span id="5ed6" class="nb lb it mx b gy ng nd l ne nf">kubectl run — namespace default backend-redis-client — rm — tty -i — restart=’Never’ \<br/> — env REDIS_PASSWORD=$REDIS_PASSWORD \<br/> — image docker.io/bitnami/redis:6.0.8-debian-10-r0 — bash</span><span id="8082" class="nb lb it mx b gy ng nd l ne nf">2. Connect using the Redis CLI:</span><span id="a87f" class="nb lb it mx b gy ng nd l ne nf">redis-cli -h backend-redis-master -a $REDIS_PASSWORD<br/>redis-cli -h backend-redis-slave -a $REDIS_PASSWORD</span><span id="6dc8" class="nb lb it mx b gy ng nd l ne nf">To connect to your database from outside the cluster execute the following commands:</span><span id="af17" class="nb lb it mx b gy ng nd l ne nf">kubectl port-forward — namespace default svc/backend-redis-master 6379:6379 &amp;<br/>redis-cli -h 127.0.0.1 -p 6379 -a $REDIS_PASSWORD</span></pre><p id="beef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">获取图表部署期间生成的密码:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="664d" class="nb lb it mx b gy nc nd l ne nf">$ kubectl get secret — namespace default backend-redis -o jsonpath=”{.data.redis-password}” | base64 — decode<br/>TySS43UhAW</span></pre><p id="4cb1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行<code class="fe nh ni nj mx b"><a class="ae kz" href="https://rtfm.co.ua/en/kubernetes-clusterip-vs-nodeport-vs-loadbalancer-services-and-ingress-an-overview-with-examples/#kubectl_portforward" rel="noopener ugc nofollow" target="_blank">port-forward</a></code>连接到Redis主实例:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2dcf" class="nb lb it mx b gy nc nd l ne nf">$ kubectl port-forward — namespace default svc/backend-redis-master 6379:6379<br/>Forwarding from [::1]:6379 -&gt; 6379<br/>Forwarding from 127.0.0.1:6379 -&gt; 6379</span></pre><p id="b406" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">连接:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9c58" class="nb lb it mx b gy nc nd l ne nf">$ redis-cli -h 127.0.0.1 -p 6379 -a TySS43UhAW<br/>Warning: Using a password with ‘-a’ or ‘-u’ option on the command line interface may not be safe.<br/>127.0.0.1:6379&gt;</span></pre><p id="4033" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mm">“管用！”(с) </em></p><p id="78b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">查看我们这里有哪些服务:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="823d" class="nb lb it mx b gy nc nd l ne nf">$ kk get svc redis-service<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEredis-service NodePort 172.20.119.242 &lt;none&gt; 6379:32445/TCP 117d</span></pre><p id="3eea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它的型号是<code class="fe nh ni nj mx b">NodePort</code>，而我们需要的是<code class="fe nh ni nj mx b">LoadBalancer</code>。</p><p id="5fab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，我们需要Redis Sentinel，它在默认情况下是关闭的:</p><blockquote class="nk nl nm"><p id="c5a7" class="kb kc mm kd b ke kf kg kh ki kj kk kl nn kn ko kp no kr ks kt np kv kw kx ky im bi translated"><code class="fe nh ni nj mx b">sentinel.enabled</code>启用哨兵集装箱<code class="fe nh ni nj mx b">false</code></p></blockquote><p id="87cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好了，让我们转到选项来启用Sentinel并配置一个负载平衡器。</p><h2 id="1ca2" class="nb lb it bd lc nq nr dn lg ns nt dp lk km nu nv lo kq nw nx ls ku ny nz lw oa bi translated">Redis选项</h2><p id="bc38" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">创建一个对你有用的选项列表。</p><p id="9bed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我的情况下，这将是:</p><ul class=""><li id="1714" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">global.redis.password</li><li id="ee32" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">指标:</li><li id="d2f9" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">指标.已启用</li><li id="4772" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">metrics.serviceMonitor.enabled</li><li id="6ed1" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">metrics . service monitor . namespace</li><li id="7d64" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">坚持:</li><li id="3ade" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">master .持久性.已启用</li><li id="702d" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">slave.persistence.enabled</li><li id="ab15" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">服务</li><li id="6498" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">master.service.type</li><li id="580b" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">master.service .批注</li><li id="4dbb" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">slave.service.type</li><li id="46fe" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">slave.service .批注</li><li id="8307" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">哨兵</li><li id="8104" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">sentinel .启用</li><li id="6ce6" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">sentinel.service.type —需要LBso客户端可以请求主/从</li><li id="7076" class="md me it kd b ke mn ki mo km mp kq mq ku mr ky mi mj mk ml bi translated">哨兵.服务.注释</li></ul><p id="15d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建一个新文件<code class="fe nh ni nj mx b">~/Temp/redis-opts.yaml</code>来保存我们想要的参数:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b212" class="nb lb it mx b gy nc nd l ne nf">global:<br/>  redis:<br/>    password: "blablacar"<br/><br/>metrics:<br/>  enabled: true<br/>  serviceMonitor:<br/>    enabled: true<br/>    namespace: "monitoring"<br/><br/>master:<br/>  persistence:<br/>    enabled: false<br/>  service:<br/>    type: LoadBalancer<br/>    annotations: <br/>      kubernetes.io/ingress.class: alb<br/>      alb.ingress.kubernetes.io/scheme: internal <br/><br/>slave:<br/>  persistence:<br/>    enabled: false<br/>  service:<br/>    type: LoadBalancer<br/>    annotations:<br/>      kubernetes.io/ingress.class: alb<br/>      alb.ingress.kubernetes.io/scheme: internal<br/><br/>sentinel:<br/>  enabled: true<br/>  service:<br/>    type: LoadBalancer<br/>    annotations: <br/>      kubernetes.io/ingress.class: alb<br/>      alb.ingress.kubernetes.io/scheme: internal</span></pre><p id="d0a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用<code class="fe nh ni nj mx b">-f</code>更新部署以指定我们的参数文件:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2316" class="nb lb it mx b gy nc nd l ne nf">$ helm upgrade — install backend-redis bitnami/redis -f ~/Temp/redis-opts.yaml</span></pre><p id="b440" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查密码:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="0368" class="nb lb it mx b gy nc nd l ne nf">$ kubectl get secret — namespace default backend-redis -o jsonpath=”{.data.redis-password}” | base64 — decode<br/>blablacar</span></pre><p id="5b02" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和负载平衡器:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b27e" class="nb lb it mx b gy nc nd l ne nf">$ kk get svc -l app=redis<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span><span id="7fbc" class="nb lb it mx b gy ng nd l ne nf">backend-redis LoadBalancer 172.20.204.235 af5e1294a4a73426692c7e25f7bb947d-915967.us-east-2.elb.amazonaws.com <br/>6379:30647/TCP,26379:32523/TCP 80s</span><span id="bc25" class="nb lb it mx b gy ng nd l ne nf">backend-redis-headless ClusterIP None &lt;none&gt; 6379/TCP,26379/TCP 80s</span><span id="9f49" class="nb lb it mx b gy ng nd l ne nf">backend-redis-metrics ClusterIP 172.20.66.2 &lt;none&gt; 9121/TCP 80s</span></pre><p id="032a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">连接:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="fac1" class="nb lb it mx b gy nc nd l ne nf">$ redis-cli -h af5e1294a4a73426692c7e25f7bb947d-915967.us-east-2.elb.amazonaws.com -a blablacar<br/>Warning: Using a password with ‘-a’ or ‘-u’ option on the command line interface may not be safe.\<br/>af5e1294a4a73426692c7e25f7bb947d-915967.us-east-2.elb.amazonaws.com:6379&gt;</span></pre><p id="e971" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有效，好吧。</p><p id="53c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是为什么负载均衡器在被设置为内部<em class="mm">的时候是公共的呢？</em></p><p id="6700" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是因为<code class="fe nh ni nj mx b">alb.ingress.kubernetes.io/scheme: internal</code>用于<a class="ae kz" href="https://rtfm.co.ua/en/aws-elastic-kubernetes-service-running-alb-ingress-controller/" rel="noopener ugc nofollow" target="_blank"> ALB入口控制器</a>，而图表创建了一个简单的带有<code class="fe nh ni nj mx b">LoadBalancer</code>类型的Kubernetes服务，它将创建一个AWS经典负载平衡器。</p><p id="daeb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">阅读文档—<a class="ae kz" href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/service/# load balancer</a>并更新我们的注释:指定“<code class="fe nh ni nj mx b">alb.ingress.kubernetes.io/scheme: internal</code>”而不是“<code class="fe nh ni nj mx b">service.beta.kubernetes.io/aws-load-balancer-internal: "true"</code>”:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c750" class="nb lb it mx b gy nc nd l ne nf">...<br/>master:<br/>  service:<br/>    type: LoadBalancer<br/>    annotations: <br/>      service.beta.kubernetes.io/aws-load-balancer-internal: "true"<br/><br/>slave:<br/>  service:<br/>    type: LoadBalancer<br/>    annotations:<br/>      service.beta.kubernetes.io/aws-load-balancer-internal: "true"<br/><br/>sentinel:<br/>  enabled: true<br/>  service:<br/>    type: LoadBalancer<br/>    annotations: <br/>      service.beta.kubernetes.io/aws-load-balancer-internal: "true"</span></pre><p id="45fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更新部署并再次检查:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f973" class="nb lb it mx b gy nc nd l ne nf">$ kk get svc -l app=redis<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE</span><span id="7805" class="nb lb it mx b gy ng nd l ne nf">backend-redis LoadBalancer 172.20.178.72 internal-***-1786016015.us-east-2.elb.amazonaws.com 6379:31192/TCP,26379:32239/TCP 17s\</span><span id="582c" class="nb lb it mx b gy ng nd l ne nf">backend-redis-headless ClusterIP None &lt;none&gt; 6379/TCP,26379/TCP 17s</span><span id="8507" class="nb lb it mx b gy ng nd l ne nf">backend-redis-metrics ClusterIP 172.20.35.163 &lt;none&gt; 9121/TCP 17s</span></pre><p id="6c9a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，进行写操作—必须由Redis主实例提供服务:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c16c" class="nb lb it mx b gy nc nd l ne nf">$ admin@bttrm-dev-app-1:~$ redis-cli -h internal-***-1786016015.us-east-2.elb.amazonaws.com -p 6379 -a blablacar SET testkey testvalue<br/>OK</span></pre><p id="de5d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和读操作:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="60f2" class="nb lb it mx b gy nc nd l ne nf">admin@bttrm-dev-app-1:~$ redis-cli -h internal-***-1786016015.us-east-2.elb.amazonaws.com -p 6379 -a blablacar GET testkey<br/>“testvalue”</span></pre><p id="52d8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制状态:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4d8f" class="nb lb it mx b gy nc nd l ne nf">admin@bttrm-dev-app-1:~$ redis-cli -h internal-***-1786016015.us-east-2.elb.amazonaws.com -p 6379 -a blablacar info replication<br/>Replication<br/>role:master<br/>connected_slaves:1<br/>slave0:ip=10.3.50.119,port=6379,state=online,offset=144165,lag=1<br/>…</span></pre><p id="fa4b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和哨兵状态:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4912" class="nb lb it mx b gy nc nd l ne nf">admin@bttrm-dev-app-1:~$ redis-cli -h internal-***-1786016015.us-east-2.elb.amazonaws.com -p 26379 -a blablacar info sentinel<br/>Sentinel<br/>sentinel_masters:1<br/>sentinel_tilt:0<br/>sentinel_running_scripts:0<br/>sentinel_scripts_queue_length:0<br/>sentinel_simulate_failure_flags:0<br/>master0:name=mymaster,status=ok,address=10.3.33.107:6379,slaves=1,sentinels=2</span></pre><p id="8e3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然写操作需要在通过Sentinels获得主设备的地址之后执行:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="ec53" class="nb lb it mx b gy nc nd l ne nf">admin@bttrm-dev-app-1:~$ redis-cli -h internal-***-1786016015.us-east-2.elb.amazonaws.com -p 26379 -a blablacar sentinel get-master-addr-by-name mymaster<br/>1) “10.3.33.107”<br/>r2) “6379”</span></pre><p id="87ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查<a class="ae kz" href="https://github.com/bitnami/charts/tree/master/bitnami/redis/#master-slave-with-sentinel" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="679a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完成了。</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="9d0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mm">最初发布于</em> <a class="ae kz" href="https://rtfm.co.ua/en/redis-running-master-slave-replication-in-kubernetes/" rel="noopener ugc nofollow" target="_blank"> <em class="mm"> RTFM: Linux、DevOps、系统管理</em> </a> <em class="mm">。</em></p></div></div>    
</body>
</html>