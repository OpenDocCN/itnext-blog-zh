<html>
<head>
<title>Integrate GitLab into JetBrains TeamCity CI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将GitLab集成到JetBrains TeamCity CI中</h1>
<blockquote>原文：<a href="https://itnext.io/integrate-gitlab-into-jetbrains-teamcity-ci-2d0a44df7a1?source=collection_archive---------2-----------------------#2019-04-07">https://itnext.io/integrate-gitlab-into-jetbrains-teamcity-ci-2d0a44df7a1?source=collection_archive---------2-----------------------#2019-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="20d8" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">我总是努力让这篇文章与TeamCity和GitLab的最新发布保持同步。(更新于2019年10月25日— GitLab 12.14和TeamCity 2019.1.4)</p></blockquote><p id="5f29" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">如果你曾经试图将GitLab集成到TeamCity中，你可能会因为缺少文档和指南而感到困惑。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div class="gh gi kv"><img src="../Images/10380a19f8b2fb08b7ddceabbd967d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*37VAPv06NDoEtN6mmIe-pQ.jpeg"/></div></figure><p id="4dcf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">💡希望本文能为您提供进行这种集成的指导。</p><h2 id="8687" class="ld le it bd lf lg lh dn li lj lk dp ll ks lm ln lo kt lp lq lr ku ls lt lu lv bi translated">集成要求</h2><ol class=""><li id="fbc1" class="lw lx it jw b jx ly kb lz ks ma kt mb ku mc kr md me mf mg bi translated">在您的项目中具有开发人员角色的GitLab用户</li><li id="8dd8" class="lw lx it jw b jx mh kb mi ks mj kt mk ku ml kr md me mf mg bi translated">拥有私有令牌的TeamCity用户</li></ol><h2 id="0a1d" class="ld le it bd lf lg lh dn li lj lk dp ll ks lm ln lo kt lp lq lr ku ls lt lu lv bi translated">步骤1 —在GitLab上启用“JetBrains TeamCity CI”项目服务</h2><p id="13ac" class="pw-post-body-paragraph jt ju it jw b jx ly jz ka kb lz kd ke ks mm kh ki kt mn kl km ku mo kp kq kr im bi translated">这个选项可以在项目<em class="jv">设置- &gt;集成</em>中找到。您也可以直接重定向到下面的地址来访问TeamCity项目服务设置:</p><p id="2d4b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated"><strong class="jw iu">http(s)://git lab _ IP/group/project/services/team city/edit(</strong><em class="jv">eg:</em><a class="ae mp" href="http://github.com/foo/bar/settings/integration)" rel="noopener ugc nofollow" target="_blank"><em class="jv">http://github.com/foo/bar/settings/s</em></a><em class="jv">services/team city/edit)</em></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/354753ae9ca22a82b3cb2666fa2325c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XNszOFgNyGOAmEvAgBL_5g.png"/></div></div></figure><ol class=""><li id="d2d1" class="lw lx it jw b jx jy kb kc ks mv kt mw ku mx kr md me mf mg bi translated">确保<strong class="jw iu">激活</strong>复选框已被选中</li><li id="526a" class="lw lx it jw b jx mh kb mi ks mj kt mk ku ml kr md me mf mg bi translated"><strong class="jw iu">URI团队城市</strong>例如:<a class="ae mp" href="http://ip_addres_of_team_city_server" rel="noopener ugc nofollow" target="_blank">http://IP _ addres _ of _ team _ city _ server</a></li><li id="1cc7" class="lw lx it jw b jx mh kb mi ks mj kt mk ku ml kr md me mf mg bi translated"><strong class="jw iu">构建类型</strong>是TeamCity中您的项目的<a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Build+Configuration+General+Settings" rel="noopener ugc nofollow" target="_blank">构建配置ID </a></li><li id="8808" class="lw lx it jw b jx mh kb mi ks mj kt mk ku ml kr md me mf mg bi translated"><strong class="jw iu">用户名</strong>和<strong class="jw iu">密码</strong>与团队城市用户相关</li></ol><p id="6b68" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">💡设置页面上有两种类型的触发器，您可以选择<strong class="jw iu">推</strong>或<strong class="jw iu">合并请求</strong>中的哪一种。</p><p id="49ba" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">您可以通过按下<code class="fe my mz na nb b">Test settings and save changes,</code>来检查您的设置。如果一切正常，它应该会被启用，没有任何问题。</p><p id="91e2" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">📝<strong class="jw iu">重要提示:</strong> TeamCity表明:</p><blockquote class="jq jr js"><p id="f5c7" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">您将需要配置对所有分支的监视，以便构建合并请求，该设置位于vsc root高级设置中。</p></blockquote><p id="e06b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">要进行更改，请导航到TeamCity build编辑页面。(TeamCity home -&gt;点击你的项目build -&gt;点击<a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Creating+and+Editing+Build+Configurations" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">编辑配置设置</strong> </a> <strong class="jw iu"> ) </strong></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nc"><img src="../Images/1736b22aa72dfdec5a9ae7d218a5c406.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rATmO7C2xGh47CKzgylwKw.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">编辑配置设置</figcaption></figure><h2 id="fc94" class="ld le it bd lf lg lh dn li lj lk dp ll ks lm ln lo kt lp lq lr ku ls lt lu lv bi translated">为您的项目配置TeamCity <a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Working+with+Feature+Branches" rel="noopener ugc nofollow" target="_blank"> VCS根分支规范</a></h2><p id="6fc4" class="pw-post-body-paragraph jt ju it jw b jx ly jz ka kb lz kd ke ks mm kh ki kt mn kl km ku mo kp kq kr im bi translated">TeamCity要求了解GitLab的每一项变更(如提交、合并请求等)。在<a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Creating+and+Editing+Build+Configurations" rel="noopener ugc nofollow" target="_blank">编辑配置设置</a>中，左侧面板有版本控制设置链接，导航至该链接。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nh"><img src="../Images/ac79f0f8ad2b1b7ce1e7811757ac5307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ODbPVG3dhOJD65Saw1XYbw.png"/></div></div></figure><p id="13ae" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">编辑你的VCS根:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi ni"><img src="../Images/1f7ee9a1390cac768bcee42e2adaa32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2pwmAfnD4h7r0A0IUZHog.png"/></div></div></figure><p id="710c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">然后找到<a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Working+with+Feature+Branches" rel="noopener ugc nofollow" target="_blank">分支规范</a>(如果看不到，点击显示高级选项)，用下面的值填充并保存更改。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nj"><img src="../Images/b1524b3793eeb8932b17fc5d43fc7f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXBonZvSwGn0J_WMfrMryg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">高级选项</figcaption></figure><p id="e538" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">然后在分支规范中添加以下规则:</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nk"><img src="../Images/2e27abdf7f2cdedfb1e077e1a20369db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rj38JopEuE1gEjB-LnzUbg.png"/></div></div></figure><pre class="kw kx ky kz gt nl nb nm nn aw no bi"><span id="801c" class="ld le it nb b gy np nq l nr ns">+:master<br/>+:refs/(merge-requests/*)/head<br/>+:merge-requests/*<br/>+:refs/heads/(*)</span></pre><h2 id="2947" class="ld le it bd lf lg lh dn li lj lk dp ll ks lm ln lo kt lp lq lr ku ls lt lu lv bi translated">步骤2——为您的项目构建配置<a class="ae mp" href="https://confluence.jetbrains.com/display/TCD18/Adding+Build+Features" rel="noopener ugc nofollow" target="_blank"> TeamCity构建特性</a></h2><p id="eab9" class="pw-post-body-paragraph jt ju it jw b jx ly jz ka kb lz kd ke ks mm kh ki kt mn kl km ku mo kp kq kr im bi translated">在<strong class="jw iu">编辑配置页面</strong>上，您可以找到<strong class="jw iu">构建特性</strong>链接，导航至该链接并点击<strong class="jw iu">添加构建特性</strong>。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nt"><img src="../Images/718cdac4f15797e8d2c96a3f4155621c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0z-k4Q8Sx_5XZY8gXiNTQ.png"/></div></div></figure><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nu"><img src="../Images/aa5a4765842307107f5866a3adbb6078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQgvAnkheKGVFzK5OOML6Q.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">添加构建功能</figcaption></figure><p id="3bbd" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">在第一个组合框中找到<strong class="jw iu"> <em class="jv">提交状态发布者</em>，</strong>并将<strong class="jw iu"> VCS根</strong>设置为<strong class="jw iu"> <em class="jv">所有附加的VCS根。</em> </strong></p><p id="5f3d" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">通过将<strong class="jw iu">发布者</strong>更改为<strong class="jw iu"> <em class="jv"> GitLab </em> </strong>您可以配置GitLab。<strong class="jw iu"> GitLab URL </strong>必须类似于下面的链接:</p><pre class="kw kx ky kz gt nl nb nm nn aw no bi"><span id="266f" class="ld le it nb b gy np nq l nr ns">http(s)://gitlab_ip/api/v4</span></pre><p id="1d38" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">正如我在故事开始时提到的，你需要一个GitLab用户，至少拥有对你的GitLab组的<strong class="jw iu">开发者角色</strong>访问权。<a class="ae mp" href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html" rel="noopener ugc nofollow" target="_blank">为GitLab用户生成一个私有令牌</a>，并输入到<strong class="jw iu">私有令牌中。</strong></p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nv"><img src="../Images/cb10c8b2b3cb02cd88bcd231b3f6fb5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTJpdIxrSTPyXT8Tv8CXPQ.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">添加构建功能</figcaption></figure><p id="3028" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">点击<strong class="jw iu">测试连接</strong>按钮，可以测试设置。保存更改。</p><h2 id="df4a" class="ld le it bd lf lg lh dn li lj lk dp ll ks lm ln lo kt lp lq lr ku ls lt lu lv bi translated">步骤3 —在合并请求中测试构建管道</h2><p id="9f9b" class="pw-post-body-paragraph jt ju it jw b jx ly jz ka kb lz kd ke ks mm kh ki kt mn kl km ku mo kp kq kr im bi translated">如果一切正常，您可以在每个pull请求中看到管道行。</p><figure class="kw kx ky kz gt la gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi nw"><img src="../Images/4844396f3b09a46069e767db48cf0334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cgLb6Th7ZCha01oupEG4JA.png"/></div></div></figure><p id="ff72" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke ks kg kh ki kt kk kl km ku ko kp kq kr im bi translated">我希望这篇文章能帮助你将GitLab集成到TeamCity CI中，我在集成过程中遇到了很多问题，不幸的是，没有任何简单的指南。</p></div></div>    
</body>
</html>