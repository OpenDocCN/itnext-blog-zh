<html>
<head>
<title>Easy way to use Azure Application Gateway for an Intranet Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为内部网应用程序使用Azure应用程序网关的简单方法</h1>
<blockquote>原文：<a href="https://itnext.io/easy-way-to-use-azure-application-gateway-for-an-intranet-application-e05e70e29d38?source=collection_archive---------1-----------------------#2022-05-18">https://itnext.io/easy-way-to-use-azure-application-gateway-for-an-intranet-application-e05e70e29d38?source=collection_archive---------1-----------------------#2022-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="24d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几个月前，我写了一篇关于使用Azure Application Gateway开发内部网应用程序的<a class="ae kl" href="https://harinderjitss.medium.com/using-azure-application-gateway-for-an-intranet-application-9009a91621ac" rel="noopener">帖子</a>。这是那篇文章的延续。我们将实现同样的目标，但我们将使用不同的方式，用<strong class="jp ir">更简单的方式</strong>。</p><h1 id="80cd" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">这个比较简单的方法是什么？</h1><p id="0538" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">当我写最后一篇<a class="ae kl" href="https://medium.com/@harinderjitss/using-azure-application-gateway-for-an-intranet-application-9009a91621ac" rel="noopener">博客</a>时，应用程序网关不允许我们创建<a class="ae kl" href="https://docs.microsoft.com/en-us/azure/application-gateway/private-link-configure?tabs=portal" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">私有链接和私有端点</strong> </a>来私有访问应用程序网关端点。现在，这个特性在预览版中是可用的。</p><p id="f23d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure私有端点是Azure私有链接的基础构建块。私有端点使部署在虚拟网络中的Azure资源能够与私有链接资源进行私有通信。</p><p id="408f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">私有端点允许资源访问部署在虚拟网络中的私有链接服务。通过虚拟网络对等和内部网络连接访问私有端点扩展了连接性。</p><p id="2ccc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我之前写了一篇<a class="ae kl" href="https://medium.com/@harinderjitss/configure-the-storage-account-access-without-public-ip-7f99c207073c" rel="noopener">文章</a>讨论私有端点及其与服务端点的比较。</p><h1 id="1e5f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">这怎么容易？</h1><p id="1818" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">简而言之，在我看来，这更容易，因为<strong class="jp ir">你不需要维护一个单独的用户定义的路线(UDR) </strong>，我们在上一篇文章中就是这么做的。</p><p id="6e0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是所需的步骤:</p><ol class=""><li id="3466" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">部署应用程序网关(在我的例子中是Standard v2)</li><li id="1d2d" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">为应用程序网关中的应用程序配置后端池、后端设置(之前称为HTTP设置)、路由规则、健康探测和重写规则(如果有)。</li><li id="eb6f" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">确保应用程序网关侦听器使用私有前端IP(不使用公共IP)和有效的主机名(在我的例子中是DNS中的类型记录)</li><li id="1299" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">创建一个私有链接。</li><li id="0531" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">创建私有端点。</li><li id="1a66" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">更新专用DNS记录以指向您的专用端点的专用IP。</li></ol><p id="685c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我详细阐述第四点和第五点。</p><h1 id="178d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置专用链接(4)</h1><p id="d418" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">专用链接配置定义了应用程序网关使用的基础结构，以支持来自专用端点的连接。要创建专用链路配置，请完成以下步骤:</p><ol class=""><li id="b73f" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">前往<a class="ae kl" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure门户</a></li><li id="6309" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">搜索并选择应用程序网关。</li><li id="f72e" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">选择要启用专用链接的应用程序网关的名称。</li><li id="6a71" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk lu lv lw lx bi translated">选择专用链接</li></ol><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/c2326bb0bed65c4d6b06515e6986ed3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yavAQy8joZnNNMOvHBjzPg.png"/></div></div></figure><p id="5172" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.配置以下项目:</p><ul class=""><li id="0083" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mp lv lw lx bi translated">名称:专用链接配置的名称。</li><li id="c5fc" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">专用链路子网:应该使用的子网IP地址。</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mq"><img src="../Images/2148e7995cb3cc78bd003e379fccc205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cv6Vobsu-2IHgRGqKkFEqg.png"/></div></div></figure><ul class=""><li id="ee28" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mp lv lw lx bi translated">前端IP配置:专用链路在应用程序网关上将流量转发到的前端IP地址。</li><li id="ea00" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">专用IP地址设置:至少指定一个IP地址</li></ul><p id="9035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.选择添加。</p><p id="4aeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些步骤将在目标虚拟网络的专用子网中创建一个专用链路。每个专用链路配置的最大IP地址数是八个。仅支持动态分配。</p><h1 id="a6fa" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置私有端点(5)</h1><p id="120e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">私有端点是一个网络接口，它使用来自虚拟网络的私有IP地址，该虚拟网络包含希望连接到您的网关的客户端。每个客户端将使用私有端点的私有IP地址将流量隧道传输到应用网关。要创建私有端点，请完成以下步骤:</p><ol class=""><li id="9f11" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk lu lv lw lx bi translated">选择专用端点连接选项卡。</li></ol><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mr"><img src="../Images/7d3a3b517188bb5af5a7d44b3f7f1d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mX-ybKmb49XrybQ_vXJLw.jpeg"/></div></div></figure><p id="02a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击私有端点。</p><p id="a5a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.在“基本”选项卡上，为专用端点配置资源组、名称和区域。选择下一步。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ms"><img src="../Images/ad65e5ef2d7a71c0cd322c4582e7896c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7sgCNs4jXdIO-yGAxXPTw.png"/></div></div></figure><p id="26b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在资源选项卡上，选择下一步。如果在尝试选择私有端点创建的<em class="mt">资源</em>选项卡上的<em class="mt">目标子资源</em>时，公共或私有IP配置资源丢失，请确保监听器正在积极利用相应的前端IP配置。没有关联监听器的前端IP配置不会显示为<em class="mt">目标子资源</em>。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mu"><img src="../Images/ce1f3adcfe0e87ee6d910b5bbdd058df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1vre6id08PWk79syqhCsg.png"/></div></div></figure><p id="33f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.在虚拟网络选项卡上，配置专用端点网络接口应配置到的虚拟网络和子网。配置私有端点应该具有动态还是静态IP地址。最后，如果您希望创建一个新的专用链接区域来自动管理IP寻址，请进行配置。选择下一步。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mv"><img src="../Images/702dc012dda9c50b0f04d9847fa173d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tG-ZpHslCpnPi9iOUU6XKg.png"/></div></div></figure><p id="8d96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在“标记”选项卡上，可以选择配置资源标记。选择下一步。</p><p id="3aef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.选择创建。</p><p id="d466" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.您可以从“DNS配置”中获取与私有端点相关联的私有IP</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mw"><img src="../Images/cc6c974f920a07c1294a93140e0b441c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*geX7O0-gjGMaN-61wlS7wA.png"/></div></div></figure><p id="fd8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新应用程序网关侦听器配置中使用的主机名的专用DNS记录，以指向您的专用端点的专用IP。</p><h1 id="86b5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">以下限制适用于私有端点:</h1><ul class=""><li id="9f1c" class="lp lq iq jp b jq lk ju ll jy mx kc my kg mz kk mp lv lw lx bi translated">来自私有端点的流量会绕过网络安全组(NSG)</li><li id="e1a1" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">私有端点不支持网络安全组(NSG)或Azure防火墙等网络策略，因此安全规则不适用于它们。</li><li id="d623" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">来自私有端点的流量会绕过用户定义的路由(UDR)。用户定义的路由可用于覆盖去往私有端点的流量。</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi na"><img src="../Images/99f92d3b0d0fee0f5f104b7d065dbe78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1V-gaOjmCXINdsnV1E_3A.png"/></div></div></figure><p id="6b1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将请求如何从客户端流向后端与<a class="ae kl" href="https://medium.com/@harinderjitss/using-azure-application-gateway-for-an-intranet-application-9009a91621ac" rel="noopener">博客中介绍另一种方法</a>的图表进行比较。您可以看到请求不再流经防火墙，因为它绕过了UDR。</p><h1 id="a16f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">走哪条路？</h1><p id="a7f7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这应该是未来的讨论，因为与应用程序网关的私有链接的使用现在正在预览中。</p><p id="804d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦该功能可以投入生产，就需要考虑以下事项:</p><ul class=""><li id="1582" class="lp lq iq jp b jq jr ju jv jy lr kc ls kg lt kk mp lv lw lx bi translated">UDR维护:如果您在使用此方法时需要访问另一个子网或另一个站点到站点VPN地址空间或另一个点到站点VPN地址空间中的资源，只要私有端点位于HUB虚拟网络的子网中，您就不必担心。如果您使用另一种方法，那么您需要将这些地址空间添加到UDR associated中。</li><li id="4384" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">防火墙和NSG规则:使用私有端点时无需担心，因为使用私有端点时会绕过防火墙和NSG。如果您使用另一种方法，那么您需要将任何新允许/拒绝的地址空间添加到相关的防火墙和NSG规则中。</li><li id="7903" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">成本:私有端点会产生额外费用。</li><li id="748f" class="lp lq iq jp b jq ly ju lz jy ma kc mb kg mc kk mp lv lw lx bi translated">安全控制:对于私有端点，NSG和防火墙被绕过，所以如果你想确保只有特定子网或网络中的资源才能使用应用网关访问应用的URL，这不是正确的方法，我建议通过<a class="ae kl" href="https://medium.com/@harinderjitss/using-azure-application-gateway-for-an-intranet-application-9009a91621ac" rel="noopener">查看我之前的帖子</a>。</li></ul></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="f087" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请阅读我的其他文章，并分享您的反馈。如果你喜欢分享的内容，请点赞、评论并订阅新文章。</p></div></div>    
</body>
</html>