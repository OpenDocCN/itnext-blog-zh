<html>
<head>
<title>Create a WireGuard® VPN with Netmaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Netmaker创建一个WireGuard VPN</h1>
<blockquote>原文：<a href="https://itnext.io/create-a-wireguard-vpn-with-netmaker-4f75b0e86bf6?source=collection_archive---------1-----------------------#2022-09-08">https://itnext.io/create-a-wireguard-vpn-with-netmaker-4f75b0e86bf6?source=collection_archive---------1-----------------------#2022-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8f180df5286f6106a7e2c012a95bc3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GtZgjKVATuujMVupUllM5g.png"/></div></div></figure><p id="4df6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">WireGuard在VPN提供商中越来越受欢迎，这是有充分理由的。它比旧的VPN协议要快得多，更不用说更小更高效了。</p><p id="798a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是如果你不想为NordVPN或者PrivateInternetAccess付费呢？好消息是，你可以用WireGuard托管你自己的WireGuard VPN。</p><p id="dbed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有几十篇文章描述了如何使用WireGuard创建VPN，但是我们将介绍如何使用<a class="ae kw" href="http://github.com/gravitl/netmaker" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Netmaker </strong> </a>来创建VPN，它有一些优点。</p><ol class=""><li id="94dc" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">你不必手动编写配置文件</li><li id="d7f4" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">它会自动缩放</li><li id="f121" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">它有一个漂亮的管理界面</li><li id="d3a4" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">从远程访问到网状网络，它能做的比标准的互联网VPN多得多。</li></ol><h1 id="7332" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">你需要什么</h1><ol class=""><li id="256c" class="kx ky iq ka b kb mj kf mk kj ml kn mm kr mn kv lc ld le lf bi translated">具有公共IP (VPS)的虚拟机。这台机器应该至少有1CPU和1GB RAM。我们推荐<a class="ae kw" href="https://m.do.co/c/496ffcf1e252" rel="noopener ugc nofollow" target="_blank">数字海洋</a>，因为他们有一些最好的出站网络价格(你的VPN需要很多)。</li><li id="ebdd" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">Linux。我们推荐Ubuntu 22.04，但是任何基于Debian的发行版都可以。</li><li id="e105" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">防火墙和安全组配置正确。暴露端口22、443和51821/UDP*。</li><li id="c7e4" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">(可选)如果您有要使用的域，请将通配符指向该计算机(例如:*.netmaker.mydomain.com)。如果您没有提供域名，netmaker会为您生成一个。</li></ol><p id="7cb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo"> *Netmaker每个网络需要一个公共端口，从51821开始。如果您计划部署额外的网络，您将希望打开一个范围，通常是51821–51830/UDP</em></p><h1 id="9068" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">部署Netmaker</h1><p id="ede5" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">一旦设置好虚拟机，您需要做的就是运行以下脚本:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1f5e" class="nb lm iq mx b gy nc nd l ne nf"><strong class="mx ir">Option #1 - If you have your own domain configured:</strong></span><span id="e7d8" class="nb lm iq mx b gy ng nd l ne nf">wget -qO - <a class="ae kw" href="https://gist.githubusercontent.com/afeiszli/381cb6bbeb69f7e1aa6966d2ccecd2a0/raw/b359112e5021c7f47cae7f2acaf0097e14571851/netmaker-vpn.sh" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/afeiszli/381cb6bbeb69f7e1aa6966d2ccecd2a0/raw/b359112e5021c7f47cae7f2acaf0097e14571851/netmaker-vpn.sh</a> | sudo bash -s -- -v true -m false -c 3 -d netmaker.mydomain.com -e example@email.com</span><span id="5e6f" class="nb lm iq mx b gy ng nd l ne nf"><strong class="mx ir">Option #2 - If you do not:</strong></span><span id="1aa3" class="nb lm iq mx b gy ng nd l ne nf">wget -qO - <a class="ae kw" href="https://gist.githubusercontent.com/afeiszli/381cb6bbeb69f7e1aa6966d2ccecd2a0/raw/b359112e5021c7f47cae7f2acaf0097e14571851/netmaker-vpn.sh" rel="noopener ugc nofollow" target="_blank">https://gist.githubusercontent.com/afeiszli/381cb6bbeb69f7e1aa6966d2ccecd2a0/raw/b359112e5021c7f47cae7f2acaf0097e14571851/netmaker-vpn.sh</a> | sudo bash -s -- -v true -m false -c 3</span></pre><p id="619d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker应该在几分钟内启动并运行。日志会给你地址来访问你的服务器。</p><h1 id="9cb1" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">本地安装WireGuard</h1><p id="dbf2" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">要使用Netmaker VPN，您接下来必须在您的设备上安装WireGuard。安装说明可在<a class="ae kw" href="https://www.wireguard.com/install/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="738b" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">访问网络制造商</strong></h1><p id="03ae" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">转到日志中的域，并创建您的管理员用户</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/24a91c400e8043214eb6c8b8f5f1e21d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RnXfufbzidX9E9uE-0lhcg.png"/></div></div></figure><p id="03b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">登录后，您可以下载并使用您的Netmaker客户端。</strong></p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/e094096f46e573fe7b1b4203161cbbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lI1vVcYE_CKETMUi_I8h9Q.png"/></div></div></figure><p id="f8e2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">点击“外部客户”</strong></p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/c189f6745c6cf16fe2ae78a45a99b768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N5axv70ZGvuQmsqAOIhzGA.png"/></div></div></figure><p id="6c2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">下载vpnclient-1 </strong>的配置文件，或者使用手机扫描二维码。如果您要将多个设备加入VPN，您可以单击左侧的“添加外部客户端”来创建更多设备。</p><h1 id="10f4" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">运行客户端</h1><p id="22dc" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated"><strong class="ka ir">在Linux或Mac上</strong>，一旦安装了WireGuard，只需运行“wg-quick up /path/to/conf/file”。</p><p id="bf9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在Windows </strong>上，打开WireGuard app，导入conf文件。</p><p id="799a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在iPhone或Android上</strong>，打开WireGuard app，扫描UI中的二维码。</p><p id="2932" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要确认它的工作，去whatsmyip.com，看看IPv4地址现在等于Netmaker服务器的IP。</p><p id="64ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！您现在运行的是Netmaker VPN。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="0fb0" class="ll lm iq bd ln lo nr lq lr ls ns lu lv lw nt ly lz ma nu mc md me nv mg mh mi bi translated"><strong class="ak">接下来的步骤</strong></h1><p id="f181" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">如果您将Netmaker用作互联网VPN，您可能需要考虑Netmaker的其他使用案例。主要是:远程访问您的设备/服务器/网络。Netmaker允许您部署“节点”来直接访问任何环境中的设备，包括您的家庭或办公室网络。</p><p id="df43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将“节点”部署到网络中的服务器上，您的客户端设备就可以立即访问。此外，在该节点上创建一个“出口网关”，现在客户端设备可以访问整个远程网络中的任何内容！查看本指南，了解<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/how-to-deploy-a-wireguard-vpn-for-aws-remote-access-with-netmaker-a3b8d0f59af2">如何设置远程访问AWS环境</a>。</p><h1 id="cc5d" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">其他注意事项</h1><p id="60a3" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">默认情况下，Netmaker服务器不会路由IPv6。您的VPS可能没有启用IPv6，即使启用了，在Docker中设置IPv6也非常具有挑战性。如果您想要创建路由IPv6流量(除IPv4之外)的互联网网关，我们建议您:</p><ol class=""><li id="1933" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">创建具有“双栈”的Netmaker网络</li><li id="8811" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">将第二台虚拟机作为“节点”添加到网络中，作为您的入口/出口网关。此机器必须启用IPv6</li><li id="f589" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">如下所述，将机器设置为入口/出口网关(问题#2)，并记住除了将“0.0.0.0/0”设置为网关范围之外，还要将“::/0”设置为网关范围。</li></ol></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="41b8" class="ll lm iq bd ln lo nr lq lr ls ns lu lv lw nt ly lz ma nu mc md me nv mg mh mi bi translated">可选配置:减少仪表板访问</h1><p id="d020" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">Netmaker有一个很棒的管理用户界面来控制你的网络。你可能不希望这件事暴露在公众面前。要将仪表板缩小到您的本地IP地址(例如，1.2.3.4)，您可以<a class="ae kw" href="https://docs.netmaker.org/server-installation.html#security-settings" rel="noopener ugc nofollow" target="_blank">遵循这些步骤</a>。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><h1 id="3a7d" class="ll lm iq bd ln lo nr lq lr ls ns lu lv lw nt ly lz ma nu mc md me nv mg mh mi bi translated">解决纷争</h1><h2 id="2d04" class="nb lm iq bd ln nw nx dn lr ny nz dp lv kj oa ob lz kn oc od md kr oe of mh og bi translated">问题#1: Traefik连接不起作用</h2><p id="8c36" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">你的日志里有这个吗？</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="42d6" class="nb lm iq mx b gy nc nd l ne nf">testing Traefik setup (please be patient, this may take 1-2 minutes)<br/>    issue establishing connection...retrying in 15 seconds...<br/>    issue establishing connection...retrying in 20 seconds...<br/>    issue establishing connection...retrying in 25 seconds...<br/>    issue establishing connection...retrying in 30 seconds...</span></pre><p id="8958" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Traefik可能在您的DNS /证书颁发方面存在问题。然后查看你的docker日志</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="22a5" class="nb lm iq mx b gy nc nd l ne nf">docker logs traefik</span></pre><p id="79ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这应该会告诉您证书的问题。如果不使用自己的域，一个常见的问题是“nip.io”是有速率限制的，这意味着你要么需要稍后再试，要么获得自己的域。</p><h2 id="2f67" class="nb lm iq bd ln nw nx dn lr ny nz dp lv kj oa ob lz kn oc od md kr oe of mh og bi translated">问题#2:入口/出口没有自动设置</h2><p id="6364" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">有时安装脚本并不那么聪明。如果你遇到问题。尝试对出口网关执行以下<a class="ae kw" href="https://docs.netmaker.org/egress-gateway.html#nat-gateway" rel="noopener ugc nofollow" target="_blank">步骤。</a></p><p id="a2f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，确保设置了“默认外部客户端DNS”字段。编辑网络并确保该字段已设置(此图中的<a class="ae kw" href="https://docs.netmaker.org/_images/ui-3.jpg" rel="noopener ugc nofollow" target="_blank"># 12</a>)。“地址应该是10.201.255.254(无论节点netmaker-1设置为什么)。</p><p id="4b99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，<a class="ae kw" href="https://docs.netmaker.org/external-clients.html" rel="noopener ugc nofollow" target="_blank">将netmaker服务器设置为入口网关</a>以生成ext客户端。</p><h2 id="8e4a" class="nb lm iq bd ln nw nx dn lr ny nz dp lv kj oa ob lz kn oc od md kr oe of mh og bi translated">问题#3:客户端无法连接</h2><p id="1202" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">如果客户端没有连接到VPN(不能访问互联网)，这可能是由于bash脚本中的竞争条件(客户端配置创建得太快)。在这种情况下，转到Ext Client部分并“创建”另一个VPN客户端。这应该可以解决竞争情况，并且您的现有客户端配置应该可以工作。</p><p id="3225" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mo">免责声明:</em></strong><em class="mo"/><a class="ae kw" href="https://wireguard.com/" rel="noopener ugc nofollow" target="_blank"><em class="mo">wire guard</em></a><em class="mo">是Jason A. Donenfeld的注册商标。</em></p></div></div>    
</body>
</html>