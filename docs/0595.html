<html>
<head>
<title>Move your API outside your application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的API移到应用程序之外</h1>
<blockquote>原文：<a href="https://itnext.io/move-your-api-outside-your-application-b07ba6809412?source=collection_archive---------0-----------------------#2018-04-07">https://itnext.io/move-your-api-outside-your-application-b07ba6809412?source=collection_archive---------0-----------------------#2018-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3972" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">修复我之前帖子的错误</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8fbd8695048b7826f77f23946b89079b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0Twvblvt3fcXlnio4J-TQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">当您将所有应用程序逻辑移动到API层时</figcaption></figure><p id="36ff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">到目前为止，我发表了一篇关于编写API请求的最常见错误的文章，并展示了Apicase的一些特性。你可以在这里阅读。</p><div class="lr ls gp gr lt lu"><a rel="noopener  ugc nofollow" target="_blank" href="/the-most-common-mistake-of-writing-api-requests-4eda46dce03d"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd ir gy z fp lz fr fs ma fu fw ip bi translated">编写API请求最常见的错误</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">大家好！今天我将再次谈论API请求组织，并且我将提出一点建议</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">itnext.io</p></div></div><div class="md l"><div class="me l mf mg mh md mi kp lu"/></div></div></a></div><p id="f050" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在此之后，我得到了一个公平的评论。正如我在最后所说的，在服务内部处理API请求<em class="mj"/>会使你的API层不灵活，并且与应用程序不可分割。<br/>不好，<strong class="kx ir">但是……</strong>我们能修好！所以，我不会占用你太多时间。</p><h1 id="8f06" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们拥有的</h1><p id="bb3a" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">假设我们有这样的API层:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/508b7465698cd7e4dcc1adac742b149a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-XTOwT1KOw_It-fngSlwQQ.png"/></div></div></figure><p id="c480" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为什么不好？</p><blockquote class="ni nj nk"><p id="cd7d" class="kv kw mj kx b ky kz jr la lb lc ju ld nl lf lg lh nm lj lk ll nn ln lo lp lq ij bi translated">我们不能在另一个应用中使用这个API层，因为它太依赖app结构了。正如Roma Sabirov和reddit的一些人所说——API不应该知道你的应用程序。</p></blockquote><p id="9ecf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> #1和#4。</strong>将商店直接连接到API层使得无法在另一个应用程序中使用<br/> <strong class="kx ir"> #2和#3 </strong>。从侧面获取数据并对其进行设置也可能会导致问题。如果我们的另一个应用程序也使用<code class="fe nq nr ns nt b">token</code>并且它不同于API要求的令牌，该怎么办？</p><p id="deb3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我一直讨厌不可重用的代码，所以我会讨厌我以前的帖子<strong class="kx ir">但是……</strong>一点也不。因为我们可以走另一条路。</p><h1 id="176d" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们如何修复它？</h1><p id="29bd" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">我们只需要从我们的API层中移除所有的边绑定。<br/>清晰的API树将会是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/96c091d775c8049d23356d0b6a45c687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*902Le0ZCwV95stOEWPihng.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">漂亮干净，比我想要的还要干净</figcaption></figure><p id="03ec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">–<em class="mj">但是我们为什么需要一个案例呢？我们可以将原始json放入fetch中。我们将在哪里处理我们的API？回到商店，划掉你所有的建议？</em></p><p id="a10e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">不</strong>你仍然可以在API层处理你的API，但是在其他地方会有所不同。<br/>我们将导入我们的API并远程添加监听器<em class="mj"/>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/b0962c42461f3e7d87f956c2f20e30cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Om1UcLvMdQUIHAmkrJN4w.png"/></div></div></figure><p id="6711" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们需要返回我们的商店绑定和授权，所以我们可以这样做:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/7f69c925921ae41254c1d930d3060554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EryjfotSWaKegrutwVy5w.png"/></div></div></figure><blockquote class="ni nj nk"><p id="f9fe" class="kv kw mj kx b ky kz jr la lb lc ju ld nl lf lg lh nm lj lk ll nn ln lo lp lq ij bi translated">现在我们可以将我们的<code class="fe nq nr ns nt b">apis/tree.js</code>移到应用程序之外，例如，移到<code class="fe nq nr ns nt b">@myorg/api</code>包中，并在我们所有的应用程序中使用它。</p></blockquote><h1 id="b683" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们可以改进什么？</h1><p id="0a52" class="pw-post-body-paragraph kv kw iq kx b ky nc jr la lb nd ju ld le ne lg lh li nf lk ll lm ng lo lp lq ij bi translated">在我们的<code class="fe nq nr ns nt b">apis/tree.js</code>中，我们可以添加一些不依赖于API的特定于API的检查。例如，我们可以添加有效负载验证:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/1725047be19dd0e4d7c5670ab435142c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hq_XgLiE4j3_I4R2akHtAQ.png"/></div></div></figure><p id="84a5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">而且，最重要的是你不需要在你的应用程序代码中写API。只有业务逻辑和使用API，就像它只是一个有一些方法的库。</p><h1 id="7377" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">待办事项</h1><ul class=""><li id="de8e" class="nu nv iq kx b ky nc lb nd le nw li nx lm ny lq nz oa ob oc bi translated">基于模式、文档或smth的API自动生成(例如swagger)</li><li id="4fe3" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated">添加定义服务的<em class="mj">转换器</em>回调的机会，以减少请求代码</li><li id="b382" class="nu nv iq kx b ky od lb oe le of li og lm oh lq nz oa ob oc bi translated">写一些(内置？)测试/验证工具</li></ul><p id="8322" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你还没有尝试过apcase——是时候修正它了！</p><div class="lr ls gp gr lt lu"><a href="https://github.com/apicase/core" rel="noopener  ugc nofollow" target="_blank"><div class="lv ab fo"><div class="lw ab lx cl cj ly"><h2 class="bd ir gy z fp lz fr fs ma fu fw ip bi translated">API case/核心</h2><div class="mb l"><h3 class="bd b gy z fp lz fr fs ma fu fw dk translated">core - 2 KB库，以一种智能的方式组织您的API</h3></div><div class="mc l"><p class="bd b dl z fp lz fr fs ma fu fw dk translated">github.com</p></div></div><div class="md l"><div class="oi l mf mg mh md mi kp lu"/></div></div></a></div><p id="e98b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">祝你好运；)</p></div></div>    
</body>
</html>