<html>
<head>
<title>Helm 3 in real life (part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现实生活中的舵手3(下)</h1>
<blockquote>原文：<a href="https://itnext.io/helm-3-in-real-life-dfdc1522dd04?source=collection_archive---------3-----------------------#2020-02-08">https://itnext.io/helm-3-in-real-life-dfdc1522dd04?source=collection_archive---------3-----------------------#2020-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c273d9d32c5758ccffa10396d53d03f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_j5weh3mWGcRdniS"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">凯文·Ku在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="5f67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几周前，我写了一篇关于Helm2和Helm3之间变化的文章:</p><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/helm2-vs-helm3-part-1-c76c29106e99"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">Helm2与Helm3(第一部分)</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">所以Helm3终于发布了。每个人都在和蒂勒说再见，但这并不是《头盔3》的唯一变化。让我们…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">itnext.io</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><p id="1e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从那以后，我一直使用Helm3进行私有测试和客户端测试。所以我又来了——准备和你分享一些你在使用Helm3时会遇到的问题。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="5317" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">您需要做出的更改:</h1><p id="5622" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated"><strong class="kf ir">重写你所有的CI/CD管道</strong>。有一些变化需要您重写所有的CI/CD管道。我在上一篇文章中已经列出了它们(删除helm init，需要指定名称，需要存在名称空间，等等)，但是我需要在这里再次指出，因为这是迄今为止大多数公司面临的最大问题。查看杰克·莫里斯的一篇关于这个的文章:</p><div class="lb lc gp gr ld le"><a rel="noopener  ugc nofollow" target="_blank" href="/breaking-changes-in-helm-3-and-how-to-fix-them-39fea23e06ff"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">头盔3的突破性变化(以及如何修复它们)</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">最近我很幸运地测试了从头盔2到头盔3的迁移。头盔3是一个主要版本，解决了许多…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">itnext.io</p></div></div><div class="ln l"><div class="nd l lp lq lr ln ls jw le"/></div></div></a></div><p id="ee24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">管道可能会非常复杂，找到所有必要的掌舵零件的变化可能会比你想象的更棘手。因此，请仔细检查您是否删除了所有helm inits，是否在安装helm3图表之前创建了名称空间，是否提供了名称(或使用— generate-name)等。我见过一些情况，大多数使用的管道被适当地改变了，但是那些不经常使用的管道(例如回滚管道)却没有。这是一个危险的情况，因为你可能已经对Helm3充满信心，然后当你决定转向生产时，它会打击你。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="dd7f" class="ma mb iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">您可能面临的问题:</h1><p id="afbb" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated"><strong class="kf ir"> CRD安装—它失败了，但它没有</strong></p><p id="316e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装包含CRD的舵图时，您可能会看到以下错误:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/b17470a48483fd69e476929b148d95ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C37qDGNKZSca0C6slQIMUw.png"/></div></div></figure><p id="5b9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">别慌！这实际上是一个假错误，它们已被正确安装:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/1b08010b8cbfab0f602912289c1ef7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2NqtYd3g9Ur7pibnqKrzNA.png"/></div></div></figure><p id="3218" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您会看到这个错误，因为Helm 3不赞成使用crd的钩子，现在有了一个策略，它们应该在CRD目录中。但是它还是安装了它们；)更多信息请点击此处:</p><div class="lb lc gp gr ld le"><a href="https://v3.helm.sh/docs/topics/charts_hooks/" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">图表挂钩</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">Helm提供了一种挂钩机制，允许图表开发人员在某个版本的生命周期中的某些点进行干预。对于…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">v3.helm.sh</p></div></div><div class="ln l"><div class="nk l lp lq lr ln ls jw le"/></div></div></a></div><p id="f6b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">“升级失败:呈现的清单包含一个已经存在的新资源”</strong></p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/0e03a317c329d7c0b3d92f963b1ea7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zGeYtdY-02YJCiCK00ZH_A.png"/></div></div></figure><p id="06b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一个讨厌的问题。当你尝试运行“头盔升级”时，有时可能会发生这种情况。但是你可能想知道…等等…三路合并补丁(升级时考虑实时状态)不是头盔3的关键特性之一吗？那么为什么我的升级会因为“资源已经存在”而失败呢？？？这个特殊的问题有点复杂，不幸的是，错误消息没有正确解释这里发生了什么。您看，只有当您更改资源的“apiVersion ”,然后尝试升级它时，才会出现这个问题。如果你想改变其他任何东西(元数据，规范)，那么它会像预期的那样工作得很好。但是如果你改变这个:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/1b8ebcc60fb23c04f04f3871cbce1eeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29zQM9s2Spqx1Zg7IrKetA.png"/></div></div></figure><p id="1950" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对此:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/84e302dddb06c7a2fb3364336fb32507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*eYkRQfb20soibu-E8j7fbw.png"/></div></figure><p id="bd93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">…那么它将失败，因为kubernetes将apiVersion更改视为重大更改，并且不允许像这样更改它。这需要一些地下逻辑来实现，但赫尔姆3没有实现(<a class="ae kc" href="https://github.com/helm/helm/issues/6850" rel="noopener ugc nofollow" target="_blank">但</a>)。有一个解决方法——您可以手动升级特定资源(通过kubectl ),然后删除特定图表的Helm secret。或者只是在Helm修复问题之前不要升级apiVersion)</p></div></div>    
</body>
</html>