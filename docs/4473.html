<html>
<head>
<title>Guide: Installing an OKD 4.5 Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">指南:安装OKD 4.5集群</h1>
<blockquote>原文：<a href="https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee?source=collection_archive---------0-----------------------#2020-07-07">https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee?source=collection_archive---------0-----------------------#2020-07-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6672" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"><em class="ko">2020年7月29日更新</em> </strong></p><p id="0f80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kp" href="https://okd.io/" rel="noopener ugc nofollow" target="_blank"> OKD </a>是红帽OpenShift容器平台(OCP)的上游和社区支持版本。OpenShift将vanilla Kubernetes扩展成一个为企业大规模使用而设计的应用程序平台。从<a class="ae kp" href="https://blog.openshift.com/introducing-red-hat-openshift-4/" rel="noopener ugc nofollow" target="_blank"> OpenShift 4 </a>发布开始，默认的操作系统是<a class="ae kp" href="https://docs.openshift.com/container-platform/4.1/architecture/architecture-rhcos.html" rel="noopener ugc nofollow" target="_blank"> Red Hat CoreOS </a>，它提供了不可变的基础设施和自动更新。<a class="ae kp" href="https://getfedora.org/en/coreos/" rel="noopener ugc nofollow" target="_blank"> Fedora CoreOS </a>和OKD一样，是红帽CoreOS的上游版本。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/4fa96facb049f8009c242e85a0c37ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L735KrMVH1ul3wEe.png"/></div></div></figure><p id="460e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过使用OKD和FCOS的开源上游组合(Fedora CoreOS)来构建您的集群，您可以在您的家庭实验室中体验OpenShift。如今，运行OKD集群的家庭实验室的二手硬件相对便宜(<a class="ae kp" href="https://www.ebay.com/sch/i.html?_from=R40&amp;_trksid=m570.l1313&amp;_nkw=server+96gb&amp;_sacat=0&amp;LH_TitleDesc=0&amp;_osacat=0&amp;_odkw=server+96gb" rel="noopener ugc nofollow" target="_blank">$ 250-$ 350</a>)，尤其是与每月花费超过250美元的云托管解决方案相比。</p><p id="31f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本指南的目的是帮助您成功构建OKD 4.5集群，以便您能够开发并学习使用OpenShift和OKD。</p><p id="e04e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意:</strong>在本指南中，我使用VMWare ESXi作为虚拟机管理程序，但您也可以使用Hyper-V、libvirt、Proxmox、VirtualBox，甚至裸机。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="6287" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">虚拟机概述:</h1><p id="105b" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">对于我的安装，我使用了一台ESXi 6.5主机，具有96GB的RAM和一个为OKD配置的独立VLAN。以下是虚拟机的分类:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mm"><img src="../Images/e8a9b172e2785ee161441a0686a56b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ocY4IMoIwahYA6Tz3MFhLA.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mn"><img src="../Images/2996252f784e339aa8bb0f743b2bb007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ry6DtAae0KqF44_QNEeaw.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="feed" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在VMWare中为OKD创建一个新网络:</h1><p id="ca60" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">登录您的VMWare主机。选择网络→端口组→添加端口组。在一个未使用的VLAN上建立一个OKD网络，在我的例子中是VLAN 20。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/86d12b85659b874f456a61f1d9d3bbac.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*0meRWgMa_dY-QujAemLpnA.png"/></div></figure><p id="6fe3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">命名您的群并设置您的VLAN ID。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/c0dc2d55650c1d89701350f2100937b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/0*fabO4vS_utBpPZf-.png"/></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="75c7" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创建ok D4-服务虚拟机:</h1><p id="ce26" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated"><a class="ae kp" href="https://www.centos.org/download/" rel="noopener ugc nofollow" target="_blank">下载</a>CentOS 8 ISO DVD。示例:<a class="ae kp" href="http://isoredirect.centos.org/centos/8/isos/x86_64/CentOS-8.2.2004-x86_64-dvd1.iso" rel="noopener ugc nofollow" target="_blank">CentOS-8 . 2 . 2004-x86 _ 64-DVD 1 . iso</a>并将其上传到您的ESXi主机数据存储。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/7b9bde61b72a897a5b0ad0062d905022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*lA2rwyM2i6FY7e0RedVgxg.png"/></div></figure><p id="7d07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建新的虚拟机。选择来宾操作系统为<em class="ko"> Linux </em>，选择CentOS 7 (64位)。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mr"><img src="../Images/d789a3186e6730d67ac5ffbde3e5732d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yKQ_IBxZl2RBSA8GZ4ScLQ.png"/></div></div></figure><p id="701b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择数据存储，并将设置自定义为4个vCPU、4GB RAM、100GB HD。向OKD网络添加第二个网络适配器。附上CentOS ISO。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ms"><img src="../Images/56b11e1d92425b272a6378965b391bf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lydgonnJOlhjVvAnW8Pagw.png"/></div></div></figure><p id="7592" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查您的设置，然后单击完成。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mt"><img src="../Images/80065e283b7f477b217677d41968f79e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bo2ytqvcsh-B1AsmpZrsHg.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="e62b" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在okd4-services虚拟机上安装CentOS 8:</h1><p id="e28b" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">运行CentOS 8安装。</p><p id="f437" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我更喜欢使用“标准分区”存储配置，而不为/home安装存储。在“安装目标”页面上，单击存储配置下的自定义，然后单击完成。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mu"><img src="../Images/edb4ad4e550791dc36076fad46f028ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fuXQBF2_bvBAAofRgfGORg.png"/></div></div></figure><p id="14c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在手动分区页面上，选择标准分区，然后单击“单击此处自动创建它们”</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mu"><img src="../Images/60ea9aad8629b98785470e71117f2bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bK9WydcQeFA8q4TwQPOEA.png"/></div></div></figure><p id="abce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择“/home”分区，然后单击“-”将其删除。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mn"><img src="../Images/46eb8edc040ff29ac1eabcb87fc9b1f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QyfdiG1mE-nYixTsHFHoQ.png"/></div></div></figure><p id="452a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">删除“Desired Capacity”字段的内容，使其为空，并单击Done，然后接受更改。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mv"><img src="../Images/f5141a326619294e82b74ab874098e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MhKEWGBiQj0DtYm8xfvCAw.png"/></div></div></figure><p id="e8a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于软件选择，使用带GUI的服务器并添加来宾代理。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mw"><img src="../Images/0e040b207cb7a9bb3064b019c17c8e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lotoyM4iL_2FEJnLWsgHjg.png"/></div></div></figure><p id="1797" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启用连接到虚拟机网络的NIC，并将主机名设置为okd4-services，然后单击Apply和Done。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mx"><img src="../Images/21b3a1876d34076fe0ee79074c1abd10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5EFyroqPFy02wMESvujnA.png"/></div></div></figure><p id="e2a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单击“开始安装”开始安装。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi my"><img src="../Images/002f4de0b8f39efdb3e4891e8afeaadf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMp6XAokjDrjdR2qChWLfw.png"/></div></div></figure><p id="fda9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设置Root密码，并创建一个管理员用户。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mv"><img src="../Images/c729f813ed3063a4390f86b77cb5cec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98LZMbkXxh15JK0b-4iP8Q.png"/></div></div></figure><p id="f80f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，登录并更新操作系统。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="d6f8" class="ne lk it na b gy nf ng l nh ni">sudo dnf install -y epel-release<br/>sudo dnf update -y<br/>sudo systemctl restart</span></pre><p id="6bd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为从家庭网络远程访问设置XRDP</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="b33d" class="ne lk it na b gy nf ng l nh ni">sudo dnf install -y xrdp tigervnc-server<br/>sudo systemctl enable --now xrxp<br/>sudo firewall-cmd --zone=public --permanent --add-port=3389/tcp<br/>sudo firewall-cmd --reload</span></pre><p id="db32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下载Google Chrome rpm并和git一起安装</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nj"><img src="../Images/47c9c0385a5eaa7da7ea202cce3596d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHPQFCRB7tnebJ1UzYDOhQ.png"/></div></div></figure><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="0a96" class="ne lk it na b gy nf ng l nh ni">sudo dnf install -y ~/Downloads/google-chrome-stable_current_x86_64.rpm git</span></pre></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="7684" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创建okd4-pfsense虚拟机:</h1><p id="f072" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated"><a class="ae kp" href="https://www.pfsense.org/download/" rel="noopener ugc nofollow" target="_blank">下载pfSense ISO </a>并将其上传到您的ESXi主机的数据存储区。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nk"><img src="../Images/a5df5f696877e3b00c7d6e3cc2acc2ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtQZphPHFMqfwxpiNV6M2w.png"/></div></div></figure><p id="9dee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建新的虚拟机。选择Guest OS为<em class="ko"> Other </em>，选择FreeBSD 64位。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nl"><img src="../Images/8326e6d8cd50564fa8da3a1f632d9317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kv6oKuuaY0iJl8Ps.png"/></div></div></figure><p id="9b91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用资源的默认模板设置。</p><p id="3936" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为网络适配器1选择您的家庭网络，并使用OKD网络添加新的网络适配器。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nm"><img src="../Images/9dba9979a7cc204f81b5ec72de841b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tLLLg8fDH-MRXwC9.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="b356" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">设置okd4-pfsense虚拟机:</h1><p id="99a0" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">启动pfSense虚拟机，并使用所有默认值运行安装。完成后，您的虚拟机控制台应该如下所示:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nn"><img src="../Images/5a49406e302c5c9596d83751393f2e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OC4FiR7YnaylppZc0BipIw.png"/></div></div></figure><p id="aa64" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过okd4-services虚拟机上的网络浏览器登录到pfSense。默认用户名是“admin”，密码是“pfsense”。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi no"><img src="../Images/801d5a6918930e9a4733d3145f3af407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hmHs1rGVo5-3_K6llXPtQ.png"/></div></div></figure><p id="d586" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录后，单击next，对主机名使用“okd4-pfsense ”,对域使用“okd.local ”,并将192.168.1.210添加为主DNS服务器。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi np"><img src="../Images/a0eaeb132ea35e058df33d4f97d9020c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DDkq5D4zzcjZUIVSshVGw.png"/></div></div></figure><p id="f673" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择您的时区。下一个。</p><p id="deab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用WAN配置的默认值。取消选中“阻止RFC1918专用网络”,因为您的家庭网络是此设置中的“WAN”。下一个。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/4e56e5648ceaf0c0c7a82e141a19b767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/0*g43i9q94i5cYBpWc.png"/></div></figure><p id="cf60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用默认的局域网IP和子网掩码。在下一个屏幕上设置管理员密码。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ba35feac4df46d6cdb8bce66c9c9704d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*vn09crScFPiW2YvLU_kaMw.png"/></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="fd5b" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创建引导节点、主节点和工作节点:</h1><p id="dda6" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">下载<a class="ae kp" href="https://getfedora.org/coreos/download/" rel="noopener ugc nofollow" target="_blank"> Fedora CoreOS裸机ISO </a>并上传到您的ESXi数据存储。</p><p id="88e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">撰写本文时最新的稳定版本是32.20200715.3.0</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/df006a1c1eb60fc8d2cbdc8d71101fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*BPQcc9hi9raT1bKxYR14og.png"/></div></figure><p id="ff4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用本文开头的电子表格中的值，在您的ESXi主机上创建六个ODK节点(引导、主、工作节点):</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/f58e40d8950ff72c6cc971206ec0fe0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FgE-gSRknky5N1F-.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nu"><img src="../Images/4907b117541001da98f1d49b1c52c181.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k38vSduCd-NIXDdj.png"/></div></div></figure><p id="3f82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该最终拥有以下虚拟机:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nv"><img src="../Images/900f254cfb0363dc07e8b026589b6141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XUtjLhcSVkWz6sS7.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="35d5" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">设置DHCP保留:</h1><p id="89a7" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">通过查看虚拟机的硬件配置，编译OKD节点MAC地址列表。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nw"><img src="../Images/dd69b0b6e31494d02394d04f06df7d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*heNT5O0QzT_VgboAOK731g.png"/></div></div></figure><p id="e24f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录pfSense。转到服务→ DHCP服务器，将您的结束范围IP更改为192.168.1.99，并将主DNS服务器设置为192.168.1.210，然后单击保存。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nx"><img src="../Images/d18989cfa39af97c952ea2dc1336f69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLPNG84AINILuXaUOys4Zg.png"/></div></div></figure><p id="2b12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在DHCP服务器上，单击页面底部的添加。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ny"><img src="../Images/d14139b07b66e1184dec6f91789e1142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*37DfW3GN63IoEgnF.png"/></div></div></figure><p id="b262" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">填写MAC地址、IP地址和主机名，然后单击保存。为每个ODK虚拟机执行此操作。同时，在okd网络中加入okd4-services MAC。完成后，单击页面顶部的应用更改。S</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nz"><img src="../Images/73c388d9778236a0e09efa721e9f0868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iwvid62_MmL2Xl8MiykHxw.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="7a67" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">配置ok D4-服务虚拟机以托管各种服务:</h1><p id="95bf" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">okd 4-服务虚拟机用于提供DNS、NFS导出、web服务器和负载平衡。</p><p id="25dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在虚拟机硬件配置页面上复制连接到OKD网络的NIC的MAC地址，并使用IP地址192.168.1.210为该虚拟机设置DHCP预留。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oa"><img src="../Images/5169e409150ef67d73a35a1e067b9066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHAEX6Cfd3flzSZvfhbu_A.png"/></div></div></figure><p id="8dbc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后点击DHCP页面顶部的“应用更改”。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ob"><img src="../Images/bc5e1d20a399583cde75844fa78a78b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*geqj7CBxxOieXfllId6yxw.png"/></div></div></figure><p id="23a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上打开一个终端，克隆包含DNS、HAProxy和install-conf.yaml示例文件的okd4_files repo:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="e588" class="ne lk it na b gy nf ng l nh ni">cd<br/>git clone <a class="ae kp" href="https://github.com/CountPickering/okd4_files.git" rel="noopener ugc nofollow" target="_blank">https://github.com/cragr/okd4_files.git</a><br/>cd okd4_files</span></pre></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="9fe6" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">安装绑定(DNS)</h1><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="3d85" class="ne lk it na b gy nf ng l nh ni">sudo dnf -y install bind bind-utils</span></pre><p id="b4e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">复制命名的配置文件和区域:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="5746" class="ne lk it na b gy nf ng l nh ni">sudo cp named.conf /etc/named.conf<br/>sudo cp named.conf.local /etc/named/<br/>sudo mkdir /etc/named/zones<br/>sudo cp db* /etc/named/zones</span></pre><p id="4ef3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启用并启动命名:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="960d" class="ne lk it na b gy nf ng l nh ni">sudo systemctl enable named<br/>sudo systemctl start named<br/>sudo systemctl status named</span></pre><p id="9579" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建防火墙规则:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="30a7" class="ne lk it na b gy nf ng l nh ni">sudo firewall-cmd --permanent --add-port=53/udp<br/>sudo firewall-cmd --reload</span></pre><p id="05a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将连接到虚拟机网络(非okd)的okd4服务NIC上的DNS更改为127.0.0.1。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oc"><img src="../Images/7eb6c36f758afa2d4d6878ef73b8b086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaOVf1q0X8yUV-pq9ppfnQ.png"/></div></div></figure><p id="a489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上重新启动网络服务:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="1cb7" class="ne lk it na b gy nf ng l nh ni">sudo systemctl restart NetworkManager</span></pre><p id="88fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services上测试DNS。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="3bf8" class="ne lk it na b gy nf ng l nh ni">dig okd.local<br/>dig –x 192.168.1.210</span></pre><p id="55cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">DNS正常工作时，您应该会看到以下结果:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/80181fcb069c475a3bc040d8269a3c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFBqlwgO-P2yak2E6evmOg.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/a32159a6a09900ce9fac31341a48899e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*N3cqc6ieS_LoN8Bg7aD-Lg.png"/></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="b9a0" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">安装HAProxy:</h1><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="e4bb" class="ne lk it na b gy nf ng l nh ni">sudo dnf install haproxy -y</span></pre><p id="0ea1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从git okd4_files目录中复制haproxy配置:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="bc8a" class="ne lk it na b gy nf ng l nh ni">sudo cp haproxy.cfg /etc/haproxy/haproxy.cfg</span></pre><p id="7c20" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动、启用和验证HA代理服务:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="e783" class="ne lk it na b gy nf ng l nh ni">sudo setsebool -P haproxy_connect_any 1<br/>sudo systemctl enable haproxy<br/>sudo systemctl start haproxy<br/>sudo systemctl status haproxy</span></pre><p id="e14d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加OKD防火墙端口:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="66a6" class="ne lk it na b gy nf ng l nh ni">sudo firewall-cmd --permanent --add-port=6443/tcp<br/>sudo firewall-cmd --permanent --add-port=22623/tcp<br/>sudo firewall-cmd --permanent --add-service=http<br/>sudo firewall-cmd --permanent --add-service=https<br/>sudo firewall-cmd --reload</span></pre><h1 id="d4f0" class="lj lk it bd ll lm of lo lp lq og ls lt lu oh lw lx ly oi ma mb mc oj me mf mg bi translated">安装阿帕奇/HTTPD</h1><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="886b" class="ne lk it na b gy nf ng l nh ni">sudo dnf install -y httpd</span></pre><p id="fc55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将httpd监听端口更改为8080:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="e06b" class="ne lk it na b gy nf ng l nh ni">sudo sed -i 's/Listen 80/Listen 8080/' /etc/httpd/conf/httpd.conf</span></pre><p id="644b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在防火墙上启用并启动httpd服务/允许端口8080:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="c829" class="ne lk it na b gy nf ng l nh ni">sudo setsebool -P httpd_read_user_content 1<br/>sudo systemctl enable httpd<br/>sudo systemctl start httpd<br/>sudo firewall-cmd --permanent --add-port=8080/tcp<br/>sudo firewall-cmd --reload</span></pre><p id="c499" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试web服务器:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="f35c" class="ne lk it na b gy nf ng l nh ni">curl localhost:8080</span></pre><p id="72a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">成功的卷发应该是这样的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ok"><img src="../Images/0cadbbbd27fe4de9b78555da00b636cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AlA9oZvObGUo9FmIU6K6jQ.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="aeed" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">恭喜你，你已经成功了一半！</h1><p id="c8f6" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">恭喜你。现在，您应该有了一个单独的家庭实验室环境设置，并为ODK做好了准备。现在我们可以开始安装了。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="9a62" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">下载openshift-installer和oc客户端:</h1><p id="af5d" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">到okd 4-服务虚拟机的SSH</p><p id="cd1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要下载最新的oc客户端和openshift-install二进制文件，您需要使用oc客户端的现有版本。</p><p id="1c11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<a class="ae kp" href="https://github.com/openshift/okd/releases" rel="noopener ugc nofollow" target="_blank"> OKD发布页面</a>下载4.5版本的oc客户端并打开shift-install。示例:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="87cc" class="ne lk it na b gy nf ng l nh ni">cd<br/>wget https://github.com/openshift/okd/releases/download/4.5.0-0.okd-2020-07-29-070316/openshift-client-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz<br/>wget https://github.com/openshift/okd/releases/download/4.5.0-0.okd-2020-07-29-070316/openshift-install-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz</span></pre><p id="dd11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">解压oc客户端的okd版本，打开shift-install:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="c2ab" class="ne lk it na b gy nf ng l nh ni">tar -zxvf openshift-client-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz<br/>tar -zxvf openshift-install-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz</span></pre><p id="5b44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将kubectl、oc和openshift-install移动到/usr/local/bin并显示版本:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="e99a" class="ne lk it na b gy nf ng l nh ni">sudo mv kubectl oc openshift-install /usr/local/bin/<br/>oc version<br/>openshift-install version</span></pre><p id="cefd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最新版本可在https://origin-release.svc.ci.openshift.org<a class="ae kp" href="https://origin-release.svc.ci.openshift.org/" rel="noopener ugc nofollow" target="_blank">获得</a></p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="4c90" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">设置openshift-installer:</h1><p id="d9db" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在install-config.yaml中，您可以使用来自RedHat的pull-secret或默认的" { " auths ":{ " fake ":{ " auth ":" bar " } } "作为pull-secret。</p><p id="9e76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还没有SSH密钥，请生成一个。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="10a2" class="ne lk it na b gy nf ng l nh ni">ssh-keygen</span></pre><p id="33e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建安装目录并复制install-config.yaml文件:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="a68c" class="ne lk it na b gy nf ng l nh ni">cd<br/>mkdir install_dir<br/>cp okd4_files/install-config.yaml ./install_dir</span></pre><p id="71ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在install_dir中编辑install-config.yaml，插入您的pull secret和ssh密钥，并备份install-config.yaml，因为它将在下一步中被删除:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="8844" class="ne lk it na b gy nf ng l nh ni">vim ./install_dir/install-config.yaml<br/>cp ./install_dir/install-config.yaml ./install_dir/install-config.yaml.bak</span></pre><p id="74c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为集群生成Kubernetes清单，忽略警告:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="54e2" class="ne lk it na b gy nf ng l nh ni">openshift-install create manifests --dir=install_dir/</span></pre><p id="5a58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">修改cluster-scheduler-02-config . YAML清单文件，以防止在控制平面计算机上调度pod:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="ed97" class="ne lk it na b gy nf ng l nh ni">sed -i 's/mastersSchedulable: true/mastersSchedulable: False/' install_dir/manifests/cluster-scheduler-02-config.yml</span></pre><p id="95bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以创建点火配置:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="ebd6" class="ne lk it na b gy nf ng l nh ni">openshift-install create ignition-configs --dir=install_dir/</span></pre><p id="dffa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意:</strong>如果重用install_dir，确保它是空的。隐藏文件是在生成配置后创建的，在第二次尝试使用同一文件夹之前，应该删除这些文件。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="1eeb" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">在web服务器上托管点火和Fedora CoreOS文件:</h1><p id="001b" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在/var/www/html中创建okd4目录:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="c8bd" class="ne lk it na b gy nf ng l nh ni">sudo mkdir /var/www/html/okd4</span></pre><p id="118f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将install_dir内容复制到/var/www/html/okd4并设置权限:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="7867" class="ne lk it na b gy nf ng l nh ni">sudo cp -R install_dir/* /var/www/html/okd4/<br/>sudo chown -R apache: /var/www/html/<br/>sudo chmod -R 755 /var/www/html/</span></pre><p id="55f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试web服务器:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="f8e2" class="ne lk it na b gy nf ng l nh ni">curl localhost:8080/okd4/metadata.json</span></pre><p id="0a4d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下载<a class="ae kp" href="https://getfedora.org/coreos/download/" rel="noopener ugc nofollow" target="_blank"> Fedora CoreOS </a>裸机bios镜像和sig文件，并缩短文件名:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="940c" class="ne lk it na b gy nf ng l nh ni">cd /var/www/html/okd4/<br/>sudo wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/32.20200715.3.0/x86_64/fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz<br/>sudo wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/32.20200715.3.0/x86_64/fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz.sig<br/>sudo mv fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz fcos.raw.xz<br/>sudo mv fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz.sig fcos.raw.xz.sig<br/>sudo chown -R apache: /var/www/html/<br/>sudo chmod -R 755 /var/www/html/</span></pre></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="1e17" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">启动引导节点:</h1><p id="daaf" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">打开odk4引导虚拟机的电源。按TAB键编辑内核引导选项，并添加以下内容:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="61a9" class="ne lk it na b gy nf ng l nh ni">coreos.inst.install_dev=/dev/sda coreos.inst.image_url=http://192.168.1.210:8080/okd4/fcos.raw.xz coreos.inst.ignition_url=http://192.168.1.210:8080/okd4/<strong class="na iu">bootstrap.ign</strong></span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/764dcb07d8b5362a8718c04a1b681402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*HFEx62qxUMZaC9rheNXhjg.png"/></div></figure><p id="6caf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该看到fcos.raw.gz图像和签名正在下载:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi om"><img src="../Images/b607f38cd40f7e80eea71ecc1a91b89d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2aQbmDxM0TV-X-mDEhOgA.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="6ac3" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">启动控制平面节点:</h1><p id="72cb" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">打开控制面板节点的电源，按TAB键编辑内核引导选项并添加以下内容，然后按enter键:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="0e5f" class="ne lk it na b gy nf ng l nh ni">coreos.inst.install_dev=/dev/sda coreos.inst.image_url=http://192.168.1.210:8080/okd4/fcos.raw.xz coreos.inst.ignition_url=http://192.168.1.210:8080/okd4/<strong class="na iu">master.ign</strong></span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1fdb80239cd2fa9332982b6e1b39cf20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*zMsj7lU9NZSUMS0hkZQEQA.png"/></div></figure><p id="aeaa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该看到fcos.raw.gz图像和签名正在下载:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oo"><img src="../Images/3aec62b87a1dea48fd7c4a7f98c7c9da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*066Mq8c8LDK0r-C_0P8Vdg.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="08be" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">启动计算节点:</h1><p id="b529" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">打开控制面板节点的电源，按TAB键编辑内核引导选项并添加以下内容，然后按enter键:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="ef2b" class="ne lk it na b gy nf ng l nh ni">coreos.inst.install_dev=/dev/sda coreos.inst.image_url=http://192.168.1.210:8080/okd4/fcos.raw.xz coreos.inst.ignition_url=http://192.168.1.210:8080/okd4/<strong class="na iu">worker.ign</strong></span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi op"><img src="../Images/c3b943c333f39556624880e3fbb7e496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*RcrNt6_cy8t1eI2bkwlP8g.png"/></div></figure><p id="5cf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该看到fcos.raw.gz图像和签名正在下载:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oo"><img src="../Images/18ef70c85dbf1f05dc2bc74d1f90c717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRI8MwStXddiVLPZrZ3PyA.png"/></div></div></figure><p id="509d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在引导过程完成之前，工作节点通常会显示以下内容:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/c69a0a60291e74574cbe8dc95caab5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQnBIHp7lsjjwV49FzgS5Q.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="d8d4" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">监控引导安装:</h1><p id="367a" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">您可以从okd4-services节点监控引导过程:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="900b" class="ne lk it na b gy nf ng l nh ni">openshift-install --dir=install_dir/ wait-for bootstrap-complete --log-level=info</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oq"><img src="../Images/f39a6a7922c6b7bf848e9106ca61ff6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7wCeIoRhJamm5V0a0OQBLQ.png"/></div></div></figure><p id="47a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">引导过程可能需要30分钟以上，完成后，您可以关闭引导节点。现在是编辑/etc/haproxy/haproxy.cfg、注释掉引导节点并重新加载haproxy服务的好时机。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="23b9" class="ne lk it na b gy nf ng l nh ni">sudo sed '/ okd4-bootstrap /s/^/#/' /etc/haproxy/haproxy.cfg<br/>sudo systemctl reload haproxy</span></pre></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="e8a5" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">登录集群并批准CSR:</h1><p id="7a34" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">现在主服务器已经联机，您应该能够登录oc客户端了。使用以下命令登录并检查集群的状态:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="7f32" class="ne lk it na b gy nf ng l nh ni">export KUBECONFIG=~/install_dir/auth/kubeconfig<br/>oc whoami<br/>oc get nodes<br/>oc get csr</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi or"><img src="../Images/0a4f18af736477c9bb0764ce34c1f8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Z7nm2Id1oRaXVqkQRqvdw.png"/></div></div></figure><p id="d6d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该只看到主节点和几个等待批准的CSR。安装jq包以帮助一次批准多个CSR。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="a181" class="ne lk it na b gy nf ng l nh ni">wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64<br/>chmod +x jq<br/>sudo mv jq /usr/local/bin/<br/>jq --version</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi os"><img src="../Images/cefa2d55eba4127fb54913d59cf90b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ecBr4WXV5riy2e-0Ues0Tg.png"/></div></div></figure><p id="7918" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">批准所有待定证书并检查您的节点:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="9def" class="ne lk it na b gy nf ng l nh ni">oc get csr -ojson | jq -r '.items[] | select(.status == {} ) | .metadata.name' | xargs oc adm certificate approve</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi os"><img src="../Images/529f987aa3ac7903c44159fb614a8eea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H7JFeU14e7lH4tSdQwE9Qw.png"/></div></div></figure><p id="ded0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查集群操作符的状态。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="4de9" class="ne lk it na b gy nf ng l nh ni">oc get clusteroperators</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ot"><img src="../Images/63f52d4ee946a3a95246f8ae8b6f6cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRynAuM2xugi-rYkQpGirA.png"/></div></div></figure><p id="c852" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">控制台刚刚在我上面的图片中可用。从install_dir/auth文件夹中获取您的kubeadmin密码，然后登录到web控制台:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="bad3" class="ne lk it na b gy nf ng l nh ni">cat install_dir/auth/kubeadmin-password</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/959d9e5e9611d75cad5b0e77e9e61fec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*DBReKdOs8IGuXLRTxwda1w.png"/></div></figure><p id="6c96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开您的网络浏览器到https://console-openshift-console.apps.lab.okd.local/的<a class="ae kp" href="https://console-openshift-console.apps.lab.okd.local/" rel="noopener ugc nofollow" target="_blank"/>，使用上面的密码以kubeadmin的身份登录:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ov"><img src="../Images/3b5a7ea17970ec269fcb0d42b62f6790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WPpdUz5K8r2SFbxbeBRFg.png"/></div></div></figure><p id="296a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">群集状态可能仍然显示正在升级，并且它会继续完成安装。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/b0c8082b23b5bbd3afbf37d7283c9d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7KJ032iCzz1nx5q3jdsbg.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="2d09" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">持久存储:</h1><p id="d0ba" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在我们完成这个项目之前，我们需要为我们的注册表创建一些持久存储。让我们将okd4-services VM配置为NFS服务器，并将其用于持久存储。</p><p id="02ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录到您的okd4-services虚拟机，并开始设置一个NFS服务器。以下命令安装必要的包，启用服务，并配置文件和文件夹权限。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="09fb" class="ne lk it na b gy nf ng l nh ni">sudo dnf install -y nfs-utils<br/>sudo systemctl enable nfs-server rpcbind<br/>sudo systemctl start nfs-server rpcbind<br/>sudo mkdir -p /var/nfsshare/registry<br/>sudo chmod -R 777 /var/nfsshare<br/>sudo chown -R nobody:nobody /var/nfsshare</span></pre><p id="88ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建NFS导出</p><p id="47fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在新的/etc/exports文件“/var/nfsshare 192.168.1.0/24(rw，sync，no_root_squash，no_all_squash，no_wdelay)”中添加这一行</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="902a" class="ne lk it na b gy nf ng l nh ni">echo '/var/nfsshare 192.168.1.0/24(rw,sync,no_root_squash,no_all_squash,no_wdelay)' | sudo tee /etc/exports</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi gj"><img src="../Images/7b667dc56abc7861fd40bb51ba8d96f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gPP260mUoiPRTwvQ.png"/></div></div></figure><p id="e9c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重新启动nfs服务器服务并添加防火墙规则:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="656f" class="ne lk it na b gy nf ng l nh ni">sudo setsebool -P nfs_export_all_rw 1<br/>sudo systemctl restart nfs-server<br/>sudo firewall-cmd --permanent --zone=public --add-service mountd<br/>sudo firewall-cmd --permanent --zone=public --add-service rpc-bind<br/>sudo firewall-cmd --permanent --zone=public --add-service nfs<br/>sudo firewall-cmd --reload</span></pre></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="f712" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">注册表配置:</h1><p id="9d00" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">在NFS共享上创建一个永久卷。使用git repo中okd4_files文件夹中的registry_py.yaml:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="2846" class="ne lk it na b gy nf ng l nh ni">oc create -f okd4_files/registry_pv.yaml<br/>oc get pv</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi my"><img src="../Images/f3e6fe0c62f5414a5fd941f3f84406a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKknSon2ajdalh0BHmIn8w.png"/></div></div></figure><p id="73c3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑图像注册表操作符:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="3658" class="ne lk it na b gy nf ng l nh ni">oc edit configs.imageregistry.operator.openshift.io</span></pre><p id="35e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将管理状态从“已删除”更改为“已管理”。在存储下:添加pvc:和claim: blank以附加PV并自动保存您的更改:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="171e" class="ne lk it na b gy nf ng l nh ni">managementState: Managed</span><span id="a8ed" class="ne lk it na b gy ow ng l nh ni">storage:<br/>    pvc:<br/>      claim:</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/248ee86b150163a81b82c723c8978ee7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*lL1gXuedWN9PTZFNt2_LiA.png"/></div></figure><p id="7608" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查您的持久卷，现在应该声明:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="00bb" class="ne lk it na b gy nf ng l nh ni">oc get pv</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oy"><img src="../Images/efa7b77c8f85f133ac92c4201c2c41b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OrCfr13nkL7TnLW6V2ONrQ.png"/></div></div></figure><p id="80c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查导出大小，它应该为零。在下一节中，我们将推送至注册表，文件大小不应为零。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="2076" class="ne lk it na b gy nf ng l nh ni">du -sh /var/nfsshare/registry</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/4a118c67e2474b91b6340cea67fbf314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*bdDeqoAB5BatRkEncx2xHw.png"/></div></figure><p id="e5cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一节中，我们将创建一个WordPress项目并将其推送到注册表中。推送后，NFS导出应该显示200+ MB。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="8377" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创建WordPress项目:</h1><p id="5fcb" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">创建一个新的OKD项目。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="d3aa" class="ne lk it na b gy nf ng l nh ni">oc new-project wordpress-test</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oy"><img src="../Images/d8055d74234add128be7e46dde6f194b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*445ForX3cxmfoHCAmZZg_A.png"/></div></div></figure><p id="99fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用docker hub中的centos php73 s2i映像创建一个新应用程序，并使用WordPress GitHub repo作为源代码。公开服务以创建路由。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="13a6" class="ne lk it na b gy nf ng l nh ni">oc new-app centos/php-73-centos7~<a class="ae kp" href="https://github.com/WordPress/WordPress.git" rel="noopener ugc nofollow" target="_blank">https://github.com/WordPress/WordPress.git</a><br/>oc expose svc/wordpress</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pa"><img src="../Images/cf83a28f8a4678da6e7c9152d86afc3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u4lXKsHFjqQeew41YXNeYg.png"/></div></div></figure><p id="401f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用centos7 MariaDB映像和一些环境变量创建一个新应用程序:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="99c6" class="ne lk it na b gy nf ng l nh ni">oc new-app centos/mariadb-103-centos7 --name mariadb --env MYSQL_DATABASE=wordpress --env MYSQL_USER=wordpress --env MYSQL_PASSWORD=wordpress</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oy"><img src="../Images/a40724e03a20faeec646b7cee2e9ae0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLcCADrn_g3kDGQHgMg13w.png"/></div></div></figure><p id="b2cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开OpenShift控制台，浏览到WordPress-test项目。一旦WordPress图像被构建并准备好，它将是深蓝色的，就像MariaDB实例所示:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pb"><img src="../Images/a1d1c6df8e7837d4b2f449b3e27cf28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGAjW5ZWx42wxo4MppWY1A.png"/></div></div></figure><p id="ff71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击WordPress对象，然后点击路线，在你的网络浏览器中打开它:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pc"><img src="../Images/8e4deecde44549f4cfefd874861a9913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLhdPrjzN2NaqBmICJeoeQ.png"/></div></div></figure><p id="b466" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你应该看到WordPress设置配置，点击让我们开始。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi mr"><img src="../Images/e2e15c75c84aaea8e573138b57ef19f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLVU88gaGFks1f0nDt0Ycw.png"/></div></div></figure><p id="6a77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如图所示，填写数据库、用户名、密码和数据库主机，并运行安装程序:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pd"><img src="../Images/de63ec776c976a0100d76c5f5ff7c7cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFbLpm-LmPlYOp4Om7k5JQ.png"/></div></div></figure><p id="7b98" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">填写欢迎信息并点击安装WordPress。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pe"><img src="../Images/27756e61a87508aa12563882d9e97614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_BDUgSeVvTufjOymcKMCA.png"/></div></div></figure><p id="6b41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录，你应该有一个工作的WordPress安装:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pf"><img src="../Images/bb34dfe7037d5ba378b7a4694e639968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pkdkQmHe2xV3mE5C4CS1vg.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pg"><img src="../Images/c443b5692a505ac52bca71dc1aa36ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qnh7So8RbOLRaisQy8ndHA.png"/></div></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pf"><img src="../Images/9ecdba524ff6e6faa6c45082b9a4d8a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFiRzigO6z01h3zXbSKEeA.png"/></div></div></figure><p id="62a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上检查NFS导出的大小。大小应该在300MB左右。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="48a2" class="ne lk it na b gy nf ng l nh ni">du -sh /var/nfsshare/registry/</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/db131b2b8fd0989a5807970f65c469f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*VKTd-S3oFQ9snCtRF6IITg.png"/></div></figure><p id="e718" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您刚刚验证了您的永久卷正在工作。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="ae63" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">HTPasswd安装程序:</h1><p id="d36e" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">kubeadmin是一个临时用户。设置本地用户最简单的方法是使用htpasswd。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="645f" class="ne lk it na b gy nf ng l nh ni">cd<br/>cd okd4_files<br/>htpasswd -c -B -b users.htpasswd testuser testpassword</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pi"><img src="../Images/cc5a74825b6eaac21670a81f151ca511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYEc9YrCOeKqOCd6Og5bPA.png"/></div></div></figure><p id="8e85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用您生成的users.htpasswd文件在openshift-config项目中创建一个秘密:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="94a4" class="ne lk it na b gy nf ng l nh ni">oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd -n openshift-config</span></pre><p id="7b24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加身份提供者。</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="061d" class="ne lk it na b gy nf ng l nh ni">oc apply -f htpasswd_provider.yaml</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pj"><img src="../Images/01a70f2d662788df3e70708db762fa95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vB_N2GWFQ0GRsrfKPMICIg.png"/></div></div></figure><p id="18a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注销OpenShift控制台。然后选择htpasswd_provider，用testuser和testpassword凭证登录。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/54b420490ae5fab4a84781d5976b03aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*Xdmyc_wAQNzA1YvN8SGLvg.png"/></div></figure><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pl"><img src="../Images/e6f422237c2acb3d2caf1c7c2fb406c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wMIiV2VmRgoJbR2fwdrvcA.png"/></div></div></figure><p id="81ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您访问管理员页面，您应该看不到任何项目:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pm"><img src="../Images/e9c5c290d57f0b47e080522d5e850cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d-sMl1RWUIHZI6j5oGFFtg.png"/></div></div></figure><p id="f10b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">授予您自己集群管理权限，项目应该立即填充:</p><pre class="kr ks kt ku gt mz na nb nc aw nd bi"><span id="8b31" class="ne lk it na b gy nf ng l nh ni">oc adm policy add-cluster-role-to-user cluster-admin testuser</span></pre><p id="8503" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的用户现在应该拥有集群管理员级别的访问权限:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi pn"><img src="../Images/1523d0ccc6c0234b045e82e5f0af8b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yST8o6n04a4PgkyXHeI8ug.png"/></div></div></figure></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><h1 id="664f" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">恭喜你。您已经创建了一个OKD集群！</h1><p id="e5c3" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb mj kd ke kf mk kh ki kj ml kl km kn im bi translated">希望您已经创建了一个OKD集群，并在这个过程中学到了一些东西。至此，您应该有了修补OpenShift继续学习的良好基础。</p></div><div class="ab cl lc ld hx le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="im in io ip iq"><p id="9c16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有一些资源可以帮助你的旅程:</p><p id="c0c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要报告问题，请使用<a class="ae kp" href="https://github.com/openshift/okd" rel="noopener ugc nofollow" target="_blank">https://github.com/openshift/okd Github Repo:</a>T2</p><p id="6e00" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如需支持，请查看<a class="ae kp" href="https://slack.k8s.io/" rel="noopener ugc nofollow" target="_blank"> k8s Slack </a>上的#openshift-users频道</p><p id="667d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">OKD工作组每两周召开一次会议，讨论发展和下一步措施。会议日程和地点在<a class="ae kp" href="https://github.com/openshift/community/projects/1#card-28309038" rel="noopener ugc nofollow" target="_blank">open shift/社区报告</a>中记录。</p><p id="18ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">okd-wg的谷歌小组:<a class="ae kp" href="https://groups.google.com/forum/#!forum/okd-wg" rel="noopener ugc nofollow" target="_blank">https://groups.google.com/forum/#!forum/okd-wg</a></p></div></div>    
</body>
</html>