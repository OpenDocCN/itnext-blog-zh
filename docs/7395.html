<html>
<head>
<title>How to use System Environment variables (process.env) in Angular application.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular应用中使用系统环境变量(process.env)？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-system-environment-variables-process-env-in-angular-application-b9e7104dcc98?source=collection_archive---------0-----------------------#2022-09-11">https://itnext.io/how-to-use-system-environment-variables-process-env-in-angular-application-b9e7104dcc98?source=collection_archive---------0-----------------------#2022-09-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c4b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用<code class="fe kl km kn ko b">@angular/cli</code>设置的环境变量很棒。除非我们需要向应用程序传递一些我们不想提交给存储库的值。</p><p id="76cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:</p><ul class=""><li id="f3d9" class="kp kq iq jp b jq jr ju jv jy kr kc ks kg kt kk ku kv kw kx bi translated">后端API URL是动态的，可以经常更改。<br/>。如果我们有多个开发环境。<br/>。在每次部署期间，API URLs可以是唯一的。</li><li id="3c2b" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated">我们用的是伐木机。我们想要的只是改变应用程序的日志级别。<br/>。在这种情况下，我们需要更改我们的<code class="fe kl km kn ko b">environment.ts</code>文件中的<code class="fe kl km kn ko b">LOG_LEVEL</code>并重新构建。我们不需要将此更改提交给回购。</li><li id="5403" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated">在CI/CD流程(管道)中，一些值可以由其他作业提供。</li><li id="77a9" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated">以及许多其他使用案例…</li></ul></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="8fca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要解决它，我们可以找到几种解决方法。</p><ul class=""><li id="92fd" class="kp kq iq jp b jq jr ju jv jy kr kc ks kg kt kk ku kv kw kx bi translated">使用<code class="fe kl km kn ko b">fs</code>库创建/生成动态<code class="fe kl km kn ko b">environment.ts</code>文件。<br/> —需要编写和维护一个脚本，该脚本将实际生成<code class="fe kl km kn ko b">environment.ts</code>文件。</li><li id="928f" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated">自定义webpack配置。<br/> —只有当你喜欢玩webpack配置时。</li><li id="a43c" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated"><a class="ae lk" href="https://www.npmjs.com/package/@ngx-env/builder" rel="noopener ugc nofollow" target="_blank">@ ngx-env/builder</a><br/>—要求对所有环境变量使用<code class="fe kl km kn ko b">NG_APP_</code>前缀</li><li id="19c7" class="kp kq iq jp b jq ky ju kz jy la kc lb kg lc kk ku kv kw kx bi translated"><a class="ae lk" href="https://www.npmjs.com/package/ngx-build-plus" rel="noopener ugc nofollow" target="_blank"> ngx-build-plus </a>作者<a class="ll lm ep" href="https://medium.com/u/acb3f1945710?source=post_page-----b9e7104dcc98--------------------------------" rel="noopener" target="_blank">曼弗雷德·施泰尔</a> <br/> —扩展Angular CLI的默认构建行为，不弹出。<br/> —为您提供一种操作webpack配置的简便方法。</li></ul><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/3e02c04e644f44288a349372c201b1f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gm7AkM36A05FQCWtgKv5jA.png"/></div></div></figure><p id="4b15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我想考虑一种使用原生角度功能的方法，比如builder和schematics。</p><h1 id="9c7b" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">天然气处理环境</h1><p id="384c" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">先说<code class="fe kl km kn ko b">npm i ng-process-env</code></p><p id="f8a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个库的主要思想是在<code class="fe kl km kn ko b">angular.json</code>和相关的<code class="fe kl km kn ko b">environment.ts</code>文件中创建一个专用的配置部分。</p><p id="1e9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能知道，在每个配置中，都有一个<code class="fe kl km kn ko b">environment.ts</code>文件替换的定义:</p><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="90f3" class="ng ma iq ko b gy nh ni l nj nk">// angular.json<br/>{<br/>  "targets": {<br/>    "build": {<br/>      ...<br/>      "configurations": {<br/>        "myconfig": {<br/>          "fileReplacements": [<br/>            {<br/>              "replace": "apps/myblogs/src/environments/environment.ts",<br/>              "with": "apps/myblogs/src/environments/environment.myconfig.ts"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="757d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装之后，我们需要为我们的应用程序创建一个新的配置部分。为此，只需运行<code class="fe kl km kn ko b">ng generate ng-process-env:process-env --project &lt;projectname&gt; --config &lt;configname&gt;</code>。<br/>其中<code class="fe kl km kn ko b">--project</code>是我们应用程序的名称，<code class="fe kl km kn ko b">--config</code>是我们配置的名称。<br/>例如，我们有一个应用程序<strong class="jp ir"> myblogs、</strong>，除了默认配置(<em class="nl">开发</em>和<em class="nl">生产</em>)，我们还想添加一个新的应用程序- <em class="nl">部署</em>。<br/>在这种情况下，我们的命令应该是这样的:<code class="fe kl km kn ko b">ng generate ng-process-nv:process-env --project myblogs --config deployment</code></p><p id="a025" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此命令将对您的代码进行以下更改:</p><ol class=""><li id="8fb8" class="kp kq iq jp b jq jr ju jv jy kr kc ks kg kt kk nm kv kw kx bi translated">将创建一个新的<code class="fe kl km kn ko b">environment.deployment.ts</code>文件。</li></ol><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="fb59" class="ng ma iq ko b gy nh ni l nj nk">// <!-- -->environment.deployment.ts<br/>export const environment = {<br/>  production: false,<br/>  baseUrl: 'http://localhost:4200',<br/>  envVar: {<br/>    /**<br/>     * Add environment variables you want to retriev from process<br/>     * PORT:4200,<br/>     * VAR_NAME: defaultValue<br/>     */<br/>  }<br/>};</span></pre><p id="952f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.用新的配置部分<code class="fe kl km kn ko b">deployment</code>更新<code class="fe kl km kn ko b">angular.json</code></p><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="1d04" class="ng ma iq ko b gy nh ni l nj nk">{<br/>  "targets": {<br/>    "build": {<br/>      ...<br/>      "configurations": {<br/>        "production": {<br/>          ...<br/>        },<br/>        "development": {<br/>          ...<br/>        },<br/>        "deployment": {<br/>          "fileReplacements": [<br/>            {<br/>              "replace": "apps/myblogs/src/environments/environment.ts",<br/>              "with": "apps/myblogs/src/environments/environment.deployment.ts"<br/>            }<br/>          ]<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="4ed1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以用配置标志<br/> <code class="fe kl km kn ko b">--configuration deployment</code>构建/服务我们的应用程序。默认的<code class="fe kl km kn ko b">environment.ts</code>文件<br/>将被替换为<code class="fe kl km kn ko b">environment.deployment.ts</code>。</p><h1 id="900c" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">配置您的配置</h1><p id="ebe3" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">此时是向<code class="fe kl km kn ko b">deployment</code>部分添加额外所需配置的好时机，或者简单地从<code class="fe kl km kn ko b">production</code>配置复制/粘贴。</p><p id="e833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要设置从<code class="fe kl km kn ko b">process.env</code>中检索的变量。<br/>打开创建的<code class="fe kl km kn ko b">environment.deployment.ts</code>文件，用你需要的变量更新<code class="fe kl km kn ko b">envVar</code>部分。</p><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="a349" class="ng ma iq ko b gy nh ni l nj nk">// environment.deployment.ts<br/>export const environment = {<br/>  production: false,<br/>  baseUrl: 'http://localhost:4200',<br/>  envVar: {<br/>    endpointUrl: 'http://myapi.com',<br/>    LOG_LEVEL: 'debug',<br/>    version: 0<br/>  }<br/>};</span></pre><h1 id="f431" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">这是一个构建时间</h1><p id="c886" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">现在我们准备收集我们的环境变量并构建应用程序(在本地或在<strong class="jp ir"> CI/CD </strong>期间)。</p><p id="0d74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们假设这是我们的环境变量:</p><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="6a3d" class="ng ma iq ko b gy nh ni l nj nk">export endpointUrl='http://otherapi.com'<br/>export LOG_LEVEL='info'<br/>export version=34</span></pre><p id="e11e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了收集变量，我们只需要运行<code class="fe kl km kn ko b">ng run myblogs:collect-vars</code>命令。<br/><code class="fe kl km kn ko b">environemnt.deployment.ts</code>文件将改为:</p><pre class="lo lp lq lr gt nc ko nd ne aw nf bi"><span id="a30f" class="ng ma iq ko b gy nh ni l nj nk">// environemnt.deployment.ts<br/>export const environment = {<br/>  production: false,<br/>  baseUrl: "http://localhost:4200",<br/>  envVar: {<br/>    endpointUrl: "http://otherapi.com",<br/>    LOG_LEVEL: "info",<br/>    version: 34 as number<br/>  }<br/>};</span></pre><p id="c456" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在需要做的就是用<code class="fe kl km kn ko b">deployment</code>配置构建我们的应用程序。<br/> <code class="fe kl km kn ko b">ng build myblogs — configuration deployment</code></p><h1 id="edf7" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">让我们总结一下</h1><p id="58b1" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">希望有一天<code class="fe kl km kn ko b">@angular/cli</code>会原生支持环境变量的使用。可以按照这个<a class="ae lk" href="https://github.com/angular/angular-cli/issues/4318" rel="noopener ugc nofollow" target="_blank">由来已久的特性要求。</a></p><p id="c436" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在那之前，你现在知道如何自己做了！</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><p id="2464" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章，请按👏拍按钮♾️时报。<br/>在<a class="ae lk" href="https://twitter.com/danduh81" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae lk" href="https://medium.com/@danduh" rel="noopener"> Medium </a>上关注我的博客更新。<br/>查看我的<a class="ae lk" href="https://danduh.me/" rel="noopener ugc nofollow" target="_blank">网站</a>和<a class="ae lk" href="https://www.youtube.com/channel/UC6lsCdwzHYQZzudJtKW-00g" rel="noopener ugc nofollow" target="_blank"> Youtube </a>的视频和公开演讲。</p><p id="24e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意提问。</p><p id="d6e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非常感谢你的阅读！</p></div></div>    
</body>
</html>