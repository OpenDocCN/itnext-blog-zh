<html>
<head>
<title>How I built my second Progressive Web App (PWA)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何构建我的第二个渐进式网络应用程序(PWA)</h1>
<blockquote>原文：<a href="https://itnext.io/how-i-built-my-second-progressive-web-app-pwa-3508c26d8e77?source=collection_archive---------7-----------------------#2019-12-18">https://itnext.io/how-i-built-my-second-progressive-web-app-pwa-3508c26d8e77?source=collection_archive---------7-----------------------#2019-12-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="c359" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">渐进式网络应用</h2><div class=""/><div class=""><h2 id="1f3f" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">得到完美的灯塔分数</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/c2235f4fdb629e41d40b8f6419518a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sgWM8jv6w-JFiQY7gimMaA.jpeg"/></div></div></figure><p id="573d" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">从今天起，我的副业项目<a class="ae lw" href="https://cld.silvestar.codes/" rel="noopener ugc nofollow" target="_blank">代码行日报</a>作为一个渐进式网络应用程序可用。</p><p id="04f7" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你碰巧读过<a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/how-i-built-my-first-progressive-web-app-pwa-6fd3f5a164c0">我之前写的关于“我如何构建我的第一个渐进式网络应用程序(PWA)</a>”的文章，这篇文章是续篇。</p><h1 id="1a42" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">工具箱</h1><p id="d50a" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">在我之前制作PWA的尝试中，我都是手动处理的。我了解了可用的选项和技术，这有助于我理解PWA网站是如何工作的。</p><p id="a650" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这次我决定用<a class="ae lw" href="https://developers.google.com/web/tools/workbox" rel="noopener ugc nofollow" target="_blank">工具箱</a>做PWA。Workbox是Google让PWA更流畅的工具。</p><blockquote class="mu mv mw"><p id="2b1e" class="la lb mx lc b ld le ka lf lg lh kd li my lk ll lm mz lo lp lq na ls lt lu lv ij bi translated"><em class="iq"> Workbox是一组库和节点模块，可以轻松缓存资源并充分利用用于构建</em> <a class="ae lw" href="https://developers.google.com/web/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> <em class="iq">渐进式Web应用</em> </a> <em class="iq">的功能。</em></p></blockquote><p id="9fea" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有一个很棒的<a class="ae lw" href="https://developers.google.com/web/tools/workbox/guides/get-started" rel="noopener ugc nofollow" target="_blank">“入门”指南</a>，我按照它在几分钟内设置了初始版本。Workbox正在提供<a class="ae lw" href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies" rel="noopener ugc nofollow" target="_blank">预定义的缓存策略</a>，如“CacheFirst”或“StaleWhileRevalidate”。您可以在一行中设置缓存策略，如下所示:</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="1851" class="ng ly iq nc b gy nh ni l nj nk">// Serve all CSS files with StaleWhileRevalidate strategy<br/>workbox.routing.registerRoute(<br/>  /\.css$/,<br/>  new workbox.strategies.StaleWhileRevalidate()<br/>)</span></pre><p id="0593" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这种策略告诉服务旧的/陈旧的CSS文件如果可用。如果不可用，请使用网络请求来获取文件。</p><p id="cc66" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">你可以在GitHub库中看到代码行每日<a class="ae lw" href="https://github.com/maliMirkec/code-line-daily/blob/master/src/sw/sw.js" rel="noopener ugc nofollow" target="_blank">的所有策略。</a></p><h1 id="f224" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">预缓存</h1><p id="8d7e" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">设置好策略后，我已经使用<a class="ae lw" href="https://developers.google.com/web/tools/workbox/guides/precache-files/cli" rel="noopener ugc nofollow" target="_blank"> Workbox CLI </a>创建了要预缓存的文件列表。我已经将Workbox CLI作为一个全局<code class="fe nl nm nn nc b">npm</code>包进行了安装。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="1048" class="ng ly iq nc b gy nh ni l nj nk">npm i -g workbox-cli</span></pre><p id="5348" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">之后，<code class="fe nl nm nn nc b">workbox</code>命令在我的终端可用。我已经运行了命令来启动向导。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="3f7f" class="ng ly iq nc b gy nh ni l nj nk">workbox wizard --injectManifest</span></pre><p id="c744" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我已经选择了已配置的路径并选择了要预缓存的文件，Workbox CLI为我创建了一个新文件。</p><p id="7329" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为了能够将这些文件注入到服务工作者文件中，我在其中添加了下面一行:</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="479f" class="ng ly iq nc b gy nh ni l nj nk">workbox.precaching.precacheAndRoute([]);</span></pre><p id="6545" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">最后，我运行了命令<code class="fe nl nm nn nc b">workbox injectManifest</code>,该命令创建了新的服务工作者文件，其中包含了要预缓存的文件列表。</p><h1 id="2687" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">自动化</h1><p id="3384" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">我很高兴一切正常，但是我意识到我需要手动运行这些命令。因为我已经花了很多精力来自动化这个项目，所以我想把Workbox添加到我的Gulp任务中。幸运的是，Workbox也可以作为Node.js环境的插件使用。</p><p id="afe7" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有一种<code class="fe nl nm nn nc b">generateSW</code>模式可以创建一个带有预缓存设置的服务人员，这似乎是符合我需求的逻辑选项。</p><blockquote class="mu mv mw"><p id="8738" class="la lb mx lc b ld le ka lf lg lh kd li my lk ll lm mz lo lp lq na ls lt lu lv ij bi translated"><em class="iq">这将生成一个服务工作器，为您的配置选择的所有文件进行预缓存设置</em></p></blockquote><p id="f670" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这是我的项目的配置。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="ef34" class="ng ly iq nc b gy nh ni l nj nk">{<br/>  "globDirectory": "dist/",<br/>  "globPatterns": [<br/>    "**/*.{html,webmanifest,css,eot,svg,ttf,woff,woff2,png,js,ico,jpg}"<br/>  ],<br/>  "globIgnores": [<br/>    "docs/**/*",<br/>    "gfx/cover/**/*"<br/>  ],<br/>  "swDest": "dist/sw.js",<br/>  "swSrc": "src/sw/sw.js"<br/>}</span></pre><p id="04f9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">其中:</p><ul class=""><li id="4e3e" class="no np iq lc b ld le lg lh lj nq ln nr lr ns lv nt nu nv nw bi translated"><code class="fe nl nm nn nc b">swSrc</code>选项告诉在哪里可以找到服务人员文件，</li><li id="0562" class="no np iq lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe nl nm nn nc b">swDest</code>选项告诉在哪里保存已处理的服务人员文件，</li><li id="eaac" class="no np iq lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe nl nm nn nc b">globDirectory</code>选项告诉哪个文件夹扫描预先缓存的文件，</li><li id="9a92" class="no np iq lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe nl nm nn nc b">globPatterns</code>选项告知使用哪些模式，以及</li><li id="977b" class="no np iq lc b ld nx lg ny lj nz ln oa lr ob lv nt nu nv nw bi translated"><code class="fe nl nm nn nc b">globIgnores</code>选项告知忽略哪些文件夹，尽管模式匹配。</li></ul><p id="dab0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">运行Gulp任务后，我得到了最终的服务工作者文件，如下所示:</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="e335" class="ng ly iq nc b gy nh ni l nj nk">// load workbox<br/>importScripts('https://storage.googleapis.com/workbox-cdn/releases/4.3.1/workbox-sw.js')<br/><br/>// output successful message<br/>if (workbox) {<br/>  console.log(`Yay! Workbox is loaded 🎉`)<br/>} else {<br/>  console.log(`Boo! Workbox didn't load 😬`)<br/>}<br/><br/>workbox.core.setCacheNameDetails({<br/>  prefix: 'cld',<br/>  suffix: 'v1.0',<br/>  precache: 'precache',<br/>  runtime: 'runtime'<br/>})<br/><br/>workbox.precaching.precacheAndRoute([<br/>  // precached file list<br/>])<br/><br/>// Serve all html files with StaleWhileRevalidate strategy<br/>workbox.routing.registerRoute(<br/>  /\.html$/,<br/>  new workbox.strategies.NetworkFirst()<br/>)<br/><br/>// Serve all css files with StaleWhileRevalidate strategy<br/>workbox.routing.registerRoute(<br/>  /\.js$/,<br/>  new workbox.strategies.StaleWhileRevalidate()<br/>)<br/><br/>// Serve all css files with StaleWhileRevalidate strategy<br/>workbox.routing.registerRoute(<br/>  /\.css$/,<br/>  new workbox.strategies.StaleWhileRevalidate()<br/>)<br/><br/>// Serve all other assets with CacheFirst strategy<br/>workbox.routing.registerRoute(<br/>  /\.(?:png|jpg|jpeg|svg|gif|webp|ico|webmanifest|eot,ttf,woff,woff2)$/,<br/>  new workbox.strategies.CacheFirst({<br/>    plugins: [<br/>      new workbox.expiration.Plugin({<br/>        maxEntries: 20,<br/>        maxAgeSeconds: 30 * 24 * 60 * 60<br/>      })<br/>    ]<br/>  })<br/>)</span></pre><h1 id="4978" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">决赛成绩</h1><p id="896b" class="pw-post-body-paragraph la lb iq lc b ld mp ka lf lg mq kd li lj mr ll lm ln ms lp lq lr mt lt lu lv ij bi translated">代码行日报现在是进步的网络应用程序。那是我的第二个PWA，我会推荐大家多了解一下。该网站现在可以离线访问，但它也通过尽可能提供缓存资产为我的用户节省了带宽。继续尝试每天安装<a class="ae lw" href="https://cld.silvestar.codes/" rel="noopener ugc nofollow" target="_blank">代码行</a>，让我知道你的想法。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/c213912c049a05b5e3dfc69a6536b8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*LmVcY_8fHnyY4hfMaee4TA.gif"/></div></figure><p id="0cf9" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">作为奖励，我已经运行了Code Line Daily站点的审计，我再次看到了fireworks，就像在<a class="ae lw" href="https://www.silvestar.codes" rel="noopener ugc nofollow" target="_blank">我的个人站点</a>一样。💯</p></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="52a8" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="mx">最初发布于</em><a class="ae lw" href="https://www.silvestar.codes/articles/how-i-built-my-second-progressive-web-app-pwa/" rel="noopener ugc nofollow" target="_blank"><em class="mx">https://www . silvestar . codes</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>