<html>
<head>
<title>gRPC and the open source Ambassador API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">gRPC和开源大使API网关</h1>
<blockquote>原文：<a href="https://itnext.io/grpc-and-the-open-source-ambassador-api-gateway-1b3c2e2d8d50?source=collection_archive---------5-----------------------#2018-02-23">https://itnext.io/grpc-and-the-open-source-ambassador-api-gateway-1b3c2e2d8d50?source=collection_archive---------5-----------------------#2018-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/286edb9cf8e4be180448f9be4a297a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fU4SKK5yzkWIvD7z62Y49w.png"/></div></div></figure><p id="5ce8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fgrpc-and-the-open-source-ambassador-api-gateway-1b3c2e2d8d50" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="4dea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">gRPC 是建立在HTTP/2之上的高性能RPC协议。我们看到越来越多的公司将他们的API从HTTP/JSON转移到gRPC。与HTTP/JSON相比，gRPC有很多优点:</p><ul class=""><li id="155e" class="ky kz iq ka b kb kc kf kg kj la kn lb kr lc kv ld le lf lg bi translated">性能。gRPC使用HTTP/2，支持流式传输、多路复用等等(<a class="ae kw" href="https://imagekit.io/demo/http2-vs-http1" rel="noopener ugc nofollow" target="_blank">参见动作差异</a>)。此外，gRPC拥有对protobuf的原生支持，这在序列化/反序列化方面比JSON快得多。</li><li id="8727" class="ky kz iq ka b kb lh kf li kj lj kn lk kr ll kv ld le lf lg bi translated">流式传输。尽管名为gRPC，但它也支持流式传输，这为更广泛的用例提供了支持。</li><li id="0dbe" class="ky kz iq ka b kb lh kf li kj lj kn lk kr ll kv ld le lf lg bi translated">端点的代码生成。gRPC使用来自API定义(<code class="fe lm ln lo lp b">.proto</code>文件)的代码生成来清除您的端点。</li></ul><p id="17f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">gRPC确实有一些缺点，其中最大的缺点可能是它比HTTP/REST更新，因此，围绕gRPC的工具和库的成熟度远不及HTTP。</p><p id="9346" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中一个缺口是在API网关中。许多API网关不支持gRPC。幸运的是，<a class="ae kw" href="https://www.getambassador.io/" rel="noopener ugc nofollow" target="_blank">大使</a>支持gRPC ，这要归功于它使用<a class="ae kw" href="https://www.envoyproxy.io" rel="noopener ugc nofollow" target="_blank">特使</a>作为其核心代理引擎。(Ambassador也是一个通用的<a class="ae kw" href="https://blog.getambassador.io/kubernetes-ingress-nodeport-load-balancers-and-ingress-controllers-6e29f1c44f2d" rel="noopener ugc nofollow" target="_blank"> Kubernetes ingress </a>解决方案。)</p><h1 id="25a9" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">API网关和gRPC</h1><p id="9a11" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">API网关实现交叉功能，如认证、日志记录、速率限制和负载平衡。通过将API网关与您的gRPC APIs一起使用，您能够在核心gRPC服务之外部署此功能。此外，Ambassador能够为您的HTTP和gRPC服务提供这种功能。</p><h1 id="43d6" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">大使和gRPC</h1><p id="5615" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">使用Ambassador部署gRPC服务非常简单。在<a class="ae kw" href="https://www.getambassador.io/user-guide/getting-started" rel="noopener ugc nofollow" target="_blank">安装大使</a>之后，为您的gRPC服务创建一个大使映射。映射示例如下所示:</p><pre class="mt mu mv mw gt mx lp my mz aw na bi"><span id="f878" class="nb lr iq lp b gy nc nd l ne nf">---<br/>apiVersion: ambassador/v0<br/>kind: Mapping<br/>name: grpc_mapping<br/>grpc: true<br/>prefix: /helloworld.Greeter/<br/>rewrite: /helloworld.Greeter/<br/>service: grpc-greet</span></pre><p id="d2ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，gRPC服务不像HTTP服务那样被路由。相反，gRPC请求包括包和服务名。该信息用于将请求路由到适当的服务。我们根据<a class="ae kw" href="https://github.com/grpc/grpc-go/blob/master/examples/helloworld/helloworld/helloworld.proto" rel="noopener ugc nofollow" target="_blank">相应地设置<code class="fe lm ln lo lp b">prefix</code>和<code class="fe lm ln lo lp b">rewrite</code>字段。原型</a>文件。另外，请注意，我们设置了<code class="fe lm ln lo lp b">grpc: true</code>来告诉Ambassador该服务使用gRPC。</p><h1 id="8934" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">部署gRPC服务</h1><p id="9529" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">我们可以部署一个简单的Hello，World gRPC服务来演示所有这些功能。将下面完整的YAML复制粘贴到一个名为<code class="fe lm ln lo lp b">helloworld.yaml</code>的文件中:</p><pre class="mt mu mv mw gt mx lp my mz aw na bi"><span id="d57b" class="nb lr iq lp b gy nc nd l ne nf">---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  labels:<br/>    service: grpc-greet<br/>  name: grpc-greet<br/>  annotations:<br/>    getambassador.io/config: |<br/>      ---<br/>      apiVersion: ambassador/v0<br/>      kind: Mapping<br/>      name: grpc_mapping<br/>      grpc: true<br/>      prefix: /helloworld.Greeter/<br/>      rewrite: /helloworld.Greeter/<br/>      service: grpc-greet<br/>spec:<br/>  type: ClusterIP<br/>  ports:<br/>  - port: 80<br/>    name: grpc-greet<br/>    targetPort: grpc-api<br/>  selector:<br/>    service: grpc-greet<br/>---<br/>apiVersion: extensions/v1beta1<br/>kind: Deployment<br/>metadata:<br/>  name: grpc-greet<br/>spec:<br/>  replicas: 1<br/>  template:<br/>    metadata:<br/>      labels:<br/>        service: grpc-greet<br/>    spec:<br/>      containers:<br/>      - name: grpc-greet<br/>        image: enm10k/grpc-hello-world<br/>        ports:<br/>        - name: grpc-api<br/>          containerPort: 9999<br/>        env:<br/>          - name: PORT<br/>            value: "9999"<br/>        command:<br/>          - greeter_server<br/>      restartPolicy: Always</span></pre><p id="959c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，运行<code class="fe lm ln lo lp b">kubectl apply -f helloworld.yaml</code>。</p><h1 id="8e38" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Hello World客户端</h1><p id="9b81" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">为了测试Ambassador和服务是否正常工作，我们需要运行一个gRPC客户机。首先，获取大使的外部IP地址。用<code class="fe lm ln lo lp b">kubectl get svc ambassador</code>可以做到这一点。</p><p id="828c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用一个Docker映像，它已经包含了适当的Hello World gRPC客户端。键入，其中$AMBASSADOR_IP设置为上面的外部IP地址，$AMBASSADOR_PORT设置为80(对于基于HTTP的大使)或443(对于配置了TLS的大使)。</p><pre class="mt mu mv mw gt mx lp my mz aw na bi"><span id="6cc7" class="nb lr iq lp b gy nc nd l ne nf">docker run -e ADDRESS=${AMBASSADOR_IP}:${AMBASSADOR_PORT} enm10k/grpc-hello-world greeter_client</span></pre><p id="7192" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到如下所示的内容:</p><pre class="mt mu mv mw gt mx lp my mz aw na bi"><span id="17a7" class="nb lr iq lp b gy nc nd l ne nf">$ docker run -e ADDRESS=35.29.51.15:80 enm10k/grpc-hello-world greeter_client<br/>2018/02/02 20:34:35 Greeting: Hello world</span></pre><h1 id="49fc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">摘要</h1><p id="b77d" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated"><a class="ae kw" href="https://www.getambassador.io/" rel="noopener ugc nofollow" target="_blank"> Ambassador </a>使向您的消费者发布gRPC服务变得容易，这要归功于<a class="ae kw" href="https://www.datawire.io/envoyproxy/" rel="noopener ugc nofollow" target="_blank"> Envoy的</a> <a class="ae kw" href="https://www.envoyproxy.io/docs/envoy/v1.5.0/intro/arch_overview/grpc.html" rel="noopener ugc nofollow" target="_blank">强大的gRPC支持</a>。通过Ambassador发布服务，您可以为gRPC服务添加身份验证、速率限制和其他功能。</p><p id="54b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您有兴趣在gRPC中使用Ambassador，请加入我们的<a class="ae kw" href="https://gitter.im/datawire/ambassador" rel="noopener ugc nofollow" target="_blank"> Gitter chat </a>或访问<a class="ae kw" href="https://www.getambassador.io." rel="noopener ugc nofollow" target="_blank">https://www . getambassador . io .</a></p><p id="6c72" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">本帖原载于</em> <a class="ae kw" href="https://blog.getambassador.io/grpc-and-the-open-source-ambassador-api-gateway-510eaaf9a0e0" rel="noopener ugc nofollow" target="_blank"> <em class="kx">大使博客</em> </a> <em class="kx">。</em></p></div></div>    
</body>
</html>