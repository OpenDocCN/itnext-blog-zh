<html>
<head>
<title>Swift UserDefault — Save Custom Object in 3 Steps ONLY!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift UserDefault —只需3步即可保存自定义对象！</h1>
<blockquote>原文：<a href="https://itnext.io/swift-userdefault-save-custom-object-in-3-steps-only-f4dcf76e85b4?source=collection_archive---------0-----------------------#2020-10-09">https://itnext.io/swift-userdefault-save-custom-object-in-3-steps-only-f4dcf76e85b4?source=collection_archive---------0-----------------------#2020-10-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/9abd33e39c4e79287c98dbbc24580518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOQiap2ETUSI61yMg1Eehg.jpeg"/></div></div></figure><p id="a792" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated">从原始数据(如<code class="fe lj lk ll lm b">String</code>、<code class="fe lj lk ll lm b">Int</code>、<code class="fe lj lk ll lm b">Double</code>、<code class="fe lj lk ll lm b">Data</code>、<code class="fe lj lk ll lm b">Array</code>、<code class="fe lj lk ll lm b">Bool</code>、&amp;、<code class="fe lj lk ll lm b">URL</code>)到<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/foundation/userdefaults" rel="noopener ugc nofollow" target="_blank">UserDefaults</a></code>的转换是一项简单的任务，但对定制对象的转换却并非易事。在过去，开发人员可能需要以<code class="fe lj lk ll lm b">Dictionary</code>的格式保存一个对象，并手动解析它。</p><p id="b7e8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">幸运的是，苹果发布了一个新协议<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/swift/codable" rel="noopener ugc nofollow" target="_blank">Codable</a></code>。任何符合<code class="fe lj lk ll lm b">Codable</code>的类/结构都可以通过<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/foundation/jsonencoder" rel="noopener ugc nofollow" target="_blank">JSONEncoder</a></code>和<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/foundation/jsondecoder" rel="noopener ugc nofollow" target="_blank">JSONDecoder</a></code>与<code class="fe lj lk ll lm b">Data</code>格式相互转换。然后我们可以直接在<code class="fe lj lk ll lm b">UserDefaults</code>中保存和检索<code class="fe lj lk ll lm b">Data</code>。</p><p id="f065" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们只需要3个主要步骤来实现自定义对象的保存和解析。开始编码吧！</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="a58d" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">最终目标</h1><figure class="mt mu mv mw gu jv"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="ce9e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用于保存和检索数据的语法冗长而乏味。最好简化成只有一行代码(见上面第2行&amp;第5行)。详细内容将包含在后面的“更简单、更易读的代码”部分。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="b09e" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">分步指南</h1><h2 id="e705" class="mz lw iu bd lx na nb dn mb nc nd dp mf kn ne nf mj kr ng nh mn kv ni nj mr nk bi translated">步骤1)对象声明—符合<code class="fe lj lk ll lm b">Codable protocol</code></h2><figure class="mt mu mv mw gu jv"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="9554" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lj lk ll lm b">Codable</code>是<code class="fe lj lk ll lm b">Encodable</code>和<code class="fe lj lk ll lm b">Decodable</code>协议的类型别名。对象必须符合<code class="fe lj lk ll lm b">Codable</code>，以便通过<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/foundation/jsonencoder" rel="noopener ugc nofollow" target="_blank">JSONEncoder</a></code>和<code class="fe lj lk ll lm b"><a class="ae ln" href="https://developer.apple.com/documentation/foundation/jsondecoder" rel="noopener ugc nofollow" target="_blank">JSONDecoder</a></code>编码为<code class="fe lj lk ll lm b">Data</code>格式和从<code class="fe lj lk ll lm b">Data</code>格式解码。</p><blockquote class="nl nm nn"><p id="3c15" class="kc kd no ke b kf kg kh ki kj kk kl km np ko kp kq nq ks kt ku nr kw kx ky kz in bi translated">请记住，任何嵌套对象也必须符合<code class="fe lj lk ll lm b">Codable</code>协议，以便将整个对象与<code class="fe lj lk ll lm b">Data</code>相互转换，并在稍后阶段保存到用户默认值。</p></blockquote><h2 id="1c36" class="mz lw iu bd lx na nb dn mb nc nd dp mf kn ne nf mj kr ng nh mn kv ni nj mr nk bi translated">步骤2)保存数据</h2><figure class="mt mu mv mw gu jv"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="d290" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第2行，为<code class="fe lj lk ll lm b">UserDefaults</code>创建一个<code class="fe lj lk ll lm b">extension</code>可以简化用法并增加代码可读性(见第13行)。</p><p id="6d4b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第5行，<code class="fe lj lk ll lm b">JSONEncoder</code>将可编码对象编码到<code class="fe lj lk ll lm b">Data</code>，稍后将数据保存到<code class="fe lj lk ll lm b">UserDefaults</code>。</p><p id="5fc0" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第13行，保存<code class="fe lj lk ll lm b">Data</code>到<code class="fe lj lk ll lm b">UserDefaults</code>的代码与保存原语类型类似，即<code class="fe lj lk ll lm b">UserDefaults.standard.set(100, forKey: "fooKey")</code>。</p><h2 id="0f15" class="mz lw iu bd lx na nb dn mb nc nd dp mf kn ne nf mj kr ng nh mn kv ni nj mr nk bi translated">步骤3)检索数据</h2><figure class="mt mu mv mw gu jv"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="92f1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第5行，保存的<code class="fe lj lk ll lm b">Data</code>由<code class="fe lj lk ll lm b">data(forKey:)</code>函数从<code class="fe lj lk ll lm b">UserDefaults</code>中检索，当数据尚未保存到该键时为<code class="fe lj lk ll lm b">nil</code>。</p><p id="40b4" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第8行，<code class="fe lj lk ll lm b">JSONDecoder</code>将检索到的<code class="fe lj lk ll lm b">Data</code>解码成输入的可编码的<code class="fe lj lk ll lm b">dataType</code>。它可能抛出错误，因为检索到的<code class="fe lj lk ll lm b">Data</code>可能包含无效的键值对。</p><p id="13d4" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第14–15行，检查可选状态后，解码后的<code class="fe lj lk ll lm b">Codable</code>对象可以直接使用。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="a308" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">更简单、可读性更强的代码</h1><figure class="mt mu mv mw gu jv"><div class="bz fq l di"><div class="mx my l"/></div></figure><p id="5272" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了进一步简化从<code class="fe lj lk ll lm b">UserDefaults</code>保存和检索数据的代码，我们可以使用上面所示的<code class="fe lj lk ll lm b">static</code> Swift属性的<code class="fe lj lk ll lm b">getter</code>和<code class="fe lj lk ll lm b">setter</code>函数(第4行&amp;第7行)。</p><p id="c33b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">因此，保存和检索数据的代码可以分别简化为一行代码(参见第14 &amp; 15行)。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="9143" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">摘要</h1><p id="a829" class="pw-post-body-paragraph kc kd iu ke b kf ns kh ki kj nt kl km kn nu kp kq kr nv kt ku kv nw kx ky kz in bi translated"><code class="fe lj lk ll lm b">UserDefaults</code>可以简单保存符合<code class="fe lj lk ll lm b">Codable</code>协议的自定义对象。<code class="fe lj lk ll lm b">JSONEncoder</code>和<code class="fe lj lk ll lm b">JSONDecoder</code>在处理数据转换中起着重要的作用。嵌套对象也必须符合<code class="fe lj lk ll lm b">Codable</code>协议才能成功编解码。</p></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><h1 id="9599" class="lv lw iu bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">进一步阅读:</h1><ol class=""><li id="5055" class="nx ny iu ke b kf ns kj nt kn nz kr oa kv ob kz oc od oe of bi translated">关于<code class="fe lj lk ll lm b">Codable</code>协议的更多信息</li></ol><div class="og oh gq gs oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-codable-json-parser-8661bb57bea7"><div class="ok ab fp"><div class="ol ab om cl cj on"><h2 class="bd iv gz z fq oo fs ft op fv fx it bi translated">Swift Codable — JSON解析器</h2><div class="oq l"><h3 class="bd b gz z fq oo fs ft op fv fx dk translated">Codable是一种可以将Swift对象本身转换为数据类型或从数据类型转换出来的协议。Codable是…的类型别名</h3></div><div class="or l"><p class="bd b dl z fq oo fs ft op fv fx dk translated">itnext.io</p></div></div><div class="os l"><div class="ot l ou ov ow os ox ka oj"/></div></div></a></div></div><div class="ab cl lo lp hy lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="in io ip iq ir"><figure class="mt mu mv mw gu jv gi gj paragraph-image"><div class="ab gv cl oy"><img src="../Images/0ba2cdafd3f9309183d6d844f092e509.png" data-original-src="https://miro.medium.com/v2/format:webp/0*zNx4UYTf3_myWpyu.png"/></div></figure><p id="525c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">欢迎您通过<a class="ae ln" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ my rik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>