<html>
<head>
<title>Using Channels in GO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GO中使用频道</h1>
<blockquote>原文：<a href="https://itnext.io/using-channels-in-go-c418b0cb0f93?source=collection_archive---------1-----------------------#2021-07-16">https://itnext.io/using-channels-in-go-c418b0cb0f93?source=collection_archive---------1-----------------------#2021-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bf01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在与Golang合作时，我们使用通道来简化工作，而不使用go套路。</p><p id="0dea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是使用通道的最基本的例子</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="1a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ks" href="https://play.golang.org/p/iy9QealMxcT" rel="noopener ugc nofollow" target="_blank">https://play.golang.org/p/iy9QealMxcT</a>链接到围棋运动场了解这一要点。</p><p id="4b30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，你知道有多少个<code class="fe kt ku kv kw b">integers</code>被发送到通道，有多少个被接收。</p><p id="ad81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第12行:<code class="fe kt ku kv kw b">numberCh &lt;-i</code>表示我们正在向通道发送整数</p><p id="db93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第16行:<code class="fe kt ku kv kw b">&lt;- numberCh</code>意味着我们正在从渠道中获取价值</p><p id="9746" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这也可以用来将整数赋给变量，例如:</p><p id="96b9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe kt ku kv kw b">newNumber := &lt;- numberCh</code></p><p id="15c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些类型的通道称为缓冲通道，您知道需要创建和读取的通道数量。</p><p id="786b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是像这样使用通道对于运行一个简单的<code class="fe kt ku kv kw b">for</code>循环没有任何好处。通道在处理go例程时非常有用，因为go可以为一个操作生成自己的进程，这使得并行处理成为可能，从而使程序同时运行，使我们的程序更快。</p><p id="0561" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以要使用go例程，我们只需要将循环封装在一个函数中，并在循环前添加一个<code class="fe kt ku kv kw b">go</code>关键字。所以我们的代码应该是。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="0769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个<a class="ae ks" href="https://play.golang.org/p/kAxw-8yAEb9" rel="noopener ugc nofollow" target="_blank">https://play.golang.org/p/kAxw-8yAEb9</a>的围棋场地链接</p><p id="372c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你运行这个程序，你会看到它不打印任何东西，但程序成功完成并退出，这是因为我们运行三个不同的线程来运行这个程序。</p><ol class=""><li id="bb7c" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">执行整个程序的主线程</li><li id="1cbc" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">从第11行开始，我们创建了一个新线程，将整数发送到我们的通道</li><li id="b0f8" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">从第18行开始，一个新线程接收发送给通道的整数</li></ol><p id="a887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">主线程成功运行并退出，它不等待其他例程。第二个和第三个线程运行，但不会在主线程完成之前完成，因此不会打印。</p><p id="6988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你来自javascript，你以前见过这个。javascript中的解决方案是要么做出承诺并等待承诺解决，要么使用<code class="fe kt ku kv kw b">aysnc</code> <code class="fe kt ku kv kw b">await</code>。我们能在Golang做这个吗？</p><p id="f040" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，当然。</p><p id="3515" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Golang里有个叫<code class="fe kt ku kv kw b">WaitGroup</code>的东西，帮我们搞定这个。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="a9e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此代码的游乐场链接<a class="ae ks" href="https://play.golang.org/p/6ZuRLVg8tzb" rel="noopener ugc nofollow" target="_blank">https://play.golang.org/p/6ZuRLVg8tzb</a></p><p id="cae9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你可以看到程序的实际输出。这和javacsript <code class="fe kt ku kv kw b">waitAll</code>一模一样。</p><p id="e0b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但这真的是同时进行的吗？你只能看到打印的数字，而且是升序排列的。这对我来说不太符合。让我们稍微改变一下程序，看看它是并发运行的。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="kq kr l"/></div></figure><p id="9e09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接到这个代码的go playground<a class="ae ks" href="https://play.golang.org/p/LfLtaE7nGQB" rel="noopener ugc nofollow" target="_blank">https://play.golang.org/p/LfLtaE7nGQB</a></p><p id="105a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们把频道增加到50个，浏览了50个号码。</p><p id="1147" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第19行，我们正在打印我们正在发送的号码</p><p id="22be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第27行，我们正在打印我们收到的号码</p><p id="fa16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它的输出看起来像这样</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/55ffe4e24ac75b4f00f9331baf5886a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:316/format:webp/1*nZqe_8G3B7HH07Is7sEJyA.png"/></div></figure><p id="4132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它随机接收和发送数字，它不等待第一个go例程完成就开始接收数字。</p><p id="425c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是Golang中一个非常简单的通道实现，用于处理go例程和通道。<a class="ae ks" href="https://medium.com/@developer.naren/handling-errors-in-channels-e76ad5cbf3a0" rel="noopener">在下一部分</a>，我们可以学习如何处理围棋程序中的错误。</p></div></div>    
</body>
</html>