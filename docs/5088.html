<html>
<head>
<title>Deploy Ionic App with CD to Linux Based App Service on Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将带有光盘的Ionic应用程序部署到Azure上基于Linux的应用程序服务</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-ionic-app-with-cd-to-linux-based-app-service-on-azure-9ba7523348a?source=collection_archive---------5-----------------------#2020-12-07">https://itnext.io/deploy-ionic-app-with-cd-to-linux-based-app-service-on-azure-9ba7523348a?source=collection_archive---------5-----------------------#2020-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f7a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我与Azure DevOps完全集成工作了2年多，但我从未参与CD部分的构建序列。感谢我的队友，他们已经创建了一个微调的构建和发布管道，所以我不觉得缺少它。有时我会遇到一些小问题。然后我谷歌了一下(😏)并修复了原因。然而，对它没有一个基本的了解，让我感到不舒服。</p><p id="c495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我的学习方法是跳进海里，努力求生。最近我也在探索离子。但是，在取得一些进展后，我需要在移动设备上测试它。在<strong class="jp ir">之前，我使用<strong class="jp ir"> Visual Studio扩展</strong>直接将更改推送到<strong class="jp ir"> Azure应用服务</strong>。</strong></p><p id="7c72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每次我将一些东西合并到'<strong class="jp ir"> develop </strong>'分支时，我都使用Azure DevOps pipelines作为快捷方式，在Azure上基于Linux的应用服务上部署我的Ionic应用。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="7358" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure DevOps主要包含三大项:</p><ul class=""><li id="480e" class="ks kt iq jp b jq jr ju jv jy ku kc kv kg kw kk kx ky kz la bi translated">源代码控制</li><li id="63de" class="ks kt iq jp b jq lb ju lc jy ld kc le kg lf kk kx ky kz la bi translated">积压和问题跟踪</li><li id="1190" class="ks kt iq jp b jq lb ju lc jy ld kc le kg lf kk kx ky kz la bi translated">构建和管道</li></ul><p id="55ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章讲的都是<strong class="jp ir">最后一个</strong>。我们将创建两个不同的管道来将代码部署到web服务器。</p><h2 id="8d9c" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">准备</h2><p id="2b7c" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">导航到<a class="ae me" href="https://dev.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure </a>并登录。如果你有一个项目，打开它；如果没有，请创建一个新的。此时，您可以克隆回购并推送您的代码。我从一个模板创建了一个Ionic应用程序，并将在这个演示中使用它。第一步是建立分支机构。</p><h2 id="3592" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">1-建立管道</h2><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mf"><img src="../Images/6a4df1df5b7cebe3d978cbfb6dd19164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i0K5Iaz7MhMVJMtgVk_aUA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">说真的，你的代码呢？</figcaption></figure><p id="6094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到左边的管道选项卡，然后创建一个新的。当源列表显示时，点击底部的链接切换到<strong class="jp ir">经典编辑器。</strong></p><p id="633b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我现在将远离YAML文件，因为向导使事情变得很容易。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mv"><img src="../Images/39289cfb6b4f8dd67f381a630a85f326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3s7D_5YuBdyKT84ToAPUMg.png"/></div></div></figure><p id="b906" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您看到经典管道向导时，首先选择您的存储库。</p><p id="9116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在下一页，使用一个<strong class="jp ir">空模板</strong>，这样我们就可以随心所欲地装饰它。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mw"><img src="../Images/4bbb8030d0945d89587e5657f44cb6da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqcTNAS4PrBA8gCRuXkHUA.png"/></div></div></figure><p id="0774" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在左侧窗格中，'<em class="mx"> Get Sources' </em>部分显示了我们的代码库和将用于该管道的分支。下面的部分向我们展示了任务的占位符。我只会重新命名工作的名称。其余的设置在我看来都不错。</p><p id="e7c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击该行右侧的加号按钮。这将提示另一个屏幕，让我们为我们的管道选择任务。</p><p id="a636" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> I) NodeJs工具安装程序</strong></p><p id="512f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了能够构建分支，我们需要在代理上运行构建命令。我们需要NodeJs来使用npm执行我们的构建命令。向下滚动并添加<strong class="jp ir"> NodeJs工具安装程序</strong>。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi my"><img src="../Images/46eccfda4a210b3c16929dbc2003b956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lZHHyVjopITcD67GxEetkg.png"/></div></div></figure><p id="f772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择以下版本:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi my"><img src="../Images/d122993c28c14fdd015234b6cf98bde6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLrm8q826ABtVd36bPHP1A.png"/></div></div></figure><p id="4d5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的例子中，node v10.x为我的项目工作，如果你需要一个特定的版本，把它放在那里。</p><p id="0b7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> II)安装依赖关系</strong></p><p id="10d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在构建之前，就像我们在本地上做的一样，安装所有npm依赖项:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi my"><img src="../Images/e449a2c521bd11efb4c91cbc18b9560d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ViuIeZX6LEJpKDHiJxj5iw.png"/></div></div></figure><p id="1ad7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mx">*如果您的package.json在另一个文件夹中，请选择该文件夹。如果它在根目录中，请将其留空。</em></p><p id="db71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">三)建设项目</strong></p><p id="efc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要运行另一个npm任务来构建。添加相同类型的任务来运行Ionic的构建脚本。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi my"><img src="../Images/d1814e84f155121c616a2b714f2cfad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0o_eN2HeJ-ACeepCvG3_pg.png"/></div></div></figure><p id="77b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这时，如果你保存配置然后运行；您将看到构建将会成功。现在我们要把那些神器打包，提取到目标。</p><p id="d178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mx">发布管道需要最后两个步骤。我们需要build &amp; publish工件来发布应用程序。</em></p><p id="7faf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> IV)归档构建工件</strong></p><p id="36f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，构建工件位于项目根目录下的“www”文件夹中。(您可以通过查看<strong class="jp ir"> angular.json </strong>文件来检查位置信息)。我们将打包构建输出，这样我们就可以为发布管道发布工件包(我们也可以轻松地下载它进行故障排除)。添加另一个任务，搜索“存档文件”。配置如下所示:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/de125333e80ee7af771952538c87aca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gsF0spw5143PMb-RiYQsqQ.png"/></div></div></figure><p id="2246" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">要存档的根文件夹或文件</strong>:在设置要存档的文件夹时，取消选中上图中我标记的文本框。如果选中，您的文件夹将与该文件夹一起存档，如果不选中，该文件夹的内容将被存档。</p><p id="7fd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建</strong>路径的归档文件应该是<code class="fe na nb nc nd b">$(Build.ArtifactStagingDirectory)/&lt;filename&gt;.zip </code>，这样下一个任务才能工作。</p><p id="4f1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个包含我们的应用程序的zip文件。</p><p id="8923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> V)发布构建工件</strong></p><p id="728d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将发布上一步中创建的zip文件。向管道添加另一个任务，并搜索<strong class="jp ir"> Publish Build工件。</strong></p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mz"><img src="../Images/3711618ab825ef3c3541b9bd4e5a3803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cKaycnxUYj2i_Ps1fGZV7w.png"/></div></div></figure><p id="ec7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">发布路径</strong>应该与归档任务目的地相同。</p><p id="ae8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经成功地创建了一个<strong class="jp ir">构建管道。在创建发布管道之前，让我们准备Azure上的应用服务。</strong></p><h2 id="af44" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated"><strong class="ak"> 2- Azure应用服务</strong></h2><p id="90e1" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">跳转到<a class="ae me" href="http://portal.azure.com" rel="noopener ugc nofollow" target="_blank"> Azure门户</a>并创建一个资源组，以便能够创建一个应用服务。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ne"><img src="../Images/50b1d74826cdaa9b8ebd9aed9da2ab85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGPBzriJ66swEvG6DVD8hw.png"/></div></div></figure><p id="9ab8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，创建一个应用服务。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ne"><img src="../Images/e9ced5fff93a14c3acf6780f5efe9b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RtyAa75FwXQNuuU_0DUdJQ.png"/></div></div></figure><p id="21cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序服务的配置如下图所示:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nf"><img src="../Images/c38fd5972460628530a2a57b10e96bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_q1Mdd2DjOQbMwXmKo99w.png"/></div></div></figure><pre class="mg mh mi mj gt ng nd nh ni aw nj bi"><span id="9bba" class="lg lh iq nd b gy nk nl l nm nn"><strong class="nd ir">Subscription     : </strong>I already have a Visual Studio Professional Subscription provided by my company. But for new users, <a class="ae me" href="http://azure.microsoft.com/en-us/free" rel="noopener ugc nofollow" target="_blank">Azure gives free credit for 12 months</a> or ask your company for a subscription.<br/><strong class="nd ir">Resource Group   : </strong>Select the resource group that we created in the previous step.<br/><strong class="nd ir">Name             :</strong> Give your app service a name.<br/><strong class="nd ir">Publish          :</strong> We are going to publish our build artifacts instead of a docker image. So select <strong class="nd ir">Code.<br/>Runtime Stack    </strong>: In the build pipeline, we create a task to install Node 10.x. So select the same version here.<br/><strong class="nd ir">Operating System </strong>: Linux <br/><strong class="nd ir">Linux Plan       : </strong>Create a new plan</span></pre><p id="0739" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mx"> —为什么是Linux？</em> </strong> <em class="mx">因为用Linux托管一个app相对便宜。同样配置的Windows服务，价格几乎翻倍。</em></p><p id="b658" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击<strong class="jp ir">查看和创建</strong>按钮创建应用服务。</p><p id="75e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以导航到您的应用程序服务详细信息并进行浏览。默认情况下，您会看到一个欢迎页面。</p><h2 id="e858" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">3-释放管道</h2><p id="95fc" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">您可以在构建管道中直接将您的构建推送到应用服务中，对此没有限制。但是，您可能需要将不同的构建部署到不同的阶段。这就是为什么我们需要一个不同的管道来发布。</p><p id="5d98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在<strong class="jp ir">管道&gt;发布</strong>之后，从左侧菜单转到发布页面，并创建一个新的。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi no"><img src="../Images/6fdaf930d7f6756754434f6cfa5d197a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61oRcAWsK1BBkCkjHCbQtw.png"/></div></div></figure><p id="7d2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在左侧的窗格中，我们需要设置要部署的包。在右边的窗格中，我们将添加一个新的stage，它将代表我们在上一步中创建的Azure应用服务。</p><p id="0173" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“添加工件”框，选择您的构建管道作为源，然后保存它。现在pipeline知道发布什么但是不知道在哪里发布。单击“添加阶段”。</p><p id="2f63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“Azure应用服务”作为模板，为其命名，然后关闭它。现在，您将看到一个未配置的阶段。单击“查看阶段任务”进行修改。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi np"><img src="../Images/598988cbcf8c026cc0d665f3a32c46bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xtthjr86glYeVIfiMg6Yug.png"/></div></div></figure><p id="b6cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在修改任务之前，最好提一下我们需要一个工具来服务ionic app。在我的例子中，我选择带有NodeJs的<strong class="jp ir"> ExpressJs </strong>来提供我们应用程序的静态文件。</p><p id="2251" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们需要一个小型的ExpressJs app。在发布管道上，我将准备一个小型NodeJs应用程序，并将其与Ionic build合并。</p><p id="234b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> I)提取工件到一个文件夹</strong></p><p id="a5de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用“提取文件”任务将工件的内容提取到以下路径。</p><pre class="mg mh mi mj gt ng nd nh ni aw nj bi"><span id="5211" class="lg lh iq nd b gy nk nl l nm nn">$(System.DefaultWorkingDirectory)/_pipelines-demo-CI/drop/node-app</span></pre><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nq"><img src="../Images/f9d04449fd08152e3a7b3a72796ad018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7DMsQhUB3-NxV9bgVHDnw.png"/></div></div></figure><p id="25d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> II)添加package.json </strong></p><p id="ab03" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了能够在NodeJs上提供我们的应用程序，我们需要两个包:</p><ul class=""><li id="21a9" class="ks kt iq jp b jq jr ju jv jy ku kc kv kg kw kk kx ky kz la bi translated">表达</li><li id="e897" class="ks kt iq jp b jq lb ju lc jy ld kc le kg lf kk kx ky kz la bi translated">压缩</li></ul><p id="fb97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在运行<code class="fe na nb nc nd b">npm install</code>之前，使用<strong class="jp ir">命令行</strong>任务添加一个package.json文件:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nq"><img src="../Images/e2d938d489d5c0e888db161934c57f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e4VZ0awfQQWgp1ujnBAe_Q.png"/></div></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nq"><img src="../Images/1a74bf98e932a569eb34bf6e25d927c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GEx2WeDPg0pt4MjBn9NjA.png"/></div></div></figure><p id="f1b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">跳转到node-app文件夹，然后添加文件内容。整个剧本如下:</p><pre class="mg mh mi mj gt ng nd nh ni aw nj bi"><span id="dbfd" class="lg lh iq nd b gy nk nl l nm nn">cd node-app<br/>cat &lt;&lt; 'EOF' &gt;&gt; package.json</span><span id="9793" class="lg lh iq nd b gy nr nl l nm nn">{<br/>  "dependencies": {<br/>    "compression": "^1.7.4",<br/>    "express": "^4.17.1"<br/>  }<br/>}</span><span id="9a78" class="lg lh iq nd b gy nr nl l nm nn">EOF</span></pre><p id="8fe0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> III)添加node-start.js </strong></p><p id="f957" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一个合适的js文件来启动节点服务器。添加另一个<strong class="jp ir">命令行</strong>任务，并添加一个插入以下内容的文件:</p><pre class="mg mh mi mj gt ng nd nh ni aw nj bi"><span id="bfa6" class="lg lh iq nd b gy nk nl l nm nn">cd node-app<br/>cat &lt;&lt; 'EOF' &gt;&gt; node-start.js</span><span id="1005" class="lg lh iq nd b gy nr nl l nm nn">var express = require("express"),<br/>  path = require("path"),<br/>  fs = require("fs");<br/>var compression = require("compression");<br/>var app = express();<br/>var staticRoot = __dirname + "/";<br/>var env = process.env.NODE_ENV || "development";</span><span id="38e8" class="lg lh iq nd b gy nr nl l nm nn">app.set("port", process.env.PORT || 5000);</span><span id="55e4" class="lg lh iq nd b gy nr nl l nm nn">app.use(compression());</span><span id="41ac" class="lg lh iq nd b gy nr nl l nm nn">app.use(express.static(staticRoot));</span><span id="0021" class="lg lh iq nd b gy nr nl l nm nn">app.get('*', (req, res) =&gt; <br/>{<br/>    var pattern = new RegExp('(.css|.html|.js|.ico|.jpg|.jpeg|.png)+$', 'gi');<br/>    if (pattern.test(req.url)) {<br/>      res.sendFile(path.resolve(__dirname, req.url));<br/>    } else {<br/>      res.sendFile(path.resolve(__dirname, '../../public/index.html'));<br/>    }<br/> });</span><span id="333c" class="lg lh iq nd b gy nr nl l nm nn">app.listen(app.get("port"), function () {<br/>  console.log("app running on port", app.get("port"));<br/>});</span><span id="feaa" class="lg lh iq nd b gy nr nl l nm nn">EOF</span></pre><p id="35c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> IV)安装NodeJs应用程序的依赖关系</strong></p><p id="7b4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像我们在创建构建管道时所做的那样，添加一个<strong class="jp ir"> npm </strong>任务。</p><blockquote class="ns nt nu"><p id="5d92" class="jn jo mx jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">不要忘记设置package.json文件路径。</p></blockquote><p id="c4ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> V)部署到Azure Web应用</strong></p><p id="8e8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为最后一步添加新任务。搜索“Azure Web App”。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nq"><img src="../Images/5b4974d3b38177ef50bd94772f8fbcfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Hgc5lBjJGJYzSSMF73UbA.png"/></div></div></figure><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ny"><img src="../Images/8a8141df1904d78603aaaf2ca7c16cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VjXTseoJ1PErMbwpTl0vEg.png"/></div></div></figure><p id="1b45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果团队项目中没有活动的Azure连接，它会提示您添加一个新的。设置连接后，您会看到一个类似上面的屏幕。</p><pre class="mg mh mi mj gt ng nd nh ni aw nj bi"><span id="7556" class="lg lh iq nd b gy nk nl l nm nn"><strong class="nd ir">Azure subscription : </strong>Your subscription will appear after creating the connection.<br/><strong class="nd ir">App type           :</strong> Web App on Linux (because we created an app service selecting Linux).<br/><strong class="nd ir">App name           : </strong>Select your app service name.<br/><strong class="nd ir">Package or folder  </strong>: Select the folder that contains our NodeJs app.<br/><strong class="nd ir">Runtime stack      :</strong> 10 LTS<br/><strong class="nd ir">Startup command </strong>   : node home/site/wwwroot/node-start.js</span></pre><p id="ed6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存它并创建一个新的版本来检查管道。它应该能够成功发布该版本。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nz"><img src="../Images/74b5dd01938546c97b287c8d6a8a1fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COM6xW0n_idb3LwAma-wiw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">成功发布</figcaption></figure><p id="15d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们将构建和发布管道连接起来，这样当您将变更推送到您的主分支时，它将自动构建和部署。</p><h2 id="1906" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">四触发器</h2><p id="8f3d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated"><strong class="jp ir"> I)将变更推送到分支后触发构建</strong></p><p id="7676" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导航到构建管道，单击编辑，并从顶部选择“触发器”选项卡。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nz"><img src="../Images/bdd53b5b78823f97316ffcc2784b6c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VMTPb_26ZU0yiXH5RUkgRw.png"/></div></div></figure><p id="0590" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">勾选<em class="mx">启用持续集成</em>，选择想要的分支，然后保存。现在，您的构建管道将在变更被推送到目标分支后立即排队。</p><p id="4479" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> II)构建后触发释放管道</strong></p><p id="e6ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开你的发布管道。在工件窗格中，单击右上角的按钮。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oa"><img src="../Images/7bb2db216fe3389d0fc1f075fd41a0fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5Nc7h98b8dBkH8mIcdB9A.png"/></div></div></figure><p id="3ae4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启用连续部署触发器:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ob"><img src="../Images/8fa3086f423efd812bdff7a23e31e983.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SO6zgPuO9YyBAgenaKdWNg.png"/></div></div></figure></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="8d63" class="oc lh iq bd li od oe of ll og oh oi lo oj ok ol lr om on oo lu op oq or lx os bi translated">解决纷争</h1><p id="e62f" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在创建成功的管道时，我失败了太多。这里有两个对我帮助很大的提示:</p><h2 id="fd83" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">I)检查您在哪个文件夹中</h2><p id="23ec" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">使用“终端”任务，您可以将当前文件夹打印到日志中。</p><p id="7f46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行终端任务时，您可以使用<code class="fe na nb nc nd b">ls -l</code> for Linux terminal列出您当前所在的所有内容，这样您就可以检查是否有文件丢失。使用<code class="fe na nb nc nd b">pwd</code>命令将向您显示完整的路径，这样您可以跳转到目标文件夹来运行实际的命令。否则，很难发现管道的问题</p><h2 id="68fc" class="lg lh iq bd li lj lk dn ll lm ln dp lo jy lp lq lr kc ls lt lu kg lv lw lx ly bi translated">II)更改启动命令以检查应用服务有什么问题</h2><p id="392b" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">即使您的发布管道成功地将内容推送到服务器，您的应用程序也可能在冷启动时崩溃。如果删除该命令，应用程序将显示默认页面。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ot"><img src="../Images/109eafb04e2792bd232cf02659cfd9a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFiK3Hdk33HxZcfRvZb-tA.png"/></div></div></figure><p id="3133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以浏览在线SSH工具来检查问题。就我而言，我在设置NodeJs应用程序时经常使用它。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><p id="2d53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望这篇教程能帮助你探索Azure上的管道。如果你认为这篇文章中有误导信息，请与我分享，以便我可以修复它。</p><p id="5e50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你好运！</p></div></div>    
</body>
</html>