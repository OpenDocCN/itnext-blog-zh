# 构建安全的云原生基础架构的顶级 GitOps 策略

> 原文：<https://itnext.io/top-gitops-tactics-to-build-secure-cloud-native-infrastructure-7c70f5d4cbf4?source=collection_archive---------4----------------------->

在企业向云迁移的推动下，GitOps 的采用率正在上升。我们可以将它的日益流行归因于它在简化基础设施管理方面的效率。因此，云安全是一个必不可少的组件。

在 [GitOps](https://www.weave.works/technologies/gitops/) 帮助公司加快交付和上市时间的同时，它也有助于提高持续集成(CI)和持续交付(CD)管道的安全性。它可以作为开发人员在整个软件开发生命周期(SDLC)中识别和解决潜在漏洞的基础。

基础设施即代码(IaC)和 GitOps 一起支持 CI、CD、版本控制和协作。在这个场景中，DevOps 团队将只与 Git 接口交互。所有集成和部署都将完全自动化。

# 为什么 GitOps 很重要？

当您在集中式存储库中管理应用程序、IaC 和状态时，您可以自动化大量 IT 操作。这种方法减轻了开发人员的负担，因为它通过代码来管理安全性和合规性。

利用 CI/CD 管道和 IaC 的企业在实施之前使用一系列线性测试和关卡来部署更新。它还补充了敏捷和 [DevOps](https://www.magalix.com/blog/what-is-devsecops-and-why-is-it-important) 协议和最佳实践。

在云环境中，如果应用程序流量突然增加，您可能会遇到一些性能问题和(当然)糟糕的用户体验。要解决这个问题，您可以快速增加云原生应用程序的资源分配。

您可以定义特定的资源增量，并将这些更改推送到存储库。在这种情况下，其他开发人员会很快审查和验证变更，并批准生产和部署。

这些类型的事件初始化 Git 操作符，并触发 GitOps CI/CD 管道。Git 操作员必须比较状态，将新配置识别为状态变化，并自动编排底层基础设施以匹配所需的状态。

但是，您必须监控自动生成和通知的潜在故障。在没有潜在问题的情况下，它会自动修改您的资源分配，以满足新的用户需求。如果失败或者出现配置错误，您可以简单地回滚到以前的状态并重新开始。

您可以利用 GitOps 来控制变更，并将其作为单一的事实来源进行验证，例如:

## 变更是可审计的

版本控制跟踪发布的内容，并允许您按需回滚。根据提交历史，对存储库上的注释、评审和决策进行审计跟踪。

## 配置为代码(CaC)

管理你在 Git 上的所有 [YAML](https://www.redhat.com/en/topics/automation/what-is-yaml) 文件，以快速检查你是否符合安全策略。因为访问策略是在配置文件中声明的，所以您可以很快知道谁有权访问以及访问什么。

## 将生产与 Git 中的期望状态相匹配

作为事实的单一来源，代码和基础设施变更的标准工作流以及对漂移的自动警告提高了可靠性并降低了人为错误的风险。在这种情况下，权限、安全扫描和测试有助于使您的更改更加安全和高度可靠，从而避免基础结构漂移。

在高级 GitOps 环境中，您还可以对 Git 存储库进行更改，并通过用于质量保证(QA)测试的标签将它们自动应用到实时基础设施中。

# GitOps 如何影响云安全？

几年前，早期采用者为他们的基础设施代码和应用程序代码维护两个或更多独立的 Git 存储库。两个不同的团队经常管理这些。这种方法旨在限制风险半径，但最近，事情开始发生变化。

GitOps 将一切都视为代码的能力对安全性有着巨大的影响。当所有的安全策略都编码好了，你就可以很容易地把所有的东西都放在版本控制中。在这种情况下，所有的变更都将被修改并被推送到一个自动化的管道中，该管道反过来验证、部署并持续监控所有的变更。

## 一切如代码实现持续的云安全

GitOps 作为单一的事实来源，有助于提高云安全性，确保不变性和开发速度。在这种情况下，您不必等到开发周期结束时才考虑安全性测试，因为您很早就将安全性转移到了左边。

## 策略即代码支持早期反馈

云原生应用的安全性测试是每个迭代的一部分。例如，编写策略并在提交时实施它们，可以提供早期测试和关于可能在管道末端产生安全问题的更改的反馈。

这意味着您可以在代码投入生产之前很久就识别并消除错误和漏洞。GitOps 安全方法补充了持续集成和 CI/CD 协议，确保每个人都遵循安全最佳实践。

# 什么是作为代码的策略？

[策略即代码](https://www.magalix.com/blog/what-is-policy-as-code)本质上是一个编纂策略的概念。通过将安全策略提交给代码，您可以编写代码计划来自动化和管理安全策略。

当实现用高级语言创建的代码策略时，您必须利用策略执行引擎或平台。这种方法通过在特定集群或整个公司内实施某些规则，帮助维护组织内的安全标准。

这些基于代码的规则存在于文本文件中，确保开发团队始终遵循最佳实践。

通过将一切视为代码，GitOps 有助于提高开发管道中几个不同元素的安全性(包括策略和配置)。当所有这些结合在一起时，开发人员可以更快地迭代版本控制，实现持续集成，测试自动化，以及 Git 中的其他特性。

当开发人员利用自动化时，他们拥有对基础设施模板的完全可审计性和版本控制。这种方法有助于通过清晰的关注点分离来提高开发速度。这意味着您不需要访问 CI/CD 平台或生产环境就可以将代码推送到存储库中。

这种分离有助于增强安全协议，并允许团队采用[最小特权](https://www.cyberark.com/what-is/least-privilege/#:~:text=The%20principle%20of%20least%20privilege,perform%20his%2Fher%20job%20functions.)的实践。这意味着只有少数经过验证的用户可以访问更小的攻击面。

如果您使用的是 Kubernetes 外部机密，您也可以将它们安全地存储在您的云原生机密存储中。这种方法能够自动地、独立于 Git 地按需快速旋转任何秘密。您还可以对每个秘密使用细粒度的基于角色的访问控制(RBAC)。

说到安全，GitOps 也让开发者承担责任。它通过在整个 SDLC 中嵌入安全扫描和防护栏，使整个过程变得更加容易。

当您用代码来加强您的安全状态时，您会对以下威胁保持警惕:

*   Git 用户互相模仿。
*   黑客移除安全功能。
*   不安全的旧版本 Git。
*   恶意用户试图重写历史。

任何潜在的 bug 或对设定状态的偏离都会在开发周期的早期被发现。因此，您可以使用 GitOps 作为策略，将安全性进一步左移。

如果您面临对管道的更改导致数据泄露的情况，您可以回到 GitOps 并触发快速响应来解决问题。当您将 IaC 存储在存储库中时，您还可以快速确定其中受影响的代码行。

当有可能快速识别攻击的规模和范围时，您可以更快地做出响应和恢复。这种方法有助于降低风险，减少违规发生的可能性。

在 Magalix，我们的业务是通过策略即代码(PaC)以编程方式执行安全标准。这种方法有助于为云原生应用构建以开发人员为中心的 CI/CD 体验。

## 在您的组织中实施 PaC 有助于:

*   只需点击一下鼠标，即可在 Kubernetes 集群间应用治理标准
*   跨云环境部署定制的策略检查
*   在 SDLC 的早期验证基础架构合规性
*   通过在 DevOps 工作流中实施 PaC 来巩固您的基础架构

在您的云原生环境中使用正确的行动手册和 GitOps 工作流，您的开发运维团队可以更快地创新，而不会影响安全性或合规性。您还可以定制您的组织策略，并通过代码自动执行它们。

本文原载于 Magalix:
[https://www . Magalix . com/blog/top-gitops-tactics-to-build-secure-cloud-native-infra structure](https://www.magalix.com/blog/top-gitops-tactics-to-build-secure-cloud-native-infrastructure)

*最初发表于*[](https://www.magalix.com/blog/top-gitops-tactics-to-build-secure-cloud-native-infrastructure)**。**