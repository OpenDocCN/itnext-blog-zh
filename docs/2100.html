<html>
<head>
<title>Trying Out BenchmarkDotNet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">试用BenchmarkDotNet</h1>
<blockquote>原文：<a href="https://itnext.io/trying-out-benchmarkdotnet-abcb2a5f960?source=collection_archive---------3-----------------------#2019-03-31">https://itnext.io/trying-out-benchmarkdotnet-abcb2a5f960?source=collection_archive---------3-----------------------#2019-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="956a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在软件中，有成千上万种不同的方法来完成同一件事情，我们倾向于用来确定行动过程的一个度量标准是我们感觉一组代码将如何优于另一组代码。事情是确定哪个代码实际上执行得更好有点棘手，我觉得一般来说人们是基于直觉而不是实际证据来做出选择的。即使开发者所涉及的证据如果没有被恰当地收集，那么它实际上是没有帮助的。例如，试图确定一组代码在调试模式下运行时的性能，实际上并不能很好地表明它将如何执行。</p><p id="fa87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开发商该怎么做？嗯，这就是<a class="ae kl" href="https://benchmarkdotnet.org/" rel="noopener ugc nofollow" target="_blank">BenchmarkDotNet</a>的用武之地。下面是这个项目对自己的描述。</p><blockquote class="km kn ko"><p id="71af" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated"><em class="iq">基准测试真的很难(尤其是微基准测试)，在性能测量过程中你很容易出错。BenchmarkDotNet将保护您避免常见的陷阱(即使对于有经验的开发人员来说也是如此),因为它为您做了所有的脏工作:它为每个基准方法生成一个独立的项目，多次启动这个项目，运行方法的多次迭代(包括预热),等等。通常，您甚至不应该关心迭代次数，因为BenchmarkDotNet会自动选择它来达到所要求的精度水平。</em></p></blockquote><p id="bad8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章的其余部分将介绍如何使用BenchmarkDotNet创建一个示例项目。</p><h1 id="6707" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">示例项目</h1><p id="d109" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我们将使用新的。NET核心控制台应用程序，可以使用下面的。NET CLI命令。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="2055" class="mf ku iq mb b gy mg mh l mi mj">dotnet new console</span></pre><p id="ac1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，运行下面的命令来添加<a class="ae kl" href="https://www.nuget.org/packages/BenchmarkDotNet/" rel="noopener ugc nofollow" target="_blank"> BenchmarkDotNet NuGet包</a>。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="d491" class="mf ku iq mb b gy mg mh l mi mj">dotnet add package BenchmarkDotNet</span></pre><p id="898e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在在<strong class="jp ir">程序</strong>类的<strong class="jp ir">主</strong>函数中，我们需要告诉应用程序运行我们感兴趣的基准。在这个例子中，我们告诉它运行<strong class="jp ir">字符串</strong>类中的基准。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="42e7" class="mf ku iq mb b gy mg mh l mi mj">public static void Main(string[] args) { BenchmarkRunner.Run&lt;Strings&gt;(); }</span></pre><p id="ec9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在在<strong class="jp ir"> Strings </strong>类中，我们有两个用<strong class="jp ir"> Benchmark </strong>属性标记的函数，这是包如何识别要测量的函数的。在这个例子中，我们将测量两种不同的不区分大小写的字符串比较方法的性能。</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="98eb" class="mf ku iq mb b gy mg mh l mi mj">public class Strings</span><span id="980c" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="9e67" class="mf ku iq mb b gy mk mh l mi mj">private readonly Dictionary&lt;string, string&gt; _stringsToTest =</span><span id="a211" class="mf ku iq mb b gy mk mh l mi mj">new Dictionary&lt;string, string&gt;</span><span id="3e3a" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="8da7" class="mf ku iq mb b gy mk mh l mi mj">{ “Test”, “test” },</span><span id="6942" class="mf ku iq mb b gy mk mh l mi mj">{ “7”, “7” },</span><span id="e343" class="mf ku iq mb b gy mk mh l mi mj">{ “A long string”, “Does not match” },</span><span id="86ed" class="mf ku iq mb b gy mk mh l mi mj">{ “Testing”, “Testing” },</span><span id="a536" class="mf ku iq mb b gy mk mh l mi mj">{ “8”, “2” }</span><span id="fbbd" class="mf ku iq mb b gy mk mh l mi mj">};</span><span id="d18f" class="mf ku iq mb b gy mk mh l mi mj">[Benchmark]</span><span id="ea15" class="mf ku iq mb b gy mk mh l mi mj">public bool EqualsOperator()</span><span id="908f" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="118b" class="mf ku iq mb b gy mk mh l mi mj">var result = false;</span><span id="6ab4" class="mf ku iq mb b gy mk mh l mi mj">foreach (var (key, value) in _stringsToTest)</span><span id="9624" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="a6dc" class="mf ku iq mb b gy mk mh l mi mj">result = key.ToLower() == value.ToLower();</span><span id="5240" class="mf ku iq mb b gy mk mh l mi mj">}</span><span id="6f64" class="mf ku iq mb b gy mk mh l mi mj">return result;</span><span id="5568" class="mf ku iq mb b gy mk mh l mi mj">}</span><span id="78ab" class="mf ku iq mb b gy mk mh l mi mj">[Benchmark]</span><span id="0ab6" class="mf ku iq mb b gy mk mh l mi mj">public bool EqualsFunction()</span><span id="97ed" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="2b84" class="mf ku iq mb b gy mk mh l mi mj">var result = false;</span><span id="d682" class="mf ku iq mb b gy mk mh l mi mj">foreach (var (key, value) in _stringsToTest)</span><span id="0939" class="mf ku iq mb b gy mk mh l mi mj">{</span><span id="728f" class="mf ku iq mb b gy mk mh l mi mj">result = string.Equals(key, value,</span><span id="0793" class="mf ku iq mb b gy mk mh l mi mj">StringComparison.OrdinalIgnoreCase);</span><span id="fb6c" class="mf ku iq mb b gy mk mh l mi mj">}</span><span id="2197" class="mf ku iq mb b gy mk mh l mi mj">return result;</span><span id="3d62" class="mf ku iq mb b gy mk mh l mi mj">}</span><span id="c087" class="mf ku iq mb b gy mk mh l mi mj">}</span></pre><p id="5753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我确信有更好的方法来为测试运行设置数据，但是上面的方法在我第一次尝试的时候是有效的。</p><h1 id="878a" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结果</h1><p id="ffce" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在发布模式下运行应用程序，您将看到类似如下的输出。</p><figure class="lw lx ly lz gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ml"><img src="../Images/3866df96af8fbf1618dc07d28205f45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKyApdMUNnCOXtS-3lpprQ.png"/></div></div></figure><h1 id="44d0" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">包扎</h1><p id="9d19" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">拥有一个能够消除运营方式中所有猜测的工具将是非常有价值的。这是我真希望几年前就找到的工具之一。该项目是开源的，可以在<a class="ae kl" href="https://github.com/dotnet/BenchmarkDotNet" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="fbf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp">原载于2019年3月31日</em><a class="ae kl" href="https://elanderson.net/2019/03/trying-out-benchmarkdotnet/" rel="noopener ugc nofollow" target="_blank"><em class="kp">【elanderson.net</em></a><em class="kp">。</em></p></div></div>    
</body>
</html>