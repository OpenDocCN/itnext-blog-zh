<html>
<head>
<title>Deploy Cloud Run for Nodejs Projects in Nx Workspace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Nx工作区中部署Nodejs项目的云运行</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-cloud-run-for-nodejs-projects-in-nx-workspace-ac1611f17f4e?source=collection_archive---------3-----------------------#2021-05-07">https://itnext.io/deploy-cloud-run-for-nodejs-projects-in-nx-workspace-ac1611f17f4e?source=collection_archive---------3-----------------------#2021-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d1be67f08267d763aa97be8b483b1843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0Jy7-K0if9UuUH-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/photos/4RCvKbu_kcY" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/4RCvKbu_kcY</a></figcaption></figure><blockquote class="kd ke kf"><p id="3f3c" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ir"> Nx </strong>是一套强大的可扩展开发工具，可帮助您设计、测试和构建任何规模的软件——与现代技术和库无缝集成，同时提供强大的CLI、缓存、依赖管理等功能。</p></blockquote><p id="688c" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我正计划开发多个<a class="ae kc" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">云运行</a>项目，也想利用monorepo共享库&amp;服务。</p><p id="64cc" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">这种集成的文档很难找到，即使您尝试Google一下。因此，我在这里，试图让它发生。这是第一步，还有改进流程的空间。</p><p id="c4be" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">在Nx中创建一个Express节点项目</strong></p><p id="bb06" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">建立一个Nx工作空间</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="2844" class="lr ls iq ln b gy lt lu l lv lw">npx create-nx-workspace myworkspace --preset=empty</span></pre><p id="1930" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">创建快递节点项目</strong></p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="2903" class="lr ls iq ln b gy lt lu l lv lw">yarn add -D @nrwl/express</span><span id="9ec9" class="lr ls iq ln b gy lx lu l lv lw">nx generate @nrwl/express:application &lt;express-app&gt;</span></pre><p id="323c" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">设置本地云运行</strong></p><p id="e921" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我使用的<a class="ae kc" href="https://cloud.google.com/code/docs/vscode/quickstart-cloud-run#installing_cloud_code" rel="noopener ugc nofollow" target="_blank">云代码</a>是一个插件，支持云运行&amp; Kubernetes的本地开发&amp;部署。</p><p id="6cbf" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">准备Dockerfile &amp; Vscode设置</strong></p><p id="5cd4" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">对于Nx Workspace中的不同项目，我使用以下命名约定。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="79dc" class="lr ls iq ln b gy lt lu l lv lw"># Dockerfile.api - for api project</span><span id="a70d" class="lr ls iq ln b gy lx lu l lv lw"># Use the official lightweight Node.js 14 image.<br/>FROM node:14-slim</span><span id="a153" class="lr ls iq ln b gy lx lu l lv lw"># Create and change to the app directory.<br/>WORKDIR /usr/src/app</span><span id="7c32" class="lr ls iq ln b gy lx lu l lv lw"># Copy application dependency manifests to the container image.<br/>COPY package*.json ./<br/>COPY yarn.lock ./<br/>COPY decorate-angular-cli.js ./</span><span id="1560" class="lr ls iq ln b gy lx lu l lv lw"># Install dependencies.<br/>RUN yarn</span><span id="c191" class="lr ls iq ln b gy lx lu l lv lw"># Copy local code to the container image.<br/>COPY . ./</span><span id="2c0c" class="lr ls iq ln b gy lx lu l lv lw"># Build the app<br/>RUN yarn build:api --production</span><span id="f01a" class="lr ls iq ln b gy lx lu l lv lw"># Run the web service on container startup.<br/>CMD ["node", "./dist/apps/api/main.js"]</span></pre><p id="e22a" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">而对于<strong class="kj ir">。vscode/launch.json </strong></p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="425d" class="lr ls iq ln b gy lt lu l lv lw">{<br/>  "configurations": [<br/>    {<br/>      "name": "Cloud Run: Run/Debug Locally - API",<br/>      "type": "cloudcode.cloudrun",<br/>      "request": "launch",<br/>      "build": {<br/>        "docker": {<br/>          "path": "Dockerfile.api"<br/>        }<br/>      },<br/>      "image": "workspace-name",<br/>      "service": {<br/>        "name": "workspace-name",<br/>        "containerPort": 8080,<br/>        "resources": {<br/>          "limits": {<br/>            "memory": "256Mi"<br/>          }<br/>        }<br/>      },<br/>      "target": {<br/>        "minikube": {}<br/>      },<br/>      "watch": true<br/>    },<br/>    {<br/>      "name": "Cloud Run: Run/Debug Locally - Web",<br/>      ......<br/>    }<br/>  ]<br/>}</span></pre><p id="ee41" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">有了这个设置，每次在本地运行或部署时，您都会看到使用哪个docker文件的选项。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/a861a43dd106c99440f1adecedc28682.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*D1ltpLEtvShyOCvd6M3IEQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">本地选项</figcaption></figure><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/2cf275f983fbd0dd279d20bcf4b2d21e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*JWSzSlsHYEH1ccgbUIe0LA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">部署选项</figcaption></figure><p id="8fd5" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">之后，您已经为Nx Workspace中的本地云运行开发做好了一切准备。</p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/bd76874a267a24dfd9fc110b17592505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*32FsZFrVtiuWwvppDfrrlg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">云运行正在localhost:8080上运行</figcaption></figure><p id="af56" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">这是我的实验，如果你有更好的选择，请帮助改进它🙏</p></div></div>    
</body>
</html>