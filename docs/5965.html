<html>
<head>
<title>GitOps with Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Kubernetes的GitOps</h1>
<blockquote>原文：<a href="https://itnext.io/gitops-with-kubernetes-740f37ea015b?source=collection_archive---------2-----------------------#2021-07-14">https://itnext.io/gitops-with-kubernetes-740f37ea015b?source=collection_archive---------2-----------------------#2021-07-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/8e68c0d39e60eaa67b6aef38bf89a636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZYRUC186rFiox2B9OVD9g.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">由<a class="ae jd" href="https://unsplash.com/@timelabpro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Timelab Pro </a>在<a class="ae jd" href="https://unsplash.com/s/photos/container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="d3e1" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">介绍</h2></div><p id="8e47" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">2017年，一家云原生公司<a class="ae jd" href="https://www.weave.works/" rel="noopener ugc nofollow" target="_blank">weaver works</a>发布了一篇名为“<a class="ae jd" href="https://www.weave.works/blog/gitops-operations-by-pull-request" rel="noopener ugc nofollow" target="_blank">GitOps——通过拉式请求进行操作</a>”的博文。这篇文章引入了术语<strong class="kx jh"> g itOps </strong>将其定义为<em class="lr">使用Git作为真理的来源来操作几乎任何事情。</em>从那以后，GitOps运动不断发展壮大，越来越受欢迎。</p><p id="5972" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将进一步了解什么是GitOps以及它如何应用于Kubernetes。应用GitOps原则我们能获得什么好处？简单用Git部署东西和GitOps有什么区别？我们能大规模使用GitOps吗？</p><h2 id="c65c" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">饭桶</h2><p id="ebdb" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">GitOps，顾名思义，和Git有关系。有趣的事实是，GitOps不一定是真正的(Git)Ops，它也可以是(SVN)Ops或(Mercurial)Ops，甚至是(版本控制系统)Ops…，但GitOps只是更好地脱口而出；)</p><p id="dd9e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">无论如何，我们都知道并喜欢Git(当它刚刚工作时)或讨厌它(当我们需要解决合并冲突时)。让我们快速回顾一下，现代的基于Git的开发人员工作流是什么样子的。显然，像Pull请求这样的特性不属于Git版本控制系统，而是属于GitHub、GitLab等。在图中，我们看到了开发人员执行的活动，包括作为管理代码变更的良好实践的拉请求。</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mq"><img src="../Images/c21bc8d49d86ffd41ab0c58c2a44ca20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPXGlE7tk_UEBAYixcMqXw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">示例Git工作流</figcaption></figure><p id="ce92" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">上面的例子以一种简化的方式展示了开发人员的工作流程，但是考虑到现在大部分工作是如何通过Git库完成的。</p><h2 id="c9a2" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">等等，我们不是一直在做GitOps吗？</h2><p id="ede7" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">你可能会问自己，你是不是一直都在做GitOps？有什么大惊小怪的？你一直在使用Git，每天都在提交/推送变更！关键的区别是<strong class="kx jh">协调循环</strong>持续发生，确保使用Kubernetes集群上的自动化代理<strong class="kx jh">在基础设施端</strong>反映Git repos中定义的任何内容。</p><p id="e257" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">换句话说；<strong class="kx jh"> GitOps =连续交付+连续运营。</strong></p><p id="befe" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们看看GitOps原则如何与Kubernetes一起工作。假设您的应用程序在Kubernetes集群中运行，并且您想要更新其部署清单以增加CPU资源余量。以“传统”的方式，你会:</p><ul class=""><li id="5df3" class="mv mw jg kx b ky kz lb lc le mx li my lm mz lq na nb nc nd bi translated">修改舵图，kustomize文件或平面部署YAML，改变CPU的要求和限制，为一个特定的部署</li><li id="2f5d" class="mv mw jg kx b ky ne lb nf le ng li nh lm ni lq na nb nc nd bi translated">使用kubectl将更改后的YAML应用到集群中</li></ul><p id="9a4d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在GitOps世界中，不是手动(或通过脚本或管道)将资源应用到集群，而是由一个专门的代理将更改拉入集群并代表您应用它们。</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/ee700dc480cf20f847ddff1a26eab14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOx3_hScga5SDb5yafjWKw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用Kubernetes的GitOps流</figcaption></figure><h2 id="5261" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">吉托普在库伯内特的优势</h2><p id="ee7d" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">Kubernetes为大规模管理工作负载带来了巨大的力量，但这种力量也伴随着复杂性的代价。人工干预越少，自动化程度越高越好。GitOps实现了非常高的自动化程度，在我看来这是它最大的好处。</p><p id="7bf5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是凯尔西·海托华对吉托普斯的评价。</p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/bd02d349a86e4fa1375ed97fe03d0005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lo55hzX30yntB6NN296xHg.png"/></div></div></figure><h2 id="dc20" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">GitOps工具</h2><p id="1990" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">GitOps工具正在迅速成熟，并提供了广泛的功能，涵盖了安全性和第2天的操作。我熟悉并且强烈推荐的工具是<a class="ae jd" href="https://www.weave.works/oss/flux/" rel="noopener ugc nofollow" target="_blank"> Flux </a>以及<a class="ae jd" href="https://www.weave.works/product/gitops-core/" rel="noopener ugc nofollow" target="_blank"> GitOps Core </a>(这两款工具都来自Weaveworks)。同类别还有一个很流行的工具<a class="ae jd" href="https://argoproj.github.io/argo-cd/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a>，但是我不太熟悉。</p><p id="4661" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">云提供商也开发他们自己的GitOps相关工具。例如，Azure使用<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/azure-arc/kubernetes/conceptual-configurations" rel="noopener ugc nofollow" target="_blank"> Azure Arc </a>和启用Azure Arc的Kubernetes，Google Cloud使用<a class="ae jd" href="https://cloud.google.com/kubernetes-engine/docs/tutorials/gitops-cloud-build" rel="noopener ugc nofollow" target="_blank">云构建</a>。</p><h2 id="8419" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">Kubernetes清单应用内回购或专用回购</h2><p id="0828" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">与GitOps相关的一个问题是:我应该将我的Kubernetes YAML清单放在与我的应用程序(微服务)相同的repo中，还是放在专用的repo中？</p><p id="ce39" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">答案取决于你的app在做什么，你有多少集群，你的平台团队有多成熟。如果您是一个小团队，并且在一个Kubernetes集群上只部署了少数应用程序，那么让您的Kubernetes清单与您的应用程序在同一个repo中是有意义的。</p><p id="0a21" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您是一个拥有多个集群的大型团队，那么将特定于集群的YAML文件从您的应用程序文件中分离到一个单独的repo中可能是一个更好的选择。</p><p id="87ca" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，请记住，所有YAML文件、舵图或其他应用更改到集群的方式都将从这些Git repos进行管理，因此请确保您的分支策略是正确的，您会没事的。</p><h2 id="0e20" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">如果我有100多个集群会怎样</h2><p id="1f6a" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">Kubernetes on the edge，在规模上，正在成为常态，但是我如何在只有2名团队成员的情况下管理多个Kubernetes集群？显然，自动化是关键。一个非常有趣的解决方案是<a class="ae jd" href="https://fleet.rancher.io/" rel="noopener ugc nofollow" target="_blank">牧场主舰队。</a></p><figure class="mr ms mt mu gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/5ee419244c28c1037cacba46704e2c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*74uCX__UgyVWob844FqdlA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">牧场船队</figcaption></figure><p id="e33d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用GitOps原则和Rancher惊人的大规模管理任何Kubernetes集群的功能，我们现在可以同时将GitOps原则应用于许多集群。</p><h2 id="5da1" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">我可以在哪里了解更多信息</h2><p id="532f" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">了解GitOps的最好方法是查看Weaveworks博客和资源，例如，<a class="ae jd" href="https://www.weave.works/technologies/gitops/" rel="noopener ugc nofollow" target="_blank">GitOps指南</a>，你也可以参与<a class="ae jd" href="https://github.com/gitops-working-group/gitops-working-group" rel="noopener ugc nofollow" target="_blank"> GitOps工作组</a>。</p><p id="5f70" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你想说服你的团队或老板试一试GitOps吗？查看<a class="ae jd" href="https://gitops-community.github.io/kit/#need-help-or-want-updates" rel="noopener ugc nofollow" target="_blank"> GitOps对话工具包</a>。</p><h2 id="a5cc" class="ls lt jg bd lu lv lw dn lx ly lz dp ma le mb mc md li me mf mg lm mh mi mj mk bi translated">结论</h2><p id="8898" class="pw-post-body-paragraph kv kw jg kx b ky ml kh la lb mm kk ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">我们只是触及了GitOps实践如何用于Kubernetes应用和基础设施的表面。GitOps是在云本地空间中越来越流行的一种趋势。值得你花点时间研究一下，看看它能给你和你的团队带来什么好处。</p></div></div>    
</body>
</html>