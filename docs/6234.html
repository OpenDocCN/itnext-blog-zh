<html>
<head>
<title>Embedding mockoon on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上嵌入mockoon</h1>
<blockquote>原文：<a href="https://itnext.io/embedding-mockoon-on-android-5c240f2a3143?source=collection_archive---------3-----------------------#2021-09-26">https://itnext.io/embedding-mockoon-on-android-5c240f2a3143?source=collection_archive---------3-----------------------#2021-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e19a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是Mockoon的忠实粉丝，我已经写了一篇关于它的博文<a class="ae kl" href="https://susuthapa19961227.medium.com/easy-front-end-development-with-mockoon-1ff656a7dba6" rel="noopener">在这里</a>。在Android上嵌入mockoon并不是一个要求，而是我想做的事情，在这篇博客中我将解释我是如何做到的。</p><p id="456c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是为那些着急的人准备的项目链接。</p><div class="km kn gp gr ko kp"><a href="https://github.com/susonthapa/mockoon-android" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab fo"><div class="kr ab ks cl cj kt"><h2 class="bd ir gy z fp ku fr fs kv fu fw ip bi translated">GitHub-suson Thapa/mocoon-Android:Android中的嵌入式mocoon实现</h2><div class="kw l"><h3 class="bd b gy z fp ku fr fs kv fu fw dk translated">嵌入式mockoon在Android中的实现。创建一个帐户，为suson tapa/mocoon-Android开发做贡献…</h3></div><div class="kx l"><p class="bd b dl z fp ku fr fs kv fu fw dk translated">github.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld le kp"/></div></div></a></div><h2 id="0a64" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">这是什么？</h2><p id="86e1" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">这是一个用于Android的Mockoon端口。只需从mockoon导出您的所有环境。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/efb10dd395a863fe1f04114d8802e454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fhNw0u8WAfUxNSOzaA_xjQ.png"/></div></div></figure><p id="6cd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后像这样在安卓里运行。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/12fd86fa52a519b1f67b5bcdda819e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*B3MfrObOGjlQNgM0-a74Kw.gif"/></div></figure><h2 id="db21" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">用例</h2><p id="9fa4" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">假设您开发了一个android应用程序，并希望向客户端展示一个演示。我们都知道那是怎么回事。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="31ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在演示时间之前，一切都正常。</p><h2 id="142e" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">我们能做些什么呢？</h2><p id="e205" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">嗯，只需用应用程序打包一个完整的模拟服务器。这样可以降低向客户端暴露后端错误的风险。但是怎么做呢？这是大图。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/0d05bef89398c463ee223d78d7d84f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ZSfuF1PDp5s1sEVVuI0P0Q.jpeg"/></div></figure><p id="b51a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Mockoon是一个nodejs应用程序，所以我们需要解决的第一件事是如何在android上运行nodejs。之后，我们只需要运行mockoon，一切都应该工作，对不对？</p><p id="1287" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事情没那么简单。mocoon有三个项目<a class="ae kl" href="https://github.com/mockoon/mockoon" rel="noopener ugc nofollow" target="_blank">mocoon-GUI</a>、<a class="ae kl" href="https://github.com/mockoon/cli" rel="noopener ugc nofollow" target="_blank">mocoon-CLI</a>和<a class="ae kl" href="https://github.com/mockoon/commons-server" rel="noopener ugc nofollow" target="_blank">mocoon-common</a>。起初我不知道mocoon-common，所以我选择了mocoon-CLI，因为这是唯一可行的选择。我做了设置，并试图运行，但mocoon-CLI是一个成熟的应用程序，所以它试图创建进程和访问受保护的目录，如<code class="fe ms mt mu mv b">/etc</code>。在与mockoon developer一起使用后，我知道了mockoon-common，它是一个最简单的服务器，GUI和CLI都使用它。但是首先我们需要想出一个在android上运行nodejs的方法。</p><h2 id="4d4d" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">如何在Android上运行nodejs？</h2><p id="ebef" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">有一个很棒的库<a class="ae kl" href="https://github.com/JaneaSystems/nodejs-mobile" rel="noopener ugc nofollow" target="_blank"> nodejs-mobile </a>，我们可以用它在Android上运行nodejs代码。你可以参考这篇<a class="ae kl" href="https://code.janeasystems.com/nodejs-mobile/getting-started-android" rel="noopener ugc nofollow" target="_blank">博客</a>关于如何集成nodejs-mobile的帖子。下面是项目结构。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/564ffe189ec648c8aa3071d1d8b5112e.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*khH-ZUO30LDuIinLBj6D3Q.png"/></div></figure><ol class=""><li id="ee19" class="mx my iq jp b jq jr ju jv jy mz kc na kg nb kk nc nd ne nf bi translated">在<code class="fe ms mt mu mv b">assets</code>文件夹中创建一个目录<code class="fe ms mt mu mv b">mockoon-android</code>，并使用<code class="fe ms mt mu mv b">npm</code>安装mocoon-commons。</li></ol><pre class="me mf mg mh gt ng mv nh ni aw nj bi"><span id="c017" class="lf lg iq mv b gy nk nl l nm nn">npm install @mockoon/commons-server</span></pre><p id="eb4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.设置<code class="fe ms mt mu mv b">cpp</code>文件夹，如这个<a class="ae kl" href="https://code.janeasystems.com/nodejs-mobile/getting-started-android" rel="noopener ugc nofollow" target="_blank">博客</a>帖子所示。其实博文挺老的，参考源码，可以直接复制粘贴文件夹就行了。</p><p id="d29a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.一个基本的<code class="fe ms mt mu mv b">C++</code>文件，通过日志重定向向start nodejs公开函数。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="4a31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们将mockoon打包在apk中，所以我们需要首先将项目提取到设备存储中，然后从那里运行它。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="c4ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个类加载nodejs运行时的共享库，将mockoon项目和模拟文件复制到缓存目录(如果还没有复制的话)。它还验证只有一个nodejs运行时实例是活动的，然后启动mockoon服务器。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="ac76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个类处理从目录和资产中复制文件。我们还需要编写一个简单的javascript文件(<code class="fe ms mt mu mv b">main.js</code>)来启动mockoon服务器。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="7d55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只是遍历所有环境并启动它们。我没有处理过许多边缘情况，如重复端口等，因为我希望这是简单的。</p><h2 id="85da" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">Apk大小</h2><p id="3597" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">因为我们正在打包mockoon和nodejs运行时，这给你的APK增加了大约60MB。因此，我们需要确保这不会影响生产。为了解决这个问题，我们需要创建一个专门用于模仿的构建变体。</p><h2 id="c7c2" class="lf lg iq bd lh li lj dn lk ll lm dp ln jy lo lp lq kc lr ls lt kg lu lv lw lx bi translated">我必须做这些吗？</h2><p id="1c6b" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">你不必经历这一切，我已经把它作为一个库发布了，你可以使用它。为此，首先创建一个新的变体。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="3e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后添加特定于该变体的依赖项，因为我们不想在生产或任何其他变体中泄露这一点。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="ee0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在初始化mockoon并提供环境文件的位置。您可以将环境文件与您的apk打包在一起，或者只从文件系统加载文件。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="no mq l"/></div></figure><p id="876d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能已经注意到我们使用反射，因为我们只在<code class="fe ms mt mu mv b">mock</code>版本中使用这个库，如果我们试图直接访问这个类，gradle会抱怨，因为它在所有版本中都不可用。</p><p id="4a7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章到此为止，我希望这对任何想在应用程序中嵌入模拟服务器的人都有帮助。</p></div></div>    
</body>
</html>