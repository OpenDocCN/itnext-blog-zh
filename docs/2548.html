<html>
<head>
<title>JS, Types and the road to sanity (flow, typescript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JS，类型和理智之路(flow，typescript)</h1>
<blockquote>原文：<a href="https://itnext.io/js-types-and-the-road-to-sanity-flow-typescript-dce65c9355cb?source=collection_archive---------3-----------------------#2019-06-12">https://itnext.io/js-types-and-the-road-to-sanity-flow-typescript-dce65c9355cb?source=collection_archive---------3-----------------------#2019-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不久前，我还被在JS上打字的想法折磨着。不是因为这是社区中的新宣传，而是因为我可以想象这样的实现有什么好处。</p><p id="7457" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使在一个使用react-redux不断增长的中小型项目中，您也可以看到，您必须从一个引用到另一个引用才能理解一个动作是如何被调用的。即使在测试中，这也会造成很大的麻烦，尤其是当你试图测试不是你写的代码时。最重要的是，当你开发应用程序时，当大量的错误出现时，类型检查会给你带来安全。</p><p id="8378" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我想我可以更深入一点，这样我就可以得到一个现实的想法，并根据我的发现来实施。</p><h1 id="a05e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">今日JS</h1><p id="2e36" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在潜入深水之前，让我们先想想我们要解决的问题。JS不是一种强类型语言，但正因为如此，它可以让每个人都有机会快速、毫无问题地构建应用程序。</p><blockquote class="lo"><p id="154b" class="lp lq iq bd lr ls lt lu lv lw lx kk dk translated">但是JS最好的长处真的会很快变成它的弱点。</p></blockquote><p id="7d7c" class="pw-post-body-paragraph jn jo iq jp b jq ly js jt ju lz jw jx jy ma ka kb kc mb ke kf kg mc ki kj kk ij bi translated">尽管JS不是一种强类型语言，但它定义了七种内置类型。这里有一个关于这些如何被称为类型、标记或子类型的争论，但是让我们坚持类型。这些类型如下</p><ul class=""><li id="7cdc" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">null</code></li><li id="5b7a" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">undefined</code></li><li id="abea" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">boolean</code></li><li id="ddbc" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">number</code></li><li id="6309" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">string</code></li><li id="bc05" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">object</code></li><li id="f17c" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated"><code class="fe mm mn mo mp b">symbol</code>-ES6中新增！</li></ul><p id="6275" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到这些类型就是他们声称使用的<code class="fe mm mn mo mp b">typeof</code>。在这里，在我调查的最开始，你可以看到这个问题。当惨叫看似没问题的时候，总有一个..酪</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="f0b5" class="nd km iq mp b gy ne nf l ng nh">typeof undefined     === "undefined"; // true<br/>typeof true          === "boolean";   // true<br/>typeof 42            === "number";    // true<br/>typeof "42"          === "string";    // true<br/>typeof { life: 42 }  === "object";    // true<br/><br/>// added in ES6!<br/>typeof Symbol()      === "symbol";    // true</span></pre><p id="dbc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是null呢？</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="2246" class="nd km iq mp b gy ne nf l ng nh">typeof null === ???;</span></pre><p id="c9fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Null是一种非常特殊且容易出错的情况，因为它的类型是<strong class="jp ir"> object </strong> …我知道它看起来很可怕，对吗？但是等一下，还有更多。</p><p id="c277" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即使是内置函数，比如布尔型、字符串型、数组型等等，你也会发现它的局限性。参见下面的例子</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="b4d6" class="nd km iq mp b gy ne nf l ng nh">var testVar = “i dont need types”                   === string<br/>var testVar = new String(“i don’t need types”)      === object</span><span id="136a" class="nd km iq mp b gy ni nf l ng nh">var testVar = false                                 === boolean<br/>var testVar = new Boolean(false)                    === object</span></pre><p id="e9ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到，如果你用一个布尔值或者一个字符串来创建一个变量，这个变量的类型对应于你所传递的内容。另一方面，如果你创建了内置函数，那么它们的类型就是object。</p><p id="eff0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这还不够奇怪的话，我收集了更多的例子来说服你。</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="ac86" class="nd km iq mp b gy ne nf l ng nh">10 + 5                                   === 15<br/>'10' + 5                                 === '105'<br/>'10' - 5                                 === 5               <br/>( + '10')                                === 10</span></pre><p id="ed23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以，你不能指望你自己的数字。</p><figure class="mv mw mx my gt nk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/f2432107e8872921e2523468783fe65a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*507YmEWUB1W7fLmlzaumEw.gif"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk translated">我知道那是什么感觉！</figcaption></figure><h1 id="7c78" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">类型需求</h1><p id="dd24" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">所以根据上面的例子，显然需要类型。这容易吗？</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="4cac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在研究JS项目的类型之前，您需要考虑几个利弊。</p><h2 id="5bf2" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">优势</h2><ul class=""><li id="fdfe" class="md me iq jp b jq lj ju lk jy oj kc ok kg ol kk mi mj mk ml bi translated">编译器上的错误</li><li id="8296" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">为下一个开发人员记录的代码</li><li id="ce91" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">避免javascript自己不直观地转换类型</li></ul><h2 id="4ea8" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">不足之处</h2><ul class=""><li id="d1ab" class="md me iq jp b jq lj ju lk jy oj kc ok kg ol kk mi mj mk ml bi translated">更多的发展时间</li><li id="4581" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">学习曲线(尤其是对于打字稿这种新语言)</li><li id="59c3" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">开发人员池</li></ul><h1 id="adbb" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">额外——除此之外，您还可以利用chrome v8的速度</h1><p id="52c9" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">记住这些，你必须看到你的选择。在JS社区中，有两个主要的参与者。流和类型脚本。</p><figure class="mv mw mx my gt nk gh gi paragraph-image"><div role="button" tabindex="0" class="on oo di op bf oq"><div class="gh gi om"><img src="../Images/cd8937f860e16690b277df2456f91f2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAP896WLOAJNH8uspXsbTA.png"/></div></div></figure><p id="888b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将跳过解释这两个的部分，直接看最后的结果。</p><p id="bb51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">流</strong>的情况下，你可以逐渐地导入到一个项目中，而不会破坏你的代码。不过这需要特别注意代码和形状，因为如果流程中还没有某些东西，它不会通知您。在这种情况下，您将需要使用flow-coverage-report，这增加了项目的复杂性。流量社区不断抱怨每一步的突破性变化。这些让心流很难运作。</p><p id="c2c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在打字稿的情况下，你必须改变<strong class="jp ir">一切……</strong>我是认真的。您必须将所有文件更改为ts、tsx等类型脚本的文件扩展名。你还必须安装你的模块所需的所有类型，例如react、redux等(2年前你可能会遇到一个问题，但现在你的模块有类型已经是很标准的了)。最后，您必须用类型定义所有现有的代码。相当痛苦。但是(总有但是)社区比流量大10倍。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="25fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你在一年前问我，我可能会选择Flow而不是Typescript，因为所有已经描述过的过程，但ATM我认为2019年是Typescript年。</p><p id="90f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是因为</p><ul class=""><li id="13de" class="md me iq jp b jq jr ju jv jy mf kc mg kg mh kk mi mj mk ml bi translated">被许多大公司选中，超过Jest等流量。</li><li id="ca7b" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">终于拥有了模块所需的所有类型</li><li id="a205" class="md me iq jp b jq mq ju mr jy ms kc mt kg mu kk mi mj mk ml bi translated">react create app提供了用现成的typescript项目创建应用程序的选项</li></ul><h1 id="ade8" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">一段时间后在React-Redux-RXjs项目上使用Typescript和我的发现/建议</h1><p id="71ff" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在使用了3.5个月之后，我总结出以下5个问题。</p><h2 id="b16f" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">非常棘手的类型检查redux生命周期</h2><p id="9718" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">检查生命周期变得越来越难，但是当你发现你的公式变得越来越简单。原因是您需要单独定义所有的操作，这样您就可以说action1将返回该操作。参见下面的例子</p><figure class="mv mw mx my gt nk"><div class="bz fp l di"><div class="or os l"/></div></figure><figure class="mv mw mx my gt nk"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="d5d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，通过将所有动作定义为一个类型，可以帮助您将该类型导入到缩减器中，并说明在该缩减器中采取的动作将是该类型中的一个。</p><figure class="mv mw mx my gt nk"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="7687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你在Reducer中定义了initialState是用户(或者你可能有一些不同的东西，比如UserReducer等等)，这个reducer采取的动作是UserActionTypes，并且返回一个用户(或者如所说的UserReducer依赖于你)，如果在这之间有任何变化，你都会知道；) .这里最重要的是，如果你的有效负载是一个带键的对象，那么每个开关盒都知道这个属性是否存在，并告诉你一个错误！一开始很难，但之后，新鸭子会用复制粘贴来拯救它。</p><h2 id="eac1" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">在文件结构上区分类型变得越来越困难</h2><p id="f999" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">如前所述，我有一个包含所有所需类型的types.ts文件。但是有些情况下，当你想规范化一些API的数据，或者你在一个utils文件中有一个需要在应用程序间共享的属性。我的建议是不要污染types.ts文件，将逻辑和文件夹中的类型分开，这样如果你有一个需要类型的util文件，就可以将它们放在一个文件夹中。</p><h2 id="a77b" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">Redux-Observable缺少关于如何对epic进行类型检查的文档</h2><p id="2bd5" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我发现很难对我的史诗进行打字检查。原因是我找不到任何文档来源来给出一个很好的例子，这个例子对于理解它的人来说不会太复杂。我使用的解决方案很简单，但我花了一些时间来弄清楚，并确保我的epic类型检查正确。</p><figure class="mv mw mx my gt nk"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="ee46" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">连接和合成不再产生相同的结果</h2><p id="24ce" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我是这样的人，当我有几个HOC时，我不会在一个大的HOC链中使用它们，而是使用redux compose。</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="ec95" class="nd km iq mp b gy ne nf l ng nh">compose(hoc1, hoc2)(Component)</span></pre><p id="2310" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这会给你一个疯狂的错误消息，我不能让它工作，因为compose返回的不是一个组件。</p><pre class="mv mw mx my gt mz mp na nb aw nc bi"><span id="235e" class="nd km iq mp b gy ne nf l ng nh">Type error: JSX element type 'Component' does not have any construct or call signatures.  TS2604</span></pre><h2 id="9555" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">不要害怕在需要的时候使用它们</h2><p id="1f03" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">你完全不用害怕。在我的例子中，我使用情感来设计我的组件，所以任何对我来说不重要的东西都不必进行类型检查。但是不要过度。</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="5cf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，除了我面临的问题，我还保留了一套规则，以保持它足够简单</p><h2 id="f2fa" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">每只鸭子的类型文件</h2><p id="845d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在每个duck上有一个types.ts来保存模型、动作和reducer结果，但是正如已经说过的，不要用其他类型污染该文件，因为您可以分离逻辑。</p><h2 id="699f" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">在每个反应组件上设置道具，并在必要时导出</h2><p id="3098" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">和prop-types库一样，我用typescript保持了相同的逻辑。此外，我还分离了任何会污染带有任何HOC的组件的逻辑，因此任何带有HOC的连接或任何额外的内容都会转到该文件夹的index.ts，如redux connect、redux forms等。在这种情况下，您可以在组件文件中分离您的props，并使用Props和ReduxProps之类的东西来提高可读性。</p><h2 id="544b" class="nd km iq bd kn ny nz dn kr oa ob dp kv jy oc od kz kc oe of ld kg og oh lh oi bi translated">始终使用React。足球俱乐部</h2><p id="8d5f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">我总是在定义反应。即使我不使用孩子或其他任何东西来扩展我的道具，为将来使用提供正确的价值</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="a40b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，在我看来，有一个或大或小的项目，安全总比后悔好。如果为MVP编写代码或快速编写代码不是您的首要考虑，那么使用类型、流或Typescript比普通Javascript更好。</p><blockquote class="lo"><p id="d830" class="lp lq iq bd lr ls lt lu lv lw lx kk dk translated">如果你喜欢这篇文章，可以考虑点击clap👏并且你可以随时访问<a class="ae ot" href="https://medium.com/@panagiotisvrs" rel="noopener">我的其他文章</a>🔥</p></blockquote><h1 id="484f" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw ou ky kz la ov lc ld le ow lg lh li bi translated"><strong class="ak">链接</strong></h1><p id="975f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated"><a class="ae ot" href="https://github.com/getify/You-Dont-Know-JS/blob/master/types%20%26%20grammar/ch3.md" rel="noopener ugc nofollow" target="_blank">https://github . com/getify/You-Dont-Know-JS/blob/master/types % 20% 26% 20g rammar/CH3 . MD</a></p><p id="01dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ot" href="https://github.com/getify/You-Dont-Know-JS/blob/master/types%20%26%20grammar/ch1.md" rel="noopener ugc nofollow" target="_blank">https://github . com/getify/You-Dont-Know-JS/blob/master/types % 20% 26% 20g rammar/ch1 . MD</a></p></div></div>    
</body>
</html>