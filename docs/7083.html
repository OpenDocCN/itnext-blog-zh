<html>
<head>
<title>How to Deploy a WireGuard VPN for AWS Remote Access with Netmaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Netmaker为AWS远程访问部署WireGuard VPN</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-deploy-a-wireguard-vpn-for-aws-remote-access-with-netmaker-a3b8d0f59af2?source=collection_archive---------1-----------------------#2022-06-07">https://itnext.io/how-to-deploy-a-wireguard-vpn-for-aws-remote-access-with-netmaker-a3b8d0f59af2?source=collection_archive---------1-----------------------#2022-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d2c161c5b6ea35b007c19ddd8f8a6de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q1tYoW2Z5_a4PBCpvRpNTw.png"/></div></div></figure><p id="d285" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS有大量的VPN工具:AWS客户端VPN、AWS直接连接和AWS站点到站点，仅举几例。<a class="ae kw" href="https://docs.aws.amazon.com/whitepapers/latest/aws-vpc-connectivity-options/introduction.html" rel="noopener ugc nofollow" target="_blank">你可以在这里看到完整的列表</a>。</p><p id="84a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么为什么要在AWS上设置自己的VPN呢？我也想知道同样的事情，但是我们的很多用户都在AWS上使用Netmaker。我问他们为什么，主要有三个原因:<strong class="ka ir">成本、可配置性、wire guard</strong>T4。</p><p id="2785" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的大多数用户都对使用WireGuard作为他们的VPN感兴趣，因为它快速、高效、先进。AWS目前对此没有任何选择。如果你想用WireGuard，你需要自己卷。</p><p id="3c8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，AWS解决方案不太容易定制。它们往往是为某些用例量身定制的。如果您需要定制您的VPN，同样，您可能需要第三方解决方案。</p><p id="823a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，AWS工具可能非常昂贵！有时推出自己的解决方案在财务上很有意义。</p><p id="5206" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天，我们将在用户中设置一个常见的用例:使用WireGuard远程访问AWS。我们通过Netmaker实现这一点，这是一个用于自动化WireGuard网络的强大虚拟网络平台。</p><p id="0d64" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将分三步进行设置:</p><ol class=""><li id="129c" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">部署Netmaker</li><li id="c42f" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">为远程访问配置Netmaker</li><li id="45db" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">通过WireGuard测试对私有资源的访问</li></ol><h1 id="2413" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">部署Netmaker</h1><p id="1387" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">我们要做的第一件事是部署一个Lightsail VPS来托管Netmaker。您也可以轻松地使用EC2实例，所以您可以自己选择。</p><h2 id="ec66" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated"><strong class="ak"> 1。创建一台具有以下规格的机器:</strong></h2><ul class=""><li id="1633" class="kx ky iq ka b kb mj kf mk kj na kn nb kr nc kv nd ld le lf bi translated">Ubuntu 20.04</li><li id="5bb3" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv nd ld le lf bi translated">至少1GB内存和1个CPU</li><li id="639f" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv nd ld le lf bi translated">部署在您想要到达的专用网络中</li></ul><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/e9f53075663641fd195fd44aa155abc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*fCHzS_hr47bNS0jHZojwQQ.png"/></div></figure><h2 id="f84c" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">2.配置网络规则</h2><p id="8886" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">部署实例后，将静态IP连接到服务器:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/1230a3de585e92e0bfd2a5939a624d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*AuUihzYryvyGfwFCcAKu-Q.png"/></div></figure><p id="64ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，转到您的实例并设置防火墙。您需要端口443 (tcp)和51821–51825(UDP)。您可以删除端口80(默认情况下启用):</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/0b6dd1ca9db96f27cb05ba6529c458a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kFZRlXtO5g0CYgNVNlbooA.png"/></div></div></figure><h2 id="3423" class="mo lm iq bd ln mp mq dn lr mr ms dp lv kj mt mu lz kn mv mw md kr mx my mh mz bi translated">3.安装Netmaker</h2><p id="21f5" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">通过SSH连接到您的主机。您需要为服务器设置一个<strong class="ka ir">域</strong>。如果您没有或者不在乎，可以使用快速安装脚本:</p><pre class="nf ng nh ni gt nl nm nn no aw np bi"><span id="b680" class="mo lm iq nm b gy nq nr l ns nt">wget -qO - https://raw.githubusercontent.com/gravitl/netmaker/master/scripts/nm-quick.sh | sudo bash</span></pre><p id="2652" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">否则，如果您想使用自己的域，</strong> <a class="ae kw" href="https://docs.netmaker.org/quick-start.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">遵循这些指令</strong> </a> <strong class="ka ir">。</strong></p><h1 id="b776" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">配置Netmaker</h1><p id="9eeb" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">成功安装Netmaker后，请转到仪表板URL，并为VPC访问配置您的服务器。首先，创建一个管理员用户，并登录:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/48ea0eafa019d524b23de1f4a8f8cd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1wyfHQ1E6xNiPt9Hx6xA8g.png"/></div></div></figure><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/2a69743214a099f85fa0ffd41176033b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*glAgDG1qLej7usNoxlNKOA.png"/></div></figure><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/679618a9be77e08b2284b4f80e430bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JrQKuKG2Rqf5qrzO3qCH2w.png"/></div></div></figure><p id="c571" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，创建一个网络。这是VPN网络，与VPC无关。它可以有您想要的任何私有地址范围，只要它不与实例上的VPC /私有地址空间重叠。最好进行如下配置:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/0453956eb28c8c34552d723269086a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etR8WhELsXXZbHVZYKMqEg.png"/></div></div></figure><p id="945b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你的网络创建完毕，点击它。您将看到网络中的单个节点，<strong class="ka ir"> netmaker-1 </strong>。这是服务器。我们将把它配置为<strong class="ka ir">入站</strong>设备(入口)和<strong class="ka ir">出站</strong>流量(出口)的“网关”。</p><p id="141e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于入站设备，单击按钮“创建入口网关”:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/306d50e4230d57ede901513690e87dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5CAxcYzLIcAMUbpldTvg9A.png"/></div></div></figure><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/a16624075a1add938eeee2f4fae98443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3sQtLBttUf_qzjT5DDaFtw.png"/></div></div></figure><p id="b613" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将把您的服务器配置为专用网络的“出口网关”。这可能有点棘手。您需要检查您的AWS设置，以确定哪个私有地址空间(子网)是正确的。您还需要知道使用哪个接口。为此，在服务器主机的命令行上，键入:<strong class="ka ir"> "ip a" </strong>，并查找对应于专用网络的地址。</p><p id="bc5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，在我们的例子中，私有网络是<strong class="ka ir"> 172.26.0.0/16 </strong>(我们的Lightsail VPS的私有地址范围)<strong class="ka ir">。</strong>当我们在本地查看使用“ip a”的接口时，我们看到在接口<strong class="ka ir"> eth0 </strong>上有一个对应的地址172.26.14.8，所以这是正确的接口。</p><p id="7dcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="oa">作者注:</em> </strong> <em class="oa">虽然这超出了本教程的范围，但是您也可以将一个“节点”部署到VPC或专用网络中，并将其设置为“出口网关”如果您无法将Netmaker部署到目标环境中，或者如果您需要访问多个专用网络范围，这将非常有用。</em></p><p id="47ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">知道接口和子网后，您可以单击“创建出口网关”，并输入信息:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/ccb49b8803387edd10fe51262bfa05d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7H4RhRgP5uujGqn3Ev9yyA.png"/></div></div></figure><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/30bc89f9960e54ab4aaf85aebbe4b238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0mxOoKoBV5saVsijh3No0A.png"/></div></div></figure><p id="a456" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的服务器现在可以用于远程访问了。剩下要做的就是创建一个客户端，以便在笔记本电脑或手机等设备上使用。转到“外部客户端”并生成一个新的客户端配置文件。这只是一个简单的WireGuard配置文件，可以附加到任何运行WireGuard的机器上。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/a97236821020290a69b8eac76ad6b521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yq7XzwavBGZ8oNkcyPs_Eg.png"/></div></div></figure><h1 id="1e6c" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">测试WireGuard访问</h1><p id="4ebb" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">要使用配置文件，我们必须在设备上安装WireGuard。如果是手机，你只需扫描WireGuard应用程序生成的二维码即可获得访问权限。如果是笔记本电脑，您可以下载配置文件并使用wg-quick运行它:</p><pre class="nf ng nh ni gt nl nm nn no aw np bi"><span id="64d7" class="mo lm iq nm b gy nq nr l ns nt">wg-quick up ~/Downloads/alex-laptop.conf</span></pre><p id="4797" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个例子，我已经使用Lightsail部署了一个Wordpress服务器。默认情况下，Lightsail VPS获得一个公共端点。你不能移除公共端点，但是你<em class="oa">可以</em>禁用到达它的能力。只需从打开的端口移除443和80:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/6269d9653e8479c48363f676d2f5c540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VP9SSeFZnCpqkxd-onEsAw.png"/></div></div></figure><p id="7961" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在只能从私有地址访问该服务器。</p><p id="0eed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在本地设置了WireGuard，进入我的浏览器，然后<em class="oa">瞧</em>！</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/bd2b1f127038eab9c1be36ba0796d32c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ls16IvHWM4Qo-yFaY1p73w.png"/></div></div></figure><p id="5a00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我关闭WireGuard(使用wg-quick down)或尝试访问公共端点，网站将无法访问。</p><p id="c53b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的Netmaker服务器正式成为我们专用AWS网络的VPN网关。</p><h1 id="4b63" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="73ef" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">我们现在已经通过Netmaker使用WireGuard VPN设置了对AWS资源的远程访问。</p><p id="b515" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以做类似的事情来访问AWS中的几乎任何资源。</p><p id="926d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker是一个强大的工具，并且是高度可配置的。如果您希望到达多个地址空间(例如，不同区域中的VPC)，您可以在每个环境中部署一个节点，并将其配置为“出口网关”，就像我们上面所做的那样。关于部署节点的更多信息(我们在本教程中没有涉及到)请看这里:<a class="ae kw" href="https://docs.netmaker.org/netclient.html" rel="noopener ugc nofollow" target="_blank">https://docs.netmaker.org/netclient.html</a></p><p id="462e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="oa">免责声明:</em></strong><em class="oa"/><a class="ae kw" href="https://wireguard.com/" rel="noopener ugc nofollow" target="_blank"><em class="oa">wire guard</em></a><em class="oa">是Jason A. Donenfeld的注册商标。</em></p></div></div>    
</body>
</html>