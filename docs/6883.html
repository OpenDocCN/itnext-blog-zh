<html>
<head>
<title>CI/CD for Cloud-Native Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云原生应用的CI/CD</h1>
<blockquote>原文：<a href="https://itnext.io/ci-cd-for-cloud-native-applications-ba433a48149f?source=collection_archive---------0-----------------------#2022-04-02">https://itnext.io/ci-cd-for-cloud-native-applications-ba433a48149f?source=collection_archive---------0-----------------------#2022-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="258a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">定义持续集成和持续交付，回顾CI/CD管道中的步骤，并探索用于构建CI/CD流程的DevOps和IaC工具。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1165b7bddd151971d00962b331d7f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDOhsNtkNQEKM3C9SVgwVQ.jpeg"/></div></div></figure><p id="d671" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">🙂持续集成(CI)和持续交付(CD)是开发和维护任何云原生应用的关键部分。从我的经验来看，恰当地采用工具和过程会使CI/CD管道变得简单、安全和可扩展。原生云(或基于云)仅仅意味着应用程序利用云服务。例如，云原生应用程序可以是通过Docker容器部署的web应用程序，并使用部署到Azure Kubernetes服务的Azure容器注册表，或者使用亚马逊EC2、AWS Lambda或亚马逊S3服务。</p><p id="df4d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在本文中，我们将:</p><ul class=""><li id="8d5d" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">定义持续集成和持续交付</li><li id="f51a" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">查看CI/CD管道中的步骤</li><li id="b85e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">探索用于构建CI/CD流程的DevOps和IaC工具</li></ul><h1 id="f121" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">CI/CD概述</h1><p id="1153" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">持续集成过程是指软件工程师在将经过测试的应用程序发布到开发、测试或生产阶段之前，将代码的所有部分结合起来进行验证。CI包括以下步骤:</p><ol class=""><li id="8b53" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nb lw lx ly bi translated"><strong class="kw iu">源代码控制</strong> —从源代码控制中获取应用程序的最新源代码。</li><li id="3840" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nb lw lx ly bi translated"><strong class="kw iu">构建</strong>——编译、构建和验证代码——或者根据JavaScript/Python代码创建包和“林挺”。</li><li id="0cd0" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nb lw lx ly bi translated"><strong class="kw iu">测试</strong> —运行单元测试并验证编码风格。</li></ol><p id="2411" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">CI之后是连续交付流程，包括以下步骤:</p><ol class=""><li id="fc49" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nb lw lx ly bi translated"><strong class="kw iu">部署</strong> —将准备好的代码放入测试(或阶段)环境中。</li><li id="be2e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nb lw lx ly bi translated"><strong class="kw iu">测试</strong> —运行集成和/或负载测试。这一步是可选的，因为应用程序可以很小，没有很大的负载。</li><li id="983c" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nb lw lx ly bi translated"><strong class="kw iu">发布</strong> —将应用程序部署到开发、测试和生产阶段。</li></ol><p id="809e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我看来，CI和CD是一个过程的两个部分。然而，在云原生世界中，您可以在没有CI的情况下实现CD。您可以在下图中看到整个CI/CD流程:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/1b4ddcfdf12681d542fdd5eaa52359c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CDpQIoJqZMu6SWi1.jpg"/></div></div></figure><p id="46e3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nd">图1 </em></p><h1 id="69f8" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">CI/CD在云原生应用开发中的重要性</h1><p id="2ad0" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">构建成功的云原生CI/CD流程依赖于基础架构即代码(IaC)工具集。许多云原生应用程序集成了CI/CD流程，其中包括构建和部署应用程序以及调配和管理其云资源的步骤。</p><h1 id="ff95" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">IAC如何支持CI/CD</h1><p id="9f5a" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">基础设施即代码是一种描述和管理应用程序基础设施配置的方法。许多DevOps平台支持IaC方法，将其直接集成到场地中——例如，Azure DevOps、GitHub、GitLab和Bitbucket支持YAML管道。借助YAML管道，您可以通过基础设施部署为您的应用构建CI/CD流程。下面，您可以看到可以轻松与IaC工具集成的DevOps平台:</p><ul class=""><li id="abc8" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">Azure资源经理、Bicep和Farmer</li><li id="fdc6" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">将（行星）地球化（以适合人类居住）</li><li id="6ae1" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">泰克顿</li><li id="1093" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">普鲁米</li><li id="8114" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">自动气象站云形成</li></ul><h1 id="690c" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">构建成功的云原生CI/CD流程</h1><p id="ec0f" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">在许多情况下，云原生应用程序的CI/CD流程包括使用IaC方法记录和部署基础架构。IaC方法允许您:</p><ul class=""><li id="4e63" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">在部署应用程序之前，为其准备基础结构。</li><li id="f311" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">添加新的云资源和配置。</li><li id="c5ba" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">管理现有配置，解决“环境漂移”等问题</li></ul><p id="09a3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当团队不得不手动支持多个环境时，环境漂移问题就出现了。漂移会导致环境设置不一致，从而导致应用程序停机。IaC的成功CI/CD流程依赖于您使用的工具和平台。</p><p id="204c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们来看看最流行的DevOps和IaC工具的组合。</p><h1 id="c606" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">Azure DevOps</h1><p id="81b8" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">Azure DevOps是一个广泛使用的工具，用于组织和构建您的云原生CI/CD流程，尤其是针对Azure Cloud。它支持基于UI和YAML的管道构建方法。在为Azure Cloud构建自动化CI/CD流程时，我更喜欢使用这个工具。让我们看一个简单的YAML管道，它在<a class="ae ne" href="https://docs.microsoft.com/en-us/azure/devtest-labs/devtest-lab-overview" rel="noopener ugc nofollow" target="_blank"> Azure DevTest Labs </a>中创建了一个虚拟机(VM):</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="7bc8" class="nk mf it ng b gy nl nm l nn no">. . . . . .<br/>jobs:<br/>- deployment: deploy<br/>  displayName: Deploy<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/>  environment: ${{ parameters.environment }}<br/> <br/>  strategy:<br/>    runOnce:<br/>      deploy:<br/>        steps:<br/>        - checkout: self<br/>        - task: AzurePowerShell@4<br/>          displayName: 'Check vm-name variable exists'<br/>          continueOnError: true<br/>          inputs:<br/>            azureSubscription: ${{ parameters.azSubscription }}<br/>            scriptType: "inlineScript"<br/>            azurePowerShellVersion: LatestVersion<br/>            inline: |<br/>              $vm_name="$(vm-name)"<br/>              echo $(vm-name) - $vm_name<br/>              #if ([string]::IsNullOrWhitespace($vm_name))<br/>              {<br/>                  throw "vm-name is not set"<br/>              }<br/>              <br/>        - task: AzureResourceManagerTemplateDeployment@3<br/>          displayName: 'New deploy VM to DevTestLab'<br/>          inputs:<br/>            deploymentScope: 'Resource Group'<br/>            azureResourceManagerConnection: ${{ parameters.azSubscription }}<br/>            subscriptionId: ${{ parameters.idSubscription }}<br/>            deploymentMode: 'Incremental'<br/>            resourceGroupName: ${{ parameters.resourceGroup }}<br/>            location: '$(location)'<br/>            templateLocation: 'Linked artifact'<br/>            csmFile: templates/vm.json<br/>            csmParametersFile: templates/vm.parameters.json<br/>            overrideParameters: '-labName "${{parameters.devTestLabsName}}"<br/>                                 -vmName ${{parameters.vmName}} -password ${{parameters.password}}<br/>                                 -userName ${{parameters.user}}<br/>                                 -storageType<br/>. . . . . .</span></pre><p id="df3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了简化管道列表，我缩短了上面的例子。如您所见，管道代码也可以是通用的；因此，您可以在多个项目中重用它。管道的前两步是内嵌的PowerShell脚本，用于验证和打印所需的变量。然后，这个管道可以很容易地集成到Azure DevOps中，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/f7c1fde5683e1c23d23c2c452741daed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3fK6KjGtaY39V_ba.jpg"/></div></div></figure><p id="4b2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nd">图二</em></p><p id="64b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后一步使用<a class="ae ne" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview" rel="noopener ugc nofollow" target="_blank"> Azure资源管理器</a> (ARM)模板在Azure DevTest Labs中创建虚拟机，并通过<a class="ae ne" href="https://docs.microsoft.com/en-us/azure/templates/microsoft.devtestlab/2015-05-21-preview/labs/virtualmachines?tabs=json" rel="noopener ugc nofollow" target="_blank"> JSON格式</a>表示。这一步非常简单:它将变量发送(覆盖)到ARM脚本中，Azure使用这些脚本在DevTest实验室中创建一个VM。</p><h1 id="eaa6" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">自动气象站云形成</h1><p id="a8d2" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated"><a class="ae ne" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS CloudFormation </a>是来自AWS云堆栈的IaC工具，旨在提供EC2、DNS、S3桶等资源。CloudFormation模板以JSON和YAML格式表示；因此，它们是构建可靠的云原生CI/CD流程的绝佳选择。此外，许多工具，如Azure DevOps、GitHub、Bitbucket和<a class="ae ne" href="https://docs.aws.amazon.com/codepipeline/latest/userguide/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS CodePipelines </a>都有针对CloudFormation的集成选项。</p><p id="5a94" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一个AWS CloudFormation模板的例子，为了适合本文，我对它进行了简化:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="34a6" class="nk mf it ng b gy nl nm l nn no">{<br/>  "AWSTemplateFormatVersion" : "2010-09-09",<br/>  "Parameters" : {<br/>     "AccessControl" : {<br/>     "Description" : " The IP address range that can be used to access the CloudFormer tool. NOTE:<br/>We highly recommend that you specify a customized address range to lock down the tool.",<br/>      "Type": "String",<br/>      "MinLength": "9",<br/>      }<br/>  },<br/>      "Mappings" : {<br/>        "RegionMap" : {<br/>        "us-east-1" : { "AMI" : "ami-21341f48" },<br/>        }<br/>  }<br/>  "Resources" : {<br/>     "CFNRole": {<br/>     "Type": "AWS::IAM::Role",<br/>     "Properties": {<br/>     "AssumeRolePolicyDocument": {<br/>            "Statement": [{<br/>            "Effect": "Allow",<br/>            "Principal": { "Service": [ "ec2.amazonaws.com" ] },<br/>            "Action": [ "sts:AssumeRole" ]<br/>            }]<br/>      },<br/>      "Path": "/"<br/>      }<br/>      },<br/>  }<br/>}</span></pre><p id="d159" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae ne" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html#:~:text=set%20of%20outputs-,Template%20sections,-Templates%20include%20several" rel="noopener ugc nofollow" target="_blank">云形成模板</a>包含以下部分:</p><ul class=""><li id="6da6" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><code class="fe nq nr ns ng b">Parameters</code>–您可以指定输入参数以从CLI运行模板或从AWS CodePipeline(或任何其他CI/CD工具)传递数据。</li><li id="d924" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><code class="fe nq nr ns ng b">Mappings</code>–您可以根据地区将关键字与特定值(或一组值)匹配。</li><li id="6f44" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><code class="fe nq nr ns ng b">Resources</code>–您可以声明包含的资源，回答“将提供什么”的问题，并且您可以使用参数根据您的需求调整资源。</li></ul><p id="99fc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">AWS CloudFormation模板看起来类似于Azure ARM模板，因为它们做相同的工作，但针对不同的云提供商。</p><h1 id="f28a" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">谷歌云部署管理器</h1><p id="e57f" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">谷歌云(GC)提供了<a class="ae ne" href="https://cloud.google.com/deployment-manager/docs" rel="noopener ugc nofollow" target="_blank">云部署管理器</a>，这是一个一体化的工具，包括描述供应资源的模板和构建CI/CD管道的模板。模板支持:</p><ul class=""><li id="b178" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><a class="ae ne" href="https://docs.python.org/3/" rel="noopener ugc nofollow" target="_blank"> Python 3.x </a></li><li id="99a3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae ne" href="https://jinja.palletsprojects.com/en/2.10.x/" rel="noopener ugc nofollow" target="_blank"> Jinja 2.10.x </a></li><li id="5d94" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">YAML</li></ul><p id="7bd7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们使用Jinja模板来探索虚拟机的部署——这在YAML看来很常见:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="a886" class="nk mf it ng b gy nl nm l nn no">resources:<br/>- type: compute.v1.instance<br/>  name: {{env["project"]}}-deployment-vm<br/>  properties:<br/>     zone: {{properties["zone"]}}<br/>     machineType:https://www.googleapis.com/compute/v1/projects/{{env["project"]}}/zones/<br/>{{properties["zone"]}}/machineTypes/f1-micro<br/>     disks:<br/>     - deviceName: boot<br/>     type: PERSISTENT<br/>     boot: true<br/>     autoDelete: true<br/>     initializeParams:<br/>     sourceImage: https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/family/<br/>debian-9<br/>     networkInterfaces:<br/>     - network: https://www.googleapis.com/compute/v1/projects/{{env["project"]}}/global/networks/<br/>default<br/>     accessConfigs:<br/>     - name: External NAT<br/>     type: ONE_TO_ONE_NAT</span></pre><p id="0023" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的例子类似于ARM和CloudFormation模板，因为它描述了要部署的资源。在我看来，YAML/Jinja 2.10.x格式比基于JSON的结构更好，因为:</p><ul class=""><li id="791f" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">YAML增长迅速，阅读速度比JSON快得多</li><li id="aee3" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">团队可以在YAML和Jinja中比在JSON中更快地找到并修复错误</li><li id="7e64" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">YAML管道(稍加修改)可以在许多其他平台上重用</li></ul><p id="ef68" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">你可以在GitHub gist 中找到这个例子的扩展版本。</p><h1 id="336d" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">泰克顿和库伯内特</h1><p id="67cb" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated"><a class="ae ne" href="https://tekton.dev/" rel="noopener ugc nofollow" target="_blank"> Tekton </a>，由<a class="ae ne" href="https://cd.foundation/" rel="noopener ugc nofollow" target="_blank"> CD基金会</a>(<a class="ae ne" href="https://www.linuxfoundation.org/projects/" rel="noopener ugc nofollow" target="_blank">Linux基金会</a>的一部分)支持，定位为基于Kubernetes的云原生应用的开源CI/CD框架。Tekton框架的组件包括:</p><ul class=""><li id="10d5" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated"><strong class="kw iu"> Tekton管道</strong> —最基本的管道，旨在根据<a class="ae ne" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" rel="noopener ugc nofollow" target="_blank"> Kubernetes定制资源</a>构建CI/CD管道。</li><li id="a40d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> Tekton触发器</strong> —基于事件驱动的方法提供运行管道的逻辑。</li><li id="7d23" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><strong class="kw iu"> Tekton CLI </strong> —构建在Kubernetes CLI之上，允许您运行管道、检查状态和管理其他选项。</li><li id="7fb9" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated"><a class="ae ne" href="https://github.com/tektoncd/dashboard/blob/main/README.md" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">tek ton Dashboard</strong></a><strong class="kw iu">和</strong><a class="ae ne" href="https://hub.tekton.dev/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">Hub</strong></a><strong class="kw iu">—</strong>使用基于web的图形界面运行管道，并观察管道执行日志、资源详细信息和整个集群的资源(参见图3中的仪表板)。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/3d673b4b34eec325f37e0cf2dc5037a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OQbKAPeD0-fpVqV3.jpg"/></div></div></figure><p id="5a30" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="nd">图3 </em></p><p id="be41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我喜欢Tekton Hub背后的想法——您可以共享您的管道和其他可重用组件。让我们看一个Tekton管道示例:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="798e" class="nk mf it ng b gy nl nm l nn no">apiVersion: tekton.dev/v1beta1<br/>kind: Pipeline<br/>metadata:<br/>  name: say-things<br/>spec:<br/>  tasks:<br/>    - name: first-task<br/>      params:<br/>        - name: pause-duration<br/>          value: "2"<br/>        - name: say-what<br/>          value: "Hello, this is the first task"<br/>      taskRef:<br/>        name: say-something<br/>    - name: second-task<br/>      params:<br/>        - name: say-what<br/>          value: "And this is the second task"<br/>      taskRef:<br/>        name: say-something</span></pre><p id="d3c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的管道代码是以本地Kubernetes格式/清单编写的，代表一组任务。因此，您可以构建本机跨云CI/CD流程。在任务中，您可以添加操作Kubernetes资源、构建图像、打印信息和许多其他操作的步骤。你可以在这里找到Tekton管道<a class="ae ne" href="https://developers.redhat.com/blog/2021/01/13/getting-started-with-tekton-and-pipelines#run_in_parallel_or_sequentially" rel="noopener ugc nofollow" target="_blank">的完整教程。</a></p><h1 id="ff70" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">Terraform、Azure二头肌和Farmer</h1><p id="83dd" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">Terraform 是基于IaC方法构建可靠CI/CD流程的领先平台。我不会深入讨论Terraform，因为它需要一篇单独的文章(甚至是一本书)。Terraform使用一种特定的语言来简化CI/CD模板的构建。此外，它允许您重用代码部分，为CI/CD流程增加了动态的味道。因此，您可以构建比ARM/JSON模板好得多的模板。让我们来看一个Terraform模板代码的基本示例:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f2b2" class="nk mf it ng b gy nl nm l nn no">terraform {<br/>  required_providers {<br/>  }<br/>  backend "remote" {<br/>    organization = "YOUR_ORGANIZATION_NAME"<br/>    workspaces {<br/>      name = "YOUR_WORKSPACE_NAME"<br/>    }<br/>  }<br/>}</span></pre><p id="b74c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的基本模板包含资源、提供者和工作空间定义。同样的方法遵循Azure二头肌和农民工具。这些地形模拟可以极大地改善和缩短您的代码。让我们看看下面的二头肌例子:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="1b7d" class="nk mf it ng b gy nl nm l nn no">param location string = resourceGroup().location<br/>param storageAccountName string = 'toylaunch${uniqueString(resourceGroup().id)}'</span><span id="3a25" class="nk mf it ng b gy nu nm l nn no">resource storageAccount 'Microsoft.Storage/storageAccounts@2021-06-01' = {<br/>  name: storageAccountName<br/>  location: location<br/>  sku: {<br/>    name: 'Standard_LRS'<br/>  }<br/>  kind: 'StorageV2'<br/>  properties: {<br/>    accessTier: 'Hot'<br/>  }<br/>}</span></pre><p id="e98d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面的Bicep代码在美国地区部署存储帐户。你可以看到<a class="ae ne" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=json" rel="noopener ugc nofollow" target="_blank"> JSON ARM示例</a>也是如此。在我看来，Terraform和Azure二头肌比ARM模板更短，也更容易理解。<a class="ae ne" href="https://compositionalit.github.io/farmer/" rel="noopener ugc nofollow" target="_blank"> Farmer </a>工具还可以在可读性和类型安全代码方面展示令人印象深刻的结果:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="d63b" class="nk mf it ng b gy nl nm l nn no">// Create a storage account with a container<br/>let myStorageAccount = storageAccount {<br/>    name "myTestStorage"<br/>    add_public_container "myContainer"<br/>}</span><span id="3055" class="nk mf it ng b gy nu nm l nn no">// Create a web app with application insights that's connected to the storage account.<br/>let myWebApp = webApp {<br/>    name "myTestWebApp"<br/>    setting "storageKey" myStorageAccount.Key<br/>}</span><span id="288a" class="nk mf it ng b gy nu nm l nn no">// Create an ARM template<br/>let deployment = arm {<br/>    location Location.NorthEurope<br/>    add_resources [<br/>        myStorageAccount<br/>        myWebApp<br/>    ]<br/>}</span><span id="b7e9" class="nk mf it ng b gy nu nm l nn no">// Deploy it to Azure!<br/>deployment<br/>|&gt; Writer.quickDeploy "myResourceGroup" Deploy.NoParameters</span></pre><p id="008f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">上面，你可以看到如何用20行易读易扩展的代码将你的web应用部署到Azure。</p><h1 id="70ec" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">普鲁米</h1><p id="2f4d" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">Pulumi框架遵循一种不同的方法来构建和组织CI/CD流程:它允许您使用自己喜欢的编程语言来部署应用程序和基础设施。Pulumi支持Python、C#、TypeScript、Go和许多其他语言。让我们看看下面的例子:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="7ef5" class="nk mf it ng b gy nl nm l nn no">public MyStack()<br/>{<br/>    var app = new WebApplication("hello", new()<br/>    {<br/>        DockerImage = "strm/helloworld-http"<br/>    });<br/>    <br/>    this.Endpoint = app.Endpoint;<br/>}</span></pre><p id="2008" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这部分代码将web应用部署到Azure cloud，并使用Docker容器来运行web应用。你可以在AKS集群中以及Docker容器<a class="ae ne" href="https://www.pulumi.com/registry/packages/azure-native/how-to-guides/azure-cs-net5-aks-webapp/" rel="noopener ugc nofollow" target="_blank">这里</a>找到如何启动web应用的例子。</p><h1 id="8fff" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">结论</h1><p id="71f3" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">如果您不知道最适合这样做的原则、工具和框架，为您的应用程序构建云原生CI/CD管道可能是一个永无止境的故事。人们很容易迷失在各种工具、提供商和术语中，因此本文旨在解释什么是CI/CD云原生应用程序，并向您介绍构建可靠CI/CD管道的广泛使用的工具和原则。拥有本指南有助于您在设计CI/CD流程和为您的云原生应用选择合适的工具时感到舒适。</p><blockquote class="nv nw nx"><p id="bdeb" class="ku kv nd kw b kx ky ju kz la lb jx lc ny le lf lg nz li lj lk oa lm ln lo lp im bi translated"><em class="it">这是DZone 's 2022 DevOps趋势报告中的一篇文章。</em></p><p id="36cc" class="ku kv nd kw b kx ky ju kz la lb jx lc ny le lf lg nz li lj lk oa lm ln lo lp im bi translated"><em class="it">更多:</em></p><p id="8a53" class="ku kv nd kw b kx ky ju kz la lb jx lc ny le lf lg nz li lj lk oa lm ln lo lp im bi translated"><a class="ae ne" href="https://dzone.com/trendreports/devops-3" rel="noopener ugc nofollow" target="_blank"> <em class="it">读报告</em> </a></p></blockquote></div></div>    
</body>
</html>