<html>
<head>
<title>How to make your NodeJS application or API secure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何确保NodeJS应用程序或API的安全</h1>
<blockquote>原文：<a href="https://itnext.io/make-security-on-your-nodejs-api-the-priority-50da8dc71d68?source=collection_archive---------0-----------------------#2019-07-12">https://itnext.io/make-security-on-your-nodejs-api-the-priority-50da8dc71d68?source=collection_archive---------0-----------------------#2019-07-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c51d775af7534a9b65aeabcea2290c91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNXNr9rzY_C8aqcjo5HDQw.png"/></div></div></figure><p id="c8f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你是后端或全栈(web)开发人员，你可能听说过这样的术语:<strong class="kd iu"> DOS攻击、XSS、SQL/NoSQL注入攻击</strong>等等。<br/>您可能已经知道这些攻击是非常有害的，您需要尽可能地保证您的应用程序(或API)的安全。但是具体怎么做呢？</p><p id="8053" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我将向您展示一些最佳实践，您可以在自己的项目中应用/实现这些实践，并使您的应用程序(或只是一个API)变得安全。但首先，如果你不熟悉这些攻击，让我们逐一分解！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="fbe9" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">拒绝服务攻击</strong></h2><p id="5a9b" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">DOS攻击会使网络或机器崩溃/关闭，使其无法访问。例如，这意味着用户将不能访问你的应用程序。攻击者通过不断发送请求、创建流量和发送大量各种信息来实现这一点。利用DOS攻击，攻击者可以让你的服务<strong class="kd iu">变慢</strong>或者<strong class="kd iu">完全崩溃</strong>。</p><h2 id="4551" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">跨站脚本(XSS)攻击</strong></h2><p id="cd28" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">XSS发作是注射的一种。攻击者将恶意脚本注入浏览器端脚本的形式。通常，当输入表单没有经过验证或编码时，它们会出现在输入表单上。<br/>利用XSS攻击，攻击者可以访问cookies、会话令牌或/和其他敏感数据。同样，这些脚本可以重写页面的HTML内容。</p><h2 id="ad36" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">暴力攻击</strong></h2><p id="0751" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">暴力攻击是一种用于获取用户密码或个人识别码(PIN)等敏感数据的方法。在这些攻击中，攻击者最有可能依靠自动化软件来生成对所需数据值的大量猜测。<br/>通过暴力攻击，攻击者可以破解加密数据(密码、pin)。</p><h2 id="2ec4" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak"> SQL/NoSQL注入攻击</strong></h2><p id="3dd6" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">SQL/NoSQL注入(SQLi)攻击是注入攻击的一种。SQL/NoSQL注入使得攻击者能够执行恶意SQL/NoSQL语句。攻击者只需将SQL/NoSQL命令(查询)插入到连接到数据库的应用程序的特定字段中(例如，POST登录请求)，就可以实现SQL/NoSQL注入攻击。<br/>利用SQL/NoSQL注入攻击，攻击者可以绕过认证、授权，检索整个SQL/NoSQL数据库的内容，添加、修改、删除数据库中的数据。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="19eb" class="me lh it bd li mf mg mh ll mi mj mk lo ml mm mn lr mo mp mq lu mr ms mt lx mu bi translated"><strong class="ak">如何防止这些攻击在自己的项目中发生？</strong></h1><p id="f215" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">没错，在您对这些攻击有所了解之后，问题是，如何在您自己的应用程序/ API中防止它们发生？<br/>我将再次向您展示如何防止这些攻击的最佳实践，一个接一个。</p><h2 id="e1fa" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">防止DOS攻击</strong></h2><ol class=""><li id="dbfb" class="mv mw it kd b ke lz ki ma km mx kq my ku mz ky na nb nc nd bi translated">当处理DOS攻击预防时，首先要考虑的是限制用户可以提交给你的应用程序/ api /服务的实际负载。您可以使用body-parser来限制body有效负载。如果你正在使用ExpressJS作为你的后端框架，那么你就是黄金。ExpressJS附带了您可以使用的内置body-parser。</li></ol><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="83c3" class="lg lh it nj b gy nn no l np nq">const express = require('express');<br/>const app = express();</span><span id="cbb5" class="lg lh it nj b gy nr no l np nq">app.use(express.json({ limit: '10kb' })); // Body limit is 10</span></pre><p id="45b3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.另一个有用的express特性是<strong class="kd iu"> express-rate-limit依赖。</strong>此依赖关系允许您为用户设置速率限制。所以基本上，你可以为每个用户设置最大的请求量，当用户使用了他所有的请求后，你可以锁定他一段时间。</p><p id="de34" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是如何配置快速速率限制:<br/> <em class="ns"> — npm安装快速速率限制- </em>使用npm安装</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="ff98" class="lg lh it nj b gy nn no l np nq">const limit = rateLimit({<br/>    max: 100,// max requests<br/>    windowMs: 60 * 60 * 1000, // 1 Hour<br/>    message: 'Too many requests' // message to send<br/>});<br/>app.use('/routeName', limit); // Setting limiter on specific route</span></pre><h2 id="b0d8" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">阻止XSS袭击</strong></h2><ol class=""><li id="983a" class="mv mw it kd b ke lz ki ma km mx kq my ku mz ky na nb nc nd bi translated">首先，您可以在输入时净化用户数据。这很容易实现，我们可以使用另一个有用的依赖项，叫做<strong class="kd iu"> xss-clean。<br/> </strong>这种依赖将阻止用户在输入中插入HTML &amp;脚本。</li></ol><p id="0a87" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是如何配置xss-clean: <br/> <em class="ns"> — npm安装xss-clean - </em>使用npm安装它</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="7234" class="lg lh it nj b gy nn no l np nq">// Data Sanitization against XSS<br/>app.use(xss());</span></pre><p id="7629" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.使用<strong class="kd iu">头盔</strong>依赖给你的项目特殊的HTTP头。头盔是中间件功能的集合。默认情况下，并不包括所有的中间件功能，但是您可以手动启用其余的功能。你可以查看<a class="ae nt" href="https://github.com/helmetjs/helmet/#user-content-how-it-works" rel="noopener ugc nofollow" target="_blank">这个</a>链接，看看其他的中间件功能。</p><p id="1789" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是你如何配置头盔-它应该在代码的顶部声明:<br/><em class="ns">-npm安装头盔- </em>使用NPM安装它</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="6aa5" class="lg lh it nj b gy nn no l np nq">app.use(helmet());</span></pre><p id="3186" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.例如，如果您使用JSON Web令牌(JWT)而不是express-session，您应该考虑将JWT的存储到cookies中。同样，确保这些用于JWT存储的cookies仅是HTTP！</p><h2 id="a250" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">防止暴力攻击</strong></h2><ol class=""><li id="4aa6" class="mv mw it kd b ke lz ki ma km mx kq my ku mz ky na nb nc nd bi translated">帮助您应对暴力攻击的最有效的方法之一是限制登录尝试，或任何与要求用户输入密码、特殊代码或pin的身份验证相关的尝试。</li><li id="4838" class="mv mw it kd b ke nu ki nv km nw kq nx ku ny ky na nb nc nd bi translated">接下来，同样，如果你使用ExpressJS，你可以实现<strong class="kd iu"> express-rate-limit依赖。</strong>这一点我们确实在DOS攻击防范中实现了。但是这种依赖性对暴力攻击和DOS攻击都有效。</li><li id="091e" class="mv mw it kd b ke nu ki nv km nw kq nx ku ny ky na nb nc nd bi translated">为了降低攻击者猜测敏感数据(密码、pin)的速度，让他们的日子更难过，您可以实现<strong class="kd iu"> bcrypt依赖。Bcrypt将加密敏感数据，如密码，这将使他们更难猜测。Bcrypt是一个有点复杂的依赖项，但是如果你想了解更多(你应该了解)请查看这个<a class="ae nt" href="https://www.npmjs.com/package/bcrypt" rel="noopener ugc nofollow" target="_blank">链接</a>。</strong></li><li id="f366" class="mv mw it kd b ke nu ki nv km nw kq nx ku ny ky na nb nc nd bi translated">另一件降低暴力攻击可能性的事情是实现<strong class="kd iu">两步验证过程</strong>，或<strong class="kd iu">双因素认证</strong>。实现这个确实需要几行代码，所以这里的<a class="ae nt" href="https://davidwalsh.name/2fa" rel="noopener ugc nofollow" target="_blank">链接</a>将帮助你解决这个问题！</li></ol><h2 id="28b1" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">防止SQL/NoSQL注入攻击</strong></h2><ol class=""><li id="4959" class="mv mw it kd b ke lz ki ma km mx kq my ku mz ky na nb nc nd bi translated">如果您正在使用SQL或NoSQL数据库，您应该整理您的数据。<br/>如果你正在使用SQL数据库，你应该考虑使用<strong class="kd iu"> node-mysql依赖。</strong>点击了解更多关于node-mysql <a class="ae nt" href="https://github.com/mysqljs/mysql#escaping-query-values" rel="noopener ugc nofollow" target="_blank">的信息。<br/>如果您正在使用NoSQL数据库(MongoDB)和ExpressJS，请考虑使用<strong class="kd iu"> express-mongo-sanitize依赖项。</strong></a></li></ol><p id="37c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是如何配置mongo-sanitize:<br/><em class="ns">—npm install express-mongo-sanitize-</em>使用NPM安装它</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="92cd" class="lg lh it nj b gy nn no l np nq">app.use(mongoSanitize());</span></pre><p id="ca5f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.如果使用MongoDB，使用对象数据建模工具(ODM)<strong class="kd iu">mongose</strong>。Mongoose允许您为每个文档定义模式和模式类型，从一开始就确保文档的安全。猫鼬本身就很复杂，但是如果你想深入了解它，我建议你查看这个<a class="ae nt" href="https://code.tutsplus.com/articles/an-introduction-to-mongoose-for-mongodb-and-nodejs--cms-29527" rel="noopener ugc nofollow" target="_blank">链接</a>或者上一个速成班，边走边学！</p><h2 id="aa82" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">在实现了这些依赖项之后，您的主应用程序文件可能如下所示:</strong></h2><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="090e" class="lg lh it nj b gy nn no l np nq">// Importing Dependencies<br/>const express = require('express');<br/>const rateLimit = require('express-rate-limit');<br/>const helmet = require('helmet');<br/>const mongoSanitize = require('express-mongo-sanitize');<br/>const xss = require('xss-clean');</span><span id="c1b0" class="lg lh it nj b gy nr no l np nq">const app = express();</span><span id="f4ad" class="lg lh it nj b gy nr no l np nq">// Helmet<br/>app.use(helmet());</span><span id="54fb" class="lg lh it nj b gy nr no l np nq">// Rate Limiting<br/>const limit = rateLimit({<br/>    max: 100,// max requests<br/>    windowMs: 60 * 60 * 1000, // 1 Hour of 'ban' / lockout <br/>    message: 'Too many requests' // message to send<br/>});<br/>app.use('/routeName', limit); // Setting limiter on specific route</span><span id="15c8" class="lg lh it nj b gy nr no l np nq">// Body Parser<br/>app.use(express.json({ limit: '10kb' })); // Body limit is 10</span><span id="b0e9" class="lg lh it nj b gy nr no l np nq">// Data Sanitization against NoSQL Injection Attacks<br/>app.use(mongoSanitize());</span><span id="80e3" class="lg lh it nj b gy nr no l np nq">// Data Sanitization against XSS attacks<br/>app.use(xss()</span></pre></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h2 id="5da5" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">如何在网站/ web app / API上实现顶级安全？</strong></h2><p id="c408" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">我向您展示的这些方法在您自己的项目中实现肯定是非常好的，而且它们做得很好！没毛病。但是！如果你能把它提升到另一个水平会怎么样？如果您想为您的项目实现顶级安全性，该怎么办？如果您可以实施详细监控的DDoS攻击防御系统，会怎么样？事实上，如果您能够集成针对所有这些漏洞的监控系统会怎么样？</p><p id="73a6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我告诉你，有一个名为SiteLock的工具可以暴露漏洞，例如:<strong class="kd iu">搜索引擎/浏览器黑名单、垃圾邮件黑名单、应用程序漏洞、SQL注入漏洞、跨站点脚本(XSS)漏洞、病毒和恶意软件、网络漏洞。</strong> <br/>我将要向你展示的东西可以节省你的时间和金钱，当然，也会让你的网络应用(或网站)更加安全。</p><p id="c13a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么这到底是怎么回事呢？</p><p id="40f8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae nt" href="https://www.bluehost.com/track/andreasdev/" rel="noopener ugc nofollow" target="_blank">你听说过Bluehost吗？<strong class="kd iu"> Bluehost </strong>是最大的网站托管提供商之一，为数百万网站提供服务。Bluehost提供了上面提到的工具SiteLock，它可以监控你的网站/应用程序并捕捉任何发现的漏洞。而且，它可以验证你的商业信誉。SiteLock附带Bluehost托管包(每月不到2美元)。</a></p><p id="435a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简而言之，为什么专门选择Bluehost？那么，你想马上推出你的网站，并确保与你的网站相关的一切都是安全和稳定的吗？除了安全性、稳定性之外，Bluehost的托管服务非常便宜，SiteLock是你做生意的有力工具。每月支付不到2美元购买SiteLock 是一个正确的举动，它将真正帮助你监控你的网站/应用程序上发生的所有事情，暴露漏洞并验证你的业务(使你的业务值得信任)。</p><h2 id="dc15" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">总结</strong></h2><p id="d6d3" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">这些只是一些方法和实践，您可以在自己的项目中使用它们来确保应用程序或API的安全。您可以根据我提供的参考资料更深入地研究其中的每一个，或者自己研究更多。<br/>我强烈建议在您自己的个人项目中实现这种级别(或更高级别的)的安全性。擅长保护后端应用程序真的很有价值，这确实是一项很好的技能。我的建议是，无论你在投资组合/简历中展示的项目有多大，都要包括安全性。你想让雇主知道你明白安全有多重要。此外，您还想展示您熟悉如何保护数据的隐私和安全。</p><p id="2325" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完成所有这些后，您可以最大限度地测试您的应用程序/ API，可能会发现安全漏洞并修补它们，或者您可以将它提升到下一个级别，使安全性更高，例如:添加两步验证、电子邮件确认、添加<a class="ae nt" href="https://github.com/expressjs/csurf#readme" rel="noopener ugc nofollow" target="_blank"> csurf </a>、增强加密密码等。</p><p id="a05a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望这篇文章对您有所帮助，并且您对潜伏在那里的威胁有所了解。如果你想知道更多关于这些攻击(非常深入)或关于加密(bcrypt，crypto)和其他东西(实现两步验证，电子邮件确认等。)，让我知道！</p><p id="84d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你有任何问题，随时问他们。</p><p id="3787" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同样，你现在可以在<a class="ae nt" href="https://twitter.com/AndreasDEV16" rel="noopener ugc nofollow" target="_blank">Twitter</a>T4【查看我的<a class="ae nt" href="http://www.andreasdeveloper.com" rel="noopener ugc nofollow" target="_blank">网站</a>上关注我。</p></div></div>    
</body>
</html>