<html>
<head>
<title>Add Login with Amazon for iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为iOS添加Amazon登录</h1>
<blockquote>原文：<a href="https://itnext.io/add-login-with-amazon-to-your-ios-swift-app-d1b07655d31a?source=collection_archive---------3-----------------------#2018-11-02">https://itnext.io/add-login-with-amazon-to-your-ios-swift-app-d1b07655d31a?source=collection_archive---------3-----------------------#2018-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e559caf0cd10cffda9c3d42b8f997a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-U5xPoCYjMBLS-jjEEs1Q.jpeg"/></div></div></figure><p id="386d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们通过将亚马逊(LWA)登录添加到我们的iOS Swift应用程序中，继续进行身份验证。在这个由两部分组成的系列中，我们将把LWA添加到iOS应用程序中，允许您的用户使用他们的亚马逊帐户进行身份验证。作为一名开发者，LWA是一种非常强大的体验，因为你正在利用一个品牌2亿客户的信任，同时获得一些东西，如他们的姓名、电子邮件地址和邮政编码，以构建更个性化的体验。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/4843778bcb512e72a10e5d87c7839617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmscvWFH_i7zdBEorsGwpA.png"/></div></div></figure><blockquote class="lb lc ld"><p id="cf3e" class="jy jz le ka b kb kc kd ke kf kg kh ki lf kk kl km lg ko kp kq lh ks kt ku kv ij bi translated">收集用户信息，如姓名、电子邮件、电话号码或年龄，是移动开发者在应用中添加社交登录或第三方登录提供商的主要原因之一。</p></blockquote><p id="e893" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当开发者收集关于他们的用户的信息时，他们可以开始与这些用户互动。这是一个双赢的局面，用户可以通过已知的提供商和凭证快速轻松地登录，而你可以收集一些关于他们的信息😊。</p><p id="1baf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将此与<strong class="ka ir">不登录</strong>的用户进行比较。除了他们的应用活动和基本的人口统计数据，你对他们个人一无所知。</p><p id="3b27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，这是<strong class="ka ir">在你的iOS应用</strong>中添加亚马逊登录的第1部分。这第一篇文章将着重于注册和创建一个LWA项目，然后下载和实施LWA SDK到一个iOS Swift应用程序中。第2部分将重点关注联合LWA和Amazon Cognito来为应用程序用户获取临时凭证，以便安全地访问您的AWS资源。第2部分类似于我们如何处理社交登录提供者，然而，LWA并不是由AWS Mobile SDK<em class="le">AWSMobileClient</em>提供的本地支持，而AWS Mobile SDK在实现脸书和谷歌时为我们完成了所有繁重的工作。</p><p id="9ae7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我之前的<a class="ae li" rel="noopener ugc nofollow" target="_blank" href="/google-sign-in-using-aws-amplify-and-amazon-cognito-69cc3bf219ad">谷歌登录</a>和<a class="ae li" rel="noopener ugc nofollow" target="_blank" href="/facebook-login-using-aws-amplify-and-amazon-cognito-4acf74875a04">脸书登录</a>集成文章中，用户只需在你的应用中选择<em class="le">使用谷歌登录</em>或<em class="le">继续使用脸书</em>按钮，并分别使用他们的谷歌或脸书凭证进行认证，同时保持在你的应用流中。<em class="le">登录亚马逊</em>从用户角度来看也是同样的交互。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/213c0cdedc02ffe8bc0a44f2da8ad391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*duwPFCKq1f5qJmuh3eY_UA.png"/></div></div></figure><p id="568a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:您的应用程序可以支持脸书登录，谷歌唱歌，并与亚马逊同时登录。你不局限于只有一个供应商。</p><p id="1797" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们开始吧！</p><h1 id="813b" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">第一部分——亚马逊开发者和LWA设置</h1><p id="e6c8" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">向亚马逊注册登录</p><p id="5f54" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1.登录亚马逊开发者门户:<a class="ae li" href="https://developer.amazon.com/login-with-amazon" rel="noopener ugc nofollow" target="_blank">https://developer.amazon.com/login-with-amazon</a></p><p id="c036" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.点击<strong class="ka ir">注册一个开发者账户</strong>在开始下。或者点击<a class="ae li" href="https://developer.amazon.com/login-with-amazon?" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ff97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.点击<strong class="ka ir">创建新的安全配置文件。</strong></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/d628997e85cb891f6351de4b3dcc03c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*i0tJDM0BFiJyc6yI1sYfrQ.png"/></div></figure><p id="6fff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.通过提供如下所示的<strong class="ka ir">安全档案名称</strong>和<strong class="ka ir">安全档案描述</strong>，完成安全档案管理表。</p><p id="1ce7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="le">仅供参考:安全配置文件名称是显示在向移动用户显示的同意屏幕中的名称。</em></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/3cd8b76e489779e1be89bb0de3a27cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgFmMhJrgFLzqsFcwykZ1g.png"/></div></div></figure><h2 id="ad82" class="mp ll iq bd lm mq mr dn lq ms mt dp lu kj mu mv ly kn mw mx mc kr my mz mg na bi translated">将你的iOS应用标识符添加到LWA安全配置文件</h2><p id="2099" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">5.点击安全配置文件的齿轮，然后<strong class="ka ir">选择iOS设置</strong></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/a7fd177c1e3f1ef37b9803b011726cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ibo7DIoHG5nxv1lhVroq7g.png"/></div></div></figure><p id="8005" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.在iOS设置选项卡下，选择<strong class="ka ir">添加API键按钮。</strong></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/2113415dc1ce253a2f73d7eb59d85d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VALDesnkW62r3WfQvr9Iw.png"/></div></div></figure><p id="a9c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">7.提供一个<strong class="ka ir"> API键名</strong>和<strong class="ka ir">包Id </strong>。捆绑包Id需要与您的iOS项目捆绑包标识符相匹配。例如<em class="le"> com.domain.appname </em></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/c026bd81664e98ddedb08f899a8b4645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VuhEeAgOHOWfoqlKIjaNVA.png"/></div></div></figure><p id="9bc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">8.选择API key下的<strong class="ka ir"> Show </strong>来显示巨大的API Key以及API Key名称和Bundle Id。<strong class="ka ir">复制API密钥</strong>并保存以备后用。几分钟后，我们将在我们的iOS项目<em class="le"> Info.plist </em>文件中使用它。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/304399a3058a5f5146e39c67a385b91a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFzoCPOJ-f_0KTt4QgdFlA.png"/></div></div></figure><h1 id="7776" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">第二部分— iOS应用程序</h1><p id="b7af" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">用亚马逊iOS starter项目克隆这个<a class="ae li" href="https://github.com/mobilequickie/LoginWithAmazoniOSSwift" rel="noopener ugc nofollow" target="_blank">登录。这是一个与亚马逊SDK登录的基础项目，已经添加了一个与Objective-C SDK交互的基本Swift代理。</a></p><pre class="kx ky kz la gt nf ng nh ni aw nj bi"><span id="52b6" class="mp ll iq ng b gy nk nl l nm nn">git clone <a class="ae li" href="https://github.com/mobilequickie/LoginWithAmazoniOSSwift.git" rel="noopener ugc nofollow" target="_blank">https://github.com/mobilequickie/LoginWithAmazoniOSSwift.git</a></span></pre><h2 id="080e" class="mp ll iq bd lm mq mr dn lq ms mt dp lu kj mu mv ly kn mw mx mc kr my mz mg na bi translated">将您的LWA iOS API密钥添加到Info.plist</h2><p id="698a" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">1.复制上面第8步中的API密钥。如果您忘记复制并需要再次引用它，请单击此处的<a class="ae li" href="https://developer.amazon.com/lwa/sp/overview.html" rel="noopener ugc nofollow" target="_blank"/>并选择显示客户端ID和客户端密码作为您的安全配置文件名。</p><p id="658f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.在您的Xcode项目中，选择<em class="le"> Info.plist </em></p><p id="d7c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.添加一个名为<strong class="ka ir"> APIKey </strong>的String类型的新键，并将iOS API键中的<strong class="ka ir">粘贴到所示的值中。</strong></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/a526849d6b21469e236e11c285e2ca6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NTVGM9G7s1RrB7iePbXwyQ.png"/></div></div></figure><h2 id="fbb7" class="mp ll iq bd lm mq mr dn lq ms mt dp lu kj mu mv ly kn mw mx mc kr my mz mg na bi translated">将URL方案添加到您的Info.plist</h2><ol class=""><li id="6406" class="np nq iq ka b kb mi kf mj kj nr kn ns kr nt kv nu nv nw nx bi translated">在Xcode项目中，选择目标项目&gt; Info，然后展开URL类型(0)</li><li id="8785" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">单击“+”创建新的URL类型</li><li id="daa7" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">在“标识符”栏中，键入您的iOS应用程序标识符</li><li id="f7fb" class="np nq iq ka b kb ny kf nz kj oa kn ob kr oc kv nu nv nw nx bi translated">在URL Schemes字段中，输入您的应用程序标识符，但要确保添加了amzn前缀。例如，amzn- <strong class="ka ir">您的应用标识符</strong></li></ol><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/a683332cfac5819dd04ec1f88a98983d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDgShlr3NncMKcXomUdo1A.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">添加登录Amazon的URL方案</figcaption></figure><h1 id="1ca9" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">在AppDelegate中初始化LWA库</h1><p id="d402" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">在AppDelegate.swift文件中，我们执行了以下操作:</p><p id="7c25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加导入<strong class="ka ir"> LoginWithAmazon </strong> <br/>添加打开网址功能</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oi"><img src="../Images/abc0655ad5e7625da281c2e7a2d1546f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTciyG4b_qDCHX82vCOS_A.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated"><a class="ae li" href="https://gist.github.com/mobilequickie/baf1cd3a2c4a6e04fd0d1756f9543d67" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/mobile quickie/ba f1 CD 3a 2 C4 a6 e 04 FD 0d 1756 f 9543d 67</a></figcaption></figure><p id="bbdb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将LoginWithAmazonProxy.swift类添加到Xcode项目中。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">LoginWithAmazonProxy.swift要点代码</figcaption></figure><p id="dc7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">我们覆盖了默认的ViewController。Swift与以下:</strong></p><p id="53f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修改ViewController.swift文件以实现AIAuthenticationDelegate，并添加所需的函数requestDidSucceed、requestDidFail和登录按钮活动。</p><figure class="kx ky kz la gt jr"><div class="bz fp l di"><div class="oj ok l"/></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">用Amazon auth flow处理登录的主视图控制器</figcaption></figure><p id="7200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">运行App，测试签到流程</strong></p><p id="fb8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用单点登录流程登录Amazon的典型用户体验流程:</p><p id="a625" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第一步:用户点击亚马逊按钮<strong class="ka ir">登录</strong></p><p id="a44d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">步骤2:Amazon登录屏幕(用户使用Amazon凭证进行身份验证)</p><p id="c1a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">步骤3:同意屏幕(如果您不需要任何用户详细信息，可以跳过此屏幕，但这有什么意思呢？)</p><p id="db13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">客户完成登录和同意流程后，他们会被自动重定向回您的iOS应用程序。在Amazon.com用户通过身份验证后，您可以随时检索他们的个人资料(姓名、电子邮件和邮政编码)。</p><h1 id="39db" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">最后的想法</h1><p id="ad42" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">拥有超过2亿个亚马逊帐户，使用亚马逊登录是为您的用户提供的另一个伟大的第三方登录提供商。请记住，第三方登录提供商集成对开发人员的最大好处是能够收集用户信息。另一个好处是用户不需要记住另一个用户名/密码。</p><p id="8eed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经通过登录亚马逊(LWA)验证了我们的用户，我们现在可以将LWA与亚马逊Cognito集成，为我们的移动用户提供临时、有限的AWS凭据来调用我们的AWS资源。请继续关注第2部分，我们将继续使用LWA，使用AWS Amplify实现我们的应用程序，并使用Amazon Cognito添加联合登录。</p></div></div>    
</body>
</html>