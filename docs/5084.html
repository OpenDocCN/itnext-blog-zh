<html>
<head>
<title>UCKS Exam Series #1 Create Cluster &amp; Security Best Practices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UCKS考试系列#1创建群集和安全性最佳实践</h1>
<blockquote>原文：<a href="https://itnext.io/cks-exam-series-1-create-cluster-security-best-practices-50e35aaa67ae?source=collection_archive---------1-----------------------#2020-12-07">https://itnext.io/cks-exam-series-1-create-cluster-security-best-practices-50e35aaa67ae?source=collection_archive---------1-----------------------#2020-12-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0449" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Kubernetes CKS示例考试问题系列</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0b4636daffcb81ed1b2b37e49b2316ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pKkK2mm8WZ7MiBj9C70awg.png"/></div></div></figure><blockquote class="kr ks kt"><p id="716a" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae lr" href="https://killer.sh/r?d=cks-series" rel="noopener ugc nofollow" target="_blank"> CKS考试系列</a> | <a class="ae lr" href="https://killer.sh/r?d=cka-series" rel="noopener ugc nofollow" target="_blank"> CKA考试系列</a> | <a class="ae lr" href="https://killer.sh/r?d=ckad-series" rel="noopener ugc nofollow" target="_blank"> CKAD考试系列</a></p></blockquote><p id="c966" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">## # # # # # # # # # # # # # # # # # # # ##</strong></p><p id="70de" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">此挑战不会在此更新，将移至:</strong></p><p id="32df" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><a class="ae lr" href="https://killercoda.com/killer-shell-cks" rel="noopener ugc nofollow" target="_blank">https://killercoda.com/killer-shell-cks</a></p><p id="fb12" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">## # # # # # # # # # # # # # # # # # # # # # # ##</strong></p><h1 id="a2ce" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">内容</h1><ol class=""><li id="854c" class="mn mo iq kx b ky mp lb mq ls mr lt ms lu mt lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-1-create-cluster-security-best-practices-50e35aaa67ae?source=friends_link&amp;sk=8bc466dae0ea90412251e32d4eaf7539" rel="noopener">创建集群&amp;安全最佳实践</a></li><li id="1be6" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-2-pods-and-secrets-3d92a6fba331?source=friends_link&amp;sk=379fa6e196233c73ef7845d84a3aa34d" rel="noopener">pod、机密和服务帐户</a></li><li id="8f2a" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-3-immutable-pods-3812cf76cff4?source=friends_link&amp;sk=ed1231a0382d97bd5c8267afe75f14ac" rel="noopener">不可变豆荚</a></li><li id="ff89" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-4-crash-that-apiserver-5f4d3d503028?source=friends_link&amp;sk=3ccd9bf1b728e85f86157ef1af23d455" rel="noopener">崩溃那个Apiserver &amp;检查日志</a></li><li id="b5dd" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-5-imagepolicywebhook-8d09f1ceee70?source=friends_link&amp;sk=93017beeae20f640f52db41d20d3ffcd" rel="noopener">ImagePolicyWebhook/admission controller</a></li><li id="289b" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-6-users-and-certificatesigningrequests-368a5b2c6a3f" rel="noopener">用户和证书签名请求</a></li><li id="e224" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-7-serviceaccount-tokens-1158c93612d4?source=friends_link&amp;sk=1064eaf2f3d4d03576bcde207eaf7cfb" rel="noopener">服务帐户令牌安装</a></li><li id="2927" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-8-rbac-db8a0984059e?source=friends_link&amp;sk=8a1abe2d51275faed47f3d36858b14d5" rel="noopener">基于角色的访问控制(RBAC) </a></li><li id="1291" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-9-rbac-v2-23ee24dd77cd?source=friends_link&amp;sk=2a6027eb75fbcf7876216cab222fa953" rel="noopener">基于角色的访问控制(RBAC) v2 </a></li><li id="186a" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-10-container-hardening-177588b8bbfe?source=friends_link&amp;sk=dbdddc1ee9321a946ee2e3f778c0711a" rel="noopener">容器硬化</a></li><li id="cc7b" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated"><a class="ae lr" href="https://wuestkamp.medium.com/cks-exam-series-11-networkpolicies-default-deny-and-allowlist-b2ce4186551f?source=friends_link&amp;sk=bdcc071a32f26b93d6c4a51b9a9436a7" rel="noopener">网络策略(默认拒绝+允许列表)</a></li></ol><p id="7e20" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p id="860c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">→查看Udemy上的<a class="ae lr" href="https://killer.sh/r?d=cks-course" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">全CKS课程</strong> </a></p><p id="595c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><h1 id="3ccc" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">规则！</h1><ol class=""><li id="10df" class="mn mo iq kx b ky mp lb mq ls mr lt ms lu mt lq mu mv mw mx bi translated">速度要快，避免从头开始手动创建yaml</li><li id="fc57" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">仅使用<a class="ae lr" href="https://kubernetes.io/docs/home/" rel="noopener ugc nofollow" target="_blank">kubernetes.io/docs</a>进行帮助。</li><li id="95d2" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">完成您的解决方案后，请查看我们的解决方案。你可能有一个更好的！</li></ol><h1 id="fe83" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">今天的任务:创建一个用于研究和检查安全最佳实践的CKS集群</h1><p id="b3d7" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">这是本系列的第一个任务，因此这将是一个准备工作，而不是自己解决问题。我们认为学习CKS的最好方法是手头有自己的集群。</p><p id="c9ff" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这可以只是一个简单的集群、一个控制平面(主)、一个节点(工作节点)，并使用<code class="fe ng nh ni nj b">kubeadm</code>进行安装。在CKS考试中，您将使用这种完全相同的集群设置。</p><ol class=""><li id="191a" class="mn mo iq kx b ky kz lb lc ls nk lt nl lu nm lq mu mv mw mx bi translated">创建两个虚拟机</li><li id="5777" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">使用<code class="fe ng nh ni nj b">kubeadm</code>安装<strong class="kx ir">控制面板</strong></li><li id="6e9d" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">使用<code class="fe ng nh ni nj b">kubeadm</code>安装<strong class="kx ir">节点</strong></li><li id="be88" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">将节点添加到群集</li><li id="1a83" class="mn mo iq kx b ky my lb mz ls na lt nb lu nc lq mu mv mw mx bi translated">观看Kubernetes最佳实践，做好心理准备！</li></ol><h1 id="d367" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">解决办法</h1><p id="0e1c" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">我们在这个系列中会用到Gcloud，因为它很容易，很简单，而且是免费的(免费信用)。但是您可以在任何地方创建必要的两个虚拟机！</p><blockquote class="kr ks kt"><p id="f429" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">hree也是由普雷斯顿·谢尔登创作的流浪回购，人们可以用<a class="ae lr" href="https://github.com/pksheldon4/cks-cluster" rel="noopener ugc nofollow" target="_blank">https://github.com/pksheldon4/cks-cluster</a></p></blockquote><h2 id="e52a" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">1.创建两个虚拟机</h2><p id="f388" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">要在Gcloud中创建虚拟机，我们可以运行:</p><p id="b67c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">创建<code class="fe ng nh ni nj b">cks-controlplane</code>:</p><pre class="kg kh ki kj gt ob nj oc od aw oe bi"><span id="7be5" class="np lw iq nj b gy of og l oh oi">gcloud compute instances create cks-controlplane --zone=europe-west3-c \<br/>--machine-type=e2-medium \<br/>--image=ubuntu-1804-bionic-v20201014 \<br/>--image-project=ubuntu-os-cloud \<br/>--boot-disk-size=50GB</span></pre><p id="fdb5" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">创造<code class="fe ng nh ni nj b">cks-node</code>:</p><pre class="kg kh ki kj gt ob nj oc od aw oe bi"><span id="9499" class="np lw iq nj b gy of og l oh oi">gcloud compute instances create cks-node --zone=europe-west3-c \<br/>--machine-type=e2-medium \<br/>--image=ubuntu-1804-bionic-v20201014 \<br/>--image-project=ubuntu-os-cloud \<br/>--boot-disk-size=50GB</span></pre><p id="2cc2" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">你也可以选择一个离你近的不同区域:<a class="ae lr" href="https://cloud.google.com/compute/docs/regions-zones" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/compute/docs/regions-zones</a></p><h2 id="1738" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">2.使用Kubeadm安装控制面板</h2><p id="a47e" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">这个挑战系列有一个<a class="ae lr" href="https://github.com/killer-sh/cks-challenge-series" rel="noopener ugc nofollow" target="_blank">库</a>。</p><pre class="kg kh ki kj gt ob nj oc od aw oe bi"><span id="e4c1" class="np lw iq nj b gy of og l oh oi">gcloud compute ssh cks-controlplane<br/>&gt; sudo -i<br/>&gt; <!-- -->bash &lt;(curl -s <a class="ae lr" href="https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_controlplane.sh)" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_controlplane.sh</a><a class="ae lr" href="https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_controlplane.sh)" rel="noopener ugc nofollow" target="_blank">)</a> </span><span id="7b8f" class="np lw iq nj b gy oj og l oh oi">exit<br/>sudo -i # login again to get nicer bash with autocompletion</span></pre><h2 id="a055" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">3.使用Kubeadm安装节点</h2><pre class="kg kh ki kj gt ob nj oc od aw oe bi"><span id="15d8" class="np lw iq nj b gy of og l oh oi">gcloud compute ssh cks-node<br/>&gt; sudo -i<br/>&gt; <!-- -->bash &lt;(curl -s <a class="ae lr" href="https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_node.sh)" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_node.sh</a><a class="ae lr" href="https://raw.githubusercontent.com/killer-sh/cks-challenge-series/master/cluster-setup/latest/install_node.sh)" rel="noopener ugc nofollow" target="_blank">)</a></span><span id="0b21" class="np lw iq nj b gy oj og l oh oi">exit<br/>sudo -i # login again to get nicer bash with autocompletion</span></pre><h2 id="3074" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">4.向群集中添加节点</h2><p id="6e35" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">将<code class="fe ng nh ni nj b">install_controlplane.sh</code>脚本在controlplane-VM上输出的<code class="fe ng nh ni nj b">kubeadm join</code>命令复制到node-VM上，并在那里执行:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/07e013c00d7cbac1573a799597434dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQ9ZRViOwY51FcBQPoMRoQ.png"/></div></div></figure><p id="8986" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">我们还可以用:<code class="fe ng nh ni nj b">kubeadm token create -—print-join-command —-ttl 0</code>创建一个新的join令牌。</p><p id="1fb6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">事后我们应该看到:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/d649ce72d47cd4d6e40258d330996d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xyQYYyhgN56zxezeUaTtVg.png"/></div></div></figure><h2 id="198c" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">5.观看Kubernetes安全最佳实践</h2><p id="0ac7" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">…做好心理准备！</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="d789" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated"><strong class="kx ir">总是在不使用的时候停止你的实例</strong>，只在需要的时候再启动，比如:</p><pre class="kg kh ki kj gt ob nj oc od aw oe bi"><span id="a89d" class="np lw iq nj b gy of og l oh oi">gloud compute instances stop cks-controlplane cks-node<br/>gloud compute instances start cks-controlplane cks-node</span></pre><p id="beb9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">这为您节省了宝贵的云资源！</p><h1 id="90f2" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">你有不同的解决方法？</h1><p id="d750" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">在下面写个评论让我们知道吧！</p><h1 id="9727" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">— — —结尾————</h1><p id="ff81" class="pw-post-body-paragraph ku kv iq kx b ky mp jr la lb mq ju ld ls nd lg lh lt ne lk ll lu nf lo lp lq ij bi translated">第一次会议到此为止。现在，您应该已经有了一个良好的K8s集群作为基础，可以用来研究和学习。</p><p id="ca6e" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld ls lf lg lh lt lj lk ll lu ln lo lp lq ij bi translated">下次再见，祝学习愉快！</p><h1 id="989d" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">准备好加入黑仔壳牌了吗？</h1><h2 id="0d9a" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">完整的CKS课程</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://killer.sh/r?d=cks-course"><div class="gh gi oo"><img src="../Images/b16ab8b3bd72db1ad641b82f067bdd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULNkfS7aG-FdPA_OEtLbJQ.png"/></div></a><figcaption class="op oq gj gh gi or os bd b be z dk translated"><a class="ae lr" href="https://killer.sh/r?d=cks-course" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><h2 id="5451" class="np lw iq bd lx nq nr dn mb ns nt dp mf ls nu nv mh lt nw nx mj lu ny nz ml oa bi translated">…或者CKS模拟器</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://killer.sh/cks"><div class="gh gi ot"><img src="../Images/4c118b1471bd606fc46cd5569df4f944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ery6hxFdiGJ6wSlP.png"/></div></a><figcaption class="op oq gj gh gi or os bd b be z dk translated"><a class="ae lr" href="https://killer.sh/cks" rel="noopener ugc nofollow" target="_blank">https://killer.sh/cks</a></figcaption></figure></div></div>    
</body>
</html>