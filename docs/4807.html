<html>
<head>
<title>How to run two Angular apps in one window?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在一个窗口运行两个Angular apps？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-separate-angular-apps-in-one-spa-shell-5250e0fc6155?source=collection_archive---------2-----------------------#2020-09-23">https://itnext.io/how-to-run-separate-angular-apps-in-one-spa-shell-5250e0fc6155?source=collection_archive---------2-----------------------#2020-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e262a6b41e50218d784bf47802d370cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*OtVUOxgftZnDRHn2kohUlg.jpeg"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">由<a class="ae jy" href="https://unsplash.com/@eprouzet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Eric Prouzet </a>在<a class="ae jy" href="https://unsplash.com/s/photos/multiple?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="a8d6" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">有时，为了解决使用Angular framework设计应用程序的特定情况，我们可以选择一个架构，假设在一个<code class="fe kx ky kz la b">window</code>范围内运行两个或更多独立的Angular应用程序。</p><p id="1d8c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">抛开这种微前端方法的利弊不谈，让我们看看如何准备我们的架构，以便在一个shell SPA中运行多个独立的角度应用程序。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/e030c6d02c833f70828d3eef3d5e9b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*Lvp7DLX4bfKX4GRJ7VpnYA.png"/></div></figure><h1 id="a4d2" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">TLDR；📕</strong></h1><ul class=""><li id="f126" class="me mf iq kb b kc mg kg mh kk mi ko mj ks mk kw ml mm mn mo bi translated">我们能够通过<em class="mp"> @angular/elements </em>在一个<code class="fe kx ky kz la b">window</code>范围内运行多个角度应用</li><li id="2fbb" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">我们需要为存储内容提供独特的空间</li><li id="8d9d" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">我们可以通过使用<em class="mp">@ angular-builders/custom-web pack</em>提供额外的配置来确保<em class="mp"> webpackJsonp </em>内容的唯一名称</li><li id="5a44" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">多角度应用运行的实际应用和解决方案可以在<a class="ae jy" href="https://github.com/marcinmilewicz/microfrontendly" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir">微前端</strong> </a>库中找到。</li></ul></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="886e" class="lg lh iq bd li lj nc ll lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md bi translated">使用@angular/elements库</h1><p id="ca1d" class="pw-post-body-paragraph jz ka iq kb b kc mg ke kf kg mh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw ij bi translated">一种更简单、更值得推荐和坚持的方法是使用官方文档中详细描述的<a class="ae jy" href="https://angular.io/api/elements" rel="noopener ugc nofollow" target="_blank"><em class="mp">@ angular/elements</em></a>库。简而言之，这个想法就是构建一个Angular应用作为<a class="ae jy" href="https://www.webcomponents.org/" rel="noopener ugc nofollow" target="_blank"> <em class="mp"> WebComponent </em> </a>并在父母的SPA app中以这种形式使用。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/6d2f3e132b2bfa73203ee47c7e49c157.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*XVA5NnXxnwBUFV22rxlWHQ.png"/></div></figure><h1 id="5e38" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">创建壳牌SPA</h1><p id="c441" class="pw-post-body-paragraph jz ka iq kb b kc mg ke kf kg mh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw ij bi translated">用@angular/elements构建的应用程序应该用在shell应用程序中，这将是我们架构的核心。要理解这个想法，最好看一个放在<a class="ae jy" href="https://github.com/marcinmilewicz/microfrontendly" rel="noopener ugc nofollow" target="_blank"><strong class="kb ir">Microfrontendly</strong></a>资源库中的例子。</p><p id="7f31" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在上面的例子中，我们有两个角度应用:<em class="mp"> foo-app </em>和<em class="mp"> bar-app </em>。两者都通过<em class="mp"> @angular/elements </em>转换成<em class="mp"> WebComponent </em>并在一个集合shell中运行。</p><h2 id="4fd8" class="nl lh iq bd li nm nn dn lm no np dp lq kk nq nr lu ko ns nt ly ks nu nv mc nw bi translated">潜在和常见的问题📉</h2><p id="00c4" class="pw-post-body-paragraph jz ka iq kb b kc mg ke kf kg mh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw ij bi translated">如果我们想弄乱额外的弹出角度应用程序，我们肯定会遇到以下问题:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/008415279e64eb6c5782aad3c23ea1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fIBIOKMvV8-WpcS82KkbEw.png"/></div></div></figure><h2 id="8b03" class="nl lh iq bd li nm nn dn lm no np dp lq kk nq nr lu ko ns nt ly ks nu nv mc nw bi translated">这到底是怎么回事？😕</h2><p id="2c21" class="pw-post-body-paragraph jz ka iq kb b kc mg ke kf kg mh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw ij bi translated">当我们推出第一款<em class="mp"> foo-app </em>时，一切都很好。然而，当我们想要在同一个<code class="fe kx ky kz la b">window</code>范围内初始化第二个Angular应用程序时，上面的错误被抛出。</p><p id="6c82" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这个问题与初始化第一个应用程序时创建的<code class="fe kx ky kz la b">window.webpackJsonp</code>密切相关。当第二个应用程序被引导时，<code class="fe kx ky kz la b">window.webpackJsonp</code>的内容不会被覆盖，新的应用程序会触发旧的代码。因此，<em class="mp"> foo-bar </em>应用的函数<code class="fe kx ky kz la b">customElements.define</code>被第二次调用，这是因为<em class="mp">自定义元素</em>可以在<code class="fe kx ky kz la b">window</code>范围内注册一次。结果，我们得到上面的异常</p><blockquote class="oc od oe"><p id="1803" class="jz ka mp kb b kc kd ke kf kg kh ki kj of kl km kn og kp kq kr oh kt ku kv kw ij bi translated">无法对“CustomElementRegistry”执行“define”:名称“foo-microapp”已用于此注册表</p></blockquote></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><blockquote class="oc od oe"><p id="5229" class="jz ka mp kb b kc kd ke kf kg kh ki kj of kl km kn og kp kq kr oh kt ku kv kw ij bi translated"><a class="ae jy" href="https://twitter.com/marcin_milewicz" rel="noopener ugc nofollow" target="_blank">如果你想了解新的伟大的角度和前端的东西，请在Twitter上关注我</a>！<em class="iq">😄</em></p></blockquote></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="cd79" class="lg lh iq bd li lj nc ll lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md bi translated">如何解决，一个窗口运行多个Angular app？👌</h1><p id="5eb5" class="pw-post-body-paragraph jz ka iq kb b kc mg ke kf kg mh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw ij bi translated">解决这类问题的一种方法(但不是唯一的方法)是使用额外的Webpack配置并指定<em class="mp"> webpackJsonp </em>范围。要解决这个问题，我们必须遵循以下步骤:</p><ol class=""><li id="17bc" class="me mf iq kb b kc kd kg kh kk oi ko oj ks ok kw ol mm mn mo bi translated">向每个支持自定义Webpack配置的Angular应用程序添加额外的构建器</li></ol><pre class="lc ld le lf gt om la on oo aw op bi"><span id="3a6a" class="nl lh iq la b gy oq or l os ot">npm i -D @angular-builders/custom-webpack</span></pre><p id="e158" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">2.更改<em class="mp"> angular.json </em>中的配置</p><pre class="lc ld le lf gt om la on oo aw op bi"><span id="1a73" class="nl lh iq la b gy oq or l os ot">"architect": {<br/> "build": {<br/>  "builder": "@angular-builders/custom-webpack:browser",<br/>  "options": {<br/>   "customWebpackConfig": {<br/>    "path": "./scripts/webpack.config.js"<br/>   },<br/>   "outputPath": "dist/bar-microapp",<br/>.....</span></pre><p id="821b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">3.添加适当的附加<em class="mp"> webpack.config.js </em></p><pre class="lc ld le lf gt om la on oo aw op bi"><span id="d1c8" class="nl lh iq la b gy oq or l os ot">const uuidv1 = require('uuidv1');<br/><br/><strong class="la ir"><em class="mp">module</em></strong>.exports = {<br/> output: {<br/>  jsonpFunction: 'foo-microapp-' + uuidv1()<br/> }<br/>};</span></pre><p id="3493" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">以上配置保证了<code class="fe kx ky kz la b">window.webpackJsonp</code>功能中内容落地的唯一性。</p><p id="d317" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">让我们从<a class="ae jy" href="https://github.com/marcinmilewicz/microfrontendly" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir">微前端</strong> </a>库运行这个例子，并检查现在发生了什么。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi ou"><img src="../Images/25183b0ab1db842bac88b86206435786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BzihEDG3N0hPG4tjEKAzA.png"/></div></div></figure><p id="d9e0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">出乎意料的是，我们观察到<code class="fe kx ky kz la b">window.webpackJsonp</code>对象是空的。为什么？让我们仔细思考和观察这个<code class="fe kx ky kz la b">window</code>物体。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi ov"><img src="../Images/a7861d34f9242632fd38279a6185e59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nRB3LqqxthtObr6PmlgpA.png"/></div></div></figure><p id="ee1e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">最后，我们能够为特定的Angular应用程序找到合适的内容，一切都正常工作。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><h1 id="a929" class="lg lh iq bd li lj nc ll lm ln nd lp lq lr ne lt lu lv nf lx ly lz ng mb mc md bi translated">摘要📗</h1><ul class=""><li id="39fe" class="me mf iq kb b kc mg kg mh kk mi ko mj ks mk kw ml mm mn mo bi translated">我们能够通过@angular/elements在一个<code class="fe kx ky kz la b">window</code>范围内运行多个角度应用</li><li id="7194" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">我们需要为存储内容提供独特的空间</li><li id="9acc" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">我们可以通过用@ angular-builders/custom-web pack提供额外的配置来确保<em class="mp"> webpackJsonp </em>内容的唯一名称</li><li id="f0d5" class="me mf iq kb b kc mq kg mr kk ms ko mt ks mu kw ml mm mn mo bi translated">多角度应用运行的实际应用和解决方案可以在<a class="ae jy" href="https://github.com/marcinmilewicz/microfrontendly" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir">微前端</strong> </a>库中找到。</li></ul></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><blockquote class="oc od oe"><p id="2830" class="jz ka mp kb b kc kd ke kf kg kh ki kj of kl km kn og kp kq kr oh kt ku kv kw ij bi translated"><a class="ae jy" href="https://twitter.com/marcin_milewicz" rel="noopener ugc nofollow" target="_blank">如果你想了解新的伟大的棱角和前端的东西，请在Twitter上关注我</a>！<em class="iq">😄</em></p></blockquote><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/e030c6d02c833f70828d3eef3d5e9b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*Lvp7DLX4bfKX4GRJ7VpnYA.png"/></div></figure></div></div>    
</body>
</html>