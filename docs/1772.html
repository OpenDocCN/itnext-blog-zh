<html>
<head>
<title>Streaming Data With Amazon’s Oldest Cloud Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过亚马逊历史最悠久的云服务传输数据</h1>
<blockquote>原文：<a href="https://itnext.io/streaming-data-with-amazons-oldest-cloud-service-51a6be142c8e?source=collection_archive---------0-----------------------#2019-01-24">https://itnext.io/streaming-data-with-amazons-oldest-cloud-service-51a6be142c8e?source=collection_archive---------0-----------------------#2019-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b247f967dcaf5a840f4af23a537359c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzPRzOULaLpWL1tb2GPkzg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">科罗拉多州博尔德附近的某处</figcaption></figure><p id="9e5c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你是一名现代应用程序开发人员，计划对应用程序中的数据流进行一些近乎实时的处理——考虑跟踪地理位置、收集分析、监控遥测等。—您的基本需求之一是选择能够接收和传输这数百万位数据的云服务。有几种选择，那么你应该选择哪一种呢？</p><p id="e961" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我们来看看需求。</p><h1 id="c44a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">数据流的要求</h1><p id="95ad" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">对于流数据处理，有一个<strong class="ke ir">存储</strong>层和一个<strong class="ke ir">处理</strong>层。存储层需要支持强一致性(至少一次交付)、快速读/写、“无限”可扩展，并允许非常高的吞吐量来处理大量的流数据。处理层负责从存储层消费数据，对该数据运行分析，并通过通知存储层已处理的数据并将其从存储层删除来监督“已处理”的数据。这两层都需要高度可伸缩、持久和容错。</p><h1 id="165c" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">数据流服务/平台</h1><p id="157b" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">为了满足上述需求，近年来出现了几种解决方案来处理这些类型的数据流工作负载。这些应用包括托管AWS服务，如<a class="ae md" href="https://aws.amazon.com/kinesis/data-firehose/" rel="noopener ugc nofollow" target="_blank">亚马逊Kinesis数据消防软管</a>和<a class="ae md" href="https://aws.amazon.com/kinesis/data-streams/" rel="noopener ugc nofollow" target="_blank">亚马逊Kinesis数据流</a>。其他类似的运行在AWS上的云流媒体数据平台已经出现，如Apache Kafka、Apache Flume和Apache Storm。</p><p id="c5ad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每种服务或平台都有自己特定的用例、优缺点和定价结构。然而，有一种主要的云服务比所有这些选项存在的时间都长，并且满足了在存储层和处理层成功传输数据的所有要求。这是一个缺乏现代活力的不性感的野兽，但却始终如一地实现了它的承诺——经济高效，“无限”的规模，安全，保证一次交付，容错，并且对吞吐量水平没有限制。进入<strong class="ke ir">亚马逊简单队列服务</strong>。</p><h1 id="93bc" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">处理您所有的数据流需求</h1><p id="728e" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">亚马逊简单队列服务(SQS)早在2004年就作为一种消息队列服务推出，支持任何规模的消息的编程发送。它今天仍然是同样可靠的服务，可以处理大多数常见的工作负载，如亚马逊Kinesis和其他流数据平台，当与AWS Lambda配合作为事件源时，开销更少，成本更低，架构简单。</p><h1 id="8e25" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">工作原理——亚马逊SQS生产商和消费者</h1><p id="2401" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">当你创建一个队列时，这个队列成为几个亚马逊SQS服务器之间的<a class="ae md" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-basic-architecture.html" rel="noopener ugc nofollow" target="_blank">分布式系统的一部分，你发送到这个队列的每条消息都被冗余地存储在多个SQS服务器上。向队列发送消息的应用程序被称为<strong class="ke ir">生产者— </strong>任何使用AWS SDK的客户端。从队列中检索消息的应用程序被称为<strong class="ke ir">消费者。</strong>消费者也可以是使用AWS SDK从队列中检索、处理和删除“已处理”消息的任何服务或客户端。</a></p><h1 id="e4ed" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">队列的消息—持久数据存储</h1><blockquote class="me mf mg"><p id="9a52" class="kc kd mh ke b kf kg kh ki kj kk kl km mi ko kp kq mj ks kt ku mk kw kx ky kz ij bi translated">亚马逊SQS作为存储层</p></blockquote><p id="e84d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，我们有一个分布在几个SQS服务器上的队列，我们有消息存储在队列中，也是冗余的。该消息有两个主要组成部分，<a class="ae md" href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-message-attributes.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">消息属性</strong> </a> <strong class="ke ir">，</strong>和一个<strong class="ke ir">消息体</strong>。消息属性是可选的，用于指定从识别发送者到为以后的处理提供消息细节的任何内容。消息体是原始文本或JSON格式的实际消息。每条消息最大为256kb，一个队列可以存储无限量的消息。您的邮件在标准队列中被发送、存储并等待处理长达14天。所有客户每月可以免费发出100万次SQS请求，此后每100万次请求收费0.40美元，使这项服务成为简单、经济高效的数据源和流数据服务！</p><h1 id="24de" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">亚马逊SQS作为AWS Lambda的事件源</h1><blockquote class="me mf mg"><p id="33ce" class="kc kd mh ke b kf kg kh ki kj kk kl km mi ko kp kq mj ks kt ku mk kw kx ky kz ij bi translated">AWS Lambda服务作为处理层</p></blockquote><p id="2db0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们知道将流数据作为存储层传输到SQS的所有好处，但是存储在队列中的流数据的处理器或消费者呢？正如我之前暗示的，AWS Lambda是这个流数据架构的处理层。截至2018年年中，亚马逊SQS队列是AWS Lambda的一级事件驱动数据源。Lambda集成是如何工作的？</p><p id="0e46" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">AWS Lambda服务(不是您的Lambda函数，而是代表您运行的Lambda SQS服务)不断轮询您的SQS队列以获取传入消息。当消息到达时，它接收消息，然后通过将消息作为参数传递来调用Lambda函数。看看一些Kinesis图表，这个SQS事件驱动架构(Lambda作为消费者)看起来几乎与Kinesis Streams或Firehose提供的相同，但没有分片、分区、交付系统、管道等的复杂性..</p><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/7318eee9829752ffeb9fed590510204f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgmYF5u7pShT0Th04YLnUw.png"/></div></div></figure><blockquote class="me mf mg"><p id="8f11" class="kc kd mh ke b kf kg kh ki kj kk kl km mi ko kp kq mj ks kt ku mk kw kx ky kz ij bi translated">如果你想更深入地了解亚马逊SQS作为一个事件源，请点击这里查看我的文章。</p></blockquote><h1 id="338c" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">走吧。开始吧。流动</h1><p id="f66f" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我创建了一个<a class="ae md" href="https://github.com/mobilequickie/SQSSwift" rel="noopener ugc nofollow" target="_blank"> Github repo </a>解决方案，其中包含一个一键式亚马逊<a class="ae md" href="https://aws.amazon.com/cloudformation/aws-cloudformation-templates/" rel="noopener ugc nofollow" target="_blank"> CloudFormation模板</a>，用于创建事件驱动的存储和处理后端层。CloudFormation堆栈创建一个亚马逊SQS队列、映射到Lamda的事件源和一个Lambda函数。对于客户端(数据流生产者)，我创建了一个iOS Swift移动应用程序，通过一次向源SQS队列直接发送单个或批量(最多10个)消息，充当流数据的生产者。</p><p id="81c3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从这里开始<a class="ae md" href="https://github.com/mobilequickie/SQSSwift" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="7575" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结束语</h1><p id="c162" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">SQS没有开销，具有成本效益，可无限扩展，并且对吞吐量、消息或队列的数量没有限制。<strong class="ke ir">这是一项始终在线的托管存储层和处理层服务(借助AWS Lambda ),几乎适用于任何应用。试一试，让我知道你的想法！</strong></p><h1 id="95e3" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">向SQS传输数据流的典型使用案例</h1><p id="284f" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated"><strong class="ke ir">地理定位</strong>:基于设备的GPS数据收集<br/> <strong class="ke ir">分析</strong>:用户活动和设备日志<br/> <strong class="ke ir">遥测日志</strong>:连接设备状态、消息和事件日志</p><blockquote class="mq"><p id="c973" class="mr ms iq bd mt mu mv mw mx my mz kz dk translated">嘿，iOS开发者们！我计划构建并记录一个本地iOS Swift应用程序，将数据传输到SQS，并通过Amazon Cognito进行认证。你建议用什么用例？留下评论，让我知道你的选择！</p></blockquote></div></div>    
</body>
</html>