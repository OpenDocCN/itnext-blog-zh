<html>
<head>
<title>Kubernetes + Rancher Cluster Manager 2.6 on your macOS laptop with k3d/k3s in 5 min</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在5分钟内将kubernetes+Rancher Cluster Manager 2.6安装到装有k3d/k3s的macOS笔记本电脑上</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-rancher-cluster-manager-2-6-on-your-macos-laptop-with-k3d-k3s-in-5-min-8acdb94f3376?source=collection_archive---------0-----------------------#2021-09-22">https://itnext.io/kubernetes-rancher-cluster-manager-2-6-on-your-macos-laptop-with-k3d-k3s-in-5-min-8acdb94f3376?source=collection_archive---------0-----------------------#2021-09-22</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/d8809c95b8c846ce944fba70afc3b0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MS5XGuUvWMI6GJ37_0Nzew.png"/></div></div></figure><blockquote class="kc kd ke"><p id="5da5" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld in bi translated"><strong class="ki iv">牧场主集群管理器2.6.1 </strong>于10月19日更新</p></blockquote><p id="28f7" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">本文展示了如何在您的Macbook上使用k3d(由k3s支持)建立一个Kubernetes集群，使用崭新的Rancher Cluster Manager 2.6 建立一个最小的Kubernetes本地实验室开发环境。</p><p id="4806" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">本文的目标是构建一个<strong class="ki iv">本地实验室</strong>来评估全新的Rancher Cluster Manager 2.6，这样您就可以练习部署&amp;使用一个*棒极了*的web UI来观察Kubernetes工作负载。</p><blockquote class="kc kd ke"><p id="f1be" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld in bi translated">本设置<strong class="ki iv"> </strong>是<strong class="ki iv"> <em class="iu">不用于生产</em> </strong>。在生产中，您将有第二个prod集群，与部署Rancher的集群不同</p></blockquote><h2 id="e0f5" class="lh li iu bd lj lk ll dn lm ln lo dp lp le lq lr ls lf lt lu lv lg lw lx ly lz bi translated"><strong class="ak"><em class="ma">TL；博士安装Docker &amp;头盔，运行最后的要点即可，看这个asci NEMA:</em></strong><a class="ae mb" href="https://asciinema.org/a/uao5iovk75B0Iggw6kPurAmCo" rel="noopener ugc nofollow" target="_blank">https://asciinema.org/a/uao5iovk75B0Iggw6kPurAmCo</a></h2><h1 id="3591" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">先决条件</h1><p id="be4c" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">你的Macbook只有两个先决条件:Docker &amp; homebrew。</p><ol class=""><li id="e29f" class="my mz iu ki b kj kk kn ko le na lf nb lg nc ld nd ne nf ng bi translated">大苏尔马科斯(11.6)</li><li id="c4cd" class="my mz iu ki b kj nh kn ni le nj lf nk lg nl ld nd ne nf ng bi translated">带有3个CPU和6 GB内存的Docker台式机(4.0.1)</li><li id="6bcd" class="my mz iu ki b kj nh kn ni le nj lf nk lg nl ld nd ne nf ng bi translated">自制(<a class="ae mb" href="https://docs.brew.sh/Installation" rel="noopener ugc nofollow" target="_blank">安装文档</a>)</li></ol><blockquote class="kc kd ke"><p id="2f64" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld in bi translated">如果你对Windows 10的操作方法感兴趣，请阅读以下内容:<a class="ae mb" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-rancher-2-5-on-your-windows-10-laptop-with-k3d-and-k3s-7404f288342f">https://it next . io/kubernetes-rancher-2-5-on-your-Windows-10-laptop-with-k3d-and-k3s-7404 f 288342 f</a></p></blockquote><h1 id="b86d" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">概观</h1><p id="511c" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">先决条件:确保Docker (6 GB mem) <br/> 0中有足够的资源。用自制软件安装k3d，kubectl和helm</p><ol class=""><li id="ca86" class="my mz iu ki b kj kk kn ko le na lf nb lg nc ld nd ne nf ng bi translated">使用k3d启动单节点Kubernetes集群(使用k3s发行版)</li><li id="d7a4" class="my mz iu ki b kj nh kn ni le nj lf nk lg nl ld nd ne nf ng bi translated">使用helm引导证书管理器，然后转移到集群</li><li id="03c6" class="my mz iu ki b kj nh kn ni le nj lf nk lg nl ld nd ne nf ng bi translated">使用Rancher GUI观察集群</li></ol><h1 id="957f" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">先决条件:确保你有足够的资源</h1><p id="5c6f" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">Kubernetes和Rancher需要一些资源来运行所有的容器，以使我们作为开发人员的生活更加轻松。我本地的实验室有8个CPU和16 GB内存，我给了Docker 3个CPU和6 GB内存。</p><p id="10cd" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">实验室，不是生产</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nm"><img src="../Images/f718549ddd7dc8f266fb73777221bae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQMkwhpMSr8MpAn-oGZwSg.png"/></div></div></figure><blockquote class="kc kd ke"><p id="bf3e" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld in bi translated">你不需要<strong class="ki iv">而不是</strong>更改你的<code class="fe nr ns nt nu b">/etc/hosts</code>，因为我们会使用<code class="fe nr ns nt nu b">.localhost</code> <a class="ae mb" href="https://en.wikipedia.org/wiki/.localhost" rel="noopener ugc nofollow" target="_blank"> DNS魔法</a>让你的浏览器自动将任何<code class="fe nr ns nt nu b">.localhost</code>域名路由到<code class="fe nr ns nt nu b">127.0.0.1</code>。</p></blockquote><figure class="nn no np nq gu jv gi gj paragraph-image"><div class="gi gj nv"><img src="../Images/6d76d29941932c84b1ebaf8b112cc62b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*d_1gwrVQ09c3npvC1RZD_w.png"/></div><figcaption class="nw nx gk gi gj ny nz bd b be z dk translated">我的本地实验室有8个CPU和16 GB内存</figcaption></figure><h1 id="b671" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">0/3用自制软件安装k3d、kubectl和helm</h1><p id="a63d" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">我在桌面上创建了一个工作文件夹<code class="fe nr ns nt nu b">k3s-rancher</code>来保存未来的kubeconfig文件。有经验的k8手会使用<code class="fe nr ns nt nu b">kubectl config get-contexts</code>来确保他们在正确的集群上工作，但我将保持简单。</p><pre class="nn no np nq gu oa nu ob oc aw od bi"><span id="b68e" class="lh li iu nu b gz oe of l og oh">brew install k3d kubectl helm</span></pre><p id="ef9a" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">运行<code class="fe nr ns nt nu b">brew list k3d kubectl helm</code>后，如果你看到这样的屏幕，你就拥有了一切</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/0a0415317b414c4099d0dc33682681c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*qtXZ_gY0s68C7ceoWFQlYA.png"/></div></figure><h1 id="eef3" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">1/3使用k3d启动单节点Kubernetes集群(使用k3s发行版)</h1><p id="f488" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated"><a class="ae mb" href="https://k3d.io/" rel="noopener ugc nofollow" target="_blank"> k3d </a>使得创建一个K8s集群变得容易，这个集群使用<a class="ae mb" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> k3s </a>发行版，只有Docker Desktop作为依赖。k3s是K8s的一个小发行版，可以在Raspberry Pi上运行——但它和任何K8s发行版一样得到了<a class="ae mb" href="https://thenewstack.io/how-rancher-labs-k3s-makes-it-easy-to-run-kubernetes-at-the-edge/" rel="noopener ugc nofollow" target="_blank">认证，你可以在生产中运行它</a>。</p><blockquote class="kc kd ke"><p id="e72e" class="kf kg kh ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld in bi translated">请注意，我指定了k3s映像k3d和Rancher Desktop 0.4.1在2021年9月中旬都出现了问题，这些版本将一起工作。在不久的将来，您可能不需要指定一个<code class="fe nr ns nt nu b">--image</code>参数</p></blockquote><pre class="nn no np nq gu oa nu ob oc aw od bi"><span id="aa29" class="lh li iu nu b gz oe of l og oh">k3d cluster create k3d-rancher \<br/>    --api-port 6550 \<br/>    --servers 1 \<br/>    --image rancher/k3s:v1.20.10-k3s1 \<br/>    --port 443:443@loadbalancer \<br/>    --wait --verbose</span></pre><p id="da40" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">输出日志将以如下方式结束:</p><pre class="nn no np nq gu oa nu ob oc aw od bi"><span id="6cec" class="lh li iu nu b gz oe of l og oh">...<br/>INFO[0013] Successfully added host record to /etc/hosts in 2/2 nodes and to the CoreDNS ConfigMap                                                    INFO[0013] Cluster 'k3d-rancher' created successfully!                                                                                               INFO[0013] --kubeconfig-update-default=false --&gt; sets --kubeconfig-switch-context=false                                                              DEBU[0013] Updating default kubeconfig with a new context for cluster k3d-rancher                                                                    DEBU[0013] Setting new current-context 'k3d-k3d-rancher'                                                                                             DEBU[0013] Wrote kubeconfig to '/Users/jyee/.kube/config'                                                                                            INFO[0013] You can now use it like this:                                                                                                             kubectl config use-context k3d-k3d-rancher                                                                                                           kubectl cluster-info                                                                                                                                 </span><span id="d1f2" class="lh li iu nu b gz oj of l og oh">$ k3d cluster list                                                                                                                                   NAME          SERVERS   AGENTS   LOADBALANCER                                                                                                        k3d-rancher   1/1       0/0      true</span></pre><p id="0341" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">使用这些命令为新集群设置<code class="fe nr ns nt nu b">kubectl</code>。你也可以使用<code class="fe nr ns nt nu b">kubectl config use-context</code>，但是我发现这让很多初学者感到困惑(包括我！).</p><pre class="nn no np nq gu oa nu ob oc aw od bi"><span id="e475" class="lh li iu nu b gz oe of l og oh">KUBECONFIG_FILE=~/.kube/k3d-rancher<br/>k3d kubeconfig get k3d-rancher &gt; $KUBECONFIG_FILE<br/>chmod 600 $KUBECONFIG_FILE<br/>export KUBECONFIG=$KUBECONFIG_FILE<br/>kubectl get nodes</span></pre><h1 id="0b6b" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">2/3使用helm引导证书管理器，然后转移到集群</h1><p id="05a5" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">这些命令从<code class="fe nr ns nt nu b">rancher-latest</code> repo安装Rancher 2.6及其必备的证书管理器，遵循这些文档:<a class="ae mb" href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/" rel="noopener ugc nofollow" target="_blank">https://Rancher . com/docs/Rancher/v 2.6/en/installation/install-Rancher-on-k8s/</a></p><pre class="nn no np nq gu oa nu ob oc aw od bi"><span id="a2c1" class="lh li iu nu b gz oe of l og oh">### Install cert-manager with helm<br/>helm repo add jetstack <a class="ae mb" href="https://charts.jetstack.io" rel="noopener ugc nofollow" target="_blank">https://charts.jetstack.io</a><br/>helm repo update<br/>kubectl create namespace cert-manager<br/>helm install cert-manager jetstack/cert-manager \<br/>    --namespace cert-manager \<br/>    --version v1.5.3 \<br/>    --set installCRDs=true --wait --debug<br/>kubectl -n cert-manager rollout status deploy/cert-manager<br/>date</span><span id="ff58" class="lh li iu nu b gz oj of l og oh">### Install the helm repos for rancher<br/>helm repo add rancher-latest <a class="ae mb" href="https://releases.rancher.com/server-charts/latest" rel="noopener ugc nofollow" target="_blank">https://releases.rancher.com/server-charts/latest</a><br/>helm repo update<br/>kubectl create namespace cattle-system<br/>helm install rancher rancher-latest/rancher \<br/>    --namespace cattle-system \<br/>    --version=2.6.1 \<br/>    --set hostname=rancher.localhost \<br/>    --set bootstrapPassword=congratsthanandayme \<br/>    --wait --debug<br/>kubectl -n cattle-system rollout status deploy/rancher<br/>kubectl -n cattle-system get all,ing<br/>date</span></pre><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ok"><img src="../Images/7f7a6ebee400380650cf25e1e5c31c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FKD8KbKW2gvH07yoZwFO9Q.png"/></div></div></figure><h1 id="6438" class="mc li iu bd lj md me mf lm mg mh mi lp mj mk ml ls mm mn mo lv mp mq mr ly ms bi translated">3/3使用Rancher GUI观察集群</h1><p id="ba6d" class="pw-post-body-paragraph kf kg iu ki b kj mt kl km kn mu kp kq le mv kt ku lf mw kx ky lg mx lb lc ld in bi translated">看到行<code class="fe nr ns nt nu b">deployment "rancher" successfully rolled out</code>后，浏览到<a class="ae mb" href="https://rancher.localdev" rel="noopener ugc nofollow" target="_blank">https://rancher . localhost</a>。如果你看到这个屏幕，你不能手动接受风险，你可能不得不使用<a class="ae mb" href="https://dev.to/brettimus/this-is-unsafe-and-a-bad-idea-5ej4" rel="noopener ugc nofollow" target="_blank"><em class="kh">this is unsafe</em></a>chrome诡计。你可以通过点击红色的警告三角形并键入“thisisunsafe”(相信我！)</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/ac7de52022bc37b6938aa9479c6201d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXK2jMKtxJDNbEgdNtOrMQ.png"/></div></div></figure><p id="5e00" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">以管理员身份登录，使用安装Rancher时使用的引导密码，在本例中是<code class="fe nr ns nt nu b">admin | congratsthanandayme</code></p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/f3aa299b7fcb71fff0f55265534ca834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4S5Fa8uG5I5xAn4OnYOPZw.png"/></div></div></figure><p id="8fef" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">接受主机名并开始！</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/1b736050ab79304e1e7bec1211c0904e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uBIyf1lymU9Sx-VW_uYv8A.png"/></div></div></figure><p id="7ecb" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">这是欢迎页面</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/c25d1e70da1cb0337ed7be8a0b75d3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQlj8_W5DwfgRvqEsKEIPw.png"/></div></div></figure><p id="6378" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">点击左上角的汉堡包，调出集群并选择<code class="fe nr ns nt nu b">local</code>集群</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj om"><img src="../Images/39d2e9943160f11a2199a31a2b2586ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adha17wHAqyp8DbV7wRvAA.png"/></div></div></figure><p id="ab32" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">现在您可以看到在这个“空的”Kubernetes集群上运行的所有资源、节点和部署的摘要屏幕。您还可以看到使用的pod、核心和内存的数量。这种资源可观察性是使用Kubernetes的一个巨大优势，我再也不想回到bash了。</p><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/03ac48e0008e179455dc17ab95486f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPwZB9Hsrdkx2t7cTP0IbQ.png"/></div></div></figure><p id="0c70" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">单击左上角的Kubectl Shell按钮，您将在浏览器中打开一个终端<em class="kh">，与您的集群和资源进行交互。在下面的例子中，我列出了所有的公共资源和入口。</em></p><figure class="nn no np nq gu jv gi gj paragraph-image"><div class="gi gj on"><img src="../Images/3a4609a6d1724689e95bde2c106c2a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*K4E85v3sYvvwSpVIlc8j8Q.png"/></div></figure><figure class="nn no np nq gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/6f713e276889cbdc00665b0fd7de8637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NgqhOM48astxMbSrq_mm1Q.png"/></div></div></figure><p id="b596" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">Rancher Cluster Manager 2.6中有许多很棒的新特性，我将很快发布另一篇关于如何部署和公开简单工作负载的文章。</p><p id="7389" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">感谢<a class="ae mb" href="https://medium.com/u/ce902113ac3a?source=post_page-----7404f288342f--------------------------------" rel="noopener"> Brandon Gulla </a>向我介绍k3d，感谢<a class="ae mb" href="https://medium.com/u/f4cb33e4a07f?source=post_page-----7404f288342f--------------------------------" rel="noopener"> Thorsten K </a>提供k3d演示，这将继续激励我，并希望有更多其他开发者！！</p><p id="fe9b" class="pw-post-body-paragraph kf kg iu ki b kj kk kl km kn ko kp kq le ks kt ku lf kw kx ky lg la lb lc ld in bi translated">下面是安装牧场主脚本的要点(这里是asci NEMA:<a class="ae mb" href="https://asciinema.org/a/uao5iovk75B0Iggw6kPurAmCo" rel="noopener ugc nofollow" target="_blank">https://asciinema.org/a/uao5iovk75B0Iggw6kPurAmCo</a>)</p><figure class="nn no np nq gu jv"><div class="bz fq l di"><div class="oo op l"/></div></figure></div></div>    
</body>
</html>