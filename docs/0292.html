<html>
<head>
<title>Devise and SAML Authentication with Ruby On Rails (Line Works)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Ruby On Rails设计和SAML认证(Line Works)</h1>
<blockquote>原文：<a href="https://itnext.io/devise-and-saml-authentication-with-ruby-on-rails-line-works-e04b5174be1d?source=collection_archive---------1-----------------------#2018-02-10">https://itnext.io/devise-and-saml-authentication-with-ruby-on-rails-line-works-e04b5174be1d?source=collection_archive---------1-----------------------#2018-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7fb3" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">认证和授权(生产线工程)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a7b4da46e068773016967b841a03e69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MD7ON6MwDHgHK3WiIGXnaQ.jpeg"/></div></div></figure><h1 id="b713" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">什么是SAML？</strong></h1><p id="9186" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">安全声明标记语言(SAML)是一个基于XML的框架，用于在两个实体(服务提供商和身份提供商)之间进行身份验证和授权。服务提供商同意信任身份提供商来认证用户。作为回报，身份提供者生成一个身份验证声明，表明用户已经过身份验证。</p><p id="5955" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">SAML是一种标准的单点登录(SSO)格式。认证信息通过数字签名的XML文档进行交换。这是一个复杂的单点登录(SSO)实现，支持无缝认证，主要是在企业和企业之间。<br/>有了SAML，你不必担心输入认证凭证或者记住并重置密码。</p><h1 id="dc03" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">SAML认证有什么好处？</strong></h1><p id="83fc" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">SAML身份验证有以下好处:</p><blockquote class="mk ml mm"><p id="0d56" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><strong class="ll ir"> <em class="iq">标准化:</em> </strong> <em class="iq"> SAML是一种标准格式，允许系统之间的无缝互操作，独立于实现。它消除了与供应商和平台特定的架构和实现相关的常见问题。</em></p><p id="4ae0" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><strong class="ll ir"> <em class="iq">改善用户体验:</em> </strong> <em class="iq">用户只需登录一次即可访问多个服务提供商，无需额外的身份验证，从而在每个服务提供商处获得更快、更好的体验。这消除了密码问题，如重置和恢复。</em></p><p id="fa96" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><strong class="ll ir"> <em class="iq">增加安全性:</em> </strong> <em class="iq">安全性是软件开发的一个关键方面，对于企业应用来说，更是极其重要。SAML提供单点身份验证，这发生在安全的身份提供者处。然后，SAML将身份传递给服务提供商。这种形式的身份验证确保凭证不会离开防火墙边界。</em></p><p id="b02b" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><strong class="ll ir"> <em class="iq">目录的松耦合:</em> </strong> <em class="iq"> SAML不需要维护用户信息，也不需要目录间的同步。</em></p><p id="d017" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><strong class="ll ir"> <em class="iq">降低服务提供商的成本:</em> </strong> <em class="iq">使用SAML，您不必跨多个服务维护帐户信息。身份提供者承担这一负担。</em></p></blockquote><h1 id="1acd" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">为什么组织使用SAML？</strong></h1><p id="ec7d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">随着各种组织将其基础设施、服务和数据迁移到云中，SAML提供了一种安全的方法，用于在不断扩大的平台、数字接触点和设备范围内对用户进行身份验证和授权。SAML通过使消费者更容易访问Web应用程序，实现了更健壮的连接系统。</p><p id="4894" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">SAML通过启用基于令牌的身份验证交换消除了对多个Web应用程序密码的需求，这种身份验证交换发生在IdP防火墙内部的IdP(持有用户凭据)和SP(服务提供商)之间。在“SP启动的”SAML事务中，当用户请求访问某个应用程序时，SP会自动将他们重定向到IdP，在IdP中对用户进行身份验证，而不会将个人信息传递给SP的系统。</p><p id="b186" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">SAML通过启用单点登录(SSO)功能解决了一个关键挑战:允许用户注册或登录，并在一段时间内使用一组凭据获得跨多个属性的授权。SAML还支持单点注销功能，确保当用户从一个站点注销时，他们会自动从该公司拥有的所有其他服务提供商处注销。</p><h1 id="fa7f" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">【SAML认证是如何工作的？</h1><p id="757a" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">SAML SSO的工作方式是将用户的身份从一个地方(身份提供者)转移到另一个地方(服务提供者)。这是通过交换数字签名的XML文档来完成的。</p><p id="d548" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">假设:一个用户登录到一个充当身份提供者的系统。用户希望登录到一个远程应用程序，如智能流应用程序(服务提供商)。会发生以下情况:</p><blockquote class="mk ml mm"><p id="20e6" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -用户访问智能流程应用(</em><a class="ae mr" href="https://smartflow.vebuin.com/" rel="noopener ugc nofollow" target="_blank"><em class="iq">【https://smartflow.vebuin.com】</em></a><em class="iq">)。</em></p><p id="e3be" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -应用程序识别用户的来源(通过应用程序子域、用户IP地址或类似信息)，并将用户重定向回身份提供商，要求进行身份验证。这是认证请求。</em></p><p id="6854" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -用户与身份提供者之间存在活动的浏览器会话，或者通过登录身份提供者建立一个会话。</em></p><p id="0b09" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -身份提供者以包含用户用户名或电子邮件地址的XML文档的形式构建认证响应。</em></p><p id="7746" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -已经知道身份提供者并具有证书指纹的服务提供者检索认证响应，并使用证书指纹对其进行验证。</em></p><p id="9297" class="lj lk mn ll b lm mf jr lo lp mg ju lr mo mh lu lv mp mi ly lz mq mj mc md me ij bi translated"><em class="iq"> -建立用户的身份，并向用户提供应用程序访问。</em></p></blockquote><h1 id="16f9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak"> SAML单点登录流程</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/ba056863142440e646e69ccc585399dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VjHzaDNcD_lfTpSq.gif"/></div></div></figure><h1 id="9891" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak"> SAML vs OAuth </strong></h1><p id="82f3" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">OAuth是比SAML更新的标准，由Google和Twitter于2006年联合开发。开发它的部分原因是为了弥补SAML在移动平台上的不足，它基于JSON而不是XML。</p><p id="98e7" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">除了SAML不太出色的移动支持，两者有什么区别？正如我们所见，SAML标准定义了提供者如何提供认证和授权服务。另一方面，OAuth只处理授权。</p><h1 id="c03e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">你需要什么？</strong></h1><p id="8294" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">要在Rails应用程序中启用SAML功能，您需要一个身份提供者。目前我有Line works和okta。这是线条作品的例子。如果你没有Line Works帐户，那么你也可以在Okta使用。</p><div class="mt mu gp gr mv mw"><a href="https://www.okta.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd ir gy z fp nb fr fs nc fu fw ip bi translated">Okta |永远在线</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">看起来你关闭了Javascript！请启用它以改善您的浏览体验。对…的深入研究</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">www.okta.com</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk kp mw"/></div></div></a></div><p id="d817" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">http://blog.cloud66.com/adding-sso-to-your-rails-application-with-saml/</code></p><p id="1f52" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我假设你熟悉设计宝石，也在你的应用程序实现。如果你还没有实现，那么请通过下面的链接。</p><p id="602b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">https://qiita.com/alokrawat050/items/5267e6ab0e274ad1188a</code></p><p id="0fea" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">https://medium.com/@alokrawat050/devise-gem-tutorial-authenticate-a-user-by-user-id-and-email-ruby-on-rails-e25ae60ca437</code></p><h1 id="cb67" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated"><strong class="ak">让我们开始SAML配置</strong></h1><p id="af36" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">首先，我们将使用SAML设计作品。</p><p id="342e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 1。</strong>将设计相同的认证宝石添加到您的gem文件中</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="2420" class="nt ks iq no b gy nu nv l nw nx">gem 'devise_saml_authenticatable'</span></pre><p id="e94e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">refer https://github.com/apokalipto/devise_saml_authenticatable</code></p><p id="9f30" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 2。</strong>添加:saml_authenticatable到您的用户模型user.rb(此处模型名为user.rb):</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="596a" class="nt ks iq no b gy nu nv l nw nx">class User &lt; ApplicationRecord<br/>  devise :saml_authenticatable, :database_authenticatable, :registerable,<br/>         :recoverable, :rememberable, :trackable, :validatable, :authentication_keys =&gt; [:login]<br/><br/>  attr_accessor :login<br/><br/>  def login=(login)<br/>    @login = login<br/>  end<br/><br/>  def login<br/>    @login || self.user_id || self.email<br/>  end<br/><br/>  def self.find_for_database_authentication(warden_conditions)<br/>    conditions = warden_conditions.dup<br/>    if login = conditions.delete(:login)<br/>      where(conditions.to_h).where(["user_id = :value OR email = :value", { :value =&gt; login.downcase }]).first<br/>    else<br/>      where(conditions.to_h).first<br/>    end<br/>  end<br/><br/>  def send_devise_notification(notification, *args)<br/>    devise_mailer.send(notification, self, *args).deliver_later<br/>  end<br/>end</span></pre><p id="f46d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这里我用的是attr_accessor :login，为什么？<br/>因为用户可以通过用户名和电子邮件登录。但是如果你不需要，请忽略。您不需要在应用程序中设置。</p><p id="440a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 3。</strong>将以下内容添加到您的config/initializer/device . Rb文件中:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="74c8" class="nt ks iq no b gy nu nv l nw nx">Devise.setup do |config|<br/>……<br/>……<br/><br/>Devise.setup do |config|  <br/>      config.saml_create_user = false<br/>      config.saml_update_user = true<br/>      config.saml_default_user_key = :email<br/>      config.saml_session_index_key = :session_index<br/>      config.saml_use_subject = true<br/>      config.idp_settings_adapter = nil<br/>      config.saml_configure do |settings|<br/>        settings.assertion_consumer_service_url     = "&lt;your url&gt;/users/saml/auth"<br/>      settings.protocol_binding = "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"<br/>      settings.name_identifier_format             = "urn:oasis:names:tc:SAML:2.0:nameid-format:transient"<br/>      settings.issuer                             = "&lt;your url&gt;/users/saml/metadata"<br/>      settings.authn_context                      = "urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"<br/>      settings.idp_slo_target_url                 = ""<br/><br/>      #line configuration<br/>      settings.idp_sso_target_url                 = "&lt;your SSO auth url&gt;"<br/>      settings.idp_cert_fingerprint               = '&lt;your fingerprint of the certificate&gt;'<br/>      settings.idp_cert_fingerprint_algorithm     = 'http://www.w3.org/2000/09/xmldsig#sha256'<br/>      end<br/>    end<br/>end</span></pre><p id="5e34" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在这里，您需要更改以下设置:</p><p id="d533" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">&lt;your url&gt;: http://localhost:3000</code>#对于开发来说是一个本地主机，但是你可以根据你的开发环境来设置</p><p id="0c71" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">&lt;your SSO auth url&gt;</code>:#检查第4.2步</p><p id="8447" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">&lt;your fingerprint of the certificate&gt;</code>如何生成指纹，查看第8步。</p><p id="375f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在你的<strong class="ll ir"> routes.rb </strong>文件中，</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="9f71" class="nt ks iq no b gy nu nv l nw nx">Rails.application.routes.draw do<br/>  root 'home#index'  <br/>  devise_for :users, skip: :saml_authenticatable, controllers: {<br/>    registrations: "user/registrations",<br/>    sessions: "user/sessions",<br/>    passwords: "user/passwords"<br/>  }<br/><br/>  # opt-in saml_authenticatable<br/>  devise_scope :user do<br/>    scope "users", controller: 'saml_sessions' do<br/>      get :new, path: "saml/sign_in", as: :new_user_sso_session<br/>      post :create, path: "saml/auth", as: :user_sso_session<br/>      get :destroy, path: "sign_out", as: :destroy_user_sso_session<br/>      get :metadata, path: "saml/metadata", as: :metadata_user_sso_session<br/>      match :idp_sign_out, path: "saml/idp_sign_out", via: [:get, :post]<br/>    end<br/>  end<br/>end</span></pre><p id="cf6d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 4。</strong>你应该在Line Works有个账户。点击开发者控制台上的<br/><a class="ae mr" href="https://developers.worksmobile.com/" rel="noopener ugc nofollow" target="_blank">https://developers.worksmobile.com/</a><br/>。下面是设置指南。</p><p id="a59f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 4.1。</strong>在Line Works开发者控制台成功登录后，进入Apps/SAML Apps。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ny"><img src="../Images/4ae6691759546bb29084d9cae93705d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I4fWDhyeB7TarIuT.png"/></div></div></figure><p id="bfcf" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 4.2。</strong>现在创建您的应用程序，点击“添加”按钮，设置以下字段，然后点击“下一步”按钮。</p><p id="f74c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">在申请信息部分，</strong></p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="48c4" class="nt ks iq no b gy nu nv l nw nx">・Application Name: <br/>・Description:</span></pre><p id="d90c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">在服务提供商信息部分，</strong></p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="89ae" class="nt ks iq no b gy nu nv l nw nx">・ACS URL: http://localhost:3000/users/saml/auth<br/>・SP issuer(Entity Id): http://localhost:3000/users/saml/metadata</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/c272b50de31e3f790e3a6eb45821d6cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/0*Gplgz3WO0SfoRYzd.png"/></div></figure><p id="2aad" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 4.3。现在激活您的应用程序。点击调整按钮，然后选择激活。</strong></p><ul class=""><li id="8ca1" class="oa ob iq ll b lm mf lp mg ls oc lw od ma oe me of og oh oi bi">1</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/6e834785f5604aa4dfda8a87887b95cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l8TNvNNBzokPJ0En.png"/></div></div></figure><ul class=""><li id="3460" class="oa ob iq ll b lm mf lp mg ls oc lw od ma oe me of og oh oi bi">2</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/06eeaef328617751e0b23fac00a28480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kHZRRgkKQqzmlkdD.png"/></div></div></figure><ul class=""><li id="5d50" class="oa ob iq ll b lm mf lp mg ls oc lw od ma oe me of og oh oi bi">3</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/6b54d0ce6b6eba6fcb09ea2518e6b9ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OLx_gT-_pcvlJEhJ.png"/></div></div></figure><p id="e72d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 5。</strong>如果你在ex，<a class="ae mr" href="http://localhost/:3000(here" rel="noopener ugc nofollow" target="_blank">的开发环境下运行你的app，http://localhost:3000(这里</a>我用3000作为默认的Rails端口，根据你的设置进行调整)。<br/>对于生产，请确保您使用https，并在您的应用程序和服务器上设置它。</p><p id="434b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 6。</strong>复制您的SSO URL(身份提供者单点登录URL)并将其值作为_<strong class="ll ir">IDP _ SSO _ target _ URL</strong>_粘贴到<strong class="ll ir">device . Rb</strong>中。</p><p id="97a2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 7。</strong>现在点击下载证书按钮，保存证书文件。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/56b94088be4952151251079e10392726.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/0*BqHzodn0oF06MUk3.png"/></div></figure><p id="bacf" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 8。</strong>运行以下命令获取证书的指纹:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="3b41" class="nt ks iq no b gy nu nv l nw nx">openssl x509 -text -noout -in ~/Downloads/&lt;your file name&gt; -fingerprint -sha256</span></pre><p id="2ab0" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">This assumes that you saved the certificate in ~/Downloads/&lt;your file name&gt;</code>复制输出的最后一行，</p><p id="ffcd" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">SHA256指纹=。复制该值并粘贴到devise.rb文件的idp_cert_fingerprint中。</p><p id="ea0d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">看起来是这样的:</p><p id="366c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><code class="fe nl nm nn no b">59:10:LO:D0:9L:31:PO:AM:59:10:LO:D0:9L:31:PO:AM:59:10:LO:D0:9L:31:PO:AM:59:10:LO:D0:9L:31:PO:AM</code></p><p id="5c51" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 9。</strong>在您的apps配置目录中，创建一个名为attribute-map.yml的文件，并将以下内容放入其中:</p><pre class="kg kh ki kj gt np no nq nr aw ns bi"><span id="d3e4" class="nt ks iq no b gy nu nv l nw nx">"urn:mace:dir:attribute-def:uid": “login”<br/>"urn:mace:dir:attribute-def:email": "email"</span></pre><p id="f929" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这告诉Devise SAML从Id Provider返回的属性映射到用户模型的哪个属性。</p><p id="4b51" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir"> 10 </strong>。现在你已经准备好测试，使用<strong class="ll ir">/用户/saml/sign_in </strong>，这将重定向到Line Works登录页面，然后在认证后返回到你的应用程序。</p><p id="6a0a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">就是这样！👏👏👏👏</p><p id="7b6a" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">感谢您抽出宝贵的时间阅读。</p><p id="35f5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">享受编码。</p><p id="7d4e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">谢谢&amp;最诚挚的问候<br/> Alok Rawat </strong></p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="1e51" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><em class="mn">原载于</em><a class="ae mr" href="https://qiita.com/alokrawat050/items/98a40c414d06a6e679ca" rel="noopener ugc nofollow" target="_blank"><em class="mn">qiita.com</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>