# TypeScript 列表理解简介

> 原文：<https://itnext.io/introducing-list-comprehension-for-typescript-6204d9b1003e?source=collection_archive---------0----------------------->

![](img/aae9ee68fa1f0728b4e9bf616e9858b0.png)

由[克里斯·利维拉尼](https://unsplash.com/@chrisliverani?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)在 [Unsplash](https://unsplash.com/s/photos/math-notation?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄

列表理解是数学中的一种方法，以一种非常简洁优雅的方式描述一组值。这种符号已经被许多语言实现，主要用于在一个表达式中构造和填充一个列表，而不是用大量的循环和 if 语句填充一个空列表。由于它与数学和基于表达式的自然列表理解的联系，它在函数式编程中工作得非常好。

Haskell 中列表理解的一个例子

因此，像 Haskell 和 F#这样的语言提供了这种技术的丰富而完整的实现就不足为奇了，而且像 Python 和 R 这样受数据科学家欢迎的语言也提供了列表理解这一语言特性。这是因为它在编程数学公式时非常好用，例如基于矩阵或集合的数学公式。

# 什么是列表理解？

关于编程语言已经谈得够多了，什么是列表理解，它是如何工作的？List comprehension 允许您用一个由三部分组成的表达式创建集合:输出表达式、输入集和过滤输入集的谓词。

Python 中列表理解的一个例子

这里的`var * 2`是在列表中创建值的表达式。该表达式将用于输入列表中的每一项。但是这个列表会被 if: `var % 2 == 0`后面的表达式过滤掉。对于小列表，这可能看起来像一些语法糖，但是对于大的多维集合，这种符号将成为真正的救命稻草！列表理解不仅仅适用于列表，它还可以用于从键值对快速创建映射。

但这并不是一切。随着花式集合语法也来了一个丰富的标准库，从范围，重复序列，字符，字符串，合并集合等创建集合。这两者的结合使得列表理解成为现代(函数式)编程语言中的一个强大工具。

在 Haskell 中创建填充列表的一些方法

在本文中，我将带您浏览我为 TypeScript 创建的列表理解库。它允许您使用常规的 TypeScript 代码，同时仍然享受列表理解的所有优点。我将主要关注 api 在使用多个输入集创建多维集合时如何保证类型安全。结果将如下所示:

# 设计界面

我们将从设置`array`函数的类型开始，该函数将执行实际的列表理解。为此，我将使用一个所谓的可调用接口，因为它们允许我们使用类型系统提供的所有功能相关的特性。对于列表理解表达式，我们需要三样东西:输入集、创建条目的函数和过滤输入条目的谓词。

我改变了标准顺序，因为如果我们提供输入集合，那么第一个 TypeScript 可以使用它来推断`out`函数的参数的泛型类型`i`，它可以推断泛型`o`。有了这个小小的改变，我们可以更容易地使用这个库，因为你不必显式地提供泛型类型参数。对于谓词，我使用了一个 rest 参数，因此我们可以定义任意数量的谓词(或者一个也不定义)。

# 使用多个输入源

当用于多输入时，列表理解变得非常强大。如果我们想在我们的库中允许多个输入，我们必须在外部 API 的定义上有点创造性。我将使用我们的`array`函数的重载来创建两个或更多输入的理解定义。在本文中，我将把所有的代码样本限制在三个输入，以保持它的简短，但是库达到了十个。

我们函数的额外重载

有了这些重载，你可以从给函数你想要的所有数据源开始，然后它就会知道`out`和`predicate`函数将要得到多少个参数。虽然这在类型推断方面很有意思，但是编写一个实现这个接口的函数有点麻烦。记住，TypeScript 中的重载只存在于编译时！在运行时，我们只有一个实现需要执行运行时类型检查，以确定我们当前的重载。

为了实现这一点，我决定将所有的参数作为一个非类型化的数组。在这个数组中，我们可以搜索函数的第一个索引。我们知道这是`out`函数。基于这些信息，我们可以将`args`数组分成一个带有输入的数组、`out`函数和一个带有谓词的数组。这有点麻烦，但仍然完全节省，因为我们的接口保证了我们所做的最正确的假设。

图像必须弄清楚这个函数期望什么作为没有类型的参数…

但是我们如何将输入源组合成`out`函数的参数集呢？有两种方法可以做到这一点:压缩输入或执行交叉连接。如果我们压缩输入，我们会将所有输入的第一项组合在一起，将所有数组的第二项组合在一起，依此类推。如果我们交叉连接，我们将第一个数组的所有元素与第二个数组的所有元素组合在一起，第一个数组的第二项与第二个数组的所有元素组合在一起，依此类推。所以交叉连接产生的线对比拉链多得多。

zip 与以[ 1，2，3 ]和[ 4，5，6 ]作为输入的交叉连接

我决定使用交叉连接技术，因为它是列表理解中最常用的技术。与命令式编程相比，它的工作原理与嵌套 for 循环相同。如果您想使用 zip 技术，您可以使用库中的 zip 函数首先压缩输入，并将结果作为单个输入提供。

用于从数组的数组中创建交叉连接的代码，该代码遵循输入的顺序

# 不仅仅是数组

在这篇文章的开始，我已经提到了列表理解不仅仅局限于列表。在图书馆里也有集合和地图理解，以便于地图和集合的构建。映射理解与数组和集合理解有些不同，因为您的 out 函数必须返回将用于构造映射的键值对。这意味着重复的键会互相覆盖。

# 创建正确的输入

列表理解的可用性非常依赖于语言在创建所需输入集合时的灵活性。大多数内置了列表理解功能的语言还提供了生成范围、重复序列和其他可能的列表定义的详尽功能。

这些特性是图书馆提供的第二个东西。有许多函数可以创建可使用的填充数组。前两个是众所周知的范围和重复:

当谈到交叉连接和压缩之间的区别时，我保证有一个压缩函数，所以它在这里。这也是一个函数，它使用重载来确保元组的类型正确，并且 TypeScript 知道哪个索引具有哪个类型，而不是合并类型并使其成为单一类型的数组:

最后一个是字符范围。此函数使用带有字母表的映射，根据字符在字母表中的顺序创建字符范围:

有了这些函数和正确的谓词，您可以充分利用列表理解在 TypeScript 中创建数组、映射和集合。

# 实际例子

最后，我会用两个实际的例子来告诉你如何在实践中运用列表理解。我将展示一个使用交叉连接技术的例子和一个使用 zip 技术的例子。两个例子都表明理解代码尊重输入的顺序是很重要的。

比方说，我们想将一个标题列表按其开头字母分组，并按字母表中的位置排序。这可以用在一个[概览页面上，以一种清晰的方式显示一个大的链接列表](https://www.diakonessenhuis.nl/aandoeningen)。

创建坐标矩阵是何时使用嵌套 for 循环的经典例子。但是通过 list comprehension，可以使用 range 和 zip 函数以一种完全实用的方式来实现这一点:

# 结论

在本文中，我们探讨了什么是列表理解，以及如何在 TypeScript 中实现它。完整库的源代码可以在 [Github](https://github.com/WimJongeneel/ts-comprehension) 上找到，并在 [npm](https://www.npmjs.com/package/ts-list-comprehension) 上发布。你认为 list comprehension 给 TypeScript 增加了一些新东西吗？或者你完全满意基于`Array.from({ length: N }).map(x => ...)`的一切吗？