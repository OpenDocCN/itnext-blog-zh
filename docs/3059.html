<html>
<head>
<title>SpringBoot, Liquibase and MariaDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SpringBoot，Liquibase和MariaDB</h1>
<blockquote>原文：<a href="https://itnext.io/springboot-liquibase-and-mariadb-b3f943c29370?source=collection_archive---------3-----------------------#2019-09-24">https://itnext.io/springboot-liquibase-and-mariadb-b3f943c29370?source=collection_archive---------3-----------------------#2019-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="78a0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用SpringBoot中的Liquibase管理MariaDB数据库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0f25928fe2920d4a2ecf4c9df4c20c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pgz-bDuK6ipygap4"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="caaa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个故事中，我们将在Liquibase的帮助下开发一个管理MariaDB实例的SpringBoot应用程序。</p><p id="772e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设下面的简单用例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/a1e6d170dfb1da42ee018a3c6c262089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*P69RM2vFNuHlAafP9driwA.png"/></div></figure><p id="f315" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们想要建模两个实体:<em class="lt">学生</em>和<em class="lt">考试</em>。每个学生可以参加一个或多个有相应分数的考试。</p><p id="516b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">请注意，显然，这个ER图只是一个用于快速深入实践的简单模型。</em></p><h2 id="7b6e" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">概观</h2><blockquote class="mn mo mp"><p id="31ec" class="kw kx lt ky b kz la jr lb lc ld ju le mq lg lh li mr lk ll lm ms lo lp lq lr ij bi translated">Liquibase提供了一种独立于数据库的方式，在<a class="ae kv" href="https://www.liquibase.org/" rel="noopener ugc nofollow" target="_blank">liquibase.org</a>实现快速、安全和可重复的数据库部署</p></blockquote><p id="7fd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据库更改存储在XML、YAML、JSON或SQL文件中，这些文件由id和作者标签以及文件本身的名称组合来标识。</p><p id="8e27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了我们的表之外，Liquibase还会在您第一次执行ChangeLog文件时自动创建<em class="lt"> DatabaseChangeLog </em>和<em class="lt"> DatabaseChangeLogLock </em>表。</p><p id="af44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">毫无疑问，Liquibase依赖于一个简单的机制</p><ol class=""><li id="ea1f" class="mt mu iq ky b kz la lc ld lf mv lj mw ln mx lr my mz na nb bi translated">它使用changelog以特定的顺序明确列出数据库更改。变更日志中的每个变更都是一个<em class="lt">变更集</em>。</li><li id="a725" class="mt mu iq ky b kz nc lc nd lf ne lj nf ln ng lr my mz na nb bi translated">它使用一个跟踪表(上面的<em class="lt"> DatabaseChangeLog </em>),该表驻留在每个数据库中，并且跟踪ChangeLog中的哪些变更集已经被部署。</li></ol><p id="a902" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，使用这种分类帐，Liquibase能够跟踪数据库变更并对其进行版本控制，此外，它还能够部署特定的变更，将分类帐中的内容与跟踪表中的内容进行比较。</p><h2 id="7a3f" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">SpringBoot快速入门</h2><p id="f7ad" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">让我们更深入地看看如何用Liquibase实现SpringBoot应用程序。</p><p id="d3d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开命令行终端，导航到您喜欢的路径并创建maven项目。下面的命令创建了一个干净的maven项目。</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="8356" class="lu lv iq nn b gy nr ns l nt nu">mvn archetype:generate <br/>-DgroupId=com.pck.app -DartifactId=app <br/>-DarchetypeArtifactId=maven-archetype-quickstart -DarchetypeVersion=1.4 -DinteractiveMode=false</span></pre><p id="f2a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开<em class="lt"> pom.xml </em>文件并粘贴提供的源代码，以创建导入Jpa、MariaDB驱动程序和Liquibase的SpringBoot应用程序。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="594b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">主<em class="lt"> App.class </em>变成…</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="f74a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">…启用Jpa存储库。</p><p id="1d8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在要做什么？</p><p id="0ae2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们必须创建<em class="lt">资源</em>文件夹。内，<em class="lt"> application.properties </em>文件和一个名为<em class="lt"> changelog </em>的文件夹。在最后一个文件夹内，我们必须创建另一个名为<em class="lt"> changes </em>和<strong class="ky ir">master</strong>changelog<em class="lt">的文件。</em></p><p id="0a4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在下图中看到完整的层次结构。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/84a2a3fedf6d54a5d691ad0e62be6574.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*Z8PyUks-Da3y81wdWmcecQ.png"/></div></figure><p id="2cac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了对Liquibase提供的可能性有一个更广泛的了解，我们将使用两种类型的变更文件。第一个是XML，而最新的是SQL。</p><p id="bf22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，<strong class="ky ir"><em class="lt">db . changelog-master . YAML</em></strong>告诉Liquibase变更文件存储在哪里。在这种情况下，YAML文件将被</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="9006" class="lu lv iq nn b gy nr ns l nt nu">databaseChangeLog:<br/>  - includeAll:<br/>      path: db/changelog/changes/</span></pre><p id="3ec3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Liquibase将只执行存储在<em class="lt">–include all</em>选项下的路径中的文件。</p><p id="3813" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">快速浏览一下<em class="lt"> application.properties </em>文件</p><pre class="kg kh ki kj gt nm nn no np aw nq bi"><span id="c978" class="lu lv iq nn b gy nr ns l nt nu">server.port = 8080<br/><br/>spring.datasource.url = jdbc:mariadb://localhost:3306/liquibase?allowMultiQueries=true<br/>spring.datasource.username = root<br/>spring.datasource.password = admin<br/><br/>spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults = false<br/>spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MariaDB103Dialect<br/><br/>spring.jpa.hibernate.ddl-auto = none</span></pre><p id="e7dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意在MariaDB中，成功执行多个查询需要使用<em class="lt"> allowMultiQueries=true </em>选项。</p><p id="a84f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">注意你使用的方言。从10.3及更高版本开始，您应该使用也提供序列支持的<strong class="ky ir"><em class="lt">org . hibernate . dialect . mariadb 103 dialect</em></strong>。</p><p id="58de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们完成了对这些配置的管理，我们就可以深入了解变更文件的语法了。</p><p id="a26a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们从名为<em class="lt"> v_0.0.1.xml </em>的XML文件开始。这个文件用于创建我们数据库的基础结构。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="42c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，看看第二个名为<em class="lt"> v_0.0.2.sql </em>的文件，它用于创建序列和在表中插入值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8282" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，只需用MariaDB连接创建<em class="lt"> liquibase </em>数据库并运行SpringBoot应用程序。</p><p id="1a59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">终于，我们完成了！</p><p id="ff07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，下面是生成的数据库和表格</p><div class="kg kh ki kj gt ab cb"><figure class="ny kk nz oa ob oc od paragraph-image"><img src="../Images/9543ad0ad99250f1915d9424fe8d304c.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*SaeOokzW6mVCKfmb3r_evQ.png"/></figure><figure class="ny kk oe oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b7f45ae57889321eaeedad83d213dd50.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*77RzmJLgUGQUL3fOk-CwjA.png"/></div></figure><figure class="ny kk of oa ob oc od paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/f2d78ab5beec1639d44e908cd9a68cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*NuIvRA9Xm92Kg3cjSc_asw.png"/></div></figure></div><h2 id="c5e0" class="lu lv iq bd lw lx ly dn lz ma mb dp mc lf md me mf lj mg mh mi ln mj mk ml mm bi translated">结论</h2><p id="c4f1" class="pw-post-body-paragraph kw kx iq ky b kz nh jr lb lc ni ju le lf nj lh li lj nk ll lm ln nl lp lq lr ij bi translated">最后，在这个故事中，我们学习了如何使用XML和SQL更改文件配置SpringBoot应用程序，通过Liquibase管理MariaDB数据库。</p></div></div>    
</body>
</html>