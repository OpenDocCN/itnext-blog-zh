<html>
<head>
<title>Connection to Database when Using JPA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JPA时连接到数据库</h1>
<blockquote>原文：<a href="https://itnext.io/connection-to-database-when-using-jpa-50ab09b4016?source=collection_archive---------3-----------------------#2018-05-11">https://itnext.io/connection-to-database-when-using-jpa-50ab09b4016?source=collection_archive---------3-----------------------#2018-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2a58ecc5ad17e50c3b530b36f1d0caa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AiFbYPGYyqX7lsvRQtF9w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><em class="kc">照片由</em> <a class="ae kd" href="https://unsplash.com/photos/uGS_R4r46Cw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="kc">格瑞拉科齐</em> </a> <em class="kc">上</em> <a class="ae kd" href="https://unsplash.com/search/photos/connection?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> <em class="kc">下</em> </a></figcaption></figure><p id="ccde" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">撰写本文时，考虑将EclipseLink作为JPA提供者，将MySql作为数据库。</p><p id="d56d" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">实例化EntityManagerFactory时，javax . persistence . persistence<br/>createentitymanager factory(String persistence unitname)和重载方法<br/>createentitymanager factory(String persistence unitname，Map properties)提供了两个API</p><ol class=""><li id="6e59" class="lc ld iq kg b kh ki kl km kp le kt lf kx lg lb lh li lj lk bi translated">到物理数据库的连接属性可以在persistence.xml <br/>中提供，如下所示:</li></ol><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="3d86" class="lu lv iq lq b gy lw lx l ly lz">&lt;?xml version=”1.0" encoding=”UTF-8"?&gt;</span><span id="146b" class="lu lv iq lq b gy ma lx l ly lz">&lt;persistence version=”2.0" xmlns=”<a class="ae kd" href="http://java.sun.com/xml/ns/persistence" rel="noopener ugc nofollow" target="_blank">http://java.sun.com/xml/ns/persistence</a>"<br/> xmlns:xsi=”<a class="ae kd" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" <br/> xsi:schemaLocation=”<a class="ae kd" href="http://java.sun.com/xml/ns/persistence" rel="noopener ugc nofollow" target="_blank">http://java.sun.com/xml/ns/persistence</a> <br/> <a class="ae kd" href="http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd" rel="noopener ugc nofollow" target="_blank">http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd</a>"&gt;<br/> <br/> &lt;persistence-unit name=”Eclipselink_JPA” transaction-type=”RESOURCE_LOCAL”&gt;<br/> <br/> &lt;class&gt;com.nitesh.e2e.jpa.entity.TBook&lt;/class&gt;</span><span id="4a6a" class="lu lv iq lq b gy ma lx l ly lz">&lt;properties&gt;<br/> &lt;property name=”javax.persistence.jdbc.url” value=”jdbc:mysql://localhost:3306/jpadb”/&gt;<br/> &lt;property name=”javax.persistence.jdbc.user” value=”root”/&gt;<br/> &lt;property name=”javax.persistence.jdbc.password” value=”password”/&gt;<br/> &lt;property name=”javax.persistence.jdbc.driver” value=”com.mysql.jdbc.Driver”/&gt;<br/> &lt;property name=”eclipselink.logging.level” value=”FINE”/&gt;<br/> &lt;property name=”eclipselink.ddl-generation” value=”create-tables”/&gt;<br/> &lt;/properties&gt;<br/> <br/> &lt;/persistence-unit&gt;<br/>&lt;/persistence&gt;</span></pre><p id="83f5" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这里我们连接到运行在localhost:3306上的mysql数据库</p><p id="828b" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后，可以通过传递持久性单元名称来实例化EntityManagerFactory，如下所示:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="aefd" class="lu lv iq lq b gy lw lx l ly lz">Persistence.createEntityManagerFactory(“Eclipselink_JPA”)</span></pre><p id="536d" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">2.我们还可以在映射中提供与我们paas给重载的createEntityManagerFactory方法相同的细节。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="c0a8" class="lu lv iq lq b gy lw lx l ly lz">Map&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();<br/> props.put(“javax.persistence.jdbc.url” , “jdbc:mysql://localhost:3306/jpadb”);<br/> props.put(“javax.persistence.jdbc.user” , “root”);<br/> props.put(“javax.persistence.jdbc.password” , “password”);<br/> props.put(“javax.persistence.jdbc.driver” , “com.mysql.jdbc.Driver”);</span><span id="7fb9" class="lu lv iq lq b gy ma lx l ly lz">EntityManagerFactory emfactory = Persistence.createEntityManagerFactory(“Eclipselink_JPA”, props);<br/></span></pre><p id="1b43" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">3.另一种连接到物理数据库的方法是创建javax.sql.DataSource对象。<br/>T16】https://docs . Oracle . com/javase/7/docs/API/javax/SQL/data source . html</p><p id="23f3" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">通常这是<strong class="kg ir">连接数据库的首选</strong>方式，因为这可以从代码中具体化。</p><blockquote class="mb mc md"><p id="0157" class="ke kf me kg b kh ki kj kk kl km kn ko mf kq kr ks mg ku kv kw mh ky kz la lb ij bi translated"><em class="iq">数据源接口由驱动厂商实现。</em> <br/>根据文档，这是对DriverManager工具的替代，DataSource对象是获得连接的首选方式。实现数据源接口的对象通常会向基于Java命名和目录(JNDI) API的命名服务注册。在代码中，我们做了一个JNDI查找并得到了DataSource对象。</p></blockquote><p id="3785" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后，这个DataSource对象被添加到属性映射中，并用于创建EntityManagerFactory，如下所示:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="2439" class="lu lv iq lq b gy lw lx l ly lz">MysqlDataSource ds = new MysqlDataSource();<br/> ds.setURL(“jdbc:mysql://localhost:3306/jpadb”);<br/> ds.setUser(“root”);<br/> ds.setPassword(“password”);<br/> <br/> Map&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();<br/> props.put(“javax.persistence.nonJtaDataSource”, ds);</span><span id="7c5d" class="lu lv iq lq b gy ma lx l ly lz">EntityManagerFactory emfactory = Persistence.createEntityManagerFactory(“Eclipselink_JPA”, props);</span></pre><p id="9de8" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在上面的代码中，我们创建了MysqlDataSource对象，它扩展了javax.sql.DataSource对象。<br/> <em class="me">在现实场景中，当我们创建数据库模式并将其绑定到一个命名的数据源时，该数据源被绑定到JNDI注册表。在代码中，我们通过JNDI查找来访问这个数据源。</em></p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="ec32" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">感谢阅读:)</p></div></div>    
</body>
</html>