<html>
<head>
<title>Kubernetes pre-stable releases now available with MicroK8s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes预稳定版本现已随MicroK8s推出</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-pre-stable-releases-now-available-with-microk8s-363d05998eff?source=collection_archive---------6-----------------------#2019-05-15">https://itnext.io/kubernetes-pre-stable-releases-now-available-with-microk8s-363d05998eff?source=collection_archive---------6-----------------------#2019-05-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0e3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你用<code class="fe kl km kn ko b">snap info microk8s</code>查看MicroK8s的频道信息，你会看到所有可用的Kubernetes版本:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="6a45" class="kx ky iq ko b gy kz la l lb lc">channels:<br/>  stable:         v1.14.1         2019-04-18 (522) 214MB classic<br/>  candidate:      v1.14.1         2019-04-15 (522) 214MB classic<br/>  beta:           v1.14.1         2019-04-15 (522) 214MB classic<br/>  edge:           v1.14.1         2019-05-10 (587) 217MB classic<br/>  1.15/stable:    –                                      <br/>  1.15/candidate: –                                      <br/>  1.15/beta:      –                                      <br/>  1.15/edge:      v1.15.0-alpha.3 2019-05-08 (578) 215MB classic<br/>  1.14/stable:    v1.14.1         2019-04-18 (521) 214MB classic<br/>  1.14/candidate: v1.14.1         2019-04-15 (521) 214MB classic<br/>  1.14/beta:      v1.14.1         2019-04-15 (521) 214MB classic<br/>  1.14/edge:      v1.14.1         2019-05-11 (590) 217MB classic<br/>  1.13/stable:    v1.13.5         2019-04-22 (526) 237MB classic<br/>  1.13/candidate: v1.13.6         2019-05-09 (581) 237MB classic<br/>  1.13/beta:      v1.13.6         2019-05-09 (581) 237MB classic<br/>  1.13/edge:      v1.13.6         2019-05-08 (581) 237MB classic<br/>  1.12/stable:    v1.12.8         2019-05-02 (547) 259MB classic<br/>  1.12/candidate: v1.12.8         2019-05-01 (547) 259MB classic<br/>  1.12/beta:      v1.12.8         2019-05-01 (547) 259MB classic<br/>  1.12/edge:      v1.12.8         2019-04-24 (547) 259MB classic<br/>  1.11/stable:    v1.11.10        2019-05-10 (557) 258MB classic<br/>  1.11/candidate: v1.11.10        2019-05-02 (557) 258MB classic<br/>  1.11/beta:      v1.11.10        2019-05-02 (557) 258MB classic<br/>  1.11/edge:      v1.11.10        2019-05-01 (557) 258MB classic<br/>  1.10/stable:    v1.10.13        2019-04-22 (546) 222MB classic<br/>  1.10/candidate: v1.10.13        2019-04-22 (546) 222MB classic<br/>  1.10/beta:      v1.10.13        2019-04-22 (546) 222MB classic<br/>  1.10/edge:      v1.10.13        2019-04-22 (546) 222MB classic</span></pre><p id="e94d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想遵循1.14 Kubernetes版本，您应该:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="89ad" class="kx ky iq ko b gy kz la l lb lc">sudo snap install microk8s --classic --channel=1.14/stable</span></pre><p id="9669" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果您总是希望获得最新的稳定版本，您应该:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="071d" class="kx ky iq ko b gy kz la l lb lc">sudo snap install microk8s --classic</span></pre><p id="c8a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的频道列表中的新内容是1.15版本下的预稳定版本(在撰写本文时，最新的稳定版本是1.14)。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><figure class="kp kq kr ks gt ll gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/a8413ee8e42926dfb0162da0453e2e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*nBRC4nYULPIGWpnJjMpKOA.png"/></div></figure><h2 id="a9be" class="kx ky iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">在预稳定版本之后</h2><p id="d733" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">我们承诺按照以下计划发布带有预稳定版本的MicroK8s。</p><ul class=""><li id="192a" class="mk ml iq jp b jq jr ju jv jy mm kc mn kg mo kk mp mq mr ms bi translated">边缘通道(例如1.15/边缘)容纳alpha上游释放。</li><li id="0350" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">beta通道(例如1.15/beta)保存beta上游版本。</li><li id="9fae" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">候选通道(例如1.15/candidate)保存上游发布的发布候选。</li></ul><p id="bcd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预稳定版本将在上游发布的同一天可用。</p><p id="da2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想在alpha 1.15版本中测试您的工作，只需:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="5898" class="kx ky iq ko b gy kz la l lb lc">sudo snap install microk8s --classic --channel=1.15/edge</span></pre><p id="576b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，请注意，预稳定版本可能会在稳定版本之前发生变化。一旦稳定版本可用，一定要对其进行测试。</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="77a1" class="kx ky iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">具有稳定版本的跟踪</h2><p id="e470" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">曲目旨在服务于特定的Kubernetes版本。例如，1.15轨道及其四个通道(1.15/edge、1.15/beta、1.15/candidate、1.15/stable)服务于v1.15 K8s版本。一旦新的K8s稳定版本发布，相应音轨的所有通道都会更新。在我们的示例中，1.15版稳定版一发布，相应的轨道通道就会以下列方式更新:</p><ul class=""><li id="ca62" class="mk ml iq jp b jq jr ju jv jy mm kc mn kg mo kk mp mq mr ms bi translated">1.15/edge通道在与v1.15稳定K8s版本配对的<a class="ae my" href="https://github.com/ubuntu/microk8s" rel="noopener ugc nofollow" target="_blank"> MicroK8s储存库</a>上合并的每次提交时更新。</li><li id="3a44" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">1.15/beta和1.15/candidate通道会在每个上游补丁发布时更新。他们持有1.15/edge通道在补丁发布时拥有的任何内容。</li><li id="6548" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">在1.15/candidate中加入新版本一周后，1.15/stable频道会更新1.15/candidate的内容。</li></ul></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="5983" class="kx ky iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">我很困惑。哪个频道适合我？</h2><p id="ea49" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">您需要回答的一个问题是，在下面的渠道参数中输入什么:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="576a" class="kx ky iq ko b gy kz la l lb lc">sudo snap install microk8s --classic --channel=&lt;What_to_use_here?&gt;</span></pre><p id="d64d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是根据您的需求为渠道提供的一些建议:</p><ul class=""><li id="cabc" class="mk ml iq jp b jq jr ju jv jy mm kc mn kg mo kk mp mq mr ms bi translated">我想一直在最新的稳定Kubernetes上。<br/>使用<code class="fe kl km kn ko b">--channel=latest</code></li><li id="a97d" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">我想总是在一个特定的上游K8s版本的最新版本。<br/>使用<code class="fe kl km kn ko b">--channel=&lt;release&gt;/stable</code>例如<code class="fe kl km kn ko b">--channel=1.14/stable.</code></li><li id="1873" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">我想测试一个预稳定的版本。<br/>使用<code class="fe kl km kn ko b">--channel=&lt;next_release&gt;/edge</code>发布alpha版本<br/>使用<code class="fe kl km kn ko b">--channel=&lt;next_release&gt;/beta</code>发布beta版本<br/>使用<code class="fe kl km kn ko b">--channel=&lt;next_release&gt;/candidate</code>发布候选版本</li><li id="fb0c" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">我在等MicroK8s的一个bug修复:<br/>用<code class="fe kl km kn ko b">--channel=&lt;release&gt;/edge</code></li><li id="537a" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated">我正在等待上游Kubernetes的一个错误修复:<br/>使用<code class="fe kl km kn ko b">--channel=&lt;release&gt;/candidate</code></li></ul></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="e0c5" class="kx ky iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">用MicroK8s开发K8s核心服务</h2><p id="52bc" class="pw-post-body-paragraph jn jo iq jp b jq mf js jt ju mg jw jx jy mh ka kb kc mi ke kf kg mj ki kj kk ij bi translated">预稳定版本的目的之一是帮助K8s核心服务开发者完成他们的任务。让我们看看如何将kubelet的本地构建与MicroK8s部署挂钩。</p><p id="ec46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照Kubernetes的<a class="ae my" href="https://github.com/kubernetes/kubernetes/blob/master/README.md" rel="noopener ugc nofollow" target="_blank">构建说明</a>我们:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="d6c6" class="kx ky iq ko b gy kz la l lb lc">git clone <a class="ae my" href="https://github.com/kubernetes/kubernetes" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes/kubernetes</a><br/>cd kubernetes<br/>build/run.sh make kubelet</span></pre><p id="0249" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">kubelet二进制文件应该可以在以下位置获得:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="1b71" class="kx ky iq ko b gy kz la l lb lc">_output/dockerized/bin/linux/amd64/kubelet</span></pre><p id="e6de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看一个MicroK8s部署:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="dd7f" class="kx ky iq ko b gy kz la l lb lc">sudo snap install microk8s --classic --channel=1.15/edge</span></pre><p id="097c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了查看kubelet运行的参数，我们:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="62d0" class="kx ky iq ko b gy kz la l lb lc">&gt; ps -ef | grep kubelet<br/>root     24184     1  2 17:28 ?        00:00:54 /snap/microk8s/578/kubelet <br/>--kubeconfig=/snap/microk8s/578/configs/kubelet.config <br/>--cert-dir=/var/snap/microk8s/578/certs <br/>--client-ca-file=/var/snap/microk8s/578/certs/ca.crt <br/>--anonymous-auth=false <br/>--network-plugin=kubenet <br/>--root-dir=/var/snap/microk8s/common/var/lib/kubelet <br/>--fail-swap-on=false <br/>--pod-cidr=10.1.1.0/24 <br/>--non-masquerade-cidr=10.152.183.0/24 <br/>--cni-bin-dir=/snap/microk8s/578/opt/cni/bin/ <br/>--feature-gates=DevicePlugins=true <br/>--eviction-hard=memory.available&lt;100Mi,nodefs.available&lt;1Gi,imagefs.available&lt;1Gi <br/>--container-runtime=remote <br/>--container-runtime-endpoint=/var/snap/microk8s/common/run/containerd.sock <br/>--node-labels=microk8s.io/cluster=true</span></pre><p id="f21a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在需要停止MicroK8s附带的kubelet，开始我们自己的构建:</p><pre class="kp kq kr ks gt kt ko ku kv aw kw bi"><span id="f3d4" class="kx ky iq ko b gy kz la l lb lc">sudo systemctl stop snap.microk8s.daemon-kubelet.service</span><span id="6a77" class="kx ky iq ko b gy mz la l lb lc">sudo _output/dockerized/bin/linux/amd64/kubelet <br/>--kubeconfig=/snap/microk8s/578/configs/kubelet.config  <br/>--cert-dir=/var/snap/microk8s/578/certs <br/>--clit-ca-file=/var/snap/microk8s/578/certs/ca.crt   <br/>--anonymous-auth=false --network-plugin=kubenet  <br/>--root-dir=/var/snap/microk8s/common/var/lib/kubelet  <br/>--fail-swap-on=false --pod-cidr=10.1.1.0/24  <br/>--container-runtime=remote <br/>--container-runtime-endpoint=/var/snap/microk8s/common/run/containerd.sock <br/>--node-labels=microk8s.io/cluster=true  --eviction-hard='memory.available&lt;100Mi,nodefs.available&lt;1Gi,imagefs.available&lt;1Gi'</span></pre><p id="8f96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！你的kubelet现在代替了MicroK8s中的kube let！你必须承认这很简单。</p><p id="bf4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你应该知道的是，一些<code class="fe kl km kn ko b">microk8s</code>命令会通过systemd重启服务。例如，<code class="fe kl km kn ko b">microk8s.enable dns</code>将启动一个服务重启，包括MicroK8s附带的kubelet。</p><p id="8f0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编码快乐！</p></div><div class="ab cl ld le hu lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ij ik il im in"><h2 id="8cd0" class="kx ky iq bd lo lp lq dn lr ls lt dp lu jy lv lw lx kc ly lz ma kg mb mc md me bi translated">进一步阅读</h2><ul class=""><li id="b357" class="mk ml iq jp b jq mf ju mg jy na kc nb kg nc kk mp mq mr ms bi translated"><a class="ae my" href="https://github.com/kubernetes/kubernetes" rel="noopener ugc nofollow" target="_blank"> Kubernetes回购</a></li><li id="872a" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><a class="ae my" href="https://github.com/ubuntu/microk8s" rel="noopener ugc nofollow" target="_blank"> MicroK8s回购</a></li><li id="026a" class="mk ml iq jp b jq mt ju mu jy mv kc mw kg mx kk mp mq mr ms bi translated"><a class="ae my" href="https://docs.snapcraft.io/channels" rel="noopener ugc nofollow" target="_blank">捕捉通道</a></li></ul></div></div>    
</body>
</html>