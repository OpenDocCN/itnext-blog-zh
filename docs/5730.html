<html>
<head>
<title>Let’s Write a Brainfuck Compiler (in JavaScript)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们写一个Brainfuck编译器(用JavaScript)</h1>
<blockquote>原文：<a href="https://itnext.io/lets-write-a-brainfuck-compiler-aaa7cfd449b0?source=collection_archive---------0-----------------------#2021-05-12">https://itnext.io/lets-write-a-brainfuck-compiler-aaa7cfd449b0?source=collection_archive---------0-----------------------#2021-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="788a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为只有八个命令的编程语言编写一个编译器。会很有趣的，我保证！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/3a85eb3de64931b9d05526bbf2d3c6f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOP5Jly-lGO-ZvAA11YZGw.jpeg"/></div></div></figure><p id="6ede" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先:什么是“脑残”？！嗯，Brainfuck是一种深奥的编程语言，仅由8个命令组成:<code class="fe la lb lc ld b">&gt; &lt; + - . , [ ]</code>。</p><p id="3795" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">等等，一门编程语言怎么可能只有八个字符？嗯，计算机只使用了<code class="fe la lb lc ld b">0</code>和<code class="fe la lb lc ld b">1</code>，所以我们还有另外6个字符可以使用！</p><p id="beeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Brainfuck是一种图灵完全编程语言，所以你真的可以用它做大量的事情！但是它是如何工作的呢？</p><p id="438c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Brainfuck对一组存储单元进行操作，其中每个单元从零开始。你可以把它想象成一盘干净的无限大的磁带。第一个单元格上有一个指针，它只能执行八个特定的命令:</p><ul class=""><li id="8d58" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">&gt;</strong></code>将指针移动到下一个单元格。</li><li id="4838" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">&lt;</strong></code> <strong class="js iu"> </strong>将指针移动到上一个单元格。</li><li id="e65d" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">+</strong></code> <strong class="js iu"> </strong>递增当前存储单元。</li><li id="11d9" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">-</strong></code> <strong class="js iu"> </strong>递减当前存储单元。</li><li id="8cb6" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b">.</code> <strong class="js iu"> </strong>将结果单元格发送到标准输出。</li><li id="5c26" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">,</strong></code>存储单个字符输入到单元格中。</li><li id="fb13" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">[</strong></code> <strong class="js iu"> </strong>如果单元格值为<code class="fe la lb lc ld b">0</code>，则跳过匹配的<code class="fe la lb lc ld b">]</code></li><li id="be19" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b"><strong class="js iu">]</strong></code> <strong class="js iu"> </strong>如果单元格值不是<code class="fe la lb lc ld b">0</code>，跳回匹配的<code class="fe la lb lc ld b">[</code></li></ul><p id="f02f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哇，太棒了，一个聪明的程序看起来怎么样？</p><pre class="kp kq kr ks gt ls ld lt lu aw lv bi"><span id="1c04" class="lw lx it ld b gy ly lz l ma mb">++++++++[&gt;++++[&gt;++&gt;+++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;+&gt;+&gt;-&gt;&gt;+[&lt;]&lt;-]&gt;&gt;.&gt;---.+++++++..+++.&gt;&gt;.&lt;-.&lt;.+++.------.--------.&gt;&gt;+.&gt;++.</span></pre><p id="3b17" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">试着猜猜它的意思！这是Brainfuck里的一个“Hello World”！</p><h1 id="89ae" class="mc lx it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">理解脑残</h1><p id="659d" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">假设我们想要将“<code class="fe la lb lc ld b">a</code>”打印到标准输出。知道了"<code class="fe la lb lc ld b">a</code>"的ASCII字符是<code class="fe la lb lc ld b">97</code>，我们可以将97个<code class="fe la lb lc ld b">+</code>命令放入一个<code class="fe la lb lc ld b">.bf</code>文件，然后编译它:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="19e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将完美地工作；它会在我们的屏幕上打印出一个漂亮的“<code class="fe la lb lc ld b">a</code>”。但是如果用一个循环来实现就太好了！所以让我们写下来:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8037" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">什么？的。他妈的是。正在发生。给你。让我们来分析通量:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6ce5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没那么难！我们如何用JavaScript实现这一点呢？</p><h1 id="a795" class="mc lx it bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">编写编译器</h1><p id="324b" class="pw-post-body-paragraph jq jr it js b jt mz jv jw jx na jz ka kb nb kd ke kf nc kh ki kj nd kl km kn im bi translated">编译器本身很简单。让我们从定义我们的<code class="fe la lb lc ld b">compile</code>函数开始:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="df80" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们创建一个包含10个<code class="fe la lb lc ld b">0</code>的数组。最初的Brainfuck实现有30000个内存单元，但目前我们可以使用10个单元；我们以后再增加。</p><p id="a330" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们声明一个指针<code class="fe la lb lc ld b">ptr</code>，它代表我们正在工作的单元格。我们之前说过，从第一个小区开始(小区<code class="fe la lb lc ld b">0</code>)。</p><p id="9272" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，对于程序中的每个字符，我们将增加/减少或移动磁带上的指针。</p><p id="2410" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们通过运行以下命令对此进行测试:</p><pre class="kp kq kr ks gt ls ld lt lu aw lv bi"><span id="ec93" class="lw lx it ld b gy ly lz l ma mb">console.log(compile("&gt;&gt;++"));</span><span id="7c7e" class="lw lx it ld b gy ng lz l ma mb">// =&gt; [0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0]</span></pre><p id="c724" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太好了，成功了！现在让我们实现另外两个命令:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5fd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以通过运行以下命令来测试编译器:</p><pre class="kp kq kr ks gt ls ld lt lu aw lv bi"><span id="1ba1" class="lw lx it ld b gy ly lz l ma mb">console.log(compile("&gt;&gt;,."));</span></pre><p id="9bb8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它将在您的浏览器上打开一个提示窗口，并将其ASCII值存储在第二个存储单元中。此时，它会将其值打印到控制台。例如，如果你在输入提示中输入“<code class="fe la lb lc ld b">c</code>”，你将在你的控制台上返回<code class="fe la lb lc ld b">c</code>。</p><p id="c43c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是实现循环的时候了:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6918" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">循环有点棘手。首先，我们必须声明三个新变量:</p><ul class=""><li id="e65c" class="le lf it js b jt ju jx jy kb lg kf lh kj li kn lj lk ll lm bi translated">会告诉我们现在是否在一个愚蠢的循环中</li><li id="27ce" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b">loopStack</code>，一个数组，将保持跟踪每个Brainfuck循环</li><li id="4330" class="le lf it js b jt ln jx lo kb lp kf lq kj lr kn lj lk ll lm bi translated"><code class="fe la lb lc ld b">innerLoops</code>，保持活跃Brainfuck循环次数的计数器。</li></ul><p id="a65e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还必须重构我们的<code class="fe la lb lc ld b">for</code>循环:我们已经切换到一个经典的类似C的<code class="fe la lb lc ld b">for</code>循环，因为我们需要程序的当前索引。在测试命令本身之前，我们需要检测我们是否在Brainfuck循环中。如果我们在一个循环中，并且当前命令是<code class="fe la lb lc ld b">[</code>，让我们将另一个循环添加到我们的<code class="fe la lb lc ld b">innerLoops</code>计数器中。如果当前命令是<code class="fe la lb lc ld b">]</code>，让我们检查这是否是我们的最后一个嵌套循环:如果是，让我们退出循环，否则递减<code class="fe la lb lc ld b">innerLoops</code>计数器。太好了，现在让我们转到命令<code class="fe la lb lc ld b">switch/case</code>。如果当前命令是<code class="fe la lb lc ld b">[</code>并且当前存储单元等于零，我们开始一个循环。否则，将当前命令索引压入<code class="fe la lb lc ld b">loopStack</code>数组。如果命令是<code class="fe la lb lc ld b">]</code>并且当前存储单元不等于零，让我们将当前索引设置为等于我们的<code class="fe la lb lc ld b">loopStack</code>的倒数第二个元素。否则，移除<code class="fe la lb lc ld b">loopStack</code>中的最后一个元件。信不信由你，你只是写了一个完整的Brainfuck编译器！我们用一些程序来测试一下吧！</p><p id="eacd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你好世界:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><a href="https://github.com/sponsors/micheleriva"><div class="gh gi nh"><img src="../Images/e05f00ed2cddfd2907284cb397168c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAIiY1uBKSNdw12oq2BbjA.png"/></div></a></figure></div></div>    
</body>
</html>