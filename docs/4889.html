<html>
<head>
<title>Bonjour: Network Discoverability But Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你好:网络发现简单</h1>
<blockquote>原文：<a href="https://itnext.io/bonjour-share-data-across-devices-without-a-backend-36faee520e14?source=collection_archive---------1-----------------------#2020-10-17">https://itnext.io/bonjour-share-data-across-devices-without-a-backend-36faee520e14?source=collection_archive---------1-----------------------#2020-10-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bb96723f87e193de22e1362012de97dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tjN6p8oX7uZJOaYr"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">由<a class="ae kf" href="https://unsplash.com/@youxventures?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> You X Ventures </a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c62c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，我发现自己在尝试做一些不同于平常的事情。我需要在iOS设备之间共享一些信息，但我不想开发后端来实现这一点。于是开始寻找替代方案。</p><p id="4fb5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">经过几个小时的四处寻找和思考，蓝牙可能是显而易见的解决方案，我突然意识到:</p><blockquote class="le"><p id="a370" class="lf lg it bd lh li lj lk ll lm ln ld dk translated">iPhones也连接到我的家庭网络，为什么不利用这一点呢？</p></blockquote><p id="dd81" class="pw-post-body-paragraph kg kh it ki b kj lo kl km kn lp kp kq kr lq kt ku kv lr kx ky kz ls lb lc ld im bi translated">听起来很简单。我所需要做的就是找出如何让这些设备互相看见，并在它们之间建立通信。简单对吗？嗯，这要看情况，因为从纸面上看，这听起来没什么痛苦:</p><ol class=""><li id="146d" class="lt lu it ki b kj kk kn ko kr lv kv lw kz lx ld ly lz ma mb bi translated">找出接收数据的设备的IP地址。</li><li id="82cb" class="lt lu it ki b kj mc kn md kr me kv mf kz mg ld ly lz ma mb bi translated">与它建立联系。</li><li id="6b2f" class="lt lu it ki b kj mc kn md kr me kv mf kz mg ld ly lz ma mb bi translated">发送数据。</li></ol><p id="c234" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好吧，如果你愿意，这就是它的要点。3个简单易懂的步骤。然而，我不了解你，但我以前从未使用过网络协议。我也从未读到过如何在iOS上着手处理这种情况。我通常使用和开发的大多数应用程序都依赖服务器在不同设备上的应用程序实例之间传递信息。</p><p id="1b98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是嘿！我们有一个路线图，我们知道我们需要遵循，所以让我们一步一步地解决它。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/40fc42dba3e3a1cc92b10328a876fa29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*y1UEbAWPuNNmirO6uFqAQQ.jpeg"/></div></figure><h2 id="9f8a" class="mm mn it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">1.找出接收数据的设备的IP地址</h2><p id="779f" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">由于目标是让设备在同一本地网络(也就是我的家庭wifi)上相互通话，我想出了两种方法来实现这一点:要么在一个设备上显示IP地址，然后在发送设备上手动输入该值，要么尝试扫描网络中所有可用的设备，并从列表中选择正确的设备。</p><p id="d715" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个选项很简单，但是我觉得用户体验会很差。任何人都不应该有处理IP号码的需要。第二个选项虽然消除了第一个选项的一些不好的体验，但也引入了拥有可能是接收设备的可能设备列表的问题。是的，您可以解析主机名，这有助于缩小范围，但是，为什么要向用户显示比需要更多的信息呢？当你真的只需要找到一个设备时，有一个设备列表可供选择不应该是正确的做法。</p><p id="3d93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">必须有一种用户友好和开发者友好的方式。因为扫描网络设备不是一件有趣的事情。</p><p id="a210" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但你知道什么最有趣吗？<a class="ae kf" href="https://en.wikipedia.org/wiki/Zero-configuration_networking" rel="noopener ugc nofollow" target="_blank"> ZeroConf </a>。在缩小了我的新需求后，我的搜索变得更加具体，我发现了这项技术的存在。为了让你少去一趟维基百科:</p><blockquote class="nk nl nm"><p id="1cd0" class="kg kh nn ki b kj kk kl km kn ko kp kq no ks kt ku np kw kx ky nq la lb lc ld im bi translated">零配置网络(zeroconf)是一组基于互联网协议套件自动创建可用计算机网络的技术。它不需要人工操作员干预或特殊的配置服务器。</p></blockquote><p id="6634" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是这和扫描设备有什么区别呢？你可能会问。主要的区别是这是自动的。我们不需要去寻找<strong class="ki iu">所有的</strong>设备，我们只需要寻找想要被我们找到的设备并建立连接。</p><p id="e353" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ZeroConf背后的概念非常复杂，我很难解释清楚。然而，我可以试着把它简化一点。可以把ZeroConf想象成一个设备，它使用一种特殊的Google来获取注册到我们可以与之通信的服务的可用设备列表。嗯，这听起来比谷歌更像Tinder主要的一点是，它允许客户端和主机被列出和找到，没有太多的麻烦或特殊的配置。</p><p id="37af" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">需要记住的一点是，ZeroConf既不连接设备，也不在设备之间传递数据。它只是让查找的过程变得容易多了。为了在设备之间真正连接和传递数据，我们需要另一种解决方案。但是该解决方案将要求我们知道我们想要连接到哪个设备。</p><p id="95cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，谢天谢地，ZeroConf有很多不同的实现。但是对于手头的任务来说更重要的是:苹果有自己的实现，我们可以使用它！</p><p id="9234" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">他们称之为:<a class="ae kf" href="https://developer.apple.com/bonjour/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"/></a><strong class="ki iu">。(我可以用所有的陈词滥调告诉你，这是法语中“你好”或“早上好”的意思，但是…哦，我想我做到了，不是吗？)</strong></p><p id="36c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你去那个链接，你会发现代码和例子都很旧了。甚至还有一个2011年WWDC演讲的链接。是的，这确实意味着那里的代码是Objective-C，不，我不想在2020年做Obj-C应用。但这只是意味着我们需要坐下来，看看他们是否提供了快速包装。</p><p id="425e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了节省我们的时间，是的，是的。我们可以使用Swift的Bonjour。虽然这些对象没有被称为“Bonjour ”,也没有我们需要添加的额外框架。这都是基础的一部分。要实现第一步，我们只需要关注2个对象:<a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservice" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> NetService </strong> </a>和<a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservicebrowser" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">net service browser</strong></a>。</p><p id="e44c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservice" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">网络服务</strong> </a>作为一个广播者，它发布带有一组参数的设备，这样如果其他设备正在寻找它，它们可以很容易地找到它。让我们来设置一下:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="57c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样。现在，我们的设备已经准备好相互通信。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="4068" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们花一点时间来讨论我们传递的一些参数和值。</p><p id="7d72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">域:</strong>文档给出的建议是传递一个空字符串，这样服务就会在默认的域名注册中心注册。理论上(令一些人沮丧的是)你可以在这里写任何字符串值，它仍然可以工作。但是因为empty是有效的并且更容易，我们就这么做。</p><p id="1576" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">类型:</strong>这里变得更加具体。这将定义服务将使用的传输层，在我们的例子中是TCP和服务本身的名称。要求两个值都以下划线(_)为前缀，并用句点(.).此外，结尾的句点是一个要求。这就是我们如何以“<em class="nn"> _examplebonjour”结尾的。_tcp。</em>”</p><p id="2518" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">名字:</strong>简单破译吧？服务的名称。文档要求这个参数是唯一的。有意义的是，如果我们开始发布多个同名的服务，我们将如何识别我们真正想要的服务呢？然而，如果保留为空字符串，它将使用“计算机名”(我猜这是在macOS上写的)，但为了确保它给出了我们期望的名称，我们传递了当前设备的名称。</p><p id="dbcf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">端口:</strong>选择的数字完全是任意的。它不应该与另一个端口重合，文档建议不要赋值，让系统为您选择一个任意的数字。无论如何，当我们在步骤2中尝试建立设备之间的连接时，这将会派上用场。抱歉，没有剧透。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="1628" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在相反，顾名思义<a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservicebrowser" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">NetServiceBrowser</strong></a><strong class="ki iu"/>在给定一组参数的情况下寻找可用的设备。有了这两样东西，我们就可以完成清单的第一步。这需要更多的工作，但没有什么太极端的，因为你会看到:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="9d23" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，也很简单。现在，我们正在寻找在指定的<em class="nn">域</em>和<em class="nn">类型</em>中广播其存在的设备。然而，你可能已经注意到我们指派了<strong class="ki iu"> self </strong>作为浏览器的代理。这是因为在苹果的好方式中，我们将通过<a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservicebrowserdelegate" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">NetServiceBrowserDelegate</strong></a>协议接收回调。我们可以通过它实现一些方法，但现在，我们只关注其中一个:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="0f9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要保存一个对这个网络服务的引用，它可能是我们的另一个设备，这样我们就可以在以后开始与它通信。此外，您可能已经注意到，第三个参数是“<em class="nn">morecomm</em>”。通过这一点，他们让我们知道我们是否可以期待更多的设备被通过。您可以使用它来了解我们是否准备好在所有设备都完成加载后向用户展示可用的设备。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="ae17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让法国人继续前进:瞧！我们已经成功地(至少在论文中)定义了我们想要如何接近和解决等式的第一部分:“<em class="nn">计算出接收数据的设备的IP</em>”。虽然，现在再想想那一步，我们从来没有真正得到过IP。</p><p id="6303" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那我们真的可以到此为止了吗？</p><p id="b4fe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是的，我们可以。当我们的<a class="ae kf" href="https://developer.apple.com/documentation/foundation/netservicebrowser" rel="noopener ugc nofollow" target="_blank"/></p><p id="6d47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，还有更多细节。但是从高层次来看，这将是满足步骤1的需求所要处理的最重要的事情。我们现在可以轻松地广播服务，并找到设备在它们之间建立连接，并最终共享数据。我们的下一步将实际创建连接，希望能够传递一些数据。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="656d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们已经走了很长的路。从玩弄一个想法；定义一些如何实现我们目标的步骤，并开始着手解决这些问题。</p><p id="3325" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望这不仅能帮助你解决如何寻找设备的问题，还能让你明白，把问题分成小块会更好解决。这使得它们更容易理解，面对起来也不那么令人沮丧，因为你将能够根据你为自己设定的垫脚石来看到和衡量你的进步。实现一个目标是会上瘾的，也是极具激励性的。</p><p id="447e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">基于这一点，我这篇文章的目标是开始分享我在这个问题上的发现，打破让我们大多数人不敢尝试基于网络的交流的想象障碍。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><h2 id="e4e1" class="mm mn it bd mo mp mq dn mr ms mt dp mu kr mv mw mx kv my mz na kz nb nc nd ne bi translated">想要更多吗？</h2><p id="5b01" class="pw-post-body-paragraph kg kh it ki b kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld im bi translated">这个系列的第2部分已经出版了。继续读吧！</p><div class="oa ob gp gr oc od"><a href="https://medium.com/@mpesate/bonjour-how-to-stream-data-in-2-easy-steps-f335bded87" rel="noopener follow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd iu gy z fp oi fr fs oj fu fw is bi translated">Bonjour:如何通过两个简单的步骤传输数据</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">使用流从一台设备向下一台设备发送数据</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">medium.com</p></div></div><div class="om l"><div class="on l oo op oq om or jz od"/></div></div></a></div></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="5205" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢这篇文章，请为它鼓掌(喜欢它),并在下面留下你的问题、评论或建议。如果可能的话，我会试着回答这些问题，但更重要的是，它可能有助于我正在撰写的这个系列的第二部分。</p></div><div class="ab cl nt nu hx nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="im in io ip iq"><p id="2177" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">更多内容由我:</strong></p><ul class=""><li id="40df" class="lt lu it ki b kj kk kn ko kr lv kv lw kz lx ld os lz ma mb bi translated"><a class="ae kf" href="https://blog.usejournal.com/taking-advantage-of-generics-and-codable-in-swift-b5e28cdeb6fa" rel="noopener ugc nofollow" target="_blank">利用Swift中的泛型和可编码性</a></li><li id="06d1" class="lt lu it ki b kj mc kn md kr me kv mf kz mg ld os lz ma mb bi translated"><a class="ae kf" href="https://medium.com/@mpesate/a-few-swift-tricks-that-you-might-not-know-7d14afbd5f71" rel="noopener">几个你可能不知道的快捷小技巧</a></li></ul></div></div>    
</body>
</html>