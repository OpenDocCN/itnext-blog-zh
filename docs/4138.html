<html>
<head>
<title>Azure DevOps Pipelines: Depends On with Conditionals in YAML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps管道:依赖于YAML的with条件</h1>
<blockquote>原文：<a href="https://itnext.io/azure-devops-pipelines-depends-on-with-conditionals-in-yaml-96f0f26fe090?source=collection_archive---------3-----------------------#2020-05-04">https://itnext.io/azure-devops-pipelines-depends-on-with-conditionals-in-yaml-96f0f26fe090?source=collection_archive---------3-----------------------#2020-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0697" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几周前，我们在YAML 中讨论了<a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-conditionals-in-yaml/" rel="noopener ugc nofollow" target="_blank">条件，展示了如何有条件地运行任务和作业，以及如何使一个作业依赖于另一个作业。这篇文章将讨论条件依赖和作业依赖的结合。如果你是这个系列的新手，你可以使用下面的文章来跟上。</a></p><p id="dca5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2020/02/getting-started-with-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS入门</a><br/><a class="ae kl" href="https://elanderson.net/2020/03/pipeline-creation-in-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS中的管道创建</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-publish-asp-net-core/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps为ASP.NET核心发布工件</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-pipelines-multiple-jobs-in-yaml/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:YAML的多个作业</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-pipelines-reuseable-yaml/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:可重用的YAML </a> <br/> <a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-use-yaml-across-repos/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps管道:跨Repos使用YAML</a><br/><a class="ae kl" href="https://elanderson.net/2020/04/azure-devops-pipelines-conditionals-in-yaml/" rel="noopener ugc nofollow" target="_blank">Azure devo PS管道:YAML的条件</a> <br/></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/e1b31bb03eb7b71ab2b260cfd258e03c.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*eXtXuLLPpobztelj.png"/></div></figure><h2 id="f087" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">现有作业</h2><p id="452d" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">提醒一下，我们的示例管道有4个作业。WebApp1作业始终运行，WebApp2作业根据管道变量运行或跳过，DependentJob依赖于WebApp1和WebApp2，最后，TagSources作业依赖于所有以前的作业。在这篇文章中，我们将调整TagSources的工作。以下是设置不带任务的TagSources作业的YAML。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="06d4" class="ku kv iq lt b gy lx ly l lz ma">- job: TagSources<br/>  displayName: 'Tag Sources'<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/><br/>  dependsOn:<br/>  - WebApp1<br/>  - WebApp2<br/>  - DependentJob</span></pre><p id="0d92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用此设置，WebApp1、WebApp2和DependentJob都必须报告成功，否则将跳过TagSources作业。以下屏幕截图显示了将变量to build WebApp2设置为false的管道运行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/d606ab0ce72af61153393d2b66e20d6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eCz0Z3yjLfQNiYoA.png"/></div></div></figure><p id="9f65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，TagSources作业被跳过，因为它的一个依赖作业被跳过。</p><h2 id="5654" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">有条件的依赖关系</h2><p id="47e1" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">假设对于我们的管道，我们希望只要所有作业都成功，或者如果WebApp1成功并且跳过了WebApp2和DependentJob作业，就运行TagSources作业。为此，我们将添加一个<strong class="jp ir">条件</strong>元素，并手动检查依赖关系的结果，如下所示。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="7edc" class="ku kv iq lt b gy lx ly l lz ma">- job: TagSources<br/>  displayName: 'Tag Sources'<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/><br/>  dependsOn:<br/>  - WebApp1<br/>  - WebApp2<br/>  - DependentJob<br/>  condition: |<br/>    and<br/>    (<br/>      eq(dependencies.WebApp1.result, 'Succeeded'),<br/>      in(dependencies.WebApp2.result, 'Succeeded', 'Skipped'),<br/>      in(dependencies.DependentJob.result, 'Succeeded', 'Skipped')<br/>    )</span></pre><p id="b6a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在结果中看到，TagSources作业甚至在两个被跳过的作业中运行。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mg"><img src="../Images/9e43f6d4eab8a9f06bd95fbb17daffcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UT2fdqG3BcU_QGHx.png"/></div></div></figure><h2 id="a51a" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="eb79" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">如果有一个更简单的方法来完成我们上面所做的，我很乐意听到它。如果我没记错的话，我是在GitHub的一期杂志上看到上述内容的，但是我没有链接。我不确定你们中有多少人会有需要这个的管道，但希望这能节省一些研究时间。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="54a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">原载于</em> <a class="ae kl" href="https://elanderson.net/2020/05/azure-devops-pipelines-depends-on-with-conditionals-in-yaml/" rel="noopener ugc nofollow" target="_blank"> <em class="mo">安德森</em> </a> <em class="mo">。</em></p></div></div>    
</body>
</html>