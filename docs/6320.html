<html>
<head>
<title>Rancher Desktop and nerdctl for local K8s dev</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适用于本地K8s开发的Rancher Desktop和nerdctl</h1>
<blockquote>原文：<a href="https://itnext.io/rancher-desktop-and-nerdctl-for-local-k8s-dev-d1348629932a?source=collection_archive---------1-----------------------#2021-10-17">https://itnext.io/rancher-desktop-and-nerdctl-for-local-k8s-dev-d1348629932a?source=collection_archive---------1-----------------------#2021-10-17</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/b5d3717a9d3d17de0894d385f54787c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*69wQVB29PgDT5o6IN1ehsQ.png"/></div></div></figure><p id="94f7" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当 (2.6) <a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-rancher-2-5-on-your-windows-10-laptop-with-k3d-and-k3s-7404f288342f">尝试</a> (2.5) <a class="ae la" href="https://jyeee.medium.com/rancher-2-4-14c31af12b7a" rel="noopener">为Kubernetes初学者开发人员找出</a> (2.4)一个<a class="ae la" href="https://jyeee.medium.com/rancher-2-3-on-windows-10-with-minikube-and-helm-e4e2ae962994" rel="noopener">好的本地开发设置</a> (2.3)时，我花了相当多的<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-rancher-cluster-manager-2-6-on-your-macos-laptop-with-k3d-k3s-in-5-min-8acdb94f3376">，我想我已经通过运行Rancher Desktop(</a><a class="ae la" href="https://rancherdesktop.io/" rel="noopener ugc nofollow" target="_blank">https://rancherdesktop.io/</a>)和使用nerdctl而不是docker build/pull/commit/tag/push找到了它。</p><p id="a7ee" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">本文展示了如何使用nerdctl(通过Rancher Desktop安装)来拉取、编辑(提交)、本地运行和部署到K8s。</p><h2 id="0bea" class="lb lc iu bd ld le lf dn lg lh li dp lj kn lk ll lm kr ln lo lp kv lq lr ls lt bi translated">注意:🤙零Docker桌面🐳本文中使用了or <code class="fe lu lv lw lx b">docker</code>命令🤙</h2><p id="b073" class="pw-post-body-paragraph kc kd iu ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz in bi translated">如果你需要帮助安装Rancher Desktop，请查看下面的文章</p><div class="md me gq gs mf mg"><a href="https://medium.com/macoclock/rancher-desktop-setup-for-k8s-on-your-macos-laptop-6f1c576ceb48" rel="noopener follow" target="_blank"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">macOS笔记本电脑上K8s的Rancher桌面设置</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">对于我在MacBook上的个人K8s测试实验室，我使用的是Rancher Desktop。我试过MiniKube(牛逼)和K3d(也…</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">medium.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu ka mg"/></div></div></a></div><p id="2d28" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">使用Rancher Desktop，kubectl、helm、nerdctl和kim会自动安装，并设置为当前配置上下文。无需使用brew或手动安装任何这些工具🙌</p><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mv"><img src="../Images/93bc073317f3069f3e02b57d0704ca28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkT_bnw8sHHSmSoyewhu5Q.png"/></div></div></figure><h1 id="fe3c" class="na lc iu bd ld nb nc nd lg ne nf ng lj nh ni nj lm nk nl nm lp nn no np ls nq bi translated">用nerdctl运行一个容器映像</h1><p id="de95" class="pw-post-body-paragraph kc kd iu ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz in bi translated">使用nerdctl提取容器映像，显示提取的容器映像，并运行容器。使用nerdctl感觉就像使用docker一样！</p><blockquote class="nz oa ob"><p id="9aae" class="kc kd oc ke b kf kg kh ki kj kk kl km od ko kp kq oe ks kt ku of kw kx ky kz in bi translated">因为我们希望使用K8s集群来构建和管理映像，所以请确保通过指定k8s.io名称空间来使用K8s集群名称空间来存储映像。这是通过在nerdctl: <code class="fe lu lv lw lx b">-n k8s.io</code>中提供这些参数来实现的</p></blockquote><p id="7ac5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们在这个例子中使用的容器图像是一个基本的nginx，它提供了我在下面的文章中制作的一个kaboomjs(<a class="ae la" href="https://kaboomjs.com/" rel="noopener ugc nofollow" target="_blank">https://kaboomjs.com/</a>♥️)游戏</p><div class="md me gq gs mf mg"><a href="https://javascript.plainenglish.io/kaboom-js-repl-it-custom-top-down-shooter-in-5-min-ebad8157073a" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">使用kaboom.js和repl.it在5分钟内创建一个自定义的自上而下的射手</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">我小时候喜欢玩自上而下的射击游戏，比如《银河战舰》和《太空入侵者》,希望我也能自己定制一款…</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="mp l"><div class="og l mr ms mt mp mu ka mg"/></div></div></a></div><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="3029" class="lb lc iu lx b gz ol om l on oo"># default from docker.io<br/>$ nerdctl -n k8s.io pull jwsy/jade-shooter:v1.1</span><span id="1c38" class="lb lc iu lx b gz op om l on oo">$ nerdctl -n k8s.io images | grep jwsy</span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oq"><img src="../Images/22853519ef144769515006daa9fd6c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TekshFROnYSJhDtxSd4AhA.png"/></div></div><figcaption class="or os gk gi gj ot ou bd b be z dk translated">感觉就像用docker一样</figcaption></figure><p id="451a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用nerdctl运行图像，并浏览到<code class="fe lu lv lw lx b">localhost:8080</code>进行查看。注意创建的容器ID，在本例中是<code class="fe lu lv lw lx b">e2a5....</code></p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="19aa" class="lb lc iu lx b gz ol om l on oo">$ nerdctl -n k8s.io run -d -p 8080:80 jwsy/jade-shooter:v1.1<br/><strong class="lx iv">e2a5</strong>bea0471b3173b68268901551c0906a29fea55bd4cba34d9f446bfaa765c2</span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ov"><img src="../Images/0fa5f7f2b45494471064e7bd01d6763d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2DZ1A_zvL9eJM-rwQLh2mA.png"/></div></div><figcaption class="or os gk gi gj ot ou bd b be z dk translated">请注意，只有两颗“子弹”发射</figcaption></figure><h1 id="9397" class="na lc iu bd ld nb nc nd lg ne nf ng lj nh ni nj lm nk nl nm lp nn no np ls nq bi translated">编辑映像，并使用nerdctl测试和创建一个新的容器映像</h1><p id="f118" class="pw-post-body-paragraph kc kd iu ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz in bi translated">为了模拟开发，使用nerdctl exec打开并编辑容器——特别是kaboom.js应用程序中发射的子弹数量。下面显示我修改了一个特定的函数<code class="fe lu lv lw lx b">keypress(["space", "up]), () =&gt; {</code>,用三个项目符号(即调用spawnBullet)代替两个。</p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="edbd" class="lb lc iu lx b gz ol om l on oo">$ nerdctl -n k8s.io exec -it <strong class="lx iv">e2a5</strong> sh</span><span id="e71c" class="lb lc iu lx b gz op om l on oo">/ # grep -A5 'keyPress(\[\"space' /usr/share/nginx/html/index.html</span><span id="7ccc" class="lb lc iu lx b gz op om l on oo">/ # vi /usr/share/nginx/html/index.html</span><span id="b3cf" class="lb lc iu lx b gz op om l on oo">/ # grep -A5 'keyPress(\[\"space' /usr/share/nginx/html/index.html</span><span id="2ceb" class="lb lc iu lx b gz op om l on oo"><strong class="lx iv"># this shows THREE spawnBullet calls after editing</strong></span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ow"><img src="../Images/3d31b391fd022bd17d5ad641391d6dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FmL8eWwfEbqap5W3A0toiQ.png"/></div></div></figure><p id="37ce" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">使用<code class="fe lu lv lw lx b">nerdctl commit</code>创建一个新的容器图像&amp;标签。输出是创建的容器图像的sha256，您可以使用<code class="fe lu lv lw lx b">nerdctl -n k8s.io images</code>再次列出图像，以显示新创建的容器图像</p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="de52" class="lb lc iu lx b gz ol om l on oo">$ nerdctl -n k8s.io commit <strong class="lx iv">e2a5</strong> local/jwsy/jade-shooter:v1.2<br/>sha256:73334cd58f5207e605728aad170228a2e7233bacabf37c0fbf8f75c931c59640</span><span id="ac12" class="lb lc iu lx b gz op om l on oo">$ nerdctl -n k8s.io images</span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ox"><img src="../Images/c031f35390b2dec1de43625c8fdf6546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IERItjFt0C35pb_nbpbRgQ.png"/></div></div></figure><p id="69dd" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">此时，您可以使用nerdctl测试保存和加载图像</p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="da00" class="lb lc iu lx b gz ol om l on oo">$ nerdctl -n k8s.io save -o local_jwsy_jade-shooter_v1.2.tar local/jwsy/jade-shooter:v1.2</span><span id="7035" class="lb lc iu lx b gz op om l on oo">$ nerdctl -n k8s.io load -i local_jwsy_jade-shooter_v1.2.tar</span></pre><p id="327e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在不同的端口上本地测试容器映像(8081与8080)</p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="0bed" class="lb lc iu lx b gz ol om l on oo">$ nerdctl -n k8s.io run -d -p 8081:80 local/jwsy/jade-shooter:v1.2</span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oy"><img src="../Images/03d4b75f740b749825351d13ae5c22f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BVTdnemX6qEcM5L7u9Bwyw.png"/></div></div><figcaption class="or os gk gi gj ot ou bd b be z dk translated">localhost:8081 —这次三颗子弹！</figcaption></figure><h1 id="a2ed" class="na lc iu bd ld nb nc nd lg ne nf ng lj nh ni nj lm nk nl nm lp nn no np ls nq bi translated">在K8s上部署容器映像</h1><p id="3268" class="pw-post-body-paragraph kc kd iu ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz in bi translated">使用部署、服务和入口的基本清单在K8s上部署映像(滚动到底部查看要点)。</p><p id="141a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">因为Rancher Desktop运行在您的本地主机上，Chromium浏览器知道将任何<code class="fe lu lv lw lx b">*.localhost</code> DNS重定向到<code class="fe lu lv lw lx b">localhost</code>，所以我们可以利用这个合理的缺省值来创建一个入口。</p><pre class="mw mx my mz gu oh lx oi oj aw ok bi"><span id="4bb2" class="lb lc iu lx b gz ol om l on oo">$ kubectl apply -f jade-shooter<br/>deployment.apps/jade-shooter created<br/>ingress.networking.k8s.io/jade-shooter created<br/>service/jade-shooter-service created</span></pre><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oz"><img src="../Images/00fd1a9d9a7ebddfa19e2f98eab9f9e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7wjme6vSyh6vKv3N-ONtw.png"/></div></div></figure><p id="16e6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">浏览入口文件中指定的<a class="ae la" href="https://jade-shooter.rancher.localhost" rel="noopener ugc nofollow" target="_blank">https://jade-shooter . rancher . localhost</a>，您将看到最新版本！</p><blockquote class="nz oa ob"><p id="b475" class="kc kd oc ke b kf kg kh ki kj kk kl km od ko kp kq oe ks kt ku of kw kx ky kz in bi translated"><em class="iu">你做</em> <strong class="ke iv"> <em class="iu">不做</em> </strong> <em class="iu">必须改变你的</em> <code class="fe lu lv lw lx b"><em class="iu">/etc/hosts</em></code> <em class="iu">如果你</em> <strong class="ke iv"> <em class="iu">使用基于Chrome或Firefox的浏览器像Brave/Canary </em> </strong> <em class="iu">(即不是Safari)因为我们会使用</em><code class="fe lu lv lw lx b"><em class="iu">.localhost</em></code><em class="iu"/><a class="ae la" href="https://en.wikipedia.org/wiki/.localhost" rel="noopener ugc nofollow" target="_blank"><em class="iu">DNS magic</em></a><em class="iu">让你的浏览器自动路由任何否则，你需要更新</em> <code class="fe lu lv lw lx b"><em class="iu">/etc/hosts </em></code> <em class="iu">来拥有条目</em> <code class="fe lu lv lw lx b"><em class="iu"> 127.0.0.1 jade-shooter.rancher.localhost</em></code></p></blockquote><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oy"><img src="../Images/523b6a0022eb089b1498d4b4cb10cbe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKELBCR2Wkv9cYOeAE8v6Q.png"/></div></div><figcaption class="or os gk gi gj ot ou bd b be z dk translated">三颗子弹和正确的DNS</figcaption></figure><p id="bcc9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下面是部署、服务和入口三个清单的要点。您应该看到的是，要实现这一点需要大量的样板配置，而且入口必须是特定于DNS的</p><figure class="mw mx my mz gu jv"><div class="bz fq l di"><div class="pa pb l"/></div></figure><h1 id="8277" class="na lc iu bd ld nb nc nd lg ne nf ng lj nh ni nj lm nk nl nm lp nn no np ls nq bi translated">奖励内容:牧场主集群管理器2.6</h1><p id="24ab" class="pw-post-body-paragraph kc kd iu ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz in bi translated">下面的截图是牧场主集群管理器2.6中的应用程序。按照以下说明在您的机器上设置它:<a class="ae la" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-rancher-cluster-manager-2-6-on-your-macos-laptop-with-k3d-k3s-in-5-min-8acdb94f3376">https://it next . io/kubernetes-rancher-cluster-manager-2-6-on-your-MAC OS-laptop-with-k3d-k3s-in-5-min-8 acdb 94 f 3376</a></p><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pc"><img src="../Images/3fb8348b8dc70460212eef2851a0d7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZRzRVBPA_ls9mjzhMeWCA.png"/></div></div></figure><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pd"><img src="../Images/e3225a4c903b89d36da6f0fe08e94eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FyDMRpO5u1cWltnqmlRlBA.png"/></div></div></figure><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pe"><img src="../Images/f9275f24ad2403954d64f066b51e6873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-4CM8Ktc10ygdQNipgChHA.png"/></div></div></figure><figure class="mw mx my mz gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pf"><img src="../Images/c092db718a79c16496ca5752c7b077d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upgNgYGSHz8uv4VGtlFKVw.png"/></div></div></figure><div class="md me gq gs mf mg"><a href="https://jyeee.medium.com/membership" rel="noopener follow" target="_blank"><div class="mh ab fp"><div class="mi ab mj cl cj mk"><h2 class="bd iv gz z fq ml fs ft mm fv fx it bi translated">通过我的推荐链接加入Medium-Jason Yee</h2><div class="mn l"><h3 class="bd b gz z fq ml fs ft mm fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="mo l"><p class="bd b dl z fq ml fs ft mm fv fx dk translated">jyeee.medium.com</p></div></div><div class="mp l"><div class="pg l mr ms mt mp mu ka mg"/></div></div></a></div></div></div>    
</body>
</html>