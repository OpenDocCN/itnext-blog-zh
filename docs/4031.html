<html>
<head>
<title>Angular 9 Snake Web Component — 51KB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角形9蛇蹼组件— 51KB</h1>
<blockquote>原文：<a href="https://itnext.io/angular-9-snake-web-component-96f61e63b158?source=collection_archive---------7-----------------------#2020-04-13">https://itnext.io/angular-9-snake-web-component-96f61e63b158?source=collection_archive---------7-----------------------#2020-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c9b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着Angular 9和Ivy的发布，我决定尝试web组件并分享我的观点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3970be97b8efa08807757c5cc469f0c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kznfDGf0qXcncniBHF1R6Q.png"/></div></div></figure><blockquote class="kx ky kz"><p id="1053" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">我使用Snake Drive Development，SDD，这实际上意味着在实现我最喜欢的项目时学习新的堆栈。我已经用多种语言和不同的模式实现了贪吃蛇游戏。(C++，C#，Angular，Angular via RxJS，React，Angular Web组件)。我真诚地建议以这种方式学习新技术，通过实施喜爱的项目，在过程中获得乐趣并学习新东西。</p></blockquote><p id="6ad2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个实现是我之前实现的Angular via RxJS贪吃蛇游戏的略微修改版本，只有很少的重要变化。变化有:<br/> * <strong class="jp ir">使用Flux模式管理UI状态</strong> <br/> * <strong class="jp ir">禁用NgZone并使用OnPush减少bundle大小</strong> <br/> * <strong class="jp ir">使用纯函数和不可变状态<br/>*<strong class="jp ir">将一切导出为Web组件<br/> *使用RxJS管理事件并触发变更检测</strong></strong></p><p id="daa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有其他关于创建Angular Web组件的教程，它们更具技术性。本文的不同之处在于，除了技术细节之外，我还构建了一个相当重的web组件，它使用了核心的角度特性，您可以自己看看最终运行的应用程序的性能。</p><p id="10b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">查看GitHub repo和Readme了解更多信息</strong></p><blockquote class="kx ky kz"><p id="5360" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">👨‍💻<a class="ae le" href="https://github.com/gogakoreli/angular-snake-web-component" rel="noopener ugc nofollow" target="_blank">角蛇Web组件GitHub库</a>T19】🎮<a class="ae le" href="https://gogakoreli.github.io/angular-snake-web-component" rel="noopener ugc nofollow" target="_blank">在这里看成品</a></p></blockquote></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="0f3b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">如何创建Web组件TL；博士</strong></h1><h2 id="50ef" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">1.通过CLI添加元素和聚合填充</h2><p id="9506" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">这将自动安装@angular/elements包并添加document-register-element poly fill</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="45bf" class="mk ln iq nc b gy ng nh l ni nj"><strong class="nc ir">ng add</strong> @angular/elements</span></pre><h2 id="5ab7" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">2.将角度组件注册为Web组件</h2><p id="5b0a" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">我创建了SnakeComponent，它导入游戏逻辑并呈现游戏状态。要将其注册为Web组件，请查看AppModule:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/210803ee163510b9f501470249579529.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-LAzT-VOAG8ZSSaOds9ug.png"/></div></div></figure><p id="e02f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我不需要AppComponent或Routing，因为我计划只使用ng-snake web组件，因此我从模块声明中删除了其他不必要的内容，以减小包的大小。</p><h2 id="52a7" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated"><strong class="ak"> 3。禁用NgZone(可选)</strong></h2><p id="1d9f" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">这是可选的，但为了试验Angular的新功能，我禁用了NgZone来检测变化。我使用了V9中Ivy引入的新的markDirty pure函数。它还减少了束的大小。要禁用NgZone，请在main.ts中使用以下命令:</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="0b4c" class="mk ln iq nc b gy ng nh l ni nj">platformBrowserDynamic().bootstrapModule(AppModule, { ngZone: ‘noop’ }).catch(err =&gt; console.error(err));</span></pre><p id="f923" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请看下面的markDirty用法示例图像。本质上，当游戏状态得到更新时，这是可观察到的，我请求markDirty(this)并且UI将相应地更新。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/9b6578e8d24c80baf887ced457dbeca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*johg0BzBVzCCjr7Mj13laQ.png"/></div></figure><h2 id="9f78" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">4.构建和部署</h2><p id="543b" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">在cli的<code class="fe nm nn no nc b">ng build --prod</code>的帮助下，js文件在项目的dist文件夹中生成。文件有两个版本，es5和es2015。在本文中，我将使用es2015版本的文件main、polyfills和runtime。我将这三个文件组合成一个<code class="fe nm nn no nc b">snake-web-component.js</code>，其中包含Angular runtime、polyfills和游戏逻辑作为一个Web组件。<em class="la">(注意我没有使用global styles.scss，所有必要的样式都在component.scss中，因此它包含在最终的js文件中)</em></p><p id="91ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建打包后，我在ngh(包的repo <a class="ae le" href="https://github.com/angular-schule/angular-cli-ghpages" rel="noopener ugc nofollow" target="_blank"> angular-cli-ghpages </a>)的帮助下，在GitHub repo对应的GitHub页面上发布简单的index.html和snake-web-component.js。GitHub页面服务静态文件gzip，这就是我自己没有gzip final js的原因。你可以在<a class="ae le" href="https://gogakoreli.github.io/angular-snake-web-component/" rel="noopener ugc nofollow" target="_blank">Angular Snake Web Component GitHub页面</a>看一下最终运行的应用。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="fa98" class="mk ln iq nc b gy ng nh l ni nj"><strong class="nc ir">“build</strong>”: “ng build --prod --output-hashing=none”,<br/>“<strong class="nc ir">package</strong>”: “cat dist/snake-web-component/{runtime-es2015,polyfills-es2015,main-es2015}.js &gt; web/snake-web-component.js”,<br/><em class="la">"</em><strong class="nc ir"><em class="la">deploy</em></strong><em class="la">"</em>: "ngh --dir web",</span></pre><h2 id="4dee" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated"><strong class="ak"> 5。让我们看看捆绑包的大小</strong></h2><p id="cd5c" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">当我开始尝试Web组件时，这些是我感兴趣的细节，以评估它们在现实世界中有多大用处。</p><p id="8562" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看<code class="fe nm nn no nc b">ng build --prod</code>之后生成的3个重要文件</p><ol class=""><li id="0b06" class="np nq iq jp b jq jr ju jv jy nr kc ns kg nt kk nu nv nw nx bi translated">main-es2015.js: ~144 KB，~45 KB (Gzipped)</li><li id="2503" class="np nq iq jp b jq ny ju nz jy oa kc ob kg oc kk nu nv nw nx bi translated">运行时-es2015.js: ~1 KB，737 B (Gzipped)</li><li id="bbcb" class="np nq iq jp b jq ny ju nz jy oa kc ob kg oc kk nu nv nw nx bi translated">polyfills-es2015.js: ~14 KB，~6 KB (Gzipped)</li><li id="bd39" class="np nq iq jp b jq ny ju nz jy oa kc ob kg oc kk nu nv nw nx bi translated"><strong class="jp ir">总大小:159 KB，51.3 KB (Gzipped) </strong></li></ol><p id="855b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们得到了一个51.3KB的js文件，它在一个Web组件中包含了Angular运行时和游戏逻辑。对于真实世界的场景来说，这些都是相当好的结果。</p><h2 id="92ba" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">6.Webpack捆绑包分析器</h2><p id="4ded" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">让我们通过Webpack Bundle Analyzer来看看一些统计数据。我们需要在没有prod标志的情况下构建项目，以查看在构建输出中使用了哪些包。这是一个粗略的估计，因为prod build会因为树抖动而丢弃大部分代码，但是获得更多的信息仍然很有趣。</p><p id="14f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要运行build-stats然后分析。内部浏览器分析器应用程序将出现，你可以看看捆绑信息。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="3eaf" class="mk ln iq nc b gy ng nh l ni nj"><strong class="nc ir"><em class="la">“build-stats”</em></strong>: “ng build --stats-json”,<br/><strong class="nc ir"><em class="la">“analyze”</em></strong>: “webpack-bundle-analyzer dist/snake-web-component/stats-es2015.json”,</span></pre><p id="58cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是analyzer的截图。你可以看到</p><ul class=""><li id="d6ae" class="np nq iq jp b jq jr ju jv jy nr kc ns kg nt kk od nv nw nx bi translated">Angular的厂商es2015占用了大部分空间，然而大部分代码会树摇，会大大减少。</li><li id="9105" class="np nq iq jp b jq ny ju nz jy oa kc ob kg oc kk od nv nw nx bi translated">在供应商内部，你可以看到rxjs占用了一些空间，在树摇动后，这些空间也会大大减少。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oe"><img src="../Images/6e8d92d77bfbc40fd3585fa855dfd930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jQT5IeSOUTnTV75OUZf_qw.png"/></div></div></figure><p id="2f4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当仔细观察其他包时，有趣的部分出现了，所以让我们禁用供应商来扩展其他文件。</p><ul class=""><li id="f8a5" class="np nq iq jp b jq jr ju jv jy nr kc ns kg nt kk od nv nw nx bi translated"><strong class="jp ir">main-es 2015 . js:8.37 KB(Gzipped)</strong>包含我写的游戏逻辑和代码。你可以粗略估计一下，在最终的snake-web-component.js中，这是我写的实际代码。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oe"><img src="../Images/d4a650c7ac3e8bad158398cd2fdd9dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcZw_vuvkKvZwEqjjN4Omg.png"/></div></div></figure><h2 id="2778" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">7.自己尝试有棱角的蛇形Web组件</h2><p id="2189" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">创建如gist所示的index.html，你会看到Angular Snake Web组件完美地运行在浏览器中。您可以在任何地方使用<ng-snake> </ng-snake>，只需导入指定的js文件。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="62a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看看游戏截图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oh"><img src="../Images/6f27cf307ac1fb5b00c7bc5077139a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjB6XPGCMVrMNTU8S7F-6A.png"/></div></div></figure><h2 id="9bf3" class="mk ln iq bd lo ml mm dn ls mn mo dp lw jy mp mq ma kc mr ms me kg mt mu mi mv bi translated">8.最后的想法</h2><p id="9c4e" class="pw-post-body-paragraph jn jo iq jp b jq mw js jt ju mx jw jx jy my ka kb kc mz ke kf kg na ki kj kk ij bi translated">总结一下Angular Web组件，我认为这些结果很有希望。由于只拥有需要的东西，这个包变得越来越小。我们可以开始创建图书馆，让每个人都可以使用。<br/>我认为有几种新的可能性:</p><ul class=""><li id="ba32" class="np nq iq jp b jq jr ju jv jy nr kc ns kg nt kk od nv nw nx bi translated">创建组件库并将组件捆绑在单独的文件中。脚本的消费者将为Angular运行时导入一个js文件，并根据组件需求导入其他单独的js文件。一个Angular运行时将被重用，其他组件可以独立导入。所以Angular组件库不仅对Angular开发人员有用，对其他人也有用。</li><li id="a89d" class="np nq iq jp b jq ny ju nz jy oa kc ob kg oc kk od nv nw nx bi translated">创建完整的组件或部件，有独立的逻辑和角度运行时间(像我的蛇游戏Web组件)。例如，在使用Angular生态系统的同时，可以将一些小部件或小组件嵌入到用户想要的任何地方，这是非常有益的。正如你所看到的，包的大小已经很小了。</li></ul><p id="9a13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为这对许多公司来说是个好消息。他们可以构建组件而不是应用程序，并使它们成为Web组件。然后将这些Web组件嵌入到不同的应用程序中，这样无论在哪里嵌入Angular Web组件，它们都具有一致性和可重用的代码。我对这个想法相当肯定，并希望看到它在许多地方得到应用。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="73df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">查看GitHub repo和Readme了解更多信息</strong></p><blockquote class="kx ky kz"><p id="2d8d" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">👨‍💻<a class="ae le" href="https://github.com/gogakoreli/angular-snake-web-component" rel="noopener ugc nofollow" target="_blank">角蛇Web组件GitHub库</a>T9】🎮<a class="ae le" href="https://gogakoreli.github.io/angular-snake-web-component" rel="noopener ugc nofollow" target="_blank">在这里看一下成品</a></p></blockquote></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><p id="41c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你认为这篇文章有趣吗？</p><p id="f6b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">单击👏按钮</strong>传播文章<br/> <a class="ae le" href="https://twitter.com/GogaKoreli" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">在Twitter上关注我@gogakoreli </strong> </a></p></div></div>    
</body>
</html>