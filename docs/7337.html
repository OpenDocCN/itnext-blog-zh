<html>
<head>
<title>KubeVirt on Killercoda on KubeVirt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">库伯维特上杀手科达上库伯维特</h1>
<blockquote>原文：<a href="https://itnext.io/kubevirt-on-killercoda-on-kubevirt-3bc02f7eac7f?source=collection_archive---------2-----------------------#2022-08-24">https://itnext.io/kubevirt-on-killercoda-on-kubevirt-3bc02f7eac7f?source=collection_archive---------2-----------------------#2022-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d1af" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">KubeVirt如何在Killercoda上运行</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9b12a50d67872ad58bfe5ff2117961f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07RM3RJ5_nVdJK_551aDyQ.png"/></div></div></figure><p id="169f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文提供了Killercoda如何使用KubeVirt来安排可任意使用的学习环境的高级概述。我们还讨论了KubeVirt如何在Killercoda上以某种“嵌套三明治”架构运行。</p><h1 id="da06" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">基勒科达</h1><p id="f6b1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><a class="ae mk" href="https://killercoda.com" rel="noopener ugc nofollow" target="_blank">killer corda</a>是一个交互式学习平台，允许每个人只需在浏览器中访问基于Linux|Kubernetes的环境。<a class="ae mk" href="https://wuestkamp.medium.com/katacoda-alternative-1d33599af75f?source=friends_link&amp;sk=853df1e3537cdd19dfcf4cfc0bcd1bff" rel="noopener">阅读更多</a></p><h1 id="f136" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">库伯维特</h1><p id="19c0" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">KubeVirt 允许在Kubernetes上运行实际的VM(虚拟机)而不是最常用的容器。KubeVirt这样描述自己:</p><blockquote class="ml mm mn"><p id="8145" class="kr ks mo kt b ku kv jr kw kx ky ju kz mp lb lc ld mq lf lg lh mr lj lk ll lm ij bi translated">KubeVirt技术解决了已经采用或想要采用Kubernetes的开发团队的需求，但他们拥有现有的基于虚拟机的工作负载，无法轻松地进行容器化。(<a class="ae mk" href="https://kubevirt.io" rel="noopener ugc nofollow" target="_blank">来源</a>)</p></blockquote><p id="1d93" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们实际上会比上面的陈述更进一步，因为在Killercoda上我们使用了KubeVirt作为一个全新的软件架构。使用容器并不能解决所有问题，能够像K8s中的pod一样管理虚拟机是非常好的！</p><p id="c1c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae mk" href="https://killercoda.com/kubevirt" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> &gt; &gt; &gt;测试kube virt on killer coda&lt;&lt;&lt;</strong></a></p><h1 id="186b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">为什么使用虚拟机而不是容器？</h1><p id="7a7e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Killercoda将容器用于其主要基础设施，但不用于用户可以访问的交互式学习环境。</p><p id="2261" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">容器非常适合可信工作负载，因为它们非常快，并且可以共享宝贵的资源，如内存。但是在同一台主机上运行的两个容器仍然共享同一个Linux内核，并且总是有不同的内核CVE。</p><p id="35cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">虚拟机提供了更好的安全性和封装，但速度较慢，而且占用更多资源。如果您允许不受信任的用户在您的基础架构内运行应用程序，那么您需要(在许多其他措施中)一个硬封装层，也就是虚拟机。</p><h1 id="4ed3" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">虚拟机如何与KubeVirt协同工作</h1><p id="2820" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">KubeVirt提供类似<code class="fe ms mt mu mv b">VirtualMachineInstance</code>的K8s资源。创建此资源将导致自动创建一个Pod和连接的虚拟机。这太棒了，因为这意味着我们可以像对待普通的pod一样对待虚拟机(大多数情况下)。</p><p id="16be" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是这是怎么做到的呢？因为假设我们有虚拟机，我们在这些虚拟机上安装Kubernetes。在Kubernetes内部，我们安装了KubeVirt。然后，KubeVirt将在哪里创建像pod一样的新虚拟机？让我们来看看下图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/3c5fde2be4f535298b7ae44001d4aca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih0UsfvWfG3Jadk9LW41-A.png"/></div></div></figure><p id="cb9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上图中，我们看到一个单节点Kubernetes集群。<code class="fe ms mt mu mv b">Pod 1</code>和<code class="fe ms mt mu mv b">Pod 2</code>是正常的豆荚。<code class="fe ms mt mu mv b">Pod 3</code>和<code class="fe ms mt mu mv b">Pod 4</code>是库贝维特吊舱。<code class="fe ms mt mu mv b">VM Pod 3</code>和<code class="fe ms mt mu mv b">VM Pod 4</code>是嵌套的虚拟机，KubeVirt将与KVM通信来创建这些虚拟机。</p><p id="4d75" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">KubeVirt需要硬件虚拟化支持，这样就可以在虚拟机上创建嵌套的虚拟机。嵌套虚拟化可以在大多数专用服务器上实现，也可以在像GCP这样的云提供商上实现。</p><h1 id="ede8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Killercoda如何使用KubeVirt</h1><p id="e039" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">定制的<strong class="kt ir">killercoda-operator</strong>(Golang)通过<em class="mo">普通的</em> K8s方式与KubeVirt通信，在集群内部创建和删除资源。</p><p id="2f18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，如果你打开了<a class="ae mk" href="https://killercoda.com/playgrounds/scenario/ubuntu" rel="noopener ugc nofollow" target="_blank"> Ubuntu Playground </a>，那么一个请求将被发送到你所在位置附近的Kubernetes集群。在K8s集群内部运行KubeVirt和定制应用程序。</p><p id="bd13" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> killercoda-operator </strong>接收到请求“new Ubuntu VM”并创建一个新的<code class="fe ms mt mu mv b">VirtualMachineInstance</code>资源。一旦安装了KubeVirt，就可以使用这个资源。这将使KubeVirt创建一个嵌套的VM。</p><p id="cab8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当用户关闭浏览器选项卡时，连接中止被发送到<strong class="kt ir">killer code-operator</strong>，它简单地删除<code class="fe ms mt mu mv b">VirtualMachineInstance</code>资源。这将导致KubeVirt实际上删除所有底层资源和嵌套的VM。</p><h1 id="7702" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">KubeVirt如何在Killercoda上运行</h1><p id="ab52" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><strong class="kt ir"><em class="mo">kube virt</em></strong><em class="mo">运行于</em><strong class="kt ir"><em class="mo">killer corda</em></strong><em class="mo">运行于</em><strong class="kt ir"><em class="mo">kube virt</em></strong></p><p id="5295" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">答案相对简单:Killercoda提供完全隔离的虚拟机。一般来说，不管你是使用GCP、AWS还是Killercoda虚拟机，你只需要在上面安装K3s，然后再安装KubeVirt。</p><p id="22c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">但是</strong>在Killercoda虚拟机上，不支持嵌套虚拟化。对于这些情况，KubeVirt提供了<a class="ae mk" href="https://github.com/kubevirt/kubevirt/blob/main/docs/software-emulation.md" rel="noopener ugc nofollow" target="_blank">软件模拟</a>，这对于测试来说很棒，但是对于生产应用来说可能太慢了。</p><h1 id="4546" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">为什么Killercoda的速度如此惊人？</h1><p id="52b1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated"><em class="mo">(抱歉自爱标题)</em></p><p id="77f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Killercoda总是保持一定数量的虚拟机运行，例如Ubuntu或Kubernetes。我们称之为预热。如果你打开一个Killercoda场景，并且有一个预热的虚拟机可用，它会直接分配给你，没有等待时间。</p><p id="f6a3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果没有预热的虚拟机可用，则会按需创建一个新的虚拟机。创建一个新的running+ready Ubuntu环境大约需要20秒，创建一个新的running+ready双节点Kubernetes集群大约需要30秒。</p><p id="58ae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最大的速度和可靠性因素可能是我们远离体积(PV/PVC)。卷创建可能会很慢，而且通常不可靠。如果您需要在短时间内创建和删除数以千计的虚拟机，您需要消除任何制造组件的麻烦。</p><p id="e83c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">KubeVirt与<a class="ae mk" href="https://kubevirt.io/user-guide/operations/containerized_data_importer" rel="noopener ugc nofollow" target="_blank"> CDI </a>(容器化数据导入器)配合得非常好，如果你开始你的旅程，你肯定应该使用它。它也可能在您的生产用例中工作得很好。但是在Killercoda上，我们决定完全不使用CDI或volumes。为了实现这一点，我们实际上运行了一个定制的KubeVirt版本。</p><h1 id="a6d3" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Kustomized KubeVirt版本</h1><p id="f750" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了速度(不使用卷)和更深层次的集成，我们维护了一个定制的KubeVirt版本。此外，我们的定制版本允许我们在虚拟机之间创建VPN。例如，在像<a class="ae mk" href="https://killercoda.com/playgrounds/scenario/kubernetes" rel="noopener ugc nofollow" target="_blank"> Kubernetes游乐场</a>这样的多节点环境中，我们希望虚拟机能够相互通信。更多关于如何建造KubeVirt <a class="ae mk" href="https://github.com/kubevirt/kubevirt/blob/main/docs/getting-started.md" rel="noopener ugc nofollow" target="_blank">的信息请点击这里</a>。</p><h1 id="72f0" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">在Killercoda上测试KubeVirt！</h1><p id="a83d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">KubeVirt 是一个了不起的项目，有很棒的架构和代码库。现在在<a class="ae mk" href="https://killercoda.com/kubevirt" rel="noopener ugc nofollow" target="_blank"> Killercoda </a>上测试一下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://killercoda.com/kubevirt"><div class="gh gi mx"><img src="../Images/3bf608452e5d216b45c04cf8d32c4154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DelOVORp2IfU22XM-g2ZTQ.png"/></div></a><figcaption class="my mz gj gh gi na nb bd b be z dk translated"><a class="ae mk" href="https://killercoda.com/kubevirt" rel="noopener ugc nofollow" target="_blank">https://killercoda.com/kubevirt</a></figcaption></figure><h1 id="065c" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结束了</h1><p id="0d49" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>