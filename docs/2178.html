<html>
<head>
<title>Kubernetes Multi-Cloud — Open Service Broker API &amp; Service Catalog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes多云—开放服务代理API和服务目录</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-multi-cloud-open-service-broker-api-service-catalog-b0a563077614?source=collection_archive---------3-----------------------#2019-04-12">https://itnext.io/kubernetes-multi-cloud-open-service-broker-api-service-catalog-b0a563077614?source=collection_archive---------3-----------------------#2019-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a34c96c557f1c506297e52ff7e4990c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SdDTUmsbXOEck-utQuEW9A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">使用开放服务代理API和Kubernetes服务目录的多云Kubernetes</figcaption></figure><div class=""/><p id="2d05" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">简单的说，多云策略就是使用两种或两种以上的云计算服务。通过这种策略，用户可以从不同的云平台中选择最佳的服务，并将它们结合起来，为您的企业创建最佳的解决方案。<a class="ae la" href="https://www.rightscale.com/blog/cloud-industry-insights/cloud-computing-trends-2018-state-cloud-survey" rel="noopener ugc nofollow" target="_blank"> 2018年云状况调查</a>显示，81%的企业使用多种云。</p><p id="a800" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kubernetes被广泛认为是部署和操作容器化应用程序的最佳方式。此外，Kubernetes的一个关键价值主张是，它可以帮助云提供商实现功能标准化。如果用户希望将不同平台上的资源绑定到Kubernetes应用程序，这将为他提供丰富的优势，同时不构建相同的本地应用程序，该怎么办？您将什么平台放在哪里，以便以最有效的方式获得最大的价值？Azure MysQL服务用于MysQL还是Amazon RDS用于PostgreSQL？AWS SQS还是Azure的AQS？或者想尝试语音界面？莱克斯接了电话。您有18种AWS服务可供选择！</p><p id="be16" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">开放服务代理API是一个行业范围的努力，通过一个简单和安全的机制来满足消费云服务的需求。该项目的参与者来自Google、IBM、Pivotal、Red Hat、SAP和许多其他领先的云公司。</p><h1 id="5b96" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">服务目录和服务代理</h1><p id="ca57" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">服务目录为开发人员、ISV和SaaS供应商提供了一种方式来供应服务实例，这些实例可以由应用程序以标准方式使用。Service Catalog是一个扩展API，支持Kubernetes集群中运行的应用轻松使用外部管理的软件产品，例如云提供商<em class="me">提供的数据存储服务。</em>服务代理是开源<a class="ae la" href="http://www.openservicebrokerapi.org/" rel="noopener ugc nofollow" target="_blank">开放服务代理(OSB) API </a>的实现，它简化了向运行在Kubernetes上的应用交付特定于云平台的服务。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/f68795bf11b0f3922f3a00d0cf46f178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ShREQ8iL8eMYE-Vd"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes架构上的服务目录</figcaption></figure><p id="7488" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用服务目录体系结构，应用程序开发人员能够从目录中请求服务，而不必担心如何以及在哪里提供服务。一旦服务可用，他们就可以将服务绑定到他们的应用程序，并使用任何相关的凭证。这些供应和绑定请求是向服务代理(AWS服务代理、Azure服务代理、GCP服务代理等)发出的。)，它们在服务目录中注册，充当运行在其他平台和应用程序上的服务之间的粘合代码。</p><p id="c84a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Kubernetes上，服务目录由catalog-apiserver和catalog-controller-manager组成，部署为Kubernetes部署，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/48f6f6890234f95835453f3d76f1baa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8q7mToSQXX5LlxxV"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上的服务目录</figcaption></figure><p id="f80e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">假设一个应用程序开发人员希望在本地Kubernetes集群上运行一个web应用程序，并使用Azure MySQL作为数据库，使用AWS S3作为存储后端，并且完全不知道如何操作这些应用程序(将这些服务与应用程序粘合在一起)，Service Broker可以帮助实现后端服务与应用程序本身的无缝集成。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/b92ca9f2bc5fd3ff05f53e5a11a5e4a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o0jvs3Aafneq2B6U"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">成分</figcaption></figure><p id="5295" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务代理提供许多服务类(例如，如果Azure代理部署在集群中，Azure MySQL将是这些服务类之一。类似云服务的东西)，每个服务类将构成众多的服务计划(例如，Azure MySQL-Basic、Azure MySQL-Production_Grade等。类似风味/计划的东西)。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/e7c36e6c720c17cf36b327a856f20454.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/0*XMjjgCFiLHIG-aFT"/></div></figure><h1 id="6a1c" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Kubernetes上的典型工作流程</h1><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/03b86a725f283ac5e93b2f1cf8b22aa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2k07WhCG2S2sfmBm"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上的工作流</figcaption></figure><h1 id="85a6" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">面向Azure的开放服务代理</h1><p id="8749" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">在Microsoft Azure公共云中提供托管服务的兼容API服务器。微软一直是服务目录的积极贡献者，该服务目录使Kubernetes运营商能够利用Azure平台提供的云原生服务。</p><p id="aacc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面的信息显示了使用Azure的OSBA将运行在Kubernetes本地集群上的Wordpress应用程序连接到Azure的MySQL服务的示例工作流</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ml"><img src="../Images/46227a4dd2ed6867919a31e67df70900.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cU_UMcKKjWkzbsa2"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">演示集群</figcaption></figure><p id="9cd3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Open Service Broker for Azure作为Pod/Deployment部署在Kubernetes上，并使用Redis作为其状态的后备存储。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/94620f9da025fce116590ae407145d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1_uFboUnGYWv_L1j"/></div></div></figure><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/2062f4690e091f921801cbc7c42c372e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VHbHstA_XZDz6qhB"/></div></div></figure><p id="7362" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">创建Service Broker部署时，应提供具有所需凭据的用户帐户。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/d78002fd89c8149c405c603bdf6ab3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uHiLYy_edTTQHyms"/></div></div></figure><p id="8205" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，“svcat”是一个服务目录的命令行工具，一旦Azure的OSBA可用，它会列出所有可用的服务类。如上所述，每个服务类别将包括多个服务计划。例如,“azure-mysql”服务类将包括如下所示的计划:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mm"><img src="../Images/ac7afa8d62b65dfbce32860437e85c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*twx4gRxGHKyoNtA6"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务目录提供的服务计划</figcaption></figure><p id="d78c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用户可以根据需求选择方案。Open Service Broker for Azure使用一个服务主体代表用户提供Azure资源，或者在这种情况下提供一个可信的媒介，由代理无缝地部署服务。应创建一个资源组(RG ),将OSBA创建的一组资产分组到逻辑组中，以便于甚至自动进行资源调配。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/dc85fb860990a761f055447f57e447ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*us_T5Lwv4nGf96np"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用于授权服务目录和代理创建资源的服务主体</figcaption></figure><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/428f7e4bfb8479b035400512c110d659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zf9QEbScvpG_c1mY"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Azure上的资源组</figcaption></figure><p id="c936" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">部署了一个Wordpress应用程序，默认情况下，它利用Open Service Broker For Azure为MySQL 数据库提供一个<a class="ae la" href="https://azure.microsoft.com/en-us/services/mysql/" rel="noopener ugc nofollow" target="_blank"> Azure数据库，供Wordpress服务器使用。</a></p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/53875553bf05d2b2965e97b7cc31788b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hoUngSJpDAPB2Nbj"/></div></div></figure><p id="e4d4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦部署了包含“ServiceInstance”和“ServiceBinding”资源的应用程序，就会在用户Azure帐户上请求MySQL资源。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/075adc34cf1e8ad655440f0aedf2c597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BmNEqlQJjIJ1mSHZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">服务实例和服务绑定</figcaption></figure><p id="5761" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将在用户Azure帐户上启动服务部署，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/463fe4814603bbad63574cd7b51f2057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U0IJZVXqiDWe0f6J"/></div></div></figure><p id="c2af" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于上面已经声明了RG和SP，所有资源都被分组到指定的资源组下，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/4b92ed85240ce50821c1551326692117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eB75TqYRxBwzGPkX"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">在Azure上创建的MySQL用户帐户</figcaption></figure><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/1fe2a0a0ae6a677d6b297fac7207119d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fpx9M-PayBuHUTzQ"/></div></div></figure><p id="6057" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如下所示，Azure的MySQL服务中将创建一个DB条目，供Wordpress使用，所有的流水线操作都是无缝完成的。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/34c7051b726f00a9eab1a83ada846590.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YkyM4cib6r_vphv1"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">DB Entry-Wordpress在用户Kubernetes集群上的应用</figcaption></figure><p id="d628" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通过使用上面的服务器名称登录到MySQL服务来验证连接性，我们可以看到本地运行的Wordpress应用程序正在将数据写入Azure MySQL服务:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/2b0ded53bb51313e13819d742d035fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C1NNN7tEb-rmqiuA"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上的Wordpress应用程序在Azure上编写MySQL</figcaption></figure><h1 id="54e7" class="lb lc jf bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">面向AWS的开放式服务代理</h1><p id="e3dd" class="pw-post-body-paragraph kc kd jf ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">代理直接在应用程序平台中提供AWS服务的简单集成将AWS服务直接集成到Kubernetes上运行的应用程序中。</p><p id="ca77" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">以下信息显示了在本地集群中运行的Kubernetes pod使用AWS S3进行存储的示例工作流。这需要在Kubernetes集群上运行服务目录。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/eafed7b7e81d4049809b00e93f70175f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CKLgKjWCtRFS0WJI"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AWS Servicebroker —演示集群</figcaption></figure><p id="7062" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">AWS Service Broker先决条件:</p><ol class=""><li id="2212" class="mn mo jf ke b kf kg kj kk kn mp kr mq kv mr kz ms mt mu mv bi translated">用于跟踪状态的DynamoDB表。</li></ol><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/49daf3003ddcbaed46bcd753bbe2d056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SKN2Ju1KjRDuIve5"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用于服务代理状态跟踪的AWS DynamoDB</figcaption></figure><p id="e0a5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.一个S3存储桶，用于存储代理用来管理AWS服务的模板。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/e0cbfe0ff71e5ca7643beffa928e4e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nEx1dZiNdkpoJcW0"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">存储Service Broker使用的云信息模板的S3存储桶</figcaption></figure><p id="74c9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.一个IAM角色，拥有与DynamoDB表、S3桶和AWS CloudFormation交互的权限。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/ed2b02fcc0675e5e54d82c57630e4c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FHRMsXH5aZ5-ew2k"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">IAM用于授权和访问</figcaption></figure><p id="c7ea" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有这些先决条件都可以使用官方AWS资源提供的云形成模板来创建。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/be04d6461f71a6df688d7045df89a757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Oqkhww-04vqu8pGg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">用于设置Service Broker先决条件的AWS CloudFormation模板</figcaption></figure><p id="62f8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">AWS Service Broker部署为Kubernetes部署:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/b6f0de5ba4c1dec06ac3c2d5c98f0e54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*od5abRSklZqYo0j6"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">在Kubernetes上部署AWS服务代理</figcaption></figure><p id="5cae" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦部署了相同的服务，目录就会同步，用户应该能够看到代理支持的所有服务类。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/0af907947d965eb34dfa23e243befd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GcqVOEOzVgqS1gd9"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">通过Kubernetes CRD的集群服务代理</figcaption></figure><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/b52ae7968b42636c763279091358482a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5O7Dml_mqBkJyw_a"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">由Kubernetes上的AWS服务代理提供的服务类别</figcaption></figure><p id="f79b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">部署了一个示例web应用程序，默认情况下，它使用S3作为后端存储，随机写入S3存储桶。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/e34e39f7f27778892e302081e1b58d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6xEhOil1dbDfC72c"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">带有S3后端的演示应用程序</figcaption></figure><p id="259f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">随着上述应用程序的创建，AWS Cloudformation服务开始使用上述IAM配置为应用程序创建S3桶。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/9f425e6103698998e2aa15024fbe5be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lsYmZpQzmTvV60q7"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AWS上的资源创建</figcaption></figure><p id="6f35" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，无缝创建了一个S3存储桶和一个日志存储桶来满足应用程序存储的需求。</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mf"><img src="../Images/7dbb6d7528a7ce6ff907f81091569ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ut4I5UH4QyPcfwZV"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">AWS上的应用程序存储-S3</figcaption></figure><p id="6b2d" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将在Kubernetes名称空间上创建一个对象服务实例，并选择服务类，服务目录与Service Broker交互，将信息同步到本地环境，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/437a9dd85836d759c041e0c9ec9b5c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ogk25nOQVto-Es_5"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上的服务实例对象</figcaption></figure><p id="4c53" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务实例信息将被写入DynamoDB表之一，以跟踪状态:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/d5b05485408ca0cdf1001090c8f46e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xWeV33p7cBq1aCxV"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">包含服务实例信息的Dynamo表</figcaption></figure><p id="ac82" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">访问在AWS上创建的S3资源的身份验证绑定由服务绑定提供:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3e0ebbb48c974b8f25196ef1062683b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/0*t4CjcjqQ-AEl9gHB"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes上的服务绑定</figcaption></figure><p id="da1e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于机密对象没有提供给上面创建的应用程序容器，对S3资源的访问将被禁止，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/f2607c23ccb8e070df7d4bb0565ae836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*heMwztEt5O0JGvch"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes资源访问机密</figcaption></figure><p id="d3d3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">收集的所有秘密都可以提供给上面使用清单中的container_spec创建的应用程序，如下所示:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/286c47bcedfa72e1965a3d3e0091303e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m794mNvX33TySzTu"/></div></div></figure><p id="683b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦上述凭证/秘密被提供给应用程序，应用程序就可以写入AWS上的S3桶。快速测试连通性:</p><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/84108a61a3bff214b37564651f048283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RDvg7AdTsAPnIlCw"/></div></div></figure><figure class="mg mh mi mj gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/8dde942c455a04c37860ea5126e98032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9ygzZuWUHL_aFx9Q"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Kubernetes在S3自动气象站上的应用</figcaption></figure><p id="daea" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，Kubernetes本地集群上的应用程序可以写入AWS上的S3存储桶。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="2ade" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">服务目录提供了强大的抽象，使外部服务在运行于多样化环境中的Kubernetes集群中可用。这些服务通常是特定云平台的第三方托管云产品，其中完整的抽象更容易掩盖集成的复杂性。服务目录和服务代理不仅限于公共云平台，还可以用于多种内部服务。另一方面，开发人员可以专注于应用程序，而无需管理复杂的服务部署。</p></div></div>    
</body>
</html>