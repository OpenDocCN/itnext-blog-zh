<html>
<head>
<title>Vistio — Visualize your Istio Mesh Using Netflix’s Vizceral</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">vistio——使用网飞的Vizceral可视化您的istio网格</h1>
<blockquote>原文：<a href="https://itnext.io/vistio-visualize-your-istio-mesh-using-netflixs-vizceral-b075c402e18e?source=collection_archive---------3-----------------------#2018-06-13">https://itnext.io/vistio-visualize-your-istio-mesh-using-netflixs-vizceral-b075c402e18e?source=collection_archive---------3-----------------------#2018-06-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi ju"><img src="../Images/d4d0314636bb96294a2212d1ad185905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YJqKg8M5xnNlqYtNr5Jsmw.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">Vistio全球级可视化</figcaption></figure><blockquote class="kk kl km"><p id="8e91" class="kn ko kp kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">GitHub Link—<a class="ae lm" href="https://github.com/nmnellis/vistio" rel="noopener ugc nofollow" target="_blank">https://github.com/nmnellis/vistio</a></p></blockquote><figure class="jv jw jx jy gt jz"><div class="bz fp l di"><div class="ln lo l"/></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">Vistio演示</figcaption></figure><p id="5278" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><a class="ae lm" href="https://github.com/Netflix/vizceral" rel="noopener ugc nofollow" target="_blank"> Vizceral </a>是网飞发布的一个开源项目，用于近乎实时地监控应用程序和集群之间的网络流量。Vistio是Vizceral的改编版，用于istio和网格监控。它利用Istio Mixer生成的指标，然后将这些指标输入Prometheus。Vistio查询Prometheus并在本地存储该数据，以允许重播流量。</p><p id="dce0" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">Vizceral提供了两种主要的可视化功能，全局级和集群级。在全局级别(如上所示),您可以通过一个入口点(如Istio入口网关)显示从互联网到Istio mesh的网络流量，也可以显示Istio mesh内的总网络流量。</p><p id="837c" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">在集群级别(如下所示)，您可以可视化内部网格的流量。通过设置警告和错误级别警报，您可以快速检测应用程序何时出现问题。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi ls"><img src="../Images/ed9ff2f5eef69a986e277e22dba91f41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jJ7pRmR9BuC_iElYCWpI4A.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">Vistio集群级可视化</figcaption></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="9fa8" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">为istio网格设置视景</h1><p id="c718" class="pw-post-body-paragraph kn ko iq kq b kr mr kt ku kv ms kx ky lp mt lb lc lq mu lf lg lr mv lj lk ll ij bi translated"><strong class="kq ir">要求</strong></p><ul class=""><li id="c35d" class="mw mx iq kq b kr ks kv kw lp my lq mz lr na ll nb nc nd ne bi translated">普罗米修斯</li><li id="f6e6" class="mw mx iq kq b kr nf kv ng lp nh lq ni lr nj ll nb nc nd ne bi translated">Istio =&gt; 0.7</li></ul><p id="3e58" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">假设</strong> <br/>为了便于部署，下面的演示做了这些假设。如果您的环境设置不同，您可能需要在本地签出代码并编辑一些文件。</p><ul class=""><li id="b61f" class="mw mx iq kq b kr ks kv kw lp my lq mz lr na ll nb nc nd ne bi translated">Prometheus在istio-system名称空间中运行，可通过<a class="ae lm" href="http://prometheus.istio-system:9090" rel="noopener ugc nofollow" target="_blank">http://Prometheus . istio-system:9090</a>访问</li><li id="8da2" class="mw mx iq kq b kr nf kv ng lp nh lq ni lr nj ll nb nc nd ne bi translated">Istio混音器启用了istio_request_count指标</li><li id="bb52" class="mw mx iq kq b kr nf kv ng lp nh lq ni lr nj ll nb nc nd ne bi translated">您的kubernetes集群有一个“标准”存储类</li><li id="d364" class="mw mx iq kq b kr nf kv ng lp nh lq ni lr nj ll nb nc nd ne bi translated">头盔安装方便部署(可选)</li></ul><p id="b4df" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">前言</strong> <br/>如果您的mesh当前没有部署，您可以按照这里的指示[ <a class="ae lm" href="https://istio.io/docs/guides/bookinfo/" rel="noopener ugc nofollow" target="_blank"> Istio Bookinfo Demo </a> ]来部署Istio及其示例应用程序。您将需要能够产生应用程序之间的流量。要测试指标是否正确地从mixer发送到Prometheus，您可以运行下面的Prometheus查询"<em class="kp"> istio_request_count" </em>，应该会看到多个条目。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi nk"><img src="../Images/c4d21b04a87197d57969dcc84e176b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sj0A5tvOud4DDVpEw-fa6g.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">普罗米修斯查询istio_request_count</figcaption></figure><h1 id="42ce" class="lt lu iq bd lv lw nl ly lz ma nm mc md me nn mg mh mi no mk ml mm np mo mp mq bi translated">部署Vistio</h1><p id="826b" class="pw-post-body-paragraph kn ko iq kq b kr mr kt ku kv ms kx ky lp mt lb lc lq mu lf lg lr mv lj lk ll ij bi translated">你可以选择通过<em class="kp"> kubectl </em>或者<a class="ae lm" href="https://github.com/kubernetes/helm" rel="noopener ugc nofollow" target="_blank"> Helm </a>来部署Vistio，这两个方向都有。根据您的环境，有些值可能需要修改。</p><p id="3b83" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">结帐Vistio(可选)</strong></p><p id="0788" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">如果你想通过Helm部署Vistio，你需要签出项目以获得Helm模板。此外，如果上述假设之一不符合您的需求(例如prometheus url不同)，您应该手动签出并编辑文件。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="6460" class="nv lu iq nr b gy nw nx l ny nz">git clone <a class="ae lm" href="https://github.com/nmnellis/vistio.git" rel="noopener ugc nofollow" target="_blank">https://github.com/nmnellis/vistio.git</a></span></pre><p id="184c" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">通过kubectl部署</strong></p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="2cb9" class="nv lu iq nr b gy nw nx l ny nz">kubectl apply -f <a class="ae lm" href="https://raw.githubusercontent.com/nmnellis/vistio/v0.1.2/vistio-mesh-only.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/nmnellis/vistio/v0.1.2/vistio-mesh-only.yaml</a> -n default</span></pre><p id="8b8c" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">通过头盔展开</strong></p><p id="6635" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">cd进入Vistio项目的根目录，运行一个"<em class="kp"> helm install" </em></p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="639c" class="nv lu iq nr b gy nw nx l ny nz">helm install helm/vistio -f helm/vistio/values-mesh-only.yaml --name vistio --namespace default</span></pre><h1 id="20a6" class="lt lu iq bd lv lw nl ly lz ma nm mc md me nn mg mh mi no mk ml mm np mo mp mq bi translated">验证并公开Vistio Web/API</h1><p id="cf19" class="pw-post-body-paragraph kn ko iq kq b kr mr kt ku kv ms kx ky lp mt lb lc lq mu lf lg lr mv lj lk ll ij bi translated">验证应用程序已启动并正在运行。我们通过"<em class="kp"> kubectl port-forward </em>"公开应用程序。</p><p id="658e" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">验证vistio-api </strong></p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="ff2b" class="nv lu iq nr b gy nw nx l ny nz">kubectl describe statefulset vistio-api -n default</span></pre><p id="7e19" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">可选检查日志</strong></p><p id="25c8" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">您应该能够从日志中的vistio-api查看到Prometheus是否有连接/查询错误。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="192f" class="nv lu iq nr b gy nw nx l ny nz">kubectl logs -n default -c vistio-api $(kubectl -n default get pod -l app=vistio-api -o jsonpath='{.items[0].metadata.name}')</span></pre><p id="3ed3" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">验证vistio-web </strong></p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="afad" class="nv lu iq nr b gy nw nx l ny nz">kubectl describe deployment vistio-web -n default</span></pre><p id="9289" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">公开vistio-api </strong></p><p id="2283" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">我们将使用"<em class="kp"> kubectl port-forward </em>"向<a class="ae lm" href="http://localhost:9091" rel="noopener ugc nofollow" target="_blank"> http://localhost:9091 </a>公开vistio-api</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="4d85" class="nv lu iq nr b gy nw nx l ny nz">kubectl -n default port-forward $(kubectl -n default get pod -l app=vistio-api -o jsonpath='{.items[0].metadata.name}') 9091:9091 &amp;</span></pre><p id="7694" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">验证vistio-api </p><p id="ae06" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">vistio-api由vistio-web调用来渲染你的网格。您应该会看到类似下面的输出</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="17e3" class="nv lu iq nr b gy nw nx l ny nz"><a class="ae lm" href="http://localhost:9091/graph" rel="noopener ugc nofollow" target="_blank">http://localhost:9091/graph</a></span></pre><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi oa"><img src="../Images/4b63e255b96ec8dc913e94a8f801bc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LkvzHsN0VzZSOD_wy7sCgQ.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">预期的vistio-api输出</figcaption></figure><p id="37e5" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">曝光远景</p><p id="5ee2" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">在另一个终端窗口中，暴露<a class="ae lm" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>上的Vizceral UI。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="45b6" class="nv lu iq nr b gy nw nx l ny nz">kubectl -n default port-forward $(kubectl -n default get pod -l app=vistio-web -o jsonpath='{.items[0].metadata.name}') 8080:8080 &amp;</span></pre><p id="5cb0" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated"><strong class="kq ir">打开Vistio </strong></p><p id="66b4" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">如果到目前为止一切正常，你应该能够加载Vistio UI并开始探索你的网状网络。您应该会看到类似下图的内容。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="4ba6" class="nv lu iq nr b gy nw nx l ny nz"><a class="ae lm" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></span></pre><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi ob"><img src="../Images/eb743f24e30c8236dcac2bedc864ef0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0YqvZYWPRbRL9gDAfrBTZA.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">主视图</figcaption></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="daca" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">探索</h1><p id="2586" class="pw-post-body-paragraph kn ko iq kq b kr mr kt ku kv ms kx ky lp mt lb lc lq mu lf lg lr mv lj lk ll ij bi translated">在全局级别，您将看到您的Istio mesh中所有请求的总和。如果您部署了istio-Ingres Gateway，您可以选择使用其他配置显示您从网格外部接收的流量[ <a class="ae lm" href="https://github.com/nmnellis/vistio#deploy-vistio-with-istio-ingress-gateway-helm" rel="noopener ugc nofollow" target="_blank">使用入口网关部署Vistio</a></p><p id="7956" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">如果您点击istio-mesh气泡，您将能够查看您的网状网络。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi oc"><img src="../Images/f80c9b58e1022d544fe6d3b37dd03b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q10lUjYmdCPrMoPKLUjKZQ.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">Istio Mesh的网络流量</figcaption></figure><p id="64ec" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">在您的Istio mesh中，有许多可视化工具可以帮助您找出有问题的应用程序。</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi od"><img src="../Images/22c46b846b8b50e1bd172aae3caac7f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WM6lx-4bms7YBO-EHs_a2g.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">查明网络问题</figcaption></figure><p id="2882" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">使用屏幕右上角的过滤器，您可以快速过滤出高错误率的应用程序。通过高级配置，您还可以在错误率超过特定值时触发警报。警报将向您显示给定应用程序的错误率的当前趋势。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h1 id="01a2" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">解决纷争</h1><p id="14ce" class="pw-post-body-paragraph kn ko iq kq b kr mr kt ku kv ms kx ky lp mt lb lc lq mu lf lg lr mv lj lk ll ij bi translated">如果您看到vistio-api的以下输出，您将会知道有些地方工作不正常。正确的输出显示在上面的教程中。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="1f48" class="nv lu iq nr b gy nw nx l ny nz"><a class="ae lm" href="http://localhost:9091/graph" rel="noopener ugc nofollow" target="_blank">http://localhost:9091/graph</a></span></pre><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi oe"><img src="../Images/26a3dce5a6831bd83358940d6437f109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-TcFuNvCvk5C53rO4vXLkw.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">vistio-api的输出不正确</figcaption></figure><ol class=""><li id="e182" class="mw mx iq kq b kr ks kv kw lp my lq mz lr na ll of nc nd ne bi translated">检查vistio-api日志中的错误—在大多数情况下，vistio-api会记录与Prometheus通信时出现的任何问题。</li></ol><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="6455" class="nv lu iq nr b gy nw nx l ny nz">kubectl logs -n default -c vistio-api $(kubectl -n default get pod -l app=vistio-api -o jsonpath='{.items[0].metadata.name}')</span></pre><p id="87e4" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">2.验证Prometheus查询—vistio-API使用以下查询来检索其数据。您应该确保Prometheus中存在这两者的数据。</p><pre class="jv jw jx jy gt nq nr ns nt aw nu bi"><span id="0379" class="nv lu iq nr b gy nw nx l ny nz"># Global Level Query<br/>sum(rate(istio_request_count[1m])) by (response_code)</span><span id="6cb5" class="nv lu iq nr b gy og nx l ny nz"># Cluster Level Query<br/>sum(rate(istio_request_count[1m])) by (source_service,destination_service,response_code)</span></pre><p id="2ae0" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">3.提交问题——如果您遇到困难，请随时提交和发布！<a class="ae lm" href="https://github.com/nmnellis/vistio/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/nmnellis/vistio/issues</a></p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="2a8f" class="pw-post-body-paragraph kn ko iq kq b kr ks kt ku kv kw kx ky lp la lb lc lq le lf lg lr li lj lk ll ij bi translated">GitHub链接—【https://github.com/nmnellis/vistio T2】</p></div></div>    
</body>
</html>