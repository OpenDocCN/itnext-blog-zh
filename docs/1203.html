<html>
<head>
<title>Build a Project Management Tool with Vue.js, Node.js and Apollo — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Vue.js、Node.js和Apollo构建一个项目管理工具——第3部分</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-3-69a7bf9f2f1b?source=collection_archive---------3-----------------------#2018-08-10">https://itnext.io/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-3-69a7bf9f2f1b?source=collection_archive---------3-----------------------#2018-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c2b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢你给了我很多掌声！写这篇文章的时候，我总共得到了将近300个掌声。</p><blockquote class="km kn ko"><p id="134c" class="jn jo kl jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">在本系列的第1部分中，我们构建了一个简单的GraphQL API。</p><p id="9954" class="jn jo kl jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">在本系列的第2部分中，我们构建了MongoDB模式和一个电子邮件表单。</p><p id="b685" class="jn jo kl jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">在这一部分，我们将完成身份验证。</p><p id="588c" class="jn jo kl jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-4-40fbe0625d32">第4部分——构建工作空间</a></p><p id="9cd7" class="jn jo kl jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated"><a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-5-d59e6e345e39">第5部分—文件夹的CRUD功能</a></p></blockquote><p id="c5eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">本教程的代码可以在</em> <a class="ae ks" href="https://github.com/kenzotakahashi/enamel/tree/part3" rel="noopener ugc nofollow" target="_blank"> <em class="kl">这里</em> </a> <em class="kl">找到。或者如果你想跟随，你可以在这里</em>  <em class="kl">克隆part2分支</em> <a class="ae ks" href="https://github.com/kenzotakahashi/enamel/tree/part2" rel="noopener ugc nofollow" target="_blank"> <em class="kl">。</em></a></p><h1 id="e9ef" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">注册</h1><p id="151c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">打开<code class="fe lw lx ly lz b">server/src/resolver.js</code>并添加以下内容:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="e882" class="mi ku iq lz b gy mj mk l ml mm">const { User, Team } = require('./models')</span><span id="112e" class="mi ku iq lz b gy mn mk l ml mm">const JWT_SECRET = process.env.JWT_SECRET</span><span id="0819" class="mi ku iq lz b gy mn mk l ml mm">function randomChoice(arr) {<br/>  return arr[Math.floor(arr.length * Math.random())]<br/>}</span><span id="a5c1" class="mi ku iq lz b gy mn mk l ml mm">const avatarColors = [<br/>  "D81B60","F06292","F48FB1","FFB74D","FF9800","F57C00","00897B","4DB6AC","80CBC4",<br/>  "80DEEA","4DD0E1","00ACC1","9FA8DA","7986CB","3949AB","8E24AA","BA68C8","CE93D8"<br/>]</span><span id="60e7" class="mi ku iq lz b gy mn mk l ml mm">const resolvers = {<br/>  ...<br/>  Mutation: {<br/>    ...<br/>    async signup (_, {id, firstname, lastname, password}) {<br/>      const user = await User.findById(id)<br/>      const common = {<br/>        firstname,<br/>        lastname,<br/>        name: `${firstname} ${lastname}`,<br/>        avatarColor: randomChoice(avatarColors),<br/>        password: await bcrypt.hash(password, 10),<br/>        status: 'Active'<br/>      }<br/>      if (user.role === 'Owner') {<br/>        const team = await Team.create({<br/>          name: `${common.name}'s Team`<br/>        })<br/>        user.set({<br/>          ...common,<br/>          team: team.id,<br/>          jobTitle: 'CEO/Owner/Founder'<br/>        })<br/>      } else {<br/>        user.set(common)<br/>      }<br/>      await user.save()<br/>      const token = jwt.sign({id: user.id, email: user.email}, JWT_SECRET)<br/>      return {token, user}<br/>    },<br/>  },<br/>}</span></pre><p id="becc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它找到在<code class="fe lw lx ly lz b">captureEmail</code>中创建的用户数据，并设置一些字段。</p><p id="4dcc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">如你所见，我们从10种颜色中随机挑选一种头像颜色。这是一种懒惰的方法，因为即使只有几个成员，也有可能选择相同的颜色。我鼓励你写一个更好的算法，并在评论中分享。我很乐意将它纳入我的代码中。</em></p><p id="e758" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lw lx ly lz b">signup</code>功能用于业主和其他用户。稍后，我们将建立帐户页面，您可以邀请其他用户。</p><p id="a258" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果用户是所有者，它还会创建一个团队。最后，它让用户登录并返回令牌和用户对象。</p><p id="7cac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe lw lx ly lz b">JWT_SECRET</code>环境变量添加到<code class="fe lw lx ly lz b">.env</code>，我们准备测试它！确保重新启动服务器。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4f86" class="mi ku iq lz b gy mj mk l ml mm">MONGODB_URI=mongodb://localhost:27017/enamel_tutorial<br/>JWT_SECRET=thisissecret</span></pre><p id="2e92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开操场，注册你上次创建的用户。您需要到数据库复制粘贴用户id。</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/907e97402acb3565a6117deb2f3be35c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bF4OooT2DZVyCDNryS8YMA.png"/></div></div></figure><p id="7332" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您去检查您的数据库，您应该看到您的团队已经创建。注意它在<code class="fe lw lx ly lz b">folders</code>下面。这是因为团队是一种特殊类型的文件夹。</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/b173b404ebf25d5f1c976fa77e2096f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cvoHi5VLUP09ZXYRpsHjA.png"/></div></div></figure><p id="9ae7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在API正在工作，让我们构建一个注册表单。</p><p id="0742" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lw lx ly lz b">client/src/router.js</code>现在看起来像是:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="72ca" class="mi ku iq lz b gy mj mk l ml mm">import Vue from 'vue'<br/>import Router from 'vue-router'<br/>import Home from './views/Home.vue'<br/>import Signup from './views/Signup.vue'</span><span id="a13f" class="mi ku iq lz b gy mn mk l ml mm">Vue.use(Router)</span><span id="2a5a" class="mi ku iq lz b gy mn mk l ml mm">const router = new Router({<br/>  mode: 'history',<br/>  routes: [<br/>    {<br/>      path: '/',<br/>      name: 'home',<br/>      component: Home,<br/>      meta: { title: 'enamel' }<br/>    },<br/>    {<br/>      path: '/signup/:id',<br/>      name: 'signup',<br/>      component: Signup,<br/>      meta: { title: 'Signup - enamel' }<br/>    },<br/>  ]<br/>})</span><span id="c3b1" class="mi ku iq lz b gy mn mk l ml mm">router.afterEach((to, from) =&gt; {<br/>  document.title = to.meta.title<br/>})</span><span id="933d" class="mi ku iq lz b gy mn mk l ml mm">export default router</span></pre><p id="12ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我添加了标题元字段，以便每条路径显示不同的文档标题。</p><p id="8717" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将注册查询添加到<code class="fe lw lx ly lz b">client/src/constants/query.gql</code>:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4aad" class="mi ku iq lz b gy mj mk l ml mm">mutation Signup($id: String!, $firstname: String!, $lastname: String!, $password: String!) {<br/>  signup(id: $id, firstname: $firstname, lastname: $lastname, password: $password) {<br/>    token<br/>    user {<br/>      id<br/>      email<br/>    }<br/>  }<br/>}</span></pre><p id="56f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是注册Vue组件。这里没有什么太疯狂的。注册用户后，它将令牌和用户id保存到localstorage。然后它应该把你带到workplace，但是因为我们还没有构建，它现在把消息打印到控制台。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bc5c" class="mi ku iq lz b gy mj mk l ml mm">// client/src/views/Signup.vue<br/>&lt;template&gt;<br/>  &lt;el-container&gt;<br/>    &lt;el-header &gt;<br/>    &lt;/el-header&gt;</span><span id="eac3" class="mi ku iq lz b gy mn mk l ml mm">&lt;el-main&gt;<br/>      &lt;div class="container-center"&gt;<br/>        &lt;div&gt;Welcome to enamel! Finish setting up your account&lt;/div&gt;</span><span id="0fe0" class="mi ku iq lz b gy mn mk l ml mm">&lt;div v-if="error" class="error"&gt;<br/>          {{ error }}<br/>        &lt;/div&gt;</span><span id="3dcc" class="mi ku iq lz b gy mn mk l ml mm">&lt;el-form ref="form" :model="form"&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;label&gt;First name&lt;/label&gt;<br/>            &lt;el-input v-model="form.firstname" placeholder="Your first name"&gt;&lt;/el-input&gt;<br/>            &lt;label&gt;Last name&lt;/label&gt;<br/>            &lt;el-input v-model="form.lastname" placeholder="Your last name"&gt;&lt;/el-input&gt;<br/>            &lt;label&gt;Password&lt;/label&gt;<br/>            &lt;el-input v-model="form.password" type="password" placeholder="Password"&gt;&lt;/el-input&gt;<br/>          &lt;/el-form-item&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;el-button type="primary" <a class="ae ks" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="signup"&gt;Complete&lt;/el-button&gt;<br/>          &lt;/el-form-item&gt;<br/>        &lt;/el-form&gt;</span><span id="4154" class="mi ku iq lz b gy mn mk l ml mm">&lt;/div&gt;</span><span id="5c35" class="mi ku iq lz b gy mn mk l ml mm">&lt;/el-main&gt;<br/>  &lt;/el-container&gt;</span><span id="dd07" class="mi ku iq lz b gy mn mk l ml mm">&lt;/template&gt;</span><span id="25a4" class="mi ku iq lz b gy mn mk l ml mm">&lt;script&gt;<br/>import { Signup } from '../constants/query.gql'</span><span id="20d1" class="mi ku iq lz b gy mn mk l ml mm">export default {<br/>  data() {<br/>    return {<br/>      error: false,<br/>      form: {<br/>        firstname: '',<br/>        lastname: '',<br/>        password: '',<br/>      }<br/>    }<br/>  },<br/>  methods: {<br/>    async signup() {<br/>      const { firstname, lastname, password } = this.form<br/>      if (!(firstname &amp;&amp; lastname &amp;&amp; password)) {<br/>        this.error = 'Please complete the form'<br/>        return<br/>      }<br/>      this.$apollo.mutate({<br/>        mutation: Signup,<br/>        variables: {<br/>          id: this.$route.params.id,<br/>          firstname,<br/>          lastname,<br/>          password<br/>        }<br/>      }).then(({data: {signup}}) =&gt; {<br/>        const id = signup.user.id<br/>        const token = signup.token<br/>        this.saveUserData(id, token)</span><span id="1c88" class="mi ku iq lz b gy mn mk l ml mm">        // this.$router.push({name: 'workspace'})<br/>        console.log('success!') // For now just print<br/>      }).catch((error) =&gt; {<br/>        this.error = 'Something went wrong'<br/>        console.log(error)<br/>      })<br/>    },<br/>    saveUserData (id, token) {<br/>      localStorage.setItem('user-id', id)<br/>      localStorage.setItem('user-token', token)<br/>      this.$root.$data.userId = localStorage.getItem('user-id')<br/>    },<br/>  }<br/>}<br/>&lt;/script&gt;</span><span id="6750" class="mi ku iq lz b gy mn mk l ml mm">&lt;style scoped&gt;</span><span id="86fc" class="mi ku iq lz b gy mn mk l ml mm">.el-button {<br/>  width: 100%;<br/>}</span><span id="1e0f" class="mi ku iq lz b gy mn mk l ml mm">.error {<br/>  padding-top: 10px;<br/>}<br/>&lt;/style&gt;</span></pre><p id="77d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们如何到达注册页面呢？回想一下上一篇文章，在提交电子邮件表单后，您应该会看到一条消息，上面写着“请检查您的电子邮件”。</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mx"><img src="../Images/109565e621f06999b6668ec85aec5c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzRQ6RauJfNpRPegX7ALiQ.png"/></div></div></figure><p id="68b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在制作过程中，我会发送一封带有注册链接的电子邮件。然而，你可能不想设置你的电子邮件。所以我要把这个app的邮件部分做成加分材料。</p><p id="876f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，把你的id复制粘贴到地址栏。</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi my"><img src="../Images/149f88581d2f3c452bd55c98d1572520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RjXaAaXKWBmIQ9ztllGowQ.png"/></div></div></figure><p id="4df5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您提交表单，它将覆盖现有数据并创建另一个团队对象。这显然不是你想要的，但现在已经足够了。(实际上在生产中仍然是这样，但是，嘿，你必须动作快！)</p><h1 id="a0c7" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">注册</h1><p id="cb5d" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">让我们不要重复同样的过程并创建一个登录功能。将此添加到<code class="fe lw lx ly lz b">server/src/resolvers.js</code>:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="80ee" class="mi ku iq lz b gy mj mk l ml mm">async login (_, {email, password}) {<br/>  const user = await User.findOne({email})<br/>  if (!user) {<br/>    throw new Error('No user with that email')<br/>  }<br/>  const valid = await bcrypt.compare(password, user.password)<br/>  if (!valid) {<br/>    throw new Error('Incorrect password')<br/>  }<br/>  const token = jwt.sign({id: user.id, email}, JWT_SECRET)<br/>  return {token, user}<br/>},</span></pre><p id="433c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我几乎总是先用playground测试一个GraphQL API，然后创建一个前端。由于这类似于注册，我们将跳过这一步，转到前端，但我鼓励你在操场上尝试。</p><p id="e1f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">路由器:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d06a" class="mi ku iq lz b gy mj mk l ml mm">...<br/>import Login from './views/Login.vue'</span><span id="129f" class="mi ku iq lz b gy mn mk l ml mm">Vue.use(Router)</span><span id="7e9f" class="mi ku iq lz b gy mn mk l ml mm">const router = new Router({<br/>  mode: 'history',<br/>  routes: [<br/>    ...<br/>    {<br/>     path: '/login',<br/>     name: 'login',<br/>     component: Login,<br/>     meta: { title: 'Login - enamel' }<br/>    }<br/>  ]<br/>})</span></pre><p id="91ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">query.gql:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="d7ba" class="mi ku iq lz b gy mj mk l ml mm">mutation Login($email: String!, $password: String!) {<br/>  login(email: $email, password: $password) {<br/>    token<br/>    user {<br/>      id<br/>      email<br/>    }<br/>  }<br/>}</span></pre><p id="5609" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Login.vue:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="3023" class="mi ku iq lz b gy mj mk l ml mm">&lt;template&gt;<br/>  &lt;el-container&gt;<br/>    &lt;el-header&gt;<br/>    &lt;/el-header&gt;</span><span id="191e" class="mi ku iq lz b gy mn mk l ml mm">&lt;el-main&gt;<br/>      &lt;div class="container-center"&gt;<br/>        &lt;h2&gt;Log in&lt;/h2&gt;<br/>        <br/>        &lt;div v-if="error" class="error"&gt;<br/>          {{ error }}<br/>        &lt;/div&gt;</span><span id="9eed" class="mi ku iq lz b gy mn mk l ml mm">&lt;el-form ref="form" :model="form"&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;label&gt;Email&lt;/label&gt;<br/>            &lt;el-input v-model="form.email" placeholder="Email"&gt;&lt;/el-input&gt;<br/>            &lt;label&gt;Password&lt;/label&gt;<br/>            &lt;el-input v-model="form.password" type="password" placeholder="Password"&gt;&lt;/el-input&gt;<br/>          &lt;/el-form-item&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;el-button type="primary" <a class="ae ks" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>.once="login"&gt;Log in&lt;/el-button&gt;<br/>          &lt;/el-form-item&gt;<br/>        &lt;/el-form&gt;</span><span id="a8d5" class="mi ku iq lz b gy mn mk l ml mm">&lt;div&gt;<br/>          &lt;span&gt;Don't have an account?&lt;/span&gt;<br/>          &lt;router-link :to="{name: 'home'}" class="link"&gt;Create an account&lt;/router-link&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;</span><span id="6aff" class="mi ku iq lz b gy mn mk l ml mm">&lt;/el-main&gt;<br/>  &lt;/el-container&gt;</span><span id="5cb9" class="mi ku iq lz b gy mn mk l ml mm">&lt;/template&gt;</span><span id="298b" class="mi ku iq lz b gy mn mk l ml mm">&lt;script&gt;<br/>import { Login } from '../constants/query.gql'</span><span id="c1e6" class="mi ku iq lz b gy mn mk l ml mm">export default {<br/>  data() {<br/>    return {<br/>      error: false,<br/>      form: {<br/>        email: '',<br/>        password: '',<br/>      }<br/>    }<br/>  },<br/>  methods: {<br/>    async login() {<br/>      const { email, password } = this.form<br/>      if (email &amp;&amp; password) {<br/>        this.$apollo.mutate({<br/>          mutation: Login,<br/>          variables: { email, password }<br/>        }).then(async (data) =&gt; {<br/>          const login = data.data.login<br/>          const id = login.user.id<br/>          const token = login.token<br/>          this.saveUserData(id, token)<br/>          // this.$router.push({name: 'workspace'})<br/>          console.log('success')<br/>        }).catch((error) =&gt; {<br/>          this.error = 'Invalid email or password'<br/>          console.log(error)<br/>        })<br/>      }<br/>    },<br/>    saveUserData (id, token) {<br/>      localStorage.setItem('user-id', id)<br/>      localStorage.setItem('user-token', token)<br/>      this.$root.$data.userId = localStorage.getItem('user-id')<br/>    },<br/>  }<br/>}<br/>&lt;/script&gt;</span><span id="01b0" class="mi ku iq lz b gy mn mk l ml mm">&lt;style scoped&gt;<br/>.el-button {<br/>  width: 100%;<br/>}<br/>&lt;/style&gt;</span></pre><p id="a235" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它应该像您预期的那样工作:</p><figure class="ma mb mc md gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/e7ff91fc8cc040633303b24d990aff07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2JtJsf-Nsy-1r5ZcCdpTwg.png"/></div></div></figure><h1 id="3f85" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">额外材料:发送电子邮件</h1><p id="1d5e" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">对于那些真正想设置你的电子邮件的人，我将介绍一下代码。</p><p id="74c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最初我使用SendGrid。SendGrid有一个免费的计划和一个简单的API。很好…直到他们封了我的账户。我联系了支持人员，但至今没有得到任何回应。我能想到的唯一原因是我把发件人设定为<code class="fe lw lx ly lz b">noreply@enamel.tech</code>。我拥有该域名，但我没有商业电子邮件帐户。我以为只要我拥有这个域名，我就可以使用任何我想要的电子邮件地址。</p><p id="7ebf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">反正我这个前期买商务邮箱太便宜了(记住，我只有1个付费客户)，所以我用我的个人邮箱和nodemailer结算。</p><p id="d9b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经安装了nodemailer，所以我们只需要导入它。以下是为gmail设置nodemailer的方法:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="febd" class="mi ku iq lz b gy mj mk l ml mm">const nodeMailer = require('nodemailer')<br/>const { welcomeEmail } = require('./emails')</span><span id="8bf0" class="mi ku iq lz b gy mn mk l ml mm">const transporter = nodeMailer.createTransport({<br/>    host: 'smtp.gmail.com',<br/>    port: 465,<br/>    secure: true,<br/>    auth: {<br/>      user: process.env.FROM_EMAIL,<br/>      pass: process.env.GMAIL_PASSWORD<br/>    }<br/>})</span></pre><p id="d482" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个新文件<code class="fe lw lx ly lz b">server/src/emails.js</code>并添加以下代码:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="bce6" class="mi ku iq lz b gy mj mk l ml mm">const url = process.env.CLIENT_URL<br/>const fromEmail = process.env.FROM_EMAIL</span><span id="c821" class="mi ku iq lz b gy mn mk l ml mm">module.exports.welcomeEmail = function(email, user) {<br/>  const text = `<br/>Hi,<br/>Thank you for choosing enamel! <br/>You are just one click away from completing your account registration.</span><span id="bc0e" class="mi ku iq lz b gy mn mk l ml mm">Confirm your email:\n<br/>${url}/signup/${user.id}<br/>`</span><span id="6e69" class="mi ku iq lz b gy mn mk l ml mm">return {<br/>    to: `${email}`,<br/>    from: {<br/>      address: fromEmail,<br/>      name: 'enamel'<br/>    },<br/>    subject: 'Please complete your registration',<br/>    text<br/>  }<br/>}</span></pre><p id="fced" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一个客户端url以及电子邮件和密码的环境变量。请确保在更改后重新启动服务器。</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="4f94" class="mi ku iq lz b gy mj mk l ml mm">MONGODB_URI=mongodb://localhost:27017/enamel_tutorial<br/>JWT_SECRET=thisissecret<br/>CLIENT_URL=<a class="ae ks" href="http://localhost:8002" rel="noopener ugc nofollow" target="_blank">http://localhost:80</a>80<br/><a class="ae ks" href="mailto:FROM_EMAIL=youremail@gmail.com" rel="noopener ugc nofollow" target="_blank">FROM_EMAIL=youremail@gmail.com</a><br/>GMAIL_PASSWORD=mypassword</span></pre><p id="6139" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后给<code class="fe lw lx ly lz b">captureEmail</code>加一句台词:</p><pre class="ma mb mc md gt me lz mf mg aw mh bi"><span id="aa56" class="mi ku iq lz b gy mj mk l ml mm">async captureEmail (_, {email}) {<br/>  const isEmailTaken = await User.findOne({email})<br/>  if (isEmailTaken) {<br/>    throw new Error('This email is already taken')<br/>  }<br/>  const user = await User.create({<br/>    email,<br/>    role: 'Owner',<br/>    status: 'Pending'<br/>  })<br/>  // New code<br/>  transporter.sendMail(welcomeEmail(email, user))</span><span id="af1b" class="mi ku iq lz b gy mn mk l ml mm">  return user<br/>},</span></pre><p id="5bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在电子邮件表单中输入您的电子邮件(确保没有用户使用相同的电子邮件)，您应该会收到您自己的电子邮件。</p><h1 id="2104" class="kt ku iq bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">接下来:创建工作场所</h1><p id="be40" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">第3部分到此为止！需要的话可以看看<a class="ae ks" href="https://github.com/kenzotakahashi/enamel/tree/part3" rel="noopener ugc nofollow" target="_blank"> github </a>做参考。</p><p id="4f7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们已经为这个应用程序建立了基础，我们可以从这里加速。我知道到目前为止有点无聊，所以谢谢你的耐心。我不会以这种方式为初学者组织我的教程。对于初学者来说，最好忽略后端，先创建UI，这样你就可以快速了解应用程序的样子。但你不是初学者，对吧？</p><p id="d7f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-4-40fbe0625d32">第4部分</a>中，我们将创建工作区，您可以在其中创建文件夹和任务。</p><p id="1a88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">如果你喜欢这个帖子，请给它一些掌声！这激励我尽快写下一部分。</em></p></div></div>    
</body>
</html>