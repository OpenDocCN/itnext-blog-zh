<html>
<head>
<title>OPA/Rego — Generating Documentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OPA/减压阀—生成文档</h1>
<blockquote>原文：<a href="https://itnext.io/opa-rego-generating-documentation-2f5445090092?source=collection_archive---------5-----------------------#2021-09-20">https://itnext.io/opa-rego-generating-documentation-2f5445090092?source=collection_archive---------5-----------------------#2021-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0030" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我之前的博客中，我分享了一个叫做<a class="ae kl" href="https://github.com/plexsystems/konstraint" rel="noopener ugc nofollow" target="_blank"> konstraint </a>的工具的细节。该条目专注于生成YAML。作为后续，我将更深入地研究文档生成功能。</p><p id="5486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">许多编程语言在代码中使用文档约定，并且通常会有注释来支持解析器提取数据以生成文档。</p><p id="831e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Konstraint为rego语言做这件事。让我们看看rego header和可用的注释和输出文档:</p><pre class="km kn ko kp gt kq kr ks kt aw ku bi"><span id="c36c" class="kv kw iq kr b gy kx ky l kz la"># @title this is a basic title for my policy<br/>#<br/># This is the longer explanation of my policy details <br/># and the opinions it enforces</span><span id="b630" class="kv kw iq kr b gy lb ky l kz la"># @enforcement deny  # This is the default, but could be dryrun</span><span id="29d6" class="kv kw iq kr b gy lb ky l kz la"># The line below is used to generate the constraint by linking the resource types of interest to the policy<br/># @kinds core/pod bigquerydatasets.crnm.cloud.google.com/BigQueryDataset</span><span id="4815" class="kv kw iq kr b gy lb ky l kz la"># The line below defines parameters for the ConstraintTemplate. As such, you need to define the Constraints yourself.<br/># @parameter &lt;name&gt; array string<br/># @parameter resource_types array string</span></pre><ul class=""><li id="517e" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">@title —这将成为文档中策略的标题。它还将用于创建目录</li><li id="936c" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">@enforcement —记录策略是拒绝还是处于试运行模式。默认值为“拒绝”</li><li id="32c8" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">@ kinds—API group/resourceName格式的以空格分隔的资源列表，用于约束要附加到的内容。</li><li id="29f9" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">@ parameter定义约束模板CRD及其数据类型的参数</li></ul><p id="fc57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">konstraint doc将解析rego文件中的文档块，如上所示，并生成一个policies.md文件，其中包含目录和对每个策略的解释。</p><p id="c414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了演示这个工具和输出，我创建了一个样例存储库:【https://github.com/patpicos/rego_doc_gen<a class="ae kl" href="https://github.com/patpicos/rego_doc_gen" rel="noopener ugc nofollow" target="_blank"/></p><figure class="km kn ko kp gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lq"><img src="../Images/176ec6a7858838708de409b5c63e8fc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3daHp_-ZBLWyrahjcHScg.png"/></div></div></figure><h1 id="8089" class="ly kw iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">结论</h1><p id="0d4e" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">自动化文档生成是确保文档得到维护和保持最新的又一小步。make指令可以在预提交挂钩或CI管道中使用，以确保存储库在每次合并时都是最新的。</p></div></div>    
</body>
</html>