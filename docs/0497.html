<html>
<head>
<title>Learning to Write React Tests with the Example of React Tic Tac Toe App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以React Tic Tac Toe应用程序为例学习编写React测试</h1>
<blockquote>原文：<a href="https://itnext.io/learning-to-write-react-tests-on-example-of-react-tic-tac-toe-app-acf7ae2b94b8?source=collection_archive---------1-----------------------#2018-03-20">https://itnext.io/learning-to-write-react-tests-on-example-of-react-tic-tac-toe-app-acf7ae2b94b8?source=collection_archive---------1-----------------------#2018-03-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/53f70de75e5daef82e35055f3fc7e848.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/1*Y_2aqnkcrtkP0mopKTPyyQ.gif"/></div></div></figure><p id="f204" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为应用程序编写测试和编写代码本身一样重要。它帮助您捕捉恼人的错误，并使您的代码更易于维护和理解。</p><p id="c19f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将尝试使用脸书开发的<a class="ae kw" href="https://facebook.github.io/jest/docs/en/tutorial-react.html" rel="noopener ugc nofollow" target="_blank"> Jest npm包</a>和AirBnb创建的<a class="ae kw" href="https://www.npmjs.com/package/enzyme" rel="noopener ugc nofollow" target="_blank">酶测试工具</a>为一个简单的反应井字游戏应用程序编写测试。你可以遵循官方的<a class="ae kw" href="https://reactjs.org/tutorial/tutorial.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>关于构建基本井字游戏的教程，或者只使用同一链接下提供的最终代码。</p><p id="2b80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们开始之前，如果您没有安装<strong class="ka ir"> yarn </strong> package manager，我建议您在终端中运行以下命令来安装它:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="cbfe" class="lg lh iq lc b gy li lj l lk ll">npm install -g yarn</span></pre><p id="e750" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，为了能够测试单独的组件，我们将不得不修改这个应用程序的结构，并将每个组件移动到相应命名的单独文件夹中。</p><p id="337d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的<strong class="ka ir"> /src </strong>文件夹中创建一个新的<strong class="ka ir">组件</strong>文件夹，结构如下:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/b681984ed4e6488d335b41925c8ef1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*kGFgyPDBk5emqubQ3K1SkA.png"/></div></figure><p id="7b7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记为每个组件添加导出默认值，包括React的导入和在每个父组件中重用的子组件。</p><p id="86e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的index.js基本上应该只将我们的主要容器组件游戏呈现给React DOM:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="55ca" class="lg lh iq lc b gy li lj l lk ll">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import Game from './Components/Game/game'<br/>import './index.css';</span><span id="6a5a" class="lg lh iq lc b gy ln lj l lk ll">// ========================================</span><span id="0c14" class="lg lh iq lc b gy ln lj l lk ll">ReactDOM.render(&lt;Game /&gt;, document.getElementById("root"));</span></pre><p id="789f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设您遵循文档中的说明，并使用<strong class="ka ir"> create-react-app </strong>包来创建您的新应用，您应该知道<strong class="ka ir"> jest </strong>测试环境<strong class="ka ir">已经包含在该包中</strong>。单独安装<strong class="ka ir"> jest </strong>会破坏您的测试并导致以下错误:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a8f6" class="lg lh iq lc b gy li lj l lk ll">TypeError: environment.setup is not a function</span></pre><p id="54a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是Enzyme需要单独安装，所以运行:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="be49" class="lg lh iq lc b gy li lj l lk ll">yarn add enzyme enzyme-adapter-react-16 react-test-renderer</span></pre><p id="6332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">适配器也需要配置，创建一个名为<strong class="ka ir"> setUpTests.js </strong>的新文件，并在其中插入以下内容:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="e1d8" class="lg lh iq lc b gy li lj l lk ll">import { configure } from 'enzyme';</span><span id="0170" class="lg lh iq lc b gy ln lj l lk ll">import Adapter from 'enzyme-adapter-react-16';</span><span id="bcb5" class="lg lh iq lc b gy ln lj l lk ll">configure({ adapter: new Adapter() });</span></pre><p id="ca35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们最终开始编写测试之前的最后一步。除了组件文件之外，在每个组件文件夹中创建一个测试文件，分别命名为board.test.js、game.test.js和square.test.js。你可以在这里了解更多关于测试文件名约定<a class="ae kw" href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#filename-conventions" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="8c35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的/src文件夹结构现在应该如下所示:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/879035bbfc0872311341c4ac326e1bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*RjBSEJtFWjN2d7mupsjewQ.png"/></div></figure><p id="2045" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从每个组件最简单的测试开始，看看它们是否都没有错误地呈现:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="fa28" class="lg lh iq lc b gy li lj l lk ll"><em class="lp">// Game/game.test.js</em><br/>import React from 'react'<br/>import Game from './game'<br/>import {shallow} from 'enzyme'</span><span id="f42b" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  shallow(&lt;Game /&gt;);<br/>});</span><span id="7efd" class="lg lh iq lc b gy ln lj l lk ll"><em class="lp">// Board/board.test.js</em><br/>import React from 'react'<br/>import Board from './board'<br/>import {shallow} from 'enzyme'</span><span id="bbd0" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  shallow(&lt;Board /&gt;);<br/>});</span><span id="7b8a" class="lg lh iq lc b gy ln lj l lk ll"><em class="lp">// Square/square.test.js<br/></em>import React from 'react'<br/>import Square from './square'<br/>import {shallow} from 'enzyme'</span><span id="768a" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  shallow(&lt;Square/&gt;);<br/>});</span></pre><p id="f0c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，<strong class="ka ir">浅层</strong>渲染用于隔离的单元测试，但是如果您想要创建一些完整的渲染测试来确保组件正确集成，Enzyme package也提供了<a class="ae kw" href="http://airbnb.io/enzyme/docs/api/mount.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">挂载</strong> </a> <strong class="ka ir"> </strong>功能。</p><p id="ce73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在您的终端中通过<strong class="ka ir"> npm test </strong>运行测试。现在，您应该看到游戏和方块通过了两个测试，但是棋盘有一个测试失败:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="5feb" class="lg lh iq lc b gy li lj l lk ll">TypeError: Cannot read property '0' of undefined</span></pre><p id="727e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如上所述，我们正在使用独立的单元测试，我们的电路板组件需要一个<strong class="ka ir">正方形</strong>道具传递给它，以便正确渲染。为了查看该组件是否正确呈现，让我们在测试中显式地将squares prop传递给它:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="e048" class="lg lh iq lc b gy li lj l lk ll">import React from 'react'<br/>import Board from './board'<br/>import {shallow} from 'enzyme'</span><span id="0687" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  <strong class="lc ir">let squares = Array(9).fill(null)</strong><br/>  shallow(&lt;Board <strong class="lc ir">squares={squares}</strong>/&gt;);<br/>});</span></pre><p id="9209" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这三项测试现在都应该通过了！请注意，没有必要在每次做出更改时都重新启动测试。运行<strong class="ka ir"> npm test </strong>命令时，jest测试环境将自动启动，前缀为<code class="fe lq lr ls lc b">--watch</code>，字面意思是<strong class="ka ir">观察</strong>文件的变化，并重新启动与这些变化的文件相关的测试。</p><p id="0d38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们测试一下，单击棋盘方格时会触发on click事件。由于Board渲染Square组件并将onClick事件作为道具传递给它们，我们将需要渲染我们的Board组件及其子Square组件，因此我们将使用Enzyme提供的<strong class="ka ir"> mount() </strong>函数，而不是<strong class="ka ir"> shallow() </strong>。我们还必须创建一个“假”onClick事件，我们通常会使用jest mock函数<code class="fe lq lr ls lc b">jest.fn()</code>将该事件从游戏组件传递到电路板。我们还将利用Enzyme的<a class="ae kw" href="http://airbnb.io/enzyme/docs/api/ReactWrapper/find.html" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">find()</strong></a><strong class="ka ir"/>选择器找到我们要模拟的组件点击使用<strong class="ka ir"/><a class="ae kw" href="http://airbnb.io/enzyme/docs/api/ShallowWrapper/simulate.html" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">simulate()</strong></a>。最后，我们将通过使用Jest的<a class="ae kw" href="https://facebook.github.io/jest/docs/en/expect.html" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">toBeCalledWith()</strong></a>来查看onClick是否被实际调用以及使用了哪些参数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="5a21" class="lg lh iq lc b gy li lj l lk ll">import React from 'react'<br/>import Board from './board'<br/>import {shallow, <strong class="lc ir">mount</strong>} from 'enzyme'</span><span id="48f4" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  let squares = Array(9).fill(null)<br/>  shallow(&lt;Board squares={squares}/&gt;);<br/>});</span><span id="bec1" class="lg lh iq lc b gy ln lj l lk ll">it('<strong class="lc ir">calls onClick event on click of a board square</strong>', () =&gt;{<br/>  let squares = Array(9).fill(null)<br/>  const onClick = <strong class="lc ir">jest.fn()</strong>;<br/>  let wrapper = mount(&lt;Board squares={squares} <strong class="lc ir">onClick={onClick}</strong>/&gt;);<br/>  wrapper.<strong class="lc ir">find</strong>('button.square').first().<strong class="lc ir">simulate</strong>('click');<br/>  expect(onClick).<strong class="lc ir">toBeCalledWith(0)</strong><br/>})</span></pre><p id="b98f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，您需要在文件顶部导入挂载函数。此外，我们希望0是调用onClick事件的参数，因为我们模拟的是在棋盘的第一个方格上单击，该方格在方格数组中的索引为0。</p><p id="764a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查您的终端，看看这个测试现在也通过了！</p><p id="8be0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的下一个测试中，我们将检查游戏状态是否正确呈现。现在，我们将从简单检查“下一个玩家:”开始，并确保在游戏开始前，下一个玩家是X，在第一步移动后，它变为o。在这种情况下，我们将不得不再次安装所有组件，因此将<strong class="ka ir"> mount </strong>添加到您的酶导入中。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="fd5c" class="lg lh iq lc b gy li lj l lk ll">import React from 'react'<br/>import Game from './game'<br/>import {shallow, <strong class="lc ir">mount</strong>} from 'enzyme'</span><span id="4429" class="lg lh iq lc b gy ln lj l lk ll">it('renders without crashing', () =&gt; {<br/>  shallow(&lt;Game /&gt;);<br/>});</span><span id="42e8" class="lg lh iq lc b gy ln lj l lk ll">it('<strong class="lc ir">renders game status correctly</strong>', () =&gt; {<br/>  const wrapper = mount(&lt;Game/&gt;)<br/>  const firstPlayer = wrapper.find('div.game-info').children().first().text()<br/>  <strong class="lc ir">expect</strong>(firstPlayer).<strong class="lc ir">toEqual('Next player: X')</strong></span><span id="a448" class="lg lh iq lc b gy ln lj l lk ll">const button = wrapper.find('button.square').first()<br/>  button.simulate('click')<br/>  const secondPlayer = wrapper.find('div.game-info').children().first().text()<br/>  <strong class="lc ir">expect</strong>(secondPlayer).<strong class="lc ir">toEqual('Next player: O')</strong><br/>})</span></pre><p id="5814" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，我们利用jest提供的toEqual()方法来确定特定元素(div.game-info)的文本内容是否是我们所期望的。</p><p id="d528" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们必须添加到状态检查中的最后一件事是在游戏结束时宣布获胜者。我们将不得不模拟方块上的点击，使用Enzyme的<strong class="ka ir">指定方块数。at(index) </strong>方法，该方法应在当前包装器的给定索引处返回节点周围的包装器(&lt; Game / &gt;)。由于我们已经在第一个方块上点击了一次，使我们的前半部分测试生效，我们将继续从第二个回合开始轮流进行。因此，让我们用以下内容更新我们的测试:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f510" class="lg lh iq lc b gy li lj l lk ll">it('renders game status correctly', () =&gt; {<br/>  const wrapper = mount(&lt;Game/&gt;)<br/>  const firstPlayer = wrapper.find('div.game-info').children().first().text()<br/>  expect(firstPlayer).toEqual('Next player: X')</span><span id="fd06" class="lg lh iq lc b gy ln lj l lk ll">const button = wrapper.find('button.square').first()<br/>  button.simulate('click')<br/>  const secondPlayer = wrapper.find('div.game-info').children().first().text()<br/>  expect(secondPlayer).toEqual('Next player: O')</span><span id="e42d" class="lg lh iq lc b gy ln lj l lk ll">//player 2<br/>  const <strong class="lc ir">turn2</strong> = wrapper.find('button.square')<strong class="lc ir">.at(1)</strong><br/>  turn2.simulate('click')<br/>  //player 1<br/>  const <strong class="lc ir">turn3</strong> = wrapper.find('button.square')<strong class="lc ir">.at(4)</strong><br/>  turn3.simulate('click')<br/>  //player 2<br/>  const <strong class="lc ir">turn4</strong> = wrapper.find('button.square')<strong class="lc ir">.at(5)</strong><br/>  turn4.simulate('click')<br/>  //player 1<br/>  const <strong class="lc ir">turn5 </strong>= wrapper.find('button.square')<strong class="lc ir">.at(8)</strong><br/>  turn5.simulate('click')<br/>  <br/>  const <strong class="lc ir">winner</strong> = wrapper.find('div.game-info').children().first().text()<br/>  expect(<strong class="lc ir">winner</strong>).<strong class="lc ir">toEqual('Winner: X')</strong><br/>})</span></pre><p id="8e4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你遵循正确的，你所有的测试现在应该通过！如果你认为你错过了什么，这里有一个链接到我的<a class="ae kw" href="https://github.com/nothingisfunny/tic-tac-toe-react-writing-tests" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">Github repo</strong></a><strong class="ka ir"/>与最终代码<strong class="ka ir">。</strong></p><p id="b13c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇博客文章提供了Jest和酶测试环境如何与React一起工作的简短概述，应该足以让您入门。点击下面的官方文档链接，了解更多信息:</p><p id="e91c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://facebook.github.io/jest/docs/en/api.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">笑话</strong> </a></p><p id="6178" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="http://airbnb.io/enzyme/docs/api/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">酶</strong> </a></p></div></div>    
</body>
</html>