<html>
<head>
<title>Setting up AWS Lambda with Confluent Cloud Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用融合云Kafka设置自动气象站Lambda</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-aws-lambda-with-confluent-kafka-a6072fbabc52?source=collection_archive---------2-----------------------#2022-09-29">https://itnext.io/setting-up-aws-lambda-with-confluent-kafka-a6072fbabc52?source=collection_archive---------2-----------------------#2022-09-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="113e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">技术演练</p><p id="674f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">无服务器是一个全新的计算模式，lambda是一个伟大的工具，但直到最近，它还与AWS服务紧密耦合，你想从SQS开发Lambda吗？简单，API网关？不言而喻。S3事件？当然可以。和大量其他可用的选项。但对我来说，至少在AWS服务的触发器上有所欠缺——特别是缺少Kafka集成。</p><p id="aa0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我需要对排序和持久性有高保证的分区消息流时，Kafka是我的首选解决方案。合流是我的首选Kafka提供商(尤其是“无服务”合流云产品)。但是，当我需要将一个无服务器Lambda连接到一个融合的云Kafka主题时，会发生什么呢？直到最近还没有“AWS优先”的解决方案(例如，Confluent为lambda 提供了一个内置的“sink”连接器，作为其托管Kafka connect产品的一部分)。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/5d16aeddad8cff18e0216c3896702a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiBPCQDpVskmbYV4Noz62A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">由OpenAI DALL-E生成</figcaption></figure><p id="150d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请看:最近AWS宣布Lambda现在支持Kafka。但是阅读<a class="ae kl" href="https://docs.aws.amazon.com/lambda/latest/dg/with-kafka.html" rel="noopener ugc nofollow" target="_blank">文档</a>主要是关于支持内置的AWS Kafka产品:MSK，并缺乏关于如何与融合的Kafka一起工作的文档。Serverless是一个流行的框架，它抽象了lambda以用于常见用例，现在也有了与Kafka一起使用的<a class="ae kl" href="https://www.serverless.com/framework/docs/providers/aws/events/kafka" rel="noopener ugc nofollow" target="_blank">文档</a>。不幸的是，这两个文档都有些含糊不清，尤其是在认证方面。不同身份验证选项的含义是什么？我们应该如何构造引用的secret manager机密？我想不通。找不到融合的卡夫卡的例子。</p><p id="f5f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我冒险尝试，并设法在一个私人项目中建立了它。几个星期后，我们在工作中遇到了这种情况，虽然我很高兴我有一个工作示例，但我决定记录这个(简单但没有记录的)过程。</p><p id="0a52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看一下设置的过程。我将重点介绍如何设置Kafka lambda触发器，因为其余部分非常简单，文档提供了预期数据结构的良好工作示例。</p><h1 id="aee0" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">设置Kafka触发器:</h1><p id="bd0a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">首先，让我们指定引导服务器(从汇合UI或CLI粘贴的副本)并输入主题名称。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mf"><img src="../Images/22b0f4a8aa25580bf98112cd754d77f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MKepza0C1uV5Dy6CQGbyhw.jpeg"/></div></div></figure><p id="2758" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您需要对消费者组id进行特定控制，那么选择它，大多数情况下不会这样，您可以跳过它</p><p id="f97f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是棘手的部分。认证，如果你使用的是无服务器框架(或者其他Cloudformation之上的抽象)，它在<em class="mg"> accessConfiguration </em>下。或者在身份验证下的UI中</p><p id="a962" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该从UI中选择BASIC_AUTH，或者(<em class="mg"> saslPlainAuth </em>用于代码描述的路径)并且作为一个值，您应该提供一个<a class="ae kl" href="https://aws.amazon.com/secrets-manager/" rel="noopener ugc nofollow" target="_blank">AWS secrets manager</a>“secret”的ARN。请注意，如果您是用代码来做这件事，您还需要为特定的lambda角色提供相关的IAM策略，允许它读取这个秘密。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/e4df394e72f291eef0eb467f6ada86aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KuP58blLpYxCpzjLBdYp_w.png"/></div></div></figure><p id="3011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是棘手的部分，这不是很好的记录。在Amazon Secrets manager(应该在设置lambda之前就存在)中，您应该以这种格式创建一个秘密:</p><blockquote class="mi mj mk"><p id="eeb8" class="jn jo mg jp b jq jr js jt ju jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj kk ij bi translated">{ "用户名":"汇合用户名"，"密码:"汇合密钥" }</p></blockquote><p id="e02a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，您可以用在融合UI或<a class="ae kl" href="https://docs.confluent.io/cloud/current/access-management/user-service-example.html#step-5-create-service-accounts-and-api-key-secret-pairs" rel="noopener ugc nofollow" target="_blank"> CLI </a>中创建用于访问集群的服务帐户和密钥时提供的用户名和密钥来替换“融合用户名”和“融合密钥”。</p><p id="6d94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是全部，现在你有一个AWS无服务器lambda与融合的独立Kafka设置连接。</p><p id="47e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">资源:</p><ul class=""><li id="2786" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><a class="ae kl" href="https://www.serverless.com/framework/docs/providers/aws/events/kafka" rel="noopener ugc nofollow" target="_blank">无服务器kafka文档</a></li><li id="edd3" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae kl" href="https://docs.aws.amazon.com/lambda/latest/dg/with-kafka.html" rel="noopener ugc nofollow" target="_blank">带kafka触发器文档的AWS lambda</a></li></ul></div></div>    
</body>
</html>