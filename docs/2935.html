<html>
<head>
<title>Adding Commento to React Apps (like Gatsby)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Commento添加到React应用程序(如Gatsby)</h1>
<blockquote>原文：<a href="https://itnext.io/adding-commento-to-react-apps-like-gatsby-871824fb57ae?source=collection_archive---------3-----------------------#2019-09-02">https://itnext.io/adding-commento-to-react-apps-like-gatsby-871824fb57ae?source=collection_archive---------3-----------------------#2019-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fb769f75eca462f0d9cb48019e3eceaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BsD3iHYaYyRcIj7gozi1MQ.png"/></div></div></figure><p id="db02" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我最近用Commento 替换了<a class="ae kw" href="https://nehalist.io/no-more-disqus-hello-commento" rel="noopener ugc nofollow" target="_blank"> Disqus，所以我认为分享如何将一个不同的评论系统嵌入到你的Gatsby站点(或一般的React应用程序)是一个好主意。</a></p><h1 id="40a7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">零依赖分量</h1><p id="5356" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Disqus有一个<a class="ae kw" href="https://github.com/disqus/disqus-react" rel="noopener ugc nofollow" target="_blank">官方包</a>,用于将它嵌入到React应用程序中，我曾经将Disqus添加到我的博客中。对于Commento，我想摆脱额外的依赖；额外的依赖增加了维护，并且总是伴随着一定的风险。这并不是说依赖开源是一个坏主意——只是有时候为小东西添加<a class="ae kw" href="https://www.npmjs.com/package/isarray" rel="noopener ugc nofollow" target="_blank">一个包只是过度夸张，不值这个价。</a></p><p id="1cbf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我自己实现了一个<em class="ma">非常</em>小的组件，负责用不到40行代码嵌入Commento。</p><blockquote class="mb mc md"><p id="2169" class="jy jz ma ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated"><em class="iq">由于大多数评论系统都以相同的方式工作(通过在页面中嵌入一个简单的JavaScript文件)，这种方法应该适用于其他系统，如</em><a class="ae kw" href="https://posativ.org/isso/" rel="noopener ugc nofollow" target="_blank"><em class="iq">Isso</em></a><em class="iq">、</em><a class="ae kw" href="https://schnack.cool/" rel="noopener ugc nofollow" target="_blank"><em class="iq">Schnack</em></a><em class="iq"/><a class="ae kw" href="https://remark42.com/" rel="noopener ugc nofollow" target="_blank"><em class="iq">remark 42</em></a><em class="iq">等。也是(有小调整)。</em></p></blockquote><p id="4d6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它是一个功能组件，利用钩子将Commento嵌入到所需的页面上。此外，它使用两个助手函数(借用自<a class="ae kw" href="https://github.com/disqus/disqus-react/blob/master/src/utils.js#L3" rel="noopener ugc nofollow" target="_blank"> disqus-react </a>)来添加和删除页面中的脚本。</p><p id="1ef8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">整个实现相当简单:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="4dfb" class="mq ky iq mm b gy mr ms l mt mu">import React, {useEffect} from 'react';</span><span id="edcb" class="mq ky iq mm b gy mv ms l mt mu">// Helper to add scripts to our page<br/>const insertScript = (src, id, parentElement) =&gt; {<br/>  const script = window.document.createElement('script');<br/>  script.async = true;<br/>  script.src   = src;<br/>  script.id    = id;<br/>  parentElement.appendChild(script);</span><span id="5bc6" class="mq ky iq mm b gy mv ms l mt mu">return script;<br/>};</span><span id="4bd0" class="mq ky iq mm b gy mv ms l mt mu">// Helper to remove scripts from our page<br/>const removeScript = (id, parentElement) =&gt; {<br/>  const script = window.document.getElementById(id);<br/>  if (script) {<br/>    parentElement.removeChild(script);<br/>  }<br/>};</span><span id="d433" class="mq ky iq mm b gy mv ms l mt mu">// The actual component<br/>const Commento = ({id}) =&gt; {<br/>  useEffect(() =&gt; {<br/>    // If there's no window there's nothing to do for us<br/>    if (! window) {<br/>      return;<br/>    }<br/>    const document = window.document;<br/>    // In case our #commento container exists we can add our commento script<br/>    if (document.getElementById('commento')) {<br/>      insertScript(`&lt;your commento url&gt;/js/commento.js`, `commento-script`, document.body);<br/>    }</span><span id="225c" class="mq ky iq mm b gy mv ms l mt mu">// Cleanup; remove the script from the page<br/>    return () =&gt; removeScript(`commento-script`, document.body);<br/>  }, [id]);</span><span id="c751" class="mq ky iq mm b gy mv ms l mt mu">return &lt;div id={`commento`} /&gt;<br/>};</span><span id="241d" class="mq ky iq mm b gy mv ms l mt mu">export default Commento;</span></pre><p id="17c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记用正确的URL替换<code class="fe mw mx my mm b">&lt;your commento url&gt;</code>。</p><p id="2b92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦找到相关联的容器(其id等于<code class="fe mw mx my mm b">commento</code>)Commento脚本就会被添加到我们的页面中，并且一旦<code class="fe mw mx my mm b">id</code>属性(应该是文章或页面id)发生变化就会被重新呈现(更多信息，请参见<a class="ae kw" href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" rel="noopener ugc nofollow" target="_blank">通过跳过效果优化性能</a>)。</p><p id="b958" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在可以通过简单地将<code class="fe mw mx my mm b">&lt;Commento id={uniquePostId} /&gt;</code>组件添加到我们想要添加评论的地方来为所有页面添加评论。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="d5cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ma">如果你喜欢这篇文章，请留下👏，关注我上</em> <a class="ae kw" href="https://twitter.com/nehalist" rel="noopener ugc nofollow" target="_blank"> <em class="ma">推特</em> </a> <em class="ma">并订阅</em> <a class="ae kw" href="https://nehalist.io/newsletter/" rel="noopener ugc nofollow" target="_blank"> <em class="ma">我的快讯</em> </a> <em class="ma">。本帖原载于2019年9月2日</em> <a class="ae kw" href="https://nehalist.io/adding-commento-to-react-apps-like-gatsby" rel="noopener ugc nofollow" target="_blank"> <em class="ma">我的博客</em> </a> <em class="ma">。</em></p></div></div>    
</body>
</html>