<html>
<head>
<title>The only guide you need for a static website in Azure — Part 2 Host your site using Azure Blob Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure中静态网站的唯一指南——第2部分使用Azure Blob存储托管您的站点</h1>
<blockquote>原文：<a href="https://itnext.io/the-only-guide-you-need-for-a-static-website-in-azure-part-2-host-your-static-site-in-azure-9114b7069db2?source=collection_archive---------1-----------------------#2021-03-22">https://itnext.io/the-only-guide-you-need-for-a-static-website-in-azure-part-2-host-your-static-site-in-azure-9114b7069db2?source=collection_archive---------1-----------------------#2021-03-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/596337fef90554f8997fc47259be38db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2RRzCrvOwS1XWbKDf5qIg.jpeg"/></div></div></figure><p id="fb49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你正在阅读这篇文章，很可能你想创建自己的静态网站，想了解更多关于静态站点生成器的信息，想知道如何使用Azure服务托管你的静态网站，或者想知道如何自动化你的web代码的完全集成和你的站点构建的部署。不管怎样，这一系列的博文都是为你准备的！</p><p id="ffb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文是系列文章的一部分，包括:</p><ul class=""><li id="9db3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">对于Azure中的静态网站，你需要的唯一指南是:第1部分:创建一个静态网站。在这篇文章中，我介绍了什么是静态网站，有什么可以选择，以及如何创建一个(本地)静态网站。</li><li id="bd10" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><a class="ae lf" href="#" rel="noopener ugc nofollow">Azure静态网站的唯一指南——第2部分:使用Azure Blob存储托管你的站点</a>。在这篇文章中，我介绍了如何在Azure Blob存储中托管静态网站，有什么可供选择，以及一些关于内容交付网络(CDN)的基础知识。你现在在这里。</li><li id="b414" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><a class="ae lf" href="https://rolfschutten.medium.com/e53aa65c1fba?source=friends_link&amp;sk=60a4f5bb7a2fd07907df311461f00409" rel="noopener">Azure静态网站的唯一指南——第3部分:使用Azure DevOps管道实现自动化</a>。在本文中，我将介绍什么是Azure DevOps服务，以及如何将静态网站的构建和部署自动化到Azure storage。</li></ul><p id="4c91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。在本文中，我们将讨论第二部分:使用Azure Blob存储托管您的站点。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="5d6c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">了解Azure Blob存储</h1><p id="2ee8" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">Azure Blob Storage是微软在Azure中的对象存储解决方案。Blob存储用于存储blob(二进制大型对象)，这是非结构化数据。这是不符合某些数据模型或定义的数据，如文本或二进制数据。Blob存储由三种类型的资源组成:帐户、帐户中的容器和容器中的blob(见下图)。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/5db687aaebc0840de92cd507571f2d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*tN6tc7wg3gTsENwzhgWhoA.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由Rolf Schutten上传</em><a class="ae lf" href="https://www.schutten.cloud/" rel="noopener ugc nofollow" target="_blank"><em class="ne">Schutten . cloud</em></a></figcaption></figure><p id="2ace" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，存储帐户可以公开访问。但是，容器和blob对象不是。显然，您可以根据自己的需要定制访问级别。可以通过格式为<a class="ae lf" href="https://youraccountaccount.blob.core.windows.net/yourcontainer/yourblob" rel="noopener ugc nofollow" target="_blank"><em class="nf">https://your account account . blob . core . windows . net/your container/your blob</em></a>的URL访问这些文件(考虑到您的访问级别和权限)。</p><p id="c930" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想了解更多关于Azure Blob存储的知识，微软有大量的<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/blobs/" rel="noopener ugc nofollow" target="_blank">文档</a>可用于这个对象存储解决方案。</p><h2 id="d3e1" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">Azure存储冗余</h2><p id="cf42" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">Azure存储提供了许多冗余选择。下面是对这些选择的解释。你也可以在<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy" rel="noopener ugc nofollow" target="_blank">微软文档</a>网站上找到所有这些信息。物体的成本和耐用性依次增加。这意味着物品的耐久性越高，成本就越高。要了解准确和最新的价格，请访问<a class="ae lf" href="https://azure.microsoft.com/en-us/pricing/details/storage/blobs/" rel="noopener ugc nofollow" target="_blank"> Azure Blob存储定价</a>页面。</p><p id="3281" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">本地冗余存储(LRS) </strong></p><p id="4fed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本地冗余存储(LRS)在主区域的单个数据中心内将您的数据复制三次。在给定的一年内，LRS提供至少99.999999999% (11个9)的物体耐久性。下图显示了如何使用LRS在单个数据中心内复制数据:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b2c431a5b998410f0f2b4e3895360da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/0*gjzhh8trZV-lB33H.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由微软上</em> <a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy?toc=/azure/storage/blobs/toc.json" rel="noopener ugc nofollow" target="_blank"> <em class="ne">微软文档</em> </a></figcaption></figure><p id="9596" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">分区冗余存储(ZRS) </strong></p><p id="3355" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">区域冗余存储(ZRS)跨主区域中的三个Azure可用性区域同步复制您的Azure存储数据。每个可用性区域都是一个独立的物理位置，具有独立的电源、冷却和网络。ZRS为Azure存储数据对象提供给定一年至少99.9999999999% (12个9)的持久性。下图显示了如何使用ZRS在主区域中跨可用性区域复制数据:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/38cafa546aa2fb739e3b8bec792e9509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/0*9ygqDXjyFNl0c2O9.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由微软在</em> <a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy?toc=/azure/storage/blobs/toc.json" rel="noopener ugc nofollow" target="_blank"> <em class="ne">微软文档</em> </a></figcaption></figure><p id="599c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">地理冗余存储(GRS) </strong></p><p id="d41e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">地理冗余存储(GRS)使用LRS在主区域的单个物理位置同步复制您的数据三次。然后，它将您的数据异步复制到远离主区域数百英里的辅助区域中的一个物理位置。GRS为Azure存储数据对象提供给定一年至少99.99999999999999% (16个9)的持久性。下图显示了如何使用GRS或RA-GRS复制您的数据:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/66479337b2afbc79b3a929a446e4bb88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JHQkSyh0PjhG9L4j.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由微软上传</em> <a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy?toc=/azure/storage/blobs/toc.json" rel="noopener ugc nofollow" target="_blank"> <em class="ne">微软文档</em> </a></figcaption></figure><p id="6517" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">地理区域冗余存储(GZRS) </strong></p><p id="36b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">地理区域冗余存储(GZRS)将跨可用性区域的冗余提供的高可用性与地理复制提供的针对区域性中断的保护相结合。GZRS存储帐户中的数据被复制到主区域中的三个Azure可用性区域，并且还被复制到辅助地理区域，以防止区域性灾难。Microsoft建议将GZRS用于需要最大一致性、耐用性、可用性、卓越性能和灾难恢复弹性的应用程序。下图显示了如何使用GZRS或RA-GZRS复制您的数据:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/432eacf7354a8d094bfb23ae56712162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TKL98GwhNDz3xBeq.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由微软上</em> <a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy?toc=/azure/storage/blobs/toc.json" rel="noopener ugc nofollow" target="_blank"> <em class="ne">微软文档</em> </a></figcaption></figure><p id="a964" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">对二级区数据的读访问</strong></p><p id="c05b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">地理冗余存储(使用GRS或GZRS)将您的数据复制到辅助区域中的另一个物理位置，以防止区域中断。但是，只有当客户或Microsoft启动从主区域到辅助区域的故障切换时，这些数据才可供读取。当您启用对辅助区域的读取权限时，您的数据在任何时候都可以被读取，包括在主区域不可用的情况下。对于辅助区域的读访问，启用读访问地理冗余存储(RA-GRS)或读访问地理区域冗余存储(RA-GZRS)。</p><h2 id="3789" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">Azure存储中的静态网站托管</h2><p id="76c2" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">静态内容(HTML、CSS、JavaScript和图像文件)可以直接从名为<em class="nf"> "$web" </em>的存储容器中提供，因为静态内容不需要web服务器。在Azure存储中托管内容支持使用无服务器架构，如Azure功能和其他平台即服务(PaaS)服务。静态网站托管是您必须在存储帐户上启用的功能，因为默认情况下它是禁用的。在<em class="nf">“自定义域名”</em>选项下，您可以非常轻松地将自己的域名添加到您的存储帐户中的静态网站。遗憾的是，Azure存储帐户还没有导入您自己的SSL证书的选项。这意味着，如果我们想为我们的静态网站自定义域启用HTTPS，我们必须使用Azure内容交付网络。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="c691" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">使用Azure内容交付网络</h1><p id="d75f" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">Azure内容交付网络(CDN)是一个全球分布式服务器网络，可以高效地向高带宽用户交付web内容。此web内容可以托管在Azure或其他位置。以下是CDN工作原理的示意图:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/b9f58e1b6d54ff9a5984e00f1cd8f0f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*O0jWEb9uYWzR0Wki.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由微软上传</em> <a class="ae lf" href="https://docs.microsoft.com/en-us/azure/cdn/cdn-overview" rel="noopener ugc nofollow" target="_blank"> <em class="ne">微软文档</em> </a></figcaption></figure><p id="848b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Azure CDN的关键特性之一是其HTTPS自定义域支持，这正是我们在本指南中使用它的原因。如果你想了解更多关于Azure CDN和它的其他功能，看看<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/cdn/" rel="noopener ugc nofollow" target="_blank">微软文档</a>。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="a2d1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">先决条件</h1><p id="845e" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">要开始托管您的静态博客网站，请确保您已经满足以下先决条件。</p><h2 id="5660" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">静态网站构建</h2><p id="52ab" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">首先，您需要一个构建来托管。如果你还没有，按照这个博客系列的第一部分<a class="ae lf" href="https://rolfschutten.medium.com/da00ddc85f2d?source=friends_link&amp;sk=481d8e810362ba54e5d47cf1c477677a" rel="noopener">创建你的静态网站。</a></p><h2 id="2473" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">安装Visual Studio代码</h2><p id="8ede" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">Visual Studio Code是微软为Windows、Linux和macOS开发的源代码编辑器。它包括调试支持、内置Git检查、语法突出显示、智能代码完成、代码片段和代码重构。</p><p id="d1b5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管任何代码编辑器都可以，而且这是个人偏好，但我仍然在这个列表中提到Visual Studio代码。一个好的代码编辑器是每个博客所有者和(网络)开发者的绝对要求。帮自己一个忙，下载Visual Studio代码。它是免费的，而且在我看来是最好的。</p><p id="5c76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要安装Visual Studio代码，请转到他们的<a class="ae lf" href="https://code.visualstudio.com/download/" rel="noopener ugc nofollow" target="_blank">下载页面</a>并根据您的操作系统下载。</p><h2 id="21c6" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">Azure订阅</h2><p id="02cc" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">对于本指南，您需要一个Azure订阅，一个本地用户帐户<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" rel="noopener ugc nofollow" target="_blank">有权</a>创建和编辑Azure存储帐户，并将静态网站版本上传到该帐户。</p><h2 id="e250" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">Azure CLI</h2><p id="e174" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">在本指南中，您将为Azure CLI使用Azure云外壳。然而，如果你喜欢在本地工作站工作，你可以<a class="ae lf" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" rel="noopener ugc nofollow" target="_blank">在本地安装Azure CLI</a>。</p><h2 id="025f" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">AzCopy</h2><p id="3261" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">在本指南中，您将使用AzCopy命令行实用程序将文件和目录上传到Blob存储帐户。前往<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10" rel="noopener ugc nofollow" target="_blank">“AzCopy入门”页面</a>获取安装文件和如何安装az copy的指南。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="8389" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">创建一个存储帐户来提供静态内容</h1><p id="fc93" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">现在我们有了要部署的东西，我们需要一个部署它的位置。您将使用<a class="ae lf" href="https://docs.microsoft.com/en-us/cli/azure/what-is-azure-cli" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>创建一个<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview#resource-groups" rel="noopener ugc nofollow" target="_blank"> Azure资源组</a>和一个<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview" rel="noopener ugc nofollow" target="_blank"> Azure存储帐户</a>。</p><p id="fb9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录到<a class="ae lf" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure门户</a>后，使用链接或点击图标打开<a class="ae lf" href="https://shell.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure云外壳</a>。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/bd1c9d4cc19e4b0a9ad3c624e533aa8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sn_GLi687eVzbtCP.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由Rolf Schutten上传</em><a class="ae lf" href="https://www.schutten.cloud/" rel="noopener ugc nofollow" target="_blank"><em class="ne">Schutten . cloud</em></a></figcaption></figure><p id="6bc9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你在本地使用Azure CLI，你首先需要使用<code class="fe ny nz oa ob b">az login</code>命令登录以使用任何CLI命令。</p><p id="7b57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，使用以下命令创建资源组:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="da30" class="ng lt iq ob b gy og oh l oi oj">az group create \<br/>    --name &lt;Name&gt; \<br/>    --location &lt;Region&gt;</span></pre><p id="c955" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以根据需要更改参数。在我的例子中，我选择了西欧地区，并将我的资源组命名为“gatsby-azuredevops-rg”。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="cc2a" class="ng lt iq ob b gy og oh l oi oj">az group create \<br/>    --name gatsby-azuredevops-rg \<br/>    --location westeurope</span></pre><p id="7453" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以将资源部署到该资源组。使用以下命令创建存储帐户:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="f873" class="ng lt iq ob b gy og oh l oi oj">az storage account create \<br/>    --name &lt;Name&gt; \<br/>    --resource-group &lt;Group&gt; \<br/>    --location &lt;Region&gt; \<br/>    --sku &lt;SKU type&gt;</span></pre><p id="321a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，您也可以根据自己的需要更改参数。在我的例子中，我选择西欧地区，我将使用<a class="ae lf" href="https://docs.microsoft.com/en-us/rest/api/storagerp/srp_sku_types" rel="noopener ugc nofollow" target="_blank">标准LRS SKU </a>，并将我的存储帐户命名为“gatsbyazuredevopssa”。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="fc2e" class="ng lt iq ob b gy og oh l oi oj">az storage account create \<br/>    --name gatsbyazuredevopssa \<br/>    --resource-group gatsby-azuredevops-rg \<br/>    --location westeurope \<br/>    --sku Standard_LRS</span></pre><p id="b085" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您有了一个存储帐户，您需要启用静态网站功能。您可以通过执行以下命令来实现这一点:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="5fb9" class="ng lt iq ob b gy og oh l oi oj">az storage blob service-properties update \<br/>    --account-name &lt;Name&gt; \<br/>    --static-website \<br/>    --404-document &lt;Error document&gt; \<br/>    --index-document &lt;Index document&gt;</span></pre><p id="95f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，您将根据您的需要在这里更改参数。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="c9be" class="ng lt iq ob b gy og oh l oi oj">az storage blob service-properties update \<br/>    --account-name gatsbyazuredevopssa \<br/>    --static-website \<br/>    --404-document 404.html \<br/>    --index-document index.html</span></pre><p id="ab50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以随时使用Azure CLI或门户更改或禁用这些设置。您也可以在这里找到端点链接。记下这个链接，你以后会需要的。</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/4f49887e8800590f3e145d4b2bf092d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*APxT1dJlGPX0uW18.png"/></div></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated"><em class="ne">图片由Rolf Schutten上传</em><a class="ae lf" href="https://www.schutten.cloud/" rel="noopener ugc nofollow" target="_blank"><em class="ne">Schutten . cloud</em></a></figcaption></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="fda3" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">创建内容交付网络端点</h1><p id="04a5" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">要创建Azure CDN端点并添加HTTPS支持的自定义域，首先必须创建CDN配置文件。在Azure CLI中使用以下命令创建它(或使用门户):</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="73b0" class="ng lt iq ob b gy og oh l oi oj">az cdn profile create \<br/>    --name &lt;Name&gt; \<br/>    --resource-group &lt;Group&gt; \<br/>    --location &lt;Region&gt; \<br/>    --sku &lt;SKU type&gt; </span></pre><p id="7353" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和以前一样，您可以根据个人喜好更改参数。有关不同SKU类型的更多信息，请点击<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/cdn/cdn-features" rel="noopener ugc nofollow" target="_blank">此链接</a>。对于本指南，您将选择标准的微软SKU。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="0357" class="ng lt iq ob b gy og oh l oi oj">az cdn profile create \<br/>    --name gatsby-azuredevops-cdnp \<br/>    --resource-group gatsby-azuredevops-rg \<br/>    --location westeurope \<br/>    --sku Standard_Microsoft </span></pre><p id="20a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然已经创建了CDN概要文件，我们现在可以创建一个CDN端点来通过HTTP和HTTPS提供内容。在Azure CLI中使用以下命令创建端点(或使用门户):</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="15d9" class="ng lt iq ob b gy og oh l oi oj">az cdn endpoint create \<br/>    --name &lt;Name&gt; \<br/>    --resource-group &lt;Group&gt; \<br/>    --profile-name &lt;Profile&gt; \<br/>    --origin &lt;URL&gt;</span></pre><p id="d42e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，您将根据您的需要在这里更改参数。在您的存储帐户中启用静态网站功能后记下的端点链接应该是您作为URL为origin参数输入的链接。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="f0f0" class="ng lt iq ob b gy og oh l oi oj">az cdn endpoint create \<br/>    --name gatsby-azuredevops-cdne \<br/>    --resource-group gatsby-azuredevops-rg \<br/>    --profile-name gatsby-azuredevops-cdnp \<br/>    --origin gatsbyazuredevopssa.z6.web.core.windows.net</span></pre><p id="7b8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你！您已成功将您的azure存储静态网站添加到Azure内容交付网络。</p><h2 id="250c" class="ng lt iq bd lu nh ni dn ly nj nk dp mc kj nl nm mg kn nn no mk kr np nq mo nr bi translated">添加自定义域</h2><p id="0426" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">若要将域映射到新创建的端点，您必须通过DNS提供商为指向该端点的自定义域创建CNAME记录。为此，请遵循DNS提供商的说明。创建CNAME记录后，在Azure CLI中运行以下命令，或者在门户中手动执行必要的步骤。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="64d7" class="ng lt iq ob b gy og oh l oi oj">az cdn custom-domain create \<br/>    --name &lt;Name&gt; \<br/>    --resource-group &lt;Group&gt; \<br/>    --endpoint-name &lt;Endpoint&gt; \<br/>    --profile-name &lt;Profile&gt; \<br/>    --hostname &lt;URL&gt;</span></pre><p id="16dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据需要更改参数。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="1474" class="ng lt iq ob b gy og oh l oi oj">az cdn custom-domain create \<br/>    --name gatsby-azuredevops-cdnd \<br/>    --resource-group gatsby-azuredevops-rg \<br/>    --endpoint-name gatsby-azuredevops-cdne \<br/>    --profile-name gatsby-azuredevops-cdnp \<br/>    --hostname <a class="ae lf" href="http://www.schutten.cloud" rel="noopener ugc nofollow" target="_blank">www.schutten.cloud</a></span></pre><p id="9be8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您已经将自己的域添加到了端点。指定的自定义域现在指向您的静态网站，该网站位于您的存储帐户中。</p><p id="4a78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在可以添加SSL证书了。您可以通过使用自己的证书或使用CDN管理的证书来实现这一点。要使用CDN管理的证书启用https，您需要执行以下代码:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="f208" class="ng lt iq ob b gy og oh l oi oj">az cdn custom-domain enable-https \<br/>--name &lt;Name&gt; \<br/>--resource-group &lt;Group&gt; \<br/>--endpoint-name &lt;Endpoint&gt; \<br/>--profile-name &lt;Profile&gt;</span></pre><p id="09da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据需要更改参数。</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="457d" class="ng lt iq ob b gy og oh l oi oj">az cdn custom-domain enable-https \<br/>    --name gatsby-azuredevops-cdnd \<br/>    --resource-group gatsby-azuredevops-rg \<br/>    --endpoint-name gatsby-azuredevops-cdne \<br/>    --profile-name gatsby-azuredevops-cdnp</span></pre><p id="55c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你更愿意使用自己的SSL证书，你可以跟随微软的<a class="ae lf" href="https://docs.microsoft.com/en-us/azure/cdn/cdn-custom-ssl?tabs=option-2-enable-https-with-your-own-certificate" rel="noopener ugc nofollow" target="_blank">这篇优秀教程。</a></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="8286" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">将您的静态网站上传到Azure存储</h1><p id="4d34" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">最重要的是，我们现在将把我们的静态网站上传到存储帐户。为此，我们从Windows命令Shell (cmd.exe)中使用AzCopy。不用Windows？在微软的【AzCopy入门”页面上，查看您需要进行哪些调整。</p><p id="5a3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，使用<code class="fe ny nz oa ob b">cd</code>(更改目录)命令导航到静态网站的目录。这是package.json和gatsby-config.js文件所在的文件夹。然后运行以下命令:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="d3a5" class="ng lt iq ob b gy og oh l oi oj">azcopy copy '&lt;local-directory-path&gt;' 'https://&lt;storage-account-name&gt;.&lt;blob or dfs&gt;.core.windows.net/&lt;container-name&gt;' --recursive</span></pre><p id="f2c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，您必须为该命令提供您的个人首选项和适用于您的参数。我们只想上传<em class="nf">/公共</em>目录。毕竟，这是编译后的应用程序，也是我们在本系列的第一篇博客中运行的<code class="fe ny nz oa ob b">gatsby build</code>命令的输出。该命令如下所示:</p><pre class="mw mx my mz gt oc ob od oe aw of bi"><span id="ef0b" class="ng lt iq ob b gy og oh l oi oj">azcopy copy '\public\*' 'https://gatsbyazuredevopssa.blob.core.windows.net/web' --recursive</span></pre><p id="880b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你更喜欢使用Azure门户，你也可以通过这种方式上传文件。上传完成后，您的静态网站应该在几分钟内在您的端点URL和自定义域上可见。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><p id="48d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们已经到了本系列第二篇文章的末尾。在本文中，您了解了什么是Azure Blob存储，什么是Azure内容交付网络，以及如何使用它们来托管您自己的静态内容。在本系列的下一篇文章中，我们将使用Azure DevOps自动化构建和部署过程。</p></div></div>    
</body>
</html>