<html>
<head>
<title>Test CNAME Endpoints w/ Dockerized BIND Locally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在本地测试带有Dockerized绑定的CNAME端点</h1>
<blockquote>原文：<a href="https://itnext.io/test-cname-endpoints-w-dockerized-bind-locally-aa83b1dd0592?source=collection_archive---------2-----------------------#2018-07-20">https://itnext.io/test-cname-endpoints-w-dockerized-bind-locally-aa83b1dd0592?source=collection_archive---------2-----------------------#2018-07-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/35069c8748aa2353699166623ee87dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IETJKIV1bMVnJ3fpN8h6qQ.png"/></div></div></figure><p id="aa9b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我想我们所有的IT人员都曾在某种程度上毒害过自己的DNS，以便在将web应用程序投入生产之前对其进行测试。“A记录”很容易处理，因为大多数现代操作系统仍然有一个叫做主机文件的东西。但是CNAMEs呢？例如，亚马逊的应用程序负载平衡器不提供基于IP的端点，而是会给你一个类似“example-GW-41709394-AP-northeast-2 . elb . Amazon AWS . com”的URL。然后，您必须在您的域名的DNS配置上创建一个CNAME，将您的域名指向它，以使事情正常运行。</p><p id="1a17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我要提出的可能不是唯一的解决方法，但它肯定是一个相当方便的解决方案，这要感谢Docker和那里精彩的Docker社区。我还觉得这是目前为止我能想到的最好的方法，因为将CMS和电子商务网站的URL(编辑代码和数据库条目)更改为测试URL是不可取的，因为我想最大限度地减少生产推广的步骤，使其看起来像是在按开关。因此，我总是喜欢尽可能接近真实配置地复制生产环境，这样我就不会在部署过程中忙于修复我们的测试没有覆盖到的东西。</p><p id="426d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，“为什么要容器化？”你可能会问。好吧，这里有一个快速的原因列表:</p><ol class=""><li id="0586" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">容器是非常便携的，我可以把这个容器放在任何工作站或服务器上，这比我所知道的任何其他方法都要快</li><li id="8503" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">我可以通过一个命令按需启动和停止一组定制的服务或组件</li><li id="445c" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">容器是一种很好的方法，它可以加速可处理服务的运行，而不会让您的主机系统受到以后不需要的库和配置文件的影响。只需移除容器进行清理。搞定了。</li><li id="df9c" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">如果我选择向其他队友开放BIND，我的服务器或工作站会受到更多的保护，因为向外界开放的服务被放在沙盒中，与我的主机的其他部分隔离开来。</li></ol><p id="3e4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">把上面的问题解决掉，让我们稍微谈谈我的解决方案是什么。本质上，它由以下两个部分组成:</p><ul class=""><li id="5eda" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky ln lf lg lh bi translated">在我的Ubuntu 18.04主机(我的笔记本电脑)上运行<a class="ae lo" href="https://github.com/sameersbn" rel="noopener ugc nofollow" target="_blank">sameersbn</a>/<a class="ae lo" href="https://github.com/sameersbn/docker-bind" rel="noopener ugc nofollow" target="_blank">docker-BIND</a>镜像(与预装的Webmin绑定)的容器*</li><li id="42db" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky ln lf lg lh bi translated">几个bash脚本将通过别名运行，以自动启动/停止该容器以及使其工作所需的相关/etc/resolv.conf编辑</li></ul><p id="1004" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的想法是能够启动/停止绑定和改变使用容器作为我的查询的DNS服务器，只需2个简单的命令别名。这样，我可以毫不费力地在维护和排除生产环境故障以及在一台机器上测试新的替代基础设施之间切换。</p><h2 id="0a3a" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">因此，事不宜迟，我做了以下工作来整合解决方案:</h2><p id="7266" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">如果Docker尚未安装，让我们从安装它开始:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="c33e" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">sudo apt install docker.io</strong></span></pre><p id="519d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们不想一直键入sudo来运行docker命令，就将我们的用户添加到/etc/group。对我来说，是“龙”:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="80f7" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">sudo vim /etc/group</strong></span></pre><p id="0698" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">/etc/group中的docker行应该如下所示:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="768f" class="lp lq it ms b gy mw mx l my mz">docker:x:127:dragon</span></pre><p id="af62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，保存、退出并重新启动，这是确保权限生效的一种简单方法，尽管我确信有很多方法可以在不重新启动的情况下实现。</p><p id="3d0b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">笔记本电脑重启后，让我们调出<a class="ae lo" href="https://github.com/sameersbn" rel="noopener ugc nofollow" target="_blank">sameersbn</a>/<a class="ae lo" href="https://github.com/sameersbn/docker-bind" rel="noopener ugc nofollow" target="_blank">docker-bind</a>图像:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="889d" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker pull sameersbn/bind:9.11.3-20180713</strong><br/>9.11.3-20180713: Pulling from sameersbn/bind<br/>6b98dfc16071: Pull complete<br/>4001a1209541: Pull complete<br/>6319fc68c576: Pull complete<br/>b24603670dc3: Pull complete<br/>97f170c87c6f: Pull complete<br/>701c34001733: Pull complete<br/>61f415ec66af: Pull complete<br/>92a47682d82d: Pull complete<br/>7428c3119443: Pull complete<br/>Digest: sha256:53188ff6ffeca017b4451203eea419373e52b42df3434614fb6d7e582475a4b4<br/>Status: Downloaded newer image for sameersbn/bind:9.11.3-20180713</span></pre><p id="5677" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，为容器卷创建一个目录:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="587a" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">sudo mkdir -p /srv/docker/bind</strong></span></pre><p id="3b8b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们准备尝试一下容器:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fa64" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker run --name bind -d --volume /srv/docker/bind:/data sameersbn/bind:9.11.3-20180713</strong><br/>24bf3c7fa926d07f9adcf5512df9e974e7cce0950f05f01a0f15bfd3cf1dbe7b</span></pre><p id="65a6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输出中的上述随机字符串告诉我，它成功启动了，但我们还是要检查一下:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fabe" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker ps</strong><br/>CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORTS                       NAMES<br/>24bf3c7fa926        sameersbn/bind:9.11.3-20180713   "/sbin/entrypoint.sh…"   10 seconds ago         Up 3 seconds       53/tcp, 10000/tcp, 53/udp   bind</span></pre><p id="5983" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！看来真的涨了！信不信由你，你已经有了一个预装了Webmin的功能齐全的DNS服务器，并且随时可以运行。超快的对吗？让我们找出这个容器的IP地址，这样我们就可以连接到它:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="e08c" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker inspect bind |grep IPAddress</strong><br/>            "SecondaryIPAddresses": null,<br/>            "IPAddress": "172.17.0.2",<br/>                    "IPAddress": "172.17.0.2",</span></pre><p id="ad3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们知道了IP是什么，让我们用web浏览器(https://172.17.0.2:10000)看一看，并绕过任何SSL警告，因为证书将是自签名的:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/2ba3be1d94614d0214943e97be77121d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wLGFRuK4GZYCu2bU6wmUg.png"/></div></div></figure><p id="c7cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">嘭！我没撒谎吧？我们有登录页面了！默认的用户名和密码是“root”和“password ”,但是我建议您更改容器上的root密码。为此，请运行以下命令:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4a94" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker exec -ti bind passwd</strong><br/>Enter new UNIX password: <br/>Retype new UNIX password: <br/>passwd: password updated successfully</span></pre><p id="eb97" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经更改了密码，让我们登录到Webmin控制台，单击站点左侧菜单上的“服务器”，然后单击“绑定DNS服务器”。这将带您进入以下屏幕:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/35592a95ee92964e8d3f03afdb75e07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WmjpqPjLN-HM8pq40LKsWg.png"/></div></div></figure><p id="4141" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从这里，点击最后一个大按钮“编辑配置文件”。</p><p id="c6ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，单击下一个屏幕上配置文件编辑区域上方的下拉菜单，并选择/etc/bind/named.conf.options。</p><p id="78ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在配置文件编辑区域找到这一行:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b075" class="lp lq it ms b gy mw mx l my mz">listen-on-v6 { any; };</span></pre><p id="bfb7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注释掉这一行，并在它下面直接添加几行，如下所示:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4a2f" class="lp lq it ms b gy mw mx l my mz"># listen-on-v6 { any; };<br/>    listen-on port 53 { any; };<br/>    forwarders {<br/>        8.8.8.8;<br/>        8.8.4.4;<br/>        };</span></pre><p id="d345" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击下面的“保存并关闭”。</p><p id="e989" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将把您带回绑定配置的主屏幕。请注意，在上面的配置块中，当Google DNS服务器没有可用的本地记录时，我会转发所有查询。</p><p id="fc49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从那里，向下滚动到页面的以下部分，并单击用红色突出显示的小按钮，为您的域创建一个主区域:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/9205f35f06f891ae3704fe64e65ece8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CfZxpiHceibsG28PZmcLkg.png"/></div></div></figure><p id="27e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输入如下相关信息:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/7dab79d09b502e900a3212d4ee0a3aa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5zA6eNg6ishQJAluRsE-PA.png"/></div></div></figure><p id="00ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所知，我为dragon-ventures.com创建了一个主区域，这是一个已经在生产中使用的域(全球DNS)。您甚至可以看到全球DNS服务器中有一个与该域名相关联的网站:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/5f992d1b1b2b25ad7e582167f19a40bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XjvpqM4857PZ3M85kunwng.png"/></div></div></figure><p id="9195" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们为www.dragon-ventures.com创造一项CNAME纪录。在BIND主页中，单击以红色突出显示的按钮:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/2bea37a444a8fcd718492675f159c413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmkWNkTnQeynpJ9iEBHYTg.png"/></div></div></figure><p id="c551" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，选择以下内容，为www.dragon-ventures.com创建CNAME记录:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/9beb85930ae5fc89375e0fb70629d98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfQeFWfJObyg4GgotMStLQ.png"/></div></div></figure><p id="2a8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">填写如下内容，然后点击绿色的“创建”按钮:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/1494c642d32455f345a159ce23e4af58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4Vw7ZjfuNcIjM-BY4QZtQ.png"/></div></div></figure><p id="9e80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，我将www.dragon-ventures.com的T2指向了T4的3DF开源项目网站。注意:不要忘记加一个“.”在实名之后，否则你会疑惑几个小时为什么DNS服务器不解析你的CNAME。所以应该是:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="f8d5" class="lp lq it ms b gy mw mx l my mz">osi.3df.io.</span></pre><p id="9367" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">而不是:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="afbc" class="lp lq it ms b gy mw mx l my mz">osi.3df.io</span></pre><p id="fe7a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，让我们返回到BIND主页，并单击apply changes按钮:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/74c5827ef00eca8ae96585433e547886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CePZrraEhJbsE5KSQ1lLeA.png"/></div></div></figure><p id="4dde" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是设置DNS的部分。现在让我们让笔记本电脑使用这个DNS服务器。现在，让我们停止容器，因为我们稍后将使用脚本启动它:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="79fb" class="lp lq it ms b gy mw mx l my mz">docker stop bind</span></pre><p id="7caa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先为你所有的个人定制脚本制作一个目录。对我来说，是~/。剧本</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a780" class="lp lq it ms b gy mw mx l my mz">mkdir ~/.scripts</span></pre><p id="64ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，在~/中创建一个名为usebind.sh的bash脚本。脚本/启动容器并编辑/etc/resolv.conf以将容器用作其DNS服务器:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4a56" class="lp lq it ms b gy mw mx l my mz">vim ~/.scripts/usebind.sh</span></pre><p id="7d93" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制并粘贴以下内容，保存并退出:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="d645" class="lp lq it ms b gy mw mx l my mz">#!/bin/bash</span><span id="ec00" class="lp lq it ms b gy nh mx l my mz"># Start bind container<br/>docker start bind</span><span id="7c6f" class="lp lq it ms b gy nh mx l my mz"># Comment out any line that starts with "nameserver"<br/>sudo sed -e '/nameserver/s/^/# /g' -i /etc/resolv.conf</span><span id="cddd" class="lp lq it ms b gy nh mx l my mz"># Add "nameserver 172.17.0.0.2" at the end of the file<br/>echo 'nameserver 172.17.0.2' | sudo tee --append /etc/resolv.conf &gt; /dev/null</span></pre><p id="1de8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，在~/中创建一个名为unbind.sh的bash脚本。脚本/将/etc/resolv.conf中的更改恢复为使用默认DNS服务器，然后停止容器:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fa96" class="lp lq it ms b gy mw mx l my mz">vim ~/.scripts/unbind.sh</span></pre><p id="2304" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制并粘贴以下内容，保存并退出:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="969a" class="lp lq it ms b gy mw mx l my mz">#!/bin/bash</span><span id="36d6" class="lp lq it ms b gy nh mx l my mz"># Remove any "#" from any line that consist of the word "nameserver"<br/>sudo sed -i '/^#.* nameserver /s/^# //' /etc/resolv.conf</span><span id="c014" class="lp lq it ms b gy nh mx l my mz"># Remove any line that consists of "172.17.0.2"<br/>sudo sed -i '/172.17.0.2/,+1 d' /etc/resolv.conf</span><span id="5099" class="lp lq it ms b gy nh mx l my mz"># Stop bind container<br/>docker stop bind</span></pre><p id="ebf6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">确保我们可以执行它:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="f3b7" class="lp lq it ms b gy mw mx l my mz">chmod u+x ~/.scripts/*bind*</span></pre><p id="9391" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，因为我希望能够在终端的任何地方输入简短的命令，所以我通过编辑现有的~/创建了两个新的别名。bash_aliases或者创建它(如果没有):</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="83a3" class="lp lq it ms b gy mw mx l my mz">vim ~/.bash_aliases</span></pre><p id="7bee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制并粘贴以下内容，保存并退出:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="0966" class="lp lq it ms b gy mw mx l my mz"># Dockerized DNS Server Start/Stop<br/>alias usebind='~/.scripts/usebind.sh'<br/>alias unbind='~/.scripts/unbind.sh'</span></pre><p id="07f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们找到别名，这样我们就不必先注销，然后再重新登录，这样就可以工作了:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="ac58" class="lp lq it ms b gy mw mx l my mz">source ~/.bashrc</span></pre><h2 id="fdbd" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">就是这样。从技术上讲，我们都准备好了，让我们来测试一下吧！</h2><p id="0fe1" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">运行usebind.sh脚本:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="7961" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">usebind</strong><br/>bind<br/>[sudo] password for dragon:</span></pre><p id="40fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">实际上应该是即时的。因为这是第一次运行这个命令，所以让我们检查一下脚本是否工作正常:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fbb6" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker ps</strong><br/>CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORTS                       NAMES<br/>24bf3c7fa926        sameersbn/bind:9.11.3-20180713   "/sbin/entrypoint.sh…"   15 minutes ago         Up 11 seconds       53/tcp, 10000/tcp, 53/udp   bind<br/><strong class="ms iu">cat /etc/resolv.conf |grep nameserver</strong><br/># nameserver 127.0.0.53<br/>nameserver 172.17.0.2</span></pre><p id="368f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧，这正是我们期望它做的。容器正在运行，我们的/etc/resolv.conf看起来不错。因此，让我们使用ping来确定我是否真的在使用DNS容器来解析我的查询:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="3512" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">ping osi.3df.io</strong><br/>PING osi.3df.io (104.31.83.214) 56(84) bytes of data.<br/><strong class="ms iu">ping </strong><a class="ae lo" href="http://www.dragon-ventures.com" rel="noopener ugc nofollow" target="_blank"><strong class="ms iu">www.dragon-ventures.com</strong></a><br/>PING osi.3df.io (104.31.83.214) 56(84) bytes of data.</span></pre><p id="17a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">看起来<a class="ae lo" href="http://www.dragon-ventures.com" rel="noopener ugc nofollow" target="_blank">www.dragon-ventures.com</a>实际上正在解析与osi.3df.io相同的IP地址，所以我肯定称之为通过。</p><p id="9ecd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，让我们检查最后一部分，即取消绑定别名是否按预期工作:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="6ded" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">unbind</strong><br/>bind<br/>[sudo] password for dragon:</span></pre><p id="2021" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Check /etc/resolv.conf:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="8a31" class="lp lq it ms b gy mw mx l my mz">cat /etc/resolv.conf |grep nameserver<br/>nameserver 127.0.0.53</span></pre><p id="059e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">检查容器是否正在运行:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="8b86" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">docker ps</strong><br/>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span></pre><p id="aac3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用ping检查:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="3afc" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">ping </strong><a class="ae lo" href="http://www.dragon-ventures.com" rel="noopener ugc nofollow" target="_blank"><strong class="ms iu">www.dragon-ventures.com</strong></a><br/>PING <a class="ae lo" href="http://www.dragon-ventures.com" rel="noopener ugc nofollow" target="_blank">www.dragon-ventures.com</a> (104.31.91.41) 56(84) bytes of data.</span></pre><p id="f8f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">DNS设置看起来不错，container不再运行，ping返回一个不同的IP地址给<a class="ae lo" href="http://www.dragon-ventures.com." rel="noopener ugc nofollow" target="_blank">www.dragon-ventures.com。</a>这证明了我们的unbind.sh脚本也是有效的。</p><p id="d87b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从这一点开始，无论何时您想要测试任何具有CNAME端点的替代基础架构，我们所要做的就是打开一个终端并执行以下操作:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="f257" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">usebind</strong><br/>bind<br/>[sudo] password for dragon:</span></pre><p id="de33" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那就开始测试吧！</p><p id="d9c4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当我们完成所有工作并想继续维护生产环境或对其进行故障排除时，我们要做的就是:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="41aa" class="lp lq it ms b gy mw mx l my mz"><strong class="ms iu">unbind[sudo] password for dragon:</strong><br/>bind</span></pre><p id="2e2f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">希望这篇文章能帮助人们简化CNAME测试的相关问题！</p><p id="7fca" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">*只要稍加调整，这个解决方案也适用于Mac和Windows。</p></div></div>    
</body>
</html>