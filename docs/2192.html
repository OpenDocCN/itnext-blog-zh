<html>
<head>
<title>Using Git hooks to enforce branch naming policy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Git挂钩实施分支命名策略</h1>
<blockquote>原文：<a href="https://itnext.io/using-git-hooks-to-enforce-branch-naming-policy-ffd81fa01e5e?source=collection_archive---------1-----------------------#2019-04-14">https://itnext.io/using-git-hooks-to-enforce-branch-naming-policy-ffd81fa01e5e?source=collection_archive---------1-----------------------#2019-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi ju"><img src="../Images/8d282e6c3acfe2c3634ee9f8b31a40e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kL2M9knYaW4DBKRb"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">由<a class="ae kk" href="https://unsplash.com/@pperkins?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Patrick Perkins </a>在<a class="ae kk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ed3f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当许多人在一个存储库中协作时，分支的数量和名称会很快失去控制。分层分支文件夹是驯服混乱的有效方法。因此，您可以在每个分支中预先添加特殊的<em class="lj"> feature/ </em>或<em class="lj"> release/ </em>字符串，比如:</p><pre class="jv jw jx jy gt lk ll lm ln aw lo bi"><span id="01a2" class="lp lq iq ll b gy lr ls l lt lu">feature/mapbox<br/>release/7.5.0</span></pre><p id="8bfe" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae kk" href="https://azure.microsoft.com/en-us/services/devops/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps </a>将<code class="fe lv lw lx ll b">/</code>视为文件夹分隔符，默认情况下会自动折叠文件夹。但是即使你有一些命名的指导方针，你也不能指望每个人都能正确命名。对于大多数存储库管理器，如github、gitlab或bitbucket，只需通过存储库管理器UI就可以轻松实施命名策略。问题是，这并不能防止开发人员在他们的本地存储库中错误地创建分支名称。幸运的是，有一种方法可以在提交之前在本地检查分支名称，这一切都从<strong class="kn ir"> Git钩子</strong>开始。</p><h1 id="ee23" class="ly lq iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">什么是Git挂钩？</h1><p id="6ce2" class="pw-post-body-paragraph kl km iq kn b ko mv kq kr ks mw ku kv kw mx ky kz la my lc ld le mz lg lh li ij bi translated">Git挂钩是每当Git存储库中发生特定事件时自动运行的脚本，例如:<strong class="kn ir">提交</strong>、<strong class="kn ir">推送</strong>和<strong class="kn ir">接收</strong>。它们允许您定制Git的内部行为，并在开发生命周期的关键点触发可定制的操作。Git挂钩是一个内置特性——不需要下载任何东西。Git挂钩在本地运行。</p><p id="3c10" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这些钩子脚本只受开发人员想象力的限制。一些示例钩子脚本包括:</p><ul class=""><li id="57d4" class="na nb iq kn b ko kp ks kt kw nc la nd le ne li nf ng nh ni bi translated">预提交:检查提交消息的拼写错误。</li><li id="d46a" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><strong class="kn ir">预收</strong>:执行项目编码标准。</li><li id="231f" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><strong class="kn ir">提交后</strong>:邮件/短信团队成员的新提交。</li><li id="9e8e" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><strong class="kn ir">接收后</strong>:将代码推送到生产中。</li></ul><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi no"><img src="../Images/411b12825ee0f5cb1cac6d39d14a4e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DepF00OEVq3BoMjaAENyrw.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated"><a class="ae kk" href="https://www.atlassian.com/git/tutorials/git-hooks" rel="noopener ugc nofollow" target="_blank">https://www.atlassian.com/git/tutorials/git-hooks</a></figcaption></figure><p id="26ce" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">每个Git存储库都有一个<code class="fe lv lw lx ll b">.git/hooks</code>文件夹，其中包含您可以绑定到的每个钩子的脚本。您可以根据需要随意更改或更新这些脚本，当这些事件发生时，Git会执行它们。</p><p id="7a4d" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">更多关于git挂钩的信息<a class="ae kk" href="https://githooks.com/" rel="noopener ugc nofollow" target="_blank">https://githooks.com/</a></p><h1 id="4d13" class="ly lq iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">创建挂钩来检查分支名称</h1><p id="6351" class="pw-post-body-paragraph kl km iq kn b ko mv kq kr ks mw ku kv kw mx ky kz la my lc ld le mz lg lh li ij bi translated">创建新分支时没有专门运行的钩子，所以我们将使用<strong class="kn ir">预提交</strong>钩子。我们应该在hooks目录中添加一个<strong class="kn ir">预提交</strong>文件。在钩子中，我们将执行以下任务:</p><ul class=""><li id="f90b" class="na nb iq kn b ko kp ks kt kw nc la nd le ne li nf ng nh ni bi translated">检查分支名称是否正确。否则，我们将打印一条错误消息，以1结束<code class="fe lv lw lx ll b">exit</code>。</li><li id="e59d" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated">如果一切正常，我们将<code class="fe lv lw lx ll b">exit</code>设为0。</li></ul><p id="32ee" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要获得当前的分支名称，我们使用这个</p><pre class="jv jw jx jy gt lk ll lm ln aw lo bi"><span id="033e" class="lp lq iq ll b gy lr ls l lt lu"><strong class="ll ir">git rev-parse --abbrev-ref HEAD</strong></span></pre><p id="3381" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后为了检查名字是否正确，我们可以使用正则表达式。在我们的例子中，名字应该以<strong class="kn ir"> feature、bugfix等开头。</strong>并且只包含小写字母、数字和一些特殊符号。</p><pre class="jv jw jx jy gt lk ll lm ln aw lo bi"><span id="1039" class="lp lq iq ll b gy lr ls l lt lu"><strong class="ll ir">^(feature|bugfix|improvement|library|prerelease|release|hotfix)\/[a-z0-9._-]+$</strong></span></pre><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="gh gi np"><img src="../Images/0b9f74db54b815e485fd086a6105e644.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*bmeCQ9RKVpuLAqZHiVocxg.png"/></div></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated"><a class="ae kk" href="https://regexper.com/#%5E%28feature%7Cbugfix%7Cimprovement%7Clibrary%7Cprerelease%7Crelease%7Chotfix%29%5C%2F%5Ba-z0-9._-%5D%2B%24" rel="noopener ugc nofollow" target="_blank">正则表达式</a></figcaption></figure><p id="d735" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下面是最终的钩子代码(简单的bash脚本):</p><figure class="jv jw jx jy gt jz"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9786" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在添加了这个挂钩并尝试提交到不符合命名策略的branch之后，我们得到了这个错误:</p><figure class="jv jw jx jy gt jz gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f24d1d8ea063b2d7f75b780ae50d8d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*6y7llCpp6vNf6UOfmc0MTA.jpeg"/></div><figcaption class="kg kh gj gh gi ki kj bd b be z dk translated">Intellij / Android Studio</figcaption></figure><h2 id="2ebc" class="lp lq iq bd lz nt nu dn md nv nw dp mh kw nx ny ml la nz oa mp le ob oc mt od bi translated">与你的团队分享Git挂钩</h2><p id="324a" class="pw-post-body-paragraph kl km iq kn b ko mv kq kr ks mw ku kv kw mx ky kz la my lc ld le mz lg lh li ij bi translated">如前所述，钩子在<code class="fe lv lw lx ll b">.git</code>文件夹中，那里存储了所有的Git元数据。该文件夹不受版本控制，因为它的大部分内容是特定于设备和用户的。如果您使用的是Git<a class="ae kk" href="https://raw.githubusercontent.com/git/git/master/Documentation/RelNotes/2.9.0.txt" rel="noopener ugc nofollow" target="_blank">2.9</a>或更高版本，有一个简单的方法可以使用<code class="fe lv lw lx ll b">core.hooksPath</code>配置变量来改变钩子目录。只需在存储库中创建一个文件夹，并将其置于版本控制之下，然后更改hooks目录。</p><pre class="jv jw jx jy gt lk ll lm ln aw lo bi"><span id="d7da" class="lp lq iq ll b gy lr ls l lt lu">$ git config core.hooksPath .githooks</span></pre><p id="ffb0" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们的例子中，我们在所有这些钩子所在的根处创建了<code class="fe lv lw lx ll b">.githooks</code>。</p><h2 id="a1b9" class="lp lq iq bd lz nt nu dn md nv nw dp mh kw nx ny ml la nz oa mp le ob oc mt od bi translated">结论</h2><p id="b1a4" class="pw-post-body-paragraph kl km iq kn b ko mv kq kr ks mw ku kv kw mx ky kz la my lc ld le mz lg lh li ij bi translated">我希望这将有助于你们中的一些人开始使用Git挂钩，并调整开发团队的工作流程:-)</p><p id="6667" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">感谢阅读！欢迎留下任何反馈！</p><p id="b0c4" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">通过以下方式与我联系:</p><ul class=""><li id="a6f2" class="na nb iq kn b ko kp ks kt kw nc la nd le ne li nf ng nh ni bi translated"><a class="ae kk" href="https://medium.com/@roland.yeghiazaryan" rel="noopener">中等</a></li><li id="cc4a" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><a class="ae kk" href="https://www.linkedin.com/in/roland-yeghiazaryan/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="33b3" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><a class="ae kk" href="https://twitter.com/RolandYeghiazar" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="fb0e" class="na nb iq kn b ko nj ks nk kw nl la nm le nn li nf ng nh ni bi translated"><a class="ae kk" href="https://github.com/androideveloper" rel="noopener ugc nofollow" target="_blank"> Github </a></li></ul></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><h2 id="afe5" class="lp lq iq bd lz nt nu dn md nv nw dp mh kw nx ny ml la nz oa mp le ob oc mt od bi translated">脚注和进一步阅读</h2><div class="oe of gp gr og oh"><a href="https://www.atlassian.com/git/tutorials/git-hooks" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">Git钩子| Atlassian Git教程</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">Git挂钩:当repo中发生事件时自动运行的脚本。在关键点触发可定制的动作…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">www.atlassian.com</p></div></div></div></a></div><div class="oe of gp gr og oh"><a href="https://medium.com/@Sergeon/using-javascript-in-your-git-hooks-f0ce09477334" rel="noopener follow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd ir gy z fp om fr fs on fu fw ip bi translated">在git挂钩中使用javaScript</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">当使用Git时，git钩子真的很方便，可以自动执行许多重复的任务，还可以…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">medium.com</p></div></div></div></a></div></div></div>    
</body>
</html>