<html>
<head>
<title>Building a real-time Todo app with Drayman, MongoDB and Tailwind CSS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Drayman，MongoDB和Tailwind CSS搭建一个实时的Todo app</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-real-time-todo-app-with-drayman-mongodb-and-tailwind-css-25d57ed5cfda?source=collection_archive---------6-----------------------#2021-08-31">https://itnext.io/building-a-real-time-todo-app-with-drayman-mongodb-and-tailwind-css-25d57ed5cfda?source=collection_archive---------6-----------------------#2021-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6dbd3efa48875ec38afd5edd11889297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxGDp1PE4m2deQRAeHuuTQ.png"/></div></div></figure><p id="1f04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本指南中，我们将使用<a class="ae kw" href="http://www.drayman.io/" rel="noopener ugc nofollow" target="_blank"> Drayman </a>、<a class="ae kw" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>和<a class="ae kw" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> Tailwind CSS </a>构建一个实时Todo应用程序。</p><p id="c473" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用常规工具，您需要创建一个带有端点的服务器，一个使用现代框架或普通JavaScript的客户端应用程序。然而，对于Drayman，它只是一个包含100行代码的脚本。</p><p id="45b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你是第一次接触Drayman，你可以去我们的<a class="ae kw" href="http://www.drayman.io/" rel="noopener ugc nofollow" target="_blank">官方文档</a>查看它是如何工作的，或者阅读其他指南。</p><h1 id="167d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">先决条件</h1><p id="25d9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">本指南假设您:</p><ul class=""><li id="cbb0" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">已经在本地<a class="ae kw" href="http://www.drayman.io/docs/introduction/getting-started" rel="noopener ugc nofollow" target="_blank">安装了Drayman项目</a>或者正在通过<a class="ae kw" href="http://new.drayman.io/" rel="noopener ugc nofollow" target="_blank"> new.drayman.io </a>使用；</li><li id="aa46" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">安装MongoDB并启用<a class="ae kw" href="https://docs.mongodb.com/manual/changeStreams/" rel="noopener ugc nofollow" target="_blank">变更流</a>功能。对于本指南，您可以在这里创建一个免费的云MongoDB数据库<a class="ae kw" href="https://www.mongodb.com/try" rel="noopener ugc nofollow" target="_blank">。通过这种方式，您可以默认启用变更流功能。</a></li></ul><p id="be3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当Drayman项目准备就绪，MongoDB启动并运行时，我们可以通过添加Tailwind CSS来开始开发我们的Todo应用程序。</p><h1 id="76c1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置顺风CSS</h1><p id="0ee7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先，您需要安装<code class="fe mo mp mq mr b">autoprefixer</code>和<code class="fe mo mp mq mr b">tailwindcss</code>:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9f43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，用这个命令生成<code class="fe mo mp mq mr b">tailwind.config.js</code>和<code class="fe mo mp mq mr b">postcss.config.js</code>文件:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2f55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在修改<code class="fe mo mp mq mr b">tailwind.config.js</code>文件，在编译时排除不使用的CSS类:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2a6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe mo mp mq mr b">src/styles.css</code>创建您的主CSS文件，并添加以下代码:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="1c3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一步是修改<code class="fe mo mp mq mr b">public/index.html</code>文件以包含生成的CSS文件。Drayman会将其生成到<code class="fe mo mp mq mr b">public/styles.css</code>文件中:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="9879" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建待办事项应用程序</h1><p id="679d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将从使用Tailwind CSS类添加基本UI开始，然后改进我们的解决方案，以包括实时功能和MongoDB支持。</p><h1 id="65a3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">添加基本用户界面</h1><p id="bf79" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">将这段代码粘贴到<code class="fe mo mp mq mr b">src/components.home.tsx</code>中:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="cbe2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果Tailwind CSS成功初始化，您应该会在浏览器中看到以下结果:</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/ad469fcbbe0870fe13b39f5f8f39d912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a0XH73UI2GbzHdIy.png"/></div></div></figure><h1 id="71c0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">添加MongoDB支持</h1><p id="8810" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对于本指南，我们将使用MongoDB的<a class="ae kw" href="https://docs.mongodb.com/manual/changeStreams/" rel="noopener ugc nofollow" target="_blank">变更流</a>功能来使我们的待办事项列表实时工作。这样，如果数据库中发生了变化，我们的应用程序将会反映这些变化。让我们修改我们的<code class="fe mo mp mq mr b">src/components/home.tsx</code>组件，并详细看看脚本内部发生了什么:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7289" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们向数据库添加了一个连接(不要忘记将<code class="fe mo mp mq mr b">YOUR_MONGODB_CONNECTION_STRING</code>改为实际的连接字符串)。然后，我们通过将Todo列表转换成一个数组- <code class="fe mo mp mq mr b">let todos = await todoListCollection.find().toArray();</code>来对其进行初始提取。</p><p id="3c2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们通过观察数据库的变化添加了实时功能<code class="fe mo mp mq mr b">todoListCollection.watch()</code>:</p><ul class=""><li id="fabf" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">在<code class="fe mo mp mq mr b">insert</code>上，一个Todo将被推送到<code class="fe mo mp mq mr b">todos</code>数组；</li><li id="573a" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">在<code class="fe mo mp mq mr b">update</code>上，来自<code class="fe mo mp mq mr b">todos</code>数组的特定Todo将被更新；</li><li id="f4bd" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">在<code class="fe mo mp mq mr b">delete</code>上，将从<code class="fe mo mp mq mr b">todos</code>数组中删除一个特定的待办事项。</li></ul><p id="cc68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">组件将反映所有这些变化，因为我们还调用了<a class="ae kw" href="http://www.drayman.io/docs/components-in-depth/helpers/force-update" rel="noopener ugc nofollow" target="_blank"> forceUpdate </a>函数——如果捕捉到任何变化，组件将重新呈现自己。</p><p id="ba78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，当一个组件实例被破坏时，我们使用<a class="ae kw" href="http://www.drayman.io/docs/components-in-depth/helpers/the-component-instance-object" rel="noopener ugc nofollow" target="_blank"> onDestroy </a>生命周期方法来关闭到数据库的连接。</p><p id="81b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还通过映射<code class="fe mo mp mq mr b">todos</code>数组和渲染每个Todo以及在Todo完成时动态更改CSS类，对我们的UI进行了更改。</p><p id="9927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，在数据库内部所做的任何更改(为此我使用了<a class="ae kw" href="https://tableplus.com/" rel="noopener ugc nofollow" target="_blank"> TablePlus </a>)都会在我们的组件内部得到反映:</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/3a395f387abfcf5a63abd7005fcbf8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s7oxiW-L1rGqmSOp.gif"/></div></div></figure><p id="cb9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的最后一步将是使输入字段和按钮按预期工作。</p><h1 id="04a9" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">向UI元素添加功能</h1><p id="42d7" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将从修改<code class="fe mo mp mq mr b">&lt;input&gt;</code>元素开始:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="34fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">变量<code class="fe mo mp mq mr b">newTodo</code>被引入。当用户输入内容时，<code class="fe mo mp mq mr b">oninput</code>事件被触发，将输入值保存到<code class="fe mo mp mq mr b">newTodo</code>变量中，从而提供了一个真实的来源——输入值总是在<code class="fe mo mp mq mr b">newTodo</code>中。</p><p id="d7ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们修改<code class="fe mo mp mq mr b">&lt;button&gt;Save&lt;/button&gt;</code>元素:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="288b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们修改了<code class="fe mo mp mq mr b">class</code>和<code class="fe mo mp mq mr b">disabled</code>属性，使其在用户没有输入时显示为禁用状态(<code class="fe mo mp mq mr b">newTodo</code>为空)。当用户点击一个按钮时，<code class="fe mo mp mq mr b">onclick</code>被触发，一个新的Todo被插入数据库。我们也不需要在这里调用<code class="fe mo mp mq mr b">forceUpdate</code>,因为在监视数据库变化时，它已经被管理过了。现在我们可以输入一些东西，单击按钮，结果将出现在浏览器中:</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/ac136600760961899356d0797f8f14bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*q-XXqoc5cufRjMkj.gif"/></div></div></figure><p id="ec6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的最后一步是修改<code class="fe mo mp mq mr b">todos</code>列表映射:</p><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="b057" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们为<code class="fe mo mp mq mr b">&lt;div&gt;</code>添加了<code class="fe mo mp mq mr b">onclick</code>事件处理程序，用于标记待办事项完成或撤消，为<code class="fe mo mp mq mr b">&lt;button&gt;Delete&lt;/button&gt;</code>添加了<code class="fe mo mp mq mr b">onclick</code>事件处理程序，用于在点击待办事项时将其从数据库中删除。</p><p id="0daa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的组件现已完成，您可以在多个选项卡中打开包含该组件的页面来检查实时功能:</p><figure class="ms mt mu mv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/89a9a1b81e11ed71876b5ebb12947a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1i4RXuo4A_yqicMC.gif"/></div></div></figure><h1 id="7528" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最终组件脚本</h1><figure class="ms mt mu mv gt jr"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="d5a2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="d08e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们在一个脚本中用100行代码创建了一个实时的Todo应用程序。</p><p id="60ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您对此感兴趣，请访问<a class="ae kw" href="http://www.drayman.io/" rel="noopener ugc nofollow" target="_blank">官方文档</a>深入了解Drayman框架！</p></div></div>    
</body>
</html>