<html>
<head>
<title>Integrate Analytics into your iOS Swift applications with AWS Amplify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Amplify将分析集成到您的iOS Swift应用程序中</h1>
<blockquote>原文：<a href="https://itnext.io/integrate-analytics-into-your-ios-swift-applications-with-aws-amplify-20d31fe0a20e?source=collection_archive---------1-----------------------#2018-09-04">https://itnext.io/integrate-analytics-into-your-ios-swift-applications-with-aws-amplify-20d31fe0a20e?source=collection_archive---------1-----------------------#2018-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e79efe3fa8a4ae34922b324114ffbd09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4mCFpcPVk4CWAcwEqt1NA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">时代广场拍摄的移动广告牌</figcaption></figure><p id="e143" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">分析不再是移动开发者的选择——如果你想让你的应用成功，分析是必须的。</p><p id="7d00" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">分析在移动应用增长和成功的两个最重要领域发挥了巨大作用:<strong class="ke ir">获取</strong>和<strong class="ke ir">保持</strong>。获取iOS客户成本高昂。一旦你赢得了客户，留住客户的努力就必须开始。</p><blockquote class="la lb lc"><p id="d95b" class="kc kd ld ke b kf kg kh ki kj kk kl km le ko kp kq lf ks kt ku lg kw kx ky kz ij bi translated">要留住iOS客户，你需要了解并吸引他们。了解客户细分和行为是定义正确客户体验的关键。</p></blockquote><p id="a651" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章(第1篇，共3篇)中，我将带领您收集用户统计数据和应用程序会话活动，以更好地了解客户平台和行为。在下面的文章中，我们将根据我们将要收集的行为和人口统计数据，探索客户细分和信息渠道，以吸引这些客户。</p><h2 id="596c" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated"><strong class="ak">工作原理</strong></h2><p id="e4fe" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">我们将从现有的离线应用程序开始，然后使用<a class="ae mf" href="https://aws-amplify.github.io/media/get_started?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir">AWS Amplify</strong>CLI</a>对其进行云支持，该应用程序提供云资源并配置iOS客户端以将分析事件发送到云。</p><h2 id="12cc" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">从本地开始</h2><p id="8864" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">您不需要在云中创建任何服务来开始分析。我首先为分析定义了一个协议(Swift代表“接口”):</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="ab76" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是一个LocalAnalyticsService类实现，它采用并符合上面的AnalyticsService协议:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="82e2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我可以使用这个分析模块之前，最后一步是创建一个服务实例。在这个例子中，我使用<code class="fe mm mn mo mp b">AppDelegate.swift</code>文件来实例化一个本地分析服务:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="454c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我可以在任何我想记录的地方记录事件。首先，获取一个对服务的引用(通常在<code class="fe mm mn mo mp b">init()</code>或<code class="fe mm mn mo mp b">viewDidLoad()</code>中)，然后调用<code class="fe mm mn mo mp b">recordEvent()</code>函数来记录一个事件:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="fadc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当你运行你的应用程序时，你会看到在Xcode的调试日志中打印出来的分析事件。请记住，我们仍然是本地的，但这样做的好处是，您可以轻松地用真正的分析服务替换实现，而无需更改任何UI代码！现在，让我们从本地分析转向亚马逊精确分析。</p><h2 id="8b04" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">使用Amazon Pinpoint添加分析服务</h2><p id="7f11" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi mq translated"><span class="l mr ms mt bm mu mv mw mx my di"> F </span>首先，<a class="ae mf" href="https://aws-amplify.github.io/media/get_started?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank">安装并配置AWS Amplify CLI </a>。AWS Amplify网站上有详细的说明和视频，可以帮助您开始使用。</p><p id="431c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦安装并配置了Amplify CLI，打开一个终端到您的iOS项目目录(带有<code class="fe mm mn mo mp b">Project.xcodeproj</code>文件的文件夹)。</p><p id="00f6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，初始化项目:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="fab5" class="lh li iq mp b gy nd ne l nf ng">$ amplify init</span></pre><p id="452a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将指导您完成整个过程，包括命名项目、确认您正在开发一个iOS项目，以及选择合适的凭证来将资源部署到AWS。这个命令将创建一个/ <code class="fe mm mn mo mp b">amplify</code>目录来存储后端的细节。现在，让我们添加一个用于存储分析的Amazon Pinpoint资源:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="4500" class="lh li iq mp b gy nd ne l nf ng">$ amplify add analytics</span></pre><p id="cb46" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以按enter键继续完成该过程。这个应用程序的所有默认设置都很好。最后，让我们部署资源:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="0623" class="lh li iq mp b gy nd ne l nf ng">$ amplify push</span></pre><p id="caff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将要求您确认部署，然后创建资源。</p><p id="87d5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">刚刚发生了什么？</p><p id="3f9c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了使我们的应用程序能够将分析数据发送到云中，我们首先使用AWS Amplify CLI初始化一个支持云的iOS项目。然后，CLI创建了一个新的Amazon Pinpoint应用程序，并为您的iOS应用程序提供了发送分析事件的适当权限。然后，CLI用Amazon Pinpoint端点和区域创建了一个<em class="ld"> awsconfiguration.json </em>文件。下面我将向您展示如何将这个配置文件添加到Xcode项目中。</p><h2 id="f31f" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">将iOS版AWS SDK添加到您的项目中</h2><p id="9586" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">iOS版AWS SDK包含连接AWS云资源所需的所有代码，包括Amazon Pinpoint。我使用<a class="ae mf" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank"> Cocoapods </a>来加载库依赖项。首先，为您的项目初始化Cocoapods:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="32e8" class="lh li iq mp b gy nd ne l nf ng">$ pod init</span></pre><p id="1adb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将产生一个空白的<code class="fe mm mn mo mp b">Podfile</code>。编辑文件以包含Amazon Pinpoint库并保存。注:确保目标名称与您的iOS应用程序名称匹配:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="908f" class="lh li iq mp b gy nd ne l nf ng">$ pod install --repo-update</span></pre><p id="ea1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在关闭Xcode并打开项目的工作空间版本:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="3dc3" class="lh li iq mp b gy nd ne l nf ng">$ open &lt;yourprojectname&gt;.xcworkspace</span></pre><p id="0587" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">快速构建以编译新的库。</p><h2 id="9337" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">集成awsconfiguration.json文件</h2><p id="c88d" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">当使用AWS Amplify CLI提供后端资源时，它会在iOS项目的根目录下生成一个名为<code class="fe mm mn mo mp b">awsconfiguration.json</code>的文件。此文件包含您可通过应用程序访问的资源的描述，并且在CLI添加、更新或删除资源时会与您的项目同步更新。这是使用Amplify CLI为您的项目提供资源的最大好处之一。</p><p id="bcaa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您只需将<code class="fe mm mn mo mp b">awsconfiguration.json</code>文件添加到Xcode项目中一次。您可以通过将它拖到Xcode项目管理器中的Finder来完成此操作。</p><p id="d262" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果要复制文件，系统会提示您。<strong class="ke ir">取消勾选复制项目框</strong>。当情况发生变化时，AWS Amplify CLI会更新该文件。如果您选中目标框，那么您的项目在被复制时可能不会收到更新。如果取消选中该框，每当您通过Amplify CLI修改项目资源时，AWS Amplify CLI都会更新该文件。</p><h2 id="ba5f" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">创建新的AWSAnalyticsService</h2><p id="4370" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">现在，我们可以创建一个新的分析云服务来取代我们的本地分析服务。</p><p id="79fa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将此类添加到您的Xcode项目:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="9e8e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe mm mn mo mp b">init()</code>方法使用<code class="fe mm mn mo mp b">awsconfiguration.json</code>文件中定义的常量初始化Amazon Pinpoint的AWS SDK。初始化Pinpoint客户端会触发SDK自动开始跟踪应用会话数据和用户统计数据，而无需任何开发人员代码。<code class="fe mm mn mo mp b">recordEvent()</code>方法是发送定制事件给Pinpoint的实现。您可以在Pinpoint控制台的<strong class="ke ir">分析</strong> &gt; <strong class="ke ir">事件</strong>选项卡下查看这些聚合事件。</p><p id="4052" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">剩下的就是用AWS analyticsService替换掉<code class="fe mm mn mo mp b">AppDelegate.swift</code>文件中的本地<code class="fe mm mn mo mp b">analyticsService</code>。</p><p id="9a91" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将<code class="fe mm mn mo mp b">LocalAnalyticsService()</code>改为<code class="fe mm mn mo mp b">AWSAnalyticsService()</code>。</p><h2 id="e255" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">在Amazon Pinpoint控制台中查看分析</h2><p id="60d1" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">一旦你运行你的应用程序，并做一些事情来生成用户分析和自定义事件流量，你可以使用Amplify CLI打开Pinpoint控制台:</p><pre class="mg mh mi mj gt mz mp na nb aw nc bi"><span id="a1ee" class="lh li iq mp b gy nd ne l nf ng">$ amplify analytics console</span></pre><p id="3753" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">可能会要求您登录控制台—只需使用您的AWS凭据。您将直接进入Pinpoint应用程序的分析选项卡，并可以开始浏览图表。</p><h2 id="3d6f" class="lh li iq bd lj lk ll dn lm ln lo dp lp kn lq lr ls kr lt lu lv kv lw lx ly lz bi translated">记录自定义事件</h2><p id="9956" class="pw-post-body-paragraph kc kd iq ke b kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv me kx ky kz ij bi translated">默认情况下，Amazon Pinpoint SDK自动收集用户人口统计数据和应用程序会话活动，无需任何额外代码。然而，如果您想要收集非默认事件，通常会添加特定于应用程序的自定义分析事件，如里程碑、游戏级别成就或<a class="ae mf" href="https://aws.github.io/aws-sdk-ios/docs/reference/Classes/AWSPinpointAnalyticsClient.html#//api/name/createVirtualMonetizationEventWithProductId:withItemPrice:withQuantity:withCurrency:" rel="noopener ugc nofollow" target="_blank">收入事件</a>。如果您已经实现了应用内购买，那么您可能希望在协议中添加一个<code class="fe mm mn mo mp b">recordRevenue()</code>函数(以及具体的实现)。这对于查看你通过应用内购买赚了多少钱的实时更新(在Pinpoint控制台上)非常有用。</p><p id="3999" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您还可以使用辅助信息来扩充用户人口统计事件，如当前已验证的用户、设备位置和其他自定义字段。我们现在收集的越多，我们的用户群就越有利于有针对性的参与。所以，花点时间想想你想收集什么，然后尝试一下。在后面的文章中，当我们讨论通过推送通知、sms和电子邮件等沟通渠道进行有针对性的互动时，我们将使用这些客户群。</p></div></div>    
</body>
</html>