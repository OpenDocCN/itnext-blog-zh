<html>
<head>
<title>How to backup and restore Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何备份和恢复云Firestore</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-backup-and-restore-cloud-firestore-d16537374640?source=collection_archive---------0-----------------------#2018-01-17">https://itnext.io/how-to-backup-and-restore-cloud-firestore-d16537374640?source=collection_archive---------0-----------------------#2018-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7210971ba0ea87db28867e8f9e199fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RRHnSIV4giXh_WKd25-5RA.jpeg"/></div></div></figure><p id="fb57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"><em class="kw">*更新</em> </strong>:我写了一个<a class="ae kx" href="https://www.npmjs.com/package/firestore-export-import" rel="noopener ugc nofollow" target="_blank"> NPM包</a>，帮助你备份和恢复firestore数据。想的话可以试试。它还可以帮助备份子集合；)</p><div class="ky kz gp gr la lb"><a href="https://www.npmjs.com/package/firestore-export-import" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">firestore-出口-进口</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">用于备份和还原Firebase Firestore的NPM软件包</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">www.npmjs.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="3072" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">*更新</strong>:感谢<a class="lq lr ep" href="https://medium.com/u/43638038564e?source=post_page-----d16537374640--------------------------------" rel="noopener" target="_blank">安德鲁的</a>信息。Firebase只是更新了它们的导入和导出特性。可以在这里阅读:<a class="ae kx" href="https://firebase.google.com/docs/firestore/manage-data/export-import" rel="noopener ugc nofollow" target="_blank">https://firebase . Google . com/docs/firestore/manage-data/export-import</a></p><p id="4e9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，如果您愿意，您仍然可以使用此软件包:)</p><p id="673d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">先决条件</strong></p><p id="b159" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要<a class="ae kx" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>或者可以运行JAVASCRIPT (JS)文件的东西。</p><p id="15bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从Firebase控制台的<em class="kw">项目设置&gt;服务帐户</em>中获取serviceAccount JSON文件</p><p id="f6dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用自己的App初始化时，更改<em class="kw"> databaseURL </em></p><p id="a85a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">从Firestore导出JSON数据</strong></p><p id="4dc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本将从您的Firestore中保存一个收藏，并将其另存为<strong class="ka ir"><em class="kw">Firestore-export . JSON</em></strong></p><p id="d522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以将该脚本命名为export.js，并使用以下代码运行它</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="47a4" class="mb mc iq lx b gy md me l mf mg">node export.js &lt;your-collection-name&gt;</span></pre><p id="c685" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记得在运行脚本之前安装NPM软件包</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="fbc2" class="mb mc iq lx b gy md me l mf mg">var admin = require("firebase-admin");<br/>var fs = require('fs');<br/>var serviceAccount = require("./serviceAccountKey.json");<br/><br/>var collectionName = process.argv[2];<br/><br/>// You should replae databaseURL with your own<br/>admin.initializeApp({<br/>  credential: admin.credential.cert(serviceAccount),<br/>  databaseURL: "https://&lt;your-project-name&gt;.firebaseio.com"<br/>});<br/><br/>var db = admin.firestore();<br/><br/>var data = {};<br/>data[collectionName] = {};<br/><br/>var results = db.collection(collectionName)<br/>.get()<br/>.then(snapshot =&gt; {<br/>  snapshot.forEach(doc =&gt; {<br/>    data[collectionName][doc.id] = doc.data();<br/>  })<br/>  return data;<br/>})<br/>.catch(error =&gt; {<br/>  console.log(error);<br/>})<br/><br/>results.then(dt =&gt; {<br/>  // Write collection to JSON file<br/>  fs.writeFile("firestore-export.json", JSON.stringify(dt), function(err) {<br/>      if(err) {<br/>          return console.log(err);<br/>      }<br/>      console.log("The file was saved!");<br/>  });<br/>})</span></pre><p id="385c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">将JSON数据导入Firestore </strong></p><p id="505d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将有助于将单个集合导入到您的Firestore。这是我将用于导入的示例JSON文件</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="e0e9" class="mb mc iq lx b gy md me l mf mg">{<br/>  "test" : {<br/>    "first-key" : {<br/>      "email"   : "dungnq@itbox4vn.com",<br/>      "website" : "dalenguyen.me",<br/>      "custom"  : {<br/>        "firstName" : "Dale",<br/>        "lastName"  : "Nguyen"<br/>      }<br/>    },<br/>    "second-key" : {<br/>      "email"   : "test@dalenguyen.me",<br/>      "website" : "google.com",<br/>      "custom"  : {<br/>        "firstName" : "Harry",<br/>        "lastName"  : "Potter"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="2b13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该脚本将以“<em class="kw">测试</em>”作为集合名称，以<em class="kw">“第一密钥”+“第二密钥”</em>作为文档导入。</p><p id="d5ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用此命令导入Firestore</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="bac0" class="mb mc iq lx b gy md me l mf mg">node import.js import-to-firestore.json</span></pre><p id="5b84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">脚本名为<em class="kw"> import.js </em>，示例JSON文件为<em class="kw">import-to-firestore . JSON</em></p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="188c" class="mb mc iq lx b gy md me l mf mg">var admin = require("firebase-admin");<br/>var fs = require('fs');<br/>var serviceAccount = require("./serviceAccountKey.json");<br/><br/>var fileName = process.argv[2];<br/><br/>// You should replae databaseURL with your own<br/>admin.initializeApp({<br/>  credential: admin.credential.cert(serviceAccount),<br/>  databaseURL: "https://&lt;your-project-name&gt;.firebaseio.com"<br/>});<br/><br/>var db = admin.firestore();<br/><br/>var collectionName = '';<br/><br/><br/>fs.readFile(fileName, 'utf8', function(err, data){<br/>  if(err){<br/>    return console.log(err);<br/>  }<br/><br/>  // Turn string from file to an Array<br/>  dataArray = JSON.parse(data);<br/><br/>  for(var index in dataArray){<br/>    collectionName = index;<br/>    for(var doc in dataArray[index]){<br/>      if(dataArray[index].hasOwnProperty(doc)){<br/>        db.collection(collectionName).doc(doc)<br/>        .set(dataArray[index][doc])<br/>        .then(() =&gt; {<br/>          console.log('Document is successed adding to firestore!');<br/>        })<br/>        .catch(error =&gt; {<br/>          console.log(error);<br/>        });<br/>      }<br/>    }<br/>  }<br/><br/>})</span></pre><p id="8ccd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想看看资源库，请看看我的Github账号:<a class="ae kx" href="https://github.com/dalenguyen/firestore-import-export" rel="noopener ugc nofollow" target="_blank">https://github.com/dalenguyen/firestore-import-export</a></p></div></div>    
</body>
</html>