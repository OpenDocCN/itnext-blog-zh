<html>
<head>
<title>Redux Saga generic api function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux Saga通用api函数</h1>
<blockquote>原文：<a href="https://itnext.io/redux-saga-generic-api-function-c99ee5647e29?source=collection_archive---------0-----------------------#2018-02-18">https://itnext.io/redux-saga-generic-api-function-c99ee5647e29?source=collection_archive---------0-----------------------#2018-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4e66691aa668401a60ef7d108953cb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GC9G3YWGrTD85yV5N0STg.png"/></div></div></figure><p id="f2b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fredux-saga-generic-api-function-c99ee5647e29" rel="noopener ugc nofollow" target="_blank"> <em class="kx">点击这里在LinkedIn </em>上分享这篇文章</a></p><p id="0e9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一下这个saga.js主文件，它定义了两个函数，但是还有更多的函数:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="0de0" class="lh li iq ld b gy lj lk l ll lm">import { takeLatest, put, call } from 'redux-saga/effects';<br/>import actions from '../actions';<br/>import api from '../api';</span><span id="fe4f" class="lh li iq ld b gy ln lk l ll lm">function* getFromServer(params) {<br/> try {<br/>        const data = yield call(api.getFromServer, ...params);<br/>        yield put({ type: action.GET_FROM_SERVER_SUCCESS, data });<br/>    } catch (error) {<br/>        yield put({ type: actions.GET_FROM_SERVER_ERROR, error })<br/>    }<br/>}</span><span id="244b" class="lh li iq ld b gy ln lk l ll lm">function* getOtherStuff(params) {<br/> try {<br/>        const data = yield call(api.getOtherStuff, ...params);<br/>        yield put({ type: action.GET_OTHER_STUFF_SUCCESS, data });<br/>    } catch (error) {<br/>        yield put({ type: actions.GET_OTHER_STUFF_ERROR, error })<br/>    }<br/>}</span><span id="9596" class="lh li iq ld b gy ln lk l ll lm">export function* sagas() {<br/>    yield takeLatest(actions.GET_FROM_SERVER, getFromServer);<br/>    yield takeLatest(actions.GET_OTHER_STUFF, getOtherStuff);<br/>}</span></pre><p id="9c98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，saga采用最新的GET_FROM_SERVER和GET_OTHER_STUFF操作，并从api/index.js调用函数，其中实际的服务器通信是解耦的。在这个结构中，我们需要在actions/index.js中为每个端点定义三个不同的操作，一个sagas/index.js中的新函数或者一个新文件和一个导入。与其让它变大，不如让它变得更通用，就像这样:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="8d74" class="lh li iq ld b gy lj lk l ll lm">function* generic(...data) {<br/>    let func = data[0];<br/>    let params = data[1];<br/>    let type = params.type;<br/> try {<br/>        const data = yield call(api[func], params);<br/>        yield put({ type: actions[type] + actions.SUCCESS, data });<br/>    } catch (error) {<br/>        console.log('saga fail: ', error);<br/>        yield put({ type: actions[type] + actions.ERROR, error })<br/>    }<br/>}</span><span id="1847" class="lh li iq ld b gy ln lk l ll lm">export function* sagas() {<br/>    yield takeLatest(actions.GET_FROM_SERVER, generic, 'getFromServer');<br/>    yield takeLatest(actions.GET_OTHER_STUFF, generic, 'getOtherStuff');<br/>}</span></pre><p id="8a00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们有一个通用的api调用者，可以用于主sagas()函数中的任何产出。我们只需要在sagas()函数中添加一行代码就完成了。还有，在actions/index.js中，我们只需要定义_SUCCESS和_ERROR两个后缀，它们在saga和redux通信中使用，这样就减少了动作类型的数量。</p><p id="fd32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您甚至可以更进一步，在分派中传递函数名，这样甚至不再需要接触saga，而是包含容器、api调用者和reducer之间的通信。</p><p id="9ea9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢这篇文章，给我一些掌声，我会发布一个通用的api调用太:D</p></div></div>    
</body>
</html>