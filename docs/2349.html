<html>
<head>
<title>AWS App Mesh — Service Mesh for Microservices Running on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS应用网格—针对在AWS上运行的微服务的服务网格</h1>
<blockquote>原文：<a href="https://itnext.io/aws-app-mesh-service-mesh-for-microservices-running-on-aws-3f667f005d6a?source=collection_archive---------3-----------------------#2019-05-09">https://itnext.io/aws-app-mesh-service-mesh-for-microservices-running-on-aws-3f667f005d6a?source=collection_archive---------3-----------------------#2019-05-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/44041f7d9ccf0e21431db5b4ee87667f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3PV38XdT5T5-3q467q_jA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">AWS的服务网格—应用网格</strong></figcaption></figure><div class=""/><p id="af6c" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在过去的几年中,“服务网格”的概念变得越来越流行，可供选择的方法也越来越多。有多个服务网格开源项目:Istio、Linkerd、Envoy和Conduit，它们可以部署在任何Kubernetes环境中。<a class="ae lb" href="https://aws.amazon.com/blogs/compute/introducing-aws-app-mesh-service-mesh-for-microservices-on-aws/" rel="noopener ugc nofollow" target="_blank"> AWS App Mesh </a>可以与运行在<a class="ae lb" href="https://aws.amazon.com/ecs" rel="noopener ugc nofollow" target="_blank">亚马逊弹性容器服务(亚马逊ECS) </a>、<a class="ae lb" href="https://aws.amazon.com/eks" rel="noopener ugc nofollow" target="_blank">亚马逊弹性容器服务的Kubernetes(亚马逊EKS) </a>和运行在亚马逊EC2的<a class="ae lb" href="https://aws.amazon.com/kubernetes" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>上的微服务一起使用。其他解决方案和App Mesh之间的显著区别在于，AWS管理控制平面，用户只需通过微服务部署数据平面，就可以将任何应用程序附加到网格。</p><p id="a95b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它的功能和集成仍在开发中，可以在预览版中使用。App Mesh为AWS上运行的微服务建立和管理服务网格。为此，App Mesh在每个微服务容器旁边运行开源特使代理，并配置代理来处理进出每个容器的所有通信。</p><p id="4818" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS App Mesh的核心是一个使用<a class="ae lb" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Envoy代理</a>的解决方案。它运行在第3层，但具有理解HTTP、HTTPS、GRPC和其它更高层协议的智能。它被写来做一件事，代理，并做好这一点。要大规模使用Envoy(数百或数千个连接)，需要一个实体来管理Envoy，这就是App Mesh所扮演的角色。App Mesh可以与AWS中的任何计算服务一起使用(ECS、EKS、EC2)。理论上，任何可以与特使管理层对话的服务都可以集成，但这取决于集成。</p><h1 id="d3d5" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">应用网状架构</h1><p id="d0db" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在将Istio或Linkerd用于服务网格的一般情况下，用户必须管理控制平面和数据平面。借助App，网格数据平面部署在应用程序中，而控制平面对用户隐藏，由Amazon管理。与任何其他AWS托管服务一样，App Mesh控制平面通过CLI和SDK公开。</p><p id="4a19" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何服务网格架构都包括一个控制平面:控制流量的策略和配置集。它是决策实施方式和数据平面背后的“如何”:使用上面列出的功能(路由、负载平衡、安全等),数据(网络数据包)进出微服务所执行的实际操作。).由于AWS对用户屏蔽了控制平面组件，因此下面是必须由用户配置的数据平面组件。</p><h1 id="2817" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">成分</h1><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/0d9d3ebab572c3befe156561138112e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xbHteSVOw60GvkgZ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd"> AWS服务网格组件</strong></figcaption></figure><p id="7702" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要将ECS/EKS上的微服务与App Mesh集成，应在微服务部署工件中添加额外的容器，其中包括作为边车部署的Envoy代理容器。这些额外的容器拦截流量，并根据应用网格控制平面应用的策略对其进行控制。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/dca96b0a1ec5c388e75db04aa3f263aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Taa7iZuBys03L_D2"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">服务网格组件</strong></figcaption></figure><h1 id="2ccc" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">应用网格对象</h1><p id="7c88" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">以一个经典的多层微服务为例，它包含多个版本的应用程序。以下ColerApp包括:</p><ul class=""><li id="7ae8" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">colorgateway:查询<em class="ms"> colorteller </em>服务</li><li id="2e13" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">colorteller:返回基于环境变量的颜色</li><li id="8277" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">TesterService:简单的服务，只查询<em class="ms"> colorgateway </em>并将结果记录在日志文件中</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/8995d7adfc4694afa2db13c4db17e0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ob9G7IBOA3GJ2U7i"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">应用网格对象</strong></figcaption></figure><p id="77c5" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了微服务应用之外，应用堆栈中还嵌入了两个容器，即:Envoy (sidecar代理，用于将所有web流量发送到应用容器)和proxy-init(sidecar容器，用于管理路由器配置),用于将微服务粘合到应用网格。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/8b31c66457fdc436b6a1f76ae83d8cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2ANZpb-ApnFc_aKg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">集装箱定义— AWS </strong></figcaption></figure><p id="908a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要控制流向此特定应用的流量，应用网格数据平面需要使用AWS应用网格CLI在应用网格控制平面上创建以下对象:</p><ol class=""><li id="b4dd" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mz mp mq mr bi translated">服务网</li></ol><figure class="mf mg mh mi gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/bf6323b2be01f1a96980386a5ac7f72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/0*Vu2dgHf5jQSZTdM5"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">列出网格</strong></figcaption></figure><p id="6ae8" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.到colorgateway和colorteller的虚拟路由器</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/74aaf8926c8be6d6c26dbeeb9e93f2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ib_IHDl2wyruhy2O"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">列出虚拟路由器</strong></figcaption></figure><p id="ef46" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.每个特定服务/应用程序的虚拟节点</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/e9090cc0f8c01743e2def7d6fd08eb98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ivfGB0uNsDr17cOW"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">列出虚拟节点</strong></figcaption></figure><p id="3c79" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.通过特定虚拟路由器路由到特定服务</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/79b335f5a1fa1a105c0f7102c99dd00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xu4f7aZYvwINbgOx"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">列出路线</strong></figcaption></figure><h1 id="5fb4" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">AWS Elastic Kubernetes服务上的应用程序网格(EKS)</h1><p id="aaf8" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">App Mesh通过向Kubernetes PodSpec添加特使代理图像来与EKS合作。App Mesh将指标、日志和跟踪导出到所提供的特使引导配置中指定的端点。App Mesh提供了一个API来配置启用Mesh的微服务之间的流量路由、断路、重试和其他控制。</p><h1 id="2d61" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">流动</h1><p id="6811" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">以上面提到的ColorApp为例，下面简单介绍了将EKS上运行的微服务与app mesh集成的步骤:</p><ol class=""><li id="0bf3" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mz mp mq mr bi translated">如上所示，创建一个名为AppColor的网格对象</li><li id="1651" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mz mp mq mr bi translated">一个EKS控制平面连同工人被创建如下所示:</li></ol><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/0693148f943e676150e32ee6915d918e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m5uHUM7_jb0rRmjp"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd"> AWS —服务网格</strong></figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nf"><img src="../Images/061cd0f805f717b459dfc57a1df46d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Oa_RhPnMHClQ2GVp"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">Kubernetes上的Appmesh用Weaveworks可视化—编织范围</strong></figcaption></figure><p id="5aec" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用户可以使用类似“<a class="ae lb" href="https://github.com/weaveworks/scope" rel="noopener ugc nofollow" target="_blank"> Weave Scope </a>”的工具:Docker和Kubernetes的可视化和监控工具。它提供了对您的应用程序以及整个基础架构的自上而下的视图，并允许您在将分布式容器化应用程序部署到云提供商时，实时诊断该应用程序的任何问题。</p><p id="bd6e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.ColorApp应用程序与工作负载清单中配置的proxy-init和envoy一起部署</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/044d7d9aea756322dfc4cfc6abc69c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-jQGHU7T9DN-h7iS"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">应用程序部署清单</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nh"><img src="../Images/72f9b17477ce21f61de87184dbf81a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Wtsl8kGSoj1MpNko"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">EKS Kubernetes上的示例应用—用Weaveworks可视化—编织范围</strong></figcaption></figure><p id="1357" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个Pod将构成一个特使和代理初始化容器:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/d73a5c7285bcaab4ced1397908bc8f09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GRvGjzQF6v7ULlvM"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd"> Appmesh-Envoy交互—用Weaveworks可视化— Weave范围</strong></figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/6dbfd20200f54ea6c766c804614b6bc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*z2CkqAP5Ex1hqWTv"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">示例应用程序容器—用Weaveworks可视化—编织范围</strong></figcaption></figure><p id="15ca" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">部署上一节中提到的虚拟节点、路由器和路由:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/afb458a7e693cd2aea32cbfde3c093b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lIUYzzM9VKwafYXH"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">虚拟节点和规则—用Weaveworks可视化—编织范围</strong></figcaption></figure><p id="6fa1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.由于应用程序网格具有到ColorApp的特定服务的所需虚拟节点和路由，因此不同的规则可作为路由应用:</p><ul class=""><li id="c242" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">100%流量到Colorteller-White槽colorteller-white-virtual_node和colorteller-virtual_router:</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/2e7a8b38ebf2ef8eee4e6dbdb5c5a45f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eC1s0hzKjffTi4wx"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">配置路线</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/e911185f01c5d4a98d6cc37cea64fc6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*czKA0L7R6dn0Kvii"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd"> Curl到上面创建的服务—测试金丝雀流—使用Weaveworks的Pod管理—编织范围</strong></figcaption></figure><p id="12de" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上所述，使用AWS应用程序网格应用的金丝雀流已经到位，它控制着到白色版本的整个流量。</p><ul class=""><li id="0990" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">在蓝色和黑色之间划分流量(典型的金丝雀场景)</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/d893e2edbeb62f10f422bf75a79cf7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3Ty0SUeN44Lws_2l"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">权重配置—路线规则</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/be161b8ae13907f5f01ace208091c1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nhvfrFRqH4Tqnyqg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><strong class="bd jd">测试重量—金丝雀规则—使用Weaveworks的Pod管理—编织范围</strong></figcaption></figure><p id="76d4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如上所示，蓝色和黑色之间具有不同权重的金丝雀流由AWS应用网格执行，其中服务网格控制平面完全由AWS管理。实现下面显示的规则所需的底层配置是无缝的</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/6dfa288db0e60f2ec6c1885c04af9217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZP2aVj7rcDqCgd_u"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">Appmesh规则</figcaption></figure><h1 id="369d" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">AWS弹性容器服务(ECS)上的应用网格</h1><p id="b0df" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">App Mesh为Amazon ECS管理的应用程序提供了新的通信、观察和管理功能。将特使代理映像添加到ECS任务定义中，使App Mesh能够管理特使配置，从而为ECS上的微服务提供服务网格功能。</p><h1 id="f80f" class="lc ld jg bd jd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">流动</h1><p id="b694" class="pw-post-body-paragraph kd ke jg kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">以上面提到的ColorApp为例，将微服务与app mesh集成的步骤如下所示:</p><ol class=""><li id="677c" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mz mp mq mr bi translated">如下所示，创建了一个由3个节点组成的群集来为ECS提供服务:</li></ol><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/bd833466010df233e5f50ed89044d13b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MS3-8SKXO5hw8MXQ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">ECS — Appmesh</figcaption></figure><p id="e469" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.微服务的所有服务都部署到上面创建的ECS集群中:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/44618d8726ae54c8145f2f58c252bf9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZHKpnVJP40xJ0-17"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">ECS集群— Appmesh</figcaption></figure><p id="1b2e" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.每个服务任务定义包括两个额外的容器(envoy和proxy-init)以及app容器。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/ccdd06eda7ace80697a6202c1c6fd370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_DcmSobGJCHjW2du"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">容器定义— ECS</figcaption></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/0a240a28cd897ec85ce95e1d231ec038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AjLW9ghgApYtmDV1"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">特使配置— ECS</figcaption></figure><p id="d53b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.在应用当前网格规则(不包含任何特定权重参数)的情况下，所有流量被直接发送到colorteller-virtual_node，该节点在服务下的端点之间平均分配流量。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/cbde6d9393a30827b7be72dadaa13aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iaDMJXoR-WU9BxIx"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">配置— Appmesh</figcaption></figure><p id="2250" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.将一个样本金丝雀流规则应用到网格中，可以在应用程序版本之间实现定向/加权流，这会改变下面显示的模式</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/2694dd3a1fe0724f828044eef60264fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v-DlEQmeYtaaaBzX"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">金丝雀流量配置</figcaption></figure><p id="0275" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">6.有了金丝雀规则，流量将根据提供的权重参数进行分配，回复将仅来自蓝色和红色</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/f81fd5432daf1eb4826ce4c0e9b86772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SEVEx75vfMFtUZ88"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">金丝雀在行动</figcaption></figure><p id="3da1" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">App Mesh可以在同一个微服务的多个版本之间进行切换，无需任何停机时间。通过改变路由器的规则，流量几乎可以立即从一个版本转移到另一个版本。可以密切监视参与同一个网格的微服务的延迟、错误率、跟踪和调试信息。这种遥测数据可以传输到CloudWatch、X-Ray和其他第三方监控解决方案。应用网格作为跨多个AWS平台的服务网格的统一平台带来了:</p><ul class=""><li id="ea6a" class="mj mk jg kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">通过将通信管理逻辑从应用程序代码和库卸载到可配置的基础设施中来简化操作。</li><li id="313e" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">通过对整个应用程序的服务级别日志、指标和跟踪的端到端可见性，减少故障排除所需的时间。</li><li id="c958" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">通过动态配置到新应用程序版本的路由，轻松推出新代码。</li><li id="0af9" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">通过自定义路由规则确保高可用性，这些规则有助于确保每项服务在部署过程中、出现故障后以及随着用户应用程序的扩展而高度可用。</li><li id="120f" class="mj mk jg kf b kg mt kk mu ko mv ks mw kw mx la mo mp mq mr bi translated">使用一组API管理所有服务到服务的流量，而不管服务是如何实现的。</li></ul><p id="878a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总之，AWS App Mesh是对AWS构建模块和微服务架构的一个很好的补充。由于该项目仍在发展中，并有一个积极的路线图，用户可以期待App Mesh在未来扩展其对许多其他AWS内部服务的支持。</p></div></div>    
</body>
</html>