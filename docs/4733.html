<html>
<head>
<title>koa just got a beautiful, auto-generated admin panel.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">koa刚刚得到了一个漂亮的自动生成的管理面板。</h1>
<blockquote>原文：<a href="https://itnext.io/koa-just-got-a-beautiful-auto-generated-admin-panel-f5f89d83e892?source=collection_archive---------0-----------------------#2020-09-03">https://itnext.io/koa-just-got-a-beautiful-auto-generated-admin-panel-f5f89d83e892?source=collection_archive---------0-----------------------#2020-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8fa0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在这篇短文中，我将向您展示如何在您的koa应用程序中添加一个全功能的管理面板。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/90c6f41ef27ad893cf2822a6a83ed666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kxt7-kuif715xqw5nnyIRQ.png"/></div></div></figure><p id="cb9b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一篇5分钟长的文章，可以帮你省下几周的工作。</p><p id="5daf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">按照本教程，你将有一个认证，漂亮的界面和你的数据的整个CRUD应用程序。此外，您可以根据自己的具体需求对其进行调整。</p><h1 id="1c05" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">堆栈</h1><p id="fab4" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">显然，我们将使用koa及其部分模块。但是作为一个管理面板界面，我们将使用<a class="ae mk" href="https://github.com/SoftwareBrothers/admin-bro" rel="noopener ugc nofollow" target="_blank"> AdminBro </a>，它在上周获得了官方<a class="ae mk" href="https://adminbro.com/module-@admin-bro_koa.html" rel="noopener ugc nofollow" target="_blank"> koa </a>支持。</p><p id="788d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以这是热点新闻。^^^</p><h1 id="15a9" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">装置</h1><p id="8b3f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如果从头开始，首先初始化repo并安装<a class="ae mk" href="https://koajs.com/" rel="noopener ugc nofollow" target="_blank"> koa </a>:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="721d" class="mq lo iq mm b gy mr ms l mt mu">mkdir koa-admin<br/>cd koa-admin<br/>yarn init <br/>yarn add koa</span></pre><p id="8865" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在安装设置管理面板所需的以下依赖项:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="501e" class="mq lo iq mm b gy mr ms l mt mu">yarn add admin-bro @admin-bro/koa @koa/router koa2-formidable</span></pre><h1 id="d3a7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">管理员设置-基础</h1><p id="41ed" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现在我们必须启动管理界面。创建一个<code class="fe mv mw mx mm b">index.js</code>文件并插入以下内容:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="a277" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们所做的:</p><ul class=""><li id="39cd" class="na nb iq kt b ku kv kx ky la nc le nd li ne lm nf ng nh ni bi translated">创建一个常规的<code class="fe mv mw mx mm b">koa</code>应用程序</li><li id="92cb" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">用一些默认设置初始化AdminBro</li><li id="6d96" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">使用<code class="fe mv mw mx mm b">buildRouter</code>方法附加管理员</li></ul><p id="f018" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，让我们用<code class="fe mv mw mx mm b">node</code>命令运行应用程序。(也可以用<code class="fe mv mw mx mm b">nodemon</code>)</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="ef9d" class="mq lo iq mm b gy mr ms l mt mu">node index.js</span></pre><p id="14de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并访问<a class="ae mk" href="http://localhost:3000/admin" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/admin</a>页面。您应该会看到类似这样的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/62ff34279c9e9494f089e7002b090483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cJ7JuGYLMEww8JGVMie_w.png"/></div></div></figure><p id="8bbc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好吧，它很漂亮，也很管用，但没什么用。让我们改变这一点。</p><h1 id="7ca5" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">用你的数据填充它</h1><p id="7c0e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">这是与<a class="ae mk" href="https://koajs.com/" rel="noopener ugc nofollow" target="_blank"> koa </a>本身不完全相关的部分。<a class="ae mk" href="https://adminbro.com/" rel="noopener ugc nofollow" target="_blank"> AdminBro </a>赋予你管理各种数据的能力。它支持以下适配器:</p><ul class=""><li id="7165" class="na nb iq kt b ku kv kx ky la nc le nd li ne lm nf ng nh ni bi translated"><a class="ae mk" href="https://adminbro.com/module-@admin-bro_sequelize.html" rel="noopener ugc nofollow" target="_blank"> @admin-bro/sequelize </a></li><li id="a3d3" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated"><a class="ae mk" href="https://adminbro.com/module-@admin-bro_typeorm.html" rel="noopener ugc nofollow" target="_blank"> @admin-bro/typeorm </a></li><li id="3d3e" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated"><a class="ae mk" href="https://adminbro.com/module-@admin-bro_mongoose.html" rel="noopener ugc nofollow" target="_blank">@ admin-bro/猫鼬</a></li><li id="e4fe" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">@admin-bro/firebase(测试版)</li></ul><p id="ce3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我将向您展示一个用mongoose适配器显示来自<a class="ae mk" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>的数据的最简单的例子，但是首先，请确保您已经在本地运行了<a class="ae mk" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> MongoDB </a>。</p><p id="3163" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在安装mongoose依赖项:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="4c43" class="mq lo iq mm b gy mr ms l mt mu">yarn add @admin-bro/mongoose mongoose</span></pre><p id="2914" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并更改我们的<code class="fe mv mw mx mm b">index.js</code>文件。</p><ol class=""><li id="c807" class="na nb iq kt b ku kv kx ky la nc le nd li ne lm np ng nh ni bi translated">需要新的依赖项，并向AdminBro注册mongoose适配器，这样它就知道如何处理传递的模型。</li><li id="b101" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm np ng nh ni bi translated">创建一个新的mongoose模型:拥有一个<code class="fe mv mw mx mm b">email</code>和<code class="fe mv mw mx mm b">encryptedPassword</code>的用户。</li><li id="538d" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm np ng nh ni bi translated">我们必须先用<code class="fe mv mw mx mm b">await</code>对蒙哥用<code class="fe mv mw mx mm b">connect</code>的方法。这就是为什么我们需要用一个<code class="fe mv mw mx mm b">async</code>函数来包装整个设置。</li><li id="f4d0" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm np ng nh ni bi translated">在设置中，我们将用户传递给AdminBro中的<code class="fe mv mw mx mm b">resources</code>数组。</li></ol><p id="86ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个更新的<code class="fe mv mw mx mm b">index.js</code>文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="3748" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是创建新用户的样子:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/4c7db46b1578d2140c3bd92e76ab6404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJfdtoiwTPA6wxWfXICVjw.png"/></div></div></figure><p id="0080" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对于用户模型，AdminBro已经生成了一个带有验证的完整CRUD。</p><h1 id="558f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">密码哈希</h1><p id="4d5b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">问题出在密码字段，每当用户传递信息时，都应该对其进行哈希处理。幸运的是，AdminBro附带了可安装的代码块，称为<a class="ae mk" href="https://adminbro.com/tutorial-features.html" rel="noopener ugc nofollow" target="_blank"> AdminBro特性</a>。猜猜看，密码哈希有一个特性。</p><p id="e758" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先用<a class="ae mk" href="https://www.npmjs.com/package/argon2" rel="noopener ugc nofollow" target="_blank"> argon2 </a>安装该功能，它将用于加密密码。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="db8c" class="mq lo iq mm b gy mr ms l mt mu">yarn add @admin-bro/passwords argon2</span></pre><p id="0992" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并将该特性传递给AdminBro选项，如下所示</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="30ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">基本上就是这样了。现在您可以创建用户，他们的密码将被自动散列。很酷——对吧？</p><p id="2f0f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在继续之前，至少创建一个具有已知电子邮件和密码的用户。我来建议:<code class="fe mv mw mx mm b">admin@example.com:password</code></p><h1 id="2ca6" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">证明</h1><p id="6864" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">由于我们在数据库中有用户，使用适当的密码散列，让我们添加一个认证机制。</p><p id="6a9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了做到这一点，我们必须将<code class="fe mv mw mx mm b">buildRouter</code>改为<code class="fe mv mw mx mm b">buildAuthenticatedRouter</code>，并定义<code class="fe mv mw mx mm b">async authenticate</code>方法。</p><p id="7fea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在此之前，我们还必须设置koa <code class="fe mv mw mx mm b">app.keys</code>,因为身份验证使用的是cookies。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="1362" class="mq lo iq mm b gy mr ms l mt mu">app.keys = ['super-secret1', 'super-secret2']</span></pre><blockquote class="nq nr ns"><p id="8b7d" class="kr ks nt kt b ku kv jr kw kx ky ju kz nu lb lc ld nv lf lg lh nw lj lk ll lm ij bi translated"><em class="iq">现实世界中最有可能的例子是</em> <code class="fe mv mw mx mm b"><em class="iq">process.env</em></code></p></blockquote><p id="4c40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，将<code class="fe mv mw mx mm b">buildRouter</code>改为<code class="fe mv mw mx mm b">buildAuthenticated</code>路由器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5b14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以我们首先寻找一个现有的用户，然后用<code class="fe mv mw mx mm b">argon2</code>检查她的密码。如果一切都是正确的，我们返回用户对象，该对象转到会话。然后可以在AdminBro内部使用它。</p><p id="7b8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我们再次运行应用程序后看到的情况:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/8583d241bc4a7d5c23e85d64e8413a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EzUD1F1lj7BtVdnIbBxl3A.png"/></div></div></figure><p id="6d8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">填入你刚刚创建的邮箱和密码(PS:我建议<code class="fe mv mw mx mm b">admin@example.com:password</code>:)——你就进去了。</p><h1 id="29e8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">总结，下一步是什么</h1><p id="20c9" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">呃，我们做到了。我们在几分钟内启动了整个应用程序、身份验证、密码哈希和用户管理(CRUD)。这一切都归功于惊人的<a class="ae mk" href="https://koajs.com/" rel="noopener ugc nofollow" target="_blank"> koa </a>框架和高超的<a class="ae mk" href="https://adminbro.com/" rel="noopener ugc nofollow" target="_blank"> admin-bro </a>管理面板。</p><p id="3902" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从这里你可以做很多事情:</p><ul class=""><li id="2c15" class="na nb iq kt b ku kv kx ky la nc le nd li ne lm nf ng nh ni bi translated">修改用户界面的外观</li><li id="aa81" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">添加新资源</li><li id="0e36" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">定义操作(如批准、不批准用户等)</li><li id="a25f" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">添加基于角色的访问控制</li><li id="0114" class="na nb iq kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">还有很多很多</li></ul><p id="da66" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要查看所有可用的选项——参见<a class="ae mk" href="https://adminbro.com/" rel="noopener ugc nofollow" target="_blank">adminbro.com</a>文档页面——它是巨大的。</p><p id="ba53" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">AdminBro经常被SoftwareBrothers的开发者更新，所以确保<a class="ae mk" href="https://github.com/SoftwareBrothers/admin-bro" rel="noopener ugc nofollow" target="_blank">启动回购</a>来激励他们:)。用<a class="ae mk" href="https://github.com/koajs" rel="noopener ugc nofollow" target="_blank"> koa </a>做同样的事情。</p><p id="b703" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你喜欢这个简短的教程。下次我想描述一些更高级的AdminBro主题。</p><p id="89b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你愿意，你可以下载一个服务器代码为<a class="ae mk" href="https://gist.github.com/tadeuszkora/3aff4bf07d279dc7d1c31af57ddf6466" rel="noopener ugc nofollow" target="_blank">的文件，你可以在这里</a>下载。</p></div></div>    
</body>
</html>