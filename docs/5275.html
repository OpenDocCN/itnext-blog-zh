<html>
<head>
<title>Kubernetes explained deep enough: Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes解释得足够深刻:服务</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-explained-deep-enough-services-1a0647499616?source=collection_archive---------3-----------------------#2021-01-30">https://itnext.io/kubernetes-explained-deep-enough-services-1a0647499616?source=collection_archive---------3-----------------------#2021-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/de86c8ca14d1aa6669408c375bf16c02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bu3XsoelZ683ajGi43217Q.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图片由<a class="ae jd" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3699542" rel="noopener ugc nofollow" target="_blank">皮克斯拜</a>的Gerd Altmann 提供</figcaption></figure><div class=""/><div class=""><h2 id="ef78" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">第5部分:服务可发现性、DNS、集群通信</h2></div><h1 id="f631" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">介绍</h1><p id="5e53" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这是Kubernetes迷你系列的第五部<strong class="lp jh"> Kubernetes解释得够深刻了</strong></p><p id="65f6" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">关于本博客的网络版以及关于docker、Kubernetes和Docker认证的更多信息，请访问:</p><div class="ip iq gp gr ir mo"><a href="https://www.itcertificationsguide.com/#/" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jh gy z fp mt fr fs mu fu fw jf bi translated">IT认证指南</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">描述</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.itcertificationsguide.com</p></div></div></div></a></div><h2 id="e4da" class="mx kw jg bd kx my mz dn lb na nb dp lf lw nc nd lh ma ne nf lj me ng nh ll ni bi translated">自定进度学习的Katacoda场景</h2><div class="ip iq gp gr ir mo"><a href="https://www.katacoda.com/decoder/courses/k8s-networking/k8s-networking-services" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jh gy z fp mt fr fs mu fu fw jf bi translated">Kubernetes网络:公开和消费服务|解码器| Katacoda</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">这个场景是Kubernetes的博客的一部分，解释得足够深入。Kubernetes网络是一个非常复杂的话题…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.katacoda.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ix mo"/></div></div></a></div><p id="3792" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><a class="ae jd" href="https://piotrzan.medium.com/kubernetes-explained-deep-enough-1ea2c6821501" rel="noopener">第一部分:简介</a></p><p id="ae38" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-explained-deep-enough-storage-eb16a66483c2">第2部分:Kubernetes解释得够深刻:存储</a></p><p id="a18a" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-explained-deep-enough-deployments-371755fbe2a3">第3部分:Kubernetes解释得足够深入:部署</a></p><p id="018f" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated"><a class="ae jd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-explained-deep-enough-configuration-cd4a9d1d8dcd">第四部分:Kubernetes解释得够深刻:配置</a></p><p id="597b" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">第5部分:服务可发现性、DNS、集群通信——这个博客</p><p id="25d5" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这个博客比其他部分稍微长一点，Kubernetes解释得足够深入。Kubernetes网络是一个非常复杂的主题，试图写出不同服务和机制的所有细微差别可能需要几个博客。相反，我们将关注Kubernetes网络的特定领域:服务，并着眼于它们的实际应用。</p><p id="1094" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">由于本系列是关于练习和实践的例子，我们将较少关注对每种服务类型的深入研究，而是将它们合并到一个更广泛的类别<em class="np">网络</em>中，并从整体的角度来看待它，只突出那些对我们将使用的例子重要的方面。</p><blockquote class="nq nr ns"><p id="7c3b" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated">如果您需要复习关于<a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>的内容，请访问Kubernetes文档</p><p id="95c0" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated">下图提供了基本定义</p></blockquote><h1 id="fcf9" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">它是如何工作的？</h1><p id="cb99" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在Kubernetes <em class="np">中，service </em>是一种资源，它抽象并封装了一种将运行在pods中的应用程序公开为网络服务的方式。</p><blockquote class="nq nr ns"><p id="27a0" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated">虽然服务不需要DNS就能工作，但强烈建议使用附加组件在Kubernetes上设置DNS服务。有几个DNS服务兼容 <a class="ae jd" href="https://github.com/kubernetes/dns/blob/master/docs/specification.md" rel="noopener ugc nofollow" target="_blank"> <em class="jg"> Kubernetes dns规范</em> </a> <em class="jg">，2个最流行的是:</em></p></blockquote><ul class=""><li id="2324" class="nw nx jg lp b lq mj lt mk lw ny ma nz me oa mi ob oc od oe bi translated"><a class="ae jd" href="https://coredns.io/" rel="noopener ugc nofollow" target="_blank">核心域名</a></li><li id="8a55" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated"><a class="ae jd" href="https://github.com/kubernetes/dns" rel="noopener ugc nofollow" target="_blank"> Kube-DNS </a></li></ul><p id="21dd" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在集群上设置DNS服务后，利用为每个服务创建的DNS记录来调用服务是非常容易的。由于Kubernetes网络是扁平的，这意味着资源可以通过它们的IP直接相互通信，这意味着应该可以从任何名称空间中的任何pod调用任何名称空间中的任何服务(假设没有网络策略阻止流量)。</p><p id="9b03" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">Kubernetes有4种类型的服务:</p><figure class="ol om on oo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/7ea87da6712fb69ec7cd147c269ed005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPCHLJDpcgdGzOUDRfAryQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><a class="ae jd" href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/services-networking/service/# publishing-services-service-types</a></figcaption></figure><blockquote class="nq nr ns"><p id="d6c0" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated"><em class="jg">关于端口的注意事项:理解服务清单中哪些端口做什么经常会令人困惑，所以让我们确保刷新定义:</em></p></blockquote><ul class=""><li id="ca2e" class="nw nx jg lp b lq mj lt mk lw ny ma nz me oa mi ob oc od oe bi translated"><strong class="lp jh">目标端口</strong>是<em class="np">应用</em>配置给<em class="np">监听</em>的端口</li><li id="df76" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated"><strong class="lp jh">端口</strong>是从外部访问应用程序的方式<em class="np"/></li><li id="977e" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated"><strong class="lp jh">节点端口</strong>是每个节点上的<em class="np">静态端口</em>，类型<em class="np">节点端口</em>的服务被公开</li></ul><h1 id="abb6" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">它解决什么问题？</h1><ul class=""><li id="1568" class="nw nx jg lp b lq lr lt lu lw op ma oq me or mi ob oc od oe bi translated">向集群外部的消费者公开pod</li><li id="20f0" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated">使pod能够相互通信</li><li id="f595" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated">服务很容易被发现</li><li id="2ac8" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated">pod向上和向下缩放不会中断通信</li></ul><h1 id="4dfe" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">如何实施？</h1><p id="3b7a" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们将重温<a class="ae jd" href="#what-problem-does-it-solve" rel="noopener ugc nofollow">一节中的场景，它解决了什么问题？</a>并验证陈述是否正确。</p><blockquote class="nq nr ns"><p id="cacb" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated"><em class="jg">如果你想学习一些有用的网络命令，我已经创建了一个帮助我通过CKA认证的要点</em></p></blockquote><figure class="ol om on oo gt is"><div class="bz fp l di"><div class="os ot l"/></div></figure><h1 id="0c12" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">先决条件</h1><p id="8cbc" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">这次我们将使用<a class="ae jd" href="https://www.katacoda.com/" rel="noopener ugc nofollow" target="_blank"> katacoda </a>代替asciinema录音。你只需要一个网络浏览器，好奇的心态和一些学习新事物的业余时间，不需要其他先决条件:)</p><blockquote class="nq nr ns"><p id="0841" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated"><a class="ae jd" href="https://www.katacoda.com/" rel="noopener ugc nofollow" target="_blank"><em class="jg"/></a><em class="jg">是一项伟大的免费服务。这是一个“为软件工程师提供的交互式学习和培训平台”，能够“在您的浏览器中使用真实环境学习新技术”</em></p></blockquote><h1 id="be56" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">示例场景</h1><p id="b1d1" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在任何系统中，一个非常常见的需求是能够促进已部署工件之间的点对点通信。这种类型的通信最常见的场景之一是多层架构(最常见的是3层):</p><ul class=""><li id="a032" class="nw nx jg lp b lq mj lt mk lw ny ma nz me oa mi ob oc od oe bi translated">表示层(UI)</li><li id="52af" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated">应用层(业务逻辑、API、中间件)</li><li id="db19" class="nw nx jg lp b lq of lt og lw oh ma oi me oj mi ob oc od oe bi translated">数据持久层(通常是数据库，但也可以是磁盘等)</li></ul><p id="c9f7" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">下图显示了多层架构应用程序不同层之间的连接。我们将看到如何使用Kubernetes的本地资源重新创建这个设置的通信部分。</p><figure class="ol om on oo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ou"><img src="../Images/0b813b2c2cc6246d5474ca026538050b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OA3KKKK75B519C1u7gKWiQ.png"/></div></div></figure><blockquote class="nq nr ns"><p id="c9d8" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated"><em class="jg">现代架构，尤其是微服务遵循不同的架构模式。例如</em> <a class="ae jd" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank"> <em class="jg">十二因素应用</em> </a> <em class="jg">方法，其中应用层和数据持久层之间的连接通过HTTPS完成，通常应用的UI部分作为静态web应用或SPA。</em></p></blockquote><p id="8dd7" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">Kubernetes世界和更广泛的基础设施即代码时代的一个关键区别是，服务器和其他资源一样，是动态配置的。工作负载可以随时在不同的服务器上重新安排，无需通知，一切都将照常运行。因此，第一个变化是，我们有了动态、灵活的基础架构，而不是固定的服务器。这些是Kubernetes集群节点。</p><p id="299f" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">我们不打算关注在公共DNS上发生的浏览器地址中URL的DNS解析。</p><p id="1177" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">现在，让我们看看使用Kubernetes时类似的架构会是什么样子:</p><figure class="ol om on oo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ov"><img src="../Images/6f3aa1ead2c274d2d54ca16ad2a6767c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ku96gtBMft3c3tx7Z_1Pow.png"/></div></div></figure><p id="3753" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">通过引入<em class="np">服务</em>抽象，我们将实际工作负载从通信机制中分离出来。这使我们能够利用Kubernetes基础设施的动态特性，并释放更多可能性，如扩展、层分离等。Kubernetes现在可以将pod移动到其他节点，扩展它们，或者破坏和重新创建，而不会对我们的应用程序造成中断。</p><p id="9000" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这一次，对于每个场景，我们将使用称为<a class="ae jd" href="https://docs.specflow.org/projects/specflow/en/latest/Gherkin/Gherkin-Reference.html" rel="noopener ugc nofollow" target="_blank">小黄瓜语法</a>的形式化符号。这将帮助我们更好地表达我们实验的目标和条件。</p><blockquote class="nq nr ns"><p id="80ee" class="ln lo np lp b lq mj kh ls lt mk kk lv nt ml ly lz nu mm mc md nv mn mg mh mi ij bi translated"><em class="jg">通常我们会使用测试框架，如</em> <a class="ae jd" href="https://docs.specflow.org/projects/specflow/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="jg"> Specflow </em> </a> <em class="jg">或</em><a class="ae jd" href="https://cucumber.io/" rel="noopener ugc nofollow" target="_blank"><em class="jg">Cucumber</em></a><em class="jg">，但出于学习的目的，我们将在Katacoda环境中手动执行步骤。</em></p></blockquote><p id="4e99" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">让我们描述一下我们的场景，然后前往我的<a class="ae jd" href="https://www.katacoda.com/decoder/courses/k8s-networking/k8s-networking-services" rel="noopener ugc nofollow" target="_blank"> Katacoda场景</a>并自己进行实验！</p><div class="ip iq gp gr ir mo"><a href="https://www.katacoda.com/decoder/courses/k8s-networking/k8s-networking-services" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jh gy z fp mt fr fs mu fu fw jf bi translated">Kubernetes网络:公开和消费服务|解码器| Katacoda</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">这个场景是Kubernetes的博客的一部分，解释得足够深入。Kubernetes网络是一个非常复杂的话题…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.katacoda.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ix mo"/></div></div></a></div><h1 id="df39" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">Katacoda场景</h1><p id="ba12" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">下面是用katacoda编写的测试场景的概述。每个场景都用gherkin语法编写，并在我们的实验环境中突出了Kubernetes的一个特性。</p><p id="e3ee" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">剧透警报，所有测试成功通过:)</p><figure class="ol om on oo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/1650e6315076d4d31f7b226098d642b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2zuxMltmaWU2q7jx3mwCA.png"/></div></div></figure><h1 id="8d2f" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">挑战</h1><p id="9944" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">你想测试什么吗？思考一个场景，测试一下，然后在评论中告诉我们。</p></div></div>    
</body>
</html>