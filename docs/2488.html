<html>
<head>
<title>Control an Arduino with Bluetooth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用蓝牙控制Arduino</h1>
<blockquote>原文：<a href="https://itnext.io/control-an-arduino-with-bluetooth-baddbf2d47ba?source=collection_archive---------1-----------------------#2019-06-01">https://itnext.io/control-an-arduino-with-bluetooth-baddbf2d47ba?source=collection_archive---------1-----------------------#2019-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5207" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用配备蓝牙功能的Arduino设备</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/990508887b03b720602c00cc829c1c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DH177UNQIXN5o3GmJMpbFg.png"/></div></div></figure><h2 id="9202" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">介绍</h2><p id="ea9d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">随着DIY爱好电子产品越来越受欢迎，制作酷的小工具变得比以往任何时候都容易。像Arduino这样的小型微型计算机对发烧友来说是一个真正的游戏规则改变者，因为它们比标准的微处理器开发板更便宜、更容易使用。在本文中，我们将了解如何将蓝牙模块连接到Arduino，然后从一个用Flutter构建的简单Android应用程序中控制和监控它。</p><p id="c3b7" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">本文假设您具备一些电子学知识和基本的计算机编程技能，但是这些并不是必需的(可以通过参与和完成这样的演示项目来获得)。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="ec33" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">材料清单</h2><p id="142d" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">为了建造这个项目，你需要一些简单的电子零件，其中一些可以很容易地替换掉。只要Arduino和蓝牙模块之间的分压器由两个电阻组成，接地端电阻的值是另一个电阻的两倍，各种Arduino板都可以正常工作，电阻值并不重要。</p><p id="6d18" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">以下是您需要的零件:</p><ul class=""><li id="678b" class="mv mw it ls b lt mj lw mk ld mx lh my ll mz mi na nb nc nd bi translated"><a class="ae ne" href="https://www.arduino.cc/en/Main/Boards" rel="noopener ugc nofollow" target="_blank"> Arduino板</a></li><li id="728e" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated"><a class="ae ne" href="https://www.google.com/search?q=arduino+hc-06" rel="noopener ugc nofollow" target="_blank"> HC-06 BT模块</a></li><li id="e1b7" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">(1) 1k电阻器—分压器信号侧</li><li id="5438" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">(1) 2k电阻—分压器接地侧</li><li id="88c6" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">(1) 4.7M电阻器—电容传感器负载</li><li id="155d" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">用纸包裹的小(~2英寸x 2英寸)金属箔片</li><li id="0cc0" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">5v直流电源、试验板、少量跳线</li><li id="4a61" class="mv mw it ls b lt nf lw ng ld nh lh ni ll nj mi na nb nc nd bi translated">带蓝牙的Android设备，用于测试应用程序</li></ul></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="94e1" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">连接起来</h2><p id="cf80" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">列出零件清单后，让我们看看如何将所有这些连接起来:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/2d444a557e2d5f2c89069ff1b0b64f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fuX6Q4eLHRkO80dlOaMXGA.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">显示Arduino、BT模块、传感器和电阻的示意图</figcaption></figure><p id="ddda" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">这里我们有一张Arduino、HC-06蓝牙模块、金属箔传感器和一些电阻的记事本草图。+5v直流电压和GND按预期接线。Arduino上的D2直接从模块上的TX引脚接收数据，而D3通过使用1k和2k电阻创建的简单分压器连接到RX。针脚D4和D8通过一个4.7米<em class="np">ω</em>电阻桥接，纸包金属箔传感器连接到D8。</p><p id="b897" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">分压器允许利用5V逻辑电平的Arduino安全地驱动HC-06的输入引脚，HC-06设计为使用3.3V。我们只需在一个方向上调整电压，因为5V组件可以安全地处理3.3V输出。实际上，5V不太可能损坏HC-06上的3.3V输入，但是，仅仅因为我们可以逃脱一两次，就开始这样做将是可怕的设计实践。在它们的预期范围之外操作东西基本上是在自找奇怪的bug。</p><p id="22f7" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">电容式传感器的工作原理是将D4的电平提高到高电平，等待D8上的电压达到与D4相同的电位需要多长时间，然后捕捉并处理每个传感器读数的输出。当有人触摸纸覆盖的箔传感器时，在箔、纸电介质和人的导电手之间形成一个电容器，当它充电时，从D4-D8电路中流出少量电流。一旦箔纸人体“电容器”完成充电，D4和D8上的电压相对于地将是相同的，然后Arduino CapactiveSensor库进行一些数学运算以获得最终的传感器值结果。</p><p id="32c5" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">除此之外，我们在Arduino上有内置的LED，我们将根据移动测试应用程序的命令打开和关闭它。这就是硬件方面的内容，现在让我们来看看一些项目代码。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="5e64" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">Arduino逻辑</h2><p id="3bf7" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">Arduino代码本身的设计非常简单，只有一个简短的C++文件和两个库导入。我们来看看文件<strong class="ls iu"> arduino/bt_demo.cpp </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="c774" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">这是Arduino单页荣耀的全部程序。首先，包括库<strong class="ls iu">软件Serial </strong>和<strong class="ls iu">电容传感器</strong>，然后初始化以连接到原理图中之前概述的引脚。</p><p id="15d8" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">接下来是<strong class="ls iu"> setup() </strong>函数，当设备上电或复位时，该函数在初始化期间被调用一次。在设置期间，<code class="fe ns nt nu nv b">LED_BUILTIN</code>引脚被置于<code class="fe ns nt nu nv b">OUTPUT</code>模式，电容传感器被校准，标准和蓝牙串行端口都被初始化为9600 <a class="ae ne" href="https://en.wikipedia.org/wiki/Baud" rel="noopener ugc nofollow" target="_blank">波特</a>。</p><p id="c46c" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">主程序<strong class="ls iu"> loop() </strong>是实际工作发生的地方。首先，指示传感器库获取30个样本平均值的原始值，该值存储为<code class="fe ns nt nu nv b">current</code>，然后通过蓝牙串行传输。在短暂的延迟之后，蓝牙设备被检查以查看是否有任何数据进入线路。如果是，则从设备中读取一个1字节字符，如果该字符是<em class="np">‘1’</em>，则<code class="fe ns nt nu nv b">LED_BUILTIN</code>亮起，否则熄灭。</p><p id="965c" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">Arduino就是这样。接下来，我们来看看控制app。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="9683" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">演示Android应用程序</h2><p id="bab5" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly ld lz ma mb lh mc md me ll mf mg mh mi im bi translated">这个项目的演示应用程序是一个默认的Flutter应用程序，由<code class="fe ns nt nu nv b">flutter create</code>创建，带有一些基本的UX和自定义本机代码，用于处理蓝牙连接本身。定制本机代码的原因是因为我在尝试使用社区包进行配对之前忘记了打开我的测试板，它无法工作。我认为这个包有问题，所以在意识到发生了什么之前，我很快就做了一个。圣生活。😆</p><p id="0899" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">让我们来看看应用程序入口点文件，<strong class="ls iu"> lib/main.dart </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="d293" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">文件<strong class="ls iu"> lib/main.dart </strong>包含应用程序UX，它由标题栏、传感器读数和用于打开和关闭板上LED的电源按钮组成。在这个文件中，我们有一些对<a class="ae ne" href="https://www.dartlang.org/tutorials/language/futures" rel="noopener ugc nofollow" target="_blank"> dart:async </a>和<code class="fe ns nt nu nv b">bt-controller.dart</code>文件的导入，后者是本地桥的客户端实现。</p><p id="7264" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">当应用程序启动时，初始化<strong class="ls iu"> BTController </strong>类，然后向它请求一个可用设备的列表，该列表又通过一个不可删除的对话框显示给用户。当选择一个设备时，控制器被指示连接到该设备，此时它将开始将从该设备读取的数据转发到传递到初始化方法中的处理程序。</p><p id="dd33" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">当<strong class="ls iu"> MainPage </strong>类从<strong class="ls iu"> BTController </strong>接收数据时，它将使用触发屏幕刷新的<strong class="ls iu"> setState() </strong>命令将数据存储在<em class="np"> sensorValue </em>中。当按下<strong class="ls iu">浮动动作按钮</strong>时，单个交替字符<em class="np">‘0’</em>或<em class="np">‘1’</em>被发送到<strong class="ls iu"> BTController </strong>以传输到模块。</p><p id="578d" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">接下来我们将看一下文件<strong class="ls iu"> lib/bt-controller.dart </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="b4e9" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated"><strong class="ls iu"> BTController </strong>类采用了<strong class="ls iu"> MethodChannel </strong>来实现Dart中的Flutter UX代码和底层蓝牙逻辑的原生Android代码之间的通信。<strong class="ls iu">init(</strong><em class="np">Function on data</em><strong class="ls iu">)</strong>方法初始化方法调用处理程序，并将对它的调用重定向到<em class="np"> onData </em>函数，以将消息向上游传回视图逻辑。为了方便和可读性，已经定义了方法来封装请求并将请求转发给平台本机代码。</p><p id="e268" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">我们不会详细讨论用于实现蓝牙逻辑本身的特定于平台的代码，因为这超出了本文的范围，因为这通常会通过使用预制的插件来处理，如<a class="ae ne" href="https://github.com/pauldemarco/flutter_blue" rel="noopener ugc nofollow" target="_blank"> flutter_blue </a>或<a class="ae ne" href="https://github.com/edufolly/flutter_bluetooth_serial" rel="noopener ugc nofollow" target="_blank"> flutter_bluetooth_serial </a>。如果你感兴趣并且想看看，MainActivity.java文件可以在<a class="ae ne" href="https://github.com/kenreilly/arduino-bluetooth-demo/blob/master/bt_demo/android/app/src/main/java/com/example/bt_demo/MainActivity.java" rel="noopener ugc nofollow" target="_blank">这里</a>找到，或者你可以选择从<a class="ae ne" href="https://github.com/kenreilly/arduino-bluetooth-demo" rel="noopener ugc nofollow" target="_blank">这里</a>复制整个项目，看看或者试验一下。这就结束了这个项目的逻辑部分，所以现在是时候看看它是如何工作的了。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h2 id="5122" class="ku kv it bd kw kx ky dn kz la lb dp lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">测试它</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/400beeacb2beeeab6a183187b8afeb4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rhMldYeIAVo8ekmQ9CG7yw.gif"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">已完成项目，BT模块已准备好配对</figcaption></figure><p id="7b21" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">开发板通电，程序加载到Arduino后，硬件就完成了。HC-06会闪烁，表示准备好配对。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/3f9f212538e4726b56b49312020a3335.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0MjLwqTQenC8CVejJxBNdA.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">Android演示应用的屏幕截图</figcaption></figure><p id="8b55" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">接下来，在手机上加载应用程序并启动它，它应该会显示可用蓝牙设备的列表。选择HC-06，在短暂的连接之后，一切都准备就绪。运行时，该应用程序将显示电容传感器的原始值，以及一个用于打开/关闭Arduino内置LED的按钮。该按钮完全不知道LED的实际状态。没有任何类型的反馈逻辑，就没有办法确保按钮“开”和LED“开”总是同步的。这是我们的简单演示的设计限制，可以通过将LED状态传回应用程序来解决。</p><p id="f90c" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">我希望你像我喜欢写这篇文章一样喜欢它。当今可用的开源嵌入式工具和设计为任何具有基本阅读和数学技能的人打开了电子原型和实验的世界，并提供了一种随着时间推移学习更高级技能和概念的不可思议的途径，这是一种有趣和令人兴奋的方式，由个人的好奇心驱动，不需要大学学位课程或在职培训的大量前期投资(尽管这两者对于考虑全职从事工程职业的人来说都是极好的选择)。</p><p id="e415" class="pw-post-body-paragraph lq lr it ls b lt mj ju lv lw mk jx ly ld ml ma mb lh mm md me ll mn mg mh mi im bi translated">感谢您的阅读，祝您的下一个电子项目好运！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><blockquote class="ny"><p id="7577" class="nz oa it bd ob oc od oe of og oh mi dk translated">肯尼斯·雷利(<a class="ae ne" href="https://twitter.com/8_bit_hacker" rel="noopener ugc nofollow" target="_blank"> 8_bit_hacker </a>)是<a class="ae ne" href="https://lvl-up.tech/" rel="noopener ugc nofollow" target="_blank"> LevelUP </a>的CTO</p></blockquote><figure class="oj ok ol om on kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/a7bb5ce5b2f751316c1f83ee4d078ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*durB32qrPeLQpsRqSVPhFw.jpeg"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">背景为HC-06的Arduino Nano细节图</figcaption></figure></div></div>    
</body>
</html>