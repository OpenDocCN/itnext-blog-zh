<html>
<head>
<title>Converged Platform for VM’s and Containers? Journey to KubeVirt!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">虚拟机和容器的融合平台？库伯维特之旅！</h1>
<blockquote>原文：<a href="https://itnext.io/converged-platform-for-vms-and-containers-journey-to-kubevirt-be33b95e4282?source=collection_archive---------5-----------------------#2020-07-17">https://itnext.io/converged-platform-for-vms-and-containers-journey-to-kubevirt-be33b95e4282?source=collection_archive---------5-----------------------#2020-07-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cd43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进入KubeVirt的细节之前，让我们了解一下对这类工具的需求。我想谈谈两个需要KubeVirt的场景。</p><p id="1b39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们来看一个案例，您将基于monolith架构的项目划分为多个微服务。在这种情况下，作为一种实践，我们不会一下子将monolith拆分成微服务！我们将通过在每次迭代中做一些服务来逐步实现。因此，您得到了需要两种不同平台的可部署映像的两种变体。即在某种虚拟化管理环境中运行现有的基于monolith的虚拟机。然后，您需要像Kubernetes这样的容器编排工具来部署您的微服务的提取服务。</p><p id="c97b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其次，让我们来看一个案例，在不久的将来，您的项目功能无法实现容器化，例如，一些虚拟网络功能(VNF ),如负载平衡器、网关，但我们计划构建一些容器来管理或协调我们需要的VNF。在这里，我们也需要两个平台来部署项目。</p><p id="5f0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这两个场景中，常见的问题都有成本和技能。您需要在两个不同的平台上花钱(如果您选择vSphere和Kubernetes的企业版)。那么您将需要这两个平台上的专业资源。在某些情况下，团队会发现很难采用两种不同的平台，并导致一些灵活性问题。如果我们可以在Kubernetes中部署和管理虚拟机，会怎么样？听起来很棒，对吧！这为专注于项目功能提供了宝贵的时间，而不是花时间去理解项目运行的平台。为了满足这些需求，KubeVirt以救助者的身份出现。</p><blockquote class="kl km kn"><p id="ae0c" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">KubeVirt是一个开源项目，它使得在Kubernetes托管的容器平台上运行虚拟机成为可能。<strong class="jp ir"> KubeVirt </strong>通过在Kubernetes容器中利用KVM(Linux内核管理程序)来提供容器原生虚拟化。”—来自RedHat。</p></blockquote><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/161022d118fb076fe6234e33b15fc49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsmjTZCfISvZxIlusBFPNQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">融合平台:容器+虚拟机</figcaption></figure><p id="7b75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看在Kubernetes平台中启动虚拟机的过程。<em class="ko">我假设您已经在您的环境中部署了Kubernetes</em>。要将虚拟机部署到Kubernetes中，您需要在Kubernetes平台上安装<em class="ko"> KubeVirt </em>特定的pod。比如，</p><ul class=""><li id="1b11" class="li lj iq jp b jq jr ju jv jy lk kc ll kg lm kk ln lo lp lq bi translated">KubeVirt操作员相关pod</li><li id="608f" class="li lj iq jp b jq lr ju ls jy lt kc lu kg lv kk ln lo lp lq bi translated">KubeVirt自定义资源(CRD)</li><li id="4fc0" class="li lj iq jp b jq lr ju ls jy lt kc lu kg lv kk ln lo lp lq bi translated">CDI操作员[这用于将虚拟机映像上传到您的Kubernetes持久卷中]</li><li id="4a2a" class="li lj iq jp b jq lr ju ls jy lt kc lu kg lv kk ln lo lp lq bi translated">CDI自定义资源(CRD的)[您可以使用‘virtctl’命令直接上传，而不是CDI]</li></ul><p id="8801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要安装这些pod，请遵循以下步骤:</p><pre class="kt ku kv kw gt lw lx ly lz aw ma bi"><span id="854e" class="mb mc iq lx b gy md me l mf mg">kubectl apply -f <a class="ae mh" href="https://github.com/kubevirt/kubevirt/releases/download/v0.26.0/kubevirt-operator.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubevirt/kubevirt/releases/download/v0.26.0/kubevirt-operator.yaml</a></span><span id="0e4b" class="mb mc iq lx b gy mi me l mf mg">kubectl apply -f <a class="ae mh" href="https://github.com/kubevirt/kubevirt/releases/download/v0.26.0/kubevirt-cr.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubevirt/kubevirt/releases/download/v0.26.0/kubevirt-cr.yaml</a></span><span id="4068" class="mb mc iq lx b gy mi me l mf mg">kubectl apply -f <a class="ae mh" href="https://github.com/kubevirt/containerized-data-importer/releases/download/v1.18.2/cdi-operator.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubevirt/containerized-data-importer/releases/download/v1.18.2/cdi-operator.yaml</a></span><span id="3aa9" class="mb mc iq lx b gy mi me l mf mg">kubectl apply -f <a class="ae mh" href="https://github.com/kubevirt/containerized-data-importer/releases/download/v1.18.2/cdi-cr.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubevirt/containerized-data-importer/releases/download/v1.18.2/cdi-cr.yaml</a></span></pre><p id="be49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行以下命令，验证所有pod是否正确安装，并应给出如图所示的输出。</p><pre class="kt ku kv kw gt lw lx ly lz aw ma bi"><span id="a721" class="mb mc iq lx b gy md me l mf mg">kubectl get pods -n kubevirt</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mj"><img src="../Images/1a7e7602cb2dd90f2c662aeeead59629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkpvIBaLMJJw4OJ3wUSI1A.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">“KubeVirt”命名空间中的kubevirt相关窗格</figcaption></figure><pre class="kt ku kv kw gt lw lx ly lz aw ma bi"><span id="eb90" class="mb mc iq lx b gy md me l mf mg">kubectl get pods -n cdi</span></pre><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mk"><img src="../Images/7dbcb5e4399eb5259caabbc2637e4729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61nyL9I2lTiJ6NAQtE8N-Q.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">“cdi”命名空间中与CDI相关的窗格</figcaption></figure><p id="fa6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，库伯维特起来了；将我们的虚拟机负载纳入Kubernetes平台。为此，我们需要Kubernetes端的更多配置。比如存储类、永久卷。我们知道虚拟机需要一个磁盘来启动。Kubernetes的持久卷将充当虚拟机的磁盘。要在本地设置这个存储配置，请在您的Kubernetes平台上运行下面的YAML文件。使用' kubectl create -f <file-name-of-below-contents/></p><p id="34ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要设置存储类:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/189c77efe2536552e8f5fae1f7bc105b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*Oi062jhUpIUHr2rJJFXBLw.png"/></div></figure><p id="9134" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行以下命令进行验证:“kubectl get sc”</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mm"><img src="../Images/7138d308234b1fabdcc9d9c606ad646b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZCj4UQ1QpadtrlRn-sdMxA.png"/></div></div></figure><p id="668a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要设置永久卷:</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/33a4210c0e90494a895033911337447a.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*V8IaE1DVOGDTUfzwZsmW_Q.png"/></div></figure><p id="dd29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过运行“kubectl get pv”进行验证</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mo"><img src="../Images/c408bd6fd15fb4a36f29d40d4d20b2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgAnw-T_WVcmsm6CJ-RMgA.png"/></div></div></figure><p id="eda6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要为将用作磁盘的虚拟机申请永久卷。要声明持久卷，运行以下命令，这将使用CDI将映像从文件主机导入到Kubernetes卷。源图像路径将在<strong class="jp ir">cdi.kubevirt.io/storage.import.endpoint</strong>字段中指定。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi mp"><img src="../Images/a8320751900697af2228b29bdda8cd1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHAdDTxJbmcHnzsw-0ztcA.png"/></div></div></figure><p id="3c16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦映像被导入，我们就需要部署我们的虚拟机，对吗？为此，KubeVirt公开了<strong class="jp ir">kind:virtualmachine instance</strong>。使用以下内容安装虚拟机。在我们的例子中，它将是ubuntu映像。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4113bd01a30fea760b72f7d8e23f3a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*2bFE39eceY7YfPXjha87Pg.png"/></div></figure><p id="11e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，您可以使用以下命令验证正在运行的虚拟机的状态:</p><pre class="kt ku kv kw gt lw lx ly lz aw ma bi"><span id="b23b" class="mb mc iq lx b gy md me l mf mg">kubectl get vmi</span></pre><p id="a6ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下命令连接到虚拟机控制台:</p><pre class="kt ku kv kw gt lw lx ly lz aw ma bi"><span id="8a62" class="mb mc iq lx b gy md me l mf mg">virtctl console ubuntu-vm</span></pre><blockquote class="kl km kn"><p id="4224" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">注意:要安装<strong class="jp ir"> virtctl </strong>，请从<a class="ae mh" href="https://github.com/kubevirt/kubevirt/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/kubevirt/kubevirt/releases</a>下载插件</p></blockquote><p id="f69b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们到了。我们已经设法在我们的Kubernetes平台上运行虚拟机，现在我们可以像往常一样在同一个平台上部署容器。希望这篇文章能为您的KubeVirt之旅提供一个更好的起点。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><p id="388e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢马努·马修斯给我们的所有动力！:)</p></div></div>    
</body>
</html>