<html>
<head>
<title>Testing components with Jest and React Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jest和React测试库测试组件</h1>
<blockquote>原文：<a href="https://itnext.io/testing-components-with-jest-and-react-testing-library-d36f5262cde2?source=collection_archive---------0-----------------------#2019-02-01">https://itnext.io/testing-components-with-jest-and-react-testing-library-d36f5262cde2?source=collection_archive---------0-----------------------#2019-02-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4593" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从不同的角度思考测试覆盖率</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c82cdf540b458df59412792afc5d600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*180CBi27vW8vOX7j"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">本杰明·沃罗斯在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="8bc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的前端团队最近在一个大规模SAAS产品中引入了React。到实现结束时，我们有大约15个活动组件，包括可重用的组件，如按钮和微调器，以及包含应用程序大部分逻辑的较大组件。</p><p id="8b66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了允许更快的开发，我们选择在没有任何单元或集成测试的情况下实现所有的组件。我们编写的所有组件都在替换现有的功能，这意味着它们都有端到端的UI测试覆盖。我们确信这些UI测试已经足够了，直到我们回去写更深入的报道。</p><h2 id="31b2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">决定开玩笑</h2><p id="3892" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">选择笑话很简单。我们对一些React测试技术进行了快速比较，发现Jest最能满足我们的需求。它得到了脸书团队的官方支持，一些关键功能，如模拟、并行测试运行和快照，似乎可以帮助我们解决过去遇到的问题。一旦我们开始实施，安装和配置就非常简单，文档也非常丰富。我们的团队讨论说，我们需要其他实用程序和库来帮助我们专门测试React组件。我们简单地看了一下酶的使用，但是因为React测试库的文档和原理看起来很有前途，所以我们没有进一步探索酶。</p><h2 id="be83" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">反应测试库</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="bf47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">React测试库(react-testing-library)可能是整个过程中最重要的发现。React Testing Library是一个与Jest配合得很好的库，它真正挑战了你，让你认真思考你到底在测试什么。过去，我们的团队努力寻找测试覆盖过多和不够之间的界限。React测试库背后的原理如下:</p><blockquote class="mv mw mx"><p id="8aec" class="kz la my lb b lc ld ju le lf lg jx lh mz lj lk ll na ln lo lp nb lr ls lt lu im bi translated"><a class="ae ky" href="https://twitter.com/kentcdodds/status/977018512689455106" rel="noopener ugc nofollow" target="_blank">你的测试越像你的软件被使用的方式，它们就越能给你信心。</a></p></blockquote><p id="e8e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能认为这是显而易见的，但是我们以前编写的许多Javascript测试测试的是函数的<em class="my">实现，而不是<em class="my">结果</em>(这在传统的HTML、CSS和Javascript文件分离的项目中可能不那么重要，但是在React项目中却至关重要)。React测试库也促使你编写更多的集成测试和更少的单元测试。这很重要，因为React应用程序可以由许多组件组成。测试单个组件很重要，但测试<em class="my">所有这些组件如何协同工作</em>可能更重要。你的用户不关心你的应用程序是如何构建的，也不关心你使用的是什么技术。他们关心的是他们能与你的应用程序交互，并且它能无缝地工作。</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/2eae3c814ded03542d7b92357d9ba659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*duElm9DDx5FgRusBz47btA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">传统测试金字塔</figcaption></figure><h2 id="ba04" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">快照测试</h2><p id="7ca5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">快照测试是Jest的一个有趣特性，它允许您测试Javascript对象。它与React组件配合得很好，因为当您呈现一个组件时，您可以查看DOM输出并在运行时创建一个“快照”。当我开始调查他们的时候，社区里有很多不同的意见。这些测试更有用的方面是，它们很好地防止了回归。不利的一面是，有时您无法判断正在测试什么，并且您可能会陷入盲目更新快照测试的坏习惯。我们有几个组件有快照测试，但一般来说，我不推荐它们超过特定的断言。如果您的组件不经常更新，不复杂，并且很容易看到您正在测试的内容，那么快照测试可能有效。</p><h2 id="c2f6" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">履行</h2><p id="1702" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">团队开始编写测试，并发现我们对应该测试什么进行了长时间的讨论。当我们不能就一个解决方案达成一致时，我们总是回来，<em class="my">“这有助于测试我们的用户如何使用这个应用吗？”。考虑到这一点，集成风格测试比单元风格测试更有价值(在大多数情况下)就变得更加清楚了。在整个过程中，我们能够为何时编写不同的测试定义一个更具体的答案。可重用的实用程序仍然有单元测试覆盖，但是存在于组件内部的实用程序将被集成测试覆盖。</em></p><p id="3d18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个组件测试的例子，它使用多个区域项来呈现一个区域。它从json文件中读取数据，遍历每个条目，然后将其呈现给DOM。有几个助手方法来构造href和过滤区域，但是我们只测试组件中呈现的内容。</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="298c" class="lv lw it ne b gy ni nj l nk nl">import React from 'react'<br/>import { render, fireEvent } from 'react-testing-library'<br/>import Component from './Container'</span><span id="87cc" class="lv lw it ne b gy nm nj l nk nl">describe('&lt;Component /&gt; spec', () =&gt; {</span><span id="f0d3" class="lv lw it ne b gy nm nj l nk nl">it('renders the component', () =&gt; {<br/>  const container = render(&lt;Component /&gt;)<br/>  expect(container.firstChild).toMatchSnapshot()<br/> })</span><span id="67ac" class="lv lw it ne b gy nm nj l nk nl">it('assert there are 6 regions', () =&gt; {<br/>  expect(document.querySelectorAll('.map-region').length).toBe(6)<br/> })</span><span id="d689" class="lv lw it ne b gy nm nj l nk nl">it('assert there are 12 region items', () =&gt; {<br/>  expect(document.querySelectorAll('.region-item').length).toBe(12)<br/> })</span><span id="6e9c" class="lv lw it ne b gy nm nj l nk nl">it('assert connect button renders the correct label', () =&gt; {<br/>  expect(document.querySelector('.connect-btn').innerHTML).toBe("Connect")<br/> })</span><span id="2dd8" class="lv lw it ne b gy nm nj l nk nl">it('assert the first item link to be /somelink', () =&gt; {<br/>  const allAgent = document.querySelector('.region-item:first-child a')<br/>  expect(allAgent.getAttribute('href')).toBe('/somelink?id=123&amp;name=link')<br/> })</span><span id="be05" class="lv lw it ne b gy nm nj l nk nl">});</span></pre><p id="3494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">总的来说，我真的很喜欢使用Jest和React测试库。起初它看起来像一个简单的库，但它非常有价值，因为它测试了与React组件的完全集成。</p><h2 id="e650" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">关键要点</h2><p id="2aa5" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">测试React组件时，请记住:</p><ul class=""><li id="a6ab" class="nn no it lb b lc ld lf lg li np lm nq lq nr lu ns nt nu nv bi translated">我提议编写的测试有助于防止回归吗？</li><li id="41cb" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">这些测试测试用户将如何与这个特性交互吗？</li><li id="f742" class="nn no it lb b lc nw lf nx li ny lm nz lq oa lu ns nt nu nv bi translated">如果你发现很难测试你的React组件，它们可能应该重写。</li></ul><p id="1a06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试驱动开发似乎一直是一个很好的实践，也许有了Jest和React测试库，这可能更容易实现。</p><div class="ob oc gp gr od oe"><a href="https://jestjs.io/" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">笑话🃏愉快的JavaScript测试</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">🃏令人愉快的JavaScript测试</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">🃏令人愉快的JavaScript测试jetjs . io</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a href="https://github.com/kentcdodds/react-testing-library" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">kentcdodds/react测试库</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">🐐简单完整的React DOM测试工具鼓励良好的测试实践。…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="ot l op oq or on os ks oe"/></div></div></a></div></div></div>    
</body>
</html>