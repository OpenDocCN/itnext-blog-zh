<html>
<head>
<title>Cloud to Cloud Authorization with AWS API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS API网关进行云到云授权</h1>
<blockquote>原文：<a href="https://itnext.io/cloud-to-cloud-authorization-with-aws-api-gateway-da461c768fe3?source=collection_archive---------3-----------------------#2022-09-25">https://itnext.io/cloud-to-cloud-authorization-with-aws-api-gateway-da461c768fe3?source=collection_archive---------3-----------------------#2022-09-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ce0e3d93024bc915dbf5a4c85cbcc3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAb4bikwPOZcjFPKs1OKWA.jpeg"/></div></div></figure><p id="cd33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有许多文章讨论了为AWS API Gateway设置授权者以保护端点。它们都是关于授权器实现的优秀文章，我不确定我能写出更好的关于授权器基础的文章，但我认为我能贡献的是一个更具架构性的观点，关于如何为云到云安全设置它们，以及我在实现中看到的一些设计决策。</p><h1 id="e161" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是正确的安全？</h1><p id="742e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">这应该是你在接触AWS控制台或开始编写代码之前问自己的第一个问题。对于云到云API，确实有两个流行的选项值得您关注和考虑。</p><p id="50ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> API键</strong></p><p id="deb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于大多数开发人员来说，这可能是最受欢迎的解决方案，它易于理解，也易于客户实现。这个解决方案创建一个共享密钥，通常是一个随机的字符串。您的合作伙伴在所有API请求的头、查询字符串或cookie中使用这个键，这样就完成了。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/358c19e897773408e8c821d1388e25cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*kB0gn7xmpDk61ypRmgVOrg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">作为查询字符串的API键</figcaption></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/e1f635985e36f466be7cc73171ea550d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*HVXEabvoFEwlPHd7EBlvCg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">作为Cookie的API密钥</figcaption></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/1cdf811fe05ebbac16c66de3bc30fa92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*uWCrx5lw_lGxQsJWtROyJw.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">API键作为标题</figcaption></figure><p id="e669" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">听起来简单而伟大，直到API密匙泄漏，现在密匙必须被改变，或者甚至好的安全过程定期滚动这个密匙可以使它有点痛苦。</p><p id="7e19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个非常简单的解决方案，但与另一个解决方案相比并不简单，它应该是您的默认选项，绝对不应该在面向消费者的应用程序中使用。</p><p id="64af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">客户端凭证OAuth2授予类型</strong></p><p id="5636" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从OAuth.net给出的定义开始</p><blockquote class="mj mk ml"><p id="cd50" class="jy jz mm ka b kb kc kd ke kf kg kh ki mn kk kl km mo ko kp kq mp ks kt ku kv ij bi translated">客户端使用客户端凭据授予类型来获取用户上下文之外的访问令牌。</p></blockquote><p id="eab1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我可以翻译一下，不要在面向消费者的应用程序中使用客户端凭证。云到云很好，因为您的合作伙伴需要确保他们的客户应用程序经过适当的身份验证，我们专注于授权对API的访问。</p><p id="892f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个解决方案是一个两步授权流程，客户端应用程序需要使用一个<em class="mm">客户端id </em>和<em class="mm">客户端秘密</em>进行身份验证，并取回一个正确形成的JWT令牌。除了安全性之外，我喜欢令牌的一点是，您可以在令牌中嵌入声明，这样您就可以获得更多关于合作伙伴访问安全且不可更改的API的详细信息。例如，这可以是关于谁是合作伙伴的细节。此外，您可以将<em class="mm">作用域</em>附加到调用中，以提供对服务的有限访问。如果您有一个分层的服务来限制授权级别的访问，这就更简单了。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/48f8121527f2762434bfff05e9adef3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*LqFDZqIxrYscicqJ7H-XVg.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk translated">客户端凭据授予类型</figcaption></figure><h1 id="8665" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">设置您的授权</h1><p id="9ea3" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">像软件中的大多数事情一样，做任何事情都有许多方法，所以我将提到几种方法和我的偏好。</p><p id="39a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">使用使用计划中内置的API网关API密钥</strong></p><p id="38fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">像大多数AWS服务一样，有一个非常简单的设置来完成设置。如果你感兴趣，我不会重复这篇关于设置的文章。</p><div class="mr ms gp gr mt mu"><a href="https://enlear.academy/amazon-api-gateway-securing-endpoints-using-api-keys-eec1c856b327" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">Amazon API网关:使用API密钥保护端点</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">亚马逊Api网关是一个托管服务。在本文中，我将展示如何使用api密钥保护端点。</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">enlear .学院</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jw mu"/></div></div></a></div><p id="2727" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我发现这种方法会导致锁定和灵活性的丧失。您只能将此方法与REST API (API网关V1)选项一起使用，因此如果您想将HTTP (API网关V2)作为一个选项，您就不走运了。</p><p id="3b3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您确实需要使用API密匙，我的建议是创建一个定制的请求授权器，并将API密匙存储在数据库中进行验证。这其中的一个问题是，它确实会导致更多的成本。AWS方法在执行任何Lambda之前完成，因为将验证放在授权器中确实需要运行Lambda。请确保您缓存了授权，它不会使这种影响。</p><p id="9efb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AWS也仅限于使用他们使用的标题，因此灵活性较低。我喜欢将API密钥作为基本类型放在Authorition头中(密钥作为用户名，密码为空)。当我在端点上进行多种类型的授权时，这让我实际上检测到它是一个API密钥授权。(我正在策划一篇这方面的文章)。</p><p id="2578" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我还发现，通常需要一个授权者来验证二手数据，所以要考虑它的价值。</p><p id="4bb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">使用AWS认知的客户端凭证</strong></p><p id="1f92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">遵循我的“不要重写”，这是一篇关于用AWS Cognito设置客户端凭证的非常好的文章。</p><div class="mr ms gp gr mt mu"><a href="https://awskarthik82.medium.com/part-1-securing-aws-api-gateway-using-aws-cognito-oauth2-scopes-410e7fb4a4c0" rel="noopener follow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">第1部分:使用AWS Cognito OAuth2范围保护AWS API网关</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">在前一篇博客中，我们看到了如何使用与OpenAM对话的自定义授权器来保护API网关。在这个博客中，我们…</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">awskarthik82.medium.com</p></div></div><div class="nd l"><div class="nj l nf ng nh nd ni jw mu"/></div></div></a></div><p id="497a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在Auth0或Okta等其他服务中设置这个，但如果你在AWS领域，这可能是你的最佳选择。你也可以建立自己的服务器，但如果你这样做，我可能会说你疯了。</p><p id="f4dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，AWS为您提供了一种简单的方法，使用上面文章中描述的专门的授权者类型进行授权，但是它将您直接与Cognito联系起来，并且没有为您提供验证请求中其他项目的选项。在请求授权器中，令牌验证并不复杂，它为您提供了使用任何服务的灵活性。</p><h1 id="7839" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">下一步是什么？</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/2c76c94ca5fd46c6e45feb9a61568297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*mHVLsQ-HOXd5oWNDXG17Cg.jpeg"/></div></figure><p id="4761" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这能让您对云到云自动化的两种主要方式有所了解。如果您现在正在使用API密匙，并且想要添加客户端凭证支持，那么您可能想要跟随我。我计划写一篇文章，展示如何一次完成多种类型的身份验证(包括直接从移动应用程序或web应用程序的用户级别)</p></div></div>    
</body>
</html>