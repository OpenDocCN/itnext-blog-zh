<html>
<head>
<title>Improving the security of Kubernetes clusters using Istio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Istio提高Kubernetes集群的安全性</h1>
<blockquote>原文：<a href="https://itnext.io/improving-the-security-of-kubernetes-clusters-using-istio-5f04c1dfdf55?source=collection_archive---------6-----------------------#2019-04-26">https://itnext.io/improving-the-security-of-kubernetes-clusters-using-istio-5f04c1dfdf55?source=collection_archive---------6-----------------------#2019-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a462" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.alcide.io/company/management/" rel="noopener ugc nofollow" target="_blank">由 </a><a class="ae kl" href="https://www.alcide.io/" rel="noopener ugc nofollow" target="_blank"> <em class="km">阿尔西德</em> </a> <em class="km">联合创始人CTO &amp;加迪·纳尔撰写。</em></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/2746c6e16652e61c37067582337fbea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8A93TTH5k8FAjn4z.jpg"/></div></div></figure><p id="bb74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<a class="ae kl" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>作为服务网格基础设施的目标和好处之一是提高它所嵌入的集群及其包含的服务的<a class="ae kl" href="https://www.alcide.io/service-mesh-security/" rel="noopener ugc nofollow" target="_blank">安全性。Istio的安全价值有以下几个方面:</a></p><ul class=""><li id="74ee" class="kz la iq jp b jq jr ju jv jy lb kc lc kg ld kk le lf lg lh bi translated">Istio验证工作负载的身份，并在创建网状连接时为其颁发和管理证书。</li><li id="34ab" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">服务网格流量可以使用mTLS通过相互端点认证自动加密。</li><li id="5a43" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">可配置的身份验证策略和安全的命名信息确保了传输层的流量授权。</li><li id="3457" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">应用层网络协议中基于角色的细粒度访问控制可用于微分段，进一步增强用户限制哪些服务交互以及交互方式的能力。</li><li id="08d9" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">Istio提供的流量可观察性与外部流量分析和分析工具相结合，支持安全相关的流量审计和监控，以检测和调查网络行为异常。</li></ul><h2 id="200d" class="ln lo iq bd lp lq lr dn ls lt lu dp lv jy lw lx ly kc lz ma mb kg mc md me mf bi translated"><a class="ae kl" href="https://get.alcide.io/hubfs/Webinar%20Recordings/GS%20%3C%3E%20Alcide%20Webinar.mp4" rel="noopener ugc nofollow" target="_blank">观看Alcide和Giant Swarm的点播网络研讨会</a>“使用Istio保护&amp;监控您的服务”。</h2><h1 id="8ce7" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">安全架构</h1><p id="ba64" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">Istio的安全特性涉及多个组件:</p><ul class=""><li id="4a5b" class="kz la iq jp b jq jr ju jv jy lb kc lc kg ld kk le lf lg lh bi translated"><strong class="jp ir"> Citadel </strong>用于密钥和证书管理。</li><li id="c4ff" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated"><strong class="jp ir"> Sidecar和外围代理</strong>实现客户端和服务器之间的安全通信并实施策略。</li><li id="e3c1" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated"><strong class="jp ir">试点</strong>向代理分发认证策略和安全命名信息。</li><li id="73ff" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated"><strong class="jp ir">混合器</strong>用于管理授权和审计。</li></ul><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nc"><img src="../Images/a2ba58bfbc2f150b9547897caa51b025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F5JR4NPTDKlDXxd0.png"/></div></div></figure><h1 id="4a26" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">身份、证书和认证</h1><p id="2ba9" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">Istio的sidecar代理使用SPIFFE IDs在工作负载之间建立mTLS连接。SPIFFE是一组开源标准，用于在动态和异构环境中安全地识别软件系统。它以特制的X.509证书的形式为现代生产环境中的每个工作负载提供安全的身份。SPIFFE消除了对应用级认证和复杂的网络级ACL配置的需求。SPIRE，即SPIFFE运行时环境，是一个可扩展的系统，它实现了SPIFFE标准中包含的原则。SPIRE管理平台，工作负载证明提供API来控制证明策略，并协调证书颁发和轮换。</p><p id="6548" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">网格中的服务通过Istio与集群管理系统的集成进行识别和认证。例如，使用Kubernetes，Citadel组件从apiserver了解所有工作负载，并自动为每个工作负载发布一个SPIFFE ID。它将为每个现有的和新的服务帐户创建的SPIFFE证书和密钥对存储为Kubernetes秘密。Kubernetes根据其服务帐户通过Kubernetes secret volume将证书和密钥对安装到pod。Citadel还监视每个证书的生命周期，并通过重写<a class="ae kl" href="https://blog.giantswarm.io/understanding-basic-kubernetes-concepts-iv-secrets-and-configmaps/" rel="noopener ugc nofollow" target="_blank"> Kubernetes secrets </a>来自动轮换证书。</p><h1 id="0bae" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">安全服务连接和身份验证策略</h1><p id="c8a0" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">Istio的安全命名信息定义了哪个或哪些服务帐户可以运行某项服务。这是从证书中编码的服务器标识到发现服务或DNS所引用的服务名称的映射。从身份A到服务名B的映射意味着“允许并授权A运行服务B”。</p><p id="b4f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户使用身份验证策略为接收请求的服务配置身份验证要求。Pilot监视Kubernetes apiserver，并通过将策略转换为sidecar代理的指令，为活动工作负载生成安全的命名信息。这些说明为每个服务指定了如何执行入站请求者所需的身份验证机制。Pilot将这些验证指令安全地分发给边车代理。</p><p id="ed20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">sidecar代理在代理的工作负载之间连接、验证和建立相互验证的TLS连接。客户端服务负责遵循必要的身份验证机制，例如通过获取适用的JWT凭据并将其附加到请求，或者通过客户端代理自动使用的TLS证书。</p><p id="2220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了身份验证机制本身，身份验证策略还包括其他设置，如:</p><ul class=""><li id="af81" class="kz la iq jp b jq jr ju jv jy lb kc lc kg ld kk le lf lg lh bi translated">目标选择:策略适用于哪个服务</li><li id="d803" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">范围:网状范围、命名空间范围或特定于服务的范围</li><li id="badd" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">传输身份验证:mTLS</li><li id="3e77" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">来源认证:对JWT使用的限制</li></ul><h1 id="72a2" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">基于角色的应用协议访问控制</h1><p id="45f9" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">微分段是一种安全技术，可在云部署中创建安全区域，并允许组织将工作负载相互隔离并单独保护它们。Istio的基于角色的访问控制(RBAC)通过命名空间级、服务级和方法级的访问控制为Istio网格中的服务提供微分段。这些控制有效地决定了“谁被允许在什么条件下做什么”。例如，用户可以设置一个策略，允许服务AccountAuditor向Payroll服务的路径“/accounts/*”发送HTTP Get请求(读取权限)，同时拒绝访问其他服务。RBAC配置与HTTP、HTTPS、HTTP2和普通TCP兼容。</p><p id="6fb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了实现这种分割，Istio的Pilot监视授权策略的变化，并将这些策略分发给与服务实例位于同一位置的sidecar代理。每个sidecar代理运行一个授权引擎，在运行时授权请求。当请求到达代理时，授权引擎根据当前授权策略评估请求上下文，并返回授权结果“允许”或“拒绝”。</p><h1 id="8d95" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">结论</h1><p id="1e15" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated">Istio的安全配置、自动化工具链和安全架构具有显著优势:</p><ul class=""><li id="26bb" class="kz la iq jp b jq jr ju jv jy lb kc lc kg ld kk le lf lg lh bi translated">服务网格中的流量在相互认证的端点之间加密，并且仅在根据用户配置允许通信的服务之间加密。这些属性可以防止多种类型的攻击，如冒充、窃听和中间人。</li><li id="ad65" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">根据最佳实践处理凭证的创建、分配和分发。凭据安全地存储在各自的工作负载旁边，因此不太可能被泄露。此外，凭据经常轮换，因此，即使在受到威胁的情况下，受威胁的凭据对攻击者的用途也非常有限。该设置由Istio自动完成，无需显式编码。</li><li id="656f" class="kz la iq jp b jq li ju lj jy lk kc ll kg lm kk le lf lg lh bi translated">身份验证策略和RBAC为用户提供了不同的选项，允许或阻止服务之间的连接，并根据安全敏感性和其他考虑因素对网格的各个部分进行分段。</li></ul><h2 id="68df" class="ln lo iq bd lp lq lr dn ls lt lu dp lv jy lw lx ly kc lz ma mb kg mc md me mf bi translated"><a class="ae kl" href="https://get.alcide.io/hubfs/Webinar%20Recordings/GS%20%3C%3E%20Alcide%20Webinar.mp4" rel="noopener ugc nofollow" target="_blank">观看Alcide和Giant Swarm举办的点播网络研讨会</a>“使用Istio保护&amp;监控您的服务”。</h2><h1 id="279c" class="mg lo iq bd lp mh mi mj ls mk ml mm lv mn mo mp ly mq mr ms mb mt mu mv me mw bi translated">关于作者:</h1><p id="89b7" class="pw-post-body-paragraph jn jo iq jp b jq mx js jt ju my jw jx jy mz ka kb kc na ke kf kg nb ki kj kk ij bi translated"><em class="km">帖子</em> <a class="ae kl" href="https://www.linkedin.com/in/gadinaor/" rel="noopener ugc nofollow" target="_blank"> <em class="km">作者:Gadi Naor </em> </a> <em class="km">，CTO&amp;</em><a class="ae kl" href="https://www.alcide.io/" rel="noopener ugc nofollow" target="_blank"><em class="km">al cide</em></a><em class="km">。</em></p><p id="12b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km"> Alcide通过强大的网络安全平台保护Kubernetes从代码到产品的部署。</em></p><div class="nd ne gp gr nf ng"><a href="https://www.linkedin.com/in/gadinaor/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">Gadi Naor -联合创始人&amp; CTO - Alcide.io | LinkedIn</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">联合创始人兼首席技术官Alcide.io特拉维夫Alcide是一家云原生安全领导者，其使命是增强开发运维服务和</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.linkedin.com</p></div></div></div></a></div></div></div>    
</body>
</html>