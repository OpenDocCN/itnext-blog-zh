<html>
<head>
<title>Using voice commands in an Android App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android应用程序中使用语音命令</h1>
<blockquote>原文：<a href="https://itnext.io/using-voice-commands-in-an-android-app-b0be26d50958?source=collection_archive---------0-----------------------#2017-08-01">https://itnext.io/using-voice-commands-in-an-android-app-b0be26d50958?source=collection_archive---------0-----------------------#2017-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3e75" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个声控乒乓球记分牌</h2></div><p id="dee6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个想法是建立一个Android应用程序，它只与口头交流而不触摸屏幕。我们先来看看:<a class="ae lb" href="https://www.google.com/search/about/" rel="noopener ugc nofollow" target="_blank">Google Now</a>&amp;<a class="ae lb" href="https://assistant.google.com/" rel="noopener ugc nofollow" target="_blank">Google Assistant</a><a class="ae lb" href="https://developers.google.com/voice-actions/" rel="noopener ugc nofollow" target="_blank">语音动作</a><a class="ae lb" href="https://developer.android.com/reference/android/speech/SpeechRecognizer.html" rel="noopener ugc nofollow" target="_blank">speech recognizer</a>和<a class="ae lb" href="https://developer.android.com/reference/android/speech/tts/TextToSpeech.html" rel="noopener ugc nofollow" target="_blank"> TextToSpeech </a>决定哪些适用于我们的app。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/a902ef29a18ea1a349759621bbfe4c3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKJ3teckvbjDZyjDPBjE4A.jpeg"/></div></div></figure><h2 id="7bae" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">用例App:乒乓球板</h2><p id="1512" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">这个想法的用例是创建一个乒乓球板应用程序。该应用程序有两个屏幕:第一个屏幕显示可用玩家及其分数的排行榜，第二个屏幕显示当时玩游戏的两名玩家及其游戏分数。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/6a67259c9ea7d472167e4afe501fa5b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*arcIzmQwZd1lMQZe6Unbag.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">排行榜</figcaption></figure><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/0f61746391ef0c5e159b696b87854a13.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*IFVgCJtBZr6tz8pzVvc5IQ.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">游戏屏幕</figcaption></figure><p id="bfd4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以在下面找到源代码:</p><div class="ms mt gp gr mu mv"><a href="https://github.com/LINKIT-Group/ping-pong" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">联络小组/乒乓球</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">乒乓球-一个带有语音识别的乒乓球记分牌应用程序</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.co</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj lm mv"/></div></div></a></div><h2 id="430b" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">Google Now vs Google Assistant:</h2><p id="38f2" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">Google Now是一个语音激活的个人助理，可以为你搜索网页并执行一些系统定义的任务。它类似于苹果的Siri，但是Google Now是平台无关的，也可以在iOS设备上运行。</p><p id="8226" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">谷歌助手就像是Google Now的升级版兄弟姐妹。它每天利用机器学习和人工智能来了解你，你可以和谷歌助手进行对话。如今，它正一天天地取代谷歌的位置。</p><p id="9a1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">激活谷歌助手有两种方式:长按home键或者说“OK，Google”。从Android 6.0棉花糖开始，系统可能会在我们的应用程序(称为“源应用程序”)顶部为助手打开一个叠加窗口。这让我们有可能从我们的应用程序中收集一些信息，并使用这些信息在我们的应用程序之外采取行动。然而，这并不能帮助我们实现我们想要的。我们想使用语音命令在我们的应用程序中执行动作。(例如<em class="nk">“OK，Google，点为Efe”</em>)。您可以在这里找到关于使用助手的更多信息<a class="ae lb" href="https://developer.android.com/training/articles/assistant.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="42ee" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">语音操作:</h2><p id="c8cd" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">谷歌定义了两种类型的语音动作。<a class="ae lb" href="https://developers.google.com/voice-actions/system/" rel="noopener ugc nofollow" target="_blank">系统语音动作</a>和<a class="ae lb" href="https://developers.google.com/voice-actions/custom-actions" rel="noopener ugc nofollow" target="_blank">自定义语音动作</a>。起初，听起来自定义语音操作可能会帮助我们，不幸的是，我们看到谷歌不再接受自定义语音操作的请求。另一方面，系统语音操作——如“搜索”、“设置闹钟”、“发起电话”、“拍照”、“打开网址”——对我们的用例应用程序来说不够有趣。</p><p id="0bf6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">语音动作在这里也分为<a class="ae lb" href="https://developer.android.com/training/wearables/apps/voice.html" rel="noopener ugc nofollow" target="_blank">系统提供的语音动作和App提供的语音动作。在您的清单文件中为您想要启动的活动定义了一个<strong class="kh ir">标签</strong>属性之后，您可以通过说<em class="nk">“OK Google，Start MyApp”</em>来启动您的应用程序。很高兴知道，但应用程序提供的语音操作不是我们所期待的。同一个</a><a class="ae lb" href="https://developer.android.com/training/wearables/apps/voice.html#FreeFormSpeech" rel="noopener ugc nofollow" target="_blank">文档页面</a>也提供了关于自由形式语音输入的信息，这看起来很有希望。</p><h2 id="19b5" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">自由形式的语音输入:</h2><p id="0249" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">从Google <a class="ae lb" href="https://developer.android.com/training/wearables/apps/voice.html#FreeFormSpeech" rel="noopener ugc nofollow" target="_blank">文档</a>中，我们看到从用户那里获得自由形式语音的一种常见方式是使用<code class="fe nl nm nn no b">ACTION_RECOGNIZE_SPEECH</code>动作调用<code class="fe nl nm nn no b">startActivityForResult</code>并在<code class="fe nl nm nn no b">onActivityResult</code>中接收结果。这种方法显示一个默认视图来获取用户语音输入。但是如果它不能理解用户所说的话，你必须再次触摸屏幕。这与我们只用语言交流的目标相冲突。因此我们决定通过使用<code class="fe nl nm nn no b">SpeechRecognizer</code>和<code class="fe nl nm nn no b">TextToSpeech</code>类来实现一个类似于Google Assistant的通信。</p><p id="8354" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是我们将要采取的步骤，以便通过获取用户语音输入来选择两个玩家。</p><p id="fa83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">1-问用户“谁是第一个玩家？”</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">文本到语音</figcaption></figure><p id="1778" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2-在问完我们的问题后，聆听用户输入，选择第一个玩家</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="acdd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3-问用户“谁是第二个玩家？”(与步骤1相同)</p><p id="27ac" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4-听取用户输入以选择第二个玩家(与步骤2相同)</p><h2 id="4628" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">最大的挑战:连续语音识别</h2><p id="6820" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">在选择两个玩家后，应用程序决定谁将开始游戏并说话(例如<em class="nk">“埃菲社将开始游戏”</em>)。挑战从这一点开始。我们需要不断地听，才能听到像<em class="nk">“埃菲社得分”这样的短语。</em>然而Google <a class="ae lb" href="https://developer.android.com/reference/android/speech/SpeechRecognizer.html" rel="noopener ugc nofollow" target="_blank">明确提到</a>这不是<code class="fe nl nm nn no b">SpeechRecognizer</code> api的本意。</p><blockquote class="nr ns nt"><p id="5597" class="kf kg nk kh b ki kj jr kk kl km ju kn nu kp kq kr nv kt ku kv nw kx ky kz la ij bi translated">这个API的实现可能会将音频流式传输到远程服务器来执行语音识别。因此，此API不打算用于连续识别，这将消耗大量的电池和带宽。</p></blockquote><p id="d0a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们使用的类似方法的实现过程中，已经报告了几个关于<code class="fe nl nm nn no b">SpeechRecognizer</code> api的错误。此外，重新启动语音识别周期之间的时间间隔阻碍了连续语音识别体验的流动。我们体验到与系统对抗无助于实现我们的目标，并停止了进一步的尝试。</p><p id="fa0d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了完成我们的应用程序，我们决定使用触摸手势(而不是语音识别)来开始游戏，并为玩家增加积分。然而，我们一直通过语音识别来选择玩家，以展示我们在本教程中使用的方法。</p><h2 id="ab1d" class="lo lp iq bd lq lr ls dn lt lu lv dp lw ko lx ly lz ks ma mb mc kw md me mf mg bi translated">结论</h2><p id="c251" class="pw-post-body-paragraph kf kg iq kh b ki mh jr kk kl mi ju kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">如果您想继续使用这种方法，请尝试通过直接从设备的麦克风捕获音频并将其传输到语音识别服务来构建自己的实现。也有一些图书馆看起来有希望实现我们想要的。</p><ul class=""><li id="e304" class="nx ny iq kh b ki kj kl km ko nz ks oa kw ob la oc od oe of bi translated"><a class="ae lb" href="https://docs.microsoft.com/en-us/azure/cognitive-services/speech/getstarted/getstartedjavaandroid" rel="noopener ugc nofollow" target="_blank">必应API </a></li><li id="9d75" class="nx ny iq kh b ki og kl oh ko oi ks oj kw ok la oc od oe of bi translated"><a class="ae lb" href="http://www.oracle.com/technetwork/java/jsapifaq-135248.html#what" rel="noopener ugc nofollow" target="_blank"> Java语音API </a></li><li id="7b98" class="nx ny iq kh b ki og kl oh ko oi ks oj kw ok la oc od oe of bi translated"><a class="ae lb" href="https://cmusphinx.github.io/wiki/tutorialandroid/" rel="noopener ugc nofollow" target="_blank"> CMUSphinx </a></li></ul></div></div>    
</body>
</html>