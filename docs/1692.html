<html>
<head>
<title>How to run CodeShip Parallel Test Pipelines efficiently — What is optimal CI parallelization?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何高效运行CodeShip并行测试管道——什么是最佳CI并行化？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-codeship-parallel-test-pipelines-efficiently-what-is-optimal-ci-parallelization-4afd36dece89?source=collection_archive---------4-----------------------#2019-01-02">https://itnext.io/how-to-run-codeship-parallel-test-pipelines-efficiently-what-is-optimal-ci-parallelization-4afd36dece89?source=collection_archive---------4-----------------------#2019-01-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0b0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您使用CodeShip作为CI服务器时，您可以通过并行测试管道显著提高CI构建的速度。管道允许您同时运行多个命令，例如，您可以将测试套件划分到几个管道中，从而更快地完成CI构建。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/73220e0d1261a40c91f3e2e71d605bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MMK-pMTZP0sRoXmI.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">代码船</figcaption></figure><h1 id="c81f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">1.如何在CodeShip上运行并行命令</h1><h2 id="6a02" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">通过CodeShip接口设置</h2><p id="301d" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">一种方法是通过<a class="ae mq" href="https://documentation.codeship.com/basic/builds-and-configuration/parallel-tests/#using-parallel-test-pipelines" rel="noopener ugc nofollow" target="_blank">代码接口</a>定义命令。一旦启用了并行测试管道，每个项目就可以拥有多个并行运行的测试管道。</p><p id="2e0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了尽可能快地运行CI构建，我们需要确保并行命令将以所有命令同时完成的方式运行测试套件的子集，以避免缓慢的管道瓶颈。为了分割测试套件，我们将使用带有队列模式的<a class="ae mq" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-codeship-parallel-test-pipelines-efficiently-optimal-ci-parallelization" rel="noopener ugc nofollow" target="_blank">backpack Pro，它为Ruby和JavaScript测试进行跨管道的动态测试套件分割</a>，以保持在并行管道(也称为CI节点)上以最佳方式运行我们的测试。</p><h2 id="c6c0" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">Ruby on Rails项目中的测试套件示例</h2><p id="b6fd" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">配置测试管道(使用1/2)</p><pre class="km kn ko kp gt mr ms mt mu aw mv bi"><span id="fc70" class="lz lc iq ms b gy mw mx l my mz"><em class="na"># first CI node running in parallel</em><br/><br/><em class="na"># RSpec tests in Knapsack Pro Queue Mode (dynamic test suite split)</em><br/>KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:queue:rspec</span></pre><p id="eb08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置测试管道(使用2/2)</p><pre class="km kn ko kp gt mr ms mt mu aw mv bi"><span id="73fd" class="lz lc iq ms b gy mw mx l my mz"><em class="na"># second CI node running in parallel</em><br/><br/><em class="na"># RSpec tests in Knapsack Pro Queue Mode (dynamic test suite split)</em><br/>KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:queue:rspec</span></pre><h2 id="fefd" class="lz lc iq bd ld ma mb dn lh mc md dp ll jy me mf lp kc mg mh lt kg mi mj lx mk bi translated">JavaScript中Cypress测试运行器的测试套件分割示例</h2><p id="f6c5" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">配置测试管道(使用1/2)</p><pre class="km kn ko kp gt mr ms mt mu aw mv bi"><span id="867b" class="lz lc iq ms b gy mw mx l my mz"><em class="na"># first CI node running in parallel</em><br/>KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 $(npm bin)/knapsack-pro-cypress</span></pre><p id="08dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置测试管道(使用2/2)</p><pre class="km kn ko kp gt mr ms mt mu aw mv bi"><span id="4b02" class="lz lc iq ms b gy mw mx l my mz"><em class="na"># second CI node running in parallel</em><br/>KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 $(npm bin)/knapsack-pro-cypress</span></pre><p id="3862" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，您可以了解更多关于JavaScript 中用于E2E测试的<a class="ae mq" href="https://docs.knapsackpro.com/2018/run-javascript-e2e-tests-faster-with-cypress-on-parallel-ci-nodes" rel="noopener ugc nofollow" target="_blank"> Cypress test runner。</a></p><h1 id="813b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">2.通过codeship-services.yml进行设置</h1><p id="412e" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">如果您使用CodeShip Pro，则通过使用<code class="fe nb nc nd ms b">type: parallel</code>头定义并行步骤组，然后嵌套您想要并行化的所有步骤，如下例所示:</p><pre class="km kn ko kp gt mr ms mt mu aw mv bi"><span id="d198" class="lz lc iq ms b gy mw mx l my mz">- type: parallel<br/>  steps:<br/>  - service: app<br/>    command: KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=0 bundle exec rake knapsack_pro:queue:rspec<br/>  - service: app<br/>    command: KNAPSACK_PRO_CI_NODE_TOTAL=2 KNAPSACK_PRO_CI_NODE_INDEX=1 bundle exec rake knapsack_pro:queue:rspec</span></pre><p id="0c91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何配置<a class="ae mq" href="https://documentation.codeship.com/pro/builds-and-configuration/steps/#parallelizing-steps-and-tests" rel="noopener ugc nofollow" target="_blank"> CodeShip Pro并行度</a>的更多示例</p><h1 id="eae6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">3.动态测试套件分割是如何工作的</h1><p id="a2b6" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">如果您想更好地了解动态测试套件拆分的工作原理以及它可以解决哪些问题，请查看视频:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="248b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="07fe" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">并行运行测试是缩短CI构建时间的快速方法。为了提高效率，我们可以使用<a class="ae mq" href="https://knapsackpro.com/?utm_source=medium&amp;utm_medium=blog_post&amp;utm_campaign=how-to-run-codeship-parallel-test-pipelines-efficiently-optimal-ci-parallelization" rel="noopener ugc nofollow" target="_blank">backpackage Pro</a>在CI节点之间以最佳方式分割测试套件，以保持CI节点自动平衡，并尽可能快地运行CI构建。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="f146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="na">最初发表于</em><a class="ae mq" href="https://docs.knapsackpro.com/2018/how-to-run-codeship-parallel-test-pipelines-efficiently-optimal-ci-parallelization" rel="noopener ugc nofollow" target="_blank">T5【docs.knapsackpro.com】</a><em class="na">。</em></p></div></div>    
</body>
</html>