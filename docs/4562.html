<html>
<head>
<title>OKD 4.5 Single Node Cluster on Windows 10 using Hyper-V</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hyper-V的Windows 10上的OKD 4.5单节点集群</h1>
<blockquote>原文：<a href="https://itnext.io/okd-4-5-single-node-cluster-on-windows-10-using-hyper-v-3ffb7b369245?source=collection_archive---------0-----------------------#2020-07-27">https://itnext.io/okd-4-5-single-node-cluster-on-windows-10-using-hyper-v-3ffb7b369245?source=collection_archive---------0-----------------------#2020-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f3a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="ko">更新时间:2020年7月29日</em> </strong></p><p id="2bf5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">谁想在他们的Windows 10工作站上运行OKD 4 SNC？我就是其中之一。</p><p id="759a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本指南面向那些希望在现有工作站(最低24GB内存)上试用ODK 4，而不购买额外硬件(如NUC或家庭实验室服务器)的人。</p><p id="5f5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">OpenShift (OCP)有<a class="ae kp" href="https://developers.redhat.com/products/codeready-containers/overview" rel="noopener ugc nofollow" target="_blank"> CodeReady Containers </a>，你可以在本地机器上建立一个OpenShift集群用于开发和测试。目前，CodeReady容器的OKD版本仍在开发中。本指南将指导您使用Hyper-V在Windows 10(专业版、企业版或教育版)工作站上安装OKD 4.5单节点集群</p><h1 id="efb7" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">虚拟机概述:</h1><p id="c50f" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">对于这次安装，我使用了32GB内存的Windows 10 Pro笔记本电脑。以下是虚拟机和网络布局的细分:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/0b261ba5719ac5f852310fb237c72824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPtyMlff8Ril8_yi7McgdA.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/cef679d4f4093901b11bd12a34b760f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*R7_Cl35uqJFvFGWqBvRHsQ.png"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="af3f" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">使用PowerShell启用Hyper-V</h1><p id="64c5" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">以管理员身份打开PowerShell控制台，并运行以下命令:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="f977" class="mx kr it mt b gy my mz l na nb">Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nc"><img src="../Images/7f40038370ebe38cdfd09b61ba51aac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6jjl3IALv56xOoy1Iagfg.png"/></div></div></figure><p id="4b99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果找不到该命令，请确定您正在以管理员身份运行PowerShell。</p><p id="3c7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，重新启动。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="10d6" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">使用Powershell在Hyper-V中创建NAT交换机</h1><p id="6b16" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">以管理员身份打开PowerShell控制台，运行以下命令创建虚拟交换机:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="c2e6" class="mx kr it mt b gy my mz l na nb">$Natswitchname = “OKD4-NATSwitch”<br/>$NATNetwork = “192.168.200.0”<br/>$NATrouteraddress = “192.168.200.1”<br/>$NATPrefixLength = “24”</span><span id="0f97" class="mx kr it mt b gy nd mz l na nb">New-VMSwitch –SwitchName $Natswitchname –SwitchType Internal –Verbose<br/>$natswitch = Get-NetAdapter | where {(($_.name -like (“vEthernet ($Natswitchname)”)))}<br/>New-NetIPAddress $NATrouteraddress -PrefixLength $NATPrefixLength -InterfaceIndex $natswitch.interfaceindex -Verbose<br/>$NATNetworkFull = $NATNetwork + “/” + $NATPrefixLength<br/>New-NetNat -Name HyperV-NatNetwork -InternalIPInterfaceAddressPrefix $NATNetworkFull -Verbose</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ne"><img src="../Images/fa5ffd2d3ad65ca38c88a54e9dc18a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAKuwpYm3b29Xm_UMvDXnA.png"/></div></div></figure><p id="7afd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开Hyper-V管理器，然后打开虚拟交换机管理器，并验证OKD4-NATSwitch是否已创建。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nf"><img src="../Images/64f6efa13d1299a1ea8045b6e117383d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHxECmQLhy8kpXGMjN3Y0w.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="6c1f" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">创建ok D4-服务虚拟机:</h1><p id="60e1" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">okd-4服务虚拟机用于托管DNS、haproxy、DHCP和web服务。</p><p id="6de4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kp" href="https://getfedora.org/en/server/download/" rel="noopener ugc nofollow" target="_blank">下载</a>Fedora服务器标准ISO。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi gj"><img src="../Images/bacc3492247f9222285378803c94c196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GHMR8wEBdnV04MW4.png"/></div></div></figure><p id="eaf1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开Hyper-V管理器并创建一个新的虚拟机。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/200ab6203a25e9eeeb5e75b15d402630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*EBn0bL4bJC4bjCyCWuEmOg.png"/></div></figure><p id="42c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择虚拟机的名称并选择位置。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nh"><img src="../Images/5144fce5296c48d3a3f0d08610ca068a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7S2BvYiCIhX7001o0FQBsw.png"/></div></div></figure><p id="f212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择第二代。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/beff287a4c586a664f11adb70f05db78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*cgp-XaifDmIHL0MW_dJzwA.png"/></div></figure><p id="82e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将启动内存设置为1024 MB。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a0b3e77064f1350e15c7f4ab4c113ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*mOy1dnXA4jTQemvi1ro-Yw.png"/></div></figure><p id="2e43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择OKD4-NATSwitch连接。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/036825b01a39aeca254f83dd19264565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*9bY5k4NzLot8dgRc_gAILw.png"/></div></figure><p id="6877" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建虚拟硬盘。我使用了默认值。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nh"><img src="../Images/6cf5a7e6ad6fde8ab31bf6aef165d1cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnff_MQF2kvoBfkYok8AHw.png"/></div></div></figure><p id="37aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择“从可引导镜像文件安装…”并浏览到您的Fedora服务器ISO。然后单击完成。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/10166b65bb266c0c140455d312a1edc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*YvoumvrNHaXaPWCZrlX9Ew.png"/></div></figure><p id="9582" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑虚拟机设置，并将引导顺序更改为HD、DVD、网络。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nm"><img src="../Images/e8d5b674eae1e6d7fbe6266d42e95439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rFvnQ5Ii4kSlk2KbLQWtXQ.png"/></div></div></figure><p id="4e85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">禁用安全启动。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nn"><img src="../Images/881cbadbb2ddb57c3d08808e16dff796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2af4geAIRG9k8WBuSTUCIg.png"/></div></div></figure><p id="690f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将您的虚拟处理器更改为“2”。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4783b2aee4e324403a1f92b683701b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*H1K8EdByOzjU3M5L0np-EQ.png"/></div></figure><p id="9322" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将动态内存改为最小512MB，最大1024MB。然后启动虚拟机。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi np"><img src="../Images/967c6a0a8b921b244ecd684f903c1072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*4p2ocaDlQKwY7MpuknqWaA.png"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="6170" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">在okd4-services虚拟机上安装Fedora Server 32:</h1><p id="0061" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">运行安装程序并选择您的安装目的地。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nq"><img src="../Images/99cc73c1d643e0ca1cd2764eee3edbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oy9KjuQllPMRk2QJzJ2YqA.png"/></div></div></figure><p id="1e92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于软件选择，选择“Fedora定制操作系统”并包括“客户代理”附加组件。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nr"><img src="../Images/0d132d1fe1d82bb8379c59311149b70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Cnsb_C1YaF145m-O.png"/></div></div></figure><p id="66f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启用连接到虚拟机网络的NIC，并将主机名设置为okd4-services，然后单击Apply。单击“配置”、“IPv4设置”,将方法更改为“手动”,并设置所示的IP设置，然后单击“保存”。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ns"><img src="../Images/d3ac11925e702691182ebb2080f6d728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VciUMFw-8NAGaTYwhg1M4w.png"/></div></div></figure><p id="b8fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设置Root密码，创建一个管理员用户并设置密码。单击“开始安装”开始安装。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nt"><img src="../Images/dc0bf1f1eb8ccc7cfdc30e0ada0de0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TXv1Rm_zwOsqXaZMK7m-Qw.png"/></div></div></figure><p id="3422" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，打开命令提示符并通过SSH连接到okd4-services虚拟机。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="f856" class="mx kr it mt b gy my mz l na nb">ssh 192.168.200.10</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nu"><img src="../Images/dbb479756e8e794dbe7eb9c5a2eaa3d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fGKUYxhA2WmhH3aRwxK4rQ.png"/></div></div></figure><p id="ec23" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装附加软件包，更新操作系统，然后重新启动。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="dd0d" class="mx kr it mt b gy my mz l na nb">sudo dnf install -y git wget vim<br/>sudo dnf update -y  &amp;&amp; sudo systemctl reboot</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="6dd1" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">配置ok D4-服务虚拟机以托管各种服务:</h1><p id="aad2" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">okd 4-服务虚拟机用于提供DHCP、DNS、NFS导出、web服务器和负载平衡。</p><p id="20cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上打开一个终端，克隆包含DHCP、DNS、HAProxy和install-conf.yaml示例文件的okd4-snc-hyperv repo:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="4b0b" class="mx kr it mt b gy my mz l na nb">cd<br/>git clone <a class="ae kp" href="https://github.com/CountPickering/okd4_files.git" rel="noopener ugc nofollow" target="_blank">https://github.com/cragr/okd4-snc-hyperv.git</a><br/>cd okd4-snc-hyperv</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="99ca" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">安装DHCP(DHCP)</h1><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="044a" class="mx kr it mt b gy my mz l na nb">sudo dnf -y install dhcp-server<br/>sudo cp dhcpd.conf /etc/dhcp/<br/>sudo systemctl enable --now dhcpd<br/>sudo firewall-cmd --add-service=dhcp --permanent<br/>sudo firewall-cmd --reload</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="635c" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">安装绑定(DNS)</h1><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="1462" class="mx kr it mt b gy my mz l na nb">sudo dnf -y install bind bind-utils</span></pre><p id="247a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">复制命名的配置文件和区域:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="6be2" class="mx kr it mt b gy my mz l na nb">sudo cp named.conf /etc/named.conf<br/>sudo cp named.conf.local /etc/named/<br/>sudo mkdir /etc/named/zones<br/>sudo cp db* /etc/named/zones</span></pre><p id="dad8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启用并启动命名:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ca11" class="mx kr it mt b gy my mz l na nb">sudo systemctl enable named<br/>sudo systemctl start named<br/>sudo systemctl status named</span></pre><p id="f87d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建防火墙规则:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="a406" class="mx kr it mt b gy my mz l na nb">sudo firewall-cmd --permanent --add-port=53/udp<br/>sudo firewall-cmd --reload</span></pre><p id="ae7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将okd4-services虚拟机上的DNS更改为127.0.0.1:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="3fad" class="mx kr it mt b gy my mz l na nb">sudo nmcli connection modify eth0 ipv4.dns "127.0.0.1"</span></pre><p id="c102" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上重新启动网络服务:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="5619" class="mx kr it mt b gy my mz l na nb">sudo systemctl restart NetworkManager</span></pre><p id="c84f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services上测试DNS。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="9de6" class="mx kr it mt b gy my mz l na nb">dig okd.local<br/>dig –x 192.168.200.10</span></pre><p id="2a3a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">DNS正常工作时，您应该会看到以下结果:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nv"><img src="../Images/e3d295eef0c0ede6b9bed75947ed33ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qi3K38-qEy_yXzIh.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/b662575b4862a8ecbfc2f6a663c903c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/0*Wz2_stY9aT17Z9lN.png"/></div></figure><p id="e1eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在提升的Powershell窗口中，在HyperV-NATSwitch上设置DNS以匹配okd 4-services IP 192 . 168 . 200 . 10，以便您可以解析DNS条目。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ab5c" class="mx kr it mt b gy my mz l na nb">Get-NetIpInterface ‘*(OKD4-NATSwitch)’ | Set-DnsClientServerAddress -ServerAddress ‘192.168.200.10’</span></pre><p id="97b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">确保您能够nslookup test . apps . lab . okd . local</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/4ae395b1764a1a63a64244351eb7f8f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*vRwQs7yOVC2TpXJat9OHwA.png"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="6873" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">安装HAProxy:</h1><p id="320d" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在okd4-services终端运行:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="becb" class="mx kr it mt b gy my mz l na nb">sudo dnf install haproxy -y</span></pre><p id="9fd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从git okd4_files目录中复制haproxy配置:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="cf51" class="mx kr it mt b gy my mz l na nb">sudo cp haproxy.cfg /etc/haproxy/haproxy.cfg</span></pre><p id="5d07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动、启用和验证HA代理服务:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="8bc5" class="mx kr it mt b gy my mz l na nb">sudo setsebool -P haproxy_connect_any 1<br/>sudo systemctl enable haproxy<br/>sudo systemctl start haproxy<br/>sudo systemctl status haproxy</span></pre><p id="79d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加OKD防火墙端口:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="9350" class="mx kr it mt b gy my mz l na nb">sudo firewall-cmd --permanent --add-port=6443/tcp<br/>sudo firewall-cmd --permanent --add-port=22623/tcp<br/>sudo firewall-cmd --permanent --add-service=http<br/>sudo firewall-cmd --permanent --add-service=https<br/>sudo firewall-cmd --reload</span></pre><h1 id="c09c" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装阿帕奇/HTTPD</h1><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ada4" class="mx kr it mt b gy my mz l na nb">sudo dnf install -y httpd</span></pre><p id="e873" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将httpd监听端口更改为8080:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ada7" class="mx kr it mt b gy my mz l na nb">sudo sed -i 's/Listen 80/Listen 8080/' /etc/httpd/conf/httpd.conf</span></pre><p id="b21e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在防火墙上启用并启动httpd服务/允许端口8080:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="8298" class="mx kr it mt b gy my mz l na nb">sudo setsebool -P httpd_read_user_content 1<br/>sudo systemctl enable httpd<br/>sudo systemctl start httpd<br/>sudo firewall-cmd --permanent --add-port=8080/tcp<br/>sudo firewall-cmd --reload</span></pre><p id="918c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试web服务器:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="93bd" class="mx kr it mt b gy my mz l na nb">curl localhost:8080</span></pre><p id="09d4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">成功的卷发应该是这样的:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ny"><img src="../Images/8e05b3cd06b292a5eaf589c6e4289a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WtDVMy09wRqvoJ93.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="e675" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">下载openshift-installer和oc客户端:</h1><p id="7c6e" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">到okd 4-服务虚拟机的SSH</p><p id="76c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要下载最新的oc客户端和openshift-install二进制文件，您需要使用oc客户端的现有版本。</p><p id="d7f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<a class="ae kp" href="https://github.com/openshift/okd/releases" rel="noopener ugc nofollow" target="_blank"> OKD发布页面</a>下载4.5版本的oc客户端并打开shift-install。示例:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="349e" class="mx kr it mt b gy my mz l na nb">cd<br/>wget https://github.com/openshift/okd/releases/download/4.5.0-0.okd-2020-07-29-070316/openshift-client-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz<br/>wget https://github.com/openshift/okd/releases/download/4.5.0-0.okd-2020-07-29-070316/openshift-install-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz</span></pre><p id="4ac5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">解压oc客户端的okd版本，打开shift-install:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="4840" class="mx kr it mt b gy my mz l na nb">tar -zxvf openshift-client-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz<br/>tar -zxvf openshift-install-linux-4.5.0-0.okd-2020-07-29-070316.tar.gz</span></pre><p id="2ea3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将kubectl、oc和openshift-install移动到/usr/local/bin并显示版本:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="c3a9" class="mx kr it mt b gy my mz l na nb">sudo mv kubectl oc openshift-install /usr/local/bin/<br/>oc version<br/>openshift-install version</span></pre><p id="c084" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最新版本可在https://origin-release.svc.ci.openshift.org<a class="ae kp" href="https://origin-release.svc.ci.openshift.org/" rel="noopener ugc nofollow" target="_blank">获得</a></p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="2b6f" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">设置openshift-installer:</h1><p id="6163" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在install-config.yaml中，您可以使用来自RedHat的pull-secret或默认的" { " auths ":{ " fake ":{ " auth ":" bar " } } "作为pull-secret。</p><p id="cc65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您还没有SSH密钥，请生成一个。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="c1b9" class="mx kr it mt b gy my mz l na nb">ssh-keygen</span></pre><p id="9c34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建安装目录并复制install-config.yaml文件:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="fcb3" class="mx kr it mt b gy my mz l na nb">cd<br/>mkdir install_dir<br/>cp okd4-snc-hyperv/install-config.yaml ./install_dir</span></pre><p id="cf30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑install_dir中的install-config.yaml并添加您的ssh密钥。备份install-config.yaml，因为它将在生成清单时被删除:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nz"><img src="../Images/74ea4e6ca2f30fff437a69f679cf5aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rEc2ZGVWKdsTGEDb.png"/></div></div></figure><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="0a1d" class="mx kr it mt b gy my mz l na nb">vim ./install_dir/install-config.yaml<br/>cp ./install_dir/install-config.yaml ./install_dir/install-config.yaml.bak</span></pre><p id="d4ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为集群生成Kubernetes清单，忽略警告:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="26d5" class="mx kr it mt b gy my mz l na nb">openshift-install create manifests --dir=install_dir/</span></pre><p id="fd68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以创建点火配置:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="f8f6" class="mx kr it mt b gy my mz l na nb">openshift-install create ignition-configs --dir=install_dir/</span></pre><p id="45ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注意:</strong>如果你重用install_dir，确保它是空的。隐藏文件是在生成配置后创建的，在第二次尝试使用同一文件夹之前，应该删除这些文件。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="9ca6" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">在web服务器上托管点火和Fedora CoreOS文件:</h1><p id="69ac" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在/var/www/html中创建okd4目录:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ff71" class="mx kr it mt b gy my mz l na nb">sudo mkdir /var/www/html/okd4</span></pre><p id="aa5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将install_dir内容复制到/var/www/html/okd4并设置权限:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="11bc" class="mx kr it mt b gy my mz l na nb">sudo cp -R install_dir/* /var/www/html/okd4/<br/>sudo chown -R apache: /var/www/html/<br/>sudo chmod -R 755 /var/www/html/</span></pre><p id="1c97" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试web服务器:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="4cdf" class="mx kr it mt b gy my mz l na nb">curl localhost:8080/okd4/metadata.json</span></pre><p id="047a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下载<a class="ae kp" href="https://getfedora.org/coreos/download/" rel="noopener ugc nofollow" target="_blank"> Fedora CoreOS </a>裸机bios镜像和sig文件，并缩短文件名:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="f5d7" class="mx kr it mt b gy my mz l na nb">cd /var/www/html/okd4/<br/>sudo wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/32.20200715.3.0/x86_64/fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz<br/>sudo wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/32.20200715.3.0/x86_64/fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz.sig<br/>sudo mv fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz fcos.raw.xz<br/>sudo mv fedora-coreos-32.20200715.3.0-metal.x86_64.raw.xz.sig fcos.raw.xz.sig<br/>sudo chown -R apache: /var/www/html/<br/>sudo chmod -R 755 /var/www/html/</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="724b" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">创建引导和主节点:</h1><p id="d2f0" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">下载<a class="ae kp" href="https://getfedora.org/coreos/download/" rel="noopener ugc nofollow" target="_blank"> Fedora CoreOS裸机ISO </a>并保存到你的下载文件夹。</p><p id="86aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">撰写本文时最新的稳定版本是32.20200715.3.0</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/df006a1c1eb60fc8d2cbdc8d71101fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*BPQcc9hi9raT1bKxYR14og.png"/></div></figure><p id="2ea6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用本文开头的电子表格中的CPU和RAM值，在Hyper-V管理器中创建两个ODK节点(okd 4-引导和okd 4-控制平面-1 ):</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="63db" class="mx kr it bd ks ob oc dn kw od oe dp la kb of og le kf oh oi li kj oj ok lm ol bi translated"><strong class="ak">ok D4-自举:</strong></h2><p id="4691" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">打开Hyper-V管理器并创建一个新的虚拟机。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/200ab6203a25e9eeeb5e75b15d402630.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*EBn0bL4bJC4bjCyCWuEmOg.png"/></div></figure><p id="b98e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择虚拟机的名称并选择位置。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi om"><img src="../Images/39c23dec5d2131f3e44125a8823d40b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWOPvTwLpcaM1B5Nd0LI-A.png"/></div></div></figure><p id="c81f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择第二代。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi nu"><img src="../Images/a5e39fc329adef98d5501976367f6d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmLXPU6MYyivrI7_SErkQw.png"/></div></div></figure><p id="018b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用“分配内存”的默认设置，我们稍后会对此进行编辑。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/a0b3e77064f1350e15c7f4ab4c113ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*mOy1dnXA4jTQemvi1ro-Yw.png"/></div></figure><p id="0645" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择OKD4-NATSwitch连接。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi on"><img src="../Images/dfc48fc9e43c6419429000350b416594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*ZIA0Ql4pI8uJIs50hXWB6g.png"/></div></figure><p id="d08b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建虚拟硬盘。我使用了默认值。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/cbefeaeb14b9dcaaa7828db22f912b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*ZeAXYC2cvpCMxCXL64edYA.png"/></div></figure><p id="2515" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">选择“从可引导镜像文件安装…”并浏览到您的Fedora CoreOS ISO。然后单击完成。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi op"><img src="../Images/14f5ca36657613d11e0367efb31024fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GjRoaRhZZHt8GKE3YBix2Q.png"/></div></div></figure><p id="a23e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过选择虚拟机并单击设置来编辑虚拟机…</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi oq"><img src="../Images/c30bac35cd6573710a4030c96282850f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ddV0XUcZPm_fsBP-EmJUiQ.png"/></div></div></figure><p id="20bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将引导顺序编辑为HD、DVD、网络。禁用安全启动。将虚拟处理器增加到4个。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi or"><img src="../Images/c40d6e2bedd06441e64bcaf7480c3f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QvBcnSHqrJWvT_TJfIzLgg.png"/></div></div></figure><p id="ec24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑内存，最小512MB，最大4096 MB</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi os"><img src="../Images/b72f9bbf80469f753838809686d5d758.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*gtu6vqF7d1iR_X86c5hlGA.png"/></div></div></figure><p id="33bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来创建ok D4-控制平面-1虚拟机。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="2c88" class="mx kr it bd ks ob oc dn kw od oe dp la kb of og le kf oh oi li kj oj ok lm ol bi translated"><strong class="ak">ok D4-控制平面-1 </strong></h2><p id="f236" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">使用与okd4-bootstrap虚拟机相同的步骤创建okd4-control-plane-1虚拟机，不同之处在于将CPU增加到4个或更多，并将内存增加到16384 MB。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ot"><img src="../Images/129b9ef0d416f10ebc71c8f144571289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1M7T3InTBI-xJtdt4h9ZoQ.png"/></div></div></figure><p id="f6c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该最终拥有以下虚拟机:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/a8e3323796633d45038462cf2edbbbb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*B1pfC-1yMm3-O5ScdAYBRA.png"/></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="650a" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">设置静态DHCP租约:</h1><p id="7b8b" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">打开odk4-bootstrap虚拟机和okd4-control-plane-1节点的电源，转到虚拟机设置、网络适配器、高级功能，并记下Mac地址。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/652d35955d79e339890596aa61abd828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*ocOGYH8EAiz6Ldhl_b_IVA.png"/></div></figure><p id="d6f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新两个节点的硬件以太网地址。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/981428c84baebffb6e2aa10ac6554807.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*g2krN8qJXVi9Pl-jBrFDsw.png"/></div></figure><p id="b2a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services节点上重新启动dhcpd服务。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="0299" class="mx kr it mt b gy my mz l na nb">sudo systemctl restart dhcpd</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="2500" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">启动引导过程:</h1><p id="5e54" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">重置虚拟机并允许其启动。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/c82c58aa671a849f4f01823fc3b9aa08.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*1rOgvS8AlAInRv4oDDYTsQ.png"/></div></figure><p id="0a13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">验证它使用正确的IP地址启动:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/c4d17adbaefc129866af12e48564f676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*izaTmm6NEZPSk4x5Tcx76w.png"/></div></figure><p id="5d11" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下载点火文件并使用bootstrap.ign启动安装程序</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="4348" class="mx kr it mt b gy my mz l na nb">curl -O <a class="ae kp" href="http://192.168.200.10:8080/okd4/bootstrap.ign" rel="noopener ugc nofollow" target="_blank">http://192.168.200.10:8080/okd4/bootstrap.ign</a><br/>sudo coreos-installer install /dev/sda --ignition-file <strong class="mt iu">./bootstrap.ign</strong></span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi oz"><img src="../Images/817f04894632923f44c6c75da99d4ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xTKWZOdQk_MkMPyscJMcA.png"/></div></div></figure><p id="e76d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，关闭虚拟机并弹出iso。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/6bb459ad249497fe34a1bb56d68f4205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*FpgbLncKOxBfEdNZGt1EAg.png"/></div></figure><p id="c9cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动虚拟机。如果成功，引导过程就开始了。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pb"><img src="../Images/0943c85114a6b8d413ce2baafef5adac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V8v_K4Y0CKHTOuy1mNYcsQ.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="56c7" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">启动控制平面1节点:</h1><p id="5206" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">除了使用master.ign之外，从引导节点重复相同的步骤</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="a1c7" class="mx kr it mt b gy my mz l na nb">curl -O <a class="ae kp" href="http://192.168.200.10:8080/okd4/bootstrap.ign" rel="noopener ugc nofollow" target="_blank">http://192.168.200.10:8080/okd4/bootstrap.ign</a><br/>sudo coreos-installer install /dev/sda --ignition-file <strong class="mt iu">./master.ign</strong></span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pc"><img src="../Images/d538afd89bcc5ad590e3c4d66467a722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1gX5JG4_O-qPYIKg4jnxg.png"/></div></div></figure><p id="ad0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装完成后，关闭虚拟机并弹出iso。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/6bb459ad249497fe34a1bb56d68f4205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*FpgbLncKOxBfEdNZGt1EAg.png"/></div></figure><p id="3a8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">启动虚拟机。</p><p id="ca75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">控制面板将显示错误，直到引导程序继续运行。这很正常，耐心一点就好。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pd"><img src="../Images/14f4d95c9583f784cbb43420a0acb583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TKukyfXcJWjotQSMln7k7g.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="4913" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">监控引导安装:</h1><p id="12ac" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">您可以从okd4-services节点监控引导过程:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="3f7f" class="mx kr it mt b gy my mz l na nb">openshift-install --dir=install_dir/ wait-for bootstrap-complete --log-level=debug</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pe"><img src="../Images/472616d7d5b0887fe94206c96a80a1fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*os8y5vsfIxMbbXxY.png"/></div></div></figure><p id="bdff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">引导过程可能需要30分钟以上，完成后，您可以关闭引导节点。现在是编辑/etc/haproxy/haproxy.cfg、注释掉引导节点并重新加载haproxy服务的好时机。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="908f" class="mx kr it mt b gy my mz l na nb">sudo sed -i '/ okd4-bootstrap /s/^/#/' /etc/haproxy/haproxy.cfg<br/>sudo systemctl reload haproxy</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="fc25" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">登录集群并检查状态:</h1><p id="a50f" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">既然控制平面节点已经在线，您应该能够登录oc客户端了。使用以下命令登录并检查集群的状态:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="15f7" class="mx kr it mt b gy my mz l na nb">export KUBECONFIG=~/install_dir/auth/kubeconfig<br/>oc whoami<br/>oc get nodes</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/a0505acc7f7aefcd92cfcf5862730639.png" data-original-src="https://miro.medium.com/v2/resize:fit:60/0*HeaPKN3xpsy_J8vj"/></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/f9f818870f59af12b12b09067b3f8338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/0*rwILiSEeG2XQTxOD.png"/></div></figure><p id="8033" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查集群操作符的状态。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="6350" class="mx kr it mt b gy my mz l na nb">oc get clusteroperators</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ph"><img src="../Images/f3392b4e35383f9b637f7b5f0830dc52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ebZ4EUroQWq3LI2v.png"/></div></div></figure><p id="f70f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦控制台操作员有空，请登录web控制台。从install_dir/auth文件夹中获取您的kubeadmin密码:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="2263" class="mx kr it mt b gy my mz l na nb">cat install_dir/auth/kubeadmin-password</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/150f645012385e8fe674ad5f21018b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/0*uMW673ZBNesYGbf-.png"/></div></figure><p id="1c7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开您的网络浏览器进入<a class="ae kp" href="https://console-openshift-console.apps.lab.okd.local/" rel="noopener ugc nofollow" target="_blank">https://console-openshift-console.apps.lab.okd.local/</a>，使用上面的密码以kubeadmin身份登录:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pj"><img src="../Images/8d5cbc98d5093cf4e320486cf9932820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-Rss6O0RV19EZprN.png"/></div></div></figure><p id="312c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">群集状态可能仍然显示正在升级，并且它会继续完成安装。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pk"><img src="../Images/a158ca918515c7acb2fd982e1cfd7a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*56iMIpMBA82RGP6V.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="8a4d" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">持久存储:</h1><p id="34c2" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在我们完成这个项目之前，我们需要为我们的注册表创建一些持久存储。让我们将okd4-services VM配置为NFS服务器，并将其用于持久存储。</p><p id="535d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录到您的okd4-services虚拟机，并开始设置一个NFS服务器。以下命令安装必要的包，启用服务，并配置文件和文件夹权限。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="05e0" class="mx kr it mt b gy my mz l na nb">sudo dnf install -y nfs-utils<br/>sudo systemctl enable nfs-server rpcbind<br/>sudo systemctl start nfs-server rpcbind<br/>sudo mkdir -p /var/nfsshare/registry<br/>sudo chmod -R 777 /var/nfsshare<br/>sudo chown -R nobody:nobody /var/nfsshare</span></pre><p id="f32e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建NFS导出</p><p id="8b50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在新的/etc/exports文件“/var/NFS share 192 . 168 . 200 . 0/24(rw，sync，no_root_squash，no_all_squash，no_wdelay)”中添加这一行</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="dde3" class="mx kr it mt b gy my mz l na nb">echo '/var/nfsshare 192.168.200.0/24(rw,sync,no_root_squash,no_all_squash,no_wdelay)' | sudo tee /etc/exports</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/21b058c335cf34c1a6fa5cfecf644f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*Al-Tla5M0ohg_g9l.png"/></div></figure><p id="6e05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重新启动nfs服务器服务并添加防火墙规则:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="841a" class="mx kr it mt b gy my mz l na nb">sudo setsebool -P nfs_export_all_rw 1<br/>sudo systemctl restart nfs-server<br/>sudo firewall-cmd --permanent --zone=public --add-service mountd<br/>sudo firewall-cmd --permanent --zone=public --add-service rpc-bind<br/>sudo firewall-cmd --permanent --zone=public --add-service nfs<br/>sudo firewall-cmd --reload</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="9889" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">注册表配置:</h1><p id="454d" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在NFS共享上创建一个永久卷。使用git repo中okd4_files文件夹中的registry_py.yaml:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="5f11" class="mx kr it mt b gy my mz l na nb">oc create -f okd4-snc-hyperv/registry_pv.yaml<br/>oc get pv</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ot"><img src="../Images/83ec2844396e0dcef276303ed1f461f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v-EyX4DP6mTsyYjA.png"/></div></div></figure><p id="0e93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑图像注册表操作符:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="efcb" class="mx kr it mt b gy my mz l na nb">oc edit configs.imageregistry.operator.openshift.io</span></pre><p id="b139" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将管理状态从“已删除”更改为“已管理”。在存储下:添加pvc:和claim: blank以附加PV并自动保存您的更改:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="ef25" class="mx kr it mt b gy my mz l na nb">managementState: Managedstorage:<br/>    pvc:<br/>      claim:</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/f84a9be7e785f9868d7b35466a778ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/0*BcikMoHUd_darNnG.png"/></div></figure><p id="03c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查您的持久卷，现在应该声明:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="200e" class="mx kr it mt b gy my mz l na nb">oc get pv</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pn"><img src="../Images/a6f9debf02977b328e7056433e720d35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yb4cTnd9N1zlKbK9.png"/></div></div></figure><p id="ce36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查导出大小，它应该为零。在下一节中，我们将推送至注册表，文件大小不应为零。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="35af" class="mx kr it mt b gy my mz l na nb">du -sh /var/nfsshare/registry</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi po"><img src="../Images/b66546353a5f8f6295404eb57a59edd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/0*UpXEyE7dB6XGlDfq.png"/></div></figure><p id="c6c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一节中，我们将创建一个WordPress项目并将其推送到注册表中。推送后，NFS导出应该显示200+ MB。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="c71b" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">创建WordPress项目:</h1><p id="e7dd" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">创建一个新的OKD项目。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="7126" class="mx kr it mt b gy my mz l na nb">oc new-project wordpress-test</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pn"><img src="../Images/b2cc41c0a987649949f26f5b602a037f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x9LrpKx_JjZCJ_gM.png"/></div></div></figure><p id="4081" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用docker hub中的centos php73 s2i映像创建一个新应用程序，并使用WordPress GitHub repo作为源代码。公开服务以创建路由。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="0f80" class="mx kr it mt b gy my mz l na nb">oc new-app centos/php-73-centos7~<a class="ae kp" href="https://github.com/WordPress/WordPress.git" rel="noopener ugc nofollow" target="_blank">https://github.com/WordPress/WordPress.git</a><br/>oc expose svc/wordpress</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pp"><img src="../Images/0976604a376222c8d65b0251023f45a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EeOCrw0v6eMFt7KX.png"/></div></div></figure><p id="4046" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用centos7 MariaDB映像和一些环境变量创建一个新应用程序:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="0da2" class="mx kr it mt b gy my mz l na nb">oc new-app centos/mariadb-103-centos7 --name mariadb --env MYSQL_DATABASE=wordpress --env MYSQL_USER=wordpress --env MYSQL_PASSWORD=wordpress</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pn"><img src="../Images/60b8b6260f543ade5f6d4945fc58035b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Kyb-P_izlgWX4FlT.png"/></div></div></figure><p id="94fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开OpenShift控制台，浏览到WordPress-test项目。一旦WordPress图像被构建并准备好，它将是深蓝色的，就像MariaDB实例所示:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pq"><img src="../Images/061117ec924356d830f0be71979bc6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0J8IgIVTY-aUhrk8.png"/></div></div></figure><p id="e44c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击WordPress对象，然后点击路线，在你的网络浏览器中打开它:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pr"><img src="../Images/a7fae56a31dd5297e55549593c6090d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JgBf5EY2WlZkBxh5.png"/></div></div></figure><p id="07c4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你应该看到WordPress设置配置，点击让我们开始。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi ps"><img src="../Images/007a4b62ee4ba31eb3e36a78a06cbcf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H7aGntQhlqDUOHNC.png"/></div></div></figure><p id="bc0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如图所示，填写数据库、用户名、密码和数据库主机，并运行安装程序:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pt"><img src="../Images/c09c93bff9b282ac72e078537efd8f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T0rwkFo-s93Hp3BH.png"/></div></div></figure><p id="edcb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">填写欢迎信息并点击安装WordPress。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pu"><img src="../Images/b28b5ed3ef0586fc9ca280d250923d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*evg4gB4CetyURwCm.png"/></div></div></figure><p id="1d13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">登录，你应该有一个工作的WordPress安装:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pv"><img src="../Images/1ed4a48d6294bf1409e3120f5f82b1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GHJh9F5WUFJC-ZW7.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pw"><img src="../Images/81592a804ed952877065bda227114ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3TmjRtBARo7KykRm.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pv"><img src="../Images/5d5785a28cb3fad4ce58d6713779a690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B-phgKsmbty-lDGh.png"/></div></div></figure><p id="8d6b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在okd4-services虚拟机上检查NFS导出的大小。大小应该在300MB左右。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="6cab" class="mx kr it mt b gy my mz l na nb">du -sh /var/nfsshare/registry/</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi px"><img src="../Images/0322078996eff8e813c13a6408bfeaee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/0*qPSgWkHl2gIdauZI.png"/></div></figure><p id="a6c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您刚刚验证了您的永久卷正在工作。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="c81c" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">HTPasswd安装程序:</h1><p id="86f5" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">kubeadmin是一个临时用户。设置本地用户最简单的方法是使用htpasswd。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="b2d6" class="mx kr it mt b gy my mz l na nb">cd<br/>cd okd4-snc-hyperv<br/>htpasswd -c -B -b users.htpasswd testuser testpassword</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi py"><img src="../Images/adf5fdd407253e60909b8afb08329082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vGedMjaPdZT4vR6G.png"/></div></div></figure><p id="e460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用您生成的users.htpasswd文件在openshift-config项目中创建一个秘密:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="f642" class="mx kr it mt b gy my mz l na nb">oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd -n openshift-config</span></pre><p id="c3db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加身份提供者。</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="5a29" class="mx kr it mt b gy my mz l na nb">oc apply -f htpasswd_provider.yaml</span></pre><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi pz"><img src="../Images/1bc581ec3156e993e82441b632a22235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XeZXBSts1U_op5VH.png"/></div></div></figure><p id="ca47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注销OpenShift控制台。然后选择htpasswd_provider，用testuser和testpassword凭证登录。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/fc4e1c1ae6cb160cd132ff19aeac6227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/0*elGdCpL5BsZmv45p.png"/></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi qb"><img src="../Images/5fb3f950cda85feff1336bfe632d0877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jFgrurSjWceBi-Jf.png"/></div></div></figure><p id="47a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您访问管理员页面，您应该看不到任何项目:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi qc"><img src="../Images/56a46d2ab328079beb37cb2e650a3264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xIyG3fu1VLtT-yPS.png"/></div></div></figure><p id="e04f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">授予您自己集群管理权限，项目应该立即填充:</p><pre class="lu lv lw lx gt ms mt mu mv aw mw bi"><span id="a541" class="mx kr it mt b gy my mz l na nb">oc adm policy add-cluster-role-to-user cluster-admin testuser</span></pre><p id="6123" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的用户现在应该拥有集群管理员级别的访问权限:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi qd"><img src="../Images/3bdc2c0bc9f68e007c74f6e8035c136d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cNlrwBpFDL24M-pa.png"/></div></div></figure></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h1 id="0e43" class="kq kr it bd ks kt mn kv kw kx mo kz la lb mp ld le lf mq lh li lj mr ll lm ln bi translated">恭喜你。您已经创建了一个OKD单节点集群！</h1><p id="1cb7" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">希望您已经创建了一个OKD单节点集群，并在这个过程中学到了一些东西。在这一点上，你应该有一个良好的基础来修补OKD和继续学习。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="0077" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有一些资源可以帮助你的旅程:</p><p id="ba4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要报告问题，请使用<a class="ae kp" href="https://github.com/openshift/okd" rel="noopener ugc nofollow" target="_blank">https://github.com/openshift/okd Github Repo:</a>T2</p><p id="bd7e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如需支持，请查看<a class="ae kp" href="https://slack.k8s.io/" rel="noopener ugc nofollow" target="_blank"> k8s Slack </a>上的#openshift-users频道</p><p id="c7bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">OKD工作组每两周召开一次会议，讨论发展和下一步措施。会议日程和地点在<a class="ae kp" href="https://github.com/openshift/community/projects/1#card-28309038" rel="noopener ugc nofollow" target="_blank">open shift/社区报告</a>中记录。</p><p id="c5b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">okd-wg的谷歌小组:<a class="ae kp" href="https://groups.google.com/forum/#!forum/okd-wg" rel="noopener ugc nofollow" target="_blank">https://groups.google.com/forum/#!forum/okd-wg</a></p></div></div>    
</body>
</html>