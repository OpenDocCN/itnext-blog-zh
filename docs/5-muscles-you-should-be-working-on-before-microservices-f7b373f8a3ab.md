# 微保养前你应该锻炼的 5 块肌肉

> 原文：<https://itnext.io/5-muscles-you-should-be-working-on-before-microservices-f7b373f8a3ab?source=collection_archive---------1----------------------->

![](img/9df03c1540f17953d81a93cabf13c832.png)

乔希·卡拉布雷斯在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

当然，每个人都认为这是一种神奇的模式，可以用一根神奇的棍子解决他们的问题。事实上，除非你知道自己在做什么，否则它可能不适合你。

在本文中，我不打算详细解释什么是微服务模式。但是，根据[微服务. io](https://microservices.io) :

> 它是一种架构风格，将应用程序构建为服务的集合。

让我们深入细节。

## 1 —沟通

首先，我认为这方面最重要的主题是人才库成员之间的交流。在最佳情况下，节点之间的连接越少越好。如果每次完成一个动作都需要调用另一个服务；设计可能有问题。

也有几种沟通方式。您可以让消费者(大多数情况下是 UI)调用每个服务，您可以让服务直接调用它们自己，或者您可以在它们之间实现一个消息队列。或者你可以把它们结合起来！

这个问题没有确定的答案，你只需要了解你所处的位置，并尝试选择正确的位置:

*   **消息队列**异步工作，所以如果您需要在请求时知道结果，这个选项可能对您不好。
*   **HTTP 端点，**则相反，会给你你想要的。但是这带来了另一个成本(额外的域、安全性、TCP 开销)

不要忘记；互动少一点好。

在选择沟通方式时，您会意识到还有另一个问题需要回答:

## 2 —交易管理

假设您的微服务应用环境中有 A & B 服务。如果您选择 message queue 选项在服务 A 和服务 B 之间进行通信，您如何确定服务 B 完成了由服务 A 启动的操作？

好吧，你可以再发一条消息给源头，告诉他们任务完成了。然后，可以用 WebSocket 或 push 消息通知 UI。但是，如果结果是完成操作所必需的，那么消息队列可能并不适合。

## 3 —数据库

数据库是这个系统中最重的一块石头。如果包含数据库操作，就很难进行操作。

在一个数据库上有几个微服务只会增加系统的复杂性。这就像有 5 个服务员，但只有一个厨师来烹饪所有的订单。

受源代码控制的数据库是另一个要点。跟踪变更很重要——通过 CI/CD 管道在数据库中进行更新也很关键。否则，你可能会在发布日有快乐的时刻:)

## 4—集成测试

当你一个人的时候，你可以唱得很完美，但是要想在合唱团唱歌，你还需要抓住节奏。因此，您需要作为一个团队开始测试您的服务。

正如你可能猜到的，这里重要的一点是测试应用程序的连接点。你可以在这里找到马丁·福勒的简短解释[。](https://martinfowler.com/articles/microservice-testing/#testing-progress-1)

## 5 —诊断

相对来说，检测一个单一应用程序的故障、内存泄漏或性能差距是很容易的。当你向俱乐部介绍新的服务时，你可能无法找到问题的症结所在。

结构化的日志记录机制对于异常非常方便。使用像 [DataDog](http://www.datadoghq.com) 或 [Seq](https://datalust.co/seq) 这样的服务或者将你的日志推送到弹性搜索会比你想象的更有用。而且，用关联 id 标记日志还可以让您轻松地关联日志，而不是检查时间戳。

您可以在此列表中添加更多标题，如 CI/CD、缓存、安全等。但是我想强调我在开发微服务时最纠结的主题。深入调查一下，决定去还是不去。它可能会让你付出更多。