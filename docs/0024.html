<html>
<head>
<title>RESTful voting gem for rails app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">rails应用程序的RESTful投票gem</h1>
<blockquote>原文：<a href="https://itnext.io/restful-voting-for-rails-app-b76076fb7cac?source=collection_archive---------0-----------------------#2016-04-07">https://itnext.io/restful-voting-for-rails-app-b76076fb7cac?source=collection_archive---------0-----------------------#2016-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/d35e5356f7533a58a6ad2e57ea9912ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQV09JBt7KmV5XHjEeF5Ww.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">资料来源:blog.codelation.com</figcaption></figure><div class=""/><p id="ba5c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la"> RailsRestVote </em>是一个Ruby Gem，它为rails应用程序的任何模型添加了投票功能，并公开了它的RESTful APIs。</p><p id="0c4e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你使用的是Angular这样的前端框架，React在你的应用中真的很有帮助。</p><p id="80c9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae lb" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Frestful-voting-for-rails-app-b76076fb7cac" rel="noopener ugc nofollow" target="_blank"> <em class="la">点击这里在LinkedIn上分享这篇文章</em> </a></p><h1 id="e66b" class="lc ld jf bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">先决条件</h1><h2 id="ccf5" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">扶持CORS</h2><p id="e1c1" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">如果你正在构建一个公共API，你可能想要启用跨源资源共享(CORS ),以使跨源AJAX请求成为可能。</p><p id="92bc" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">rack-cors gem使这变得非常简单。就像这样把它放在你的Gemfile里:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="0043" class="ma ld jf mw b gy na nb l nc nd">gem 'rack-cors'</span></pre><p id="032e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">并将类似下面的代码放入Rails应用程序的config/application.rb中。例如，这将允许来自任何资源的GET、POST或OPTIONS请求。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6dff" class="ma ld jf mw b gy na nb l nc nd">module YourApp<br/>  class Application &lt; Rails::Application</span><span id="0952" class="ma ld jf mw b gy ne nb l nc nd">    # ...</span><span id="5f40" class="ma ld jf mw b gy ne nb l nc nd">    config.middleware.insert_before 0, "Rack::Cors" do<br/>      allow do<br/>        origins '*'<br/>        resource '*', :headers =&gt; :any, :methods =&gt; [:get, :post, :options]<br/>      end<br/>    end</span><span id="80c7" class="ma ld jf mw b gy ne nb l nc nd">  end<br/>end</span></pre><blockquote class="nf ng nh"><p id="691c" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><em class="jf">更多详细配置选项请参见gem </em> <a class="ae lb" href="https://github.com/cyu/rack-cors" rel="noopener ugc nofollow" target="_blank"> <em class="jf">文档</em> </a></p></blockquote><h1 id="e20a" class="lc ld jf bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">装置</h1><p id="3d6f" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">将这一行添加到应用程序的Gemfile中:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="9154" class="ma ld jf mw b gy na nb l nc nd">gem 'rails_rest_vote'</span></pre><p id="cd76" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后执行:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2986" class="ma ld jf mw b gy na nb l nc nd">$ bundle install</span></pre><p id="fee4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在项目文件夹中运行以下命令:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="4bd1" class="ma ld jf mw b gy na nb l nc nd">$ rails g rails_rest_vote <!-- -->MODEL</span></pre><p id="c210" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在上面的命令中，您需要用应用程序用户的类名替换<code class="fe nl nm nn mw b">MODEL</code>(通常是<code class="fe nl nm nn mw b">User</code>，但也可能是<code class="fe nl nm nn mw b">Admin</code>)</p><p id="e931" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">它会为你做三件事:</p><ul class=""><li id="ba59" class="no np jf ke b kf kg kj kk kn nq kr nr kv ns kz nt nu nv nw bi translated">在db/migrate/ folder中创建投票表的迁移文件。</li><li id="35ab" class="no np jf ke b kf nx kj ny kn nz kr oa kv ob kz nt nu nv nw bi translated">在用户模型中插入关联，即has_many :votes</li><li id="8d06" class="no np jf ke b kf nx kj ny kn nz kr oa kv ob kz nt nu nv nw bi translated">创建投票模型，即app/models/vote.rb</li></ul><p id="20ad" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，使用以下命令迁移数据库:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="e001" class="ma ld jf mw b gy na nb l nc nd">$ rake db:migrate</span></pre><p id="fda3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在你可以走了。</p><h1 id="8812" class="lc ld jf bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">使用</h1><p id="a0f4" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">将以下行添加到您想要使用向上投票/向下投票或相似/不相似功能的模型中:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="c27b" class="ma ld jf mw b gy na nb l nc nd">has_many :votes, :as =&gt; :votable</span></pre><p id="d403" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">它有两种用法，我在下面的例子中使用的是<code class="fe nl nm nn mw b">Post</code>模型:</p><blockquote class="nf ng nh"><p id="385d" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="jf">用作upvote/downvote(堆栈溢出/Quora): </em> </strong></p><p id="6bc9" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="jf">原料药</em> </strong></p></blockquote><h2 id="c644" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/票数/上升</h2><p id="f4e8" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">以下API用于模型的向上投票:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="f896" class="ma ld jf mw b gy na nb l nc nd">method: POST <br/>body: {"votable_id":"1","votable_type":"Post","user_id":"1"}<br/>content-type: application/json<br/>response: {"status":200,"message":"upvoted successfully."}</span></pre><h2 id="eb25" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/票数/下降</h2><p id="5137" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">以下API用于否决模型:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="1243" class="ma ld jf mw b gy na nb l nc nd">method: POST <br/>body: {"votable_id":"1","votable_type":"Post","user_id":"1"}<br/>content-type: application/json<br/>response: {"status":200,"message":"downvoted successfully."}</span></pre><h2 id="6311" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/选票/用户？user_id=1</h2><p id="8419" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">以下API返回特定用户完成的向上投票和向下投票计数:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="3374" class="ma ld jf mw b gy na nb l nc nd">method: GET <br/>content-type: application/json<br/>response: {"status":200,"upcount":1,"upvotes":[{"id":1,...}], "downcount":1,"downvotes":[{"id":3,...}]}</span></pre><h2 id="fdef" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/票数/车型？votable_id=1&amp;votable_type=Post</h2><p id="6e28" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">以下API返回特定用户完成的向上投票和向下投票计数。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="6ca0" class="ma ld jf mw b gy na nb l nc nd">method: GET <br/>content-type: application/json<br/>response: {"status":200,"upcount":1,"upvotes":[{"id":1,...}], "downcount":1,"downvotes":[{"id":3,...}]}</span></pre><blockquote class="nf ng nh"><p id="b270" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="jf">用</em> <em class="jf">作为喜欢/不喜欢(脸书):</em> </strong></p><p id="8f58" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><strong class="ke jg"> <em class="jf">原料药</em> </strong></p></blockquote><h2 id="a29e" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/喜欢</h2><p id="4a59" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">相同的API用于相似和不相似的功能。如果你第一次点击这个API，它将像“喜欢”一样工作，如果你第二次发送相同的参数，它将从投票表中删除记录，即“不喜欢”</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="7344" class="ma ld jf mw b gy na nb l nc nd">method: POST <br/>body: {"votable_id":"1","votable_type":"Post","user_id":"1"}<br/>content-type: application/json<br/>response: {"status":200,"message":"liked successfully."}</span></pre><h2 id="0303" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/API/赞/用户？user_id=1</h2><p id="46e3" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">以下API返回特定用户完成的计数:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2039" class="ma ld jf mw b gy na nb l nc nd">method: GET <br/>content-type: application/json<br/>response: {"status":200,"likecount":1,"likes":[{"id":1,...}]}</span></pre><h2 id="cab3" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">/api/likes/model？votable_id=1&amp;votable_type=Post</h2><p id="a818" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">下面的API返回类似于在特定模型上完成的计数。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="cd3e" class="ma ld jf mw b gy na nb l nc nd">method: GET <br/>content-type: application/json<br/>response: {"status":200,"likecount":1,"likes":[{"id":1,...}]}</span></pre><h2 id="18b9" class="ma ld jf bd le mb mc dn li md me dp lm kn mf mg lq kr mh mi lu kv mj mk ly ml bi translated">注意:</h2><p id="90a6" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated"><code class="fe nl nm nn mw b">user_id</code>内部请求体可以是<code class="fe nl nm nn mw b">admin_id</code>，这取决于应用程序的用户模型(通常是<code class="fe nl nm nn mw b">User</code>，但也可能是<code class="fe nl nm nn mw b">Admin</code>)</p><blockquote class="nf ng nh"><p id="63fb" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated">根据您的使用情况，这两种功能可以在同一应用程序中使用。</p></blockquote><h1 id="7d5a" class="lc ld jf bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">基于令牌的认证</h1><p id="e39f" class="pw-post-body-paragraph kc kd jf ke b kf mm kh ki kj mn kl km kn mo kp kq kr mp kt ku kv mq kx ky kz ij bi translated">如果您使用基于令牌的身份验证来授权请求，您可以在应用程序的ApplicationController中进行。</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="a8ff" class="ma ld jf mw b gy na nb l nc nd"># app/controllers/application_controller.rb <br/>class ApplicationController &lt; ActionController::API <br/>    before_action :authenticate_request <br/>    attr_reader :current_user <br/>    <br/>    private <br/>    def authenticate_request<br/>       # Here you can read headers and check for current user. this example is for `jwt` check below link for more.<br/>       @current_user = AuthorizeApiRequest.call(request.headers).result render json: { error: 'Not Authorized' }, status: 401 unless @current_user <br/>    end <br/>end</span></pre><blockquote class="nf ng nh"><p id="2bbb" class="kc kd la ke b kf kg kh ki kj kk kl km ni ko kp kq nj ks kt ku nk kw kx ky kz ij bi translated"><em class="jf">阅读</em><a class="ae lb" href="https://www.pluralsight.com/guides/ruby-ruby-on-rails/token-based-authentication-with-ruby-on-rails-5-api" rel="noopener ugc nofollow" target="_blank"><em class="jf">token-based-authentic ation-with-ruby-on-rails-5-API</em></a><em class="jf">博文进行整合。</em></p></blockquote><h1 id="4092" class="lc ld jf bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">检查git repo。</h1><div class="ip iq gp gr ir oc"><a href="https://github.com/tixdo/rails_rest_vote" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jg gy z fp oh fr fs oi fu fw je bi translated">thecodinghouse/rails_rest_vote</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">用于rails应用程序的RESTful投票gem</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ix oc"/></div></div></a></div><p id="93a0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">(帮助其他人找到我在Medium上的文章👏🏽下面。)</p></div></div>    
</body>
</html>