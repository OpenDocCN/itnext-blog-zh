<html>
<head>
<title>How I replaced LVM with ZFS filesystem for my home NAS server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何为我的家庭NAS服务器用ZFS文件系统替换LVM</h1>
<blockquote>原文：<a href="https://itnext.io/how-i-replaced-lvm-with-zfs-filesystem-for-my-home-nas-server-7165f620e07f?source=collection_archive---------5-----------------------#2020-05-07">https://itnext.io/how-i-replaced-lvm-with-zfs-filesystem-for-my-home-nas-server-7165f620e07f?source=collection_archive---------5-----------------------#2020-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/677df5e0787f529892174d00d5c7bc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vqxVvT13Wy7lnhJ_"/></div></div></figure><p id="d5b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上一篇<a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/how-i-turned-my-old-desktop-into-2-5tb-nas-backup-linux-server-with-a-few-hard-drives-1414852aa0b5">文章</a>中，我没有用LVM很好地解决在我的家庭NAS中使用多个磁盘的问题，所以我现在要用ZFS升级解决方案。</p><h1 id="aed5" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">什么是ZFS？</h1><p id="b4fb" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">ZFS是一个高级文件系统，具有强大的功能，如池化存储、快照、自动修复和数据完整性验证、RAID-Z和16eb文件大小限制。</p><h2 id="364f" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">集中储存</h2><p id="277a" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">ZFS结合了卷管理器(就像我上次使用的LVM)和文件系统的特性。这意味着文件系统可以跨多个驱动器或一个池。</p><h1 id="f48e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">以前与LVM的解决方案</h1><p id="60a6" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在前面的解决方案中，我使用逻辑卷管理器进行了以下设置:</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/59bc0fe92b1eb006d1ee138ed7b75f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*6wFwdtgA_GMYbcDHrWq9yQ.png"/></div></figure><p id="8de0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在一个大的(2.3 TB)逻辑卷中只有一堆硬盘。这带来了一个大问题——如果其中一个驱动器出现故障，整个逻辑卷都会被破坏。</p><p id="5856" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是ZFS的用武之地。</p><h1 id="eecd" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用ZFS取代LVM</h1><p id="b756" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，我必须将我的数据备份到另一个(外部)驱动器上。然后我卸载了逻辑卷并删除了它。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/eaacd61cf4a6ddd8210707bb8efd2369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*skWHaJhcrAxzHTwkrU3P7Q.png"/></div></div></figure><p id="7bd1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在第一个解决方案中，我没有检查磁盘的运行状况，所以现在我已经检查了。我用过SMART(自我监控、分析和报告技术)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/d61bb7433944bc986c2fb80b9ce8aa32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9juloTeicl2LezAC9Qfn0w.png"/></div></div></figure><p id="786e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我发现其中3个磁盘充满了错误和故障，所以我只选择了<em class="mw"> sdd </em> (WD 1TB)和<em class="mw"> sde </em> (WD 320GB)驱动器，它们也具有最快的读取速度(我没有测试写入速度，读取速度对我来说足够作为基准)。我已经用<em class="mw"> hdparm </em>测试了读取速度。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/7befcc9f523d25f7cbbd9548b8e25d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwU78iaJZgcs3fwqpIZ2mw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">(sdb是系统固态硬盘，<em class="nc"> sdd </em>是SATA3硬盘)</figcaption></figure><h2 id="ffed" class="md lb it bd lc me mf dn lg mg mh dp lk km mi mj lo kq mk ml ls ku mm mn lw mo bi translated">安装和使用ZFS</h2><p id="aa81" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，我将磁盘格式化为Solaris文件系统(fdisk中的<em class="mw">be</em>代码，上一篇文章中的教程)。</p><p id="212a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我使用zfstools ( <em class="mw">安装zfsutils-linux </em>)创建池，将其挂载到一个挂载点，并开始使用ZFS。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/1bab791b8d4a9d01a8277d299fbb19dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vq9f6ZvIBbH9H9TGtxncYQ.png"/></div></div></figure><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/f93aa4a5be11d9dec0cb5a80f7e19e7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMM2pn4CA0xi7EjLVCSCBw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">池列表</figcaption></figure><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/17d034c67b0e4dc27e4b2146fd519b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*Wl7-7xwn1aL4NAEeoxkM3g.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">装载点—可用空间</figcaption></figure><p id="bc6b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上一篇文章中，挂载点已经在samba配置中注册了，所以我可以马上开始使用网络驱动器。<br/>搞定。</p></div></div>    
</body>
</html>