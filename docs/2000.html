<html>
<head>
<title>Creating a Kafka Topic Running Kafka Brokers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Kafka主题运行Kafka Brokers</h1>
<blockquote>原文：<a href="https://itnext.io/creating-a-kafka-topic-running-kafka-brokers-d9aab5530fb2?source=collection_archive---------0-----------------------#2019-03-13">https://itnext.io/creating-a-kafka-topic-running-kafka-brokers-d9aab5530fb2?source=collection_archive---------0-----------------------#2019-03-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/54be031dbaf7be5b6f3edc0bfbd5b7bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*kRfr0GJApNNKlLGSmjBWUw.png"/></div></figure><p id="e336" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从1996年开始编程，从2001年开始开发Java的Raúl Estrada在这篇文章中学习如何使用Kafka brokers运行Kafka主题。他是BEA Systems和Oracle Inc .的企业架构师，但他也喜欢web、移动和游戏编程。劳尔是自由软件的支持者，喜欢尝试新的技术、框架、语言和方法。</p><p id="2a41" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">服务器背后真正的艺术在于它的配置。本文将研究如何在独立模式下处理Kafka代理的基本配置。有两种类型的配置:独立和集群。当以集群模式运行复制并且所有主题都被正确分区时，Kafka的真正力量被释放出来。</p><p id="b26f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">集群模式有两个主要优势:并行性和冗余性。并行性是指在集群成员之间同时运行任务的能力。冗余保证了当Kafka节点关闭时，集群是安全的，并且可以从其他运行的节点访问。</p><p id="06d2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">本文展示了如何在我们的本地机器上配置一个包含多个节点的集群，尽管在实践中，让多台包含多个节点的机器共享集群总是更好。</p><p id="ff83" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了开始这个练习，让我们使用合流平台开源版本。汇合平台在Docker镜像中也是可用的，但是在这里我们将把它安装在本地。在<a class="ae kw" href="https://www.confluent.io/download/" rel="noopener ugc nofollow" target="_blank">https://www.confluent.io/download/</a>打开合流平台下载页面。</p><p id="8c36" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Confluent Platform的当前版本是5.0.0稳定版。请记住，由于Kafka核心运行在Scala上，因此有两个版本:Scala 2.11和Scala 2.12。</p><p id="9c4b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们可以从我们的桌面目录运行融合平台，但是让我们对Linux用户使用<code class="fe kx ky kz la b">/opt/</code>，对macOS用户使用<code class="fe kx ky kz la b">/usr/local</code>。</p><p id="22d0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要安装合流平台，在目录中提取下载的文件<code class="fe kx ky kz la b">confluent-5.0.0-2.11.tar.gz</code>，如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="f69d" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; tar xzf confluent-5.0.0-2.11.tar.gz</strong></span></pre><p id="5071" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，转到合流平台安装目录，从现在开始称为<code class="fe kx ky kz la b">&lt;confluent-path&gt;</code>。</p><p id="849e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">代理是一个服务器实例。服务器(或代理)实际上是运行在操作系统中的一个进程，并根据其配置文件启动。</p><p id="438b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Confluent的人员为我们提供了一个标准代理配置的模板。这个名为<code class="fe kx ky kz la b">server.properties</code>的文件位于Kafka安装目录的<code class="fe kx ky kz la b">config</code>子目录中:</p><p id="70b6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">1.在<code class="fe kx ky kz la b">&lt;confluent-path&gt;</code>里面，做一个带有名字标记的目录。</p><p id="5ed1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">2.对于我们想要运行的每个Kafka代理(服务器),我们需要制作一个配置文件模板的副本，并相应地对其进行重命名。在这个例子中，我们的集群将被称为<code class="fe kx ky kz la b">mark</code>:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="8a27" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; cp config/server.properties &lt;confluent-path&gt;/mark/mark-1.properties</strong></span><span id="5f7b" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">&gt; cp config/server.properties &lt;confluent-path&gt;/mark/mark-2.properties</strong></span></pre><p id="9973" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">3.相应地修改每个属性文件。如果文件名为<code class="fe kx ky kz la b">mark-1</code>，则<code class="fe kx ky kz la b">broker.id</code>应为<code class="fe kx ky kz la b">1</code>。然后，指定服务器将运行的端口；推荐的是<code class="fe kx ky kz la b">mark-1</code>的<code class="fe kx ky kz la b">9093</code>和<code class="fe kx ky kz la b">mark-2</code>的<code class="fe kx ky kz la b">9094</code>。请注意，模板中没有设置port属性，因此添加以下行。最后，指定Kafka日志的位置(Kafka日志是存储所有Kafka代理操作的特定档案)；在这种情况下，使用<code class="fe kx ky kz la b">/tmp</code>目录。在这里，写权限的问题是很常见的。不要忘记向用户授予写和执行权限，以便通过日志目录执行这些过程，如下例所示:</p><p id="8142" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<code class="fe kx ky kz la b">mark-1.properties</code>中，设置以下内容:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="371e" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">broker.id=1</strong></span><span id="50a4" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">port=9093</strong></span><span id="e6bd" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">log.dirs=/tmp/mark-1-logs</strong></span></pre><p id="0dce" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<code class="fe kx ky kz la b">mark-2.properties</code>中，设置以下内容:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="17e5" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">broker.id=2</strong></span><span id="a02f" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">port=9094</strong></span><span id="e751" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">log.dirs=/tmp/mark-2-logs</strong></span></pre><p id="85dc" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">4.使用<code class="fe kx ky kz la b">kafka-server-start</code>命令启动Kafka代理，并将相应的配置文件作为参数传递。不要忘记合流平台必须已经在运行，并且端口不应该被另一个进程使用。按如下方式启动Kafka代理:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="4f52" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-server-start &lt;confluent-</strong></span><span id="05c8" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">path&gt;/mark/mark-1.properties &amp;</strong></span></pre><p id="c9ec" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在另一个命令行窗口中，运行以下命令:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="2aa9" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-server-start &lt;confluent-</strong></span><span id="3013" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">path&gt;/mark/mark-2.properties &amp;</strong></span></pre><p id="f782" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">不要忘记结尾的<code class="fe kx ky kz la b">&amp;</code>是指定你想要回你的命令行。如果您想查看代理的输出，建议在各自的命令行窗口中分别运行每个命令。</p><p id="11ce" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请记住，属性文件包含服务器配置，位于<code class="fe kx ky kz la b">config</code>目录中的<code class="fe kx ky kz la b">server.properties</code>文件只是一个模板。</p><p id="ded4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在有两个代理，<code class="fe kx ky kz la b">mark-1</code>和<code class="fe kx ky kz la b">mark-2</code>，运行在同一个集群中的同一台机器上。</p><p id="ed04" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请记住，没有愚蠢的问题，如下例所示:</p><p id="1944" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">问</strong>:每个经纪人如何知道自己属于哪个集群？</p><p id="c070" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">答</strong>:代理知道它们属于同一个集群，因为在配置中，它们都指向同一个Zookeeper集群。</p><p id="3440" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">问:同一个集群中的每个代理与其他代理有什么不同？</p><p id="7d3c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">答</strong>:每个代理在集群中由在<code class="fe kx ky kz la b">broker.id</code>属性中指定的名称来标识。</p><p id="a416" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">问</strong>:如果没有指定端口号会怎么样？</p><p id="8176" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">答</strong>:如果未指定port属性，Zookeeper将分配相同的端口号，并将覆盖数据。</p><p id="6397" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">问</strong>:如果没有指定日志目录会怎么样？</p><p id="d557" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu"> A </strong>:如果未指定<code class="fe kx ky kz la b">log.dir</code>，所有代理将写入相同的默认值<code class="fe kx ky kz la b">log.dir</code>。如果代理计划在不同的机器上运行，那么可以不指定port和<code class="fe kx ky kz la b">log.dir</code>属性(因为它们在相同的端口和日志文件中运行，但是在不同的机器上)。</p><p id="3cda" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">问:我如何检查在我想要启动我的代理的端口上没有正在运行的进程？</p><p id="c3e9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">答</strong>:有一个有用的命令，看看具体端口上运行的是什么进程；本例中的<code class="fe kx ky kz la b">9093</code>端口:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="a1a1" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; lsof -i :9093</strong></span></pre><p id="eed7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">前面命令的输出如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="d865" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME</strong></span><span id="2741" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">java 12529 admin 406u IPv6 0xc41a24baa4fedb11 0t0 TCP *:9093 (LISTEN)</strong></span></pre><p id="542e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">轮到您了:尝试在启动Kafka代理之前运行该命令，并在启动它们之后运行该命令以查看变化。此外，尝试在正在使用的端口上启动一个代理，看看它是如何失败的。</p><p id="8c26" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">好吧，如果我想让我的集群在几台机器上运行呢？</p><p id="5fd1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要在不同的机器上但在同一个集群中运行Kafka节点，在配置文件中调整Zookeeper连接字符串；其默认值如下:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="37e7" class="lj lk it la b gy ll lm l ln lo">zookeeper.connect=localhost:2181</span></pre><p id="6fc2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">请记住，DNS必须能够找到彼此的机器，并且它们之间没有网络安全限制。</p><p id="79e8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">只有当您在与Zookeeper相同的机器上运行Kafka broker时，Zookeeper connect的默认值才是正确的。根据不同的架构，需要决定是否在同一台Zookeeper机器上运行一个代理。</p><p id="4073" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要指定Zookeeper可以在其他机器上运行，请执行以下操作:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="8ae3" class="lj lk it la b gy ll lm l ln lo">zookeeper.connect=localhost:2181, 192.168.0.2:2183, 192.168.0.3:2182</span></pre><p id="3410" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">前一行指定Zookeeper运行在本地主机的端口<code class="fe kx ky kz la b">2181</code>，IP地址为<code class="fe kx ky kz la b">192.168.0.2</code>的机器的端口<code class="fe kx ky kz la b">2183</code>，以及IP地址为<code class="fe kx ky kz la b">192.168.0.3</code>的机器的端口<code class="fe kx ky kz la b">2182</code>。Zookeeper的默认端口是<code class="fe kx ky kz la b">2181</code>，所以通常它在那里运行。</p><p id="f9ac" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">轮到您了:作为一个练习，尝试使用关于Zookeeper集群的错误信息启动一个代理。另外，使用<code class="fe kx ky kz la b">lsof</code>命令，尝试在一个正在使用的端口上启动Zookeeper。</p><p id="98df" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您对配置有疑问，或者不清楚要更改什么值，那么<code class="fe kx ky kz la b">server.properties</code>模板(作为Kafka项目的一部分)是开源的，如下所示:</p><p id="b6d5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae kw" href="https://github.com/apache/kafka/blob/trunk/config/server.properties" rel="noopener ugc nofollow" target="_blank">https://github . com/Apache/Kafka/blob/trunk/config/server . properties</a></p><h1 id="f873" class="lq lk it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated"><strong class="ak">运行卡夫卡主题</strong></h1><p id="6eb9" class="pw-post-body-paragraph jx jy it jz b ka mn kc kd ke mo kg kh ki mp kk kl km mq ko kp kq mr ks kt ku im bi translated">代理内部的权力是主题，即其中的队列。现在我们有两个经纪人在运行，让我们为他们创建一个Kafka主题。</p><p id="ee80" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">像几乎所有现代基础设施项目一样，Kafka有三种构建方式:通过命令行、通过编程和通过web控制台(在这种情况下是汇合控制中心)。Kafka代理的管理(创建、修改和销毁)可以通过用大多数现代编程语言编写的程序来完成。如果不支持该语言，可以通过Kafka REST API进行管理。上一节展示了如何使用命令行构建代理。</p><p id="c6f2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">是否可以只通过编程来管理(创建、修改或销毁)代理？不，我们也可以管理主题。也可以通过命令行创建主题。正如我们已经看到的，Kafka预先构建了管理经纪人和管理主题的工具，我们将在接下来看到。</p><p id="e1af" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要在我们正在运行的集群中创建一个名为<code class="fe kx ky kz la b">amazingTopic</code>的主题，请使用以下命令:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="e9da" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic amazingTopic</strong></span></pre><p id="955c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">输出应该如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="c78c" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">Created topic amazingTopic</strong></span></pre><p id="c58c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这里使用了<code class="fe kx ky kz la b">kafka-topics</code>命令。用<code class="fe kx ky kz la b">--create</code>参数指定我们想要创建一个新的主题。<code class="fe kx ky kz la b">--topic</code>参数设置主题的名称，在本例中是<code class="fe kx ky kz la b">amazingTopic</code>。</p><p id="f4f0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">你还记得并行和冗余这两个术语吗？嗯，<code class="fe kx ky kz la b">–-partitions</code>参数控制并行度，<code class="fe kx ky kz la b">--replication-factor</code>参数控制冗余度。</p><p id="6c7e" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">--replication-factor</code>参数是基本的，因为它指定了主题将在集群的多少个服务器上复制(例如，运行)。另一方面，一个代理只能运行一个副本。</p><p id="b9a8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">显然，如果指定的数量大于集群上正在运行的服务器的数量，就会导致错误(你不信？在您的环境中尝试一下)。错误将是这样的:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="b1df" class="lj lk it la b gy ll lm l ln lo">Error while executing topic command: replication factor: 3 larger than available brokers: 2</span><span id="05b5" class="lj lk it la b gy lp lm l ln lo">[2018-09-01 07:13:31,350] ERROR org.apache.kafka.common.errors.InvalidReplicationFactorException: replication factor: 3 larger than available brokers: 2</span><span id="fba1" class="lj lk it la b gy lp lm l ln lo">(kafka.admin.TopicCommand$)</span></pre><p id="8a55" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要考虑的是，代理应该正在运行(不要害羞，在您的环境中测试所有这些理论)。</p><p id="099f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">--partitions</code>参数，顾名思义，表示主题将有多少个分区。数量决定了在消费者端可以实现的并行度。在进行集群微调时，这个参数非常重要。</p><p id="afa5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，正如所料，<code class="fe kx ky kz la b">--zookeeper</code>参数指出了Zookeeper集群正在哪里运行。</p><p id="54ec" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">创建主题时，代理日志中的输出如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="204b" class="lj lk it la b gy ll lm l ln lo">[2018-09-01 07:05:53,910] INFO [ReplicaFetcherManager on broker 1] Removed fetcher for partitions amazingTopic-0 (kafka.server.ReplicaFetcherManager)</span><span id="ce29" class="lj lk it la b gy lp lm l ln lo">[2018-09-01 07:05:53,950] INFO Completed load of log amazingTopic-0 with 1 log segments and log end offset 0 in 21 ms (kafka.log.Log)</span></pre><p id="eec8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">简而言之，这条消息读起来像一个新的话题已经在我们的集群中诞生了。</p><p id="9e85" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我如何检查我的新的闪亮的话题？使用相同的命令:<code class="fe kx ky kz la b">kafka-topics</code>。</p><p id="2b9c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">参数比<code class="fe kx ky kz la b">--create</code>多。要检查主题的状态，请运行带有<code class="fe kx ky kz la b">--list</code>参数的<code class="fe kx ky kz la b">kafka-topics</code>命令，如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="5098" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-topics.sh --list --zookeeper localhost:2181</strong></span></pre><p id="504f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们知道，输出是主题列表，如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="5708" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">amazingTopic</strong></span></pre><p id="5749" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该命令返回集群中所有正在运行的主题的名称列表。</p><p id="f055" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如何获取某个主题的详细信息？使用相同的命令:<code class="fe kx ky kz la b">kafka-topics</code>。</p><p id="0f08" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">对于特定主题，运行带有<code class="fe kx ky kz la b">--describe</code>参数的<code class="fe kx ky kz la b">kafka-topics</code>命令，如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="de63" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-topics --describe --zookeeper localhost:2181 --topic amazingTopic</strong></span></pre><p id="b68b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">命令输出如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="d11a" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">Topic:amazingTopic PartitionCount:1 ReplicationFactor:1 Configs: Topic: amazingTopic Partition: 0 Leader: 1 Replicas: 1 Isr: 1</strong></span></pre><p id="b369" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">以下是对输出的简要说明:</p><p id="b6ae" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">PartitionCount</code>:主题上的分区数量(并行度)</p><p id="369d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">ReplicationFactor</code>:主题的副本数量(冗余)</p><p id="a9b6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">Leader</code>:负责给定分区读写操作的节点</p><p id="a14a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">Replicas</code>:复制该话题数据的经纪人列表；其中一些甚至可能已经死亡</p><p id="7580" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe kx ky kz la b">Isr</code>:当前为同步副本的节点列表</p><p id="f6e1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们创建一个具有多个副本的主题(例如，我们将在集群中运行更多的代理)；我们键入以下内容:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="f336" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-topics --create --zookeeper localhost:2181 --replication-factor 2 --partitions 1 --topic redundantTopic</strong></span></pre><p id="b0a9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">输出如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="1974" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">Created topic redundantTopic</strong></span></pre><p id="ad57" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，调用带有<code class="fe kx ky kz la b">--describe</code>参数的<code class="fe kx ky kz la b">kafka-topics</code>命令来检查主题细节，如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="69a2" class="lj lk it la b gy ll lm l ln lo"><strong class="la iu">&gt; &lt;confluent-path&gt;/bin/kafka-topics --describe --zookeeper localhost:2181 --topic redundantTopic</strong></span><span id="3999" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">Topic:redundantTopic PartitionCount:1 ReplicationFactor:2 Configs:</strong></span><span id="1852" class="lj lk it la b gy lp lm l ln lo"><strong class="la iu">Topic: redundantTopic Partition: 0 Leader: 1 Replicas: 1,2 Isr: 1,2</strong></span></pre><p id="0bc5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">可以看到，<code class="fe kx ky kz la b">Replicas</code>和<code class="fe kx ky kz la b">Isr</code>是同一个列表；我们推断所有节点都是同步的。</p><p id="9b64" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">轮到您了:使用<code class="fe kx ky kz la b">kafka-topics</code>命令，尝试在死去的代理上创建复制的主题，并查看输出。此外，创建关于运行服务器的主题，然后杀死它们以查看结果。输出是您期望的吗？</p><p id="6187" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所有这些通过命令行执行的命令都可以通过编程方式执行，或者通过合流控制中心web控制台执行。</p><p id="e6b8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="kv">如果您觉得这篇文章很有趣，可以探索一下</em> <a class="ae kw" href="https://www.amazon.com/Apache-Kafka-Quick-Start-Guide/dp/1788997824?utm_source=itnext&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="kv"> Apache Kafka快速入门指南</em> </a> <em class="kv">使用最新的Apache Kafka 2.0构建高性能、健壮的数据流处理管道的同时，实时处理大量数据。</em> <a class="ae kw" href="https://www.packtpub.com/big-data-and-business-intelligence/apache-kafka-quick-start-guide?utm_source=itnext&amp;utm_medium=referral&amp;utm_campaign=ThirdPartyPromotions" rel="noopener ugc nofollow" target="_blank"> <em class="kv"> Apache Kafka快速入门指南</em> </a> <em class="kv">将帮助您学习如何使用Apache Kafka高效处理分布式应用程序，并熟悉解决快速数据和处理管道中的日常问题。</em></p></div></div>    
</body>
</html>