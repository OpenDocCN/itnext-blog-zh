<html>
<head>
<title>AWS IoT Core for LoRaWAN, AWS IoT Analytics, and Amazon QuickSight</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适用于LoRaWAN、AWS物联网分析和Amazon QuickSight的AWS物联网核心</h1>
<blockquote>原文：<a href="https://itnext.io/aws-iot-core-for-lorawan-amazon-iot-analytics-and-amazon-quicksight-8387a73d056a?source=collection_archive---------3-----------------------#2021-04-14">https://itnext.io/aws-iot-core-for-lorawan-amazon-iot-analytics-and-amazon-quicksight-8387a73d056a?source=collection_archive---------3-----------------------#2021-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7876" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用最近发布的面向LoRaWAN的AWS物联网核心，通过LoRaWAN网关和设备监控室内空气质量</h2></div><p id="217f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下面的帖子中，我们将学习如何使用私有的LoRaWAN传感器设备网络监测室内空气质量(IAQ)。这些设备使用新发布的AWS物联网核心LoRaWAN服务，通过LoRaWAN网关向AWS传输其传感器遥测数据。然后，我们将使用AWS物联网分析和亚马逊QuickSight来分析和可视化传感器数据。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e92f7f8ed1e9581249046d8cda41af3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_YbkXa50yxkX7jHDYm1ug.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">显示IAQ传感器数据的亚马逊QuickSight仪表盘</figcaption></figure><h1 id="b653" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">介绍</h1><p id="a84d" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">2020年12月15日，AWS <a class="ae mr" href="https://aws.amazon.com/about-aws/whats-new/2020/12/introducing-aws-iot-core-lorawan/" rel="noopener ugc nofollow" target="_blank">宣布</a>支持Semtech的低功耗、远程广域网(LoRaWAN)连接。LoRaWAN设备和网关现在可以使用<a class="ae mr" href="https://aws.amazon.com/iot-core/lorawan/" rel="noopener ugc nofollow" target="_blank">用于LoRaWAN的AWS物联网核心</a>连接到AWS物联网核心。AWS IoT Core for LoRaWAN是一项完全托管的功能，支持客户将使用LoRaWAN协议的无线设备与AWS云连接起来。使用AWS物联网核心，客户现在可以通过<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-security.html#connect-iot-lorawan-security-devices" rel="noopener ugc nofollow" target="_blank">安全地</a>将他们的LoRaWAN设备和网关连接到AWS云来建立私有的LoRaWAN网络——而无需开发或操作<a class="ae mr" href="https://lora-alliance.org/lora_products/lorawan-network-server/" rel="noopener ugc nofollow" target="_blank"> LoRaWAN网络服务器</a> (LNS)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9d60fca73e9dfe8e9a516812bf3c2312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EizVG2LYXArfGK7GiA_FaA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">LoRaWAN网站的AWS物联网核心</figcaption></figure><p id="7d90" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae mr" href="https://lora-alliance.org/about-lorawan/" rel="noopener ugc nofollow" target="_blank"> LoRa联盟</a>将LoRaWAN规范描述为一种低功耗、广域(LPWA)网络协议，旨在将电池供电的“东西”无线连接到地区、国家或全球网络中的互联网，并以双向通信、端到端安全性、移动性和本地化服务等关键物联网(IoT)需求为目标。LoRaWAN规范定义了设备到基础设施(LoRa)物理层参数和(LoRaWAN)协议，提供了制造商之间的无缝互操作性。</p><p id="6e46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据<a class="ae mr" href="https://en.wikipedia.org/wiki/LoRa" rel="noopener ugc nofollow" target="_blank">维基百科</a>，LoRa(远程)是一种专有的低功耗广域网调制技术。它基于从线性调频扩频(CSS)技术衍生而来的扩频调制技术。由法国格勒诺布尔的Cycleo公司开发，被LoRa联盟的创始成员Semtech公司收购，并获得专利。</p><h2 id="6c93" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">AWS认证的硬件</h2><p id="b8ce" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">随着AWS物联网核心for LoRaWAN的发布，AWS发布了在<a class="ae mr" href="https://devices.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"> AWS合作伙伴设备目录</a>中找到的合格网关列表。该目录帮助客户发现与AWS服务配合使用的合格硬件，以帮助构建和交付成功的物联网解决方案。面向LoRaWAN的AWS物联网核心支持名为<a class="ae mr" href="https://lora-developers.semtech.com/resources/tools/lora-basics/lora-basics-for-gateways/" rel="noopener ugc nofollow" target="_blank"> LoRa Basics Station </a>的开源网关-LNS协议软件，这是一个LoRa数据包转发器的实现。AWS物联网核心LoRaWAN网关认证计划使客户能够采购符合所需LoRa基础站规范的预测试LoRaWAN网关和开发人员套件。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/70d9abb080169e7ce3884bb1e8064074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KW8ty7W_pAFsX9BEE-XP3g.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">AWS合作伙伴设备目录</figcaption></figure><h2 id="8cfc" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">洛拉万网关</h2><p id="0ba5" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在这篇文章中，我们将使用布劳万通信公司生产的符合AWS标准的LoRaWAN兼容<a class="ae mr" href="https://devices.amazonaws.com/detail/a3G0h000007dlLPEAY/MiniHub-Pro" rel="noopener ugc nofollow" target="_blank"> MiniHub Pro </a>网关。售价109美元的MiniHub Pro是一款低成本网关，它使用<a class="ae mr" href="https://doc.sm.tc/station/" rel="noopener ugc nofollow" target="_blank"> LoRa Basics Station </a>将从LoRaWAN设备(上行链路)接收的RF数据包转发到LoRaWAN网络服务器(LNS)，这是LoRaWAN服务的AWS物联网核心的一部分。MiniHub Pro基于微控制器的实时操作系统<a class="ae mr" href="https://www.freertos.org/" rel="noopener ugc nofollow" target="_blank"> FreeRTOS </a>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9a9cec8d69e6c33d7272ccec568ebfd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CIfLd52ytc9o71fhCinyCw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">符合AWS标准、符合LoRaWAN标准的MiniHub Pro网关</figcaption></figure><h2 id="64e9" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">劳拉旺设备公司</h2><p id="df6f" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">除了网关之外，我们还将使用一套两个型号为TBHV110 915 Mhz <a class="ae mr" href="https://www.browan.com/product/healthy-home-sensor-iaq/detail" rel="noopener ugc nofollow" target="_blank">的健康家庭传感器IAQ </a> ( <em class="ne">又名Tabs Healthy Home </em>)，也是由Browan Communications Inc .制造的。根据Browan的说法，健康家庭传感器利用LoRaWAN连接(<a class="ae mr" href="https://lora-alliance.org/resource_hub/lorawan-specification-v1-0-3/" rel="noopener ugc nofollow" target="_blank"> LoRaWAN 1.0.3 </a>)来传递周围环境的温度、相对湿度、挥发性有机化合物(VOC)水平和室内空气质量(IAQ)。健康家庭传感器每个传感器的价格是60美元。这篇文章中使用的网关和两个设备是从<a class="ae mr" href="https://www.calchipconnect.com/" rel="noopener ugc nofollow" target="_blank">Cal-Chip Connected Devices</a>购买的，总零售成本为229美元，外加税和运费。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9b4b261281d2e23d3748307e1e937301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehYR7-SUrwXSD6NP-I93Ig.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">Cal-Chip Connected Devices提供的健康家庭传感器IAQ</figcaption></figure><h2 id="db3b" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">IAQ指数</h2><p id="32cf" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">健康家庭传感器确定IAQ指数，读数在0-500之间，表示一般空气质量。根据美国疾病预防控制中心的说法，监测和保持良好的室内空气质量和适当的通风对减少新冠肺炎潜在的空气传播至关重要。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nf"><img src="../Images/bc108d4a907312bcd5318142234a94f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txaLRO1OYJpt99JOBYnU2w.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">图表由布朗健康家庭传感器(IAQ)参考指南提供</figcaption></figure><h1 id="d2d8" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">源代码</h1><p id="6165" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">这篇文章的源代码可以在<a class="ae mr" href="https://github.com/garystafford/lorawan-iot-core-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。使用下面的命令来<code class="fe ng nh ni nj b">git clone</code>项目的本地副本。</p><pre class="lf lg lh li gt nk nj nl nm aw nn bi"><span id="29a7" class="ms lv it nj b gy no np l nq nr">git clone --branch main --single-branch --depth 1 \<br/>    <a class="ae mr" href="https://github.com/garystafford/lorawan-iot-core-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/garystafford/lorawan-iot-core-demo.git</a></span></pre><p id="bc16" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Lambda函数及其相关的AWS资源使用<a class="ae mr" href="https://aws.amazon.com/serverless/sam/" rel="noopener ugc nofollow" target="_blank"> AWS无服务器应用程序模型</a> (SAM)进行部署。本演示中使用的主要AWS资源显示在下面的体系结构图中。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ns"><img src="../Images/300abf730fee1dac75904861cd379f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZLzsMV_35YylEfqH2IQpQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">这篇文章演示的架构</figcaption></figure><h1 id="f41d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">添加网关和设备</h1><p id="863a" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">结合制造商的产品手册，<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan.html" rel="noopener ugc nofollow" target="_blank"> AWS文档</a>将指导您使用AWS物联网核心为LoRaWAN添加LoRaWAN网关和设备。在AWS上添加网关和设备是简单明了的，只要您有制造商或零售商提供的适当的GatewayEUI、DevEUI、AppEUI(又名JoinEUI)和AppKey。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3e597809f112ec97b477b973925f7ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8zoqPW8leFeCDoABa-uJjQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为LoRaWAN向AWS物联网核心添加LoRaWAN设备</figcaption></figure><h2 id="e311" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">空中激活(OTAA)</h2><p id="4727" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在这篇文章中，网关和传感器设备使用<a class="ae mr" href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/#otaa" rel="noopener ugc nofollow" target="_blank">无线激活</a> (OTAA)连接到LoRaWAN的AWS物联网核心。根据<a class="ae mr" href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/#why-is-otaa-better-than-abp" rel="noopener ugc nofollow" target="_blank">物联网</a>和<a class="ae mr" href="https://iotwireless.workshop.aws/300_device/050_key_concepts/170_activation.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>，OTAA优于<a class="ae mr" href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/#abp" rel="noopener ugc nofollow" target="_blank">个性化激活</a> (ABP)，因为它更安全。使用OTAA时，临时会话密钥是在每次激活时从根密钥中派生出来的。ABP使用静态密钥，不太安全，如果用例没有明确要求，就不应该使用。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e9cdeb14b4d67e0ea342fe52619bb6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XXRfS9jF4vlRHmwVAwCVyQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为LoRaWAN向AWS物联网核心添加LoRaWAN网关</figcaption></figure><p id="0f4e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">LoRaWAN网关被添加到LoRaWAN的AWS物联网核心。然后，使用从物联网核心接收的信息在本地配置网关。使用MiniHub Pro，您可以启用<a class="ae mr" href="https://docs.aws.amazon.com/freertos/latest/userguide/freertos-ota-dev.html" rel="noopener ugc nofollow" target="_blank"> FreeRTOS空中更新</a>和<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-to-iot.html#iot-lorawan-endpoint-intro" rel="noopener ugc nofollow" target="_blank">配置和更新服务器</a> (CUPS)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/05e9b169062b5fe660d9fb430cd56d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fl7MtnhIOvKE3F0n6ke-Vg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为无线(OTA)更新配置MiniHub Pro网关</figcaption></figure><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e238136b583eda0d7605277c9a2c3ce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uQYZaD9sAQhkUUag0Z_1A.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为配置和更新服务器(CUPS)配置MiniHub Pro网关</figcaption></figure><p id="ed3c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下面，我们看到MiniHub Pro网关已成功添加到物联网核心，并通过该连接与作为LoRaWAN网络服务器(LNS)的LoRaWAN的AWS物联网核心交换了上行链路帧(RF数据包)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/39a5eaad888d48157355f09e0b8a23b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9PuG1_kk4ajjaO0LfKmwQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为LoRaWAN的AWS物联网核心添加了MiniHub Pro网关</figcaption></figure><p id="06dd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们以类似的方式添加两个健康的家庭传感器设备。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3e597809f112ec97b477b973925f7ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8zoqPW8leFeCDoABa-uJjQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">为LoRaWAN向AWS物联网核心添加LoRaWAN设备</figcaption></figure><p id="8b04" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面，我们看到两个健康家庭传感器设备中的一个已经成功连接到LoRaWAN的AWS物联网核心，并且还通过MiniHub Pro网关传输了上行链路帧。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/9d285a7a3572fbc85644a3a7c220e6d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8dE1OXKXMMkqN6NSrZzEQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">健康家庭传感器加入AWS物联网核心</figcaption></figure><h1 id="d3ca" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">物联网目的地</h1><p id="167b" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">从网关接收来自设备的消息，并使用目的地将其路由到物联网规则。根据<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-create-destinations.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>的说法，目的地描述了处理来自无线设备的数据的AWS物联网规则，以便AWS物联网服务可以使用这些数据。许多设备可以共享一个目的地。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/bb96de964a2941bc97d9af75b58234c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*14CV83jXYZXSTfs8nJeCSg.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">AWS物联网核心无线连接目的地将设备连接到物联网规则</figcaption></figure><h1 id="b1eb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">物联网规则</h1><p id="ce26" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">根据<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan-destination-rules.html" rel="noopener ugc nofollow" target="_blank"> AWS </a>的说法，物联网规则告诉AWS物联网在收到来自你的设备的消息时该做什么。规则从消息中提取数据，使用消息数据评估表达式，并在满足规则条件时调用一个或多个操作。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/76435aaeb4d2b957dd2a0a5b72be49ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3rA3iVfWVMIYkKhK3STNw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">物联网规则，转换base64编码的二进制设备消息，并将其传递给物联网分析</figcaption></figure><p id="b842" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用AWS IoT Core for LoRaWAN，设备的消息是base64编码的二进制消息。IoT规则的查询语句是一个SQL语句，用于确定将哪些消息转发给操作。在LoRaWAN的例子中，查询语句包含对AWS Lambda函数的内联调用。该函数接受许多输入参数。它对base64编码的消息进行解码，对二进制消息进行解码和翻译，并用结果构建一个Python字典。最后，字典被序列化为JSON并返回给IoT规则。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">物联网规则查询语句</figcaption></figure><h2 id="cac4" class="ms lv it bd lw mt mu dn ma mv mw dp me kr mx my mg kv mz na mi kz nb nc mk nd bi translated">健康家庭传感器信息</h2><p id="3c03" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">LoRa在北美使用915 MHz的免执照亚千兆赫无线电频率。健康家庭传感器设备使用LoRaWAN 1.0.3规范通过该无线电频率传输二进制消息。健康家庭传感器设备向MiniHub Pro网关发送的二进制消息的有效载荷长度为11个字节，如下所示:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nv"><img src="../Images/b565b33e2fdbf207985b5c463ad1da0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPUeqIkGyCCccwIuCUex4w.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">图表由布朗健康家庭传感器(IAQ)参考指南提供</figcaption></figure><p id="b786" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在传输之前，设备使用<a class="ae mr" href="https://cryptobook.nakov.com/symmetric-key-ciphers/cipher-block-modes#ctr-counter-block-mode" rel="noopener ugc nofollow" target="_blank"> AES128 CTR模式</a>对包含传感器数据的二进制消息进行加密。LoRaWAN的AWS物联网核心解密二进制消息，然后将解密的二进制消息有效负载编码为base64字符串。</p><p id="ebd4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">AWS IoT Core为LoRaWAN提供的最终JSON格式消息IoT规则包含设备的base64编码二进制消息(PayloadData)，以及有关源LoRaWAN设备和传输消息的LoRaWAN网关的附加信息。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="b85c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">IoT规则的查询语句调用Lambda函数来解码和转换base64编码的二进制消息。Lambda调用正确的解码器，该解码器包含解码二进制消息的每个字节的逻辑。AWS开发了物联网规则解码器<a class="ae mr" href="https://github.com/aws-samples/aws-iot-core-lorawan/blob/main/transform_binary_payload/src-iotrule-transformation/app.py" rel="noopener ugc nofollow" target="_blank">λ</a>以及<a class="ae mr" href="https://github.com/aws-samples/aws-iot-core-lorawan/tree/main/transform_binary_payload/src-payload-decoders/python" rel="noopener ugc nofollow" target="_blank">几个二进制消息有效载荷解码器</a>，可在<a class="ae mr" href="https://github.com/aws-samples/aws-iot-core-lorawan/tree/main/transform_binary_payload" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上免费获得，包括:</p><ul class=""><li id="0a86" class="nw nx it kk b kl km ko kp kr ny kv nz kz oa ld ob oc od oe bi translated">浏览器标签对象定位器</li><li id="4ad6" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">德拉吉诺LHT65，LGT92，LSE01，LBT1，LDS01</li><li id="5994" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">公理W1</li><li id="001c" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">埃尔西斯</li><li id="e877" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">全球卫星LT-100</li><li id="5085" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated">NAS脉冲读取器UM3080</li></ul><p id="c000" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于ASW没有在提供的解码器列表中包括Browan Healthy Home传感器设备，因此我使用设备的<a class="ae mr" href="https://lora-alliance.org/wp-content/uploads/2020/05/RM_IAQ-Sensor_20200205_v2_with-downlink.pdf" rel="noopener ugc nofollow" target="_blank">产品手册</a>中详述的消息有效载荷信息创建了一个新的基于Python的解码器。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="7555" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解码器首先解码base64编码的二进制消息有效负载。</p><pre class="lf lg lh li gt nk nj nl nm aw nn bi"><span id="f5fc" class="ms lv it nj b gy no np l nq nr"># base64 encoded binary message<br/>AAs0LNsCAQB/ADM=<br/><br/># base64 decoded 11-byte binary message<br/>00000000 00001011 00110100 00101100 11011011 00000010 00000001 00000000 01111111 00000000 00110011</span><span id="89aa" class="ms lv it nj b gy ok np l nq nr"># as hexadecimal<br/>00 0b 34 2c db 02 01 00 7f 00 33</span><span id="52ac" class="ms lv it nj b gy ok np l nq nr"># as decimal<br/>0 11 52 44 219 2 1 0 127 0 51</span></pre><p id="a18e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，解码器逐位处理二进制消息有效载荷的每个字节，并应用任何附加逻辑来导出最终传感器值。解码base64编码的二进制消息有效负载，并将其放回原始消息中，我们得到以下消息结构:</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="3e3a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">物联网规则操作</h1><p id="1a66" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">由规则查询返回并由Lambda函数处理的消息被传递给一个<a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-rule-actions.html" rel="noopener ugc nofollow" target="_blank"> AWS IoT规则动作</a>。AWS IoT规则操作指定触发规则时要执行的操作。此规则的操作向AWS IoT分析渠道发送消息。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/7dd02291d3c72c3fc7768d034522a8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CEuBkLEeC2kECawkWvj3iQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">AWS物联网规则查询语句和物联网分析操作</figcaption></figure><h1 id="3eea" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">AWS物联网分析</h1><p id="8999" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">根据<a class="ae mr" href="https://aws.amazon.com/iot-analytics/" rel="noopener ugc nofollow" target="_blank"> AWS </a>的说法，物联网分析是一种完全托管的服务，可以轻松运行和操作海量物联网数据的复杂分析。物联网分析由五个主要组件组成:渠道、管道、数据存储、数据集和笔记本。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/0ad0145cd9049bc1de7014e4b85603cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbuSUJ472eyF4m7u6PVCWQ.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">AWS物联网分析管理控制台</figcaption></figure><p id="f5f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">物联网规则向物联网分析<a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/create-channel.html" rel="noopener ugc nofollow" target="_blank">频道</a>发送消息。通道将数据发布到<a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/create-pipeline.html" rel="noopener ugc nofollow" target="_blank">管道</a>。管道消耗来自通道的消息，并使您能够在将消息存储到<a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/create-data-store.html" rel="noopener ugc nofollow" target="_blank">数据存储</a>之前对其进行处理和过滤。数据存储接收并存储消息。通过创建SQL <a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/create-dataset.html" rel="noopener ugc nofollow" target="_blank">数据集</a>或容器数据集，可以从数据存储中检索数据。SQL数据集包含针对数据存储执行的SQL查询。根据<a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/sql-support.html" rel="noopener ugc nofollow" target="_blank">文档</a>，亚马逊Athena和亚马逊物联网分析的SQL表达式都是基于PrestoDB的。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/1c27e069ef73f78fa19a4d63722ff408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VXHVXgYVVv2hZPWdR4c-Ug.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">AWS物联网分析数据集</figcaption></figure><p id="a7c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我编写的SQL查询是针对健康家庭传感器设备收集的数据的。在Amazon QuickSight中，我们将使用这个数据集来构建一个IAQ监控仪表板。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="9dc2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">亚马逊QuickSight</h1><p id="c274" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">据<a class="ae mr" href="https://aws.amazon.com/quicksight/" rel="noopener ugc nofollow" target="_blank"> AWS </a>称，亚马逊QuickSight是一个可扩展的、无服务器的、可嵌入的、基于机器学习的商业智能(BI)服务，专为云构建。QuickSight可让您轻松创建和发布交互式BI仪表盘，其中包含基于机器学习的见解。AWS物联网分析提供<a class="ae mr" href="https://docs.aws.amazon.com/iotanalytics/latest/userguide/data-visualization.html#visualization-quicksight" rel="noopener ugc nofollow" target="_blank">与亚马逊quick sight</a>的直接集成。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/0a29ac8b36f430b952e5c97b33d99c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1gGUrf5lzLSC4x3EgCmXA.png"/></div></div></figure><p id="8136" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用“AWS物联网分析”数据源，我们可以通过导入在上一步中构建的物联网分析数据集来构建QuickSight数据集。在QuickSight中，我们可以预览数据、更改字段类型、应用过滤器、添加计算字段(如<code class="fe ng nh ni nj b">sensor_location</code>)以及根据需要排除字段。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/660a024e400d5b76dc9efd29e2c44fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mo42vtmxDlocISYTmy81dQ.png"/></div></div></figure><p id="ec6b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，最终数据被保存(<em class="ne">缓存</em>)在<a class="ae mr" href="https://docs.aws.amazon.com/quicksight/latest/user/spice.html" rel="noopener ugc nofollow" target="_blank"> SPICE </a>中，这是QuickSight的超快速并行内存计算引擎。</p><figure class="lf lg lh li gt lj"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">用于分析的最终数据</figcaption></figure><p id="f436" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用这个数据集，我们可以构建一个快速分析。该分析将使用各种视觉类型来显示传感器数据，如温度、相对湿度、挥发性有机化合物(VOC)水平、室内空气质量(IAQ)、传感器设备的电池电量，以及网关的SNR(信噪比)和RSSI(接收信号强度指示)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3cc6ba4fdb93899d0da545f41d0ec83b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*He4Q5uvQSNKDlzQubq56jw.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">使用物联网分析IAQ数据集构建亚马逊QuickSight分析</figcaption></figure><p id="cba8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们可以安全地与数据消费者共享我们构建的分析，作为QuickSight <a class="ae mr" href="https://docs.aws.amazon.com/quicksight/latest/user/working-with-dashboards.html" rel="noopener ugc nofollow" target="_blank">仪表盘</a>，可通过网络浏览器或使用<a class="ae mr" href="https://docs.aws.amazon.com/quicksight/latest/user/using-quicksight-mobile.html" rel="noopener ugc nofollow" target="_blank">亚马逊QuickSight移动应用</a>访问。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/e92f7f8ed1e9581249046d8cda41af3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_YbkXa50yxkX7jHDYm1ug.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk translated">显示IAQ传感器数据的亚马逊QuickSight仪表盘</figcaption></figure><p id="dc7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面，我们将看到QuickSight如何在一天内可视化多个传感器位置的室内空气质量数据。在此视图中，传感器数据以五分钟为增量进行捕获和显示。视觉包含指示好的和坏的IAQ阈值的参考线。通过分析结果，我们可以快速了解外部和内部环境条件、HVAC系统、空气过滤装置、通过门窗的外部通风以及人类活动如何影响住宅不同区域一天中的IAQ。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/45f8bfd6245cbfeeba51c1ac79906c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8D1yxjXGrd6IPm8aSjoP6w.png"/></div></div></figure><h1 id="984b" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="1496" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在这篇文章中，我们了解到使用新发布的AWS IoT Core for LoRaWAN service，从LoRaWAN设备和网关激活、配置和开始收集传感器遥测数据是多么容易。我们观察到AWS物联网核心、物联网分析和亚马逊QuickSight的无缝集成，以转换、存储和可视化传感器数据。扩展此示例以添加基于传感器数据的通知和自动补救，对于<a class="ae mr" href="https://aws.amazon.com/iot-events/" rel="noopener ugc nofollow" target="_blank"> AWS物联网事件</a>等服务来说同样简单。</p><h1 id="ea64" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">参考</h1><ul class=""><li id="3e43" class="nw nx it kk b kl mm ko mn kr ol kv om kz on ld ob oc od oe bi translated"><a class="ae mr" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan.html" rel="noopener ugc nofollow" target="_blank">劳拉旺的AWS物联网核心文档</a></li><li id="891d" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae mr" href="https://iotwireless.workshop.aws/" rel="noopener ugc nofollow" target="_blank">劳拉旺车间AWS物联网核心</a> ( <em class="ne">强烈推荐！</em>)</li><li id="4d7f" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae mr" href="https://lora-developers.semtech.com/" rel="noopener ugc nofollow" target="_blank"> Semtech的LoRa开发者门户</a></li><li id="ed7f" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae mr" href="https://lora-developers.semtech.com/resources/tools/lora-basics/lora-basics-for-gateways/" rel="noopener ugc nofollow" target="_blank"> LoRa基础站2.0.5文件</a></li><li id="410d" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae mr" href="https://lora-alliance.org/wp-content/uploads/2020/05/RM_IAQ-Sensor_20200205_v2_with-downlink.pdf" rel="noopener ugc nofollow" target="_blank">布朗健康家庭传感器(IAQ)参考手册</a></li><li id="0530" class="nw nx it kk b kl of ko og kr oh kv oi kz oj ld ob oc od oe bi translated"><a class="ae mr" href="https://www.browan.com/download/xvX/stream" rel="noopener ugc nofollow" target="_blank"> Browan AWS MiniHub Pro入门指南</a></li></ul></div><div class="ab cl oo op hx oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="im in io ip iq"><p id="5d09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本博客代表我自己的观点，不代表我的雇主亚马逊网络服务公司(AWS)的观点。所有产品名称、徽标和品牌都是其各自所有者的财产。</p></div></div>    
</body>
</html>