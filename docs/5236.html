<html>
<head>
<title>Why does markdown need to be sanitized? And how to do it in Vue?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么markdown需要清理？以及如何在Vue中做到？</h1>
<blockquote>原文：<a href="https://itnext.io/why-does-markdown-need-to-be-sanitized-and-how-to-do-it-in-vue-390d70cf9574?source=collection_archive---------5-----------------------#2021-01-18">https://itnext.io/why-does-markdown-need-to-be-sanitized-and-how-to-do-it-in-vue-390d70cf9574?source=collection_archive---------5-----------------------#2021-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0a3716e6ab1e3d6ae0af817e001759f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRHCaHDJWwqgmnffqW8cIg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">封面图像</figcaption></figure><p id="903a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Marked使markdown易于使用，尤其是与Vue一起使用时。凭借快速的性能和易读的代码，Vue.js是创建markdown编辑器的明智选择。</p><p id="ed65" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有了这么多可用的库，创建一个markdown编辑器并不困难。但是你会用合适的消毒剂来消毒吗？</p><p id="b5e3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面介绍如何使用Marked和DOMPurify这样的杀毒软件，用Vue制作markdown编辑器。</p><h1 id="4f3b" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">为什么这里使用DOMPurify？</h1><p id="ed47" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">通常，降价编辑器会有一个输入框供你输入一些降价信息。这个降价输入被解析成HTML，然后显示出来。呈现这个解析的HTML可能会为跨站点脚本攻击敞开大门。</p><p id="c3ee" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">跨站点脚本(也称为XSS)是web应用程序中常见的软件漏洞。这是一种攻击，涉及恶意脚本被注入受信任的网站并在不知情的情况下执行。</p><p id="0b48" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">据<a class="ae md" href="https://en.wikipedia.org/wiki/Cross-site_scripting" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="me mf mg"><p id="a92b" class="kc kd mh ke b kf kg kh ki kj kk kl km mi ko kp kq mj ks kt ku mk kw kx ky kz ij bi translated"><em class="iq">截至2007年，在网站上执行的跨站点脚本大约占</em> <a class="ae md" href="https://en.wikipedia.org/wiki/NortonLifeLock" rel="noopener ugc nofollow" target="_blank"> <em class="iq">赛门铁克</em> </a> <em class="iq">记录的所有安全漏洞的84%。</em></p></blockquote><p id="180f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了避免在输入区域输入这样的恶意脚本并影响我们的markdown编辑器应用程序，我们需要净化解析后的HTML以确保它可以安全呈现。这就是DOMPurify的用武之地。</p><p id="5c3e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">DOMPurify是一个用于HTML、MathML和SVG的XSS杀毒软件库。它是用JavaScript编写的，可以在所有现代浏览器中运行(Safari (10+)、Opera (15+)、Internet Explorer (10+)、Edge、Firefox和Chrome，以及几乎任何使用Blink或WebKit的浏览器)。它在IE6或其他传统浏览器上也不会崩溃。</p><p id="22b0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在给DOMPurify解析过的HTML之后，它将返回一个带有干净HTML的字符串。在标记的文档中提到的消毒剂中，DOMPurify是推荐的选择。</p><h1 id="dd7f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">制作编辑器</h1><p id="0de9" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我们的目标是制作一个简单的可运行的markdown编辑器。我已经把所有东西都放在了<code class="fe ml mm mn mo b">App.vue</code>文件中，并且没有创建任何单独的组件。所以让我们开始吧。</p><p id="956e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的降价编辑需要一个输入:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/a8cde196377de3a6cd489f52bedd2a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6kXxEfTKM9oQKKr8"/></div></div></figure><p id="22a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来是一个显示降价的div:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/a2dd365e381d8db0ceb30cff2b49b883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*76ToAlL54AJHTdBV"/></div></div></figure><p id="c898" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以设置文本区域的样式并使其变大，而不是每次都手动增加其尺寸，以便更容易查看正在键入的内容。我会在使用Marked和DOMPurify之后再做。</p><p id="20a4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们在用DOMPurify净化之前将输入传递给Marked。</p><h1 id="719a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">解析降价输入</h1><p id="8415" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">来自输入的值需要传递给Marked。但是首先，我们需要来自textarea的值:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/5f9d8596e50efc637b3a877f4086b623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vRaJ9SiyM3PeweKp"/></div></div></figure><p id="1f8e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将确保我们在文本区域中输入的任何内容都显示在<code class="fe ml mm mn mo b">input</code>数据属性中。</p><p id="d48f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，我们所要做的就是从一个计算属性返回解析后的markdown来显示它:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/628fb9516375870d5b2151600b56639d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K42Rp_Lsb5FuJecR"/></div></div></figure><p id="dc4c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这里，使用计算的属性，我们返回解析的markdown(基本上是一个HTML字符串),并使用<code class="fe ml mm mn mo b">v-html</code>指令在div中呈现它。</p><h1 id="1bb9" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用DOMPurify消毒</h1><p id="7ffe" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">尽管DOMPurify很强大，但我们不需要任何复杂的东西。要整理解析后的HTML，导入库并使用<code class="fe ml mm mn mo b">sanitize()</code>方法:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/5bfb1be306524463c22666706f85bc08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VCCfH_sQ9roeustA"/></div></div></figure><p id="5ba9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于我们使用的是计算属性，每次<code class="fe ml mm mn mo b">input</code>数据属性更新时，<code class="fe ml mm mn mo b">markdownResult()</code>也会再次执行。我们将markdown输入传递给Marked，后者将其解析为一个HTML字符串。然后这个字符串通过DOMPurify来确保HTML是干净的。</p><p id="377b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的降价编辑器有一个输入区。这里输入的Markdown被解析并呈现到它下面的div中。我们已经创建了一个简单的markdown编辑器。我们来设计一下。</p><h1 id="2de5" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">样式编辑器</h1><p id="1416" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我还添加了一个按钮来清除编辑器中的所有内容:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/b7c7b1620b2c075e64da092f32e617de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wQtreKl3fltSBNMO"/></div></div></figure><p id="22fd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我不会把它弄得太花哨。将编辑器和div分别放在页面的一端就可以了。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/0cec08e62f8f256ad2f5beac2e128c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xbIlUFdV69R6cshZ"/></div></div></figure><p id="0586" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你不知道— <code class="fe ml mm mn mo b">resize: none</code>会使文本区无法调整大小。</p><h1 id="6c49" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">包扎</h1><p id="7b80" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我们做了一个最小的，干净的markdown编辑器。在DOMPurify的帮助下，我们还确保了每一点markdown渲染都没有恶意脚本。尽管使用DOMPurify并不意味着您的web应用程序对于跨站点脚本攻击是完全安全的，但是这是一个开始。</p><p id="5cc9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">进一步阅读的链接:</p><ol class=""><li id="dd09" class="mx my iq ke b kf kg kj kk kn mz kr na kv nb kz nc nd ne nf bi translated"><a class="ae md" href="https://owasp.org/www-community/attacks/xss/" rel="noopener ugc nofollow" target="_blank">一篇关于跨站脚本攻击的文章</a></li><li id="0ff2" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">通过JavaScript注入HTML的危险以及如何安全地完成<a class="ae md" href="https://labs.tadigital.com/index.php/2020/04/10/safe-ways-to-inject-html-through-javascript/" rel="noopener ugc nofollow" target="_blank"/></li><li id="32c3" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated"><a class="ae md" href="https://en.wikipedia.org/wiki/Cross-site_scripting" rel="noopener ugc nofollow" target="_blank">维基百科页面</a>关于跨站点脚本</li><li id="eb16" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">DOMPurify <a class="ae md" href="https://github.com/cure53/DOMPurify" rel="noopener ugc nofollow" target="_blank"> GitHub仓库</a></li><li id="9528" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated"><a class="ae md" href="https://marked.js.org" rel="noopener ugc nofollow" target="_blank">官方文件</a>为标注</li><li id="c615" class="mx my iq ke b kf ng kj nh kn ni kr nj kv nk kz nc nd ne nf bi translated">标记为<a class="ae md" href="https://github.com/markedjs/marked" rel="noopener ugc nofollow" target="_blank">的GitHub库</a></li></ol></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="c240" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mh">原载于</em> <a class="ae md" href="https://niharraoteblog.netlify.app/vue-markdown-editor" rel="noopener ugc nofollow" target="_blank"> <em class="mh">我的博客</em> </a> <em class="mh">。</em></p></div></div>    
</body>
</html>