<html>
<head>
<title>Azure Terrafy- Azure’s best Terraform buddy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure Terrafy- Azure的最佳Terraform伙伴</h1>
<blockquote>原文：<a href="https://itnext.io/azure-terrafy-azures-best-terraform-buddy-74211194ddee?source=collection_archive---------2-----------------------#2022-05-19">https://itnext.io/azure-terrafy-azures-best-terraform-buddy-74211194ddee?source=collection_archive---------2-----------------------#2022-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bd04437e58e292dd1add6fe700b2f771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPGmUYQx6yDyQD425Zp_Vw.png"/></div></div></figure><p id="f182" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">整个DevOps世界都在向IAC (infrastructure as a code，基础设施即代码)转移，这早已是一个<strong class="ka ir">“既成事实”</strong>的事实，这意味着通过确定性代码在云中对组织中的整个环境和流程进行建模。<br/>在复杂环境下工作时，例如:</p><ul class=""><li id="9d0d" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">不均匀</li><li id="ea73" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">多工具/供应商</li><li id="82d2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">多个云提供商</li></ul><p id="8c59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种需求正在急剧增加。</p><p id="9072" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我过去作为顾问的经历中，我能够就如何进入IAC世界向组织提供建议，并帮助DevOps人员通过Terraform认证，这实际上是IAC世界的默认语言。</p><p id="c3d6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种态度上的转变在高科技世界中并不总是容易消化的，尤其是在大型组织中。<br/>现有环境(主要是遗留环境)使得对现有计算实体进行建模并将其转移到基于IAC的工作形式变得非常困难。</p><p id="1f2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同一个月(2022年5月)，Azure生态系统的一个奇妙工具被引入，它被称为——<strong class="ka ir">“Azure Terrafy”</strong> <br/>这个工具可以在教育人和建模准确性方面，解决向IAC熟练水平更平滑过渡过程中的许多问题。这个工具的功能令人印象深刻，我将在本文中向您简单介绍一下。</p><p id="52dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果是这样，我们已经写得够多了。让我们从介绍这个工具开始</p><h1 id="29b1" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">安装Terrafy</h1><p id="a325" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">安装很简单，尽管您需要安装GO语言作为先决条件。</p><p id="9024" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mn">(我将在本文中使用PowerShell，因为，你知道，微软</em>😜<em class="mn"> ) </em></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="3eb0" class="mx ll iq mt b gy my mz l na nb">PS:| go install github.com/Azure/aztfy@latest</span></pre><p id="da13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请刷新您的终端会话。</p><h1 id="9a0d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">了解一下考试的环境。</h1><p id="a617" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated"><em class="mn">值得注意的是，</em><strong class="ka ir"><em class="mn">aztfy</em></strong><em class="mn">目前只支持资源组级别的导入，但在不久的将来也会支持订阅。</em></p><p id="8429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1.当<strong class="ka ir"> <em class="mn"> aztfy </em> </strong>最终安装完成后，请运行<strong class="ka ir"> <em class="mn"> aztfy </em> </strong>命令，并指定想要导入的Azure RG(资源组)。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6876" class="mx ll iq mt b gy my mz l na nb">PS:| Aztfy<em class="mn"> &lt;RG name&gt;</em></span></pre><p id="bb0d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.一旦初始导入完成，<strong class="ka ir"> <em class="mn"> aztfy </em> </strong>将向您显示在订阅中检测到的所有资源(在我们的例子中，只有35个项目。在<strong class="ka ir">【现实世界】</strong>场景中，会比那个大很多)</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/85063e0ca98f39e79f3339b26629c4f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xvgj-TkDAqYNI3kI49Q3yQ.png"/></div></div></figure><p id="e364" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.现在，您将在一个交互式列表中看到所有的资源，您可以手动调查这些资源。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/325a5be5105fdacb93933ffbf81e4468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SuE1d1qLcuHxgDYGUeS5tg.png"/></div></div></figure><p id="ae44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.在此阶段，您可以执行以下操作:</p><blockquote class="ne nf ng"><p id="a8b0" class="jy jz mn ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">a.通过显示错误进行调试</p><p id="c49a" class="jy jz mn ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">b.查看建议或导入</p><p id="ab9d" class="jy jz mn ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">c.筛选要导入的资源</p><p id="f806" class="jy jz mn ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">d.显示依赖关系</p></blockquote><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/36476f84f840ade471ceac2ee5d5c835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1n_OWSdwDaLeTq1CnvMWdg.png"/></div></div></figure><p id="972b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.当您准备好所需的导入状态时，通过向下并输入“W”来启动最终的导入过程。<br/>(如果已经不明显，那就需要一段时间；因此，这是你延长休息时间的时间😁)</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/f73a5dfaa4619a47aaaa223d27afbf6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EPxTn8VeCFN8xNbg8EKeg.png"/></div></div></figure><p id="e6dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.还有“<strong class="ka ir">凯西·卡达布拉</strong>”你所有的资源都在Terrafrom的HCL文件中定义好了，包括<strong class="ka ir">的依赖</strong>。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/58b47fbe6e65d8b77c78ea783e0bd876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ijqXp4VuSqPoPuCkR77GRg.png"/></div></div></figure><p id="fb10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从现在开始，你的创造力就是你最好的朋友！</p><p id="4a58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">GitHub上项目资源库的链接:</p><blockquote class="ne nf ng"><p id="16c4" class="jy jz mn ka b kb kc kd ke kf kg kh ki nh kk kl km ni ko kp kq nj ks kt ku kv ij bi translated">【https://github.com/Azure/aztfy T4】</p></blockquote><h1 id="fd02" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">要考虑的事情</h1><p id="bac6" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">由于这是一个相对较新的项目，有一些东西还没有“烤好”。</p><ol class=""><li id="9538" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv no lc ld le bi translated">导入任务仅适用于资源组。</li><li id="f67b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv no lc ld le bi translated">导入任务仅导出整体结构。如果你想要一个更灵活或更抽象的设计，你将需要在它上面做更多的工作。</li><li id="2fc2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv no lc ld le bi translated">如果您计划使用状态文件，您只有一个选择，那就是将其保存在本地。试图将状态文件存储在远程位置并不简单。</li></ol></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="2699" class="lk ll iq bd lm ln nw lp lq lr nx lt lu lv ny lx ly lz nz mb mc md oa mf mg mh bi translated">Terraform AzAPI提供者Terrafy背后的机制</h1><p id="6f9f" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">AzAPI提供者是位于Azure ARM REST APIs之上的一个薄层。AzAPI提供程序使您能够使用任何API版本管理任何Azure资源类型。该提供程序通过允许管理新的Azure资源和属性(包括私有预览)来补充AzureRM提供程序。</p><h1 id="927d" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">AzAPI提供者资源</h1><p id="955b" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">为了让您无需更新即可管理所有Azure资源和功能，AzAPI提供程序包括以下通用资源:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/b5b4f06cbfd1b941072ffaf2ad776614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQLjVBj7qv70xAlmFIL6Lw.png"/></div></div></figure><p id="8a3f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有关AzAPI提供者的更多信息，请参考此处的链接<a class="ae nn" href="https://docs.microsoft.com/en-us/azure/developer/terraform/overview-azapi-provider" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>