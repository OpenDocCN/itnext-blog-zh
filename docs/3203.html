<html>
<head>
<title>Deploy Ruby on Rails to Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Ruby on Rails部署到Kubernetes</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-ruby-on-rails-to-kubernetes-b845cd3d5dae?source=collection_archive---------2-----------------------#2019-10-23">https://itnext.io/deploy-ruby-on-rails-to-kubernetes-b845cd3d5dae?source=collection_archive---------2-----------------------#2019-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="259f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes上Ruby on Rails的优化开发和部署工作流<br/></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/8c1ea4b6be200c870428b69c93df43c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qomgO9KpjcZeFE7N.png"/></div></div></figure><p id="7203" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Rails是一个强大的框架，自带电池。有一样东西不是现成的，那就是将Rails项目部署到Kubernetes的简单方法，以及在Kubernetes上迭代开发Rails项目的省时方法。</p><p id="2f2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们通过展示开发人员如何使用Kubernetes构建Rails应用程序，将DevOps推向了一个新的高度。本教程对于Kubernetes初学者来说很棒，但对于那些希望在Kubernetes上简化Rails开发和部署工作流的高级用户来说也很棒。</p><blockquote class="kx ky kz"><p id="5052" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">本教程适用于任何Kubernetes集群(minikube、Docker Kubernetes、GKE、EKS、AKS等。)但是如果您手头没有集群，您仍然可以使用DevSpace赞助的一个免费的、完全托管的Kubernetes名称空间来学习本教程。</em></p></blockquote><h1 id="a05d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1.创建Rails项目</h1><blockquote class="kx ky kz"><p id="2bf7" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated">显然，如果您已经有了一个Rails项目，并希望在本教程中使用，那么您可以跳过这一步。</p></blockquote><p id="b028" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在创建Rails项目之前，让我们用希望Rails项目所在的目录来定义一个变量:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="7789" class="mh lf iq md b gy mi mj l mk ml">PROJECT_DIR=/c/Users/[username]/rails-project # for win (git-bash)<br/>PROJECT_DIR=/home/[username]/rails-project # for mac, linux (bash)</span></pre><blockquote class="kx ky kz"><p id="715d" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">如果您使用Docker Toolbox，您的</em> <code class="fe mm mn mo md b"><em class="iq">$PROJECT_DIR</em></code> <em class="iq">需要在您用户的主目录内，例如</em> <code class="fe mm mn mo md b"><em class="iq">/c/Users/[username]</em></code> <em class="iq">。</em></p><p id="d700" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">如果您在Windows上使用较新的Docker桌面，请确保您的项目所在的驱动器在Docker设置中标记为</em> <a class="ae mp" href="https://docs.docker.com/docker-for-windows/#shared-drives" rel="noopener ugc nofollow" target="_blank"> <em class="iq">共享驱动器</em> </a> <em class="iq">。</em></p></blockquote><p id="54c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们为Rails项目的名称创建一个变量:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="58f9" class="mh lf iq md b gy mi mj l mk ml">PROJECT_NAME=app</span></pre><p id="f597" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您手头没有Rails应用程序，这段代码是利用Docker快速创建Rails项目的好方法:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="04cf" class="mh lf iq md b gy mi mj l mk ml">mkdir $PROJECT_DIR</span><span id="5d27" class="mh lf iq md b gy mq mj l mk ml">docker run --rm -v /$PROJECT_DIR:/app -w //app ruby:2.6-alpine sh -c "apk add build-base nodejs yarn tzdata sqlite-dev postgresql-client postgresql-dev &amp;&amp; gem install pg rails &amp;&amp; rails new $PROJECT_NAME --database=postgresql"</span><span id="b7b9" class="mh lf iq md b gy mq mj l mk ml">cd $PROJECT_DIR/$PROJECT_NAME</span></pre><p id="9f66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个命令可能会花费一些时间，但是如果您熟悉Ruby on Rails，您可能已经知道了。</p><blockquote class="kx ky kz"><p id="3ac0" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">正如您在代码片段中看到的，我们使用了</em> <code class="fe mm mn mo md b"><em class="iq">--database=postgresql</em></code> <em class="iq">，因为我们稍后想要添加一个PostgreSQL数据库(当然，如果您不需要，可以跳过这一步)。</em></p></blockquote><h1 id="af7f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2.集装箱化项目</h1><p id="be42" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">因此，让我们将Rails项目容器化。为了快速简单地完成这项工作，我们使用了Kubernetes的开源开发工具<a class="ae mp" href="https://github.com/devspace-cloud/devspace" rel="noopener ugc nofollow" target="_blank"> DevSpace </a>。DevSpace是一个用于容器化项目的客户端专用CLI工具，也是将应用程序交互式部署到Kubernetes的最快工具。</p><p id="37cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有针对DevSpace的Ruby gem，但是您可以通过npm轻松安装DevSpace:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="cb85" class="mh lf iq md b gy mi mj l mk ml">npm install -g devspace</span></pre><p id="008d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多安装选项，请看一下<a class="ae mp" href="https://github.com/devspace-cloud/devspace#quickstart" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p><p id="0a31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装DevSpace之后，将项目容器化是非常简单的事情。只需运行以下命令:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="81b2" class="mh lf iq md b gy mi mj l mk ml">devspace init</span></pre><p id="546b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">当DevSpace询问您应用程序正在监听哪个端口时，键入</strong> <code class="fe mm mn mo md b"><strong class="jp ir">3000</strong></code> <strong class="jp ir">并点击</strong> <code class="fe mm mn mo md b"><strong class="jp ir">Enter</strong></code> <strong class="jp ir">。剩下的问题应该很容易回答。如果你不确定，你可以点击<code class="fe mm mn mo md b">Enter</code>来选择默认选项。</strong></p><p id="9210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">初始化过程完成后，您就可以将项目部署到Kubernetes了。但是，如果您需要一个数据库，在部署项目之前添加它是明智的。</p><h2 id="fc34" class="mh lf iq bd lg mw mx dn lk my mz dp lo jy na nb ls kc nc nd lw kg ne nf ma ng bi translated">额外收获:添加Postgres数据库</h2><p id="7e8d" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">打开文件<code class="fe mm mn mo md b">devspace.yaml</code>(由<code class="fe mm mn mo md b">devspace init</code>创建)并将<code class="fe mm mn mo md b">deployments</code>部分从:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="5254" class="mh lf iq md b gy mi mj l mk ml">deployments:<br/>- name: app<br/>  helm:<br/>    componentChart: true<br/>    values:<br/>      containers:<br/>      - image: dscr.io/${DEVSPACE_USERNAME}/app<br/>      service:<br/>        ports:<br/>        - port: 3000</span></pre><p id="a5ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">收件人:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="9c3d" class="mh lf iq md b gy mi mj l mk ml">deployments:<br/>- name: database<br/>  helm:<br/>    chart:<br/>      name: stable/postgresql<br/>    values:<br/>      postgresqlDatabase: "db_app"<br/>      postgresqlUsername: "db_user"<br/>      postgresqlPassword: ${DB_PASSWORD}<br/>- name: app<br/>  helm:<br/>    componentChart: true<br/>    values:<br/>      containers:<br/>      - image: dscr.io/${DEVSPACE_USERNAME}/app<br/>        env:<br/>        - name: DATABASE_URL<br/>          value: "postgres://db_user:${DB_PASSWORD}<a class="ae mp" href="http://twitter.com/database" rel="noopener ugc nofollow" target="_blank">@database</a>-postgresql/db_app"<br/>      service:<br/>        ports:<br/>        - port: 3000</span></pre><p id="a2d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搞定了。就这样，现在您可以部署这个Ruby项目，并立即拥有一个PostgreSQL数据库供应用程序使用。</p><h1 id="c273" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">3.选择Kubernetes集群</h1><p id="4022" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">如果您没有Kubernetes集群或者想要对托管的Kubernetes名称空间使用类似Heroku的服务，请运行以下命令在DevSpace Cloud中获取一个免费的名称空间:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="3a63" class="mh lf iq md b gy mi mj l mk ml">devspace create space ruby-app</span></pre><p id="f05e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以将DevSpace Cloud视为Kubernetes的一种Heroku，但在技术堆栈、可移植性和可伸缩性方面没有限制。因此，您可以部署任何容器，并且只需一个命令就可以轻松地将您的应用程序移动到另一个Kubernetes集群。</p><blockquote class="kx ky kz"><p id="88d4" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq"> DevSpace会自动为你在DevSpace Cloud中创建的空间添加kube-context，这样你也可以使用kubectl、helm等工具。</em></p></blockquote><p id="180c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您已经有一个Kubernetes集群，那就更简单了:只需告诉DevSpace使用哪个名称空间(如果不存在，将在部署期间创建):</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="0233" class="mh lf iq md b gy mi mj l mk ml">devspace use namespace [my-namespace]</span></pre><h1 id="4f7f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">4.开发项目</h1><p id="79fe" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">在部署这个Rails项目之前，我们需要建立一个尽可能高效地开发项目的工作流。DevSpace为此工作流提供了一个命令:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="545d" class="mh lf iq md b gy mi mj l mk ml">devspace dev</span></pre><blockquote class="kx ky kz"><p id="59a3" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">第一次运行该命令时，DevSpace会要求您定义一个用于变量</em> <code class="fe mm mn mo md b">DB_PASSWORD</code>的数据库密码。</p></blockquote><p id="b71a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一次运行可能需要一段时间，但第二次会快得多。</p><p id="e0c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个命令实际上是从Docker文件构建Docker映像，标记它并将其推送到注册表。然后，DevSpace根据<code class="fe mm mn mo md b">devspace.yaml</code>的<code class="fe mm mn mo md b">deployments</code>部分部署项目，并启动开发服务(本地主机访问的端口转发、日志流和热重装的文件同步)。</p><p id="e187" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切正常，您应该能够在终端中看到Rails日志，浏览器将会打开，在<code class="fe mm mn mo md b">localhost:3000</code>上显示著名的Rails欢迎页面。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/fac2b79f1dd39ae4a0abb0dee12228c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lhCxvMUNrKrUenl9.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">Ruby on Rails欢迎页面——每个Rails开发人员最喜欢看的页面。</figcaption></figure><h2 id="a8b4" class="mh lf iq bd lg mw mx dn lk my mz dp lo jy na nb ls kc nc nd lw kg ne nf ma ng bi translated">生成索引路由</h2><p id="2199" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">既然项目已经在Kubernetes集群中运行，我们就可以开始开发实际的业务逻辑了。当然，您也可以在本地运行常见的<code class="fe mm mn mo md b">rails</code>命令，但是在本教程中，我将向您展示如何在运行容器中直接运行这些命令。</p><blockquote class="kx ky kz"><p id="eb20" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">确保</em> </strong> <code class="fe mm mn mo md b"><strong class="jp ir"><em class="iq">devspace dev</em></strong></code> <strong class="jp ir"> <em class="iq">仍在运行</em> </strong> <em class="iq">后再继续本部分教程。只需让它运行或再次启动它，并打开第二个终端来运行以下命令。</em></p></blockquote><p id="a6bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要为“Hello World”索引页生成控制器，请运行以下命令:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="f4fb" class="mh lf iq md b gy mi mj l mk ml">devspace enter -- rails generate controller Welcome index</span></pre><blockquote class="kx ky kz"><p id="3041" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">你可以看到我们正在执行一个常规的</em> <code class="fe mm mn mo md b"><em class="iq">rails</em></code> <em class="iq">命令。通过添加前缀</em> <code class="fe mm mn mo md b"><em class="iq">devspace enter --</em></code> <em class="iq">，我们告诉DevSpace在Kubernetes的容器内运行这个</em> <code class="fe mm mn mo md b"><em class="iq">rails</em></code> <em class="iq">命令，而不是在本地机器上执行它。您也可以运行容器内的任何其他</em> <code class="fe mm mn mo md b"><em class="iq">rails</em></code> <em class="iq">、</em> <code class="fe mm mn mo md b"><em class="iq">rake</em></code> <em class="iq">、</em> <code class="fe mm mn mo md b"><em class="iq">npm</em></code> <em class="iq">或</em> <code class="fe mm mn mo md b"><em class="iq">bundle</em></code> <em class="iq">命令，只需在命令前添加</em> <code class="fe mm mn mo md b"><em class="iq">devspace enter --</em></code> <em class="iq">即可。</em></p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="1fa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，像往常一样，将本地文件系统上的<code class="fe mm mn mo md b">config/routes.rb</code>从:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="7024" class="mh lf iq md b gy mi mj l mk ml">Rails.application.routes.draw do<br/>  # For details on the DSL available within this file, see <a class="ae mp" href="https://guides.rubyonrails.org/routing.html" rel="noopener ugc nofollow" target="_blank">https://guides.rubyonrails.org/routing.html</a><br/>end</span></pre><p id="b7b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">收件人:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="cada" class="mh lf iq md b gy mi mj l mk ml">Rails.application.routes.draw do<br/>  get 'welcome/index'<br/>  root 'welcome#index'<br/>  # For details on the DSL available within this file, see <a class="ae mp" href="https://guides.rubyonrails.org/routing.html" rel="noopener ugc nofollow" target="_blank">https://guides.rubyonrails.org/routing.html</a><br/>end</span></pre><blockquote class="kx ky kz"><p id="00da" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq"> DevSpace确保远程系统上的任何文件更改都会反映在本地文件系统上，反之亦然。这是迭代构建基于Kubernetes的应用程序的最快方法。</em></p></blockquote><p id="1736" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您只编辑一个文件，您可以看到这有多快。去试试吧:</p><ol class=""><li id="8c49" class="no np iq jp b jq jr ju jv jy nq kc nr kg ns kk nt nu nv nw bi translated">将“欢迎#索引”替换为“Hello World！”文件内部<code class="fe mm mn mo md b">app/views/welcome/index.html.erb</code></li><li id="de97" class="no np iq jp b jq nx ju ny jy nz kc oa kg ob kk nt nu nv nw bi translated">重新加载浏览器以查看更改，并查看从Kubernetes集群中的容器实时流出的<code class="fe mm mn mo md b">devspace dev</code>命令的日志。</li></ol><h2 id="7b74" class="mh lf iq bd lg mw mx dn lk my mz dp lo jy na nb ls kc nc nd lw kg ne nf ma ng bi translated">额外:添加帖子</h2><p id="881f" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">如果没有任何数据需要持久化，我们就不需要数据库。因此，出于本教程的目的，让我们为博客文章生成一个Rails框架:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="206e" class="mh lf iq md b gy mi mj l mk ml">devspace enter -- rails generate scaffold Post title:string body:text</span></pre><p id="d30d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建支架后，我们需要调用<code class="fe mm mn mo md b">rake</code>进行数据库迁移:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="9aaf" class="mh lf iq md b gy mi mj l mk ml">devspace enter -- rake db:migrate</span></pre><p id="bd80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！一切都已经活了:</p><ol class=""><li id="d2a6" class="no np iq jp b jq jr ju jv jy nq kc nr kg ns kk nt nu nv nw bi translated">转到此URL:<a class="ae mp" href="http://localhost:3000/posts" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/posts</a></li><li id="da7a" class="no np iq jp b jq nx ju ny jy nz kc oa kg ob kk nt nu nv nw bi translated">添加文章，看看它们是如何保存到数据库中的。</li><li id="8ef0" class="no np iq jp b jq nx ju ny jy nz kc oa kg ob kk nt nu nv nw bi translated">添加新帖子时，观察通过<code class="fe mm mn mo md b">devspace dev</code>传输的日志。</li></ol><h1 id="f1f0" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">5.部署项目</h1><p id="31da" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">如果您已经完成了教程的这一部分，那么您已经掌握了开发流程的诀窍。现在，是时候部署应用程序了。在大多数情况下，您可能希望使用<code class="fe mm mn mo md b">devspace create space myapp-prod</code>或运行<code class="fe mm mn mo md b">devspace use namespace [prod-namespace]</code>来创建另一个空间，以分离开发和生产。您可以随时使用<code class="fe mm mn mo md b">devspace use space/namespace</code>命令切换回开发工作区。</p><p id="3bb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦进入正确的kube上下文和名称空间，就可以使用以下命令部署项目:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="7028" class="mh lf iq md b gy mi mj l mk ml">devspace deploy</span></pre><p id="5435" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在访问已部署的Rails项目之前，您需要等到数据库迁移完成并且应用程序开始监听。您可以使用以下命令通过流式传输应用程序容器的日志来检查此过程的状态:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="5763" class="mh lf iq md b gy mi mj l mk ml">devspace logs -f</span></pre><p id="06dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在您看到以下日志行之后:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="a143" class="mh lf iq md b gy mi mj l mk ml">* Listening on tcp://0.0.0.0:3000</span></pre><p id="25d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用以下命令访问您部署的Rails应用程序:</p><pre class="km kn ko kp gt mc md me mf aw mg bi"><span id="bedb" class="mh lf iq md b gy mi mj l mk ml">devspace open</span></pre><p id="8fc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DevSpace可以为您启动一个私有的端口转发会话(用于类似于<code class="fe mm mn mo md b">devspace dev</code>的本地主机访问),也可以为您创建一个Kubernetes入口，使您的项目在一个域上公开可用。</p><h1 id="51db" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">下一步是什么？</h1><p id="1d55" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">就Kubernetes和Rails的更高生产率而言，还有很多值得展示的地方。这就是为什么我把这篇文章看作是博客系列的开始。如果你对下一篇文章感兴趣(很可能是关于让Rails应用程序在Kubernetes上生产就绪和(自动)可伸缩)，请订阅，我的下一篇文章一发表(可能在3-4周内)，你就会收到一封简短的电子邮件。</p><p id="92e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这对你有帮助，或者你有任何问题或想法，下一步可能会有什么有趣的博客，请通过twitter <a class="ae mp" href="https://twitter.com/LukasGentele" rel="noopener ugc nofollow" target="_blank"> @LukasGentele </a>或电子邮件:lg AT devspace.cloud联系</p><p id="5e55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">期待收到你的来信！</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><p id="958b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">最初发布于</em><a class="ae mp" href="https://devspace.cloud/blog/2019/10/21/deploy-ruby-on-rails-to-kubernetes" rel="noopener ugc nofollow" target="_blank"><em class="la">https://devspace . cloud</em></a><em class="la">。</em></p></div></div>    
</body>
</html>