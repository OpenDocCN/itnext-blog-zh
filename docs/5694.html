<html>
<head>
<title>How to Add MySql &amp; MongoDB to a Kubernetes .Net Core Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将MySql &amp; MongoDB添加到一个Kubernetes？网络核心微服务架构</h1>
<blockquote>原文：<a href="https://itnext.io/databases-in-a-kubernetes-angular-net-core-microservice-arch-a0c0ae23dca9?source=collection_archive---------1-----------------------#2021-05-04">https://itnext.io/databases-in-a-kubernetes-angular-net-core-microservice-arch-a0c0ae23dca9?source=collection_archive---------1-----------------------#2021-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5a71" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用持久卷在Docker桌面上的K8S中添加MySQL DB和MongoDB副本集，并从ASP.NET核心、C#和Angular访问数据库</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/3eb9c5ceaeb013bc096dd7ddb64ffc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*c6ick1ppNEU8obRxRRpyzw.png"/></div></figure><p id="e853" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本指南中，您将<strong class="kp ir">在基于微服务的云架构</strong>中使用数据库。它从一个<strong class="kp ir"> MySQL </strong>实例开始，继续到一个<strong class="kp ir"> MongoDB副本集</strong>和一个<strong class="kp ir">无头Kubernetes服务</strong>。两个数据库都使用<strong class="kp ir">持久卷</strong>。数据库由<strong class="kp ir">ASP.NET核心后端服务</strong>访问，并使用<strong class="kp ir"> Angular作为前端</strong>。应用程序通过<strong class="kp ir">入口控制器</strong>公开。</p><p id="4a6d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">部件概述图:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lk"><img src="../Images/51f216edf74cec41bb63080da843756f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*COp4cLADP_SzCTTW_NVEyQ.png"/></div></div></figure><h2 id="d558" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">内容</h2><ol class=""><li id="b289" class="mi mj iq kp b kq mk kt ml kw mm la mn le mo li mp mq mr ms bi translated">具有持久卷的Kubernetes中的MySQL</li><li id="b2ae" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li mp mq mr ms bi translated">Kubernetes中的MongoDB副本集作为StatefulSet</li><li id="c6f1" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li mp mq mr ms bi translated">访问ASP.NET核心REST-API服务中的数据库</li><li id="3a68" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li mp mq mr ms bi translated">从Angular调用ASP.NET核心API</li><li id="4390" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li mp mq mr ms bi translated">将Angular应用程序和ASP.NET核心服务部署到Kubernetes</li><li id="a2f5" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li mp mq mr ms bi translated">最后的想法和展望</li></ol></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="cafd" class="nf lq iq bd lr ng nh ni lu nj nk nl lx jw nm jx ma jz nn ka md kc no kd mg np bi translated">1.具有持久卷的Kubernetes中的MySQL</h1><p id="fe05" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">您将在Docker桌面上的Kubernetes中部署一个MySQL pod。服务将使其在端口3306上可访问。您将使用Kubernetes持久卷，这样MySQL数据在pod重新启动或删除后仍然存在。</p><p id="329f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">Docker桌面上Kubernetes的MySQL部署:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/030ce86b5b974470ce3cacfd35e38c85.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*GgTLlz7N2gSDIXQ8JZk3fg.png"/></div></figure><h2 id="d72e" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">准备</h2><p id="145e" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">安装<a class="ae nu" href="https://hub.docker.com/editions/community/docker-ce-desktop-windows" rel="noopener ugc nofollow" target="_blank">Docker Desktop for Windows</a>并启用Kubernetes:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nv"><img src="../Images/71296b0d54d64c7185670b55a8390438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzjJfH56yoJGrxUQru1fSA.png"/></div></div></figure><h2 id="61a2" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">创建部署</h2><p id="03ec" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建文件mysql.yaml:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="956c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">应用yaml: </strong></p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="7b85" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl apply -f mysql.yaml</span></pre><h2 id="8661" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">(可选)使用一个临时MySQL客户端容器来访问和测试MySQL部署</h2><p id="3342" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建容器并连接到MySQL数据库服务器(在一行中输入命令):</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="dcc5" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl run -it — rm — image=mysql:5.6 — restart=Never mysql-client — mysql -h mysql -ppassword</span></pre><p id="b9ea" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建新数据库:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="39eb" class="lp lq iq nz b gy od oe l of og">mysql&gt;create database testdb;</span></pre><p id="08ca" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以删除MySQL pod:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="0f19" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl delete pod -l app=mysql</span></pre><p id="65af" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Kubernetes会自动重建豆荚。持久卷保证sql数据在删除和重新创建pod后仍然存在。</p><blockquote class="oh oi oj"><p id="a9c5" class="kn ko lj kp b kq kr jr ks kt ku ju kv ok kx ky kz ol lb lc ld om lf lg lh li ij bi translated">您必须保护您的MySQL配置，以便在生产环境中使用它。使用Kubernetes的秘密等。</p></blockquote><p id="1985" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> <em class="lj">延伸阅读官方Kubernetes文档中的</em></strong><em class="lj">:</em><a class="ae nu" href="https://kubernetes.io/docs/tasks/run-application/run-single-instance-stateful-application/" rel="noopener ugc nofollow" target="_blank"><em class="lj">运行单实例有状态应用</em> </a> (MySQL)</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="441f" class="nf lq iq bd lr ng nh ni lu nj nk nl lx jw nm jx ma jz nn ka md kc no kd mg np bi translated">2.Kubernetes中的MongoDB副本集作为StatefulSet</h1><p id="fea3" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">您将使用StatefulSet向Kubernetes部署两个MongoDB pods。每个pod都使用自己的持久存储。然后将这两个实例配置为一个MongoDB副本集。</p><p id="3fb8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">无头服务使实例可以在端口27017和确定性名称“mongod-0.mongodb-service”和“mongod-1.mongodb-service”上访问:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi on"><img src="../Images/64054724341f146f682722ce1cd20a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RJCBex0WtVOhkpIxwQ7mlg.png"/></div></div></figure><h2 id="570e" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">创建状态集</h2><p id="e97f" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建文件mongodb.yaml:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="0a74" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">应用yaml:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="e803" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl apply -f mongodb.yaml</span></pre><h2 id="4d96" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">配置MongoDB副本集</h2><blockquote class="oh oi oj"><p id="2c2a" class="kn ko lj kp b kq kr jr ks kt ku ju kv ok kx ky kz ol lb lc ld om lf lg lh li ij bi translated">您将手动配置副本集。参见本文，了解如何使用sidecar容器进行自动配置:<a class="ae nu" href="https://kubernetes.io/blog/2017/01/running-mongodb-on-kubernetes-with-statefulsets/" rel="noopener ugc nofollow" target="_blank">在Kubernetes上运行MongoDB，使用StatefulSets </a></p></blockquote><p id="d429" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">连接到mongod-0 pod:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="222a" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl exec -it mongod-0 -c mongod-container bash</span></pre><p id="b7bd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">启动mongo客户端:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="c231" class="lp lq iq nz b gy od oe l of og">root@mongod-0:/# mongo</span></pre><p id="3f64" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">配置副本集(在一行中输入命令):</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="3773" class="lp lq iq nz b gy od oe l of og">MainRepSet:PRIMARY&gt; rs.initiate({ _id: “MainRepSet”, version: 1, members: [{ _id: 0, host: “mongod-0.mongodb-service.default.svc.cluster.local:27017” }, { _id: 1, host: “mongod-1.mongodb-service.default.svc.cluster.local:27017” } ]});</span></pre><blockquote class="oh oi oj"><p id="9c59" class="kn ko lj kp b kq kr jr ks kt ku ju kv ok kx ky kz ol lb lc ld om lf lg lh li ij bi translated">您必须保护您的MongoDB配置，以便在生产环境中使用它。使用Kubernetes的秘密等。</p></blockquote><p id="a450" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">延伸阅读:</em><a class="ae nu" href="https://deeptiman.medium.com/mongodb-statefulset-in-kubernetes-87c2f5974821" rel="noopener"><em class="lj">MongoDB statefullset in Kubernetes</em></a><em class="lj">by</em><a class="oo op ep" href="https://medium.com/u/3a3e6395f78f?source=post_page-----a0c0ae23dca9--------------------------------" rel="noopener" target="_blank"><em class="lj">Deeptiman Pattnaik</em></a></p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="2e40" class="nf lq iq bd lr ng nh ni lu nj nk nl lx jw nm jx ma jz nn ka md kc no kd mg np bi translated">3.访问ASP.NET核心REST-API服务中的数据库</h1><p id="ceff" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">您将创建一个ASP.NET核心web API来访问MySQL数据库，并创建第二个ASP.NET核心web API来连接到MongoDB副本集。最后，您将为每个API创建一个docker映像。</p><p id="2546" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章关注的是数据库访问。所以我把其他方面说得很短。关于如何在Docker Desktop with Ingress上使用K8S，使用ASP.NET核心REST API和Angular为云进行本地开发的详细信息，请参见我之前的帖子<a class="ae nu" href="https://levelup.gitconnected.com/kubernetes-angular-asp-net-core-microservice-architecture-c46fc66ede44" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9978" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">用ASP.NET和web开发工作量安装<a class="ae nu" href="https://visualstudio.microsoft.com/en/vs/community/" rel="noopener ugc nofollow" target="_blank"> Visual Studio社区</a>(免费)。</p><h2 id="dc06" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">使用MySQL服务创建一个API</h2><p id="bd07" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建一个ASP.NET核心5.0 Web API项目，并将其命名为“MySqlApi”。激活Docker，使用“Linux”设置。禁用HTTPS。</p><p id="a79a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">安装“MySQL connector”nu get包。</p><p id="50b5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="lj">延伸阅读:</em><a class="ae nu" href="https://mysqlconnector.net/tutorials/connect-to-mysql/" rel="noopener ugc nofollow" target="_blank">【https://mysqlconnector.net/tutorials/connect-to-mysql/】T21</a></p><p id="be8d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">添加一个新控制器“MySqlController”:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="e147" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">该代码将查询并返回MySQL服务器中的所有数据库。</p><blockquote class="oh oi oj"><p id="d1c3" class="kn ko lj kp b kq kr jr ks kt ku ju kv ok kx ky kz ol lb lc ld om lf lg lh li ij bi translated">为了更容易理解，所有代码都放在一个方法中。请确保使用正确的配置等。在生产环境中运行时。</p></blockquote><p id="1429" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">将API归档</strong></p><p id="1dd2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在Visual Studio MySqlApi项目中，将项目资源管理器中的文件“Dockerfile”重命名为“dockerfile”(第一个字符小写)。然后右键单击Docker文件，选择“创建Docker映像”。这也会将图像推送到docker。</p><h2 id="79be" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">使用MongoDB服务创建一个API</h2><p id="e3b3" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建第二个Web API项目，并将其命名为“MongoDbApi”。使用与“MySqlApi”项目相同的设置。</p><p id="1513" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">安装“MongoDB。驱动程序" NuGet包。</p><p id="f36b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">添加一个新控制器“MongoDbController”:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ee42" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">代码将查询并返回MongoDB副本集中的所有集合。</p><p id="0b5c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">像在MySqlApi项目中一样创建docker映像。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="41f6" class="nf lq iq bd lr ng nh ni lu nj nk nl lx jw nm jx ma jz nn ka md kc no kd mg np bi translated">4.从Angular调用ASP.NET核心API</h1><p id="7153" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">您将创建一个Angular应用程序来加载和显示来自ASP.NET API的数据。最后，您创建一个docker映像，它使用NGINX为应用程序提供服务。</p><p id="4158" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Node.js/NPM下载安装<a class="ae nu" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">。<br/> <br/>安装Angular(我写这个指南的时候用的是Angular 9):</a></p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="86d3" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;npm install -g <a class="ae nu" href="http://twitter.com/angular/cli" rel="noopener ugc nofollow" target="_blank">@angular/cli</a></span></pre><p id="f19a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建应用程序:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="ad58" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;ng new DemoApp</span></pre><p id="6676" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">调整<code class="fe oq or os nz b">DemoApp\src\app</code>中的代码</p><p id="af1c" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将HttpClientModule添加到<strong class="kp ir"> app.module.ts </strong>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="bcb5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">调用<strong class="kp ir"> app.component.ts </strong>中的REST-API:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="7b22" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在<strong class="kp ir">app.component.html</strong>中显示加载的数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><h2 id="e4df" class="lp lq iq bd lr ls lt dn lu lv lw dp lx kw ly lz ma la mb mc md le me mf mg mh bi translated">将Angular应用程序归档</h2><p id="153b" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">创建文件<code class="fe oq or os nz b">DemoApp\src\app\dockerfile</code></p><p id="2fc2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">确保文件“dockerfile”没有文件扩展名。这将使用NGINX来服务应用程序:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="ec39" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建文件”。dockerignore”(开头带点):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="c542" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">打开命令提示符并构建docker映像(末尾的点很重要):</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="5bc2" class="lp lq iq nz b gy od oe l of og">C:\dev\demo\DemoApp&gt;docker build -t demoapp .</span></pre></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="68a9" class="nf lq iq bd lr ng nh ni lu nj nk nl lx jw nm jx ma jz nn ka md kc no kd mg np bi translated">5.将Angular应用程序和ASP.NET核心服务部署到Kubernetes</h1><p id="b1cb" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">安装NGINX入口控制器(在命令行的一行中):</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="fa33" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl apply -f <a class="ae nu" href="https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/cloud/deploy.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.41.2/deploy/static/provider/cloud/deploy.yaml</a></span></pre><p id="7590" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建kubernetes.yaml:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="77b1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">应用yaml:</p><pre class="kg kh ki kj gt ny nz oa ob aw oc bi"><span id="084a" class="lp lq iq nz b gy od oe l of og">C:\dev\demo&gt;kubectl apply -f kubernetes.yaml</span></pre><p id="c8f2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">大功告成！</strong>在http端口80上打开浏览器，查看您的Kubernetes微服务是如何工作的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ot"><img src="../Images/a76d5f9a08927fc674513836cdeb0aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jLbLYA39hkO6oOT-pnKHKA.png"/></div></div></figure><h1 id="e552" class="nf lq iq bd lr ng ou ni lu nj ov nl lx jw ow jx ma jz ox ka md kc oy kd mg np bi translated">6.最后的想法和展望</h1><p id="487c" class="pw-post-body-paragraph kn ko iq kp b kq mk jr ks kt ml ju kv kw nq ky kz la nr lc ld le ns lg lh li ij bi translated">您为基于微服务的云架构创建了<strong class="kp ir">工作基础</strong>和<strong class="kp ir">使用了两种不同类型的数据库</strong>。</p><p id="6809" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">请确保<strong class="kp ir">调整代码以在生产环境中使用</strong> : C <strong class="kp ir">改进代码</strong>和<strong class="kp ir">应用安全最佳实践</strong>，使用Kubernetes的秘密和最新的安全映像。应用角度和。NET核心设计模式、错误处理等。</p><p id="6eee" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">见我的后续帖子<a class="ae nu" rel="noopener ugc nofollow" target="_blank" href="/how-to-build-an-event-driven-asp-net-core-microservice-architecture-e0ef2976f33f"> <strong class="kp ir">如何使用事件进行微服务间通信</strong> </a>。</p><p id="48de" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我会在接下来的文章中向你展示更多的内容:Kubernetes的秘密，安全方面，如SSL、日志、调试、CI/CD、导航图、(代码)质量、(自动)伸缩和自我修复等。</p><p id="1b44" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">查看我的其他故事如何:</strong></p><ul class=""><li id="a3e6" class="mi mj iq kp b kq kr kt ku kw oz la pa le pb li pc mq mr ms bi translated"><a class="ae nu" href="https://levelup.gitconnected.com/how-to-sign-in-with-google-in-angular-and-use-jwt-based-net-core-api-authentication-rsa-6635719fb86c" rel="noopener ugc nofollow" target="_blank">在Angular中登录谷歌，使用JWT。使用非对称(RSA)签名令牌进行NET Core API认证</a></li><li id="406e" class="mi mj iq kp b kq mt kt mu kw mv la mw le mx li pc mq mr ms bi translated"><a class="ae nu" href="https://levelup.gitconnected.com/how-to-jwt-authenticate-with-angular-to-an-asp-net-4cfab5298d08" rel="noopener ugc nofollow" target="_blank">使用NSwag自动生成TypeScript客户端访问. NET核心服务API，使用OpenAPI/Swagger描述API </a></li></ul><p id="1fe0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果您有任何问题、想法或建议，请联系我。</p></div></div>    
</body>
</html>