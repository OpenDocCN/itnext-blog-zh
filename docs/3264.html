<html>
<head>
<title>Filtering Data in Vuex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Vuex中过滤数据</h1>
<blockquote>原文：<a href="https://itnext.io/filtering-data-in-vuex-7361141d7baa?source=collection_archive---------3-----------------------#2019-11-08">https://itnext.io/filtering-data-in-vuex-7361141d7baa?source=collection_archive---------3-----------------------#2019-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/954275becb3d206cfa00257f5d5db276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROtQY0XW1itY-76_ufVHww.png"/></div></div></figure><p id="0d46" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">像软件开发中的大多数挑战一样，通常有多种方法来实现一个解决方案。过滤Vuex中的数据也不例外。这是一个潜在的实现。根据您的情况，这可能适用，也可能不适用。对我来说，这很好。</p><h1 id="6303" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">设置</h1><p id="ce9a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我有一个名为Presidents的示例应用程序。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/f475dc5667e39e5c12590f98bda0422b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g_hAupAt8OGxmU7s.png"/></div></div></figure><p id="64e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我打赌看着它你就能猜到它是干什么的。它展示了美国总统。想不到！</p><p id="8d47" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了简单起见，我在node本地运行了一个Express服务器，当应用程序加载App.vue组件时，会调用Vuex来加载数据。下面是应用程序组件的代码:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8034" class="mm la it mi b gy mn mo l mp mq">&lt;script&gt;<br/>import HeaderComponent from './components/Header';<br/>import { mapGetters } from 'vuex';</span><span id="c68a" class="mm la it mi b gy mr mo l mp mq">export default {</span><span id="2ce9" class="mm la it mi b gy mr mo l mp mq">name: "app",<br/>    components: { "header-component" : HeaderComponent },<br/>    created() {<br/>        this.$store.dispatch("getPresidents");</span><span id="995e" class="mm la it mi b gy mr mo l mp mq">    }<br/>};<br/>&lt;/script&gt;</span></pre><p id="80ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上面的代码中可以看到，当created()钩子被触发时，Vuex中调用了<em class="ms"> getPresidents() </em>动作:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="580a" class="mm la it mi b gy mn mo l mp mq">import axios from 'axios';</span><span id="6a76" class="mm la it mi b gy mr mo l mp mq">const state = {<br/>    presidents: []<br/>};</span><span id="d0c8" class="mm la it mi b gy mr mo l mp mq">const actions = {<br/>    getPresidents({commit}) {<br/>        axios.get('/api/presidents').then((response) =&gt; {<br/>            commit('UPDATE_PRESIDENTS', response.data);<br/>        });<br/>    }<br/>};</span><span id="019a" class="mm la it mi b gy mr mo l mp mq">const mutations = {<br/>    UPDATE_PRESIDENTS(state, payload) {<br/>        state.presidents = payload;<br/>    }<br/>};</span></pre><p id="3737" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在getPresidents()操作中，我们使用axios进行HTTP调用并从服务器加载数据。然后，数据显示在PresidentList组件中。如果我们从组件的角度来考虑用户界面，下面是它的展示方式:</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/405620ebd5162779f9d224d56003848e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7aUdvJKaqpZjOZLO.jpg"/></div></div></figure><p id="a695" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们有主应用程序组件，用红色表示，标题、过滤器和presidentList组件用蓝色表示，PresidentListItem组件用黄色表示。</p><p id="8909" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Vuex存储上有一个getter，由PresidentList组件访问，并为每位总统呈现一个PresidentListItem组件。</p><p id="6305" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">到目前为止，一切顺利。</p><p id="b117" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们把注意力转向滤波器组件。</p><h1 id="57ee" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">在Vuex中过滤</h1><p id="5316" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我希望能够根据<em class="ms">的名字、党派或者两者来过滤总统名单。</em></p><p id="0e8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我最初的实现传递了两个字符串给Vuex商店，但是我真的不喜欢这个设置，所以我决定创建一个名为<em class="ms"> filterObj </em>的自定义对象。</p><p id="8e8e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">filterObj 将使跟踪过滤标准变得容易。我的自定义对象也让我能够很容易地看到我是在处理1个还是2个过滤标准。</p><p id="019b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是自定义<em class="ms"> filterObj </em>的代码。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7eff" class="mm la it mi b gy mn mo l mp mq">const filterObj = {<br/>    _presidentName: undefined,<br/>    _partyAffiliation: undefined,<br/>    _filterCount: 0<br/>}</span><span id="9284" class="mm la it mi b gy mr mo l mp mq">Object.defineProperty(filterObj, "presidentName", {<br/>    enumerable: true,<br/>    get(){<br/>        return this._presidentName;<br/>    },<br/>    set(newVal) {<br/>        if(newVal === ''){<br/>            this._presidentName = undefined;<br/>            this._filterCount--;<br/>        } else {<br/>            if(this._presidentName === undefined){<br/>                this._filterCount++;<br/>            }<br/>            this._presidentName = newVal.toLowerCase();<br/>        }<br/>    }<br/>});</span><span id="c41c" class="mm la it mi b gy mr mo l mp mq">Object.defineProperty(filterObj, "partyAffiliation", {<br/>    enumerable: true,<br/>    get(){<br/>        return this._partyAffiliation;<br/>    },<br/>    set(newVal) {<br/>        if(newVal === ''){<br/>            this._partyAffiliation = undefined;<br/>            this._filterCount--;<br/>        } else {<br/>            if(this._partyAffiliation === undefined){<br/>                this._filterCount++;<br/>            }<br/>            this._partyAffiliation = newVal.toLowerCase();<br/>        }<br/>    }<br/>});</span><span id="78c4" class="mm la it mi b gy mr mo l mp mq">Object.defineProperty(filterObj, "filterCount", {<br/>    enumerable: true,<br/>    get(){<br/>        return this._filterCount;<br/>    },<br/>    set(newVal) {<br/>        <br/>        this._filterCount = newVal;<br/>    }<br/>});</span><span id="6690" class="mm la it mi b gy mr mo l mp mq">export default filterObj;</span></pre><p id="121b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我这样实现它有三个原因:</p><ol class=""><li id="1a7a" class="mt mu it kd b ke kf ki kj km mv kq mw ku mx ky my mz na nb bi translated">我总是希望传入的值是小写的，在presidentName的setter中很容易做到这一点。</li><li id="0844" class="mt mu it kd b ke nc ki nd km ne kq nf ku ng ky my mz na nb bi translated">当我应用过滤器时，我想知道我处理了多少个过滤标准。这样做的原因是，如果我只处理1个过滤器，我实际上是在执行逻辑or运算，而如果我有2个标准，我是在执行逻辑AND运算。</li><li id="90c3" class="mt mu it kd b ke nc ki nd km ne kq nf ku ng ky my mz na nb bi translated">传递一个包含我需要的所有信息的对象很简单</li></ol><p id="6395" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">每当用户与UI中的过滤器组件控件交互时，它都与<em class="ms"> filterObj </em>保持同步:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="d3df" class="mm la it mi b gy mn mo l mp mq">&lt;template&gt;<br/>    &lt;div&gt;<br/>        &lt;div class="box"&gt;filter presidents &lt;br&gt;<br/>            &lt;label for="name"&gt;name: &lt;/label&gt;<br/>            &lt;input type="text" class="input" v-model="filterObj.presidentName" <a class="ae nh" href="http://twitter.com/keyup" rel="noopener ugc nofollow" target="_blank">@keyup</a>="filterPresidents"&gt;<br/>            <br/>            &lt;label for="name"&gt;party: &lt;/label&gt;<br/>            &lt;select class="input" <a class="ae nh" href="http://twitter.com/change" rel="noopener ugc nofollow" target="_blank">@change</a>="filterPresidents" v-model="filterObj.partyAffiliation"&gt; <br/>                &lt;option  v-for="(party, key) in parties" :value="party" :key="key"&gt;{{ party }}&lt;/option&gt;<br/>            &lt;/select&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="11af" class="mm la it mi b gy mr mo l mp mq">&lt;script&gt;<br/>    import filterObj from "../utils/filterObj";<br/>    export default {<br/>        name: 'FilterPanel',<br/>        data() {<br/>            return {<br/>                parties: ['','republican', 'democrat', <br/>                          'federalist', 'whig',       <br/>                          'democratic-republican', 'none'],<br/>                filterObj<br/>            }<br/>        },<br/>        methods: {<br/>            filterPresidents() {<br/>                this.$store.dispatch('filterPresidents', <br/>                this.filterObj);<br/>            }<br/>        }<br/>    }<br/>&lt;/script&gt;</span></pre><p id="e64a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">每当控件中的数据发生变化时，我们就调用组件上的<em class="ms"> filterPresidents() </em>方法。</p><p id="28d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用Vuex时的一个规则是，我们从不直接修改状态。相反，我们<em class="ms">将</em>分派给<em class="ms">商店上的</em>行动。我们可以在filterPresidents()方法中传递过滤器对象来实现这一点:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="10b0" class="mm la it mi b gy mn mo l mp mq">filterPresidents() {<br/>       this.$store.dispatch('filterPresidents', <br/>       this.filterObj);<br/>}</span></pre><p id="b7da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦“进入”商店，<em class="ms">动作</em> <em class="ms">提交突变</em>，而<em class="ms">以某种方式突变</em>状态:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="6c5e" class="mm la it mi b gy mn mo l mp mq">const state = {<br/>    presidents: [],<br/>    filterObj: {}<br/>};</span><span id="fef4" class="mm la it mi b gy mr mo l mp mq">const actions = {<br/>    filterPresidents({commit}, filterObj) {<br/>        commit('UPDATE_FILTER', filterObj);</span><span id="d1dc" class="mm la it mi b gy mr mo l mp mq">}<br/>};</span><span id="628d" class="mm la it mi b gy mr mo l mp mq">const mutations = {<br/>    UPDATE_FILTER(state, payload) {<br/>        state.filterObj = payload;<br/>    }<br/>};<br/>const getters = {<br/>    presidents: state =&gt; state.presidents<br/>}</span></pre><p id="b885" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">准备就绪后，剩下要做的就是将我们的getter从上面显示的简单getter更新为一个识别状态的getter，我们可以使用它来进行动态过滤:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a125" class="mm la it mi b gy mn mo l mp mq">const getters = {    <br/>    presidents: state =&gt; {<br/>        switch(state.filterObj.filterCount) {<br/>            //no filters passed<br/>            case 0:<br/>            case undefined:<br/>                return state.presidents;</span><span id="fd96" class="mm la it mi b gy mr mo l mp mq">//only 1 filter passed<br/>            case 1:<br/>                return state.presidents.filter(president =&gt; {<br/>                    for(let key in state.filterObj) {<br/>                        if(president[key]) {<br/>                       if(president[key].toLowerCase().includes(state.filterObj[key]))<br/>                                return true<br/>                        }<br/>                    }<br/>                    return false;<br/>                });</span><span id="5255" class="mm la it mi b gy mr mo l mp mq">//2 filters passed<br/>            case 2:<br/>                return state.presidents.filter(president =&gt; {<br/>                    for(let key in state.filterObj) {<br/>                        if(president[key]) {<br/>                            if(!president[key].toLowerCase().includes(state.filterObj[key]))<br/>                                return false;<br/>                        }<br/>                    }<br/>                    return true;<br/>                });<br/>        }<br/>    }<br/>};</span></pre><p id="46c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们可以根据传递给商店的“过滤器”数量轻松进行过滤。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a3624d1faac08efc647607b8451fdf49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*XJbQJ5tqeGVDGNDL.gif"/></div></figure><p id="b925" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可能有办法让这更有效，但这是一项正在进行的工作。无论如何，如果你有改进修改的建议，请发表评论。</p><p id="494c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以在GitHub上查看<a class="ae nh" href="https://github.com/aritzcovan/vue-presidents" rel="noopener ugc nofollow" target="_blank">的完整源代码。</a></p><p id="7414" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同时，感谢你的阅读和快乐的陪伴！</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><p id="a8a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="ms">原载于</em><a class="ae nh" href="http://ritzcovan.com/index.php/2018/10/01/filtering-data-in-vuex/" rel="noopener ugc nofollow" target="_blank"><em class="ms">http://ritzcovan.com</em></a><em class="ms">。</em></p></div></div>    
</body>
</html>