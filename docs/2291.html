<html>
<head>
<title>Protect Yourself from the Recent dockerhub.com Attack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保护自己免受最近的dockerhub.com袭击</h1>
<blockquote>原文：<a href="https://itnext.io/protect-yourself-from-the-recent-dockerhub-com-attack-f881b8e84694?source=collection_archive---------5-----------------------#2019-05-01">https://itnext.io/protect-yourself-from-the-recent-dockerhub-com-attack-f881b8e84694?source=collection_archive---------5-----------------------#2019-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1b6917c343be1d135bc88db56df8c021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nZlmyoV2Lh66Ue_Q.png"/></div></div></figure><p id="6a83" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上周的<a class="ae kw" href="https://news.ycombinator.com/item?id=19763413" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">dockerhub.com攻击</strong> </a>影响了数十万个账户，并将其容器暴露给恶意代码。在<a class="ae kw" href="https://www.codenotary.io" rel="noopener ugc nofollow" target="_blank">code公证人</a>，我们也发布开源软件，并希望确保我们的容器图像不受影响。</p><p id="70ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它是这样工作的:</p><h1 id="14ea" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">验证集装箱的真实性和完整性</h1><ol class=""><li id="3e86" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated">在<a class="ae kw" href="https://www.codenotary.io/?utm_source=vchain&amp;utm_medium=blog&amp;utm_campaign=protect.yourself.from.the.recent.dockerhub.com.attack" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">code公证人. io </strong> </a>上创建一个<strong class="ka ir">免费</strong>账号，保护文件的完整性和原始性</li><li id="1fd5" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">签署你的Docker容器映像的本地副本你知道它是好的<br/> <strong class="ka ir"> vcn签署docker://hello-world </strong></li><li id="e097" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">在另一个(推荐:蜜罐或隔离)系统<br/> <strong class="ka ir">上从<a class="ae kw" href="http://dockerhub.com/" rel="noopener ugc nofollow" target="_blank">dockerhub.com</a>下载容器镜像</strong></li><li id="f463" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">确保您从<a class="ae kw" href="http://dockerhub.com/" rel="noopener ugc nofollow" target="_blank">dockerhub.com</a>提取的容器图像已经用code公证人签名:<br/> <strong class="ka ir"> vcn验证docker://hello-world </strong></li></ol><p id="5c06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在这里找到完整的命令行演示来保护golang容器图像:<a class="ae kw" href="https://asciinema.org/a/243863" rel="noopener ugc nofollow" target="_blank">https://asciinema.org/a/243863</a></p><p id="825e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果输出显示可信的以及您期望的资产信息，您可以确定容器图像是原始的:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6f4e" class="mu ky iq mq b gy mv mw l mx my">vcn v docker://zerotrust/parity <br/>Asset: docker://7d2d42157acdabf4ae46a4815af9037179c871a3b20df628c997af5d452bd7ff <br/>Hash: 7d2d42157acdabf4ae46a4815af9037179c871a3b20df628c997af5d452bd7ff Date: 2019–05–01 14:00:35 +0000 UTC <br/>Key: 0x2a4d3071a9d12e3886d43890d0dbaa8be60febec <br/>Name: docker://7d2d42157acdabf4ae46a4815af9037179c871a3b20df628c997af5d452bd7ff <br/>Size: 270 MB <br/>Company: vChain, Inc. <br/>Website: https://www.vchain.us <br/>Level: 2 — SOCIAL_VERIFIED <br/>Status: TRUSTED</span></pre><h1 id="cd68" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">这是怎么回事？</h1><p id="f4c4" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mz kl km kn na kp kq kr nb kt ku kv ij bi translated">当运行vcn命令来签署任何文件、容器图像或文档时，除了文件和身份信息之外，还会生成唯一的散列，并存储在由独立财团(<a class="ae kw" href="https://www.zerotrustconsortium.org" rel="noopener ugc nofollow" target="_blank"> ZTC </a>)运行的分布式分类账上。</p><p id="254c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当散列出现在分布式分类账上时，没有人能够再改变该信息，每个人都可以验证其完整性。</p><p id="3b9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以作为所有者或用户对文件或容器图像进行签名。作为一个<strong class="ka ir">所有者(开发者或发行者)</strong>保护你的用户免受所谓的恶意克隆或者作为一个比普通校验和(MD5，SHA-1，SHA-256 aso)先进得多的解决方案是有意义的。).作为<strong class="ka ir">用户(团队或公司)</strong>，您可以确保只有软件或映像可以运行，它们是可验证的并且已经过您的签名。这样，您几乎消除了运行不需要的软件的风险。</p><p id="7d08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与用于签署文件的数字证书不同，code公证人方法根本不改变文件，并且不与文件本身一起传播。这样，每个人都可以从世界各地验证文件，只需运行vcn verify或使用<a class="ae kw" href="https://chrome.google.com/webstore/detail/vchain-codenotary-downloa/mnloemedehacppeggbipipjlphdjpjcb?hl=en" rel="noopener ugc nofollow" target="_blank">code公证人Chrome浏览器扩展</a>。</p><p id="48b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">作为发布者或用户，您可以简单地取消对您的文件、图像、软件等的信任或更新。任何人都可以随时验证和检查状态变化。几乎是你能找到的最灵活和最好的保护。</strong></p><p id="d302" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到docker容器映像的话题，当你签署你信任的本地版本时，dockerhub.com发生了什么以及它是否被黑客攻击都无关紧要。现在，世界上的每个人都可以在Docker Hub上下载容器图像，并根据code公证人服务进行验证。如果不能验证提取的容器映像，就不要运行它。</p><h1 id="e438" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用vcn-watchdog实现连续的容器完整性监控</h1><p id="7b3e" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj mz kl km kn na kp kq kr nb kt ku kv ij bi translated">为了实现近乎防弹的保护，您可以在您的docker主机上运行我们的sidecar方法，以确保您在无法验证的容器运行或图像被提取时得到警报。由于您可以对所有想要运行的容器映像进行签名，因此您可以完全保护自己，并使用code公证人作为服务将容器列入白名单。</p><p id="319d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在GitHub上作为开源项目发布的sidecar <strong class="ka ir"> vcn-watchdog </strong>，不断保护不受不需要的、受感染的Docker容器映像的攻击。</p><p id="b439" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与Docker集成，看门狗不断检查其已知的，<a class="ae kw" href="https://www.codenotary.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">公证</strong> </a>【签名图像】容器的完整性。如果一个容器没有通过验证检查，就会发送一个警报，在我们的例子中，就是我们的Slack通道。</p><p id="a383" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是您快速启用容器连续完整性监控的方法:</p><ol class=""><li id="a9ae" class="lv lw iq ka b kb kc kf kg kj nc kn nd kr ne kv mc md me mf bi translated">用your公证人签名您本地存储的容器:<br/> <strong class="ka ir"> vcn签名docker://ImageId </strong></li><li id="b3e5" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">在你的服务器上检查一下https://github.com/vchain-us/vcn-watchdog。该工具不断验证你的容器的完整性:<br/> <strong class="ka ir"> git克隆</strong><a class="ae kw" href="https://github.com/vchain-us/vcn-watchdog.git" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">https://github.com/vchain-us/vcn-watchdog.git</strong></a></li><li id="574f" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">编辑<code class="fe nf ng nh mq b">verify</code>文件并设置您正在使用的警报/监控工具(参见以下说明)</li><li id="cd6a" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">确保<strong class="ka ir"> /var/run/docker.sock </strong>可以访问，这样边车集装箱就可以访问集装箱图像进行验证</li><li id="6969" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">在您的服务器上使用以下命令启动容器<br/><strong class="ka ir">docker-compose build&amp;&amp;docker-compose up</strong></li></ol><p id="f228" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要修改<code class="fe nf ng nh mq b">verify</code>文件，将您的警报工具连接到err()函数。如果您像我们一样使用Slack，请执行以下操作:</p><ol class=""><li id="eb73" class="lv lw iq ka b kb kc kf kg kj nc kn nd kr ne kv mc md me mf bi translated">创建一个Slack Bot(Slack documentation<a class="ae kw" href="https://get.slack.help/hc/en-us/articles/115005265703-Create-a-bot-for-your-workspace" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">此处</strong> </a>)</li><li id="c6cd" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">使用以下代码:</li></ol><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="aa6b" class="mu ky iq mq b gy mv mw l mx my">function err() { echo "Container ${1} (${2}) verification failed" &gt;&amp;2 curl -q -X POST \ <br/>-H 'Content-type: application/json' \ <br/>- data "{\"text\":\"Container ${1} (${2}) verification failed\"}" \<br/>"<a class="ae kw" href="https://hooks.slack.com/services/$TOKEN/$KEY" rel="noopener ugc nofollow" target="_blank">https://hooks.slack.com/services/$TOKEN/$KEY</a>" &gt; /dev/null 2&gt;&amp;1}</span></pre><p id="8b84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">设置完成后，如果验证失败，您将在Slack Bot通知中看到以下消息:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/346a5cacc57e77e52240e4ebe45c9ca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*alNE80LID0VD4v55.png"/></div></div></figure><p id="e9b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果您没有看到警告消息，您的容器已经过验证，是安全的。</strong></p><p id="ba6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢让你的生活变得复杂，并且每次怀疑自己被黑客攻击时都要执行13个耗时的手动步骤，那么<a class="ae kw" href="https://blog.madhuakula.com/some-tips-to-review-docker-hub-hack-of-190k-accounts-addcd602aade" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Madhuakula </strong> </a>为喜欢这条路线的程序员概述了一个分步指南。然而，正如Joona Hoikkala最近在推特上说的那样，大多数人并不这么认为。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/b1fd30d55b427e9c7c4aa1473b8561bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yNmbarSPjqSgQoJW.png"/></div></div></figure><p id="93b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">立即开始使用vcn-watchdog，创建您的<strong class="ka ir">免费</strong> <a class="ae kw" href="https://www.codenotary.io/?utm_source=vchain&amp;utm_medium=blog&amp;utm_campaign=protect.yourself.from.the.recent.dockerhub.com.attack" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">公证</strong> </a>账户:</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="14a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nr">原载于2019年5月1日</em><a class="ae kw" href="https://www.vchain.us/protect-yourself-from-the-recent-dockerhub-com-attack/" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://www . vchain . us</em></a><em class="nr">。</em></p></div></div>    
</body>
</html>