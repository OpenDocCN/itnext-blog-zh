<html>
<head>
<title>Safe Coding in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的安全编码</h1>
<blockquote>原文：<a href="https://itnext.io/safe-coding-in-swift-a66e1f818a93?source=collection_archive---------0-----------------------#2020-12-09">https://itnext.io/safe-coding-in-swift-a66e1f818a93?source=collection_archive---------0-----------------------#2020-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="08a8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">确保你的应用不再崩溃(或者至少不像以前那样崩溃)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e444621388d98c7def765d6b684868bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ugmfxq4ZKNhHKRZK17NjFg.png"/></div></div></figure><p id="7cdf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想象一下这个场景；你刚刚更新了你的应用程序，然后出去发泄一下。当你们都很放松的时候，你的电话开始一遍又一遍的响。你上一个版本崩溃的次数比Windows Vista还多！😜</p><p id="27e6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我不想成为那样的人，但这可能是你的错，所以你活该😬</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ln lo l"/></div></figure><p id="283d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据我的经验，9/10的情况下会有意外的崩溃，这是因为我太确定一个变量总会有一个值…直到它没有。所以，为了不在每次外出和电话铃响时都得轻微的心脏病，让我们来看看你在编码时可以遵循的一些原则，以尽量减少崩溃。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="e529" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">始终提供默认值</h1><p id="891a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">Swift为开发人员提供了一种非常方便的方法，在使用变量时提供一个值，以防它是<code class="fe mt mu mv mw b">nil</code>。让我们看看下面的例子:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="2bf9" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    self</strong>.numberOfLikes = response <strong class="mw ir">as!</strong> Int<br/>    <strong class="mw ir">self</strong>.updateUI()<br/>}</span></pre><p id="f8b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你发现问题了吗？虽然这被认为是一个新手的错误，但它也可能发生在更有经验的开发人员身上。如果你没注意到，它是<code class="fe mt mu mv mw b">forced unwrap</code>:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="a5cb" class="nb lx iq mw b gy nc nd l ne nf">response <strong class="mw ir">as!</strong> Int</span></pre><p id="fc2b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不管你有多确定响应会一直存在，总会有<strong class="kt ir">和</strong>出错<strong class="kt ir">和你的应用<strong class="kt ir">崩溃</strong>的时候！</strong></p><p id="c312" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最有可能的是，这可能是因为你或其他人将来会做出的改变。一个属性或一个响应现在可能是强制性的，但是将来您的业务逻辑可能会改变，使该属性或响应成为可选的。因此，当这种变化生效时，你的应用程序很有可能会大规模崩溃！</p><p id="c052" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是避免这种灾难的方法:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="cc6b" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    self</strong>.numberOfLikes = response <strong class="mw ir">as?</strong> Int ?? 0<br/>    <strong class="mw ir">self</strong>.updateUI()<br/>}</span></pre><p id="c21e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们快速看一下发生了什么变化:</p><p id="3f6e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那个<code class="fe mt mu mv mw b">??</code>被称为<strong class="kt ir">零合并运算符</strong>，它与<code class="fe mt mu mv mw b">optional</code>值密切相关。nil合并操作符可以在内联中执行，而不是检查变量是否为nil，如果是，就给它赋值。它实际上检查左边的表达式是否产生一个零，如果是，它把你在右边提供的值赋给变量。否则，它会安全地解开变量。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="5867" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated"><code class="fe mt mu mv mw b">if-let</code> &amp; <code class="fe mt mu mv mw b">guard-let</code>报表</h1><p id="a24a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">尽管nil合并操作符很方便，但有时您需要在代码中添加更多的逻辑。例如，如果您知道某个值有时可以为零，有时不为零，那么您应该使用<code class="fe mt mu mv mw b">if-let</code>语句。</p><p id="b6fd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="1e08" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    if </strong>response != nil<strong class="mw ir"> </strong>{<strong class="mw ir"><br/>        self</strong>.numberOfLikes = response <strong class="mw ir">as!</strong> Int<br/>    }</span><span id="89ed" class="nb lx iq mw b gy ng nd l ne nf">    <strong class="mw ir">self</strong>.updateUI()<br/>}</span></pre><p id="527d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">虽然上面的情况看起来比强制解包变量更安全，但它仍然可能导致崩溃。如果响应确实不是<code class="fe mt mu mv mw b">nil</code>，但出于某种原因它不再是<code class="fe mt mu mv mw b">Int</code>，会发生什么？</p><p id="c450" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们改用<code class="fe mt mu mv mw b">if-let</code>语句，看看会发生什么:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="0e3d" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    if let </strong>numberOfLikes = response <strong class="mw ir">as?</strong> Int<strong class="mw ir"> </strong>{<strong class="mw ir"><br/>        self</strong>.numberOfLikes = numberOfLikes<br/>    }</span><span id="e5ee" class="nb lx iq mw b gy ng nd l ne nf"><strong class="mw ir">    self</strong>.updateUI()<br/>}</span></pre><p id="ec12" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在看起来不是好多了吗？这样你就能以最安全的方式具体检查你想要的东西！当然，您总是可以在同一个<code class="fe mt mu mv mw b">if-let</code>语句中添加更多的检查，就像这样:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="6d1f" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    if let </strong>numberOfLikes = response <strong class="mw ir">as?</strong> Int,<br/>       <strong class="mw ir">let</strong> variable2 = something <strong class="mw ir">as?</strong> Type,<br/>       <strong class="mw ir">let</strong> variable3 = somethingElse <strong class="mw ir">as?</strong> Type<strong class="mw ir"> </strong>{</span><span id="2c46" class="nb lx iq mw b gy ng nd l ne nf">       ...<br/>    }</span><span id="e148" class="nb lx iq mw b gy ng nd l ne nf"><strong class="mw ir">    self</strong>.updateUI()<br/>}</span></pre><blockquote class="nh ni nj"><p id="97a0" class="kr ks nk kt b ku kv jr kw kx ky ju kz nl lb lc ld nm lf lg lh nn lj lk ll lm ij bi translated">只有当所有子语句都不是<code class="fe mt mu mv mw b">nil</code>时，<code class="fe mt mu mv mw b">if-let</code>语句才会被认为有效。显然，如果需要，您可以添加<code class="fe mt mu mv mw b">else-if-let</code>和<code class="fe mt mu mv mw b">else</code>语句。</p></blockquote></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="4ea8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的标题中，我提到了另一种类型的语句，即<code class="fe mt mu mv mw b">guard-let</code>语句。那个，不用声明要用的变量，但是是加分项。您会发现，在您想要完全停止代码块流动的情况下，它会更有用。</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="39c8" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    guard let </strong>numberOfLikes = response <strong class="mw ir">as?</strong> Int <strong class="mw ir">else</strong> { <strong class="mw ir">return</strong> }<br/>    <strong class="mw ir">self</strong>.updateUI()<br/>}</span></pre><p id="d7cc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个例子中，只有当<code class="fe mt mu mv mw b">guard-let</code>语句不调用<code class="fe mt mu mv mw b">return</code>时，才会调用<code class="fe mt mu mv mw b">updateUI</code>函数。如果你只想检查一个变量是否包含一个值，而不是把它存储在某个地方，如果不包含，就返回，那么你可以这样做:</p><pre class="kg kh ki kj gt mx mw my mz aw na bi"><span id="652e" class="nb lx iq mw b gy nc nd l ne nf"><strong class="mw ir">Server</strong>.request("getNumberOfLikes") { (response, error) <strong class="mw ir">in<br/>    guard </strong>response <strong class="mw ir">as?</strong> Int <strong class="mw ir">else</strong> { <strong class="mw ir">return</strong> }<br/>    <strong class="mw ir">self</strong>.updateUI()<br/>}</span></pre><h1 id="3a20" class="lw lx iq bd ly lz no mb mc md np mf mg jw nq jx mi jz nr ka mk kc ns kd mm mn bi translated">这个故事的要点</h1><p id="7781" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">如果你从今天所读的内容中应该记住一些东西，那就是你永远不应该，让我重复一遍以示强调，<strong class="kt ir">你永远不应该</strong>，不检查任何可选值！</p><p id="0f10" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">快速总结每个控制语句何时更有用:</p><ul class=""><li id="cb95" class="nt nu iq kt b ku kv kx ky la nv le nw li nx lm ny nz oa ob bi translated">nil合并操作符使你能够在变量为零的情况下为变量提供一个默认值。您应该在总是需要一个值的情况下使用它。</li><li id="8224" class="nt nu iq kt b ku oc kx od la oe le of li og lm ny nz oa ob bi translated"><code class="fe mt mu mv mw b">if-let</code>语句帮助您安全地打开可能有值或没有值的选项。</li><li id="6dc3" class="nt nu iq kt b ku oc kx od la oe le of li og lm ny nz oa ob bi translated"><code class="fe mt mu mv mw b">guard-let</code>语句最适合于当一个变量或一组变量为零，或者与您提供的检查不匹配时，您需要对代码块进行转义的情况。</li></ul></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="b2f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望你看完我的毫无疑问完美的教程后，不是吹牛😜，你将会对如何使你的应用程序不容易崩溃和出错有所了解。</p><p id="a4e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读！<br/>下一集再见(希望如此😁)</p></div></div>    
</body>
</html>