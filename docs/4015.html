<html>
<head>
<title>How to Make Kubernetes Deployments Easier with Helm3 &amp; ChartMuseusm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Helm3 &amp; ChartMuseusm简化Kubernetes部署</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-make-kubernetes-deployments-easier-witth-helm3-chartmuseusm-34f043b2124c?source=collection_archive---------4-----------------------#2020-04-11">https://itnext.io/how-to-make-kubernetes-deployments-easier-witth-helm3-chartmuseusm-34f043b2124c?source=collection_archive---------4-----------------------#2020-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2346" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">权威指南</h2><div class=""/><div class=""><h2 id="584a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何用ChartMuseusm高效使用Helm3，减少维护？</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/a091b3d8cc2ea0707491535cd8908442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APUbZw3a0nXT423KFfL3_Q.jpeg"/></div></div></figure><h1 id="80d7" class="la lb iq bd lc ld le lf lg lh li lj lk kf ll kg lm ki ln kj lo kl lp km lq lr bi translated">简介:</h1><p id="f9d7" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">Helm是用于Kubernetes包管理的工具之一。这是CNCF的一个孵化器项目，由Helm Community维护。它已经存在了一段时间，最近发布了Helm v3，旨在通过移除舵杆使其更加灵活和用户友好。以下是Helm如何让您的生活变得轻松:</p><ul class=""><li id="0b7d" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">轻松创建、共享和托管您自己的包。</li><li id="bafe" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">将软件包安装到任何Kubernetes集群中。查询群集以查看安装和运行了哪些软件包。</li><li id="e339" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">更新、删除、回滚或查看已安装软件包的历史记录。</li><li id="c5d0" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">Helm社区提供的800多张图表。</li></ul><p id="40a9" class="pw-post-body-paragraph ls lt iq lu b lv mq ka lx ly mr kd ma mb ne md me mf nf mh mi mj ng ml mm mn ij bi translated">在本文中，我将重点介绍如何使用Helm3将应用程序部署到Kube集群。如果你还在头盔2上，那么这里的<a class="ae nh" href="https://helm.sh/docs/topics/v2_v3_migration/" rel="noopener ugc nofollow" target="_blank"/>是头盔社区提供的迁移到头盔3的指南。</p><h1 id="8eb9" class="la lb iq bd lc ld le lf lg lh li lj lk kf ll kg lm ki ln kj lo kl lp km lq lr bi translated">如何有效地使用头盔:</h1><ul class=""><li id="5601" class="mo mp iq lu b lv lw ly lz mb ni mf nj mj nk mn mv mw mx my bi translated">可以定制Helm模板来打包您的大多数生产应用程序。创建可用于所有或大部分部署的智能模板。下面是我为本文创建的一个名为<strong class="lu ja"> wonderchart </strong>的示例图表:</li></ul><div class="nl nm gp gr nn no"><a href="https://github.com/Krishna1408/helm3templates" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ja gy z fp nt fr fs nu fu fw iz bi translated">Krishna 1408/helm 3模板</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">海图博物馆和海图博物馆配置的头盔模板。-Krishna 1408/helm 3模板</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ky no"/></div></div></a></div><ul class=""><li id="9377" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">部署应用程序时，请始终对图表进行版本控制并使用版本。这将保护您的部署不被破坏，并使回滚更容易。</li></ul><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="19ab" class="oi lb iq oe b gy oj ok l ol om"># Chart.yaml</span><span id="65b3" class="oi lb iq oe b gy on ok l ol om">apiVersion: v2<br/>name: wonderchart<br/>description: A Helm chart which can be used for multiple purposes.<br/><em class="oo"><br/></em>version: 0.1.2<em class="oo"><br/></em>appVersion: 1.0.2</span></pre><ul class=""><li id="fa18" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">如果您正在使用某个社区图表，请确保<strong class="lu ja">锁定</strong>正在使用的版本。使用最新版本可以打破现有的应用程序很多时间。示例:</li></ul><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="c2f2" class="oi lb iq oe b gy oj ok l ol om"># Installing nginx-ingress chart:</span><span id="b8fc" class="oi lb iq oe b gy on ok l ol om">helm upgrade -i nginx-ingressstable/nginx-ingress -f values.yaml --namespace nginx-ingress --version 1.26.2</span></pre><ul class=""><li id="8d09" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">使用像Chartmuseum这样的工具，您可以轻松地在存储库之间共享您的模板，并减少维护工作。</li></ul><h1 id="b462" class="la lb iq bd lc ld le lf lg lh li lj lk kf ll kg lm ki ln kj lo kl lp km lq lr bi translated">图表博物馆:</h1><p id="4847" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">好了，您已经准备好了高度定制的图表。现在唯一剩下的事情就是将它分布到你的微服务的各个存储库。跨微服务复制粘贴或移动图表/模板效率不高，而且会增加维护工作量。在这里，ChartMuseusm开始发挥作用。</p><h2 id="a09c" class="oi lb iq bd lc op oq dn lg or os dp lk mb ot ou lm mf ov ow lo mj ox oy lq iw bi translated">为什么选择ChartMuseum:</h2><ul class=""><li id="cfef" class="mo mp iq lu b lv lw ly lz mb ni mf nj mj nk mn mv mw mx my bi translated">轻松地跨不同的部署管道或存储库分发图表。</li><li id="236d" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">它公开了一个用于图表操作的API。</li><li id="0493" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">减少维护，因为您可以轻松共享图表或模板。</li><li id="0304" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">几乎不需要任何努力就可以在kubernetes建立起来。</li><li id="12b6" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">支持多个云的后端，例如AWS S3。</li></ul><blockquote class="oz pa pb"><p id="136a" class="ls lt oo lu b lv mq ka lx ly mr kd ma pc ne md me pd nf mh mi pe ng ml mm mn ij bi translated">他的文章将主要关注AWS云。如果您打算在任何其他云上部署它，同样的步骤也适用。</p></blockquote><h2 id="7589" class="oi lb iq bd lc op oq dn lg or os dp lk mb ot ou lm mf ov ow lo mj ox oy lq iw bi translated">在Kubernetes上设置Chartmuseum:</h2><ul class=""><li id="bb73" class="mo mp iq lu b lv lw ly lz mb ni mf nj mj nk mn mv mw mx my bi translated">为后端创建一个S3桶，例如<code class="fe pf pg ph oe b">chart-museum-bucket</code></li><li id="2e04" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">创建一个Kube2Iam角色，以便chartmuseusm可以访问这个存储桶。如果你不使用Kube2Iam，那么它不是必需的。</li><li id="207b" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">这是博物馆掌舵图的链接。使用它来创建云或环境的值文件。下面是AWS的一个示例值文件。请确保为入口添加机密和正确的DNS主机名:</li></ul><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pi pj l"/></div><figcaption class="pk pl gj gh gi pm pn bd b be z dk translated">AWS的图表museusm值</figcaption></figure><ul class=""><li id="c40f" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">使用命令部署图表:<code class="fe pf pg ph oe b">helm upgrade -i chartmuseum-test -f values.yaml stable/chartmuseum</code></li><li id="8801" class="mo mp iq lu b lv mz ly na mb nb mf nc mj nd mn mv mw mx my bi translated">图表部署后，您可以通过值文件中为入口指定的URL来访问它，在当前示例中:<code class="fe pf pg ph oe b">http://chartmuseum-test.example.com</code></li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi po"><img src="../Images/5c94d801a1d16279c3c1269d6c6b9984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVaheRXjkxbFYsrUxTm2cg.png"/></div></div></figure><h2 id="7692" class="oi lb iq bd lc op oq dn lg or os dp lk mb ot ou lm mf ov ow lo mj ox oy lq iw bi translated">将图表上传到Chartmuseum:</h2><p id="dc46" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这里，我们将使用我的git存储库作为示例:</p><div class="nl nm gp gr nn no"><a href="https://github.com/Krishna1408/helm3templates" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ja gy z fp nt fr fs nu fu fw iz bi translated">Krishna 1408/helm 3模板</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">海图博物馆和海图博物馆配置的头盔模板。-Krishna 1408/helm 3模板</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ky no"/></div></div></a></div><p id="979a" class="pw-post-body-paragraph ls lt iq lu b lv mq ka lx ly mr kd ma mb ne md me mf nf mh mi mj ng ml mm mn ij bi translated">目录结构如下所示:</p><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="36bc" class="oi lb iq oe b gy oj ok l ol om">helm3templates<br/>  wonderchart/<br/>  chart-museusm-values/</span></pre><p id="6833" class="pw-post-body-paragraph ls lt iq lu b lv mq ka lx ly mr kd ma mb ne md me mf nf mh mi mj ng ml mm mn ij bi translated">要将Wonderchart上传到chartmuseum created，请遵循以下步骤:</p><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="6058" class="oi lb iq oe b gy oj ok l ol om">cd wonderchart</span><span id="c59f" class="oi lb iq oe b gy on ok l ol om"># Create the package to upload<br/>helm package .</span><span id="3ef8" class="oi lb iq oe b gy on ok l ol om"># Above command will create a package: wonderchart-0.1.1.tgz</span><span id="b8d5" class="oi lb iq oe b gy on ok l ol om"># Upload the package<br/>curl --data-binary "@wonderchart-0.1.1.tgz" <!-- -->http://chartmuseum-test.example.com<!-- -->api/charts -u &lt;user&gt;:&lt;password&gt;</span></pre><h2 id="a103" class="oi lb iq bd lc op oq dn lg or os dp lk mb ot ou lm mf ov ow lo mj ox oy lq iw bi translated">如何使用Chartmuseum:</h2><ul class=""><li id="216e" class="mo mp iq lu b lv lw ly lz mb ni mf nj mj nk mn mv mw mx my bi translated">使用以下命令添加chartmuseusm repo:</li></ul><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="e605" class="oi lb iq oe b gy oj ok l ol om">helm repo add &lt;repo-name&gt; http://chartmuseum-test.example.com  — username &lt;user&gt; — password &lt;password&gt;</span><span id="2ce3" class="oi lb iq oe b gy on ok l ol om"># Example:<br/>helm repo add chartmuseum-test <a class="ae nh" href="http://chartmuseum-test.example.com" rel="noopener ugc nofollow" target="_blank">http://chartmuseum-test.example.com</a> ---username user1 --password Password123</span></pre><ul class=""><li id="0b90" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">使用<code class="fe pf pg ph oe b">helm repo list</code>命令查看已添加的回购:</li></ul><pre class="kp kq kr ks gt od oe of og aw oh bi"><span id="3c74" class="oi lb iq oe b gy oj ok l ol om">$ helm repo list</span><span id="c9f4" class="oi lb iq oe b gy on ok l ol om">NAME             URL</span><span id="d267" class="oi lb iq oe b gy on ok l ol om">stable           https://kubernetes-charts.storage.googleapis.com/</span><span id="6209" class="oi lb iq oe b gy on ok l ol om">chartmuseum-test      https://chartmuseum-test.example.com</span></pre><ul class=""><li id="fc7d" class="mo mp iq lu b lv mq ly mr mb ms mf mt mj mu mn mv mw mx my bi translated">使用ChartMuseusm部署一个测试部署，使用:<code class="fe pf pg ph oe b">helm upgrade -i test-deployment chartmuseum-test/wonderchart -f values.yaml</code></li></ul><blockquote class="pp"><p id="34ab" class="pq pr iq bd ps pt pu pv pw px py mn dk translated">您可以在您的CI中使用本节中提到的命令，并使用chartmuseum在kubernetes集群上部署应用程序。</p></blockquote><figure class="qa qb qc qd qe kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pz"><img src="../Images/67808714acccab8cb98e4bbd4563a623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xWYCt9YW7PzncQpLNBLXTA.jpeg"/></div></div></figure><p id="f00d" class="pw-post-body-paragraph ls lt iq lu b lv mq ka lx ly mr kd ma mb ne md me mf nf mh mi mj ng ml mm mn ij bi translated">希望这篇文章有助于解决你面临的一些问题。在过去的两年里，我一直在使用Helm and chartmuseum，它帮助我保持物品整洁。快乐驾驶！！！</p></div></div>    
</body>
</html>