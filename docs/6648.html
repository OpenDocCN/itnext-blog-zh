<html>
<head>
<title>Cross-Platform file downloads using Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter进行跨平台文件下载</h1>
<blockquote>原文：<a href="https://itnext.io/cross-platform-file-downloads-using-flutter-6723d40ee730?source=collection_archive---------0-----------------------#2022-01-17">https://itnext.io/cross-platform-file-downloads-using-flutter-6723d40ee730?source=collection_archive---------0-----------------------#2022-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/be0c3c2ff1f854adb22bfdc67bcbb894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r4mhR7PHYHHh0NTWZlI8dA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:Unsplash | <a class="ae kc" href="https://images.unsplash.com/photo-1544396821-4dd40b938ad3?ixlib=rb-1.2.1&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=873&amp;q=80" rel="noopener ugc nofollow" target="_blank">链接</a></figcaption></figure><h1 id="c72f" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="661e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">嗨，在这篇文章中，我想分享一个我以前没有找到的关于使用Flutter下载文件的解决方案。对于每个特定的平台，这个问题已经解决了，但是对于跨平台应用程序(包括web)还没有一个标准的解决方案。</p><p id="ee31" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这对于在移动设备和网络上运行的应用程序尤其重要。由于每一个平台的环境和硬件都不同，我们需要一个通用的flutter实现，它为所有平台抽象出相同的功能，并在幕后定制实现。</p><h1 id="b849" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">定义问题</h1><p id="19cc" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在为了更好地理解我们想要做什么，让我们定义什么是<strong class="ld ir">前提条件</strong>和<strong class="ld ir">预期行为</strong>。</p><p id="967a" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">作为先决条件，我们有一个运行在Android、iOS和web上的Flutter应用程序，一个指向服务器上托管的文件(在这种情况下是PDF)的URL。</p><p id="758d" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">Android和iOS的<strong class="ld ir">预期行为</strong>是将文件存储在手机文件系统中，并在手机的状态栏中显示结果，在web应用程序的情况下，我们希望以常规浏览器下载的方式下载文件，在这种情况下，我们将打开浏览器选项卡并显示PDF文件。</p><h1 id="eadb" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">实用解决方案:DownloadButton小部件</h1><p id="452d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">由于(几乎)Flutter中的所有东西都是一个小部件，我认为这不会是例外。我们将创建一个下载文件的自定义按钮，该小部件只接收我们想要执行下载的URL，它应该做所有的工作。</p><p id="ad29" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">让我们创建一个简单的Flutter应用程序，在支架主体的中心只有一个按钮。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="b3ee" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为了将实现放入按钮中，让我们为按钮创建一个新文件。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="528b" class="mk ke iq bd kf ml mm dn kj mn mo dp kn lm mp mq kr lq mr ms kv lu mt mu kz mv bi translated">添加必需的依赖项</h2><p id="d8c5" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在，我们需要一些方便的依赖项来访问文件系统、查找目录路径和请求权限等。</p><p id="a8c3" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为此，我们将向pubspec.yaml添加以下包</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><blockquote class="mw mx my"><p id="598a" class="lb lc mz ld b le lz lg lh li ma lk ll na mb lo lp nb mc ls lt nc md lw lx ly ij bi translated"><strong class="ld ir">注意</strong>:检查依赖版本。</p><p id="4e75" class="lb lc mz ld b le lz lg lh li ma lk ll na mb lo lp nb mc ls lt nc md lw lx ly ij bi translated"><strong class="ld ir">注意#2: </strong>查看<a class="ae kc" href="https://pub.dev/packages/permission_handler" rel="noopener ugc nofollow" target="_blank"> permission_handler设置指南</a>在继续之前，您需要为iOS和Android配置设置一些权限。</p></blockquote><p id="8508" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe nd ne nf ng b"><strong class="ld ir">path_provider</strong></code>:对于移动实现，您需要访问应用文档目录，<code class="fe nd ne nf ng b">path_provider</code>包为其提供了一个简单的功能。</p><p id="2c64" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe nd ne nf ng b"><strong class="ld ir">dio</strong></code>:用于执行下载的便捷包，无需担心底层实现(在大文件的情况下，它还提供下载进度回调)。</p><p id="67a5" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe nd ne nf ng b"><strong class="ld ir">permissin_handler</strong></code> <strong class="ld ir"> : </strong>此库用于下载前要求Android/iOS权限。</p><p id="6622" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe nd ne nf ng b"><strong class="ld ir">open_file</strong></code> <strong class="ld ir"> : </strong>用于直接从应用程序中打开下载的文件。</p><p id="1fb1" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe nd ne nf ng b"><strong class="ld ir">universal_html</strong></code>:这对于避免兼容性问题尤为重要。由于手机应用程序不支持<code class="fe nd ne nf ng b">dart:html</code>包。</p><h2 id="0f7b" class="mk ke iq bd kf ml mm dn kj mn mo dp kn lm mp mq kr lq mr ms kv lu mt mu kz mv bi translated">按平台分离实现</h2><p id="a04f" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这种情况下，我们不能使用平台API，因为它在Flutter Web上不受支持，但幸运的是，Flutter团队提供了一个常量来检测应用程序是否是Web。</p><p id="82a2" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">为了使它变得清晰，我们将创建一个抽象服务，它根据平台采取不同的实现。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h2 id="3007" class="mk ke iq bd kf ml mm dn kj mn mo dp kn lm mp mq kr lq mr ms kv lu mt mu kz mv bi translated">颤振网络实现</h2><p id="e0e8" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们从最简单的部分开始，web解决方案。在这里，我们只需要打开一个指向所提供的URL的新浏览器选项卡，浏览器就会完成剩下的工作。听起来很简单，对吗？让我们看看代码。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="1107" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">正如你所看到的，这非常简单，因为我们可以让浏览器通过打开一个带有URL的新标签来完成所有的工作。</p><h2 id="acb1" class="mk ke iq bd kf ml mm dn kj mn mo dp kn lm mp mq kr lq mr ms kv lu mt mu kz mv bi translated">Flutter移动实现</h2><p id="0057" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">不幸的是，在这一部分中，解决方案并不简单明了。为了正确处理下载，我们必须做更多的微观管理。</p><p id="1182" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我们应该注意文件系统和应用程序的权限，以实现访问。所以它需要一些额外的配置。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><h1 id="8dfc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">把所有的放在一起</h1><p id="6f65" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在让我们看看下载按钮小部件如何正确下载文件。</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="mi mj l"/></div></figure><blockquote class="mw mx my"><p id="571f" class="lb lc mz ld b le lz lg lh li ma lk ll na mb lo lp nb mc ls lt nc md lw lx ly ij bi translated"><strong class="ld ir">注意</strong>:现在下载按钮有了一个必需的参数<code class="fe nd ne nf ng b">url</code>，它将由父小部件(在本例中是主页)提供。</p></blockquote><h1 id="2955" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结果</h1><p id="9d1b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们在移动和网络中测试应用程序，看看结果如何。我们可以使用一个<a class="ae kc" href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf" rel="noopener ugc nofollow" target="_blank">虚拟pdf </a>作为输入。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/b3a647ff1a900fcf2bb64bf9c30a175e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*opGkWJ7LuOxhcIEAUu5-SA.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Web示例</figcaption></figure><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d2a9c1355c8327557ea3f885c5fd20e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*Wfgf2SRH5SlL92mdzZb6DQ.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">移动示例</figcaption></figure><h1 id="9e76" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="1e4e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">Flutter很棒，但仍处于成长过程中，并在为常见场景寻找标准解决方案，就像本文中描述的那样。</p><p id="6127" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">尽管如此，它还是带来了解决问题的强大功能和灵活性，widgets方法使得在世界各地的开发人员之间扩展和共享解决方案变得容易，这非常好，尤其是对于开源社区。</p><p id="61ab" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">我希望这篇文章对你有所帮助，如果你发现一些可以改进的地方或任何建议，请在评论中告诉我，如果你正在阅读这篇文章，非常感谢你的时间。😊</p><blockquote class="mw mx my"><p id="cc45" class="lb lc mz ld b le lz lg lh li ma lk ll na mb lo lp nb mc ls lt nc md lw lx ly ij bi translated">你可以使用<a class="ae kc" href="https://github.com/MCarlomagno/flutter_download_button" rel="noopener ugc nofollow" target="_blank">这个链接</a>获得完整的代码</p></blockquote></div></div>    
</body>
</html>