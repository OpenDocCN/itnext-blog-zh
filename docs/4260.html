<html>
<head>
<title>I’ve been coding for almost 40 years, so why do I still do stupid things?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我编码快40年了，为什么还在做傻事？</h1>
<blockquote>原文：<a href="https://itnext.io/ive-been-coding-for-almost-40-years-so-why-do-i-still-do-stupid-things-6ea458b8edff?source=collection_archive---------6-----------------------#2020-05-25">https://itnext.io/ive-been-coding-for-almost-40-years-so-why-do-i-still-do-stupid-things-6ea458b8edff?source=collection_archive---------6-----------------------#2020-05-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/c04f4c3243dfdbaf73cdf73a23b2c218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7w9dpMH2sPGHiApiGP2KSQ.png"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">堪培拉的阴影:作者拍摄的照片。</figcaption></figure><div class=""/><div class=""><h2 id="d89f" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">我刚刚发现了一个bug，这个bug一度让我怀疑自己对Javascript基础的理解。</h2></div><p id="c57c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi lu translated">SS<strong class="la jk">ymptom</strong>:我正在调用一个函数<code class="fe md me mf mg b">getCommonData</code>，它是从一个名为<code class="fe md me mf mg b">feedScanner</code>的模块中加载的。调用<code class="fe md me mf mg b">getCommonData()</code>应该返回实际数据。在单元测试中是这样，但是，在实践中，它会返回到它的初始化状态。</p><pre class="mh mi mj mk gu ml mg mm mn aw mo bi"><span id="337b" class="mp mq jj mg b gz mr ms l mt mu">// This fails as it thinks the scanner has not started.</span><span id="4aff" class="mp mq jj mg b gz mv ms l mt mu">const commonData = getCommonData();<br/>console.debug('commonData', commonData);</span></pre><p id="11d4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">我</span> <strong class="la jk">调查</strong>:看来我的预感是对的，有<strong class="la jk">两个</strong> <code class="fe md me mf mg b">feedScanner</code>模块！WTF。</p><pre class="mh mi mj mk gu ml mg mm mn aw mo bi"><span id="f9a4" class="mp mq jj mg b gz mr ms l mt mu">*** Hey I’m a feedscanner ***<br/>*** Hey I’m a feedscanner ***</span></pre><blockquote class="mw"><p id="a22c" class="mx my jj bd mz na nb nc nd ne nf lt dk translated">Javascript导入被缓存了，为什么我会看到两个T4模块？</p></blockquote><p id="4382" class="pw-post-body-paragraph ky kz jj la b lb ng kk ld le nh kn lg lh ni lj lk ll nj ln lo lp nk lr ls lt in bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">I</span>T27】调查:它<strong class="la jk">一定</strong>与<code class="fe md me mf mg b">webpack</code>配置有关。在这个项目中它是定制的和复杂的。</p><blockquote class="mw"><p id="6538" class="mx my jj bd mz na nl nm nn no np lt dk translated">奇怪的是，也许这一直在发生，但我现在才注意到，因为现在是我第一次依赖这些数据。这可能是真的吗？</p></blockquote><p id="454d" class="pw-post-body-paragraph ky kz jj la b lb ng kk ld le nh kn lg lh ni lj lk ll nj ln lo lp nk lr ls lt in bi translated">也</p><blockquote class="mw"><p id="c8ac" class="mx my jj bd mz na nl nm nn no np lt dk translated">我只是重写了feedScanner是如何被触发的，这样它就不会启动，直到听到一条消息(通过<code class="fe md me mf mg b">window.postMessage</code>)说一些‘公共’数据已经被捕获并准备好供<code class="fe md me mf mg b">feedScanner</code>使用。</p></blockquote><p id="476d" class="pw-post-body-paragraph ky kz jj la b lb ng kk ld le nh kn lg lh ni lj lk ll nj ln lo lp nk lr ls lt in bi translated">到</p><blockquote class="mw"><p id="26e4" class="mx my jj bd mz na nl nm nn no np lt dk translated">也许我真的不理解Javascript <code class="fe md me mf mg b">import</code>系统，或者至少不理解<code class="fe md me mf mg b">Babel</code>对我的代码做了什么，以及它可能会带来哪些奇怪的副作用。</p></blockquote><p id="83a7" class="pw-post-body-paragraph ky kz jj la b lb ng kk ld le nh kn lg lh ni lj lk ll nj ln lo lp nk lr ls lt in bi translated">很多移动部件和很多已经改变了。</p><p id="e90e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">太容易成为替罪羊了<code class="fe md me mf mg b">Webpack</code>。</p><p id="408f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">我</span> <strong class="la jk">调查</strong>:再挖。还是怪我的<code class="fe md me mf mg b">Webpack</code>配置。摆弄我的<code class="fe md me mf mg b">Webpack</code>配置中的东西，比如:</p><pre class="mh mi mj mk gu ml mg mm mn aw mo bi"><span id="3fe3" class="mp mq jj mg b gz mr ms l mt mu">optimization: {<br/> runtimeChunk: ‘single’<br/>}</span></pre><p id="17a6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">这是疯狂的巫术，并迅速给了我四个单独的<code class="fe md me mf mg b">feedScanners</code>！</p><h2 id="3012" class="mp mq jj bd nq nr ns dn nt nu nv dp nw lh nx ny nz ll oa ob oc lp od oe of og bi translated">FML。</h2><h1 id="3036" class="oh mq jj bd nq oi oj ok nt ol om on nw kp oo kq nz ks op kt oc kv oq kw of or bi">❄︎ — — — — — — — — — — — — — — — — — — — — ❄︎</h1><p id="85af" class="pw-post-body-paragraph ky kz jj la b lb os kk ld le ot kn lg lh ou lj lk ll ov ln lo lp ow lr ls lt in bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di">我</span> <strong class="la jk">开始</strong>考虑<em class="ox">陌生人</em>关于为什么可能有两个feedScanners的理论。我重写了很多相邻的代码。<br/>我睡在这个问题上。我醒来时有了一个想法。</p><blockquote class="mw"><p id="a763" class="mx my jj bd mz na nl nm nn no np lt dk translated">可能不是<code class="fe md me mf mg b">Webpack</code>。</p></blockquote><h1 id="76af" class="oh mq jj bd nq oi oj ok nt ol om on nw kp oy kq nz ks oz kt oc kv pa kw of or bi">❄︎ — — — — — — — — — — — — — — — — — — — — ❄︎</h1><h1 id="edaa" class="oh mq jj bd nq oi oj ok nt ol om on nw kp oo kq nz ks op kt oc kv oq kw of or bi translated"><span class="l lv lw lx bm ly lz ma mb mc di"> T </span>何的问题</h1><h2 id="78c5" class="mp mq jj bd nq nr ns dn nt nu nv dp nw lh nx ny nz ll oa ob oc lp od oe of og bi translated">简单地说。</h2><p id="4279" class="pw-post-body-paragraph ky kz jj la b lb os kk ld le ot kn lg lh ou lj lk ll ov ln lo lp ow lr ls lt in bi lu translated">当你解决一个问题时，没有比实现的洪流更好的了。唉，最终的结果是，你可以在一堆证据中增加一条，证明你实际上是一个多么愚蠢的人。</p><p id="6060" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在接收空数据的文件中:</p><pre class="mh mi mj mk gu ml mg mm mn aw mo bi"><span id="0beb" class="mp mq jj mg b gz mr ms l mt mu">import { getCommonData } from ‘src/content/feedscanner’;</span></pre><p id="3778" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在所有其他与<code class="fe md me mf mg b">feedScanner</code>模块相关的文件中:</p><pre class="mh mi mj mk gu ml mg mm mn aw mo bi"><span id="2371" class="mp mq jj mg b gz mr ms l mt mu">import { start } from ‘src/content/feedScanner’;</span></pre><p id="9253" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated"><code class="fe md me mf mg b">Webpack</code> <strong class="la jk">正在</strong>加载<em class="ox">两个</em> <code class="fe md me mf mg b">feedScanner</code>模块——但这既不是<code class="fe md me mf mg b">Webpack</code>的错，也不是我的配置的错。这是更平淡无奇的东西。</p><p id="2036" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi lu translated"><span class="l lv lw lx bm ly lz ma mb mc di"> T </span> <strong class="la jk"> he </strong>正确的拼写应该是‘feedScanner’但是macOS作为一个<em class="ox">非装箱</em>文件系统没有注意到。但是<code class="fe md me mf mg b">Webpack</code>关心大小写，并假设它们是两个不同的模块。然而，它从同一个文件中提取了它们，所以它们是相同的代码，但是对<code class="fe md me mf mg b">Webpack</code>来说，它看起来像是不同的文件，对最终的Javascript来说，它们是两个独立的模块。</p><h1 id="d8c7" class="oh mq jj bd nq oi oj ok nt ol om on nw kp oo kq nz ks op kt oc kv oq kw of or bi translated">吸取的教训</h1><p id="3b91" class="pw-post-body-paragraph ky kz jj la b lb os kk ld le ot kn lg lh ou lj lk ll ov ln lo lp ow lr ls lt in bi lu translated">F  <strong class="la jk">或第一百次</strong> : macOS不是一个区分大小写的文件系统，这并不总是由<code class="fe md me mf mg b">Webpack</code>或你的<code class="fe md me mf mg b">Webpack</code>配置造成的。</p><p id="96cb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">记住，伙计们，斯特金法则和其他任何东西一样适用于你自己。</p><p id="6099" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">感谢阅读。</p><p id="e02d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi">—</p><p id="f5f2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">像这样但不是订户？你可以通过<a class="ae pb" href="https://davesag.medium.com/membership" rel="noopener">davesag.medium.com</a>加入来支持作者。</p></div></div>    
</body>
</html>