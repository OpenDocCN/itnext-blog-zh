<html>
<head>
<title>Setup Metricbeat on Kubernetes and config Kibana dashboard to visualize cluster data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上设置Metricbeat并配置Kibana仪表板以可视化集群数据</h1>
<blockquote>原文：<a href="https://itnext.io/config-kibana-dashboard-to-visualize-your-kubernetes-cluster-data-20a87bd7111d?source=collection_archive---------2-----------------------#2020-06-24">https://itnext.io/config-kibana-dashboard-to-visualize-your-kubernetes-cluster-data-20a87bd7111d?source=collection_archive---------2-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2a36" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">什么是基巴纳？</p><p id="0d0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">ibana是一个开源应用程序，为Elasticsearch中的索引数据提供搜索和数据可视化功能。Kibana主要充当监控和管理弹性堆栈集群的用户界面。</p><p id="5f57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kibana通过创建条形图、饼图、表格、直方图和地图来简化数据分析。然后，仪表板视图将这些可视元素组合起来，然后通过浏览器共享，以提供实时分析视图。</p><p id="3d62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您也可以使用Kibana来分析Kubernetes集群的健康状况。它允许您通过分布在任何云环境中的pod、名称空间和节点来分析所有容器的健康状况。</p><p id="a988" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天，我将使用弹性搜索云来导出和可视化我的Kubernetes集群指标。</p><p id="6017" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经使用https://cloud.elastic.co/home的弹性云<a class="ae kx" href="https://cloud.elastic.co/home" rel="noopener ugc nofollow" target="_blank">创建了一个弹性部署，如下图所示。</a></p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/97557678c6dffd44725d96a808fc2095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQXArD1ojD35r_Hpd4t0uw.png"/></div></div></figure><p id="1bc1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我将把Kubernetes集群指标导出到这个弹性云部署中。首先，我们需要将metric-beat部署部署到我们的Kubernetes集群。</p><p id="040d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用标准的elastic helm repo将metric-beat安装到集群中。但是要让metric-beat将指标发送到您的弹性云部署，您需要修改标准弹性/metricbeat repo的values.yaml。你可以使用<a class="ae kx" href="https://github.com/madeesha/metricbeat/blob/master/values.yaml" rel="noopener ugc nofollow" target="_blank">自定义数值。我提交给我自己的git回购的YAML </a>文件。将内容复制到一个本地文件，在文件中搜索“elastic_cloud_id”和“elastic_password ”,并用实际的elastic cloud部署id和密码替换它。确保在values.yaml文件中替换daemonset和deployment的值。然后使用该文件将metric-beat helm chart安装到您的Kubernetes集群中。</p><pre class="kz la lb lc gt lk ll lm ln aw lo bi"><span id="ae71" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">helm repo add elastic https://Helm.elastic.co</strong></span><span id="7fb4" class="lp lq it ll b gy lv ls l lt lu"><strong class="ll iu">helm install  metricbeat elastic/metricbeat -f values.yaml</strong></span></pre><p id="3d94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果此命令成功，您将能够看到metric beats pods已成功部署到您的集群，如下所示。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lw"><img src="../Images/63189bc1532f0e3659f08c9145e8de70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lFsFaLP5iaBEBvDe2OwwFA.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lx"><img src="../Images/7fa9a30cb6fa78cf07ddf14b596a81ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7JJDBC37yKPy-XmNjdb4Aw.png"/></div></div></figure><p id="e5cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，metric-beat设置为向您的弹性云部署发送集群指标。然后我们可以在Kibana中配置索引模式，开始分析数据。在Kibana中，进入<strong class="js iu">管理→ Kibana →索引模式</strong>页面，点击<strong class="js iu">创建索引模式</strong>。Kibana将自动识别和显示Metricbeat指数。</p><p id="8212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输入'<em class="ly"> metricbeat-* </em>'并在下一步选择<em class="ly"> @timestamp </em>字段，以完成在Kibana中创建索引模式。</p><p id="aea8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在转到<strong class="js iu"> Kibana → Discover </strong>页面，您将看到从Kubernetes集群收集的所有指标都显示在那里。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lz"><img src="../Images/9e46f48cea52de8f6fbc948e3aad123a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GchdWYh4mx8NAnmpShb7aw.png"/></div></div></figure><p id="9d0c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在剩下要做的就是创建一个Kibana仪表板来可视化指标数据。为此，我们可以简单地将metric-beat安装到我们的本地机器中，并将标准的Kibana仪表板加载到我们的Kibana部署中。</p><p id="20d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae kx" href="https://www.elastic.co/guide/en/beats/metricbeat/7.7/metricbeat-installation.html" rel="noopener ugc nofollow" target="_blank">安装公制节拍</a>:</p><pre class="kz la lb lc gt lk ll lm ln aw lo bi"><span id="a9ca" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">curl -L -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.7.1-linux-x86_64.tar.gz<br/>tar xzvf metricbeat-7.7.1-linux-x86_64.tar.gz</strong></span></pre><p id="f9b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后打开metric beat-7 . 7 . 1-Linux-x86 _ 64/metric beat . YAML文件，取消“cloud.id”和“cloud.auth”变量的注释，并给出正确的值。cloud.auth值应该是弹性用户名和密码的组合。</p><p id="a7df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">cloud . auth = " elastic:elastic _ cloud _密码"</p><p id="e1cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后您可以使用下面的命令加载Kibana仪表板，</p><pre class="kz la lb lc gt lk ll lm ln aw lo bi"><span id="67e4" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">cd metricbeat-7.7.1-linux-x86_64</strong><br/><strong class="ll iu">./metricbeat setup --dashboards</strong></span></pre><p id="634c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，转到Kibana →仪表盘→ <a class="ae kx" href="https://7b68ae1bbdd745f6a7781fdfe6340ea2.ap-southeast-2.aws.found.io:9243/app/kibana#/dashboard/AV4RGUqo5NkDleZmzKuZ-ecs" rel="noopener ugc nofollow" target="_blank"> [Metricbeat Kubernetes]概述ECS </a>仪表盘，您将能够看到一个包含所有Kubernetes指标的漂亮仪表盘。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ma"><img src="../Images/f41eb1dbe1c6256bd219ff9b92c5dfdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NH7BjUpuoEkIFU-DPvWYA.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mb"><img src="../Images/8f98849e90a51b525dbb8043a0df9853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySCmSkBLXirfM5Hi4pVMbA.png"/></div></div></figure><p id="3ba1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以现在，你已经成功地配置了Kubernetes metric-beat与弹性云Kibana仪表板。干杯！！！</p></div></div>    
</body>
</html>