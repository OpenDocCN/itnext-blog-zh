<html>
<head>
<title>The roots of data visualization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据可视化的根源</h1>
<blockquote>原文：<a href="https://itnext.io/the-roots-of-data-visualization-9e6ca7c1a884?source=collection_archive---------7-----------------------#2018-03-11">https://itnext.io/the-roots-of-data-visualization-9e6ca7c1a884?source=collection_archive---------7-----------------------#2018-03-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="0a52" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fthe-roots-of-data-visualization-9e6ca7c1a884" rel="noopener ugc nofollow" target="_blank"> <em class="kp">点击这里在LinkedIn上分享这篇文章</em> </a></p><p id="f17a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很多年前，我读过保罗·格拉厄姆写的一篇非常鼓舞人心的文章:<a class="ae ko" href="http://www.paulgraham.com/rootsoflisp.html" rel="noopener ugc nofollow" target="_blank">Lisp的根源</a>。给定有限数量的操作符和一个单一的数据结构(列表)，您可以构建一种编程语言。那一刻，我被简单的哲学震惊了:一方面，lisp很小，每个操作符都很简单；另一方面，像宏、高阶函数、递归之类的东西可以帮助你构建任何复杂的程序员。最美妙的是，复杂的东西是用最简单的组件建造的。</p><p id="fbfd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最近，我在研究与数据可视化相关的东西，发现同样的哲学也适用于这里。一个吸引人的、漂亮的数据可视化可能只由很少的元素组成，如形状、长度、颜色、纹理和角度。</p><p id="b446" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实际上，Nathan Yau是《数据点:有意义的可视化》一书的作者，他在下图中列出了书中常用的元素:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/9264f7566aaa48e5059ef7d7247fabb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLTp1PleiyO-i6lxUI8mCQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">视觉线索——来自Nathan Yau</figcaption></figure><p id="a86d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">令人兴奋的事实是，通过将这些元素组合在一起，您可能会实现<code class="fe lg lh li lj b">1+1&gt;2</code>。</p><h1 id="5ac4" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">心理学和认知系统</h1><p id="2ce0" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">数据可视化实际上是基于人类的视觉认知系统。因此，对人类视觉系统如何工作的一些理解可以帮助我们设计更有效的可视化(更快地向读者传递我们想要表达的信息)。</p><h2 id="afa1" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">心理学</h2><p id="11c4" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">在生活中，我们会遇到这样的情景:如果一件产品原价10美元，如果折扣价是5美元，消费者将极有可能购买它；但是如果产品的价格是100美元，打折后的价格是95美元，那就没那么有吸引力了。所以这两种折扣的绝对数量是相同的(都是5美元)，但效果是不一样的。</p><p id="8866" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这被描述为<a class="ae ko" href="https://en.wikipedia.org/wiki/Weber%E2%80%93Fechner_law" rel="noopener ugc nofollow" target="_blank">韦伯-费希纳定律</a>:</p><blockquote class="mz na nb"><p id="0d6b" class="jq jr kp js b jt ju jv jw jx jy jz ka nc kc kd ke nd kg kh ki ne kk kl km kn im bi translated"><em class="it">韦伯-费希纳定律是指心理物理学领域的两个相关定律，即韦伯定律和费希纳定律。这两个定律都与人类感知有关，更具体地说，与物理刺激的实际变化和感知变化之间的关系有关。这包括对所有感官的刺激:视觉、听觉、味觉、触觉和嗅觉。</em></p></blockquote><p id="1187" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可能会影响到我们在设计一些可视化时，需要考虑以下事情:</p><ul class=""><li id="02c1" class="nf ng it js b jt ju jx jy kb nh kf ni kj nj kn nk nl nm nn bi translated">避免使用面积进行比较</li><li id="5764" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">当差异足够大时，考虑使用非线性视觉元素</li><li id="1097" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">使用多种颜色作为视觉编码时，使色差足够大</li></ul><p id="bc69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/ad4a40620af6ad1da9f8634343c0a730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vinCIoEWIUgsBoZRqOWEhw.png"/></div></div></figure><p id="72a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的图像中，当面积增加时，你很难通过正方形来区分实际的差异。如果仔细观察底层数据，会发现绝对差都是5:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="b497" class="mn ll it lj b gy ny nz l oa ob">var data = [<br/>  {width: 5, height: 5},<br/>  {width: 10, height: 10},</span><span id="8c12" class="mn ll it lj b gy oc nz l oa ob">  {width: 50, height: 50},<br/>  {width: 55, height: 55},</span><span id="a29d" class="mn ll it lj b gy oc nz l oa ob">  {width: 100, height: 100},<br/>  {width: 105, height: 105}<br/>];</span></pre><h2 id="1bf9" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">格式塔心理学</h2><blockquote class="mz na nb"><p id="5249" class="jq jr kp js b jt ju jv jw jx jy jz ka nc kc kd ke nd kg kh ki ne kk kl km kn im bi translated"><em class="it">格式塔心理学或格式塔主义(德语:格式塔[ɡəˈʃtalt]“形状，形式”)是柏林实验心理学派的一种心灵哲学。格式塔心理学试图理解在一个明显混乱的世界中获得和保持有意义的感知能力背后的规律。格式塔心理学的中心原则是，心灵形成一个具有自组织倾向的全球整体。</em></p></blockquote><p id="8d5f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它强调人类看到一个画面，会先简化成一个整体，再细化成各个部分；而不是先识别每个部分，再组合成一个整体。</p><p id="4b02" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最著名的达尔马提亚狗:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/5b4134ca52a7cbcc7c0e37c49986484b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SYXKQfQUee-Tv0Dk6FMljA.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">著名的达尔马提亚狗</figcaption></figure><p id="6a1e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以很容易地(嗯，也许没那么容易)识别出一只在悬垂的树荫下嗅着地面的狗，但是通过首先识别它的身体部位，狗是不会被识别出来的。</p><p id="1197" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实际上，格式塔原则包含许多次级原则:</p><ul class=""><li id="4c95" class="nf ng it js b jt ju jx jy kb nh kf ni kj nj kn nk nl nm nn bi translated">邻近定律</li><li id="1e9c" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">类似律</li><li id="c598" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">闭合定律</li><li id="b675" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">对称定律</li><li id="2cc9" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">共同命运法则</li></ul><p id="305a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不会一一列举，因为互联网上有很多这样的例子。请记住，当你设计一些可视化产品时，考虑使用这些法则来帮助你建立一些易于人们消费的东西。</p><h1 id="9991" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">视觉设计的基本原则</h1><p id="52aa" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">在他的书<em class="kp">非设计师的设计书</em>中，Robin Williams讨论了视觉设计的4个非常基本的原则:</p><ul class=""><li id="55cf" class="nf ng it js b jt ju jx jy kb nh kf ni kj nj kn nk nl nm nn bi translated">对比(使用不同的颜色、字体、字号来构建信息层次)</li><li id="8bea" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">重复(重复样式，如标题所用的颜色)</li><li id="6591" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">对齐(垂直或水平对齐)</li><li id="c2ca" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">邻近性(将相关事物放得更近)</li></ul><p id="026f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看看这个简单的例子:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/c8d4d48acb7a4b8d5885011a257bd9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uQlDV0xr8C7MoN5Y97m7OQ.png"/></div></div></figure><h2 id="8f83" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">一些简单的用法</h2><ul class=""><li id="bccc" class="nf ng it js b jt mi jx mj kb oe kf of kj og kn nk nl nm nn bi translated">淡化折线图的背景网格(对比)</li><li id="ba61" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">突出显示异常值(不同颜色形成对比)</li><li id="957a" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">图表和图例中使用的颜色(重复)</li><li id="42a4" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">靠近轴的标签(接近度)</li></ul><p id="3f99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，理论已经足够了，让我们跳到一个非常具体的例子，看看我们如何将这些原则应用于它。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/f39bcd44a0496f9ff16b06db1d7cf4b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFCYSBMOOlGDjSbgfB5Hpg.png"/></div></div></figure><h1 id="f340" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">星夜图</h1><p id="d843" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">我从我女儿的日常活动中收集了一些数据(基本上，她只做3种事情:吃饭、睡觉和玩一会儿)。</p><p id="7b6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据可视化的第一步是<code class="fe lg lh li lj b">what do you want to get from the data</code>，在这种情况下，我只想知道她每天睡多少小时，分布情况如何。</p><h2 id="91cd" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">增强型条形图</h2><p id="faad" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">一旦我有了视觉化的概念，下一步就是选择正确的视觉编码。所以对于我们人类的眼睛来说，最准确的编码是<code class="fe lg lh li lj b">length</code>。我需要将<code class="fe lg lh li lj b">sleeping hours</code>转换成<code class="fe lg lh li lj b">length</code>，最简单的方法是条形图。</p><p id="6fe5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们期望的数据(CSV格式)如下:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="c727" class="mn ll it lj b gy ny nz l oa ob">2016/11/21,768<br/>2016/11/22,760<br/>2016/11/23,700</span></pre><p id="245b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">第一个字段是日期，第二个字段是睡眠时间。我在纸上画了一些草图，如图所示:</p><p id="f9c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Y轴表示24小时内每天的时间，X轴表示日期。实心矩形表示她在睡觉，而虚线矩形表示她醒着。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oh"><img src="../Images/917f76b83c97d85213acf6497bcfdca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cG8xZDJFkV4CDdQFPbCiig.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">起草</figcaption></figure><h2 id="7d51" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">原始数据</h2><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="6dc0" class="mn ll it lj b gy ny nz l oa ob">name,date,length,note<br/>心心,2016/11/21 19:23,119,<br/>心心,2016/11/21 22:04,211,<br/>心心,2016/11/22 02:03,19,<br/>心心,2016/11/22 02:23,118,<br/>心心,2016/11/22 05:58,242,<br/>心心,2016/11/22 10:57,128,<br/>心心,2016/11/22 14:35,127,<br/>心心,2016/11/22 17:15,127,<br/>心心,2016/11/22 20:02,177,<br/>心心,2016/11/23 01:27,197,</span></pre><p id="096a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有一个小问题，就是我们的Y轴是固定长度的，如果她从23:00开始睡觉，3个小时后醒来，那么Y轴上的横条将超过24。</p><p id="1f32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我写了一个简单的脚本来转换数据:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="468e" class="mn ll it lj b gy ny nz l oa ob">require 'csv'<br/>require 'active_support/all'<br/>require 'json'</span><span id="7726" class="mn ll it lj b gy oc nz l oa ob">csv = CSV.read('./visualization/data/sleeping_data_refined.csv', :headers =&gt; :first_row)</span><span id="5e19" class="mn ll it lj b gy oc nz l oa ob">data = []<br/>csv.each do |row|<br/>    date = DateTime.parse(row['date'], "%Y/%m/%d %H:%M")<br/>    <br/>    mins_until_end_of_day = date.seconds_until_end_of_day / 60<br/>    diff = mins_until_end_of_day - row['length'].to_i<br/>    <br/>    if (diff &gt;= 0) then<br/>        data &lt;&lt; {<br/>            :name =&gt; row['name'],<br/>            :date =&gt; row['date'],<br/>            :length =&gt; row['length'],<br/>            :note =&gt; row['note']<br/>        }<br/>    else <br/>        data &lt;&lt; {<br/>            :name =&gt; row['name'],<br/>            :date =&gt; date.strftime("%Y/%m/%d %H:%M"),<br/>            :length =&gt; mins_until_end_of_day,<br/>            :note =&gt; row['note']<br/>        }</span><span id="8160" class="mn ll it lj b gy oc nz l oa ob">        data &lt;&lt; {<br/>            :name =&gt; row['name'],<br/>            :date =&gt; (date.beginning_of_day + 1.day).strftime("%Y/%m/%d %H:%M"),<br/>            :length =&gt; diff.abs,<br/>            :note =&gt; row['note']<br/>        }<br/>    end<br/>end</span></pre><p id="229e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦我们有了<code class="fe lg lh li lj b">cleaned</code>数据，我们就可以试着画出条形图。以下是需要考虑的几点:</p><ul class=""><li id="b214" class="nf ng it js b jt ju jx jy kb nh kf ni kj nj kn nk nl nm nn bi translated">时间应该与零对齐</li><li id="4064" class="nf ng it js b jt no jx np kb nq kf nr kj ns kn nk nl nm nn bi translated">她睡得越久，酒吧就应该越深</li></ul><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="6a45" class="mn ll it lj b gy ny nz l oa ob">var dateRange = _.uniq(data, function(d) {<br/>    var date = d.date;<br/>    return [date.getYear(), date.getMonth(), date.getDate()].join("/");<br/>});</span><span id="6793" class="mn ll it lj b gy oc nz l oa ob">xScale.domain(dateRange.map(function(d) { return d.date; }));</span><span id="cc9c" class="mn ll it lj b gy oc nz l oa ob">function getFirstInDomain(date) {<br/>    var domain = xScale.domain();</span><span id="fbc8" class="mn ll it lj b gy oc nz l oa ob">    var index = _.findIndex(domain, function(d) {<br/>        return date.getYear() === d.getYear() <br/>            &amp;&amp; date.getMonth() === d.getMonth() <br/>            &amp;&amp; date.getDate() === d.getDate();<br/>    });</span><span id="9727" class="mn ll it lj b gy oc nz l oa ob">    return domain[index];<br/>}</span></pre><p id="08b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">函数<code class="fe lg lh li lj b">getFirstInDomain</code>按日期返回<code class="fe lg lh li lj b">X</code>，所以日期<code class="fe lg lh li lj b">2016/11/21 19:23</code>和<code class="fe lg lh li lj b">2016/11/21 22:04</code>将返回d3.scale的一个整数</p><p id="0cde" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以根据睡眠时间将睡眠质量分为5个等级，使用d3非常简单:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="2017" class="mn ll it lj b gy ny nz l oa ob">var level = d3.scale.threshold()<br/>  .domain([60, 120, 180, 240, 300])<br/>  .range(["low", "fine", "medium", "good", "great", "prefect"]);</span></pre><p id="1396" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以在矩形上添加不同的<code class="fe lg lh li lj b">CSS Class</code>:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="fb33" class="mn ll it lj b gy ny nz l oa ob">svg.selectAll(".bar")<br/>    .data(data)<br/>    .enter()<br/>    .append("rect")<br/>    .attr("class", function(d) {<br/>        return level(d.length)+" bar";<br/>    })<br/>//...</span></pre><p id="ff3d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，最后的输出看起来是这样的。我们可以知道她早上0-6点睡觉，然后下午10-13点，最后晚上18-20点睡觉。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/cdf80b683a541e1b252118203dd876ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grQiISxW_Z3lfmDJolSRrQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">星形条形图</figcaption></figure><h2 id="86ee" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">星夜图</h2><p id="bd26" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">但是当数据增加时就有问题了。我们可以尝试另一种方式，比如径向轴。因为我们设想了与<code class="fe lg lh li lj b">time</code>相关的东西，所以实现<code class="fe lg lh li lj b">watch</code>的周期会很棒。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oi"><img src="../Images/9f717c68fc4ed74f301085249021e74f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVooMQarDbkh-L3z9_iLrA.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">星夜图草稿</figcaption></figure><h2 id="eff2" class="mn ll it bd lm mo mp dn lq mq mr dp lu kb ms mt ly kf mu mv mc kj mw mx mg my bi translated">将角度转换为弧度</h2><p id="ba7c" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">这里需要一点数学，我们先把圆(360度)分成分钟，然后每分钟的角度数为:<code class="fe lg lh li lj b">360/(24*60)</code>，再用公式把角度换算成弧度:<code class="fe lg lh li lj b">degree * π/180</code>:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="e859" class="mn ll it lj b gy ny nz l oa ob">var perAngle = (360 / (24 * 60)) * (Math.PI/180);</span></pre><p id="372d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于任何特定的时间，比如说<code class="fe lg lh li lj b">10:20</code>，我们首先计算分钟数:<code class="fe lg lh li lj b">10*60+20</code>，乘以<code class="fe lg lh li lj b">preAngle</code>，结果就是起始弧角，再加上睡眠分钟数的倍数<code class="fe lg lh li lj b">preAngle</code>就得到终止弧角:</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="ac33" class="mn ll it lj b gy ny nz l oa ob">function startAngle(date) {<br/>    var start = (date.getHours() * 60 + date.getMinutes()) * perAngle;<br/>    return Math.floor(start*1000)/1000;<br/>}</span><span id="6536" class="mn ll it lj b gy oc nz l oa ob">function endAngle(date, length) {<br/>    var end = (date.getHours() * 60 + date.getMinutes() + length) * perAngle;<br/>    return Math.floor(end*1000)/1000;<br/>}</span></pre><p id="ed4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以结果看起来是这样的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/3079e76946b6562a8090ccbfa24c5eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pX75f6CdF8sTkM34Z-8L4w.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">星图(部分)</figcaption></figure><p id="d6fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，我们可以使用线性比例和<em class="kp"> svg </em>渐变来为图形绘制图例(非常感谢<a class="ae ko" href="https://www.visualcinnamon.com/2016/05/smooth-color-legend-d3-svg-gradient.html" rel="noopener ugc nofollow" target="_blank">关于svg渐变</a>的伟大帖子<em class="kp"> Nadieh Bremer </em>)。):</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="0f4b" class="mn ll it lj b gy ny nz l oa ob">var colorScale = d3.scale.linear()<br/>  .range(["#2c7bb6", "#00a6ca","#00ccbc","#90eb9d","#ffff8c","#f9d057"].reverse());</span><span id="f7ba" class="mn ll it lj b gy oc nz l oa ob">var defs = vis.append("defs");</span><span id="e578" class="mn ll it lj b gy oc nz l oa ob">var linearGradient = defs.append("linearGradient")<br/>    .attr("id", "linear-gradient")<br/>    .attr("x1", "0%")<br/>    .attr("y1", "0%")<br/>    .attr("x2", "100%")<br/>    .attr("y2", "0%");</span><span id="1ef1" class="mn ll it lj b gy oc nz l oa ob">linearGradient.selectAll("stop") <br/>  .data( colorScale.range() )                  <br/>  .enter().append("stop")<br/>  .attr("offset", function(d,i) { return i/(colorScale.range().length-1); })<br/>  .attr("stop-color", function(d) { return d; });</span></pre><p id="49a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦我们有了梯度和范围，我们就可以用它来绘制图例。</p><pre class="kr ks kt ku gt nu lj nv nw aw nx bi"><span id="6b2f" class="mn ll it lj b gy ny nz l oa ob">var legendWidth = 300;</span><span id="eaa2" class="mn ll it lj b gy oc nz l oa ob">var legendsvg = vis.append("g")<br/>  .attr("class", "legendWrapper")<br/>  .attr("transform", "translate(" + (width/2+legendWidth) + "," + (height - 40) + ")");</span><span id="90c5" class="mn ll it lj b gy oc nz l oa ob">//Draw the Rectangle<br/>legendsvg.append("rect")<br/>  .attr("class", "legendRect")<br/>  .attr("x", -legendWidth/2)<br/>  .attr("y", 0)<br/>  .attr("width", legendWidth)<br/>  .attr("height", 3.5)<br/>  .style("fill", "url(#linear-gradient)");<br/>  <br/>//Append title<br/>legendsvg.append("text")<br/>  .attr("class", "legendTitle")<br/>  .attr("x", 0)<br/>  .attr("y", -10)<br/>  .style("text-anchor", "middle")<br/>  .text("Sleeping Minutes");</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oj"><img src="../Images/60859147b6317a23edaeeec23dd15cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0SVhikl_rUKVCw4D_viTnw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">带图例的星夜图</figcaption></figure><p id="84e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还为每个弧线添加了一个工具提示。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi nt"><img src="../Images/dfebf9d44c901996890d4bc6b51862d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pvR229z3o_wIhV-dvQ6kTA.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">悬停时的工具提示</figcaption></figure><p id="d5c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最终的可运行演示在这里托管:<a class="ae ko" href="http://bl.ocks.org/abruzzi/d01a221df9cf79b918a00033695092c9" rel="noopener ugc nofollow" target="_blank">欣欣的睡眠状态</a>，你可以在这里找到所有的<a class="ae ko" href="(https://github.com/abruzzi/health-recording)" rel="noopener ugc nofollow" target="_blank">代码</a>。</p><p id="4e8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">添加一些背景图片后，最终版本看起来是这样的:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ok"><img src="../Images/52e83fe3d9e2bdccbbe6ce18369db6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CxX8nL9a3AMcVVL6ZJwkg.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">星夜图的最终版本</figcaption></figure><h1 id="9bca" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">摘要</h1><p id="0897" class="pw-post-body-paragraph jq jr it js b jt mi jv jw jx mj jz ka kb mk kd ke kf ml kh ki kj mm kl km kn im bi translated">我们讨论了数据可视化的一些理论，以及构建一个真正的可视化程序的原子元素。我们也谈到了视觉设计的一些原则，可以使表达更有效。最后，有一个端到端的例子，说明我们如何应用这些原则和理论来制作一个有意义的，美丽的图形。</p></div></div>    
</body>
</html>