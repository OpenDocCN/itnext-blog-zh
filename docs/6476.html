<html>
<head>
<title>Chrome Extension Development with Nx Workspace &amp; Angular v13 — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nx Workspace和Angular v13开发Chrome扩展—第2部分</h1>
<blockquote>原文：<a href="https://itnext.io/chrome-extension-development-with-nx-workspace-angular-v13-f9163e545c8f?source=collection_archive---------2-----------------------#2021-11-28">https://itnext.io/chrome-extension-development-with-nx-workspace-angular-v13-f9163e545c8f?source=collection_archive---------2-----------------------#2021-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b24417ca6d6608f5f6a3682f4379deee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PMzoZwbaE54iYTRdSR3MsA.png"/></div></div></figure><p id="89fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我试图为个人使用创建一个简单的Chrome扩展。然后指出这可以使用HTML、CSS &amp; JavaScript来完成。</p><p id="0a44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" rel="noopener ugc nofollow" target="_blank" href="/chrome-extension-development-with-nx-workspace-angular-v13-48cf3d2c2a41"> <strong class="kd iu">第1部分:入门</strong> </a> <strong class="kd iu"> <br/> </strong> <a class="ae kz" href="https://medium.com/@dalenguyen/chrome-extension-development-with-nx-workspace-angular-v13-f9163e545c8f" rel="noopener"> <strong class="kd iu">第2部分:更改背景颜色</strong></a><strong class="kd iu"><br/></strong><a class="ae kz" href="https://medium.com/@dalenguyen/chrome-extension-development-with-nx-workspace-angular-v13-part-3-f824c0baf75f" rel="noopener"><strong class="kd iu">第3部分:添加上下文菜单</strong></a><strong class="kd iu"><br/></strong><a class="ae kz" href="https://medium.com/@dalenguyen/chrome-extension-development-with-nx-workspace-angular-v13-part-4-948fcc51e0f8" rel="noopener"><strong class="kd iu">第4部分:发送HTTP请求</strong></a><br/><a class="ae kz" href="https://dalenguyen.medium.com/chrome-extension-development-with-nx-workspace-angular-v13-part-5-7245829ea87c" rel="noopener"><strong class="kd iu">第5部分:添加内容脚本</strong> </a></p><p id="8632" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://github.com/dalenguyen/dalenguyen.github.io/tree/dev/apps/ext-utils" rel="noopener ugc nofollow" target="_blank"> Github示例</a></p><p id="35d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上一篇文章中，我介绍了用Nx &amp; Angular开发chrome扩展的基本结构。在这一集里，我将向你展示一些真实的行动。</p><p id="16dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<a class="ae kz" href="https://developer.chrome.com/docs/extensions/mv3/getstarted/" rel="noopener ugc nofollow" target="_blank">这个例子</a>中，我将创建一个按钮，以便用绿色更新站点的背景色。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi la"><img src="../Images/686d08822bb5b136bbdb7b1ca73be89b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*vw5B5NXndF5E3x4Pn0wSog.png"/></div></figure><p id="6759" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">安装@types/chrome </strong></p><p id="911e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在Angular中输入非常有用，因此您将看到对您的实现的建议</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2966" class="lk ll it lg b gy lm ln l lo lp">yarn add -D @types/chrome</span></pre><p id="ef74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">创建后台脚本</strong></p><blockquote class="lq lr ls"><p id="70a0" class="kb kc lt kd b ke kf kg kh ki kj kk kl lu kn ko kp lv kr ks kt lw kv kw kx ky im bi translated">扩展是基于事件的程序，用于修改或增强Chrome浏览体验。事件是浏览器触发器，例如导航到新页面、移除书签或关闭标签。扩展在其后台脚本中监控这些事件，然后根据指定的指令做出反应。</p></blockquote><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="c7eb" class="lk ll it lg b gy lm ln l lo lp">// src/background.ts</span><span id="c31a" class="lk ll it lg b gy lx ln l lo lp">/// &lt;reference types="chrome"/&gt;</span><span id="9bd1" class="lk ll it lg b gy lx ln l lo lp">const color = '#3aa757'</span><span id="9b3e" class="lk ll it lg b gy lx ln l lo lp">chrome.runtime.onInstalled.addListener(() =&gt; {<br/>  chrome.storage.sync.set({ color })<br/>  console.log('Default background color set to %cgreen', `color: ${color}`)<br/>})</span></pre><p id="5cad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该脚本以一个监听事件<code class="fe ly lz ma lg b">onInstalled</code>开始，然后为存储设置一个颜色值——记住将<strong class="kd iu">存储</strong>添加到manifest.json中的权限中</p><p id="c54e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此时，您的manifest.json将如下所示</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e530" class="lk ll it lg b gy lm ln l lo lp">{<br/>  "name": "Great Extension",<br/>  "version": "1.0",<br/>  "description": "Build an Extension with Angular",<br/>  "manifest_version": 3,<br/>  "action": {<br/>    "default_popup": "index.html",<br/>    "default_icon": {<br/>      "16": "assets/images/get_started16.png",<br/>      "32": "assets/images/get_started32.png",<br/>      "48": "assets/images/get_started48.png",<br/>      "128": "assets/images/get_started128.png"<br/>    }<br/>  },<br/>  "icons": {<br/>    "16": "assets/images/get_started16.png",<br/>    "32": "assets/images/get_started32.png",<br/>    "48": "assets/images/get_started48.png",<br/>    "128": "assets/images/get_started128.png"<br/>  },<br/>  "background": {<br/>    "service_worker": "<strong class="lg iu">background.js</strong>"<br/>  },<br/>  "permissions": ["<strong class="lg iu">storage</strong>", "activeTab", "scripting"]<br/>}</span></pre><p id="17c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">在Angular项目中准备背景脚本</strong></p><p id="c622" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于<code class="fe ly lz ma lg b">background.js</code>与<code class="fe ly lz ma lg b">main.js</code>相比是一个独立的脚本，我们需要一个自定义的流程，而不是将脚本直接导入到<code class="fe ly lz ma lg b">main.ts</code>。它将被编译成卡盘并由<code class="fe ly lz ma lg b">index.html</code>加载。</p><p id="08a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在Angular中，我们有自定义webpack构建器，可以将自定义webpack文件添加到构建选项中。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="0460" class="lk ll it lg b gy lm ln l lo lp">yarn add -D @angular-builders/custom-webpack</span></pre><p id="459b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在angular.json中，您已经从`<strong class="kd iu">@ angular-devkit/build-angular</strong>切换到`<strong class="kd iu">@ angular-builders/custom-webpack</strong>`,并包含了您的自定义web pack的路径。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e2ca" class="lk ll it lg b gy lm ln l lo lp">// angular.json</span><span id="e5f0" class="lk ll it lg b gy lx ln l lo lp">"architect": {<br/>   "build": {<br/>      "builder": "<a class="ae kz" href="http://twitter.com/angular" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu">@angular</strong></a><strong class="lg iu">-builders/custom-webpack:browser</strong>",<br/>      "outputs": ["{options.outputPath}"],<br/>      "options": {<br/>          ....<br/>          "aot": true,<br/>          <strong class="lg iu">"customWebpackConfig": { "path": "apps/ext-utils/custom-webpack.config.js" }</strong><br/>},</span></pre><p id="1702" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你的自定义网络包包含了<code class="fe ly lz ma lg b">background.ts</code>的路径</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="e961" class="lk ll it lg b gy lm ln l lo lp">// custom-webpack.config.js</span><span id="a916" class="lk ll it lg b gy lx ln l lo lp">module.exports = {<br/>  entry: { background: 'apps/ext-utils/src/background.ts' },<br/>  optimization: {<br/><strong class="lg iu">    runtimeChunk: false,<br/></strong>  },<br/>}</span></pre><p id="752c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不要忘记在tsconfig.app.json中包含background.ts &amp; types</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="598b" class="lk ll it lg b gy lm ln l lo lp">// tsconfig.app.json</span><span id="1a94" class="lk ll it lg b gy lx ln l lo lp">{<br/>  "extends": "./tsconfig.json",<br/>  "compilerOptions": {<br/>    "outDir": "../../dist/out-tsc",<br/>    <strong class="lg iu">"types": ["chrome"]</strong><br/>  },<br/>  "files": ["src/main.ts", "src/polyfills.ts", <strong class="lg iu">"src/background.ts"</strong>],<br/>  "include": ["src/**/*.d.ts"],<br/>  "exclude": ["**/*.test.ts", "**/*.spec.ts"]<br/>}</span></pre><p id="3c92" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们构建扩展，你会看到背景作为一个单独的文件。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/5c5b13e2105386ba7c90da4f088cf2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*ecIOkn8GXdDuiPoRYLmmpA.png"/></div></figure><p id="ceec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了保持原来的文件名，不要忘记更改<code class="fe ly lz ma lg b">outputHashing</code>。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6518" class="lk ll it lg b gy lm ln l lo lp">"configurations": {<br/>  "production": {<br/>       ...<br/>       <strong class="lg iu">"outputHashing": "none"</strong><br/>   },<br/>},</span></pre><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/d9b5d3fe0ca7631954352871344856eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*Fm__Fxuom8ELLU7aCW2urg.png"/></div></figure><p id="f575" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，您可以重新加载扩展并检查是否包含了<code class="fe ly lz ma lg b">background.js</code>。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/1c537b583f1fa196c12ae9fc6182af4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*wfAGvTPgrDj8e7otrYFeZQ.png"/></div></figure><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/fe83038e3a65fd78e14cd8191738e3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*Fq3yOGkjV0Ktgzzax35_cA.png"/></div></figure><p id="a3f8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">添加层逻辑</strong></p><p id="abae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">扩展现在有一个弹出窗口，我们需要添加一个按钮进行交互。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="88d0" class="lk ll it lg b gy lm ln l lo lp">// app.component.html</span><span id="dd6a" class="lk ll it lg b gy lx ln l lo lp">&lt;h1&gt;Utils Extension&lt;/h1&gt;<br/>&lt;button (click)="changeBackground()"&gt;Change Background&lt;/button&gt;</span></pre><p id="546e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将函数添加到组件中。这个函数将从存储器中获取颜色，并更新你所浏览的任何网站的背景。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="9282" class="lk ll it lg b gy lm ln l lo lp">// app.component.ts</span><span id="8764" class="lk ll it lg b gy lx ln l lo lp">export class AppComponent {<br/>  async changeBackground() {<br/>    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true })</span><span id="56af" class="lk ll it lg b gy lx ln l lo lp">if (tab.id != null) {<br/>      chrome.scripting.executeScript({<br/>        target: { tabId: tab.id },<br/>        func: () =&gt; {<br/>          chrome.storage.sync.get('color', ({ color }) =&gt; {<br/>            document.body.style.backgroundColor = color<br/>          })<br/>        },<br/>      })<br/>    }<br/>  }<br/>}</span></pre><p id="e68e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不要忘记，清单需要<code class="fe ly lz ma lg b"><a class="ae kz" href="https://developer.chrome.com/docs/extensions/mv3/manifest/activeTab/" rel="noopener ugc nofollow" target="_blank">activeTab</a></code>权限来允许扩展临时访问当前页面，还需要<code class="fe ly lz ma lg b"><a class="ae kz" href="https://developer.chrome.com/docs/extensions/reference/scripting/" rel="noopener ugc nofollow" target="_blank">scripting</a></code>权限来使用脚本API的<code class="fe ly lz ma lg b"><a class="ae kz" href="https://developer.chrome.com/docs/extensions/reference/scripting#method-executeScript" rel="noopener ugc nofollow" target="_blank">executeScript</a></code>方法。</p><p id="7950" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样。现在你知道如何通过改变背景来与网站互动。如果你有任何问题或要求，请在评论区提出。</p><p id="355a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://twitter.com/dale_nguyen" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">在Twitter上关注我</strong> </a>了解Angular、JavaScript &amp; WebDevelopment的最新内容👐</p></div></div>    
</body>
</html>