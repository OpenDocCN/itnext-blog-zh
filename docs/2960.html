<html>
<head>
<title>Creating a MEAN Stack Twitter Scheduler (Angular, MongoDB, Node.js, and Express) — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个平均堆栈Twitter调度器(Angular、MongoDB、Node.js和Express)——第2部分</h1>
<blockquote>原文：<a href="https://itnext.io/creating-a-mean-stack-twitter-scheduler-angular-mongodb-node-js-and-express-part-2-ded5b5d5fc05?source=collection_archive---------6-----------------------#2019-09-06">https://itnext.io/creating-a-mean-stack-twitter-scheduler-angular-mongodb-node-js-and-express-part-2-ded5b5d5fc05?source=collection_archive---------6-----------------------#2019-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="2a45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本系列的<a class="ae kl" href="https://medium.com/@aaronrhoades91/creating-a-mean-stack-twitter-scheduler-angular-mongodb-node-js-and-express-34b37e717ceb?source=friends_link&amp;sk=3778ff7e3b568fe56f5b75ead951f0a0" rel="noopener">第1部分中，我们为Tweet定义了一个基本的TypeScript对象，并创建了一个API来将Tweet </a><a class="ae kl" href="https://docs.mongodb.com/manual/core/document/" rel="noopener ugc nofollow" target="_blank">文档</a>添加到我们的MongoDB数据库中。到上一篇教程结束时，我们已经有了一个可以向数据库添加一个基本的“预定Tweet”对象的API。在本教程中，我将重点放在应用程序的角度部分。</p><p id="2347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们将上一篇教程中的TypeScript <code class="fe km kn ko kp b">Tweet</code>类复制并粘贴到一个名为“Twitter”(<em class="kq">src/app/Twitter</em>)的新文件夹中。这也是我将要存储我的Twitter组件的地方</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="kw kx l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><strong class="ak">src/app/Twitter/tweet . ts</strong></figcaption></figure><p id="ae8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们创建组件。打开可信Angular CLI并创建一个组件:</p><p id="2550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">ng g component twitter/Twitter</code></p><p id="d6ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用默认角度设置，这将创建以下组件，并很好地打包到一个文件夹中:</p><ul class=""><li id="1d93" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">twitter.component.html</li><li id="2c69" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">推特.组件.规格. js</li><li id="d9b1" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">推特.组件. ts</li><li id="654e" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">推特.组件. css</li><li id="32af" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">(更新至app.module.ts)</li></ul><p id="1aeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要一个服务来连接我们的API，所以我们最好现在就在命令行中创建它。</p><p id="113c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">ng g service twitter/Twitter</code></p><p id="38ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的Twitter组件有了一个Twitter服务来安排我们的tweets。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/3f5ed3f4c2751ddd58609781361b4fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*livkvWrQtN0D_JetNNXwzw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">推特真多。</figcaption></figure><h1 id="c99a" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">设置Twitter服务</h1><p id="c829" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">Twitter服务将以一些样板代码开始:</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="910e" class="na lu iq kp b gy nb nc l nd ne">import { Injectable } from '<a class="ae kl" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';</span><span id="89ac" class="na lu iq kp b gy nf nc l nd ne"><a class="ae kl" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({<br/>  providedIn: 'root'<br/>})<br/>export class TwitterService {</span><span id="6142" class="na lu iq kp b gy nf nc l nd ne">constructor() { }<br/>}</span></pre><p id="2f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要设置我们的HTTPClient。添加必要的导入语句:</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="fd51" class="na lu iq kp b gy nb nc l nd ne">import { Tweet } from './tweet';<br/>import { HttpClient } from '<a class="ae kl" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>/http';<br/>import { Observable } from 'rxjs';</span></pre><p id="3fd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在构造函数中创建一个http对象:</p><p id="7ef5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">constructor(private http: HttpClient){}</code></p><p id="9fff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并创建ScheduleTweet函数，该函数返回一个rxjs <a class="ae kl" href="https://rxjs-dev.firebaseapp.com/guide/observable" rel="noopener ugc nofollow" target="_blank">可观察值</a>:</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="e7b2" class="na lu iq kp b gy nb nc l nd ne">ScheduleTweet(tweet: Tweet) : Observable&lt;any&gt;{<br/>   return this.http.post('api/tweets', tweet);<br/>}</span></pre><p id="407c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，加上语法突出显示，我们完成的Twitter服务应该是这样的:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="kw kx l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">不算太坏，嗯？</figcaption></figure><h1 id="37c9" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">现在，Twitter组件</h1><p id="13b0" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">现在是时候设置我们的组件了。这是应用程序的一部分，用户在其中与UI交互以创建预定的tweet。我在我的应用程序中使用<a class="ae kl" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> bootstrap 4 </a>来加速，我们假设用户已经登录。我们将通过查看Angular为我们设置的样板文件再次开始。</p><p id="a749" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">下面是组件样板:</strong></p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="61ec" class="na lu iq kp b gy nb nc l nd ne">import { Component, OnInit } from '<a class="ae kl" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';</span><span id="7d7b" class="na lu iq kp b gy nf nc l nd ne"><a class="ae kl" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a>({<br/>  selector: 'app-twitter',<br/>  templateUrl: './twitter.component.html',<br/>  styleUrls: ['./twitter.component.css']<br/>})<br/>export class TwitterComponent implements OnInit {</span><span id="09fc" class="na lu iq kp b gy nf nc l nd ne">  constructor() { }</span><span id="b0a3" class="na lu iq kp b gy nf nc l nd ne">  ngOnInit() {<br/>  }</span><span id="5f7f" class="na lu iq kp b gy nf nc l nd ne">}</span></pre><p id="1c82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">马上，我们将想要导入我们的Twitter服务，以及某种用户/登录服务来获取登录的用户名。我不会在本教程中详细介绍用户/登录服务，因为这是一个完全不同的设置，但基本上你需要知道的是你将从它那里收到一个用户名。</p><p id="8f30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">导入两个服务，以及Tweet对象:<em class="kq">(只需记住login.service在本教程中不做回顾。)</em> </strong></p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="6428" class="na lu iq kp b gy nb nc l nd ne">import { Tweet } from '../tweet';<br/>import { LoginService} from '../../login/login.service';<br/>import { TwitterService } from '../twitter.service';</span></pre><p id="719b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">向构造函数添加两个服务的实例:</strong></p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="9b2c" class="na lu iq kp b gy nb nc l nd ne">constructor(<br/>  private loginService: LoginService,<br/>  private twitterService: TwitterService<br/>) { }</span></pre><p id="c365" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后但同样重要的是，出色的scheduleTweet函数(它实际上从服务中调用了<code class="fe km kn ko kp b">scheduleTweet()</code>函数):</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="4487" class="na lu iq kp b gy nb nc l nd ne">sendTweet(tweet: Tweet){<br/>  this.twitterService.scheduleTweet(tweet).subscribe(<br/>    (data: any) =&gt; console.log(data),<br/>    err =&gt; console.log(err)<br/>  );<br/>}</span></pre><p id="2a15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我喜欢让事情从简单开始，所以我只是将成功或失败记录到JavaScript控制台。最终我们将显示数据并创建错误回退，但现在我只想看到数据从UI输入到数据库中。</p><p id="3a41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们进入UI之前，还有最后一件事。在加载页面时，我们将必须检索用户以进入我们预定的Tweet对象的<code class="fe km kn ko kp b">shq_userid</code>字段。这将是我们从loginService中需要的一件事，我们将把它添加到ngOnInit():</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="299f" class="na lu iq kp b gy nb nc l nd ne">this.scheduledTweet.mhq_userid = this.loginService.getLoggedInUser();</span></pre><p id="a53d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有困难，你可以暂时把它设置为一个特定的字符串。</p><h1 id="2990" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">还剩下什么？</h1><p id="023b" class="pw-post-body-paragraph jn jo iq jp b jq mr js jt ju ms jw jx jy mt ka kb kc mu ke kf kg mv ki kj kk ij bi translated">我们仍然需要用户填写推文<code class="fe km kn ko kp b">text </code>和<code class="fe km kn ko kp b">shq_scheduled_date</code>字段。我们可能需要设法获得Twitter <code class="fe km kn ko kp b">id</code>和<code class="fe km kn ko kp b">screen_name</code>字段。由于我目前只关注连接到MongoDB，我们将首先关注用户输入的<strong class="jp ir">文本</strong>和<strong class="jp ir">预定日期</strong>。因此，我将简单地将下面两行作为占位符代码添加到ngOnInit()函数中，我们将在本教程的下一部分讨论用户输入的数据。感谢你的坚持！</p><pre class="kr ks kt ku gt mw kp mx my aw mz bi"><span id="008e" class="na lu iq kp b gy nb nc l nd ne">this.scheduledTweet.user.id = 123456;<br/>this.scheduledTweet.user.screen_name = "aaronbrosef";</span></pre><p id="8919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PS，这是本教程末尾的语法突出显示的完整twitter.component.ts:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="kw kx l"/></div></figure><p id="d166" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第3部分即将推出！</p></div></div>    
</body>
</html>