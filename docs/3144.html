<html>
<head>
<title>Kubernetes tip: How to use the ‘storageClass’ attribute 🤔</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes提示:如何使用“storageClass”属性🤔</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-tip-how-to-use-the-storageclass-attribute-75cf47e7c6b0?source=collection_archive---------3-----------------------#2019-10-11">https://itnext.io/kubernetes-tip-how-to-use-the-storageclass-attribute-75cf47e7c6b0?source=collection_archive---------3-----------------------#2019-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b6f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一篇简短的博客文章，介绍了Kubernetes动态预配置的一个方面，当人们第一次探索它的时候，经常会被绊倒(我肯定被弄糊涂了！)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/9cd931e2b34723530f2732b9162fdeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:256/format:webp/1*1Cc99RF4vtCSKaHDgz_iyQ.png"/></div></figure><p id="da51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了使用一个<code class="fe kt ku kv kw b">StorageClass</code>，你需要做的就是从一个<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>中引用它。但是<code class="fe kt ku kv kw b">StorageClass</code>不是一个强制字段——所以有可能根本不使用它，或者提供一个空字符串(<code class="fe kt ku kv kw b">""</code>)作为它的值。理解这些选项及其影响非常重要。</p><p id="1d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来澄清这些排列组合，一劳永逸！</p><blockquote class="kx ky kz"><p id="14ae" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq"> Kubernetes </em> <code class="fe kt ku kv kw b"><em class="iq">StorageClass</em></code> <em class="iq">概念(以及更多)在</em> <a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/tutorial-basics-of-kubernetes-volumes-part-2-b2ea6f397402"> <em class="iq">《教程:Kubernetes基础知识卷(第二部分)】</em> </a>中有深入的介绍</p></blockquote><p id="ef1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像<code class="fe kt ku kv kw b">PersistentVolume</code>封装了存储相关的细节一样，<code class="fe kt ku kv kw b">StorageClass</code>提供了一种描述存储“类别”的方式。这里是一个<a class="ae le" href="https://azure.microsoft.com/services/storage/disks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">天蓝色磁盘</a>的<code class="fe kt ku kv kw b">StorageClass</code>的例子。</p><pre class="km kn ko kp gt lf kw lg lh aw li bi"><span id="e3d6" class="lj lk iq kw b gy ll lm l ln lo">apiVersion: storage.k8s.io/v1<br/>kind: StorageClass<br/>metadata:<br/>  labels:<br/>    kubernetes.io/cluster-service: "true"<br/>  name: default<br/>parameters:<br/>  cachingmode: ReadOnly<br/>  kind: Managed<br/>  storageaccounttype: Standard_LRS<br/>provisioner: kubernetes.io/azure-disk<br/>reclaimPolicy: Delete<br/>volumeBindingMode: Immediate</span></pre><h1 id="03a3" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">当<code class="fe kt ku kv kw b"><em class="mm">storageClass</em></code>属性缺失时</h1><p id="5ab8" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">如果想在集群中使用<code class="fe kt ku kv kw b">default</code>存储类，可以选择不在<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>中包含<code class="fe kt ku kv kw b">storageClass</code>属性。例如，<a class="ae le" href="https://azure.microsoft.com/services/storage/disks/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> Azure Kubernetes服务</a>包括两个预播种的存储类。</p><p id="6124" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过运行<code class="fe kt ku kv kw b">kubectl get storageclass</code>命令进行检查</p><pre class="km kn ko kp gt lf kw lg lh aw li bi"><span id="15e2" class="lj lk iq kw b gy ll lm l ln lo">NAME                PROVISIONER                AGE<br/>default (default)   kubernetes.io/azure-disk   6d10h<br/>managed-premium     kubernetes.io/azure-disk   6d10h</span></pre><ul class=""><li id="84ae" class="ms mt iq jp b jq jr ju jv jy mu kc mv kg mw kk mx my mz na bi translated"><code class="fe kt ku kv kw b">default</code>存储类别:提供由标准硬盘支持的标准<a class="ae le" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-blog-abhishgu#standard-hdd" rel="noopener ugc nofollow" target="_blank"> Azure磁盘</a></li><li id="0fee" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><code class="fe kt ku kv kw b">managed-premium</code>存储类:调配高级【由高级SSD支持的Azure磁盘】(<a class="ae le" href="https://docs.microsoft.com/azure/virtual-machines/windows/disks-types?WT.mc_id=medium-" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/Azure/virtual-machines/windows/disks-types？wt . MC _ id = medium-</a>blog-abhishgu # premium-SSD)</li></ul><blockquote class="kx ky kz"><p id="3bc0" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">在这种情况下，即使</em> <code class="fe kt ku kv kw b"><em class="iq">PersistentVolume</em></code> <em class="iq">存在并且与</em> <code class="fe kt ku kv kw b"><em class="iq">PersistentVolumeClaim</em></code> <em class="iq">中的要求相匹配，也将使用</em> <code class="fe kt ku kv kw b"><em class="iq">default</em></code> <em class="iq">存储类(及其关联的</em> <code class="fe kt ku kv kw b"><em class="iq">provisioner</em></code> <em class="iq">)。</em></p></blockquote><h1 id="dfb0" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">当<code class="fe kt ku kv kw b">storageClass</code>属性设置为空字符串时</h1><p id="5a67" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">这是个棘手的问题！</p><p id="8c33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您已经有了一个<code class="fe kt ku kv kw b">PersistentVolume</code>以及相应的存储介质，并且想要使用它(不涉及自定义存储类或<code class="fe kt ku kv kw b">default</code>类)</p><p id="150e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，只需在<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>中将<code class="fe kt ku kv kw b">storageClass</code>设置为空字符串(<code class="fe kt ku kv kw b">""</code>)。这将抑制动态预配置！</p><blockquote class="kx ky kz"><p id="3c0f" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq">查看</em> <a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/how-to-add-persistent-storage-to-your-kubernetes-apps-using-azure-disk-5eb081c1a31"> <em class="iq">“如何使用Azure Disk将持久存储添加到您的Kubernetes应用程序”</em> </a> <em class="iq">以查看实际操作</em></p></blockquote><h1 id="4584" class="lp lk iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">当引用特定的<code class="fe kt ku kv kw b">storageClass</code>属性时</h1><blockquote class="kx ky kz"><p id="064a" class="jn jo la jp b jq jr js jt ju jv jw jx lb jz ka kb lc kd ke kf ld kh ki kj kk ij bi translated"><em class="iq"/><a class="ae le" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-custom-storage-classes-in-kubernetes-edc568acfdfe"><em class="iq">“如何在Kubernetes中使用自定义存储类？”</em> </a> <em class="iq">博文用一个例子</em>展示了这个场景</p></blockquote><p id="2a33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在许多情况下，除了已经安装在Kubernetes集群中的存储类之外，您可能还需要创建自定义的存储类，例如，一旦删除了<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>，您需要改变处理<code class="fe kt ku kv kw b">PersistentVolume</code>和存储介质的移除的方式。</p><p id="6d34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，自定义存储类中指定的<code class="fe kt ku kv kw b">provisioner</code>将用于创建存储介质(和相应的<code class="fe kt ku kv kw b">PersistentVolume</code>对象)以满足<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>中的存储请求细节。</p><p id="b1c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">注意</strong>:如果从<code class="fe kt ku kv kw b">PersistentVolumeClaim</code>引用无效的存储类，动态预配置将会失败</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="e68f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前就这些。我希望得到您的反馈和建议！只需<a class="ae le" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank">发推文</a>或发表评论。还有，别忘了喜欢和关注😃😃</p></div></div>    
</body>
</html>