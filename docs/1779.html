<html>
<head>
<title>Entity Framework Core: Client-side Evaluation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实体框架核心:客户端评估</h1>
<blockquote>原文：<a href="https://itnext.io/entity-framework-core-client-side-evaluation-473077eee5d?source=collection_archive---------2-----------------------#2019-01-27">https://itnext.io/entity-framework-core-client-side-evaluation-473077eee5d?source=collection_archive---------2-----------------------#2019-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fe52d0de4ce6d620a700c50dae3077ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OnuBfh94fvUaa0SOVf212A.png"/></div></div></figure><p id="7692" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基于我在<a class="ae kw" href="https://www.reddit.com/r/dotnet/comments/a9422k/entity_framework_core_string_filter_tips/" rel="noopener ugc nofollow" target="_blank"> Reddit </a>上看到的，我几周前在<a class="ae kw" href="https://elanderson.net/2018/12/entity-framework-core-string-filter-tips/" rel="noopener ugc nofollow" target="_blank">Entity Framework Core:String Filter Tips</a>上的帖子可能会被认为对客户端评估过于苛刻。我的意思不是说当你需要的时候不应该使用客户端评估，而是你应该选择什么时候使用客户端评估，当查询在客户端运行时，这是很容易错过的。</p><p id="8ed8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.reddit.com/user/TimeRemove" rel="noopener ugc nofollow" target="_blank"> TimeRemove </a>很好地解释了检测和处理客户端评估的方法，本文将对此进行回顾。示例应用程序与在示例应用程序部分定义的<a class="ae kw" href="https://elanderson.net/2018/12/entity-framework-core-string-filter-tips/" rel="noopener ugc nofollow" target="_blank">实体框架核心:字符串过滤器提示</a>中使用的应用程序相同。</p><h1 id="d53d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">示例客户端查询</h1><p id="4dd3" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">下面是我们将用来触发客户端评估的查询。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="f3c5" class="mj ky iq mf b gy mk ml l mm mn">var contacts = await _context .Contacts .Where(c =&gt; String.Compare(c.FirstName, "D", StringComparison.Ordinal) &gt; 0) .ToListAsync();</span></pre><h1 id="e86f" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">没有变化</h1><p id="19b3" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在不改变应用程序的情况下运行这个查询实际上会在<strong class="ka ir">调试窗口</strong>中给出以下警告。</p><blockquote class="mo mp mq"><p id="f6fe" class="jy jz mr ka b kb kc kd ke kf kg kh ki ms kk kl km mt ko kp kq mu ks kt ku kv ij bi translated"><em class="iq">微软。EntityFrameworkCore.Query:警告:LINQ表达式“where (Compare([c].名字，" D "，序数)&gt; 0)'无法翻译，将在本地进行计算。</em></p></blockquote><p id="0311" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不确定这个警告有多久了，但这是我第一次注意到它。这是一个很好的提醒，可以更频繁地确认和检查调试窗口。</p><h1 id="a6c5" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">客户端评估引发异常</h1><p id="c222" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对DbContext进行以下更改将导致Entity Framework Core在进行客户端评估时抛出异常，而不仅仅是显示警告。在本例中，我们覆盖了DbContext的<strong class="ka ir">on configuration</strong>函数，并更改为在调试模式下构建应用程序时抛出异常。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4a97" class="mj ky iq mf b gy mk ml l mm mn">protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) { #if DEBUG optionsBuilder.ConfigureWarnings(w =&gt; w.Throw(RelationalEventId.QueryClientEvaluationWarning)); #endif base.OnConfiguring(optionsBuilder); }</span></pre><p id="f7bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行示例查询会导致以下异常。</p><blockquote class="mo mp mq"><p id="a87a" class="jy jz mr ka b kb kc kd ke kf kg kh ki ms kk kl km mt ko kp kq mu ks kt ku kv ij bi translated"><em class="iq"> InvalidOperationException:为警告“Microsoft。EntityFrameworkCore . query . queryclientevaluationwarning:LINQ表达式“where (Compare([c].名字，“D”，序数)&gt; 0)“无法翻译，将在本地进行计算。”。可以通过传递事件ID“relational event ID”来取消或记录此异常。将“QueryClientEvaluationWarning”添加到“DbContext”中的“ConfigureWarnings”方法。“OnConfiguring”或“AddDbContext”。</em></p></blockquote><p id="f73b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时候，客户端评估是您想要的。如何处理这种需求并使异常处于启用状态，以便在客户端评估发生时收到通知？为此，您需要将查询分成多个部分，运行服务器评估部分，然后在不同的语句中运行客户端评估部分。下面是我们分解的示例查询，这样就不会引发异常。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="3607" class="mj ky iq mf b gy mk ml l mm mn">//Server evaluation var contacts = await _context.Contacts.ToListAsync(); //Client evaluation contacts = contacts .Where(c =&gt; String.Compare(c.FirstName, "D", StringComparison.Ordinal) &gt; 0) .ToList();</span></pre><h1 id="67f2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">包扎</h1><p id="c3f9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果我引入了任何困惑，我希望这篇文章能帮助澄清它。100%清楚客户端评估并不坏，但是我觉得这是开发者做出的一个选择，这很重要。我希望以上能给你一些工具，让你在选择客户端评估的时候更加清楚。</p><p id="194b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次感谢<a class="ae kw" href="https://www.reddit.com/user/TimeRemove" rel="noopener ugc nofollow" target="_blank"> TimeRemove </a>对我最初帖子的澄清。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="e87a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mr">原载于2019年1月27日</em><a class="ae kw" href="https://elanderson.net/2019/01/entity-framework-core-client-side-evaluation/" rel="noopener ugc nofollow" target="_blank"><em class="mr">【elanderson.net</em></a><em class="mr">。</em></p></div></div>    
</body>
</html>