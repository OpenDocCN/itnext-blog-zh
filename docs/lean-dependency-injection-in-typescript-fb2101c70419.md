# TypeScript 中更精简的依赖注入模式

> 原文：<https://itnext.io/lean-dependency-injection-in-typescript-fb2101c70419?source=collection_archive---------2----------------------->

## 从 Java 风格的 OOP 到更…类型化的感觉？

![](img/3aa06415c70cff397090d7c918a53ca5.png)

什么时候咖啡图片在编程文章中不起作用？

解耦代码、消除隐式依赖、支持可测试性都很棒，而依赖注入是实现这些的*模式。然而，传统的类实例为其他类实例获取接口的 DI 方法有点太… Java？OOP？进取心？当然，我们可以摆脱过于复杂的结构，做一些简单的事情来代替？*

# 问题是

让我们定义一堆接口、一个服务、一些数据访问对象(Dao)和简短使用示例(在测试代码中)。假设我们已经定义了一些用户和组织类型。我们现在也让它保持无聊。

服务注入了几个 DAOs，易于测试！

像上面这样写代码并没有什么大的错误，这完全是一个可以很好伸缩的工作模式。然而，我确实有一些问题。

*   **类意味着易变的状态。** *或至少是它的一种潜力。看到课有点害怕是个好习惯。如果不需要可变状态，为什么要使用它？*
*   **啰嗦，样板。这显然是一个品味问题，但我有一种感觉，我们可以让一切更简洁。**
*   **接口意味着继承或声明合并。** *或者至少对他们来说有潜力。* *为什么不用* `*type*` *代替？这感觉像是一个更受限制的事情，我觉得很好。如果你一定要使用一个界面，只需要在需要的时候翻转它。*

# 更精简的方法

相同的代码:DAOs、服务、示例用法。但是一切都更受限制，更简短，我们更多地使用函数和对象文字。让我们看看进展如何:

仍然有一个注入了一些 Dao 的服务，所以其实都是一样的。

这是怎么回事？

*   **使用** `**type**` **结束接口。这是一个更严格的限制，对我来说是一件好事。**
*   服务现在是闭包而不是类。 *函数返回一个对象文字量。没有隐藏可变状态的可能性，坦率地说，它只是简单得多，甚至可能更容易看。*
*   **Dao 已经没有接口了。** *有点明白了。Dao 或者它们应该是连接器或者 API/DB 客户端，甚至可能完全不同，这取决于它们具体做什么。*
*   测试实现只是对象文字。他们真的需要比这更多的东西吗？
*   一切都感觉更像是打字稿。还有现代？ *完全是口味问题，所以让我知道你的想法。*

# 结论

很明显，我更喜欢某种风格。但是我相信我已经尽力用好的论据来证明我的观点。值得注意的是，这里的区别并不在于依赖注入，而在于一般的类型脚本。我倾向于相信，用函数和记录代替基于面向对象类/实例的结构通常更好(我喜欢把对象文字看作记录，而不是单例)。

尝试不同的方法，看看你更喜欢用什么和看什么。