<html>
<head>
<title>Laravel and Vue: Creating a Portfolio website with a CRUD admin panel — Chapter Five</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第五章</h1>
<blockquote>原文：<a href="https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-five-d4c6ceeff93c?source=collection_archive---------3-----------------------#2019-11-01">https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-five-d4c6ceeff93c?source=collection_archive---------3-----------------------#2019-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="08cb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Laravel表单验证、错误消息和处理成功</h2></div><p id="4905" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">回顾:</strong>在上一章中，我们创建了更新功能并重构了代码，因为如果我们不重构代码，它将变得难以查看。</p><p id="f6d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">现在</strong>:我们要解决一个问题。问题是当我们提交表单时，我们必须在network选项卡中查看表单是否已成功提交。</p><p id="b574" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">表单的用户可能不知道错误代码和web开发术语。用户也可能不知道如何使用网络选项卡或<strong class="kk iu"> inspect element/web开发工具</strong>的任何部分。</p><p id="8e8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要一种方式来告诉用户正在发生什么。正在发生的是<strong class="kk iu">‘错误正在发生’</strong>和<strong class="kk iu">‘表单未被验证’</strong>。</p><p id="cbec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还需要一些临时造型。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="2517" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">临时造型</h1><p id="3751" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">将以下代码添加到app.vue中:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ec8f" class="mr lm it mn b gy ms mt l mu mv">&lt;style <em class="mw">id</em>="temporary"&gt;<br/> #app {<br/>     display: grid;<br/>     grid-auto-flow: column;<br/> }<br/> img {<br/>      max-width: 100%;<br/>       height: auto;<br/>  }<br/>&lt;/style&gt;</span></pre><p id="04a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，你将有刊头和形式并排。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="d969" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">通过警报通知用户</h1><p id="6e0e" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">用户需要一种直观的方式来知道错误正在发生以及哪些错误正在发生。</p><p id="061f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们试试警报——更改onSubmit方法以显示JavaScript警报</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="87e3" class="mr lm it mn b gy ms mt l mu mv">onSubmit() {<br/>    <em class="mw">let </em>fd = <em class="mw">new </em>FormData();<br/>    fd.append('name', <em class="mw">this</em>.name);<br/>    fd.append('userpic', <em class="mw">this</em>.file);<br/><br/>    axios.post('api/profile', fd)<br/>        .then(response =&gt; {<br/><strong class="mn iu">            <em class="mw">console</em>.log("response " + response);<br/>            alert(response);</strong><br/>        })<br/>        .catch(error =&gt; {<br/><strong class="mn iu">            <em class="mw">console</em>.log("ERROR " + error);<br/>            alert(error)</strong><br/>        })<br/>},</span></pre><blockquote class="mx my mz"><p id="a392" class="ki kj mw kk b kl km ju kn ko kp jx kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">代码解释:<br/> <strong class="kk iu">然后</strong> —如果一切顺利，记录<strong class="kk iu">字响应</strong>和<strong class="kk iu">响应本身</strong>。此外，创建一个<strong class="kk iu">警告框</strong>，其中出现<strong class="kk iu">响应</strong>。</p><p id="d2f3" class="ki kj mw kk b kl km ju kn ko kp jx kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated"><strong class="kk iu">捕捉</strong> —如果有错误，记录<strong class="kk iu">文字错误</strong>和<strong class="kk iu">错误本身</strong>。此外，创建一个<strong class="kk iu">警告框</strong>，其中显示错误。</p></blockquote><p id="1dfe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">发布一个空表单将会得到一个类似如下的警告框:</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi nd"><img src="../Images/dc71b96a866273c127c43f60d819e1c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*aUWoylS1G4-3_EgoFfGDww.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">使用HTTP 500消息发出警报</figcaption></figure><p id="53a6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们会看到一个警告框，显示以下消息:</p><blockquote class="np"><p id="3003" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">错误:请求失败，状态代码为500</p></blockquote><p id="0745" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">类似的消息将出现在浏览器控制台中:</p><blockquote class="np"><p id="663b" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">错误错误:请求失败，状态代码为500</p></blockquote><p id="d4e1" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">这些消息对用户不太友好。让我们制作用户友好的信息。</p><h2 id="1098" class="mr lm it bd ln oe of dn lr og oh dp lv kr oi oj lx kv ok ol lz kz om on mb oo bi translated"><strong class="ak">用户友好的错误信息</strong></h2><p id="0992" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">Laravel具有验证功能，可以帮助我们用用户友好的语言发出这些错误消息。</p><p id="5f29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们查看网络选项卡，我们会发现这个500错误的消息</p><blockquote class="np"><p id="0b7e" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">消息:在null上调用成员函数<strong class="ak"> hashName() </strong></p></blockquote><figure class="oq or os ot ou ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi op"><img src="../Images/7c9eca383db79d7868c359234c73cd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*28vG8oPZ-l5cLXu3O-3mvA.png"/></div></div></figure><p id="1b8c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着我们在控制器函数中使用了<strong class="kk iu"> hashName() </strong>，但是我们使用的hashName()是<strong class="kk iu">不存在</strong>。</p><p id="c63f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们使用CTRL+F(或者程序中使用的任意组合键)在控制器中找到hashName()。在PHPStorm中，是CTRL+F)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ddf5" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>insertData($profile) {<br/>    $profile-&gt;name = request()-&gt;name;<br/>    <strong class="mn iu">$profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();</strong><br/>    $profile-&gt;save();<br/>    <em class="mw">return </em>request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>}</span></pre><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ov"><img src="../Images/c555b09c4979107f8c4204a2d34a6c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32OzoINn-kFwLXev-pL2rw.png"/></div></div></figure><p id="9a84" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们的控制器中，我们可以看到:</p><ul class=""><li id="da96" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pb pc pd pe bi translated">hashName()用于一个具有“userpic ”密钥的<strong class="kk iu">文件</strong></li><li id="ec06" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">userpic文件应该在<strong class="kk iu">请求()</strong>中。</li></ul><p id="6d10" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为没有提交文件:</p><ul class=""><li id="b5ee" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pb pc pd pe bi translated"><strong class="kk iu">请求()中不存在关键字为“userpic </strong>的文件</li><li id="476c" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">如果某样东西不存在，你就不能给它命名</li></ul><p id="475d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们应该有Laravel验证，它使用所需的规则<strong class="kk iu">。</strong></p><p id="5fee" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在ProfileController的store()函数中，在开头添加一个验证器，如下所示:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="0848" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>store(Request $request)<br/>{<br/>    <strong class="mn iu"><em class="mw">$this</em>-&gt;validate($request, [<br/>        'userpic' =&gt; 'required'<br/>    ]);</strong><br/><br/>    $profile = Profile::<em class="mw">all</em>();<br/>    <em class="mw">if </em>($profile-&gt;isEmpty()) {<br/>        <em class="mw">return $this</em>-&gt;insertData($profile = <em class="mw">new </em>Profile());<br/>    } <em class="mw">else </em>{<br/>        <em class="mw">return $this</em>-&gt;insertData($profile = Profile::<em class="mw">all</em>()[0]);<br/>    }<br/>}</span></pre><p id="6ce6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您将看到一条500状态错误消息</p><blockquote class="np"><p id="ecfb" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">列“名称”不能为空</p></blockquote><p id="308a" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">因此，在验证代码中，我们将在<strong class="kk iu">名称</strong>上添加使用<strong class="kk iu">必需的</strong>规则。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="c693" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>store(Request $request)<br/>{<br/>    <em class="mw">$this</em>-&gt;validate($request, [<br/>        'userpic' =&gt; 'required',<br/>        '<strong class="mn iu">name</strong>' =&gt; '<strong class="mn iu">required</strong>'<br/>    ]);<br/>    $profile = Profile::<em class="mw">all</em>();<br/>    <em class="mw">if </em>($profile-&gt;isEmpty()) {<br/>        <em class="mw">$this</em>-&gt;insertData($profile = <em class="mw">new </em>Profile());<br/>    } <em class="mw">else </em>{<br/>        <em class="mw">$this</em>-&gt;insertData($profile = Profile::<em class="mw">findOrFail</em>(1));<br/>    }<br/>}</span></pre><p id="e788" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在,“选择一个文件并提交一个空的名称框”将得到一个422状态错误，消息如下:</p><blockquote class="np"><p id="fea6" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">给定的数据无效。</p></blockquote><p id="ace7" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">和一个错误json。你可以在下图中看到这些。</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/a40ea1cbda24b81cc6455ea1b446b041.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*rr_lRqq8LCV7tXBd-kxxmg.png"/></div></figure><p id="c44d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将验证器代码放在函数的开始是非常重要的。</p><p id="f1e2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您提交表单时，request()数据将通过验证代码。如果request()数据没有通过验证，您将在network选项卡中看到422状态错误，并且不会插入任何数据。</p><blockquote class="mx my mz"><p id="4c0f" class="ki kj mw kk b kl km ju kn ko kp jx kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">422状态意味着服务器知道你想做什么，但是它认为你(客户端)出错了。</p><p id="9bb1" class="ki kj mw kk b kl km ju kn ko kp jx kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">由于我们没有通过验证，我们得到一个422状态，因为我们在客户端出错了。</p></blockquote><p id="0d64" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您在警报中得到一个422错误</p><blockquote class="np"><p id="ae61" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">错误:请求失败，状态代码为422</p></blockquote><p id="acac" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated"><strong class="kk iu">我们的目标是</strong>:我们的目标是将<strong class="kk iu">验证器错误消息</strong>放入警告框。</p><p id="0ea4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">为什么</strong>:验证器错误消息使用了没有术语的语言，因此更加用户友好</p><p id="00b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们使用axios js时，错误的响应数据在<strong class="kk iu"> error.response.data内。</strong>让我们将它记录在控制台中</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="d9de" class="mr lm it mn b gy ms mt l mu mv">console.log(error.response.data)</span></pre><p id="4632" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们得到一个带有<strong class="kk iu">消息</strong>和<strong class="kk iu">错误</strong> <strong class="kk iu">的对象</strong>。这与您在“网络”选项卡中获得的内容是一样的。</p><p id="3b93" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们记录error.response.data中的errors对象</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="21f2" class="mr lm it mn b gy ms mt l mu mv">console.log(error.response.data<strong class="mn iu">.errors</strong>)</span></pre><p id="99ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是我们需要的对象，因为这是我们接收验证器消息的对象。</p><p id="abe3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要获取这个对象的值，并把它们放在一个警告框中。我们使用<code class="fe pl pm pn mn b"><strong class="kk iu">Object.values()</strong></code>获取对象的值</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="97c0" class="mr lm it mn b gy ms mt l mu mv">.catch(error =&gt; {<br/>    <em class="mw">let </em>er = error.response.data.errors;<br/>    <em class="mw">let </em>ov = <strong class="mn iu">Object.values(er)</strong>;<br/>    alert(ov);<br/>})</span></pre><p id="fad4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，警报看起来像这样:</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div class="gh gi po"><img src="../Images/9d0f081b042c6389b2429f95639ffdb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*D4roEI7kOa-L7tY-NUHVvQ.png"/></div></figure><p id="0231" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们得到了由Laravel的验证器提供的错误信息。</p><p id="0c29" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可能会注意到两条消息之间有一个逗号。为了去掉逗号，我们可以使用join方法。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2481" class="mr lm it mn b gy ms mt l mu mv">alert(ov.<strong class="mn iu">join('')</strong>);</span></pre><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/a82fd5d1f14d6afe12e720e74d7fa5bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*r5lsByAMX3GYoQwMfLMlqw.png"/></div></figure><p id="62e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，使用<code class="fe pl pm pn mn b"><strong class="kk iu">join('')</strong></code>后，逗号消失了。</p><p id="073e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的警报起作用了。😃</p><p id="f9ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是如果您只想更新一个字段呢？有时候你想:</p><ul class=""><li id="7848" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pb pc pd pe bi translated">保留当前名称的同时更改图像</li><li id="cebd" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">在保持当前图像的同时更改名称。</li></ul><p id="3b15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了解决这两种情况，我们需要使用验证规则<strong class="kk iu"> required_without </strong></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="01eb" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">必需_无</h1><p id="a69d" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">这是一个验证规则，仅当其他字段为空时，该字段才成为必填字段。在我们的例子中，如果userpic为空，我们希望名称是必需的，如果名称为空，我们希望userpic字段是必需的。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9fd4" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">$this</em>-&gt;validate($request, [<br/>    'userpic' =&gt; '<strong class="mn iu">required_without</strong>:name',<br/>    'name' =&gt; '<strong class="mn iu">required_without</strong>:userpic'<br/>]);</span></pre><p id="7116" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了确保不需要的<strong class="kk iu">正常工作，我们需要看看三个场景并解决它们的问题:</strong></p><ol class=""><li id="5cc9" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pq pc pd pe bi translated">当表单为空时提交表单。</li><li id="a902" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pq pc pd pe bi translated">提交没有填写名称字段的文件。</li><li id="dbf8" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pq pc pd pe bi translated">提交未选择文件的已填写名称字段。</li></ol><h2 id="d9a9" class="mr lm it bd ln oe of dn lr og oh dp lv kr oi oj lx kv ok ol lz kz om on mb oo bi translated">1.表单为空时提交表单</h2><p id="cf31" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">任务:提交一个空表单，你会得到一个警告框，上面写着:</p><blockquote class="np"><p id="d0b2" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">当名称不存在时，需要userpic字段。当userpic不存在时，名称字段是必需的。</p></blockquote><p id="b74d" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">这很好。我们毫无问题地收到了所需的<strong class="kk iu">消息，而没有收到</strong>消息。</p><h2 id="9f67" class="mr lm it bd ln oe of dn lr og oh dp lv kr oi oj lx kv ok ol lz kz om on mb oo bi translated">2.提交没有填写名称字段的文件。</h2><p id="3325" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated"><strong class="kk iu">问题:</strong>如果提交一个没有名称字段的文件，将返回500状态错误。</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/d212da082efdb2ac3f0824ffab7bf51a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*Pdosh9SJQb5Rh0omhNlHQw.gif"/></div></figure><blockquote class="mx my mz"><p id="bf86" class="ki kj mw kk b kl km ju kn ko kp jx kq na ks kt ku nb kw kx ky nc la lb lc ld im bi translated">别担心，我们能处理好。</p></blockquote><p id="e9b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看network选项卡，您会发现一个响应json。</p><p id="1e71" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">列“名称”不能为空</strong> —这意味着我们尝试<strong class="kk iu">插入</strong>名称和文件已经被数据库拒绝<strong class="kk iu">。</strong></p><p id="f672" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里发生的是我们的<strong class="kk iu">请求()数据</strong>通过了验证。然而，当<strong class="kk iu">请求()数据</strong>传递给<code class="fe pl pm pn mn b"><strong class="kk iu">insertData()</strong></code>函数时，会出现500错误。这个500错误是因为数据库拒绝了请求。</p><p id="e67a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">解决方案尝试</strong>:只有填写了<strong class="kk iu"> request()- &gt; name </strong>，我们才能尝试提交名称。这可以通过<code class="fe pl pm pn mn b"><strong class="kk iu">request()-&gt;filled()</strong></code>完成，如下图所示:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="0cf5" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>insertData($profile) {<br/>    <strong class="mn iu"><em class="mw">if </em>(request()-&gt;filled('name')) {<br/>        $profile-&gt;name = request()-&gt;name;<br/>    }</strong><br/>    $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>    $profile-&gt;save();<br/>    request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>}</span></pre><p id="e9d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，尝试提交一个没有填写名称字段的文件。我们发现它在更新图像的同时保持了相同的<strong class="kk iu">名称</strong>。</p><p id="c9e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">问题已解决</strong>:现在可以提交没有姓名字段的文件了。😃</p><h2 id="101e" class="mr lm it bd ln oe of dn lr og oh dp lv kr oi oj lx kv ok ol lz kz om on mb oo bi translated">3.提交未选择文件的已填写名称字段。</h2><p id="ef22" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated"><strong class="kk iu">问题:</strong>这样做的话，我们会得到500错误和消息</p><blockquote class="np"><p id="ab07" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated"><strong class="ak">在null上调用成员函数hashName()</strong></p></blockquote><p id="f478" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">如前所述(在<strong class="kk iu">通过警报通知用户—用户友好的错误消息</strong>中)，我们在控制器函数中使用<strong class="kk iu"> hashName() </strong>，但是我们使用的hashName()是<strong class="kk iu">不存在</strong>。</p><p id="f7d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">解决方案尝试:</strong>让我们只插入文件数据，如果请求有一个带有<strong class="kk iu"> userpic </strong>关键字的文件，这可以使用<code class="fe pl pm pn mn b"><strong class="kk iu">hasfile('')</strong></code>来完成:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9e26" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>insertData($profile) {<br/>    <em class="mw">if </em>(request()-&gt;filled('name')) {<br/>        $profile-&gt;name = request()-&gt;name;<br/>    }</span><span id="597f" class="mr lm it mn b gy ps mt l mu mv">    <em class="mw">if </em>(request()-&gt;<strong class="mn iu">hasFile</strong>('userpic')) {<br/>        $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>    }</span><span id="09bf" class="mr lm it mn b gy ps mt l mu mv">    $profile-&gt;save();<br/>    request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>}</span></pre><p id="6a90" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过提交没有文件的填充名称字段来测试此代码。我们现在看到的是另一个500错误</p><blockquote class="np"><p id="97bf" class="nq nr it bd ns nt nu nv nw nx ny ld dk translated">对空成员函数存储()的调用</p></blockquote><p id="efa8" class="pw-post-body-paragraph ki kj it kk b kl nz ju kn ko oa jx kq kr ob kt ku kv oc kx ky kz od lb lc ld im bi translated">这个错误说的函数和<strong class="kk iu">公共函数store()不是同一个函数。</strong></p><p id="bd30" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">错误所指的函数用在insertData()的底部</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2e6f" class="mr lm it mn b gy ms mt l mu mv"><strong class="mn iu">request()-&gt;file('userpic')</strong>-&gt;store('/public/userpics');</span></pre><p id="997e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe pl pm pn mn b"><strong class="kk iu">request()-&gt;file('userpic')</strong></code>此处为空。我们不能对null使用store()。</p><p id="05e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">错误解释</strong>:如果您没有提交任何文件，那么请求()中不会包含任何文件。上面的代码试图从请求()中存储一个文件，但是该文件为空，因为我们从未提交过。</p><p id="11d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们重新组织代码，这样<strong class="kk iu">成员函数store() </strong>只在request()拥有带有<strong class="kk iu"> userpic </strong>关键字的文件时使用。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2578" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>insertData($profile) {<br/>    <em class="mw">if </em>(request()-&gt;filled('name')) {<br/>        $profile-&gt;name = request()-&gt;name;<br/>    }</span><span id="2204" class="mr lm it mn b gy ps mt l mu mv">    <em class="mw">if </em>(request()-&gt;hasFile('<strong class="mn iu">userpic</strong>')) {<br/>        $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>        <strong class="mn iu">request()-&gt;file('userpic')-&gt;store('/public/userpics');</strong><br/>    }</span><span id="85e0" class="mr lm it mn b gy ps mt l mu mv">    $profile-&gt;save();<br/>}</span></pre><p id="c3e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">问题已解决</strong>:现在提交没有文件的名称将获得200状态。200状态表示OK。您还可以返回新创建/编辑的数据库行作为响应，如下所示:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2edd" class="mr lm it mn b gy ms mt l mu mv">$profile-&gt;save();<br/><strong class="mn iu"><em class="mw">return</em></strong><em class="mw"> </em>Profile::<em class="mw">all</em>()[0];</span></pre><p id="6152" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">记得在<code class="fe pl pm pn mn b"><strong class="kk iu">$this-&gt;insertData</strong></code> <strong class="kk iu"> </strong>前用<code class="fe pl pm pn mn b"><strong class="kk iu">return</strong></code> <strong class="kk iu"> </strong>这个词。否则<code class="fe pl pm pn mn b"><strong class="kk iu">insertData()</strong></code>功能会将数据返回到存储功能，但不会返回到客户端，因此您不会在网络选项卡中看到它。</p><p id="077e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们当前的store()和insertData()函数:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9349" class="mr lm it mn b gy ms mt l mu mv"><em class="mw">public function </em>store(Request $request)<br/>{<br/>    <em class="mw">$this</em>-&gt;validate($request, [<br/>        'userpic' =&gt; 'required_without:name',<br/>        'name' =&gt; 'required_without:userpic'<br/>    ]);<br/><br/>    $profile = Profile::<em class="mw">all</em>();<br/>    <em class="mw">if </em>($profile-&gt;isEmpty()) {<br/>        <strong class="mn iu"><em class="mw">return</em></strong><em class="mw"> $this</em>-&gt;insertData($profile = <em class="mw">new </em>Profile());<br/>    } <em class="mw">else </em>{<br/>        <strong class="mn iu"><em class="mw">return</em></strong><em class="mw"> $this</em>-&gt;insertData($profile = Profile::<em class="mw">all</em>()[0]);<br/>    }<br/>}<br/><br/><em class="mw">public function </em>insertData($profile) {<br/>    <em class="mw">if </em>(request()-&gt;filled('name')) {<br/>        $profile-&gt;name = request()-&gt;name;<br/>    }<br/>    <em class="mw">if </em>(request()-&gt;hasFile('userpic')) {<br/>        $profile-&gt;img_path = request()-&gt;file('userpic')-&gt;hashName();<br/>        request()-&gt;file('userpic')-&gt;store('/public/userpics');<br/>    }<br/>    $profile-&gt;save();<br/>    <strong class="mn iu"><em class="mw">return</em></strong><em class="mw"> </em>Profile::<em class="mw">all</em>()[0];<br/>}</span></pre><p id="5089" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们有以下更新能力:</p><ul class=""><li id="d670" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pb pc pd pe bi translated">仅更新名称</li><li id="752c" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">仅更新用户图片</li><li id="e30f" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">更新名称和用户图片</li></ul><p id="3752" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们在表单为空的时候提交它，我们会得到一个合适的错误消息。</p><p id="3f0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们如何处理成功？</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h2 id="6ebf" class="mr lm it bd ln oe of dn lr og oh dp lv kr oi oj lx kv ok ol lz kz om on mb oo bi translated">处理成功</h2><p id="2a52" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们如何处理成功？这不仅仅是一个生活问题或者财务问题。在我们的例子中，这也是一个表单验证问题。</p><p id="3849" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们得到一个200状态响应，axios就转移到它的<code class="fe pl pm pn mn b"><strong class="kk iu">.then</strong></code>方法。我们可以修改<code class="fe pl pm pn mn b"><strong class="kk iu">.then</strong></code>来使用<code class="fe pl pm pn mn b"><strong class="kk iu">this.$parent</strong></code>从父组件运行一个方法</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="60df" class="mr lm it mn b gy ms mt l mu mv">axios.post('api/profile', fd)<br/>    <strong class="mn iu">.then(<em class="mw">this</em>.$parent.getProfile())</strong><br/>    .catch(error =&gt; {<br/>        <em class="mw">let </em>er = error.response.data.errors;<br/>        <em class="mw">let </em>ov = Object.values(er);<br/>        alert(ov.join(''));<br/>    })</span></pre><p id="66bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里我们的父组件是<strong class="kk iu"> App.vue </strong>，它包含<code class="fe pl pm pn mn b"><strong class="kk iu">getProfile()</strong></code>。</p><p id="9a8a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe pl pm pn mn b"><strong class="kk iu">getProfile()</strong></code> <strong class="kk iu"> </strong>是帮助我们渲染轮廓数据的方法。</p><p id="e044" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在可以插入数据，它会立即出现在页面<strong class="kk iu">上</strong>。不需要重装。</p><p id="a184" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来测试一下:</p><p id="4a73" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">插入姓名:</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi pt"><img src="../Images/c7894fc524988382cbad35f9e6562917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JFk-6oTl5kYzA0Td7bj9NQ.gif"/></div></div></figure><p id="b59b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">插入图像:</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi pt"><img src="../Images/d3dda34626efb4642c12aec35f11cf61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*5RoB0GfGVyCuEeB6gfekCw.gif"/></div></div></figure><p id="9363" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">插入两者:</p><figure class="mi mj mk ml gt ne gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi pt"><img src="../Images/4b7854c3f80715426df51a238bab80bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BZJl4S9_9p1TN7BCxSjkZw.gif"/></div></div></figure></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="1672" class="ll lm it bd ln lo lp lq lr ls lt lu lv jz lw ka lx kc ly kd lz kf ma kg mb mc bi translated">摘要</h1><p id="b2c7" class="pw-post-body-paragraph ki kj it kk b kl md ju kn ko me jx kq kr mf kt ku kv mg kx ky kz mh lb lc ld im bi translated">我们在本章中做了什么:</p><ul class=""><li id="f81c" class="ow ox it kk b kl km ko kp kr oy kv oz kz pa ld pb pc pd pe bi translated">使用Laravel验证来验证表单</li><li id="c24f" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">显示Laravel验证错误的JavaScript警报</li><li id="b217" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">使用<code class="fe pl pm pn mn b"><strong class="kk iu">required_without</strong></code> <strong class="kk iu"> </strong>来确保至少需要一个字段</li><li id="16f0" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">在将名称和文件保存到数据库之前，使用了<code class="fe pl pm pn mn b"><strong class="kk iu">request()-hasFile()</strong></code>和<code class="fe pl pm pn mn b"><strong class="kk iu">$request-&gt;filled()</strong></code>来确保请求分别有一个文件和名称。</li><li id="44ed" class="ow ox it kk b kl pf ko pg kr ph kv pi kz pj ld pb pc pd pe bi translated">通过在数据插入时简单地重新运行<code class="fe pl pm pn mn b"><strong class="kk iu">getProfile()</strong></code>方法成功处理。</li></ul></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="fdc7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下一章，我们将处理<strong class="kk iu">前端表单验证</strong>和<strong class="kk iu">图像调整</strong></p><div class="pu pv gp gr pw px"><a rel="noopener  ugc nofollow" target="_blank" href="/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-six-6f7ed2b23b42"><div class="py ab fo"><div class="pz ab qa cl cj qb"><h2 class="bd iu gy z fp qc fr fs qd fu fw is bi translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第六章</h2><div class="qe l"><h3 class="bd b gy z fp qc fr fs qd fu fw dk translated">前端表单验证和调整图像大小</h3></div><div class="qf l"><p class="bd b dl z fp qc fr fs qd fu fw dk translated">itnext.io</p></div></div><div class="qg l"><div class="qh l qi qj qk qg ql nj px"/></div></div></a></div></div></div>    
</body>
</html>