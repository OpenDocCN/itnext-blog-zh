<html>
<head>
<title>Neo4j: running in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Neo4j:奔跑在库伯内特斯</h1>
<blockquote>原文：<a href="https://itnext.io/neo4j-running-in-kubernetes-79633944f213?source=collection_archive---------6-----------------------#2020-08-05">https://itnext.io/neo4j-running-in-kubernetes-79633944f213?source=collection_archive---------6-----------------------#2020-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1b1efd94550cc3b0c360821bccba6112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZMkWmnz9GI1GfU5Zcu1CA.png"/></div></div></figure><p id="da01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在之前的帖子中— <a class="ae kw" href="https://rtfm.co.ua/en/neo4j-graph-database-run-with-docker-and-cypher-ql-examples/" rel="noopener ugc nofollow" target="_blank"> Neo4j:图形数据库—用Docker和Cypher QL运行示例</a> —我们已经用в Docker运行了Neo4j数据库。</p><p id="cc70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个任务是在Kubernetes集群中运行它。</p><p id="f911" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将使用Neo4j Community Edition，它将作为单节点实例运行，因为Neo4j的群集功能在企业版中提供，其成本约为190.000美元/年。</p><p id="56ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于社区版，我们可以应用一个掌舵图——<a class="ae kw" href="https://hub.helm.sh/charts/equinor-charts/neo4j-community" rel="noopener ugc nofollow" target="_blank">neo4j——社区</a>。</p><p id="d66c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加其存储库:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c4e1" class="lg lh iq lc b gy li lj l lk ll">$ helm repo add equinor-charts <a class="ae kw" href="https://equinor.github.io/helm-charts/charts/" rel="noopener ugc nofollow" target="_blank">https://equinor.github.io/helm-charts/charts/</a><br/>“equinor-charts” has been added to your repositories</span><span id="7083" class="lg lh iq lc b gy lm lj l lk ll">$ helm repo update<br/>Hang tight while we grab the latest from your chart repositories…<br/>…Successfully got an update from the “equinor-charts” chart repository<br/>…Successfully got an update from the “stable” chart repository<br/>Update Complete. ⎈ Happy Helming!</span></pre><p id="1c17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署到一个定制的名称空间，在本例中，它是<em class="ln"> eks-dev-1-neo4j </em>。</p><p id="1b93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe lo lp lq lc b">--set</code>接受它的许可，并为它的<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-persistentvolume-and-persistentvolumeclaim-an-overview-with-examples/" rel="noopener ugc nofollow" target="_blank">持久卷</a>的<code class="fe lo lp lq lc b"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-persistentvolume-and-persistentvolumeclaim-an-overview-with-examples/#StorageClass" rel="noopener ugc nofollow" target="_blank">StorageClass</a></code>添加值，并添加一个供管理员访问的密码:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f2f1" class="lg lh iq lc b gy li lj l lk ll">$ helm upgrade — install — namespace eks-dev-1-neo4j — create-namespace neo4j-community equinor-charts/neo4j-community — set acceptLicenseAgreement=yes — set neo4jPassword=mySecretPassword — set persistentVolume.storageClass=gp2<br/>Release “neo4j-community” does not exist. Installing it now.<br/>NAME: neo4j-community<br/>LAST DEPLOYED: Fri Jul 31 15:27:38 2020<br/>NAMESPACE: eks-dev-1-neo4j<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None<br/>NOTES:<br/>We’ll need to wait a few seconds for Neo4j to start.<br/>We need to see this line in our pod log:<br/>&gt; Remote interface available at Remote interface available at <a class="ae kw" href="http://localhost:7474/" rel="noopener ugc nofollow" target="_blank">http://localhost:7474/</a><br/>We can see the content of the logs by running the following command:<br/>kubectl logs -l “app=neo4j-community”</span></pre><p id="c1b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的——部署完毕，检查吊舱:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c57e" class="lg lh iq lc b gy li lj l lk ll">$ kk -n eks-dev-1-neo4j get pod<br/>NAME READY STATUS RESTARTS AGE<br/>neo4j-community-neo4j-community-0 1/1 Running 0 29s</span></pre><p id="dc67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查其<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-persistentvolume-and-persistentvolumeclaim-an-overview-with-examples/" rel="noopener ugc nofollow" target="_blank"> PersistentVolumeClaim </a>:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6f05" class="lg lh iq lc b gy li lj l lk ll">$ kk -n eks-dev-1-neo4j get pvc<br/>NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE<br/>datadir-neo4j-community-neo4j-community-0 Bound pvc-29c5d6a0–34b7–4b5c-94d2–778139790a2d 10Gi RWO gp2 15m</span></pre><p id="cda0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查相应的<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-persistentvolume-and-persistentvolumeclaim-an-overview-with-examples/" rel="noopener ugc nofollow" target="_blank"> PersistentVolume </a> —注意，我们已经以动态方式创建了该PVC，因此它的回收策略设置为<em class="ln"> Delete </em>:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="1b23" class="lg lh iq lc b gy li lj l lk ll">$ kk -n eks-dev-1-neo4j get pv pvc-29c5d6a0–34b7–4b5c-94d2–778139790a2d<br/>NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE<br/>pvc-29c5d6a0–34b7–4b5c-94d2–778139790a2d 10Gi RWO Delete Bound eks-dev-1-neo4j/datadir-neo4j-community-neo4j-community-0 gp2 16m</span></pre><p id="13f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，运行端口转发来从您的工作站访问Neo4j服务器:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2b12" class="lg lh iq lc b gy li lj l lk ll">$ kubectl -n eks-dev-1-neo4j port-forward neo4j-community-neo4j-community-0 7474:7474<br/>Forwarding from 127.0.0.1:7474 -&gt; 7474<br/>Forwarding from [::1]:7474 -&gt; 7474</span></pre><p id="539f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查连接:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d3ad" class="lg lh iq lc b gy li lj l lk ll">$ curl <a class="ae kw" href="http://localhost:7474/db/data/" rel="noopener ugc nofollow" target="_blank">http://localhost:7474/db/data/</a><br/>{<br/>“errors” : [ {<br/>“code” : “Neo.ClientError.Security.Unauthorized”,<br/>“message” : “No authentication header supplied.”<br/>} ]<br/>}</span></pre><p id="c9d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务器已准备好工作。</p><h1 id="8dfb" class="lr lh iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">有用的链接</h1><ul class=""><li id="5a48" class="mo mp iq ka b kb mq kf mr kj ms kn mt kr mu kv mv mw mx my bi translated"><a class="ae kw" href="https://github.com/neo4j-contrib/neo4j-helm/blob/master/user-guide/USER-GUIDE.md" rel="noopener ugc nofollow" target="_blank"> Neo4j-Helm用户指南</a></li><li id="eb13" class="mo mp iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated"><a class="ae kw" href="https://medium.com/neo4j/neo4j-considerations-in-orchestration-environments-584db747dca5" rel="noopener">编排环境中的Neo4j考虑事项</a></li><li id="675e" class="mo mp iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated"><a class="ae kw" href="https://medium.com/neo4j/how-to-backup-neo4j-running-in-kubernetes-3697761f229a" rel="noopener">如何备份运行在Kubernetes </a>的Neo4j</li><li id="3ba1" class="mo mp iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated"><a class="ae kw" href="https://github.com/neo4j-contrib/neo4j-helm/blob/master/tools/external-exposure/EXTERNAL-EXPOSURE.md" rel="noopener ugc nofollow" target="_blank">Neo4j团簇的外部曝光</a></li></ul></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="b377" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ln">最初发布于</em> <a class="ae kw" href="https://rtfm.co.ua/en/neo4j-running-in-kubernetes/" rel="noopener ugc nofollow" target="_blank"> <em class="ln"> RTFM: Linux，devo PSисистемноеадмнииитииовваниование</em></a><em class="ln">。</em></p></div></div>    
</body>
</html>