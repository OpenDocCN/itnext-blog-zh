<html>
<head>
<title>Cypress.io — Best practices for maintainable tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">cypress . io——可维护测试的最佳实践</h1>
<blockquote>原文：<a href="https://itnext.io/cypress-io-best-practices-for-maintainable-tests-e9b9f392f117?source=collection_archive---------3-----------------------#2018-04-02">https://itnext.io/cypress-io-best-practices-for-maintainable-tests-e9b9f392f117?source=collection_archive---------3-----------------------#2018-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5eb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个测试直到失败才被重视。应针对故障情况编写<em class="kl">测试。Cypress在GUI中创建了一个大纲来帮助我们理解设置和测试做什么。写得好的测试帮助我们理解什么失败了。截图和视频帮助我们理解<em class="kl">它是如何失败的。</em></em></p><p id="2f33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在继续之前，请阅读Cypress文档中的<a class="ae km" href="https://docs.cypress.io/guides/references/best-practices.html" rel="noopener ugc nofollow" target="_blank">最佳实践</a>。</p><h1 id="6245" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">每个测试必须在完全隔离的情况下运行</h1><p id="8607" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">减少测试套件运行时间的一种方法是增加同时运行的测试数量。分片(或者分割工作)通常发生在文件级，所以至少一个测试文件不应该依赖于先前测试文件的任何状态。</p><p id="9bbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试也可能在任何一步失败。每个<code class="fe lq lr ls lt b">it</code>程序块都运行，而不管先前运行的<code class="fe lq lr ls lt b">it</code>程序块。如果一个<code class="fe lq lr ls lt b">it</code>模块依赖于另一个<code class="fe lq lr ls lt b">it</code>模块留下的状态，就会发生难以理解的级联故障。使用<code class="fe lq lr ls lt b">before</code>对每个<code class="fe lq lr ls lt b">describe</code>程序块运行一次，使用<code class="fe lq lr ls lt b">beforeEach</code>对每个嵌套的<code class="fe lq lr ls lt b">it</code>程序块运行一次。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">隔离测试状态</figcaption></figure><h1 id="73a3" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">测试的焦点应该是有限的</h1><p id="fd66" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">如果你必须使用单词“and”或逗号，那么测试可能做得太多了。失败将更难被发现。开发人员以后可能会在一个缺乏焦点的测试中添加更多的东西，从而使失败更加难以理解。</p><p id="e3e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Cypress将在命令日志中创建一个大纲，显示<code class="fe lq lr ls lt b">describe</code>、<code class="fe lq lr ls lt b">context</code>和<code class="fe lq lr ls lt b">it</code>块以及它们如何嵌套。简明扼要的信息有助于理解这个大纲。</p><p id="1735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">开展测试可能需要更长的时间，但是理解失败更重要。可以在测试套件中投入更多的硬件来减少运行时间。一个人花更多的时间去发现失败不仅更昂贵，而且也意味着他或她花更少的时间去做只有人类才能做的事情。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">限制焦点，思考考试大纲</figcaption></figure><p id="c1d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个建议应该与测试想要达到的目标相平衡。在LogRhythm，我们有冒烟测试，旨在短时间内测试大量集成服务。这些测试验证影响手动测试或当前功能开发的关键工作流。在合并任何拉取请求之前运行冒烟测试。我们的回归套件在合并后每晚运行，并且更紧密地遵循这些指导方针。只有几十个冒烟测试和数百个(最终是数千个)回归测试。</p><h1 id="8b37" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">断言应该是明显的</h1><p id="721f" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">Cypress使用了<a class="ae km" href="http://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank"> Chai </a>，并且还包括两个额外的匹配器套件:<a class="ae km" href="http://www.chaijs.com/plugins/chai-sinon/" rel="noopener ugc nofollow" target="_blank"> chai-sinon </a>和<a class="ae km" href="http://www.chaijs.com/plugins/chai-jquery/" rel="noopener ugc nofollow" target="_blank"> chai-jquery </a>。赛普拉斯的文档把它们都列在这里:<a class="ae km" href="https://docs.cypress.io/guides/references/assertions.html" rel="noopener ugc nofollow" target="_blank">https://docs.cypress.io/guides/references/assertions.html</a>。一个常见的问题是期待某事会发生，这会导致无用的断言失败。错误的断言阻止了使用<code class="fe lq lr ls lt b">cy.should</code>简写。找到正确的匹配器确实需要更多的时间，但是失败消息有助于缩小失败的范围。</p><p id="87fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个好的实践是强制断言失败，看看错误消息和Cypress日志输出是否足以知道原因。将<code class="fe lq lr ls lt b">.only</code>放在您正在评估的<code class="fe lq lr ls lt b">it</code>模块上是最容易的。这样，应用程序将会在通常截图的地方停止，你可以像调试一个真正的故障一样进行调试。这种实践将帮助您编写更好的测试。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">使用有用的柴匹配器</figcaption></figure></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="5aa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">思考失败案例将有助于不得不进行失败测试的可怜工程师。那个可怜的工程师可能就是你！</p></div></div>    
</body>
</html>