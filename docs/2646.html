<html>
<head>
<title>Secure log-in in 15 minutes — Hells yeah!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">15分钟内安全登录—太好了！</h1>
<blockquote>原文：<a href="https://itnext.io/secure-log-in-feature-in-15-minutes-hells-yeah-f69b09502b?source=collection_archive---------3-----------------------#2019-07-02">https://itnext.io/secure-log-in-feature-in-15-minutes-hells-yeah-f69b09502b?source=collection_archive---------3-----------------------#2019-07-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/717f53176e9435e4168d50fc7a99a07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljg1sS0I6ocGKk5fm1_N6w.png"/></div></div></figure><p id="5b0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Web应用程序是企业IT资产、功能和业务工作流的核心。在某种程度上，许多这样的web应用程序最终都有缺陷，比如跨站点脚本和SQL注入。</p><p id="8b18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，这些都是必须考虑的。然而，还有其他一些经常被忽视的弱点，这些都与登录相关。</p><p id="a38d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">登录和注册漏洞包括:</p><ul class=""><li id="0141" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">不受加密保护的应用程序登录</li><li id="93f9" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">弱密码要求</li><li id="f9f1" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">密码复杂性强制</li><li id="973c" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">缺少入侵者锁定</li><li id="01ac" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">描述性的错误消息有时会帮助潜在的入侵者</li></ul><p id="89d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">构建考虑到这些漏洞的安全登录和注册功能可能是一项耗费大量资源的任务。幸运的是，让开发人员花费精力创建这样一个特性并不是唯一的解决方案。</p><p id="c2e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了<strong class="ka ir"> Okta </strong>，你可以管理任何用户对任何应用或设备的访问。<strong class="ka ir"> Okta </strong>运行在云上——在一个安全、可靠、经过广泛审核的平台上，该平台与内部应用程序、目录和身份管理系统深度集成。</p><p id="aecc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最棒的是…它非常容易安装！</p><h1 id="1588" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建React应用程序</h1><p id="9949" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">我们将构建一个简单的React登录。</p><p id="5ba0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们用<a class="ae mn" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>开始吧。有了<a class="ae mn" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>，开始一个新的react应用程序变得超级容易。它附带了许多不错的开箱即用的功能，例如预配置的<a class="ae mn" href="https://github.com/webpack/webpack" rel="noopener ugc nofollow" target="_blank"> Webpack </a>和用于零构建配置的Babel setup。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b32d" class="mx ll iq mt b gy my mz l na nb">npx create-react-app my-spa-example<br/>cd my-spa-example<br/>npm start</span></pre><p id="6546" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">嘣！</strong> React应用程序已启动并运行。干得好！</p><h1 id="0041" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Okta帐户设置</h1><p id="54f1" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">好的……现在让我们来设置Okta帐户。如果你还没有一个注册<a class="ae mn" href="https://developer.okta.com/signup/" rel="noopener ugc nofollow" target="_blank">这里</a>，登录到你的开发者控制台，导航到<strong class="ka ir">应用</strong>，然后点击<strong class="ka ir">添加应用</strong>。选择<strong class="ka ir">单页App </strong>，然后点击<strong class="ka ir">下一步</strong>。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/404d2a7e8678ddd1ba1c22c229215333.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCFRRS0vgoTCH3CpShWLhg.png"/></div></div></figure><p id="eb3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不错！现在你只需要添加一些设置。我们将把重定向URI改为<code class="fe nd ne nf mt b">localhost:3000</code>，因为这是create-react-app使用的端口。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/6f84edc2c646d22e741e2095c68b349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQWbmxD6QEQxO3KE2aDxTQ.png"/></div></div></figure><h1 id="cb51" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Okta和React应用程序集成</h1><p id="ae8e" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">太好了！因此，我们进行了大约5分钟，我们已经创建了我们的Okta帐户并运行了我们的React应用程序。现在，让我们让这两者一起工作。</p><p id="10c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Okta将需要一些依赖。也就是说，我们将使用Okta登录小部件，它使登录变得非常简单。我们还将使用Okta的访问令牌来帮助管理我们的路线。接下来，在下面安装这些依赖项。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="57f5" class="mx ll iq mt b gy my mz l na nb">npm install <!-- -->@okta/okta-signin-widget <!-- -->@okta/okta-react react-router-dom --save</span></pre><p id="5be4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了在react中呈现登录小部件，我们必须创建一个包装器，允许我们将其视为React组件。</p><p id="0674" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们在我们的<code class="fe nd ne nf mt b">/src/directory</code>中创建一个名为<code class="fe nd ne nf mt b">SignUpWidget.js</code>的文件。它看起来会像这样。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="713e" class="mx ll iq mt b gy my mz l na nb">import React, { Component } from 'react';<br/>import ReactDOM from 'react-dom';<br/>import OktaSignIn from '@okta/okta-signin-widget';<br/>import '@okta/okta-signin-widget/dist/css/okta-sign-in.min.css';<br/>import '@okta/okta-signin-widget/dist/css/okta-theme.css';<br/><br/>export default class OktaSignInWidget extends Component {<br/>    componentDidMount() {<br/>        const el = ReactDOM.findDOMNode(this);<br/>        this.widget = new OktaSignIn({<br/>            baseUrl: this.props.baseUrl<br/>        });<br/>        this.widget.renderEl({el}, this.props.onSuccess, this.props.onError);<br/>    }<br/><br/>    componentWillUnmount() {<br/>        this.widget.remove();<br/>    }<br/><br/>    render() {<br/>        return &lt;div /&gt;;<br/>    }<br/>};</span></pre><p id="0de8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有些路线需要验证才能渲染。通过从<code class="fe nd ne nf mt b">@okta/okta-react</code>导入<code class="fe nd ne nf mt b">SecureRoute</code>可以很容易地定义这些路线。让我们来看看这个例子需要哪些路线:</p><ul class=""><li id="ab07" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><code class="fe nd ne nf mt b">/</code>:处理应用程序基本控制的默认页面</li><li id="7f33" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe nd ne nf mt b">/protected</code>:受<code class="fe nd ne nf mt b">SecureRoute</code>保护的路线</li><li id="1ee6" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe nd ne nf mt b">/login</code>:显示登录页面</li><li id="ae9d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><code class="fe nd ne nf mt b">/implicit/callback</code>:重定向后解析令牌的路径</li></ul><p id="e70c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们需要在<code class="fe nd ne nf mt b">/src directory</code>中创建另一个文件，并将其命名为<code class="fe nd ne nf mt b">Home.js</code>。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="c0e9" class="mx ll iq mt b gy my mz l na nb">import React, { Component } from 'react';<br/>import { Link } from 'react-router-dom';<br/>import { withAuth } from '@okta/okta-react';<br/><br/>export default withAuth(class Home extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = { authenticated: null };<br/>    this.checkAuthentication = this.checkAuthentication.bind(this);<br/>    this.login = this.login.bind(this);<br/>    this.logout = this.logout.bind(this);<br/>  }<br/><br/>  async checkAuthentication() {<br/>    const authenticated = await this.props.auth.isAuthenticated();<br/>    if (authenticated !== this.state.authenticated) {<br/>      this.setState({ authenticated });<br/>    }<br/>  }<br/><br/>  async componentDidMount() {<br/>    this.checkAuthentication();<br/>  }<br/><br/>  async componentDidUpdate() {<br/>    this.checkAuthentication();<br/>  }<br/><br/>  async login() {<br/>    this.props.auth.login('/');<br/>  }<br/><br/>  async logout() {<br/>    this.props.auth.logout('/');<br/>  }<br/><br/>  render() {<br/>    if (this.state.authenticated === null) return null;<br/><br/>    const button = this.state.authenticated ?<br/>      &lt;button onClick={this.logout}&gt;Logout&lt;/button&gt; :<br/>      &lt;button onClick={this.login}&gt;Login&lt;/button&gt;;<br/><br/>    return (<br/>      &lt;div&gt;<br/>        &lt;Link to='/'&gt;Home&lt;/Link&gt;&lt;br/&gt;<br/>        &lt;Link to='/protected'&gt;Protected&lt;/Link&gt;&lt;br/&gt;<br/>        {button}<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>});</span></pre><p id="3f6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在已经添加了一个路由到<code class="fe nd ne nf mt b">/protected</code>的链接。该路线仅对拥有有效<code class="fe nd ne nf mt b">accessToken</code>的用户可见。</p><p id="1c38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，创建一个名为<code class="fe nd ne nf mt b">Protected.js</code>的新组件。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="fab0" class="mx ll iq mt b gy my mz l na nb">import React from 'react';<br/><br/>export default () =&gt; &lt;h3&gt;Protected&lt;/h3&gt;;</span></pre><p id="3487" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此路由将托管登录小部件以及已登录的重定向用户。如果用户来自受保护的页面，他们将被重定向回登录页面。</p><p id="9b22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将创建一个<code class="fe nd ne nf mt b">Login.js</code>组件。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="964c" class="mx ll iq mt b gy my mz l na nb">import React, { Component } from 'react';<br/>import { Redirect } from 'react-router-dom';<br/>import OktaSignInWidget from './SignInWidget';<br/>import { withAuth } from '@okta/okta-react';<br/><br/>export default withAuth(class Login extends Component {<br/>    constructor(props) {<br/>        super(props);<br/>        this.onSuccess = this.onSuccess.bind(this);<br/>        this.onError = this.onError.bind(this);<br/>        this.state = {<br/>            authenticated: null<br/>        };<br/>        this.checkAuthentication();<br/>    }<br/><br/>    async checkAuthentication() {<br/>        const authenticated = await this.props.auth.isAuthenticated();<br/>        if (authenticated !== this.state.authenticated) {<br/>            this.setState({ authenticated });<br/>        }<br/>    }<br/><br/>    componentDidUpdate() {<br/>        this.checkAuthentication();<br/>    }<br/><br/>    onSuccess(res) {<br/>        if (res.status === 'SUCCESS') {<br/>            return this.props.auth.redirect({<br/>                sessionToken: res.session.token<br/>            });<br/>        } else {<br/>            // The user can be in another authentication state that requires further action.<br/>            // For more information about these states, see:<br/>            //   https://github.com/okta/okta-signin-widget#rendereloptions-success-error<br/>        }<br/>    }<br/><br/>    onError(err) {<br/>        console.log('error logging in', err);<br/>    }<br/><br/>    render() {<br/>        if (this.state.authenticated === null) return null;<br/>        return this.state.authenticated ?<br/>    &lt;Redirect to={{ pathname: '/' }}/&gt; :<br/>        &lt;OktaSignInWidget<br/>        baseUrl={this.props.baseUrl}<br/>        onSuccess={this.onSuccess}<br/>        onError={this.onError}/&gt;;<br/>    }<br/>});</span></pre><h1 id="6086" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">把所有的东西放在一起</h1><p id="96a1" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">在项目的根目录下，创建一个名为` . env.local '的文件，这个文件将安全地存储Okta <code class="fe nd ne nf mt b">CLIENT_ID</code>、<code class="fe nd ne nf mt b">ORG_URL</code>和API访问令牌。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="eece" class="mx ll iq mt b gy my mz l na nb">REACT_APP_OKTA_CLIENT_ID={yourClientId}<br/>REACT_APP_OKTA_ORG_URL=https://{yourOktaDomain}<br/>REACT_APP_OKTA_TOKEN={yourOktaAPIToken}</span></pre><p id="94a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你的Okta <code class="fe nd ne nf mt b">ORG_URL</code>可以在你的Okta仪表盘右上角找到。</p><p id="97f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的<code class="fe nd ne nf mt b">CLIENT_ID</code>是基于每个应用程序创建的。如果你访问你的Okta账户，点击<strong class="ka ir">应用程序，</strong>，你会看到你的项目名称下面有<code class="fe nd ne nf mt b">CLIENT_ID</code>。</p><p id="d4d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Okta API访问令牌可以通过访问Okta仪表板，点击API选项卡来创建。然后，您可以选择创建新令牌。</p><p id="fa6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦您将所有这些项目放入您的<code class="fe nd ne nf mt b">.env.local</code>中，我们将访问我们的<code class="fe nd ne nf mt b">App.js</code>文件，并将整个应用程序包装在一个从<code class="fe nd ne nf mt b">@okta/okta-react</code>导入的安全组件中。然后，这些密码被传递到该组件中，如下所示:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="d7a8" class="mx ll iq mt b gy my mz l na nb">import React, { Component } from 'react';<br/>import { BrowserRouter as Router, Route } from 'react-router-dom';<br/>import { Security, SecureRoute, ImplicitCallback } from '@okta/okta-react';<br/>import Home from './Home';<br/>import Login from './Login';<br/>import Protected from './Protected';<br/><br/>function onAuthRequired({history}) {<br/>    history.push('/login');<br/>}<br/><br/>class App extends Component {<br/>    render() {<br/>        return (<br/>            &lt;Router&gt;<br/>            &lt;Security issuer=    {`${process.env.REACT_APP_OKTA_ORG_URL}/oauth2/default`}<br/>                      redirect_uri={window.location.origin + '/implicit/callback'}<br/>                      client_id={process.env.REACT_APP_OKTA_CLIENT_ID}<br/>                      onAuthRequired={onAuthRequired} &gt;<br/>            &lt;Route path='/' exact={true} component={Home} /&gt;<br/>        &lt;SecureRoute path='/protected' component={Protected} /&gt;<br/>        &lt;Route path='/login' render={() =&gt; &lt;Login baseUrl='https://dev-951263.okta.com' /&gt;} /&gt;<br/>        &lt;Route path='/implicit/callback' component={ImplicitCallback} /&gt;<br/>        &lt;/Security&gt;<br/>        &lt;/Router&gt;<br/>    );<br/>    }<br/>}<br/><br/>export default App;</span></pre><p id="fca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">和…..瞧啊。！！！</strong></p><p id="402b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在已经成功通过Okta认证。</p><p id="f406" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在怎么办？有了用户的<code class="fe nd ne nf mt b">id_token</code>，你对用户的身份有了基本的诉求。您可以通过修改<code class="fe nd ne nf mt b">scopes</code>来检索关于用户的定制信息，从而扩展声明集。干得好！</p><p id="9e90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个项目及其文件可以在<a class="ae mn" href="https://github.com/gavmac/15-min-OKTA-register" rel="noopener ugc nofollow" target="_blank"> github </a>上找到并下载。</p></div></div>    
</body>
</html>