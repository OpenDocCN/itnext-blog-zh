<html>
<head>
<title>Attaching an Elastic IP to EKS worker node</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将弹性IP连接到EKS工作节点</h1>
<blockquote>原文：<a href="https://itnext.io/attaching-an-elastic-ip-to-eks-worker-node-f69b9d8fa521?source=collection_archive---------1-----------------------#2020-06-04">https://itnext.io/attaching-an-elastic-ip-to-eks-worker-node-f69b9d8fa521?source=collection_archive---------1-----------------------#2020-06-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gl gn jp jq jr js gh gi paragraph-image"><div class="gh gi jo"><img src="../Images/324b4562388ff87e87825f138555f463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*ip6KYgXR1Z_lM07mb6cOGg.png"/></div></figure><p id="3f2c" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">嗨，我还面临一个有趣的任务，在Kubernetes中运行STUN服务器。</p><p id="8334" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">STUN服务器需要通过整个<code class="fe kt ku kv kw b">1024-65535</code> udp端口范围，但是Kubernetes <a class="ae kx" href="https://github.com/kubernetes/kubernetes/issues/23864" rel="noopener ugc nofollow" target="_blank">不支持在服务</a>中指定端口范围。解决方案看起来很简单，用<code class="fe kt ku kv kw b">hostNetwork: true</code>运行pod，并把它分配给具有弹性IP的独立EC2实例。</p><p id="140a" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">问题是EKS不允许您创建单独的实例，而是指导您使用自动缩放组。因此，您没有机会静态地将弹性IP分配给特定的EKS工作者，但是您可以动态地这样做。</p><p id="fe58" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">实现这一点的最简单方法是将以下initContainer放入pod定义中:</p><figure class="ky kz la lb gt js"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="6608" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">不要忘记创建具有以下权限的特定aws帐户:</p><pre class="ky kz la lb gt le kw lf lg aw lh bi"><span id="87e7" class="li lj ir kw b gy lk ll l lm ln">{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Action": [<br/>        "ec2:AssociateAddress",<br/>        "ec2:DisassociateAddress"<br/>      ],<br/>      "Resource": "*"<br/>    }<br/>  ]<br/>}</span></pre><p id="0afc" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">这个应用的秘密是:</p><figure class="ky kz la lb gt js"><div class="bz fp l di"><div class="lc ld l"/></div></figure></div></div>    
</body>
</html>