<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://itnext.io/angular-cross-field-validation-for-reactive-forms-8913216635c6?source=collection_archive---------1-----------------------#2020-10-12">https://itnext.io/angular-cross-field-validation-for-reactive-forms-8913216635c6?source=collection_archive---------1-----------------------#2020-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/55ab32a462cb7488a0d05a34d9240569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yC9qLW3NERT5cDGFaN4pAg.png"/></div></div></figure><p id="6874" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">在我的上一篇文章中，我介绍了为我的<strong class="jf kc">角度反应式表单</strong>创建一个自定义表单控件验证器。</p><p id="b8bb" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">尽管表单控件验证器非常强大，但有时还不够。假设您需要一次验证多个控件。例如，当您有一个<strong class="jf kc"> <em class="kd">注册表</em> </strong>并且您必须检查<code class="fe ke kf kg kh b"><em class="kd">password</em></code>和<code class="fe ke kf kg kh b"><em class="kd">password_confirm</em></code>字段是否匹配时。</p><h1 id="20dc" class="ki kj je bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">创建自定义表单验证程序</h1><p id="d8d0" class="pw-post-body-paragraph jc jd je jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka im bi translated">让我们从创建一个新文件开始。我建议您创建一个新文件夹来保存您所有的验证器。</p><p id="e2d1" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">首先，我将创建并导出一个箭头函数，它接受一个<code class="fe ke kf kg kh b">FormGroup</code>参数并返回一个<code class="fe ke kf kg kh b">ValidatorFn</code>。</p><p id="d3e1" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">有了这个参数，我们现在可以验证多个控件，当然，也可以比较它们的值。</p><pre class="ll lm ln lo gt lp kh lq lr aw ls bi"><span id="8aea" class="lt kj je kh b gy lu lv l lw lx">const function <strong class="kh kc">passwordMatchValidator</strong>(form: FormGroup): ValidatorFn {<br/>   const password = form.controls['password'].value;<br/>   const password_confirm = form.controls['password_confirm'].value;</span><span id="cb0c" class="lt kj je kh b gy ly lv l lw lx">   if (!password || !password_confirm) {<br/>      return null;<br/>   }</span><span id="4013" class="lt kj je kh b gy ly lv l lw lx">   return (password === password_confirm) ? null : <strong class="kh kc">{mismatch: true}</strong>;<br/>}</span></pre><p id="a0ab" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">该函数接受一个<code class="fe ke kf kg kh b">FormGroup</code>参数并返回:</p><ol class=""><li id="e7f9" class="lz ma je jf b jg jh jk jl jo mb js mc jw md ka me mf mg mh bi translated">一个<code class="fe ke kf kg kh b">{[key]: [value]}</code>表达式，如果存在错误</li><li id="e0e7" class="lz ma je jf b jg mi jk mj jo mk js ml jw mm ka me mf mg mh bi translated"><code class="fe ke kf kg kh b">null</code>如果有效</li></ol><p id="ab5b" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">对于这个例子，我只关心这两个值是否相等。因此，如果这些值中的任何一个为空，我将返回<code class="fe ke kf kg kh b">null</code>。</p><h1 id="9185" class="ki kj je bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">将错误应用于每个控件</h1><p id="618a" class="pw-post-body-paragraph jc jd je jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka im bi translated">如果我们想显示两个字段的错误，我们还需要将它应用于两个表单控件。</p><pre class="ll lm ln lo gt lp kh lq lr aw ls bi"><span id="122b" class="lt kj je kh b gy lu lv l lw lx">const function <strong class="kh kc">passwordMatchValidator</strong>(form: FormGroup): ValidatorFn {<br/>   const password = form.controls['password'].value;<br/>   const password_confirm = form.controls['password_confirm'].value;</span><span id="85c7" class="lt kj je kh b gy ly lv l lw lx">if (!password || !password_confirm) {<br/>      return null;<br/>   }<br/>   <br/><strong class="kh kc">   form.controls['password'].setErrors({password: true});<br/>   form.controls['password_confirm'].setErrors({password: true});</strong></span><span id="b97f" class="lt kj je kh b gy ly lv l lw lx">   return (password === password_confirm) ? null : <strong class="kh kc">{mismatch: true}</strong>;<br/>}</span></pre><blockquote class="mn mo mp"><p id="7c41" class="jc jd kd jf b jg jh ji jj jk jl jm jn mq jp jq jr mr jt ju jv ms jx jy jz ka im bi translated"><em class="je">警告:</em> <code class="fe ke kf kg kh b"><em class="je">setErrors</em></code> <em class="je">方法代替了控制错误。</em></p></blockquote><h1 id="10e7" class="ki kj je bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">使用自定义验证程序</h1><p id="f863" class="pw-post-body-paragraph jc jd je jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka im bi translated">我们的验证器已经可以使用了！剩下的唯一一件事就是以我们的形式调用它，如下所示:</p><pre class="ll lm ln lo gt lp kh lq lr aw ls bi"><span id="cac4" class="lt kj je kh b gy lu lv l lw lx">import { Component, OnInit } from '@angular/core';<br/>import { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';<br/><strong class="kh kc">import { passwordMatchValidator } from './validators/password-match.validator';</strong><br/><br/>@Component({<br/>  ...<br/>})<br/>export class MyComponent implements OnInit {<br/>  myForm: FormGroup;<br/>  constructor() {}  <br/>  <br/>  ngOnInit() {<br/>     <strong class="kh kc">this.myForm = new FormGroup({<br/>       "password": new FormControl(''),<br/>       "password_confirm": new FormControl('')<br/>     }, <br/>     {<br/>       validators: passwordMatchValidator<br/>     });</strong><br/>  }</span></pre><p id="fc81" class="pw-post-body-paragraph jc jd je jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka im bi translated">希望你觉得这个指南有用！</p></div></div>    
</body>
</html>