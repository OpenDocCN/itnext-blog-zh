<html>
<head>
<title>Swift iOS CLLocationManager All-In-One</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift iOS CLLocationManager一体化</h1>
<blockquote>原文：<a href="https://itnext.io/swift-ios-cllocationmanager-all-in-one-b786ffd37e4a?source=collection_archive---------0-----------------------#2020-08-04">https://itnext.io/swift-ios-cllocationmanager-all-in-one-b786ffd37e4a?source=collection_archive---------0-----------------------#2020-08-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/a91259362a001c156d0e2cf7a1f6de32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eNUAMturKAiV9tuEErburA.png"/></div></div></figure><p id="f8cf" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated"><span class="l lb lc ld bm le lf lg lh li di">苹果公司为客户提供了许多优质服务。其中最有用和最著名的功能是她的位置探测技术。在<a class="ae lj" href="https://medium.com/@myrickchow/as-simple-as-possible-why-does-gps-need-at-least-4-satellite-signals-5bff178fedc0" rel="noopener"> GPS </a>和cell tower信号的帮助下，iOS可以操纵用户的当前位置。许多应用程序利用这一功能制作了优秀的应用程序，例如谷歌地图、苹果地图和口袋妖怪Go！</span></p><p id="fb58" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">是负责处理所有位置请求和系统回调的框架。它提供了许多高级API，用于配置位置请求和通知任何位置信息更新的应用程序，包括坐标和航向方向。您还可以借助GPX文件来模拟一系列位置更新，以便进行调试。</p><div class="lo lp gq gs lq lr"><a href="https://myrickchow.medium.com/simulate-debugging-location-in-ios-24496cbbc9d9" rel="noopener follow" target="_blank"><div class="ls ab fp"><div class="lt ab lu cl cj lv"><h2 class="bd iv gz z fq lw fs ft lx fv fx it bi translated">模拟iOS中的调试位置</h2><div class="ly l"><h3 class="bd b gz z fq lw fs ft lx fv fx dk translated">如何在iOS中调试位置服务？GPX的文件是关键！带时间戳的坐标可以帮助你完全模拟…</h3></div><div class="lz l"><p class="bd b dl z fq lw fs ft lx fv fx dk translated">myrickchow.medium.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf ka lr"/></div></div></a></div><p id="7bb5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lk ll lm ln b">CoreLocation</code>是一个大框架，我希望这篇文章能帮助你更好地理解它，并用它制作一个出色的应用程序。开始吧！</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="1d6d" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">项目设置—信息列表和功能</h1><h2 id="feb3" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">1.为位置隐私添加显示消息</h2><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/0bb794eb05c4f09f1236598840bea349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kyTyS0yfrGMgoUC6DV9fAQ.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">带有两个私钥和值的info.plist的屏幕截图</figcaption></figure><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj oi"><img src="../Images/3c41312bd4768229927c7a39cc19229b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__PGJqjKTMXPfZeMG165Ug.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">请求“使用中”(左)和“始终”(右)的授权对话框</figcaption></figure><p id="6df7" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当请求<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620562-requestwheninuseauthorization" rel="noopener ugc nofollow" target="_blank">requestwheniuseauthorization()</a>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620551-requestalwaysauthorization" rel="noopener ugc nofollow" target="_blank">requestAlwaysAuthorization</a>()</code>时，这些消息显示在认证对话框中</p><ol class=""><li id="e933" class="oj ok iu ke b kf kg kj kk kn ol kr om kv on kz oo op oq or bi translated">如果需要前景定位，必须增加<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationwheninuseusagedescription" rel="noopener ugc nofollow" target="_blank">NSLocationWhenInUseUsageDescription</a></code><strong class="ke iv"/>。</li><li id="e072" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">如果app想在后台状态下检索位置信息，必须添加<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationalwaysandwheninuseusagedescription" rel="noopener ugc nofollow" target="_blank">NSLocationAlwaysAndWhenInUseUsageDescription</a></code>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationwheninuseusagedescription" rel="noopener ugc nofollow" target="_blank">NSLocationWhenInUseUsageDescription</a></code>。</li></ol><blockquote class="ox oy oz"><p id="a580" class="kc kd pa ke b kf kg kh ki kj kk kl km pb ko kp kq pc ks kt ku pd kw kx ky kz in bi translated">不要把<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationalwaysusagedescription" rel="noopener ugc nofollow" target="_blank">Privacy — Location Always Usage Description</a></code>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationusagedescription" rel="noopener ugc nofollow" target="_blank">Privacy — Location Usage Description</a></code>的键搞混了。前者从iOS 11开始<strong class="ke iv">已被弃用</strong>，后者只在MacOS app中使用</p></blockquote><h2 id="2fdf" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">2.项目能力</h2><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pe"><img src="../Images/063acc0d5d67da712b4be5197dfb0451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZCM1wH9G6-NKOjYau5RNA.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">目标&gt;签名和功能&gt; "+功能"-&gt;后台模式</figcaption></figure><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pf"><img src="../Images/e8931336ab17c5b18e7c86682e04b04f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iONYnhD3Dh_Jw4s18bNaHg.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">必须勾选“位置更新”</figcaption></figure><p id="1922" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">如果你的应用程序想要在后台状态下检索位置信息，必须在“后台模式”选项卡中选中“位置更新”选项！</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="e615" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">7个步骤—请求一次性位置信息</h1><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><h2 id="86ed" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤1:导入核心位置依赖关系</h2><p id="9b22" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated"><code class="fe lk ll lm ln b">CoreLocation</code>是包含<code class="fe lk ll lm ln b">CLLocationManager</code>的框架，T5是用于检索位置信息和处理由位置变化触发的所有事件的帮助器类，例如地理围栏(当用户进入或退出特定的<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clcircularregion" rel="noopener ugc nofollow" target="_blank">CLCircularRegion</a></code>时)和<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423531-startmonitoringsignificantlocati" rel="noopener ugc nofollow" target="_blank">监视重要的位置变化</a>。</p><h2 id="805a" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤2:声明CLLocationManager变量</h2><p id="efbe" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">为了保存对<code class="fe lk ll lm ln b">CLLocationManager</code>的强引用，有必要在<code class="fe lk ll lm ln b">ViewController</code>级别声明一个变量。这可以确保我们在整个<code class="fe lk ll lm ln b">ViewController</code>生命周期中处理相同的<code class="fe lk ll lm ln b">CLLocationManager</code>。</p><h2 id="3f50" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤3:初始化并配置CLLocationManager</h2><p id="741b" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">许多属性可以选择性地配置给一个<code class="fe lk ll lm ln b">CLLocationManager</code>，但是只有<code class="fe lk ll lm ln b">delegate</code>属性(<code class="fe lk ll lm ln b">CLLocationManagerDelegate</code>)是处理来自<code class="fe lk ll lm ln b">CLLocationManager</code>的所有回调所必须的。其他属性包括<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423836-desiredaccuracy" rel="noopener ugc nofollow" target="_blank">期望精度</a>、<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620567-activitytype" rel="noopener ugc nofollow" target="_blank">活动类型</a>、<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423500-distancefilter" rel="noopener ugc nofollow" target="_blank">距离过滤器</a>和<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620550-headingfilter" rel="noopener ugc nofollow" target="_blank">航向过滤器</a>等。这些都将在以后的会议中详细讨论。</p><h2 id="1964" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤4:请求位置授权</h2><p id="775b" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">可以请求两种类型的位置授权，一种是“正在使用中”，另一种是“总是”。</p><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div class="gi gj pl"><img src="../Images/82d0f5002a957f2c364f57ca485c2f6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*99VURUPRgiPSJebDm0NzIg.png"/></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">背景位置使用指示器</figcaption></figure><p id="6a9d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><strong class="ke iv">“使用中”</strong>仅在app在<strong class="ke iv">前台</strong>或后台位置使用指示器<strong class="ke iv">启用</strong>的后台检索位置信息时请求。</p><p id="da90" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><strong class="ke iv">【总是】</strong>当位置信息可以在后台检索时，即使后台位置使用指示器<strong class="ke iv">被禁用</strong>也需要。</p><blockquote class="ox oy oz"><p id="5c73" class="kc kd pa ke b kf kg kh ki kj kk kl km pb ko kp kq pc ks kt ku pd kw kx ky kz in bi translated">要获得“始终”授权，您的应用程序必须首先请求“使用时”权限，然后请求“始终”授权。</p><p id="4871" class="kc kd pa ke b kf kg kh ki kj kk kl km pb ko kp kq pc ks kt ku pd kw kx ky kz in bi translated">参考:<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620551-requestalwaysauthorization" rel="noopener ugc nofollow" target="_blank">苹果文档</a></p></blockquote><h2 id="b41e" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤5:实现CLLocationManagerDelegate</h2><p id="fb40" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated"><code class="fe lk ll lm ln b">CLLocationManagerDelegate</code>对于处理从<code class="fe lk ll lm ln b">CLLocationManager</code>触发的所有事件至关重要。最重要的回调是<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423701-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didChangeAuthorization:)</a></code>、<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423615-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didUpdateLocations:</a></code>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423786-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didFailWithError:</a></code>。它们将在以后的另一节课中讨论。</p><h2 id="1a2e" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤6:当“使用中”或“总是”授权被授予时请求位置</h2><p id="bd30" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">在<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423701-locationmanager" rel="noopener ugc nofollow" target="_blank">locationManager(_:didChangeAuthorization:)</a></code>得到正确的许可确认后，通过调用<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1620548-requestlocation" rel="noopener ugc nofollow" target="_blank">request location()</a>,<code class="fe lk ll lm ln b">CLLocationManager</code>可以开始通过GPS或蜂窝塔网络获取位置信息。</p><h2 id="3e54" class="nl mo iu bd mp nm nn dn mt no np dp mx kn nq nr nb kr ns nt nf kv nu nv nj nw bi translated">步骤7:处理位置信息</h2><p id="69ab" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">就在<code class="fe lk ll lm ln b">CLLocationManager</code>检索到位置信息后，用嵌入在<code class="fe lk ll lm ln b">locations</code>参数中的信息触发<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423615-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didUpdateLocations:</a> </code>。</p><p id="8e75" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated">C  <code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocation" rel="noopener ugc nofollow" target="_blank">LLocation</a></code>是一个包含大量关于位置的有用信息的类。有用的是既有纬度又有经度的<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423786-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">CLLocationCoordinate2D</a></code>、关于位置检索时间的<code class="fe lk ll lm ln b">timestamp</code>和关于应用程序对位置的信任程度的<code class="fe lk ll lm ln b">horizontalAccuracy</code>。</p><p id="05af" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">下面是一个<code class="fe lk ll lm ln b">CLLocation</code>对象的例子:</p><pre class="nx ny nz oa gu pm ln pn po aw pp bi"><span id="b756" class="nl mo iu ln b gz pq pr l ps pt">{<br/>  coordinate: {<br/>    latitude: 22.42550181697769,<br/>    longitude: 114.23000319878552<br/>  },<br/>  altitude: 23.69447899864746,<br/>  horizontalAccuracy: 65.0,<br/>  verticalAccuracy: 10.0,<br/>  floor: {<br/>    level: 1<br/>  },<br/>  speed: 32.0,<br/>  speedAccuracy: 1.0,<br/>  timestamp: 2020-08-02 15:14:33,<br/>  courseAccuracy: 0.4,<br/>  course: 33.2,<br/>}</span></pre></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="0df4" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">进一步讨论</h1><p id="1864" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">现在，我们将讨论<code class="fe lk ll lm ln b">CLLocationManager</code>的配置和<code class="fe lk ll lm ln b">CLLocationManagerDelegate</code>的相应回调。如果你只是想在前台获得一个单一的位置信息，你已经完成，可以跳过以下部分。我将介绍以下配置和特性:</p><ol class=""><li id="c7dd" class="oj ok iu ke b kf kg kj kk kn ol kr om kv on kz oo op oq or bi translated">授权状态</li><li id="0b14" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">期望精度(纬度和经度)</li><li id="38fa" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">距离过滤器(公差单位为米)</li><li id="382e" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">航向(磁北极和真北的方向)</li><li id="1bd0" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">活动类型</li><li id="64b7" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">地理围栏(进入/退出一个区域)</li><li id="a777" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">航向和速度</li><li id="6e62" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">持续监控位置更新</li><li id="9dd0" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">监控重要的位置变化</li><li id="6121" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated">监控标题更新</li></ol></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="4df6" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">授权状态</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pu"><img src="../Images/47d217554db22d9f7f7311d42b928173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82PeAMAanS4nY7BecTloCg.png"/></div></div></figure><p id="4bdc" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用户可以在两个级别向应用授予位置授权，即<strong class="ke iv">系统级</strong>和<strong class="ke iv">应用级</strong>。系统级授权是一个全局设置，可以禁用或启用设备中的所有应用程序。应用程序级别1仅指定给特定应用程序，包含5种不同的授权状态(尽管上图中仅显示了4种状态):</p><ol class=""><li id="1188" class="oj ok iu ke b kf kg kj kk kn ol kr om kv on kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clauthorizationstatus/denied" rel="noopener ugc nofollow" target="_blank">CLAuthorizationStatus.denied</a></code> <br/>设置选项:<strong class="ke iv"><br/></strong>系统设置:<strong class="ke iv">【位置服务】</strong>在系统层面被禁用或者<br/> <strong class="ke iv">飞机</strong>模式开启，禁止设备检索任何位置数据。</li><li id="7a8b" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clauthorizationstatus/notdetermined" rel="noopener ugc nofollow" target="_blank">CLAuthorizationStatus.notDetermined</a></code> <br/>设置选项:<strong class="ke iv">下次询问</strong></li><li id="bc52" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clauthorizationstatus/authorizedwheninuse" rel="noopener ugc nofollow" target="_blank">CLAuthorizationStatus.authorizedWhenInUse</a></code> <br/>使用App 时设置选项:<strong class="ke iv"/></li><li id="bbcd" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clauthorizationstatus/authorizedalways" rel="noopener ugc nofollow" target="_blank">CLAuthorizationStatus.authorizedAlways</a></code> <br/>设置选项:<strong class="ke iv">始终</strong></li><li id="e3de" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clauthorizationstatus/restricted" rel="noopener ugc nofollow" target="_blank">CLAuthorizationStatus.restricted</a></code> <br/>受<strong class="ke iv">家长控制</strong>限制</li></ol><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pv"><img src="../Images/39b53464deb46c9d22f93c1d7325da93.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*QB2rR_Vx4JXUbcPc_MysWA.png"/></div></div></figure><p id="58da" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当app请求位置授权但系统级位置服务被禁用时，弹出上述对话框，将用户重定向到<code class="fe lk ll lm ln b">Settings</code>页面，手动切换回位置服务。这个弹出对话框是默认的iOS行为，开发者不需要为此执行任何代码。</p><p id="73c5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">此外，可以使用<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423648-locationservicesenabled" rel="noopener ugc nofollow" target="_blank">CLLocationManager.locationServicesEnabled()</a></code>来检查系统定位服务是否启用，然后在应用程序端显示某些消息。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="cd57" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">期望精度</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pw"><img src="../Images/864910df37a5c279a6b5a02a07c13dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wVhepbVfWQb-SJBy.jpg"/></div></div></figure><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="0b02" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">不同的精度导致不同水平的电池使用。为了更精确的定位，系统必须使用来自卫星的GPS信号，精度可以达到几十米。但是，缺点是电池使用率高。通过使用精度较低的电平手段(~城市街区)——<strong class="ke iv">手机信号</strong>，功耗大大降低。</p><p id="0dda" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">共有7个<code class="fe lk ll lm ln b">CLLocationAccuracy</code>常量。默认值为<code class="fe lk ll lm ln b">kCLLocationAccuracyBest</code>。</p><ol class=""><li id="8943" class="oj ok iu ke b kf kg kj kk kn ol kr om kv on kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcllocationaccuracybestfornavigation" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyBestForNavigation</a></code> —精度是所有可用选项中最高的；它需要相对<strong class="ke iv">更大的力量</strong>来保持高精度。<strong class="ke iv">官方建议仅在手机插电时使用此选项！</strong></li></ol><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="a624" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">2.<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcllocationaccuracybest" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyBest</a></code>(默认)—精确度高，但不如<code class="fe lk ll lm ln b">kCLLocationAccuracyBestForNavigation</code>精确</p><p id="d8e2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kCLLocationAccuracyNearestTenMeters" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyNearestTenMeters</a></code>—10米</p><p id="6b34" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">4.<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcllocationaccuracyhundredmeters" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyHundredMeters</a></code>—100米</p><p id="ca3b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">5.<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcllocationaccuracykilometer" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyKilometer</a></code>—1公里</p><p id="a0ec" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">6.<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcllocationaccuracythreekilometers" rel="noopener ugc nofollow" target="_blank">kCLLocationAccuracyThreeKilometers</a></code>—3公里</p><p id="6523" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><em class="pa">参考:</em><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationaccuracy" rel="noopener ugc nofollow" target="_blank"><em class="pa">CLLocationAccuracy官方文档</em> </a></p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="58cf" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">距离过滤器</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div class="gi gj px"><img src="../Images/c3f937a2494ccdd44aaae467da234d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*inPdu8Yk2aAOi6P6xKcY1Q.png"/></div></figure><p id="9d99" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">这是用户为了让<code class="fe lk ll lm ln b">CLLocationManager</code>触发位置更新而必须“水平”移动的<strong class="ke iv">最小距离</strong>(单位为米)。“水平地”的定义是沿着纬度(南北方向)和经度(西向东方向)而不是高度(由低到高的方向)。</p><p id="205b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">默认值是<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/kcldistancefilternone" rel="noopener ugc nofollow" target="_blank">kCLDistanceFilterNone</a></code>，这意味着水平方向的每一个变化都会触发<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423615-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didUpdateLocations:</a></code>回调。</p><p id="7a3b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">通过将其设置为较小的值，可以消除由随机信号不稳定性导致的位置更新。</p><p id="e87a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><em class="pa">参考:</em> <a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423500-distancefilter" rel="noopener ugc nofollow" target="_blank"> <em class="pa">距离滤波器</em> </a></p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="2a48" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">标题</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj py"><img src="../Images/4e0700f8bab84a6abaf2be9f18ab96a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lE_BCQIaI6Y3e6R-lsg9cg.png"/></div></div></figure><p id="bd79" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">“航向”表示用户设备的方向与磁北或真北之间的度数。这里有一个例子:</p><p id="8ed6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">didUpdateHeading</p><pre class="nx ny nz oa gu pm ln pn po aw pp bi"><span id="b00b" class="nl mo iu ln b gz pq pr l ps pt">{<br/>  magneticHeading: 123.333,<br/>  trueHeading: ...,<br/>  headingAccuracy: ...,<br/>  x: ...,<br/>  y: ...,<br/>  z: ...,<br/>  timestamp: ...<br/>}</span></pre><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pz"><img src="../Images/707e319994d63300965d67d991c8f661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CirqFisgZNruFlOVqYqAJA.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">地磁北极和真北相距约1000公里，这导致了地球上大多数地方的磁偏角。</figcaption></figure><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj qa"><img src="../Images/7c0977801c3f4b3658e3c3adc567a9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSNnTDuPRv7E0LZDD-jrNw.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated">黄色是旋转轴</figcaption></figure><p id="8699" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">磁北极是磁铁的南极指向的北极。然而，真北是地球自转轴在磁北方向的尖端。建议观看一段<a class="ae lj" href="https://www.youtube.com/watch?v=ieW7Hzrr8pw" rel="noopener ugc nofollow" target="_blank"> Youtube视频——指南针:真北vs磁北</a>以了解更多信息。</p><p id="903e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">一句话总结，我们通常在地图导航中使用<code class="fe lk ll lm ln b">magneticHeading</code>的值就是<code class="fe lk ll lm ln b">trueHeading</code>。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="584b" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">活动类型</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj qb"><img src="../Images/60e9753531297414194572ec6a60a174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUqeU6zzQBsuafjep0oiBg.png"/></div></div></figure><p id="1c9d" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当<strong class="ke iv">不可能</strong>改变位置时，<code class="fe lk ll lm ln b">CLLocationManager</code>确定在后台状态暂停位置更新的策略以节省功耗是一个变量。有5种不同类型的<code class="fe lk ll lm ln b">activityType</code>:</p><ol class=""><li id="9231" class="oj ok iu ke b kf kg kj kk kn ol kr om kv on kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clactivitytype/automotivenavigation" rel="noopener ugc nofollow" target="_blank">automotiveNavigation</a></code>:用于车载导航</li><li id="c746" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clactivitytype/othernavigation" rel="noopener ugc nofollow" target="_blank">otherNavigation</a></code>:用于汽车以外的其他交通工具，如轮船、火车等</li><li id="69b6" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clactivitytype/fitness" rel="noopener ugc nofollow" target="_blank">fitness</a></code>:用于行人导航<br/> *室内位置禁用</li><li id="c0a5" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clactivitytype/airborne" rel="noopener ugc nofollow" target="_blank">airborne</a></code>:用于飞机导航</li><li id="8532" class="oj ok iu ke b kf os kj ot kn ou kr ov kv ow kz oo op oq or bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clactivitytype/other" rel="noopener ugc nofollow" target="_blank">other</a></code>:默认值</li></ol><p id="0356" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">根据<code class="fe lk ll lm ln b">activityType</code>暂停位置服务后，重启服务是开发者的责任，而不是iOS！<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/usernotifications/unlocationnotificationtrigger" rel="noopener ugc nofollow" target="_blank">UNLocationNotificationTrigger</a></code></p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="379b" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">地理围栏(区域监测)</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj qc"><img src="../Images/5ece81e7754dd4dffb032997dd332c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c4AjsbIS9J5sZSvG.png"/></div></div></figure><p id="6a04" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">当iOS检测到用户“刚刚”进入和退出由带有纬度、经度和半径的<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clcircularregion" rel="noopener ugc nofollow" target="_blank">CLCircularRegion</a></code>定义的区域时，可以通知应用程序。</p><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="e1e2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">上面的代码不言自明。当用户进入和退出特定的<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/clcircularregion" rel="noopener ugc nofollow" target="_blank">CLCircularRegion</a></code>、<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423560-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didEnterRegion:</a></code>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423630-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">locationManager:didExitRegion:</a></code>将被分别调用。</p><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><blockquote class="ox oy oz"><p id="6dca" class="kc kd pa ke b kf kg kh ki kj kk kl km pb ko kp kq pc ks kt ku pd kw kx ky kz in bi translated">在iOS架构中，用于监控<code class="fe lk ll lm ln b">CLLocationRegion</code>的资源由设备中的所有应用共享。所以iOS为了平衡所有app的利益，把<code class="fe lk ll lm ln b">CLLocationRegion</code>的最大金额限制在了<strong class="ke iv">【20】</strong>之间。</p><p id="f042" class="kc kd pa ke b kf kg kh ki kj kk kl km pb ko kp kq pc ks kt ku pd kw kx ky kz in bi translated">参考:<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/monitoring_the_user_s_proximity_to_geographic_regions" rel="noopener ugc nofollow" target="_blank">苹果开发者文档——监控用户与地理区域的接近度</a></p></blockquote></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="5de0" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">航向和速度</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj qd"><img src="../Images/ea6c79b212ba61ca012c0cb5cb1ee031.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/0*nwNe-IpHJVOV3eWV.jpg"/></div></div></figure><p id="dbb5" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">设备用户移动的方向。它是一个代表从磁北开始计数的度数的<code class="fe lk ll lm ln b">Double</code>。精度可参考<code class="fe lk ll lm ln b">courseAccuracy</code>字段，但仅从iOS 13.4开始可用。</p><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="39e1" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在<code class="fe lk ll lm ln b">CLLocationManager</code>检测到两个或更多位置信息之前，它可以计算速度并通过<code class="fe lk ll lm ln b">speedAccuracy</code>将其存储在<code class="fe lk ll lm ln b">speed</code>字段中。</p><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="0f90" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><em class="pa">参考:</em><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationdirection" rel="noopener ugc nofollow" target="_blank"><em class="pa">CLLocationDirection |苹果开发者文档</em> </a></p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="55f4" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">持续监控位置更新</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div class="gi gj qe"><img src="../Images/d87b38e59d1b97598c2371e2e93d6110.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*XQFE13B2-NLM9_ys8gM3lA.png"/></div></figure><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="b138" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">除了请求单个位置，app还可以通过调用<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423750-startupdatinglocation" rel="noopener ugc nofollow" target="_blank">startUpdatingLocation(</a>)</code>来持续监控位置更新。它使用<code class="fe lk ll lm ln b">distanceFilter</code>来设置每次位置更新的距离容差。换句话说，只有当用户从最后检测到的位置移动了特定的距离时，应用程序才会被通知。</p><p id="55e7" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">新的位置都被发送到<a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate/1423615-locationmanager?language=objc" rel="noopener ugc nofollow" target="_blank">location manager:diddupdatelocations:</a>。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="55ae" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">监控重要的位置变化</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj qf"><img src="../Images/e3a975049664d665b60744b0fcd0acda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IjDTjQJCr62lPfu1.jpg"/></div></div></figure><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="9e5c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423531-startmonitoringsignificantlocati" rel="noopener ugc nofollow" target="_blank">startMonitoringSignificantLocationChanges()</a></code>提供与<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423750-startupdatinglocation" rel="noopener ugc nofollow" target="_blank">startUpdatingLocation(</a>)</code>类似的服务。它们都提供持续的位置更新服务，即使应用程序被发送到后台。</p><p id="7e9b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">然而，<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423531-startmonitoringsignificantlocati" rel="noopener ugc nofollow" target="_blank">startMonitoringSignificantLocationChanges()</a></code>中的距离公差是由系统决定的。只有当用户行驶了500米或更远时，应用程序才能收到通知。两个连续的通知必须至少相隔5分钟。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="1c87" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">监控标题更新</h1><figure class="nx ny nz oa gu jv gi gj paragraph-image"><div class="gi gj qg"><img src="../Images/f558f0e7f7afc2fc7b5e24bc97bdb9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*oBC6NVJdX616Dwg0biRn-Q.png"/></div></figure><figure class="nx ny nz oa gu jv"><div class="bz fq l di"><div class="ob oc l"/></div></figure><p id="30c6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">就像坐标(纬度和经度)信息一样，iOS提供了一种在用户航向改变时获得通知的方法。用法类似于<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/corelocation/cllocationmanager/1423750-startupdatinglocation" rel="noopener ugc nofollow" target="_blank">startUpdatingLocation(</a>)</code>功能。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="3f6a" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">摘要</h1><p id="8218" class="pw-post-body-paragraph kc kd iu ke b kf pg kh ki kj ph kl km kn pi kp kq kr pj kt ku kv pk kx ky kz in bi translated">框架为我们提供了一个用户友好的工具来检测用户的位置信息，并在位置信息改变时提供通知。</p><p id="e255" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在开始编码之前，<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationalwaysandwheninuseusagedescription" rel="noopener ugc nofollow" target="_blank">NSLocationAlwaysAndWhenInUseUsageDescription</a></code>和<code class="fe lk ll lm ln b"><a class="ae lj" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nslocationwheninuseusagedescription" rel="noopener ugc nofollow" target="_blank">NSLocationWhenInUseUsageDescription</a></code>需要添加到项目<code class="fe lk ll lm ln b">info.plist</code>中，以提供请求授权的消息。</p><p id="4758" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe lk ll lm ln b">CLLocationManager</code>可配置<code class="fe lk ll lm ln b">desiredAccuracy</code>、<code class="fe lk ll lm ln b">activityType</code>、<code class="fe lk ll lm ln b">distanceFilter</code>和<code class="fe lk ll lm ln b">headingFilter</code>。它还可以在用户位置(500米以上)发生重大变化时通知应用程序，但连续通知必须间隔5分钟。</p></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><h1 id="26d7" class="mn mo iu bd mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk bi translated">您可能对以下内容感兴趣:</h1><div class="lo lp gq gs lq lr"><a href="https://myrickchow.medium.com/simulate-debugging-location-in-ios-24496cbbc9d9" rel="noopener follow" target="_blank"><div class="ls ab fp"><div class="lt ab lu cl cj lv"><h2 class="bd iv gz z fq lw fs ft lx fv fx it bi translated">模拟iOS中的调试位置</h2><div class="ly l"><h3 class="bd b gz z fq lw fs ft lx fv fx dk translated">如何在iOS中调试位置服务？GPX的文件是关键！带时间戳的坐标可以帮助你完全模拟…</h3></div><div class="lz l"><p class="bd b dl z fq lw fs ft lx fv fx dk translated">myrickchow.medium.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf ka lr"/></div></div></a></div><div class="lo lp gq gs lq lr"><a href="https://medium.com/@myrickchow/as-simple-as-possible-why-does-gps-need-at-least-4-satellite-signals-5bff178fedc0" rel="noopener follow" target="_blank"><div class="ls ab fp"><div class="lt ab lu cl cj lv"><h2 class="bd iv gz z fq lw fs ft lx fv fx it bi translated">尽可能简单—为什么GPS至少需要4个卫星信号？</h2><div class="ly l"><h3 class="bd b gz z fq lw fs ft lx fv fx dk translated">GPS是一种基于卫星的导航系统，用于在全球范围内定位用户位置。我们来看看GPS的解释可以是怎样的…</h3></div><div class="lz l"><p class="bd b dl z fq lw fs ft lx fv fx dk translated">medium.com</p></div></div><div class="ma l"><div class="qh l mc md me ma mf ka lr"/></div></div></a></div></div><div class="ab cl mg mh hy mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="in io ip iq ir"><p id="cf22" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">欢迎您在<a class="ae lj" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ my rik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>