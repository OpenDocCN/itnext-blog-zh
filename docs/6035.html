<html>
<head>
<title>MAAS Integration with VirtualBox (vboxpower)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MAAS与VirtualBox (vboxpower)的集成</h1>
<blockquote>原文：<a href="https://itnext.io/maas-integration-with-virtualbox-20d850381c21?source=collection_archive---------3-----------------------#2021-07-28">https://itnext.io/maas-integration-with-virtualbox-20d850381c21?source=collection_archive---------3-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8c24e1cac79c51de5430265bd13a3d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0T1Fm9T0XzMsH3AoHQT4bQ.png"/></div></div></figure><p id="10e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> MAAS </strong>是一款不可思议的工具，可用于创建包含物理和虚拟服务器的本地裸机云。本文的目标不是介绍MAAS本身。如果您不熟悉MAAS，请阅读关于<a class="ae kw" href="https://maas.io/" rel="noopener ugc nofollow" target="_blank"> MAAS的官方文档。IO </a>网站。我们是来整合MAAS和VirtualBox的。如您所知，MAAS本身不支持VirtualBox电源类型，要调配VirtualBox虚拟机，我们应该使用手动电源类型。对于手动电源类型，MAAS不会自动完成电源管理过程。这个过程是我们自己完成的。本文将通过使用<strong class="ka ir"> vboxpower </strong>为您提供解决这一问题的方案。</p><h1 id="0fef" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">vboxpower是什么？</h1><p id="0663" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">vboxpower是一个包装器，使MAAS能够自动管理VirtualBox虚拟机的功能。vboxpower与MAAS webhook驱动程序结合使用，可自动执行VirtualBox虚拟机的电源管理过程。关于<a class="ae kw" href="https://github.com/ssbostan/vboxpower" rel="noopener ugc nofollow" target="_blank"> vboxpower </a> GitHub库的更多信息。</p><h1 id="bcea" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何部署vboxpower？</h1><p id="8706" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我将演示在Ubuntu 20.04上的部署步骤，但是对于其他环境也是类似的。让我们开始吧。</p><p id="0b6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 1-安装VirtualBox: </strong></p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="4aa8" class="mj ky iq mf b gy mk ml l mm mn">sudo apt update &amp;&amp; sudo apt install -y virtualbox</span></pre><p id="cc78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2-安装VirtualBox扩展包:</strong></p><p id="805b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到VirtualBox <a class="ae kw" href="https://www.virtualbox.org/wiki/Downloads" rel="noopener ugc nofollow" target="_blank">下载</a>页面，下载扩展包的正确版本。要安装扩展包，打开VirtualBox，进入<strong class="ka ir">文件- &gt;首选项- &gt;扩展</strong>，添加下载的包。安装此软件包是为了支持虚拟机上的PXE启动。</p><p id="2ec7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3-安装VirtualBox SDK(vbox power需要):</strong></p><p id="f40e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">vboxpower使用vboxapi与VirtualBox通信。从VirtualBox下载页面，下载适当版本的SDK软件包。要安装SDK，请运行下列步骤。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="6789" class="mj ky iq mf b gy mk ml l mm mn">unzip VirtualBoxSDK-6.1.24-145767.zip<br/>cd sdk/installer<br/>sudo VBOX_INSTALL_PATH=/usr/lib/virtualbox python3 vboxapisetup.py install</span></pre><p id="bcd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4-安装vboxpower: </strong></p><p id="2126" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">克隆<a class="ae kw" href="https://github.com/ssbostan/vboxpower" rel="noopener ugc nofollow" target="_blank"> vboxpower </a>并运行以下命令:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="b3a3" class="mj ky iq mf b gy mk ml l mm mn">sudo apt install -y python3-pip<br/>git clone <a class="ae kw" href="https://github.com/ssbostan/vboxpower" rel="noopener ugc nofollow" target="_blank">https://github.com/ssbostan/vboxpower</a><br/>cd vboxpower<br/>sudo ./deploy</span></pre><p id="2991" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署脚本创建一个systemd服务并将<strong class="ka ir"> vboxpower.py </strong>复制到<strong class="ka ir"> /opt/maas/vboxpower </strong>目录。之后，该服务将自动启动。如果一切顺利，可以在所有网络接口的端口5241/tcp上访问vboxpower。</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="c678" class="mj ky iq mf b gy mk ml l mm mn">curl 192.168.56.1:5241<br/>curl 192.168.56.1:5241<br/>{<br/>  "machines": [<br/>    {<br/>      "links": {<br/>        "off": "/pfsense/off",<br/>        "on": "/pfsense/on",<br/>        "status": "/pfsense/status"<br/>      },<br/>      "name": "pfsense",<br/>      "status": "running"<br/>    },<br/>    {<br/>      "links": {<br/>        "off": "/maas/off",<br/>        "on": "/maas/on",<br/>        "status": "/maas/status"<br/>      },<br/>      "name": "maas",<br/>      "status": "running"<br/>    }<br/>  ]<br/>}</span></pre><p id="69d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5-创建新的虚拟机:</strong></p><p id="5af0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过在VirtualBox上添加新的虚拟机，您应该在vboxpower 5241/tcp上看到虚拟机信息—再次卷曲它。请考虑，在这个步骤中需要之前安装的扩展包。新的虚拟机应该能够从网络启动。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/997c9f9b89d96a4225f4ffba8b0dae82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*NrCpFUUNGvdHNzPAsZMSww.png"/></div></figure><p id="5287" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 6-将机器添加到MAAS: </strong></p><p id="7db7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要添加之前创建的机器，您必须使用Webhook电源类型进行电源管理。在必需的webhook URI字段中，分别添加以下URIs。</p><p id="9e73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">http://HOST _ IP:5241/VM _ NAME/on</strong></p><p id="d62d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">http://主机IP:5241/虚拟机名称/关闭</strong></p><p id="912a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">http://主机IP:5241/虚拟机名称/状态</strong></p><p id="a285" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用您自己的信息替换HOST_IP和VM_NAME。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/e251023a671712e24173e0ace5212884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O40Jus58dmwIfeJZNuVwrA.png"/></div></div></figure><p id="99e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 7-聚会时间:</strong></p><p id="49e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加机器后，机器的启动/停止过程应由MAAS自动完成。</p><h1 id="5ed6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论:</h1><p id="0de3" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">通过MAAS webhook驱动程序，我们可以为我们的基础设施开发定制驱动程序。除了使用此驱动程序来管理VirtualBox虚拟机电源，您还可以阅读我的驱动程序代码，并为您的基础架构编写自己的驱动程序。不要限制自己！编程的世界可以让我们的世界发展得更快。祝你一切顺利。</p><p id="59a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的领英<a class="ae kw" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p></div></div>    
</body>
</html>