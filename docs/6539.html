<html>
<head>
<title>Entity Framework Dev Environment in Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker中的实体框架开发环境</h1>
<blockquote>原文：<a href="https://itnext.io/database-development-in-docker-with-entity-framework-core-95772714626f?source=collection_archive---------1-----------------------#2021-12-13">https://itnext.io/database-development-in-docker-with-entity-framework-core-95772714626f?source=collection_archive---------1-----------------------#2021-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c3b01732786a850b9df4a63884fe0903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bpcSrJ_fSKrPmiP1"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@campaign_creators?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">活动发起人</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4e36" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我对Docker开发环境有点厌烦了吗？希望不会！这一次，我将展示一个非常引人注目的Docker用例，我认为它可以对几乎任何规模的开发团队产生立竿见影的影响。这是迄今为止我最喜欢的一张！</p><p id="4baf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为一名开发人员，在过去的17年里，我参与的项目多得数不清。如今，在本地下载代码通常是一件简单的事情，然后我们就可以走了。启动并运行一个本地数据库通常更麻烦。具体来说，我经常发现我需要安装特定数据库平台的特定版本，然后或者定位快照文件，运行脚本，或者让“那个家伙”来做这件事，他在过去的大约100年里为所有新的开始做这件事。所有这些都不理想。</p><p id="6880" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用dev容器和Visual Studio代码可以减轻所有这些痛苦，并通过一个<code class="fe le lf lg lh b">git clone</code>在本地下载数据库。</p><p id="e8b5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为使用Docker来配置和存储开发环境是一个非常强大的概念。这是“基础设施即代码”的下一次进化。当使用Docker时，我们基本上以“开发环境作为代码”结束。定义环境的代码随着repo一起移动，并且随着项目的增长而更新和改变。这意味着开发环境总是同步的，永远不会过时。</p><p id="0f40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我将演示如何在Docker容器中设置数据库服务器，并用一些基本数据初始化它，以便团队中的新开发人员可以简单地<code class="fe le lf lg lh b">git clone</code>回购，并立即开始编码。<em class="li">建立本地数据库没有额外的开销。</em></p><p id="e068" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个例子的代码在我的Github上是<a class="ae kf" href="https://github.com/AndyWatt83/database-docker-dev-env" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><p id="1b5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章将只关注数据库项目，但是请记住，我之前已经向<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/net-development-in-docker-6509d8a5077b">展示了如何使用. NET WebAPI </a>和<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/angular-development-in-docker-with-dev-containers-49d2cabad445"> Angular前端</a>来完成这项工作。这三者可以合并成一个完整的堆栈环境…请看这个空间。</p><p id="9e5d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一如既往，前提条件是:</p><ul class=""><li id="5c28" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated"><a class="ae kf" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="bf83" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated"><a class="ae kf" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li><li id="2900" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">VSCode的“<a class="ae kf" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" rel="noopener ugc nofollow" target="_blank">远程容器</a>”扩展</li><li id="d172" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">运行bash shell的终端</li><li id="a494" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">如果你使用的是Windows，<a class="ae kf" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" rel="noopener ugc nofollow" target="_blank">我推荐WSL </a>，尽管这不是必须的。</li></ul><h1 id="17ad" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">初始设置</h1><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/ed34d468a6f1a99cd276acee444ad4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u3hbmycwcylVQ4nv"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@clemensvanlay?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克莱门斯范雷</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="bc40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从一个空目录开始。打开你的终端</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="a17e" class="ne ly it lh b gy nf ng l nh ni">mkdir database-docker-dev-env; \<br/>cd database-docker-dev-env; \<br/>code .</span></pre><p id="8f40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将在空目录中打开VSCode。VSCode会在左下角告诉你它在哪个环境下运行。这有助于跟踪你的位置。此时，我们仍然在主机上，而不是在docker环境中。在我的情况下，这是WSL。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/3b321a8057a3ea5049f0236558c148bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/format:webp/1*ixUwvhFDSGdAq_lbsjW-JQ.png"/></div></figure><p id="b7f1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面给了我们一个空文件夹——完全空白的画布。您可以通过按F1键并浏览菜单来自动设置这些开发容器，但这次我将使用一个相当定制的设置，所以我将手动设置。</p><p id="0513" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个解决方案需要两个Docker容器。</p><ul class=""><li id="e3e9" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated">开发环境将在一个容器中运行，包含所有常见的开发依赖项，如dotnet、vim等。</li><li id="c83a" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">另一个是数据库服务器。在这个例子中，我们将运行Postgres。</li></ul><p id="05f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将使用Docker Compose进行编排。将以下内容复制/粘贴到终端中，以设置文件夹和所需文件。</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="ce72" class="ne ly it lh b gy nf ng l nh ni">mkdir docker; \<br/>cd docker; \<br/>mkdir database; \<br/>mkdir dev-env; \<br/>touch docker-compose.yaml; \<br/>cd dev-env; \<br/>touch Dockerfile; \<br/>cd ..; \<br/>cd database; \<br/>touch database.env;</span></pre><p id="ef25" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">文件夹应该如下所示:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/3fc9ff25bab46e83a27fc904c56b4401.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*YFR5jb4SH1SNPeetvL_krg.png"/></div></figure><h1 id="4d4a" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">Docker设置</h1><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/47dd61c01214212eddb33053b6925755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p5TVwR9tbsjZKki3"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@carrier_lost?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">伊恩·泰勒</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1604" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我将演示如何配置所有docker的东西。</p><h2 id="869a" class="ne ly it bd lz nm nn dn md no np dp mh kr nq nr ml kv ns nt mp kz nu nv mt nw bi translated">开发环境容器</h2><p id="cdbb" class="pw-post-body-paragraph kg kh it ki b kj nx kl km kn ny kp kq kr nz kt ku kv oa kx ky kz ob lb lc ld im bi translated">让我们从构建开发环境容器开始。这将基于微软提供的标准C#容器，通过一些扩展允许我们在容器中使用实体框架核心。</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="8941" class="ne ly it lh b gy nf ng l nh ni"># [Choice] .NET version: 6.0, 5.0, 3.1, 6.0-bullseye, 5.0-bullseye, 3.1-bullseye, 6.0-focal, 5.0-focal, 3.1-focal</span><span id="bfd9" class="ne ly it lh b gy oc ng l nh ni">ARG VARIANT="6.0-focal"</span><span id="8734" class="ne ly it lh b gy oc ng l nh ni">FROM mcr.microsoft.com/vscode/devcontainers/dotnet:0-${VARIANT}</span><span id="474f" class="ne ly it lh b gy oc ng l nh ni"># [Choice] Node.js version: none, lts/*, 16, 14, 12, 10<br/>ARG NODE_VERSION="none"</span><span id="c75d" class="ne ly it lh b gy oc ng l nh ni">RUN if [ "${NODE_VERSION}" != "none" ]; then su vscode -c "umask 0002 &amp;&amp; . /usr/local/share/nvm/nvm.sh &amp;&amp; nvm install ${NODE_VERSION} 2&gt;&amp;1"; fi</span><span id="29c3" class="ne ly it lh b gy oc ng l nh ni"># [Optional] Uncomment this section to install additional OS packages.<br/>RUN apt-get update &amp;&amp; export DEBIAN_FRONTEND=noninteractive \<br/>&amp;&amp; apt-get -y install --no-install-recommends vim</span><span id="a734" class="ne ly it lh b gy oc ng l nh ni">RUN dotnet tool install -g dotnet-ef<br/>ENV PATH $PATH:/root/.dotnet/tools</span></pre><p id="5103" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上述Dockerfile文件是:</p><ul class=""><li id="9459" class="lj lk it ki b kj kk kn ko kr ll kv lm kz ln ld lo lp lq lr bi translated">继承。基础映像中的NET Core 6</li><li id="afb2" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">安装Vim(只是因为我喜欢它)</li><li id="336e" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">安装实体框架核心cli工具</li><li id="097b" class="lj lk it ki b kj ls kn lt kr lu kv lv kz lw ld lo lp lq lr bi translated">将cli工具添加到path变量</li></ul><p id="105e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个例子就是这样。这将允许我们创建一个实体框架项目，并使用实体框架cli工具与数据库服务器进行交互。</p><h2 id="7936" class="ne ly it bd lz nm nn dn md no np dp mh kr nq nr ml kv ns nt mp kz nu nv mt nw bi translated">数据库容器</h2><p id="8cdf" class="pw-post-body-paragraph kg kh it ki b kj nx kl km kn ny kp kq kr nz kt ku kv oa kx ky kz ob lb lc ld im bi translated">我将使用Postgres Docker映像，因此不需要为数据库容器编写定制的Docker文件。我把这个部分<a class="ae kf" href="https://zhao-li.medium.com/getting-started-with-postgresql-using-docker-compose-34d6b808c47c" rel="noopener">建立在翟立</a><a class="ae kf" href="https://zhao-li.medium.com/" rel="noopener">的这篇优秀文章</a>的基础上。需要一些配置，所以进入<code class="fe le lf lg lh b">database.env</code>并添加以下配置</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="e2b5" class="ne ly it lh b gy nf ng l nh ni">POSTGRES_USER=docker_user<br/>POSTGRES_PASSWORD=password<br/>POSTGRES_DB=blog_database</span></pre><h2 id="8cce" class="ne ly it bd lz nm nn dn md no np dp mh kr nq nr ml kv ns nt mp kz nu nv mt nw bi translated">Docker撰写</h2><p id="7177" class="pw-post-body-paragraph kg kh it ki b kj nx kl km kn ny kp kq kr nz kt ku kv oa kx ky kz ob lb lc ld im bi translated">最后，通过将docker设置与docker合成文件绑定在一起，docker设置就完成了。应该是这样的:</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="f918" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这实际上只是旋转一个Postgres容器并传入env变量。我还将数据库数据保存在一个名为<code class="fe le lf lg lh b">blog-database-data</code>的卷中。</p><p id="4e4c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于<code class="fe le lf lg lh b">dev-env</code>容器，所有这些都是基于我们上面配置的映像旋转容器。</p><h2 id="0974" class="ne ly it bd lz nm nn dn md no np dp mh kr nq nr ml kv ns nt mp kz nu nv mt nw bi translated">测试一下</h2><p id="ca30" class="pw-post-body-paragraph kg kh it ki b kj nx kl km kn ny kp kq kr nz kt ku kv oa kx ky kz ob lb lc ld im bi translated">在这一点上，我们可以启动它，看看它是否工作。在终端中，键入:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="588f" class="ne ly it lh b gy nf ng l nh ni">cd .. \<br/>docker compose up</span></pre><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/3857ecfd6f5016a4159d66a3ed9451c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*CbQDMpqUCPotYDekXg6HwQ.png"/></div></figure><p id="764f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先确保Docker容器中的所有东西都是应有的。看看<code class="fe le lf lg lh b">dev-env</code>集装箱的内部</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="40fe" class="ne ly it lh b gy nf ng l nh ni">docker exec -it dev-env /bin/bash</span></pre><p id="51ea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当在容器中时，你可以说服自己<code class="fe le lf lg lh b">dotnet</code>和<code class="fe le lf lg lh b">dotnet-ef</code>安装正确:</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi og"><img src="../Images/04b1b27acc286363b40b6c9857458e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*5Ii-AlMf8IDtZ6b-j0rUng.png"/></div></figure><p id="6d26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe le lf lg lh b">exit</code>从开发者环境容器中出来，看看Postgres容器:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="b40d" class="ne ly it lh b gy nf ng l nh ni">docker exec -it postgres /bin/bash</span></pre><p id="cf60" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样的——说服自己postgres已经安装并且可用</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/15636e41b20079355736b417f10e9055.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*2QD6H1zF6DceEZcU6_b5dA.png"/></div></figure><p id="4da6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来不错！您现在可以<code class="fe le lf lg lh b">exit</code>Postgres容器，并通过以下方式将所有容器拆除:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="71af" class="ne ly it lh b gy nf ng l nh ni">docker compose down</span></pre><h2 id="29fe" class="ne ly it bd lz nm nn dn md no np dp mh kr nq nr ml kv ns nt mp kz nu nv mt nw bi translated">VSCode中的开发容器</h2><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/bb2a3881c9e3c627b493500694e3d750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A5ccCh8B6VR38PJn"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@tvannoy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">特雷弗·瓦诺伊</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="4cd6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们将配置VSCode。回到终端并粘贴到(项目根文件夹中):</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="293f" class="ne ly it lh b gy nf ng l nh ni">mkdir .devcontainer; \<br/>cd .devcontainer; \<br/>touch devcontainer.json;</span></pre><p id="1bf8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<code class="fe le lf lg lh b">.devcontainer.json</code>中粘贴以下内容:</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="30b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就是Docker设置的全部内容。所以在VSCode中按F1，选择rebuild并在容器中重新打开。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/352572fca7284b8437117423fdb0e42d.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*pdKXlSYHIu5Twe2XBVfSeQ.png"/></div></figure><p id="e4b1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一次会花一些时间，但在随后的创业中会快得多。加载完成后，您可以看到VSCode窗口的底部显示我们处于Docker环境中。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/39d2e1b49b1c321b2c1b3ff9c0963b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*UEj3Hpu6WTVIQdo5w5UqPw.png"/></div></figure><p id="5318" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您在VSCode中打开一个终端，您将看到它已经在我们配置的环境容器中打开。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/c19c512ece2cb98dc1587acae85a23f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*TM84u0GVsj8hpsf_0i_7VA.png"/></div></figure><p id="76ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">至此，所有的Docker工作都完成了。这篇文章的其余部分只是给出一个使用实体框架核心的例子来说明这一点。</p><h1 id="3cba" class="lx ly it bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">实体框架示例</h1><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/315c549da761905db120a378f0db253d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nv_Tg6F6K_UAyTyq"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/@dakotaroosphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">达科塔·鲁斯</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="063c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经完成了Docker方面的工作，但是我将继续使用实体框架构建一个小示例，并展示与Postgres实例的交互。我将使用VSCode 中的<strong class="ki iu">终端添加一个新的。NET项目，并安装实体框架所需的包。</strong></p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="dee1" class="ne ly it lh b gy nf ng l nh ni">dotnet new classlib --name Blog.Database; \<br/>cd Blog.Database; \<br/>dotnet add package Microsoft.EntityFrameworkCore; \<br/>dotnet add package Microsoft.EntityFrameworkCore.Design; \<br/>dotnet add package Microsoft.EntityFrameworkCore.Analyzers; \<br/>dotnet add package Microsoft.EntityFrameworkCore.Relational; \<br/>dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL; \<br/>touch BlogDbContext.cs; \<br/>touch BlogPost.cs; \<br/>rm Class1.cs; </span></pre><p id="31cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们通过将以下代码粘贴到<code class="fe le lf lg lh b">BlogDbContext.cs</code>和<code class="fe le lf lg lh b">BlogPost.cs</code>来建立一个真正简单的代码优先数据库示例</p><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><figure class="mw mx my mz gt ju"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="420f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回到VSCode上的终端，输入以下内容。</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="7a4f" class="ne ly it lh b gy nf ng l nh ni">dotnet-ef migrations add initial; \<br/>dotnet-ef database update;</span></pre><p id="df57" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的代码将测试数据发送到运行在另一个Docker容器中的Postgres数据库。我们当然可以证明这一点！</p><p id="74df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意，在Docker环境中有一个限制，那就是我们不能访问其他Docker容器。这只能在主机上实现，因此您需要使用VSCode中的终端以外的终端。如果您在VSCode终端中尝试，您将看到docker不可用。</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi on"><img src="../Images/a8b1bf8c6c8591071aa6b7553337c964.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*l_yfsxSZiuDrG7_WLtD3dg.png"/></div></figure><p id="90db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">回到您的终端(不是VSCode中的那个！)</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="455f" class="ne ly it lh b gy nf ng l nh ni">docker exec -it postgres /bin/bash</span></pre><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/17341439eb6545b000396f753fce2319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*Idoh7zHQXAsGk78TrHrl9w.png"/></div></figure><p id="8f11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将带您进入运行Postgres的Docker容器。然后键入:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="3914" class="ne ly it lh b gy nf ng l nh ni">psql --host=database --username=docker_user --dbname=blog_database</span></pre><p id="33fe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出现提示时输入密码。(提示——是<code class="fe le lf lg lh b">password</code>)</p><p id="7312" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，该信息与我们不久前设置的<code class="fe le lf lg lh b">database.env</code>中的细节相匹配。接下来，检查并确保已经创建了表:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="ffa5" class="ne ly it lh b gy nf ng l nh ni">\d</span></pre><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi op"><img src="../Images/1ac4fc532ef01da23b6fabec6eadbd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*PysXqmxm5pkbf4OLh79mPA.png"/></div></figure><p id="7ad5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来不错！我们还可以证明测试数据已经完成了:</p><pre class="mw mx my mz gt na lh nb nc aw nd bi"><span id="8b9a" class="ne ly it lh b gy nf ng l nh ni">select * from "Posts";</span></pre><figure class="mw mx my mz gt ju gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/cdb1f1707effc4249dc93ab9fee60e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*y-RQmYVAmifMeA8ViKzwQA.png"/></div></figure><p id="05f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为这是一个很好的总结的地方。</p><p id="58e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，任何人都可以简单地拉动这个回购，旋转它，并开始使用应用程序，而不必考虑如何设置数据库。</p><p id="1ca6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在这个例子中使用了Postgres，但是完全相同的原理也适用于可以在Docker容器中运行的任何其他数据库平台。我认为这是一个非常令人信服的dev容器用例，但是和以前一样，我非常想在评论中听到人们的意见！让我知道你的想法，感谢你的阅读！</p><figure class="mw mx my mz gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/153d3e792bce15083fec87cb8cfd17e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cbiihhpu6OW6VoLW"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Joshua Hoehne 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div></div>    
</body>
</html>