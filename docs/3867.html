<html>
<head>
<title>The easiest way to setup multiple environments on React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native上设置多个环境的最简单方法</h1>
<blockquote>原文：<a href="https://itnext.io/the-easiest-way-to-setup-multiple-environments-on-react-native-67b33d073390?source=collection_archive---------0-----------------------#2020-03-16">https://itnext.io/the-easiest-way-to-setup-multiple-environments-on-react-native-67b33d073390?source=collection_archive---------0-----------------------#2020-03-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ce581dfb4612ca57e83c84cc3ded5244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gHUd_znZCC0p8A9fJtNEWw.png"/></div></div></figure><p id="4b13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我发现有些事情在React Native上很简单，但在web应用程序中却很容易做到；其中之一就是处理不同的环境变量。</p><p id="f592" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您仍在开发应用程序时，通常只有一个环境，但当其他一些用户开始测试它或当您打算发布它时，您可能希望为API使用不同的URL，如开发版本的API也可以访问新的端点或更全面的日志记录程序，以及生产就绪版本，经过良好测试并带有发布版本的生产数据库。</p><p id="30ad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有时您需要两个以上的环境，例如:</p><ul class=""><li id="e442" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated"><strong class="kd iu">开发</strong>:这是你要开发应用所有新特性的地方；环境已经准备好帮助你更好的日志和假数据库，如果你搞砸了，你可以随时删除和重新创建；</li><li id="9a1a" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated"><strong class="kd iu">试运行:</strong>试运行中的应用程序版本由客户、朋友或质量保证部门的一些同事进行测试，环境几乎是生产版本的复制品；</li><li id="5893" class="kz la it kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated"><strong class="kd iu">制作:</strong>这是你要发布到商店(App Store，Google Play)的版本</li></ul><h1 id="1cee" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">那么，如何为不同的环境存储(和使用)不同的变量呢？</h1><p id="b0d7" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">很明显，我试图用谷歌搜索答案，但是我找到的解决方案对我来说似乎太难或者不够灵活。</p><h2 id="4a43" class="mq lo it bd lp mr ms dn lt mt mu dp lx km mv mw mb kq mx my mf ku mz na mj nb bi translated">使用react-native-dotenv</h2><p id="885c" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">React Native上管理不同环境最常用的方法是使用<a class="ae nc" href="https://github.com/zetachang/react-native-dotenv" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">React-Native-dotenv</strong></a>:起初我认为这是我通常在web应用程序中使用的<a class="ae nc" href="https://github.com/motdotla/dotenv" rel="noopener ugc nofollow" target="_blank"> node dotenv </a>库的一个端口。</p><p id="34eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不幸的是，<a class="ae nc" href="https://github.com/motdotla/dotenv" rel="noopener ugc nofollow" target="_blank">似乎最多处理2个环境</a>(一个开发和一个发布/生产)，并且还有一些糟糕的变量缓存。有一次，我花了两个小时和一个同事聊天，以了解为什么他机器上的应用程序使用另一个API端点(解决方案:在你改变。env，您必须在导入该变量的文件中更改/添加一行，否则react-native-dotenv将继续为旧变量服务🤦‍♂️)</p><p id="e0d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2021年2月10日更新:react-native-dotenv的最新升级现在允许使用多个。多个环境的env文件，并通过简单地运行“纱线开始-重置-缓存”来重置缓存。看起来我去年遇到的所有问题都被这个库解决了！</p><p id="77d6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">继续阅读，寻找不同的解决方案，也许你可以适应其他需求🚀</p><h1 id="03ee" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">更容易的(天真的)解决方案</h1><p id="08d7" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">这是我目前使用的方法。准备好你的手指，因为你将需要创建一些新的文件。</p><p id="1eb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我们将所有的环境存储在一个<strong class="kd iu"> envs </strong>文件夹中的JSON文件中。</p><p id="6c97" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将为本文创建3个环境(开发、试运行和生产)，每个环境都有不同的API_URL。显然你可以添加任意多的变量！</p><p id="41ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> envs/development.json </strong></p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="d85f" class="mq lo it nj b gy nn no l np nq">{<br/>"API_URL": "https://development.api.com",<br/>}</span></pre><p id="b548" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> envs/staging.json </strong></p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="5dda" class="mq lo it nj b gy nn no l np nq">{<br/>"API_URL": "https://staging.api.com",<br/>}</span></pre><p id="0d93" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> envs/production.json </strong></p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="61c9" class="mq lo it nj b gy nn no l np nq">{<br/>"API_URL": "https://production.api.com",<br/>}</span></pre><p id="d8ab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还和我在一起吗？现在，我们将创建一个节点脚本，它将在每次我们想要切换环境时更改环境文件。</p><p id="190c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我把它放在一个<strong class="kd iu"> <em class="nd">脚本</em> </strong>文件夹中(在那里我还有其他脚本来自动化我的构建过程的其他部分)</p><p id="85fa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">脚本/set-environment.js</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="08dd" class="mq lo it nj b gy nn no l np nq"><em class="nd">#!/bin/node</em></span><span id="bb1e" class="mq lo it nj b gy nr no l np nq">const fs = require("fs");</span><span id="3328" class="mq lo it nj b gy nr no l np nq">//Obtain the environment string passed to the node script<br/>const environment = process.argv[2]</span><span id="1378" class="mq lo it nj b gy nr no l np nq">//read the content of the json file<br/>const envFileContent = require(`../envs/${environment}.json`);</span><span id="43ec" class="mq lo it nj b gy nr no l np nq">//copy the json inside the env.json file<br/>fs.writeFileSync("env.json", JSON.stringify(envFileContent, undefined, 2));</span></pre><p id="6841" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个<strong class="kd iu"><em class="nd">set-environment . js</em></strong>只有4行:首先它在一个变量中存储你调用脚本时的第一个参数，然后<strong class="kd iu">会</strong>要求<strong class="kd iu"> <em class="nd"> envs </em> </strong>里面的文件具有相同的名称，最后会在根文件夹中创建一个env.json文件，内容为<em class="nd"> envFileContent。</em></p><p id="aa1a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以试着打电话</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="93fd" class="mq lo it nj b gy nn no l np nq">node scripts/set-environment.js development</span></pre><p id="fad6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">而✨MAGIC ✨…一个新的<strong class="kd iu"> <em class="nd"> env.json </em> </strong>文件已经放在了合适的地方，随时可以为你的一切变数服务。</p><p id="c8ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，您可以在package.json文件中设置一些脚本，以便能够切换环境，而无需在终端中键入所有单词:只需键入<strong class="kd iu"> <em class="nd"> yarn env:dev </em> </strong>即可。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="a753" class="mq lo it nj b gy nn no l np nq">{<br/>  "name": "your-app-name",<br/>  "scripts": {<br/>    "start": "react-native start",</span><span id="16f9" class="mq lo it nj b gy nr no l np nq">    "env:staging": "node scripts/set-environment.js staging",<br/>    "env:dev": "node scripts/set-environment.js development",<br/>    "env:prod": "node scripts/set-environment.js production",</span><span id="b9e5" class="mq lo it nj b gy nr no l np nq">    ...<br/>  },<br/>  "dependencies": {...},<br/>  ...<br/>}</span></pre><h2 id="f9a1" class="mq lo it bd lp mr ms dn lt mt mu dp lx km mv mw mb kq mx my mf ku mz na mj nb bi translated">如何使用新的？代码中的env文件</h2><p id="bace" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">现在你只需要从src/env.json文件中<strong class="kd iu">导入</strong>你的变量，你就可以开始了！🚀</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b6415493bc9818d7b3806ad8111d9dfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2DLTgWeIw3Z4SefjlgktA.png"/></div></div></figure><h1 id="5823" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">如何自动切换环境</h1><p id="b004" class="pw-post-body-paragraph kb kc it kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">现在我们需要一种自动切换环境的方法。</p><p id="cf5c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们在<strong class="kd iu"><em class="nd">package . JSON:</em></strong>中创建一些新的脚本，这几乎是免费的</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="8efa" class="mq lo it nj b gy nn no l np nq">{<br/>  "name": "your-app-name",<br/>  "scripts": {<br/>    "start": "react-native start",</span><span id="48cb" class="mq lo it nj b gy nr no l np nq">    "env:staging": "node scripts/set-environment.js staging",<br/>    "env:dev": "node scripts/set-environment.js development",<br/>    "env:prod": "node scripts/set-environment.js production",</span><span id="8e90" class="mq lo it nj b gy nr no l np nq">    "_ios": "react-native run-ios",</span><span id="cf6f" class="mq lo it nj b gy nr no l np nq">    "ios": "yarn env:dev &amp;&amp; yarn _ios",<br/>    "ios:staging": "yarn env:staging &amp;&amp; yarn _ios",<br/>    "ios:prod": "yarn env:prod &amp;&amp; yarn _ios",<br/>    <br/>    "_build:ios": "react-native bundle --platform ios ...",<br/>    "build:ios": "yarn env:dev &amp;&amp; yarn _build:ios",<br/>    "build:ios:staging": "yarn env:staging &amp;&amp; yarn _build:ios",<br/>    "build:ios:prod": "yarn env:prod &amp;&amp; yarn _build:ios",<br/>  },</span><span id="b373" class="mq lo it nj b gy nr no l np nq">  "dependencies": {...},</span><span id="aa7e" class="mq lo it nj b gy nr no l np nq">  ...<br/>}</span></pre><p id="8529" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我删除了一些脚本和所有的依赖关系，以保持代码部分的轻量级。Android脚本与iOS脚本相同。</p><p id="8fb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以现在，每当我想在模拟器上启动我的iOS应用程序和生产环境时，我只需要启动</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="fa03" class="mq lo it nj b gy nn no l np nq">yarn ios:prod</span></pre><p id="c51a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">环境变量将加载到您的应用程序中。<br/>如果我想构建iOS发布版本提交到App Store怎么办？</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="8fe5" class="mq lo it nj b gy nn no l np nq">yarn build:ios:prod</span></pre><p id="1e22" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是你需要✨的唯一命令</p></div></div>    
</body>
</html>