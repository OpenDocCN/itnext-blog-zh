<html>
<head>
<title>Using fetch with Typescript and Todoist</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将fetch与Typescript和Todoist一起使用</h1>
<blockquote>原文：<a href="https://itnext.io/using-fetch-with-typescript-and-the-todoist-api-5203c5177ed5?source=collection_archive---------0-----------------------#2020-04-25">https://itnext.io/using-fetch-with-typescript-and-the-todoist-api-5203c5177ed5?source=collection_archive---------0-----------------------#2020-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/6485b70727cade8513fb8f8b8b46c97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NEad92LHIhRzNlXqRvK80g.jpeg"/></div></div></figure><div class=""/><p id="d1a8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些天我一直在摆弄打字稿。到目前为止，这种体验非常棒。我主要和鲁比·科特林一起工作。我也在一些场合使用过Javascript。也就是说，我发现对Typescript的更改并没有我想象的那么难，事实上，我觉得这很直观。当我将它与VScode(也是内置的Typescript)一起使用时，IDE经常会指出任何缺失/错误的类型，这将阻止无数小时的调试。</p><p id="0602" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我过去从事的用于发出HTTP请求的javascript项目中，我会使用像<em class="kw"> Axios </em>或<em class="kw">这样的库。ajax </em>，这让我想到如果我可以使用最近的fetch API会怎么样。使用fetch消除了对Axios或jQuery等外部依赖的需要，尽管目前并非所有浏览器都支持它(看看你的Internet Explorer)。</p><p id="29a1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我决定在一个简单的react应用程序中同时尝试Typescript和fetch。对于这个例子，我将使用Todoist的任务API(API Docs:<a class="ae kx" href="https://developer.todoist.com/rest/v1/#tasks" rel="noopener ugc nofollow" target="_blank">https://developer.todoist.com/rest/v1/#tasks</a>)。该示例将包括通过API创建一个简单的任务。对于那些不知道的人来说，Todoist是一个生产力应用程序，可以让你组织、计划和协作完成任务和项目。就我个人而言，我使用它的任务列表来组织我的工作，也可以在我需要去杂货店购物时作为购物清单。</p><p id="5496" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使用API，您需要获得一个令牌，该令牌可以通过创建一个帐户来获得。</p><p id="ee23" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过API创建任务非常简单，您需要发出一个POST请求，带有一些参数，还需要传入几个头，如下所述。</p><p id="2086" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使用fetch设置头，可以使用HeadersInit类型，如下所示</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="da3f" class="lh li jb ld b gy lj lk l ll lm">import { v4 as uuidv4 } from 'uuid';</span><span id="188c" class="lh li jb ld b gy ln lk l ll lm">const headers: HeadersInit = {<br/>  'Content-Type': 'application/json',<br/>  'X-Request-Id': uuidv4(),<br/>  'Authorization': `Bearer &lt;API_TOKEN&gt;`<br/>}</span></pre><p id="76af" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至于请求体，我已经声明了一个名为TaskParam的类型，如下所示</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="cd8e" class="lh li jb ld b gy lj lk l ll lm">export type TaskParam = {<br/>  content: string;<br/>  due_lang: string;<br/>  due_string: string;<br/>  priority: number<br/>};</span><span id="1c91" class="lh li jb ld b gy ln lk l ll lm">const taskParam: TaskParam = {<br/>  content: 'Buy eggs',<br/>  due_string: 'Tomorrow at 12.00',<br/>  due_lang: 'en',<br/>  priority: 1,<br/>}</span></pre><p id="c4e7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在这里请求你如何去做:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="24a6" class="lh li jb ld b gy lj lk l ll lm">export async function createTask(taskParam: TaskParam): Promise&lt;Response&gt; {<br/>  const url = '<a class="ae kx" href="https://api.todoist.com/rest/v1/tasks'" rel="noopener ugc nofollow" target="_blank">https://api.todoist.com/rest/v1/tasks'</a>;<br/>  const opts: RequestInit = {<br/>    method: 'POST',<br/>    headers,<br/>    body: JSON.stringify(taskParam),<br/>  };<br/>  return fetch(url, opts)<br/>}</span></pre><p id="69f3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这样，您应该能够重用这个函数来创建任意多的任务。</p><p id="da05" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相反，如果我们想得到所有活动的任务，代码是非常相似的。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="15a7" class="lh li jb ld b gy lj lk l ll lm">export async function getTasks(): Promise&lt;Response&gt; {<br/>  const url = '<a class="ae kx" href="https://api.todoist.com/rest/v1/tasks'" rel="noopener ugc nofollow" target="_blank">https://api.todoist.com/rest/v1/tasks'</a>;<br/>  const opts: RequestInit = {<br/>    method: 'GET',<br/>    headers,<br/>  };<br/>  return fetch(url, opts)<br/>}</span></pre><p id="118f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至于测试，您需要将<em class="kw"> fetch-mock </em>添加到package.json中。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="5065" class="lh li jb ld b gy lj lk l ll lm">import fetchMock from 'fetch-mock';</span><span id="612c" class="lh li jb ld b gy ln lk l ll lm">const taskParam: TaskParam = {<br/>  content: 'Buy eggs',<br/>  due_string: 'Tomorrow at 12.00',<br/>  due_lang: 'en',<br/>  priority: 1,<br/>}</span><span id="8838" class="lh li jb ld b gy ln lk l ll lm">describe('createTask', () =&gt; {<br/>  it('returns ok', async () =&gt; {</span><span id="b2d8" class="lh li jb ld b gy ln lk l ll lm">fetchMock.post('<a class="ae kx" href="https://api.todoist.com/rest/v1/tasks'" rel="noopener ugc nofollow" target="_blank">https://api.todoist.com/rest/v1/tasks'</a>, { ok: 'ok' });</span><span id="f6d1" class="lh li jb ld b gy ln lk l ll lm">const response = await createTask(taskParam);<br/>    const result = await response.json()</span><span id="05ca" class="lh li jb ld b gy ln lk l ll lm">expect(result).toEqual({ ok: "ok" });</span><span id="e9a9" class="lh li jb ld b gy ln lk l ll lm">});<br/>});</span></pre><p id="9126" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">总的来说，代码可能看起来非常类似于Javascript，但是当使用Typescript时，IDE可能会指出一些在响应体、头或整体请求配置中可能会丢失的字段。</p><p id="25ac" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">喜欢这个故事吗？在我的个人网站上查看更多信息<a class="ae kx" href="http://www.ricardo-trindade.com/" rel="noopener ugc nofollow" target="_blank">https://www.ricardo-trindade.com/</a></p></div></div>    
</body>
</html>