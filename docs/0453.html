<html>
<head>
<title>Advanced React/Redux Techniques | How to Use Refs on Connected Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级React/Redux技术|如何在连接的组件上使用参考</h1>
<blockquote>原文：<a href="https://itnext.io/advanced-react-redux-techniques-how-to-use-refs-on-connected-components-e27b55c06e34?source=collection_archive---------2-----------------------#2018-03-12">https://itnext.io/advanced-react-redux-techniques-how-to-use-refs-on-connected-components-e27b55c06e34?source=collection_archive---------2-----------------------#2018-03-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将带您了解如何在React组件上使用refs，该组件使用React-Redux API连接到Redux存储。</p><p id="c93f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是首先，关于参考文献的一点背景…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3d004682a0d1510ae00665a5a3ca0387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ner81Yha3VWgCa_iXGNcg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">不…不是那种裁判。</figcaption></figure><h2 id="ea6f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">什么是裁判？</h2><p id="b215" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">如果你没有使用过引用，我强烈推荐你阅读一下<a class="ae lz" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>来理解它们是如何工作的以及它们的用途，但是简而言之，引用是一种存储对组件实例上的对象的<em class="ma">引用</em>的方式。</p><p id="1f0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它们可以用来存储对DOM元素或另一个类组件实例的引用，所以让我们快速浏览一下这两个用例。</p><h2 id="834f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">在DOM元素上使用引用</h2><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="f3a4" class="lb lc iq mc b gy mg mh l mi mj">class VideoPlayer extends React.Component {</span><span id="dd11" class="lb lc iq mc b gy mk mh l mi mj"> constructor() {<br/>    super();<br/>    this.state = {<br/>      isPlaying: false,<br/>    }<br/>    this.handleVideoClick = this.handleVideoClick.bind(this);<br/>  }<br/>  <br/>  handleVideoClick() {<br/>    if (this.state.isPlaying) {<br/>      this.video.pause();<br/>    }<br/>    else {<br/>      this.video.play();<br/>    }<br/>    this.setState({ isPlaying: !this.state.isPlaying });<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;video<br/>          ref={video =&gt; this.video = video}<br/>          onClick={this.handleVideoClick}<br/>        &gt;<br/>         &lt;source<br/>            src="some.url"<br/>            type="video/ogg"<br/>         /&gt;<br/>        &lt;/video&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="1149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个代码片段中，我创建了一个非常基本的视频播放器组件，每当您单击视频时，它就会播放和暂停视频。因为我需要使用HTML5 video元素上的play()和pause()方法来实现这一点，所以我在component实例上存储了一个对该元素的引用。这样，我可以根据需要在单击处理程序中访问这些方法。很漂亮，对吧？</p><h2 id="4f47" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">在其他零部件实例上使用参照</h2><p id="ebe7" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">有时，您会希望在另一个组件实例上使用ref，而不是在DOM元素上使用ref。我最近在React内部需要使用<a class="ae lz" href="https://www.highcharts.com/" rel="noopener ugc nofollow" target="_blank"> Highcharts </a>时遇到了这个用例。根据他们网站上的Highcharts博客,你可以使用他们的库在React中创建图表:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="84af" class="lb lc iq mc b gy mg mh l mi mj">class HighchartComponent extends React.Component {<br/>  componentDidMount() {<br/>    this.chart = new Highcharts[this.props.type || 'Chart'](<br/>      this.props.container, <br/>      this.props.options<br/>    );<br/>  }<br/>  <br/>  componentWillUnmount() {<br/>    this.chart.destroy();<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div id={this.props.container}&gt;&lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="b7b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，由Highcharts生成的图表实例存储在HighchartsComponent实例中。但是，如果您想在这个组件之外访问图表(以及允许您操作图表的所有方法)，该怎么办呢？比方说，我们想要创建一个按钮，当点击它时，使用内置的Highcharts API来销毁图表。</p><p id="73f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是裁判可以派上用场的地方。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="afac" class="lb lc iq mc b gy mg mh l mi mj">const highchartsOptions = {<br/>  // ...highcharts options<br/>};</span><span id="e2b4" class="lb lc iq mc b gy mk mh l mi mj">class Container extends React.Component {<br/>  constructor() {<br/>    super();<br/>    this.handleButtonClick = this.handleButtonClick.bind(this);<br/>  }</span><span id="6c0a" class="lb lc iq mc b gy mk mh l mi mj">  handleButtonClick() {<br/>    if (this.highchartsComponent.chart) {<br/>      this.highchartsComponent.chart.destroy();<br/>    }<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;HighchartsComponent<br/>          container="chart"<br/>          options={highchartsOptions}<br/>          ref={highchartsComponent =&gt;<br/>           this.highchartsComponent = highchartsComponent<br/>          }<br/>        /&gt;<br/>        &lt;button onClick={this.handleButtonClick}&gt;<br/>          Destroy Chart<br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="4a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个代码片段中，HighchartsComponent上的ref允许我在父容器组件上存储一个对该已挂载组件实例的引用。这就是我通过调用按钮点击处理程序中的destroy()方法来访问它的chart属性并利用Highcharts API的方法。</p><h2 id="63a4" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">在连接的元件上使用参照</h2><p id="2079" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">好吧…那么通过React-Redux connect() API连接到Redux store的组件呢？应该够简单了吧？</p><p id="8b19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们继续将前一个示例中的high charts组件连接到一个假想的Redux商店。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="3f36" class="lb lc iq mc b gy mg mh l mi mj">connect()(HighchartsComponent);</span></pre><p id="8e24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后…所有东西都坏掉了。😭</p><p id="9967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这不再起作用的原因是connect()是一个更高阶的组件，它接受您提供给它的任何组件，并返回一个全新的组件。因此，highcartscomponent上的ref现在指向连接的组件实例，而不是highcartscomponent实例。如果我们试图访问图表属性，它自然会返回未定义。</p><p id="5c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们能做什么呢？幸运的是，React-Redux API提供了一种获取包装组件实例的方法(在本例中，是我们的HighchartsComponent)。您所要做的就是在connect()调用中将withRef选项设置为true:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="aa34" class="lb lc iq mc b gy mg mh l mi mj">connect(null, null, null, { withRef: true })(HighchartsComponent);</span></pre><p id="7527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您可以使用getWrappedInstance()方法来…您猜对了…获取包装的实例。现在，我们之前的例子看起来像这样:</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="1509" class="lb lc iq mc b gy mg mh l mi mj">class Container extends React.Component {<br/>  constructor() {<br/>    super();<br/>    this.handleButtonClick = this.handleButtonClick.bind(this);<br/>  }</span><span id="72c5" class="lb lc iq mc b gy mk mh l mi mj">  handleButtonClick() {<br/>    if (this.highchartsComponent.chart) {<br/>      this.highchartsComponent.chart.destroy();<br/>    }<br/>  }<br/>  <br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;HighchartsComponent<br/>          container="chart"<br/>          options={chartOption}<br/>          ref={connectedComponent =&gt;<br/>            this.highchartsComponent =<br/>            connectedComponent.getWrappedInstance();<br/>          }<br/>        /&gt;<br/>        &lt;button onClick={this.handleButtonClick}&gt;<br/>          Destroy Chart<br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>    )<br/>  }<br/>}</span></pre><p id="7553" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切正常！🎉</p><p id="8f54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更新</strong>:从<code class="fe ml mm mn mc b">react-redux</code> &gt; = v6.0开始，<code class="fe ml mm mn mc b">withRef</code>和<code class="fe ml mm mn mc b">getWrappedInstance</code>被弃用，取而代之的是<code class="fe ml mm mn mc b">forwardRef</code> <a class="ae lz" href="https://react-redux.js.org/api/connect#forwardref-boolean" rel="noopener ugc nofollow" target="_blank">选项</a>，这简化了事情，因为您不再需要调用getWrappedInstance来获得包装的组件实例。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/c55590dcb69b2baff779fb1a8e2815e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*q_WZ4r7UjTP8mK3I5dS0IA.jpeg"/></div></figure><p id="8c0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整代码，请查看<a class="ae lz" href="https://jsfiddle.net/jacobworrel/anqjxq95/30/" rel="noopener ugc nofollow" target="_blank"> JSfiddle </a>。</p></div><div class="ab cl mp mq hu mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ij ik il im in"><ol class=""><li id="1ba4" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">引用不适用于功能组件，因为它们没有实例。</li><li id="ef42" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">React明确警告不要过度使用refs，因为它们避开了典型的自顶向下的数据流，但是我发现它们在我需要访问第三方API的情况下特别有用。</li></ol></div></div>    
</body>
</html>