<html>
<head>
<title>Extending CaaS Kentico Cloud With Custom Elements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自定义元素扩展CaaS Kentico云</h1>
<blockquote>原文：<a href="https://itnext.io/extending-caas-kentico-cloud-with-custom-elements-76a999f4553e?source=collection_archive---------8-----------------------#2019-03-26">https://itnext.io/extending-caas-kentico-cloud-with-custom-elements-76a999f4553e?source=collection_archive---------8-----------------------#2019-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5428fb9fe3884b6a81b7243d8ec3b92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMgJY4CHFBxx9nwn_0UV1A@2x.png"/></div></div></figure><p id="12a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在对内容进行建模时，您经常会遇到以特定结构存储数据的需求，这种结构超出了字符串、数字或选项列表等传统类型。典型的例子是国家和州。除非你想给编辑自由的空间，否则你不能使用自由文本域。那么，如何扩展内容即服务系统并存储这些数据呢？</p><p id="627b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为什么不应该使用自由文本字段？除了编辑不得不每次都写国家名称的事实之外，你最终会得到一堆非结构化的数据、许多重复和错别字。因为不是世界上所有的国家都有州，所以在选择器中还需要一点业务逻辑。因此，简单的下拉菜单也不是理想的解决方案。</p><h1 id="e4ce" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">自定义元素</h1><p id="3b52" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">首先我要强调的是，自定义这个词并不意味着你需要实现它。您甚至不必下载、编译或安装它。不，要在<a class="ae lz" href="https://kenticocloud.com" rel="noopener ugc nofollow" target="_blank"> Kentico Cloud </a>中使用自定义元素，您只需复制并粘贴它的URL。但我稍后会讲到。首先，让我解释一下什么是定制元素。</p><p id="bed9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自定义元素是一个独立的web应用程序，即一个网站，托管在互联网上的某个地方。它不是在Kentico Cloud中实现的，而是使用iframes集成到UI中。因此，它可以位于很远很远的服务器上(不过最好不要太远——延迟仍然适用)。Kentico Cloud将通过JavaScript与iframe中的自定义元素进行通信，为其提供初始化数据，并侦听数据更改以确保它们是持久的。自定义元素负责其余的工作。它显示数据、处理数据、转换数据并将其返回给Kentico Cloud的方式是在其实现中进行编排的。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/31fb8dcec1da803d2f1dfd7e67a2811f.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/0*DMxZZAQN2AO4lUkc.png"/></div></figure><p id="9b32" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么国家和州选择器会是什么样子呢？这是一个带有两个下拉选择器的空白页面。如果所选国家有任何州，则会显示第二个显示州的下拉列表。它还没有保存任何更改，因为没有要与之通信的父窗口(Kentico Cloud)。</p><p id="88ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您对使用现有的自定义元素感兴趣，请随意跳到“使用自定义元素”一节。</p><h1 id="5730" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">构建自定义元素</h1><p id="f3ca" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">国家和州选择器涵盖了与国家相关的内容项的一个用例。可能是你公司的办公室，你国家的大使馆或者你最喜欢的旅行社的旅行。所有这些项目都与特定的国家/州相关。</p><p id="d048" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您看，当您的数据结构超出标准数据类型时，您可能需要一个自定义元素。寻找它的最佳地点是我们的<a class="ae lz" href="https://github.com/kentico/custom-element-samples/issues" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>。如果你找不到一个符合你要求的，你很幸运！你可以享受建造一个的所有乐趣:-)，所以只要跟随我的国家和州选择器的故事。</p><h1 id="8806" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我该如何开始？</h1><p id="e487" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">每个自定义元素都是一个独立的应用程序，所以由你来选择你最喜欢的平台。然而，与Kentico Cloud的通信是通过JavaScript进行的，因此基于Node.js或您最喜欢的JavaScript框架的实现将会工作得最好。</p><p id="64c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然你可以只用记事本在一片绿地上开始，但我们为你准备了一个<a class="ae lz" href="https://github.com/Kentico/custom-element-devkit" rel="noopener ugc nofollow" target="_blank"> DevKit </a>来加速不太有趣的任务，比如最小化资产，包括Kentico云样式等等。DevKit可以在<a class="ae lz" href="https://github.com/Kentico/custom-element-devkit" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得，您可以从克隆它的存储库开始:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="b3da" class="mk kx iq mg b gy ml mm l mn mo">git clone <a class="ae lz" href="https://github.com/kentico/custom-element-devkit" rel="noopener ugc nofollow" target="_blank">https://github.com/kentico/custom-element-devkit</a></span></pre><p id="09e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和安装缺失的节点模块:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="8f85" class="mk kx iq mg b gy ml mm l mn mo">npm install</span></pre><p id="953d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建新的自定义元素，导航到<code class="fe mp mq mr mg b">/client/custom-elements</code>文件夹并为其创建一个新文件夹。您还需要创建两个文件:</p><ul class=""><li id="f4ad" class="ms mt iq ka b kb kc kf kg kj mu kn mv kr mw kv mx my mz na bi translated"><strong class="ka ir">index . Pug</strong>T11<a class="ae lz" href="https://pugjs.org/api/getting-started.html" rel="noopener ugc nofollow" target="_blank">Pug</a>中你的自定义元素的视图。</li><li id="27a5" class="ms mt iq ka b kb nb kf nc kj nd kn ne kr nf kv mx my mz na bi translated"><strong class="ka ir">code . tsx</strong>T16】带有自定义元素逻辑的JavaScript代码文件。</li></ul><p id="42d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，JS文件有一个TypeScript扩展名，所以如果您对TS更熟悉的话，您可以使用它，但是您也可以坚持使用标准的JavaScript代码。该文件应该以您的定制元素命名—在我的例子中，它是<code class="fe mp mq mr mg b">selector.tsx</code>。</p><h1 id="395e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我应该使用哪个框架？</h1><p id="26c4" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">devkit适用于任何JS框架，所以可以随意使用您最喜欢的框架或普通JS。最近我经常使用React.js，所以我决定使用它。我需要在devkit根目录下安装两个额外的包:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="156f" class="mk kx iq mg b gy ml mm l mn mo">npm install react react-dom — save</span></pre><h1 id="3936" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">自定义元素如何与Kentico Cloud通信？</h1><p id="a4b4" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">每一个组件，哪怕只是一个简单的文本字段，都需要和Kentico Cloud进行通信。他们需要在内容项目打开或更新时交换数据，以确保编辑人员看到正确的值，并且他们的工作得以持续。该组件还需要防止对已经发布的内容项进行更新，并告诉Kentico Cloud它需要多少空间才能正确呈现。</p><p id="2288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kentico Cloud定制元素API为所有这些情况提供了方法。看一看我在<code class="fe mp mq mr mg b">code.tsx</code>中对国家选择器的(简化)实现:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="072a" class="mk kx iq mg b gy ml mm l mn mo">CustomElement.init((element, _context) =&gt; {<br/>  const data = element.value ? JSON.parse(element.value) : null;<br/>  const components = (&lt;CountrySelector data={data} disabled={element.disabled} customElementApi={CustomElement} /&gt;);<br/>  ReactDom.render(components, document.querySelector('#reactapp'));<br/>});<br/>CustomElement.setHeight(250);</span></pre><p id="ef43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kentico Cloud通过调用<code class="fe mp mq mr mg b">CustomElement.Init</code>并提供<code class="fe mp mq mr mg b">element</code>和<code class="fe mp mq mr mg b">_context</code>对象中的所有数据来启动定制元素。我用那个事件用数据(<code class="fe mp mq mr mg b">element.value</code>)和标志来初始化我的组件，这些数据和标志描述了组件是否应该允许编辑者更改值(<code class="fe mp mq mr mg b">element.disabled</code>)。</p><p id="56e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我的选择器使用两个数据字段——<code class="fe mp mq mr mg b">countryCode</code>和<code class="fe mp mq mr mg b">stateCode</code>——来保存编辑器的选择。因此，<code class="fe mp mq mr mg b">element.value</code>对象将为空(没有值或全新的内容项)或如下所示:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="9e8e" class="mk kx iq mg b gy ml mm l mn mo">{countryCode: “US”, stateCode: “NH”}</span></pre><p id="e885" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后一个参数(<code class="fe mp mq mr mg b">customElementApi</code>)使我的React组件能够调用自定义元素API的方法<code class="fe mp mq mr mg b">setValue()</code>，该方法将数据保存在Kentico Cloud中。每当用户更改国家或州时，我的选择器都会调用它，以确保他或她的选择得到保留。</p><p id="5430" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于选择器目前对所有用例使用相同的高度，因此使用方法<code class="fe mp mq mr mg b">setHeight()</code>将其设置为250px。</p><p id="a424" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有关可用方法的完整列表，请查看Kentico Cloud文档中的<a class="ae lz" href="https://developer.kenticocloud.com/v1/reference#custom-elements-api" rel="noopener ugc nofollow" target="_blank"> API参考。</a></p><h1 id="7d77" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">构建和部署自定义元素</h1><p id="82ce" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">当你完成实现后，你应该先奖励自己一两杯啤酒。之后，是时候构建和部署它，让全世界都看到。实现这一目标的第一步是构建自定义元素:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a6e7" class="mk kx iq mg b gy ml mm l mn mo">npm start — -cjsm</span></pre><p id="76f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些标志确保自定义元素将在单个HTML文件中被编译、样式和JavaScript缩小和内联。该过程完成后，查看<code class="fe mp mq mr mg b">\built\custom-elements\{element name}</code>。您应该会看到两个文件— <code class="fe mp mq mr mg b">index.html</code>和带有Kentico图标的字体文件(<code class="fe mp mq mr mg b">woff</code>)。</p><p id="4fb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为自定义元素由一个HTML文件表示，所以你可以在任何地方托管它(Heroku，Surge，你的托管空间，等等。).然而，我决定将它托管在GitHub上的<a class="ae lz" href="https://github.com/Kentico/custom-element-samples" rel="noopener ugc nofollow" target="_blank"> Kentico定制元素示例库</a>中，因为它已经托管了一些定制元素，并且是与其他开发人员共享的最佳位置。这样，任何人都可以快速找到我的选择器，并在他们的项目中使用它。该存储库也使用GitHub页面，因此所有托管在那里的元素都可以使用URL直接引用。</p><h1 id="f843" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用自定义元素</h1><p id="c69e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">所以定制元素被部署并可以在线访问(我们有它的URL)。酷，那是最难的部分。现在让我们使用Kentico Cloud中的自定义元素。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/2a40a5f8bfd965babc4d73906d1bbe3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*emLNy2YHLCnsedfj.png"/></div></div></figure><p id="f199" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您打开内容类型定义时，您可以将通用自定义元素拖放到字段列表中。在新字段的配置中，有一个用于定制元素URL的文本框。因为我的国家和州选择器是托管在GitHub上的，所以URL看起来像这样:</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="2228" class="mk kx iq mg b gy ml mm l mn mo"><a class="ae lz" href="https://kentico.github.io/custom-element-samples/CountryStateSelector/country-state-selector.html" rel="noopener ugc nofollow" target="_blank">https://kentico.github.io/custom-element-samples/CountryStateSelector/country-state-selector.html</a></span></pre><p id="c6aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，定制元素始终需要通过HTTPS访问，以确保Kentico Cloud和定制元素之间的安全通信。</p><p id="2456" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。不需要其他步骤。继续操作，打开任何基于更新内容类型的内容项目并进行尝试。</p><p id="81fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，您也可以利用我们的<a class="ae lz" href="https://github.com/kentico/custom-element-samples" rel="noopener ugc nofollow" target="_blank">每日增长列表</a>中的任何自定义元素，并在处理特定数据结构时为您的编辑带来出色的用户体验。</p><h1 id="b6de" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为您的自定义元素获得150美元</h1><p id="50e4" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在处理内容时，国家和州的选择很常见。那么，让每个开发人员为它创建自己的定制选择器有意义吗？大概不会。因为我已经创建了一个，所以其他人很容易使用它——只需在自定义元素配置中引用它的URL。</p><p id="8199" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们喜欢开发人员互相帮助，共享定制元素会节省你的开发人员大量的时间。我们也喜欢玩。这就是为什么我们在2019年3月组织了一场比赛，奖励自定义元素贡献者。规则很简单——创建一个定制元素，并将其贡献给GitHub上的示例库。我们将用150美元的亚马逊代金券奖励前10名最佳定制元素！这样你就能买到亚马逊Echo、Apple Pencil或20x USB连接线(这足以支付我一年的USB连接线消费)！</p><p id="45e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解更多信息并报名参加，请访问www.kenticocloud.com/blog/custom-elements-contest<a class="ae lz" href="https://www.kenticocloud.com/blog/custom-elements-contest" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="148a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">*更新:大赛截止日期已延至4月14日* </strong></p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="9097" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="no">原载于</em><a class="ae lz" href="https://kenticocloud.com/blog/extending-custom-elements" rel="noopener ugc nofollow" target="_blank"><em class="no">kenticocloud.com</em></a><em class="no">。</em></p></div></div>    
</body>
</html>