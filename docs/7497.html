<html>
<head>
<title>Using Redis on Cloud? Here are ten things you should know</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在云上使用Redis？以下是你应该知道的十件事</h1>
<blockquote>原文：<a href="https://itnext.io/using-redis-on-cloud-here-are-ten-things-you-should-know-a1026624441e?source=collection_archive---------3-----------------------#2022-10-10">https://itnext.io/using-redis-on-cloud-here-are-ten-things-you-should-know-a1026624441e?source=collection_archive---------3-----------------------#2022-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/eb2971b07afb2038c30226619c73d04f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lgkpH3OZWmszU6L4"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">伊恩·巴塔格利亚在<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><div class=""/><div class=""><h2 id="5865" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">Redis相关的最佳实践、技巧和诀窍，包括集群可伸缩性、客户端配置、集成、指标</h2></div><p id="2e35" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">大规模操作有状态分布式系统是很困难的，Redis也不例外。托管数据库通过承担大量繁重的工作使生活变得更加轻松。但是您仍然需要一个良好的架构，并在服务器(Redis)和客户机(应用程序)上应用最佳实践。</p><p id="6cac" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个博客涵盖了一系列Redis相关的最佳实践、技巧和诀窍，包括集群可伸缩性、客户端配置、集成、指标等。虽然我会不时地为Redis引用<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/what-is-memorydb-for-redis.html" rel="noopener ugc nofollow" target="_blank"> Amazon MemoryDB </a>和<a class="ae jd" href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/WhatIs.html" rel="noopener ugc nofollow" target="_blank">elastic cache</a>，但大多数(如果不是全部)都适用于Redis集群。</p><blockquote class="lr ls lt"><p id="0479" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">这绝不是一份详尽的清单。我简单地选择了10，因为它是一个好的、有益健康的数字！</em></p></blockquote><p id="01fb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们直入主题，从您在扩展Redis集群方面有哪些选择开始。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="9ee7" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">1.可扩展性选项</h1><p id="c426" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">您可以放大<em class="lu">或缩小</em>或<em class="lu"/>:</p><ul class=""><li id="373d" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">纵向扩展—您可以增加单个节点/实例的容量，例如从<a class="ae jd" href="https://aws.amazon.com/ec2/instance-types/" rel="noopener ugc nofollow" target="_blank">Amazon EC2</a>T0】类型升级到<code class="fe nl nm nn no b">db.r6g.2xlarge</code></li><li id="7598" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">横向扩展—您可以向群集中添加更多节点</li></ul><p id="3238" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将<em class="lu">向外扩展</em>的需求可能由几个原因驱动。</p><p id="2891" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您需要处理<em class="lu">读取繁重的</em>工作负载，您可以选择添加更多副本节点。这适用于Redis集群设置(如<code class="fe nl nm nn no b">MemoryDB</code>)或非集群主副本模式，如<a class="ae jd" href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/Replication.Redis-RedisCluster.html" rel="noopener ugc nofollow" target="_blank">禁用集群模式的ElastiCache】。</a></p><p id="ff91" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您想增加<em class="lu">写</em>容量，您会发现自己受到主副本模式的限制，应该选择基于Redis集群的设置。您可以增加集群中碎片的数量——这是因为只有主节点可以接受写入，并且每个碎片只能有一个主节点。</p><blockquote class="lr ls lt"><p id="452f" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">这还有一个额外的好处，就是提高了整体的高可用性。</em></p></blockquote><figure class="nv nw nx ny gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/4604ee22d718a077bd3f39c82ece63e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SINLUyOftL3ux0h-.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><em class="nz">图1: Redis(禁用集群模式)和Redis(启用集群模式)集群—Redis文档的ElastiCache】</em></figcaption></figure><h1 id="9f8d" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">2.在扩展您的集群之后，您最好使用这些副本！</h1><p id="3efc" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">大多数Redis集群客户端(包括<code class="fe nl nm nn no b">redis-cli</code>)的默认行为是将所有<em class="lu">读取</em>重定向到<em class="lu">主</em>节点。如果您添加了读取副本来扩展读取流量，它们将处于闲置状态！</p><p id="e30a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您需要切换到<a class="ae jd" href="https://redis.io/commands/readonly/" rel="noopener ugc nofollow" target="_blank">只读</a>模式，以确保处理所有读取请求的副本不只是被动的参与者。确保适当地配置Redis客户机——这将因客户机和编程语言而异。</p><p id="4c5f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，在<a class="ae jd" href="https://github.com/go-redis/redis" rel="noopener ugc nofollow" target="_blank"> Go Redis客户端</a>中，您可以将<code class="fe nl nm nn no b">ReadOnly</code>设置为<code class="fe nl nm nn no b">true</code>:</p><pre class="nv nw nx ny gt of no og oh aw oi bi"><span id="ebd7" class="oj mg jg no b gy ok ol l om on">client := redis.NewClusterClient(<br/>	&amp;redis.ClusterOptions{<br/>	     Addrs:     []string{clusterEndpoint},<br/>	     ReadOnly:  true,<br/>		<em class="lu">//..other options</em><br/>})</span></pre><p id="af34" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要进一步优化，还可以使用<code class="fe nl nm nn no b">RouteByLatency</code>或<code class="fe nl nm nn no b">RouteRandomly</code>，两者都会自动开启<code class="fe nl nm nn no b">ReadOnly</code>模式。</p><blockquote class="lr ls lt"><p id="8ebc" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">你可以参考一下</em> <a class="ae jd" href="https://lettuce.io/core/release/reference/index.html#readfrom.read-from-settings" rel="noopener ugc nofollow" target="_blank"> <em class="jg"> Java客户端比如莴苣</em> </a></p></blockquote><h1 id="83d7" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">3.使用读取副本时，请注意一致性特征</h1><p id="1bdc" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">您的应用程序可能会从副本中读取陈旧的数据——这是<em class="lu">最终一致性</em>在起作用。由于主节点到副本节点的复制是<em class="lu">异步</em>的，因此您发送到主节点的写入可能尚未反映在读取的副本中。当您有大量读取副本时，尤其是跨多个可用性分区时，很可能会出现这种情况。如果这对于您的用例来说是不可接受的，那么您将不得不求助于使用主节点进行读取。</p><p id="3713" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">MemoryDB或ElastiCache for Redis中的<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/metrics.memorydb.html" rel="noopener ugc nofollow" target="_blank"> ReplicationLag度量</a>可用于检查副本在应用主节点的更改方面落后多少(以秒为单位)。</p><p id="1b2a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">强一致性呢？</p><p id="4872" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<code class="fe nl nm nn no b">MemoryDB</code>、<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/consistency.html" rel="noopener ugc nofollow" target="_blank">的情况下，主节点的读数是强一致的</a>。这是因为客户端应用仅在写入(到主节点)被写入到<em class="lu">持久多AZ事务日志</em>之后才接收到成功的写入确认。</p><h1 id="1cbc" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">4.记住，您可以影响您的键在Redis集群中的分布</h1><p id="68ad" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">Redis不使用一致散列(像许多其他分布式数据库一样)，而是使用散列槽的概念。总共有<code class="fe nl nm nn no b">16384</code>个槽，一系列散列槽被分配给集群中的每个主节点，并且每个键属于一个特定的散列槽(从而被分配给一个特定的节点)。如果键属于不同的哈希槽，在Redis集群上执行的多键操作将无法工作。</p><p id="ed9e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，你并不完全受集群的支配！可以通过使用<em class="lu">散列标签</em>来影响密钥的放置。因此，您可以确保特定的键具有相同的哈希槽。例如，如果您将客户ID为<code class="fe nl nm nn no b">42</code>的订单存储在名为<code class="fe nl nm nn no b">customer:42:orders</code>的<code class="fe nl nm nn no b">HASH</code>中，将客户概要信息存储在<code class="fe nl nm nn no b">customer:42:profile</code>中，您可以使用花括号<code class="fe nl nm nn no b">{}</code>来定义将被散列的特定子串。在这种情况下，我们的键是<code class="fe nl nm nn no b">{customer:42}:orders</code>和<code class="fe nl nm nn no b">{customer:42}:profile</code> - <code class="fe nl nm nn no b">{customer:42}</code>现在驱动哈希槽放置。现在我们可以确信这两个键都在<em class="lu">同一个</em>散列槽中(因此是同一个节点)。</p><h1 id="9a09" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">5.你考虑过缩小规模吗？</h1><p id="d7d4" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">你的应用是成功的，它有很多用户和流量。您横向扩展了集群，但事情仍然进展顺利。厉害！</p><p id="c857" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是如果你需要缩减规模呢？</p><p id="910c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这样做之前，您需要注意几件事情:</p><ul class=""><li id="fa8d" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">每个节点上都有足够的空闲内存吗？</li><li id="c137" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">非高峰时段可以这样吗？</li><li id="fb5b" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">它将如何影响您的客户端应用程序？</li><li id="e9b6" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">在此阶段，您可以监控哪些指标？(如<code class="fe nl nm nn no b">CPUUtilization</code>、<code class="fe nl nm nn no b">CurrConnections</code>等。)</li></ul><p id="8e84" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">参考Redis文档的MemoryDb中的一些<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/best-practices-online-resharding.html" rel="noopener ugc nofollow" target="_blank">最佳实践，以便更好地计划扩展。</a></p><h1 id="e48d" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">6.当事情出错时…</h1><p id="4ee2" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">面对现实吧，失败是令人羡慕的。重要的是你是否为他们做好了准备？对于Redis集群，需要考虑以下几点:</p><ul class=""><li id="26a4" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">您是否测试过您的应用程序/服务在遇到故障时的行为？如果没有，请做！使用MemoryDB和ElastiCache for Redis，您可以利用<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/autofailover.html#auto-failover-test" rel="noopener ugc nofollow" target="_blank">故障转移API </a>来模拟主节点故障并触发故障转移。</li><li id="fb82" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">您有副本节点吗？如果您只有一个带有单个主节点的碎片，那么如果该节点出现故障，您肯定会停机。</li><li id="05ba" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">你有多个碎片吗？如果您只有一个碎片(包含主碎片和副本碎片)，那么在该碎片的主节点出现故障的情况下，群集将无法接受任何写入。</li><li id="0bfa" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">您的碎片是否跨越多个可用性区域？如果你有跨多个AZ的碎片，你将更好地准备应对AZ失败。</li></ul><blockquote class="lr ls lt"><p id="3971" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">在所有情况下，</em> <code class="fe nl nm nn no b"><em class="jg">MemoryDB</em></code> <em class="jg">确保在节点替换或故障转移期间不会丢失数据</em></p></blockquote><h1 id="2395" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">7.无法连接到Redis，求助！</h1><blockquote class="lr ls lt"><p id="a419" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">Tl；DR:可能是网络/安全配置</em></p></blockquote><p id="de6e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是一件经常让人犯错的事情！有了<code class="fe nl nm nn no b">MemoryDB</code>和<code class="fe nl nm nn no b">ElastiCache</code>，你的<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/vpcs.html" rel="noopener ugc nofollow" target="_blank"> Redis节点在一个VPC </a>中。如果您有一个部署到计算服务的客户端应用程序，如<a class="ae jd" href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>、<a class="ae jd" href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html" rel="noopener ugc nofollow" target="_blank"> EKS </a>、<a class="ae jd" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html" rel="noopener ugc nofollow" target="_blank"> ECS </a>、<a class="ae jd" href="https://docs.aws.amazon.com/apprunner/latest/dg/what-is-apprunner.html" rel="noopener ugc nofollow" target="_blank"> App Runner </a>等。，您需要确保拥有正确的配置——特别是在VPC和安全组方面。</p><p id="676f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这可能因您使用的计算平台而异。例如，你如何<a class="ae jd" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html" rel="noopener ugc nofollow" target="_blank">配置一个Lambda函数来访问VPC </a>中的资源，与App Runner如何做(通过<a class="ae jd" href="https://docs.aws.amazon.com/apprunner/latest/dg/network-vpc.html" rel="noopener ugc nofollow" target="_blank"> VPC连接器</a>)或者甚至EKS(尽管从概念上来说，它们是相同的)相比，会稍有不同。</p><h1 id="6de9" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">8.Redis 6带有访问控制列表——使用它们吧！</h1><p id="5fdc" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">没有理由不对您的Redis集群应用身份验证(用户名/密码)和授权(基于ACL的权限)。<code class="fe nl nm nn no b">MemoryDB</code>符合Redis 6，<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/clusters.acls.html" rel="noopener ugc nofollow" target="_blank">支持ACL </a>。然而，为了符合较旧的Redis版本，它为每个帐户配置了一个默认的用户和一个不可变的ACL。如果您创建一个<code class="fe nl nm nn no b">MemoryDB</code>集群并将其与此ACL相关联:</p><ul class=""><li id="a826" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">客户端无需认证即可连接<em class="lu"/></li><li id="afc4" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">客户端可以在任何按键上执行<em class="lu">任何</em>命令(也没有权限或授权)</li></ul><p id="1578" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">作为最佳实践:</p><ul class=""><li id="b6b0" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated">定义显式ACL</li><li id="348e" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">添加用户(以及密码)，以及</li><li id="b96d" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated">根据您的安全要求配置访问字符串。</li></ul><p id="749c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您应该监控身份验证失败。例如，MemoryDB中的<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/metrics.memorydb.html" rel="noopener ugc nofollow" target="_blank"> AuthenticationFailures </a>指标为您提供了失败的身份验证尝试的总数——为此设置一个警报以检测未授权的访问尝试。</p><p id="e903" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">别忘了周边安全</p><p id="c57e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您已经在服务器上配置了<code class="fe nl nm nn no b">TLS</code>，不要忘记在您的客户机上也使用它！例如，使用Go Redis:</p><pre class="nv nw nx ny gt of no og oh aw oi bi"><span id="6c63" class="oj mg jg no b gy ok ol l om on">client := redis.NewClusterClient(<br/>	&amp;redis.ClusterOptions{<br/>		Addrs:     []string{clusterEndpoint},<br/>		TLSConfig: &amp;tls.Config{MaxVersion:      tls.VersionTLS12},<br/>		<em class="lu">//..other options</em><br/>	})</span></pre><blockquote class="lr ls lt"><p id="f8c4" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">不使用它会给你带来不太明显的错误(例如一个通用的</em> <code class="fe nl nm nn no b"><em class="jg">i/o timeout</em></code> <em class="jg">),使事情难以调试——这是你需要小心的事情。</em></p></blockquote><h1 id="6845" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">9.有些事情你不能做</h1><p id="0da3" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">作为托管数据库服务，<code class="fe nl nm nn no b">MemoryDB</code>或<code class="fe nl nm nn no b">ElastiCache</code> <a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/restrictedcommands.html" rel="noopener ugc nofollow" target="_blank">限制对某些Redis命令</a>的访问。例如，您<em class="lu">不能</em>使用<a class="ae jd" href="https://redis.io/commands/cluster/" rel="noopener ugc nofollow" target="_blank">集群</a>相关命令的子集，因为集群管理(缩放、分片等。)是由服务本身负责的。</p><p id="b372" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">但是，在某些情况下，你也许可以找到替代方案。以监控运行缓慢的查询为例。虽然您<em class="lu">无法使用<a class="ae jd" href="https://redis.io/commands/config-set/" rel="noopener ugc nofollow" target="_blank">配置设置</a>对<code class="fe nl nm nn no b">latency-monitor-threshold</code>进行</em>配置，但是您可以在<a class="ae jd" href="https://docs.aws.amazon.com/memorydb/latest/devguide/components.html#whatis.components.parametergroups" rel="noopener ugc nofollow" target="_blank">参数组</a>中设置<code class="fe nl nm nn no b">slowlog-log-slower-than</code>设置，然后使用<code class="fe nl nm nn no b">slowlog get</code>进行对比。</p><h1 id="ab2f" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">10.使用连接池</h1><p id="02e5" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">您的Redis服务器节点(即使是强大的节点)资源有限。其中之一是支持一定数量的并发连接的能力。大多数redis客户机提供连接池，作为有效管理Redis服务器连接的一种方式。重用连接不仅有利于Redis服务器，而且由于开销更少，客户端性能也得到提高——这在高容量场景中非常重要。</p><p id="1e29" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">ElastiCache提供了<a class="ae jd" href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/CacheMetrics.Redis.html" rel="noopener ugc nofollow" target="_blank">一些您可以跟踪的指标</a>:</p><ul class=""><li id="63bb" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">CurrConnections</code>:客户端连接的数量(不包括读取副本的数量)</li><li id="2ce9" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><code class="fe nl nm nn no b">NewConnections</code>:特定时间段内服务器接受的连接总数。</li></ul><h1 id="0d08" class="mf mg jg bd mh mi oa mk ml mm ob mo mp km oc kn mr kp od kq mt ks oe kt mv mw bi translated">11.(奖励)使用适当的连接模式</h1><p id="4d22" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">这是一个显而易见的错误，但我还是要把它说出来，因为这是我见过的最常见的“入门”错误之一。</p><p id="277f" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您在客户端应用程序中使用的连接模式将取决于您是否使用独立的Redis设置，即Redis集群(很可能)。大多数Redis客户对它们进行了明确的区分。例如，如果您在启用<code class="fe nl nm nn no b">MemoryDB</code>或<code class="fe nl nm nn no b">Elasticache</code>集群模式的情况下使用<a class="ae jd" href="https://github.com/go-redis/redis" rel="noopener ugc nofollow" target="_blank"> Go Redis客户端</a>，您需要使用<a class="ae jd" href="https://pkg.go.dev/github.com/go-redis/redis#NewClusterClient" rel="noopener ugc nofollow" target="_blank"> NewClusterClient </a>(不是<a class="ae jd" href="https://pkg.go.dev/github.com/go-redis/redis#NewClient" rel="noopener ugc nofollow" target="_blank"> NewClient </a>):</p><pre class="nv nw nx ny gt of no og oh aw oi bi"><span id="108e" class="oj mg jg no b gy ok ol l om on">redis.NewClusterClient(&amp;redis.ClusterOptions{<em class="lu">//....})</em></span></pre><blockquote class="lr ls lt"><p id="70ac" class="kv kw lu kx b ky kz kh la lb lc kk ld lv lf lg lh lw lj lk ll lx ln lo lp lq ij bi translated"><em class="jg">有意思的是，还有</em><a class="ae jd" href="https://pkg.go.dev/github.com/go-redis/redis#NewUniversalClient" rel="noopener ugc nofollow" target="_blank"><em class="jg">universal client</em></a><em class="jg">选项哪个更灵活一点(在写这篇文章的时候，这是在Go Redis v9) </em></p></blockquote><p id="e629" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你没有使用正确的连接模式，你会得到一个错误。但有时，根本原因会隐藏在一般的错误消息后面——所以您需要保持警惕。</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><h1 id="1b34" class="mf mg jg bd mh mi mj mk ml mm mn mo mp km mq kn mr kp ms kq mt ks mu kt mv mw bi translated">结论</h1><p id="7668" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">您做出的架构选择最终将由您的特定需求驱动。我建议您浏览以下博客文章，深入了解MemoryDB和ElastiCache for Redis的性能特征，以及它们如何影响您设计解决方案的方式:</p><ul class=""><li id="cdda" class="nc nd jg kx b ky kz lb lc le ne li nf lm ng lq nh ni nj nk bi translated"><a class="ae jd" href="https://aws.amazon.com/blogs/database/optimize-redis-client-performance-for-amazon-elasticache/" rel="noopener ugc nofollow" target="_blank">优化亚马逊ElastiCache和MemoryDB的Redis客户端性能</a></li><li id="29c5" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><a class="ae jd" href="https://aws.amazon.com/blogs/database/best-practices-redis-clients-and-amazon-elasticache-for-redis/" rel="noopener ugc nofollow" target="_blank">最佳实践:Redis客户端和用于Redis的Amazon ElastiCache】</a></li><li id="660e" class="nc nd jg kx b ky np lb nq le nr li ns lm nt lq nh ni nj nk bi translated"><a class="ae jd" href="https://aws.amazon.com/blogs/database/measuring-database-performance-of-amazon-memorydb-for-redis/" rel="noopener ugc nofollow" target="_blank">为Redis测量Amazon MemoryDB的数据库性能</a></li></ul><p id="6b56" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">请随意分享你的Redis技巧、诀窍和建议。在那之前，快乐大厦！</p></div></div>    
</body>
</html>