<html>
<head>
<title>Creating a Rust Web App with Rocket and Diesel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Rocket和Diesel创建Rust Web应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/creating-a-rust-web-app-with-rocket-and-diesel-58f5f6cacd27?source=collection_archive---------0-----------------------#2022-08-05">https://itnext.io/creating-a-rust-web-app-with-rocket-and-diesel-58f5f6cacd27?source=collection_archive---------0-----------------------#2022-08-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/d8e8333499e538957d6b20e567cdd4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZvWQHq9zl7Rn0iocKRyvw.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">安迪·赫尔曼万在<a class="ae jg" href="https://unsplash.com/s/photos/rocket?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="7fe8" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">我玩得很开心</h2></div><p id="080d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">变更日志:【2022年12月30日—使用Medium的新代码块进行语法突出显示</em></p><p id="7ac4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lv translated">D<span class="l lw lx ly bm lz ma mb mc md di">独立的、分离的、简洁的、包含电池的——在对火箭进行修补后，我会将这些形容词与它联系在一起。我会说我真的玩得很开心。请点击此处快速查看。</span></p><p id="b2fb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是另一篇关于Rust + Rocket + Diesel技术栈的文章，比如这里的<a class="ae jg" href="https://blog.logrocket.com/create-backend-api-with-rust-postgres/" rel="noopener ugc nofollow" target="_blank"/>和这里的<a class="ae jg" href="https://betterprogramming.pub/using-the-diesel-orm-for-a-web-app-with-rocket-90e610f6a6cf" rel="noopener ugc nofollow" target="_blank"/>。本文像对待任何其他web框架一样对待这个框架——从hello world开始，然后是<strong class="la jk">映射</strong>，然后是<strong class="la jk">序列化</strong>，然后是<strong class="la jk">应用配置</strong>，最后是<strong class="la jk">数据库配置和访问</strong>。</p><p id="3f12" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们是原型制作，所以除非另有说明，否则将所有内容都放在<code class="fe me mf mg mh b">main.rs</code>中。</p><p id="fa32" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是我们将要使用的堆栈:</p><ul class=""><li id="fa5e" class="mi mj jj la b lb lc le lf lh mk ll ml lp mm lt mn mo mp mq bi translated">🦀锈</li><li id="22d8" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">🚀火箭</li><li id="cfc8" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">⛽柴油公司</li><li id="954e" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">🐘Postgres</li><li id="0f5e" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">🐳码头工人</li></ul><p id="cbcf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">开发工具:</p><ul class=""><li id="2e08" class="mi mj jj la b lb lc le lf lh mk ll ml lp mm lt mn mo mp mq bi translated">visual Studio Code+<a class="ae jg" href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer" rel="noopener ugc nofollow" target="_blank">rust-analyzer</a>插件</li><li id="878e" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">✉️邮递员</li><li id="4669" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt mn mo mp mq bi translated">⿳桌游</li></ul></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="04de" class="nd ne jj bd nf ng nh ni nj nk nl nm nn kp no kq np ks nq kt nr kv ns kw nt nu bi translated">内容</h1><ol class=""><li id="6726" class="mi mj jj la b lb nv le nw lh nx ll ny lp nz lt oa mo mp mq bi translated"><a class="ae jg" href="#aa4a" rel="noopener ugc nofollow">你好世界</a></li><li id="138d" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><code class="fe me mf mg mh b"><a class="ae jg" href="#f510" rel="noopener ugc nofollow">GET /blog-posts/*</a></code> <a class="ae jg" href="#f510" rel="noopener ugc nofollow">端点</a></li><li id="c198" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><code class="fe me mf mg mh b"><a class="ae jg" href="#9027" rel="noopener ugc nofollow">POST /blog-posts</a></code> <a class="ae jg" href="#9027" rel="noopener ugc nofollow">终点</a></li><li id="bfe8" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#9415" rel="noopener ugc nofollow">错误</a></li><li id="2645" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#856a" rel="noopener ugc nofollow"> App配置</a></li><li id="dee4" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#0066" rel="noopener ugc nofollow">柴油设置</a></li><li id="6743" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#4501" rel="noopener ugc nofollow">迁移</a></li><li id="3157" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#b4d9" rel="noopener ugc nofollow">模式&amp;模式</a></li><li id="d0ec" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#ae71" rel="noopener ugc nofollow">柴油连接</a></li><li id="d39e" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#5bf5" rel="noopener ugc nofollow">更新</a> <code class="fe me mf mg mh b"><a class="ae jg" href="#5bf5" rel="noopener ugc nofollow">GET /blog-posts</a></code> <a class="ae jg" href="#5bf5" rel="noopener ugc nofollow">端点</a></li><li id="0083" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><a class="ae jg" href="#aa0c" rel="noopener ugc nofollow">更新</a> <code class="fe me mf mg mh b"><a class="ae jg" href="#aa0c" rel="noopener ugc nofollow">POST /blog-posts</a></code> <a class="ae jg" href="#aa0c" rel="noopener ugc nofollow">端点</a></li></ol></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="e92c" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">0.锈</h2><p id="c8e7" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">使用<code class="fe me mf mg mh b"><a class="ae jg" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">rustup</a></code>安装最新版本的Rust并运行</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="2107" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">rustup</strong> default stable &amp;&amp; <strong class="mh jk">rustup</strong> update</span></pre><p id="5e3d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后安装<a class="ae jg" href="https://crates.io/crates/cargo-watch" rel="noopener ugc nofollow" target="_blank">货表</a>进行热重装；</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="1744" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> install cargo-watch</span></pre><h2 id="aa4a" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">1.你好世界</h2><p id="88ea" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">我们从简单的开始。创建一个名为<code class="fe me mf mg mh b">rocket-diesel</code>的新项目:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="d707" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> new rocket-diesel --bin<br/><strong class="mh jk">cd</strong> rocket-diesel</span></pre><p id="b155" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">添加火箭依赖项:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="5d18" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> add rocket@0.5.0-rc.2 --features=json</span></pre><p id="2db7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">main.rs</code>中增加以下内容:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="34fd" class="pf ne jj mh b be pg ph l pi pb">#[macro_use] extern crate rocket;<br/><br/>#[get("/")]<br/>fn index() -&gt; &amp;'static str {<br/>    "Hello, world!"<br/>}<br/><br/>#[launch]<br/>fn rocket() -&gt; _ {<br/>    let rocket = rocket::build();<br/>    rocket.mount("/", routes![index])<br/>}</span></pre><ol class=""><li id="0f9c" class="mi mj jj la b lb lc le lf lh mk ll ml lp mm lt oa mo mp mq bi translated">建造一枚火箭— <code class="fe me mf mg mh b">rocket::build()</code></li><li id="5f64" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><strong class="la jk">在火箭上安装</strong>路线— <code class="fe me mf mg mh b">rocket.mount()</code></li><li id="b76f" class="mi mj jj la b lb mr le ms lh mt ll mu lp mv lt oa mo mp mq bi translated"><strong class="la jk">发射</strong>——<code class="fe me mf mg mh b">#[launch]</code></li></ol><p id="4993" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">奔跑</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="570b" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> watch -x run</span></pre><figure class="oq or os ot gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pj"><img src="../Images/9c07f42e232c4d4566af3c628d555f26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5XMlP_lPWZ3rNr7e_D0bA.png"/></div></div></figure><p id="208c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太可爱了。</p><h2 id="f510" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">2.获取/博客帖子/*端点</h2><p id="47d6" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">使用<a class="ae jg" href="https://serde.rs/" rel="noopener ugc nofollow" target="_blank"> serde </a>板条箱对dto进行序列化和去序列化。</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="3722" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> add serde@1.0.140</span></pre><p id="48bc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个可以序列化和反序列化的结构。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="5c61" class="pf ne jj mh b be pg ph l pi pb">#[derive(Serialize, Deserialize)]<br/>struct BlogPost {<br/>    id: i32,<br/>    title: String,<br/>    body: String,<br/>    published: bool,<br/>}</span></pre><p id="bdb1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们创建一个<code class="fe me mf mg mh b"><strong class="la jk">GET /blog-posts/random</strong></code>端点。</p><p id="fb97" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Rocket对JSON有一流的支持(还记得我们加的<code class="fe me mf mg mh b">--features=json</code>？)用一个<code class="fe me mf mg mh b">Json&lt;T&gt;</code>返回值创建端点。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="6f77" class="pf ne jj mh b be pg ph l pi pb">#[get("/random")]<br/>fn get_random_blog_post() -&gt; Json&lt;BlogPost&gt; {<br/>    Json(<br/>        BlogPost {<br/>            id: 1,<br/>            title: "My first post".to_string(),<br/>            body: "This is my first post".to_string(),<br/>            published: true,<br/>        }<br/>    )<br/>}</span></pre><p id="3710" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并将它安装到路线的<code class="fe me mf mg mh b">/blog-posts</code>矢量(第7行)</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="abaf" class="pf ne jj mh b be pg ph l pi pb">#[launch]<br/>fn rocket() -&gt; _ {<br/>    let rocket= rocket::build();<br/>    <br/>    rocket<br/>      .mount("/", routes![index])<br/>      .mount("/blog-posts", routes![get_random_blog_post])<br/>}</span></pre><p id="cfd2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你去<a class="ae jg" href="http://127.0.0.1:8000/blog-posts/random" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/blog-posts/random</a>，你会看到JSON的响应。</p><p id="7a57" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们要创建<code class="fe me mf mg mh b"><strong class="la jk">GET /blog-posts/&lt;id&gt;</strong></code>。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="9caa" class="pf ne jj mh b be pg ph l pi pb">#[get("/&lt;id&gt;")]<br/>fn get_blog_post(id: i32) -&gt; Json&lt;BlogPost&gt; {<br/>    Json(<br/>      BlogPost {<br/>          id,<br/>          title: "Some title".to_string(),<br/>          body: "Some body".to_string(),<br/>          published: true,<br/>      }<br/>    )<br/>}</span></pre><p id="daa2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将<code class="fe me mf mg mh b">get_post</code>添加到路线矢量中。然后在<a class="ae jg" href="http://127.0.0.1:8000/blog-posts/1000" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/blog-posts/1000</a>查看响应。</p><p id="02e5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们想创建<code class="fe me mf mg mh b"><strong class="la jk">GET /blog-posts</strong></code>来检索所有书籍。你知道该怎么做。将响应类型更改为<code class="fe me mf mg mh b">Json&lt;Vec&lt;Book&gt;&gt;</code>。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="00ce" class="pf ne jj mh b be pg ph l pi pb">#[get("/")]<br/>fn get_all_blog_posts() -&gt; Json&lt;Vec&lt;BlogPost&gt;&gt; {<br/>    Json(vec![<br/>        BlogPost {<br/>            id: 0,<br/>            title: "Harry Potter".to_string(),<br/>            body: "There once lived a boy".to_string(),<br/>            published: true,<br/>        },<br/>        BlogPost {<br/>            id: 1,<br/>            title: "Fantastic Beast".to_string(),<br/>            body: "There once lived a beast".to_string(),<br/>            published: true,<br/>        }<br/>      ]<br/>    )<br/>}</span></pre><p id="f3b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将<code class="fe me mf mg mh b">get_all_posts</code>添加到路线矢量中。然后在<a class="ae jg" href="http://127.0.0.1:8000/blog-posts" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/blog-posts</a>查看响应。</p><h2 id="9027" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">3.帖子/博客-帖子端点</h2><p id="41a6" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">用<code class="fe me mf mg mh b">application/json</code>数据过帐映射？在宏中使用<code class="fe me mf mg mh b">data = </code>！别忘了<code class="fe me mf mg mh b">Json</code>包装！</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="4b7a" class="pf ne jj mh b be pg ph l pi pb">#[post("/", data = "&lt;blog_post&gt;")]<br/>fn create_blog_post(blog_post: Json&lt;BlogPost&gt;) -&gt; Json&lt;BlogPost&gt; {<br/>    blog_post<br/>}</span></pre><p id="1a80" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在HTTP客户端中尝试一下。</p><h2 id="9415" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">4.错误</h2><p id="efb5" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">如果在调用上述POST端点时数据类型错误，将自动返回HTTP 422:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="8fbe" class="pf ne jj mh b be pg ph l pi pb">{<br/>    "error": {<br/>        "code": 422,<br/>        "reason": "Unprocessable Entity",<br/>        "description": "The request was well-formed but was unable to be followed due to semantic errors."<br/>    }<br/>}</span></pre><h2 id="856a" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">5.应用程序配置</h2><p id="48e9" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">应用程序配置是<a class="ae jg" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank"> 12因素应用程序</a>的一部分，我们很好奇它如何与Rocket一起工作。提示:依赖注入😍。</p><p id="590c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">配置在<code class="fe me mf mg mh b">Rocket.toml</code>中定义。创建此文件并添加以下内容:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="7048" class="pf ne jj mh b be pg ph l pi pb"># ./Rocket.toml<br/><br/>[default]<br/>name = "raimi"<br/>age = 20</span></pre><p id="0177" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">src/main.rs</code>中将该配置定义为一个Rust结构。这里，我们将该结构命名为<code class="fe me mf mg mh b">Config</code>。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="bebc" class="pf ne jj mh b be pg ph l pi pb">#[derive(Deserialize)]<br/>struct Config {<br/>    name: String,<br/>    age: u8,<br/>}</span></pre><p id="1823" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Rocket中，配置是<a class="ae jg" href="https://rocket.rs/v0.5-rc/guide/state/" rel="noopener ugc nofollow" target="_blank">管理的状态</a>，可以通过<code class="fe me mf mg mh b">&amp;State&lt;T&gt;</code>检索。这里，我们试图通过使用<code class="fe me mf mg mh b">&amp;State&lt;Config&gt;</code>在GET端点中使用<code class="fe me mf mg mh b">Config</code>值。美丽的❤️.</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="3356" class="pf ne jj mh b be pg ph l pi pb">// ./src/main.rs<br/><br/>use rocket::State;<br/><br/>#[get("/config")]<br/>fn get_config(config: &amp;State&lt;Config&gt;) -&gt; String {<br/>    format!(<br/>      "Hello, {}! You are {} years old.", config.name, config.age<br/>   )<br/>}</span></pre><p id="c0c4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，在第8行，我们告诉Rocket，它必须从<code class="fe me mf mg mh b">Rocket.toml</code>(或另一个提供者)提取<code class="fe me mf mg mh b">Config</code>配置值，并将其用作托管状态。在第9行中，我们包括了新的<code class="fe me mf mg mh b">get_config</code>路线。</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="9e16" class="pf ne jj mh b be pg ph l pi pb">use rocket::fairing::AdHoc;<br/><br/>#[launch]<br/>fn rocket() -&gt; _ {<br/>    let rocket = rocket::build();<br/><br/>    rocket<br/>        .attach(AdHoc::config::&lt;Config&gt;())<br/>        .mount("/", routes![index, get_config])<br/>        .mount(<br/>            "/blog-posts",<br/>            routes![<br/>                get_random_blog_post,<br/>                get_blog_post,<br/>                get_all_blog_posts,<br/>                create_blog_post<br/>            ],<br/>        )<br/>}</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="1d2a" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">🐳Docker设置</h2><p id="c42b" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">在我们继续之前，让我们稍微休息一下。我们将使用Docker Hub的官方Postgres映像来设置Postgres。创建一个<code class="fe me mf mg mh b">docker-compose.yml</code>文件:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="329b" class="pf ne jj mh b be pg ph l pi pb">version: '3.1'<br/>services:<br/>  db:<br/>    image: postgres<br/>    restart: always<br/>    environment:<br/>      POSTGRES_USER: postgres<br/>      POSTGRES_PASSWORD: example<br/>    ports:<br/>      - "5432:5432"</span></pre><p id="2588" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并运行<code class="fe me mf mg mh b">docker-compose up</code>。请注意，连接字符串如下所示(我们稍后将使用此信息):</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="128a" class="ob ne jj mh b gy oy oz l pa pb">postgresql://postgres:example/localhost:5432/postgres</span></pre></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="0066" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">6.柴油设置</h2><p id="18c8" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">我们将使用Diesel进行同步、阻塞式ORM。让我们安装它，以便我们可以在CLI中使用它:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="523a" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> add diesel_cli@1.4.1 --no-default-features --features postgres</span></pre><h2 id="4501" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">7.移民</h2><p id="7d3b" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">默认情况下，Diesel在<code class="fe me mf mg mh b">migrations</code>文件夹中查找迁移。我们会创造它</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="175f" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">mkdir</strong> migrations</span></pre><p id="5074" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并使用以下命令生成新的迁移脚本:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="7eb9" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">diesel</strong> migration generate create_blog_posts</span></pre><p id="c161" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">up.sql</code>文件中，添加</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="cd64" class="pf ne jj mh b be pg ph l pi pb">-- Your SQL goes here<br/>CREATE TABLE blog_posts (<br/>  id SERIAL PRIMARY KEY,<br/>  title VARCHAR NOT NULL,<br/>  body TEXT NOT NULL,<br/>  published BOOLEAN NOT NULL DEFAULT 'f'<br/>)</span></pre><p id="f9e6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">而在<code class="fe me mf mg mh b">down.sql</code>中，</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="7cc5" class="pf ne jj mh b be pg ph l pi pb">-- This file should undo anything in `up.sql`<br/>DROP TABLE blog_posts;</span></pre><p id="1896" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后运行迁移，指定数据库URL。</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="bf03" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">diesel</strong> migration run \<br/>  --database-url postgresql://postgres:example@localhost:5432/postgres</span></pre><h2 id="b4d9" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">8.模式和模型</h2><p id="b7df" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">将Diesel作为依赖项添加到应用程序中:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="15d8" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> add diesel@1.4.1</span></pre><p id="4017" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后添加以下内容，替换现有的<code class="fe me mf mg mh b">BlogPost</code>结构:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="0016" class="pf ne jj mh b be pg ph l pi pb">#[macro_use] extern crate diesel;<br/>use diesel::{Insertable, Queryable, table};<br/><br/>table! {<br/>    blog_posts (id) {<br/>        id -&gt; Int4,<br/>        title -&gt; Varchar,<br/>        body -&gt; Text,<br/>        published -&gt; Bool,<br/>    }<br/>}<br/><br/>#[derive(Serialize, Deserialize, Queryable, Debug, Insertable)]<br/>#[table_name = "blog_posts"]<br/>struct BlogPost {<br/>    id: i32,<br/>    title: String,<br/>    body: String,<br/>    published: bool,<br/>}</span></pre><p id="5621" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注意<code class="fe me mf mg mh b">table!</code>宏是从以下命令中派生出来的:</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="7e2f" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">diesel</strong> print-schema</span></pre><p id="53eb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个宏根据数据库模式扩展成一堆代码来表示<code class="fe me mf mg mh b">blog_post</code>表及其列。该代码用于将<code class="fe me mf mg mh b">BlogPost</code>结构与<code class="fe me mf mg mh b">blog_posts</code>表相关联，并根据列<code class="fe me mf mg mh b">id</code>、<code class="fe me mf mg mh b">title</code>、<code class="fe me mf mg mh b">body</code>和<code class="fe me mf mg mh b">published</code>验证结构成员的名称。太棒了。</p><h2 id="ae71" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">9.柴油连接</h2><p id="1dc7" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">添加为同步ORM提供支持的Rocket库。</p><pre class="oq or os ot gt ou mh ov ow aw ox bi"><span id="9199" class="ob ne jj mh b gy oy oz l pa pb"><strong class="mh jk">cargo</strong> add rocket_sync_db_pools@0.1.0-rc.2 \<br/>  --features=diesel_postgres_pool</span></pre><p id="dc45" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe me mf mg mh b">Rocket.toml</code>中配置我们的数据库:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="65c9" class="pf ne jj mh b be pg ph l pi pb">[default.databases.my_db]<br/>url = "postgres://postgres:example@localhost:5432/postgres"</span></pre><p id="4ae5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们的应用程序中使用这种配置:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="1231" class="pf ne jj mh b be pg ph l pi pb">#[database("my_db")]<br/>pub struct Db(diesel::PgConnection);</span></pre><p id="2adb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后将<code class="fe me mf mg mh b">Db</code>作为整流罩连接到第6行的火箭上:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="b5c2" class="pf ne jj mh b be pg ph l pi pb">#[launch]<br/>fn rocket() -&gt; _ {<br/>    let rocket = rocket::build();<br/><br/>    rocket<br/>        .attach(Db::fairing())<br/>        .attach(AdHoc::config::&lt;Config&gt;())<br/>        .mount("/", routes![index, custom])<br/>        .mount(<br/>            "/blog-posts",<br/>            routes![<br/>                get_random_blog_post,<br/>                get_blog_post,<br/>                get_all_blog_posts,<br/>                create_blog_post<br/>            ],<br/>        )<br/>}</span></pre><p id="20cb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">点击保存按钮，并确保您的应用程序可以运行。</p><h2 id="5bf5" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">10.创建一篇博客文章</h2><p id="faef" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">现在，我们将更新我们的<code class="fe me mf mg mh b">create_blog_post</code>，这样任何新的请求都将保存在数据库中:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="964c" class="pf ne jj mh b be pg ph l pi pb">#[post("/", data = "&lt;blog_post&gt;")]<br/>async fn create_blog_post(<br/>  connection: Db,<br/>  blog_post: Json&lt;BlogPost&gt;,<br/>) -&gt; Json&lt;BlogPost&gt; {<br/>  <br/>    connection<br/>        .run(move |c| {<br/>            diesel::insert_into(blog_posts::table)<br/>                .values(&amp;blog_post.into_inner())<br/>                .get_result(c)<br/>        })<br/>        .await<br/>        .map(Json)<br/>        .expect("boo")<br/>  <br/>}</span></pre><p id="e8d6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用HTTP客户端并提交POST请求，然后查看数据是否存储在数据库中！我用TablePlus做这个。</p><h2 id="aa0c" class="ob ne jj bd nf oc od dn nj oe of dp nn lh og oh np ll oi oj nr lp ok ol nt om bi translated">11.获取所有博客文章</h2><p id="bd5f" class="pw-post-body-paragraph ky kz jj la b lb nv kk ld le nw kn lg lh on lj lk ll oo ln lo lp op lr ls lt im bi translated">最后，我们将更新<code class="fe me mf mg mh b">get_all_blog_posts</code>来检索我创建的所有博客文章:</p><pre class="oq or os ot gt ou mh pc bn pd pe bi"><span id="f736" class="pf ne jj mh b be pg ph l pi pb">#[get("/")]<br/>async fn get_all_blog_posts(connection: Db) -&gt; Json&lt;Vec&lt;BlogPost&gt;&gt; {<br/>    connection<br/>        .run(|c| blog_posts::table.load(c))<br/>        .await<br/>        .map(Json)<br/>        .expect("Failed to fetch blog posts")<br/>}</span></pre><p id="d7a0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">检查您是否在<a class="ae jg" href="http://localhost:8000/blog-posts" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/blog-posts</a>看到了所有的博客帖子。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="1acf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">还和我在一起吗？太棒了，谢谢你读到这里！你可以在这里找到完整的应用:<a class="ae jg" href="https://github.com/remykarem/rocket-diesel" rel="noopener ugc nofollow" target="_blank">https://github.com/remykarem/rocket-diesel</a>。一定要看看我在下面贴的一些链接！</p><p id="fe39" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我觉得火箭怎么样？到目前为止，我喜欢火箭。感觉像是Spring Boot + FastAPI(但可能是因为我只知道这两个框架)。看起来Rocket附带了很多电池(例如Json)，作为该库的用户，我很欣赏这一点。我觉得<a class="ae jg" href="https://rocket.rs/v0.5-rc/guide/state/#managed-state" rel="noopener ugc nofollow" target="_blank">托管状态</a>和<a class="ae jg" href="https://rocket.rs/v0.5-rc/guide/state/#request-local-state" rel="noopener ugc nofollow" target="_blank">请求-本地状态</a>的概念类似于在Spring Boot管理beans，但我不能确定，当我再次谈到它时，我会了解更多。</p><p id="f899" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我觉得柴油怎么样？作为一个查询构建者，我认为API太冗长了。我简要地看了一下SQLx是如何工作的，我想下次我会尝试这样做。</p><p id="15ac" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">直到那时！</p><p id="43f9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">参考文献</strong></p><p id="4cfe" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://rocket.rs/" rel="noopener ugc nofollow" target="_blank">https://rocket.rs/</a></p><p id="72ab" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://diesel.rs/guides/getting-started" rel="noopener ugc nofollow" target="_blank">https://diesel.rs/guides/getting-started</a></p><p id="d8d4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://github.com/TmLev/crud-rest-api-rust-rocket-diesel-postgres" rel="noopener ugc nofollow" target="_blank">https://github . com/TmLev/crud-rest-API-rust-rocket-diesel-postgres</a></p><p id="9516" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">【https://dev.to/davidedelpapa/rocket-tutorial-01-basics-4ph9 T4】</p><p id="9141" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://github.com/SergioBenitez/Rocket/blob/v0.5-rc/examples/databases/src/diesel_sqlite.rs" rel="noopener ugc nofollow" target="_blank">https://github . com/SergioBenitez/Rocket/blob/v 0.5-RC/examples/databases/src/diesel _ SQLite . RS</a></p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="8f82" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我在人工智能、机器学习、编程语言、Web框架、生产力和学习方面发表文章。</p><p id="268e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">如果你喜欢阅读更多关于web框架的内容，你可以</em> <a class="ae jg" href="https://remykarem.medium.com/subscribe" rel="noopener"> <em class="lu">订阅</em> </a> <em class="lu">随时接收我发布的更新，或者</em> <a class="ae jg" href="https://remykarem.medium.com/membership" rel="noopener"> <em class="lu">通过我的推荐链接注册</em> </a> <em class="lu">！请注意，您的会员费的一部分将作为介绍费分摊给我。</em></p></div></div>    
</body>
</html>