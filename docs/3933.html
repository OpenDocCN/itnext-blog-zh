<html>
<head>
<title>Get rid of Fragment/Activity boilerplate code using Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Kotlin去除片段/活动样板代码</h1>
<blockquote>原文：<a href="https://itnext.io/get-rid-of-fragment-activity-boilerplate-code-using-kotlin-1b103763baf8?source=collection_archive---------4-----------------------#2020-03-27">https://itnext.io/get-rid-of-fragment-activity-boilerplate-code-using-kotlin-1b103763baf8?source=collection_archive---------4-----------------------#2020-03-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1770" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天，我将向您展示一种方法来删除片段和活动中最常见的样板代码，尤其是在使用MVVM架构时。</p></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/303760cd4178898fa9e3c0168bf0f75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0pKZlIehESHTSAdrUliTg.jpeg"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">声明片段/活动的当前状态:充斥着如下内容:oncreate view | binding = DatabindingUtil…| inflater . inflate()| binding . life cycle owner =…| viewModel =…</figcaption></figure><h1 id="c161" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">为什么？</h1><p id="eff7" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">Android团队最近引入了一个变化，允许在片段的构造函数中直接传递布局资源。这消除了重写onCreateView方法的需要，在不使用数据绑定时节省了大约3行代码。这也给了我灵感，让我创作出一些去除更多样板文件的东西。忘记每次都做同样的数据绑定和膨胀。</p><h1 id="f3eb" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我为什么要在乎？</h1><p id="85ec" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">当您使用MVVM和数据绑定时，该解决方案将从每个活动/片段中删除大约10行代码，但是即使您不像我一样做每件事，您仍然会有很多好处。<br/> 10行可能看起来不多，但相信我，这真的很重要。有了10个片段，就节省了100行代码，在非常简单的片段中，你实际上只会看到重要的东西，而不是2/3的样板文件。</p><h1 id="6069" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">我们将去掉哪些部分？</h1><ul class=""><li id="cb40" class="ml mm iq jp b jq mg ju mh jy mn kc mo kg mp kk mq mr ms mt bi translated">膨胀布局资源</li><li id="8c3a" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">声明ViewModel成员变量并设置它</li><li id="1876" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">声明绑定变量并设置它</li><li id="37c2" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk mq mr ms mt bi translated">将绑定与视图模型连接起来</li></ul></div><div class="ab cl kl km hu kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ij ik il im in"><h1 id="f192" class="li lj iq bd lk ll mz ln lo lp na lr ls lt nb lv lw lx nc lz ma mb nd md me mf bi translated">示例(类似于活动)</h1><p id="2f4c" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">这门课:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">用样板文件上课</figcaption></figure><p id="fdd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">会是这样的:</p><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">类，您可以随意调用它。</figcaption></figure><h1 id="d476" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">BaseFragment类看起来怎么样？</h1><figure class="kt ku kv kw gt kx"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h1 id="5057" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">注意事项:</strong></h1><ol class=""><li id="3571" class="ml mm iq jp b jq mg ju mh jy mn kc mo kg mp kk ng mr ms mt bi translated"><strong class="jp ir">绑定</strong>和<strong class="jp ir">视图模型</strong>是继承的，不需要在子类中声明它们，但是<strong class="jp ir">绑定</strong>可能为空(不过这并不重要，因为<strong class="jp ir">绑定</strong>主要用于BaseFragment中的内容，你根本不可能在子类中使用该变量)。另外:你不需要像以前一样知道绑定的类别，甚至可以在Android Studio中修复一些偶然的红色标记。</li><li id="a261" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk ng mr ms mt bi translated">不幸的是，目前在Kotlin中无法将ViewModel作为泛型和类来传递。<a class="ae nh" href="https://discuss.kotlinlang.org/t/avoid-passing-generic-and-kclass-of-same-class-when-inheriting/16217/2" rel="noopener ugc nofollow" target="_blank">kot Lin论坛上的问题</a> <br/>如果没有通用VM，我们将无法访问子类中ViewModel的特定字段&amp;方法。获取ViewModel实例需要该类。<strong class="jp ir">这里我们使用Koin的getViewModel()方法，但是如果您愿意，也可以使用ViewModelProviders。</strong></li><li id="fc64" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk ng mr ms mt bi translated">我们不能在第19行使用binding.setViewModel，因为我们需要一个通用的方法，但是setVariable也可以。唯一的限制是变量<strong class="jp ir">在xml中必须精确地命名为viewModel，</strong>，但是您可以选择任何您喜欢的名称。对于不同的xml文件，不需要有不同的视图模型名称，所以我只留下视图模型或者类似vm的东西。对于扩展该类的片段/活动，该名称将是相同的。</li><li id="c978" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk ng mr ms mt bi translated">这个课程对于活动来说是非常相似的，所以我将省略它</li><li id="51e9" class="ml mm iq jp b jq mu ju mv jy mw kc mx kg my kk ng mr ms mt bi translated">您可以立即在构造函数中看到布局资源和视图模型，无需在类中搜索它们。</li></ol><h1 id="f86b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="f6bc" class="pw-post-body-paragraph jn jo iq jp b jq mg js jt ju mh jw jx jy mi ka kb kc mj ke kf kg mk ki kj kk ij bi translated">在xml中使用相同的ViewModel名称来交换数百行代码，并且在继承时必须指定ViewModel类两次……对我来说似乎不是一件坏事。</p><p id="262e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请告诉我你是否认为有任何可以改进的地方，无论是代码还是这篇文章。<br/>这是我的第一个媒体帖子，我相信在:D之后我会继续编辑它</p><p id="3343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你愉快</p></div></div>    
</body>
</html>