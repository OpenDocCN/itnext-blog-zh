<html>
<head>
<title>Apache Kafka in Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蔚蓝中的阿帕奇卡夫卡</h1>
<blockquote>原文：<a href="https://itnext.io/apache-kafka-in-azure-6985ccdce89f?source=collection_archive---------1-----------------------#2020-06-09">https://itnext.io/apache-kafka-in-azure-6985ccdce89f?source=collection_archive---------1-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="cf6e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Apache Kafka已经在不同的垂直行业和行业中获得了广泛的采用，并且确实已经成为数据流、构建实时大数据管道甚至与流行的微服务异步通信的事实上的选择。</p><p id="9efe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我们比较并快速浏览了在Azure中运行Kafka集群的各种选项——请记住，这是我基于个人经验的个人观点，并不反映我的雇主微软的观点。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/3fdb49babf006efef599a3a05193d167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inWBfpNfCkPaWudezVqqGw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">卡夫卡——在云中？</figcaption></figure><p id="690a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">TL；DR——对于没有耐心的人，请查看下表，获取简明摘要</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi le"><img src="../Images/f0edc825977cd85226519e8fd5bd9a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqjbHIawX13Ska6zr-UZjA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">快速脏对比！</figcaption></figure><p id="aaf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，本文的重点是讨论和比较在Azure中运行Kafka的最相关和最新的方法:</p><ol class=""><li id="5aa0" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">活动中心</li><li id="cad4" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">使用运算符的Kubernetes (AKS)上的卡夫卡</li><li id="4211" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">蔚蓝色的融合云</li><li id="a0ba" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">卡夫卡论HDInsight</li></ol><p id="1525" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它们中的每一个都以自己的方式提供了一个全面的解决方案&amp;在某些条件下是合适的。本文的目的是提供指导，帮助您为工作负载选择正确的方式。</p><h1 id="9e63" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">活动中心</h1><p id="80f5" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这可能是迁移到托管Kafka集群的最简单和最容易的方法，因为您可以使用一些限制:</p><ol class=""><li id="3192" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">压缩:虽然Kafka的事件中心目前不支持压缩OOTB，但你可以解决这个问题</li><li id="e88e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">缺乏对Kafka流、HTTP Kafka API支持和主题ACL的支持</strong>，尽管它与Azure AD很好地集成了身份验证&amp;授权，并提供了访问EH的不同方式；通过<a class="ae mw" href="https://docs.microsoft.com/en-us/azure/event-hubs/authenticate-shared-access-signature" rel="noopener ugc nofollow" target="_blank">共享访问签名(SAS) </a>或通过<a class="ae mw" href="https://docs.microsoft.com/en-us/azure/event-hubs/authenticate-managed-identity" rel="noopener ugc nofollow" target="_blank">管理身份</a>。</li><li id="f757" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">主题</strong>的分区数量一旦部署就无法更改。所以一定要精心策划。(<strong class="js iu">更新</strong>:在专用层中，允许向上扩展— <a class="ae mw" href="https://docs.microsoft.com/en-us/azure/event-hubs/dynamically-add-partitions" rel="noopener ugc nofollow" target="_blank">您可以动态地向事件中心主题添加分区</a>)</li></ol><p id="a683" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有一些我非常喜欢活动中心的地方:</p><ul class=""><li id="f441" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated">作为一项托管服务，您可以选择根据需求<strong class="js iu">自动扩展</strong>集群。EH与吞吐量单位一起工作。单个吞吐量单元允许1 MB/s的入流量和两倍的出流量。它允许您从小规模开始，并根据您的需求进行扩展。</li><li id="fe85" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated">能够创建具有99.99% SLA的活动中心的<strong class="js iu">专用单租户部署</strong>，以满足最苛刻的流媒体需求。</li><li id="d6ef" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated"><strong class="js iu">事件中心捕获</strong>:允许您将EH中的数据自动捕获到blob存储帐户或ADLS Gen2，使您能够专注于数据处理而不是数据捕获。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi my"><img src="../Images/410c64b8c043b97f3b092123da0fb2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*DQH2I3dO91HPA5eMMw7t9A.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">事件中心捕捉设置</figcaption></figure><ul class=""><li id="17cb" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated"><strong class="js iu"> BYOK </strong> : EH支持客户管理的密钥来加密静态数据。你可以使用Azure Key Vault来存储&amp;管理你的密钥&amp;审计你的使用情况。</li><li id="fa49" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated">Swift <strong class="js iu">与事件网格</strong>的集成:事件网格是一个智能路由系统，使您能够构建高度健壮的事件驱动系统。详情见本<a class="ae mw" href="https://github.com/Azure/azure-event-hubs/tree/master/samples/e2e/EventHubsCaptureEventGridDemo" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mz"><img src="../Images/c2db13ec7ef63d8c50b98e218c5fb40b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*la61TMyiZtyJnWA0.PNG"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">活动中心和活动网格集成</figcaption></figure><h2 id="31e8" class="na lu it bd lv nb nc dn lz nd ne dp md kb nf ng mh kf nh ni ml kj nj nk mp nl bi translated">有活动中心的Spring Boot</h2><p id="bf6a" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">为了证明从Kafka迁移到EventHub是多么容易，我在这里创建了一个非常基本的<a class="ae mw" href="https://github.com/agrajm/spring-boot-kafka" rel="noopener ugc nofollow" target="_blank"> Spring Boot应用程序</a>,只需更改配置文件<code class="fe nm nn no np b">application.yaml</code>,它就可以与Kafka本地或Event Hub对话</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/35e971d897a92ab2c90de336efb92bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxFVpeWzg-SXat1y1Wm8wQ.png"/></div></div></figure><p id="beca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一些需要考虑的事项:</p><ol class=""><li id="8ecb" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">用您的EventHub名称空间替换<code class="fe nm nn no np b">&lt;Event_Hub_Namespace&gt;</code></li><li id="eea5" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">在事件中心用共享访问策略替换<code class="fe nm nn no np b">&lt;Connection_String_Primary_key</code>——只选择需要的访问。默认情况下，定义了一个根SAS策略，它拥有比您希望给予您的应用程序更多的访问权限。相反，定义一个适当范围的SAS策略，并复制其连接字符串主键，以代替JAAS配置的密码。</li><li id="d330" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">连接到EventHubs时，您必须使用<code class="fe nm nn no np b">$ConnectionString</code>作为用户名。</li><li id="4393" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">默认情况下，它会创建一个名为<code class="fe nm nn no np b">$Default</code>的消费组，我们在这里已经使用过了，但是您可以随意创建更多的消费组。</li><li id="5d46" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">确保选择标准或高级层，因为基本层中的事件中心不支持Kafka协议</li></ol><h1 id="7a2c" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">卡夫卡论库伯内特使用算子</h1><p id="43a0" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">如果您已经投资了Kubernetes来管理您的基础设施或编排您的微服务，并且如果这些工作负载需要与Kafka对话，那么这可能是您的最佳选择。我之前在博客上写过如何使用Strimzi运算符在AKS 上运行<a class="ae mw" href="https://medium.com/swlh/running-kafka-on-azure-kubernetes-service-d8d6882ade8" rel="noopener"> Kafka。正如他们所说，细节决定成败，但是如果你真的选择Kubernetes来运行你的Kafka工作负载，确保你使用一个运营商来帮助你。因为有很多，从免费的&amp;开源</a><a class="ae mw" href="https://strimzi.io/quickstarts/" rel="noopener ugc nofollow" target="_blank"> Strimzi Operator </a>到像<a class="ae mw" href="https://docs.confluent.io/current/installation/operator/index.html" rel="noopener ugc nofollow" target="_blank"> Confluent Operator </a>这样的许可运营商，它们允许你在Kubernetes上部署和管理作为云原生的有状态容器应用的Confluent Platform。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fb7781771be221b140bbc3d19e62a0de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*EJKNCjDHEhA6erdoUT9kPw.png"/></div></figure><h2 id="680f" class="na lu it bd lv nb nc dn lz nd ne dp md kb nf ng mh kf nh ni ml kj nj nk mp nl bi translated">为什么要使用运算符？</h2><p id="9eb0" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">因为这些运营商提供各种级别的配置来实现默认安全的Kafka安装，所以使用生产级功能(如机架感知)来跨可用性区域传播代理，并使用Kubernetes污点和容差在专用节点上运行Kafka。根据您的需要，您可以使用NodePort、负载平衡器和Ingress在Kubernetes外部公开Kafka，使用TLS可以轻松保护这些组件。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/299224b8df79d32bf278f1c69a2bd03c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBfvx0OqQVsQD3wIH8LYEw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">礼貌:汇合操作员</figcaption></figure><p id="b74b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">汇合操作符可能是最全面的，支持整个汇合平台(Kafka Connect，KSQL，Schema Registry，Replicator等)。)上Kubernetes。Strimzi是另一个需要小心的。它有一个非常令人印象深刻的全面的文档和一个非常活跃的Github repo。Strimzi由Red Hat支持，也有一个以Red Hat AMQ Streams形式出现的付费版本。但是，如果您愿意为Kafka集群付费，为什么不考虑像融合云这样的完全托管解决方案呢？这是我们在下一节要探讨的内容。</p><h1 id="5a0e" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">蔚蓝色的融合云</h1><p id="51b6" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">融合云现在集成在Azure Marketplace中，让您可以自由地构建新的集群，而无需使用信用卡单独注册融合，也就是说，您可以使用Azure信用来消费融合云提供的任何服务。此外，在融合云中发生的任何消费都会反映在您的Azure消费中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/4c9e50a65a91166745f71f9295421276.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdBh0UgR7V9jAmDNEB5_WA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">使用Azure Marketplace创建融合订阅</figcaption></figure><p id="0a88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你确实需要注册一个新账户，并管理不同的用户名和密码，但这是你唯一需要做的额外事情。<a class="ae mw" href="https://docs.confluent.io/current/quickstart/cloud-quickstart/index.html" rel="noopener ugc nofollow" target="_blank">融合云快速入门</a>确实是进入该平台的一个不错的快速入门——安装<code class="fe nm nn no np b">ccloud</code> cli并快速创建Kafka集群、主题、API-key等。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/dfb2760362b7ada2a349842f98fb8ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lun-rjyfyzuRIbwtDgK2-A.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建新的Kafka集群—融合云</figcaption></figure><p id="ceaa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦你创建了一个基本的Kafka集群和API Key &amp; Secret来使用，上面链接的<a class="ae mw" href="https://github.com/agrajm/spring-boot-kafka" rel="noopener ugc nofollow" target="_blank">同一个Spring boot应用程序</a>现在可以通过修改<code class="fe nm nn no np b">application.yaml</code>配置文件中的以下内容来使用这个在融合云中创建的集群:</p><ul class=""><li id="3ee8" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated">引导服务器信息</li><li id="3e70" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated">JAAS配置的用户名和密码:您必须创建API Key &amp; Secret并将其与您的Kafka集群相关联，然后才能使用它</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/45e73ece8d0dc940c8320996f3c7d5c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZW4MLpvtcT2Ff0gBnEyJ8w.png"/></div></div></figure><p id="1ad5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望从融合云产品中获得的东西:</p><ol class=""><li id="8455" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">创建<strong class="js iu">专用</strong>集群的能力——无论是基本的&amp;标准集群，您都只能获得大型多租户集群融合的一部分。我确信这一点正在积极开发中，但有时出于合规性原因&amp;诸如此类，客户更喜欢为自己创建一个单租户专用集群。</li><li id="6d6b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">SSO b/w Azure &amp; Confluent Cloud UI —我真的不想创建另一个帐户，记住另一组用户名/密码，安装另一个CLI来管理我的Kafka集群，所以如果我们可以使用相同的凭据和相同的工具(az cli)就太棒了。</li><li id="fd8a" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><strong class="js iu">用于数据加密的BYOK</strong>:同样，这主要是受监管行业的客户所需要的，但这是目前一个非常常见的问题，如果融合云能够支持客户管理的密钥，比如通过Azure Key Vault，那就太好了。</li></ol><p id="d020" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果出现以下情况，我真的会转向融合云</p><ul class=""><li id="5bf1" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated">我对PAYG的成本模型很满意&amp;寻找可靠的托管服务</li><li id="cf46" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated">我依赖于融合生态系统的其他部分:Kafka Connect、KSQL、连接器(源和汇都有)、融合模式注册表、复制器等。在撰写本文时，以下连接器可用</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/6a9804cd653a16b5db742e87ed57e4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ma_hk2kQ0chFs9mNZuw9WA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">融合的云:卡夫卡的连接器</figcaption></figure><h1 id="dcd3" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Azure高清洞察</h1><p id="3c1c" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">Azure HDInsight是Hadoop组件的完全托管的云分发版。它支持许多开源框架，如Apache Spark、Hive、Apache Storm、R Server、Apache HBase，当然还有Apache Kafka。它在Kafka正常运行时间上提供99.99%的SLA，并使用Azure托管磁盘作为Kafka代理的后备存储(为每个代理提供高达16TB的存储)。</p><h2 id="8e83" class="na lu it bd lv nb nc dn lz nd ne dp md kb nf ng mh kf nh ni ml kj nj nk mp nl bi translated">企业级安全性</h2><p id="8d62" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">虽然对于任何云提供商来说，安全将始终是<a class="ae mw" href="https://docs.microsoft.com/en-us/azure/security/fundamentals/shared-responsibility" rel="noopener ugc nofollow" target="_blank">的共同责任</a>，但Azure HDInsight拥有几个企业级安全功能，让您的生活变得轻松:</p><ul class=""><li id="b9eb" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated"><strong class="js iu"> VNet集成</strong>:Azure HD insight集群通常部署在虚拟网络中，Kafka集群完全隔离，无法在VNet之外访问。您还可以<a class="ae mw" href="https://azure.microsoft.com/en-us/blog/secure-incoming-traffic-to-hdinsight-clusters-in-a-vnet-with-private-endpoint/" rel="noopener ugc nofollow" target="_blank">使用私有端点</a>保护传入流量。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/25fd0aee35cabbf656e008c4248b7ae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oE2h0U6_WZtXGSDJ6VUQ7Q.png"/></div></div></figure><ul class=""><li id="838c" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn mx ll lm ln bi translated"><strong class="js iu">AuthN&amp;AuthZ</strong>:HD insight巧妙地与Azure AD集成在一起，用于身份验证&amp;通过Apache Ranger提供主题授权。虽然HDInsight不支持Kafka通过ACL对主题进行授权的方式，但您可以在Azure AD中使用用户组&amp;并在Apache Ranger中定义安全策略来达到相同的效果。</li><li id="1106" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated"><strong class="js iu">加入域的虚拟机</strong>:您可以让HDInsight集群中的虚拟机加入<a class="ae mw" href="https://docs.microsoft.com/en-us/azure/hdinsight/domain-joined/apache-domain-joined-architecture" rel="noopener ugc nofollow" target="_blank">域</a>，以便在这些虚拟机上运行的各种服务能够为经过身份验证的用户无缝工作。</li><li id="2bad" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated"><strong class="js iu"> BYOK &amp;托管身份</strong> : HDInsight for Kafka支持使用Azure Key Vault中的客户托管密钥来加密Kafka代理的Azure托管磁盘中存储的数据。这对某些受监管的客户来说是无价的。</li><li id="01eb" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn mx ll lm ln bi translated"><strong class="js iu">监控</strong> : Azure HDInsight与Azure Monitor集成，Azure Monitor提供单一界面，您可以使用该界面监控所有集群。</li></ul><p id="e2c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kafka的典型HDInsight集群由以下资源组成:</p><ol class=""><li id="26f1" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">头节点:您可以进入并管理环境和集群资源的几个头节点</li><li id="1ff7" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">动物园管理员节点:卡夫卡经纪人要求的3个ZK节点</li><li id="682f" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">工作节点:代理运行的位置</li><li id="095c" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">Azure托管磁盘:附加到每个代理的托管磁盘</li></ol><p id="d1df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您为Kafka创建HDInsight集群时，您可以选择工作节点的数量&amp;每个工作节点的标准磁盘。头节点和ZK节点分别固定为2和3。在创建集群时，它还会为您提供一个大概的成本指示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/4aa8037057be58c3a15f597a46eae64b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xajc-PlR4PDqHWeg9zxaeQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建群时的成本指示</figcaption></figure><p id="8588" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Azure HDInsight的Kafka集群的典型架构如下所示</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/5d3d12aa7b071847a590a8dddf071243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*rLIpuWn2f1g7N2h_yoySFQ.png"/></div></div></figure><p id="b211" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天，许多企业正在Azure中使用Azure HDInsight for Kafka，最值得注意的是<a class="ae mw" href="https://azure.microsoft.com/en-au/blog/announcing-public-preview-of-apache-kafka-on-hdinsight-with-azure-managed-disks/" rel="noopener ugc nofollow" target="_blank">丰田已经使用Azure HDInsight在Azure上部署了他们的联网汽车架构</a>，并利用Kafka、Storm &amp; Spark进行事件流传输和决策制定。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/a308ea2e5448aad52420107f92e2d833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Go0hpaBJXvZDnxdVA0wZ7w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">使用HDInsight Kafka的丰田联网汽车架构</figcaption></figure><p id="bfc1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个可能的缺点是您会产生成本，这部分是因为您有一个专用的集群(您的头节点、zookeeper节点、代理和与之相关的受管磁盘不会与任何人共享)，所以您最终要为所有计算和存储支付费用。同样，由于安全性和合规性的提高，我们看到许多企业继续采用这种方式，但您的收益可能会有所不同。</p><p id="903a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我也找不到任何自动扩展集群的方法——尽管HDInsight的<a class="ae mw" href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-autoscale-clusters" rel="noopener ugc nofollow" target="_blank">自动扩展是GA </a>,但可能不适用于“Kafka”类型的集群。</p><h1 id="71bb" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结论</h1><p id="bcb7" class="pw-post-body-paragraph jq jr it js b jt mr jv jw jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">这里没有简单的答案——没有放之四海而皆准的答案。几乎从来没有！但是我希望这种比较能够帮助你在Azure中部署Kafka时选择最适合你的用例的方法。</p></div></div>    
</body>
</html>