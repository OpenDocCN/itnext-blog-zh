<html>
<head>
<title>DDD in Node/Typescript, the functional way. Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DDD在Node/Typescript中，以函数的方式。第一部分</h1>
<blockquote>原文：<a href="https://itnext.io/ddd-in-node-typescript-the-functional-way-part-1-98d18d998b33?source=collection_archive---------1-----------------------#2020-02-25">https://itnext.io/ddd-in-node-typescript-the-functional-way-part-1-98d18d998b33?source=collection_archive---------1-----------------------#2020-02-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="a428" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一个系列的第一部分，在这里我将解释如何以函数的方式实现DDD(域驱动设计):使用NodeJS和Typescript。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/4e5f12f000972d07b57ef98776f34bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s75731zuQRAbOO6NcOvtHA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">DDD在Node/Typescript中，以函数的方式。第一部分</figcaption></figure><p id="cf41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">免责声明:这不是为了解释DDD的基本知识，有很多伟大的书籍已经这样做了。无论如何，这篇文章有大量的链接，可能有助于发现或更新概念。</p><p id="74a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您不需要对DDD和函数式编程有广泛的了解，但是推荐一些基础知识。</p><p id="9b0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本系列的目标是:解释如何在函数范式中实现DDD，特别是使用NodeJS和Typescript进行类型检查。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="6355" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在第一集中，我们将设计和定义我们的领域，并开始创建第一批领域类型，或者换句话说，业务核心。类型是我们的<a class="ae ll" href="https://culttt.com/2014/11/12/domain-model-domain-driven-design/" rel="noopener ugc nofollow" target="_blank">域模型</a>的基础，它们定义了允许创建域对象的方式，因为除了类型和名称，我们还定义了<strong class="js iu">约束</strong>。</p><p id="abb7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用这种方式定义我们的业务是非常有用和有利可图的，因为我们可以<strong class="js iu">在开发阶段</strong>捕获bug，这是一个bug的较低成本。如果你不使用类型，在运行时会出现错误，如果有测试的话。否则，大多数错误将在生产中被发现，很可能是由用户发现的。</p><p id="b35f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用类型的另一个好处是，你将省去编写大量的单元测试。这还不错。如果类型检查在违反规则时警告你，<strong class="js iu">你不需要对那个类型进行单元测试</strong>，这已经包括在内了。</p><p id="ad9d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用Typescript，它与大多数IDE有很好的集成，特别是VS代码和后面的优秀社区。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="72ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">删除任何面向对象元素的原因是JavaScript实际上是一种函数范式语言。它也支持面向对象范式，但是<strong class="js iu">函数式编程从JS </strong>中汲取了所有的强大功能，特别是自从引入了一些ES6特性之后。你可以使用类或者原型继承，但是我更喜欢组合、闭包、lambdas、不变性或者currying。反正我不打算解释函数式编程的<a class="ae ll" href="https://alvinalexander.com/scala/fp-book/benefits-of-functional-programming" rel="noopener ugc nofollow" target="_blank">好处。</a></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="2b01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，我们将创建一个虚拟的汽车租赁公司，该公司希望实施一个计算机化的系统，从过时的传统纸质系统中脱离出来。让我们把公司命名为RentSuper。此时，与<a class="ae ll" href="https://www.infoq.com/news/2016/05/domain-experts-ddd/" rel="noopener ugc nofollow" target="_blank">领域专家</a>的沟通将至关重要。我想你听说过<a class="ae ll" href="https://martinfowler.com/bliki/UbiquitousLanguage.html" rel="noopener ugc nofollow" target="_blank">这种无处不在的语言</a>。让我们定义我们的领域。</p><p id="c365" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个伟大的发现方法是<a class="ae ll" href="https://www.eventstorming.com/" rel="noopener ugc nofollow" target="_blank">事件风暴</a>。这将有助于理解和分割业务的各个部分。汽车租赁业务非常庞大，所以我们将重点放在取车系统上，这个过程从用户请求汽车开始，到用户放弃汽车结束。</p><p id="db27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我做了一个快速事件风暴。不是专家，不想进入细节。这是取车系统的结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ln"><img src="../Images/0ca2973d89eedb601d807f8994ac154c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ak_NkMKjy5wE-SlYUOx-SQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">取车领域事件风暴</figcaption></figure><p id="a077" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没有领域专家提供的信息帮助，我做不到。他们是确切知道这些步骤如何工作的人。这就是为什么<strong class="js iu">沟通是至关重要的</strong>。如你所见，便利贴中的所有术语都可以被每个人理解，这是构建这种无处不在的语言的第一块基石。</p><p id="9d5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在当前模型中，域是重叠的。我们需要将域分成<a class="ae ll" href="https://martinfowler.com/bliki/BoundedContext.html" rel="noopener ugc nofollow" target="_blank">有界的上下文</a>。在实践中，定义这种环境可能很棘手，事实上，这是最大的挑战之一。出于这个目的，我们不打算深究这个问题，所以这是我们的有界环境:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi lo"><img src="../Images/afcfa2b19e954589c2e46aa7fe876b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3i-jLhtoHwxvFjHnG6-gxg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">使用有界上下文创建解决方案</figcaption></figure><p id="bfc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了定义有界上下文之间的联系，<a class="ae ll" href="https://www.infoq.com/articles/ddd-contextmapping/" rel="noopener ugc nofollow" target="_blank">上下文映射</a>是一个很好的工具，但是现在我们只定义取车域，所以跳过这一部分。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/ddf1f5d213546c1bbb901d683ca34c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*4KjFs4AsU8VGdp7YoHKlJA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建租赁订单工作流</figcaption></figure><p id="adf4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将定义我们在事件风暴中定义的第一个工作流的输入和输出:<strong class="js iu">创建租赁订单</strong>。</p><p id="60b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们不会深入探究像<em class="lm"> ValidateOrder </em>这样的子步骤，因为这不是本文的目标。</p><p id="4309" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这个工作流的伪代码，我们已经有了一些开始编写类型的信息。原始类型和基本类型应该优先。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/7c010683eb72717dbc9e4f76e73e7884.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*rzko0-U1d5MgkfDF3lqd3w.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">汽车类型</figcaption></figure><p id="b77c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们要租车，所以开始做车型模型。</p><p id="835c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在工作流程中，需要验证汽车:汽车存在，在选定的提货办公室可用，并且可以卸货。</p><p id="a7fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们需要创造两种类型。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/599ff7854d4d9429aafc9b6e8f38c4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*IOjB1q1IZEMkXQpu9ynJHQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">订单类型</figcaption></figure><p id="6ea4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lm"> UnvalidatedOrder </em>是我们接收到的输入。它有一些未验证的值。</p><p id="76a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦通过<em class="lm">产品库存</em>依赖关系确认了汽车、办公室和日期，订单就生效了。</p><p id="e79a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">再一次，使用依赖关系，我们在选定的日期和办公室获得该车的<em class="lm"> amountToBill </em>，以创建<em class="lm">price order，</em>作为有效负载发送到<em class="lm"> RentOrderCreated </em>事件中。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/816cc86040a7d6a1c3b53835e2073c71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*NB0iVbBCKNk_b34Tf6IrKQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">工作流签名</figcaption></figure><p id="d006" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在是类型检查的重要部分进入的时候，<strong class="js iu">函数签名。</strong>这在定义工作流时绝对至关重要，确保我们领域的<strong class="js iu">一致性。</strong></p><p id="2489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">工作流的结果可以是<em class="lm"> RentOrderCreated </em>事件，也可以是错误。</p><p id="cf2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">函数签名将第一个参数(<em class="lm"> ProductStock </em>)标记为依赖。作为第二个参数，它接收<em class="lm"> UnvalidatedOrder </em>并返回先前定义的结果。</p><p id="e52a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始实施工作流之前，我们需要定义子步骤:<em class="lm"> ValidateOrder </em>、<em class="lm"> PriceOrder </em>和<em class="lm"> CreateEvents </em>工作流。为了敏捷，这里就不做了。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="46d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个Github repo  里面显示的代码和所有相关的都是<a class="ae ll" href="https://github.com/boxgames1/nodejs-ddd" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">。</strong></a></p><p id="8ed8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢这第一部分。一会儿见！</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="9955" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我是奥利弗·阿隆索，在西班牙远程工作的软件工程师。您可以在我的<a class="ae ll" href="https://www.linkedin.com/in/oliverioap/" rel="noopener ugc nofollow" target="_blank"> LinkedIn个人资料、</a> <a class="ae ll" href="https://oliveralonso.dev/" rel="noopener ugc nofollow" target="_blank">我的web </a>或<a class="ae ll" href="https://github.com/boxgames1" rel="noopener ugc nofollow" target="_blank"> GitHub帐户中找到更多关于我的信息。</a></p><p id="8db5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！</p></div></div>    
</body>
</html>