<html>
<head>
<title>How to Seed a Rails Database with a CSV File?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用CSV文件作为Rails数据库的种子？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-seed-a-rails-database-with-a-csv-file-105a7ba0e88c?source=collection_archive---------2-----------------------#2019-05-12">https://itnext.io/how-to-seed-a-rails-database-with-a-csv-file-105a7ba0e88c?source=collection_archive---------2-----------------------#2019-05-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2413582348337d5169fc01b22c7b7025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UuybfmgybQsPiEVb"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@mbaumi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米卡·鲍梅斯特</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b01b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，我一直在为自己做一个好玩的项目。我正在创建一个数独网络应用程序。它构建在Ruby on Rails后端和React前端之上。</p><p id="e57b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我找到了一个包含一百万个数独谜题和答案的开源数据集，我用它来做我的后台。简单来说，我只使用了5000个谜题/答案作为数据库的种子。</p><p id="ab67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我找到的开源数据集在一个包含两列的CSV文件中。第一栏是难题，第二栏是解决方案。</p><h1 id="74fb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">什么是CSV文件？</h1><p id="bbb6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">“CSV <a class="ae kc" href="https://www.lifewire.com/what-is-a-file-2625878" rel="noopener ugc nofollow" target="_blank">文件</a>是一个逗号分隔值文件。所有CSV文件都是<a class="ae kc" href="https://www.lifewire.com/txt-text-file-4150707" rel="noopener ugc nofollow" target="_blank">纯文本文件</a>，只能包含数字和字母，并以表格形式组织其中包含的数据。”(<a class="ae kc" href="https://www.lifewire.com/csv-file-2622708" rel="noopener ugc nofollow" target="_blank">什么是CSV文件？</a>)</p><h1 id="d5f5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何读取和访问CSV文件？</h1><p id="7986" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了将CSV文件中的信息植入数据库，您需要知道CSV文件所在的文件路径。</p><p id="d6c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对我来说，将by CSV文件放在我的Rails API项目目录的<code class="fe me mf mg mh b">lib</code>文件夹中是最有意义的。你可以把你的文件放在对你最有意义的地方。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/885afe9457ed6139111ca246f5cc7d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*s49q5GYlSB-QbX7jGsNw2g.png"/></div></figure><p id="1f64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Ruby中，您可以一次导入所有CSV文件(将所有文件内容存储在内存中)或一次从文件中读取一行。我选择通过使用<code class="fe me mf mg mh b">.foreach</code>方法从文件中一次读取一行来实现这一点。另一个选择是使用<code class="fe me mf mg mh b">CSV.read</code>方法。</p><p id="5d8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在种子文件中，您需要使用以下代码:</p><pre class="mj mk ml mm gt mn mh mo mp aw mq bi"><span id="8400" class="mr lc iq mh b gy ms mt l mu mv">require 'csv'</span><span id="244a" class="mr lc iq mh b gy mw mt l mu mv">CSV.foreach(Rails.root.join('lib/sudoku_seeds.csv'), headers: true) do |row|<br/>  <br/>  Board.create({<br/>    puzzle: row[0],<br/>    solution: row[1]<br/>  })</span><span id="0b15" class="mr lc iq mh b gy mw mt l mu mv">end</span></pre><h2 id="c5f7" class="mr lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">需要</h2><p id="36b4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在第一行中，我使用了<code class="fe me mf mg mh b">require 'csv'</code>，它允许我在Ruby中处理CSV文件。这是真的，因为<a class="ae kc" href="https://ruby-doc.org/stdlib-2.6.3/libdoc/csv/rdoc/index.html" rel="noopener ugc nofollow" target="_blank"> CSV是Ruby标准库</a>的一部分。</p><h2 id="4b10" class="mr lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">使用文件路径访问文件</h2><p id="2e75" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在看到<code class="fe me mf mg mh b">CSV.foreach</code>做什么之前，让我们先看看括号内发生了什么。</p><p id="8c55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">属性1: </strong>我知道我的文件的本地路径是:<code class="fe me mf mg mh b">'lib/sudoku_seeds.csv'</code>。将其替换为CSV文件的文件路径。</p><p id="3651" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是<code class="fe me mf mg mh b">Rails.root.join(‘lib/sudoku_seeds.csv’)</code>在做什么呢？如果您在您的终端中运行<code class="fe me mf mg mh b">Rails.root</code>,同时在您试图访问的目录中，返回值是您当前目录的路径。例如，我在我的rails控制台上运行<code class="fe me mf mg mh b">Rails.root</code>来测试它。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/029677a400e5cf918e36a4464550b470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jh0C1mTxpWd4lT21D8A7Yg.png"/></div></div></figure><p id="2e89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我将<code class="fe me mf mg mh b">.join(‘lib/sudoku_seeds.csv’)</code>添加到先前返回到我的本地目录的路径中时，我的返回值就是保存我的谜题和答案的CSV文档的确切路径。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/506f4b018198453a756804463befa7b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6KbwJR2gDuEGiNXaDDEHUw.png"/></div></div></figure><p id="484c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">属性2:</strong><code class="fe me mf mg mh b">headers: true</code>的第二个属性，表示我的CSV文件的第一行有列名。如果您的CSV文件在第一行中没有列名，那么您不需要包括该属性。</p><h2 id="55c0" class="mr lc iq bd ld mx my dn lh mz na dp ll ko nb nc lp ks nd ne lt kw nf ng lx nh bi translated">CSV.foreach</h2><p id="eef1" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">知道我们已经将文件路径和一个头选项作为参数传递给了<code class="fe me mf mg mh b">CSV.foreach</code>方法，我们还将一个块传递给了我们的方法。该块是关键字<code class="fe me mf mg mh b">do</code>和<code class="fe me mf mg mh b">end</code>之间的所有内容。在这个代码的例子中:</p><pre class="mj mk ml mm gt mn mh mo mp aw mq bi"><span id="2298" class="mr lc iq mh b gy ms mt l mu mv">do |row|<br/>  <br/>  Board.create({<br/>    puzzle: row[0],<br/>    solution: row[1]<br/>  })</span><span id="3870" class="mr lc iq mh b gy mw mt l mu mv">end</span></pre><p id="3bf8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">CSV.foreach</code>方法将CSV文件的每一行传递给代码块。在我的例子中，我调用我的<code class="fe me mf mg mh b">Board</code>模型并为每一行创建一个新的board实例。</p><p id="3abc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">CSV.foreach</code>把每一行当作一个数组，通过调用它在数组中的位置来访问一行中的每一列。例如，我的CSV文件只有两列:未完成的谜题和正确的答案。</p><p id="74d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过访问代码为<code class="fe me mf mg mh b">row[0]</code>的第一列，为每个<code class="fe me mf mg mh b">Board</code>分配一个难题属性，通过访问第二列<code class="fe me mf mg mh b">row[1]</code>分配解决方案属性。这将通过增加值<code class="fe me mf mg mh b">row[value]</code>来为您需要的任意多的列继续。</p><h1 id="7f6e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">您现在已经成功地植入了您的数据库</h1><p id="54f9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">遵循这些步骤将允许您使用此方法在数据库中植入CSV文件。如果你想深入这个话题，Darko Gjorgjievski有一个很棒的教程，分为两部分。<a class="ae kc" href="https://www.sitepoint.com/guide-ruby-csv-library-part/" rel="noopener ugc nofollow" target="_blank">第1部分</a>和<a class="ae kc" href="https://www.sitepoint.com/guide-ruby-csv-library-part-2/" rel="noopener ugc nofollow" target="_blank">第2部分</a>可通过以下链接找到。</p><p id="8940" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦您为数据库设定了种子，请务必测试您的数据，并确保一切都按预期执行！</p></div></div>    
</body>
</html>