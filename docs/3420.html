<html>
<head>
<title>Connect Apache Airflow to Snowflake Data Warehouse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Apache Airflow连接到雪花数据仓库</h1>
<blockquote>原文：<a href="https://itnext.io/connect-apache-airflow-to-snowflake-data-warehouse-37936a9edfa1?source=collection_archive---------0-----------------------#2019-12-12">https://itnext.io/connect-apache-airflow-to-snowflake-data-warehouse-37936a9edfa1?source=collection_archive---------0-----------------------#2019-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="6d7e" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">TL；DR，创建雪花连接，并使用Airlfow雪花贡献钩子和雪花操作符在雪花DWH上执行SQL命令。</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/f7dc875c432feb7b3ac2db8656a8433f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cev6pRKyE6o3zgZJsBu0g.png"/></div></div></figure><h1 id="68cf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><a class="ae lz" href="https://airflow.apache.org" rel="noopener ugc nofollow" target="_blank">阿帕奇气流:</a></h1><p id="8d4e" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">Airflow是一个以编程方式创作、调度和监控工作流的平台。广泛用于编排复杂的计算工作流、数据处理管道和ETL过程。</p><h2 id="f64f" class="mi lc iq bd ld mj mk dn lh ml mm dp ll mc mn mo lp me mp mq lt mg mr ms lx mt bi translated"><a class="ae lz" href="https://www.snowflake.com" rel="noopener ugc nofollow" target="_blank">雪花云数据仓库</a>:</h2><p id="ff2f" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">雪花是作为软件即服务(SaaS)提供的分析数据仓库。其独特的架构是传统共享磁盘数据库架构和无共享数据库架构的混合，允许对结构化和半结构化数据(CSV、JSON、ORC、Avro、Parquet、XML)提供完整的关系数据库支持。</p><h2 id="f99c" class="mi lc iq bd ld mj mk dn lh ml mm dp ll mc mn mo lp me mp mq lt mg mr ms lx mt bi translated">依赖关系:</h2><p id="c9c9" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">Apache airflow附带社区贡献的操作符和用于雪花启动airflow版本<code class="fe mu mv mw mx b">1.10.0</code> <br/>除了airflow版本1.10.0或更高版本之外，您还需要安装以下软件— <code class="fe mu mv mw mx b"><a class="ae lz" href="https://pypi.org/project/snowflake-sqlalchemy/" rel="noopener ugc nofollow" target="_blank">snowflake-sqlalchemy</a></code></p><blockquote class="my"><p id="fa04" class="mz na iq bd nb nc nd ne nf ng nh ko dk translated">pip安装雪花-sqlalchemy</p></blockquote><h2 id="db3a" class="mi lc iq bd ld mj ni dn lh ml nj dp ll mc nk mo lp me nl mq lt mg nm ms lx mt bi translated">正在创建连接:</h2><p id="8446" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">第一步是在<code class="fe mu mv mw mx b">Admin -&gt; Connecitons</code>为雪花dwh创建一个连接，并创建一个新的<code class="fe mu mv mw mx b">Conn Type = Snowflake</code>连接</p><pre class="kq kr ks kt gt nn mx no np aw nq bi"><span id="1245" class="mi lc iq mx b gy nr ns l nt nu">Conn Id: &lt;CONNECTION_ID&gt;<br/>Conn Type: Snowflake<br/>Host: &lt;YOUR_SNOWFLAKE_HOSTNAME&gt;<br/>Schema: &lt;YOUR_SNOWFLAKE_SCHEMA&gt;<br/>Login: &lt;YOUR_SNOWFLAKE_USERNAME&gt;<br/>Password: &lt;YOUR_SNOWFLAKE_PASSWORD&gt;<br/>Extra: {<br/>        "account": &lt;YOUR_SNOWFLAKE_ACCOUNT_NAME&gt;,<br/>        "warehouse": &lt;YOUR_SNOWFLAKE_WAREHOUSE_NAME&gt;,<br/>         "database": &lt;YOUR_SNOWFLAKE_DB_NAME&gt;,<br/>         "region": &lt;YOUR_SNOWFLAKE_HOSTED_REGION&gt;<br/>    }</span></pre><blockquote class="jn jo jp"><p id="c771" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">上面的模式部分可以留空，可以在您的SQL查询中提到。</p></blockquote><p id="9bed" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">现在，让我们深入了解雪花帐户、地区、云平台和主机名。雪花账户可以托管在以下任一云平台上:</p><ul class=""><li id="1264" class="nv nw iq jt b ju jv jy jz mc nx me ny mg nz ko oa ob oc od bi translated"><a class="ae lz" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务(AWS) </a></li><li id="df81" class="nv nw iq jt b ju oe jy of mc og me oh mg oi ko oa ob oc od bi translated"><a class="ae lz" href="https://azure.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank">微软Azure </a></li></ul><p id="0bf4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">下面将基于托管雪花的云平台来解释帐户名、区域、主机名</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oj"><img src="../Images/b0ac9f158022c41be0a7c8590ff275b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0qm6f6vgd9x5mzkE.png"/></div></div><figcaption class="ok ol gj gh gi om on bd b be z dk translated">雪花—帐户名和主机名</figcaption></figure><p id="20e1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">例如，如果帐户名是<code class="fe mu mv mw mx b">xy12345</code>:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/1ba4fb985d58f4959f881604fc87d588.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7hJ1rSDmgfg0WqprXZWowA.png"/></div></figure><p id="d820" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">您的雪花连接应该类似于以下示例</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi op"><img src="../Images/05527f3966f7c3e0d9aa57a35b73d0fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21DM6ZrudLSh-BAJV0gzTw.png"/></div></div></figure><h2 id="bcb5" class="mi lc iq bd ld mj mk dn lh ml mm dp ll mc mn mo lp me mp mq lt mg mr ms lx mt bi translated">正在创建DAG:</h2><p id="9475" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">让我们创建一个DAG，它使用雪花操作符&amp; hook并通过上面创建的连接连接到雪花DWH。</p><p id="e90b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">雪花运算符—当运算符执行某些SQL命令时，它会执行，但不会返回查询结果。当不需要查询结果时，最好使用运算符，即<code class="fe mu mv mw mx b">create, insert, merge, update, delete, copy into, truncate</code>所有这些都可以与运算符一起使用。</p><p id="458a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">雪花钩子——当钩子被使用时，查询结果总是被返回，因此钩子应该在<code class="fe mu mv mw mx b">select</code>查询必须被执行并且结果需要被传递给python进行进一步处理时被使用。</p><p id="8320" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">下面是一个DAG示例:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="oq or l"/></div><figcaption class="ok ol gj gh gi om on bd b be z dk translated">样本雪花连接器DAG</figcaption></figure><p id="2f7d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">在上面的DAG中，雪花运算符创建了一个表，并将数据插入到该表中。然后，雪花钩子用于查询由操作符创建的表。</p></div></div>    
</body>
</html>