<html>
<head>
<title>Home automation with SmartThings and OutSystems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">智能家居和外部系统家庭自动化</h1>
<blockquote>原文：<a href="https://itnext.io/home-automation-with-smartthings-and-outsystems-e6eb0fdb8f1b?source=collection_archive---------1-----------------------#2022-06-24">https://itnext.io/home-automation-with-smartthings-and-outsystems-e6eb0fdb8f1b?source=collection_archive---------1-----------------------#2022-06-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d9ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">各位家庭自动化爱好者，你们好！</p><p id="0c5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在过去的几个月里，我一直在设置我的智能家居。我决定用SmartThings，因为在易用性和可扩展性之间有一个很好的平衡。如果你在用HomeAssistant，请不要评价我:)</p><p id="c96d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想拥有的东西之一是一个壁挂式平板电脑，它是一个专用的控制面板，可以在一个地方管理设备，而不必使用我们手机中的不同应用程序。</p><p id="c363" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一段时间以来，我使用一个名为SharpTools的第三方平台来构建我的控制面板，但我想要比它所能提供的更多一些。因为我已经在使用SmartThings API构建一些定制的小部件，所以我决定全力以赴，在OutSystems 中构建一切。</p><p id="1786" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.outsystems.com/home/GetStartedForFree.aspx" rel="noopener ugc nofollow" target="_blank">刚接触外部系统？免费试用！</a></p><p id="90b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.outsystems.com/forge/Component_Overview.aspx?ProjectId=13032&amp;ProjectName=smartthings-integration" rel="noopener ugc nofollow" target="_blank">下载smart things Integration for out systems。</a></p><h1 id="b376" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">从结尾开始</h1><p id="dd6f" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我首先确定了控制面板的主要用例，并设计了界面和交互以获得最佳体验(至少以我的技能来说)。</p><p id="20e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的想法是非常常见的家庭自动化爱好者有，我见过几个这样的控制面板，我决定做我自己的了:公寓的3d渲染和它上面的控制。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/dff45defb0ac16a1bddb90e6b3a58969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NeHyBzgG7SeXbKUW"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">Figma中的初始UI设计</figcaption></figure><h1 id="cfb9" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">应用程序设置</h1><p id="d9ce" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我首先创建了一个服务模块来处理所有的API调用、服务器动作和数据。然后，一个示例应用程序列出设备及其详细信息，最后另一个应用程序为我的个人控制面板。</p><p id="f2d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一下每个应用程序的更多细节。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/9e8ee8fb948a1cd1a63f318c758b7bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/0*kBTxfe8X41eWSxpg"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">我的外部系统个人环境中的SmartThings应用</figcaption></figure><h1 id="c211" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">智能事物核心</h1><p id="8820" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这是一个服务模块，处理与<a class="ae kl" href="https://developer-preview.smartthings.com/docs/devices/device-basics" rel="noopener ugc nofollow" target="_blank"> SmartThings API </a>的所有通信，还存储服务器动作，以执行由小部件或动作触发的特定动作。</p><p id="e79b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不是后端开发人员，我使用REST的知识非常有限，并且依赖于从互联网上复制粘贴。使用OutSystems添加这些方法并在结构中表示它们对我来说非常有用，节省了时间。</p><h2 id="871b" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">方法</h2><p id="93bb" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我只添加了我觉得我实际上需要的方法，主要是列出东西、修改东西和获取关于东西的信息。</p><p id="8db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我仍然不知道如何在不ping设备的情况下监听设备上的变化，但对于我的用例来说，当平板电脑屏幕醒来时刷新数据已经足够了。稍后，我将更好地了解这个“postEvents”方法。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/d8192a650cd3156865277d8b94c70d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/0*E2M8zjMEGmXE3qom"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">我添加的初始方法集</figcaption></figure><h2 id="9b62" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">行动</h2><p id="6e14" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">在这些方法之上，我还创建了一些动作来抽象一些常见场景的复杂性，比如开灯或关灯、设置级别等。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/17f1a22ed832d4311b2a20cf0ea0789b.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/0*UiIwB7bJi-EoifG0"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">为获取或发布数据而创建的一组初始操作</figcaption></figure><h2 id="1969" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">设备同步</h2><p id="552f" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了更容易地组织房间和设备，我创建了一个计时器，将信息同步到外部系统，这样我就可以更容易地创建集合和显示信息。同样，后端真的不是我的领域，所以如果云中的设备数量与OutSystems表中的设备数量不同，我就删除所有设备并重新存储它们。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mu"><img src="../Images/915c6f938b77bcc48927eb3d1d37dc9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0LVAgCebc01uMiXH"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">如果它看起来很蠢，但却有效，那它就不蠢</figcaption></figure><h1 id="8483" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">SmartThings示例应用</h1><p id="0715" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这实际上是前端，我们可以看到集成提供了什么。第一个版本能够列出场景、房间、设备，获取设备信息和状态，还能执行开灯或关灯等命令。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mv"><img src="../Images/823fab90385c5484403d82f62a5d6e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VWvjFZ4JWC8axrYVMRYPFA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">设备屏幕，列出了所有设备以及可以对其执行的操作</figcaption></figure><h2 id="50c7" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">小部件示例:灯开关</h2><p id="c81e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这是一个非常基本的灯开关，包含在示例应用程序中。</p><p id="99ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当用户单击小部件时，带有状态的局部变量被切换，其值被传递给调用API的操作，该API带有在给定设备或设备列表上执行的命令。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/50bc55011e40426c63b3ec448642157d.png" data-original-src="https://miro.medium.com/v2/resize:fit:276/format:webp/1*dxa-AAAS03zBUl1niJpY0g.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">小部件块在ServiceStudio中的样子</figcaption></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/ad1e89ba2844d5427bd6df9f39d9b725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*cX3nYgnnN0GRB8MrKm5bfA.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">按下开关时运行的动作</figcaption></figure><h1 id="1b14" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">控制面板</h1><p id="5062" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">因此，使用上面看到的组件，是时候让实际的控制面板启动并运行了！</p><p id="127e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然我们90%的时间都在使用墙上的灯开关，但控制面板是用来改变各个灯的亮度水平，在出门前检查天气和控制Roomba，而不需要我妻子安装另一个应用程序(她甚至没有安装SmartThings)。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">看起来很酷，不是吗？</figcaption></figure><h2 id="2196" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">3d视图</h2><p id="2ec2" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我见过许多基于3d渲染的控制面板的例子，它们看起来很酷，并且在寻找设备时拥有蓝图的实际上下文要高效得多。</p><p id="6485" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经有了3d模型，因为我们在装修公寓之前使用了一个名为Planner5D的软件，所以这个项目有点“免费”。导出渲染后，我用它做了控制面板背景，并导入到外部系统。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/bc27acf205f9814a8b8b0ce63959d7fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eoUOD8RKl9Y4ajrMjF_JXg.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">渲染已经很好地放置在背景图像中</figcaption></figure><h2 id="c881" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">自定义小部件</h2><p id="f683" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我为这个控制面板构建了几个定制的小部件，一个时钟、一个天气小部件、一个室温图表和其他小部件来处理诸如灯和传感器之类的设备。</p><p id="6c9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中最重要的是灯开关和调光器部件。SmartThings在管理智能灯组方面很糟糕，他们通过他们的应用程序允许这一点，但他们实际上并没有将灯组作为一个设备或我们可以通过API控制的任何东西公开，所以我必须构建能够同时控制多个灯的定制开关，确保它们在状态和亮度级别方面总是同步的。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi na"><img src="../Images/16364ed688908399045c4e84617f8d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/0*E_2kgJPsaSNN8bQx"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">具有开关和调光功能的部件</figcaption></figure><h2 id="afe3" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">与Roomba集成</h2><p id="00a6" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这个还没完成，但是可以用。</p><p id="dc07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了与Roomba集成，我必须在SmartThings IDE中创建虚拟开关，并通过IFTTT自动控制它们来控制Roomba。不幸的是，IFTTT不支持Roomba最喜欢的多区域任务，所以这种集成迫使我为每个房间创建单独的开关和/或为整个公寓创建一个开关。我想我可以通过使用语音助手触发器来执行Roomba最喜欢的任务来解决这个问题，我稍后会这样做。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/98110ed5af61293609c2783ccbfe352b.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/0*H2BgETNVI2CxFrAf"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">SmartThings IDE中的虚拟交换机</figcaption></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/f580f9ff076f065ae43adfeb2668ae8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/0*DZi7Daq5Xyn6fZ05"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">如果TTT小应用程序或其他任何名称，它们会根据交换机的状态连接到Roomba</figcaption></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/60124976b74bcd9d8133bc741816da3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/0*49siLs0psJsd01ku"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">每个区域都有一个覆盖图像，带有一个触发虚拟开关打开或关闭的点击处理程序</figcaption></figure><h2 id="b2e0" class="mg kn iq bd ko mh mi dn ks mj mk dp kw jy ml mm la kc mn mo le kg mp mq li mr bi translated">背景随着昼夜循环平稳变化</h2><p id="cddd" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我说过我用控制面板上的渲染创建了一个背景，但实际上我创建了两个。一个版本用于白天，另一个版本用于晚上。</p><p id="091a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">时钟小部件调用一个动作来定义一天图像的透明度级别，这样背景随着一天中的时间循环，从早上8点到下午2点到晚上8点。它很微妙，但我喜欢它的样子。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ne"><img src="../Images/7b1de93fbec8577ad3fc5e2b5a4a98f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QkTow0R1WQR2Nal8"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">伟大的数学，这样的计算，哇</figcaption></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/17a07fdcd01c330d0338667a5169af07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*6FkXJbkNDBkiWBU4"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">我点击AddHours()来记录这张GIF的时间</figcaption></figure><h1 id="c1e5" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结束语</h1><p id="141d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">虽然我的控制面板已经基本完成，但实际的集成、方法、动作和示例应用程序还有很多需要改进的地方，我会继续这样做，但我想尽可能早地与社区分享尽可能多的内容。</p><p id="3027" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢一些帮助出主意的亲密朋友，感谢我的妻子容忍这种胡说八道。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ng"><img src="../Images/913f73e4f079b7a83ff53ac90cf22fb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1m_2nGndGWXWcxmOu-Cyqw.jpeg"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">这就是了，一台便宜的安卓平板电脑，安装在墙上，运行我的控制面板，质量很成问题</figcaption></figure></div></div>    
</body>
</html>