<html>
<head>
<title>Follow-up: Web Push Notifications And PWA In 2020</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">后续:2020年的网络推送通知和PWA</h1>
<blockquote>原文：<a href="https://itnext.io/follow-up-web-push-notifications-and-pwa-in-2020-54d27fbc829a?source=collection_archive---------2-----------------------#2020-04-14">https://itnext.io/follow-up-web-push-notifications-and-pwa-in-2020-54d27fbc829a?source=collection_archive---------2-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5986" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是我一年前的教程“使用Ionic和Angular的渐进式网络应用中的网络推送通知”的后续</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4c8e0523700f1fb18870d32d79bf971a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W6Eot89ZwJa994WQum55Sg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Javier Allegue Barros 在<a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b3c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我分享<a class="ae ky" href="https://medium.com/@david.dalbusco/one-trick-a-day-d-34-469a0336a07e" rel="noopener">一天一招</a>直到原定的2020年4月19日瑞士新冠肺炎隔离期结束。离第一个里程碑还有五天。希望更好的日子就在前面。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="7559" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你在Twitter上关注我，你可能已经知道我开发的一个应用程序最近被苹果和谷歌拒绝，因为它不符合他们对当前新冠肺炎疫情的限制性政策。</p><p id="b090" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我写这些文章不是为了分享我对这些公司的看法，而是为了分享我一年前的教程的后续内容:<a class="ae ky" href="https://medium.com/@david.dalbusco/add-web-push-notifications-to-your-ionic-pwa-358f6ec53c6f" rel="noopener">渐进式网络应用中的网络推送通知</a>。</p><p id="8dc3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实上，被拒绝的应用程序的一个核心概念依赖于推送通知。由于它是用<a class="ae ky" href="https://ionicframework.com" rel="noopener ugc nofollow" target="_blank"> Ionic </a>和<a class="ae ky" href="https://angular.io" rel="noopener ugc nofollow" target="_blank"> Angular </a>开发的，我们能够发布一个渐进式的网络应用程序，但这样的功能还能得到很好的支持吗？</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ac4e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">介绍</h1><p id="2cdd" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我正在写这篇文章<strong class="lb iu">2020年4月14日星期二</strong>，这就是为什么它反映了那个特定日期的状态。如果你将来读到这篇文章并注意到改进或变化，请联系我！</p><p id="a5aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">今天下午，我在运行Android v10的OnePlus 6和运行iOS 13的iPhone 6s上进行了测试。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="304b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">机器人</h1><p id="43b9" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">它就像一个魔咒，句号。我测试网络推送通知时，手机处于空闲模式，处于唤醒状态，并且应用程序处于打开状态。在所有情况下，我都收到了通知。干得好，谷歌👍。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1d6d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ios</h1><p id="4ffe" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">iOS上仍然<strong class="lb iu">不支持</strong>网页推送通知。自从我在2019年2月发布我的教程以来，状态没有改变。在<a class="ae ky" href="https://caniuse.com/#search=notification" rel="noopener ugc nofollow" target="_blank">can use</a>的帮助下，你可以注意到iOS Safari还没有实现通知API。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f05e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">设置</h1><p id="f786" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">我在上一篇文章中展示的<a class="ae ky" href="https://firebase.google.com/docs/cloud-messaging" rel="noopener ugc nofollow" target="_blank"> Firebase Cloud Messaging </a>设置仍然有效。当然，也许一些截图已经改变或已经实现，但想法是一样的。此外，我已经用完全相同的方式为我的应用程序设置了令牌，一切都很好。</p><p id="b528" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不过，值得注意的一件有趣的事情是，来自<a class="ae ky" href="https://medium.com/@galilo7g" rel="noopener">加利罗</a>的<a class="ae ky" href="https://medium.com/@galilo7g/good-tutorial-just-mention-the-need-to-specify-the-firebase-version-in-the-service-worker-that-e90d3d8a2231" rel="noopener">评论</a>。根据他/她的经验，服务人员使用的Firebase依赖项必须设置为与<code class="fe mz na nb nc b">package.json</code>中使用的版本号完全相同的版本号。我没有这个问题，但这可能是值得记住的事情。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b513" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">履行</h1><p id="a262" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">除了下面的反对意见(可以改进也可以不改进)之外，在我之前的教程中显示的<a class="ae ky" href="https://medium.com/@david.dalbusco/deeplinking-in-ionic-apps-with-branch-io-ba1a1c4ed227" rel="noopener">实现</a>仍然有效。它是我在我们的应用程序中实现的，因此我今天在我的Android手机上成功测试了它。</p><p id="921a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">也就是说，我认为可能有一种更简单的方法，特别是如果你正在使用<a class="ae ky" href="https://github.com/angular/angularfire" rel="noopener ugc nofollow" target="_blank"> AngularFire </a>，在渐进式Web应用中实现Web推送通知。我没有检查它，但在遵循我的教程之前，它可能值得一个快速的研究，以防你能抽出一些时间😉。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="9b05" class="nd md it bd me ne nf dn mi ng nh dp mm li ni nj mo lm nk nl mq lq nm nn ms no bi translated">贬值</h2><p id="4dd2" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">没什么大不了的，但是在看代码的时候，我注意到<code class="fe mz na nb nc b">await messaging.requestPermission();</code>被标记为不推荐使用。它可以更新如下:</p><pre class="kj kk kl km gt np nc nq nr aw ns bi"><span id="121d" class="nd md it nc b gy nt nu l nv nw">if (Notification.permission !== 'denied') {<br/>    await Notification.requestPermission();<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="f3e4" class="nd md it bd me ne nf dn mi ng nh dp mm li ni nj mo lm nk nl mq lq nm nn ms no bi translated">总共</h2><p id="a4cb" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">总之，我的增强型Angular服务负责注册Web推送通知和请求权限。</p><pre class="kj kk kl km gt np nc nq nr aw ns bi"><span id="112f" class="nd md it nc b gy nt nu l nv nw">import {Injectable} from '@angular/core';<br/><br/>import {firebase} from '@firebase/app';<br/>import '@firebase/messaging';<br/><br/>import {environment} from '../../../environments/environment';<br/><br/>@Injectable({<br/>    providedIn: 'root'<br/>})<br/>export class FirebaseNotificationsPwaService {<br/><br/>    async init() {<br/>        navigator.serviceWorker.ready.then((registration) =&gt; {<br/>            if (!firebase.messaging.isSupported()) {<br/>                return;<br/>            }<br/><br/>            const messaging = firebase.messaging();<br/><br/>            messaging.useServiceWorker(registration);<br/><br/>             messaging<br/>                 .usePublicVapidKey(environment.firebase.vapidKey);<br/><br/>            messaging.onMessage((payload) =&gt; {<br/>                // If we want to display <br/>                // a msg when the app is in foreground<br/>                console.log(payload);<br/>            });<br/><br/>            // Handle token refresh<br/>            messaging.onTokenRefresh(() =&gt; {<br/>                messaging.getToken().then(<br/>                    (refreshedToken: string) =&gt; {<br/>                    console.log(refreshedToken);<br/>                }).catch((err) =&gt; {<br/>                    console.error(err);<br/>                });<br/>            });<br/>        }, (err) =&gt; {<br/>            console.error(err);<br/>        });<br/>    }<br/><br/>    async requestPermission() {<br/>        if (!Notification) {<br/>            return;<br/>        }<br/><br/>        if (!firebase.messaging.isSupported()) {<br/>            return;<br/>        }<br/><br/>        try {<br/>            const messaging = firebase.messaging();<br/><br/>            if (Notification.permission !== 'denied') {<br/>                await Notification.requestPermission();<br/>            }<br/><br/>            const token: string = await messaging.getToken();<br/><br/>            // User token<br/>            console.log(token);<br/>        } catch (err) {<br/>            console.error(err);<br/>        }<br/>    }<br/>}</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b0c3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">摘要</h1><p id="4de4" class="pw-post-body-paragraph kz la it lb b lc mu ju le lf mv jx lh li mw lk ll lm mx lo lp lq my ls lt lu im bi translated">希望有一天我们也能在iOS设备上发送网页推送通知🤞。</p><p id="2fb7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">呆在家里，注意安全！</p><p id="3cc5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大卫</p></div></div>    
</body>
</html>