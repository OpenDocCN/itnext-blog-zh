<html>
<head>
<title>How to Restart Kubernetes Pods With Kubectl</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Kubectl重启Kubernetes Pods</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-restart-kubernetes-pods-with-kubectl-2a7834a6b961?source=collection_archive---------0-----------------------#2022-10-10">https://itnext.io/how-to-restart-kubernetes-pods-with-kubectl-2a7834a6b961?source=collection_archive---------0-----------------------#2022-10-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="98ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">豆荚是Kubernetes (K8S)的最小单位。它们应该一直运行，直到被新的部署所取代。正因为如此，没有办法重启一个pod，反而要更换。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8ca69e3676a79c4bd8719c5e0525da06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5scqv2_0W1fUWHoUrjWZlA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@giabyte?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Gia Oris </a>在<a class="ae le" href="https://unsplash.com/s/photos/start?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="db96" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">K8S没有使用<code class="fe lf lg lh li b">kubectl restart [podname]</code>命令(使用Docker你可以使用<code class="fe lf lg lh li b">docker restart [container_id]</code>)，所以有几种不同的方法用<code class="fe lf lg lh li b">kubectl</code>实现pod重启’。</p><p id="2a01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在几种情况下，您可能需要“重新启动”pod，通常是当pod状态停留在“终止”状态时，或者当pod出现错误并且不重新启动无法修复该错误时。在某些情况下，您可能需要在修改配置后重新启动pod，例如修改资源限制以限制pod的内存限制，或者更改pod正在使用的永久卷存储。</p><p id="c0b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，要重新启动pod中的特定容器，您可以使用下面详述的方法6，而不必重新创建pod。</p><h2 id="bf96" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">Pod状态</h2><p id="9064" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">pod有五种可能的状态:</p><ol class=""><li id="2780" class="mh mi it js b jt ju jx jy kb mj kf mk kj ml kn mm mn mo mp bi translated"><strong class="js iu">待定:</strong>此状态表示pod中至少有一个容器尚未创建。</li><li id="708d" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><strong class="js iu">正在运行:</strong>所有的容器都已经创建，并且pod已经绑定到一个节点。此时，容器正在运行，或者正在启动或重新启动。</li><li id="2764" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><strong class="js iu">成功:</strong>pod中的所有容器都已成功终止，不会重新启动。</li><li id="f672" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><strong class="js iu">失败:</strong>所有容器都已终止，至少有一个容器失败。失败的容器处于非零状态。</li><li id="791d" class="mh mi it js b jt mq jx mr kb ms kf mt kj mu kn mm mn mo mp bi translated"><strong class="js iu">未知:</strong>无法获得pod的状态。</li></ol><p id="d810" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您注意到pod处于不良状态，状态显示为“错误”,您可以尝试“重启”作为故障排除的一部分，以恢复正常操作。您也可能会看到“CrashLoopBackOff”状态，这是遇到错误时的默认状态，K8S会尝试自动重启pod。</p><h2 id="cea3" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">重启一个pod</h2><p id="f21e" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">您可以使用以下方法通过<code class="fe lf lg lh li b">kubectl.</code>来“重启”一个pod。一旦新的pod被重新创建，它们将具有与旧的不同的名称。使用<code class="fe lf lg lh li b">kubectl get pods</code>命令可以获得吊舱列表。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="d079" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法1</h2><ul class=""><li id="fcfd" class="mh mi it js b jt mc jx md kb nc kf nd kj ne kn nf mn mo mp bi translated"><code class="fe lf lg lh li b"><strong class="js iu">kubectl rollout restart</strong></code></li></ul><p id="6584" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种方法是推荐的第一停靠港，因为它不会在吊舱运行时引入停机时间。首次展示重启将一次杀死一个单元，然后新单元将按比例增加。此方法可从K8S v1.15开始使用。</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="1a69" class="lj lk it li b gy nk nl l nm nn">kubectl rollout restart deployment &lt;deployment_name&gt; -n &lt;namespace&gt;</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="74b2" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法2</h2><ul class=""><li id="effc" class="mh mi it js b jt mc jx md kb nc kf nd kj ne kn nf mn mo mp bi translated"><code class="fe lf lg lh li b"><strong class="js iu">kubectl scale</strong></code></li></ul><p id="73bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这种方法会导致停机，不推荐使用。如果停机不是问题，可以使用这种方法，因为它是<code class="fe lf lg lh li b">kubectl rollout restart</code>方法的更快的替代方法(在重新部署之前，您的pod可能必须经过漫长的持续集成/持续部署过程)。</p><p id="d12b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果没有与部署相关联的YAML文件，您可以将复制副本的数量设置为0。</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="fe87" class="lj lk it li b gy nk nl l nm nn">kubectl scale deployment &lt;deployment name&gt; -n &lt;namespace&gt; --replicas=0</span></pre><p id="c77e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这终止了豆荚。缩放完成后，副本可以根据需要按比例放大(至少放大到1倍):</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="fc9d" class="lj lk it li b gy nk nl l nm nn">kubectl scale deployment &lt;deployment name&gt; -n &lt;namespace&gt; --replicas=3</span></pre><p id="ef74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在缩放过程中，可以使用以下方法检查Pod状态:</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="6a96" class="lj lk it li b gy nk nl l nm nn">kubectl get pods -n &lt;namespace&gt;</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="1bae" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法3</h2><ul class=""><li id="9184" class="mh mi it js b jt mc jx md kb nc kf nd kj ne kn nf mn mo mp bi translated"><code class="fe lf lg lh li b"><strong class="js iu">kubectl delete pod</strong></code> <strong class="js iu">和</strong> <code class="fe lf lg lh li b"><strong class="js iu">kubectl delete replicaset</strong></code></li></ul><p id="8dc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果需要，可以单独删除每个pod:</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="6493" class="lj lk it li b gy nk nl l nm nn">kubectl delete pod &lt;pod_name&gt; -n &lt;namespace&gt;</span></pre><p id="6e6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样做将导致pod被重新创建，因为K8S是声明性的，它将基于指定的配置创建一个新的pod。</p><p id="785b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，在大量的pod运行的情况下，这实际上并不是一种实用的方法。但是，如果许多窗格具有相同的标签，您可以使用该标签一次选择多个窗格:</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="20d8" class="lj lk it li b gy nk nl l nm nn">kubectl delete pod -l “app:myapp” -n &lt;namespace&gt;</span></pre><p id="5255" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一种方法如果有许多pod，则可以删除ReplicaSet:</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="7784" class="lj lk it li b gy nk nl l nm nn">kubectl delete replicaset &lt;name&gt; -n &lt;namespace&gt;</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="dbc4" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法4</h2><ul class=""><li id="100a" class="mh mi it js b jt mc jx md kb nc kf nd kj ne kn nf mn mo mp bi translated"><code class="fe lf lg lh li b"><strong class="js iu">kubectl get pod | kubectl replace</strong></code></li></ul><p id="940f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe lf lg lh li b">kubectl get pod </code>获取当前正在运行的pod的YAML语句，并通过指定的<code class="fe lf lg lh li b">--force</code>标志将其传递给<code class="fe lf lg lh li b">kubectl replace</code>命令，可以检索要更换的pod，以实现重启。如果没有可用的YAML文件并且pod已启动，这将非常有用。</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="3e8b" class="lj lk it li b gy nk nl l nm nn">kubectl get pod &lt;pod_name&gt; -n &lt;namespace&gt; -o yaml | kubectl replace --force -f -</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="750f" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法5</h2><ul class=""><li id="e531" class="mh mi it js b jt mc jx md kb nc kf nd kj ne kn nf mn mo mp bi translated"><code class="fe lf lg lh li b"><strong class="js iu">kubectl set env</strong></code></li></ul><p id="7ea8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设置或更改与pod关联的环境变量将导致它重新启动以进行更改。以下示例将环境变量<code class="fe lf lg lh li b">DEPLOY_DATE</code>设置为指定的日期，导致pod重新启动。</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="6862" class="lj lk it li b gy nk nl l nm nn">kubectl set env deployment <!-- -->&lt;deployment name&gt;<!-- --> -n &lt;namespace&gt; DEPLOY_DATE="$(date)"</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="80a3" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">方法6</h2><p id="cd1d" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">这种方法将允许您杀死一个特定容器的主进程，这将触发该容器的重启，而无需K8S杀死pod并重新创建它。</p><pre class="kp kq kr ks gt ng li nh ni aw nj bi"><span id="e3d4" class="lj lk it li b gy nk nl l nm nn">kubectl exec -it &lt;pod_name&gt; -c &lt;container_name&gt; --/bin/sh -c "kill 1"</span></pre><p id="c2cf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将向进程1发送一个<code class="fe lf lg lh li b">SIGTERM</code>信号，进程1是在容器中运行的主进程。所有其他进程都将是进程1的子进程，并将在进程1退出后终止。请参见<a class="ae le" href="http://linuxcommand.org/lc3_man_pages/kill1.html" rel="noopener ugc nofollow" target="_blank"> kill联机帮助页</a>了解您可以发送的其他信号。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="dcf9" class="lj lk it bd ll lm ln dn lo lp lq dp lr kb ls lt lu kf lv lw lx kj ly lz ma mb bi translated">摘要</h2><p id="b4e8" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">当遇到K8S中的pod问题时，工具箱中有一系列命令可供使用，这将使您能够使用适当的方法来重启它们，具体取决于您部署pod的方式、应用程序正常运行的必要性以及您需要重启的速度。一般来说，最好的方法是使用上述的<code class="fe lf lg lh li b">kubectl rollout restart</code>方法，因为它可以避免应用程序停机。</p><p id="8d35" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重启并不能解决最初导致pod出现问题的问题，因此需要进一步调查根本原因。</p><p id="2e22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">干杯！🍻</p><div class="no np gp gr nq nr"><a href="https://www.buymeacoffee.com/jackwesleyroper" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">Jack Roper正在Azure、Azure DevOps、Terraform、Kubernetes和Cloud tech上写博客！</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">希望我的博客能帮到你，你会喜欢它的内容！我真的很喜欢写技术内容和分享…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ky nr"/></div></div></a></div><p id="8582" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="og">原载于</em><a class="ae le" href="https://spacelift.io/" rel="noopener ugc nofollow" target="_blank"><em class="og">space lift . io</em></a><em class="og">。</em></p></div></div>    
</body>
</html>