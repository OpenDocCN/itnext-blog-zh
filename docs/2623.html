<html>
<head>
<title>Kubernetes Journey — Up and running out of the cloud — etcd</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes之旅—启动并运行云计算— etcd</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c?source=collection_archive---------2-----------------------#2019-06-26">https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c?source=collection_archive---------2-----------------------#2019-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/152462e9f0c50c25a543311426a75d99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aMwZBR2LHbutNFKvc2HilA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由<a class="ae kc" href="https://unsplash.com/@marg_cs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Margarida CSilva </a>在<a class="ae kc" href="https://unsplash.com/search/photos/circle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="cba7" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在本文中，我们将介绍一些关于<strong class="km ir"> etcd </strong>的细节，以及它在<strong class="km ir"> Kubernetes集群</strong>中扮演的角色。我强烈建议您通过参考链接更好地理解<strong class="km ir"> etcd </strong>的工作原理。</p><p id="0978" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在<a class="ae kc" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-master-and-worker-6328775b347f">上一篇文章</a>中，我们介绍了<strong class="km ir"> Masters </strong>和<strong class="km ir"> Workers </strong>，并简要概述了它们的主要组成部分。</p><p id="ab78" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这些文章是我们<a class="ae kc" href="https://medium.com/@mtvallim/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5" rel="noopener"> Kubernetes之旅</a>的一部分。我希望您对深入研究如何从云中安装和配置Kubernetes感到兴奋！</p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="6c78" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">如果你不想等到所有的文章都发表了，又想马上动手，可以随意克隆项目的Github repo。它完全实用，文档也在不断改进:</p><div class="li lj gp gr lk ll"><a href="https://github.com/mvallim/kubernetes-under-the-hood" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd ir gy z fp lq fr fs lr fu fw ip bi translated">罩下的姆瓦利姆/库伯内特斯</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">本教程是有人计划安装一个Kubernetes集群，并希望了解一切如何配合在一起…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz jw ll"/></div></div></a></div></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/7845d71a257fc523834314d48c997922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNOK-8IjGv96ZoHTDH21ZA.png"/></div></div></figure><blockquote class="mf"><p id="984c" class="mg mh iq bd mi mj mk ml mm mn mo lh dk translated"><strong class="ak"> <em class="mp"> etcd </em> </strong> <em class="mp">是一个分布式键值存储，它提供了一种可靠的方式来存储跨机器集群的数据。它是开源的，可以在GitHub上获得。etcd在网络分区期间优雅地处理领导者选举，并且将容忍机器故障，包括领导者。</em></p></blockquote><blockquote class="mq mr ms"><p id="cbfa" class="kk kl mt km b kn mu kp kq kr mv kt ku mw mx kx ky my mz lb lc na nb lf lg lh ij bi translated">参考:<a class="ae kc" href="https://coreos.com/etcd/docs/latest/" rel="noopener ugc nofollow" target="_blank">https://coreos.com/etcd/docs/latest/</a></p></blockquote><p id="a2da" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">它是一个在集群中所有服务器上运行的守护程序，提供动态配置记录，并允许以简单的方式在集群成员之间共享多个配置数据。</p><p id="95d0" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">因为数据以键值形式存储在<strong class="km ir"> etcd </strong>中，所以它被自动分配和复制(自动选择<strong class="km ir"> leader </strong>)。对存储数据的所有更改都会反映在整个集群中。</p><p id="acd3" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="km ir"> etcd </strong>还提供了一个发现服务，允许“已部署”的应用程序向所有集群节点通告它们提供的服务。</p><p id="1b1d" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">与<strong class="km ir"> etcd </strong>的通信是通过API调用完成的，使用HTTP上的JSON。该API可以直接使用(例如通过curl或wget)，或者通过<strong class="km ir"> etcdctl </strong>间接使用。</p><blockquote class="mq mr ms"><p id="a875" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">参考:【https://etcd.io/ T4】</p></blockquote></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="edfc" class="nc nd iq bd ne nf ng dn nh ni nj dp nk kv nl nm nn kz no np nq ld nr ns nt nu bi translated"><strong class="ak">故障容差</strong></h2><blockquote class="mf"><p id="c0bb" class="mg mh iq bd mi mj nv nw nx ny nz lh dk translated"><em class="mp">建议集群中的成员数量为奇数。奇数的集群大小不会改变多数所需的数量，但是通过添加额外的成员，您可以获得更高的失败容忍度。在实践中，当比较偶数和奇数大小的集群时，您可以看到这一点</em></p></blockquote><blockquote class="mq mr ms"><p id="f83b" class="kk kl mt km b kn mu kp kq kr mv kt ku mw mx kx ky my mz lb lc na nb lf lg lh ij bi translated">参考:<a class="ae kc" href="https://coreos.com/etcd/docs/latest/v2/admin_guide.html" rel="noopener ugc nofollow" target="_blank">https://coreos.com/etcd/docs/latest/v2/admin_guide.html</a></p></blockquote><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/bfbc0908e0beec15d699eeb30347a9a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xawnd-GCZDm8XeqUL90qfQ.png"/></div></div></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="3c91" class="nc nd iq bd ne nf ng dn nh ni nj dp nk kv nl nm nn kz no np nq ld nr ns nt nu bi translated"><strong class="ak">复制</strong></h2><blockquote class="mf"><p id="e4d3" class="mg mh iq bd mi mj nv nw nx ny nz lh dk translated">在计算机科学中，<strong class="ak">状态机复制</strong>或<strong class="ak">状态机方法</strong>是一种通过复制服务器和协调客户端与服务器副本的交互来实现容错服务的通用方法。该方法还为理解和设计复制管理协议提供了一个框架。</p></blockquote><blockquote class="mq mr ms"><p id="1c8f" class="kk kl mt km b kn mu kp kq kr mv kt ku mw mx kx ky my mz lb lc na nb lf lg lh ij bi translated">参考:<a class="ae kc" href="https://en.wikipedia.org/wiki/State_machine_replication" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/State_machine_replication</a></p></blockquote><ul class=""><li id="d899" class="ob oc iq km b kn ko kr ks kv od kz oe ld of lh og oh oi oj bi translated"><strong class="km ir">主动复制</strong></li><li id="98e3" class="ob oc iq km b kn ok kr ol kv om kz on ld oo lh og oh oi oj bi translated"><strong class="km ir">被动复制</strong>‣领导节点负责将状态复制到其他副本；</li></ul></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h2 id="dcd4" class="nc nd iq bd ne nf ng dn nh ni nj dp nk kv nl nm nn kz no np nq ld nr ns nt nu bi translated"><strong class="ak">共识(筏)</strong></h2><blockquote class="mf"><p id="4124" class="mg mh iq bd mi mj nv nw nx ny nz lh dk translated"><em class="mp"> Raft是一种共识算法，旨在易于理解。它在容错和性能方面与Paxos相当。不同之处在于，它被分解成相对独立的子问题，并且它清楚地解决了实际系统所需的所有主要部分。我们希望Raft能够让更多的人使用共识，并且这些人能够开发出比现在更高质量的基于共识的系统。</em></p></blockquote><blockquote class="mq mr ms"><p id="72bf" class="kk kl mt km b kn mu kp kq kr mv kt ku mw mx kx ky my mz lb lc na nb lf lg lh ij bi translated">参考:<a class="ae kc" href="https://raft.github.io/" rel="noopener ugc nofollow" target="_blank">https://raft.github.io/</a></p></blockquote><p id="56c4" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="km ir">什么是分布式共识算法？</strong></p><ul class=""><li id="5837" class="ob oc iq km b kn ko kr ks kv od kz oe ld of lh og oh oi oj bi translated">允许一组进程就一个值达成一致的算法；</li><li id="9e4e" class="ob oc iq km b kn ok kr ol kv om kz on ld oo lh og oh oi oj bi translated">它允许协调分布式过程；</li><li id="9a07" class="ob oc iq km b kn ok kr ol kv om kz on ld oo lh og oh oi oj bi translated">它们出现在复制状态机的环境中；</li><li id="00e5" class="ob oc iq km b kn ok kr ol kv om kz on ld oo lh og oh oi oj bi translated">这种算法在构建大规模、可靠的分布式系统中起着至关重要的作用；</li></ul></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="f3fa" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="km ir">为了更好地理解这个概念，打个比方</strong></p><blockquote class="mq mr ms"><p id="14ec" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">从前，有一个王国，由国王统治的<strong class="km ir">聚居地</strong>。这位国王非常民主，由9位非常聪明、忠诚的顾问组成的团队支持他。</p><p id="eb00" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">每次他的臣民向国王提出请求，国王都会先和他的谋士商量，然后决定是否同意。如果大多数顾问投赞成票，请求将被批准。否则，它将被拒绝。</p></blockquote><p id="f325" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这是Raft算法中事务如何提交到日志的一个非常基本的类比。所有请求都由领导者(国王)处理，只有在大多数顾问(集群中的其他节点)接受请求后才会提交。</p><blockquote class="mq mr ms"><p id="8ae3" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">一天，在与一条可怕的龙搏斗时，国王死了。没有等待任何哀悼期，顾问们决定他们中的一个应该被选为新的执政国王。九个谋士中有两个(2)(姑且称他们为谋士5和7)申请成为新王。经过快速选举，4名辅导员投票给辅导员5，而其中3人投票给辅导员7。现在谋士5是新的国王，并开始遵循与前任统治者相同的政策。</p></blockquote><p id="fbc8" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">这大致说明了在Raft算法中领导者选举是如何发生的。</p><blockquote class="mq mr ms"><p id="6f4e" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">过了一段时间，由于对新统治者治理王国的方式不满，一些谋士发动了叛乱，最终将这片土地分成了两个王国:北部的<strong class="km ir">聚居地</strong>——由谋士5统治——和南部的<strong class="km ir">聚居地</strong>——由谋士7统治——每个都有自己的国王和谋士。人们现在生活在其中一个王国里，总是直接向他们各自的国王提出要求。即使这些王国现在已经分离，它们仍然以同样的方式被统治着(请求被提交给国王们，国王们向他们各自的顾问咨询)。</p><p id="5794" class="kk kl mt km b kn ko kp kq kr ks kt ku mw kw kx ky my la lb lc na le lf lg lh ij bi translated">几年后，两位国王达成协议，决定重新统一王国。<strong class="km ir">集群地</strong>又是一个王国，又是谋士5统治。不幸的是，在分裂期间，每个王国都制定了相互冲突的法律。为了解决这个问题，顾问们同意，每一个法律冲突都将通过遵循最近颁布的相应法律来解决。</p></blockquote><p id="901c" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">例如，故事的这一部分描述了一个网络划分的场景。在这种情况下，集群被拆分，每个新集群现在都有自己的领导者和节点。冲突的请求可能由不同的集群在不同的时间处理，并且当集群合并在一起时，需要一种解决冲突值的方法。Raft中用来处理这个的一个东西是<strong class="km ir">术语</strong>。</p><p id="6329" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><em class="mt">(故事演职员表:</em> <a class="ae kc" href="https://medium.com/@ivam.santos" rel="noopener"> <strong class="km ir"> <em class="mt">伊瓦姆卢兹</em> </strong> </a> <em class="mt"> ) </em></p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="6d86" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="km ir">何时使用？</strong></p><ul class=""><li id="8c5b" class="ob oc iq km b kn ko kr ks kv od kz oe ld of lh og oh oi oj bi translated">当过程需要共享一系列操作/事件的一致的、原子的和有序的视图时；<br/> ‣高可用性(容错)；<br/> ‣性能(在数千个客户端之间分配负载)；</li></ul></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi op"><img src="../Images/3420460b4026b396c4b80b395f3890c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Xv60_SZ47ENsNwPOU0ukGw.gif"/></div></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><h1 id="da7b" class="oq nd iq bd ne or os ot nh ou ov ow nk ox oy oz nn pa pb pc nq pd pe pf nt pg bi translated">etcd如何融入Kubernetes集群？</h1><p id="8ef4" class="pw-post-body-paragraph kk kl iq km b kn ph kp kq kr pi kt ku kv pj kx ky kz pk lb lc ld pl lf lg lh ij bi translated"><strong class="km ir"> etcd </strong>存储<strong class="km ir"> Kubernetes </strong>的设置、状态和元数据。因为Kubernetes 是一个分布式系统，所以使用分布式数据库是非常有意义的。<strong class="km ir"> etcd </strong>如前所述，是一个具有高可用性和可伸缩性的分布式数据库。</p><p id="1baf" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><em class="mt">“理想的婚礼为理想的方案在</em> <strong class="km ir"> <em class="mt">丛地</em> </strong> <em class="mt">。”</em></p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="eddd" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我希望你喜欢这篇文章以及这个系列的其他文章。在下一篇文章中，我们将更深入地了解Kubernetes网络的细节，描述组成它的各个部分，以及它们如何相互交互。</p><p id="7969" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">不要忘记在下面的评论中留下你的反馈。不断完善这一系列的内容非常重要。</p><p id="0123" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我再次强烈推荐您关注我的Medium，这样您就不会错过本系列中发表的任何新文章。如果你错过了这个系列的第一篇文章，可以在这里查看<a class="ae kc" href="https://medium.com/@mtvallim/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5" rel="noopener">。</a></p></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="4669" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">回头见！！</p><p id="bc65" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">再见</p></div></div>    
</body>
</html>