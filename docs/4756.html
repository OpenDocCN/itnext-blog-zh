<html>
<head>
<title>How to implement Redux Saga with ReactJS and Redux?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用ReactJS和Redux实现Redux Saga？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-implement-redux-saga-with-reactjs-and-redux-d6116efcc90?source=collection_archive---------2-----------------------#2020-09-08">https://itnext.io/how-to-implement-redux-saga-with-reactjs-and-redux-d6116efcc90?source=collection_archive---------2-----------------------#2020-09-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6d4bdc4231d41d5bc698725382769ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dviXgVuAcVK7HTJGP5rLg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.blog.duomly.com/implement-redux-saga-with-reactjs-and-redux/" rel="noopener ugc nofollow" target="_blank">如何用ReactJS和Redux实现Redux Saga？</a></figcaption></figure><p id="bc81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文原载于<a class="ae kf" href="https://www.blog.duomly.com/implement-redux-saga-with-reactjs-and-redux/" rel="noopener ugc nofollow" target="_blank">https://www . blog . duomly . com/implement-redux-saga-with-react js-and-redux/</a></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="3853" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Redux设置教程简介</h1><p id="9a5d" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">很多时候，你可以听到前端应用程序的状态，但是它到底是什么呢？让我解释一下。</p><p id="70aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">前端应用程序中的状态表示给定时间内存储在应用程序中的所有数据。它可以以不同的格式存储，如对象或字符串。基于状态的值，我们可以个性化应用程序，显示和隐藏某些元素。</p><p id="87c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了管理现代前端框架中的状态，我们可以使用不同的库，如Redux、MobX或NgRx。最常见的是Redux，它主要用于ReactJS应用程序，尽管它也可以用于Angular。</p><p id="846a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Redux，应用程序的状态保存在存储中，我们可以从应用程序中的每个组件访问存储。Redux由存储、reducers和动作组成。</p><p id="45ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我想告诉您更多关于Redux库的信息，并创建一个简单的ReactJS项目，在这里我将一步一步地设置Redux。</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="0df4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">开始吧！</p><h1 id="efac" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">Redux是如何工作的？</h1><p id="1775" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">Redux基于flux架构，它支持单向数据流。这意味着应用程序中的数据一次又一次地经历相同的生命周期，这使得状态中发生的所有事情都更加可预测。</p><p id="0042" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看这个简单的图形，它展示了数据在Redux应用程序中的生命周期。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/65895fcccf5bf40d73f5b7ff1871bdec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ydp_SlbVoA4LsqLCDab0XA.png"/></div></div></figure><p id="bbdc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上图中，您可以从UI中看到，我们触发了一个将数据传递给reducer的操作。接下来，reducer更新存储，这是我们的应用程序的状态。商店定义了用户界面。</p><p id="cee4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们想想使用Redux能给我们的开发带来什么好处。</p><h1 id="22af" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">使用Redux的好处</h1><p id="b2b8" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">当您构建应用程序时，您或多或少知道需要在应用程序内部管理多少数据。在大多数情况下，前端应用程序有一些功能，非常罕见的只是静态网站。通常，我们保存一些用户数据、表单数据等。在应用程序状态中，然后使用一个工具来管理状态是非常有用的。</p><p id="5fa5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ReactJS应用程序中最流行的解决方案是Redux。这种解决方案的流行有一些重要的好处。让我们一个一个来看看。</p><ul class=""><li id="8a1b" class="na nb it ki b kj kk kn ko kr nc kv nd kz ne ld nf ng nh ni bi translated"><strong class="ki iu">可预测状态</strong>—Redux中的状态是可预测的，因为减速器功能是纯的；因此，如果我们传递相同的状态和相同的动作，它需要返回相同的结果。Redux状态也是不可变的；它不能被改变或修改。</li><li id="47a3" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">易于维护</strong>——考虑到它是可预测的，并且对Redux应用程序的结构非常严格，任何了解Redux的人都会理解它，并且很容易使用它。</li><li id="ad7e" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">易于调试</strong> — Redux允许我们使用可用的开发工具记录行为，使调试更加容易。</li><li id="edd7" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">可用的开发者工具</strong> — Redux拥有令人惊叹的开发者工具，可以在浏览器中使用它们来查看后端发生了什么。</li><li id="53d5" class="na nb it ki b kj nj kn nk kr nl kv nm kz nn ld nf ng nh ni bi translated"><strong class="ki iu">服务器端渲染</strong> — Redux通过允许管理初始渲染来支持服务器端渲染。Redux将应用程序的状态发送给服务器，并对服务器的请求做出响应。</li></ul><p id="9db9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面我列出了使用Redux管理前端应用程序状态的一些好处。现在，我想转到实用部分，我们将使用ReactJS应用程序设置一个Redux。</p><h1 id="9876" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">创建ReactJS项目并安装Redux</h1><p id="30cb" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">是时候开始这篇文章的实践部分了。我必须创建一个新的ReactJS应用程序，这将是我们项目的基础。然后，我将安装Redux包，以便能够在我们新创建的应用程序中设置它。</p><p id="99db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开控制台，并转到您想要创建项目的位置。使用<code class="fe no np nq nr b">create-react-app</code>。因此，让我们用下面的命令创建一个应用程序。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="3f49" class="nw lm it nr b gy nx ny l nz oa">npx create-react-app redux-app</span></pre><p id="983b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们使用<code class="fe no np nq nr b">yarn</code>或<code class="fe no np nq nr b">npm</code>来启动应用程序。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="067c" class="nw lm it nr b gy nx ny l nz oa">cd redux-app<br/>yarn start</span></pre><p id="efd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当您的应用程序正常工作时，我们必须使用您为项目选择的包管理器安装<code class="fe no np nq nr b">redux</code>包和<code class="fe no np nq nr b">react-redux</code>包。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="ca95" class="nw lm it nr b gy nx ny l nz oa">yarn add redux<br/>yarn add react-redux</span></pre><p id="d247" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果一切都完成了，我们就可以进入应用程序的代码并设置Redux文件结构。</p><h1 id="f1ff" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">设置冗余结构</h1><p id="6d17" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">现在，我必须为我们的Redux文件建立结构。我决定在<code class="fe no np nq nr b">src</code>文件夹中为<code class="fe no np nq nr b">redux</code>创建一个单独的文件夹。在那里我创建了两个文件夹，一个用于<code class="fe no np nq nr b">actions</code>，一个用于<code class="fe no np nq nr b">reducers</code>，我创建的最后一个元素是<code class="fe no np nq nr b">store.js</code>文件。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="6f9a" class="nw lm it nr b gy nx ny l nz oa">└── src<br/>    |── redux<br/>    │   ├── actions<br/>    │   ├── reducers<br/>    │   |── store.js</span></pre><p id="6f35" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们的Redux文件的结构准备好时，我们可以将ReactJS应用程序的主文件与存储连接起来。</p><p id="e2d8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们打开<code class="fe no np nq nr b">index.js</code>文件，并按照下面的代码更新它。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="9923" class="nw lm it nr b gy nx ny l nz oa">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import App from './App';<br/>import * as serviceWorker from './serviceWorker';<br/>import { Provider } from 'react-redux';<br/>import store from 'redux/store.js';</span><span id="844f" class="nw lm it nr b gy ob ny l nz oa">ReactDOM.render(<br/>  &lt;Provider store={store}&gt;<br/>    &lt;React.StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/React.StrictMode&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span><span id="ce33" class="nw lm it nr b gy ob ny l nz oa">serviceWorker.unregister();</span></pre><p id="d385" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我从<code class="fe no np nq nr b">react-redux</code>导入了<code class="fe no np nq nr b">&lt;Provider&gt;</code>组件，用于将Redux存储传递给ReactJS应用程序。</p><p id="11dc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时，我们需要做的下一件事是定义我们的商店。让我们打开<code class="fe no np nq nr b">store.js</code>文件，并编写下面的代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="0a0e" class="nw lm it nr b gy nx ny l nz oa">import { createStore } from 'redux';<br/>import rootReducer from './reducers/index.js';</span><span id="41be" class="nw lm it nr b gy ob ny l nz oa">const store = createStore(rootReducer);</span><span id="7a81" class="nw lm it nr b gy ob ny l nz oa">export default store;</span></pre><p id="5a0f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所知，在<code class="fe no np nq nr b">store.js</code>文件中，我导入了需要创建的<code class="fe no np nq nr b">rootReducer</code>。<br/>在该文件中，我将使用<code class="fe no np nq nr b">combineReducers</code>方法，该方法将用于将减速器组合成一个单独的减速器，并将其传递给商店。之所以使用它，是因为为了创建和组织状态，我们通常会使用多个缩减器，但是我们只能将一个缩减器传递给<code class="fe no np nq nr b">createStore</code>方法，这就是为什么我们使用<code class="fe no np nq nr b">combineReducer</code>。</p><p id="f358" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们打开<code class="fe no np nq nr b">redux</code>文件夹，在那里创建一个<code class="fe no np nq nr b">index.js</code>文件。在新创建的文件中，让我们使用下面的代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="0f96" class="nw lm it nr b gy nx ny l nz oa">import { combineReducers } from 'redux';<br/>import users from './users';</span><span id="b73c" class="nw lm it nr b gy ob ny l nz oa">const rootReducer = combineReducers({<br/>  users: users,<br/>});</span><span id="3d57" class="nw lm it nr b gy ob ny l nz oa">export default rootReducer;</span></pre><p id="18e5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我还没有传递任何缩减器，因为我没有创建任何缩减器，但是我们将更新这个文件。现在，让我们创建一个动作和减速器。</p><h1 id="e5ba" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">创建动作和减速器</h1><p id="0163" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在这一步中，我将创建一个缩减器和一个动作。在我们的应用程序中，我们将使用JSONPlaceholder来获取数据。我们将创建一个用户配置文件列表。这就是为什么我们首先要创建一个用户缩减器。</p><p id="c450" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们转到<code class="fe no np nq nr b">reducers</code>文件夹，创建<code class="fe no np nq nr b">users.js</code>文件。在文件内部，让我们添加以下代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="3504" class="nw lm it nr b gy nx ny l nz oa">import * as type from '../types';</span><span id="49c6" class="nw lm it nr b gy ob ny l nz oa">const initialState = {<br/>  users: [],<br/>}</span><span id="eb8d" class="nw lm it nr b gy ob ny l nz oa">export default function users(state = initialState, action) {<br/>  switch (action.type) {<br/>    case type.GET_USERS:<br/>      return {<br/>        ...state,<br/>        users: action.payload<br/>      }<br/>    default:<br/>      return state<br/>  }<br/>}</span></pre><p id="4cf7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个文件中，我们设置了用户缩减器，我们还设置了初始状态并导入了将要使用的动作类型。不，我们必须创建<code class="fe no np nq nr b">types.js</code>文件并在那里创建类型。所以，让我们转到<code class="fe no np nq nr b">redux</code>文件夹，创建一个文件<code class="fe no np nq nr b">types.js</code>，并把它放在下面的代码中。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="e394" class="nw lm it nr b gy nx ny l nz oa">export const GET_USERS = 'GET_USERS';</span></pre><p id="2497" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们必须创建一个动作来获取用户。让我们转到<code class="fe no np nq nr b">actions</code>文件夹，并创建<code class="fe no np nq nr b">users.js</code>文件，我们将在其中放置操作。</p><p id="e785" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在文件内部，我们将使用以下代码定义<code class="fe no np nq nr b">getUsers</code>动作。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="e316" class="nw lm it nr b gy nx ny l nz oa">import * as type from '../types';</span><span id="3427" class="nw lm it nr b gy ob ny l nz oa">export function getUsers(users) {<br/>  return { <br/>    type: type.GET_USERS,<br/>    payload: users,<br/>  }<br/>}</span></pre><p id="e268" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的代码中，我创建了一个获取用户并将他们保存在reducers中的动作。现在，我们需要一些UI来调度动作并显示来自应用程序商店的数据。</p><h1 id="c9cd" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">调度操作并从Redux存储中获取数据</h1><p id="a4ff" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">让我们从创建一个新组件开始，我们将在其中构建UI来显示来自商店的数据。首先，让我们添加允许我们使用Bootstrap 5的CDN。在<code class="fe no np nq nr b">public\index.html</code>文件中，在head元素中添加以下代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="42d2" class="nw lm it nr b gy nx ny l nz oa">&lt;!-- CSS only --&gt;<br/>&lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous"&gt;</span></pre><p id="cac6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们为我们的组件创建一个新文件夹，在新创建的<code class="fe no np nq nr b">components</code>文件夹中创建两个文件，<code class="fe no np nq nr b">UsersComponent.jsx</code>和<code class="fe no np nq nr b">CardComponent.jsx</code>。在<code class="fe no np nq nr b">CardComponent.jsx</code>文件中，我们添加以下代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="123c" class="nw lm it nr b gy nx ny l nz oa">import React from 'react';</span><span id="608e" class="nw lm it nr b gy ob ny l nz oa">const Card = (props) =&gt; {<br/>  return (<br/>    &lt;div className="card"&gt;<br/>      &lt;div className="card-body"&gt;<br/>        &lt;h5 className="card-title"&gt;{props.user.name}&lt;/h5&gt;<br/>        &lt;h6 className="card-subtitle mb-2 text-muted"&gt;{props.user.company.name}&lt;/h6&gt;<br/>        &lt;p className="card-text"&gt;{props.user.company.catchPhrase}&lt;/p&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="1015" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此代码用于创建包含用户名、公司名称和公司短语的用户卡。</p><p id="da78" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们打开<code class="fe no np nq nr b">UsersComponent.jsx</code>文件，并把下面的代码放在那里。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="9595" class="nw lm it nr b gy nx ny l nz oa">import React, { useEffect } from 'react';<br/>import { useSelector, useDispatch } from 'react-redux';<br/>import { getUsers } from '../redux/actions/users';<br/>import Card from './CardComponent';</span><span id="78b8" class="nw lm it nr b gy ob ny l nz oa">const Users = () =&gt; {<br/>  const dispatch = useDispatch();<br/>  const users = useSelector(state =&gt; state.users.users);</span><span id="4bfe" class="nw lm it nr b gy ob ny l nz oa">  useEffect(() =&gt; {<br/>    dispatch(getUsers([<br/>      {<br/>        id: 1,<br/>        name: 'Leanne Graham',<br/>        company: {<br/>          name: "Romaguera-Crona",<br/>          catchPhrase: "Multi-layered client-server neural-net",<br/>        }<br/>      }<br/>    ]));<br/>  }, [])</span><span id="83e3" class="nw lm it nr b gy ob ny l nz oa">  return (<br/>    &lt;&gt;<br/>      {users.length &gt; 0 &amp;&amp; users.map((user) =&gt; (<br/>        &lt;Card key={user.id} user={user} /&gt;<br/>      ))}<br/>      {users.length === 0 &amp;&amp; &lt;p&gt;No users available!&lt;/p&gt;}<br/>    &lt;/&gt;<br/>  )<br/>}</span><span id="8029" class="nw lm it nr b gy ob ny l nz oa">export default Users;</span></pre><p id="169f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用了来自<code class="fe no np nq nr b">react-redux</code>和<code class="fe no np nq nr b">useEffect()</code>的钩子，我在这段代码中调度动作。当我们运行应用程序时，动作被分派，用户数据被传递给存储。</p><p id="2de8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们仍然需要将UsersComponent添加到<code class="fe no np nq nr b">App.js</code>文件中，以显示它并更改一些样式。我们先打开<code class="fe no np nq nr b">App.js</code>，确定它看起来像下面的代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="876c" class="nw lm it nr b gy nx ny l nz oa">import React from 'react';<br/>import Users from './components/UsersComponent';<br/>import './App.css';</span><span id="8457" class="nw lm it nr b gy ob ny l nz oa">function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Users /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="0cf0" class="nw lm it nr b gy ob ny l nz oa">export default App;</span></pre><p id="4257" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而且让我们现在就打开<code class="fe no np nq nr b">App.css</code>文件；接下来，删除其中的所有样式，并放置如下代码。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="c356" class="nw lm it nr b gy nx ny l nz oa">.App {<br/>  margin: 5%;<br/>}<br/>.card {<br/>  margin: 10px;<br/>}</span></pre><p id="4f86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了能够检查Redux中发生了什么，我们可以使用<code class="fe no np nq nr b">redux-dev-tools</code>，我们将在下一点中打开它。</p><h1 id="3804" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">添加冗余开发工具</h1><p id="6664" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated"><code class="fe no np nq nr b">redux-dev-tools</code>是一个工具，它允许我们检查应用程序状态中发生了什么，调度了哪些操作，以及存储了哪些数据。</p><p id="2070" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们打开我们的<code class="fe no np nq nr b">store.js</code>文件，用下面的代码更新它。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="ec90" class="nw lm it nr b gy nx ny l nz oa">import { createStore, compose } from 'redux';</span><span id="a214" class="nw lm it nr b gy ob ny l nz oa">const store = compose(<br/>  window.devToolsExtension &amp;&amp; window.devToolsExtension(),<br/>)(createStore)(rootReducer);</span></pre><p id="5b76" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当你在Google Chrome中打开开发者工具并找到Redux选项卡时，你将能够看到关于商店和Redux中发生的动作的所有信息。</p><h1 id="167c" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">设置Redux中间件</h1><p id="786a" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">首先，让我解释一下什么是中间件。代码可以放在发送请求的框架和生成响应的框架之间。中间件的最大优势是我们可以在一个项目中结合一些第三方中间件。</p><p id="a478" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么，为什么Redux中需要中间件呢？action和reducer之间的数据流按照一个非常清晰的模式工作，但是当我们必须与API通信或者做一些其他副作用类型的动作时。中间件有助于执行副作用，而不会阻止应用程序的状态更新。</p><p id="bd09" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我想更深入地了解我们必须通过Redux与API通信的情况。这就是为什么我想告诉你更多关于两个流行的用于异步API调用的中间件解决方案，Redux-Thunk和Redux-Saga。</p><h2 id="564d" class="nw lm it bd ln oc od dn lr oe of dp lv kr og oh lz kv oi oj md kz ok ol mh om bi translated">重复思维</h2><p id="2ee3" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">Redux Thunks是一个第三方库，允许在Redux应用程序内部创建异步API调用。它允许我们编写名为thunk的函数，该函数发出Ajax请求，并使用响应数据调用动作创建器。</p><p id="97f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我解释一下thunk是什么。Thunk是一个延迟表达式求值的包装函数。</p><p id="1005" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Redux Thunks在ReactJS和Redux环境的初学者中非常常见，因为它非常容易使用和设置。</p><p id="0319" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是，我们不会为我们的API调用选择这个解决方案。</p><p id="e7fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Redux中的中间件有一个不同的流行解决方案，它被称为Redux-Saga。现在让我们更仔细地看看这个话题。</p><h2 id="0111" class="nw lm it bd ln oc od dn lr oe of dp lv kr og oh lz kv oi oj md kz ok ol mh om bi translated">Redux传奇</h2><p id="5d72" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">中间件的下一个解决方案是Redux-Saga。Redux-Saga使用ES6生成器而不是函数。它允许我们轻松地测试、编写和读取Redux中的异步调用。</p><p id="1fee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Redux-Saga而不是Redux-Thunk的最大优点是避免了回调地狱，并且操作保持纯净，因此异步代码非常容易测试。<br/>在我们的应用中，我们将使用Redux-Saga作为中间件来创建API调用。来实施吧！</p><h2 id="3173" class="nw lm it bd ln oc od dn lr oe of dp lv kr og oh lz kv oi oj md kz ok ol mh om bi translated">实现中间件</h2><p id="2ee6" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">为了实现我们的<code class="fe no np nq nr b">redux-saga</code>,让我们从使用yarn或npm安装它开始。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="b5bb" class="nw lm it nr b gy nx ny l nz oa">yarn add redux-saga</span></pre><p id="81da" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们在<code class="fe no np nq nr b">redux</code>文件夹中创建<code class="fe no np nq nr b">saga</code>文件夹。在新创建的文件夹中，创建两个文件，<code class="fe no np nq nr b">index.js</code>和<code class="fe no np nq nr b">userSaga.js</code>。在<code class="fe no np nq nr b">userSaga.js</code>文件中，我们将创建一个API调用和我们的sagas来获取用户数据。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="0922" class="nw lm it nr b gy nx ny l nz oa">import { call, put, takeEvery } from 'redux-saga/effects'</span><span id="6f15" class="nw lm it nr b gy ob ny l nz oa">const apiUrl = `https://jsonplaceholder.typicode.com/users`;<br/>function getApi() {<br/>  return fetch(apiUrl, {<br/>      method: 'GET',<br/>      headers: {<br/>          'Content-Type': 'application/json',</span><span id="95d7" class="nw lm it nr b gy ob ny l nz oa">      }<br/>  }).then(response =&gt; response.json())<br/>    .catch((error) =&gt; {throw error})<br/>}</span><span id="04e3" class="nw lm it nr b gy ob ny l nz oa">function* fetchUsers(action) {<br/>   try {<br/>      const users = yield call(getApi);<br/>      yield put({type: 'GET_USERS_SUCCESS', users: users});<br/>   } catch (e) {<br/>      yield put({type: 'GET_USERS_FAILED', message: e.message});<br/>   }<br/>}</span><span id="20f4" class="nw lm it nr b gy ob ny l nz oa">function* userSaga() {<br/>   yield takeEvery('GET_USERS_REQUESTED', fetchUsers);<br/>}</span><span id="89b6" class="nw lm it nr b gy ob ny l nz oa">export default userSaga;</span></pre><p id="7756" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了，准备好之后，让我们打开<code class="fe no np nq nr b">index.js</code>文件，我们必须创建一个对象来组合我们的传奇，因为我们可能有不止一个。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="adff" class="nw lm it nr b gy nx ny l nz oa">import { all } from 'redux-saga/effects'<br/>import userSaga from './userSaga'</span><span id="a798" class="nw lm it nr b gy ob ny l nz oa">export default function* rootSaga() {<br/>  yield all([<br/>    userSaga(),<br/>  ])<br/>}</span></pre><p id="51b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是应用中间件并在<code class="fe no np nq nr b">store.js</code>文件中运行我们的rootSaga。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="c3cc" class="nw lm it nr b gy nx ny l nz oa">import { createStore, applyMiddleware, compose } from 'redux';<br/>import createSagaMiddleware from 'redux-saga';<br/>import rootReducer from './reducers/index.js';<br/>import rootSaga from './sagas/index';</span><span id="f006" class="nw lm it nr b gy ob ny l nz oa">const sagaMiddleware = createSagaMiddleware();<br/>const store = compose(<br/>  applyMiddleware(sagaMiddleware),<br/>  window.devToolsExtension &amp;&amp; window.devToolsExtension(),<br/>)(createStore)(rootReducer);</span><span id="dcd6" class="nw lm it nr b gy ob ny l nz oa">sagaMiddleware.run(rootSaga);</span><span id="b70f" class="nw lm it nr b gy ob ny l nz oa">export default store;</span></pre><p id="8568" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很好，现在，我们可以在我们的reducer中做一些改变来监听动作的结果，但是首先，让我们在我们的<code class="fe no np nq nr b">types.js</code>文件中改变和添加新的类型。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="8506" class="nw lm it nr b gy nx ny l nz oa">export const GET_USERS_REQUESTED = 'GET_USERS_REQUESTED';<br/>export const GET_USERS_SUCCESS = 'GET_USERS_SUCCESS';<br/>export const GET_USERS_FAILED = 'GET_USERS_FAILED';</span></pre><p id="0df5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开<code class="fe no np nq nr b">reducer\user.js</code>文件，让我们更新减速器和初始状态。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="4c4b" class="nw lm it nr b gy nx ny l nz oa">const initialState = {<br/>  users: [],<br/>  loading: false,<br/>  error: null,<br/>}</span><span id="c517" class="nw lm it nr b gy ob ny l nz oa">export default function users(state = initialState, action) {<br/>  switch (action.type) {<br/>    case type.GET_USERS_REQUESTED:<br/>      return {<br/>        ...state,<br/>        loading: true,<br/>      }<br/>    case type.GET_USERS_SUCCESS:<br/>      return {<br/>        ...state,<br/>        loading: false,<br/>        users: action.users<br/>      }<br/>    case type.GET_USERS_FAILED:<br/>      return {<br/>        ...state,<br/>        loading: false,<br/>        error: action.message,<br/>      }<br/>    default:<br/>      return state<br/>  }<br/>}</span></pre><p id="df63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们的reducer中有错误和加载属性。当API调用开始时，我们可以打开加载器，让用户知道发生了什么。</p><p id="617c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们转到actions文件夹中的<code class="fe no np nq nr b">user.js</code>文件，更改动作的类型。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="81a7" class="nw lm it nr b gy nx ny l nz oa">export function getUsers() {<br/>  return {<br/>    type: type.GET_USERS_REQUESTED,<br/>  }<br/>}</span></pre><p id="23e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于这些变化，我们需要在我们的<code class="fe no np nq nr b">UsersComponent.jsx</code>文件中应用一些变化。</p><pre class="mo mp mq mr gt ns nr nt nu aw nv bi"><span id="40bc" class="nw lm it nr b gy nx ny l nz oa">const Users = () =&gt; {<br/>  const dispatch = useDispatch();<br/>  const users = useSelector(state =&gt; state.users.users);<br/>  const loading = useSelector(state =&gt; state.users.loading);<br/>  const error = useSelector(state =&gt; state.users.error);</span><span id="5b43" class="nw lm it nr b gy ob ny l nz oa">  useEffect(() =&gt; {<br/>    dispatch(getUsers());<br/>  }, [])</span><span id="1451" class="nw lm it nr b gy ob ny l nz oa">  return (<br/>    &lt;&gt;<br/>      {users.loading &amp;&amp; &lt;p&gt;Loading...&lt;/p&gt;}<br/>      {users.length === 0 &amp;&amp; !loading &amp;&amp; &lt;p&gt;No users available!&lt;/p&gt;}<br/>      {error &amp;&amp; !loading &amp;&amp; &lt;p&gt;{error}&lt;/p&gt;}<br/>      {users.length &gt; 0 &amp;&amp; users.map((user) =&gt; (<br/>        &lt;Card key={user.id} user={user} /&gt;<br/>      ))}<br/>    &lt;/&gt;<br/>  )<br/>}</span></pre><p id="2446" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了，让我们看看应用程序是否正常工作！</p><h1 id="af5d" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">结果</h1><p id="8875" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">当您打开应用程序和开发人员工具时，您将看到请求动作首先被启动，然后reducer将加载更改为真。当呼叫准备好时，应该发生成功动作，并且数据应该显示在屏幕上。</p><p id="36a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是它给我的样子。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/e47cf9109c86e74175afd95859fce5db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_zOWh6KL4eehbeMwppEUQ.png"/></div></div></figure><h1 id="7ce5" class="ll lm it bd ln lo mu lq lr ls mv lu lv lw mw ly lz ma mx mc md me my mg mh mi bi translated">结论</h1><p id="5d07" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">恭喜你！您刚刚使用Redux和sagas中间件创建了一个ReactJS应用程序。</p><p id="cab5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，您可以了解什么是应用程序状态，为什么状态管理库在某些情况下是一个好的解决方案，以及如何在ReactJS应用程序中设置Redux。除此之外，您还可以了解什么是中间件，以及为什么我们需要使用ReactJS和Redux。我们也对比了<code class="fe no np nq nr b">redux-thunks</code>和<code class="fe no np nq nr b">redux-saga</code>。</p><p id="6844" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请告诉我们你更喜欢你的应用中的哪种解决方案。</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oo"><img src="../Images/569b5629b61c6fc38ef667df4b6cb018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmTcuUeaGsAJSDedBMBgTA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www.duomly.com" rel="noopener ugc nofollow" target="_blank"> Duomly —编程在线课程</a></figcaption></figure><p id="0c81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读，<br/>安娜</p></div></div>    
</body>
</html>