<html>
<head>
<title>4 Strategies for Incrementally Migrating from VMs to Kubernetes using an API Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用API网关从虚拟机增量迁移到Kubernetes的4种策略</h1>
<blockquote>原文：<a href="https://itnext.io/4-strategies-for-incrementally-migrating-from-vms-to-kubernetes-using-an-api-gateway-a82fb6029177?source=collection_archive---------7-----------------------#2019-09-23">https://itnext.io/4-strategies-for-incrementally-migrating-from-vms-to-kubernetes-using-an-api-gateway-a82fb6029177?source=collection_archive---------7-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="ae3a" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">应用现代化</h2><div class=""/><div class=""><h2 id="361a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">规划和实施从虚拟机到云原生平台迁移的策略</h2></div><p id="d9f3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">越来越多的组织正在从由虚拟机(VM)组成的数据中心迁移到围绕Docker和Kubernetes等容器技术构建的“下一代”云原生平台。然而，由于这种迁移固有的复杂性，迁移不会在一夜之间发生。相反，一个组织通常会运行一个混合的多基础设施和多平台环境，其中应用程序跨虚拟机和容器。从系统边缘开始迁移，使用云原生API网关提供的功能，并向内朝应用程序迁移，这提供了几种策略来最小化痛苦和风险。</p><p id="33fd" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在Datawire Ambassador博客上最近发表的文章系列中，提出了与这种迁移的规划和实现相关的四种策略:<a class="ae lk" href="https://blog.getambassador.io/routing-in-a-multi-platform-data-center-from-vms-to-kubernetes-via-ambassador-47bbe658683c" rel="noopener ugc nofollow" target="_blank">部署多平台服务发现系统</a>，该系统能够在高度动态的环境中有效地路由；<a class="ae lk" href="https://blog.getambassador.io/incremental-app-migration-from-vms-to-kubernetes-planning-and-tactics-5ffc18c151e" rel="noopener ugc nofollow" target="_blank">调整您的持续交付渠道</a>以利用最佳实践，避免网络复杂性带来的隐患；使用<a class="ae lk" href="https://blog.getambassador.io/part-3-incremental-app-migration-from-vms-to-kubernetes-ambassador-and-consul-aacf87eea3e8" rel="noopener ugc nofollow" target="_blank">流量转移来促进增量</a>和安全迁移；<a class="ae lk" href="https://blog.getambassador.io/part-4-incremental-app-migration-from-vms-to-kubernetes-implementing-end-to-end-transport-f597e5536393" rel="noopener ugc nofollow" target="_blank">通过加密和网络分段保护您的基础设施</a>从最终用户到服务的所有流量。</p><figure class="lm ln lo lp gt lq gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi ll"><img src="../Images/88607fb74ec02c7fdbddac5c7e1c2dce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cI6bRLwPoMfaOVxQ.png"/></div></div></figure><h1 id="9058" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">策略1:部署多平台服务发现系统</h1><p id="b46c" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">在迁移到云和容器的过程中，通常会看到现有应用被分解为服务，新系统使用微服务架构风格进行设计。业务功能通常是通过一个API提供的，该API由一个或多个服务的协作提供支持，因此这些组件需要能够<a class="ae lk" href="https://blog.getambassador.io/routing-in-a-multi-platform-data-center-from-vms-to-kubernetes-via-ambassador-47bbe658683c" rel="noopener ugc nofollow" target="_blank">相互定位和通信</a>。</p><p id="d4ef" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在多平台和多云环境中，存在两类挑战:</p><ul class=""><li id="2909" class="mu mv iq kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">跨一系列不同的平台和基础设施有效地路由流量，包括多个Kubernetes集群。</li><li id="1a15" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">持续更新部署在动态调度的容器运行时(如Kubernetes)中的服务的位置，并运行在(短暂的)商用云基础设施上。</li></ul><p id="0702" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">系统边缘是解决这两个挑战的好地方，因为所有用户流量都通过某种形式的网关或代理堆栈，并可以相应地进行路由。例如，使用一个<a class="ae lk" href="https://blog.getambassador.io/routing-in-a-multi-platform-data-center-from-vms-to-kubernetes-via-ambassador-47bbe658683c" rel="noopener ugc nofollow" target="_blank"> API网关与一个多平台服务发现解决方案</a>的组合。</p><h1 id="7b82" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">策略2:调整您的持续交付渠道</h1><p id="213a" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">一个组织不能指望在一夜之间<a class="ae lk" href="https://blog.getambassador.io/incremental-app-migration-from-vms-to-kubernetes-planning-and-tactics-5ffc18c151e" rel="noopener ugc nofollow" target="_blank">将他们现有的应用</a>迁移到一个新的平台上。在典型的现有传统/遗产堆栈中，存在太多移动部件和太多复杂性。任何迁移都需要以渐进的方式进行规划和实施，构建和部署应用程序的最佳实践<a class="ae lk" href="https://blog.getambassador.io/incremental-app-migration-from-vms-to-kubernetes-planning-and-tactics-5ffc18c151e" rel="noopener ugc nofollow" target="_blank">被编码到一个连续的交付管道中</a>。</p><p id="1549" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">支持交付渠道适应多平台和多云的关键要求:</p><ul class=""><li id="c378" class="mu mv iq kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">能够按需为问答创建和初始化Kubernetes集群，并能够将流量动态路由到这些集群。</li><li id="35ec" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">能够启动迁移的应用程序进行自动验证，在类似生产(或理想的生产)的环境中运行，而不会将应用程序暴露给最终用户。</li><li id="2cf7" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">支持在新平台上逐步推出功能。理想情况下，可以转移或拆分客户流量，以允许少量用户由运行在新基础架构上的应用程序提供服务，因为这将允许迁移的低风险验证。</li></ul><p id="1ea3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">解耦新功能的部署和发布是连续交付的基础部分，通常这个<a class="ae lk" href="https://blog.getambassador.io/continuous-delivery-how-can-an-api-gateway-help-or-hinder-1ff15224ec4d" rel="noopener ugc nofollow" target="_blank">的实现从边缘</a>开始。</p><h1 id="484d" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">策略3:使用流量转移来促进安全的增量迁移</h1><p id="13b1" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">一旦组织内部制定并同意了迁移计划，就必须实施该计划。进行迁移的有效策略是在新平台(例如Kubernetes)上部署API网关，并使用该API网关将流量路由到现有平台。这种策略允许操作员和工程师熟悉新的目标环境，但不需要实施应用程序从一个平台到另一个平台的“大爆炸”式迁移。一旦部署了API网关，该网关就可以用于<a class="ae lk" href="https://blog.getambassador.io/part-3-incremental-app-migration-from-vms-to-kubernetes-ambassador-and-consul-aacf87eea3e8" rel="noopener ugc nofollow" target="_blank">逐渐将流量从现有应用转移到新服务</a>。</p><p id="661a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">增量迁移应用程序和流量路由时所需的功能:</p><ul class=""><li id="5f13" class="mu mv iq kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">入口(南北向)流量路由的分散式自助配置，使产品、API和应用团队能够独立规划和实施其迁移。</li><li id="7124" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">使用金丝雀释放路由和流量阴影等功能实现流量转移的能力。</li><li id="bced" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">支持跨多种基础设施类型(和云)、平台和集群路由服务到服务(东西向)流量。仅在Kubernetes内路由东西向流量的能力不支持这种增量迁移方法。</li><li id="6da2" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">为流量管理提供集中配置的“sane默认值”的能力，例如全球实施传输加密的要求(包括最低TLS版本)、通过第三方IDP的身份验证以及防止DDoS攻击的速率限制。</li></ul><p id="b949" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">使用服务网格来实现高级流量路由正成为一种流行的方法。值得一提的是，虽然乍看起来很相似，但是<a class="ae lk" href="https://blog.getambassador.io/api-gateway-vs-service-mesh-104c01fa4784" rel="noopener ugc nofollow" target="_blank"> API网关和服务网格面向不同的用例，并且具有不同的需求</a>。</p><h1 id="84c2" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">策略4:通过加密和网络分段保护您的基础设施</h1><p id="172c" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">在软件交付中实现安全性是一个非常重要的话题，也是一个相当大的话题，但是在迁移到新平台的过程中，理解的重要性只会增加。从设计到编码和打包(包括依赖关系管理)，最终到部署和操作，在流程的所有级别设计安全性是必不可少的。在运行时级别，实施深度防御至关重要。作为任何迁移的一部分，跨基础设施和平台的流量必须是安全的。任何实施都应该包括在边缘适当使用<a class="ae lk" href="https://blog.getambassador.io/implementing-authentication-with-the-ambassador-api-gateway-oauth-idps-oidc-oh-my-26a1a6d77bb3" rel="noopener ugc nofollow" target="_blank">用户认证，以及对来自边缘和服务之间的流量进行加密。</a></p><p id="2658" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">多平台迁移的安全要求包括:</p><ul class=""><li id="c3db" class="mu mv iq kq b kr ks ku kv kx mw lb mx lf my lj mz na nb nc bi translated">能够向任何目标基础架构、云和平台部署和管理传输加密组件(并能够定期轮换相关证书)。</li><li id="503c" class="mu mv iq kq b kr nd ku ne kx nf lb ng lf nh lj mz na nb nc bi translated">API网关(执行用户身份验证)能够与服务到服务的传输安全紧密集成的能力，确保从边缘流向服务的流量在加密方面没有间隙。</li></ul><p id="c63c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如前所述，部署服务网格正在成为实现端到端传输安全的常用方法。由于这种实践和相关技术相对较新，工程师们在任何增量迁移过程中“<a class="ae lk" href="https://www.cncf.io/webinars/securing-cloud-native-communication/" rel="noopener ugc nofollow" target="_blank">注意间隙</a>，并且在实现中的漏洞或裂缝期间不意外地暴露用户流量是很重要的。</p><h1 id="73f4" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">包扎</h1><p id="4a5a" class="pw-post-body-paragraph ko kp iq kq b kr mp ka kt ku mq kd kw kx mr kz la lb ms ld le lf mt lh li lj ij bi translated">本系列文章和<a class="ae lk" href="https://github.com/datawire/pro-ref-arch" rel="noopener ugc nofollow" target="_blank">相关的多平台代码/配置</a>示例旨在帮助平台运营商和工程师将应用从虚拟机迁移到Kubernetes。如前所述，迁移不是一项简单的工作，重要的是要相应地进行规划，并安全地逐步实施。</p><p id="94f3" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">示例代码在不断发展，因此如果您对云供应商或复杂的路由场景有任何特殊要求，请联系Datawire团队。</p><p id="42db" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">像往常一样，可以通过Twitter(<a class="ae lk" href="https://www.twitter.com/getambassadorio" rel="noopener ugc nofollow" target="_blank">@ getambassadorio</a>)或<a class="ae lk" href="http://d6e.co/slack" rel="noopener ugc nofollow" target="_blank"> Datawire OSS Slack </a>提问。</p></div></div>    
</body>
</html>