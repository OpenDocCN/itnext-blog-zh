<html>
<head>
<title>Run C# natively in the browser through the web assembly via mono-wasm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过mono-wasm在浏览器中通过web程序集本地运行C#</h1>
<blockquote>原文：<a href="https://itnext.io/run-c-natively-in-the-browser-through-the-web-assembly-via-mono-wasm-60f3d55dd05a?source=collection_archive---------0-----------------------#2019-12-09">https://itnext.io/run-c-natively-in-the-browser-through-the-web-assembly-via-mono-wasm-60f3d55dd05a?source=collection_archive---------0-----------------------#2019-12-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="955f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用c#-Mono Wasm增强您的前端应用</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f5326e9c1b8833e74e8fc0aa32958053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fBXFYn5eORJCF8p6Z0gWpA.png"/></div></div></figure><blockquote class="ku kv kw"><p id="c959" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">WebAssembly(缩写为<em class="it"> Wasm </em>)是一种基于堆栈的虚拟机的二进制指令格式。Wasm被设计为C/C++/Rust等高级语言编译的可移植目标，支持客户端和服务器应用程序在web上的部署。<br/>——【https://webassembly.org/ T4】</p></blockquote><p id="5eb2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">我们都听说过WASM、能力和可能性。其他语言和运行时，如Rust，都有它们在浏览器和。NET，官方唯一的办法就是使用<a class="ae lu" href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor" rel="noopener ugc nofollow" target="_blank"> Blazor </a>这是一个前端框架。</p><p id="168d" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">Blazor很好，但它是开发整个前端应用程序的完整包。如果我喜欢用。我的旧JS应用程序中的. NET库已经在生产中了吗？</p><p id="51cc" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">大约两年前，我在Mono网站上读到一篇关于mono-wasm的文章。他们展示了他们所取得成就的巨大可能性。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/75a169ab9b1d66b6ee649c1e20d1be94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X_CGs2339VMe7IphAArLSA.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">单幅和幅装配的第一个例子之一</figcaption></figure><p id="877a" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">差不多两周前，我在<a class="ae lu" href="https://www.linkit.nl/" rel="noopener ugc nofollow" target="_blank"> LINKIT </a>做了一次关于 WebAssembly的<a class="ae lu" href="https://github.com/0x414c49/wasm-blazor-lecture" rel="noopener ugc nofollow" target="_blank">内部演讲。我想向人们展示如何在没有Blazor的情况下在浏览器中运行他们的代码，所以我询问了像Steve Sanderson、Miguel de Icaza和Scott Hanselman这样的人。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="47d4" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">一个小时后，我能够编译和运行。NET在浏览器里面。由于这个过程没有正式的文档，我决定写一篇关于它的文章。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="8bce" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">我们开始吧！😱</p><h2 id="714b" class="mm mn it bd mo mp mq dn mr ms mt dp mu lv mv mw mx lw my mz na lx nb nc nd ne bi translated">要求</h2><ol class=""><li id="a6fe" class="nf ng it la b lb nh le ni lv nj lw nk lx nl lt nm nn no np bi translated">在您的操作系统上下载并安装Mono SDK。你可以在这里找到不同操作系统的下载和安装程序。</li><li id="b767" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt nm nn no np bi translated">安装后，确保您可以在终端中直接访问<strong class="la iu">csc.exe</strong>和<strong class="la iu">单声道</strong>。如果它们不在环境路径中，在其中添加一个到mono的bin目录的路径。</li><li id="64b4" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt nm nn no np bi translated">在这里获得mono wasm 的最新成功构建。下载并解压缩。用<code class="fe nv nw nx ny b">sdks/wasm/mono-wasm-###########.zip</code>指定的zip文件。</li><li id="9534" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt nm nn no np bi translated">(可选)web服务器或简单的CLI静态文件服务器，如<strong class="la iu"> python http-server </strong>或<a class="ae lu" href="https://github.com/natemcmaster/dotnet-serve" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">dotnet-serve</strong></a><strong class="la iu"/>本地托管您的站点<strong class="la iu">。</strong></li></ol><p id="d03e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">为了便于运行和编译C#代码，克隆或下载这个库:</p><div class="nz oa gp gr ob oc"><a href="https://github.com/0x414c49/mono-wasm-example" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">0x 414 c 49/mono-wasm-示例</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">一个在浏览器中运行C#的简单例子，以及如何用mono-wasm编译代码</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><p id="cfbe" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">在示例中，我创建了一个非常简单的CSharp类，它包含两个静态方法。我们将使用这个类来演示如何运行这个项目。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f170dea59be315b21b3233a53a96003a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUVkwRnSkwWSWPJLlxbfZg.png"/></div></div></figure><p id="6faf" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">首先，我们需要将代码编译成。NET程序集。这可以用单声道或。NET官方<strong class="la iu"> csc </strong> (CSharp编译器)。在运行<code class="fe nv nw nx ny b">csc</code>来编译代码之前，你需要定义一个名为$ WASM SDK的变量，这个变量应该包含mono-wasm SDK的路径。</p><pre class="kj kk kl km gt or ny os ot aw ou bi"><span id="b42b" class="mm mn it ny b gy ov ow l ox oy">$WASM_SDK="path to mono-wasm sdk"</span><span id="a61a" class="mm mn it ny b gy oz ow l ox oy"># for eg:<br/># $WASM_SDK="D:\WasmSDK\"<br/># DONT FORGET THE TRAILING SLASH</span></pre><p id="d56e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">然后你可以在<code class="fe nv nw nx ny b">example</code>文件夹中运行下面的命令来编译你的代码。</p><pre class="kj kk kl km gt or ny os ot aw ou bi"><span id="ea2e" class="mm mn it ny b gy ov ow l ox oy">csc /target:library -out:Example.dll /noconfig /nostdlib /r:$WASM_SDK/wasm-bcl/wasm/mscorlib.dll /r:$WASM_SDK/wasm-bcl/wasm/System.dll /r:$WASM_SDK/wasm-bcl/wasm/System.Core.dll /r:$WASM_SDK/wasm-bcl/wasm/Facades/netstandard.dll /r:$WASM_SDK/wasm-bcl/wasm/System.Net.Http.dll /r:$WASM_SDK/framework/WebAssembly.Bindings.dll /r:$WASM_SDK/framework/WebAssembly.Net.Http.dll Example.cs</span></pre><ul class=""><li id="8af2" class="nf ng it la b lb lc le lf lv pa lw pb lx pc lt pd nn no np bi translated">如你所见，用<code class="fe nv nw nx ny b">-out</code>我们定义了程序集的输出名称。</li><li id="d20d" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt pd nn no np bi translated">在命令的末尾，您应该添加想要编译的CSharp文件</li><li id="cd13" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt pd nn no np bi translated">其他程序集位于编译时引用的mono-wasm目录中。</li></ul><p id="242f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">如果您成功编译了代码，<code class="fe nv nw nx ny b">Example.dll</code>汇编应该被创建。然后，您需要为web程序集发布您的程序集:</p><pre class="kj kk kl km gt or ny os ot aw ou bi"><span id="34ee" class="mm mn it ny b gy ov ow l ox oy">mono $WASM_SDK/packager.exe --copy=always --out=./publish --asset=./index.html Example.dll</span></pre><p id="e579" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">这个命令运行<code class="fe nv nw nx ny b">packager.exe</code>,它是Mono的一个工具，发布你的包含所有需求的程序集。在该命令中，<code class="fe nv nw nx ny b">index.html</code>被定义为一个资产，这意味着打包程序将在发布期间复制该文件。</p><p id="bc84" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">打包程序将创建一个名为publish的文件夹，并在其中复制内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/da1ba7a7662e658835038d9f7a067c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98tdlnoauPAhMKrGp3VCog.png"/></div></div></figure><ul class=""><li id="344f" class="nf ng it la b lb lc le lf lv pa lw pb lx pc lt pd nn no np bi translated">index.html</li><li id="cee2" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt pd nn no np bi translated">mono.js、mono-config.js和runtime.js是JavaScript的mono绑定。</li><li id="8033" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt pd nn no np bi translated">mono.wasm就是单声道。web程序集的. NET运行库。</li></ul><p id="051f" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">那什么是托管文件夹呢？如果你看看它的内容，你会看到许多DLL汇编文件，包括Example.dll。</p><p id="dc88" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">现在你可以宿主publish文件夹的例子来看看它是如何工作的，我已经在我的GithubPages上宿主了这里:</p><p id="e353" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated"><a class="ae lu" href="https://0x414c49.github.io/wasm-example/index.html" rel="noopener ugc nofollow" target="_blank">https://0x414c49.github.io/wasm-example/index.html</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/e2b9e9dfeec88a2836867c13a7e2a2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnK_HBMK113aifTywP2lZQ.png"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">示例输出</figcaption></figure><p id="8d0a" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">如果导航到该URL，请打开F12 Web Developer工具并转到网络选项卡。在页面加载之前，你会看到所有的DLL程序集都被下载了！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/9c20d18657d869dc163e7eb0f5b74c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*NKkF-VGcBUr7ip-uD835sA.png"/></div></figure><p id="f283" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">正如你所看到的，在你按下按钮<code class="fe nv nw nx ny b">Run Wasm, Run</code>后，C#代码会在浏览器中用wasm执行，这真的很有趣。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="6a43" class="mm mn it bd mo mp mq dn mr ms mt dp mu lv mv mw mx lw my mz na lx nb nc nd ne bi translated">与JS集成</h2><p id="e95a" class="pw-post-body-paragraph kx ky it la b lb nh ju ld le ni jx lg lv ph lj lk lw pi ln lo lx pj lr ls lt im bi translated">现在你明白了如何在浏览器中执行C#代码，但是如何将它与JavaScript集成在一起呢？</p><p id="8e4b" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">我们有一个类名示例(在Example.cs文件中),它包括两个公共和静态方法:</p><ol class=""><li id="cdd7" class="nf ng it la b lb lc le lf lv pa lw pb lx pc lt nm nn no np bi translated"><strong class="la iu">总和</strong></li><li id="97c5" class="nf ng it la b lb nq le nr lv ns lw nt lx nu lt nm nn no np bi translated"><strong class="la iu">你好</strong></li></ol><p id="1234" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">在我们的示例中，我们演示了如何调用Hello方法，它只是在文本区域中显示一条欢迎消息。如果你在第<a class="ae lu" href="https://github.com/0x414c49/mono-wasm-example/blob/5e314708cf31d3e35dbf238bdbe106e0ba7fd182/example/index.html#L42" rel="noopener ugc nofollow" target="_blank"> 42 </a>行打开<code class="fe nv nw nx ny b">Index.html</code>文件，我绑定了一个静态方法。NET转换为JS变量:</p><pre class="kj kk kl km gt or ny os ot aw ou bi"><span id="ba07" class="mm mn it ny b gy ov ow l ox oy">var execute = Module.mono_bind_static_method("[Example] Example:Hello");</span></pre><p id="29a2" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated"><code class="fe nv nw nx ny b">Module</code>是由<code class="fe nv nw nx ny b">mono.js</code>文件注入页面的对象。这个对象有许多方法，但最有用的方法之一是<code class="fe nv nw nx ny b">mono_bind_static_method</code>。使用此方法，您可以从。NET应用到JS世界，并像执行一个简单的JS函数一样执行它。</p><pre class="kj kk kl km gt or ny os ot aw ou bi"><span id="80bc" class="mm mn it ny b gy ov ow l ox oy">execute("Ali");</span><span id="94a6" class="mm mn it ny b gy oz ow l ox oy">// will return something like:<br/>// Hello Ali, I'm a message from C# and this message generated at 12/9/2019 12:55:13 PM</span></pre><p id="ff74" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">就是这样！这是你开始需要知道的全部。下载<strong class="la iu">WASM SDK</strong>可以查看<a class="ae lu" href="https://github.com/mono/mono/tree/master/sdks/wasm/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> Mono </a>的这个回购。有一些下载<strong class="la iu"> mono-wasm </strong> SDK的指南和网址。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="0c9d" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">Miguel de Icaza 是Mono的创始人和Xamarin的创始人，他让我写一篇关于如何用mono-wasm在浏览器中运行C#的文章，所以这篇文章是献给你的，Miguel！</p><p id="f1c8" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg lv li lj lk lw lm ln lo lx lq lr ls lt im bi translated">所有资料都可以在这里下载:<br/><a class="ae lu" href="https://github.com/0x414c49/mono-wasm-example" rel="noopener ugc nofollow" target="_blank">https://github.com/0x414c49/mono-wasm-example</a></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="9a68" class="mm mn it bd mo mp mq dn mr ms mt dp mu lv mv mw mx lw my mz na lx nb nc nd ne bi translated">如果你喜欢我的文章，请多看看我关于C#的其他文章</h2><ul class=""><li id="3c0c" class="nf ng it la b lb nh le ni lv nj lw nk lx nl lt pd nn no np bi translated"><a class="ae lu" rel="noopener ugc nofollow" target="_blank" href="/hitchhikers-guide-to-the-c-scripting-13e45f753af9">C #脚本的搭便车指南</a></li></ul></div></div>    
</body>
</html>