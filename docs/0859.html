<html>
<head>
<title>Javascript E2E / UI Testing (or how to break up with Selenium and move on)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Javascript E2E / UI测试(或者如何与Selenium分手并继续前进)</h1>
<blockquote>原文：<a href="https://itnext.io/javascript-e2e-ui-testing-or-how-to-brake-up-with-selenium-and-move-on-f991c142079a?source=collection_archive---------4-----------------------#2018-06-10">https://itnext.io/javascript-e2e-ui-testing-or-how-to-brake-up-with-selenium-and-move-on-f991c142079a?source=collection_archive---------4-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8980f66fb3bb5cebdc719311761cb449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJegCwmsHsi31Lq_-Sz2xA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">网络浏览器自动化工具</figcaption></figure><p id="91e7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当你的测试<strong class="ke ir">缓慢、不稳定</strong>并且<strong class="ke ir">忽略</strong>时，你就知道出问题了。我有没有提到<strong class="ke ir">不可维护</strong>和<strong class="ke ir">难写</strong>？最后，设置您的测试环境<strong class="ke ir">有多容易/多难？</strong></p><p id="a31e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">编写测试通常是痛苦和无聊的任务，但我知道我们可以做得更好。所以让我们看看如何在JS中实现它。为了展示JS的威力，我开始评估一些工具。当然，JS生态系统是如此不稳定，当你读完这篇文章时，也许会有新的/闪亮的工具出现(或者没有)。</p><h1 id="2a03" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">操纵木偶的人</h1><p id="f59a" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">有了木偶师，你几乎可以自动化一切。我们可以创建UI测试，运行web scraper，截图，创建pdf，检查代码覆盖率和可视化比较网站。木偶师通过DevTools协议⚡.直接控制Chromium浏览器<br/>困扰我的一件事是当编写UI测试时，我们需要编写大量代码，这使得测试变得冗长(waitForSelector，waitForNavigation，wait and wait some)。不要误会，我们完全掌控，但是要写很多嘈杂的代码可能导致<strong class="ke ir">不可维护的代码</strong>。</p><h1 id="e0ef" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">柏树</h1><p id="c629" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">Cypress在设计时就考虑了测试，它有很好的特性。Cypress通过API控制浏览器，在浏览器中运行代码。网站加载在iframe中，Cypress可以访问真正的DOM元素。Cypress有很好的元素检查、断言模式、执行测试命令的侧边平移和DOM快照。我无法将测试配置为并行运行，所以我只能继续前进。然而，Cypress是一个很好的测试工具。</p><h1 id="c52a" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">然后我就爱上了<a class="ae md" href="https://devexpress.github.io/testcafe/" rel="noopener ugc nofollow" target="_blank"> TestCafe </a></h1><p id="c698" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">所有其他工具都感觉有点笨拙，但是当我开始使用TestCafe时，我感觉我在编写UI测试时拥有了超能力。TestCafe在Node中运行。它使用代理来注入模拟用户动作的脚本，并从那里进行完全控制。</p><p id="de77" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">空谈是廉价的，所以让我给你看看代码。</p><p id="da3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我将使用TodoMVC应用程序，你可以在<a class="ae md" href="https://github.com/fvitas/testcafe-todomvc" rel="noopener ugc nofollow" target="_blank"> github repo </a>上检查测试文件。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c8a1" class="mn lb iq mj b gy mo mp l mq mr">npm i testcafe</span></pre><p id="c03b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我创建了带有页面选择器的类和带有初始页面的fixture:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/b141c3060ad0543125f2a44995d93e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjV4NZIZkIAUFAn7wWBLvQ.png"/></div></div></figure><p id="0984" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用异步await测试看起来如此干净和甜蜜:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/dfd4c8365f812ea8a8ca12c332fe00af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KUJJzzJ5R8NCGa9rGBjJw.png"/></div></div></figure><p id="dac4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">添加npm脚本并运行它，或者在终端中键入:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="79c9" class="mn lb iq mj b gy mo mp l mq mr">"test": "./node_modules/.bin/testcafe chrome tests/"</span></pre><p id="4cd0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们断言删除一个todo:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/a4edeceade5f9a6127eeda1ff61d45ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-3wnSFwA2hTID8MuxZLCZg.png"/></div></div></figure><p id="2a23" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有很多不错的功能，我们可以断言元素有多少个子元素，或者断言元素的css类。就个人而言，我不喜欢nth(0)是从零开始的，因为它是从css :nth-child(1)开始的，但是我喜欢这个函数式api。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/263f5da3521da0150352b95644e42719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2h6TH9OkVTg-wMavr2ZlQ.png"/></div></div></figure><p id="11d5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有了他们漂亮的<a class="ae md" href="https://devexpress.github.io/testcafe/documentation/test-api/actions/" rel="noopener ugc nofollow" target="_blank">动作api </a>，我们可以像真正的用户一样做很多事情:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/01e16464bfee2d8c4ed28b343ae1e562.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bQRupNJXc8YOahbvYOEFnA.png"/></div></div></figure><p id="dc21" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在测试完成所有待办事项:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/21d18a40ab648a1b123d012b2ac31a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-wjrYlRrs_cOIB71Rf6KA.png"/></div></div></figure><p id="6d5e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了让事情变得更简单(不要重复)，我们可以使用for-of循环和await，但是我们必须使用Node 9+:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/608bdc2e24af94745c38202cea26d7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTk0e_vlV0K-xJ84LGogxQ.png"/></div></div></figure><h1 id="a810" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">测试失败的地方</h1><p id="19d8" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">如果断言失败，我们会得到一个非常好的错误消息，包括行号和上下文。在这里，我在测试中犯了错误，只是为了看到这个漂亮输出:</p><div class="me mf mg mh gt ab cb"><figure class="my jr mz na nb nc nd paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/e5958fe04e432c7962fd7466ecb58695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*jMsMw7Gpg_V5BwEwzyGURw.png"/></div></figure><figure class="my jr ne na nb nc nd paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/1b0a2a73a492df65160dd01c7449c4b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*Y48vU7bYeKDfyUf0ILL9Kw.png"/></div></figure></div><h1 id="64b1" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">平行得要命</h1><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/7e215ada3ed4035bf1970123e1542bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xjT2QT1gKz1gvlK_IrfzOA.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">并行运行测试</figcaption></figure><div class="me mf mg mh gt ab cb"><figure class="my jr ng na nb nc nd paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/f3f4efb5593aa72a1d3851c3884f2577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*1jNZLplauflePUlgYLAGaQ.png"/></div></figure><figure class="my jr nh na nb nc nd paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><img src="../Images/ed3d8499dacc9ed860ba92ed3d70b738.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*OxhBHySOwgu8QySELZ4Vkw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk ni di nj nk translated">串行执行(左)与并行执行(右)</figcaption></figure></div><h1 id="f9b9" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">TestCafe CLI选项</h1><p id="c2ca" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated"><strong class="ke ir">跨浏览器支持:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="18a4" class="mn lb iq mj b gy mo mp l mq mr">$ testcafe chrome tests/<br/>$ testcafe firefox tests/<br/>$ testcafe ie tests/<br/>$ testcafe safari tests/<br/>$ testcafe all tests/</span></pre><p id="5a2e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">设备仿真:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="49e9" class="mn lb iq mj b gy mo mp l mq mr">$ <!-- -->testcafe "chrome:emulation:device=iphone 6" tests/</span></pre><p id="0bd7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">无头:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4e01" class="mn lb iq mj b gy mo mp l mq mr">$ <!-- -->testcafe chrome:headless tests/</span></pre><p id="a62a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">测试失败时的截图:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="53b9" class="mn lb iq mj b gy mo mp l mq mr">$ testcafe chrome tests/ <!-- -->--screenshots-on-fails <!-- -->-s screenshots</span></pre><p id="689c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">降低测试速度:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b4c6" class="mn lb iq mj b gy mo mp l mq mr">$ testcafe chrome tests/ <!-- -->--speed <!-- -->0.5</span></pre><p id="419e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">测试失败时调试:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="39c5" class="mn lb iq mj b gy mo mp l mq mr">$ testcafe chrome tests/ <!-- -->--debug-on-fail</span></pre><p id="4773" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">最好的并发性:</strong></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b5e8" class="mn lb iq mj b gy mo mp l mq mr">$ testcafe chrome tests/ <!-- -->--concurrency 8</span></pre><h1 id="f75d" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">排除故障</h1><p id="9ebd" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">因为它是从节点运行的，所以调试testcafe的服务器端版本是用<code class="fe nl nm nn mj b">--inspect</code>或<code class="fe nl nm nn mj b">--inspect-brk</code>运行它，并在测试代码中的任何地方放置<code class="fe nl nm nn mj b">debugger</code>操作符。<br/>客户端版本的调试被放到【test里面，testcafe会暂停执行。另一个客户端版本是运行带有<br/> <code class="fe nl nm nn mj b">--debug-mode</code>标志的testcafe，我们可以手动继续执行测试。</p><h1 id="9763" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">在CI上运行</h1><p id="cb51" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">TestCafe有很棒的<a class="ae md" href="https://devexpress.github.io/testcafe/documentation/recipes/integrating-testcafe-with-ci-systems/" rel="noopener ugc nofollow" target="_blank">流行词文档</a>。当我需要快速和出色的设置时，Travis总是我的第一选择。您可以查看<a class="ae md" href="https://travis-ci.org/fvitas/testcafe-todomvc/builds/390368486" rel="noopener ugc nofollow" target="_blank">作业日志</a>了解我最近的测试执行情况。这是travis.yml:</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/0ba4459b348c61b2d81478b369301275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TlE58DN477a5BUn3BddyVA.png"/></div></div></figure><h1 id="3dbf" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><figure class="me mf mg mh gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/6275717b7bf8c4b2b4171a4b08cfc78c.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*9skw8tSuimBoaWrONOlWbg.png"/></div></figure><p id="6250" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">遵循测试金字塔，不要写太多的UI测试，他们应该验证一些用户流。写得足够让你对自己的申请充满信心。</p><p id="8554" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">希望你喜欢它，TestCafe是一个非常棒的工具，它让编写测试变得非常漂亮。</p><p id="5ea1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">喝杯咖啡，检查一下TestCafe文档，写下这些测试☕</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><a href="https://www.buymeacoffee.com/filipvitas"><div class="gh gi nq"><img src="../Images/b770d2531f2dab5c5b502a9ed488d374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1T4tQigcaxxTJza1DG_sGw.png"/></div></a></figure></div></div>    
</body>
</html>