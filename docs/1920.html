<html>
<head>
<title>Performance optimized JS architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">性能优化的JS架构</h1>
<blockquote>原文：<a href="https://itnext.io/performance-optimized-js-architecture-e95241d061f?source=collection_archive---------2-----------------------#2019-02-24">https://itnext.io/performance-optimized-js-architecture-e95241d061f?source=collection_archive---------2-----------------------#2019-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="37c2" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">TL；大卫:我最近更新了我的<a class="ae kp" href="https://activenode.de" rel="noopener ugc nofollow" target="_blank">投资组合</a>，应用了许多与绩效相关的技术。这是关于我用来实现更好的加载和压缩行为的技术。使用的工具:TS，Shell，terserJS，ImageOptim，SQIP，filewatcher，SASS，网络节流，DevTools。我的页面在Google Pagespeed上的平均表现被评为<strong class="jt ir"> 99/100 </strong>。我还在计算最后的位数，以得到100/100的总数。</p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/9ac05adea3532a0cb03abf3d99248ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFf2mDXgVxcvSXCtX3riXw.png"/></div></div></figure><p id="14f5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">首先，我想指出，在过去16年的编码生涯中，我只对一件事感兴趣:<strong class="jt ir">不要成为一个狂热分子，也不要贬低任何技术。</strong>没有所谓的<em class="js">适合所有情况。</em>这两篇文章隐喻了我所说的:<a class="ae kp" href="https://medium.com/chingu/using-the-chrome-devtools-audit-feature-to-measure-and-optimize-performance-part-1-868a20bbfde8" rel="noopener">这个</a>和<a class="ae kp" href="https://medium.com/javascript-scene/the-typescript-tax-132ff4cb175b" rel="noopener">这个</a>。</p><p id="d628" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><strong class="jt ir">好的</strong>，既然我们已经讨论过了这个问题，我们可能可以跳过技术狂热者的讨论以及像<em class="js">“你为什么不[把你想要的东西放在这里]…”这样的辩解。</em></p><p id="3d17" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我的要求很简单:</p><blockquote class="jn jo jp"><p id="489a" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">我的作品集应该准备好在预期的等待时间内在一部有GPRS连接的手机上被浏览——EWT。</p></blockquote><h2 id="50dd" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">WTF是<em class="ly">预期等待时间</em>？</h2><p id="93bb" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">如果你周六下午1点去宜家，你可能会对等30分钟才到收银台感到恼火，但与此同时，这正是你可以期待和计划的——我把这个时间跨度称为EWT。</p><p id="4dca" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">拿如今的<em class="js">任何一个</em>网站来说。我想说——除了Google start page——你可能不会在合理的时间内去任何地方。你希望它加载，但它甚至没有出现，所以EWT没有实现(你可能希望它需要30秒，但没有等待一分钟，只看到一个空白的屏幕——是啊，谢谢什么也没有)。</p><p id="a52f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我并不期望<strong class="jt ir"> <em class="js">的任何东西</em> </strong>都能与GPRS和2G兼容。然而，我希望至少能告诉我“连接不良”。请稍后再试”。完全没问题。</p><p id="22c2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我的投资组合的GPRS EWT总计为20秒，因为我觉得这是一个时间跨度，当我意识到我目前处于最差的连接状态，并且我可以看到事情仍然开始加载时，我实际上会等待。</p><p id="8a5a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">现在这是关于建立基础。</p><h1 id="a768" class="me lg iq bd lh mf mg mh lk mi mj mk ln ml mm mn lq mo mp mq lt mr ms mt lw mu bi translated">让我们深入了解这些技术:</h1><h2 id="7c76" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">1.package.json:</h2><blockquote class="jn jo jp"><p id="6bed" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">如果你只关心性能部分，你可以跳过第一和第二部分。</p></blockquote><p id="594c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">我安装了2个<code class="fe mv mw mx my b"><a class="ae kp" href="https://github.com/DefinitelyTyped/DefinitelyTyped" rel="noopener ugc nofollow" target="_blank">@types</a></code>包，这样我的编辑器和编译器可以帮助我进行正确的类型提示。</p><p id="87ae" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><code class="fe mv mw mx my b"><a class="ae kp" href="https://www.browsersync.io/" rel="noopener ugc nofollow" target="_blank">browser-sync</a></code>用于运行具有节流功能的即时实时重载服务器(详见下文)。</p><p id="71ac" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">有了<code class="fe mv mw mx my b">filewatcher</code>,我可以在文件改变时重新编译。使用<code class="fe mv mw mx my b">html-minifier</code>和<code class="fe mv mw mx my b"><a class="ae kp" href="https://www.npmjs.com/package/terser" rel="noopener ugc nofollow" target="_blank">terser</a></code>，我创建了最小的<code class="fe mv mw mx my b">--production</code>版本，并使用<code class="fe mv mw mx my b"><a class="ae kp" href="https://www.npmjs.com/package/include-tag" rel="noopener ugc nofollow" target="_blank">include-tag</a></code>在没有成熟模板系统的情况下，用简单变量将html包含在html中。</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="a0ba" class="lf lg iq my b gy nd ne l nf ng">{<br/> "devDependencies": {<br/>   "@types/es6-promise": "^3.3.0",<br/>   "@types/node": "^10.0.3", <br/>   "browser-sync": "^2.24.4",<br/>   "browser-sync-spa": "^1.0.3",<br/>   "filewatcher": "^3.0.1",<br/>   "html-minifier": "^3.5.21",<br/>   "include-tag": "^1.1.0",<br/>   "node-sass": "^4.9.0",<br/>   "sass": "^1.3.1",<br/>   "terser": "^3.14.1",<br/>   "typescript": "^2.8.3"<br/> },</span><span id="5b55" class="lf lg iq my b gy nh ne l nf ng"> "scripts": {<br/>   "build": "./_dev/watch.sh --build-only --prod",<br/>   "watch": "./_dev/watch.sh --watch"<br/> }<br/>}</span></pre><h2 id="eece" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">2.watch.sh:</h2><p id="8c40" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">Shellscript并不令人惊讶。它运行<code class="fe mv mw mx my b">filewatcher</code>、<code class="fe mv mw mx my b">typescript</code>等。根据旗帜来看。例如:</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="e161" class="lf lg iq my b gy nd ne l nf ng">echo 'Starting TS watcher'<br/>./node_modules/.bin/tsc $WATCH_PARAM -p ./tsconfig.json</span></pre><h2 id="865c" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">3.JS架构和构建:</h2><p id="45d4" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">这是一个小的投资组合，所以我想要一个JS包，我不想用魔法使事情过于复杂。这是我使用TypeScript的两个原因之一。TS编译器允许你构建捆绑包，而<code class="fe mv mw mx my b">tsconfig.json</code>让我选择构建目标，所以我甚至不用考虑捆绑系统，同时仍然能够构建我的文件——滥用TypeScript作为构建系统是很棒的❤️.</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="e837" class="lf lg iq my b gy nd ne l nf ng">/// &lt;reference path='history.ts' /&gt;<br/>/// &lt;reference path='work.controller.ts' /&gt;<br/>/// &lt;reference path='routes.ts' /&gt;<br/>/// &lt;reference path='breakpointSetups.ts' /&gt;<br/>/// &lt;reference path='scrollwatcher.ts' /&gt;</span><span id="25be" class="lf lg iq my b gy nh ne l nf ng">/**<br/>here goes code from my index.ts file<br/>*/</span></pre><p id="881e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">在每个文件中，我都定义了全局函数和全局变量。为什么？它省去了额外的限定变量范围的闭包函数。如果你害怕这样做，那么只需在编译后将结果代码封装在一个函数中。TypeScript帮助我没有失去概述。</p><p id="7839" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">示例:</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="f956" class="lf lg iq my b gy nd ne l nf ng">//source version index.ts:<br/>const query = (selector: string, rootElem?: HTMLElement) =&gt; {<br/>  return Array.prototype.map.call(<br/>    (rootElem || document).querySelectorAll(selector),<br/>    (d: Element) =&gt; d<br/>  );<br/>};</span></pre><p id="0de5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">为了获得最佳的整体缩小，有必要在多次使用时将所有内容抽象为函数调用(参见上面的<code class="fe mv mw mx my b">query</code>示例)。不要手动调用<code class="fe mv mw mx my b">.querySelector</code>，因为它是不可缩小的对象属性)。</p><h2 id="b86f" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">4.关键和非阻塞JS:</h2><p id="bcea" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">JS的一个关键部分被内联到页面的底部(bottom =确保DOM首先可用)，其余部分像这样加载:</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="e5c0" class="lf lg iq my b gy nd ne l nf ng">var s = document.createElement('script');<br/>s.async = true;<br/>s.defer = true;<br/>s.src = '/index.min.js';<br/>s.onload = function() {<br/>  init_resolve();<br/>};<br/>document.head.appendChild(s);</span></pre><h2 id="b953" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">5.即时图像；延迟加载和LQIP/SQIP:</h2><p id="2e19" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated"><a class="ae kp" href="https://github.com/zouhir/lqip-loader" rel="noopener ugc nofollow" target="_blank"> LQIP </a>(低质量图像占位符)是一种预加载质量极低的图像作为实际图像的占位符并提供基本图像信息(如平均颜色)的方法。<a class="ae kp" href="https://www.npmjs.com/package/sqip" rel="noopener ugc nofollow" target="_blank"> SQIP </a>是其仅使用SVG的继任者。</p><p id="45fc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated"><code class="fe mv mw mx my b">sqip inputImage</code>将输出一个具有<code class="fe mv mw mx my b">data:image/svg+base64</code>清晰度的<code class="fe mv mw mx my b">&lt;img&gt;</code>，其大小约为1-2kb，与100kb以上的原始图像相比，可以很容易地内联。</p><p id="687c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">然后，您只延迟加载实际的可见区域。例如，当用户浏览我的预览时，很有可能用户将首先看到低质量图像，同时在JS中请求原始图像，然后淡入。🔥</p><h2 id="b398" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">6.内联CSS与HTTP2:</h2><p id="f848" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">最近我经常听到这样的话:HTTP2解决了这个问题。在您同时请求多个资源的情况下，这是真的。但是浏览器不能请求它自己都不知道的东西。我的意思是，如果你从来没有谈论过，你的伴侣怎么会做你最喜欢的菜。</p><p id="62fd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">长话短说:首先加载HTML，然后才是CSS。如果你想改善初始渲染行为，这是不好的。如果可能，内联关键CSS。</p><blockquote class="jn jo jp"><p id="273a" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">对于较大的页面，不要内联所有的CSS。认为它一定会提高性能，这是一种误解。我试过了，但实际性能下降了。我的灯塔得分也下降了。HTML上额外的解析工作降低了渲染速度。此外，您还需要在每个页面上进行额外的解析工作。因此，重要的是适当地平衡，真正只提供必要的内联CSS。</p></blockquote><h2 id="eb2a" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">7.通过Chrome覆盖工具优化CSS的使用:</h2><p id="0f87" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">在你的页面有所进展之后，你肯定不会记得哪个CSS被实际使用了，哪个没有。</p><p id="0e5b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">使用Chromium的覆盖工具:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ni"><img src="../Images/34d565c7c978427b07037be99457e28c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pGooZRnhlHgW7Kzq-oHCTw.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">在Chrome DevTools中按下⌘ + Shift + P，输入“Coverage”然后回车</figcaption></figure><ol class=""><li id="dc9b" class="nn no iq jt b ju jv jy jz lc np ld nq le nr ko ns nt nu nv bi translated">在Chrome中打开封面抽屉</li><li id="3c2c" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko ns nt nu nv bi translated">按下抽屉内的重新加载图标(确保在重新加载之前您的缓存已被删除！)</li></ol><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/7ed24361454b6de6afb74658a4b7b712.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*RYTS5OV2VuzXtpja1Y7-7Q.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">覆盖率工具中的重新加载图标</figcaption></figure><p id="e716" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">3.单击您想要检查覆盖率的CSS文件。绿线表示使用情况——到目前为止。其他都是红色的。<strong class="jt ir">不过:红色的还没有确认没用过</strong>！</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi oc"><img src="../Images/b797f45c4c90cbe8aff3f2d674f701a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xawsYRfLMyTwp4wMF-0wzQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">只有在重新加载后才第一次瞥见覆盖范围</figcaption></figure><p id="6ee7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">4.您现在需要调整页面的大小，并点击所有的路线，以便覆盖检测器能够完成它的工作。你会看到许多红色的东西突然变成了绿色(<strong class="jt ir">当HTML被渲染时它们变成了绿色，因此相应的CSS被使用</strong>。渲染！=在DOM中。如果它位于DOM中，但是被隐藏了，那么它就不会被渲染。)</p><p id="a395" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">5.彻底完成第4步后，你可能需要检查剩下的红色部分。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi od"><img src="../Images/b78f055155ae9bbdac2b1de416af06a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jk4j7LF6s-zJhX4IJ6w0kw.png"/></div></div></figure><p id="038a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">Chrome可能会告诉你还有很多未使用的字节，但你必须明白，当前的实现将所有未被主动解析的内容显示为红色，并且是绘画的一部分。因此，例如，<code class="fe mv mw mx my b">@media</code>查询的内部可以显示绿色，但是查询本身<code class="fe mv mw mx my b">@media</code>显示红色。<strong class="jt ir">这并不意味着它没用过！</strong>如果你有厂商前缀，也会发生同样的情况。显然，Chrome不会解析Firefox厂商前缀，但这可能仍然是必要的。所以要小心🤓</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/8f85c94324ac651336720ff0e3ee2b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*WUwo0okuy-OS7lnYOqt-wA.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">已解析媒体查询，但查询本身显示为红色。这是覆盖工具的当前行为。</figcaption></figure><p id="ffa6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">6.继续从你的CSS中删除那些被证明是没有被使用的红色的。</p><h2 id="c289" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">8.移动优先？先慢连接！</h2><p id="669c" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">很酷，所以我们首先使用移动设备，但初始加载需要10秒的最佳连接速度，因为我们正在加载像指环王编年史一样大的资产。</p><p id="335f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">因此，称之为移动优先的方法有时会被误解。称之为<em class="js">慢移动优先</em>我们就没事了。</p><p id="8809" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">事实上，你应该首先关心的是感觉到的性能。如果这没问题，那么你甚至可以从统计的角度着眼于提高性能，美化数字。</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><p id="95f8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">Chrome DevTools允许你调节网络速度。这是有帮助的，但它只在Chromium浏览器中工作，而且非常有限。BrowserSync不仅为你的页面建立了一个静态服务器，还为你提供了一个UI来降低速度——服务器级的。所以你可以在每一个浏览器上测试它，特别是你可以慢到GPRS的速度。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi om"><img src="../Images/eda57de32ad9ca0cfb3f694fd3d71e0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*PFkdndlwA18VtACjvIYuqg.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">启动BrowserSync服务器后的终端响应</figcaption></figure><p id="d066" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">你唯一需要做的就是运行<code class="fe mv mw mx my b">browser-sync start --server</code>，它会告诉你静态服务器的URL以及管理服务器设置的UI的URL。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi on"><img src="../Images/bda60254a1ab8920669fe6be931f4d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZasIp8IiTw_xs3xWfFBN2Q.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">在浏览器同步用户界面中以不同的速度启动多台服务器</figcaption></figure><p id="cfba" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">BrowserSync还可以做更多的事情，但是就性能而言，您现在已经准备好测试非常差的连接以及连接之间的感知性能。</p><h2 id="3191" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">9.。htaccess与express:</h2><p id="0abf" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">我倾向于把服务器的责任交给提供商，因为解决问题只需要一个电话。也就是说:我有一个合适的服务器运行着多个采用可配置技术的项目——包括nodejs。所以我本来可以创建一个nodeJS服务器，但是我选择通过<code class="fe mv mw mx my b">.htaccess</code>硬编码路由:</p><pre class="kr ks kt ku gt mz my na nb aw nc bi"><span id="8d7c" class="lf lg iq my b gy nd ne l nf ng">RewriteEngine on<br/>RewriteBase /<br/>RewriteRule ^.*$ index.html</span></pre><p id="6e95" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">这就是应用程序运行所需的所有服务器代码。(我通过对实际路由进行硬编码，将其增强为只响应有效路由)。</p><h2 id="9a0e" class="lf lg iq bd lh li lj dn lk ll lm dp ln lc lo lp lq ld lr ls lt le lu lv lw lx bi translated">10.增强最后的比特</h2><p id="7320" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">运行Lighthouse(或简单地运行Pagespeed Insights)，检查建议并跟进。例如，我发现我在页面中包含了一种字体，我在最开始的时候尝试过，但后来它只是停留在代码中而没有被使用。通过删除这些代码，我在移动性能上得到了2分(从97分到99分)。</p><h1 id="c4c2" class="me lg iq bd lh mf mg mh lk mi mj mk ln ml mm mn lq mo mp mq lt mr ms mt lw mu bi translated">结论:</h1><p id="79c1" class="pw-post-body-paragraph jq jr iq jt b ju lz jw jx jy ma ka kb lc mb ke kf ld mc ki kj le md km kn ko ij bi translated">我没有纳入所有可能的提高性能的解决方案，仍然得到了梦想的速度性能排名。你可能会提出这样的论点:页面本身很小，因此更容易获得好的性能排名。我承认这一点，但请考虑以下两点:</p><ol class=""><li id="2ac1" class="nn no iq jt b ju jv jy jz lc np ld nq le nr ko ns nt nu nv bi translated">如果你不专注于提高性能，也很容易让一个小页面变得非常慢，在<a class="ae kp" href="https://developers.google.com/web/tools/lighthouse/" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>上得到不好的结果</li><li id="d5df" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko ns nt nu nv bi translated">在所有可用于提高性能的工具中，我只加入了很少但有效的一部分</li></ol><p id="618c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lc kd ke kf ld kh ki kj le kl km kn ko ij bi translated">在此基础上可以做很多事情，例如:</p><ul class=""><li id="cf06" class="nn no iq jt b ju jv jy jz lc np ld nq le nr ko oo nt nu nv bi translated">ServiceWorker缓存</li><li id="1963" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko oo nt nu nv bi translated">通过JS创建重复的结构来最小化初始HTML</li><li id="7f20" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko oo nt nu nv bi translated">自动混淆/最小化类名(强烈建议使用捆绑系统来整合文件的整个上下文),这样可以再次减小HTML的整体大小</li><li id="79f7" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko oo nt nu nv bi translated">增强服务器端头缓存设置</li><li id="2bb6" class="nn no iq jt b ju nw jy nx lc ny ld nz le oa ko oo nt nu nv bi translated">通过<code class="fe mv mw mx my b">&lt;picture&gt;</code>元素提供多种分辨率和文件类型</li></ul></div></div>    
</body>
</html>