<html>
<head>
<title>JavaScript: Zoom like in maps for SVG/HTML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript:像SVG/HTML地图一样缩放</h1>
<blockquote>原文：<a href="https://itnext.io/javascript-zoom-like-in-maps-for-svg-html-89c0df016d8d?source=collection_archive---------2-----------------------#2022-10-31">https://itnext.io/javascript-zoom-like-in-maps-for-svg-html-89c0df016d8d?source=collection_archive---------2-----------------------#2022-10-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/a2c06d8c7fbec54fe7bb12997a745183.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/1*t49LrQa5S4e7hG0cbs1LCA.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><em class="jy">图一。放大dgrm.net流程图编辑器</em></figcaption></figure><p id="1b34" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">【dgrm.net】T2|<a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank">GitHub</a></p><p id="e7f7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如何在<a class="ae kx" href="https://dgrm.net/" rel="noopener ugc nofollow" target="_blank">dgrm.net</a>流程图编辑器中进行缩放。</p><p id="63de" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">你可以缩放</p><ul class=""><li id="d585" class="ky kz iq kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">鼠标滚轮，</li><li id="f6c3" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">触摸屏设备</li><li id="7599" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">两个手指放在手机和平板电脑上。</li></ul><p id="57c1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">一个现成的SVG缩放功能为您的项目包括在内。</p><h1 id="a32f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">缩放算法</h1><p id="0b3e" class="pw-post-body-paragraph jz ka iq kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ij bi translated">SVG和HTML有伸缩性。<a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/scale" rel="noopener ugc nofollow" target="_blank">HTML中的缩放</a>。</p><p id="1dc8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">仅仅改变规模是不够的。图像会滑走。<br/>放大时，屏幕中央的圆圈向右下方滑动。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mp"><img src="../Images/4b011238a104f01d6a39415af1bed5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*S5OIv2aIkXeyZm-DosVSLA.gif"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><em class="jy">图二。错误:放大时，屏幕中心的圆圈向右滑动。</em></figcaption></figure><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mp"><img src="../Images/3daabf02a450f7f1fe3257a489c86461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*od67rAw4UhnH4lKcVcJWTQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><em class="jy">图3。放大时，屏幕中心的圆圈向右滑动—方案。</em></figcaption></figure><p id="98ef" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">黑色矩形是屏幕。蓝色是放大的图像。<br/>放大的圆圈在放大图像的中心，但是已经相对于屏幕滑动。</p><p id="fa02" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">需要缩放和移位，那么图像的中心就不会离开。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mp"><img src="../Images/8ccc428307529eb4051adb0eb417c138.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rmr1qc0GtrivT2FLUe2hOA.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><em class="jy">图4。放大并向左上方移动。圆圈保持在屏幕的中心。</em></figcaption></figure><p id="6042" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在图4中，图像的中心没有滑走。但是地图不是这样工作的。地图没有缩放到中心。地图相对于光标放大。光标所指的地方不会相对于屏幕移动。</p><p id="33c7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">地图中心的建筑倒下了。它以红色突出显示。光标下的建筑保持不变。用蓝色突出显示。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/60aa388188e57d1ebf3b8ed0a361df5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/1*SfEyB89QSwldmLCHWcb0wA.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><em class="jy">图5。地图不是缩放到中心，而是相对于光标。光标所指的地方不会相对于屏幕移动。</em></figcaption></figure><p id="a91d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">缩放功能应该移动图像，使光标下的点保持不变。</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="b394" class="ne ln iq na b gy nf ng l nh ni">/**<br/> * <a class="ae kx" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {SVGGraphicsElement} svgEl<br/> * <a class="ae kx" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {Point} fixedPoint<br/> *                this point will not change position while scale<br/> * <a class="ae kx" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {number} scale<br/> * <a class="ae kx" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {number} nextScale<br/> */<br/>export function svgScale(svgEl, fixedPoint, scale, nextScale) {<br/>    const position = svgPositionGet(svgEl);<br/> <br/>    svgPositionSet(svgEl, {<br/>        x: nextScale / scale * (position.x - fixedPoint.x) +     <br/>           fixedPoint.x,<br/>        y: nextScale / scale * (position.y - fixedPoint.y) + <br/>           fixedPoint.y<br/>    });<br/> <br/>    ensureTransform(svgEl, SVGTransform.SVG_TRANSFORM_SCALE)<br/>        .setScale(nextScale, nextScale);<br/>}</span></pre><p id="6fbd" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="nj">清单1。缩放功能。移动图像，使固定点保持不变。<br/>在</em><a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS/blob/e6d6a13c6294e79058f605ff1609c3f08ee5cf27/src/diagram/infrastructure/svg-utils.js" rel="noopener ugc nofollow" target="_blank"><em class="nj">GitHub</em></a><em class="nj">上有辅助函数svgPositionGet、svgPositionSet、ensureTransform。</em></p><h1 id="33dd" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">使用鼠标滚轮和触摸板缩放</h1><p id="893c" class="pw-post-body-paragraph jz ka iq kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ij bi translated">订阅鼠标滚轮事件“滚轮”。用两个手指在触摸板上挤压没有单独的事件。收缩使用相同的“轮子”事件。</p><p id="e06c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">对于滚轮，刻度以0.25的增量变化，而对于触摸板，刻度以0.05的增量变化。选择这些值，以便:</p><ul class=""><li id="72df" class="ky kz iq kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">鼠标滚轮不需要长时间扭转</li><li id="8aaf" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">触摸板上的图像没有跳动</li></ul><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="7e11" class="ne ln iq na b gy nf ng l nh ni">// 'svg' is type of {SVGSVGElement}<br/>let scale = 1;<br/>// mouse wheel, trackpad pitch<br/>svg.addEventListener('wheel', /** <a class="ae kx" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> {WheelEvent} evt */ evt =&gt; {<br/>    evt.preventDefault();<br/> <br/> <br/>    // calc nextScale<br/> <br/>    const delta = evt.deltaY || evt.deltaX;<br/>    const scaleStep = Math.abs(delta) &lt; 50<br/>        ? 0.05  // touchpad pitch<br/>        : 0.25; // mouse wheel<br/> <br/>    const scaleDelta = delta &lt; 0 ? scaleStep : -scaleStep;<br/>    const nextScale = scale + scaleDelta; // 'scale' is prev scale<br/> <br/> <br/>    // calc fixedPoint<br/>    const fixedPoint = { x: evt.clientX, y: evt.clientY };<br/> <br/> <br/>    // scale<br/>    // 'svgEl' is element to scale<br/>    svgScale(svgEl, fixedPoint, scale, nextScale);<br/>    scale = nextScale;<br/>});</span></pre><p id="adb8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="nj">清单2。订阅鼠标滚轮事件。触摸触摸板触发相同的事件。完整代码参见</em><a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS/blob/e6d6a13c6294e79058f605ff1609c3f08ee5cf27/src/diagram-extensions/scale-feature.js" rel="noopener ugc nofollow" target="_blank"><em class="nj">【GitHub】</em></a><em class="nj">。</em></p><h1 id="e995" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">用两个手指在手机和平板电脑上缩放</h1><p id="c05e" class="pw-post-body-paragraph jz ka iq kb b kc mk ke kf kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw ij bi translated">对于手指缩放，固定点是手指之间的中点。音阶的变化取决于手指间距离的变化。</p><p id="3247" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">您还需要考虑图像可以同时缩放和移动。</p><pre class="mq mr ms mt gt mz na nb nc aw nd bi"><span id="18ad" class="ne ln iq na b gy nf ng l nh ni">// calc nextScale<br/> <br/>// distance between fingers<br/>const distanceNew = Math.hypot(<br/>    firstFinger.x - secondFinger.x,<br/>    firstFinger.y - secondFinger.y);<br/> <br/>// 'distance' is previous distance between fingers<br/>// 'scale' is previous scale<br/>const nextScale = scale / distance * distanceNew;<br/> <br/> <br/>// calc fixedPoint<br/>const fixedPoint = {<br/>    x: (firstFinger.x + secondFinger.x) / 2,<br/>    y: (firstFinger.y + secondFinger.y) / 2<br/>};<br/> <br/> <br/>// scale<br/>// 'svgEl' is element to scale<br/>svgScale(svgEl, fixedPoint, scale, nextScale);<br/>scale = nextScale;<br/> <br/>// don't forget to also move the canvas behind your fingers</span></pre><p id="376a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="nj">清单3。对于手指缩放，固定点是手指之间的中点。音阶的变化取决于手指间距离的变化。完整代码见</em><a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS/blob/e6d6a13c6294e79058f605ff1609c3f08ee5cf27/src/diagram-extensions/scale-feature.js" rel="noopener ugc nofollow" target="_blank"><em class="nj">GitHub</em></a><em class="nj">。</em></p><h1 id="3cb2" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">关于dgrm.net的其他文章</h1><ul class=""><li id="6d19" class="ky kz iq kb b kc mk kg ml kk nk ko nl ks nm kw ld le lf lg bi translated"><a class="ae kx" href="https://medium.com/codex/javascript-svg-diagram-editor-which-weighs-6-5-less-than-bootstrap-open-source-library-b753feaaf835" rel="noopener"> JavaScript SVG图表编辑器3.9 KB(开源库)</a></li><li id="530e" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated"><a class="ae kx" href="https://medium.com/codex/javascript-diagram-editor-that-renders-diagrams-from-png-images-open-source-d1de0f053088" rel="noopener"> JavaScript图表编辑器，从PNG图像(开源)呈现图表</a></li><li id="8fd5" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated"><a class="ae kx" href="https://medium.com/codex/javascript-text-editor-for-svg-6881f670d432" rel="noopener">SVG的JavaScript文本编辑器</a></li><li id="e534" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated"><a class="ae kx" href="https://medium.com/@alexey-boyko/flowchart-editor-ui-a8face0729d0" rel="noopener">流程图编辑器UI </a></li></ul><h1 id="ef5f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">如何支持该项目</h1><ul class=""><li id="cd2a" class="ky kz iq kb b kc mk kg ml kk nk ko nl ks nm kw ld le lf lg bi translated">开始使用流程图编辑器<a class="ae kx" href="https://dgrm.net/" rel="noopener ugc nofollow" target="_blank">Dgrm.net</a>。告诉我你的想法。评论，私信，在<a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。我什么都读，我会保留一份提议清单。</li><li id="b72a" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">告诉你的朋友。</li><li id="5e7f" class="ky kz iq kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">在<a class="ae kx" href="https://github.com/AlexeyBoiko/DgrmJS" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上给个星。</li></ul></div></div>    
</body>
</html>