<html>
<head>
<title>Dockerize Rsyslog server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dockerize Rsyslog服务器</h1>
<blockquote>原文：<a href="https://itnext.io/dockerize-rsyslog-server-f8f9754c37d5?source=collection_archive---------1-----------------------#2019-12-20">https://itnext.io/dockerize-rsyslog-server-f8f9754c37d5?source=collection_archive---------1-----------------------#2019-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="a8bf" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="9649" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本文中，我将解释如何对Rsyslog服务器进行dockerize，并构建一个解耦的、可伸缩的集中式日志记录机制。下面是对Docker和Rsyslog的一个快速介绍</p><p id="0f62" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Rsyslogd :可靠且扩展的syslogd实用程序，为消息日志提供支持。</p><p id="abab" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><a class="ae lo" href="https://docs.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>:集装箱化应用平台</p><h2 id="af52" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">我为什么要容器化Rsyslog服务器？</h2><p id="c44f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">作为开发人员或系统管理员，将所有设备和应用程序的日志传送到中央日志记录设备以解决问题或运行分析非常重要。随着基础设施的增长，日志量也在增加，我们的中央日志记录基础设施应该能够动态扩展和处理负载，同时最大限度地减少或避免停机。当一个应用程序被解耦时，很容易扩展它。</p><h2 id="fb48" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">如何解耦Rsyslog服务器？</h2><p id="a9ef" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我用一个例子来解释这一点，假设我们有3个微服务(前端、后端、API ),我们可以用一组容器运行3个Rsyslog docker服务，并具有高度可用的架构，如下图所示。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mb"><img src="../Images/d8cce1246fd6213774c5418112e1a849.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Da6CYMT7PiSbQRc7uJ5oNQ.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">Rsyslogd微服务架构示例</figcaption></figure><p id="8308" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">另外，请注意，这是解除Rsyslog耦合的方法之一。根据不同的环境，你可以选择最适合的。我在这里的目的是演示我们可以解耦Rsyslog。</p><p id="2827" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">现在让我们进入实现阶段。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h2 id="0d92" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">创建Docker图像。</h2><p id="7511" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建一个名为Dockerfile的文件，并粘贴以下内容。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="a54d" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">构建Docker映像</h2><pre class="mc md me mf gt na nb nc nd aw ne bi"><span id="0adc" class="lp jo iq nb b gy nf ng l nh ni">docker build -t mysyslog .</span></pre><h2 id="ebc6" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">运行容器</h2><pre class="mc md me mf gt na nb nc nd aw ne bi"><span id="c30f" class="lp jo iq nb b gy nf ng l nh ni">docker run  --cap-add SYSLOG --restart always -v /var/log:/var/log -p 514:514 -p 514:514/udp --name rsyslog mysyslog</span></pre><p id="de17" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><em class="nj">命令击穿</em></p><pre class="mc md me mf gt na nb nc nd aw ne bi"><span id="55c5" class="lp jo iq nb b gy nf ng l nh ni">--cap-add SYSLOG --&gt; Allow container to perform privileged syslog(2) operations.<br/>--restart always --&gt; Restart container regardless of the exit status<br/>-v /var/log:/var/log --&gt; Mount host /var/log directory in container /var/log directory <br/>-p 514:514         --&gt; Bind Host TCP 514 port to contaainer TCP 514 port <br/>-p 514:514/udp     --&gt; Bind Host UDP 514 port to contaainer UDP 514 port</span></pre><p id="2a6b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">或者，您可以使用下面的docker-compose.yaml文件并启动Rsyslog服务器。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="1ebf" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">通过运行以下命令启动服务</p><pre class="mc md me mf gt na nb nc nd aw ne bi"><span id="183e" class="lp jo iq nb b gy nf ng l nh ni">docker-compose up -d</span></pre><h2 id="04ce" class="lp jo iq bd jp lq lr dn jt ls lt dp jx kw lu lv kb la lw lx kf le ly lz kj ma bi translated">测试您的系统日志服务器:</h2><p id="4b5c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">找到您的主机的IP地址，并配置您的日志驱动程序。在我的例子中，我运行在IP地址为192.168.0.5的主机上，所以我使用了以下命令。</p><pre class="mc md me mf gt na nb nc nd aw ne bi"><span id="f8de" class="lp jo iq nb b gy nf ng l nh ni">docker run --log-driver syslog --log-opt syslog-address=tcp://192.168.0.5:514 alpine echo hello world</span></pre><p id="1d31" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">导航到/var/log/remote/</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="e405" class="jn jo iq bd jp jq nk js jt ju nl jw jx jy nm ka kb kc nn ke kf kg no ki kj kk bi translated">接下来是什么！</h1><p id="a0a8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">阅读我的另一篇文章<a class="ae lo" href="https://medium.com/@sudheer.chamarthi/run-rsyslog-server-in-kubernetes-bb51a7a6e227" rel="noopener">这里</a>解释了在Kubernetes中运行Syslog服务器</p></div></div>    
</body>
</html>