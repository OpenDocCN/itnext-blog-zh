<html>
<head>
<title>Use Secret Environment Variables in GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GitHub操作中使用秘密环境变量</h1>
<blockquote>原文：<a href="https://itnext.io/use-secret-environment-variables-in-github-actions-38367139bdaf?source=collection_archive---------2-----------------------#2022-07-05">https://itnext.io/use-secret-environment-variables-in-github-actions-38367139bdaf?source=collection_archive---------2-----------------------#2022-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6dcb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为GitHub Actions CI/CD工作流设置受保护的环境变量并不困难。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c32b7ed0a96b69312cacffd9e6b359eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sSipbIELTJLPjycM_8RdA.jpeg"/></div></div></figure><h1 id="92c5" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="354b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">今年早些时候，我和我的开发团队正在构建一个新的开源<a class="ae mf" href="https://github.com/blues/sparrow-starter" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">应用</strong> </a>，以帮助我们的用户更快地使用我所在的物联网(IoT)公司销售的硬件。</p><blockquote class="mg mh mi"><p id="7aa5" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><em class="iq">我在一家名为</em><a class="ae mf" href="https://blues.io/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir"><em class="iq">Blues Wireless</em></strong></a><em class="iq">的物联网初创公司工作，该公司的使命是通过使用</em><a class="ae mf" href="https://blues.io/products/notecard/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank"><em class="iq">note cards</em></a><em class="iq">——可以嵌入任何物联网项目的预付费蜂窝设备，将传感器数据传输到安全的云:</em><a class="ae mf" href="https://notehub.io/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank"><em class="iq">note hub</em></a><em class="iq">——然后可以将数据转发到任何公共云</em></p></blockquote><p id="34cd" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">这个想法是，一旦我们的用户设置了他们的新物联网设备，他们就可以使用我们的starter repo，它已经被设计为接受并在图表和图形中显示某些传感器数据，然后在他们使用新的传感器或数据可视化进一步定制他们的设备时修改代码。</p><p id="0e3d" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">考虑到易于设置和部署，我们使用自包含的<a class="ae mf" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Next.js框架</strong> </a>构建了该应用，在上托管了该应用的演示示例，并使用<a class="ae mf" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">GitHub Actions</strong></a>来控制自动化CI/CD工作流(构建、测试、部署等)。).</p><p id="4730" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">我在使用GitHub Actions时遇到的一件棘手的事情是，如何添加敏感的环境变量，这些变量在本地用于运行应用程序及其集成和端到端测试，同时仍然保持它们的秘密(并且不受GitHub的源代码控制)。</p><p id="ce73" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在本文中，我将教您如何将“秘密”环境变量添加到GitHub Actions工作流中，这样需要动态、敏感变量的步骤(如自动化测试套件)就可以在CI/CD管道中成功运行，就像在本地开发环境中一样。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="e114" class="kr ks iq bd kt ku mz kw kx ky na la lb jw nb jx ld jz nc ka lf kc nd kd lh li bi translated">什么是GitHub Actions？</h1><p id="656f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让我们退后一分钟来讨论GitHub动作，以防您还没有使用它们的需求。</p><p id="a277" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">早在2018年，GitHub发布了一个名为<a class="ae mf" href="https://resources.github.com/downloads/What-is-GitHub.Actions_.Benefits-and-examples.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">的新功能，GitHub Actions </strong> </a>，旨在让开发者能够跨问题、拉请求和其他事件自动化他们的工作流。</p><p id="0169" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">2019年，它还向GitHub Actions引入了<a class="ae mf" href="https://github.blog/2019-08-08-github-actions-now-supports-ci-cd/" rel="noopener ugc nofollow" target="_blank">完全持续集成/持续部署(CI/CD) </a>。</p><p id="b552" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">这些工具使得自动化开发人员如何在任何平台上构建、测试和部署项目变得更加容易，而不需要开发团队中的devops专家。与其他CI/CD工具相比，GH Actions的优势之一是，如果一个repo已经在GitHub中(很可能是这样)，那么设置工作流以自动化的方式处理所有这些类型的任务(以及更多)是非常简单的。</p><blockquote class="mg mh mi"><p id="8d79" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><em class="iq">如果你曾经使用过另一个CI/CD平台，如</em><a class="ae mf" href="https://jenkins.io/" rel="noopener ugc nofollow" target="_blank"><em class="iq">Jenkins</em></a><em class="iq">，</em><a class="ae mf" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"><em class="iq">circle CI</em></a><em class="iq">，</em><a class="ae mf" href="https://www.jetbrains.com/teamcity/" rel="noopener ugc nofollow" target="_blank"><em class="iq">team city</em></a><em class="iq">，或者其他一些工具，一旦你开始使用GitHub Actions，你应该会有类似的感觉。</em></p></blockquote><p id="e440" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">下面是一个简单的CI/CD管道的示例图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ne"><img src="../Images/ac37da76da37ca4298700f3177d2700d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wqkawcVtMhx0J7AdI86EIw.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">持续集成图由<a class="ae mf" href="https://resources.github.com/ci-cd/" rel="noopener ugc nofollow" target="_blank"> GitHub资源提供:CI/CD </a></figcaption></figure><p id="814e" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">深入GH Actions如何工作的所有细节已经超出了这篇博客的范围，但是希望我已经给了你足够好的入门知识来理解我们现在要讨论的内容。</p><h1 id="20fb" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在Repo中，为GH操作设置环境变量</h1><p id="cf62" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">开始为GH操作设置环境变量的地方是在repo本身内部。</p><h2 id="3837" class="nj ks iq bd kt nk nl dn kx nm nn dp lb ls no np ld lw nq nr lf ma ns nt lh nu bi translated">确定要在GitHub中复制的本地环境变量</h2><p id="98d2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我们特定的<a class="ae mf" href="https://github.com/blues/sparrow-starter" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">回购</strong> </a>中，我们有四个动态环境变量是app(及其测试套件)需要运行的:<code class="fe nv nw nx ny b">HUB_BASE_URL</code>、<code class="fe nv nw nx ny b">HUB_AUTH_TOKEN</code>、<code class="fe nv nw nx ny b">HUB_PROJECT_UID</code>和<code class="fe nv nw nx ny b">HUB_PRODUCT_UID</code>，</p><p id="a1e2" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">所有这些变量都与在<a class="ae mf" href="https://notehub.io/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank"> Notehub </a>中发现的独特项目值相关，Notehub是一种云应用，物联网传感器数据通过Notecard交付。</p><ul class=""><li id="e0d2" class="nz oa iq ll b lm mk lp ml ls ob lw oc ma od me oe of og oh bi translated"><code class="fe nv nw nx ny b">HUB_BASE_URL</code>是到达Notehub API获取数据的URL。</li><li id="0ae8" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated"><code class="fe nv nw nx ny b">HUB_AUTH_TOKEN</code>是访问Notehub中的数据所需的授权令牌。</li><li id="2db5" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated"><code class="fe nv nw nx ny b">HUB_PROJECT_UID</code>是发送传感器数据的Notehub中的项目ID。</li><li id="916f" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated"><code class="fe nv nw nx ny b">HUB_PRODUCT_UID</code>是传感器设备的唯一ID——因为一个项目可以有许多设备向其发送数据。</li></ul><blockquote class="mg mh mi"><p id="f517" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><em class="iq">虽然并非所有这些环境变量都是“绝密”的，但因为只有四个，所以在回购中把它们组合在一起更有意义，而不是把它们分成位于代码库中不同位置的“公共”和“私有”变量。</em></p></blockquote><p id="c2d9" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">由于这是一个Next.js应用程序，我们在本地存储这些不应该签入源代码控制(即GitHub)的敏感变量的方式是通过使用<a class="ae mf" href="https://nextjs.org/docs/basic-features/environment-variables" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">。</strong> </a> <code class="fe nv nw nx ny b"><a class="ae mf" href="https://nextjs.org/docs/basic-features/environment-variables" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">env</strong></a></code> <a class="ae mf" href="https://nextjs.org/docs/basic-features/environment-variables" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">文件</strong> </a>。</p><p id="f24e" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">对于应用程序，以下示例代码控制Next.js在本地启动时读取的环境变量。</p><p id="d5ef" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated"><code class="fe nv nw nx ny b"><strong class="ll ir">.env.local</strong></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/74e7cf1bad2d8c0211c29b37a5a7dd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XesgAimPCgEvvX-dLPKrpw.png"/></div></div></figure><p id="dafc" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">然后使用<code class="fe nv nw nx ny b">process.env</code>语法在应用程序内部访问这些变量。例如，要获得应用程序运行代码中的<code class="fe nv nw nx ny b">HUB_PROJECT_UID</code>值，只需在JavaScript文件中需要的地方编写<code class="fe nv nw nx ny b">process.env.HUB_PROJECT_UID</code>即可。</p><p id="a864" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">好了，我们已经确定了我们的环境变量是动态的，也不应该签入GitHub，让GitHub Actions知道它在运行CI工作流时也需要查找它们。</p><h2 id="8ad4" class="nj ks iq bd kt nk nl dn kx nm nn dp lb ls no np ld lw nq nr lf ma ns nt lh nu bi translated">将环境变量添加到GitHub操作YAML文件中</h2><p id="4d19" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为了让GitHub知道它有一个GitHub动作工作流要为一个repo运行，在repo的根目录下应该存在以下文件夹:<code class="fe nv nw nx ny b">.github/workflows/</code>。</p><p id="f820" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">其中将包含一个YAML文件:我们的文件被命名为<code class="fe nv nw nx ny b"><a class="ae mf" href="https://github.com/blues/sparrow-reference-web-app/blob/main/.github/workflows/CI-PRs-and-main.yml" rel="noopener ugc nofollow" target="_blank">CI-PRs-and-main.yml</a></code>，但是你可以给它起任何你认为有意义的名字。</p><p id="6216" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在YAML文件中，将列出各种步骤，对于需要这些秘密的步骤，我们将添加所需的环境变量，如下所示:</p><blockquote class="mg mh mi"><p id="41be" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><strong class="ll ir"> <em class="iq">注意:</em> </strong> <em class="iq">如果你想在它的repo中看到完整的GitHub Actions文件，你可以点击下面的文件标题。</em></p></blockquote><p id="73cb" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated"><code class="fe nv nw nx ny b"><a class="ae mf" href="https://github.com/blues/sparrow-reference-web-app/blob/main/.github/workflows/CI-PRs-and-main.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">CI-PRs-and-main.yml</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/0227f18602913d28b043f754378b4f1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKwF01QcM-RyT_aHriUiRA.png"/></div></div></figure><p id="f17f" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">如果您注意到这个YAML文件中有两个<code class="fe nv nw nx ny b">steps</code>需要敏感的环境变量:<code class="fe nv nw nx ny b">Run unit tests</code>和<code class="fe nv nw nx ny b">Cypress run</code>。</p><p id="990d" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated"><strong class="ll ir">声明</strong> <code class="fe nv nw nx ny b"><strong class="ll ir">env</strong></code> <strong class="ll ir">属性和每个需要的环境变量</strong></p><p id="f381" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">为了告诉GH Actions这些自定义环境变量应该存在，我们在需要这些变量的步骤中声明了<code class="fe nv nw nx ny b"><a class="ae mf" href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">env</strong></a></code> <a class="ae mf" href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">属性</strong> </a>。</p><p id="0bbc" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">然后缩进并列出每个需要的秘密变量(以及回购如何读取它们)。例如，由于我们的repo在本地读取秘密变量<code class="fe nv nw nx ny b">HUB_AUTH_TOKEN</code>，因此用相同的名称命名在GitHub操作工作流中读取的<code class="fe nv nw nx ny b">env</code>属性是有意义的。</p><pre class="kg kh ki kj gt op ny oq or aw os bi"><span id="80d2" class="nj ks iq ny b gy ot ou l ov ow">env:<br/>    HUB_AUTH_TOKEN:</span></pre><p id="5ba8" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated"><strong class="ll ir">设置</strong> <code class="fe nv nw nx ny b"><strong class="ll ir">${{ secrets.MY_SECRET }}</strong></code> <strong class="ll ir">值</strong></p><p id="6681" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在列出GitHub动作的环境变量名之后，使用语法<code class="fe nv nw nx ny b">${{ secrets.NAME_OF_SECRET_IN_GITHUB }}</code>为存储在GitHub动作中的同名值赋值。</p><p id="95a7" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">我将在下一节讨论如何远程设置这个值。</p><h1 id="26cc" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在GitHub Repo中设置那些敏感的环境变量</h1><p id="cc44" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">现在我们准备在GitHub中设置秘密变量。</p><h2 id="a779" class="nj ks iq bd kt nk nl dn kx nm nn dp lb ls no np ld lw nq nr lf ma ns nt lh nu bi translated">访问回购的“设置”选项卡</h2><p id="4605" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在GitHub中找到需要变量的repo，点击<strong class="ll ir">设置</strong>选项卡。</p><p id="c74f" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在<strong class="ll ir">设置</strong>中，向下进入侧边栏的<strong class="ll ir">秘密</strong>下拉菜单，点击它进入<strong class="ll ir">行动</strong>页面。该页面应该类似于下图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/ddcbaca2bfc2e2cd49c74c526982bc3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmc5YsV7alP7CbsLG_6rjQ.png"/></div></div></figure><p id="d04b" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在我的<strong class="ll ir"> Actions Secrets </strong>页面中，已经存在一些存储库机密——这是我们将添加到GH Actions工作流中运行的内容。点击屏幕右上角的<strong class="ll ir">新存储库密码</strong>按钮。</p><h2 id="fce4" class="nj ks iq bd kt nk nl dn kx nm nn dp lb ls no np ld lw nq nr lf ma ns nt lh nu bi translated">设置新的环境机密</h2><p id="ecc5" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">将出现一个新屏幕，向存储库添加新的机密。这里是GitHub操作YAML中定义的环境变量名将被复制和它们的值被定义的地方。</p><p id="3a22" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">使用上面的示例变量，我们将在<code class="fe nv nw nx ny b">Name</code>输入中定义一个名为<code class="fe nv nw nx ny b">HUB_PROJECT_UID</code>的新变量作为秘密的名称，然后将实际项目的值(在本例中是在Notehub中定义的)添加到<code class="fe nv nw nx ny b">Value</code>文本区域中。</p><blockquote class="mg mh mi"><p id="b1a1" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><em class="iq">这对应于YAML文件中的</em> <code class="fe nv nw nx ny b"><em class="iq">${{ secrets.HUB_PROJECT_UID }}</em></code> <em class="iq">值。</em></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/d62f5018605c45e193c93995e8855d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKt1E3fd8Iawnn1Et-Tj1w.png"/></div></div></figure><p id="b314" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">再次检查密码名称和值是否正确后，点击<strong class="ll ir">添加密码</strong>按钮。一旦秘密被保存，它在GitHub中被加密，你将很难看到它的原始值是多少。</p><blockquote class="mg mh mi"><p id="3a73" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><strong class="ll ir"> <em class="iq">注:</em> </strong> <em class="iq">如果您确实意识到以后某个秘密不正确或需要更新，不必担心，可以通过单击主</em> <strong class="ll ir"> <em class="iq">动作秘密</em> </strong> <em class="iq">页面上秘密名称旁边的</em> <strong class="ll ir"> <em class="iq">更新</em> </strong> <em class="iq">按钮来更新秘密值。</em></p><p id="a12f" class="lj lk mj ll b lm mk jr lo lp ml ju lr mm mn lu lv mo mp ly lz mq mr mc md me ij bi translated"><em class="iq">你仍然看不到秘密的旧值是多少，但是有一条前进的道路来做出改变。</em></p></blockquote><p id="0054" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">太好了！GitHub Actions文件知道为工作流的某些步骤注入什么环境变量，这些环境变量和它们的值已经在repo的settings选项卡中定义了，现在是时候进行测试了。</p><h2 id="8de3" class="nj ks iq bd kt nk nl dn kx nm nn dp lb ls no np ld lw nq nr lf ma ns nt lh nu bi translated">运行您的GitHub操作工作流，并观察它的通过</h2><p id="8b89" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">对于我们的repo，GitHub Actions工作流被设计为每当用户将代码推送到pull请求或<code class="fe nv nw nx ny b">main</code>分支时运行，如下定义:</p><p id="7c54" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated"><code class="fe nv nw nx ny b"><a class="ae mf" href="https://github.com/blues/sparrow-reference-web-app/blob/main/.github/workflows/CI-PRs-and-main.yml" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">CI-PRs-and-main.yml</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/bdb03a050df0e6ae685348accde33516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isX0FQKa1_62xU1-4PpTNw.png"/></div></div></figure><p id="1f88" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">如果您已经有一个失败的工作流，只需转到repo的<strong class="ll ir">操作</strong>选项卡，单击失败的工作流，然后单击主工作流屏幕上的<strong class="ll ir">重新运行所有作业</strong>按钮。</p><p id="93fe" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">如果没有，请执行触发新工作流运行所需的任何操作。</p><p id="db4b" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">无论哪种方式，当秘密环境变量集被成功读出时，这是您应该看到的最终结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/813c606f6433badab3d8730577ac6041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gpsh9fpyYLGURt2Q1ZJCAA.png"/></div></div></figure><p id="abb0" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">请注意，在图中列出的工作流过程中的所有步骤中，需要敏感环境变量的两个步骤<code class="fe nv nw nx ny b">Run Unit Tests</code>和<code class="fe nv nw nx ny b">Cypress run</code>都成功通过了。</p><p id="4827" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">在这个过程中没有敏感信息或秘密泄露。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="42e0" class="kr ks iq bd kt ku mz kw kx ky na la lb jw nb jx ld jz nc ka lf kc nd kd lh li bi translated">结论</h1><p id="7700" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">随着几年前GitHub Actions的引入，GitHub显著降低了开发团队利用持续集成/持续部署管道所带来的好处所需的复杂性和专业知识。不过，有一件事一直是个问题，那就是如何处理环境变量，这些变量由于其敏感的性质，应该对通用代码库保密——这正是应用程序(和自动化测试套件)运行所需要的那种保密。</p><p id="d9d7" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">GitHub想出了一个办法来处理这个问题:在回购协议的设置中设置秘密，一旦设置好就加密。GitHub可以简单地存储变量，并使用<code class="fe nv nw nx ny b">${{ secrets.MY_SECRET_HERE }}</code>语法在任何必要的工作流程步骤中访问这些变量，而不是通过使用<code class="fe nv nw nx ny b">.gitignore</code> JSON文件、构建管道库或其他不直观、难以管理的系统来确保秘密的安全。好多了！</p><p id="5f58" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">过几周再来看看——我会写更多关于JavaScript、React、IoT或其他与web开发相关的东西。</p><p id="483b" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">如果你想确保你不会错过我写的一篇文章，在这里注册我的时事通讯:<a class="ae mf" href="https://paigeniedringhaus.substack.com" rel="noopener ugc nofollow" target="_blank">https://paigeniedringhaus.substack.com</a></p><p id="a6b9" class="pw-post-body-paragraph lj lk iq ll b lm mk jr lo lp ml ju lr ls mn lu lv lw mp ly lz ma mr mc md me ij bi translated">感谢阅读。我希望这有助于您构建自己的需要敏感环境变量的GitHub Actions工作流:CI/CD是当今构建高质量软件的最佳方式，GitHub正在让每个人越来越容易实现这一点。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h1 id="bcdc" class="kr ks iq bd kt ku mz kw kx ky na la lb jw nb jx ld jz nc ka lf kc nd kd lh li bi translated">参考资料和更多资源</h1><ul class=""><li id="3dba" class="nz oa iq ll b lm ln lp lq ls pa lw pb ma pc me oe of og oh bi translated"><a class="ae mf" href="https://resources.github.com/downloads/What-is-GitHub.Actions_.Benefits-and-examples.pdf" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a></li><li id="a169" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated"><a class="ae mf" href="https://resources.github.com/ci-cd/" rel="noopener ugc nofollow" target="_blank"> GitHub的CI/CD资源</a></li><li id="0e12" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated">完整<a class="ae mf" href="https://github.com/blues/sparrow-starter" rel="noopener ugc nofollow" target="_blank"> GitHub项目回购</a></li><li id="690f" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated">蓝调无线<a class="ae mf" href="https://blues.io/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank">网站</a></li><li id="d5d8" class="nz oa iq ll b lm oi lp oj ls ok lw ol ma om me oe of og oh bi translated"><a class="ae mf" href="https://notehub.io/?&amp;utm_source=medium.com&amp;utm_medium=web&amp;utm_campaign=sparrow-accelerator&amp;utm_content=secret-env-vars-github-actions" rel="noopener ugc nofollow" target="_blank"> Notehub </a>云</li></ul></div></div>    
</body>
</html>