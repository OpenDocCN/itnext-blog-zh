<html>
<head>
<title>Rewriting a Ruby/Rails app in Elixir/Phoenix (almost) Literally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Elixir/Phoenix(几乎)逐字重写Ruby/Rails应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/rewriting-a-ruby-rails-app-in-elixir-phoenix-almost-literally-7d50d913c8d3?source=collection_archive---------0-----------------------#2019-01-20">https://itnext.io/rewriting-a-ruby-rails-app-in-elixir-phoenix-almost-literally-7d50d913c8d3?source=collection_archive---------0-----------------------#2019-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a0b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我一直在寻找一个有点挑战性的应用程序，除了用菲尼克斯框架编写的简单演示。熟悉Ruby/Rails之后，我选择了Michael Hartl的<strong class="jp ir"> Ruby on Rails教程——用Rails学习Web开发</strong>(【https://www.railstutorial.org】)实际上，我是在阅读该教程时学习Rails的！)并决定转换几乎贯穿整个教程的twitter like示例应用程序。</p><p id="f82c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我把它叫做<strong class="jp ir">迷你推特</strong>(可能不是一个好的名字选择，但是在计算机科学中命名是如此困难！).我认为这是一个相当复杂的应用程序，有很多书里没有提到的功能。所以，我接受了挑战，将这个应用程序转换为Elixir/Phoenix，并与Elixir/Phoenix社区分享我的经验。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/c5fd6fafd60b132991591f1bd343e475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QLNXH9cObyn9zCvpvrI2jw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">迷你推特应用主页</figcaption></figure><p id="5efb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">完整代码</strong>:在我的github上可以找到这款应用的Elixir/Phoenix版本的完整代码——<a class="ae kl" href="https://github.com/imeraj/Phoenix_Playground/tree/master/1.4/minitwitter" rel="noopener ugc nofollow" target="_blank">https://github . com/imeraj/Phoenix _ Playground/tree/master/1.4/mini Twitter</a></p><p id="8567" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果有人对Ruby/Rails版本感兴趣，我在这里也有一些附加功能(比如presence)的完整代码—<a class="ae kl" href="https://github.com/imeraj/miniTwitter" rel="noopener ugc nofollow" target="_blank">https://github.com/imeraj/miniTwitter</a></p><p id="b93d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">先决条件:我假设你熟悉Ruby/Rails和Elixir/Phoenix </strong>。了解Ruby/Rails并不是理解代码的必要条件，只是你应该能够按照教程来理解应用程序的特性，以及它是如何实现的，以便能够理解代码。我将在这里介绍该应用的一些亮点，但由于该应用的复杂性和范围，不可能在这里介绍完整的实现；这可能需要写另一个教程/书！我会参考迈克尔的教程来遵循代码。</p><p id="4a58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">仙丹/凤凰版本</strong>:我用过仙丹1.7.4搭配Erlang/OTP 21和凤凰1.4。</p><p id="97f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这次重写涵盖了什么内容</strong>:几乎所有的功能都和教程中的一样。不是前端开发人员，我不得不牺牲一些美感和前端的一些微调。</p><p id="c61d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重写中没有涵盖的内容:主要是测试。我开始编写测试，但是我对编写所有的测试变得不耐烦了。所以我跳过了编写测试。我认为<strong class="jp ir">编程凤凰1.4(</strong><a class="ae kl" href="https://pragprog.com/book/phoenix14/programming-phoenix-1-4" rel="noopener ugc nofollow" target="_blank">https://pragprog.com/book/phoenix14/programming-phoenix-1-4</a>)涵盖了在凤凰城编写测试的所有细节，如果你遵循这本书，你应该能够添加这个应用程序所需的测试。</p><p id="89b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将每天提供一些代码摘录使用的工具/库。我已经在git commit消息中提供了很好的描述，所以这些连同这篇文章和Michael的教程可以帮助您理解Elixir/Phoenix版本。</p><h1 id="d328" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">第一天(2019年1月10日)</strong></h1><p id="fd94" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">涵盖内容</strong>:教程第3章&amp; 4</p><p id="b9dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">功能覆盖</strong>:主要是app设置和主页，联系人页面设置</p><p id="9bff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:不适用</p><p id="9809" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我在配置文件中指定密码时，我得到了一个奇怪的关于MySQL和mariex(<a class="ae kl" href="https://github.com/xerions/mariaex" rel="noopener ugc nofollow" target="_blank">https://github.com/xerions/mariaex</a>)的错误。我发现在最新的代码中已经修复了。所以我不得不使用最新的git依赖，并使用override true来使它与mysql一起工作—</p><p id="7f14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自mix.exs —</p><p id="44f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">{:mariaex，git:" https://github . com/x erions/Maria ex . git "，override: true}</p><p id="b720" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第1天提交</strong>:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/7e7214f15ccaa2c7b727b8e454e432bac6e5fa2f" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitTwitter:初始提交imeraj/Phoenix _ Playground @ 7e 7214 f</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-使用mysql数据库-用{:mariaex，git…替换mariax默认依赖项</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/a147423c51393efce6740572fd2194d254fb6d8e" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加大部分静态页面imeraj/Phoenix _ Playground @ a 147423</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-增加了两个静态页面:home.html和help.html与助手，路线，和必要的页面变化…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="mx l mt mu mv mr mw kw mi"/></div></div></a></div><h1 id="aa8c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第二天(2019年1月11日)</h1><p id="1b29" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">涵盖内容</strong>:第5章</p><p id="63e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">功能覆盖</strong>:主要是修复app布局</p><p id="405f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:不适用</p><p id="f3cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第2天提交:</strong></p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/6283642c0db0163fc29f179e690306e69b782adc" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加上次提交时丢失的文件imeraj/Phoenix _ Playground @ 6283642</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">在GitHub上创建一个帐户，为imeraj/Phoenix_Playground的开发做出贡献。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="my l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/38c37f305b36836764d97fc105c1e39edf253119" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:修复应用布局imeraj/Phoenix _ Playground @ 38 c37 f 3</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-修复了应用程序布局-为视图和布局编写了测试-修复了损坏的测试-使用了默认的毫克…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="mz l mt mu mv mr mw kw mi"/></div></div></a></div><p id="436f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">描述</strong>:修复app布局。添加了第一天提交时丢失的一些文件。</p><h1 id="5ab6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第三天(2019年1月12日)</h1><p id="fd86" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">内容包括什么:第六章</p><p id="d286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">功能覆盖</strong>:建模用户</p><p id="902d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:不适用</p><p id="6f71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第3天提交:</strong></p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/79d9389a1bd7ea85a345804db3d7aa201d225b86" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加用户模式(无凭据)imeraj/Phoenix _ Playground @ 79d 9389</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了用户模式、注册(无凭据)-添加了必要的上下文、模式验证-添加了…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="na l mt mu mv mr mw kw mi"/></div></div></a></div><p id="70d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">描述:</strong>添加了<strong class="jp ir">账户</strong>上下文和<strong class="jp ir">用户</strong>模式和迁移文件。</p><p id="c52a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">此阶段的用户</strong>模式如下所示-</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="57de" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Accounts.User do<br/>  use Ecto.Schema<br/>  import Ecto.Changeset<br/><br/><br/>  schema "users" do<br/>    field :name, :string<br/>    field :email, :string<br/><br/>    timestamps()<br/>  end<br/><br/>  @email_regex ~r/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i<br/><br/>  @doc false<br/>  def changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [:name, :email])<br/>    |&gt; validate_required([:name, :email])<br/>    |&gt; validate_length(:name, min: 3, max: 50)<br/>    |&gt; validate_length(:email, max: 255)<br/>    |&gt; validate_format(:email, @email_regex)<br/>    |&gt; downcase_email()<br/>    |&gt; unique_constraint(:email)<br/>  end<br/><br/>  defp downcase_email(changeset) do<br/>    case fetch_change(changeset, :email) do<br/>      {:ok, email} -&gt; put_change(changeset, :email, String.downcase(email))<br/>      :error -&gt; changeset<br/>    end<br/>  end<br/>end</span></pre><p id="e756" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> @email_regex </strong>用于帮助验证电子邮件，而<strong class="jp ir"> downcase_email </strong>用于在持久化用户之前将提供的电子邮件地址转换为小写。</p><p id="35f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相应的迁移文件如下所示—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="6220" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Repo.Migrations.CreateUsers do<br/>  use Ecto.Migration<br/><br/>  def change do<br/>    create table(:users) do<br/>      add :name, :string, null: false<br/>      add :email, :string, null: false<br/><br/>      timestamps()<br/>    end<br/><br/>    create unique_index(:users, [:email])<br/>  end<br/>end</span></pre><h1 id="3584" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第四天(2019年1月13日)</h1><p id="1da1" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">涵盖的内容</strong>:第7、8、9章</p><p id="f00b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖的功能</strong>:主要涵盖注册用户、基本登录和高级登录，并在计算机上记住用户</p><p id="3ab1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:必须在mix.exs中添加额外的依赖关系来支持注册和登录。</p><p id="fe67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自mix.exs —</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="2c58" class="ng ld iq nc b gy nh ni l nj nk">      {:comeonin, "~&gt; 4.1"},<br/>      {:bcrypt_elixir, "~&gt; 1.0"},<br/>      {:pbkdf2_elixir, "~&gt; 0.12"}</span></pre><p id="0093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第4天提交</strong>:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/20a99f065ca6ac9f647c3885485e787f7f2b5b03" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加注册支持imeraj/Phoenix _ Playground @ 20a 99 f 0</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了uesr模式和迁移脚本的密码字段-添加了完整的注册表单…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nl l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/81da3e6eae4f6154bc66caf7bef8d3aff02efe3c" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:增加了基本的登录支持(跳过了一些测试)imeraj/Phoenix _ Playground @ 81 da 3 e 6</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加基本登录支持-添加注销支持-基于登录/注销的固定布局-添加新…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nm l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/29ee48c165d6c3aba2610b391921c9c30e84ef4b" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwiiter:添加高级登录支持，带/不带remember_me (ski...…</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">pped测试)描述:-添加了带/不带remember_me的高级登录支持-添加了长期cookie支持…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nn l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/bae4728080f5cfaadb75e3bc585852813f20a59c" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加了丢失的迁移文件imeraj/Phoenix _ Playground @ BAE 4728</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">在GitHub上创建一个帐户，为imeraj/Phoenix_Playground的开发做出贡献。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="no l mt mu mv mr mw kw mi"/></div></div></a></div><p id="d132" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他那个阶段的用户模式看起来像—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="ff78" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Accounts.User do<br/>  use Ecto.Schema<br/>  import Ecto.Changeset<br/><br/>  schema "users" do<br/>    field :name, :string<br/>    field :email, :string<br/>    field :password, :string, virtual: true<br/>    field :password_confirmation, :string, virtual: true<br/>    field :password_hash, :string<br/>    field :remember_hash, :string<br/><br/>    timestamps()<br/>  end<br/><br/>  @email_regex ~r/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i<br/><br/>  @doc false<br/>  def changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [:name, :email, :password, :password_confirmation])<br/>    |&gt; validate_required([:name, :email, :password, :password_confirmation])<br/>    |&gt; validate_length(:name, min: 3, max: 50)<br/>    |&gt; validate_length(:email, max: 255)<br/>    |&gt; validate_format(:email, @email_regex)<br/>    |&gt; validate_length(:password, min: 6, max: 32)<br/>    |&gt; validate_confirmation(:password)<br/>    |&gt; downcase_email()<br/>    |&gt; unique_constraint(:email)<br/>    |&gt; put_pass_hash()<br/>  end<br/><br/>  def update_changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [:name, :email, :password, :password_confirmation, :remember_hash])<br/>    |&gt; validate_length(:name, min: 3, max: 50)<br/>    |&gt; validate_length(:email, max: 255)<br/>    |&gt; validate_format(:email, @email_regex)<br/>    |&gt; validate_length(:password, min: 6, max: 32)<br/>    |&gt; validate_confirmation(:password)<br/>    |&gt; downcase_email()<br/>    |&gt; unique_constraint(:email)<br/>    |&gt; put_pass_hash()<br/>  end<br/><br/>  def new_token(size \\ 64) do<br/>    :crypto.strong_rand_bytes(size)<br/>    |&gt; Base.url_encode64(padding: false)<br/>  end<br/><br/>  defp put_pass_hash(changeset) do<br/>    case changeset do<br/>      %Ecto.Changeset{valid?: true, changes: %{password: pass}} -&gt;<br/>        put_change(changeset, :password_hash, Comeonin.Pbkdf2.hashpwsalt(pass))<br/><br/>      _ -&gt;<br/>        changeset<br/>    end<br/>  end<br/><br/>  defp downcase_email(changeset) do<br/>    case fetch_change(changeset, :email) do<br/>      {:ok, email} -&gt; put_change(changeset, :email, String.downcase(email))<br/>      :error -&gt; changeset<br/>    end<br/>  end<br/>end</span></pre><p id="7faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还添加了必要的迁移文件。此外，编写了<strong class="jp ir">认证插件</strong>来认证用户——</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="02cd" class="ng ld iq nc b gy nh ni l nj nk">defmodule MinitwitterWeb.Auth do<br/>  import Plug.Conn<br/>  import Phoenix.Controller<br/><br/>  alias Minitwitter.Accounts<br/>  alias MinitwitterWeb.Router.Helpers, as: Routes<br/><br/>  @max_age 7 * 24 * 60 * 60<br/><br/>  def init(opts), do: opts<br/><br/>  def call(conn, _opts) do<br/>    user_id = get_session(conn, :user_id)<br/><br/>    cond do<br/>      user = conn.assigns[:current_user] -&gt;<br/>        put_current_user(conn, user)<br/><br/>      user = user_id &amp;&amp; Accounts.get_user(user_id) -&gt;<br/>        put_current_user(conn, user)<br/><br/>      true -&gt;<br/>        assign(conn, :current_user, nil)<br/>    end<br/>  end<br/><br/>  def login(conn, user) do<br/>    conn<br/>    |&gt; put_current_user(user)<br/>    |&gt; put_session(:user_id, user.id)<br/>    |&gt; configure_session(renew: true)<br/>  end<br/><br/>  defp put_current_user(conn, user) do<br/>    conn<br/>    |&gt; assign(:current_user, user)<br/>  end<br/><br/>  def authenticate_user(conn, _opts) do<br/>    cond do<br/>      conn.assigns.current_user -&gt;<br/>        conn<br/><br/>      remember_token = conn.cookies["remember_token"] -&gt;<br/>        user_id = conn.cookies["user_id"]<br/>        user = Accounts.get_user(user_id)<br/><br/>        if user &amp;&amp; Accounts.authenticated?(user, remember_token) do<br/>          login(conn, user)<br/>        else<br/>          halt_connection(conn)<br/>        end<br/><br/>      true -&gt;<br/>        halt_connection(conn)<br/>    end<br/>  end<br/><br/>  defp halt_connection(conn) do<br/>    conn<br/>    |&gt; put_flash(:error, "You must be logged in to access that page!")<br/>    |&gt; redirect(to: Routes.page_path(conn, :home))<br/>    |&gt; halt()<br/>  end<br/><br/>  def login_by_email_and_pass(conn, email, given_pass) do<br/>    case Accounts.authenticate_by_email_and_pass(email, given_pass) do<br/>      {:ok, user} -&gt; {:ok, login(conn, user)}<br/>      {:error, :unauthorized} -&gt; {:error, :unauthorized, conn}<br/>      {:error, :not_found} -&gt; {:error, :not_found, conn}<br/>    end<br/>  end<br/><br/>  def logout(conn) do<br/>    if conn.assigns.current_user do<br/>      Accounts.forget_user(conn.assigns.current_user)<br/><br/>      conn<br/>      |&gt; delete_resp_cookie("user_id")<br/>      |&gt; delete_resp_cookie("remember_token")<br/>      |&gt; configure_session(drop: true)<br/>    end<br/>  end<br/><br/>  def remember(conn, user, token) do<br/>    conn =<br/>      conn<br/>      |&gt; put_resp_cookie("user_id", Integer.to_string(user.id), max_age: @max_age)<br/>      |&gt; put_resp_cookie("remember_token", token, max_age: @max_age)<br/><br/>    conn<br/>  end<br/>end</span></pre><p id="1405" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">会话和持久cookies都被用来记住必要的令牌。Acccounts上下文也更新了必要的功能。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi np"><img src="../Images/e3aa2044f504070b51e92a1f1803817f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*etXeTh6rde22iEdWu5wmvQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">注册页面</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nq"><img src="../Images/64ca9ad0900e220de8c0c139e76d6048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nCAQGXLRQlkzNdU91f2AQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">登录页面</figcaption></figure><h1 id="9a60" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第五天(2019年1月14日)</h1><p id="1573" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">内容包括什么:第10章</p><p id="0159" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖的特性</strong>:更新、显示和删除用户</p><p id="74b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖项</strong>:必须在mix.exs中添加额外的依赖项，以支持用户分页和为DB种子生成假数据。</p><p id="d332" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自mix.exs —</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="d4df" class="ng ld iq nc b gy nh ni l nj nk">      {:faker, "~&gt; 0.11"},<br/>      {:scrivener_ecto, "~&gt; 2.0"}</span></pre><p id="02b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第5天提交</strong>:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/50b36dad7a78a44f0814674055d03fa4e0ee6d2b" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">迷你推特:增加了用户更新、显示和删除支持…</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了用户更新、显示和删除支持-添加了访问控制所需的插件-添加了Faker到…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nr l mt mu mv mr mw kw mi"/></div></div></a></div><p id="b65f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了生成假数据，使用了下面的代码(摘自seeds.exs的最终提交)</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="069e" class="ng ld iq nc b gy nh ni l nj nk"># Script for populating the database. You can run it as:<br/>#<br/>#     mix run priv/repo/seeds.exs<br/>#<br/># Inside the script, you can read and write to any of your<br/># repositories directly:<br/>#<br/>#     Minitwitter.Repo.insert!(%Minitwitter.SomeSchema{})<br/>#<br/># We recommend using the bang functions (`insert!`, `update!`<br/># and so on) as they will fail if something goes wrong.<br/>defmodule MinitwitterWeb.DevelopmentSeeder do<br/>  import Ecto.Query, only: [from: 2]<br/><br/>  alias Minitwitter.Accounts<br/>  alias Minitwitter.Accounts.User<br/>  alias Minitwitter.Microposts<br/>  alias Minitwitter.Repo<br/><br/>  def insert_data do<br/>    # users<br/>    Repo.insert!(%Accounts.User{<br/>      name: "Admin",<br/>      email: "demo.rails007@gmail.com",<br/>      password: "phoenix",<br/>      password_hash: Comeonin.Pbkdf2.hashpwsalt("phoenix"),<br/>      admin: true,<br/>      activated: true,<br/>      activated_at: DateTime.truncate(DateTime.utc_now(), :second)<br/>    })<br/><br/>    for _ &lt;- 1..50,<br/>        do:<br/>          Repo.insert!(%Accounts.User{<br/>            name: Faker.Name.name(),<br/>            email: Faker.Internet.email(),<br/>            password: "phoenix",<br/>            password_hash: Comeonin.Pbkdf2.hashpwsalt("phoenix"),<br/>            activated: true,<br/>            activated_at: DateTime.truncate(DateTime.utc_now(), :second)<br/>          })<br/><br/>    # Microposts<br/>    query =<br/>      from u in "users",<br/>        select: u.id<br/><br/>    ids = Repo.all(query)<br/><br/>    Enum.each(ids, fn id -&gt;<br/>      for _ &lt;- 1..50,<br/>          do:<br/>            Repo.insert!(%Microposts.Post{<br/>              content: Faker.Lorem.sentence(5),<br/>              user_id: id<br/>            })<br/>    end)<br/><br/>    # Follwing relationships<br/>    users = Repo.all(User)<br/>    user = Enum.at(users, 0)<br/>    following = Enum.slice(users, 2, 50)<br/>    followers = Enum.slice(users, 3, 40)<br/>    for followed &lt;- following, do: Minitwitter.Accounts.follow(followed, user)<br/><br/>    for follower &lt;- followers, do: Minitwitter.Accounts.follow(user, follower)<br/>  end<br/>end<br/><br/>case Mix.env() do<br/>  :dev -&gt;<br/>    MinitwitterWeb.DevelopmentSeeder.insert_data()<br/><br/>  _ -&gt;<br/>    :ignore<br/>end</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ns"><img src="../Images/08610a448a61b606da0a08614a97fdaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfyKuIJzdYBQjLvoSKtP0Q.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">更新个人资料页面</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nt"><img src="../Images/267e9123e23fe3f4f536a3423e3aa66a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acAt43BFX81f_9djY8w2mQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">显示用户页面</figcaption></figure><h1 id="d995" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第六天(2019年1月15日)</h1><p id="3b83" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">涵盖的内容</strong>:第11章</p><p id="c325" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖的功能</strong>:通过电子邮件支持账户激活</p><p id="e351" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:必须在mix.exs中添加额外的依赖关系，以支持使用smtp发送电子邮件。</p><p id="2956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自mix.exs —</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="dc1b" class="ng ld iq nc b gy nh ni l nj nk">      {:bamboo, "~&gt; 1.1"},<br/>      {:bamboo_smtp, "~&gt; 1.6.0"}</span></pre><p id="cc07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第6天提交</strong>:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/dd43131fcda7e85178e7843744b3d510b4ce8543" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwiiter:添加账号激活支持imeraj/Phoenix _ Playground @ DD 43131</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了对迁移、模式更改-修改用户和会话控制器的帐户激活支持…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nu l mt mu mv mr mw kw mi"/></div></div></a></div><p id="87e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">config.exs中邮件程序的配置—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="9628" class="ng ld iq nc b gy nh ni l nj nk">config :minitwitter, Minitwitter.Mailer,<br/>  adapter: Bamboo.SMTPAdapter,<br/>  server: "smtp.gmail.com",<br/>  port: 587,<br/>  username: "demo.rails007",<br/>  password: "XXXXXXX",<br/>  # can be `:always` or `:never`<br/>  tls: :if_available,<br/>  # can be `true`<br/>  ssl: false,<br/>  retries: 3</span></pre><p id="bfae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">电子邮件模板代码如下—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="789d" class="ng ld iq nc b gy nh ni l nj nk">&lt;h1&gt;Minitwitter App&lt;/h1&gt;<br/>   &lt;p&gt;Hi &lt;%= @user.name %&gt;,&lt;/p&gt;<br/>&lt;p&gt;<br/>   Welcome to the Minitwitter! Click on the link below to activate your account:<br/>&lt;/p&gt;</span><span id="9dd9" class="ng ld iq nc b gy nv ni l nj nk">&lt;%= Routes.account_activations_url(@conn, :edit, @user.activation_token, email: @user.email) %&gt;</span></pre><h1 id="39ef" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第七天(2019年1月16日)</h1><p id="08e1" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">内容包括什么:第12章</p><p id="d97f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖的功能</strong>:支持通过电子邮件重置密码</p><p id="c60b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:不适用</p><p id="b6d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第7天提交</strong>:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/900c02ac06afe4fdbb8c928382d5322d2536aec8" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加密码重置支持imeraj/Phoenix _ Playground @ 900 c02a</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了对迁移和模式更改的密码重置支持-添加了password_resets_controller以重置…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nw l mt mu mv mr mw kw mi"/></div></div></a></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nx"><img src="../Images/d9f632d672d7429f958dfe3887a2e1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eJqUYkDLKrBB_11rMGR05A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">忘记密码页面</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ny"><img src="../Images/613b6ae19160e5aa758093205f7a7a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47244fg_XBXfUE79-SDW_w.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">重置密码页面</figcaption></figure><h1 id="aa63" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第8天和第9天(2019年1月18日和19日)</h1><p id="c1bc" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated"><strong class="jp ir">涵盖内容</strong>:第13章</p><p id="ac67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">涵盖的功能</strong>:支持图片上传的微博客</p><p id="1dc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:必须在mix.exs中添加额外的依赖关系，以支持微博客中的时间格式和图片上传—</p><p id="042c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">来自mix.exs —</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="7989" class="ng ld iq nc b gy nh ni l nj nk">      {:timex, "~&gt; 3.4"},<br/>      {:arc, "~&gt; 0.11.0"},<br/>      {:arc_ecto, "~&gt; 0.11.1"}</span></pre><p id="8793" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第8天&amp;第9天</strong>提交:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/0b6e7a0fbc8fcb1227bba5c332b82bf9417b1808" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwiiter:添加微帖子支持imeraj/Phoenix _ Playground @ 0 b 6 e 7 a 0</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了对数据库迁移、模式、上下文、控制器的微发布的支持-重构代码以移除…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="nz l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/90a61e9df59dee810d5c2ce0bc9b2afcf30208e4" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwiiter:添加对micr post imeraj/Phoenix _ Playground @ 90a 619的支持</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了对数据库模式、视图、模板和控制器的微发布支持-添加了:arc和:arc_ecto…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="oa l mt mu mv mr mw kw mi"/></div></div></a></div><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/c5382f0f121e015ea392f79ca8a3409d971292fb" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:修正了correct_user插件中的错误，排除:index imeraj/Phoenix _ Playground @ c 5382 f 0</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">在GitHub上创建一个帐户，为imeraj/Phoenix_Playground的开发做出贡献。</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="ob l mt mu mv mr mw kw mi"/></div></div></a></div><p id="85c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为带有图片的微帖子添加了<strong class="jp ir">帖子</strong>模式—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="86c9" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Microposts.Post do<br/>  use Ecto.Schema<br/>  use Arc.Ecto.Schema<br/>  import Ecto.Changeset<br/><br/>  schema "posts" do<br/>    field :content, :string<br/>    field :user_id, :id<br/>    field :picture, Minitwitter.ImageUploader.Type<br/><br/>    timestamps()<br/>  end<br/><br/>  @doc false<br/>  def changeset(post, attrs) do<br/>    post<br/>    |&gt; cast(attrs, [:content, :user_id])<br/>    |&gt; cast_attachments(attrs, [:picture])<br/>    |&gt; validate_required([:content, :user_id])<br/>    |&gt; validate_length(:content, min: 1, max: 140)<br/>    |&gt; foreign_key_constraint(:user_id)<br/>  end<br/>end</span></pre><p id="a829" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，添加了必要的迁移文件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oc"><img src="../Images/c4723223f64de01cc318b62526e2622c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0LLgq1LwHWDSGz_m4-msMw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">带有图片和时间格式的微博客</figcaption></figure><h1 id="5bdb" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">第10天(2019年1月20日)</h1><p id="d579" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">内容包括什么:第14章</p><p id="b914" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">覆盖的功能</strong>:以下用户</p><p id="5340" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用的库/依赖关系</strong>:不适用</p><p id="1b0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第8天&amp;第9天</strong>提交:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/imeraj/Phoenix_Playground/commit/5a85ff2bc43ef7ca300414c33338a632547d94ea" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">minitwitter:添加关注者，关注支持imeraj/Phoenix _ Playground @ 5a 85 ff 2</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">描述:-添加了必要的模式，迁移，控制器，视图来支持跟随和取消跟随-修复了一些错误…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="od l mt mu mv mr mw kw mi"/></div></div></a></div><p id="07ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加了<strong class="jp ir">关系</strong>模式，以支持用户跟踪—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="0a57" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Accounts.Relationship do<br/>  use Ecto.Schema<br/>  import Ecto.Changeset<br/><br/>  schema "relationships" do<br/>    belongs_to(:follower, Minitwitter.Accounts.User)<br/>    belongs_to(:followed, Minitwitter.Accounts.User)<br/><br/>    timestamps()<br/>  end<br/><br/>  @doc false<br/>  def changeset(relationship, attrs) do<br/>    relationship<br/>    |&gt; cast(attrs, [:follower_id, :followed_id])<br/>    |&gt; validate_required([:follower_id, :followed_id])<br/>    |&gt; foreign_key_constraint(:follower_id)<br/>    |&gt; foreign_key_constraint(:followed_id)<br/>  end<br/>end</span></pre><p id="27d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新了<strong class="jp ir">用户</strong>模式，以支持用户跟踪—</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="3412" class="ng ld iq nc b gy nh ni l nj nk">defmodule Minitwitter.Accounts.User do<br/>  use Ecto.Schema<br/>  import Ecto.Changeset<br/><br/>  schema "users" do<br/>    field :name, :string<br/>    field :email, :string<br/>    field :password, :string, virtual: true<br/>    field :password_confirmation, :string, virtual: true<br/>    field :password_hash, :string<br/>    field :remember_hash, :string<br/>    field :admin, :boolean, dafault: false<br/>    field :activation_token, :string, virtual: true<br/>    field :activation_hash, :string<br/>    field :activated, :boolean, default: false<br/>    field :activated_at, :utc_datetime<br/>    field :reset_hash, :string<br/>    field :reset_sent_at, :utc_datetime<br/><br/>    has_many(:posts, Minitwitter.Microposts.Post)<br/><br/>    has_many(:active_relationships, Minitwitter.Accounts.Relationship, foreign_key: :follower_id)<br/>    has_many(:passive_relationships, Minitwitter.Accounts.Relationship, foreign_key: :followed_id)<br/>    has_many(:following, through: [:active_relationships, :followed])<br/>    has_many(:followers, through: [:passive_relationships, :follower])<br/><br/>    timestamps()<br/>  end<br/><br/>  @email_regex ~r/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i<br/><br/>  @doc false<br/>  def changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [:name, :email, :password, :password_confirmation])<br/>    |&gt; validate_required([:name, :email, :password, :password_confirmation])<br/>    |&gt; validate_length(:name, min: 3, max: 50)<br/>    |&gt; validate_length(:email, max: 255)<br/>    |&gt; validate_format(:email, @email_regex)<br/>    |&gt; validate_length(:password, min: 6, max: 32)<br/>    |&gt; validate_confirmation(:password)<br/>    |&gt; downcase_email()<br/>    |&gt; unique_constraint(:email)<br/>    |&gt; put_pass_hash()<br/>    |&gt; put_activation_hash()<br/>  end<br/><br/>  def reset_pass_changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [:password, :password_confirmation, :reset_hash])<br/>    |&gt; validate_required([:password, :password_confirmation])<br/>    |&gt; validate_length(:password, min: 6, max: 32)<br/>    |&gt; validate_confirmation(:password)<br/>    |&gt; put_pass_hash()<br/>  end<br/><br/>  def update_changeset(user, attrs) do<br/>    user<br/>    |&gt; cast(attrs, [<br/>      :name,<br/>      :email,<br/>      :password,<br/>      :password_confirmation,<br/>      :remember_hash,<br/>      :activated,<br/>      :activated_at,<br/>      :reset_hash,<br/>      :reset_sent_at<br/>    ])<br/>    |&gt; validate_required([:name, :email])<br/>    |&gt; validate_length(:name, min: 3, max: 50)<br/>    |&gt; validate_length(:email, max: 255)<br/>    |&gt; validate_format(:email, @email_regex)<br/>    |&gt; validate_length(:password, min: 6, max: 32)<br/>    |&gt; validate_confirmation(:password)<br/>    |&gt; downcase_email()<br/>    |&gt; unique_constraint(:email)<br/>    |&gt; put_pass_hash()<br/>  end<br/><br/>  def new_token(size \\ 64) do<br/>    :crypto.strong_rand_bytes(size)<br/>    |&gt; Base.url_encode64(padding: false)<br/>  end<br/><br/>  defp put_pass_hash(changeset) do<br/>    case changeset do<br/>      %Ecto.Changeset{valid?: true, changes: %{password: pass}} -&gt;<br/>        put_change(changeset, :password_hash, Comeonin.Pbkdf2.hashpwsalt(pass))<br/><br/>      _ -&gt;<br/>        changeset<br/>    end<br/>  end<br/><br/>  defp put_activation_hash(changeset) do<br/>    case changeset do<br/>      %Ecto.Changeset{valid?: true} -&gt;<br/>        token = new_token()<br/><br/>        changeset<br/>        |&gt; put_change(:activation_token, token)<br/>        |&gt; put_change(:activation_hash, Comeonin.Pbkdf2.hashpwsalt(token))<br/><br/>      _ -&gt;<br/>        changeset<br/>    end<br/>  end<br/><br/>  defp downcase_email(changeset) do<br/>    case fetch_change(changeset, :email) do<br/>      {:ok, email} -&gt; put_change(changeset, :email, String.downcase(email))<br/>      :error -&gt; changeset<br/>    end<br/>  end<br/>end</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi oe"><img src="../Images/bd4fef37944711e9a719cb711fea1331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9nZoG1llUXtpYAj5gFy4A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">追随者，追随者支持</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi of"><img src="../Images/dc2f1030f9a443ebcccc4e8d0f3659c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFHrk-7enBkhVipfaan2Kg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">跟随/取消跟随支持</figcaption></figure><p id="9e32" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这几乎是完整的应用程序。我建议你阅读Michael的教程，并每天阅读代码，以了解项目的整体思路。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="4a40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">体验重写app </strong>:</p><p id="1d61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个实验后我的想法/经历—</p><ul class=""><li id="0dcf" class="on oo iq jp b jq jr ju jv jy op kc oq kg or kk os ot ou ov bi translated">Ruby/Rails更加简洁，但是Elixir/Phoenix更加明确。</li><li id="a9e3" class="on oo iq jp b jq ow ju ox jy oy kc oz kg pa kk os ot ou ov bi translated">Elixir/Phoenix库似乎是可用的，并且日益成熟。</li><li id="488d" class="on oo iq jp b jq ow ju ox jy oy kc oz kg pa kk os ot ou ov bi translated">Rails和Phoenix在Coffeescript和EEx script上更兼容。我不是一个前端人员，但即使是我也可以毫不费力地将Coffeescript代码转换成EEx(但我认为我的CSS乱七八糟！).</li><li id="a19c" class="on oo iq jp b jq ow ju ox jy oy kc oz kg pa kk os ot ou ov bi translated">我发现与活动记录相比，ecto有点复杂。特别是，ecto支持多种可能让初学者感到困惑的做事方式。但是一旦你掌握了它，它也是非常清晰和符合逻辑的。还有，如果你卡住了，谷歌是你的朋友:)</li></ul><p id="d76d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论:</strong></p><p id="9719" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过做这个爱好项目，我学到了很多东西。我想我现在更了解长生不老药/凤凰了。我希望这篇文章将鼓励更多的开发者认真研究Elixir/Phoenix，并可能使一些人皈依:)</p><p id="fb15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="pb">我希望这篇文章和项目源代码对一些人有用。更多详细和深入的未来技术文章，请关注我这里或点击</em> <a class="ae kl" href="https://twitter.com/meraj_enigma" rel="noopener ugc nofollow" target="_blank"> <em class="pb"> twitter </em> </a> <em class="pb">。</em></p></div></div>    
</body>
</html>