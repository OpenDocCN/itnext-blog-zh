<html>
<head>
<title>Build a Project Management Tool with Vue.js, Node.js and Apollo — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Vue.js、Node.js和Apollo构建一个项目管理工具——第2部分</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part2-47fbe5dc2de4?source=collection_archive---------0-----------------------#2018-08-05">https://itnext.io/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part2-47fbe5dc2de4?source=collection_archive---------0-----------------------#2018-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="121f" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">在本系列的第1部分中，我们构建了一个简单的GraphQL API。</p><p id="9954" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">在这一部分，我们将构建MongoDB模式和一个电子邮件表单。</p><p id="b685" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">在<a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-3-69a7bf9f2f1b">第3部分</a>中，我们将完成认证。</p><p id="588c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-4-40fbe0625d32">第4部分——建立工作空间</a></p><p id="9cd7" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-5-d59e6e345e39">第5部分—文件夹的CRUD功能</a></p></blockquote><p id="e7a0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">让我们从创建一个MongoDB模式开始本教程。在<code class="fe kt ku kv kw b">server/src</code>中创建一个新文件<code class="fe kt ku kv kw b">models.js</code>。</p><p id="6e6e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">虽然您可以在不创建模式的情况下使用MongoDB，但是这样做可以让您以更具表现力的方式编写代码，并帮助您可视化数据库结构。</p><p id="8b39" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">首先，我们需要一个文件夹、团队和用户的模型。Wrike比其他工具更复杂，因为文件夹和任务是一个树状结构——你可以创建一个子文件夹的子文件夹。所以文件夹模型有一个父引用。还要注意，我使用了动态引用<a class="ae kp" href="http://mongoosejs.com/docs/populate.html#dynamic-ref" rel="noopener ugc nofollow" target="_blank">进行共享。这是因为您可以与整个团队、组或用户共享一个文件夹。</a></p><p id="8742" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">最后，我编写了<code class="fe kt ku kv kw b">buildModel</code>函数来抽象样板代码。它将时间戳(createdAt和updateAt)插入到每个模型中。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="3508" class="lf lg iq kw b gy lh li l lj lk">server/src/models.js<br/>const mongoose = require("mongoose")<br/>const moment = require('moment')<br/>const Schema = mongoose.Schema<br/>const ObjectId = Schema.Types.ObjectId</span><span id="0170" class="lf lg iq kw b gy ll li l lj lk">function buildModel(name, schema) {<br/>  return mongoose.model(name, new Schema(schema, {timestamps: true}))<br/>}</span><span id="94b5" class="lf lg iq kw b gy ll li l lj lk">const Folder = buildModel('Folder', {<br/>  name: String,<br/>  description: String,<br/>  shareWith: [{<br/>    kind: String,<br/>    item: { type: ObjectId, refPath: 'shareWith.kind' }<br/>  }],<br/>  parent: { type: ObjectId, ref: 'Folder' },<br/>})<br/>module.exports.Folder = Folder</span></pre><p id="380d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">团队模型与文件夹完全相同。但是由于团队有不同的特征，我为此建立了一个单独的模型。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="55cb" class="lf lg iq kw b gy lh li l lj lk">module.exports.Team = Folder.discriminator('Team', new Schema({<br/>}, {timestamps: true}))</span></pre><p id="a5e5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">用户模型有许多字段。我会在我们进行的过程中解释每一个领域。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="5e5a" class="lf lg iq kw b gy lh li l lj lk">module.exports.User = buildModel('User', {<br/>  name: {<br/>    type: String,<br/>    default: ''<br/>  },<br/>  firstname: String,<br/>  lastname: String,<br/>  email: {<br/>    type: String,<br/>    required: true,<br/>  },<br/>  password: {<br/>    type: String,<br/>  },<br/>  jobTitle: {<br/>    type: String,<br/>    default: ''<br/>  },<br/>  avatarColor: String,<br/>  team: { type: ObjectId, ref: 'Team' },<br/>  role: String,<br/>  status: String<br/>})</span></pre><h1 id="6d80" class="lm lg iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">用户对象</strong></h1><p id="0ce9" class="pw-post-body-paragraph jq jr iq jt b ju mj jw jx jy mk ka kb kq ml ke kf kr mm ki kj ks mn km kn ko ij bi translated">通常像这样的教程在完成一个基本功能后处理认证，这有助于你快速获得一个大图。这种方法的缺点是您最终要重写一些代码。所以我决定先建立身份验证。我知道这不是最令人兴奋的部分，但是让我们现在就完成它，这样我们就可以进入更有趣的东西了！</p><p id="3b3c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这里是新的<code class="fe kt ku kv kw b">schema.graphql</code>。我不想要求用户马上注册，而是想先获取他的电子邮件。所以我们有<code class="fe kt ku kv kw b">captureEmail</code>以及<code class="fe kt ku kv kw b">signup</code>和<code class="fe kt ku kv kw b">login</code>。我们需要定义一个定制的标量类型<code class="fe kt ku kv kw b">Date</code>，因为GraphQL默认没有。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="d5a3" class="lf lg iq kw b gy lh li l lj lk">// server/src/schema.graphql<br/>scalar Date</span><span id="1c3f" class="lf lg iq kw b gy ll li l lj lk">type Query {<br/> test: String<br/>}</span><span id="ef59" class="lf lg iq kw b gy ll li l lj lk">type Mutation {<br/>  captureEmail(email: String!): User<br/>  signup(id: String!, firstname: String!, lastname: String!, password: String!): AuthPayload!<br/>  login(email: String!, password: String!): AuthPayload!<br/>}</span><span id="6010" class="lf lg iq kw b gy ll li l lj lk">type User {<br/>  id: String<br/>  name: String<br/>  firstname: String<br/>  lastname: String<br/>  email: String<br/>  avatarColor: String<br/>  jobTitle: String<br/>  team: String<br/>  role: String<br/>  status: String<br/>  createdAt: Date<br/>}</span><span id="fe2f" class="lf lg iq kw b gy ll li l lj lk">type AuthPayload {<br/>  token: String!<br/>  user: User!<br/>}</span></pre><p id="aebb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">现在我们已经有了GraphQL模式设置，让我们编写相应的revolver函数。稍后我们将填充<code class="fe kt ku kv kw b">signup</code>和<code class="fe kt ku kv kw b">login</code>。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="4132" class="lf lg iq kw b gy lh li l lj lk">const { GraphQLScalarType } = require('graphql')<br/>const moment = require('moment')<br/>const { User } = require('./models')</span><span id="c45e" class="lf lg iq kw b gy ll li l lj lk">const resolvers = {<br/>  Query: {<br/>    test (_, args, context) {<br/>      return 'Hello World!!'<br/>    }<br/>  },<br/>  Mutation: {<br/>    async captureEmail (_, {email}) {<br/>      const isEmailTaken = await User.findOne({email})<br/>      if (isEmailTaken) {<br/>        throw new Error('This email is already taken')<br/>      }<br/>      const user = await User.create({<br/>        email,<br/>        role: 'Owner',<br/>        status: 'Pending'<br/>      })<br/>      return user<br/>    },<br/>    async signup (_, {id, firstname, lastname, password}) {<br/>    },<br/>    async login (_, {email, password}) {<br/>    }<br/>  },<br/>  Date: new GraphQLScalarType({<br/>    name: 'Date',<br/>    description: 'Date custom scalar type',<br/>    parseValue: (value) =&gt; moment(value).toDate(), // value from the client<br/>    serialize: (value) =&gt; value.getTime(), // value sent to the client<br/>    parseLiteral: (ast) =&gt; ast<br/>  })<br/>}</span><span id="358d" class="lf lg iq kw b gy ll li l lj lk">module.exports = resolvers</span></pre><p id="e5e3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><code class="fe kt ku kv kw b">captureEmail</code>直截了当。首先，它检查电子邮件是否已被占用。否则，创建一个拥有所有者角色的用户。状态为待定，因为用户尚未注册。</p><p id="1947" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在突变下面，我们有日期标量类型。由于GraphQL不能发送和接收日期对象，我们需要解析和序列化它。为了序列化它，我们调用<code class="fe kt ku kv kw b">getTime()</code>来获取自1970/01/01以来的毫秒数。这样我们就可以把一个日期当作一个数字。为了解析它，我们使用<a class="ae kp" href="http://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> moment.js </a>。这是一个非常棒的处理日期和时间的库，我在整个应用程序中广泛使用它。</p><p id="f325" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">让我们测试一下<code class="fe kt ku kv kw b">captureEmail</code>。就像之前一样，通过去<code class="fe kt ku kv kw b">localhost:5500/playground</code>开辟操场，写一个变异。确保提供电子邮件作为查询变量。</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mo"><img src="../Images/84325d176f2f9108f87d9cbf304a6e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6Pd6Q1keTgPg2RYxz6EfA.png"/></div></div></figure><p id="c248" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这应该会创建一个新用户。为了证实这一点，请看一下MongoDB。我使用免费的GUI工具<a class="ae kp" href="https://robomongo.org/" rel="noopener ugc nofollow" target="_blank"> Robo 3T </a>，但是你可以使用任何你想要的。如您所见，用户对象已经创建。</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/5ff4ed8ce60ac2178c9d28fbde0c408e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GKAuXQJoarN3q6J8VFROg.png"/></div></div></figure><h1 id="0e5c" class="lm lg iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置Vue应用程序</h1><p id="619c" class="pw-post-body-paragraph jq jr iq jt b ju mj jw jx jy mk ka kb kq ml ke kf kr mm ki kj ks mn km kn ko ij bi translated">我不想让你在后台呆太久，所以让我们创建一个Vue应用程序并测试从客户端捕获电子邮件。</p><p id="6dcb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">为了搭建Vue应用程序，我们将使用<a class="ae kp" href="https://cli.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue cli 3 </a>。这是一个神奇的工具。你知道它会根据你的代码自动添加babel polyfills吗？这让我们的生活变得轻松多了。如果您还没有，请全局安装它。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="8424" class="lf lg iq kw b gy lh li l lj lk">yarn global add @vue/cli</span></pre><p id="8486" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">然后在根目录下新建一个app。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="b009" class="lf lg iq kw b gy lh li l lj lk">vue create client</span></pre><p id="b9ee" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这是我们需要的功能。为了简单起见，我只包括了最基本的东西。</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mx"><img src="../Images/b03e45aa5b9c9ca8ed389be0c7f06ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPlS6CB3q3pSwstoeBI_nA.png"/></div></div></figure><p id="1c24" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">CSS预处理器是个人喜好的问题。我用SCSS，但你也可以用你最喜欢的。</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi my"><img src="../Images/2f3c0401841c8ccd098726c6c89acffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2NGwB6IqlDWbLX3IzG9AAw.png"/></div></div></figure><p id="21d4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">为了最小化文件数量，我将配置文件放在package.json中。</p><p id="be32" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">确认应用程序正在运行:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="f803" class="lf lg iq kw b gy lh li l lj lk">cd client<br/>yarn serve</span></pre><p id="75d0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">将以下依赖项添加到<code class="fe kt ku kv kw b">package.json</code>。这就是我们客户需要的。可以看到，除了element-ui和moment，都是GraphQL/Apollo相关的。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="3ecd" class="lf lg iq kw b gy lh li l lj lk">{<br/>  ...<br/>  "dependencies": {<br/>    "apollo-cache-inmemory": "1.2.5",<br/>    "apollo-client": "2.3.5",<br/>    "apollo-link": "1.2.2",<br/>    "apollo-link-error": "1.1.0",<br/>    "apollo-link-http": "1.5.4",<br/>    "element-ui": "2.4.3",<br/>    "graphql": "0.13.2",<br/>    "graphql-tag": "2.9.2",<br/>    "moment": "2.22.2",<br/>    "vue-apollo": "3.0.0-beta.19",<br/>    "vue": "^2.5.16",<br/>    "vue-router": "^3.0.1",<br/>    "vuex": "^3.0.1"<br/>  },<br/>  ...<br/>}</span></pre><p id="1455" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">安装依赖项:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="7684" class="lf lg iq kw b gy lh li l lj lk">yarn</span></pre><p id="ad3f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在<code class="fe kt ku kv kw b">main.js</code>中，安装库并为Apollo添加一些样板代码:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="d047" class="lf lg iq kw b gy lh li l lj lk">import Vue from 'vue'<br/>import { ApolloClient } from 'apollo-client'<br/>import { InMemoryCache } from 'apollo-cache-inmemory'<br/>import { onError } from "apollo-link-error"<br/>import { ApolloLink } from 'apollo-link'<br/>import { HttpLink } from 'apollo-link-http'<br/>import { enableExperimentalFragmentVariables } from 'graphql-tag'<br/>import VueApollo from 'vue-apollo'<br/>import ElementUI from 'element-ui'</span><span id="d28d" class="lf lg iq kw b gy ll li l lj lk">import App from './App.vue'<br/>import router from './router'<br/>import store from './store'</span><span id="58e1" class="lf lg iq kw b gy ll li l lj lk">import 'element-ui/lib/theme-chalk/index.css'</span><span id="9a03" class="lf lg iq kw b gy ll li l lj lk">Vue.use(ElementUI)</span><span id="6591" class="lf lg iq kw b gy ll li l lj lk">Vue.config.productionTip = false</span><span id="7e79" class="lf lg iq kw b gy ll li l lj lk">const uri = `${process.env.VUE_APP_URI}/graphql`<br/>const httpLink = new HttpLink({uri})</span><span id="81c8" class="lf lg iq kw b gy ll li l lj lk">const cache = new InMemoryCache({})</span><span id="3a39" class="lf lg iq kw b gy ll li l lj lk">const errorLink = onError(({ graphQLErrors, networkError }) =&gt; {<br/>  if (graphQLErrors)<br/>    graphQLErrors.map(({ message, locations, path }) =&gt;<br/>      console.log(<br/>        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`<br/>      )<br/>    )<br/>  if (networkError) console.log(`[Network error]: ${networkError}`)<br/>})</span><span id="caeb" class="lf lg iq kw b gy ll li l lj lk">const client = new ApolloClient({<br/>  link: ApolloLink.from([<br/>    errorLink,<br/>    httpLink<br/>  ]),<br/>  cache,<br/>  connectToDevTools: true,<br/>})</span><span id="41ed" class="lf lg iq kw b gy ll li l lj lk">const apolloProvider = new VueApollo({<br/>  defaultClient: client,<br/>  defaultOptions: {<br/>    $loadingKey: 'loading'<br/>  }<br/>})</span><span id="3520" class="lf lg iq kw b gy ll li l lj lk">Vue.use(VueApollo)</span><span id="3874" class="lf lg iq kw b gy ll li l lj lk">new Vue({<br/>  router,<br/>  provide: apolloProvider.provide(),<br/>  store,<br/>  render: h =&gt; h(App)<br/>}).$mount('#app')</span></pre><p id="5934" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">创建<code class="fe kt ku kv kw b">.env.development</code>并为后端API定义环境变量:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="aa01" class="lf lg iq kw b gy lh li l lj lk">VUE_APP_URI=<a class="ae kp" href="http://localhost:5500" rel="noopener ugc nofollow" target="_blank">http://localhost:5500</a></span></pre><p id="7081" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">CSS文件太长，无法放在这里。您可以从<a class="ae kp" href="https://github.com/kenzotakahashi/enamel/tree/part2/client/src/assets/css" rel="noopener ugc nofollow" target="_blank">库</a>中复制粘贴<code class="fe kt ku kv kw b">style.scss</code>和<code class="fe kt ku kv kw b">variables.scss</code>。</p><p id="976a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">创建<code class="fe kt ku kv kw b">vue.config.js</code>并添加以下内容:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="077f" class="lf lg iq kw b gy lh li l lj lk">//client/vue.config.js<br/>module.exports = {<br/>  devServer: {<br/>    port: 8080,<br/>    proxy: '<a class="ae kp" href="http://localhost:5500'" rel="noopener ugc nofollow" target="_blank">http://localhost:5500'</a><br/>  },<br/>  configureWebpack: {<br/>    module: {<br/>      rules: [<br/>        {<br/>          test: /\.(graphql|gql)$/,<br/>          exclude: /node_modules/,<br/>          loader: 'graphql-tag/loader'<br/>        }<br/>      ]<br/>    }<br/>  },<br/>  css: {<br/>    loaderOptions: {<br/>      sass: {<br/>        data: `<a class="ae kp" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank">@import</a> "@/assets/css/variables.scss";`<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="a57f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们将在客户端使用graphQL文件，所以我们需要在这里定义一个加载器。</p><p id="4e8c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我希望scss变量可以从所有组件中访问，而不需要手动导入，所以我在这里导入<code class="fe kt ku kv kw b">variables.scss</code>。</p><p id="1d29" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">将路线模式改为<code class="fe kt ku kv kw b">history</code></p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="8c11" class="lf lg iq kw b gy lh li l lj lk">client/src/router.js<br/>import Vue from 'vue'<br/>import Router from 'vue-router'<br/>import Home from './views/Home.vue'</span><span id="201d" class="lf lg iq kw b gy ll li l lj lk">Vue.use(Router)</span><span id="fc4c" class="lf lg iq kw b gy ll li l lj lk">export default new Router({<br/>  mode: 'history',<br/>  ...<br/>})</span></pre><p id="0135" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">删除<code class="fe kt ku kv kw b">App.vue</code>中的样本代码，替换为:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="0ae6" class="lf lg iq kw b gy lh li l lj lk">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;router-view&gt;&lt;/router-view&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="a471" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">最后，Home.vue中的captureEmail页面:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="d8b5" class="lf lg iq kw b gy lh li l lj lk">//client/src/views/Home.vue<br/>&lt;template&gt;<br/>  &lt;el-container&gt;<br/>    &lt;el-header&gt;<br/>    &lt;/el-header&gt;</span><span id="17a1" class="lf lg iq kw b gy ll li l lj lk">&lt;el-main&gt;<br/>      &lt;div class="container-center"&gt;<br/>        &lt;h2&gt;Welcome!&lt;/h2&gt;<br/>        &lt;div&gt;Enter your email address to start free trial&lt;/div&gt;</span><span id="6caa" class="lf lg iq kw b gy ll li l lj lk">&lt;div v-if="error" class="error"&gt;<br/>          {{ error }}<br/>        &lt;/div&gt;</span><span id="f09d" class="lf lg iq kw b gy ll li l lj lk">&lt;el-form ref="form" :model="form"&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;label&gt;Email&lt;/label&gt;<br/>            &lt;el-input v-model="form.email" placeholder="Email"&gt;&lt;/el-input&gt;<br/>          &lt;/el-form-item&gt;<br/>          &lt;el-form-item&gt;<br/>            &lt;el-button type="primary" &gt;Create my enamel account&lt;/el-button&gt;<br/>          &lt;/el-form-item&gt;<br/>        &lt;/el-form&gt;</span><span id="c1d6" class="lf lg iq kw b gy ll li l lj lk">&lt;div&gt;<br/>          &lt;span&gt;Already have an enamel account?&lt;/span&gt;<br/>          &lt;router-link :to="{name: 'login'}" class="link"&gt;Log in&lt;/router-link&gt;<br/>        &lt;/div&gt;</span><span id="371c" class="lf lg iq kw b gy ll li l lj lk">&lt;div v-if="submitted"&gt;<br/>          &lt;div&gt;Thank you!&lt;/div&gt;<br/>          &lt;div&gt;Please check your email.&lt;/div&gt;<br/>        &lt;/div&gt; <br/>      &lt;/div&gt;</span><span id="b253" class="lf lg iq kw b gy ll li l lj lk">&lt;/el-main&gt;<br/>  &lt;/el-container&gt;</span><span id="bdfd" class="lf lg iq kw b gy ll li l lj lk">&lt;/template&gt;</span><span id="f8da" class="lf lg iq kw b gy ll li l lj lk">&lt;script&gt;</span><span id="0d08" class="lf lg iq kw b gy ll li l lj lk">export default {<br/>  data() {<br/>    return {<br/>      submitted: false,<br/>      error: false,<br/>      form: {<br/>        email: '',<br/>      }<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span><span id="9ae6" class="lf lg iq kw b gy ll li l lj lk">&lt;style scoped lang="scss"&gt;<br/>.el-button {<br/>  width: 100%;<br/>}</span><span id="ae36" class="lf lg iq kw b gy ll li l lj lk">.error {<br/>  padding-top: 10px;<br/>}</span><span id="9772" class="lf lg iq kw b gy ll li l lj lk">&lt;/style&gt;</span></pre><p id="f104" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">现在，如果您转到一个根URL，它应该是这样的:</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mz"><img src="../Images/1c1b2365f47f748e69efe4bc4298e18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XoxffRE_AUFMWteaZgI27g.png"/></div></div></figure><p id="e44c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">唷，代码太多了！它甚至什么都不做！</p><h1 id="efd8" class="lm lg iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">捕获电子邮件</h1><p id="9adf" class="pw-post-body-paragraph jq jr iq jt b ju mj jw jx jy mk ka kb kq ml ke kf kr mm ki kj ks mn km kn ko ij bi translated">终于到了使用阿波罗客户端的时候了。创建<code class="fe kt ku kv kw b">constants/query.gql</code>并放置我们在操场上使用的相同代码:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="cc9d" class="lf lg iq kw b gy lh li l lj lk">//client/src/constatnts/query.gql<br/>mutation CaptureEmail($email: String!) {<br/>  captureEmail(email: $email) {<br/>    id<br/>    email<br/>  }<br/>}</span></pre><p id="3b2b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们还将在<code class="fe kt ku kv kw b">helpers/helpers.js</code>中定义一个验证函数，因此在<code class="fe kt ku kv kw b">src</code>中创建文件夹。</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="0aa1" class="lf lg iq kw b gy lh li l lj lk">//client/src/helpers/helpers.js<br/>export function validateEmail(email) {<br/>  const re = /^(([^&lt;&gt;()\[\]\\.,;:\s@"]+(\.[^&lt;&gt;()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;<br/>  return re.test(String(email).toLowerCase())<br/>}</span></pre><p id="480e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">您可以使用类似Vue-validate的东西进行验证。这是一个强大的库，但我想保持简单，不要在库上回复太多。</p><p id="e771" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们差不多完成了。回到<code class="fe kt ku kv kw b">Home.vue</code>。向提交按钮添加事件处理程序:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="1358" class="lf lg iq kw b gy lh li l lj lk">&lt;el-button type="primary" <a class="ae kp" href="http://twitter.com/click" rel="noopener ugc nofollow" target="_blank">@click</a>="capture"&gt;Create my enamel account&lt;/el-button&gt;</span></pre><p id="6faf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">导入查询和验证函数。<code class="fe kt ku kv kw b">capture</code>方法看起来是这样的:</p><pre class="kx ky kz la gt lb kw lc ld aw le bi"><span id="e935" class="lf lg iq kw b gy lh li l lj lk">&lt;script&gt;<br/>import { CaptureEmail } from '../constants/query.gql'<br/>import { validateEmail } from '@/helpers/helpers'</span><span id="0dec" class="lf lg iq kw b gy ll li l lj lk">export default {<br/>  ...<br/>  methods: {<br/>    capture() {<br/>      const {email} = this.form<br/>      if (!email || !validateEmail(email)) {<br/>        this.error = 'Please enter a valid email'<br/>        return<br/>      }<br/>      this.$apollo.mutate({<br/>        mutation: CaptureEmail,<br/>        variables: {email}<br/>      }).then(({data}) =&gt; {<br/>        this.submitted = true<br/>        this.error = false<br/>        // For development only<br/>        console.log(data.captureEmail.id)<br/>      }).catch((error) =&gt; {<br/>        if (error.graphQLErrors.length &gt;= 1) {<br/>          this.error = error.graphQLErrors[0].message            <br/>        } else {<br/>          this.error = 'Something went wrong'<br/>        }<br/>        console.log(error)<br/>      })</span><span id="df70" class="lf lg iq kw b gy ll li l lj lk">    },<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="5241" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">首先，它验证电子邮件。如果有效，调用Apollo变异方法，用email作为变量。然后，如果一切正常，将<code class="fe kt ku kv kw b">this.submitted</code>设置为真并显示一条消息。否则，显示一条错误消息。Apollo错误是graphQLErrors或NetworkError。因此，如果错误对象有graphQLErrors，则显示消息。在这种情况下，就是邮件已经被占用了。否则这是一个网络错误，所以我们只显示一个普通的错误消息。</p><p id="0c36" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">你可以在这里了解更多关于错误处理<a class="ae kp" href="https://www.apollographql.com/docs/react/features/error-handling.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="8750" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果您输入的电子邮件与您在playground中使用的不同，您应该会看到下面的消息。</p><figure class="kx ky kz la gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi na"><img src="../Images/109565e621f06999b6668ec85aec5c15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzRQ6RauJfNpRPegX7ALiQ.png"/></div></div></figure><p id="df68" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">你也可以尝试输入一个无效的电子邮件或电子邮件已经采取，并确认他们得到妥善处理。</p><p id="b3c9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">第2部分到此为止！如有需要，可查看<a class="ae kp" href="https://github.com/kenzotakahashi/enamel/tree/part2" rel="noopener ugc nofollow" target="_blank"> github </a>作为参考。</p><p id="d7f1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在<a class="ae kp" href="https://medium.com/@kenzotakahashi2/build-a-project-management-tool-with-vue-js-node-js-and-apollo-part-3-69a7bf9f2f1b" rel="noopener">第3部分</a>中，我们将创建认证。</p><p id="1a88" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果你喜欢这篇文章，请给它一些掌声！这激励我尽快写下一部分。</p></div></div>    
</body>
</html>