<html>
<head>
<title>How to Build an Event-Driven ASP.NET Core Microservice Architecture</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建事件驱动的ASP.NET核心微服务架构</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-an-event-driven-asp-net-core-microservice-architecture-e0ef2976f33f?source=collection_archive---------0-----------------------#2021-05-16">https://itnext.io/how-to-build-an-event-driven-asp-net-core-microservice-architecture-e0ef2976f33f?source=collection_archive---------0-----------------------#2021-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1400" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用RabbitMQ、C#、REST-API和实体框架进行异步解耦通信，并最终与集成事件和发布-订阅保持一致</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/55b6023e5327bdfeb0f2ba4e0f89effb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*KjRCx2BzuGXCPQy-xIoC_Q.png"/></div></figure><p id="3c90" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本指南中，您将<strong class="kp ir">创建两个c# ASP.NET核心微服务</strong>。两个微服务都有它们自己的<strong class="kp ir">有界上下文和域模型</strong>。每个微服务都有自己的<strong class="kp ir">数据库和REST API </strong>。一个微服务发布另一个微服务消费的<strong class="kp ir">集成事件</strong>。</p></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="491e" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">解耦微服务——一个真实的代码示例</h1><p id="e2f9" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">该应用程序使用了一个真实世界的例子，用户<strong class="kp ir">可以写文章</strong>。用户微服务允许创建和编辑用户。<strong class="kp ir">在用户域中，用户实体有几个属性</strong>，如名称、邮件等。在post域中，还有一个用户，因此post微服务可以加载帖子并显示作者，而无需访问用户微服务。post域中的用户实体简单得多:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/39aae7414b60686feda1c8beaa3a4c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CgPKfmHdDLfSbosnCcR33g.png"/></div></div></figure><p id="368d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">微服务<strong class="kp ir">解耦</strong>并且<strong class="kp ir">异步通信</strong>导致<strong class="kp ir">最终一致性</strong>。这种架构是松散耦合服务(T21)的基础，支持高可伸缩性。微服务通过<strong class="kp ir">实体框架</strong>访问它们的<strong class="kp ir">示例Sqlite数据库</strong>，并通过<strong class="kp ir"> RabbitMQ </strong>交换消息(例如在Docker桌面上)。</p><p id="2210" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="ms">工作流程、组件和技术概述图:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mt"><img src="../Images/b41d9cfe85ecac425b4b3d197d7623fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBI724d-APCSGAYo5m3zcg.png"/></div></div></figure><blockquote class="mu mv mw"><p id="9b3b" class="kn ko ms kp b kq kr jr ks kt ku ju kv mx kx ky kz my lb lc ld mz lf lg lh li ij bi translated">本文中的代码和配置不适合生产使用。本指南侧重于概念和组件如何交互。为此，错误处理等。省略。</p></blockquote><h2 id="bc88" class="na lr iq bd ls nb nc dn lw nd ne dp ma kw nf ng mc la nh ni me le nj nk mg nl bi translated">本指南的步骤</h2><ol class=""><li id="cfab" class="nm nn iq kp b kq mi kt mj kw no la np le nq li nr ns nt nu bi translated">创建。网络核心微服务</li><li id="dd64" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li nr ns nt nu bi translated">使用RabbitMQ并配置交换和管道</li><li id="257c" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li nr ns nt nu bi translated">发布和消费微服务中的集成事件</li><li id="dd6e" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li nr ns nt nu bi translated">测试工作流程</li><li id="5248" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li nr ns nt nu bi translated">最后的想法和展望</li></ol></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="4998" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">1.创建。网络核心微服务</h1><p id="45a5" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">在本指南的第一部分，您将<strong class="kp ir">创建用户并发布微服务</strong>。您将<strong class="kp ir">添加实体和基本Web API</strong>。实体将通过实体框架从<strong class="kp ir"> Sqlite数据库</strong>中<strong class="kp ir">存储和检索。可选地，您可以在浏览器中使用<strong class="kp ir"> Swagger UI </strong>测试用户微服务。</strong></p><h2 id="9bdd" class="na lr iq bd ls nb nc dn lw nd ne dp ma kw nf ng mc la nh ni me le nj nk mg nl bi translated">让我们开始吧。</h2><p id="3618" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated"><strong class="kp ir">用ASP.NET和web开发工作量安装</strong> <a class="ae oa" href="https://visualstudio.microsoft.com/en/vs/community/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> Visual Studio社区</strong> </a>(免费)。</p><p id="658e" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">创建一个解决方案</strong>并添加两个ASP.NET Core 5 Web API项目“UserService”和“PostService”。禁用HTTPS并激活OpenAPI支持。</p><p id="0d0a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">对于这两个项目<strong class="kp ir">，安装以下NuGet包</strong>:</p><ul class=""><li id="5571" class="nm nn iq kp b kq kr kt ku kw ob la oc le od li oe ns nt nu bi translated">微软。实体框架工作核心工具</li><li id="d9cd" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">微软。EntityFrameworkCore.Sqlite</li><li id="4091" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">纽顿软件。Json</li><li id="7e73" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">RabbitMQ。客户</li></ul><h2 id="12db" class="na lr iq bd ls nb nc dn lw nd ne dp ma kw nf ng mc la nh ni me le nj nk mg nl bi translated">实现用户服务</h2><p id="0370" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">创建用户实体:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="0dbd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建用户服务上下文:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="258a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">编辑Startup.cs </strong>配置UserServiceContext使用Sqlite并调用<em class="ms">数据库。EnsureCreated() </em>确保数据库包含实体模式:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="03b5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">创建用户控制器</strong>(它只实现本演示所需的方法):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="6f54" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">调试UserService项目，它将启动您的浏览器。您可以使用swagger UI来测试创建和读取用户是否有效:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oh"><img src="../Images/429887c88fe776d048e56e9ceccf9d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TufSfAX0F9Gs2xlrRgsZ2Q.png"/></div></div></figure><h2 id="8799" class="na lr iq bd ls nb nc dn lw nd ne dp ma kw nf ng mc la nh ni me le nj nk mg nl bi translated">实施邮政服务</h2><p id="99af" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">创建用户和发布实体:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="3526" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建PostServiceContext:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="e956" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">编辑startup.cs </strong>配置UserServiceContext使用Sqlite并调用<em class="ms">数据库。EnsureCreated() </em>确保数据库包含实体模式:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="8864" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建后控制器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="45cd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">目前，您不能插入帖子，因为PostService数据库中没有用户。</p><h1 id="feed" class="lq lr iq bd ls lt oi lv lw lx oj lz ma jw ok jx mc jz ol ka me kc om kd mg mh bi translated">2.使用RabbitMQ并配置交换和管道</h1><p id="b4ba" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">在本指南的第二部分，您将<strong class="kp ir">让RabbitMQ运行</strong>。然后您将<strong class="kp ir">使用RabbitMQ admin web UI为应用程序配置交换和管道</strong>。您可以选择使用admin UI向RabbitMQ发送消息。</p><p id="589f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="ms">此图显示了用户服务如何向RabbitMQ发布消息，以及PostService和潜在的其他服务如何使用这些消息:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi on"><img src="../Images/85890decaf3d6d1349488f357b45a70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8oytI-Z7gw1Sp26CxGEng.png"/></div></div></figure><p id="7769" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让RabbitMQ运行起来最简单的方法就是<strong class="kp ir">安装</strong> <a class="ae oa" href="https://hub.docker.com/editions/community/docker-ce-desktop-windows" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> Docker桌面</strong> </a>。然后<strong class="kp ir">发出下面的命令</strong>(在控制台窗口的一行中)用admin UI启动RabbitMQ容器:</p><pre class="kg kh ki kj gt oo op oq or aw os bi"><span id="c360" class="na lr iq op b gy ot ou l ov ow">C:\dev&gt;docker run -d  -p 15672:15672 -p 5672:5672 --hostname my-rabbit --name some-rabbit rabbitmq:3-management</span></pre><p id="10d8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">在端口15672上打开浏览器</strong>，使用用户名“guest”和密码“guest”登录。使用web UI<strong class="kp ir">创建一个名为“user”类型的交换</strong>和<strong class="kp ir">两个队列</strong>“user . postservice”和“user.otherservice”。</p><blockquote class="mu mv mw"><p id="6d7f" class="kn ko ms kp b kq kr jr ks kt ku ju kv mx kx ky kz my lb lc ld mz lf lg lh li ij bi translated">使用“Fanout”类型很重要，这样交换就可以将消息复制到所有连接的队列中。</p></blockquote><p id="f4c5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您还可以使用web UI将消息发布到exchange，并查看它们是如何排队的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi ox"><img src="../Images/1ea1ea18d100e1f0ac171bf4fda553e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*YRD8fLl_NoNGRwLK7w6lww.png"/></div></div></figure></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="cfb8" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">3.发布和消费微服务中的集成事件</h1><p id="f5d9" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">在指南的这一部分，您将<strong class="kp ir">带上。NET微服务和RabbitMQ一起</strong>。<strong class="kp ir">用户服务发布</strong>事件。<strong class="kp ir"> PostService使用</strong>事件，而<strong class="kp ir">在其数据库</strong>中添加/更新用户。</p><p id="2397" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">修改用户服务。UserController </strong>发布用户创建和更新RabbitMQ的集成事件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure><blockquote class="mu mv mw"><p id="bb75" class="kn ko ms kp b kq kr jr ks kt ku ju kv mx kx ky kz my lb lc ld mz lf lg lh li ij bi translated">在这些示例中，连接和其他RabbitMQ对象没有正确关闭。它们也应该被重用。见<a class="ae oa" href="https://www.rabbitmq.com/tutorials/tutorial-one-dotnet.html" rel="noopener ugc nofollow" target="_blank">官方RabbitMQ。NET教程</a>和<a class="ae oa" rel="noopener ugc nofollow" target="_blank" href="/the-outbox-pattern-in-event-driven-asp-net-core-microservice-architectures-10b8d9923885">我的后续文章</a>。</p></blockquote><p id="acd5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">修改(</strong>和<em class="ms">误用</em> <strong class="kp ir">)后期服务。编程</strong>以订阅集成事件并将更改应用到后期服务数据库:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="60c4" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">4.测试工作流程</h1><p id="482d" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">在本指南的最后部分，您将测试整个工作流程:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mt"><img src="../Images/b41d9cfe85ecac425b4b3d197d7623fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nBI724d-APCSGAYo5m3zcg.png"/></div></div></figure><p id="87c2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">本指南最后部分的步骤总结</strong>(您可以通过Swagger UI访问服务):</p><ul class=""><li id="3eb5" class="nm nn iq kp b kq kr kt ku kw ob la oc le od li oe ns nt nu bi translated">调用UserService REST API，并向用户数据库添加一个用户</li><li id="dc45" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">UserService将创建一个事件，由PostService使用，并将用户添加到post DB中</li><li id="529b" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">访问PostService REST API并为用户添加一篇文章。</li><li id="742b" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">调用PostService REST API并从post数据库中加载文章和用户</li><li id="19cc" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">调用UserService REST API并重命名用户</li><li id="3e38" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">UserService将创建一个事件，由PostService使用并更新post DB中的用户名</li><li id="891d" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated">调用PostService REST API并从post数据库中加载post和重命名的用户</li></ul><blockquote class="mu mv mw"><p id="5808" class="kn ko ms kp b kq kr jr ks kt ku ju kv mx kx ky kz my lb lc ld mz lf lg lh li ij bi translated">用户数据库必须为空。如果您在本指南的前面步骤中创建了用户，则可以删除user.db(在Visual Studio资源管理器中)。数据库调用。EnsureCreated()将在启动时重新创建数据库。</p></blockquote><p id="a4e6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">配置两个项目作为服务运行</strong>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oy"><img src="../Images/fa0c793df7beb4ff2b897d2c97eb067c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQTbsd6i8oaxZvPAJm076w.png"/></div></div></figure><p id="e6d8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">将PostService的App-URL更改为另一个端口</strong>(例如<a class="ae oa" href="http://localhost:5001" rel="noopener ugc nofollow" target="_blank"> http://localhost:5001 </a>)，这样两个项目可以并行运行。将解决方案配置为启动两个项目并开始调试:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi oz"><img src="../Images/e535eef28f70d28481a498ab249aa37a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxKmZRU52XKvpRUZ_0q-Gg.png"/></div></div></figure><p id="8f24" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">使用Swagger UI在用户服务中创建用户:</p><pre class="kg kh ki kj gt oo op oq or aw os bi"><span id="9c51" class="na lr iq op b gy ot ou l ov ow">{<br/> "name": "Chris",<br/> "mail": "chris@chris.com",<br/> "otherData": "Some other data"<br/>}</span></pre><p id="8221" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在您的环境中，生成的用户Id可能会有所不同:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/30f6d790b73e5dca360aacf14e731e60.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*irm6bDO86SNAURShpWWT6w.png"/></div></figure><p id="6016" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">集成事件将用户复制到PostService:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/aa5972fe12e9fa9add4697a1e4b92563.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*K8qzwMngXwwR6PzhnFYaTQ.png"/></div></figure><p id="0882" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，您可以在PostServive Swagger UI中创建帖子(使用您的用户Id):</p><pre class="kg kh ki kj gt oo op oq or aw os bi"><span id="1930" class="na lr iq op b gy ot ou l ov ow">{<br/>  "title": "MyFirst Post",<br/>  "content": "Some interesting text",<br/>  "userId": 1<br/>}</span></pre><p id="5de1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">阅读所有帖子。用户名包含在结果中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/9ca8b50b038ff81e009f026c62b55493.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*5Jmh4yzAnARKeQQp96wMCA.png"/></div></figure><p id="7f2f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在用户服务Swagger UI中更改用户名:</p><pre class="kg kh ki kj gt oo op oq or aw os bi"><span id="b7b6" class="na lr iq op b gy ot ou l ov ow">{<br/>  "id": 1,<br/>  "name": "My new name"<br/>}</span></pre><p id="3efe" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后再次阅读帖子，并查看更改后的用户名:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/66181505305c86054bd25b3601524503.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*xNOsX0lltHO-nG9LaEbHQA.png"/></div></figure></div><div class="ab cl lj lk hu ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="ij ik il im in"><h1 id="e9ba" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">5.最后的想法和展望</h1><p id="5529" class="pw-post-body-paragraph kn ko iq kp b kq mi jr ks kt mj ju kv kw mk ky kz la ml lc ld le mm lg lh li ij bi translated">您为事件驱动的微服务架构创建了<strong class="kp ir">工作基础。</strong>除了数据复制，您还可以将其用于经典的生产者-消费者工作流、传奇等。</p><p id="2d66" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">请确保<strong class="kp ir">调整代码以在生产环境中使用</strong> : <strong class="kp ir">清理代码</strong>和<strong class="kp ir">应用安全最佳实践。</strong>申请。NET核心设计模式、错误处理等。</p><p id="5790" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">目前，当RabbitMQ或微服务崩溃时，消息可能会在边缘情况下丢失。参见我的后续文章<a class="ae oa" rel="noopener ugc nofollow" target="_blank" href="/the-outbox-pattern-in-event-driven-asp-net-core-microservice-architectures-10b8d9923885"> <strong class="kp ir">如何应用事务性发件箱模式，让应用更有弹性</strong> </a>。</p><p id="ca2f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">请参阅我的其他文章，了解如何:</p><ul class=""><li id="425e" class="nm nn iq kp b kq kr kt ku kw ob la oc le od li oe ns nt nu bi translated"><a class="ae oa" rel="noopener ugc nofollow" target="_blank" href="/how-to-use-database-sharding-and-scale-an-asp-net-core-microservice-architecture-22c24916590f"> <strong class="kp ir">使用数据库分片并扩展您的应用</strong> </a></li><li id="2c8d" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated"><a class="ae oa" href="https://levelup.gitconnected.com/kubernetes-angular-asp-net-core-microservice-architecture-c46fc66ede44" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir">将您的ASP.NET核心应用程序部署到Kubernetes，使用Angular作为UI </strong> </a></li><li id="d3e6" class="nm nn iq kp b kq nv kt nw kw nx la ny le nz li oe ns nt nu bi translated"><a class="ae oa" rel="noopener ugc nofollow" target="_blank" href="/databases-in-a-kubernetes-angular-net-core-microservice-arch-a0c0ae23dca9"> <strong class="kp ir">添加MySql和MongoDB数据库</strong> </a>。</li></ul><p id="37a2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你有任何问题、想法或建议，请联系我。</p></div></div>    
</body>
</html>