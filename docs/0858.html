<html>
<head>
<title>Getting Started With TypeScript in Unreal Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">虚幻引擎中的TypeScript入门</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-typescript-in-unreal-engine-f1a70adb624?source=collection_archive---------3-----------------------#2018-06-10">https://itnext.io/getting-started-with-typescript-in-unreal-engine-f1a70adb624?source=collection_archive---------3-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d65aecee0960189d534b2fc5bc9e3a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Re6J_9bw9twIrdOCEeZxCg.png"/></div></div></figure><p id="14dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能听说过像《堡垒之夜》和《未知玩家的战场》这样的游戏。这两款游戏都是在虚幻引擎4中构建的。虚幻引擎一直是AAA游戏开发商和独立工作室的最爱。自从Epic Games在2015年发布免费使用的引擎以来，许多热切的开发者和爱好者已经尝试在强大的3D引擎中创建游戏。大多数爱好者和小团队选择引擎内置的蓝图编辑器，而不是C++中的脚本。虽然Unreal的blueprint editor使用起来非常简单，但对于一些开发人员来说，在GUI界面中连接许多节点似乎很麻烦。幸运的是，JavaScript社区总能找到将他们最喜欢的语言与任何东西配对的方法，因此给我们带来了<a class="ae kw" href="https://github.com/ncsoft/Unreal.js" rel="noopener ugc nofollow" target="_blank">虚幻。JS </a>。Unreal.js是Unreal Engine的V8运行时，它可以替代现有的C++和Blueprint脚本，或者与现有的c++和blue print脚本一起运行。唯一能让用JS开发大型3D游戏变得更容易的是无限可伸缩的TypeScript。在这里，我将向您展示如何开始使用Unreal.js和TypeScript。</p><p id="022e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，如果你还没有，通过Epic Games Launcher安装虚幻引擎。接下来，在启动器中进入市场，找到Unreal.js，然后运行“安装到引擎”。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/91648046f7d6a4132298bde6d4fddf10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3lfG27WKE6wVamH_7Fh0_w.png"/></div></div></figure><p id="5880" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开虚幻引擎，创建一个新项目。在这个例子中，我创建了一个第三人称蓝图项目。</p><p id="fcc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开编辑器后，进入“编辑&gt;插件”并确保“虚幻JS”已启用。如果没有，启用它，您将看到一个提示，要求重新启动编辑器。</p><p id="2956" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在项目的内容文件夹中，您应该会看到一个名为“脚本”的文件夹。如果没有安装typescript，可以通过运行</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="868e" class="lh li iq ld b gy lj lk l ll lm">npm install -g typescript</span></pre><p id="b9f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，打开您的终端，导航到脚本文件夹并运行</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="993d" class="lh li iq ld b gy lj lk l ll lm">tsc --init</span></pre><p id="eccc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这会生成一个tsconfig.json文件。打开文件，根据您的喜好更改设置。在底部，我们将从Unreal.js中排除“aliases.js”文件。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="56eb" class="lh li iq ld b gy lj lk l ll lm">tsconfig.json<br/>...<br/>...</span><span id="f8ad" class="lh li iq ld b gy ln lk l ll lm">// "emitDecoratorMetadata": true,         /* Enables experimental          support for emitting type metadata for decorators. */</span><span id="3d70" class="lh li iq ld b gy ln lk l ll lm">},</span><span id="1ace" class="lh li iq ld b gy ln lk l ll lm"> "exclude": [</span><span id="c0a5" class="lh li iq ld b gy ln lk l ll lm">   "aliases.js"</span><span id="e8b0" class="lh li iq ld b gy ln lk l ll lm">  ]</span><span id="1e12" class="lh li iq ld b gy ln lk l ll lm">}</span></pre><p id="744a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在您喜欢的编辑器中打开Scripts文件夹，创建一个名为“helloUnreal.ts”的文件。</p><p id="8957" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们只添加一个控制台消息。在文件中添加</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="7277" class="lh li iq ld b gy lj lk l ll lm">console.log(’HELLO UNREAL!’)</span></pre><p id="424b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在我们的终端中，让我们运行TypeScript编译器。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9d3f" class="lh li iq ld b gy lj lk l ll lm">tsc helloUnreal.ts</span></pre><p id="2f78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这应该会创建一个“helloUnreal.js”文件。</p><p id="53ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开虚幻编辑器，在第三个人示例地图中，转到“蓝图”并打开事件图。在事件图中，我们将添加一个在游戏开始时触发的事件，名为“EventBeginPlay”。添加事件的最简单方法是右键单击蓝图并搜索它。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/0c51eb8adbf1c5a7e71b6a53088517cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-hcqCDv_UzEC8d6W_A0zA.png"/></div></div></figure><p id="7cae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们将找到使用相同方法添加JavaScript组件的函数，并通过单击和拖动将两个节点连接在一起。选择JavaScript组件，然后在编辑器右侧的“Details”选项卡上，将我们的“helloUnreal.js”文件添加到“脚本源文件”输入框中。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/77ee7ac1c5e7457d439d9fdb99cbc174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkuWGvpGZHEgF1HkFp6Bwg.png"/></div></div></figure><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/0e945183b20fae1ed3de4f66d884c9a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*jSph02f0TvQHIlOCsF6w1Q.png"/></div></figure><p id="2a9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，确保点击“编译”和“保存”，这应该是它。现在我们可以打开JavaScript控制台并测试我们的代码。转到“窗口&gt;开发工具&gt; Javascript控制台”并打开控制台。</p><p id="8f3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在点击“播放”按钮，运行游戏。在控制台中，您应该会看到“HELLO UNREAL！”我们之前添加的消息。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/57718e3ae892a78910e9d5f61ec501b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*DnxSdpzvarC7mOzVi5PeQg.png"/></div></figure><h1 id="cf31" class="ls li iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">使用TypeScript创建HUD信息</h1><p id="34d7" class="pw-post-body-paragraph jy jz iq ka b kb mp kd ke kf mq kh ki kj mr kl km kn ms kp kq kr mt kt ku kv ij bi translated">好了，现在让我们试着用Unreal.js对我们的游戏做点什么。首先，为了启动一个实时重载开发环境，让我们创建一个名为“bootstrap.ts”的引导文件，它将遵循<a class="ae kw" href="https://github.com/ncsoft/Unreal.js/blob/master/Examples/Content/Scripts/bootstrap.js" rel="noopener ugc nofollow" target="_blank"> Unreal.js示例</a>。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="6550" class="lh li iq ld b gy lj lk l ll lm">/// &lt;reference path="typings/ue.d.ts"&gt;/&gt;</span><span id="5af8" class="lh li iq ld b gy ln lk l ll lm">export default function (filename:string) {</span><span id="b91c" class="lh li iq ld b gy ln lk l ll lm">    Context.RunFile('aliases.js')</span><span id="b24f" class="lh li iq ld b gy ln lk l ll lm">    Context.RunFile('polyfill/unrealengine.js')</span><span id="ba7b" class="lh li iq ld b gy ln lk l ll lm">    Context.RunFile('polyfill/timers.js')</span><span id="db12" class="lh li iq ld b gy ln lk l ll lm">  require('devrequire')(filename)</span><span id="71e8" class="lh li iq ld b gy ln lk l ll lm">}</span></pre><p id="47d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们运行TypeScript来观察我们用</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9cd2" class="lh li iq ld b gy lj lk l ll lm">tsc -w</span></pre><p id="3103" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们打印我们的“你好不真实！”通过创建一个演员向HUD发送消息。以<a class="ae kw" href="https://github.com/ncsoft/Unreal.js/blob/master/Examples/Content/Scripts/helloCanvas.js" rel="noopener ugc nofollow" target="_blank"> helloCanvas为例</a>。打开helloUnreal.ts并添加以下代码:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="c327" class="lh li iq ld b gy lj lk l ll lm">/// &lt;reference path="typings/ue.d.ts"&gt;/&gt;</span><span id="ad9a" class="lh li iq ld b gy ln lk l ll lm">// find a local player controller</span><span id="7fe2" class="lh li iq ld b gy ln lk l ll lm">function GetPC() {</span><span id="a455" class="lh li iq ld b gy ln lk l ll lm">// out-ref function returns an object which contains out-ref params and return param.</span><span id="9d42" class="lh li iq ld b gy ln lk l ll lm">// eg) bool USomeClass::Func(int a, int* b, int* c); -&gt; {$:{bool}, b:{int}, c:{int}}</span><span id="1932" class="lh li iq ld b gy ln lk l ll lm">return PlayerController.C(GWorld.GetAllActorsOfClass(PlayerController).OutActors[0])</span><span id="f519" class="lh li iq ld b gy ln lk l ll lm">}</span><span id="8d4d" class="lh li iq ld b gy ln lk l ll lm">function main(){</span><span id="de50" class="lh li iq ld b gy ln lk l ll lm"> class MyHUD extends HUD {</span><span id="7b05" class="lh li iq ld b gy ln lk l ll lm">    ctor() {</span><span id="2086" class="lh li iq ld b gy ln lk l ll lm">    }</span><span id="a100" class="lh li iq ld b gy ln lk l ll lm">// override ReceiveDrawHUD</span><span id="c444" class="lh li iq ld b gy ln lk l ll lm">   ReceiveDrawHUD() {</span><span id="62f0" class="lh li iq ld b gy ln lk l ll lm">   var text:string = 'HELLO UNREAL!';</span><span id="5543" class="lh li iq ld b gy ln lk l ll lm">   this.Canvas.DrawText(</span><span id="a30e" class="lh li iq ld b gy ln lk l ll lm">      GEngine.SmallFont,</span><span id="158c" class="lh li iq ld b gy ln lk l ll lm">      text,</span><span id="201c" class="lh li iq ld b gy ln lk l ll lm">      {X:this.Canvas.SizeX/2,Y:this.Canvas.SizeY/2},</span><span id="d7e6" class="lh li iq ld b gy ln lk l ll lm">      {R:1,G:1,B:1,A:1},</span><span id="fee7" class="lh li iq ld b gy ln lk l ll lm">      0,</span><span id="a68f" class="lh li iq ld b gy ln lk l ll lm">      {R:0,G:0,B:0,A:1},</span><span id="0499" class="lh li iq ld b gy ln lk l ll lm">      {X:1,Y:1},</span><span id="c191" class="lh li iq ld b gy ln lk l ll lm">      true,true,true,</span><span id="73c4" class="lh li iq ld b gy ln lk l ll lm">      {R:0,G:0,B:0,A:1}</span><span id="0d4a" class="lh li iq ld b gy ln lk l ll lm">    )</span><span id="4ff4" class="lh li iq ld b gy ln lk l ll lm">  }</span><span id="378d" class="lh li iq ld b gy ln lk l ll lm">}</span><span id="c938" class="lh li iq ld b gy ln lk l ll lm">// register new HUD class</span><span id="407b" class="lh li iq ld b gy ln lk l ll lm">let MyHUD_C = require('uclass')()(global,MyHUD);</span><span id="5e09" class="lh li iq ld b gy ln lk l ll lm">// and instantiate it</span><span id="b0ec" class="lh li iq ld b gy ln lk l ll lm">  GetPC().ClientSetHUD(MyHUD_C)</span><span id="bc64" class="lh li iq ld b gy ln lk l ll lm">// no mess to clean</span><span id="9fe6" class="lh li iq ld b gy ln lk l ll lm">  return function () {</span><span id="1cb8" class="lh li iq ld b gy ln lk l ll lm">  }</span><span id="5faa" class="lh li iq ld b gy ln lk l ll lm">}</span><span id="c3e2" class="lh li iq ld b gy ln lk l ll lm">import bootstrap from "./bootstrap"</span><span id="c5f8" class="lh li iq ld b gy ln lk l ll lm">// bootstrap to initiate live-reloading dev env.</span><span id="ab4a" class="lh li iq ld b gy ln lk l ll lm">try {</span><span id="964f" class="lh li iq ld b gy ln lk l ll lm">  module.exports = () =&gt; {</span><span id="e775" class="lh li iq ld b gy ln lk l ll lm">   let cleanup:Function|null = null</span><span id="480a" class="lh li iq ld b gy ln lk l ll lm">// wait for map to be loaded.</span><span id="bb73" class="lh li iq ld b gy ln lk l ll lm">process.nextTick(() =&gt; cleanup = main());</span><span id="408f" class="lh li iq ld b gy ln lk l ll lm">// live-reloadable function should return its cleanup function</span><span id="822f" class="lh li iq ld b gy ln lk l ll lm">  return () =&gt; (&lt;Function&gt;cleanup)()</span><span id="f1a1" class="lh li iq ld b gy ln lk l ll lm">  }</span><span id="c040" class="lh li iq ld b gy ln lk l ll lm">}</span><span id="ba93" class="lh li iq ld b gy ln lk l ll lm">catch (e) {</span><span id="49f9" class="lh li iq ld b gy ln lk l ll lm">  bootstrap('helloUnreal')</span><span id="20d0" class="lh li iq ld b gy ln lk l ll lm">}</span></pre><p id="29e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，当我们在游戏中点击“Play”时，应该会看到“HELLO UNREAL！”屏幕中央的消息。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/cacdce9fd39e34bcb86a0a0bc4ec8d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nGZ9WZEr07mrKfSviX6QQ.png"/></div></div></figure><p id="2e81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，这个例子包含了一个没有使用的清理函数。如果你在你的剧本中创造演员，这个功能是非常重要的，但是你可以在这里看到一个基本的例子<a class="ae kw" href="https://github.com/ncsoft/Unreal.js/blob/master/Examples/Content/Scripts/helloWorld.js" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a22d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们用<a class="ae kw" href="https://github.com/ncsoft/Unreal.js" rel="noopener ugc nofollow" target="_blank">虚幻有了一个虚幻引擎项目。可以使用TypeScript编写脚本的JS </a>。编码快乐！</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="0e70" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="nc">注意</em> </strong> <em class="nc">:编写类型文件是为了在JavaScript的VSCode中提供自动完成功能，可能需要一些配置来删除最新版本的TypeScript中的所有警告。库检查也可能触发</em> <a class="ae kw" href="https://github.com/ncsoft/Unreal.js/issues/164#issuecomment-289242192" rel="noopener ugc nofollow" target="_blank"> <em class="nc"> GitHub用户concestar row</em></a><em class="nc">指出的错误，应该在tsconfig.json文件中忽略。</em></p><p id="90cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nc">虚幻。JS是开源的，更新类型对于任何对使用TypeScript感兴趣的人来说都是一个巨大的贡献。</em></p></div></div>    
</body>
</html>