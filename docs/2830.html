<html>
<head>
<title>Kubernetes: part 2 — a cluster set up on AWS with AWS cloud-provider and AWS LoadBalancer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:第2部分——使用AWS云提供商和AWS负载平衡器在AWS上设置一个集群</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-part-2-a-cluster-set-up-on-aws-with-aws-cloud-provider-and-aws-loadbalancer-f02c3509f2c2?source=collection_archive---------1-----------------------#2019-08-10">https://itnext.io/kubernetes-part-2-a-cluster-set-up-on-aws-with-aws-cloud-provider-and-aws-loadbalancer-f02c3509f2c2?source=collection_archive---------1-----------------------#2019-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/42c243c82915a194d9b682944da6df1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*c1Dvp0gnY4eiRlHJ.png"/></div></figure><p id="1686" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在第一部分— <a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-1-architecture-and-main-components-overview/" rel="noopener ugc nofollow" target="_blank"> Kubernetes:第一部分—架构和主要组件概述</a> —我们快速浏览了一下Kubernetes。</p><p id="f58a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第三部分— <a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-3-aws-eks-overview-and-manual-eks-cluster-set-up/" rel="noopener ugc nofollow" target="_blank"> Kubernetes:第三部分— AWS EKS概述和手动EKS集群设置</a>。</p><p id="ebcb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我想尝试的下一件事是使用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" rel="noopener ugc nofollow" target="_blank">kubeadm</a></code>手动创建一个集群，在那里运行一个简单的web服务，并通过AWS LoadBalancer访问它。</p><p id="9caa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这个过程中，我面临的主要问题是缺乏成熟的文档和最新的例子，因此几乎所有的事情都必须通过试凑法来完成。</p><p id="db7a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">终于看到一条消息说:</p><blockquote class="kx ky kz"><p id="d476" class="ju jv la jw b jx jy jz ka kb kc kd ke lb kg kh ki lc kk kl km ld ko kp kq kr ij bi translated">警告:aws内置云提供程序现已弃用。AWS提供程序已被弃用，将在未来的版本中删除</p></blockquote><p id="97d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">下面的例子使用了Kubernetes版本:v1.15.2 .和ес2以及OS Ubuntu 18.04</p><ul class=""><li id="8764" class="le lf iq jw b jx jy kb kc kf lg kj lh kn li kr lj lk ll lm bi translated"><a class="ae ks" href="#b80a" rel="noopener ugc nofollow">准备AWS </a></li><li id="4ef8" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#969d" rel="noopener ugc nofollow"> VPC </a></li><li id="4794" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#253c" rel="noopener ugc nofollow">子网</a></li><li id="917f" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#d3da" rel="noopener ugc nofollow">互联网网关</a></li><li id="2c95" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#32de" rel="noopener ugc nofollow">路由表</a></li><li id="36a5" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#5e09" rel="noopener ugc nofollow"> IAM角色</a></li><li id="6a2d" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#bf01" rel="noopener ugc nofollow"> IAM主角色</a></li><li id="9846" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#cc25" rel="noopener ugc nofollow"> IAM工人角色</a></li><li id="9248" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#2b78" rel="noopener ugc nofollow">运行EC2 </a></li><li id="8a8b" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#bab2" rel="noopener ugc nofollow">一个Kubernetes集群成立</a></li><li id="3321" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#9ffd" rel="noopener ugc nofollow"> Kubernetes安装</a></li><li id="4081" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#4fab" rel="noopener ugc nofollow">主机名</a></li><li id="939a" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#f04b" rel="noopener ugc nofollow">集群设置</a></li><li id="2584" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#8b5a" rel="noopener ugc nofollow"> kubeadm复位</a></li><li id="17bf" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#8fc1" rel="noopener ugc nofollow">法兰绒CNI安装</a></li><li id="e87e" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#f0c1" rel="noopener ugc nofollow">附加工作者节点</a></li><li id="ebf6" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#a23d" rel="noopener ugc nofollow">负载平衡器创建</a></li><li id="badf" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr lj lk ll lm bi translated"><a class="ae ks" href="#d33b" rel="noopener ugc nofollow"> AWS负载平衡器—未添加工作节点</a></li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="b80a" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">准备AWS</h2><h2 id="969d" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">VPC</h2><p id="917a" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">用<em class="la"> 10.0.0.0/16 </em> CIDR制造一个VPC:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi mx"><img src="../Images/d758a9663c17813e1d0c70d515311a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a-69DesbJM3sNzi-.png"/></div></div></figure><p id="da93" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加一个名为【kubernetes.io/cluster/kubernetes】的标签，其值为<em class="la">所拥有的</em>——K8s将使用它来自动发现与Kubernetes堆栈相关的AWS资源，并且它将在创建新资源时添加这样一个标签:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/94bd67c20927b84706251b01fbc131b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6_94v4DGYt6_Wh3c.png"/></div></div></figure><p id="d507" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启用<em class="la"> DNS主机名</em>:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nh"><img src="../Images/f1158f3e4859bb8e1c3c2dc43503289a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3nYuMRKKy5yD8Fbu.png"/></div></div></figure><figure class="my mz na nb gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/bd2e8ff0cd091b5426540460a750ec47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/0*tQZp6HgvdkS6R6Dk.png"/></div></figure><h2 id="253c" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">子网络</h2><p id="68ac" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">在此VPC中创建新子网:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nj"><img src="../Images/6423da355360f06ba00b6f0e93e06e59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*caJlhx31imKCdlIn.png"/></div></div></figure><p id="c65d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为将放置在此子网中的EC2实例启用公共IP:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nk"><img src="../Images/c3115db45fcfe2521e1085ed09719c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ey_M-AImE4fN3LEP.png"/></div></div></figure><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nl"><img src="../Images/10b5fac7d1d88cd1d53b771cf08d7c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zxkhzAzxL2pKa9id.png"/></div></div></figure><p id="fec4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加标签:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nm"><img src="../Images/bac263389739a216fdb9b60ffa0aad13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ojAE-zpGr4kieQds.png"/></div></div></figure><h2 id="d3da" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">互联网网关</h2><p id="000e" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">创建一个IGW，将流量从子网路由到互联网:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nn"><img src="../Images/a5736e4fafedc3b8cd011f69daf01f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SuhScTsyPramexSg.png"/></div></div></figure><p id="c330" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于IGW，也添加标签，以防万一:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi no"><img src="../Images/cb34f1f9905e0492624721fdd9bdb02f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HE5FxCphN4ztZN7U.png"/></div></div></figure><p id="8c39" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将此IGW附加到您的VPC:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi no"><img src="../Images/9dead0762d2391248e7b144320798683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jlx4g65REB3XT2qr.png"/></div></div></figure><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi np"><img src="../Images/08bb77e45f71b1498b5046403536b38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R06q1ELVjcp54uCX.png"/></div></div></figure><h2 id="32de" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">路由表</h2><p id="1b6c" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">创建路由表:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi np"><img src="../Images/d05d94a8eedd79a26816420fe2f5a82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nS4HgY7VnnnQYGdj.png"/></div></div></figure><p id="86af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在此添加标签:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nq"><img src="../Images/4086c62d969822ad930d39925da538e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TDHXPCUfyn6XURKi.png"/></div></div></figure><p id="71cc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击<em class="la">路由</em>选项卡，通过我们上面创建的IGW向<em class="la"> 0.0.0.0/0 </em>网络添加一条新路由:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nr"><img src="../Images/72ec3efea604dac9359ebe551d748d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-ip1dLFIqp-1Q4YD.png"/></div></div></figure><p id="78cd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将此表附加到子网— <em class="la">编辑子网关联</em>:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/c0a203f9d8715e9aee7578545a4a95d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ebuxWXlezudB99kl.png"/></div></div></figure><p id="b59d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">选择您之前创建的子网:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nr"><img src="../Images/3ff47cb4cee4e57b616045bb84417b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tByypdruiuuY_OWl.png"/></div></div></figure><h2 id="5e09" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">IAM角色</h2><p id="fda7" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">为了让Kubernetes与AWS一起工作，需要创建两个IAM EC2角色——主角色和从角色。</p><p id="0500" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您也可以使用ACCESS/SECRET来代替。</p><p id="bf01" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> IAM主角色</strong></p><p id="3c6f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入<em class="la"> IAM &gt; Policies </em>，点击<em class="la"> Create policy </em>，进入JSON添加新的策略描述(参见<a class="ae ks" href="https://github.com/kubernetes/cloud-provider-aws" rel="noopener ugc nofollow" target="_blank"> cloud-provider-aws </a>):</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="47fa" class="lz ma iq kw b gy nw nx l ny nz">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "autoscaling:DescribeAutoScalingGroups",<br/>                "autoscaling:DescribeLaunchConfigurations",<br/>                "autoscaling:DescribeTags",<br/>                "ec2:DescribeInstances",<br/>                "ec2:DescribeRegions",<br/>                "ec2:DescribeRouteTables",<br/>                "ec2:DescribeSecurityGroups",<br/>                "ec2:DescribeSubnets",<br/>                "ec2:DescribeVolumes",<br/>                "ec2:CreateSecurityGroup",<br/>                "ec2:CreateTags",<br/>                "ec2:CreateVolume",<br/>                "ec2:ModifyInstanceAttribute",<br/>                "ec2:ModifyVolume",<br/>                "ec2:AttachVolume",<br/>                "ec2:AuthorizeSecurityGroupIngress",<br/>                "ec2:CreateRoute",<br/>                "ec2:DeleteRoute",<br/>                "ec2:DeleteSecurityGroup",<br/>                "ec2:DeleteVolume",<br/>                "ec2:DetachVolume",<br/>                "ec2:RevokeSecurityGroupIngress",<br/>                "ec2:DescribeVpcs",<br/>                "elasticloadbalancing:AddTags",<br/>                "elasticloadbalancing:AttachLoadBalancerToSubnets",<br/>                "elasticloadbalancing:ApplySecurityGroupsToLoadBalancer",<br/>                "elasticloadbalancing:CreateLoadBalancer",<br/>                "elasticloadbalancing:CreateLoadBalancerPolicy",<br/>                "elasticloadbalancing:CreateLoadBalancerListeners",<br/>                "elasticloadbalancing:ConfigureHealthCheck",<br/>                "elasticloadbalancing:DeleteLoadBalancer",<br/>                "elasticloadbalancing:DeleteLoadBalancerListeners",<br/>                "elasticloadbalancing:DescribeLoadBalancers",<br/>                "elasticloadbalancing:DescribeLoadBalancerAttributes",<br/>                "elasticloadbalancing:DetachLoadBalancerFromSubnets",<br/>                "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",<br/>                "elasticloadbalancing:ModifyLoadBalancerAttributes",<br/>                "elasticloadbalancing:RegisterInstancesWithLoadBalancer",<br/>                "elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer",<br/>                "elasticloadbalancing:AddTags",<br/>                "elasticloadbalancing:CreateListener",<br/>                "elasticloadbalancing:CreateTargetGroup",<br/>                "elasticloadbalancing:DeleteListener",<br/>                "elasticloadbalancing:DeleteTargetGroup",<br/>                "elasticloadbalancing:DescribeListeners",<br/>                "elasticloadbalancing:DescribeLoadBalancerPolicies",<br/>                "elasticloadbalancing:DescribeTargetGroups",<br/>                "elasticloadbalancing:DescribeTargetHealth",<br/>                "elasticloadbalancing:ModifyListener",<br/>                "elasticloadbalancing:ModifyTargetGroup",<br/>                "elasticloadbalancing:RegisterTargets",<br/>                "elasticloadbalancing:SetLoadBalancerPoliciesOfListener",<br/>                "iam:CreateServiceLinkedRole",<br/>                "kms:DescribeKey"<br/>            ],<br/>            "Resource": [<br/>                "*"<br/>            ]<br/>        }<br/>    ]<br/>}</span></pre><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oa"><img src="../Images/111c02878e12b7a3f9a2a624ed085d8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GzV_0yRkSb3ORLbt.png"/></div></div></figure><p id="73d9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保存它:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ob"><img src="../Images/f3ebf9e957b3f6924903c6aa4b56098d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1NGiIYr3i-YZ6MGM.png"/></div></div></figure><p id="6294" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="la">角色</em>，使用EC2类型创建一个角色:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oc"><img src="../Images/240f910d68e80f99cc738ceaffa44bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IGQ98_-Fp5sIm67K.png"/></div></div></figure><p id="88af" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">点击<em class="la">权限</em>，找到并附上上面添加的策略:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oc"><img src="../Images/923e8a2a3e7fb93688d4276e05e53d4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dEf6f4xBGAaIHqza.png"/></div></div></figure><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oc"><img src="../Images/a746790d398bb4801b699841c08059c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xFh6rFNQzL1a3wFE.png"/></div></div></figure><p id="cc25" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> IAM工人角色</strong></p><p id="e980" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">同样，为工作节点创建另一个策略:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="787c" class="lz ma iq kw b gy nw nx l ny nz">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "ec2:DescribeInstances",<br/>                "ec2:DescribeRegions",<br/>                "ecr:GetAuthorizationToken",<br/>                "ecr:BatchCheckLayerAvailability",<br/>                "ecr:GetDownloadUrlForLayer",<br/>                "ecr:GetRepositoryPolicy",<br/>                "ecr:DescribeRepositories",<br/>                "ecr:ListImages",<br/>                "ecr:BatchGetImage"<br/>            ],<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="3631" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保存为<em class="la">k8s-cluster-iam-worker-policy</em>(显然可以使用任何名称):</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi od"><img src="../Images/f7bb7d5c51347707e98eee601e21b3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rdi5Fz1liV_lf97G.png"/></div></div></figure><p id="4018" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并创建一个<em class="la">k8s-cluster-iam-worker-role</em>:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oe"><img src="../Images/141a4527328b24d8e5c123933e294ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9WG0OShvvBCr9zed.png"/></div></div></figure><h2 id="2b78" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">运行EC2</h2><p id="c6b2" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">使用t2.medium类型创建EC2(最小类型，因为cKubernetes master至少需要2个CPU内核)，使用您的VPC，并将<em class="la">k8s-cluster-iam-master-role</em>设置为IAM角色:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi of"><img src="../Images/c3e09f7aeab30040b5e838de7cd39da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yFb58enavNAozQDu.png"/></div></div></figure><p id="8b71" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加标签:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ca"><img src="../Images/7cc86be4560a7e2e57082b22a4a96048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tALuWrkuBchGnIf0.png"/></div></div></figure><p id="91fb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个<em class="la">安全组</em>:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ca"><img src="../Images/45d0b5b4282ed28f614e6e88374642e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p9wkEsz02I59dodH.png"/></div></div></figure><p id="b86c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Wile Master正在启动—使用<em class="la">k8s-cluster-iam-Worker-role</em>以同样的方式创建一个Worker节点:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi og"><img src="../Images/fe8b5f07acc0add96efc21db03dc45cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hhf6Zomno481bUIM.png"/></div></div></figure><p id="5b11" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">标签:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oh"><img src="../Images/69e23dc2d0c352452e972bacc596c009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RLEX_GLLRLansXh5.png"/></div></div></figure><p id="bd48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">附加现有SG:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oi"><img src="../Images/f8da1aab8a78d166b57b7378bd738f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AIZZQxl0M54SXEBk.png"/></div></div></figure><p id="cf0d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">连接到任何实例并检查网络是否正常工作:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="0f00" class="lz ma iq kw b gy nw nx l ny nz">$ ssh -i k8s-cluster-eu-west-3-key.pem ubuntu@35.***.***.117 ‘ping -c 1 1.1.1.1’<br/>PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.<br/>64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=1.08 ms</span></pre><p id="087f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">很好。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h2 id="bab2" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">建立了一个库本内特星团</h2><h2 id="9ffd" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">Kubernetes装置</h2><p id="bfb5" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">在两个EC2上执行接下来的步骤。</p><p id="3968" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更新软件包列表和已安装的软件包:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="f7c5" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–112:~# apt update &amp;&amp; apt -y upgrade</span></pre><p id="d772" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">添加Docker和Kubernetes存储库:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="a72c" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–112:~# curl -fsSL <a class="ae ks" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -<br/>OK<br/>root@ip-10–0–0–112:~# add-apt-repository “deb [arch=amd64] <a class="ae ks" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable”<br/>root@ip-10–0–0–112:~# curl -s <a class="ae ks" href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/apt/doc/apt-key.gpg</a> | sudo apt-key add -<br/>OK<br/>root@ip-10–0–0–112:~# echo “deb <a class="ae ks" href="https://apt.kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://apt.kubernetes.io/</a> kubernetes-xenial main” &gt; /etc/apt/sources.list.d/kubernetes.list<br/>root@ip-10–0–0–112:~# apt update<br/>root@ip-10–0–0–112:~# apt install -y docker-ce kubelet kubeadm kubectl</span></pre><p id="9af1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者只做一个命令:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="84ae" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–112:~# apt update &amp;&amp; apt -y upgrade &amp;&amp; curl -fsSL <a class="ae ks" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add — &amp;&amp; add-apt-repository “deb [arch=amd64] <a class="ae ks" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable” &amp;&amp; curl -s <a class="ae ks" href="https://packages.cloud.google.com/apt/doc/apt-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/apt/doc/apt-key.gpg</a> | sudo apt-key add — &amp;&amp; echo “deb <a class="ae ks" href="https://apt.kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://apt.kubernetes.io/</a> kubernetes-xenial main” &gt; /etc/apt/sources.list.d/kubernetes.list &amp;&amp; apt update &amp;&amp; apt install -y docker-ce kubelet kubeadm kubectl</span></pre><h2 id="4fab" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">主机名</h2><p id="7dff" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">在两个EC2上执行接下来的步骤。</p><p id="e115" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Afaik接下来的更改只需要在Ubuntu上完成，并且您不能更改由AWS设置的主机名(本例中的<em class="la">IP-10–0–0–102</em>)。</p><p id="be4c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在检查主机名:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="84a4" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# hostname<br/>ip-10–0–0–102</span></pre><p id="3d4a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将其作为完全限定的域名(FQDN):</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="ef07" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# curl <a class="ae ks" href="http://169.254.169.254/latest/meta-data/local-hostname" rel="noopener ugc nofollow" target="_blank">http://169.254.169.254/latest/meta-data/local-hostname</a><br/>ip-10–0–0–102.eu-west-3.compute.internal</span></pre><p id="f2ca" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将主机名设置为FQDN:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="c1f5" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# hostnamectl set-hostname ip-10–0–0–102.eu-west-3.compute.internal</span></pre><p id="9d9f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">立即检查:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="8ea3" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# hostname<br/>ip-10–0–0–102.eu-west-3.compute.internal</span></pre><p id="a335" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在工作节点上重复。</p><h2 id="f04b" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">集群设置</h2><p id="68ea" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">创建一个<code class="fe kt ku kv kw b">/etc/kubernetes/aws.yml </code>文件:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="4d45" class="lz ma iq kw b gy nw nx l ny nz">---<br/>apiVersion: kubeadm.k8s.io/v1beta2<br/>kind: ClusterConfiguration<br/>networking:<br/>  serviceSubnet: "10.100.0.0/16"<br/>  podSubnet: "10.244.0.0/16"<br/>apiServer:<br/>  extraArgs:<br/>    cloud-provider: "aws"<br/>controllerManager:<br/>  extraArgs:<br/>    cloud-provider: "aws"</span></pre><p id="2bb3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用此配置初始化群集:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="d652" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubeadm init — config /etc/kubernetes/aws.yml<br/>[init] Using Kubernetes version: v1.15.2<br/>[preflight] Running pre-flight checks<br/>[WARNING IsDockerSystemdCheck]: detected “cgroupfs” as the Docker cgroup driver. The recommended driver is “systemd”. Please follow the guide at <a class="ae ks" href="https://kubernetes.io/docs/setup/cri/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/setup/cri/</a><br/>[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 19.03.1. Latest validated version: 18.09<br/>…<br/>[kubelet-start] Writing kubelet environment file with flags to file “/var/lib/kubelet/kubeadm-flags.env”<br/>[kubelet-start] Writing kubelet configuration to file “/var/lib/kubelet/config.yaml”<br/>[kubelet-start] Activating the kubelet service<br/>[certs] Using certificateDir folder “/etc/kubernetes/pki”<br/>[certs] Generating “ca” certificate and key<br/>[certs] Generating “apiserver” certificate and key<br/>[certs] apiserver serving cert is signed for DNS names [ip-10–0–0–102.eu-west-3.compute.internal kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.100.0.1 10.0.0.102]<br/>…<br/>[kubeconfig] Using kubeconfig folder “/etc/kubernetes”<br/>[kubeconfig] Writing “admin.conf” kubeconfig file<br/>[kubeconfig] Writing “kubelet.conf” kubeconfig file<br/>[kubeconfig] Writing “controller-manager.conf” kubeconfig file<br/>[kubeconfig] Writing “scheduler.conf” kubeconfig file<br/>[control-plane] Using manifest folder “/etc/kubernetes/manifests”<br/>[control-plane] Creating static Pod manifest for “kube-apiserver”<br/>[control-plane] Creating static Pod manifest for “kube-controller-manager”<br/>[control-plane] Creating static Pod manifest for “kube-scheduler”<br/>[etcd] Creating static Pod manifest for local etcd in “/etc/kubernetes/manifests”<br/>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory “/etc/kubernetes/manifests”. This can take up to 4m0s<br/>[apiclient] All control plane components are healthy after 23.502303 seconds<br/>[upload-config] Storing the configuration used in ConfigMap “kubeadm-config” in the “kube-system” Namespace<br/>[kubelet] Creating a ConfigMap “kubelet-config-1.15” in namespace kube-system with the configuration for the kubelets in the cluster<br/>…<br/>[mark-control-plane] Marking the node ip-10–0–0–102.eu-west-3.compute.internal as control-plane by adding the label “node-role.kubernetes.io/master=’’”<br/>[mark-control-plane] Marking the node ip-10–0–0–102.eu-west-3.compute.internal as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]<br/>…<br/>Your Kubernetes control-plane has initialized successfully!<br/>…<br/>Then you can join any number of worker nodes by running the following on each as root:<br/>kubeadm join 10.0.0.102:6443 — token rat2th.qzmvv988e3pz9ywa \<br/> — discovery-token-ca-cert-hash sha256:ce983b5fbf4f067176c4641a48dc6f7203d8bef972cb9d2d9bd34831a864d744</span></pre><p id="a4c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个<code class="fe kt ku kv kw b">kubelet</code>配置文件:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="9a55" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# mkdir -p $HOME/.kube<br/>root@ip-10–0–0–102:~# cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>root@ip-10–0–0–102:~# chown ubuntu:ubuntu $HOME/.kube/config</span></pre><p id="b64b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查节点:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="dbbb" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get nodes -o wide<br/>NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME<br/>ip-10–0–0–102.eu-west-3.compute.internal NotReady master 55s v1.15.2 10.0.0.102 &lt;none&gt; Ubuntu 18.04.3 LTS 4.15.0–1044-aws docker://19.3.1</span></pre><p id="2f0a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以使用<code class="fe kt ku kv kw b">config view</code>获取您的集群信息:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="b69d" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubeadm config view<br/>apiServer:<br/>extraArgs:<br/>authorization-mode: Node,RBAC<br/>cloud-provider: aws<br/>timeoutForControlPlane: 4m0s<br/>apiVersion: kubeadm.k8s.io/v1beta2<br/>certificatesDir: /etc/kubernetes/pki<br/>clusterName: kubernetes<br/>controllerManager:<br/>extraArgs:<br/>cloud-provider: aws<br/>dns:<br/>type: CoreDNS<br/>etcd:<br/>local:<br/>dataDir: /var/lib/etcd<br/>imageRepository: k8s.gcr.io<br/>kind: ClusterConfiguration<br/>kubernetesVersion: v1.15.2<br/>networking:<br/>dnsDomain: cluster.local<br/>podSubnet: 10.244.0.0/16<br/>serviceSubnet: 10.100.0.0/16<br/>scheduler: {}</span></pre><p id="8b5a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> kubeadm复位</strong></p><p id="66d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您想完全销毁您的集群，从头开始设置它—使用<code class="fe kt ku kv kw b">reset</code>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="ec86" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubeadm reset</span></pre><p id="aecb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和重置IPTABLES规则:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="6fd8" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X</span></pre><h2 id="8fc1" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">法兰绒CNI装置</h2><p id="5105" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">从主节点执行:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="02b9" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl apply -f <a class="ae ks" href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a><br/>podsecuritypolicy.policy/psp.flannel.unprivileged created<br/>clusterrole.rbac.authorization.k8s.io/flannel created<br/>clusterrolebinding.rbac.authorization.k8s.io/flannel created<br/>serviceaccount/flannel created<br/>configmap/kube-flannel-cfg created<br/>daemonset.apps/kube-flannel-ds-amd64 created<br/>daemonset.apps/kube-flannel-ds-arm64 created<br/>daemonset.apps/kube-flannel-ds-arm created<br/>daemonset.apps/kube-flannel-ds-ppc64le created<br/>daemonset.apps/kube-flannel-ds-s390x created</span></pre><p id="612e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">稍等片刻，再次检查节点:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="ca63" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get nodes<br/>NAME STATUS ROLES AGE VERSION<br/>ip-10–0–0–102.eu-west-3.compute.internal Ready master 3m26s v1.15.2</span></pre><p id="7adb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe kt ku kv kw b">STATUS == Ready</code>好的。</p><h2 id="f0c1" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">附加工作节点</h2><p id="c1f8" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">在Worker节点上用<code class="fe kt ku kv kw b"><a class="ae ks" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/#config-file" rel="noopener ugc nofollow" target="_blank">JoinConfiguration</a></code>创建一个<code class="fe kt ku kv kw b">/etc/kubernetes/node.yml</code>文件:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="25d9" class="lz ma iq kw b gy nw nx l ny nz">---<br/>apiVersion: kubeadm.k8s.io/v1beta1<br/>kind: JoinConfiguration<br/>discovery:<br/>  bootstrapToken:<br/>    token: "rat2th.qzmvv988e3pz9ywa"<br/>    apiServerEndpoint: "10.0.0.102:6443"<br/>    caCertHashes:<br/>      - "sha256:ce983b5fbf4f067176c4641a48dc6f7203d8bef972cb9d2d9bd34831a864d744"<br/>nodeRegistration:<br/>  name: ip-10-0-0-186.eu-west-3.compute.internal<br/>  kubeletExtraArgs:<br/>    cloud-provider: aws</span></pre><p id="1941" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将此节点加入群集:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="9b32" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–186:~# kubeadm join — config /etc/kubernetes/node.yml<br/>[preflight] Running pre-flight checks<br/>[WARNING IsDockerSystemdCheck]: detected “cgroupfs” as the Docker cgroup driver. The recommended driver is “systemd”. Please follow the guide at <a class="ae ks" href="https://kubernetes.io/docs/setup/cri/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/setup/cri/</a><br/>[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 19.03.1. Latest validated version: 18.09<br/>[preflight] Reading configuration from the cluster…<br/>[preflight] FYI: You can look at this config file with ‘kubectl -n kube-system get cm kubeadm-config -oyaml’[kubelet-start] Downloading configuration for the kubelet from the “kubelet-config-1.15” ConfigMap in the kube-system namespace<br/>[kubelet-start] Writing kubelet configuration to file “/var/lib/kubelet/config.yaml”<br/>[kubelet-start] Writing kubelet environment file with flags to file “/var/lib/kubelet/kubeadm-flags.env”<br/>[kubelet-start] Activating the kubelet service<br/>[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap…<br/>…</span></pre><p id="c8f3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">回到主服务器，再次检查节点:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="9125" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get nodes<br/>NAME STATUS ROLES AGE VERSION<br/>ip-10–0–0–102.eu-west-3.compute.internal Ready master 7m37s v1.15.2<br/>ip-10–0–0–186.eu-west-3.compute.internal Ready &lt;none&gt; 27s v1.15.2</span></pre><h2 id="a23d" class="lz ma iq bd mb mc md dn me mf mg dp mh kf mi mj mk kj ml mm mn kn mo mp mq mr bi translated">负载平衡器创建</h2><p id="d64e" class="pw-post-body-paragraph ju jv iq jw b jx ms jz ka kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr ij bi translated">最后一件事是运行web服务，让我们使用一个简单的NGINX容器并放置一个<code class="fe kt ku kv kw b"><a class="ae ks" href="https://rtfm.co.ua/kubernetes-znakomstvo-chast-1-arxitektura-i-osnovnye-komponenty-obzor/#LoadBalancer" rel="noopener ugc nofollow" target="_blank">LoadBalancer</a></code> <a class="ae ks" href="https://rtfm.co.ua/kubernetes-znakomstvo-chast-1-arxitektura-i-osnovnye-komponenty-obzor/#Services" rel="noopener ugc nofollow" target="_blank">服务</a>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="d846" class="lz ma iq kw b gy nw nx l ny nz">kind: Service<br/>apiVersion: v1<br/>metadata:<br/>  name: hello<br/>spec:<br/>  type: LoadBalancer<br/>  selector:<br/>    app: hello<br/>  ports:<br/>    - name: http<br/>      protocol: TCP<br/>      # ELB's port<br/>      port: 80<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: hello<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: hello<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello<br/>    spec:<br/>      containers:<br/>        - name: hello<br/>          image: nginx</span></pre><p id="c8fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">应用它:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="bfde" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl apply -f elb-example.yml\service/hello created\deployment.apps/hello created</span></pre><p id="21f1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查<code class="fe kt ku kv kw b"><a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-1-architecture-and-main-components-overview/#Deployment" rel="noopener ugc nofollow" target="_blank">Deployment</a></code>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="f4c5" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get deploy -o wide<br/>NAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTOR<br/>hello 1/1 1 1 22s hello nginx app=hello</span></pre><p id="5c48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe kt ku kv kw b"><a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-1-architecture-and-main-components-overview/#ReplicaSet" rel="noopener ugc nofollow" target="_blank">ReplicaSet</a></code>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="4a7a" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get rs -o wide<br/>NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR<br/>hello-5bfb6b69f 1 1 1 39s hello nginx app=hello,pod-template-hash=5bfb6b69f</span></pre><p id="f7a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-1-architecture-and-main-components-overview/#Pod" rel="noopener ugc nofollow" target="_blank"> Pod </a>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="f939" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get pod -o wide<br/>NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES<br/>hello-5bfb6b69f-4pklx 1/1 Running 0 62s 10.244.1.2 ip-10–0–0–186.eu-west-3.compute.internal &lt;none&gt; &lt;none&gt;</span></pre><p id="ea22" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和<a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-1-architecture-and-main-components-overview/#Services" rel="noopener ugc nofollow" target="_blank">服务</a>:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="e013" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl get svc -o wide<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR<br/>hello LoadBalancer 10.100.102.37 aa5***295.eu-west-3.elb.amazonaws.com 80:30381/TCP 83s app=hello<br/>kubernetes ClusterIP 10.100.0.1 &lt;none&gt; 443/TCP 17m &lt;none&gt;</span></pre><p id="669b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在AWS控制台中检查ELB:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi oj"><img src="../Images/74f2ed47400db7e345d0111695d54317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tvq3YWEDZ-zVomZB.png"/></div></div></figure><p id="cc11" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">实例—这是我们的工作节点:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ok"><img src="../Images/ae2a84b688597e28e9884d3dff8d86ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1HxLR-U67F1mhTyR.png"/></div></div></figure><p id="03d8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们回忆一下它是如何工作的:</p><ol class=""><li id="8c4b" class="le lf iq jw b jx jy kb kc kf lg kj lh kn li kr ol lk ll lm bi translated">AWS ELB将流量路由到工作节点(<code class="fe kt ku kv kw b">NodePort</code>服务)</li><li id="1286" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr ol lk ll lm bi translated">在工作节点上，通过<code class="fe kt ku kv kw b">NodePort</code>服务，它将被路由到Pod的端口(<code class="fe kt ku kv kw b">TargetPort</code>)</li><li id="27da" class="le lf iq jw b jx ln kb lo kf lp kj lq kn lr kr ol lk ll lm bi translated">在带有<code class="fe kt ku kv kw b">TargetPort</code>的Pod上，流量将被发送到集装箱的港口(<code class="fe kt ku kv kw b">containerPort</code></li></ol><p id="4eaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在上面的负载平衡器描述中，我们看到了下一个设置:</p><blockquote class="kx ky kz"><p id="157f" class="ju jv la jw b jx jy jz ka kb kc kd ke lb kg kh ki lc kk kl km ld ko kp kq kr ij bi translated">端口配置<br/> 80 (TCP)转发到30381 (TCP)</p></blockquote><p id="6a54" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">查看Kubernetes集群服务:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="dbcd" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kk describe svc hello<br/>Name: hello<br/>Namespace: default<br/>Labels: &lt;none&gt;<br/>Annotations: kubectl.kubernetes.io/last-applied-configuration:<br/>{“apiVersion”:”v1",”kind”:”Service”,”metadata”:{“annotations”:{},”name”:”hello”,”namespace”:”default”},”spec”:{“ports”:[{“name”:”http”,”po…<br/>Selector: app=hello<br/>Type: LoadBalancer<br/>IP: 10.100.102.37<br/>LoadBalancer Ingress: aa5***295.eu-west-3.elb.amazonaws.com<br/>Port: http 80/TCP<br/>TargetPort: 80/TCP<br/>NodePort: http 30381/TCP<br/>Endpoints: 10.244.1.2:80</span></pre><p id="b586" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi">…</p><p id="eb57" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里是我们的<code class="fe kt ku kv kw b">NodePort</code> : <em class="la"> http 30381/TCP </em></p><p id="615b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以直接向节点发送请求。</p><p id="ab89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">查找工作节点的地址:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="5e77" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kk get node | grep -v master<br/>NAME STATUS ROLES AGE VERSION<br/>ip-10–0–0–186.eu-west-3.compute.internal Ready &lt;none&gt; 51m v1.15.2</span></pre><p id="5513" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并连接到<em class="la"> 30381 </em>端口:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="ae45" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# curl ip-10–0–0–186.eu-west-3.compute.internal:30381<br/>&lt;!DOCTYPE html&gt;&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>…</span></pre><p id="d0fb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查ELB是否在工作:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="e8c4" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# curl aa5***295.eu-west-3.elb.amazonaws.com<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>…</span></pre><p id="a1a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和一个豆荚的日志:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="b1e6" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl logs hello-5bfb6b69f-4pklx<br/>10.244.1.1 — — [09/Aug/2019:13:57:10 +0000] “GET / HTTP/1.1” 200 612 “-” “curl/7.58.0” “-”</span></pre><p id="d33b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> AWS负载平衡器—未添加工作节点</strong></p><p id="2dcd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当我尝试设置这个集群时，ELB遇到了一个问题，即在创建负载平衡器Kubernetes服务时，没有将工作节点添加到AWS负载平衡器。</p><p id="0edb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这种情况下，尝试检查<code class="fe kt ku kv kw b">ProviderID</code> ( <code class="fe kt ku kv kw b"><a class="ae ks" href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/" rel="noopener ugc nofollow" target="_blank">--provider-id</a></code>)是否出现在节点的设置中:</p><pre class="my mz na nb gt ns kw nt nu aw nv bi"><span id="4598" class="lz ma iq kw b gy nw nx l ny nz">root@ip-10–0–0–102:~# kubectl describe node ip-10–0–0–186.eu-west-3.compute.internal | grep ProviderID<br/>ProviderID: aws:///eu-west-3a/i-03b04118a32bd8788</span></pre><p id="9a66" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果没有<code class="fe kt ku kv kw b">ProviderID</code>，使用<code class="fe kt ku kv kw b">kubectl edit node &lt;NODE_NAME&gt;</code>作为<code class="fe kt ku kv kw b">ProviderID: aws:///eu-west-3a/&lt;EC2_INSTANCE_ID&gt;</code>添加它:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi om"><img src="../Images/a24a3253ecac9229b83719324ad916fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dshaJV9Nmc9r3lt2.png"/></div></div></figure><p id="61a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是当您使用设置了<code class="fe kt ku kv kw b">cloud-provider: aws</code>的<code class="fe kt ku kv kw b"><a class="ae ks" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/#config-file" rel="noopener ugc nofollow" target="_blank">JoinConfiguration</a></code>文件加入一个节点时，必须设置它。</p><p id="489d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="7868" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="la">最初发布于</em> <a class="ae ks" href="https://rtfm.co.ua/en/kubernetes-part-2-a-cluster-set-up-on-aws-with-aws-cloud-provider-and-aws-loadbalancer/#Cluster_set_up" rel="noopener ugc nofollow" target="_blank"> <em class="la"> RTFM: Linux、DevOps和系统管理</em> </a> <em class="la">。</em></p></div></div>    
</body>
</html>