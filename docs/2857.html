<html>
<head>
<title>Implementing Microfrontends in GatsbyJS using Ara Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Ara框架在GatsbyJS中实现微前端</h1>
<blockquote>原文：<a href="https://itnext.io/implementing-microfrontends-in-gatsbyjs-using-ara-framework-a95ee79cc0e7?source=collection_archive---------3-----------------------#2019-08-15">https://itnext.io/implementing-microfrontends-in-gatsbyjs-using-ara-framework-a95ee79cc0e7?source=collection_archive---------3-----------------------#2019-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文原载于<a class="ae kl" href="https://ara-framework.github.io/website/blog/2019/08/17/gatsby-js" rel="noopener ugc nofollow" target="_blank"> Ara博客</a>。</p><p id="bda2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.gatsbyjs.org/" rel="noopener ugc nofollow" target="_blank"> GatsbyJS </a>是创建静态网站最流行的框架。在软件行业，静态站点生成器的概念并不是最近才出现的，但是由于JavaScript技术最近的发展和<a class="ae kl" href="https://jamstack.org" rel="noopener ugc nofollow" target="_blank"> JAMstack </a>的引入，它变得越来越流行。</p><p id="6749" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">GatsbyJS使我们能够提供快速可靠的网站，这些网站可以在任何云提供商处轻松、廉价地托管，例如，<a class="ae kl" href="https://zeit.co/" rel="noopener ugc nofollow" target="_blank"> Zeit </a>、<a class="ae kl" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>，以及其他一些使这一任务变得更容易的服务。</p><h1 id="74e2" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">JAMstack和AWS Lambda</h1><p id="211d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">JAMstack的主要特点是仅在构建期间按需提供计算资源来生成静态页面，通常使用无服务器CI/CD工具，如<a class="ae kl" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a>或<a class="ae kl" href="https://travis-ci.org/" rel="noopener ugc nofollow" target="_blank"> Travis CI </a>，这使我们无需管理专用服务器。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/44454154cce069406336ce90b843a977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lbuc243qwiUZl1ax.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">盖茨比解释图</figcaption></figure><p id="f1fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>以类似的方式工作，它运行由webhook触发的功能，通常使用Lambda与API Gateway、SNS、SQS等其他AWS服务集成。</p><p id="ede0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据这个前提，我们可以部署一个lambda函数，它可以在S3桶中生成和存储HTML，或者为什么不部署一个lambda函数，它可以按需呈现HTML。</p><h1 id="842e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">微前端在这里扮演什么角色？</h1><p id="37b9" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">像微服务这样的微前端使团队能够独立开发和发布功能。</p><p id="1525" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">隔离级别使我们能够将不同的框架集成到同一个页面中。然而，这并不意味着我们应该任意混合框架，我们应该在公司范围内定义标准框架和库。</p><p id="adb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，前端技术发展很快，事实是在某些时候我们需要转移到另一个框架。因此，微前端让我们可以灵活地逐渐切换到另一个，而无需从头开始重建前端。</p><h2 id="c8eb" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">场景</h2><p id="94db" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们可以想象一下，我们是一家媒体公司，有很多网站分布在世界各地，由不同的团队维护。我们喜欢React，但在过去的几年里，我们爱上了VueJs，所以它成了我们开发UI的标准库。</p><p id="8ce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的产品团队想尝试一个新的媒体网站，JAMstack适合这个解决方案，但是我们意识到当前的VueJS框架没有我们需要的必要特性。</p><p id="9aa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们发现盖茨比有我们需要的东西。但我们有另一个问题，新网站需要重用以前使用VueJS开发的一些视图，我们可以迁移这些视图来作出反应，但我们没有足够的时间，我们不想在未来维护这两个视图。</p><p id="3392" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，我们的一位成员最近读到了关于微前端的文章，并提出了建议。我们说:“为什么不呢，我们试试吧”。</p><h1 id="850e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是Ara框架？</h1><p id="a6da" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Ara是一个使用<a class="ae kl" href="https://github.com/airbnb/hypernova" rel="noopener ugc nofollow" target="_blank"> Airbnb的Hypernova轻松开发和集成微前端的框架。</a>我们创建了一个名为<a class="ae kl" href="https://github.com/ara-framework/ara-cli/wiki" rel="noopener ugc nofollow" target="_blank"> <em class="mr"> Nova </em> </a> <strong class="jp ir"> </strong>的基础架构来在服务器端包含Nova视图。你可以在这里阅读更多相关信息<a class="ae kl" href="https://github.com/ara-framework/ara-cli/wiki" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="ms mt gp gr mu mv"><a href="https://ara-framework.github.io/website/" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">Ara框架使用Airbnb Hypernova轻松构建微前端</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">使用Airbnb Hypernova轻松构建微前端</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">使用Airbnb hypernovara-framework . github . io轻松构建微前端</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj lz mv"/></div></div></a></div><p id="6694" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我们带来了一个新概念，叫做<em class="mr"> Nova Bridge </em>，我们将在本文中进行解释。</p><h1 id="e78c" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">微前端</h1><p id="bda4" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/ara-framework/hypernova-lambda" rel="noopener ugc nofollow" target="_blank"> Hypernova Lambda </a>是针对AWS Lambda的<a class="ae kl" href="https://github.com/airbnb/hypernova" rel="noopener ugc nofollow" target="_blank"> Airbnb的Hypernova </a>的实现。Hypernova是服务器端渲染JavaScript视图的服务，这些视图在浏览器上进行水合处理以使其动态，它也被称为通用渲染。</p><p id="d0d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Ara框架中，我们通常称Nova为Hypernova服务。</p><h2 id="b4c9" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">创建微前端(Nova)</h2><p id="7c92" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们需要安装Ara CLI来执行一些常见的任务，比如生成nova服务、在本地运行hypernova lambda以及为客户端脚本提供服务。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="0cb1" class="mf kn iq nl b gy np nq l nr ns">$ npm install -g ara-cli</span></pre><p id="93bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装CLI后，我们可以运行以下命令来生成新的Nova服务:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="946c" class="mf kn iq nl b gy np nq l nr ns">$ ara new:nova -t vue novas/global</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nt"><img src="../Images/774070efdc7d363e2eb73bda93c8f3ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1xWHmakQ147zbISb-zZyg.png"/></div></div></figure><p id="3abf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">生成的项目包含一个基本设置。我们把它做得很简单。可定制。</p><p id="f9a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">切入点:</strong></p><p id="2b08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件<code class="fe nu nv nw nl b">src/index.js</code>包含Hypernova服务器的入口点。默认情况下，它使用Express，但是我们稍后将实现AWS Lambda。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="6551" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">示例组件:</strong></p><p id="7b1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nu nv nw nl b">src/components/Example.vue</code>文件使用<code class="fe nu nv nw nl b">title</code>道具渲染一个基本视图。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="7edf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用以下命令运行服务:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="3384" class="mf kn iq nl b gy np nq l nr ns">$ yarn dev</span></pre><p id="5758" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦Hypernova服务器运行，我们将看到下一条消息。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nz"><img src="../Images/66ddbd4f405cc0a047bb5ffc923253ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUz4UslQbZ40MDwgu7g-kg.png"/></div></div></figure><p id="a0a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用以下有效负载测试向<code class="fe nu nv nw nl b"><a class="ae kl" href="http://localhost:3000/batch" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/batch</a></code>发出<code class="fe nu nv nw nl b">POST</code>请求的服务:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="9bcf" class="mf kn iq nl b gy np nq l nr ns">{<br/>  "uuid": {<br/>    "name": "Example",<br/>    "data": {<br/>      "title": "Ara Framework"<br/>    }<br/>  }<br/>}</span></pre><p id="3215" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回应应该是这样的:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="04d5" class="mf kn iq nl b gy np nq l nr ns">{<br/>    "success": true,<br/>    "error": null,<br/>    "results": {<br/>        "uuid": {<br/>            "name": "Example",<br/>            "html": "&lt;div data-hypernova-key=\"Example\" data-hypernova-id=\"cfd4b502-f9a4-4475-9168-233595ea4489\"&gt;&lt;h1 data-server-rendered=\"true\"&gt;Ara Framework&lt;/h1&gt;&lt;/div&gt;\n&lt;script type=\"application/json\" data-hypernova-key=\"Example\" data-hypernova-id=\"cfd4b502-f9a4-4475-9168-233595ea4489\"&gt;&lt;!--{\"title\":\"Ara Framework\"}--&gt;&lt;/script&gt;",<br/>            "meta": {},<br/>            "duration": 11.534634,<br/>            "statusCode": 200,<br/>            "success": true,<br/>            "error": null<br/>        }<br/>    }<br/>}</span></pre><p id="1067" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以注意到响应包含了为<code class="fe nu nv nw nl b">Example</code>视图生成的HTML。</p><h2 id="2455" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">实现超级新星Lambda</h2><p id="4af9" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先，我们需要安装<code class="fe nu nv nw nl b">hypernova-lambda</code>。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="f751" class="mf kn iq nl b gy np nq l nr ns">$ yarn add hypernova-lambda</span></pre><p id="9dc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要修改入口点来使用<code class="fe nu nv nw nl b">hypernova-lambda</code>。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">src/index.js</figcaption></figure><p id="d48a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要删除<code class="fe nu nv nw nl b">webpack.config.js</code>中的<code class="fe nu nv nw nl b">NodemonPlugin</code></p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="6655" class="mf kn iq nl b gy np nq l nr ns">{<br/>  ...<br/>  plugins: [<br/>    new VueLoaderPlugin(),<br/>    new NodemonPlugin() // Remove Nodemon plugin<br/>  ]<br/>}</span></pre><p id="4400" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用CLI在本地运行lambda函数:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="4914" class="mf kn iq nl b gy np nq l nr ns">$ ara run:lambda</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oa"><img src="../Images/511b377d59f77a0d6c8ed5832c9c1478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZpfY93ddLDP0jRhKXRz9A.png"/></div></div></figure><p id="ef05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我们可以使用S3本地服务器在本地提供客户端脚本:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="d0cf" class="mf kn iq nl b gy np nq l nr ns">$ ara run:lambda --asset</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ob"><img src="../Images/efd905e396c668ecd3d5bd73cf577ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fu7nixAMWx9SsT6Md3hBww.png"/></div></div></figure><p id="21ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<a class="ae kl" href="http://127.0.0.1:4568/assets/client.js" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:4568/assets/client . js</a>访问客户端脚本</p><p id="3720" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个演示，我们将在本地测试hypernova lambda。我不会讨论部署方法，这取决于您。</p><h1 id="a170" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">盖茨比项目</h1><p id="1ae8" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">GatsbyJS有自己的CLI来执行常见任务，如创建项目、运行开发服务器、构建网站等等。</p><p id="6d85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要安装它:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="1698" class="mf kn iq nl b gy np nq l nr ns">$ npm install -g gatsby-cli</span></pre><p id="b52c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用CLI创建一个新项目:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="878b" class="mf kn iq nl b gy np nq l nr ns">$ gatsby new gatsby-site</span></pre><p id="a075" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以运行开发服务器:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="3120" class="mf kn iq nl b gy np nq l nr ns">$ yarn develop</span></pre><p id="931d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该命令编译资产并在<a class="ae kl" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>上运行开发服务器</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oc"><img src="../Images/9685dc3c9ec3a5b5ee3bb4e2818d22b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akLqBO85oIM8mAKJoWxK0Q.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">GatsbyJS项目主页</figcaption></figure><p id="a04b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经运行了Nova服务和Gatsby，是时候将我们的<code class="fe nu nv nw nl b">Example</code>视图集成到Gatsby页面中了。</p><h2 id="812d" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">新星桥</h2><p id="9b7d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Nova bridge使我们能够使用任何视图库(如React)来集成和渲染Nova视图。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi od"><img src="../Images/43b0b30d1f85b149ccc47796195a876d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1LXUoTxvmX7GNsmLlFv-eA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">新星桥图</figcaption></figure><ol class=""><li id="d2bd" class="oe of iq jp b jq jr ju jv jy og kc oh kg oi kk oj ok ol om bi translated">Nova桥发出一个<code class="fe nu nv nw nl b">NovaMount</code>事件，通知Nova服务需要渲染和安装一个视图。</li><li id="5eb8" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">客户端入口点侦听事件，并使用事件负载信息来呈现视图。</li><li id="4275" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">客户端入口点在Nova Bridge占位符中装载呈现的视图。</li></ol><h2 id="e26b" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">实现Nova桥</h2><p id="f37d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们需要安装<a class="ae kl" href="https://github.com/ara-framework/nova-react-bridge" rel="noopener ugc nofollow" target="_blank">新星反应桥</a>:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="a065" class="mf kn iq nl b gy np nq l nr ns">$ yarn add nova-react-bridge</span></pre><p id="6bd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦安装了这个包，我们就可以在React组件中放置一个Nova视图。我们将在主页上呈现<code class="fe nu nv nw nl b">Example</code>视图。</p><p id="ce4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">新星组件需要<code class="fe nu nv nw nl b">name</code>和<code class="fe nu nv nw nl b">data</code>道具</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="936b" class="mf kn iq nl b gy np nq l nr ns">&lt;Nova name="Example" data={{ title: 'Ara Framework' }} /&gt;</span></pre><p id="8ed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要编辑文件<code class="fe nu nv nw nl b">src/pages/index.js</code>。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="eb4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要修改Nova服务中的客户端脚本来监听<code class="fe nu nv nw nl b">NovaMount</code>事件并挂载视图。它位于<code class="fe nu nv nw nl b">novas/global/src/client.js</code></p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="2909" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">客户端入口点与服务器非常相似。它使用事件中的<code class="fe nu nv nw nl b">name</code>和<code class="fe nu nv nw nl b">id</code>来渲染和挂载视图。</p><p id="c5b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们需要在<code class="fe nu nv nw nl b">html.js</code>文件中添加入口点脚本。GatsbyJS使用默认的HTML模板，所以我们需要复制并覆盖它。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="af05" class="mf kn iq nl b gy np nq l nr ns">$ cp .cache/default-html.js src/html.js</span></pre><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">html . JSP</figcaption></figure><p id="754f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要再次运行开发服务器</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="2f1a" class="mf kn iq nl b gy np nq l nr ns">$ yarn develop</span></pre><p id="91e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nu nv nw nl b">Example</code>视图显示了带有文本“Ara Framework”的标题</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi os"><img src="../Images/7cf32841e1d99f4dee583d4f726cafab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCUNxnpPoyIouqCiQ4shNQ.png"/></div></div></figure><p id="214a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道<code class="fe nu nv nw nl b">Example</code>视图很简单，让我们让它更具互动性</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">示例. vue</figcaption></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ot"><img src="../Images/d7d82616d87f82b04ad26e4d66418f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QGnGgOp8gq9nX_7BsMlviA.png"/></div></div></figure><p id="3918" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们添加了一个输入控件来更改标题文本。所以让我们去生成我们的静态网站。</p><h2 id="db09" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">用GatsbyJS生成静态网站</h2><p id="3fd7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先，我们需要构建我们的GatsbyJS项目:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="3ff2" class="mf kn iq nl b gy np nq l nr ns">$ yarn build</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nz"><img src="../Images/a95875cb326b62bde09d0dd1e126bf65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iqzjpl9WxiZEXZ2SJ0Cf1g.png"/></div></div></figure><p id="d4f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个命令创建了一个名为<code class="fe nu nv nw nl b">public</code>的文件夹，其中包含生成的文件。</p><p id="a8c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用GatsbyJS CLI运行一个服务器来使用静态文件:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="5dee" class="mf kn iq nl b gy np nq l nr ns">$ yarn serve</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oa"><img src="../Images/9f2bcebe89a802ef695db372b4f6db36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmQziGQUiQnzy9QyS-XKtA.png"/></div></div></figure><p id="46a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个命令将在<a class="ae kl" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank"> http://localhost:9000 </a>上运行服务器。查看生成的HTML，我们可以注意到GatsbyJS只呈现了占位符，没有呈现Nova视图。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ou"><img src="../Images/bc49989d7951648e8a3d25752baac1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0FmwXJnJcdaDLSxY1ztVng.png"/></div></div></figure><p id="6069" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要使用<a class="ae kl" href="https://github.com/ara-framework/nova-static" rel="noopener ugc nofollow" target="_blank"> Nova Static </a>来包含Nova服务渲染的视图。</p><h2 id="fe9e" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated">使用Nova Static包含Nova视图</h2><p id="0ca1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/ara-framework/nova-static" rel="noopener ugc nofollow" target="_blank"> Nova Static </a>是Ara框架的一个工具部分，它使我们能够在静态HTML文件中包含Nova视图。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ov"><img src="../Images/ea7019059f7a095a69856a6d489f6318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Xfi3GoFGuRcSwSEZaEB_A.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk translated">Nova静态图</figcaption></figure><ol class=""><li id="d843" class="oe of iq jp b jq jr ju jv jy og kc oh kg oi kk oj ok ol om bi translated">静态站点生成器生成静态文件(HTML、CSS、JS等)。</li><li id="faf4" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova Static读取HTML文件。</li><li id="ee82" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova Static解析并抓取HTML，为Nova服务(Hypernova Lambda)创建一个请求负载。</li><li id="cb40" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova Static向Nova服务请求Nova视图。</li><li id="b560" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova服务服务器端呈现视图并将它们发送回Nova Static。</li><li id="475d" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova Static用Nova服务呈现的HTML替换占位符(Transclusion)。</li><li id="1f35" class="oe of iq jp b jq on ju oo jy op kc oq kg or kk oj ok ol om bi translated">Nova Static用新的HTML文件替换HTML文件的内容。</li></ol><h2 id="4111" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated"><strong class="ak">安装Nova Static </strong></h2><p id="16ef" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Nova Static是使用GO开发的，因此我们需要在CI/CD中使用一个安装了Go的容器。</p><p id="5a96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以安装可执行文件:</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="bbf5" class="mf kn iq nl b gy np nq l nr ns">$ export GOPATH=~/go</span><span id="c8a6" class="mf kn iq nl b gy ow nq l nr ns">$ <!-- -->go get github.com/ara-framework/nova-static/nova-static</span><span id="9bea" class="mf kn iq nl b gy ow nq l nr ns">$ go install github.com/ara-framework/nova-static/nova-static</span><span id="6901" class="mf kn iq nl b gy ow nq l nr ns">$ <!-- -->export PATH="$PATH:$GOPATH/bin"</span></pre><p id="792d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行命令<code class="fe nu nv nw nl b">nova-static</code>时可执行文件应该是可用的，我们接下来将使用它。</p><h2 id="2963" class="mf kn iq bd ko mg mh dn ks mi mj dp kw jy mk ml la kc mm mn le kg mo mp li mq bi translated"><strong class="ak">运行新星静态</strong></h2><p id="d604" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先，我们需要定义一些环境变量:</p><p id="03e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nu nv nw nl b">HYPERNOVA_BATCH</code>是向Nova服务请求视图的端点。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="e50b" class="mf kn iq nl b gy np nq l nr ns">$ export HYPERNOVA_BATCH=http://localhost:3000/batch</span></pre><p id="0a8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe nu nv nw nl b">STATIC_FOLDER</code>是包含静态文件的文件夹</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="6019" class="mf kn iq nl b gy np nq l nr ns">/* Relative path from the gatsby project */<br/>$ export STATIC_FOLDER=./public</span></pre><p id="ff1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦环境变量被导出，我们可以运行<code class="fe nu nv nw nl b">nova-static</code>命令。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="5ee1" class="mf kn iq nl b gy np nq l nr ns">$ nova-static</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ox"><img src="../Images/11ce65db2c7d301997eadbd36c49025b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wodj2jlGvz6LqIJ5HiCVtw.png"/></div></div></figure><p id="3c33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行服务器时，我们可以注意到Nova视图包含在静态文件中。</p><pre class="lq lr ls lt gt nk nl nm nn aw no bi"><span id="510f" class="mf kn iq nl b gy np nq l nr ns">$ yarn serve</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oy"><img src="../Images/85195b94cced74312a187a3501583c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kT_X2-7b33qdukc1s92GCQ.png"/></div></div></figure><p id="34d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们禁用浏览器中的JavaScript时，也会呈现Nova视图。你可以在Chrome中使用这个<a class="ae kl" href="https://chrome.google.com/webstore/detail/quick-javascript-switcher/geddoclleiomckbhadiaipdggiiccfje?hl=en" rel="noopener ugc nofollow" target="_blank">扩展</a>。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi oz"><img src="../Images/10078a56a952e60b5b5a859c1fd29544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TW1_emP6y4OOQ6X60Ax2fA.png"/></div></div></figure><p id="5163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Gatsby的另一个特点是客户端路由。页面在浏览器中交付后，用户无需从静态文件服务器加载页面即可浏览页面。</p><p id="3453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将<code class="fe nu nv nw nl b">Example</code>添加到<code class="fe nu nv nw nl b">page-2</code>页面中。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nx ny l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi pa"><img src="../Images/5f0e60706daca5ccd863b8cf4b146a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gz3YwZHsOxSPFthKTBKFrg.png"/></div></div></figure><p id="ea95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以注意到Nova视图也是在导航到另一个页面后挂载的。每次需要挂载Nova视图时，Nova Bridge都会发出<code class="fe nu nv nw nl b">NovaMount</code>事件。在这种情况下，每次React都会挂载一个Nova组件。</p><h1 id="9201" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论</h1><p id="85ca" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">使用AWS Lambda的Nova服务是实现JAMStack架构的好伙伴。我们可以在构建期间使用它们来呈现HTML，并将它们包含到任何静态站点生成器(Jekyll、Next、Nuxt等)生成的页面中。</p><p id="52b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Nova Bridge为我们提供了在运行时集成Nova视图的灵活性。在这个演示中，我们安装了VueJS视图，但是我们可以交付从其他团队开发和部署的独立的React视图。</p><div class="ms mt gp gr mu mv"><a href="https://github.com/marconi1992/ara-gatsby-demo" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd ir gy z fp na fr fs nb fu fw ip bi translated">马可尼1992/阿拉-盖茨比-德莫</h2><div class="nc l"><h3 class="bd b gy z fp na fr fs nb fu fw dk translated">安装GatsbyJS项目的依赖项gatsby-site $ yarn安装安装novas服务的依赖项novas/global…</h3></div><div class="nd l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">github.com</p></div></div><div class="ne l"><div class="pb l ng nh ni ne nj lz mv"/></div></div></a></div></div></div>    
</body>
</html>