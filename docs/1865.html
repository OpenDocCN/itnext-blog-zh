<html>
<head>
<title>AWS Lambda Simplified With Serverless Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Lambda通过无服务器框架得到简化</h1>
<blockquote>原文：<a href="https://itnext.io/aws-lambda-simplified-with-serverless-framework-8fbc01418422?source=collection_archive---------1-----------------------#2019-02-12">https://itnext.io/aws-lambda-simplified-with-serverless-framework-8fbc01418422?source=collection_archive---------1-----------------------#2019-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/15971174c45beed2defeaa6cfb7be540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SKPLdqS1a5IZ09JH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">潘卡杰·帕特尔在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="41b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你以前使用过<a class="ae kc" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>来创建一个使用<a class="ae kc" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API Gateway </a>的API，那么你一定知道在频繁更新的情况下创建和管理它们的痛苦。对我来说也是如此，尤其是许多功能很难管理，很难调试和频繁更新。由于有许多管理Lambda的框架，我尝试了<a class="ae kc" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>，一切都为我改变了。看到管理和跟踪一切是如此的强大和简单，我真是大吃一惊。这有助于开发和部署Lambda功能，以及管理AWS基础设施资源。这有助于我将注意力集中在编写代码上，而不用担心基础设施管理。</p><p id="a541" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简单介绍一下无服务器计算，它是一个云计算模型，旨在抽象基础架构管理，提供一个具有按使用付费模式的内在可扩展设计。这有助于提供可用性和容错性，这有助于开发人员专注于编写业务逻辑，而不用担心其他事情。</p><p id="c810" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在无服务器中，我们有一个功能，它是一个独立的部署单元，只是在云上执行的代码。任何触发这些功能的事情都被称为事件。执行这些功能所需的资源(基础设施)由云提供商管理。就无服务器框架而言，我们需要创建一个类似项目的服务，包含功能、触发这些功能的事件以及它们所需的资源。</p><p id="d5fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将创建一个NodeJs函数，它可以使用无服务器框架部署在AWS Lambda上。为此，我们首先需要使用'<a class="ae kc" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>'安装无服务器框架。无服务器为我们提供了两个彼此等价的命令‘无服务器’和‘SLS’。我们将在本文中使用“无服务器”命令。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="6f73" class="lk ll iq lg b gy lm ln l lo lp">npm install -g serverless</span></pre><p id="1c8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了开始在无服务器上工作，我们需要创建一个服务，在这里我们需要用一个服务名来传递NodeJs运行时，这个服务名充当我们的代码所在的目录的名称。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d8cf" class="lk ll iq lg b gy lm ln l lo lp">serverless create --template aws-nodejs --path <!-- -->lambdaService</span><span id="c95a" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">Response of this command</strong>:</span><span id="feea" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Generating boilerplate...<br/>Serverless: Generating boilerplate in "/path/to/lambda/lambdaService"<br/> _______                             __<br/>|   _   .-----.----.--.--.-----.----|  .-----.-----.-----.<br/>|   |___|  -__|   _|  |  |  -__|   _|  |  -__|__ --|__ --|<br/>|____   |_____|__|  \___/|_____|__| |__|_____|_____|_____|<br/>|   |   |             The Serverless Application Framework<br/>|       |                           serverless.com, v1.37.1<br/> -------'</span><span id="1af6" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Successfully generated boilerplate for template: "aws-nodejs"</span></pre><p id="42df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在服务目录中创建了两个文件，分别名为<strong class="kf ir"> serverless.yml </strong>和<strong class="kf ir"> handler.js </strong>。yml包含我们的无服务器代码的配置，它定义了部署服务的提供者、功能细节、使用的任何自定义插件、触发每个功能的事件、功能所需的资源等。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3f4b" class="lk ll iq lg b gy lm ln l lo lp"># Welcome to Serverless!<br/>#<br/># This file is the main config file for your service.<br/># It's very minimal at this point and uses default values.<br/># You can always add more config options for more control.<br/># We've included some commented out config examples here.<br/># Just uncomment any of them to get that config option.<br/>#<br/># For full config options, check the docs:<br/>#    docs.serverless.com<br/>#<br/># Happy Coding!</span><span id="97df" class="lk ll iq lg b gy lq ln l lo lp">service: lambdaService</span><span id="d3c9" class="lk ll iq lg b gy lq ln l lo lp">provider:<br/>  name: aws<br/>  runtime: nodejs8.10<br/>  stage: dev<br/>  region: us-east-1<br/>  memorySize: 512 </span><span id="849d" class="lk ll iq lg b gy lq ln l lo lp">plugins:<br/>  - serverless-offline</span><span id="43a8" class="lk ll iq lg b gy lq ln l lo lp">custom:<br/>    serverless-offline:<br/>        port: 4000</span><span id="09ef" class="lk ll iq lg b gy lq ln l lo lp">functions:<br/>  ourFunction:<br/>    handler: handler.ourFunction<br/>    description: Used to as dummy lambda function<br/>    events:<br/>     - http:<br/>         path: /<br/>         method: get</span></pre><p id="8429" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">handler.js文件包含项目的lambda函数代码。在serverless.yml中定义的每个函数都将指向handler.js中的一个函数。我们将把这个文件中的所有代码都写在一个将要被调用的函数中。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="765d" class="lk ll iq lg b gy lm ln l lo lp">'use strict';</span><span id="61ca" class="lk ll iq lg b gy lq ln l lo lp">module.exports.ourFunction = async (event, context) =&gt; {<br/> return {<br/>  statusCode: 200,<br/>  body: JSON.stringify({<br/>   message: 'Function executed successfully!',<br/>   input: event,<br/>  }),<br/> };<br/>};</span></pre><p id="4cc5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将创建一个API来调用我们的函数。这将触发API网关路由的创建，该路由将根据请求调用Lambda。我们刚刚在我们的serverless.yml文件中添加了API相关的细节，我们准备好了。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d5c4" class="lk ll iq lg b gy lm ln l lo lp">ourFunction:<br/>    handler: handler.ourFunction<br/>    description: Used to as dummy lambda function<br/>    events:<br/>     - http:<br/>         path: /<br/>         method: get</span></pre><p id="cba4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们完成了在处理函数中编写业务逻辑的工作，我们需要将这些代码部署到AWS Lambda中。当我们运行命令来部署所有功能、事件和资源时，它们是使用AWS CloudFormation模板创建的。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="826f" class="lk ll iq lg b gy lm ln l lo lp">serverless deploy</span><span id="e51f" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">Response of this command</strong>:</span><span id="b420" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Packaging service...<br/>Serverless: Excluding development dependencies...<br/>Serverless: Creating Stack...<br/>Serverless: Checking Stack create progress...<br/>.....<br/>Serverless: Stack create finished...<br/>Serverless: Uploading CloudFormation file to S3...<br/>Serverless: Uploading artifacts...<br/>Serverless: Uploading service lambdaService.zip file to S3 (1.36 MB)...<br/>Serverless: Validating template...<br/>Serverless: Updating Stack...<br/>Serverless: Checking Stack update progress...<br/>...........................<br/>Serverless: Stack update finished...<br/>Service Information<br/>service: lambdaService<br/>stage: dev<br/>region: us-east-1<br/>stack: lambdaService-dev<br/>resources: 9<br/>api keys:<br/>  None<br/>endpoints:<br/>  GET - <a class="ae kc" href="https://1wntg29ej5.execute-api.us-east-1.amazonaws.com/dev/" rel="noopener ugc nofollow" target="_blank">https://1hntg29euyg.execute-api.us-east-1.amazonaws.com/dev/</a><br/>functions:<br/>  ourFunction: lambdaService-dev-ourFunction<br/>layers:<br/>  None</span></pre><p id="b098" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在部署此服务之前，我们需要确保的一件事是，我们创建并存储所需的AWS凭证。详情可在<a class="ae kc" href="https://serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。您甚至可以使用以下命令为无服务器设置AWS凭据:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="88b4" class="lk ll iq lg b gy lm ln l lo lp">serverless config credentials --provider aws --key AWS_ACCESS_KEY --secret AWS_SECRET</span></pre><p id="e5ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从本地系统使用“invoke”命令调用我们的lambda函数，并从lambda获得日志响应。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="9b29" class="lk ll iq lg b gy lm ln l lo lp">serverless invoke -f <!-- -->ourFunction<!-- --> -l</span></pre><p id="18b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无服务器框架最好的一点是它的插件，可以通过npm轻松下载并使用serverless.yml添加。这里我们将使用serverless-offline创建一个本地API路由，可用于本地调试。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="19dd" class="lk ll iq lg b gy lm ln l lo lp">npm install serverless-offline</span></pre><p id="2e8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过更改serverless.yml文件中的配置来更改脱机应用程序的端口。要离线运行lambda，我们只需要运行下面的命令，就可以进行本地调试了。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="5e40" class="lk ll iq lg b gy lm ln l lo lp">serverless offline start</span><span id="f970" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">Response of command</strong>:</span><span id="5ce4" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Starting Offline: dev/us-east-1.</span><span id="8907" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Routes for ourFunction:<br/>Serverless: GET /</span><span id="3741" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Offline listening on <a class="ae kc" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank">http://localhost:4000</a></span></pre><p id="c27b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦一切都完成了，我们不需要这个函数，那么我们可以通过执行remove命令简单地删除它。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="7b8d" class="lk ll iq lg b gy lm ln l lo lp">serverless remove</span><span id="69d6" class="lk ll iq lg b gy lq ln l lo lp"><strong class="lg ir">Response of this command</strong>:</span><span id="2a40" class="lk ll iq lg b gy lq ln l lo lp">Serverless: Getting all objects in S3 bucket...<br/>Serverless: Removing objects in S3 bucket...<br/>Serverless: Removing Stack...<br/>Serverless: Checking Stack removal progress...<br/>........<br/>Serverless: Stack removal finished...</span></pre><p id="69db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有这些让我们的生活变得足够简单，使用Lambda不再是痛苦的经历。</p><p id="46a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="lr"> PS:如果你喜欢这篇文章，请用掌声支持它</em> </strong>👏<strong class="kf ir"> <em class="lr">。欢呼</em> </strong></p></div></div>    
</body>
</html>