<html>
<head>
<title>A framework I wrote (and why you shouldn’t use it)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写的一个框架(以及为什么你不应该使用它)</h1>
<blockquote>原文：<a href="https://itnext.io/a-framework-i-wrote-and-why-you-shouldnt-use-it-276f25a39529?source=collection_archive---------3-----------------------#2019-06-01">https://itnext.io/a-framework-i-wrote-and-why-you-shouldnt-use-it-276f25a39529?source=collection_archive---------3-----------------------#2019-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="24c2" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">最近向我展示了<code class="fe kf kg kh ki b">FluentValidation</code>，这是。NET——我决定用Swift重写框架。它很好用…但是你应该使用它吗？</h2></div><h1 id="a252" class="kj kk iq bd kl km kn ko kp kq kr ks kt jw ku jx kv jz kw ka kx kc ky kd kz la bi translated">流畅验证</h1><p id="f184" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae lx" href="https://github.com/JeremySkinner/FluentValidation" rel="noopener ugc nofollow" target="_blank">这里的</a>是原文。NET框架(这里的<a class="ae lx" href="https://github.com/maxchuquimia/SwiftFluentValidation" rel="noopener ugc nofollow" target="_blank">是我的版本)。该框架背后的思想是，您可以使用“流畅的”规则来验证实例的属性，从而确定整个实例是否可以被视为“有效”。假设你有一个<code class="fe kf kg kh ki b">CustomerModel</code>比如:</a></p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/1acd133f2781dad4124190fae400430e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApjJCFp0IPkOsluiDCj-Eg.png"/></div></div></figure><p id="61d2" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">您可以简单地通过<code class="fe kf kg kh ki b">import FluentValidation</code>和子类<code class="fe kf kg kh ki b">FluentValidator</code>为<code class="fe kf kg kh ki b">CustomerModel</code>构建一个验证器。由于<code class="fe kf kg kh ki b">KeyPath</code>将规则的输入值限制为通用模型的有效属性，它完全是强类型的。最后，我认为Swift框架比。网一！</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/9fe31958b2694b4a920291c05af2fd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bsh5moj_F1yYWWYA7ZpcfQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">❤仿制药。那是一件t恤吗？</figcaption></figure><p id="891b" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">然后，验证器可以被实例化和重用:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/09bd1584a77b454dc2e014e9823c97a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACyj2XDizIzCqHIwsbrYFg.png"/></div></div></figure><p id="0460" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">很漂亮吧？由于泛型的强大功能，当规则失败时返回的错误也是强类型的。如果您喜欢简单地使用字符串消息，如。NET版本，你可以<a class="ae lx" href="https://i.imgur.com/cw5vxX5.png" rel="noopener ugc nofollow" target="_blank">在<code class="fe kf kg kh ki b">String</code>上创建一个扩展</a>，使其符合<code class="fe kf kg kh ki b">Error</code>协议…</p><h1 id="7d80" class="kj kk iq bd kl km kn ko kp kq kr ks kt jw ku jx kv jz kw ka kx kc ky kd kz la bi translated">你真的需要一个框架来验证吗？</h1><p id="4c72" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">考虑以下静态函数:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/15eff286fcf71d29c463958e2f5f0f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgaO-xnJqMcLhtP02THfgA.png"/></div></div></figure><p id="6f17" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">它完成与验证器相同的任务:给定一个<code class="fe kf kg kh ki b">CustomerModel</code>，如果它有问题，将返回一个错误。可以自己做，不用框架！</p><h2 id="7f1f" class="mt kk iq bd kl mu mv dn kp mw mx dp kt lk my mz kv lo na nb kx ls nc nd kz ne bi translated">营养价值</h2><p id="8b16" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">随着Cocoapods逐渐进入正常状态，iOS开发人员的思维方式发生了转变:通过[Pod]文件中的一行代码，可以导入多个progress spinnerss，这些spinner可以根据您的喜好进行实例化(您知道我说的这个库)。外包整个网络层的开发也变得可能(同样，你确切地知道我在说什么)。但是营养价值在哪里呢？对我来说，我选择编码的原因是..因为我喜欢编码。您可以从构建自己的网络层以及在下一个项目中对其进行改进中学到很多东西。但是，在让自己依赖第三方之前，你应该三思而行，还有许多其他原因。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ng"><img src="../Images/9ee73ddda912d8214115831f8c8d690f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JhltyhC82jHbSFGhb9mQEg.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">方便，但从长远来看可能对你不健康</figcaption></figure><h2 id="f925" class="mt kk iq bd kl mu mv dn kp mw mx dp kt lk my mz kv lo na nb kx ls nc nd kz ne bi translated">信心</h2><p id="f0e5" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">当为客户做一个项目时，不可避免地会有错误出现的时候。午餐是不可能的日子。在这段艰难时期，你最不需要的就是回答这个问题:</p><blockquote class="nh"><p id="dde7" class="ni nj iq bd nk nl nm nn no np nq lw dk translated">这个bug是我/我的团队创造的还是我们使用的库创造的？</p></blockquote><p id="c9a3" class="pw-post-body-paragraph lb lc iq ld b le nr jr lg lh ns ju lj lk nt lm ln lo nu lq lr ls nv lu lv lw ij bi translated">假设你导入了我的框架，你的应用程序中出现了一个关于验证不能正常工作的错误。是我的错，还是你的错？您可能已经手动下载了我的框架并运行了单元测试:如果您这样做了，您将看到我有40+次通过测试，导致100%的代码覆盖率。你单独阅读所有的测试了吗？如果不是，您如何确定其中一个过程不是假阳性？如果您使用了一个静态函数进行对象验证，比如本文前面显示的函数，那么您可以立即确定是您引入了这个bug。</p><p id="272e" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">有时候问题是错误<em class="nf">没有</em>在应该发生的时候发生。在开发过程中应用程序崩溃是发现你做错了什么，你需要在提交代码之前修复它的重要部分。我见过一个布局框架，如果一个视图没有超级视图，它就什么也不做:这给我们造成了很多困惑，因为我们没有意识到我们忘记了将目标视图添加到层次结构中，所以我们不知道哪里出了问题。默认情况下，如果您试图在无效环境中进行约束，Autolayout会导致崩溃——非常有用！</p><p id="cff0" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">我们在Objective C项目中使用的另一个框架是将所有对委托方法的调用包装在一个<code class="fe kf kg kh ki b">@try { }</code>块中。这意味着回调触发的所有代码都不会崩溃，即使访问数组中的无效范围。通过带有断点的代码，可以看到一个函数无法执行它的某些行。</p><h2 id="157c" class="mt kk iq bd kl mu mv dn kp mw mx dp kt lk my mz kv lo na nb kx ls nc nd kz ne bi translated">维护</h2><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nw"><img src="../Images/f607183ac8ab9b8ac9a8a49b94341eb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BVzqtVZIj005FWFMxr0kg.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">这件事发生在我发表这篇文章之前的工作中，所以我决定附上一张截图。</figcaption></figure><p id="bc2f" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">新版Swift发布后会发生什么？我可能太忙了，没时间更新<code class="fe kf kg kh ki b">FluentValidation</code>，所以你的团队可能在下一次冲刺中无法下载最新版本的Xcode。或者，我可能会重命名一些方法，导致下次更新依赖项时构建失败。我似乎记得一年前我打开一个项目时，在我可以编译之前，必须用<code class="fe kf kg kh ki b">.distinctUntilChanged({ $0, $1 })</code>替换每个<code class="fe kf kg kh ki b">.distinctUntilChanged()</code>的<a class="ae lx" href="https://github.com/ReactiveX/RxSwift/issues/1611#issuecomment-379213750" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c20c" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">或者，更糟糕的是，也许你去了Github并注意到一个新的提交:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nx"><img src="../Images/d49403e6b4415c271e732fc5119e6d16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvj2dASgdxi3BGcItB1RsA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">这种情况最近发生在我们身上:我们放入导航结构的框架将不再更新。祝我们好运告诉客户这件事。</figcaption></figure><p id="722e" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">接下来会发生什么？你要么需要熟悉我在两个工作日晚上写的代码，因为我想证明一个观点，要么你需要从你的应用程序中取出<code class="fe kf kg kh ki b">FluentValidation</code>并重新编写你所有的验证。</p><h2 id="7247" class="mt kk iq bd kl mu mv dn kp mw mx dp kt lk my mz kv lo na nb kx ls nc nd kz ne bi translated">入职</h2><p id="3f9b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">同样重要的是要考虑一个新的开发人员如何容易地进入代码并理解正在发生的事情。他们是否需要在开始理解如何实现一个特性或修复一个bug之前学习一个全新的范例？</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/073f616e6cc0756fdb41bcf0844c1bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALr7HWwt1WRUcBzSkeBUyg.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">这是…第一次看的时候很有面子。</figcaption></figure><h1 id="f5dc" class="kj kk iq bd kl km kn ko kp kq kr ks kt jw ku jx kv jz kw ka kx kc ky kd kz la bi translated">结论</h1><p id="c4b7" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">当然，有些情况下第三方框架是有用的。当然，我并不讨厌开源项目:我喜欢分享知识和想法——这就是为什么你可以免费阅读这篇文章！</p><p id="0566" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">要从中吸取的信息是:不要因为Github上有15，267颗星，或者因为它的ReadMe文件顶部有一个花哨的徽标和闪亮的徽章，就诱使自己导入一个框架。事实上，尽量不要把它想成“导入一个框架”——把它想成“让自己依赖一个陌生人的代码”。</p><p id="89fa" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">自己写代码。相信你写的代码。下次改进它。</p><p id="76a9" class="pw-post-body-paragraph lb lc iq ld b le mk jr lg lh ml ju lj lk mm lm ln lo mn lq lr ls mo lu lv lw ij bi translated">不要让iOS社区将自己导向一个npm式的厌恶者。</p></div></div>    
</body>
</html>