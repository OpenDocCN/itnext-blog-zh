<html>
<head>
<title>Flutter: Dart Immutable Objects JSON Serialization and Deserialization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter: Dart不可变对象JSON序列化和反序列化</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-dart-immutable-objects-json-serialization-and-deserialization-dff917b1af2?source=collection_archive---------4-----------------------#2020-06-12">https://itnext.io/flutter-dart-immutable-objects-json-serialization-and-deserialization-dff917b1af2?source=collection_archive---------4-----------------------#2020-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/b8eab3e217c92faa0ff894df3afe90ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*agEJ53X5DX9D9qCbB0FY8w.jpeg"/></div></div></figure><div class=""/><p id="3e0d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://medium.com/@muccy/flutter-dart-immutable-objects-and-values-5e321c4c654e" rel="noopener">之前的一篇文章</a>中，我讨论了关于<code class="fe kx ky kz la b">freezed</code>和<code class="fe kx ky kz la b">kt_dart</code>的内容，这两个包为Dart和Flutter带来了不可变的值类型。我忽略了<code class="fe kx ky kz la b">freezed</code>揭露的一个免费功能:与<code class="fe kx ky kz la b"><a class="ae kw" href="https://github.com/dart-lang/json_serializable" rel="noopener ugc nofollow" target="_blank">json_serialializable</a></code>的集成。</p><h2 id="2ea9" class="lb lc jb bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">装置</h2><p id="b2a0" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">首先，将依赖项添加到<code class="fe kx ky kz la b">pubspec.yaml</code>文件中:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="7ffc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，像这样编辑您的不可变对象声明:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><ul class=""><li id="c8b7" class="mf mg jb ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated">您需要声明另一个带有<code class="fe kx ky kz la b">.g.dart</code>后缀的<code class="fe kx ky kz la b">part</code>文件。</li><li id="d666" class="mf mg jb ka b kb mo kf mp kj mq kn mr kr ms kv mk ml mm mn bi translated">您需要声明一个名为<code class="fe kx ky kz la b">fromJson</code>的新工厂构造函数，并将其绑定到由<code class="fe kx ky kz la b">freezed</code>生成器提供的合成反序列化器。</li></ul><p id="9ee8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！就是管用！</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">如果您提供了错误的类型或者遗漏了一些必填字段，那么`<code class="fe kx ky kz la b">fromJson`</code>将会抛出一个异常。</figcaption></figure><p id="d7b1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以获得一个返回<code class="fe kx ky kz la b">Map&lt;String, dynamic&gt;</code>的免费<code class="fe kx ky kz la b">toJson</code>方法。</p><p id="4836" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过使用<code class="fe kx ky kz la b">json_serializable</code> <a class="ae kw" href="https://github.com/dart-lang/json_serializable/tree/master/json_serializable#annotation-values" rel="noopener ugc nofollow" target="_blank">注释</a>来影响JSON模型。比如说。您可以更改字段名称:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="33fd" class="lb lc jb bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">不可变集合</h2><p id="1740" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">虽然<code class="fe kx ky kz la b">json_serializable</code>能够处理普通的<code class="fe kx ky kz la b">List</code>或<code class="fe kx ky kz la b">Dictionary</code>对象，但是我们希望支持<code class="fe kx ky kz la b">kt_dart</code>包提供的不可变类型。您有两种方法来扩展此功能:前者是编写一组自定义转换器:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="96d1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我很确定你已经发现了问题:因为你必须调用<code class="fe kx ky kz la b">cast()</code>你必须为每个封闭类型写一个转换的。目前还不可能写出一个通用版本。这不是一个大问题，因为它们是一行程序，但肯定有点乏味。</p><p id="b99e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">后一种方式是使用名为<code class="fe kx ky kz la b"><a class="ae kw" href="https://github.com/knaeckeKami/json_serializable_immutable_collections" rel="noopener ugc nofollow" target="_blank">json_serializable_immutable_collections</a></code>的<code class="fe kx ky kz la b">json_serializable</code>扩展。你把它安装在<code class="fe kx ky kz la b">pubspec.yaml</code>文件的<code class="fe kx ky kz la b">dev_dependencies</code>里面:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="26cf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后创建一个<code class="fe kx ky kz la b">build.yaml</code>文件来指示源代码生成器使用这个扩展:</p><figure class="lz ma mb mc gt is"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="120b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后您可以重新启动<code class="fe kx ky kz la b">build_runner</code>和<code class="fe kx ky kz la b">KtList</code>，<code class="fe kx ky kz la b">KtSet</code>和<code class="fe kx ky kz la b">KtMap</code>将在没有特殊转换器的情况下得到支持。</p><h2 id="aecb" class="lb lc jb bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">VS代码集成</h2><p id="4d19" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您可以通过<em class="mx">浏览器</em>选项卡中的<code class="fe kx ky kz la b">json_serializable</code>隐藏生成的文件。为此，打开<em class="mx">设置</em>并搜索<em class="mx">文件:排除</em>首选项。然后，你可以将这个模式添加到列表中:<code class="fe kx ky kz la b">**/*.g.dart</code>。</p></div></div>    
</body>
</html>