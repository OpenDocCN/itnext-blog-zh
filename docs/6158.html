<html>
<head>
<title>Jenkins Tutorial — Part 5 — When Conditions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">詹金斯教程—第5部分—当条件</h1>
<blockquote>原文：<a href="https://itnext.io/jenkins-tutorial-part-5-when-conditions-76e61fc8ac0e?source=collection_archive---------0-----------------------#2021-09-05">https://itnext.io/jenkins-tutorial-part-5-when-conditions-76e61fc8ac0e?source=collection_archive---------0-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c518273176f996c36d381a98cf53ea9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isD_dDi7u493JTm4ZudxOw.jpeg"/></div></div></figure><p id="464a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Jenkins教程系列的这篇文章中，我打算解释Jenkins管道中的条件。假设您希望在满足一个或多个条件时执行管道阶段。你怎么能这样做？答案是当条件具备时。那么，我们开始吧。</p><p id="43e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对这个教程系列感兴趣，<strong class="ka ir"> STAR </strong> ize以下GitHub repo。这个回购是我为本教程创建的一个特殊回购。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/jenkins-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/jenkins-教程:Jenkins参考和管道代码示例</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">Jenkins参考和管道代码示例的Jenkins教程系列-GitHub-ssbo stan/Jenkins-教程…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="57e7" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">詹金斯“何时”指令:</h1><p id="d785" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">流水线阶段的执行可以用条件来控制。这些条件必须在每个阶段的<code class="fe mr ms mt mu b">when</code>块中定义。Jenkins支持一组重要的条件，可以定义这些条件来限制阶段执行。每个<code class="fe mr ms mt mu b">when</code>块必须包含至少一个条件。如果在<code class="fe mr ms mt mu b">when</code>块中声明了多个条件，那么对于正在执行的阶段，所有条件都应该返回true。此外，使用嵌套条件可以定义更复杂的条件，下面将对此进行解释。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="00ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以上示例中的阶段<strong class="ka ir">测试</strong>仅在管道作业的第一次运行时运行，且仅运行一次。这个阶段不是从二号楼开始运行。</p><h1 id="ded0" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">内置条件:</h1><p id="f602" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">Jenkins本地支持的条件称为内置条件。除了这些条件，一些插件可能会添加更多的条件。对于这种情况，请参见Jenkins插件文档。</p><p id="8306" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> branch </strong>用给定的模式检查源代码分支名。如果分支名称与模式匹配，则执行阶段。您应该注意，这种情况仅适用于多分支管道。</p><p id="aac8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下例中的<strong class="ka ir">测试</strong>阶段在分支名称以“release-”开始时执行，所有ANT样式的模式都被接受。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="89bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> buildingTag </strong>如果当前git提交有一个标签，则运行下面的阶段。这种情况受到一个未修复的错误的影响，如果您看到它不起作用，您应该手动设置TAG_NAME环境变量。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="0015" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> changelog </strong>获取一个正则表达式，并将其与上一次git提交的消息进行匹配。如果日志消息与给定的模式匹配，则执行下面的阶段。您应该注意，此条件仅在多分支管道以及脚本来自SCM repo的管道中有效。在下面的示例中，当git提交消息包含“<strong class="ka ir"> Test </strong>”字符串时，该阶段运行。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="39cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">变更集</strong>按照给定的模式观察文件/目录的变化。它会看到最后一次git提交，如果有任何文件/目录发生了与给定模式相匹配的更改，就会执行这个阶段。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="cac5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">环境</strong>检查环境变量值。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5de4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">等于</strong>如果实际值等于期望值，则运行阶段。例如，如果当前内部版本号为1，以下条件将运行阶段。可以说，它只运行一次。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5670" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">表达式</strong>获取一个Groovy语言表达式，如果表达式的值为true，则运行下面的阶段。在字符串的情况下，包括“0”和“假”的所有值都返回<strong class="ka ir">真</strong>。如果您打算使用字符串作为表达式的一部分，您必须将值设置为<strong class="ka ir"> null </strong>，以将其计算为<strong class="ka ir"> false </strong>。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="68ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果TAG_NAME变量与给定模式匹配，tag 运行舞台。如果模式为空，并且TAG_NAME变量存在，它将运行舞台。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="12e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> triggeredBy </strong>当当前构建被给定参数触发时，执行该阶段。此条件对于通知非常有用。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="1937" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">詹金斯复杂条件:</h1><p id="8de6" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">复杂条件通常是上面解释的一组条件。Jenkins支持三种复杂/嵌套条件。<code class="fe mr ms mt mu b">not</code>、<code class="fe mr ms mt mu b">allOf</code>、<code class="fe mr ms mt mu b">anyOf</code>是与条件结合使用的复杂条件。</p><p id="b22c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> not </strong>执行嵌套条件为<strong class="ka ir">假</strong>的阶段。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d278" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果所有嵌套条件都为<strong class="ka ir">真</strong>，则<strong class="ka ir"> allOf </strong>执行该阶段。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6b26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果至少有一个嵌套条件为<strong class="ka ir">真</strong>，anyOf </strong>执行该阶段。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="mz na l"/></div></figure><h1 id="2a03" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">何时评估“When”指令？</h1><p id="4a61" class="pw-post-body-paragraph jy jz iq ka b kb mm kd ke kf mn kh ki kj mo kl km kn mp kp kq kr mq kt ku kv ij bi translated">默认情况下，<code class="fe mr ms mt mu b">when</code>指令在<code class="fe mr ms mt mu b">agent</code>、<code class="fe mr ms mt mu b">input</code>和<code class="fe mr ms mt mu b">options </code>指令之后被评估。您可以在<code class="fe mr ms mt mu b">when</code>块内用<code class="fe mr ms mt mu b">beforeAgent</code>、<code class="fe mr ms mt mu b">beforeInput</code>和<code class="fe mr ms mt mu b">beforeOptions</code>改变这些。</p><pre class="mv mw mx my gt nb mu nc nd aw ne bi"><span id="07e9" class="nf lp iq mu b gy ng nh l ni nj">when {<br/>    beforeAgent true<br/>    beforeInput true<br/>    beforeOptions true<br/>    // Write your conditions here...<br/>}</span></pre><p id="3bd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jenkins CI是实现CI/CD管道的一个强大而丰富的工具。有时候，你可能会觉得很复杂，其实不然。你应该拥有日复一日的实践来巩固你的知识。如果您有任何问题，请在下面评论或在教程的GitHub repo上打开一个问题。</p><p id="da50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae nk" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p></div></div>    
</body>
</html>