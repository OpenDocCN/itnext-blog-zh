<html>
<head>
<title>How to run automation scripts in multiple environments.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在多种环境下运行自动化脚本？</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-run-automation-scripts-in-multiple-environments-abc39d11aa20?source=collection_archive---------2-----------------------#2019-09-19">https://itnext.io/how-to-run-automation-scripts-in-multiple-environments-abc39d11aa20?source=collection_archive---------2-----------------------#2019-09-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/abffe23dcf61cafd1ef7868ed9e3e86c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FyYnSt53ycxywrImfYf6kA.png"/></div></div></figure><p id="1cd8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个应用程序都需要环境。主要的三个环境是测试、稳定性和生产。自动化工程师必须能够在这些环境中运行自动化脚本。当您运行测试时，您希望在不同的配置中完成这项工作。当您运行您只想指定的测试时，比如说:</p><p id="91ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> mvn清洁测试-Denv =测试或Gradle清洁测试-Denv =测试</strong></p><p id="26a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Gradle，您必须在build.gradle中创建任务:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2f77" class="lf lg iq lb b gy lh li l lj lk">tasks.withType(Test){<br/>    systemProperty <strong class="lb ir">'env'</strong>, System.<em class="ll">getProperty</em>(<strong class="lb ir">'env'</strong>, <strong class="lb ir">'env'</strong>)<br/>}</span></pre><p id="b9b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试从测试环境开始。</p><p id="2bc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要实现这一功能，可以通过3种方式进行改进:</p><ol class=""><li id="23ae" class="lm ln iq ka b kb kc kf kg kj lo kn lp kr lq kv lr ls lt lu bi translated"><strong class="ka ir">使用Java语言。</strong></li></ol><p id="2ea0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<a class="ae lv" href="http://twitter.com/Parameters" rel="noopener ugc nofollow" target="_blank">@参数</a>对测试方法进行标注。如果要传递的参数是简单的原始类型，如int、String，..等等。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="f492" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">public class </strong>BaseWeb {</span><span id="fe4d" class="lf lg iq lb b gy lw li l lj lk"><em class="ll">/**<br/>     * Before test.<br/>     *<br/>     * </em><strong class="lb ir"><em class="ll">@param env this value </em></strong>environment<em class="ll">.<br/>     */<br/>    </em>@Parameters({<strong class="lb ir">"env"</strong>})<br/>    @BeforeMethod(alwaysRun = <strong class="lb ir">true</strong>)<br/>    <strong class="lb ir">public void </strong>beforeTest(@Optional(<strong class="lb ir">"UAT"</strong>) <strong class="lb ir">final </strong>String env) {<br/>        <strong class="lb ir">switch </strong>(env) {<br/>            <strong class="lb ir">case "UAT"</strong>:<br/>                baseUrl = <strong class="lb ir">"Here need add url for UAT"</strong>;<br/>                <strong class="lb ir">break</strong>;<br/>            <strong class="lb ir">case "PROD"</strong>:<br/>                baseUrl = <strong class="lb ir">"Here need add url for PROD"</strong>;<br/>                <strong class="lb ir">break</strong>;<br/>            <strong class="lb ir">default</strong>:<br/>                <em class="ll">//Do nothing<br/>        </em>}<br/>    }<br/>}</span></pre><p id="a4be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可选的指定了默认使用的环境。</p><p id="b691" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要成功运行，您必须使用:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="e94c" class="lf lg iq lb b gy lh li l lj lk">mvn clean test -Denv=PROD</span></pre><p id="4884" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.<strong class="ka ir">表示TestNG库。</strong></p><p id="f308" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要创建一个文件，例如，他的名字是testng.xml</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="35e0" class="lf lg iq lb b gy lh li l lj lk">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE suite SYSTEM "<a class="ae lv" href="http://testng.org/testng-1.0.dtd" rel="noopener ugc nofollow" target="_blank">http://testng.org/testng-1.0.dtd</a>"&gt;<br/>&lt;suite name="All Test Suite"&gt;<br/>    &lt;test name="PROD"&gt;<br/>        &lt;parameter name="env" value="<strong class="lb ir">Here need add url for PROD</strong>"/&gt;<br/>        &lt;classes&gt;<br/>            &lt;class name="tests.beforeTest"/&gt;<br/>        &lt;/classes&gt;<br/>    &lt;/test&gt;<br/>    &lt;test name="UAT"&gt;<br/>        &lt;parameter name="env" value="<strong class="lb ir">Here need add url for UAT</strong>"/&gt;<br/>        &lt;classes&gt;<br/>            &lt;class name="tests.beforeTest"/&gt;<br/>        &lt;/classes&gt;<br/>    &lt;/test&gt;</span></pre><p id="73ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建一个BaseWeb类，其中我们使用了变量env和注释<a class="ae lv" href="http://twitter.com/Parameters" rel="noopener ugc nofollow" target="_blank"> @Parameters </a>:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="11d9" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">public class </strong>BaseWeb {</span><span id="21f2" class="lf lg iq lb b gy lw li l lj lk"><em class="ll">/**<br/>     * Before test.<br/>     *<br/>     * </em><strong class="lb ir"><em class="ll">@param env this is </em></strong>environment<em class="ll">.<br/>     */<br/>    </em>@Parameters({<strong class="lb ir">"env"</strong>})<br/>    @BeforeMethod(alwaysRun = <strong class="lb ir">true</strong>)<br/>    <strong class="lb ir">public void </strong>beforeTest(<strong class="lb ir">final </strong>String env) {<br/>        baseUrl = env;<br/>    }</span><span id="6234" class="lf lg iq lb b gy lw li l lj lk">}</span></pre><p id="a403" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要成功运行，您必须使用:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="5783" class="lf lg iq lb b gy lh li l lj lk">mvn clean test -Denv=PROD</span></pre><p id="1a7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.<strong class="ka ir">永旺比特</strong><a class="ae lv" href="http://owner.aeonbits.org/" rel="noopener ugc nofollow" target="_blank">http://owner.aeonbits.org/</a>所有者对图书馆的资助</p><p id="e7ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OWNER API是一个Java库，通过Java属性文件来最小化处理应用程序配置所需的代码。</p><p id="3f24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">OWNER以JAR文件的形式提供，也可以从Maven中央存储库下载。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0187" class="lf lg iq lb b gy lh li l lj lk">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.aeonbits.owner&lt;/groupId&gt;<br/>        &lt;artifactId&gt;owner&lt;/artifactId&gt;<br/>        &lt;version&gt;1.0.8&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><p id="697f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者格雷尔:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="8889" class="lf lg iq lb b gy lh li l lj lk">compile group: 'org.aeonbits.owner', name: 'owner', version: '1.0.8'</span></pre><p id="8999" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个库允许您以属性文件的形式存储在不同环境下运行测试的所有数据。</p><p id="4df7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该库的操作方法如图所示:</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/cc3b2060d4e699887f42792917c91954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TuSNr_oIOwjQf4AtwfsYQ.png"/></div></div></figure><p id="fe76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你有测试，他们与配置一起工作。从配置文件中读取配置数据，并通过系统属性重写。</p><p id="2a55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">描述WebConfig接口。我们用注释<a class="ae lv" href="http://twitter.com/Key" rel="noopener ugc nofollow" target="_blank"> @Key </a>标记了工作中需要的所有方法。在Key中，指定要从文件中读取的名称属性。仅此而已。否则图书馆会为你做的。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="7653" class="lf lg iq lb b gy lh li l lj lk">/**<br/> * The interface Web config.<br/> */<br/><a class="ae lv" href="http://twitter.com/Config" rel="noopener ugc nofollow" target="_blank">@Config</a>.Sources({"classpath:${env}.properties"})<br/>public interface WebConfig extends Config {</span><span id="9383" class="lf lg iq lb b gy lw li l lj lk">/**<br/>     * Value BASE_CONFIG.<br/>     */<br/>    WebConfig BASE_CONFIG = ConfigFactory.create(WebConfig.class, System.getenv(), System.getProperties());</span><span id="cd6a" class="lf lg iq lb b gy lw li l lj lk">/**<br/>     * Value web.url.<br/>     *<br/>     * <a class="ae lv" href="http://twitter.com/return" rel="noopener ugc nofollow" target="_blank">@return</a> url. url<br/>     */<br/>    <a class="ae lv" href="http://twitter.com/Key" rel="noopener ugc nofollow" target="_blank">@Key</a>("web.url")<br/>    String getWebUrl();</span><span id="7a2f" class="lf lg iq lb b gy lw li l lj lk">}</span></pre><p id="c33f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，在方法beforeTest类BasWeb中，我们使用一个常量调用我们的方法:<strong class="ka ir">BASE _ config . getweburl()</strong></p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="55a9" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">public class </strong>BaseWeb {</span><span id="c06a" class="lf lg iq lb b gy lw li l lj lk"><em class="ll">/**<br/>     * Before test.<br/>     *<br/>     * <br/>     */</em><br/>    @BeforeMethod(alwaysRun = <strong class="lb ir">true</strong>)<br/>    <strong class="lb ir">public void </strong>beforeTest() {<br/>        baseUrl = BASE_CONFIG.getWebUrl();<br/>    }</span><span id="6f58" class="lf lg iq lb b gy lw li l lj lk">}</span></pre><p id="1b9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们创建了一些属性文件，这些文件引用了我们的数据来处理环境。在我们的示例中，我们创建了两个属性文件uat.properties和prod.properties</p><p id="dd00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在数据文件中指定选项web.url</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="8e52" class="lf lg iq lb b gy lh li l lj lk">uat.properties file.<br/> web.url = <strong class="lb ir">Here need add url for UAT </strong><br/> <br/> prod.properties file.<br/> web.url = <strong class="lb ir">Here need add url for PROD</strong></span></pre><p id="eea2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要成功运行，您必须使用:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="60e6" class="lf lg iq lb b gy lh li l lj lk"><strong class="lb ir">mvn clean test -Denv=PROD</strong> for Maven</span><span id="a4d1" class="lf lg iq lb b gy lw li l lj lk">or</span><span id="d8d8" class="lf lg iq lb b gy lw li l lj lk"><strong class="lb ir">gradle clean test -Denv=PROD </strong>for Gradle</span></pre><p id="0ab4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Gradle，您必须在build.gradle中创建任务:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="89fe" class="lf lg iq lb b gy lh li l lj lk">tasks.withType(Test){<br/>    systemProperty <strong class="lb ir">'env'</strong>, System.<em class="ll">getProperty</em>(<strong class="lb ir">'env'</strong>, <strong class="lb ir">'env'</strong>)<br/>}</span></pre><h1 id="36f1" class="ly lg iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">UPD:</h1><p id="a113" class="pw-post-body-paragraph jy jz iq ka b kb mv kd ke kf mw kh ki kj mx kl km kn my kp kq kr mz kt ku kv ij bi translated">如果您在项目中使用CI Jenkins，您可能会有一个关于如何直接从Jenkins管理多个环境的问题。</p><p id="d18d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要解决此问题，您需要创建一个作业并选中复选框“此项目已参数化”。接下来<strong class="ka ir">添加参数</strong> - &gt;选择参数</p><p id="3a34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在name字段中，选择我们将来要传递给mvn的变量的名称。例如<strong class="ka ir"> env </strong></p><p id="b456" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在“选择”字段中，您必须输入环境变量。在我们的例子中，它是<strong class="ka ir"> UAT和PROD </strong></p><p id="9a27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在描述字段中，需要对该参数进行描述。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/34f057575f6e20101ae97856f37bbde1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvkt42KAIcEVvaLTKv7YJw.png"/></div></div></figure><p id="35aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来在字段目标和选项中，有必要注册:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="c258" class="lf lg iq lb b gy lh li l lj lk">clean test -Denv=${env}</span></pre><p id="ba67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以使用参数运行build。从下拉列表中，您可以选择UAT或生产。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/e937c03b41cfb4d3a65682a128f16f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BW5Zqu1x4HP3QtpZSifI6w.png"/></div></div></figure></div></div>    
</body>
</html>