<html>
<head>
<title>GitOps Is Powerful; But, Is Your Organization Ready?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GitOps功能强大；但是，您的组织准备好了吗？</h1>
<blockquote>原文：<a href="https://itnext.io/gitops-is-powerful-but-is-your-organization-ready-a18288238a21?source=collection_archive---------0-----------------------#2020-05-22">https://itnext.io/gitops-is-powerful-but-is-your-organization-ready-a18288238a21?source=collection_archive---------0-----------------------#2020-05-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7be1" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">软件交付</h2><div class=""/><div class=""><h2 id="87e3" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">GitOps为什么强大？采用GitOps之前的主要考虑事项。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6b7f2dd718a9aed4dd96bb2e11a9c4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0PH-FYpX5NHxAR7YBkcPQ.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">安迪·凯利在<a class="ae lh" href="https://unsplash.com/s/photos/automation?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="abe6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">‘GitOps’是一种在Kubernetes上交付和管理云原生应用的运营模式。它可以被认为是对基于Kubernetes系统的DevOps和SRE(现场可靠性工程)最佳实践的优化。</em></p><p id="eb7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">考虑到“GitOps”是一个在weaver works上创造的术语，并且它源于weaver works运行基于Kubernetes的系统的历史，GitOps通常在Kubernetes的上下文中被提及。但是，现在GitOps作为一个基本概念或最佳实践正在扩展到各种其他平台和工具，如Nomad、Terraform、Ansible、Chef、Pulumi等。也是。除了技术方面之外，成功地完成GitOps还非常依赖于<em class="me">人员</em>和<em class="me">流程</em>方面。</p><p id="f132" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本帖中，我们将探讨为什么我们需要gitop，gitop的优势，以及在组织内成功采用gitop需要解决的一些挑战。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="fb53" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">“Git”代表“Ops”？</h1><p id="9aee" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">GitOps的基本思想可以概括为以声明方式管理和执行的操作，使用<a class="ae lh" href="https://git-scm.com/" rel="noopener ugc nofollow" target="_blank"> Git </a>作为事实的来源系统。</p><p id="8e41" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps是基于<em class="me"> Git拉请求工作流、持续集成&amp;持续部署(CICD)、配置管理、基础设施即代码、容器不变性、监控</em>、<em class="me">和可观察性</em>的构建块构建的。</p><p id="3044" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们从下面的图表中来理解它，我借用了亚历克西斯·理查森的一篇旧的Weaveworks <a class="ae lh" href="https://www.weave.works/blog/the-gitops-pipeline" rel="noopener ugc nofollow" target="_blank">博客文章</a>。现在，您将看到GitOps管道的许多变体，它们具有各种工具和实现，但我只想坚持基本原则，保持简单。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nj"><img src="../Images/e3950759514e5a2b245fd6b4622c474f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m3xe-v7QO9DFRARo"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片提供:<a class="ae lh" href="https://www.weave.works/blog/the-gitops-pipeline" rel="noopener ugc nofollow" target="_blank">https://www.weave.works/blog/the-gitops-pipeline</a></figcaption></figure><p id="de83" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">简单来说，GitOps管道就是这样工作的— </strong></p><blockquote class="nk nl nm"><p id="b040" class="li lj me lk b ll lm kd ln lo lp kg lq nn ls lt lu no lw lx ly np ma mb mc md im bi translated">工程师向Git存储库提交代码(审查并合并一个拉请求)。</p><p id="bd79" class="li lj me lk b ll lm kd ln lo lp kg lq nn ls lt lu no lw lx ly np ma mb mc md im bi translated">CI管道基于检测到的Git变化被触发，在成功完成所有需要的CI步骤后，一个新的<a class="ae lh" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">版本的</a>容器映像被上传到映像存储库。</p><p id="f893" class="li lj me lk b ll lm kd ln lo lp kg lq nn ls lt lu no lw lx ly np ma mb mc md im bi translated">一个部署自动机/ <a class="ae lh" href="https://github.com/operator-framework" rel="noopener ugc nofollow" target="_blank">操作符</a>(在上图的例子中是Flux)在映像repo中获取更改，并更新Git repo中的配置。</p><p id="a697" class="li lj me lk b ll lm kd ln lo lp kg lq nn ls lt lu no lw lx ly np ma mb mc md im bi translated">更新完成后，运营商将启动Kubernetes的部署流程。</p></blockquote><p id="a83a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps可以看作是一个基于事件的系统。每个阶段都是基于前一个阶段中的更改事件触发的。部署和系统状态同步通过部署自动机以拉模式进行。管道中引入的任何基于推送的机制，无论是手动CI触发器，还是部署触发器，或者任何“kubectl”命令，都可以使GitOps的整个概念变得多余。</p><p id="95d2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps可以与任何基于Git的系统一起工作，如<a class="ae lh" href="http://github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae lh" href="https://bitbucket.org/product" rel="noopener ugc nofollow" target="_blank"> Bitbucket </a>或<a class="ae lh" href="https://about.gitlab.com/" rel="noopener ugc nofollow" target="_blank"> GitLab </a>。对目标系统的任何更改都通过更改Git中的声明性配置来控制和执行。GitOps不推荐使用任何特定的工具，比如CI服务器、映像存储库，甚至是部署自动机/操作员。</p><p id="03b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我希望下面我从<a class="ae lh" href="https://fluxcd.io/" rel="noopener ugc nofollow" target="_blank">https://fluxcd.io/</a>那里借用的流量定义将有助于更好地理解部署操作员在GitOps中的角色和重要性—</p><p id="4dc5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me"> "Flux是一个工具，它可以自动确保您的</em><a class="ae lh" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><em class="me">Kubernetes</em></a><em class="me">集群的状态与您在Git中提供的配置相匹配。它在集群中使用一个</em> <a class="ae lh" href="https://github.com/operator-framework/awesome-operators" rel="noopener ugc nofollow" target="_blank"> <em class="me">操作符</em> </a> <em class="me">来触发Kubernetes内部的部署，这意味着您不需要单独的持续交付工具。”</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="6173" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">我们真的需要GitOps吗？</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/98b6c8252010c448d29082e3b97c68f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mE0zZ-CQ7PG5wJaoIjvN-A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">奥斯汀·迪斯特尔</a>在<a class="ae lh" href="https://unsplash.com/s/photos/meeting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0692" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还没有足够的工具、流程和最佳实践来管理容器编排系统吗？是，也不是。</p><p id="f4d1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">多年来，一些组织成功地设计了他们的CICD管道，使其尽可能高效地满足组织的要求。其他的仍在这个过程中发展。随着这一领域不断推出新的、更好的自动化产品，不断需要尽快适应和发展，以企业保持市场相关性所需的快速步伐进行构建和创新。开发运维实践和随之而来的技术流程创新让许多组织实现了他们的目标。</p><h2 id="8661" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">新技术带来新挑战</h2><p id="d475" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated"><em class="me">创新是一个迭代的过程。</em>组织开始采用高度可扩展的云平台、云原生开发、容器、微服务和无服务器技术来构建更好的系统。为了管理容器工作负载，容器编排系统如<a class="ae lh" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"><em class="me">【Kubernetes】</em></a><em class="me"/><a class="ae lh" href="https://dcos.io/" rel="noopener ugc nofollow" target="_blank"><em class="me">中间层DC/OS</em></a><em class="me"/><a class="ae lh" href="https://www.nomadproject.io/" rel="noopener ugc nofollow" target="_blank"><em class="me">Nomad</em></a><em class="me"/>等。被收养了。这种范式的转变给工程师们带来了一种新的挑战。系统变得更加分布式、松散耦合、异步和动态。</p><p id="7cf1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me">基于分布式容器的微服务系统很难管理。早期的软件开发、交付和管理实践被认为无法处理分布式和云原生系统关于如何开发、交付和管理软件的需求。软件开发、代码评审、代码合并、代码升级、测试、发布管理和操作都必须采用更好的方法。</em></strong></p><p id="523f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">基于DevOps的实践成为快速、大规模管理和操作系统的关键。在交付管道中，<em class="me">基于Git的版本控制系统</em>和工作流帮助开发人员扩展开发流程，并使其更加高效。<em class="me">通过安全扫描持续集成和测试管道</em>使得软件交付更加可靠和安全。<em class="me">基础设施即代码</em>和<em class="me">配置管理工具</em>使基础设施和平台更加稳定、可靠、可扩展，并且更易于供应。<em class="me">容器</em>提供了“不可变的服务器”,配置管理工具试图通过最小化配置漂移来交付这些服务器。<em class="me">持续部署工具</em>有助于高效的软件交付和发布管理过程。虽然CICD工具链和管道必须实施一些软件交付标准，但是它们必须足够灵活以处理各种技术和语言。标准化的管道对于确保交付安全和高质量的软件至关重要，要有适当的访问和审计控制。</p><p id="4e52" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me">基于分布式容器的微服务系统比较复杂，识别故障点、监控指标、告警阈值都比较复杂。这引入了对构成任何给定系统的分布式组件和服务的内部更好的可见性的需求。<em class="me">服务/功能级别的可观察性</em>对于理解整个系统的行为和健康变得更加重要。虽然仍然需要<em class="me">黑盒监控</em>来了解整体系统健康状况，但是<em class="me">白盒监控</em>和<em class="me">可观察性(</em> <a class="ae lh" href="https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/ch04.html" rel="noopener ugc nofollow" target="_blank"> <em class="me">日志记录、指标收集和跟踪</em> </a> <em class="me"> ) </em>对于云原生系统来说更加重要，以便更好地了解各个服务是如何工作的。出现了许多新的工具，它们能够处理高度分布式系统的高日志量、可伸缩性、粒度和可跟踪性需求。</em></strong></p><p id="e934" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于新的云原生应用程序，我们需要监控、收集和查看洞察的方式必须有所不同。虽然某些监控指标，如<em class="me">延迟、错误、请求率和饱和度</em> <a class="ae lh" href="https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/" rel="noopener ugc nofollow" target="_blank"> <em class="me">(监控的4个黄金信号)</em> </a>对于任何面向用户的系统来说都是至关重要的，但从日志、系统指标和跟踪中获取其他详细的信息也同样重要。有了这些认识，就有可能<em class="me">理解和观察系统在运行时的行为，任何依赖关系的变化的影响，识别可能的性能瓶颈，依赖关系图</em>等等。<em class="me">借助合适的工具，它可以帮助确定特定的使用和依赖模式，预测可能的影响，并进行容量和资源规划。</em></p><p id="41fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">监控和警报的另一个重要方面是知道监控什么以及何时通知。</em>随着时间的推移，微调指标、阈值和警报可能是一项艰巨的任务。理解系统的正常和异常行为和模式需要付出大量的努力。一些最新工具的AI/ML功能可以在这方面有所帮助。但是，如果做得不好，可能会导致<em class="me">警报疲劳</em>并最终导致关键警报被忽略并淹没在噪音中。</p><p id="2c60" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me">应用和平台安全需求也必须发展</em> </strong>以应对由系统、容器、API、大量上游/下游依赖项的高度分布式特性引入的<em class="me">新攻击媒介</em>。早期的访问控制、南北网络安全的安全模型不足以保护高度分布和动态的系统。专家开发了零信任安全模型来解决这些问题。</p><h2 id="1c7b" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">重新思考运营策略</h2><p id="2e1f" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">因此，我们可能需要重新审视我们管理容器、微服务和Kubernetes或Nomad等平台的实践。</p><p id="4389" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Kubernetes允许团队彼此独立地执行开发和操作活动。开发人员不必担心他们的发布周期会受到服务器修补、备份/恢复、容量供应/取消供应等操作活动的影响。系统工程师能够在不停机和不中断应用程序可用性的情况下执行操作活动。Kubernetes的声明式配置方法使工程师能够以声明方式推出应用程序版本、管理策略、定义资源配置和集群状态。这反过来也允许对它们进行版本控制。</p><p id="ea4a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps建立在这些版本控制的基本概念之上，现在它不仅适用于应用程序代码本身，还扩展到维护整个集群状态。</p><p id="c3f5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="me">那么，到底有什么不同呢？</em> </strong>嗯，根本的区别是，GitOps应该是<em class="me">事件驱动，拉式，</em>而集群状态是<em class="me">可观测的。</em></p><p id="a999" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">是的，GitOps当然不是解决管理基于Kubernetes的系统的所有复杂性的灵丹妙药。但是，它肯定可以简化很多。不管GitOps的方法有多好，除非事先把一些事情理顺，否则你不会从中获益。相反，你可能会遇到其他风险，我将在下面的<em class="me">“在做GitOps之前整理一些事情”</em>小节中介绍这些风险。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="cc52" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">GitOps的优势</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/ae7576be127638a66a0482ebd6740fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LrtMdrF1WWdAJihaTJkT0g.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">布雷特·乔丹在<a class="ae lh" href="https://unsplash.com/s/photos/win?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h2 id="f4fa" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">基于现有的最佳实践</h2><p id="1259" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">由于GitOps是建立在围绕Git工作流、基础设施即代码、CICD管道、不可变服务器、监控和可观察性的现有最佳实践基础上的模式，它只是在Kubernetes上管理云原生应用程序的更成熟状态的一种演变。因此，可以在很大程度上利用组织内现有的工具链和知识。采用GitOps可能需要在某些流程领域进行一些调整。</p><h2 id="1644" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">简化了自动化的“连续部署”问题</h2><p id="39cb" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated"><em class="me">持续集成容易；持续部署很难。</em> GitOps能够通过自动化以结构化、明确定义的方式解决持续部署问题。这是由“部署运营商”实现的，如FluxCD、ArgoCD等。由于各种原因，如应用程序的状态、停机容限、上游/下游依赖性以及许多其他组织特定的流程和依赖性，正确的连续部署一直是一项具有挑战性的任务。GitOps最佳实践以及云原生应用开发实践(如<a class="ae lh" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank"> 12因素应用</a>方法)解决了许多此类问题，反过来也简化了部署流程。</p><h2 id="6980" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">简化Kubernetes集群管理</h2><p id="ec59" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">由于Kubernetes集群配置是通过Git中受版本控制的代码以声明方式定义的，因此它提供了针对期望状态的最大可见性和可审计性。Git提交历史允许识别任何问题，甚至将集群状态回滚/恢复到特定的提交散列。GitOps增强了针对特定目标环境的自动化应用程序部署、蓝/绿和canary版本等部署方法、管理多个集群以及自动化配置偏差检测和补救方面的功能。</p><h2 id="0bd7" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">减少的<a class="ae lh" href="https://en.wikipedia.org/wiki/Mean_time_to_repair" rel="noopener ugc nofollow" target="_blank"> MTTR </a>(平均修复时间)</h2><p id="20c7" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">一小段糟糕的代码或一个错误的配置可能会对您的生产系统造成严重破坏。此外，对于基于分布式微服务的系统，调试、故障排除和修复问题可能会非常具有挑战性。所有这些加起来需要很长时间来修复和恢复系统。由于在GitOps中，每个更改都是受版本控制的，并且整个系统管理是自动化的，因此MTTR可以大大减少。下MTTR区对于良好的客户体验至关重要。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="3048" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated"><strong class="ak">做GitOps之前先理清几件事</strong></h1><h2 id="a92c" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">1.代码评审和<a class="ae lh" href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests" rel="noopener ugc nofollow" target="_blank">拉请求</a>文化</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/454d5329fb2fa349428d934aeac17645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QxxvDlb0LUjiN5dnIIzjCw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">约翰·施诺布里奇在<a class="ae lh" href="https://unsplash.com/s/photos/meeting?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b91f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">代码审查在整个软件交付过程中扮演着重要的角色，尤其是在CICD自动化支持的频繁发布中。如果没有一个适当的代码审查过程，坏代码发布的机会就会成倍增加。构建和测试失败是非常明显的，在管道的早期很容易被发现。但是同样重要的是观察代码变更对应用程序的非功能性需求的其他影响。比如，我们能否避免新的嵌套“for”循环，因为它会对性能产生重大影响？我们真的需要一个全局变量吗？对于手头的问题，使用了正确的数据结构吗？一个函数/方法应该变得更细粒度吗？定义的接口契约足够好吗？代码是否具有足够的可扩展性？诸如此类。有时，通过仔细检查代码更改可以找到这样的答案。有时，这很难做到，我们需要依靠可观察性度量来进一步改进。</p><p id="1fc8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Git pull-requests提供了一种提交经过验证的高质量代码的好方法，这些代码可以合并到分支中。重要的是要建立一种“拉请求”的文化，在这种文化中，不允许任何开发人员将任何代码更改直接提交给任何Git分支。当“拉”请求被验证、检查和合并时，它可以触发CI管道。一个成功的CI构建和测试步骤可以导致新的工件版本被上传到工件存储库中。</p><p id="e68a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，作为拉取请求本身的一部分，拥有一个良好的构建和测试流程是非常重要的。这是确保良好代码质量和最终系统稳定性的第一步。</p><h2 id="5a86" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">2.持续测试非常重要</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/9a24bbe8fe251b7850c9239706372366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aIHWUgAoEdWIUuHwznvVHw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@nicolasthomas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">尼古拉斯·托马斯</a>在<a class="ae lh" href="https://unsplash.com/s/photos/test?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="3971" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我再怎么强调好的测试用例对于CICD自动化的成功和构建一个可靠的系统是多么的重要也不为过。对于GitOps，我们谈论的是基于拉的端到端自动化，如此高度的自动化要求对通过管道发布的软件进行健壮的测试。当然，使用GitOps也可以实现更好的回滚功能。但是，只有编写好的代码和好的测试用例才能确保代码本身更好的可靠性。</p><p id="71fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">许多人仍然依赖手工测试来测试产品的各个关键部分。这不仅是一个不可靠的过程，而且不可扩展。它会导致片状产品。<em class="me">因此，测试覆盖是一个关键的部分，在做GitOps之前需要正确地解决。相信我，你会睡得更好，而且不会在半夜修理问题。</em></p><p id="35f0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">很难想象并捕捉到应用程序的每一个失败场景，因为有太多超出应用程序范围的东西会导致失败。随着云原生开发、微服务和动态云基础设施的增长，<a class="ae lh" href="https://medium.com/@bbideep/why-should-chaos-be-part-of-your-distributed-systems-engineering-5bcb21497660" rel="noopener">混沌工程</a>正在获得一些重要的动力。并非所有架构都需要如此有弹性，以适应极端的规模和可靠性要求。根据您的可用性和正常运行时间要求，您不需要过度优化。但是，有资格在Kubernetes等平台上运行的复杂分布式微服务也需要大量的弹性测试。正如我们已经讨论过的，另一个基本的好处是开发和业务活动的分离。为了无缝地执行操作活动，应用程序和平台在本质上需要足够的弹性，以便Kubernetes对象可以在集群中自由移动和重新配置。</p><p id="9c1d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">所以，准备好弹性测试吧。</em></p><h2 id="7168" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">3.安全执行需要向左转</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/f12c3fd9b65bfc21004112fdabfcd8ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iARko9JWBkUHhpU71-YnAw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@thejmoore?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">乔恩·摩尔</a>在<a class="ae lh" href="https://unsplash.com/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="7027" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在分布式系统中，安全性不再是事后才考虑的问题。作为CICD管道的一部分，它必须与开发和测试活动相结合。云原生应用的高度分布式特性为不良行为者创造了许多新的攻击媒介。传统的访问控制、外围防火墙、基于IP/主机的权限模型不再能够守住堡垒。零信任模型通过各种方法来解决这些问题，例如基于服务的身份验证、最小访问权限、基于资源的访问控制、服务级web应用防火墙和策略等等。</p><p id="7d04" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要在体系结构和服务的每一层整合安全控制，it必须向左转。开发人员、系统工程师和安全工程师要理解这种变化的重要性，软件和系统需要设计成满足新的安全相关要求。最近，我们已经听说了很多数据泄露事件、勒索软件和其他安全漏洞。不幸的是，其中很多也与构建在云上的系统有关。尽管云提供商受到了负面报道，但基本问题可以缩小到错误配置的安全策略，要么是由于无知，要么是他们的自动化和安全控制不够好。有时，存在忽视安全最佳实践和妥协以满足交付目标和时间表的趋势。但是，无论如何都要避免。更确切地说，在考虑安全性的情况下规划交付内容是非常重要的。</p><h2 id="2180" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">4.卓越运营—监控和可观察性</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/53118f2d761c7868bf662971d8d90e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H085ozHSNysN32B7_lAdew.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">艾伦·j·亨德利在<a class="ae lh" href="https://unsplash.com/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6eaf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在“我们真的需要GitOps吗？”上一节中，我们讨论了分布式微服务架构如何变得非常复杂，以及为什么适当的监控和可观察性如此重要。</p><p id="1775" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然监控对于了解系统的当前健康状况很重要，但可观察性对于更好地了解系统内部并帮助识别模式和改进区域也很重要。</p><p id="2377" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于基础设施即代码和版本控制是GitOps的基础，它支持可重复的操作过程、可跟踪的系统状态更改、推出和回滚。实时系统的可观察性有助于检测任何意外的配置偏差和系统变化并发出警报。从根本上说，由于集群/系统状态应该与Git中控制的状态定义版本同步，因此需要仔细研究任何偏差，并采取适当的措施。基本上，传统的运营实践需要在SRE原则的基础上发展到下一个层次。这可能是一个组织内部的重大文化转变。</p><p id="717e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">因此，建议仔细评估现有的监控和可观察性工具和能力以及相关流程是否足以处理此类系统和剧烈变化。</em></p><h2 id="284f" class="nr mn it bd mo ns nt dn ms nu nv dp mw lr nw nx my lv ny nz na lz oa ob nc iz bi translated">5.利用DevOps的力量——文化转变</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/5b391d30283d6dbf4fbc454b9204b206.png" data-original-src="https://miro.medium.com/v2/format:webp/1*DanW-tmDINRzL6Q0QBo2NA.jpeg"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated"><a class="ae lh" href="https://unsplash.com/@cytonn_photography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Cytonn摄影</a>在<a class="ae lh" href="https://unsplash.com/s/photos/agreement?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="2826" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">不用说，GitOps是基于DevOps的原理。虽然，每个组织都在采用DevOps原则和最佳实践来满足更快的上市时间表，但是，由于各种原因，许多组织仍然无法利用DevOps的强大功能。我不想掉进这个帖子里的那个兔子洞。但是，主要原因可能与<em class="me">人</em>和<em class="me">过程</em>方面有关。</p><p id="d4d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">传统的发布周期长的流程壁垒只能阻碍开发速度和创新速度。是的，需要满足安全性和法规遵从性要求。但是，需要通过围绕安全控制、可见性和可审核性的更好自动化来解决这些问题，而不是传统的手动流程。</p><p id="4fee" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">DevOps不是让每个团队成员都做“开发”和“运营”的事情。它不是关于CICD管道、发布管理、技术实现或操作程序本身。DevOps是关于最佳实践的，它可以使团队认识到所执行的开发和操作活动的重要性，一起工作来构建一个整体可靠的系统，更快和无缝地交付软件，并有效地管理系统。</p><p id="7284" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">如果没有必要的文化转变，现有的限制只会阻碍流程，并且不可能实现GitOps的全部潜力以及随之而来的福利。</em></p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="5762" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">总结想法</h1><p id="ccc1" class="pw-post-body-paragraph li lj it lk b ll ne kd ln lo nf kg lq lr ng lt lu lv nh lx ly lz ni mb mc md im bi translated">分别来自Weaveworks和<a class="ae lh" href="https://www.intuit.com/" rel="noopener ugc nofollow" target="_blank"> Intuit </a>的Flux CD和Argo CD团队正在积极工作，通过引入两个项目的最佳功能来构建最佳GitOps解决方案(<a class="ae lh" href="https://fluxcd.io/" rel="noopener ugc nofollow" target="_blank"> Flux CD </a>和<a class="ae lh" href="https://argoproj.github.io/projects/argo-cd/" rel="noopener ugc nofollow" target="_blank"> Argo CD </a>)。这个联合项目叫做<a class="ae lh" href="https://github.com/argoproj/gitops-engine" rel="noopener ugc nofollow" target="_blank"> GitOps引擎</a>。虽然GitOps最初是由Weaveworks品牌的，但大多数流行的CI工具、配置管理工具和容器编排平台提供商已经加入到我们今天所知的“GitOps”中。</p><p id="2aa4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">许多组织仍然坚持将基于推送的部署作为一个过程、一个护栏、一个更好的控制机制，或者用于审计目的。当然，考虑到特定组织的环境，这些可能是非常有效的理由。基于推送的部署过程在大多数组织中仍然很普遍，可以推测，到目前为止，这种过程对他们来说工作得很好。</p><p id="0962" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于一些组织来说，采用GitOps并实现其优势可能需要一些时间。毕竟，这样的计划涉及到重大的文化和流程变化。所以，从小规模开始，然后扩大规模！</p><p id="ea77" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps可能是一个有趣的空间，可以观察事物如何随着时间的推移而演变。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h1 id="aeaf" class="mm mn it bd mo mp mq mr ms mt mu mv mw ki mx kj my kl mz km na ko nb kp nc nd bi translated">参考</h1><div class="og oh gp gr oi oj"><a href="https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">谷歌网站可靠性工程</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">谷歌的SRE团队有一些基本原则和最佳实践来建立成功的监控和警报…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">landing.google.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/@copyconstruct/monitoring-and-observability-8417d1952e1c" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">监控和可观察性</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">在7月下旬与几个朋友共进午餐时，可观察性的话题被提了出来。我有一个关于速度的演讲…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="oy l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://medium.com/@copyconstruct/monitoring-in-the-time-of-cloud-native-c87c7a5bfa3e" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">云原生时代的监控</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">注意——非常感谢杰米·威尔金森和朱利叶斯·沃尔茨,《谷歌的现在和过去》,他们阅读了这篇文章的草稿…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="oz l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://www.weave.works/blog/the-gitops-pipeline" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">GitOps管道-第2部分</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">GitOps依赖于你的整个系统来声明性地表达。GitOps管道模型将Git置于设计阶段…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">www.weave.works</p></div></div><div class="os l"><div class="pa l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://www.weave.works/blog/gitops-part-3-observability" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">GitOps第3部分-可观察性</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">可观察性可以被视为Kubernetes持续交付周期的一部分。观察到的状态必须与…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">www.weave.works</p></div></div><div class="os l"><div class="pb l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">分布式系统可观测性</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">网络基础设施正处于范式转变之中。随着系统变得更加分布式，构建的方法…</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">www.oreilly.com</p></div></div><div class="os l"><div class="pc l ou ov ow os ox lb oj"/></div></div></a></div><div class="og oh gp gr oi oj"><a href="https://github.com/argoproj/gitops-engine" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd jd gy z fp oo fr fs op fu fw jc bi translated">argoproj/gitops-引擎</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">两个最大的GitOps项目正在联手。Argo CD和Flux CD已经问世多年，使得……</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">github.com</p></div></div><div class="os l"><div class="pd l ou ov ow os ox lb oj"/></div></div></a></div></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><p id="b617" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="me">跟我上</em> <a class="ae lh" href="https://www.linkedin.com/in/bideep/" rel="noopener ugc nofollow" target="_blank"> <em class="me"> LinkedIn </em> </a> <em class="me">，</em><a class="ae lh" href="https://twitter.com/bbideep" rel="noopener ugc nofollow" target="_blank"><em class="me">Twitter</em></a><em class="me">。</em></p><p id="ed99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://bbideep.medium.com/subscribe" rel="noopener"> <em class="me">在媒体上订阅</em> </a> <em class="me">更多此类帖子。</em></p></div></div>    
</body>
</html>