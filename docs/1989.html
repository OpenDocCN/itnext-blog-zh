<html>
<head>
<title>How to deploy web apps to AWS using S3 &amp; CloudFront</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用S3和CloudFront将web应用部署到AWS</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-a-web-app-on-aws-using-s3-cloudfront-45f77cd652c6?source=collection_archive---------1-----------------------#2019-03-08">https://itnext.io/deploying-a-web-app-on-aws-using-s3-cloudfront-45f77cd652c6?source=collection_archive---------1-----------------------#2019-03-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ffb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你发现自己迷失在AWS文档中，你并不孤单。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/526fba1a4fc25ee8c1cdaa604b6e8d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vb_oGv53xB5SoOg2WxAVHg.png"/></div></div></figure><p id="ac1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，您可以了解如何使用AWS S3、CloudFront和Route 53在AWS上部署您的网站和前端应用程序。我们将使用S3来存储我们的源代码和资产，使用CloudFront作为CDN来分发我们的网站并提供HTTPS支持，使用Route53来创建指向CloudFront分发的自定义DNS记录。让我们直接跳过它。</p><h2 id="0303" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">设置我们的S3桶</h2><blockquote class="lq lr ls"><p id="fca9" class="jn jo lt jp b jq jr js jt ju jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj kk ij bi translated">亚马逊简单存储服务(亚马逊S3)是一种对象存储服务，提供行业领先的可扩展性、数据可用性、安全性和性能。这意味着各种规模和行业的客户都可以使用它来存储和保护各种使用情形下的任意数量的数据，例如网站、移动应用程序、备份和恢复、归档、企业应用程序、物联网设备和大数据分析。</p></blockquote><p id="6def" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要创建我们的s3存储桶，我们将在那里存储代码和资产。要为静态网站托管配置我们的bucket，请遵循以下步骤:</p><ol class=""><li id="f0cd" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated">创建一个新的bucket，将url作为Bucket名称(例如test.potato.com)。</li><li id="9484" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">从第三步的下拉菜单中选择“授予公共读取权限”。如果选项不存在，创建存储桶后，转到“权限选项卡”-&gt;“访问控制列表”，然后在“公共访问”下，单击“每个人”并选中“列出对象”。</li><li id="92ef" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">转到新创建的存储桶“属性”选项卡，并通过选择“使用此存储桶托管网站”来启用“静态网站托管”。</li><li id="67cc" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">将“index.html”设置为错误和索引页面，因为前端路由器将处理服务器404错误。</li><li id="9dd9" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">转到“权限”下的“存储桶策略”，将S3:GetObject权限附加到S3存储桶。用您新创建的存储桶的名称替换<your_bucket_name>。</your_bucket_name></li></ol><pre class="km kn ko kp gt ml mm mn mo aw mp bi"><span id="0919" class="kx ky iq mm b gy mq mr l ms mt">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Sid": "AddPerm",<br/>            "Effect": "Allow",<br/>            "Principal": "*",<br/>            "Action": "s3:GetObject",<br/>            "Resource": "arn:aws:s3:::&lt;YOUR_BUCKET_NAME&gt;/*"<br/>        }<br/>    ]<br/>}</span></pre><p id="7552" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.启用CORS..在“CORS配置”选项卡中，添加以下内容</p><pre class="km kn ko kp gt ml mm mn mo aw mp bi"><span id="dd2a" class="kx ky iq mm b gy mq mr l ms mt">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;CORSConfiguration &gt;<br/>&lt;CORSRule&gt;<br/>    &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;<br/>    &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;<br/>    &lt;MaxAgeSeconds&gt;3000&lt;/MaxAgeSeconds&gt;<br/>    &lt;AllowedHeader&gt;Authorization&lt;/AllowedHeader&gt;<br/>&lt;/CORSRule&gt;<br/>&lt;/CORSConfiguration&gt;</span></pre><p id="d65f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.(可选)为package.json添加一个部署脚本，这样只需从项目中运行<code class="fe mu mv mw mm b">yarn deploy</code>就可以进行部署。这需要安装<code class="fe mu mv mw mm b">aws-cli</code>,你可以从这里的<a class="ae mx" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank">安装</a>,如果你没有的话，运行<code class="fe mu mv mw mm b">aws configure</code>进行设置</p><pre class="km kn ko kp gt ml mm mn mo aw mp bi"><span id="67a4" class="kx ky iq mm b gy mq mr l ms mt">// package.json<br/>"scripts": {<br/>  "deploy:live": "npm run build &amp;&amp; aws s3 sync dist/    s3://&lt;YOUR_S3_BUCKET_NAME&gt; --delete &amp;&amp; npm run-script invalidate-cache:live",</span><span id="2f43" class="kx ky iq mm b gy my mr l ms mt">  "invalidate-cache:live": "aws configure set preview.cloudfront true &amp;&amp; aws cloudfront create-invalidation --distribution-id &lt;CLOUDFRONT_DISTRIBUTION_ID&gt; --paths '/*'"}</span></pre><p id="1133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，这个脚本会运行你的构建脚本，然后将构建步骤生成的<code class="fe mu mv mw mm b">dist/</code>文件夹的内容复制到S3桶，并删除远程存在但由于<code class="fe mu mv mw mm b">--delete</code>标志而不在本地文件夹中的文件。之后，您可能需要使您的CloudFront发行版的缓存无效，这是第二个脚本要做的。我们将在下一步完成CloudFront设置，您将能够获得发行版id。</p><p id="be0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你去“静态网站托管”，你的网站现在应该在提供的链接下。</p><h2 id="9614" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">设置CloudFront</h2><blockquote class="lq lr ls"><p id="0572" class="jn jo lt jp b jq jr js jt ju jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj kk ij bi translated">Amazon CloudFront是一种快速内容交付网络(CDN)服务，它在一个对开发人员友好的环境中，以低延迟、高传输速度向全球客户安全地交付数据、视频、应用程序和API。CloudFront与AWS集成，这两个物理位置都直接连接到AWS全球基础设施，以及其他AWS服务。CloudFront与包括AWS Shield for DDoS缓解、Amazon S3、Elastic Load Balancing或Amazon EC2在内的服务无缝协作，作为应用程序的来源，并与Lambda@Edge一起运行更接近客户用户的定制代码，并定制用户体验。</p></blockquote><p id="68cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要设置CloudFront发行版，请从AWS控制台转到“CloudFront ”,并遵循以下步骤:</p><ol class=""><li id="2262" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated">点击“创建分发”并选择“Web分发”。</li><li id="5065" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">将源域名设置为新创建的s3存储桶。</li><li id="d33a" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">选择“将HTTP重定向到HTTPS”，以启用https。</li><li id="0366" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">要启用gzip压缩以加快加载速度，请选中“自动压缩对象”。</li><li id="1735" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">将默认根对象设置为index.html，以便它将/重定向到/index.html</li><li id="355d" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">在“备用域名(cnames)”下，输入您想要访问您的网站的URL。(在这种情况下，s3存储桶名称或您的ssl证书支持的子域，即:test.potato.com)</li><li id="0435" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">(可选)如果您有自定义SSL证书，请选择一个，或者您可以从AWS证书管理器(ACM)请求一个。</li><li id="0b4b" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">单击Create Distribution，等待分发创建完成。</li></ol><p id="c90f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的网站现在应该可以通过CloudFront发行版的URL访问了。接下来，我们将看看如何通过自定义域名使其可用，就像我们在上一步中在cnames中提供的那样。</p><h2 id="73ed" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">配置路由53</h2><blockquote class="lq lr ls"><p id="9394" class="jn jo lt jp b jq jr js jt ju jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj kk ij bi translated">Amazon Route 53是一个高度可用和可扩展的云<a class="ae mx" href="https://aws.amazon.com/route53/what-is-dns/" rel="noopener ugc nofollow" target="_blank">域名系统(DNS) </a> web服务。它旨在为开发者和企业提供一种极其可靠且经济高效的方式，通过将www.example.com<a class="ae mx" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">等名字翻译成计算机用来相互连接的192.0.2.1等数字IP地址，将最终用户路由到互联网应用程序。Amazon Route 53也完全符合IPv6。</a></p></blockquote><p id="5eb4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们需要对DNS配置进行更改，添加一个别名域名，指向我们新创建的CloudFront发行版。这假设您已经创建了一个HostedZone，并通过AWS购买了一个域。</p><ol class=""><li id="a7d2" class="lx ly iq jp b jq jr ju jv jy lz kc ma kg mb kk mc md me mf bi translated">从AWS控制台转到53号公路。</li><li id="3762" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">点击您的托管区域。</li><li id="a006" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">创建一个新的记录集，其名称与您在CloudFront发行版的cname/备用域名中提供的名称相匹配。</li><li id="7014" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">单击“Alias ”,在“Alias Target”下，从autocomplete下拉列表中选择您新部署的CloudFront发行版，然后单击create。</li><li id="1cce" class="lx ly iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">(可选)对“AAAA (IPv6)”类型的记录集重复这些步骤，而不是“IPv4”类型的记录集，以支持IPv6。</li></ol><p id="c586" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这样，您现在拥有了一个完全部署好的功能性网站，您可以通过自定义域访问它。您的网站通过自定义SSL证书支持HTTPs和HTTP/2，您可以通过从应用程序运行<code class="fe mu mv mw mm b">yarn deploy</code>来轻松部署您的网站。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="dc90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢我的内容，愿意支持我，你可以<a class="ae mx" href="https://www.buymeacoffee.com/khaledosman" rel="noopener ugc nofollow" target="_blank">请我喝啤酒</a></p></div></div>    
</body>
</html>