<html>
<head>
<title>How to use Jest in Angular aka make unit testing great (again)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular aka中使用Jest使单元测试变得伟大(再次)</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-jest-in-angular-aka-make-unit-testing-great-again-e4be2d2e92d1?source=collection_archive---------0-----------------------#2019-04-01">https://itnext.io/how-to-use-jest-in-angular-aka-make-unit-testing-great-again-e4be2d2e92d1?source=collection_archive---------0-----------------------#2019-04-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/268db7a34a401093ac8ba0b1f1564adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PaIJLmMyQUNlMChGNLtxNA.png"/></div></div></figure><div class=""/><div class=""><h2 id="dde2" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">用Jest，这位来自脸书的出色的测试者，再次让单元测试变得有趣</h2></div><p id="9517" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">Angular是创建web应用程序的强大框架。Angular团队非常重视提供良好的测试体验。事实上，我不仅喜欢为简单的功能编写单元测试，也喜欢为整个组件编写单元测试。在较少依赖的较小项目中，我可以很容易地遵循TDD风格的方法。</p><p id="2381" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">然而，当项目相当大时，测试体验对我(和其他人，只是谷歌一下)来说要糟糕得多:</p><ul class=""><li id="cdeb" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">(初始)构建时间很慢</li><li id="7f45" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">重新编译通常不可靠</li><li id="7bd7" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">生产率低于应有的水平。特别是对于导入大量其他组件和模块的组件，运行这些测试变得很麻烦。</li></ul><p id="9f14" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">脸书创建了一个伟大的测试框架，叫做<a class="ae md" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf"> Jest </strong> </a>。Jest使用了<a class="ae md" href="https://github.com/jsdom/jsdom" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf"><em class="me">jsdom</em></strong></a><strong class="kv jf"><em class="me"/></strong>，从而支持测试web应用程序所需的大部分DOM API。通过并行测试，Jest应该比其他测试运行程序更快。致命的特性是CLI，它极大地改善了测试体验。与Jasmine或其他JavaScript框架相比，配置工作大大减少了。此外，您可以生成现成的代码覆盖率。</p><p id="25a0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">幸运的是，Jest不仅可以在React项目中使用，还可以在Angular、Vue.js和基本上所有js框架中使用。在本教程中，我想展示如何用Jest替换默认的角度测试。</p></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="ad00" class="mm mn je bd mo mp mq dn mr ms mt dp mu lc mv mw mx lg my mz na lk nb nc nd ne bi translated">如何在角度项目中设置Jest</h2><ol class=""><li id="5f72" class="lp lq je kv b kw nf kz ng lc nh lg ni lk nj lo nk lv lw lx bi translated">如果尚未创建Angular CLI项目，请创建一个。</li><li id="b5b1" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated">我们需要<strong class="kv jf">安装笑话</strong>和打字:<code class="fe nl nm nn no b">npm install jest @types/jest --only=dev</code>。</li><li id="635b" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated">为了让Jest知道如何在有角度的环境中工作，我们需要安装以下NPM包:<code class="fe nl nm nn no b">npm install jest-preset-angular</code>。</li><li id="cb44" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated"><strong class="kv jf">将Jest配置</strong>添加到您的<strong class="kv jf"> package.json </strong>中。或者，您可以创建一个JavaScript文件来配置Jest。</li><li id="7a5c" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated">调整你的测试脚本:用Jest命令替换任何<code class="fe nl nm nn no b">ng test</code>用法。</li><li id="340e" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated">将<code class="fe nl nm nn no b">tsconfig.json</code>文件中的<code class="fe nl nm nn no b">"jasmine"</code>替换为<code class="fe nl nm nn no b">"jest"</code>。</li><li id="c23a" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated"><strong class="kv jf">去除茉莉</strong>及其类型:<code class="fe nl nm nn no b">npm uninstall jasmine @types/jasmine</code>。</li><li id="6508" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo nk lv lw lx bi translated"><strong class="kv jf">删除任何</strong> <strong class="kv jf"> <em class="me">因果</em> </strong> <em class="me"> </em>相关包和<strong class="kv jf"> test.ts </strong>如果不需要在真实浏览器中测试。</li></ol><p id="595c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这里有一个示例<strong class="kv jf"> package.json </strong>，它包括Jest的脚本和告诉Jest在哪里可以找到我们的配置的方法。</p><pre class="np nq nr ns gt nt no nu nv aw nw bi"><span id="fe61" class="mm mn je no b gy nx ny l nz oa">{<br/> "name": "my-package",<br/> "version": "0.0.1",<br/> "license": "MIT",<br/> "scripts": {<br/>  "test": "jest",<br/>  "test:watch": "jest --watch",<br/>  "test:cc": "jest --coverage"<br/> },<br/> "dependencies": {<br/>  "<a class="ae md" href="http://twitter.com/angular/common" rel="noopener ugc nofollow" target="_blank">@angular/common</a>": "7.2.1",<br/>  "<a class="ae md" href="http://twitter.com/angular/compiler" rel="noopener ugc nofollow" target="_blank">@angular/compiler</a>": "7.2.1",<br/>  ...<br/> },<br/> "devDependencies": {<br/>  "<a class="ae md" href="http://twitter.com/types/jest" rel="noopener ugc nofollow" target="_blank">@types/jest</a>": "^24.0.6",<br/>  "jest": "^24.1.0",<br/>  "jest-preset-angular": "^6.0.2",<br/>  "ts-node": "~7.0.1",<br/>  "typescript": "3.2.4"<br/> },<br/> "jest": {<br/>  "preset": "jest-preset-angular",<br/>  "setupTestFrameworkScriptFile": "&lt;rootDir&gt;/setupJest.ts"<br/> }<br/>}</span></pre><p id="20e9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf"> setupJest.ts </strong>(在<em class="me"> package.json </em>中导入，可以换个名字)可以简单到:</p><pre class="np nq nr ns gt nt no nu nv aw nw bi"><span id="ee8f" class="mm mn je no b gy nx ny l nz oa">import 'jest-preset-angular';</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="2ee3" class="mm mn je bd mo mp mq dn mr ms mt dp mu lc mv mw mx lg my mz na lk nb nc nd ne bi translated">Jest的优势(与Karma + Jasmine相比)</h2><ul class=""><li id="353c" class="lp lq je kv b kw nf kz ng lc nh lg ni lk nj lo lu lv lw lx bi translated"><strong class="kv jf"> CLI </strong>:按文件名或测试名正则表达式模式过滤(减少对<a class="ae md" href="https://jasmine.github.io/2.1/focused_specs.html" rel="noopener ugc nofollow" target="_blank"><em class="me">fdescripe</em></a>的需求)并重新运行测试</li><li id="9335" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">执行测试而不构建整个应用程序允许更快地运行我们的测试</li><li id="caff" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv jf">低配置</strong>需要入门</li><li id="94a8" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">清晰的文档使Jest很容易适应你的需要</li><li id="1c4a" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">测试是稳定的:在编写测试时，不再有突然的测试运行失败</li><li id="dfc2" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">您可以<a class="ae md" href="https://jestjs.io/docs/en/migration-guide" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf">保留大部分Jasmine语法</strong> </a>，因为Jest除了包含自己的API之外，还包含了大部分Jasmine API</li><li id="0186" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae md" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf">快照测试</strong> </a>，Jasmine中没有的有用特性</li><li id="c22e" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">更活跃的社区会让Jest变得更好</li></ul><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/a137479888771245a1bcf09d487d5297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StN2FXPgt9JMWfHdQ9PR_w.png"/></div></div></figure></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="7cad" class="mm mn je bd mo mp mq dn mr ms mt dp mu lc mv mw mx lg my mz na lk nb nc nd ne bi translated">从因果报应+茉莉切换到笑话时的陷阱</h2><ul class=""><li id="1dca" class="lp lq je kv b kw nf kz ng lc nh lg ni lk nj lo lu lv lw lx bi translated"><strong class="kv jf">有些属性或函数是</strong> <a class="ae md" href="https://github.com/jsdom/jsdom" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf"> jsdom </strong> </a>中不存在的。例如:jsdom中不支持<a class="ae md" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText" rel="noopener ugc nofollow" target="_blank"> <em class="me"> innerText </em> </a>属性。主要问题是innerText(像其他一些属性和函数一样)依赖布局引擎来指导，而jsdom没有布局引擎。相反，您可以使用<a class="ae md" href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent" rel="noopener ugc nofollow" target="_blank"><em class="me">text content</em></a><em class="me"/>并可选地调用<a class="ae md" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim" rel="noopener ugc nofollow" target="_blank"> trim() </a>来消除空白。</li><li id="961d" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">像<a class="ae md" href="https://jquery.com/" rel="noopener ugc nofollow" target="_blank"> jQuery </a>这样的第三方库的导入可能会很棘手。如果您使用jQuery并希望它在全球范围内可用，您需要将jQuery添加到<a class="ae md" href="https://developer.mozilla.org/en-US/docs/Web/API/Window" rel="noopener ugc nofollow" target="_blank">窗口</a>对象中。您可以在您的<em class="me"> setupJest.ts </em>文件中这样做。</li><li id="a70f" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv jf">Jest</strong>目前还不太支持跨浏览器测试。如果你想进行跨浏览器单元测试，你可以保留所有与Karma相关的文件，因为Jest目前不支持在浏览器中运行(除了Chrome使用<a class="ae md" href="https://github.com/GoogleChrome/puppeteer" rel="noopener ugc nofollow" target="_blank"> <em class="me">木偶师</em> </a>)。</li><li id="e2b0" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">如果你使用<a class="ae md" href="https://netbasal.com/sexier-imports-in-typescript-e3c645bdd3c6" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf">类型脚本路径</strong> </a> <strong class="kv jf">进行更干净的导入，而Jest不理解你的导入</strong>，那么你需要提供Jest一个<a class="ae md" href="https://kulshekhar.github.io/ts-jest/user/config/#paths-mapping" rel="noopener ugc nofollow" target="_blank">路径映射</a>。</li></ul></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="8765" class="mm mn je bd mo mp mq dn mr ms mt dp mu lc mv mw mx lg my mz na lk nb nc nd ne bi translated">额外收获:使用你的IDE运行Jest测试</h2><p id="3d12" class="pw-post-body-paragraph kt ku je kv b kw nf kf ky kz ng ki lb lc oc le lf lg od li lj lk oe lm ln lo im bi translated"><strong class="kv jf">Jetbrains</strong>(<strong class="kv jf">IntelliJ/web storm</strong>…)的开发者创建了一个<a class="ae md" href="https://www.jetbrains.com/help/idea/running-unit-tests-on-jest.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf"> Jest插件</strong> </a>，它允许你直接从你的IDE运行测试。如果你使用的是<strong class="kv jf"> Visual Studio代码</strong>，你可以很容易地<strong class="kv jf">创建一个启动配置</strong>，你可以在其中执行。你需要做的就是在你的<strong class="kv jf">中创建一个<a class="ae md" href="https://code.visualstudio.com/docs/editor/debugging#_launch-configurations" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf"> launch.json </strong> </a>文件。vscode </strong>文件夹，并添加以下配置:</p><pre class="np nq nr ns gt nt no nu nv aw nw bi"><span id="e5d1" class="mm mn je no b gy nx ny l nz oa">{<br/>      "type": "node",<br/>      "request": "launch",<br/>      "name": "Jest: Run all",<br/>      "program": "${workspaceFolder}/node_modules/.bin/jest",<br/>      "args": [],<br/>      "console": "integratedTerminal",<br/>      "internalConsoleOptions": "neverOpen",<br/>      "disableOptimisticBPs": true<br/>    },<br/>    {<br/>      "type": "node",<br/>      "request": "launch",<br/>      "name": "Jest: Run current File",<br/>      "program": "${workspaceFolder}/node_modules/.bin/jest",<br/>      "args": [<br/>        "${relativeFile}"<br/>      ],<br/>      "console": "integratedTerminal",<br/>      "internalConsoleOptions": "neverOpen",<br/>      "disableOptimisticBPs": true<br/>    }<br/>}</span></pre></div><div class="ab cl mf mg hx mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="im in io ip iq"><h2 id="a02d" class="mm mn je bd mo mp mq dn mr ms mt dp mu lc mv mw mx lg my mz na lk nb nc nd ne bi translated">结论</h2><p id="f1de" class="pw-post-body-paragraph kt ku je kv b kw nf kf ky kz ng ki lb lc oc le lf lg od li lj lk oe lm ln lo im bi translated">感谢阅读这篇关于如何使用Jest大幅度提高Angular测试体验的文章。无论我使用哪种框架，Jest都已经成为我最喜欢的JavaScript测试解决方案。你对Jest和JavaScript测试框架有什么体验？请在评论中告诉我。</p></div></div>    
</body>
</html>