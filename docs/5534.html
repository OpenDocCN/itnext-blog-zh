<html>
<head>
<title>Setting up API Gateway with DynamoDB using Cloudformation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cloudformation通过DynamoDB设置API网关</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-api-gateway-with-dynamodb-using-cloudformation-a8ab3e70f494?source=collection_archive---------1-----------------------#2021-03-26">https://itnext.io/setting-up-api-gateway-with-dynamodb-using-cloudformation-a8ab3e70f494?source=collection_archive---------1-----------------------#2021-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a784" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，为DynamoDB构建API时，会使用lambda函数。我想看看没有lambda是怎么做到的。在这篇文章中，我将为包含龙的信息的数据库构建一个简单的API。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7d61c56c090674a353559753375e80f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2055Yow2uLrQwc3V17z5Hg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">我们将要实现的架构</figcaption></figure><p id="7fd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用嵌套的堆栈设置，以便更容易将数据库和API集成到现有的基础设施中，或者在以后进行扩展。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="fbb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根栈由下面的<code class="fe li lj lk ll b">template.yaml</code>定义:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="06e6" class="lq lr iq ll b gy ls lt l lu lv">AWSTemplateFormatVersion: 2010-09-09<br/>Transform: AWS::Serverless-2016-10-31<br/>Description: Root stack<br/>Resources:<br/>  Application:<br/>    Type: AWS::Serverless::Application<br/>    Properties:<br/>      Location: application/template.yaml<br/>    Parameters:<br/>      Stage: prod</span><span id="cf6c" class="lq lr iq ll b gy lw lt l lu lv">Outputs:<br/>  EndpointUrl:<br/>   Value: !GetAtt Application.Outputs.Url</span></pre><p id="4489" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DynamoDB和API以及<code class="fe li lj lk ll b">EndpointUrl</code>在<code class="fe li lj lk ll b">application/template.yaml</code>中定义。模板的前几行如下:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="e898" class="lq lr iq ll b gy ls lt l lu lv">AWSTemplateFormatVersion: 2010-09-09<br/>Transform: AWS::Serverless-2016-10-31<br/>Description: &gt;-<br/>  Creates API Gateway and sets up a dynamodb<br/>Parameters:<br/>  Stage:<br/>   Type: String</span></pre><p id="2849" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署的阶段，在这种情况下<code class="fe li lj lk ll b">prod</code>是从根栈传递到应用程序的参数。</p><p id="e3af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个模板中定义了3个资源，DynamoDB表、AIM角色和API网关，以及一个输出。让我们从桌子开始:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="6021" class="lq lr iq ll b gy ls lt l lu lv">Resources:<br/>  DragonsTable:<br/>    Type: AWS::DynamoDB::Table<br/>    Properties:<br/>      TableName: dragons<br/>      AttributeDefinitions:<br/>        - AttributeName: id<br/>          AttributeType: S<br/>      KeySchema:<br/>        - AttributeName: id<br/>          KeyType: HASH<br/>      ProvisionedThroughput:<br/>        ReadCapacityUnits: 1<br/>        WriteCapacityUnits: 1</span></pre><p id="cab2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DynamoDB龙表将包含所有关于龙的信息，例如:它们的名字、大小、颜色和年龄。在模板中，表只有一个定义的属性:<code class="fe li lj lk ll b">id</code>。该属性对于<code class="fe li lj lk ll b">KeySchema </code>是必需的，并且是一个分区键。使用的其他属性确实需要添加到模板中，因为它们不是模式或二级索引的一部分。DynamoDB表的默认计费模式是预配的。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="635d" class="lq lr iq ll b gy ls lt l lu lv">  APIRole:<br/>    Type: AWS::IAM::Role<br/>    Properties:<br/>      AssumeRolePolicyDocument:<br/>        Version: 2012-10-17<br/>        Statement:<br/>         - Effect: Allow<br/>           Principal:<br/>             Service:<br/>             - apigateway.amazonaws.com<br/>           Action:<br/>            - sts:AssumeRole<br/>      Policies:<br/>       - PolicyName: APIPolicy<br/>         PolicyDocument:<br/>           Version: 2012-10-17<br/>         Statement:<br/>          - Effect: Allow<br/>            Action:<br/>             - "dynamodb:PutItem"<br/>             - "dynamodb:UpdateItem"<br/>             - "dynamodb:DeleteItem"<br/>             - "dynamodb:GetItem"<br/>             - "dynamodb:Scan"<br/>            Resource: !GetAtt DragonsTable.Arn</span></pre><p id="dd3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">api角色将确保API网关被允许访问数据库。我们将允许以下操作:添加新项目(put)、更新项目、删除项目、获取特定项目和扫描整个数据库。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="c3f5" class="lq lr iq ll b gy ls lt l lu lv">Api:<br/>   Type: AWS::Serverless::Api<br/>   Properties:<br/>     StageName: !Ref Stage<br/>     OpenApiVersion: 3.0.2<br/>     DefinitionBody:<br/>       Fn::Transform:<br/>         Name: AWS::Include<br/>         Parameters:<br/>           Location: openapi.yaml</span></pre><p id="f038" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第三个资源是API网关服务，在另一个模板<code class="fe li lj lk ll b">openapi.yaml</code>中定义。在这个yaml中，我们将定义端点。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="cb50" class="lq lr iq ll b gy ls lt l lu lv">Outputs:<br/>  Url:<br/>   Description: Endpoint URL<br/>   Value: !Sub https://${Api}.execute-api.${AWS::Region}.amazonaws.com/${Stage}</span></pre><p id="2490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模板的输出是我们在根栈中引用的api端点url。这个端点供用户或应用程序访问我们的API。</p><p id="9511" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们来看一下<code class="fe li lj lk ll b">openapi.yaml</code>模板。我们定义了两条路径:<code class="fe li lj lk ll b">dragons</code>和<code class="fe li lj lk ll b">dragon</code>。<code class="fe li lj lk ll b">dragons</code>端点有两种方法:<code class="fe li lj lk ll b">POST</code>和<code class="fe li lj lk ll b">GET</code>。post方法用于向数据库中添加新项，而get方法用于列出数据库中的所有项。<code class="fe li lj lk ll b">dragon/dragonId</code>接收数据库中项目的<code class="fe li lj lk ll b">id</code>并处理特定项目。我们在这里实现的方法有:<code class="fe li lj lk ll b">GET</code>，获取特定龙的详细信息，<code class="fe li lj lk ll b">PUT</code>，更新特定龙的名称，<code class="fe li lj lk ll b">DELETE</code>，从数据库中删除一条龙。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="2de1" class="lq lr iq ll b gy ls lt l lu lv">openapi: 3.0.2<br/>info:<br/>  title:<br/>    Dragons Api<br/>  description:<br/>    Lambdaless api to get data from DynamoDB<br/>  version: 1.0.0<br/>paths:<br/>  /dragons:<br/>    post:<br/>      consumes:<br/>        - 'application/json'<br/>      produces:<br/>        - 'application/json'<br/>      requestBody:<br/>        content:<br/>          application/json:<br/>            schema:<br/>              $ref: '#/components/schemas/Dragon'<br/>      responses:<br/>        200:<br/>          $ref: '#/components/responses/Dragon'<br/>      x-amazon-apigateway-integration:<br/>        description: Add a new dragon to the database<br/>        credentials:  { 'Fn::GetAtt': APIRole.Arn }<br/>        uri: { 'Fn::Sub': 'arn:aws:apigateway:${AWS::Region}:dynamodb:action/PutItem' }<br/>        requestTemplates:<br/>          application/json: <br/>            Fn::Sub:<br/>              - |- <br/>                { <br/>                  "TableName": "${tableName}",<br/>                  "Item": {<br/>                    "id": {<br/>                      "S": "$context.requestId"<br/>                    },<br/>                    "name": {<br/>                      "S": "$input.path("$.name")"<br/>                    },<br/>                    "size": {<br/>                      "S": "$input.path("$.size")"<br/>                    },<br/>                    "age": {<br/>                      "N": "$input.path("$.age")"  <br/>                    },<br/>                    "color": {<br/>                      "S": "$input.path("$.color")"  <br/>                    }<br/>                  }<br/>                }<br/>              - { tableName: { Ref: DragonsTable } }<br/>        responses:<br/>          default:<br/>            statusCode: 200<br/>            responseTemplates:<br/>              application/json: '#set($inputRoot = $input.path("$"))<br/>                {<br/>                    "id": "$context.requestId"<br/>                }'<br/>        passthroughBehavior: 'when_no_match'<br/>        httpMethod: POST<br/>        type: AWS</span></pre><p id="0dda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该方法根据模板底部定义的模式使用json数据，这些数据将被添加到数据库中。端点还生成一个json响应，并返回添加到数据库中的龙的id。从我们之前定义的API角色中获取的凭证。本例中的uri(统一资源标识符)是dynamodb操作put项。</p><p id="f05b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请求模板用于解析json并将项目添加到表中。表名由先前定义的表替换。</p><p id="cee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在这个路径上定义的下一个方法是get方法，它将使用dynamodb表上的扫描操作来获取表中的所有项目:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="01ac" class="lq lr iq ll b gy ls lt l lu lv">    get:<br/>      consumes:<br/>        - 'application/json'<br/>      produces:<br/>        - 'application/json'<br/>      responses:<br/>        200:<br/>          $ref: '#/components/responses/Dragon'<br/>      x-amazon-apigateway-integration:<br/>        description: Retrieve all dragons in the database<br/>        credentials:  { 'Fn::GetAtt': APIRole.Arn }<br/>        uri: { 'Fn::Sub': 'arn:aws:apigateway:${AWS::Region}:dynamodb:action/Scan' }<br/>        requestTemplates:<br/>          application/json:<br/>            Fn::Sub:<br/>              - |-<br/>                {<br/>                  "TableName": "${tableName}"<br/>                }<br/>              - { tableName: { Ref: DragonsTable } }<br/>        responses:<br/>          default:<br/>            statusCode: 200<br/>            responseTemplates:<br/>              application/json: '#set($inputRoot = $input.path("$"))<br/>                          {<br/>                            "dragons": [<br/>                              #foreach($elem in $inputRoot.Items) {<br/>                                "id": "$elem.id.S",<br/>                                "name": "$elem.name.S",<br/>                                "size": "$elem.size.S",<br/>                                "age": "$elem.age.N",<br/>                                "color": "$elem.color.S"<br/>                              }#if($foreach.hasNext),#end<br/>                              #end<br/>                            ]<br/>                          }'<br/>        passthroughBehavior: 'when_no_match'<br/>        httpMethod: POST<br/>        type: AWS</span></pre><p id="b16e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们定义一个需要路径变量<code class="fe li lj lk ll b">dragonId</code>的路径。这条路径上的第一个方法是get方法，用于从数据库中获取特定的项。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="54a6" class="lq lr iq ll b gy ls lt l lu lv">  /dragon/{dragonId}:<br/>    get:<br/>      consumes:<br/>        - 'application/json'<br/>      produces:<br/>        - 'application/json'<br/>      parameters:<br/>        - name: 'dragonId'<br/>          in: 'path'<br/>          required: true<br/>          schema:<br/>            type: string<br/>      responses:<br/>        200:<br/>          $ref: '#/components/responses/Dragon'<br/>      x-amazon-apigateway-integration:<br/>        description: Retrieve a specific dragon from the database <br/>        credentials:  { 'Fn::GetAtt': APIRole.Arn }<br/>        uri: { 'Fn::Sub': 'arn:aws:apigateway:${AWS::Region}:dynamodb:action/GetItem' }<br/>        requestTemplates:<br/>          application/json:<br/>            Fn::Sub: <br/>              - |-<br/>                { <br/>                  "TableName": "${tableName}",<br/>                  "Key": {<br/>                          "id": {<br/>                            "S": "$input.params("dragonId")"<br/>                          }<br/>                        }<br/>                }<br/>              - { tableName: { Ref: DragonsTable } }<br/>        responses:<br/>          default:<br/>            statusCode: 200<br/>            responseTemplates:<br/>              application/json: '#set($inputRoot = $input.path("$"))<br/>                {<br/>                    "id": "$inputRoot.Item.id.S",<br/>                    "name": "$inputRoot.Item.name.S",<br/>                    "size": "$inputRoot.Item.size.S",<br/>                    "age": "$inputRoot.Item.age.N",<br/>                    "color": "$inputRoot.Item.color.S"<br/>                }'<br/>        passthroughBehavior: "when_no_match"<br/>        httpMethod: POST<br/>        type: AWS<br/><br/>    put:<br/>      consumes:<br/>        - 'application/json'<br/>      produces:<br/>        - 'application/json'<br/>      parameters:<br/>        - name: 'dragonId'<br/>          in: 'path'<br/>          required: true<br/>          schema:<br/>            type: string<br/>      responses:<br/>        200:<br/>          $ref: '#/components/responses/Dragon'<br/>      x-amazon-apigateway-integration:<br/>        description: Update the name of a specific dragon<br/>        credentials:  { 'Fn::GetAtt': APIRole.Arn }<br/>        uri: { 'Fn::Sub': 'arn:aws:apigateway:${AWS::Region}:dynamodb:action/UpdateItem' }<br/>        requestTemplates:<br/>          application/json: <br/>            Fn::Sub: <br/>              - |-<br/>                { <br/>                  "TableName": "${tableName}",<br/>                  "Key": {<br/>                          "id": {<br/>                            "S": "$input.params("dragonId")"<br/>                          }<br/>                        },<br/>                  "ExpressionAttributeValues": {<br/>                    ":n": {"S": "$input.path("$.name")"}<br/>                        },<br/>                  "ExpressionAttributeNames": {<br/>                    "#n": "name"<br/>                  },<br/>                  "UpdateExpression": "SET #n = :n",<br/>                  "ReturnValues": "ALL_NEW"<br/>                }<br/>              - { tableName: { Ref: DragonsTable } }<br/>        responses:<br/>          default:<br/>            statusCode: 200<br/>            responseTemplates:<br/>              application/json: '#set($inputRoot = $input.path("$"))<br/>                {<br/>                  "updated": {<br/>                    "id": "$inputRoot.Attributes.id.S",<br/>                    "name": "$inputRoot.Attributes.name.S"<br/>                  }<br/>                }'<br/>        passthroughBehavior: 'when_no_match'<br/>        httpMethod: POST<br/>        type: AWS<br/><br/>    delete:<br/>      consumes:<br/>        - 'application/json'<br/>      produces:<br/>        - 'application/json'<br/>      parameters:<br/>      - name: 'dragonsId'<br/>        in: 'path'<br/>        required: true<br/>        schema:<br/>            type: string<br/>      responses:<br/>        200:<br/>          content:<br/>            application/json:<br/>              schema:<br/>                '$ref': '#/components/responses/Dragon'<br/>      x-amazon-apigateway-integration:<br/>        description: Delete a specific dragon from the database<br/>        credentials: { 'Fn::GetAtt': APIRole.Arn}<br/>        uri: { 'Fn::Sub': 'arn:aws:apigateway:${AWS::Region}:dynamodb:action/DeleteItem' }<br/>        requestTemplates:<br/>          application/json:  <br/>            Fn::Sub: <br/>              - |-<br/>                {<br/>                  "TableName": "${tableName}",<br/>                    "Key": {<br/>                      "id": {<br/>                        "S": "$input.params("dragonId")"<br/>                      }<br/>                    },<br/>                  "ReturnValues": "ALL_OLD"<br/>                }<br/>              - { tableName: { Ref: DragonsTable } }<br/>        responses:<br/>          default:<br/>            statusCode: 200<br/>            responseTemplates:<br/>              application/json: '#set($inputRoot = $input.path("$"))<br/>                {   <br/>                  "deleted" : {<br/>                    "id": "$inputRoot.Attributes.id.S",<br/>                    "name": "$inputRoot.Attributes.name.S",<br/>                    "size": "$inputRoot.Attributes.size.S",<br/>                    "age": "$inputRoot.Attributes.age.N",<br/>                    "color": "$inputRoot.Attributes.color.S"<br/>                    }<br/>                }'<br/>        passthroughBehavior: 'when_no_match'<br/>        httpMethod: POST<br/>        type: AWS</span></pre><p id="970b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们定义模式的:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="2661" class="lq lr iq ll b gy ls lt l lu lv">components:<br/>  schemas:<br/>    Empty:<br/>      type: object<br/>      description: Empty Schema<br/>    Dragon:<br/>      type: object<br/>      description: Dragon<br/>      properties:<br/>        id:<br/>          type: string<br/>        name:<br/>          type: string<br/>        size:<br/>          type: string<br/>        age:<br/>          type: number<br/>        color:<br/>          type: string<br/>  responses:<br/>    Dragon:<br/>      description: Dragon<br/>      content:<br/>        application/json:<br/>          schema:<br/>            type: object<br/>            properties:<br/>              id:<br/>                type: string<br/>              name:<br/>                type: string<br/>              size:<br/>                type: string<br/>              age:<br/>                type: number<br/>              color:<br/>                type: string</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="1640" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是时候部署api了。将这些值替换为与您的设置相匹配的值。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="8b71" class="lq lr iq ll b gy ls lt l lu lv">$ export profile="demo"<br/>$ export region="eu-central-1"<br/>$ export stackname="dragons-api"<br/>$ export bucket="bucket-medium-article"</span></pre><p id="6d2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们在aws上创建bucket来存储我们的cloudformation模板。如果你已经有一个桶，你可以跳过这个。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="07a9" class="lq lr iq ll b gy ls lt l lu lv">$ aws s3api create-bucket --bucket ${bucket} --create-bucket-configuration LocationConstraint=${region} --profile ${profile}</span></pre><p id="0846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将本地工件打包并上传到S3。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="f0c2" class="lq lr iq ll b gy ls lt l lu lv">$ aws cloudformation package --profile ${profile} --template-file template.yaml --s3-bucket ${bucket} --output-template-file ./build/template-generated.yaml</span></pre><p id="0e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们部署cloudformation模板并创建或更新堆栈。</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="0a60" class="lq lr iq ll b gy ls lt l lu lv">$ aws cloudformation deploy --profile ${profile} --template-file ./build/template-generated.yaml --stack-name ${stackname} --capabilities CAPABILITY_AUTO_EXPAND CAPABILITY_IAM</span></pre><p id="29de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要获取API的端点，我们可以使用以下命令:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="c0e1" class="lq lr iq ll b gy ls lt l lu lv">$ export endpointUrl=$(aws cloudformation describe-stacks --profile ${profile} --stack ${stackname} --query "Stacks[0].Outputs[?OutputKey=='EndpointUrl'].OutputValue" --output text)</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><p id="ea92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们通过向表中添加一条龙来测试API:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="3fb7" class="lq lr iq ll b gy ls lt l lu lv">$ curl -X POST ${endpointUrl}/dragons -H "Content-Type: application/json" -d '{"name":"Mushu","size":"small","color":"red","age":"123"}'</span></pre><p id="f0a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将返回数据库中新创建的龙的id，例如:<code class="fe li lj lk ll b">{ “id”: “d1c89d37–5d1d-4fba-9e01–7a83f4387f0c” }</code></p><p id="d42d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要获得数据库中的所有龙，我们可以使用以下代码:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="ddfd" class="lq lr iq ll b gy ls lt l lu lv">$ curl -X GET ${endpointUrl}/dragons </span></pre><p id="0ae8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将返回龙的列表:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="9316" class="lq lr iq ll b gy ls lt l lu lv">{ “dragons”: <br/>  [ <br/>    { “id”: “d1c89d37–5d1d-4fba-9e01–7a83f4387f0c”, <br/>      “name”: “Mushu”, <br/>      “size”: “small”, <br/>      “age”: “123”, <br/>      “color”: “red” <br/>    }, <br/>    { “id”: “2fd695eb-b50a-476a-8e17–3676238b63e8”, <br/>      “name”: “Toothless”, <br/>      “size”: “medium”, <br/>      “age”: “15”, <br/>      “color”: “black” <br/>    }<br/>  ] <br/>}</span></pre><p id="d6b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要更新其中一条龙的名称:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="e28d" class="lq lr iq ll b gy ls lt l lu lv">$ curl -X PUT ${endpointUrl}/dragon/2ca9cb67–5d27–49be-aec1–128606d3f899 -H “Content-Type: application/json” -d ‘{“name”:”Meatlug”}’</span><span id="d761" class="lq lr iq ll b gy lw lt l lu lv">{ “updated”: { “id”: “2ca9cb67–5d27–49be-aec1–128606d3f899”, “name”: “Meatlug”} }</span></pre><p id="302c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从表格中删除龙:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="847d" class="lq lr iq ll b gy ls lt l lu lv">$ curl -X DELETE ${endpointUrl}/dragon/2fd695eb-b50a-476a-8e17-3676238b63e8                                                       </span><span id="30d4" class="lq lr iq ll b gy lw lt l lu lv">{ "deleted" : { "id": "2fd695eb-b50a-476a-8e17-3676238b63e8", "name": "Toothless", "size": "medium", "age": "15", "color": "black" } }</span></pre><p id="59cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要获得特定龙的详细信息:</p><pre class="km kn ko kp gt lm ll ln lo aw lp bi"><span id="93e1" class="lq lr iq ll b gy ls lt l lu lv">$ curl -X GET ${endpointUrl}/dragon/d1c89d37-5d1d-4fba-9e01-7a83f4387f0c    </span><span id="6d2d" class="lq lr iq ll b gy lw lt l lu lv">{ "id": "d1c89d37-5d1d-4fba-9e01-7a83f4387f0c", "name": "Mushu", "size": "small", "age": "123", "color": "red" }</span></pre><p id="225b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。我希望您对这个用例感兴趣！</p></div></div>    
</body>
</html>