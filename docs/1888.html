<html>
<head>
<title>Serverless Framework: Deploy an HTTP endpoint using NodeJS, Lambda on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器框架:在AWS上使用NodeJS，Lambda部署HTTP端点</h1>
<blockquote>原文：<a href="https://itnext.io/serverless-framework-deploy-an-http-endpoint-using-nodejs-lambda-on-aws-30558422de1b?source=collection_archive---------4-----------------------#2019-02-18">https://itnext.io/serverless-framework-deploy-an-http-endpoint-using-nodejs-lambda-on-aws-30558422de1b?source=collection_archive---------4-----------------------#2019-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="ca57" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">目标</h1><p id="7ee9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">今天你将学习如何使用<a class="ae lj" href="http://serverless.com" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>创建一个<a class="ae lj" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a> HTTP端点，在NodeJS中用<a class="ae lj" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>实现</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/a338c22b0acc2f91fbf288d76ae759ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*XFTi2IF45rN7pjKr_0d5IA.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">在我们要实现的架构之上</figcaption></figure><h1 id="9634" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">什么是无服务器框架？</h1><blockquote class="lw lx ly"><p id="7339" class="kl km lz kn b ko ma kq kr ks mb ku kv mc md ky kz me mf lc ld mg mh lg lh li ij bi translated"><em class="iq">“无服务器是您部署和操作无服务器架构的工具包。专注于您的应用，而不是您的基础设施。——</em><a class="ae lj" href="http://serverless.com" rel="noopener ugc nofollow" target="_blank"><em class="iq"/></a><em class="iq"/></p></blockquote><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/90e1bbf76e433d17d0a9826cb6db3d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3BJE0sST78m41GUv"/></div></div></figure><p id="8650" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">无服务器框架的主要优势:</p><ul class=""><li id="7114" class="mn mo iq kn b ko ma ks mb kw mp la mq le mr li ms mt mu mv bi translated">使用无服务器框架，您可以通过定义一个简单的yam配置文件来定义整个无服务器应用程序</li><li id="6f18" class="mn mo iq kn b ko mw ks mx kw my la mz le na li ms mt mu mv bi translated">无服务器框架是开源的，并提供不可知的</li><li id="2041" class="mn mo iq kn b ko mw ks mx kw my la mz le na li ms mt mu mv bi translated">无服务器框架支持多种语言，如NodeJS、Python、Java、Ruby、Go等等</li></ul><h1 id="32ac" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">先决条件</h1><p id="faee" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">本教程将介绍在AWS中创建和部署无服务器应用程序所需的一些步骤。但是，在开始之前，您需要:</p><ul class=""><li id="e575" class="mn mo iq kn b ko ma ks mb kw mp la mq le mr li ms mt mu mv bi translated">拥有一个<a class="ae lj" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank"> AWS账户</a> : AWS给你<a class="ae lj" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank"> 12个月的免费等级</a>，你可以使用它来进行你的测试！</li><li id="6d69" class="mn mo iq kn b ko mw ks mx kw my la mz le na li ms mt mu mv bi translated">安装<a class="ae lj" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>和<a class="ae lj" href="https://yarnpkg.com/" rel="noopener ugc nofollow" target="_blank">纱线</a></li></ul><h1 id="2915" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">无服务器配置</h1><p id="a421" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在开始之前，我们需要做一些无聊的步骤来安装和配置无服务器</p><h2 id="8387" class="nb jo iq bd jp nc nd dn jt ne nf dp jx kw ng nh kb la ni nj kf le nk nl kj nm bi translated">安装无服务器</h2><p id="b7c6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">打开你的控制台，输入(如果你用的是Linux，把sudo放在前面)</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="166d" class="nb jo iq no b gy ns nt l nu nv">$ npm install -g serverless</span></pre><h2 id="34fb" class="nb jo iq bd jp nc nd dn jt ne nf dp jx kw ng nh kb la ni nj kf le nk nl kj nm bi translated">配置AWS IAM密钥</h2><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="6c51" class="nb jo iq no b gy ns nt l nu nv"><em class="lz">$ serverless config credentials --provider aws --key xxxxxxxxxxxxxx --secret xxxxxxxxxxxxxx</em></span></pre><h1 id="837f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">开始吧！</h1><p id="adb4" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们终于准备好开始了！我们将开始创建一个HTTP端点，它将通过<a class="ae lj" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> AWS API网关</a>公开</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/eb7e846507672c35d99f1f01f8504ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/0*9-AKtTdDuAgNk6sM"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">AWS API网关将帮助我们公开HTTP端点</figcaption></figure><h2 id="bf5b" class="nb jo iq bd jp nc nd dn jt ne nf dp jx kw ng nh kb la ni nj kf le nk nl kj nm bi translated">创建样板文件</h2><p id="e6f7" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦定义了我们想要使用的技术堆栈(NodeJS)和云提供商(Serverless可以为我们准备一个简单的项目。所以打开一个控制台，输入</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="cc73" class="nb jo iq no b gy ns nt l nu nv"><em class="lz">$ serverless create --template aws-nodejs --path </em>serverless-aws-nodejs</span></pre><p id="0b1d" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">如您所见，Serverless在一个基本的NodeJS服务中创建了一个新文件夹。主要文件有:</p><ul class=""><li id="c513" class="mn mo iq kn b ko ma ks mb kw mp la mq le mr li ms mt mu mv bi translated"><em class="lz">server less . yml</em>:server less的主配置文件</li><li id="d7c4" class="mn mo iq kn b ko mw ks mx kw my la mz le na li ms mt mu mv bi translated"><em class="lz"> handlers.js </em>:确实包含NodeJS应用。我们可以在<em class="lz"> app.js </em>中重命名</li></ul><p id="2878" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">下一步是安装所需的依赖项。进入创建的文件夹并键入</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="a2a3" class="nb jo iq no b gy ns nt l nu nv">$ npm init -y &amp;&amp; npm install</span></pre><h2 id="928c" class="nb jo iq bd jp nc nd dn jt ne nf dp jx kw ng nh kb la ni nj kf le nk nl kj nm bi translated">部署！</h2><p id="ad1e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们终于准备好部署了！只需在控制台上键入:</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="3906" class="nb jo iq no b gy ns nt l nu nv">$ serverless deploy</span></pre><p id="73bd" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">几秒钟后，您将得到以下输出</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="d207" class="nb jo iq no b gy ns nt l nu nv">Serverless: Packaging service...<br/>Serverless: Excluding development dependencies...<br/>Serverless: Creating Stack...<br/>Serverless: Checking Stack create progress...<br/>.....<br/>Serverless: Stack create finished...<br/>Serverless: Uploading CloudFormation file to S3...<br/>Serverless: Uploading artifacts...<br/>Serverless: Uploading service .zip file to S3 (387 B)...<br/>Serverless: Validating template...<br/>Serverless: Updating Stack...<br/>Serverless: Checking Stack update progress...<br/>...............<br/>Serverless: Stack update finished...<br/>Service Information<br/>service: serverless-aws-nodejs<br/>stage: dev<br/>region: us-east-1<br/>stack: serverless-aws-nodejs<br/>api keys:<br/>  None<br/>endpoints:<br/>  None<br/>functions:<br/>  hello: serverless-aws-nodejs-dev-hello<br/>layers:<br/>  None</span></pre><p id="e7e5" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">不到5分钟，我们就在AWS上部署了第一个服务！虽然看起来很酷，但是我们部署的服务没有暴露任何端点所以不能用(Doh！)我们稍微改一下吧。</p><h1 id="7910" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">公开HTTP端点</h1><p id="dffb" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了公开一个HTTP端点，我们需要在<em class="lz"> serverless.yml </em>中配置AWS API网关，并用<em class="lz"> Express </em>处理它。</p><p id="64c8" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">让我们清理一下<em class="lz"> serverless.yml </em>文件，并在里面粘贴这些内容</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="9c40" class="nb jo iq no b gy ns nt l nu nv">service: serverless-aws-nodejs</span><span id="5f8c" class="nb jo iq no b gy nx nt l nu nv">provider:<br/> name: aws #Define the cloud provider to use<br/> runtime: nodejs8.10 <br/> stage: dev<br/> region: eu-central-1</span><span id="3b95" class="nb jo iq no b gy nx nt l nu nv">functions:<br/> app:<br/>  handler: app.server<br/>  events: #Define the events that trigger the lambda<br/>   - http: #Define an HTTP endpoint that respond to the / route<br/>     path: /<br/>     method: ANY #Define the HTTP methods to be used (GET/POST)<br/>     cors: true<br/>   - http: #Define an HTTP endpoin that respond to any routes<br/>     path: /{proxy+}<br/>     method: ANY<br/>     cors: true</span></pre><p id="7856" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">清理app.js并粘贴到该内容中</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="fd5a" class="nb jo iq no b gy ns nt l nu nv">// app.js<br/>const express = require('express')<br/>const app = express()<br/>const sls = require('serverless-http')</span><span id="8e58" class="nb jo iq no b gy nx nt l nu nv">//Handle the GET endpoint on the root route /<br/>app.get('/', async (req, res, next) =&gt; { <br/> res.status(200).send('Hello Serverless!')<br/>})</span><span id="9a92" class="nb jo iq no b gy nx nt l nu nv">module.exports.server = sls(app)</span></pre><p id="b951" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">安装依赖项</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="5748" class="nb jo iq no b gy ns nt l nu nv">npm install express serverless-http</span></pre><h2 id="e875" class="nb jo iq bd jp nc nd dn jt ne nf dp jx kw ng nh kb la ni nj kf le nk nl kj nm bi translated">再部署一下吧！</h2><p id="3238" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">几分钟后，您将得到类似的输出</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="9bc6" class="nb jo iq no b gy ns nt l nu nv">Serverless: Packaging service...<br/>Serverless: Excluding development dependencies...<br/>Serverless: Uploading CloudFormation file to S3...<br/>Serverless: Uploading artifacts...<br/>Serverless: Uploading service .zip file to S3 (283 B)...<br/>Serverless: Validating template...<br/>Serverless: Updating Stack...<br/>Serverless: Checking Stack update progress...<br/>.......................................<br/>Serverless: Stack update finished...<br/>Service Information<br/>service: serverless-aws-nodejs<br/>stage: dev<br/>region: eu-central-1<br/>stack: serverless-aws-nodejs-dev<br/>api keys:<br/>  None<br/>endpoints:<br/>  ANY - <a class="ae lj" href="https://sjib9tfm63.execute-api.eu-central-1.amazonaws.com/dev/" rel="noopener ugc nofollow" target="_blank">https://xxxxxxxxxx.execute-api.eu-central-1.amazonaws.com/dev/</a><br/>  ANY - <a class="ae lj" href="https://sjib9tfm63.execute-api.eu-central-1.amazonaws.com/dev/{proxy+" rel="noopener ugc nofollow" target="_blank">https://xxxxxxxxxx.execute-api.eu-central-1.amazonaws.com/dev/{proxy+</a>}<br/>functions:<br/>  app: serverless-aws-nodejs-dev-app<br/>layers:<br/>  None</span></pre><p id="b835" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">您可以从输出中注意到，这一次它公开了两个不同的端点。让我们测试第一个</p><pre class="ll lm ln lo gt nn no np nq aw nr bi"><span id="f26e" class="nb jo iq no b gy ns nt l nu nv">$ curl <a class="ae lj" href="https://xxxxxxxxxx.execute-api.eu-central-1.amazonaws.com/dev/" rel="noopener ugc nofollow" target="_blank">https://xxxxxxxxxx.execute-api.eu-central-1.amazonaws.com/dev/</a></span><span id="f4ea" class="nb jo iq no b gy nx nt l nu nv">Hello Serverless!% ###The output!</span></pre><h1 id="4376" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="d5fd" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在本教程中，我们学习了如何使用无服务器框架部署一个非常简单的HTTP端点。</p><p id="b5a6" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">后续教程:</p><ul class=""><li id="c32f" class="mn mo iq kn b ko ma ks mb kw mp la mq le mr li ms mt mu mv bi translated"><a class="ae lj" href="https://link.medium.com/0FpYcgFFEU" rel="noopener"> <strong class="kn ir">“无服务器框架:使用AWS Lambda和DynamoDB部署REST API”</strong></a>，我们将看到如何创建一个与DynamoDB集成的类REST API！</li><li id="b412" class="mn mo iq kn b ko mw ks mx kw my la mz le na li ms mt mu mv bi translated"><a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/serverless-framework-warming-up-aws-lambda-to-avoid-cold-start-2be579475531"> <strong class="kn ir">无服务器框架:预热AWS Lambda以避免“冷启动”</strong> </a>，我们将了解AWS Lambda函数的“冷启动”问题是什么，以及如何使用无服务器框架解决它</li></ul><p id="9f73" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">此处链接到<a class="ae lj" href="https://bitbucket.org/mriso/serverless-aws-nodejs" rel="noopener ugc nofollow" target="_blank">位存储桶回购</a></p><p id="ad31" class="pw-post-body-paragraph kl km iq kn b ko ma kq kr ks mb ku kv kw md ky kz la mf lc ld le mh lg lh li ij bi translated">请不吝赐教:)</p></div></div>    
</body>
</html>