<html>
<head>
<title>Sign In With Apple in 7 Steps — As Deep As Possible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过7个步骤登录Apple尽可能深入</h1>
<blockquote>原文：<a href="https://itnext.io/sign-in-with-apple-in-7-steps-as-deep-as-possible-45c919bdb066?source=collection_archive---------3-----------------------#2021-07-25">https://itnext.io/sign-in-with-apple-in-7-steps-as-deep-as-possible-45c919bdb066?source=collection_archive---------3-----------------------#2021-07-25</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><figure class="gm go js jt ju jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj jr"><img src="../Images/93cb4a88ac9da8f5c298c0dd0b5b8cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zj1nYYHmgAIEUmFAejS7Bw.png"/></div></div></figure><p id="7a98" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi la translated"><span class="l lb lc ld bm le lf lg lh li di"> S </span> ign In With Apple是苹果公司打造的认证系统。iCloud用户可以鉴定应用程序以检索他们的全名和电子邮件地址。苹果公司为那些想要隐藏自己电子邮件地址的用户提供代理电子邮件服务，以免应用程序所有者索要他们的电子邮件地址。在代理电子邮件系统的控制下，应用程序所有者必须首先在苹果服务器上注册他们的域名，以便向客户发送电子邮件。</p><p id="099f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">苹果提供了<a class="ae lj" href="https://developer.apple.com/documentation/authenticationservices" rel="noopener ugc nofollow" target="_blank">认证服务框架</a>，为开发者提供了一个简单易用的认证工具，以方便他们在应用中实现。开发者必须首先在苹果开发者控制台配置功能，然后在应用程序端编码。可以只分7步！👏🏼</p><p id="b89b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">对于提供任何第三方认证选项的应用程序来说，登录苹果是一个必要的登录选项，包括谷歌登录、脸书、Instagram和Twitter等。因此，你可以看到越来越多的应用程序现在在其应用程序中提供使用苹果选项登录。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="8947" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">开始前</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mp"><img src="../Images/86a42543aee5fa156c66e7ddd303f17b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MaM1ZaNfN1wsX1cR"/></div></div></figure><p id="b1ed" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">登录苹果<strong class="ke iv">只有</strong> <strong class="ke iv">可以在</strong> <strong class="ke iv">真实设备</strong>上运行，因此你<strong class="ke iv">必须</strong>拥有<a class="ae lj" href="https://developer.apple.com/programs/" rel="noopener ugc nofollow" target="_blank">苹果开发者账户</a>，用于生成<a class="ae lj" rel="noopener ugc nofollow" target="_blank" href="/apple-provisioning-profile-as-simple-as-possible-b2db0af94e5">预置描述文件</a>，以便将你的开发应用安装到真实设备上。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="2cc8" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">步骤1)通过登录Apple创建/更新预置描述文件</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mu"><img src="../Images/e1e94f0897203ac870f0453a95cc704b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hd1UckJuy_SyqMcOBA2eKw.png"/></div></div></figure><p id="26c6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">访问<a class="ae lj" href="https://developer.apple.com/" rel="noopener ugc nofollow" target="_blank">苹果开发者控制台</a>并创建一个带有苹果登录功能的应用标识符。</p><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mv"><img src="../Images/5df5cd9e5264ea6dac69c3e5e56cc3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Effzdc_fFTUfjo1kZ0CVkg.png"/></div></div></figure><p id="2f13" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">然后为您刚刚创建的应用程序实例生成一个配置文件。</p><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj mw"><img src="../Images/f1d196c9142e6292323dca8157e9b4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmZ0P2LX6i4BPlorrVT-8A.png"/></div></div></figure><p id="037b" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">将预置描述文件导入Xcode项目。</p><h1 id="809b" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">第2步)在Xcode项目中添加Apple登录</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj nc"><img src="../Images/c520da42ba918885f43367a9ad69e527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DDfxfNJ09ODiZeriUYo3zQ.png"/></div></div></figure><p id="3c90" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">点击目标标签上的“+功能”按钮，选择“登录苹果”功能。</p><blockquote class="nd ne nf"><p id="19b6" class="kc kd ng ke b kf kg kh ki kj kk kl km nh ko kp kq ni ks kt ku nj kw kx ky kz in bi translated">如果“使用Apple登录”功能未启用，运行时错误代码<code class="fe nk nl nm nn b">1000</code>将从认证服务框架返回到<code class="fe nk nl nm nn b">didCompleteWithError</code>回调。</p><p id="7728" class="kc kd ng ke b kf kg kh ki kj kk kl km nh ko kp kq ni ks kt ku nj kw kx ky kz in bi translated">要了解更多信息，请参考第5步中的“错误处理”部分。</p></blockquote><h1 id="f8a0" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">步骤3)添加一个ASAuthorizationAppleIDButton</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj no"><img src="../Images/230e0abc4ef81c2db23c05b8a5451e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcpHkmgLz9osn8yM-URDwA.png"/></div></div></figure><p id="6079" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">向您的<code class="fe nk nl nm nn b">UIViewController</code>添加一个<code class="fe nk nl nm nn b">UIButton</code>，并将类别类型分配给<code class="fe nk nl nm nn b">ASAuthorizationAppleIDButton</code>。</p><p id="20a8" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">用<code class="fe nk nl nm nn b">ASAuthorizationAppleIDButton</code>代替普通的<code class="fe nk nl nm nn b">UIButton</code>有什么好处？以下是一些要点:</p><ol class=""><li id="16e7" class="np nq iu ke b kf kg kj kk kn nr kr ns kv nt kz nu nv nw nx bi translated">苹果在使用苹果按钮登录时有严格的<a class="ae lj" href="https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/overview/buttons/" rel="noopener ugc nofollow" target="_blank">人机界面指南</a>，例如尺寸(最小140W x最小30H)、圆角半径和显示的按钮标题。为了保证苹果审查顺利，我们应该使用<code class="fe nk nl nm nn b">ASAuthorizationAppleIDButton</code>。</li><li id="8cc2" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><code class="fe nk nl nm nn b">AuthenticationServices</code>框架可以支持多种语言，并根据设备的语言环境改变按钮标题。它减轻了开发人员的工作量！</li></ol><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj od"><img src="../Images/262a910055e9da2c7b61e86b5ef6ee2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q_XfABXOF8DTwOg6OTTBQ.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated"><code class="fe nk nl nm nn b">ASAuthorizationAppleIDButton in different languages</code></figcaption></figure><p id="b267" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">3.<code class="fe nk nl nm nn b">ASAuthorizationAppleIDButton</code>支持明暗主题。开发人员可以通过编程初始化按钮来选择主题。</p><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/ed2280bcdbdedc59f4bb08f18aa4d278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Kby5KEwRJANdSoKZKMHIDw.png"/></div></figure><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><h1 id="f437" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">步骤4)创建一个ASAuthorizationRequest</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ol"><img src="../Images/44387f30992f2fa11919f2df852a5b49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_zl1HnJGVTAjho2gATettg.png"/></div></div></figure><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="gi gj om"><img src="../Images/6cf2731ad805ede3c8221dfb5882d523.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*HO4kec1FCQa1T2yqoLwnVw.png"/></div></figure><p id="0218" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们必须定义什么类型的用户信息是我们真正需要的。根据<code class="fe nk nl nm nn b">AuthenticationServices</code>的最新版本，开发者可以请求的字段只有两个:</p><ol class=""><li id="a822" class="np nq iu ke b kf kg kj kk kn nr kr ns kv nt kz nu nv nw nx bi translated">全名(名+姓)</li><li id="1331" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated">电子邮件地址(真实的电子邮件地址或苹果公司的代理电子邮件地址)</li></ol><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj on"><img src="../Images/e9b821d0d7ad3b2ccc3a438c74b305d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jNeS8q7FivzKZuFI.jpg"/></div></div></figure><p id="051e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">苹果为用户提供了一个选项，通过提供代理电子邮件地址，向应用程序所有者隐藏他/她的实际电子邮件地址。总的来说，苹果将是一个中间人，负责将应用程序所有者的电子邮件转发到应用程序用户的电子邮件地址。<a class="ae lj" href="https://help.apple.com/developer-account/?lang=en#/devf822fb8fc" rel="noopener ugc nofollow" target="_blank">在向客户发送电子邮件之前，额外的SMTP中继验证</a>必须通过苹果服务器进行配置。因此，即使app数据库被黑客入侵，如果没有正确的SMTP中继验证，黑客也无法向用户发送垃圾邮件。</p><h1 id="5fbb" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">步骤5实现ASAuthorizationControllerDelegate</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><h2 id="64e5" class="oo ls iu bd lt op oq dn lx or os dp mb kn ot ou mf kr ov ow mj kv ox oy mn oz bi translated">数据处理</h2><p id="93e2" class="pw-post-body-paragraph kc kd iu ke b kf pa kh ki kj pb kl km kn pc kp kq kr pd kt ku kv pe kx ky kz in bi translated"><code class="fe nk nl nm nn b">AuthenticationServices</code>可以在<code class="fe nk nl nm nn b">didCompleteWithAuthorization</code>回调时向app返回认证信息。信息打包在<code class="fe nk nl nm nn b">ASAuthorization</code>对象的<code class="fe nk nl nm nn b">credential</code>字段中。有一些重要的领域需要强调:</p><ol class=""><li id="5a1c" class="np nq iu ke b kf kg kj kk kn nr kr ns kv nt kz nu nv nw nx bi translated"><code class="fe nk nl nm nn b">user</code> —用户的<code class="fe nk nl nm nn b">String</code>标识符</li><li id="6737" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><code class="fe nk nl nm nn b">fullName</code>—<code class="fe nk nl nm nn b">PersonNameComponents</code>对象，由<code class="fe nk nl nm nn b">givenName</code>和<code class="fe nk nl nm nn b">familyName</code>字段组成</li><li id="9a80" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><code class="fe nk nl nm nn b">email</code> —用户的实际电子邮件地址或Apple代理电子邮件地址，格式为“ABC prefix @ privaterelay . Apple id . com”</li><li id="1877" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><code class="fe nk nl nm nn b">identityToken </code> —一个代表<a class="ae lj" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JSON Web令牌</a> (JWT)的<code class="fe nk nl nm nn b">Data</code>。你可以用在线工具解码令牌，比如<a class="ae lj" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT.io </a>。您可以在解码后的令牌中找到<code class="fe nk nl nm nn b">iss</code>(发行者)、<code class="fe nk nl nm nn b">aud</code>(包标识符)和<code class="fe nk nl nm nn b">email</code>字段。</li></ol><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pf"><img src="../Images/f7356fcfcf4d12a855d0eb7b05e47fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yW2c6mWo4PxNwgpUxncOFw.png"/></div></div></figure><h2 id="5fda" class="oo ls iu bd lt op oq dn lx or os dp mb kn ot ou mf kr ov ow mj kv ox oy mn oz bi translated">错误处理</h2><p id="d532" class="pw-post-body-paragraph kc kd iu ke b kf pa kh ki kj pb kl km kn pc kp kq kr pd kt ku kv pe kx ky kz in bi translated"><code class="fe nk nl nm nn b">didCompleteWithError</code>可能会抛出两个错误:</p><ol class=""><li id="14b7" class="np nq iu ke b kf kg kj kk kn nr kr ns kv nt kz nu nv nw nx bi translated"><strong class="ke iv">错误代码1000 </strong>你必须再次阅读步骤2)。</li><li id="2068" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><strong class="ke iv">错误代码1001</strong>T30】用户用Apple flow取消签到。</li></ol><h1 id="86f6" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">步骤6实现asauthorizationcontrollerpresentationcontextproving</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="553a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe nk nl nm nn b">presentationContextProvider</code>是一个委托，它提供了一个显示上下文，系统可以在其中向用户呈现一个授权界面。我们可以简单的返回当前<code class="fe nk nl nm nn b">UIViewController</code>截至<code class="fe nk nl nm nn b">ASPresentationAnchor</code>的<code class="fe nk nl nm nn b">window</code>。</p><h1 id="8ce9" class="lr ls iu bd lt lu mx lw lx ly my ma mb mc mz me mf mg na mi mj mk nb mm mn mo bi translated">提出请求</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="gi gj pg"><img src="../Images/bbb2a1777e30e145cee32c81148e9df2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*bAyxbiw3d6uZBgmIRyd0rA.png"/></div></figure><p id="b1a6" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">最后一步非常简单。我们只需要让<code class="fe nk nl nm nn b">ASAuthorizationController</code>实例向用户请求个人信息。</p><p id="30a2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您现在可以在步骤5)中引入的<code class="fe nk nl nm nn b">ASAuthorizationControllerDelegate</code>的<code class="fe nk nl nm nn b">didCompleteWithAuthorization</code>回调中处理用户信息。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="6c5c" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">发展实践技能</h1><h2 id="07fa" class="oo ls iu bd lt op oq dn lx or os dp mb kn ot ou mf kr ov ow mj kv ox oy mn oz bi translated">问题一:首次成功登录后无法选择选项</h2><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj ph"><img src="../Images/5574f091473970bf7291a3c2b2fc1f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3E2o4A7mKQoPpW2kGQVdpQ.png"/></div></div></figure><p id="db7c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为了测试你的代码，你可能会多次尝试通过“登录苹果”来登录。然而，<code class="fe nk nl nm nn b">ASAuthorizationController</code>的UI在首次成功登录后改变并隐藏了选择共享何种信息的选项。</p><p id="f974" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">为什么？这是因为苹果最伟大的UX理论——“尊重用户的选择”。一旦用户同意/拒绝了他/她的全名或电子邮件地址的请求，应用程序开发人员就不应该再问用户了！因此，用户只需要决定他/她这次是否想登录苹果😉。</p><h2 id="0108" class="oo ls iu bd lt op oq dn lx or os dp mb kn ot ou mf kr ov ow mj kv ox oy mn oz bi translated">问题二:全名和电子邮件地址都是零！！！首次成功登录后</h2><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/0371393bd2bb382288b9ee4d8d9c1260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*m9c5hTQoyG71L_lU1NoIMQ.png"/></div></figure><p id="80f9" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">您是否发现在返回的<code class="fe nk nl nm nn b">credential</code>中存储的信息在每次登录之间并不一致？🤔</p><p id="199e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在第二次尝试时，名字、姓氏和电子邮件地址都是<code class="fe nk nl nm nn b">nil</code>，即使用户已经将他/她的个人信息授权给应用程序。在<code class="fe nk nl nm nn b">ASAuthorizationControllerDelegate</code>的<code class="fe nk nl nm nn b">didCompleteWithAuthorization</code>回拨处看到上面的截图。</p><p id="378f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">是<code class="fe nk nl nm nn b">AuthenticationServices</code>框架的bug吗？不。实际上是计划好的！根据<a class="ae lj" href="https://developer.apple.com/forums/thread/121496#379297" rel="noopener ugc nofollow" target="_blank">苹果框架工程师在苹果开发者论坛上的回答</a>，用户信息仅在<strong class="ke iv">初始用户注册</strong>时在<code class="fe nk nl nm nn b">ASAuthorizationAppleIDCredential</code>发送，强烈建议应用开发者将用户凭证安全地存储在本地，直到在我们的服务器上成功创建帐户！</p><blockquote class="nd ne nf"><p id="564f" class="kc kd ng ke b kf kg kh ki kj kk kl km nh ko kp kq ni ks kt ku nj kw kx ky kz in bi translated">换句话说，一旦用户授予信息，应用程序开发人员就不能更新或添加额外的范围到<code class="fe nk nl nm nn b">requestedScopes</code>字段。在启动应用程序之前，我们应该记住这个问题。<br/>设置<code class="fe nk nl nm nn b">requestedScopes</code>见步骤4)</p></blockquote></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="6658" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">撤销Apple ID登录权限</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pi"><img src="../Images/83cd1ff62b9354324e2a9eceec1b7264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-qE7y0tqF0b1gAbYhjjdkA.png"/></div></div></figure><p id="25d2" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">在应用程序开发阶段，开发人员和质量保证测试人员必须多次登录苹果，以检查应用程序和服务器是否运行顺畅，即使用户没有授权某些信息。那么，我们如何在不更换不同iCloud账号的情况下，在同一台设备上进行多次测试呢？</p><p id="1c5e" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">我们可以导航到设置应用程序&gt;密码与安全&gt;使用Apple ID的应用程序&gt;[您的应用程序]&gt;单击“停止使用Apple ID”以撤销登录状态。</p><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pj"><img src="../Images/ae9ab8c12b1998cffde48b8088098530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8THZWKLSKqb0P0u9l0qjg.png"/></div></div><figcaption class="oe of gk gi gj og oh bd b be z dk translated"><a class="ae lj" href="https://appleid.apple.com/account/manage" rel="noopener ugc nofollow" target="_blank"> iCloud账户管理网站</a></figcaption></figure><p id="1bac" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">你也可以在<a class="ae lj" href="https://appleid.apple.com/account/manage" rel="noopener ugc nofollow" target="_blank"> iCloud账户管理网站</a>进行操作。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="0e71" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">当用户撤销身份验证时获得通知</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="77fe" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">一旦用户撤销了使用Apple权限登录，应用程序开发人员应该将此事件发送到服务器，并让后端开发人员决定是否适合暂时暂停甚至删除用户的帐户。</p><p id="3bbd" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated"><code class="fe nk nl nm nn b">AuthenticationServices</code>框架提供了一个<code class="fe nk nl nm nn b">ASAuthorizationAppleIDProvider.credentialRevokedNotification</code>，app只需通过<code class="fe nk nl nm nn b">NotificationCenter</code>就可以观察到。参见上面的代码。您可以通过在<a class="ae lj" href="https://appleid.apple.com/account/manage" rel="noopener ugc nofollow" target="_blank"> iCloud账户管理网站</a>撤销登录状态来测试该代码。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="fedb" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">获取登录状态</h1><figure class="mq mr ms mt gu jv"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="af2a" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">如果当用户撤销登录状态时，你的应用不在状态或不在前台，你将错过通知。Apple提供了另一个在运行时获取最新凭证状态的函数。当凭据状态不是“授权”时，我们可以采取额外的操作。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="ca56" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">如何向代理邮箱发送邮件？</h1><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gi gj pk"><img src="../Images/9ac577ba54f2c8211992575c54f8fcac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqGaNkuxUIENov9dkbL5Qg.png"/></div></div></figure><p id="e1ce" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">虽然这是一个普通的后台话题，但仍然值得在这里讨论。一旦用户不想与应用程序所有者共享他/她的实际电子邮件地址，就会创建一个代理电子邮件地址。它由苹果公司控制。为了与苹果服务器通信，需要首先在苹果开发者控制台<a class="ae lj" href="https://help.apple.com/developer-account/?lang=en#/devf822fb8fc" rel="noopener ugc nofollow" target="_blank">配置私人电子邮件中继服务</a>。这些过程包括注册域名和通信电子邮件。</p><p id="a081" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">如果您直接从您的个人电子邮件邮箱(如Gmail)向代理电子邮件地址发送电子邮件，您将会收到错误<code class="fe nk nl nm nn b">550 5.1.1 Relay not allowed</code>。错误截图见上。</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="d996" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">还有一件小事</h1><p id="c8fb" class="pw-post-body-paragraph kc kd iu ke b kf pa kh ki kj pb kl km kn pc kp kq kr pd kt ku kv pe kx ky kz in bi translated">iPhone上的<code class="fe nk nl nm nn b">ASAuthorizationController</code>只能<strong class="ke iv">支持</strong>的<strong class="ke iv">人像模式</strong>。用户必须切换回纵向模式，才能继续使用Apple flow登录。在我看来，如果它能支持横向模式就更好了，但我相信苹果是有意和明智的。😉</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="67dd" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">摘要</h1><p id="e8cf" class="pw-post-body-paragraph kc kd iu ke b kf pa kh ki kj pb kl km kn pc kp kq kr pd kt ku kv pe kx ky kz in bi translated">登录Apple是Apple为进一步保护用户隐私而提供的工具。用户可以选择向应用程序所有者公开自己的全名和真实电子邮件地址。苹果公司为那些想向他人隐藏自己真实电子邮件地址的用户生成了一个代理电子邮件地址。</p><p id="c63c" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">应用程序所有者必须在苹果开发者控制台设置SMTP配置并注册域名和其他细节，以便向用户的代理电子邮件地址发送电子邮件。</p><p id="a72f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">对于编码部分，主要关注<code class="fe nk nl nm nn b">ASAuthorizationController</code>，它可以向用户请求个人信息，并通过<code class="fe nk nl nm nn b">ASAuthorizationControllerDelegate</code>返回。我们必须记住，一旦用户之前授权了它，我们就不能更新了。我们必须在本地安全地保存用户凭证，直到在服务器端成功创建一个帐户！</p></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><h1 id="5c91" class="lr ls iu bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">参考</h1><ol class=""><li id="817a" class="np nq iu ke b kf pa kj pb kn pl kr pm kv pn kz nu nv nw nx bi translated"><a class="ae lj" href="https://help.apple.com/developer-account/?lang=en#/devf822fb8fc" rel="noopener ugc nofollow" target="_blank">配置私人邮件中继服务</a></li><li id="9518" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://developer.apple.com/forums/thread/121496#379297" rel="noopener ugc nofollow" target="_blank">苹果开发者论坛——在真实设备</a>上请求范围时无法获得电子邮件&amp;名称</li><li id="f661" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank"> JWT。IO </a></li><li id="48c6" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/overview/buttons/" rel="noopener ugc nofollow" target="_blank">关于使用苹果按钮登录的人机界面指南</a></li><li id="2ad9" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://developer.apple.com/documentation/authenticationservices" rel="noopener ugc nofollow" target="_blank">苹果认证服务框架</a></li></ol><div class="po pp gq gs pq pr"><a rel="noopener  ugc nofollow" target="_blank" href="/apple-provisioning-profile-as-simple-as-possible-b2db0af94e5"><div class="ps ab fp"><div class="pt ab pu cl cj pv"><h2 class="bd iv gz z fq pw fs ft px fv fx it bi translated">Apple预置描述文件尽可能简单</h2><div class="py l"><h3 class="bd b gz z fq pw fs ft px fv fx dk translated">供应简档可以被视为应用所有者、开发者和测试设备所有者之间的合同。看一看…</h3></div><div class="pz l"><p class="bd b dl z fq pw fs ft px fv fx dk translated">itnext.io</p></div></div><div class="qa l"><div class="qb l qc qd qe qa qf ka pr"/></div></div></a></div></div><div class="ab cl lk ll hy lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="in io ip iq ir"><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="ab gv cl qg"><img src="../Images/819888c798075632fded5f287224d60e.png" data-original-src="https://miro.medium.com/v2/format:webp/0*IqGVHisZbHGKTtWa.jpg"/></div></figure><figure class="mq mr ms mt gu jv gi gj paragraph-image"><div class="ab gv cl qg"><img src="../Images/6b4bd79a25c54205fcd408a05bced170.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eUdSsCq1iuPyBaFWAfLQxg.png"/></div></figure><p id="c70f" class="pw-post-body-paragraph kc kd iu ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz in bi translated">感谢您阅读这篇文章。希望你觉得有趣和有用！欢迎您关注我，并通过以下渠道与我联系:</p><ol class=""><li id="cf23" class="np nq iu ke b kf kg kj kk kn nr kr ns kv nt kz nu nv nw nx bi translated"><a class="ae lj" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ myrik _ chow</a></li><li id="fd69" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://www.youtube.com/channel/UC_UEqZPDms3rtX5W-m9hgxg" rel="noopener ugc nofollow" target="_blank">YouTube @ myrick show</a></li><li id="f39d" class="np nq iu ke b kf ny kj nz kn oa kr ob kv oc kz nu nv nw nx bi translated"><a class="ae lj" href="https://www.linkedin.com/in/myrick-chow-720b34118/" rel="noopener ugc nofollow" target="_blank">LinkedIn @ myrik Chow</a></li></ol></div></div>    
</body>
</html>