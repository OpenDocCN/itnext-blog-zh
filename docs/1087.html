<html>
<head>
<title>Deploy a basic Python application using Jenkins X &amp; Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jenkins X &amp; Kubernetes部署基本的Python应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-a-basic-python-application-using-jenkins-x-kubernetes-4adace2fe345?source=collection_archive---------2-----------------------#2018-07-19">https://itnext.io/deploy-a-basic-python-application-using-jenkins-x-kubernetes-4adace2fe345?source=collection_archive---------2-----------------------#2018-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e99f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Jenkins X是Kubernetes的CI / CD平台。Jenkins X为您提供了创建或导入应用程序、自动构建应用程序并将其部署到Kubernetes的可能性。每一次代码更改都会导致应用程序的一次新部署，由于钩子的存在，这一切都是自动进行的。当您对您的应用程序感到满意时，您可以使用CLI命令将应用程序提升到使用GitOps方法的不同环境中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/12efc2490d9f58a284e54d8536500c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*3bKDUGtRcSfUwnr3UaiH6w.png"/></div></figure><p id="8ef2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我将向您展示如何使用Jenkins X创建一个新的Kubernetes集群。不需要懂Python。主要目标是展示Jenkins X可以用于各种类型的应用程序。我们将在我们的分段环境中的pod中部署我们的应用程序。我们将提交、扩展pod的数量，并将我们的应用程序推广到我们的生产环境中。</p><p id="dbf8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kw">本教程在</em> <a class="ae kx" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">谷歌云上进行，谷歌云提供300美元免费信用</em> </a> <em class="kw">来开始使用任何GCP产品。</em></p><h1 id="a18d" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h1><ul class=""><li id="fdd3" class="lw lx it js b jt ly jx lz kb ma kf mb kj mc kn md me mf mg bi translated"><a class="ae kx" href="https://cloud.google.com/sdk/downloads" rel="noopener ugc nofollow" target="_blank">安装gcloud SDK </a></li><li id="fd01" class="lw lx it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">创建一个谷歌云帐户</li><li id="d949" class="lw lx it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">在控制台中链接计费帐户</li></ul><h1 id="931d" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用Jenkins X安装Kubernetes集群</h1><p id="fdc7" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">首先，我们将检查我们的包管理器(在我的例子中是<code class="fe mp mq mr ms b">brew</code>)是否是最新的。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="33b3" class="mx kz it ms b gy my mz l na nb">$ brew update</span></pre><p id="132b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在你的机器上安装<code class="fe mp mq mr ms b">jx</code>二进制文件。它是与Jenkins X一起工作的命令行工具。<a class="ae kx" href="https://jenkins-x.io/getting-started/install/" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到关于在Linux或不同平台上安装的细节。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="2c8b" class="mx kz it ms b gy my mz l na nb">$ brew tap jenkins-x/jx<br/>$ brew install jx<br/>$ jx --version<br/>  1.3.106</span></pre><p id="550f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在创建一个我们将要工作的GCP项目。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="ac16" class="mx kz it ms b gy my mz l na nb">$ <!-- -->gcloud projects create some-unique-id --name jenkins-x<br/>$ gcloud projects list<br/>PROJECT_ID          NAME       PROJECT_NUMBER<br/>xxxx-jenkins-x    jenkins-x    xxxxxxxx</span></pre><p id="9e37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要忘记将您的帐单帐户与此项目关联。这可以使用控制台来完成。还有一些<a class="ae kx" href="https://cloud.google.com/sdk/gcloud/reference/alpha/billing/accounts/projects/link" rel="noopener ugc nofollow" target="_blank"> alpha命令</a>可用。</p><p id="abff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe mp mq mr ms b">jx</code>创建一个默认的Kubernetes集群。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="d699" class="mx kz it ms b gy my mz l na nb">$ <!-- -->jx create cluster gke --skip-login --default-admin-password=xxx -n jenkins-x-kubernetes</span></pre><p id="eeb2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用箭头键配置您的集群。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/28fb5b7455dbf352d54f3dfea8adebb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zSUg06sv07mySs37l89UVA.png"/></div></div></figure><p id="0b0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是我对本教程的个人配置。</p><ul class=""><li id="57e7" class="lw lx it js b jt ju jx jy kb nh kf ni kj nj kn md me mf mg bi translated">谷歌云区:欧洲-西方1-b</li><li id="5775" class="lw lx it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">谷歌云机器类型:n1-标准-2</li><li id="d0ca" class="lw lx it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">最小节点数3</li><li id="9c8e" class="lw lx it js b jt mh jx mi kb mj kf mk kj ml kn md me mf mg bi translated">最大节点数4</li></ul><p id="c9be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建集群可能需要几分钟时间。它会要求我们的<a class="ae kx" href="https://www.github.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a>凭证。最后，我们还需要定义一个GitHub API令牌，我们可以在GitHub上创建它。进入“<em class="kw">设置- &gt;开发者设置- &gt;个人访问令牌</em>，生成新令牌。提供“<em class="kw">回购</em>”权限，点击生成:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nk"><img src="../Images/440a67abfd7b4ac9dba1da8811bea026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyXvbQArYLGQHCmur3Hibw.png"/></div></div></figure><p id="158b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们继续安装。我们还选择在kube-system名称空间中安装一个入口控制器。别忘了确认域名。同样，我们需要等待几分钟，以便我们的Kubernetes和Jenkins X组件可以被提取/创建。</p><p id="6e99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当一切都在运行时，你的浏览器会自动打开<a class="ae kx" href="http://jenkins.jx.35.205.153.90.nip.io" rel="noopener ugc nofollow" target="_blank">http://Jenkins . JX . xx . xx . xx . xx . nip . io</a>。耐心点。接下来是自动登录，您的Jenkins实例将自动配置。</p><p id="c1d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们的完整Jenkins X环境安装在Google云平台上的3节点Kubernetes集群上。安装还会创建两个库，并将它们推送到你的GitHub账户。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nl"><img src="../Images/d4ac604189079c29cd08ae589b01e84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XGEvnyYikAo-QqBJHdxB9g.png"/></div></div></figure><p id="434d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">存储库的README.md告诉我们:“<em class="kw">创建新的基于GitOps的环境时使用的默认git存储库</em>”。<a class="ae kx" href="https://www.weave.works/blog/gitops-operations-by-pull-request" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到更多关于GitOps的信息。简而言之，GitOps是一种声明性的方法，您的整个环境状态都存储在Git存储库中(应用程序、版本、环境配置等等)。这些存储库包含一个Jenkinsfile ( = Jenkins pipelines)，将在基于GitOps的部署中使用。</p><p id="c610" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是时候从CLI打开我们的Jenkins控制台了。切换到部署Jenkins的名称空间，并打开控制台。用命令行界面和箭头键玩一会儿。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="aa37" class="mx kz it ms b gy my mz l na nb">$ jx ns --&gt; now you can choose your namespace using the arrow keys<br/>$ jx ns jx --&gt; now you choose your namespace immediately<br/>Using namespace 'jx' from context named 'gke_xxx-jenkins-x_europe-west1-b_jenkins-x-kubernetes' on server '<a class="ae kx" href="https://35.187.58.234'" rel="noopener ugc nofollow" target="_blank">https://xx.xx.xx.xx'</a>.</span><span id="10f7" class="mx kz it ms b gy nm mz l na nb">$ jx console</span></pre><p id="3dc5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用我们在<code class="fe mp mq mr ms b">jx create cluster</code>命令中定义的密码作为用户“admin”登录。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nn"><img src="../Images/5f6c7253755fe75ead61cd6bc7ab40ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lt_UAhu8RP30MuprWTSjYA.png"/></div></div></figure><p id="ca42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些管道是从Jenkinsfiles创建的，这些文件存储在我们刚刚讨论过的两个git存储库中。这些管道是多分支管道，将在应用程序的升级和版本控制期间使用。多分支管道使您能够为同一项目的不同分支实现不同的Jenkinsfiles。</p><p id="b5c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在初始运行期间，会添加您的个人环境配置。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi no"><img src="../Images/f669143ba621e44d38778dd58e7e8e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7LY0sRWKBBmloPHVClDAA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">新的蓝海布局提供了一些关于管道中各阶段的清晰信息</figcaption></figure><p id="817c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当两条管道都正常时，您可以确信您的环境工作正常。现在，我们可以开始关注我们自己已经存在的python应用程序了。</p><h1 id="087b" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">运行基本Python应用程序</h1><p id="172d" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">我已经创建了一些非常基本的Dockerized Python应用程序，你需要从这个<a class="ae kx" href="https://github.com/lvthillo/python-flask-docker.git" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中派生出来。最后，它只是一个Docker容器，通过使用Python和Flask(一个小型微服务框架)打印其名称和IP。</p><p id="4784" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">分叉存储库很重要，因为Jenkins X将创建PR(Pull Requests)并合并它们。当然，你没有权限在我的存储库上这样做，这就是为什么你需要分叉它。</p><p id="057a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将首先测试基本的应用程序。克隆您的分叉库构建Docker映像并启动它。说明在<a class="ae kx" href="https://github.com/lvthillo/python-flask-docker/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a>中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nt"><img src="../Images/ceb619641123589066856826e5d1bb26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5F0yUNhMACI-e9b-qCyNg.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">该应用程序正在端口8080上运行(而不是Flask的默认端口5000)。这里的原因是用Jenkins X导入应用程序(见后面)会自动公开容器端口8080。在初始部署到端口5000后，可以对其进行编辑，但是我们希望执行最少的手动步骤。这就是我们在端口8080上运行应用程序的原因。</figcaption></figure><h1 id="01c9" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用Jenkins X将我们的基本Python应用程序作为管道导入</h1><p id="f180" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在我们将把我们的项目导入到Jenkins中。首先，我们需要在本地存储库中<code class="fe mp mq mr ms b">cd</code>(从fork克隆的)。现在执行<code class="fe mp mq mr ms b">jx import</code>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nu"><img src="../Images/f3d77d358b7bf19b5195b10a6e0f64be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oACbUyAlTBWGtgPPDMdCWg.png"/></div></div></figure><p id="2f57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还可以使用URL导入git项目。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="9c8b" class="mx kz it ms b gy my mz l na nb">$ jx import --url <a class="ae kx" href="https://github.com/lvthillo/python-flask-docker.git" rel="noopener ugc nofollow" target="_blank">https://github.com/your-user-name/python-flask-docker.git</a></span></pre><p id="a992" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行上面输出中返回的命令。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nv"><img src="../Images/dea2365a64d796a21be8b3fb53528034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrSjC2rZpwCTSHPtr4iCvQ.png"/></div></div></figure><p id="8ddb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查詹金斯控制台的管道。从克隆存储库、版本控制、创建Git标签、测试(如果有测试的话)和构建应用程序开始。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/eb62eedcfe4234b7f8f203001d8f26a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*P5uG9IyVljzFw67HebVeCw.png"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nx"><img src="../Images/2234197ed88f4d76b697083191ef881a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1GQHOw_MiY9D3ScP72Qig.png"/></div></div></figure><p id="310d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它正在构建Docker应用程序并将图像推送到Docker注册表。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ny"><img src="../Images/5682cc9bffdc23f74507b4da2eb9a8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSW9Wos7aanXMvsfOM4-iQ.png"/></div></div></figure><p id="4e5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在升级阶段，会在environment-Jenkins-x-kubernetes-staging存储库中创建一个PR (Pull Request)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nz"><img src="../Images/f777bd92a83f9334c36704604c620e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*090syoD8PQywrJydQtSuIw.png"/></div></div></figure><p id="e03b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个PR将把我们的应用程序及其版本添加到Git存储库中的<a class="ae kx" href="https://github.com/lvthillo/environment-jenkins-x-kubernetes-staging/pull/1/commits/ae807a64518c6ece2f1baf8dbd42954f23047219#diff-6c071f3cbcacdcc322bba55dbfbfcaee" rel="noopener ugc nofollow" target="_blank"> env/requirements.yaml </a>文件中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oa"><img src="../Images/b71b3d099c310fa052400d2b8808b41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeNPmBT4iqh11gKYV2G6zA.png"/></div></div></figure><p id="445a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在python-flask-docker管道的日志中:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ob"><img src="../Images/29e271b5aa7e8d5be5439b72ddf51efa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UQcrFpQB3Hbz-3ONHPXNSw.png"/></div></div></figure><p id="2bd3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以看到多分支环境——Jenkins-x-kubernettes——暂存管道为拉请求触发(分支PR-1)。它将检查PR并执行<code class="fe mp mq mr ms b">helm build</code>，在环境上执行测试以及代码审查和批准。当它成功时，它会将PR与master合并。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oc"><img src="../Images/6616de5fc09a1e822d48608023ca29a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Opz5SKdv6-qLhM_m4m6TeA.png"/></div></div></figure><p id="ee7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PR与主分支的合并将再次触发管道，但这次是从主分支。该流水线将检验主分支，并再次执行<code class="fe mp mq mr ms b">helm build</code>和<code class="fe mp mq mr ms b">helm apply</code>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi od"><img src="../Images/5fa42e7918a49f631f663e02854b60eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AI5yoz5h9IWpdyrOyZyVtA.png"/></div></div></figure><p id="98e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从主分支开始的这个环境-Jenkins-x-kubernetetes-staging管道将部署我们的pod。当它成功时，两个管道(environment-Jenkins-x-kubernettes-staging管道+我们的python-flask-docker管道管道)都成功退出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oe"><img src="../Images/222589c307ee8488424d30d5944e373c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PD8nTayMQWcDJLlo8VU0w.png"/></div></div></figure><p id="77f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在检查现有的应用程序。在这里，我们需要首先使用<code class="fe mp mq mr ms b">jx</code> CLI来访问我们的jx-staging名称空间。我们的pod正在这个名称空间中运行。<br/>从该名称空间获取应用程序</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="3f03" class="mx kz it ms b gy my mz l na nb">$ jx ns jx-staging<br/>$ jx get applications<br/># in short: jx get apps -n jx-staging</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi of"><img src="../Images/07d87edb00c4c6ec8f96a431ecdb5232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eRZ7vJMaHYVOmfmzSJD80A.png"/></div></div></figure><p id="950b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们甚至可以使用<code class="fe mp mq mr ms b">jx</code>来检查我们的日志。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi og"><img src="../Images/d58fcda004c374fb560502ac6775ac81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixBU0e79XyXLkldRbbPR_A.png"/></div></div></figure><p id="afb0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">访问URL以检查应用程序。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oh"><img src="../Images/5a0bb8d70d11b2fb477ecae83b3224a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EoqrBZuEOV6mi7zdUrnZwg.png"/></div></div></figure><p id="8d77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打印出pod及其主机名和IP。</p><p id="a330" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还可以在Kubernetes引擎控制台中查看我们的新应用程序(转到工作负载)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oi"><img src="../Images/b89aae66d91e6ab0e74bb8dc7b5c3519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_I9WUldUeTwU2APqGqkKdw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">我们的应用程序部署在jx-staging名称空间中</figcaption></figure><p id="7559" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，您还可以看到Jenkins X部署的其他组件，如Nexus、Heapster、Docker Registry等。</p><p id="e1ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们甚至可以检查我们的图像是否存在于Docker注册表中。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oj"><img src="../Images/e0e44e75cf284cca8d84e70440675b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vAAYdtnFm2zz0glAtIROOA.png"/></div></div></figure><p id="5ffb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们将更新我们的应用程序，看看会发生什么！</p><h1 id="fffd" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">重新部署和提升应用程序</h1><p id="3d53" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">我们知道Jenkins X在导入我们的应用程序时创建了一个GitHub web钩子。这意味着我们只需提交一个更改，我们的应用程序就会自动更新。</p><p id="5949" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们向应用程序的模板页面添加一点文本，并提交+推送到远程GitHub存储库。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ok"><img src="../Images/dbd5f0e66db709cfbf6a7f1298790530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LDeFca_jbIeqIUS7PJ-pw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">“就是这样！”已添加。</figcaption></figure><p id="c16f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">python-flask-docker管道管道自动启动。它将创建一个新的版本(0.0.2 ),在环境-Jenkins-x-kubernettes-staging pipeline(见上文)的帮助下，版本0.0.2将升级到我们的jx-staging环境。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ol"><img src="../Images/cf2e54e18c59543fd3fd5e688c25dc8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lU1YmMyfVXwV157nXfLnNA.png"/></div></div></figure><p id="2faa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">验证结果。一个新的pod与我们更新的应用程序一起部署。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi om"><img src="../Images/36681af0429f8ce80248d197fd0ca2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRH-6pEbv2sIhUzIuvHvmg.png"/></div></div></figure><p id="1334" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样我们也可以更新头盔的<code class="fe mp mq mr ms b">charts/python-flask-docker/values.yaml</code>来增加吊舱的数量。我们可以将复制计数设置为4。我们的管道将再次被触发，我们将在我们的暂存环境中部署版本0.0.3。</p><p id="f3ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记住标签是被创建的，我们也可以在GitHub中发布这些标签。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi on"><img src="../Images/f14dff83ecb9d25c141d8b9c5a6e02d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUEoCGuduLI-NZCP6Fj-hw.png"/></div></div></figure><p id="4ff4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署之后，我们可以<code class="fe mp mq mr ms b">curl</code>我们的应用程序。我们可以使用一些安装了<code class="fe mp mq mr ms b">curl </code>的docker镜像。</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="90f0" class="mx kz it ms b gy my mz l na nb">$ <!-- -->docker run --rm tutum/curl /bin/bash -c 'for i in $(seq 1 10); do curl -s <a class="ae kx" href="http://python-flask-docker.jx-staging.35.233.12.38.nip.io/" rel="noopener ugc nofollow" target="_blank">http://python-flask-docker.jx-staging.xx.xx.xx.xx.nip.io/</a> &amp;&amp; echo " "  ; done'</span></pre><p id="c4d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">短输出:</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="911d" class="mx kz it ms b gy my mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-nm678&lt;/b&gt; and its IP is &lt;b&gt;10.36.1.19&lt;/b&gt;. That's it!</span><span id="3962" class="mx kz it ms b gy nm mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-844r4&lt;/b&gt; and its IP is &lt;b&gt;10.36.1.20&lt;/b&gt;. That's it!</span><span id="2c03" class="mx kz it ms b gy nm mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-zmzb5&lt;/b&gt; and its IP is &lt;b&gt;10.36.0.16&lt;/b&gt;. That's it!</span><span id="8ad1" class="mx kz it ms b gy nm mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-7sj6v&lt;/b&gt; and its IP is &lt;b&gt;10.36.1.17&lt;/b&gt;. That's it!</span><span id="4e6c" class="mx kz it ms b gy nm mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-nm678&lt;/b&gt; and its IP is &lt;b&gt;10.36.1.19&lt;/b&gt;. That's it!</span><span id="1fac" class="mx kz it ms b gy nm mz l na nb">The hostname of the container is &lt;b&gt;jx-staging-python-flask-docker-6d64d66f96-844r4&lt;/b&gt; and its IP is &lt;b&gt;10.36.1.20&lt;/b&gt;. That's it!</span><span id="00f3" class="mx kz it ms b gy nm mz l na nb">...</span></pre><p id="eddb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们通过4个pod实现负载平衡，也可能通过不同的节点实现负载平衡。当我们满意时，我们可以将我们的应用程序推广到我们的生产环境中。</p><p id="f7d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">获取我们的应用程序名称:</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="a4ab" class="mx kz it ms b gy my mz l na nb">$ <!-- -->jx get app -n jx-staging<br/>APPLICATION         STAGING PODS URL<br/>python-flask-docker 0.0.3   4/4  <a class="ae kx" href="http://python-flask-docker.jx-staging.35.233.12.38.nip.io" rel="noopener ugc nofollow" target="_blank">http://python-flask-docker.jx-staging.xx.xx..xx.nip.io</a></span></pre><p id="4b19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将我们的应用程序推向生产。我们可以推广特定的版本。确保您仍然在git存储库中！</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="3a6c" class="mx kz it ms b gy my mz l na nb">$ <!-- -->jx promote python-flask-docker --version 0.0.3 --env production</span></pre><p id="c210" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建了一个新的PR，但这次是在我们的生产存储库中。环境-Jenkins-x-kubernetes-生产管道被触发。PR被测试和合并，现在相同的管道再次从由合并触发的主分支开始。它将执行<code class="fe mp mq mr ms b">helm apply</code>(部署)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi oo"><img src="../Images/371d09293ba788fb13271d49a4d5a021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3p0D2lcwM52As62jWAs7w.png"/></div></div></figure><p id="c45c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们在jx-production环境中检查应用程序并访问URL(它不再包含“<em class="kw"> staging </em>”)！).</p><pre class="kp kq kr ks gt mt ms mu mv aw mw bi"><span id="8952" class="mx kz it ms b gy my mz l na nb">jx get apps -n jx-production<br/>APPLICATION         PRODUCTION PODS URL<br/>python-flask-docker 0.0.3      4/4  <a class="ae kx" href="http://python-flask-docker.jx-production.35.233.12.38.nip.io" rel="noopener ugc nofollow" target="_blank">http://python-flask-docker.jx-production.xx.xx.xx.xx.nip.io</a></span></pre><p id="6432" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们现在正在生产中访问我们的应用程序。检查pod名称。由于我们的GitOps方法，还有4个pod在生产中运行。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi op"><img src="../Images/70cb5f4c0a056ccebe12d211d3fa3544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tavzx4BTjuaBdTOfYSiE4A.png"/></div></div></figure><h1 id="0407" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="99be" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">在这篇博客中，我们学习了如何使用<code class="fe mp mq mr ms b">jx</code>安装Kubernetes集群，以及如何导入任何类型的应用程序。我们看到了如何在几秒钟内创建完全自动化的部署管道。我们不必再关心钩子或者创建我们的应用程序环境。所有配置都存储在Git存储库中。由于基于GitOps的方法，在环境之间提升应用程序不再是瓶颈。</p><p id="d7e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢它，并了解Jenkins X的基本知识。当我有时间时，我会写第二篇关于Jenkins X的博客，更深入地关注它提供的所有其他不同的可能性。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><a href="https://www.buymeacoffee.com/dZb8fLN"><div class="gh gi oq"><img src="../Images/83dc7212ef8502659c81086ad58b8d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*bk_C8Um34KavCkO2yzMCZg.png"/></div></a><figcaption class="np nq gj gh gi nr ns bd b be z dk translated">如果真的对你有帮助…:)</figcaption></figure></div></div>    
</body>
</html>