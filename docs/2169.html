<html>
<head>
<title>Optimizing app monitoring process. Or how to fetch app logs from the server with one command.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化应用程序监控流程。或者如何用一个命令从服务器获取应用程序日志。</h1>
<blockquote>原文：<a href="https://itnext.io/optimizing-app-monitoring-process-or-how-to-fetch-app-logs-from-the-server-with-one-command-7fdf5d9a936?source=collection_archive---------5-----------------------#2019-04-10">https://itnext.io/optimizing-app-monitoring-process-or-how-to-fetch-app-logs-from-the-server-with-one-command-7fdf5d9a936?source=collection_archive---------5-----------------------#2019-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d598" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">这篇短文描述了我在优化开发过程中的经验。我将描述如何用一个命令将服务器日志提取到我的本地机器中。</h2></div><p id="4310" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我以前的文章中，我描述了一种自动化大多数远程服务器操作的方法。在本文中，我将描述shell脚本编程的一些额外的有用功能。如果你没有看到我之前的文章，请先看看这个<a class="ae lb" href="https://medium.com/@bagrijroman/how-to-auto-deploy-your-app-with-one-command-12f9ac00d34a" rel="noopener">链接</a>。</p><h1 id="7a22" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">初始任务</h1><p id="a53d" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">在当前的工作中，需要不时地监控服务器日志。正如你可能已经猜到的，这个问题可以用两种方法解决——普通的更简单的方法，和更有趣的自动化方法。</p><p id="2c83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种更简单的方法是通过ssh或ftp连接到服务器，并查看服务器日志进行分析。</p><p id="653b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其次，更有趣的自动化方法是准备shell脚本，它将在一个命令中完成大部分工作。这个想法是获取本地机器的日志并进行分析。这种日志处理方式将减少连接服务器和手动获取日志的时间。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/dfc9798884bf89a5ffa47543f6d3dcb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*JvEyTHmWWnts7pIg.png"/></div></figure><h1 id="cb69" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">我如何解决任务</h1><p id="4455" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我准备下一个算法来解决我的任务</p><ul class=""><li id="89e6" class="mh mi iq kh b ki kj kl km ko mj ks mk kw ml la mm mn mo mp bi translated">为服务器应用程序日志创建(如果之前未创建)本地文件夹</li><li id="6219" class="mh mi iq kh b ki mq kl mr ko ms ks mt kw mu la mm mn mo mp bi translated">通过网络将服务器日志文件夹复制到本地目标文件夹</li><li id="f8be" class="mh mi iq kh b ki mq kl mr ko ms ks mt kw mu la mm mn mo mp bi translated">使用操作时间戳重命名复制的文件夹</li></ul><p id="f5e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">经过这三个简单的步骤后，服务器日志副本将出现在我的本地计算机上，我可以用方便的方式分析它们，用任何UI编辑器而不是CLI编辑器。在我看来，在cli界面中读取数千行日志并不是最好的主意。</p><h1 id="d685" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">从理论到实践</h1><p id="223c" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">首先，我声明将在我的脚本中使用的变量。我更喜欢将值移动到变量中，因为这使我的脚本更加清晰和灵活。此外，在类似的情况下，只需更改变量声明块中的一些值，就可以重用它。</p><pre class="ma mb mc md gt mv mw mx my aw mz bi"><span id="0c55" class="na ld iq mw b gy nb nc l nd ne">DESTINATION_FOLDER='logs_dump'<br/>DUMP_FOLDER_NAME=`date +"%Y-%m-%d_%T"`<br/>SSH_KEY_PATH="./key.pem"<br/>SERVER="&lt;user&gt;@&lt;server_address&gt;"<br/>SERVER_PROJECT_FOLDER="&lt;project_folder_absolute_path&gt;"<br/>SERVER_LOGS_FOLDER="&lt;logs_folder_path&gt;"</span></pre><p id="5554" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">DESTINATION_FOLDER —本地计算机上将日志文件夹复制到的文件夹。</p><p id="8b36" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">转储文件夹名称—基于操作时间戳的复制日志文件夹的新名称。</p><p id="80a9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">SSH_KEY_PATH —权限密钥文件的路径。</p><p id="8d0c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">服务器—连接远程服务器的ssh地址。</p><p id="5251" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">SERVER_PROJECT_FOLDER —远程服务器上项目文件夹的路径。</p><p id="0356" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">SERVER_LOGS_FOLDER —基于项目文件夹路径的日志文件夹路径。在我的例子中，日志将存储在项目目录中的一个单独的文件夹中。</p><h2 id="576a" class="na ld iq bd le nf ng dn li nh ni dp lm ko nj nk lo ks nl nm lq kw nn no ls np bi translated">第二个动作</h2><p id="0ad9" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为日志创建(如果不存在)本地文件夹，并将目录更改为该文件夹。</p><pre class="ma mb mc md gt mv mw mx my aw mz bi"><span id="160d" class="na ld iq mw b gy nb nc l nd ne">mkdir -p "$DESTINATION_FOLDER"<br/>cd "$DESTINATION_FOLDER"</span></pre><h2 id="517b" class="na ld iq bd le nf ng dn li nh ni dp lm ko nj nk lo ks nl nm lq kw nn no ls np bi translated">第三个动作</h2><p id="2e4f" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">将日志文件夹从远程服务器复制到上一步创建的文件夹中</p><pre class="ma mb mc md gt mv mw mx my aw mz bi"><span id="27b4" class="na ld iq mw b gy nb nc l nd ne">scp -r -i $SSH_KEY_PATH $SERVER:$SERVER_PROJECT_FOLDER/$SERVER_LOGS_FOLDER ./</span></pre><p id="fd97" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">出于这些目的，我使用scp命令。它允许在两个目标点之间拷贝文件，如果其中一个是远程主机。例如，将文件或文件夹从本地机器复制到远程服务器或相反方向。</p><p id="3eab" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选项"-r "允许对整个目录进行递归复制。</p><p id="9eef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">选项“-i”选择标识(私钥)来自的文件。</p><h2 id="4629" class="na ld iq bd le nf ng dn li nh ni dp lm ko nj nk lo ks nl nm lq kw nn no ls np bi translated">第四项行动</h2><p id="0738" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">使用操作时间戳值重命名复制的日志文件夹。</p><pre class="ma mb mc md gt mv mw mx my aw mz bi"><span id="341f" class="na ld iq mw b gy nb nc l nd ne">mv $SERVER_LOGS_FOLDER $DUMP_FOLDER_NAME</span></pre><p id="f42c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">经过上述步骤，我的项目中的一个常规任务变得自动化。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/72c518056d0d53d519f9077738decd52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VDskHWlkmGIom7NR.jpg"/></div></div></figure><p id="b99a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">整个脚本代码:</p><pre class="ma mb mc md gt mv mw mx my aw mz bi"><span id="590d" class="na ld iq mw b gy nb nc l nd ne">#==================VARIABLES_SECTION=======================<br/>DESTINATION_FOLDER='logs_dump'<br/>DUMP_FOLDER_NAME=`date +"%Y-%m-%d_%T"`<br/>SSH_KEY_PATH="./key.pem"<br/>SERVER="&lt;user&gt;@&lt;server_address&gt;"<br/>SERVER_PROJECT_FOLDER="&lt;project_folder_absolute_path&gt;"<br/>SERVER_LOGS_FOLDER="&lt;logs_folder_path&gt;"<br/>#==========================================================<br/><br/>echo ======================================================<br/>echo Create sever logs dump...<br/>echo ======================================================<br/><br/>mkdir -p "$DESTINATION_FOLDER"<br/>cd "$DESTINATION_FOLDER"<br/><br/>echo Fetching server log files...<br/><br/>scp -r -i $SSH_KEY_PATH $SERVER:$SERVER_PROJECT_FOLDER/$SERVER_LOGS_FOLDER ./<br/>mv $SERVER_LOGS_FOLDER $DUMP_FOLDER_NAME<br/><br/>echo fetched...<br/>echo ======================================================<br/><br/>echo Dump folder $DESTINATION_FOLDER/$DUMP_FOLDER_NAME<br/>echo ======================================================</span></pre><h1 id="be31" class="lc ld iq bd le lf lg lh li lj lk ll lm jw ln jx lo jz lp ka lq kc lr kd ls lt bi translated">结论</h1><p id="5e17" class="pw-post-body-paragraph kf kg iq kh b ki lu jr kk kl lv ju kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">在这篇文章中，我以通过网络在本地和远程机器之间复制一些文件的方式描述了我的任务自动化的经验。这种能力有助于我发现服务器日志，但是如果需要的话，这种方法也可以用于任何其他需要通过网络复制文件的任务。</p><p id="f943" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果这篇文章对你有用，你可以在这里留下你的掌声(即使是50次),或者问我一个问题。</p></div></div>    
</body>
</html>