<html>
<head>
<title>How to create a multiple stack AWS CDK (Python) Infrastructure as Code (IaC) Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建多堆栈AWS CDK (Python)基础设施即代码(IaC)项目</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-create-a-multiple-stacks-aws-cdk-python-infrastructure-as-code-iac-project-e8a8defcd209?source=collection_archive---------3-----------------------#2021-06-24">https://itnext.io/how-to-create-a-multiple-stacks-aws-cdk-python-infrastructure-as-code-iac-project-e8a8defcd209?source=collection_archive---------3-----------------------#2021-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/162ebb769f83ffe13c5b5049a1bddc43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5YMnDmcJHAtj1Zqh1plkQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">AWS CDK</figcaption></figure><p id="840f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这篇文章是关于创建一个多栈AWS CDK IaC项目。我将使用Python，因为我对它更熟悉，但是如果你对另一种语言很熟悉，也可以使用Typescript、Javascript、Java或C#</p><p id="b4aa" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我还创建了一个简单的lambda应用程序和一个简单的容器化应用程序，它们将使用这个基础设施。这些应用程序都有用Github操作创建的简单CICD。</p><p id="c538" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">为什么在AWS CDK中需要多个堆栈？</strong></p><p id="958b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们想象一下，您需要将相同的应用程序部署到不同的区域，采用不同的配置，或者您有一个大型基础架构，并且希望将每个应用程序/服务堆栈分开，保留在自己的定义文件中，以便多个开发人员或团队可以在没有冲突的情况下一起工作。或者您有不同的环境开发、测试、生产前、生产等。多个堆栈使管理这种类型的基础架构变得容易。</p><h1 id="5072" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">无服务器应用:</strong></h1><p id="0478" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">将数据从CSV文件导入DynamoDB，然后上传到S3存储桶。AWS Lambda将在新文件上传时自动触发。</p><p id="444c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="mg"> Github库:</em><em class="mg"/><a class="ae mh" href="https://github.com/omerkarabacak/serverless-csv-to-dynamodb" rel="noopener ugc nofollow" target="_blank">https://github.com/omerkarabacak/serverless-csv-to-dynamodb</a></p><p id="bf25" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">基础设施</strong> : S3 + Lambda + DynamoDB</p><p id="cb55" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae mh" href="https://github.com/omerkarabacak/multi-stack-aws-cdk-python-iac-project/blob/main/lambda_stack/lambda_stack.py" rel="noopener ugc nofollow" target="_blank">https://github . com/omerkarabacak/multi-stack-AWS-CDK-python-IAC-project/blob/main/lambda _ stack/lambda _ stack . py</a></p><h1 id="7b70" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated"><strong class="ak">集装箱化应用:</strong></h1><p id="c895" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">应用程序将简单地计算一个给定数字的阶乘并返回结果。我使用Python Flask，只是为了创建一个简单的容器化应用程序。</p><p id="5a9a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> <em class="mg"> Github资源库:</em></strong><em class="mg"/><a class="ae mh" href="https://github.com/omerkarabacak/containerised-python-flask-app" rel="noopener ugc nofollow" target="_blank">https://Github . com/omerkarabacak/container ised-python-flask-app</a></p><p id="72d7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">基础设施:ECR + ECS + ELB</p><p id="c694" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae mh" href="https://github.com/omerkarabacak/multi-stack-aws-cdk-python-iac-project/blob/main/container_stack/container_stack.py" rel="noopener ugc nofollow" target="_blank">https://github . com/omerkarabacak/multi-stack-AWS-CDK-python-IAC-project/blob/main/container _ stack/container _ stack . py</a></p><h1 id="1d12" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">基础设施代码项目:</h1><p id="2ec1" class="pw-post-body-paragraph kf kg it kh b ki mb kk kl km mc ko kp kq md ks kt ku me kw kx ky mf la lb lc im bi translated">这个项目有两个不同的堆栈，一个用于无服务器应用程序，另一个用于容器化应用程序。</p><h1 id="a066" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">如何运行这个AWS CDK项目</h1><h2 id="ef87" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">安装CDK CLI工具(如果尚未安装，请安装)</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="8316" class="mi le it mz b gy nd ne l nf ng">npm install -g aws-cdk</span></pre><h2 id="7d55" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">如何为Python创建虚拟环境并安装依赖项</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="a0ed" class="mi le it mz b gy nd ne l nf ng">python3 -m venv .venv<br/>source .venv/bin/activate<br/>pip install -r requirements.txt</span></pre><h2 id="b849" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">如何运行测试</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="1e63" class="mi le it mz b gy nd ne l nf ng">pytest</span></pre><h2 id="e689" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">显示堆栈</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="e1a5" class="mi le it mz b gy nd ne l nf ng">cdk ls</span></pre><h2 id="11c5" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">如何部署选定的堆栈</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2d8b" class="mi le it mz b gy nd ne l nf ng">cdk deploy lambda-stack --profile &lt;AWS_PROFILE_NAME&gt;</span></pre><h2 id="4daa" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">如何部署所有堆栈</h2><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="faa5" class="mi le it mz b gy nd ne l nf ng">cdk deploy --all --profile &lt;AWS_PROFILE_NAME&gt;</span></pre><h2 id="165a" class="mi le it bd lf mj mk dn lj ml mm dp ln kq mn mo lr ku mp mq lv ky mr ms lz mt bi translated">有用的命令</h2><ul class=""><li id="8ba6" class="nh ni it kh b ki mb km mc kq nj ku nk ky nl lc nm nn no np bi translated"><code class="fe nq nr ns mz b">cdk ls</code>列出应用程序中的所有堆栈</li><li id="e09e" class="nh ni it kh b ki nt km nu kq nv ku nw ky nx lc nm nn no np bi translated"><code class="fe nq nr ns mz b">cdk synth</code>发出合成的云生成模板</li><li id="78ab" class="nh ni it kh b ki nt km nu kq nv ku nw ky nx lc nm nn no np bi translated"><code class="fe nq nr ns mz b">cdk deploy</code>将此堆栈部署到您的默认AWS帐户/地区</li><li id="89c3" class="nh ni it kh b ki nt km nu kq nv ku nw ky nx lc nm nn no np bi translated"><code class="fe nq nr ns mz b">cdk diff</code>将部署的堆栈与当前状态进行比较</li><li id="423e" class="nh ni it kh b ki nt km nu kq nv ku nw ky nx lc nm nn no np bi translated"><code class="fe nq nr ns mz b">cdk docs</code>打开CDK文档</li></ul><p id="1717" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu"> <em class="mg"> Github资源库:</em></strong><a class="ae mh" href="https://github.com/omerkarabacak/multi-stack-aws-cdk-python-iac-project" rel="noopener ugc nofollow" target="_blank">https://Github . com/omerkarabacak/multi-stack-AWS-CDK-python-IAC-project</a></p><p id="f2cf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你喜欢这篇文章，我想你会想看看我的另一篇也与这个话题相关的文章:</p><p id="0051" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae mh" rel="noopener ugc nofollow" target="_blank" href="/aws-eks-101-creating-a-cluster-and-deploying-an-app-9608a1cac016"> AWS EKS 101:创建集群和部署应用| mer KARABACAK | 2022年12月| ITNEXT </a></p><p id="8f73" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">支持媒介和我:)</strong><a class="ae mh" href="https://omerkarabacak.medium.com/membership" rel="noopener">https://omerkarabacak.medium.com/membership</a></p></div></div>    
</body>
</html>