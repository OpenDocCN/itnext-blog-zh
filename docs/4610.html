<html>
<head>
<title>BLE and GATT for IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">BLE与关贸总协定的物联网</h1>
<blockquote>原文：<a href="https://itnext.io/ble-and-gatt-for-iot-2ae658baafd5?source=collection_archive---------1-----------------------#2020-08-04">https://itnext.io/ble-and-gatt-for-iot-2ae658baafd5?source=collection_archive---------1-----------------------#2020-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0cad" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">物联网蓝牙低能耗(BLE)和通用属性配置文件(GATT)规范入门</h2></div><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="kn ko l"/></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">帖子的音频版本</figcaption></figure><h1 id="08b3" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">介绍</h1><p id="8f41" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据维基百科，<a class="ae mh" href="https://en.wikipedia.org/wiki/Bluetooth" rel="noopener ugc nofollow" target="_blank">蓝牙</a>是一种无线技术标准，用于在固定和移动设备之间短距离交换数据。<a class="ae mh" href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy" rel="noopener ugc nofollow" target="_blank">蓝牙低能耗</a>(蓝牙LE或BLE)是由<a class="ae mh" href="https://www.bluetooth.com/" rel="noopener ugc nofollow" target="_blank">蓝牙特别兴趣小组</a>(蓝牙SIG)设计并推向市场的<a class="ae mh" href="https://en.wikipedia.org/wiki/Personal_area_network" rel="noopener ugc nofollow" target="_blank">无线个人区域网</a> (WPAN)技术。根据<a class="ae mh" href="https://www.bluetooth.com/learn-about-bluetooth/bluetooth-technology/radio-versions/" rel="noopener ugc nofollow" target="_blank">蓝牙SIG </a>，BLE是为极低功耗操作而设计的。BLE支持从125 Kb/s到2 Mb/s的数据速率，具有从1毫瓦(mW)到100 mW的多种功率级别。几个关键因素会影响可靠蓝牙连接的有效范围，从一公里到不到一米不等。新一代蓝牙5理论上比蓝牙4.2提供了4倍的范围改进，从大约200英尺(60米)到800英尺(240米)。</p><p id="a8c4" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">维基百科目前列出了蓝牙SIG定义和采用的蓝牙规范的36个<a class="ae mh" href="https://en.wikipedia.org/wiki/List_of_Bluetooth_profiles" rel="noopener ugc nofollow" target="_blank">定义</a>，包括<a class="ae mh" href="https://www.bluetooth.com/specifications/gatt/" rel="noopener ugc nofollow" target="_blank">通用属性规范(GATT)规范</a>。根据蓝牙SIG，GATT建立在<a class="ae mh" href="http://lpccs-docs.dialog-semiconductor.com/tutorial-custom-profile-DA145xx/att.html#" rel="noopener ugc nofollow" target="_blank">属性协议(ATT) </a>之上，为ATT传输和存储的数据建立通用操作和框架。GATT为BLE协议提供配置文件发现和描述服务。它定义了如何将ATT属性分组到集合中以形成服务。</p><p id="701c" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">鉴于其低能耗和完善的配置文件，如GATT，与竞争协议如<a class="ae mh" href="https://zigbeealliance.org/" rel="noopener ugc nofollow" target="_blank"> ZigBee </a>、<a class="ae mh" href="https://en.wikipedia.org/wiki/Bluetooth" rel="noopener ugc nofollow" target="_blank">蓝牙classic </a>和<a class="ae mh" href="https://en.wikipedia.org/wiki/Wi-Fi" rel="noopener ugc nofollow" target="_blank"> Wi-Fi </a>相比，BLE是用于<a class="ae mh" href="https://en.wikipedia.org/wiki/Internet_of_things" rel="noopener ugc nofollow" target="_blank">物联网</a>(物联网)设备的理想短程无线协议。在本帖中，我们将探讨如何使用BLE和GATT规范将环境传感器数据从物联网传感器传输到物联网网关。</p><h2 id="ecc7" class="mn ku it bd kv mo mp dn kz mq mr dp ld lu ms mt lf ly mu mv lh mc mw mx lj my bi translated">物联网传感器</h2><p id="7896" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在本文中，我们将使用Arduino单板微控制器作为物联网传感器，实际上是一个传感器阵列。2019年8月发布的3.3V支持人工智能的<a class="ae mh" href="https://store.arduino.cc/usa/nano-33-ble-sense-with-headers" rel="noopener ugc nofollow" target="_blank"> Arduino Nano 33 BLE感应</a>板，配备了Nordic Semiconductors的强大<a class="ae mh" href="https://www.nordicsemi.com/Products/Low-power-short-range-wireless/nRF52840" rel="noopener ugc nofollow" target="_blank"> nRF52840 </a>处理器，一个运行频率为64 MHz的32位ARM Cortex-M4 CPU，1MB的CPU闪存，256KB的SRAM，以及一个<a class="ae mh" href="https://www.u-blox.com/en/product/nina-b3-series-open-cpu" rel="noopener ugc nofollow" target="_blank"> NINA-B306 </a>独立蓝牙5低能耗模块。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mz"><img src="../Images/aeeb2a072f3866a5a2f74d0cfcdc2ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B0uU3dH2K_WW9hdFwHANkw.jpeg"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">试验板上的Arduino Nano 33 BLE传感器(带接头)</figcaption></figure><p id="7f4b" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">Sense还包含一系列令人印象深刻的嵌入式传感器:</p><ul class=""><li id="9c95" class="ng nh it ln b lo mi lr mj lu ni ly nj mc nk mg nl nm nn no bi translated">9轴惯性传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lsm9ds1.pdf" rel="noopener ugc nofollow" target="_blank"> LSM9DS1 </a> ): 3D数字线加速度传感器、3D数字<br/>角速度传感器、3D数字磁传感器</li><li id="adff" class="ng nh it ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated">湿度和温度传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_HTS221.pdf" rel="noopener ugc nofollow" target="_blank"> HTS221 </a>):电容式数字相对湿度和温度传感器</li><li id="3b3a" class="ng nh it ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated">气压传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_lps22hb.pdf" rel="noopener ugc nofollow" target="_blank"> LPS22HB </a> ): MEMS纳米压力传感器:260–1260百帕(hPa)绝对数字输出气压计</li><li id="ba77" class="ng nh it ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated">麦克风(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_mp34dt05-a.pdf" rel="noopener ugc nofollow" target="_blank"> MP34DT05 </a> ): MEMS音频传感器全向数字麦克风</li><li id="cc0c" class="ng nh it ln b lo np lr nq lu nr ly ns mc nt mg nl nm nn no bi translated">手势、接近度、光色和光强传感器(<a class="ae mh" href="https://content.arduino.cc/assets/Nano_BLE_Sense_av02-4191en_ds_apds-9960.pdf" rel="noopener ugc nofollow" target="_blank"> APDS9960 </a>):高级手势检测、接近度检测、数字环境光感测(ALS)和颜色感测(RGBC)。</li></ul><p id="161f" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">Sense是一款出色的<a class="ae mh" href="https://www.amazon.com/Arduino-Nano-Sense-headers-Mounted/dp/B07WXKDVTL" rel="noopener ugc nofollow" target="_blank">低成本</a>单板微控制器，用于学习收集和传输物联网传感器数据。</p><h2 id="9c90" class="mn ku it bd kv mo mp dn kz mq mr dp ld lu ms mt lf ly mu mv lh mc mw mx lj my bi translated">物联网网关</h2><p id="de29" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">根据<a class="ae mh" href="https://whatis.techtarget.com/definition/IoT-gateway" rel="noopener ugc nofollow" target="_blank"> TechTarget </a>的说法，物联网网关是一种物理设备或软件程序，充当云与控制器、传感器和智能设备之间的连接点。所有移动到云的数据都要经过网关，反之亦然，网关可以是专用的硬件设备或软件程序。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi nu"><img src="../Images/66e4bff21e6229880a89f8f6cc78191b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZDQlUns3tmomYMSPzWAMA.png"/></div></div></figure><p id="fda1" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">在本帖中，我们将使用最新一代的<a class="ae mh" href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 3 Model B+ </a>单板计算机(SBC)，作为物联网网关。这款Raspberry Pi型号具有1.4GHz Cortex-A53 (ARMv8) 64位四核处理器片上系统(SoC)、1GB LPDDR2 SDRAM、双频无线局域网、蓝牙4.2 BLE和千兆以太网。</p><p id="3052" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated"><em class="nv">按照本文，您可以用Raspberry Pi替代任何基于Linux的机器来运行包含的示例Python脚本。</em></p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi mz"><img src="../Images/928586a1a13c28897c4453d959edc5b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0GRsxsLcm9BvTiZ3dAV7vQ.jpeg"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk translated">树莓Pi 3型号B+</figcaption></figure><p id="18cc" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">Arduino将通过BLE向Raspberry Pi传输物联网传感器遥测数据。Raspberry Pi使用Wi-Fi或以太网，能够安全地将传感器遥测数据传输到云端。在蓝牙<a class="ae mh" href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gap" rel="noopener ugc nofollow" target="_blank">术语</a>中，蓝牙外围设备(<em class="nv">又名</em> GATT服务器)，也就是Arduino，会将数据传输到蓝牙中央设备(<em class="nv">又名</em> GATT客户端)，也就是树莓派。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/4f43f14b0ba29fe5188ce30cc77fb82b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*b-KrLeZ2eJKR3RbF3Eq0WQ.png"/></div></figure><h2 id="c2bf" class="mn ku it bd kv mo mp dn kz mq mr dp ld lu ms mt lf ly mu mv lh mc mw mx lj my bi translated">Arduino草图</h2><p id="cfbf" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">对于那些不熟悉Arduino的人来说，一个<a class="ae mh" href="https://www.arduino.cc/en/tutorial/sketch" rel="noopener ugc nofollow" target="_blank">草图</a>是Arduino为一个程序使用的名字。它是上传到非易失性闪存并在Arduino板上运行的代码单元。Arduino语言是一组C/C++函数。avr-g++ 编译器支持的所有标准C和C++结构都应该可以在Arduino中工作。</p><p id="adec" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">对于本文，草图<a class="ae mh" href="https://github.com/garystafford/iot-ble-demo/blob/master/combo_sensor_ble/combo_sensor_ble.ino" rel="noopener ugc nofollow" target="_blank"> combo_sensor_ble.ino </a>包含了收集环境传感器遥测数据所需的所有代码，包括温度、相对湿度、大气压力、环境光和RGB颜色。这篇文章的所有代码，包括草图，都可以在<a class="ae mh" href="https://github.com/garystafford/iot-ble-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nx ko l"/></div></figure><p id="ee5e" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">传感器遥测将由Sense在BLE宣传为具有多种GATT特征的<a class="ae mh" href="https://www.bluetooth.com/specifications/gatt/characteristics/" rel="noopener ugc nofollow" target="_blank"> GATT环境传感服务</a> (GATT指定编号<a class="ae mh" href="https://www.bluetooth.com/specifications/assigned-numbers/environmental-sensing-service-characteristics/" rel="noopener ugc nofollow" target="_blank"> 0x181A </a>)。每个特性代表一个传感器读数，并包含最新的传感器值，例如温度(<a class="ae mh" href="https://www.bluetooth.com/xml-viewer/?src=https://www.bluetooth.com/wp-content/uploads/Sitecore-Media-Library/Gatt/Xml/Characteristics/org.bluetooth.characteristic.temperature.xml" rel="noopener ugc nofollow" target="_blank"> 0x2A6E </a>)或湿度(<a class="ae mh" href="https://www.bluetooth.com/xml-viewer/?src=https://www.bluetooth.com/wp-content/uploads/Sitecore-Media-Library/Gatt/Xml/Characteristics/org.bluetooth.characteristic.humidity.xml" rel="noopener ugc nofollow" target="_blank"> 0x2A6F </a>)。</p><p id="91ed" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">每个GATT特性都定义了数据应该如何表示。为了准确地表示数据，需要修改传感器读数。例如，使用<a class="ae mh" href="https://www.arduino.cc/en/Reference/ArduinoHTS221" rel="noopener ugc nofollow" target="_blank"> ArduinoHTS221库</a>，以两位小数精度捕捉温度(如22.21°C)。然而，温度GATT特性(0x2A6E)需要一个带符号的16位值(-32，768–32，767)。为了保持精度，将捕获的值(例如，22.21°C)乘以100以将其转换为整数(例如，2221)。然后，Raspberry Pi将以正确的精度将该值转换回原始值。</p><p id="dc26" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">GATT规范没有表示环境光和RGB颜色的当前预定义特征。因此，我为颜色值创建了一个自定义特征，并为其分配了一个通用的唯一标识符(UUID)。</p><p id="8b8e" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">根据文档，环境光和RGB颜色被捕获为16位值(范围为0–65，535)。然而，使用<a class="ae mh" href="https://www.arduino.cc/en/Reference/ArduinoAPDS9960" rel="noopener ugc nofollow" target="_blank"> ArduinoAPDS9960库</a>，我发现读数的范围在0–4097之间。不用深入杂草，最大计数(或饱和度)值是可变的。它可以基于积分时间和计数寄存器的大小(例如，16位)来计算。在库文件Arduino_APDS9960.cpp中，ADC积分时间似乎设置为10 ms。</p><p id="ce2c" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">RGB值通常表示为<a class="ae mh" href="https://en.wikipedia.org/wiki/8-bit_color" rel="noopener ugc nofollow" target="_blank"> 8位颜色</a>。我们可以在发送之前将值转换为8位，或者稍后在Raspberry Pi物联网网关上处理它。为了演示数据传输效率，草图将12位值连接成一个字符串(例如，<code class="fe ny nz oa ob b">4097,2811,1500,4097</code>)。该字符串将在树莓Pi上从12位转换为8位(如<code class="fe ny nz oa ob b">255,175,93,255</code>)。</p><h2 id="00ff" class="mn ku it bd kv mo mp dn kz mq mr dp ld lu ms mt lf ly mu mv lh mc mw mx lj my bi translated">预览和调试BLE设备服务</h2><p id="3ee1" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在查看运行在Raspberry Pi上的代码之前，我们可以使用任意数量的移动应用程序来预览和调试运行在Arduino上并在BLE广告的环境感知服务。一个普遍推荐的应用程序是Nordic Semiconductor的<a class="ae mh" href="https://www.nordicsemi.com/Software-and-tools/Development-Tools/nRF-Connect-for-mobile" rel="noopener ugc nofollow" target="_blank"> nRF Connect for Mobile </a>，可在<a class="ae mh" href="https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp&amp;hl=en_US" rel="noopener ugc nofollow" target="_blank"> Google Play </a>上获得。我发现Android版本在正确解释和显示GATT特征值方面比iOS版本更好。</p><p id="63d8" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">下面，我们看到一个扫描我的本地附近的BLE设备广告，使用nRF连接移动应用程序的Android版本。请注意BLE设备ArduinoNano33BLESense(用红色表示)。另外，请注意BLE设备的媒体访问控制地址(MAC地址)，在我的例子中是<code class="fe ny nz oa ob b">d1:aa:89:0c:ee:82</code>。物联网网关稍后将需要MAC地址。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi oc"><img src="../Images/72175612cf2b4d3665962d96f67c40ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p6ygcTDjv7rL9r7nZFeNRA.png"/></div></div></figure><p id="fe63" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">连接到设备，我们看到三个服务。环境传感服务(以红色表示)包含传感器读数。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi oc"><img src="../Images/323df20d5b349dbccb111f0426173797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T9SZnX_ftkp2wsWn-SKr0w.png"/></div></div></figure><p id="1cbb" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">深入到环境感知服务(0x181A)，我们看到四个预期特征:温度(0x2A6E)、湿度(0x2A6F)、压力(0x2A6D)和未知特征(936 b6a 25-e503–4f7c-9349-bcc 76 c 22 b 8 c 3)。由于nRF Connect无法将颜色传感器读数识别为注册的GATT特性(没有GATT分配的编号)，因此它显示为未知特性。尽管温度、湿度和压力值(以红色表示)被正确解释和显示，但颜色传感器读数仍为原始十六进制文本(例如，<code class="fe ny nz oa ob b">30-2c-30-2c-30-2c-30-00</code>或<code class="fe ny nz oa ob b">0,0,0,0</code>)。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi oc"><img src="../Images/a83c844b3fb31e8925e1489a3dcc37a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Asv60s5cyOICSUiIym0Q0Q.png"/></div></div></figure><p id="34d1" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">这些结果表明一切都在按预期运行。</p><h2 id="8c84" class="mn ku it bd kv mo mp dn kz mq mr dp ld lu ms mt lf ly mu mv lh mc mw mx lj my bi translated">BLE客户端Python代码</h2><p id="6a49" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">作为BLE客户端(也称为中央设备)，Raspberry Pi运行一个Python脚本。脚本<a class="ae mh" href="https://github.com/garystafford/iot-ble-demo/blob/master/rasppi_ble_receiver.py" rel="noopener ugc nofollow" target="_blank"> rasppi_ble_receiver.py </a>使用<a class="ae mh" href="https://github.com/IanHarvey/bluepy" rel="noopener ugc nofollow" target="_blank"> bluepy </a> Python模块通过Linux上的<a class="ae mh" href="http://www.bluez.org/" rel="noopener ugc nofollow" target="_blank"> Bluez </a>与ble设备接口。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="nx ko l"/></div></figure><p id="a932" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">要运行Python脚本，请执行以下命令，将MAC地址参数替换为您自己的BLE设备通告的MAC地址。</p><pre class="ki kj kk kl gt od ob oe of aw og bi"><span id="bfb4" class="mn ku it ob b gy oh oi l oj ok">python3 ./rasppi_ble_receiver.py d1:aa:89:0c:ee:82</span></pre><p id="e2eb" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">与nRF Connect应用程序不同，bluepy Python模块无法正确解释和显示GATT特征值。因此，该脚本从Arduino获取原始的十六进制文本，并将其转换为正确的值。例如，温度读数必须从字节<code class="fe ny nz oa ob b">b'\xb8\x08\x00\x00'</code>转换为字节数组<code class="fe ny nz oa ob b">bytearray(b'\xb8\x08\x00\x00')</code>，然后转换为整数<code class="fe ny nz oa ob b">2232</code>，再转换为小数<code class="fe ny nz oa ob b">22.32</code>，最后转换为华氏温标<code class="fe ny nz oa ob b">72.18°F</code>。</p><p id="c300" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">每两秒钟从BLE设备中检索一次传感器读数。除了显示数字传感器读数，Python脚本还使用<a class="ae mh" href="https://pypi.org/project/Colr/" rel="noopener ugc nofollow" target="_blank"> colr </a> Python模块显示8位RGB颜色的颜色样本，以及表示光强度的灰度样本。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div role="button" tabindex="0" class="na nb di nc bf nd"><div class="gh gi ol"><img src="../Images/2a39978094b5d8b8b22fa6b13008ba23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lx6iRpfpX8MnG_PUclkZJw.png"/></div></div></figure><p id="0e49" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">以下屏幕记录显示了Arduino串行监视器和Raspberry Pi终端输出的并行视图。当Python脚本启动时，Raspberry Pi(中央设备)连接到Arduino(外围设备)。Raspberry Pi成功读取并解释来自环境传感服务的遥测数据。</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="om ko l"/></div></figure><h1 id="a667" class="kt ku it bd kv kw kx ky kz la lb lc ld jz le ka lf kc lg kd lh kf li kg lj lk bi translated">结论</h1><p id="b256" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated">在本文中，我们探讨了如何使用BLE和GATT规范将环境传感器数据从外围设备传输到中央设备。鉴于其低能耗和完善的配置文件，如GATT，蓝牙低能耗(BLE)是物联网设备的理想短程无线协议。</p></div><div class="ab cl on oo hx op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="im in io ip iq"><p id="0cdf" class="pw-post-body-paragraph ll lm it ln b lo mi ju lq lr mj jx lt lu mk lw lx ly ml ma mb mc mm me mf mg im bi translated">这篇博客代表我自己的观点，而不是我的雇主亚马逊网络服务公司的观点。</p></div></div>    
</body>
</html>