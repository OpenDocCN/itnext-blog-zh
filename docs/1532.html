<html>
<head>
<title>Learn how Full-stack apps work by building a simple one using JavaScript (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过使用JavaScript构建一个简单的应用程序来了解全栈应用程序是如何工作的(第2部分)</h1>
<blockquote>原文：<a href="https://itnext.io/learn-how-full-stack-apps-work-by-building-a-simple-one-using-javascript-part-2-45b42c1f2e84?source=collection_archive---------2-----------------------#2018-11-17">https://itnext.io/learn-how-full-stack-apps-work-by-building-a-simple-one-using-javascript-part-2-45b42c1f2e84?source=collection_archive---------2-----------------------#2018-11-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d292" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">构建一个可以从后端API获取数据的前端应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/479b2d5665ad7efe8c15f780b2d55f7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AenJNna8ufix9ON-b9noJA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@rawpixel" rel="noopener ugc nofollow" target="_blank"> rawpixel </a>拍摄</figcaption></figure><p id="9a01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将构建一个简单的表单，它可以与我们在这个两部分系列的第一部分中创建的假天气API进行通信。该表单将接受一个城市名称，并返回与该城市相关的天气数据。我们正在构建的应用程序非常简单，但这些概念与用于构建大型应用程序的概念相同。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="5a9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是这个两部分系列的第二部分。如果你没有读过第一部分，你可以在这里查看一下。</p><h1 id="8bf9" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">步骤1:设置我们的项目</h1><p id="dab8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要完成本教程，您需要以下内容:</p><ul class=""><li id="e6ea" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">一个文本编辑器(我用的是<a class="ae kv" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>)</li><li id="f1c0" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">浏览器(我用的是Chrome浏览器，但是Firefox浏览器应该可以正常工作)</li><li id="d27d" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">本系列第一部分中内置的API</li></ul><p id="b5db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，让我们得到这个项目的启动文件。你可以在我的Github上找到它们。</p><p id="05a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦你克隆或下载了文件，在你的文本编辑器中打开它们。这是您应该看到的文件结构:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="0e0f" class="np ma iq nl b gy nq nr l ns nt">/Fake-Weather-Form-Starter<br/>  README.md<br/>  index.html<br/>  script.js</span></pre><p id="dd39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们只有三个文件，其中只有两个与我们正在做的事情有关。<code class="fe nu nv nw nl b">script.js</code>文件是空的，所以让我们从打开我们的<code class="fe nu nv nw nl b">index.html</code>文件开始。这是你应该看到的:</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="fa31" class="np ma iq nl b gy nq nr l ns nt">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;</span><span id="2cb1" class="np ma iq nl b gy nx nr l ns nt">&lt;head&gt;<br/>  &lt;meta charset="utf-8" /&gt;<br/>  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>  &lt;title&gt;Fake Weather Data&lt;/title&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;style&gt;<br/>    body {<br/>      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;<br/>    }<br/>    form {<br/>      display: flex;<br/>      /* flex-direction: column; */<br/>      justify-content: center;<br/>      align-items: flex-end;<br/>      margin-top: 10%;<br/>    }<br/>    .form-item {<br/>      display: flex;<br/>      flex-direction: column;<br/>      align-items: flex-start;<br/>    }<br/>    label, input, button {<br/>      padding: 10px;<br/>      margin-left: 10px;<br/>    }<br/>    label {<br/>      padding-left: 0px;<br/>    }<br/>    .weather-info {<br/>      display: flex;<br/>      flex-direction: column;<br/>      align-items: center;<br/>    }<br/>    .error-message {<br/>      color: red;<br/>      text-align: center;<br/>    }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;</span><span id="a49f" class="np ma iq nl b gy nx nr l ns nt">&lt;body&gt;</span><span id="6101" class="np ma iq nl b gy nx nr l ns nt">&lt;form&gt;<br/>    &lt;div class="form-item"&gt;<br/>      &lt;label for="city"&gt;City Name: &lt;/label&gt;<br/>      &lt;input type="text" placeholder="Enter a city name" id="city" name="city" required&gt;<br/>    &lt;/div&gt;<br/>    &lt;button type="submit"&gt;SUBMIT&lt;/button&gt;<br/>  &lt;/form&gt;<br/>  &lt;div class="error-message"&gt;&lt;/div&gt;</span><span id="f159" class="np ma iq nl b gy nx nr l ns nt">&lt;div class="weather-info"&gt;<br/>    &lt;h1 class="cityName"&gt;&lt;/h1&gt;<br/>    &lt;h4 class="celsius"&gt;&lt;/h4&gt;<br/>    &lt;h4 class="fahrenheit"&gt;&lt;/h4&gt;<br/>  &lt;/div&gt;</span><span id="445d" class="np ma iq nl b gy nx nr l ns nt">  &lt;script src="script.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span><span id="e240" class="np ma iq nl b gy nx nr l ns nt">&lt;/html&gt;</span></pre><p id="a4f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">html文件的主体只包含一个带有一个输入的表单、一个提交按钮和一个包含三个空元素的div。这些元素将显示我们的数据。此外，我们在表单下面有一个div，它将显示任何与表单相关的错误消息。</p><p id="d60d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我在html <code class="fe nu nv nw nl b">head</code>标签中添加了一些样式，让我们的表单看起来更好。这不是最好的造型方式，也不是最好的造型，但它确实有效。在本教程中，我们更关心功能而不是麻醉剂。您可以通过在浏览器上打开<code class="fe nu nv nw nl b">index.html</code>来查看表格。如果您这样做，您应该会看到:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/69a1251f49c3b4f6bbd4bf43670fcf1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*7liWT_uibN5NcGV_9ty2Nw.png"/></div></figure><p id="b028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好了，现在我们准备写一些代码了！</p><h1 id="5fca" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">步骤2:构建主表单功能</h1><p id="9938" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将为这个项目做非常简单的DOM操作，所以我们将使用普通的JavaScript来完成。在文本编辑器上打开你的<code class="fe nu nv nw nl b">script.js</code>文件，让我们开始吧。</p><p id="e7eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们希望表单在提交时检索数据，所以让我们选择表单，然后为<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/Events/submit" rel="noopener ugc nofollow" target="_blank">提交事件</a>添加一个事件监听器。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="91c3" class="np ma iq nl b gy nq nr l ns nt">// Select our form<br/>const form = document.querySelector('form');</span><span id="3654" class="np ma iq nl b gy nx nr l ns nt">// When form is submitted print 'submitted' to the browser console<br/>form.addEventListener('submit', function(e) {<br/>  // prevent form default behavior<br/>  e.preventDefault();<br/>  console.log('submitted');<br/>})</span></pre><p id="8112" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们的表单所要做的就是在浏览器控制台上打印出“已提交”。我们只是确保表单工作正常。如果是，您应该会看到以下内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/de00c6affddf5d2dc93cade1d01a0ed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*e8r2CZlvKDNC1omdgzRp9Q.gif"/></div></div></figure><p id="effb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不错！我们的形式有效。但是，我们希望表单能够访问用户在输入中插入的任何内容。让我们选择我们的文本输入，然后将其值存储在一个变量中。每当用户触发<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/Events/input" rel="noopener ugc nofollow" target="_blank">输入事件</a>时，该变量需要更新。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2e1e" class="np ma iq nl b gy nq nr l ns nt">// Select text input<br/>const textInput = document.getElementById('city');</span><span id="4e0a" class="np ma iq nl b gy nx nr l ns nt">// Store the value of the input in a variable<br/>let cityName = textInput.value;</span><span id="7efb" class="np ma iq nl b gy nx nr l ns nt">// When an input event is triggered update cityName<br/>textInput.addEventListener('input', function(e) {<br/>  cityName = e.target.value;<br/>})</span><span id="5e6e" class="np ma iq nl b gy nx nr l ns nt">// Select our form<br/>const form = document.querySelector('form');</span><span id="b77b" class="np ma iq nl b gy nx nr l ns nt">// When form is submitted print 'submitted' to the browser console<br/>form.addEventListener('submit', function(e) {<br/>  // prevent form default behavior<br/>  e.preventDefault();</span><span id="75ba" class="np ma iq nl b gy nx nr l ns nt">// print input value<br/>  console.log(cityName);</span><span id="e4c5" class="np ma iq nl b gy nx nr l ns nt">// clear input<br/>  textInput.value = '';<br/>})</span></pre><p id="e0ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的表单现在在提交时打印输入值，然后清除文本输入值。您的应用程序现在应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/68bce54774a64203037f8857886138d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*i1LVmOEW0sERuli3y4Gjrw.gif"/></div></div></figure><p id="f3ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完美！现在让我们调用我们的API。</p><h1 id="c22c" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">步骤3:从假天气API获取数据</h1><p id="d910" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在我们开始获取数据之前，我们需要确保我们的API是活动的。在这种情况下，您所要做的就是转到您的weather API目录，并使用<code class="fe nu nv nw nl b">node index.js</code>运行它。一旦开始，你可以把它留在后台，回到我们的表单。</p><p id="cff3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用JavaScript进行http请求有很多种方法。您可以使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest" rel="noopener ugc nofollow" target="_blank"> XMLHttpRequest </a>或<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> fetch API </a>，但在我的情况下，我更喜欢使用<a class="ae kv" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>。这里没有正确的答案，只有个人偏好。</p><p id="3591" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要将axios添加到我们的应用程序中，我们需要做的就是在html文件中包含cdn。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="2d6b" class="np ma iq nl b gy nq nr l ns nt">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/></span><span id="85fa" class="np ma iq nl b gy nx nr l ns nt">...</span><span id="d856" class="np ma iq nl b gy nx nr l ns nt">  &lt;script src="<a class="ae kv" href="https://unpkg.com/axios/dist/axios.min.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/axios/dist/axios.min.js</a>"&gt;&lt;/script&gt;<br/>  &lt;script src="script.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="20e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的例子中，我将它添加在我的<code class="fe nu nv nw nl b">script.js</code>脚本标签的正上方。</p><p id="b8c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在应该能够在我们的<code class="fe nu nv nw nl b">script.js</code>文件中使用axios向我们的API发出请求</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="4910" class="np ma iq nl b gy nq nr l ns nt">// Select text input<br/>const textInput = document.getElementById('city');</span><span id="121e" class="np ma iq nl b gy nx nr l ns nt">// Store the value of the input in a variable<br/>let cityName = textInput.value;</span><span id="19f3" class="np ma iq nl b gy nx nr l ns nt">// When an input event is triggered update cityName<br/>textInput.addEventListener('input', function(e) {<br/>  cityName = e.target.value;<br/>})</span><span id="9525" class="np ma iq nl b gy nx nr l ns nt">// Select our form<br/>const form = document.querySelector('form');</span><span id="4408" class="np ma iq nl b gy nx nr l ns nt">// When form is submitted print 'submitted' to the browser console<br/>form.addEventListener('submit', function(e) {<br/>  // prevent form default behavior<br/>  e.preventDefault();</span><span id="3513" class="np ma iq nl b gy nx nr l ns nt">// make request to our API<br/>  axios.get('<a class="ae kv" href="http://localhost:3000/weather/?city='" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/weather/?city='</a> + cityName)<br/>    .then(function(response) {<br/>      console.log(response.data);<br/>    })<br/>    .catch(function(error) {<br/>      console.log(error);<br/>    })</span><span id="7b9b" class="np ma iq nl b gy nx nr l ns nt">// clear input<br/>  textInput.value = '';<br/>})</span></pre><p id="7810" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当表单被提交时，我们应该会从打印在浏览器控制台上的API得到一个响应。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/e9f360cc2d6510c0432e6005d8089145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*C3Elwva1XKPsTh5K32LcUQ.gif"/></div></div></figure><p id="04a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你得到的结果和上面显示的一样，那么恭喜你！您已经完成了本教程的大部分。现在我们需要做的就是在我们的页面上显示这些数据，而不是在浏览器控制台上。此外，当用户输入一个不在我们数据库中的城市时，我们应该得到一条错误消息。</p><pre class="kg kh ki kj gt nk nl nm nn aw no bi"><span id="8a36" class="np ma iq nl b gy nq nr l ns nt">// Select text input<br/>const textInput = document.getElementById('city');</span><span id="63db" class="np ma iq nl b gy nx nr l ns nt">// Store the value of the input in a variable<br/>let cityName = textInput.value;</span><span id="b1e6" class="np ma iq nl b gy nx nr l ns nt">// When an input event is triggered update cityName<br/>textInput.addEventListener('input', function(e) {<br/>  cityName = e.target.value;<br/>})</span><span id="7cc8" class="np ma iq nl b gy nx nr l ns nt">// Select our form<br/>const form = document.querySelector('form');</span><span id="4ec1" class="np ma iq nl b gy nx nr l ns nt">// When form is submitted print 'submitted' to the browser console<br/>form.addEventListener('submit', function(e) {<br/>  // prevent form default behavior<br/>  e.preventDefault();</span><span id="f6fa" class="np ma iq nl b gy nx nr l ns nt">// make request to our API<br/>  axios.get('<a class="ae kv" href="http://localhost:3000/weather/?city='" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/weather/?city='</a> + cityName)<br/>    .then(function(response) {<br/>      // select elements<br/>      let city = document.querySelector('.cityName');<br/>      let celsius = document.querySelector('.celsius');<br/>      let fahrenheit = document.querySelector('.fahrenheit');<br/>      let errorMessage = document.querySelector('.error-message');</span><span id="de2d" class="np ma iq nl b gy nx nr l ns nt">if (response.data.city) {<br/>        city.innerHTML = 'City: ' + response.data.city;<br/>        celsius.innerHTML = 'Temperature (C): ' + response.data['temperature (C)'];<br/>        fahrenheit.innerHTML = 'Temperature (F): ' + response.data['temperature (F)'];<br/>      } else {<br/>        errorMessage.innerHTML = "This city is not in our database"<br/>      }<br/>    })<br/>    .catch(function(error) {<br/>      console.log(error);<br/>    })</span><span id="4e70" class="np ma iq nl b gy nx nr l ns nt">// clear input<br/>  textInput.value = '';<br/>})</span></pre><p id="71cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码应该产生以下结果。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/7863a82e403f8a1e4806a14bbcca69ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Buzg-FK6b6mNZx7cF6eHiQ.gif"/></div></div></figure><p id="76a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">恭喜你！如果您已经做到了这一步，那么您已经成功地构建了一个API和一个可以从中获取数据的前端应用程序。这是一个非常简单的演示，但我希望这能启发你构建一些更健壮、更有趣的东西。</p><p id="60fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你对这篇文章有任何问题或建议，欢迎在下面评论或在我的推特上找到我并给我留言！</p></div></div>    
</body>
</html>