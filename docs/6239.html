<html>
<head>
<title>You are doing code reviews wrong</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你做代码审查是错误的</h1>
<blockquote>原文：<a href="https://itnext.io/you-are-doing-code-reviews-wrong-e0b16ce8812b?source=collection_archive---------0-----------------------#2021-09-28">https://itnext.io/you-are-doing-code-reviews-wrong-e0b16ce8812b?source=collection_archive---------0-----------------------#2021-09-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="683e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正确地进行代码审查是困难的。在这篇短文中，我将引导您完成代码评审的目标，并讨论在您的组织中实现代码评审的增量层次。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/2142c41d7dad9b4d14ead54dd827aa97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6gN_9hsR886JT1lGM2rvA.png"/></div></div></figure><h1 id="b4f3" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">代码评审的非目标</h1><p id="c6e1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">我将从什么是代码评审开始。</p><p id="7f14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码评审不是设计评审。如果您经常在代码评审期间讨论设计，那么您的团队流程中的某个地方就会出现系统故障。编写代码就是实现一个达成一致的设计。因此，在审查代码时，设计不应该成为争论的焦点。</p><p id="e288" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码审查不是测试。如果您花费时间来确定代码更改是否如预期的那样工作，这是一个明确的信号，表明您的测试覆盖范围不够，您正在浪费宝贵的开发人员时间。</p><p id="d457" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代码评审的主要目标是加速开发、改善知识分布、更好地利用领域专家和消除摩擦。我们将在经历不同级别的代码评审时讨论这些目标。</p><h1 id="bd86" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">提升您的代码评审水平</h1><p id="ffbd" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果你没有进行代码评审，或者觉得你没有从代码评审中获得很大的价值，下面的级别将允许你建立你的评审管道。</p><h2 id="0778" class="ma ky iq bd kz mb mc dn ld md me dp lh jy mf mg ll kc mh mi lp kg mj mk lt ml bi translated">0级—全自动审查</h2><p id="2442" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">0级代码评审更多的是一种门控技术，因为没有人参与评审过程。</p><ul class=""><li id="be6b" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">检查和实施代码格式化</li><li id="205f" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">检查代码样式冲突</li><li id="acf4" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">检查失败的测试</li><li id="b119" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">检查静态检查工具报告的错误</li></ul><p id="6d62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">研究哪些工具可以为你的语言自动运行，并设置它们。花时间设置这些检查几乎总是值得的，因为好处是倍增的(开发人员的数量)和复合的。我还建议花时间建立一种在本地运行这些检查的方法，这样每个开发人员甚至可以在将代码更改发送给代码评审之前检查他们的代码更改是否符合规范。如果你使用的是<em class="na"> git </em>，看看<em class="na">预提交</em>框架作为起点。</p><p id="9d54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">审稿:</strong>自动化</p><p id="cb73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">目标:</strong>速度，通过统一减少摩擦</p><p id="c872" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成本:可以忽略不计</p><h2 id="9b06" class="ma ky iq bd kz mb mc dn ld md me dp lh jy mf mg ll kc mh mi lp kg mj mk lt ml bi translated">0.5级—人工判断的自动审查</h2><p id="7e5b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">在一些自动化检查上设置一个硬阈值可能会对代码质量有害。</p><p id="e955" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，如果代码更改引入了一个新特性，如果它也降低了性能，这可能是没问题的。无论哪种方式，自动运行性能测试是值得的，但是需要人工批准或请求更改。</p><p id="4eb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">评审员:</strong>自动化，由高级团队成员批准，最好是做产品级决策的人</p><p id="c893" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">目标:</strong>速度，更好地利用领域专家</p><p id="ffed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">成本:</strong>可忽略不计</p><h2 id="04c9" class="ma ky iq bd kz mb mc dn ld md me dp lh jy mf mg ll kc mh mi lp kg mj mk lt ml bi translated">级别1 —纯可读性审查</h2><p id="e135" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果你想做一个精益版本的代码审查，这就是它。纯粹的可读性检查是在回答一个简单的问题。代码可读吗？这里我指的是一个特定的属性:“代码在做什么很明显吗？”。这里有两个可能会被混淆为相反的代码片段。</p><p id="4981" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是一个不可读代码的示例:</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="0853" class="ma ky iq nc b gy ng nh l ni nj">int Update(vector&lt;User&gt;&amp; users) {<br/>    int sum = 0;<br/>    for (auto &amp;user : users) {<br/>        sum += Calculate(user);<br/>    }<br/>    return sum;<br/>}</span></pre><p id="9d8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个片段不可读，因为不清楚这里发生了什么。我们到底在计算什么？为什么函数叫<code class="fe nk nl nm nc b">Update</code>，是在更新什么东西吗？或许<code class="fe nk nl nm nc b">Calculate</code>会改变<code class="fe nk nl nm nc b">user</code>的状态？</p><p id="d705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是可读代码的示例:</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="65f8" class="ma ky iq nc b gy ng nh l ni nj">float sin_taylor(float x) {<br/>    // Taylor series approximation for sinus function:<br/>    // <a class="ae nn" href="https://en.wikipedia.org/wiki/Taylor_series#Approximation_error_and_convergence" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Taylor_series#Approximation_error_and_convergence</a><br/>    assert(x &gt; -1 &amp;&amp; x &lt; 1); // only precise for (-1,1)<br/>    return x - (x*x*x)/(3*2) + (x*x*x*x*x)/(5*4*3*2*1) - (x*x*x*x*x*x*x)/(7*6*5*4*3*2);<br/>}</span></pre><p id="8e0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里发生的事情很清楚。更多关于公式的信息被链接，代码只是维基百科上列出的数学公式的扩展。</p><p id="7fbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可读性检查可以让初级开发人员更加熟悉代码库，从而达到双重目的。幸运的是，初级开发人员也能很好地判断哪些代码是可读的。</p><p id="5a01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">评审:</strong>初级团队成员</p><p id="ba46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">目标:</strong>速度，分享知识</p><p id="3c35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">成本:</strong>小</p><h2 id="9fcc" class="ma ky iq bd kz mb mc dn ld md me dp lh jy mf mg ll kc mh mi lp kg mj mk lt ml bi translated">1.5级—语言可读性审查</h2><p id="65b3" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">语言可读性在大组织中变得很重要。它的作用与linters相似，但是在linters有限的地方，人们可以检查代码的风格和语言的习惯用法，即使是在复杂的情况下。但很明显，成本要高得多。</p><p id="0348" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">语言可读性审查的主要目标是减少摩擦，增加整个组织的语言知识。它确保一个团队不会以与另一个团队完全不同的方式使用特定的语言或库或服务。通过这个回顾，开发人员将随着时间的推移学习使用语言、库或服务的惯用方式。</p><p id="452e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个审查应该完全集中在语言(或库等)的正确使用上。)并应依赖批准的指南(而非主观偏好)。</p><p id="0462" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">审核者:</strong>基于既定准则的语言/库专家</p><p id="4edc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">目标:</strong>通过统一减少摩擦，分享知识</p><p id="c8d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">成本:</strong>重大</p><h2 id="6779" class="ma ky iq bd kz mb mc dn ld md me dp lh jy mf mg ll kc mh mi lp kg mj mk lt ml bi translated">第2级—所有权审查</h2><p id="c3d1" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">所有权审查的目的是让维护者确认他们接受这段代码的所有权。但是，当然，这到底意味着什么将根据上下文，尤其是维护者而有所不同。</p><p id="4b18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这次审查的典型重点领域是:</p><ul class=""><li id="7b43" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">地方风格的考虑</li><li id="77a9" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">本地专家知识(例如正确使用内部库)</li><li id="82aa" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">维护负担</li></ul><p id="7639" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在团队可以为彼此的项目交叉贡献以交付他们需要的特性的环境中，这种审查变得非常重要。这同样适用于许多开源项目，因为它们从外部贡献接收代码变更。</p><p id="0267" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">审核人:</strong>项目/库维护人员或高级开发人员</p><p id="eebf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">目标:</strong>速度，更好的利用领域专家</p><p id="35a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">成本:</strong>显著</p><h1 id="f3f6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">挑什么</h1><p id="7f75" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">呈现的级别建立在彼此之上。因此，举例来说，如果0级评审不完整，那么进行1级评审是没有意义的。然而，你不一定要使用所有的水平。</p><p id="62e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是基于您的项目的一些建议:</p><ul class=""><li id="26d3" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated"><strong class="jp ir">小型开源项目:</strong>0级+2级</li><li id="cd1c" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><strong class="jp ir">中型开源项目:</strong>0级+1级+2级</li><li id="f0d6" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><strong class="jp ir">大开源项目:</strong>0级+0.5级+1级+2级</li><li id="f6af" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><strong class="jp ir">单队公司:</strong>0级(+0.5级)+1级</li><li id="f8df" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated"><strong class="jp ir">多团队公司:</strong>0级+0.5级+1级+1.5级+2级</li></ul><h1 id="2f19" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">感谢您的阅读</h1><p id="9103" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">感谢您阅读这篇文章。你喜欢吗？</p><p id="9a00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也在YouTube上发布视频。你有问题吗？在推特<a class="ae nn" href="https://twitter.com/SimonToth83" rel="noopener ugc nofollow" target="_blank">或LinkedIn </a>上联系我。</p></div></div>    
</body>
</html>