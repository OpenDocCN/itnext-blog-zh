<html>
<head>
<title>Jenkins: SAML, Okta, user groups, and Role-Based Security plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins: SAML、Okta、用户组和基于角色的安全插件</h1>
<blockquote>原文：<a href="https://itnext.io/jenkins-saml-okta-users-groups-and-role-based-security-plugin-4298a1f71a7e?source=collection_archive---------1-----------------------#2019-10-15">https://itnext.io/jenkins-saml-okta-users-groups-and-role-based-security-plugin-4298a1f71a7e?source=collection_archive---------1-----------------------#2019-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/eea0b72721660f437927e3be00e1ad7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*bI_VSuFdSfdZ8M7M.png"/></div></figure><p id="6ee0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">还是关于Jenkins的Okta和SSO让我们为Jenkins配置一个基于角色的安全插件。参见<a class="ae ks" href="https://rtfm.co.ua/en/jenkins-saml-authentication-via-okta-and-users-groups/" rel="noopener ugc nofollow" target="_blank">Jenkins:Okta SSO和用户组</a>帖子的第一部分。</p><p id="b708" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">总的想法是在Okta中定义用户组，当用户登录到Jenkins时，Okta必须通过用户组。</p><p id="d8a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，Jenkins必须根据该用户的组为其分配正确的权限。</p><h2 id="02da" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">基于角色的安全插件配置</h2><p id="73c7" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">安装<a class="ae ks" href="https://plugins.jenkins.io/role-strategy" rel="noopener ugc nofollow" target="_blank">基于角色的授权策略</a>插件本身:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lr"><img src="../Images/f4515429a1d0ea062308c4db8f6cf39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3K8vy1wkXIMoK7K3.png"/></div></div></figure><p id="7c81" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入<em class="ma">配置全局安全</em>，将按钮切换到<em class="ma">基于角色的策略</em>:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mb"><img src="../Images/0c16f72b91ae29f3e7367cc7c074321b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bJ5HmerJznDf6s3A.png"/></div></div></figure><p id="730e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入<em class="ma">管理和分配角色</em>:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mb"><img src="../Images/c333c596c92e53210ce188993415665f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KSIi_XouxZtHrKau.png"/></div></div></figure><h2 id="2595" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">创建角色—全局角色</h2><p id="b30b" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">这里的角色分为三个方面:</p><ul class=""><li id="48ba" class="mc md iq jw b jx jy kb kc kf me kj mf kn mg kr mh mi mj mk bi translated"><em class="ma">全局角色</em>:显然，全局权限的全局角色，如创建/删除视图、作业、总体</li><li id="e133" class="mc md iq jw b jx ml kb mm kf mn kj mo kn mp kr mh mi mj mk bi translated"><em class="ma">项目角色</em>:基于项目的权限设置——作业受正则表达式限制</li><li id="cf08" class="mc md iq jw b jx ml kb mm kf mn kj mo kn mp kr mh mi mj mk bi translated"><em class="ma">代理角色</em>:詹金斯奴隶/工人/代理权限</li></ul><p id="539b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您现在尝试登录，将会遇到“<strong class="jw ir">缺少整体/读取权限</strong>”错误:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mq"><img src="../Images/7c31e8e5ee637dc25aa38796ee2289b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xK5M_S4ihPv8CzjL.png"/></div></div></figure><p id="6295" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了避免这种情况，需要创建一个具有<em class="ma">总体读取</em>权限的全局角色。</p><p id="8dde" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="ma">管理角色</em>:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mr"><img src="../Images/b12876782518c8dc251fef71e0ce26e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yBF4RAV9VmMhs2oB.png"/></div></div></figure><p id="c32b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">创建一个名为<em class="ma"> read_all </em>的新全局角色，并将权限设置为<em class="ma"> Overall — Read </em>:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ms"><img src="../Images/41cece5fefdbd71cb441551fff4cc82e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kuu6EkPIJxrHNHwb.png"/></div></div></figure><p id="face" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保存。</p><h2 id="fabc" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">分配角色</h2><p id="f781" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">例如，让我们来做一个<em class="ma">测试</em>用户:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/4f4bc49e79e8836b366825dfe7beedb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/0*VS1maQ31Bo9BfcWf.png"/></div></figure><p id="937d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">它被分配了两个组——每个人<em class="ma">和开发人员<em class="ma">和开发人员</em>。</em></p><p id="9896" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="ma">分配角色</em>，添加<em class="ma"> Everyone </em>组，并将<em class="ma"> read_all </em>分配给它:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mu"><img src="../Images/868b12c4355db85b217ce9c54386ddf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ArYqlKLbRSnUKf8H.png"/></div></div></figure><p id="bea4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">保存并以此用户身份登录:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mv"><img src="../Images/8da765aa86ab538c06c303388feed372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jHJ_yvpQ_UAyjLd-.png"/></div></div></figure><p id="7393" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">好的—您可以登录，但现在看不到任何作业。</p><h2 id="4978" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">项目角色</h2><p id="6e7c" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">接下来，需要创建角色来授予对各种作业/视图的访问权限。</p><p id="c3de" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">例如，我们有一个<em class="ma"> Android </em>视图，为我们的Android开发人员提供工作:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mw"><img src="../Images/597d6f4e2e1b340351ae7116f491d7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bli_elvSoA62tBTm.png"/></div></div></figure><p id="11fd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">转到<em class="ma">管理角色</em>，添加一个<em class="ma"> android_developer </em>角色，并在<em class="ma">模式</em>中设置<code class="fe mx my mz na b">(?i)android_.*</code>值——在这里，我们将<code class="fe mx my mz na b">(?i)</code>设置为不区分大小写的搜索，并使用<code class="fe mx my mz na b">android_.*</code>——将选择所有android作业:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nb"><img src="../Images/a90632aa6624a75c5ad8af54a4468356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EhlU4Yts1dfrSVNC.png"/></div></div></figure><p id="356a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以点击一个正则表达式来查看哪些作业将与您在<em class="ma">模式</em>中设置的过滤器相匹配:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nc"><img src="../Images/248a743bbcbb922f113de28b2fae7e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sb79QUozfY3Q9TyN.png"/></div></div></figure><p id="4e99" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">进入<em class="ma">分配角色</em>，将<em class="ma"> android_developer </em>角色附加到<em class="ma"> Android </em>组:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nd"><img src="../Images/4aedd204bfec53203bab12b02856620e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B4bAvkTTnBB90-BF.png"/></div></div></figure><h2 id="8279" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">奥克塔集团</h2><p id="fc99" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">转到Okta，将<em class="ma"> Android </em>组添加到我们的测试用户:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/841988bd8f68cf563a11f3c0af830179.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*FdkX_IHHcLJ6fmG6.png"/></div></figure><p id="f29f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以此用户身份登录:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nf"><img src="../Images/ebb98eaf245b8e509b0f1a8324e110d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qN7IEsot1KkJJDd1.png"/></div></div></figure><p id="d1a1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太棒了——我们只能看到Android作业和视图。</p><p id="f03d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">同样，让我们为ios创建另一个角色— <em class="ma"> ios_config </em>，但这一次—使用<em class="ma">配置</em>权限:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ng"><img src="../Images/b8c4fd84babb4ab95f0374897b0aa738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TNpUk25dqu6rae2c.png"/></div></div></figure><p id="c2a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将此角色分配给<em class="ma"> iOS </em>组:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nh"><img src="../Images/6cfef241ad8342c78756cc5e1e711c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FAdXr2jfJ3Gs7Uas.png"/></div></div></figure><p id="c19a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在Okta中，将<em class="ma"> iOS </em>组连接到<em class="ma">测试用户</em>:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/afd595ffb8ac4485153bbbf97d074f8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/0*ZGk7c4cdFB7r4sGB.png"/></div></figure><p id="5416" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">登录后，您将立即看到iOS作业:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nj"><img src="../Images/b69fde9c36e5012083f1c5c860ff1ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CtxXmkOFWueYhhYz.png"/></div></div></figure><p id="f0e5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且<em class="ma">配置</em>权限正在工作:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nk"><img src="../Images/2096ae5f837070873a68f6859a1c7ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uZe0iYpHLVWGs8tL.png"/></div></div></figure><h2 id="12cb" class="kt ku iq bd kv kw kx dn ky kz la dp lb kf lc ld le kj lf lg lh kn li lj lk ll bi translated">支持</h2><p id="b6d6" class="pw-post-body-paragraph ju jv iq jw b jx lm jz ka kb ln kd ke kf lo kh ki kj lp kl km kn lq kp kq kr ij bi translated">您在Jenkins中创建的安全领域、组和用户将保存在<code class="fe mx my mz na b">config.xml</code>文件中:</p><figure class="ls lt lu lv gt jr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/416a05d6245e7c97047a8062fd41dbfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/0*KYIMrXTghSQeBrTH.png"/></div></figure><p id="af15" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，在更改任何Security Real设置之前，最好备份该文件。</p><p id="b9ac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi">Готово.</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="f138" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ma">最初发布于</em> <a class="ae ks" href="https://rtfm.co.ua/en/jenkins-saml-okta-users-groups-and-role-based-security-plugin/" rel="noopener ugc nofollow" target="_blank"> <em class="ma"> RTFM: Linux、DevOps和系统管理</em> </a> <em class="ma">。</em></p></div></div>    
</body>
</html>