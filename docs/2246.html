<html>
<head>
<title>Firebase + Algolia Searching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase + Algolia搜索</h1>
<blockquote>原文：<a href="https://itnext.io/firebase-algolia-6c58fba930b7?source=collection_archive---------4-----------------------#2019-04-23">https://itnext.io/firebase-algolia-6c58fba930b7?source=collection_archive---------4-----------------------#2019-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/478943acb5aa435a7366d60095eb0b52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLz5a4UAm7IDnnIWel_DVg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">以非凡的速度和索引搜索您的firestore数据库</figcaption></figure></div><div class="ab cl kf kg hx kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="im in io ip iq"><p id="7273" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我开始创建一个应用程序来帮助其他人学习基本的<a class="ae lk" href="https://polish-verbs.firebaseapp.com" rel="noopener ugc nofollow" target="_blank">波兰语变体</a>。我希望这款应用程序具有出色的搜索能力，因为我们学习语言的方式各不相同，我们可能会记住部分单词，甚至是单词的发音。</p><p id="4752" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">Algolia让我能够非常快速地索引我的数据库，它非常强大。Elasticsearch是一个备选方案，但我想用这个应用程序开发一个真正的“无配置/无服务器”体验。</p><p id="47e8" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我创建了一个通过url执行的firebase函数，该函数将索引我的firestore收藏。然后，我使用algolia客户端API搜索这些索引，同样不必混淆任何重要的API或管理密钥，因为没有管理密钥，任何人都无法写入algolia索引。</p><p id="6005" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">让我们开始吧。</p><p id="9708" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">第一步:设置</strong> <a class="ae lk" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank"> <strong class="ko iu"> firebase </strong> </a></p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="f26b" class="lu lv it lq b gy lw lx l ly lz">$ npm install -g firebase-tool</span><span id="a0a1" class="lu lv it lq b gy ma lx l ly lz">$ firebase login</span><span id="daed" class="lu lv it lq b gy ma lx l ly lz">$ mkdir firebase-functions &amp;&amp; cd firebase-functions</span><span id="031f" class="lu lv it lq b gy ma lx l ly lz">$ firebase init functions</span></pre><p id="571c" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">遵循CLI过程的其余部分，并设置您的firebase functions项目。</p><p id="f819" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">第二步:设置您的项目</strong></p><p id="e76d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">在firebase-functions项目中，安装并保存algoliasearch。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="276b" class="lu lv it lq b gy lw lx l ly lz">$ npm i algoliasearch --save</span></pre><p id="8b3f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">第三步:编写你的函数</strong></p><blockquote class="mb mc md"><p id="341f" class="km kn me ko b kp kq kr ks kt ku kv kw mf ky kz la mg lc ld le mh lg lh li lj im bi translated">注意:您需要从spark计划升级到使用外部API的功能。</p></blockquote><p id="ef7d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">确保您已经设置了<a class="ae lk" href="https://www.algolia.com/doc/" rel="noopener ugc nofollow" target="_blank"> Algolia </a>。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="cd30" class="lu lv it lq b gy lw lx l ly lz">// functions/index.js</span><span id="2cf0" class="lu lv it lq b gy ma lx l ly lz">const functions = require('firebase-functions');<br/>const admin = require('firebase-admin');<br/>const algoliasearch = require('algoliasearch');<br/><br/>const ALGOLIA_APP_ID = 'XXXXXXXX';<br/>const ALGOLIA_ADMIN_KEY = 'XXXXXXXX';<br/>const ALOGOLIA_INDEX_NAME = 'XXXXXXXX';<br/><br/>admin.initializeApp(functions.config().firebase);<br/><br/>exports.firestoreToAlgolia = functions.https.onRequest((req, res) =&gt; {<br/>    const arr = [];<br/>    admin.firestore().collection('COLLECTION_NAME').get().then(docs =&gt; {<br/>        docs.forEach(doc =&gt; {<br/>            const verb = doc.data();<br/>            verb.objectID = doc.id;<br/>            arr.push(verb);<br/>        });<br/><br/>        const client = algoliasearch(ALGOLIA_APP_ID, ALGOLIA_ADMIN_KEY);<br/>        const index =  client.initIndex(ALOGOLIA_INDEX_NAME);<br/>        <br/>        index.saveObjects(arr, (err, content) =&gt; {<br/>            if (err) res.status(500);<br/>            <br/>            res.status(200).send(content);<br/>        });<br/>    });<br/>});</span></pre><p id="25f5" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">第四步:部署&amp;执行功能</strong></p><p id="c091" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">现在您已经编写了firebase函数，是时候部署和执行了。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="0025" class="lu lv it lq b gy lw lx l ly lz">$ firebase deploy --only functions</span></pre><p id="58d5" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">一旦您成功部署了您的函数，您将会看到类似如下的消息:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="2ff4" class="lu lv it lq b gy lw lx l ly lz">Function URL (<!-- -->firestoreToAlgolia<!-- -->): <a class="ae lk" href="https://us-central1-MY_PROJECT.cloudfunctions.net/addMessage" rel="noopener ugc nofollow" target="_blank">https://us-central1-MY_PROJECT.cloudfunctions.net/</a>firestoreToAlgolia</span></pre><p id="d462" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">或者，您可以在firebase项目中的函数链接下找到它的url。</p><p id="c226" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">将该URL复制并粘贴到您的浏览器中，几秒钟后，您的数据将被algolia搜索编入索引。</p><p id="5860" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">第五步:配置客户端</strong></p><p id="8f17" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我在我的react项目中创建了一个Algolia“类”,如果你愿意，你可以用另一种方式来实现。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="c9bd" class="lu lv it lq b gy lw lx l ly lz">// utils/algolia.js</span><span id="036a" class="lu lv it lq b gy ma lx l ly lz">import algoliasearch from 'algoliasearch';<br/><br/>const ALGOLIA_APP_ID = 'XXXXXXXX';<br/>const ALGOLIA_API_KEY = 'XXXXXXXX';<br/><br/>const client = algoliasearch(ALGOLIA_APP_ID, ALGOLIA_API_KEY, {<br/>  protocol: 'https:'<br/>});<br/>const index = client.initIndex('COLLECTION_NAME');<br/><br/>export default index;</span></pre><p id="9643" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">然后我在我的反应“动词”容器中使用它</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="9e29" class="lu lv it lq b gy lw lx l ly lz">// containers/verb/index.js</span><span id="752c" class="lu lv it lq b gy ma lx l ly lz">import React, { useState } from 'react';<br/>import algolia from 'utils/algolia';</span><span id="d238" class="lu lv it lq b gy ma lx l ly lz">const getVerbs = (verbs, setVerbs, query) =&gt;<br/>  algolia.search({ query, hitsPerPage: 50 }).then(res =&gt; setVerbs(res.hits));</span><span id="1a82" class="lu lv it lq b gy ma lx l ly lz">const Verbs = ({ history }) =&gt; {<br/>  const [loading, setLoading] = useState(true);<br/>  const [verbs, setVerbs] = useState([]);<br/>  const [query, updateQuery] = useState('');<br/>  const [fetching, updateFetch] = useState(true);<br/><br/>  if (fetching)<br/>    getVerbs(verbs, setVerbs, query).then(() =&gt; {<br/>      setLoading(false);<br/>      updateFetch(false);<br/>    });<br/><br/>  return (<br/>    &lt;&gt;<br/>      &lt;SearchBar updateQuery={updateQuery} updateFetch={updateFetch} /&gt;<br/>    &lt;/&gt;<br/>  );<br/>};</span><span id="0e87" class="lu lv it lq b gy ma lx l ly lz">...</span></pre><p id="f7cd" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">就是这样，现在您的应用程序中有了一个极其强大的搜索组件，当添加新数据时，只需执行一个URL就可以进行索引。</p><p id="de09" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">请留下评论，分享经验！我很想听听你对这篇文章的看法，以及你是否有任何建议与我分享。</p></div></div>    
</body>
</html>