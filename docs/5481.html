<html>
<head>
<title>Data Lakes: Discovery, Security, and Privacy of Sensitive Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据湖:敏感数据的发现、安全和隐私</h1>
<blockquote>原文：<a href="https://itnext.io/discovery-security-and-privacy-of-sensitive-data-955c5ba4ec52?source=collection_archive---------7-----------------------#2021-03-15">https://itnext.io/discovery-security-and-privacy-of-sensitive-data-955c5ba4ec52?source=collection_archive---------7-----------------------#2021-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f84b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Amazon Macie来发现和保护您基于Amazon S3的数据湖中的敏感数据</h2></div><h1 id="1ddc" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">介绍</h1><p id="3f49" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与分析客户一起工作时，经常会看到具有十几个或更多离散数据源的数据湖。数据通常来自客户的内部和外部来源。内部数据可能来自多个团队、部门、分部和企业系统。外部数据来自供应商、合作伙伴、公共资源以及对许可数据源的订阅。不同数据源的数量、速度、多样性、准确性和交付方法各不相同。所有这些数据都被送入数据湖，用于分析、商业智能和机器学习等目的。</p><p id="3f2d" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">鉴于传入数据量和数据源之间的差异不断增加，组织确保遵守相关法律、政策和法规变得越来越复杂、昂贵和耗时。影响数据湖中数据处理方式的法规包括组织健康保险便携性和责任法案(HIPAA)、通用数据隐私法规(GDPR)、支付卡行业数据安全标准(PCI DSS)、加州消费者隐私法案(CCPA)和联邦信息安全管理法案(FISMA)。</p><h1 id="06f1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">数据湖</h1><p id="8079" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">AWS将<a class="ae mb" href="https://aws.amazon.com/big-data/datalakes-and-analytics/what-is-a-data-lake/" rel="noopener ugc nofollow" target="_blank">数据湖</a>定义为一个集中式存储库，允许您存储任何规模的所有结构化和非结构化数据。一旦进入数据湖，您就可以运行不同类型的分析，从仪表盘和可视化到大数据处理、实时分析和机器学习，以指导更好的决策。</p><p id="b1ee" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">数据湖中的数据按照其在分析过程中所处的阶段有规律地组织或分离。传入的数据通常被称为原始数据。然后对数据进行处理，如有必要，进行清理、过滤、丰富和标记。最后，对数据进行分析和聚合，并将结果写回数据湖。分析和汇总的数据用于构建商业智能仪表板和报告、机器学习模型，并交付给下游或外部系统。不同类别的数据(原始数据、已处理数据和聚合数据)通常被称为青铜级、白银级和黄金级，这是对其整体数据质量或价值的一种参考。</p><h1 id="c134" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">保护数据湖</h1><p id="c9eb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">假设您收到了来自外部数据源的大量数据。传入的数据被清理、过滤和丰富。数据被重新格式化、分区、压缩以提高分析效率，并被写回数据湖。您的分析管道针对数据运行复杂且耗时的查询。不幸的是，在为一组利益相关者构建报告时，您意识到原始数据意外地包含了您的客户的信用卡信息和其他敏感信息。除了不合规之外，您还浪费了初始数据处理的时间和费用，以及替换和重新处理数据的额外时间和费用。解决方案——亚马逊Macie。</p><h1 id="17e9" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">亚马逊Macie</h1><p id="1b7f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">根据AWS的说法，<a class="ae mb" href="https://aws.amazon.com/macie/" rel="noopener ugc nofollow" target="_blank">亚马逊Macie </a>是一项完全托管的数据安全和数据隐私服务，它使用机器学习和模式匹配来发现和保护你存储在<a class="ae mb" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank">亚马逊简单存储服务</a>(亚马逊S3)中的敏感数据。Macie的警报或发现可以被搜索、过滤并发送到<a class="ae mb" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank"> Amazon EventBridge </a>，以前称为Amazon CloudWatch Events，以便与现有工作流或事件管理系统轻松集成，或与AWS服务结合使用，如<a class="ae mb" href="https://aws.amazon.com/step-functions/" rel="noopener ugc nofollow" target="_blank"> AWS步骤功能</a>或<a class="ae mb" href="https://aws.amazon.com/managed-workflows-for-apache-airflow/" rel="noopener ugc nofollow" target="_blank">Amazon Managed Workflows for Apache air flow(MWAA)</a>以自动执行补救任务。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/c6392d90250c750c4940038c69d0f8b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dS8gX-PHVtsNC5gqOKKgCA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">亚马逊Macie的摘要视图</figcaption></figure><h1 id="38d1" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">数据发现和保护</h1><p id="31d9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在本文中，我们将部署一个自动化的数据检查工作流来检查位于S3的数据湖中的样本数据。亚马逊Macie将检查上传到加密S3桶的数据文件。如果在文件中发现敏感数据，这些文件将被移动到加密的隔离桶中，以供进一步调查。将发送电子邮件和短信提醒。该工作流将利用亚马逊EventBridge、<a class="ae mb" href="https://aws.amazon.com/sns/" rel="noopener ugc nofollow" target="_blank">亚马逊简单通知服务</a>(亚马逊SNS)、<a class="ae mb" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>和<a class="ae mb" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" rel="noopener ugc nofollow" target="_blank"> AWS系统管理器参数存储</a>。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ms"><img src="../Images/f07174388feccaf203b9cff6a1d2384b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ulxv-85jvRJrH44ffsOTng.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">Macie数据检查工作流程架构</figcaption></figure><h2 id="7605" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">源代码</h2><p id="40e1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用这个<code class="fe nf ng nh ni b">git clone</code>命令，下载这篇文章的<a class="ae mb" href="https://github.com/garystafford/macie-demo" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>到你的本地环境。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="bb47" class="mt kj it ni b gy nn no l np nq">git clone --branch main --single-branch --depth 1 --no-tags \<br/>    https://github.com/garystafford/macie-demo.git</span></pre><p id="455a" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这篇文章的AWS资源可以使用<a class="ae mb" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> AWS云形成</a>来部署。为了跟进，您需要安装最新版本的<a class="ae mb" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3 </a>、<a class="ae mb" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/quickstart.html#installation" rel="noopener ugc nofollow" target="_blank"> Boto3 </a>和<a class="ae mb" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI版本2 </a>。</p><h2 id="6e0d" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">抽样资料</h2><p id="be07" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将使用MITRE公司免费提供的合成患者数据。这些数据是由MITRE的开源合成患者生成器<a class="ae mb" href="https://synthetichealth.github.io/synthea/#technology-landing" rel="noopener ugc nofollow" target="_blank"> Synthea </a>生成的，该生成器对合成患者的病史进行建模。Synthea数据以多种数据标准导出，包括<a class="ae mb" href="http://hl7.org/fhir/" rel="noopener ugc nofollow" target="_blank"> HL7 FHIR </a>、<a class="ae mb" href="https://www.healthit.gov/policy-researchers-implementers/consolidated-cda-overview" rel="noopener ugc nofollow" target="_blank"> C-CDA </a>和CSV。我们将在这篇文章中使用CSV格式的数据文件。从<a class="ae mb" href="https://synthetichealth.github.io/synthea/#technology-landing" rel="noopener ugc nofollow" target="_blank"> Synthea </a>网站下载并解压缩CSV文件。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="8bcd" class="mt kj it ni b gy nn no l np nq">REMOTE_FILE="synthea_sample_data_csv_apr2020.zip"</span><span id="9c02" class="mt kj it ni b gy nr no l np nq">wget "https://storage.googleapis.com/synthea-public/${REMOTE_FILE}"</span><span id="2184" class="mt kj it ni b gy nr no l np nq">unzip -j "${REMOTE_FILE}" -d synthea_data/</span></pre><p id="444c" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">十六个CSV数据文件包含总共471，852行数据，包括列标题。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="f1de" class="mt kj it ni b gy nn no l np nq"><em class="ns">&gt; wc -l *.csv</em></span><span id="4d23" class="mt kj it ni b gy nr no l np nq">      598 allergies.csv<br/>    3,484 careplans.csv<br/>    8,377 conditions.csv<br/>       79 devices.csv<br/>   53,347 encounters.csv<br/>      856 imaging_studies.csv<br/>   15,479 immunizations.csv<br/>   42,990 medications.csv<br/>  299,698 observations.csv<br/>    1,120 organizations.csv<br/>    1,172 patients.csv<br/>    3,802 payer_transitions.csv<br/>       11 payers.csv<br/>   34,982 procedures.csv<br/>    5,856 providers.csv<br/>        1 supplies.csv<br/>  ------------------------------<br/>  <strong class="ni iu">471,852 total</strong></span></pre><h2 id="2492" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">Amazon Macie自定义数据标识符</h2><p id="f247" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了演示Amazon Macie的一些高级特性，我们将使用三个<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/custom-data-identifiers.html" rel="noopener ugc nofollow" target="_blank">自定义数据标识符</a>。根据Macie的文档，自定义数据标识符是您定义的一组标准，反映了您组织的特定专有数据，例如，员工id、客户帐号或内部数据分类。我们将创建三个自定义数据标识符来检测特定Synthea格式的患者ID、美国司机号和美国护照号列。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/38d5dc576c82bfc7c2cd660cb49f6509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-6WFiYcbA35UxcE6BjMsQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">Post的三个自定义数据标识符</figcaption></figure><p id="c2b9" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">本文中的自定义数据标识符使用了正则表达式(<em class="ns"> regex </em>)和关键字的组合。标识符设计用于处理结构化数据，如CSV文件。如果这些关键字中的任何一个出现在存储文本的列或字段的名称中，或者文本在字段值中这些单词之一的最大匹配距离内，Macie将报告与regex模式匹配的文本。Macie <a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/custom-data-identifiers.html#custom-data-identifiers-regex-support" rel="noopener ugc nofollow" target="_blank">支持</a>Perl兼容正则表达式(PCRE)库提供的regex模式语法的子集。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/4dd30b312cc97c466696cce65033fc04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*buPgNr_kWYvlnurvp6Hsag.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">患者ID自定义数据标识符控制台</figcaption></figure><h2 id="4645" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">启用Macie</h2><p id="2c58" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在使用本演示的资源创建CloudFormation堆栈之前，您需要从AWS管理控制台启用Amazon Macie，或者使用带有<code class="fe nf ng nh ni b">enable-macie</code>命令的<code class="fe nf ng nh ni b"><a class="ae mb" href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/macie2/index.html" rel="noopener ugc nofollow" target="_blank">macie2</a></code> API和AWS CLI。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="1200" class="mt kj it ni b gy nn no l np nq">aws macie2 enable-macie</span></pre><p id="56fb" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">您的多帐户<a class="ae mb" href="https://aws.amazon.com/organizations/" rel="noopener ugc nofollow" target="_blank"> AWS组织</a>也可以启用Macie。<code class="fe nf ng nh ni b">enable-organization-admin-account</code>命令指定一个账户作为AWS组织的委托Amazon Macie管理员账户。有关更多信息，请参见<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/macie-accounts.html" rel="noopener ugc nofollow" target="_blank">在Amazon Macie中管理多个账户</a>。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="5967" class="mt kj it ni b gy nn no l np nq">AWS_ACCOUNT=111222333444</span><span id="88c4" class="mt kj it ni b gy nr no l np nq">aws macie2 enable-organization-admin-account \<br/>    --admin-account-id ${AWS_ACCOUNT}</span></pre><h2 id="42ef" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">云形成堆栈</h2><p id="b456" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要使用提供的模板<code class="fe nf ng nh ni b"><a class="ae mb" href="https://github.com/garystafford/macie-demo/blob/main/cloudformation/macie_demo.yml" rel="noopener ugc nofollow" target="_blank">cloudformation/macie_demo.yml</a></code>创建CloudFormation堆栈，请运行以下AWS CLI命令。您需要将电子邮件地址和电话号码作为输入参数。当Macie产生<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/findings-types.html#findings-sensitive-data-types" rel="noopener ugc nofollow" target="_blank">敏感数据发现</a>时，这些参数值将用于发送电子邮件和文本警报。</p><p id="8be9" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><em class="ns">在继续之前，请确保您了解创建CloudFormation堆栈的所有潜在成本和安全影响。</em></p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="66b6" class="mt kj it ni b gy nn no l np nq">SNS_PHONE="+12223334444"<br/>SNS_EMAIL="your-email-address@email.com"<br/><br/>aws cloudformation create-stack \<br/>  --stack-name macie-demo \<br/>  --template-body file://cloudformation/macie_demo.yml \<br/>  --parameters ParameterKey=SNSTopicEndpointSms,ParameterValue=${SNS_PHONE} \<br/>  ParameterKey=SNSTopicEndpointEmail,ParameterValue=${SNS_EMAIL} \<br/>  --capabilities CAPABILITY_NAMED_IAM</span></pre><p id="a0a4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">如AWS CloudFormation控制台所示，新的<code class="fe nf ng nh ni b">macie-demo</code>栈将包含21个AWS资源。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/e8815d72127ff93cc5149728b0921224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rx1OX9lqOGKhjrAJwRMhyA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">成功创建云形成堆栈</figcaption></figure><h2 id="3577" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">上传数据</h2><p id="8834" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，随着栈的部署，将CSV格式的数据文件上传到加密的S3桶，代表您的数据湖。目标S3时段具有以下命名约定，<code class="fe nf ng nh ni b">synthea-data-&lt;aws_account_id&gt;-&lt;region&gt;</code>。您可以从<a class="ae mb" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" rel="noopener ugc nofollow" target="_blank"> AWS Systems Manager参数存储库</a>中检索两个新的bucket名称，它们是由CloudFormation使用<code class="fe nf ng nh ni b">ssm</code> API编写的。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="5b76" class="mt kj it ni b gy nn no l np nq">aws ssm get-parameters-by-path \<br/>  --path /macie_demo/ \<br/>  --query 'Parameters[*].Value'</span></pre><p id="c61d" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">使用以下<code class="fe nf ng nh ni b">ssm</code>和<code class="fe nf ng nh ni b">s3</code> API命令上传数据文件。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="835f" class="mt kj it ni b gy nn no l np nq">DATA_BUCKET=$(aws ssm get-parameter \<br/>    --name /macie_demo/patient_data_bucket \<br/>    --query 'Parameter.Value')</span><span id="8d15" class="mt kj it ni b gy nr no l np nq">aws s3 cp synthea_data/ \<br/>    "s3://$(eval echo ${DATA_BUCKET})/patient_data/" --recursive</span></pre><p id="a724" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">您应该在S3存储桶中找到16个CSV文件，总共大约82.3 MB。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/76bd45c8f18997ef7eca948e465ea290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vx4wxOt9OIL3IOu0spyVrg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">合成患者数据文件上传至S3</figcaption></figure><h2 id="5d5d" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">敏感数据发现作业</h2><p id="816a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">随着CloudFormation堆栈的创建和患者数据文件的上传，我们将创建两个敏感数据发现作业。这些作业将扫描加密S3存储桶的内容以查找敏感数据，并报告结果。根据<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/discovery-jobs.html" rel="noopener ugc nofollow" target="_blank">文档</a>，您可以将敏感数据发现作业配置为仅运行一次以进行按需分析和评估，或者重复运行以进行定期分析、评估和监控。在本次演示中，我们将使用AWS CLI创建一次性敏感数据发现作业。我们还将使用AWS SDK for Python (Boto3)创建一个重复的敏感数据发现作业。这两个作业也可以在Macie的作业控制台中创建。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/74aeb634ba0fe1a33dbb7e53d2bb7240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v9P1wCGihg3Kc1xqQTPwmQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">创建新作业Macie的作业控制台</figcaption></figure><p id="0bdd" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">对于这两个敏感数据发现作业，我们将包括三个自定义数据标识符。每个自定义数据标识符都有一个唯一的ID。我们将需要这三个id来创建两个敏感数据发现作业。您可以使用AWS CLI和<code class="fe nf ng nh ni b">macie2</code> API来检索这些值。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="9959" class="mt kj it ni b gy nn no l np nq">aws macie2 list-custom-data-identifiers --query 'items[*].id'</span></pre><p id="3332" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">接下来，修改<code class="fe nf ng nh ni b"><a class="ae mb" href="https://github.com/garystafford/macie-demo/blob/main/job_specs/macie_job_specs_1x.json" rel="noopener ugc nofollow" target="_blank">job_specs/macie_job_specs_1x.json</a></code>文件，添加三个定制数据标识符id。此外，更新您的AWS帐户ID和S3时段名称(第3–5、12和14行)。请注意，由于所有的患者数据文件都是CSV格式，我们将只检查文件扩展名为<code class="fe nf ng nh ni b">csv</code>的文件(第18–33行)。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="5aac" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">上面的JSON模板是使用标准的AWS CLI <code class="fe nf ng nh ni b">generate-cli-skeleton</code>命令生成的。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="efed" class="mt kj it ni b gy nn no l np nq">aws macie2 create-classification-job --generate-cli-skeleton</span></pre><p id="c3a0" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">要使用上述JSON模板创建一次性敏感数据发现作业，请运行以下AWS CLI命令。将根据当前时间动态生成唯一的作业名称。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="b301" class="mt kj it ni b gy nn no l np nq">aws macie2 create-classification-job \<br/>    --name $(echo "SyntheaPatientData_${EPOCHSECONDS}") \<br/>    --cli-input-json file://job_specs/macie_job_specs_1x.json</span></pre><p id="989e" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">在Amazon Macie作业控制台中，我们可以看到一个一次性敏感数据发现作业正在运行。采样深度为100时，运行该作业需要几分钟时间。可以调整<code class="fe nf ng nh ni b">samplingPercentage</code> <a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/APIReference/jobs.html#jobs-properties" rel="noopener ugc nofollow" target="_blank">作业属性</a>来扫描任意百分比的数据。如果该值小于100，Macie会随机选择要分析的对象，直到达到指定的百分比，并分析这些对象中的所有数据。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/4b872c2536114304960cf92d1cf2d9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2iXNZfhPAuwT2BL5lD-Njw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">一次性敏感数据发现作业正在运行</figcaption></figure><p id="d518" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">一旦工作完成，<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/findings.html" rel="noopener ugc nofollow" target="_blank">的调查结果</a>将会出现在梅西的调查结果控制台上。除了Macie的<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/managed-data-identifiers.html" rel="noopener ugc nofollow" target="_blank">管理数据标识符</a>之外，使用三个自定义数据标识符，在S3的Synthea患者数据文件中应该总共有十五个发现。应该有六个高严重性调查结果和九个中等严重性调查结果。其中，三个属于个人查找类型，七个属于自定义标识符查找类型，五个属于多重查找类型，同时具有个人和自定义标识符查找类型。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/bd271e5bb00415d97ef89d36e4dc21c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9uAMu_RYqPxWhaSv78z_g.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">Macie的结果控制台显示一次性作业的结果</figcaption></figure><h2 id="670a" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">隔离高严重性发现</h2><p id="f813" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们部署的数据检查工作流使用AWS Lambda函数<code class="fe nf ng nh ni b">macie-object-mover</code>，将所有具有高严重性发现的数据文件隔离到第二个S3存储桶。违规文件被复制到隔离桶，并从源桶中删除。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="875f" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">亚马逊事件桥</h2><p id="221d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">根据Macie的<a class="ae mb" href="https://docs.aws.amazon.com/macie/latest/user/findings-publish-event-schemas.html" rel="noopener ugc nofollow" target="_blank">文档</a>，为了支持与其他应用程序、服务和系统的集成，例如监控或事件管理系统，Amazon Macie会自动将发现结果发布到<a class="ae mb" href="https://aws.amazon.com/eventbridge/" rel="noopener ugc nofollow" target="_blank"> Amazon EventBridge </a>作为发现事件。Amazon EventBridge是一个无服务器的事件总线，它使得使用从您的应用程序、集成的软件即服务(SaaS)应用程序和AWS服务生成的事件来大规模构建事件驱动的应用程序变得更加容易。</p><p id="e780" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">CloudFormation堆栈中包括三个Amazon EventBridge规则。根据发现的类型和严重性，每个规则都将发现事件链接到电子邮件或文本消息警报。如果发现的严重性很高，EventBridge规则<code class="fe nf ng nh ni b">macie-rule-high</code>会触发Lambda<code class="fe nf ng nh ni b">macie-object-mover</code>，将文件移动到隔离状态。亚马逊SNS也发送SMS文本消息。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/7b3d7ea6a9511cf13a0c614a1cab9ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6p2-T-Evx4NnNQErIAaElA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">Post的事件规则，显示在Amazon EventBridge控制台中</figcaption></figure><p id="d2c8" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">每个EventBridge规则都包含一个事件模式。事件模式用于过滤特定模式的传入事件流。当Macie发现基于任何自定义数据标识符<code class="fe nf ng nh ni b">macie-rule-custom</code>时触发的EventBridge规则使用如下所示的事件模式。该模式检查触发事件的三个自定义数据标识符名称之一的查找事件。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="cac5" class="mt kj it ni b gy nn no l np nq">{<br/>  "source": [<br/><strong class="ni iu">    "aws.macie"<br/></strong>  ],<br/>  "detail-type": [<br/><strong class="ni iu">    "Macie Finding"<br/></strong>  ],<br/>  "detail": {<br/>    "classificationDetails": {<br/>      "result": {<br/>        "customDataIdentifiers": {<br/>          "detections": {<br/>            "name": [<br/><strong class="ni iu">              "Patient ID",<br/>              "US Passport",<br/>              "US Driver License"<br/></strong>            ]<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="ed52" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">包含高严重性发现的六个数据文件将由Lambda移动到隔离桶，由EventBridge触发。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nv"><img src="../Images/ebb8ba0a61f95656a64c2f88365eda5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0J8f4oW6tt_7yHICxT_J3g.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">包含具有高严重性发现的数据文件的隔离存储桶</figcaption></figure><h2 id="d5f7" class="mt kj it bd kk mu mv dn ko mw mx dp ks lj my mz ku ln na nb kw lr nc nd ky ne bi translated">计划的敏感数据发现作业</h2><p id="7f01" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">数据源通常在重复的基础上交付数据，例如夜间数据馈送。对于这些类型的数据源，我们可以安排敏感数据发现作业按计划运行。在本演示中，我们将使用用于Python的AWS SDK(boto 3)创建一个计划作业。与基于AWS CLI的一次性作业不同，您不需要修改项目的脚本，<code class="fe nf ng nh ni b"><a class="ae mb" href="https://github.com/garystafford/macie-demo/blob/main/scripts/create_macie_job_daily.py" rel="noopener ugc nofollow" target="_blank">scripts/create_macie_job_daily.py</a></code>。Python脚本将检索您的AWS帐户ID和三个自定义数据标识符ID。Python脚本然后运行<code class="fe nf ng nh ni b"><a class="ae mb" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/macie2.html#Macie2.Client.create_classification_job" rel="noopener ugc nofollow" target="_blank">create_classification_job</a></code>命令。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="cea4" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">要创建计划的敏感数据发现作业，请运行以下命令。</p><pre class="md me mf mg gt nj ni nk nl aw nm bi"><span id="6933" class="mt kj it ni b gy nn no l np nq">python3 ./scripts/create_macie_job_daily.py</span></pre><p id="3d19" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated"><code class="fe nf ng nh ni b">scheduleFrequency</code>参数被设置为<code class="fe nf ng nh ni b">{ 'dailySchedule': {} }</code>。该值指定运行作业的每日重复模式。<code class="fe nf ng nh ni b">create_classification_job</code>命令的<code class="fe nf ng nh ni b">initialRun</code>参数被设置为<code class="fe nf ng nh ni b">True</code>。这将导致新作业在创建后立即分析所有符合条件的对象，此外还会每天进行分析。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nv"><img src="../Images/ab43eb23c8b53fe23b4b7557888ecb86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdNtSGOhcOO0i5aI8_ejJQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">处于活动/空闲状态的计划敏感数据发现作业</figcaption></figure><h1 id="518f" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">结论</h1><p id="4d34" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这篇文章中，我们了解了如何使用Amazon Macie来发现和保护亚马逊S3的敏感数据。我们学习了如何使用自动化来根据Macie的发现触发警报，并根据发现的类型隔离数据文件。邮政的数据检查工作流程可以很容易地整合到现有的数据湖摄取管道，以确保传入数据的完整性。</p></div><div class="ab cl nw nx hx ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="im in io ip iq"><p id="bb9f" class="pw-post-body-paragraph la lb it lc b ld lw ju lf lg lx jx li lj ly ll lm ln lz lp lq lr ma lt lu lv im bi translated">这篇博客代表我自己的观点，而不是我的雇主亚马逊网络服务公司(AWS)的观点。所有产品名称、徽标和品牌都是其各自所有者的财产。</p></div></div>    
</body>
</html>