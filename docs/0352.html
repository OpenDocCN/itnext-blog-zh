<html>
<head>
<title>How to use Google reCaptcha with Vuejs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Vuejs中使用Google reCaptcha</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-google-recaptcha-with-vuejs-7756244400da?source=collection_archive---------0-----------------------#2018-02-25">https://itnext.io/how-to-use-google-recaptcha-with-vuejs-7756244400da?source=collection_archive---------0-----------------------#2018-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="245e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是最终产品的演示。</p><p id="1ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.linkedin.com/cws/share?url=https%3A%2F%2Fitnext.io%2Fhow-to-use-google-recaptcha-with-vuejs-7756244400da" rel="noopener ugc nofollow" target="_blank"> <em class="km">点击这里在LinkedIn </em> </a>上分享这篇文章</p><p id="eb91" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谷歌reCaptcha是一个很好的方法来检查你的应用程序/网站上的垃圾邮件和虚假账户。在本教程中，我们将了解如何将reCaptcha添加到vuejs应用程序的<em class="km">register</em>/<em class="km">sign</em><em class="km">up</em>页面，以确保注册的人确实是人。流程如下。</p><ol class=""><li id="4df9" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">用户填写注册表单并提交。</li><li id="6f05" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">Google reCaptcha开始判断用户是否不是机器人。我们将使用一个<a class="ae kl" href="https://developers.google.com/recaptcha/docs/invisible" rel="noopener ugc nofollow" target="_blank">不可见的reCaptcha </a>，这意味着用户的验证可以在他们不知道的情况下发生。如果reCaptcha不能不引人注目地确定他们是否是人类，则可能会向用户提出一个挑战来完成。</li><li id="8994" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">一旦验证完成，reCaptcha将发出一个带有令牌的事件，表明用户已经过验证。在用户通过验证之前，不会触发此事件。</li><li id="780b" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">我们将把这个令牌和注册表单一起提交给我们的服务器。我们做的第一件事是验证令牌是否正确。为此，我们需要调用reCaptcha API。</li></ol><p id="c432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将把前端和后端分成一个客户端和API。让我们从客户开始。</p><h1 id="e301" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">前端</h1><p id="27d5" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">首先我们需要<a class="ae kl" href="https://www.google.com/recaptcha/admin#list" rel="noopener ugc nofollow" target="_blank">创建一个reCaptcha实例</a>。你需要一个谷歌帐户。前往<a class="ae kl" href="https://www.google.com/recaptcha/admin#list" rel="noopener ugc nofollow" target="_blank">https://www.google.com/recaptcha/admin#list</a>。您将看到以下表格:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi me"><img src="../Images/35cb2d20334c5e66b25cd754e23dc2d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMsiz8kEbGfdbaw7eQZ9mg.png"/></div></div></figure><p id="0219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">填写表格:你可以使用任何你想要的标签。选择<em class="km">隐形验证码</em>选项<em class="km">，</em>输入你的应用将被托管的域——我刚刚为这个演示选择了localhost。接受条款和条件并点击<em class="km">注册</em>。在下一页，记下站点密钥和机密，我们稍后会用到它们。</p><p id="cf56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">前端将有3个依赖项:</p><ul class=""><li id="7919" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk mq kt ku kv bi translated">Google reCaptcha—<a class="ae kl" href="https://www.google.com/recaptcha/api.js" rel="noopener ugc nofollow" target="_blank">https://www.google.com/recaptcha/api.js</a></li><li id="cef0" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk mq kt ku kv bi translated">vue JS—<a class="ae kl" href="https://unpkg.com/vue-recaptcha@latest/dist/vue-recaptcha.min.js" rel="noopener ugc nofollow" target="_blank">https://UNP kg . com/vue-recaptcha @ latest/dist/vue-recaptcha . min . JS</a></li><li id="0c3d" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk mq kt ku kv bi translated">vue-recaptcha—<a class="ae kl" href="https://unpkg.com/vue@latest/dist/vue.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/vue@latest/dist/vue.js</a>(github<a class="ae kl" href="https://github.com/DanSnow/vue-recaptcha" rel="noopener ugc nofollow" target="_blank">https://github.com/DanSnow/vue-recaptcha</a>)</li></ul><p id="3e2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km"> //index.html </em></p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">完整gist在<a class="ae kl" href="https://gist.github.com/sellomkantjwa/14da94687ba8759152ac807d8a4b837c" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/sellomkantjwa/14d a 94687 ba 8759152 AC 807d 8 a4b 837 c</a></figcaption></figure><p id="ece5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们给我们的根div一个app的id。我们将用它来让Vue知道我们的应用程序的根目录在哪里。在底部，我们有3个依赖脚本Vue，Vue-re-raptcha和Google reCaptcha。此外，我们包含了<em class="km"> index.js，</em>它保存了我们应用程序的核心逻辑。除了<code class="fe mx my mz na b">vue-recaptcha</code>标签之外，这个表单非常标准，它是reCaptcha的vue组件包装器。我们向组件传递两个处理程序:</p><ul class=""><li id="8cff" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk mq kt ku kv bi translated">验证—一旦验证了用户，就调用</li><li id="36b3" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk mq kt ku kv bi translated">expired —当reCaptcha过期时调用。过期的reCaptcha必须重新加载才能再次工作。</li></ul><p id="9b36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还传入了注册reCaptcha实例时获得的<em class="km"> sitekey </em>和一个<em class="km"> invisible </em>的大小，用于reCaptcha的不可见变体。</p><p id="033d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应用的核心位于<em class="km"> index.js </em></p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="c7e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当用户按下注册按钮时，调用<em class="km">提交</em>方法。我们设置了<code class="fe mx my mz na b">this.status=submitting</code>,这样我们就可以禁用注册按钮。这样我们可以避免多次点击，从而避免多次提交。同样在<em class="km">提交</em>方法中，我们调用<code class="fe mx my mz na b"><strong class="jp ir">this</strong>.$refs.recaptcha.execute(), </code>，这告诉reCaptcha开始检查用户是否确实是人类。在这个阶段，有两种情况可能发生。reCaptcha确信用户是人类，并且不要求用户完成挑战<br/> 2。reCaptcha怀疑有不法行为，并要求用户完成一项挑战，以证明他们是人类。</p><p id="dcb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦reCaptcha确信用户是人类(有或没有挑战)，它将调用在我们的<em class="km"> vue-recaptcha </em>组件上指定的<em class="km">验证</em>处理程序。在这种情况下，我们的处理程序是<em class="km">oncaptchaaverified</em>方法。在onCaptchaVerified方法中，我们知道用户已经被验证为人类，我们可以继续向服务器提交表单。</p><p id="73c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个<em class="km"> recaptchaToken </em>被传入到我们的<em class="km">oncaptchaeverified</em>方法中，我们可以将该令牌与我们的注册表单一起发布，以在服务器上再次验证用户已经证明他们不是机器人。重置我们的reCaptcha ( <code class="fe mx my mz na b"><strong class="jp ir">this</strong>.$refs.recaptcha.reset()</code>)非常重要，因为如果服务器出现错误(例如，电子邮件已被使用)，我们将需要再次验证服务器上的用户。我们可以尝试将令牌保存到我们的状态，并在用户重新提交时再次发送到服务器进行验证，但是reCaptcha允许令牌只能用于服务器验证一次，所以这种方法行不通，我们必须重置reCaptcha。我们还在到期时重置reCaptcha，否则当我们试图执行它时会得到一个错误。</p><h1 id="3298" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">后端</h1><p id="4386" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">一旦我们在后端收到令牌，我们需要在注册用户之前验证它是否有效。这相对简单，我们只需要将令牌(作为<em class="km">响应</em>参数发布在主体中)发布给reCaptcha API进行验证。除了令牌之外，我们还必须通过我们的reCaptcha secret发布(告诉您您会需要它，请注意，在下面的示例中，我们已经将它设置为环境变量)。让我们来看看我们的服务器:</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">服务器上的令牌验证码令牌验证(<a class="ae kl" href="https://gist.github.com/sellomkantjwa/27f69adb806b3fb75a9bd3914c297893" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/sellomkantjwa/27 f 69 ADB 806 B3 FB 75 a9 BD 3914 c 297893</a>)</figcaption></figure><p id="231b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，我们将得到一个类似如下的JSON响应:</p><pre class="mf mg mh mi gt nb na nc nd aw ne bi"><span id="6c33" class="nf lc iq na b gy ng nh l ni nj">{<br/>  "success": true|false,<br/>  "challenge_ts": timestamp,  <br/>  "hostname": string,         <br/>  "error-codes": [...]        // optional<br/>}</span></pre><p id="a97c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息见<a class="ae kl" href="https://developers.google.com/recaptcha/docs/verify" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/recaptcha/docs/verify</a>。对我们来说最重要的领域是<code class="fe mx my mz na b">success</code>领域。它指示令牌验证是否成功。如果是，那么我们可以继续添加注册我们的用户，如果不是，我们拒绝用户，并返回一个错误到前端。</p><p id="9df1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！我们现在可以确信我们的用户是合法的。</p><p id="2663" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你错过了，这里的<a class="ae kl" href="http://vue-recaptcha-demo.s3-website-eu-west-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"/>是一个带有<a class="ae kl" href="https://github.com/sellomkantjwa/vue-recaptcha-demo" rel="noopener ugc nofollow" target="_blank">源代码</a>的现场演示。</p></div></div>    
</body>
</html>