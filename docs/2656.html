<html>
<head>
<title>Express server for an Angular application part 7: add cache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular应用程序的快速服务器第7部分:添加缓存</h1>
<blockquote>原文：<a href="https://itnext.io/express-server-for-an-angular-application-part-7-add-cache-f11e8060a2e3?source=collection_archive---------2-----------------------#2019-07-05">https://itnext.io/express-server-for-an-angular-application-part-7-add-cache-f11e8060a2e3?source=collection_archive---------2-----------------------#2019-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="db48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Express.js是为构建web应用程序而设计的Node.js的web应用程序框架，在这一系列文章中，我将一步一步地解释我是如何实现一个具有一些高级功能的Express服务器的，我将这些功能用于我用Angular 7制作的单页面应用程序。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/3fe8d6ab4e60d998c6ff732dbbf122ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyhh0__dl03UXNlBQDmtQA.png"/></div></div></figure><p id="b523" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将讨论我在不同文章中解决的7个主要问题:</p><ol class=""><li id="e1b7" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-1-getting-started-2cd27de691bd?fbclid=IwAR0FqPoqKeBps4QUM3E09aSGKDwjUNKcoZHxPKAB5iBt8dwUbuEol3b7IZ8" rel="noopener">入门</a></li><li id="bf53" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-2-serve-files-from-a-bucket-ae14d23e7cde" rel="noopener">从桶里取文件</a></li><li id="9f67" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-3-redirect-routes-to-an-external-service-d4658ed575cb" rel="noopener">将一些呼叫重定向到外部服务</a></li><li id="7546" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-4-redirect-http-to-https-requests-d4f6e7ed7e93" rel="noopener">将http重定向到https请求</a></li><li id="7343" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-5-redirect-non-www-to-www-requests-b81a7794a4d7" rel="noopener">将非www请求重定向到www请求</a></li><li id="8736" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-5-limit-connections-and-prevent-ddos-e27902cc702b" rel="noopener">限制连接并阻止DDoS </a></li><li id="f65a" class="kx ky iq jp b jq lh ju li jy lj kc lk kg ll kk lc ld le lf bi translated"><a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-7-add-cache-f11e8060a2e3" rel="noopener">处理一些缓存</a></li></ol><p id="f8a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将讨论如何给express server 添加一个缓存层。</p><h1 id="ef3b" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">参考知识库</h1><p id="47a9" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">该项目的一个工作示例可从以下网址获得:</p><p id="19a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lg" href="https://github.com/mzuccaroli/express_server_for_angular_example" rel="noopener ugc nofollow" target="_blank">https://github . com/mzuccaroli/express _ server _ for _ angular _ example</a>主分支包含最终的完整项目，但每篇文章都有一个专用的分支，对于这篇文章，引用<a class="ae lg" href="https://github.com/mzuccaroli/express_server_for_angular_example/tree/develop" rel="noopener ugc nofollow" target="_blank">https://github . com/mzuccaroli/express _ server _ for _ angular _ example/tree/develop</a></p><h1 id="2ce6" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">关于环境</h1><p id="cb50" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">对于这个特性，就像在我选择为开发和生产引入不同行为之前开发的特性一样，就像在本教程的前一部分“<a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-4-redirect-http-to-https-requests-d4f6e7ed7e93" rel="noopener">如何将http请求重定向到https </a>”中一样，我使用“_environment”变量将本地开发行为与生产行为分开。更多<a class="ae lg" href="https://medium.com/@marcozuccaroli/express-server-for-an-angular-application-part-4-redirect-http-to-https-requests-d4f6e7ed7e93" rel="noopener">信息见文章</a></p><h1 id="e7c3" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">为什么缓存</h1><p id="2bfb" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">根据定义，Angular应用程序是一组静态文件，其中一些文件，如字体、图像和主js，可能会很大，因此express服务器的主要工作是不断地获取这组有限的文件，并将它们提供给用户。<br/> <strong class="jp ir">这是添加一个小缓存层</strong>的理想情况，它将大大提高你的服务器性能。</p><h1 id="a304" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">添加缓存层</h1><p id="d184" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">主要思想是为桶获取的请求执行内存缓存，这些文件在数量上是有限的并且是静态的，所以我们不需要担心大量的内存使用。在nodejs中执行它而不添加复杂层的工具是<em class="mp">节点缓存</em>，它将在键值存储中缓存您的响应对象。</p><p id="b940" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先安装节点缓存</p><blockquote class="mq mr ms"><p id="ade3" class="jn jo mp jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated">npm安装内存-缓存-保存</p></blockquote><p id="09bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将其导入您的服务器:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8023" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以添加缓存处理函数:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3f6b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您可以看到的，这两个函数主要是在内存缓存中放置和检索对象，getCache函数是根据快速调用链编写的，因此您可以在每次处理这样的请求时调用它:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="e25f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意“cache.getcache()”函数是app.all()函数的一个参数，而cache.handleResponse()是在第二个函数中显式调用的，因此，如果所需的对象在缓存中，则直接由getcache函数提供，否则，如果没有缓存的对象，handleResponse函数将从桶中检索它，放入内存缓存中，并将其提供给主函数。</p><p id="eff1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在所有处理程序中添加缓存方法，并大幅提高服务器性能。你可以在这里看到完整的工作示例:<a class="ae lg" href="https://github.com/mzuccaroli/express_server_for_angular_example" rel="noopener ugc nofollow" target="_blank">https://github . com/mzuccaroli/express _ server _ for _ angular _ example</a></p><h1 id="7a33" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">关于字体文件的说明</h1><p id="5492" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">本文和参考示例<strong class="jp ir">的灵感来自于一个在生产环境</strong>中运行的真实项目，因此在<strong class="jp ir">压力测试</strong>阶段，我注意到了字体文件的一个问题:在某些情况下，缓存的字体文件被损坏，我未能理解这个问题的真正原因，所以我将它们从缓存中排除，对handleresponse()函数做了如下小修改:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="395f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它并不完美，但工作得很好，正如你所看到的<strong class="jp ir">这不是“hello world”</strong>演示，而是在生产中运行的真实代码，如果将来我会解决字体问题，这篇文章将会更新，如果你找到了解决方案，请写信给我！</p></div></div>    
</body>
</html>