<html>
<head>
<title>A portable WiFI router/NAS/Docker using RaspAP on Raspberry Pi 4 with USB/SSD boot device</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Raspberry Pi 4上使用RaspAP的便携式WiFI路由器/NAS/Docker，带有USB/SSD引导设备</h1>
<blockquote>原文：<a href="https://itnext.io/a-portable-wifi-router-nas-docker-using-raspap-on-raspberry-pi-4-with-usb-ssd-boot-device-a64cd4a68d6f?source=collection_archive---------2-----------------------#2022-07-12">https://itnext.io/a-portable-wifi-router-nas-docker-using-raspap-on-raspberry-pi-4-with-usb-ssd-boot-device-a64cd4a68d6f?source=collection_archive---------2-----------------------#2022-07-12</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="2fe8" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">在使用固态硬盘的便携设备上安装DIY路由器/NAS/etc，以获得更高的速度和可靠性</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/01a32f316ed2c4bd74ea382bcc532ad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hiqSUU3KstgR6SQS.png"/></div></div></figure><p id="1735" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">RaspAP允许我们在基于Debian的系统上构建WiFi路由器，比如Raspberry Pi。它可以轻松构建一个复杂的WiFi路由器，同时运行其他服务。</p><p id="9604" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您可以构建自己的WiFi路由器，提供比商用路由器更多的功能，会怎么样？商用路由器处理WiFi网络、本地以太网和广域网之间的路由互联网流量。通常，这是它们的功能范围，尽管有些有一个支持磁盘驱动器或打印机的USB端口。如果我们能造出一个功能更多的电脑会怎么样？</p><p id="0ab0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">一个Raspberry Pi，加上合适的软件，可以制作一个非常好的WiFi路由器，也可以运行其他软件。一种选择是安装OpenWRT，这是一种专业级路由器软件，甚至被用作实际商业WiFi路由器的固件。它可以在树莓Pi上运行，我最近也尝试了一下。但是，我看不出有什么方法可以和OpenWRT一起运行其他服务。我对使用Raspberry Pi作为路由器很感兴趣，它还可以处理其他任务，如网络连接存储(NAS)。</p><p id="69d0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">另一方面，RaspAP不会接管机器。您可以安装自己选择的操作系统，然后在该操作系统中安装RaspAP，而不是安装为RaspAP预先定制的操作系统映像。嗯，“您选择的<em class="lr">操作系统</em>”仅限于RaspAP团队支持的操作系统。他们的网站目前列出了<em class="lr"> Raspberry Pi OS </em>、<em class="lr"> Armbian </em>、<em class="lr"> Debian </em>、<em class="lr"> Ubuntu </em>，它们都是Debian Linux的变种。RaspAP似乎也可以作为Docker图像使用。</p><p id="fd63" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我得出的一个观点是，对于基于Raspberry Pi的路由器来说，最好从普通磁盘驱动器启动，而不是从SD卡启动。我知道树莓派是基于将操作系统烧录到SD卡上。但是，WiFi路由器是那种你设置好，放在架子上，并期望它在没有干预的情况下运行几年的设备。对于这种应用的主驱动器来说，SD卡简直是最差的选择。因此，主机(也称为Raspberry Pi)最好运行常规磁盘驱动器。对于Raspberry Pi，这意味着使用通过USB连接的常规磁盘驱动器(SSD或HDD)进行引导。</p><p id="bd1e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">有关几篇相关文章，请参见:</p><ul class=""><li id="124c" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><a class="ae mb" href="https://techsparx.com/linux-sbc/raspberry-pi/pi4-boot-usb.html" rel="noopener ugc nofollow" target="_blank">如何从USB驱动器启动Raspberry Pi 4或400</a>—从USB驱动器启动Raspberry Pi的指南</li><li id="be58" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><a class="ae mb" href="https://techsparx.com/linux-sbc/raspberry-pi/pi4-openwrt.html" rel="noopener ugc nofollow" target="_blank">使用USB引导设备在Raspberry Pi 4上安装OpenWRT</a>—也许你更喜欢OpenWRT？</li></ul><p id="e36e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">安装RaspAP的高级过程是:</p><ul class=""><li id="2ea8" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">用Raspberry Pi OS(或其他支持的OS)刻录SD卡(或u盘)。您可能应该使用Lite版本——没有GUI支持——因为这种设备可能不会用于桌面用户体验</li><li id="390c" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">使用以太网线将您的Raspberry Pi连接到您的互联网路由器</li><li id="e69f" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">从SD卡(或USB驱动器)启动Raspberry Pi</li><li id="e4d8" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">设置:<code class="fe mh mi mj mk b">sudo apt-get update &amp;&amp; sudo apt-get full-upgrade -y</code></li><li id="ef4f" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">重新启动</li><li id="2d40" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">配置:<code class="fe mh mi mj mk b">sudo raspi-config</code></li><li id="56a8" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">重启— <code class="fe mh mi mj mk b">raspi-config</code>可能会要求重启</li><li id="3338" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">安装:<code class="fe mh mi mj mk b">curl -sL https://install.raspap.com | bash</code></li><li id="fc65" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">访问RaspAP web GUI并开始配置</li></ul><p id="a39d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">更多文档位于:<a class="ae mb" href="https://raspap.com/" rel="noopener ugc nofollow" target="_blank">https://raspap.com/</a></p><p id="0536" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">接下来是我自己的旅程，并没有上面的概述那么简单。运行这种组合有几个技巧。</p><p id="d2eb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我的测试系统是一个2GB的Raspberry Pi 4，安装在FLIRC机箱中，外部机箱中有一个Kingston 2.5英寸480GB SSD驱动器。我有一个EDIMAX品牌的USB WiFi模块，可以测试多种WiFi场景。该系统的图片在文章的底部。</p><p id="4eb2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我最终的目标是这个组合:</p><ul class=""><li id="db97" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">允许<code class="fe mh mi mj mk b">eth0</code>连接到本地局域网，或者直接连接到笔记本电脑，但是<code class="fe mh mi mj mk b">eth0</code>是可选的</li><li id="3ee5" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">使用<code class="fe mh mi mj mk b">wlan0</code>(Raspberry Pi上的内置WiFi)将WiFi连接到主机网络，比如我家的WiFi系统</li><li id="1f38" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">使用WiFi加密狗提供托管接入点</li><li id="e452" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">使用固态硬盘作为启动驱动器，并支持根据需要热连接其他驱动器</li><li id="52f7" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">一个附加服务是使用Samba导出文件系统</li></ul><h1 id="60a9" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">RaspAP初始设置的混乱——在Raspberry Pi操作系统上调试PAM配置</h1><p id="5984" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">在我的第一次尝试中，我在第<code class="fe mh mi mj mk b">raspi-config</code>步做出了不幸的选择。这使得RaspAP的设置不正确，导致了对PAM子系统的一些探索。我在调试这个的时候学到了一些东西，可能会有用。</p><p id="3b2a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果你想阅读工作建议，跳过这一节。本节旨在为遇到类似问题的人提供有用的建议。</p><p id="6541" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">第一个线索是RaspAP安装脚本没有完成就“冻结”了。也就是说，它收到了一条关于设置NAT服务的消息，输出停止了，过了一段时间，到Raspberry Pi的SSH连接中断了。SSH回到路由器显示它运行良好，RaspAP web GUI正在运行，我可以摆弄一些东西。</p><p id="9251" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">但是，当我试图创建一个WiFi热点时，我不断得到一个错误— <em class="lr">无法保存热点设置</em>。这个模糊的错误信息令人不满意。在热点区域，有一个<em class="lr">日志</em>标签，你可以打开它查看关于<code class="fe mh mi mj mk b">hostapd</code>服务的细节。但是这对于最初的问题是没有用的。</p><p id="fe6e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">相反，<code class="fe mh mi mj mk b">/var/log/auth.log</code>中的这些信息更为重要。</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="5e76" class="nm mm iu mk b gz nn no l np nq">Jul  5 18:28:48 router sudo: pam_unix(sudo:auth): conversation failed<br/>Jul  5 18:28:48 router sudo: pam_unix(sudo:auth): auth could not identify password for [www-data]<br/>Jul  5 18:28:48 router sudo: www-data : user NOT in sudoers ; PWD=/var/www/html ; USER=root ; COMMAND=/sbin/iw dev wlan0 set txpower auto</span></pre><p id="0ebb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">为了解释这一点，RaspAP软件试图使用<code class="fe mh mi mj mk b">sudo</code>来做一些事情。PAM系统(<code class="fe mh mi mj mk b">sudo:auth</code>)说它不能识别<code class="fe mh mi mj mk b">www-data</code>的密码，并且这个用户名不在<code class="fe mh mi mj mk b">sudoers</code>文件中。</p><p id="d9cc" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">第一阶段的解决方案是运行:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="21d5" class="nm mm iu mk b gz nn no l np nq">$ sudo usermod -aG sudo www-data</span></pre><p id="5b8a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这将把<code class="fe mh mi mj mk b">www-data</code>用户ID添加到<code class="fe mh mi mj mk b">sudo</code>组，允许该用户ID使用<code class="fe mh mi mj mk b">sudo</code>命令。</p><p id="0be8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">之后,<code class="fe mh mi mj mk b">auth.log</code>消息演变为:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="df43" class="nm mm iu mk b gz nn no l np nq">Jul 5 19:02:31 router sudo: pam_unix(sudo:auth): conversation failed Jul 5 19:02:31 router sudo: pam_unix(sudo:auth): auth could not identify password for</span></pre><p id="5a5a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">经过大量的搜索(和一个<a class="ae mb" href="https://stackoverflow.com/questions/58509304/pam-requires-password-for-exec-shell-exec-even-with-nopasswd-in-etc-sudoers" rel="noopener ugc nofollow" target="_blank">堆栈溢出post </a>)我发现可以使用<code class="fe mh mi mj mk b">visudo</code>向<code class="fe mh mi mj mk b">sudoers</code>文件添加一个条目:</p><p id="f4bc" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">将这一行放在文件的底部，而不是中间的某个地方。这允许<code class="fe mh mi mj mk b">www-data</code>使用<code class="fe mh mi mj mk b">sudo</code>而无需在系统中注册密码。</p><p id="3ced" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">此后,<code class="fe mh mi mj mk b">auth.log</code>消息变为:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="fa58" class="nm mm iu mk b gz nn no l np nq">www-data ALL=(ALL) NOPASSWD: ALL</span></pre><p id="2d8f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这表示活动成功。事实上，我现在可以更改设置了，但我仍然无法打开WiFi系统。</p><p id="1d2d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr">日志</em>选项卡(<code class="fe mh mi mj mk b">hostapd</code>)中，显示了以下消息:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="6181" class="nm mm iu mk b gz nn no l np nq">Jul  5 19:58:28 router sudo: www-data : PWD=/var/www/html ; USER=root ; COMMAND=/bin/chmod o+r /tmp/hostapd.log<br/>Jul  5 19:58:28 router sudo: pam_unix(sudo:session): session opened for user root(uid=0) by (uid=33)<br/>Jul  5 19:58:28 router sudo: pam_unix(sudo:session): session closed for user root</span></pre><p id="f62b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这表示活动成功。事实上，我现在可以更改设置了，但我仍然无法打开WiFi系统。</p><p id="63ed" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr">日志</em>选项卡(<code class="fe mh mi mj mk b">hostapd</code>)中，显示了以下消息:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="6580" class="nm mm iu mk b gz nn no l np nq">Configuration file: /etc/hostapd/hostapd.conf<br/>Could not read interface uap0 flags: No such device<br/>nl80211: Driver does not support authentication/association or connect commands<br/>nl80211: deinit ifname=uap0 disabled_11b_rates=0<br/>Could not read interface uap0 flags: No such device<br/>nl80211 driver initialization failed.<br/>uap0: interface state UNINITIALIZED-&gt;DISABLED<br/>uap0: AP-DISABLED <br/>uap0: CTRL-EVENT-TERMINATING <br/>hostapd_free_hapd_data: Interface uap0 wasn't started</span></pre><p id="87f0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在那一点上，我被难住了。是的，<code class="fe mh mi mj mk b">uap0</code>设备不存在等。我上床睡觉，考虑这个问题，早上决定从头开始。</p><h1 id="afae" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">安装RaspAP时不正确使用<code class="fe mh mi mj mk b">raspi-config</code></h1><p id="8867" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">上一节讨论的问题原来是因为我在运行<code class="fe mh mi mj mk b">raspi-config</code>时做了一个错误的选择。即使用<code class="fe mh mi mj mk b">raspi-config</code>开启WiFi支持。这个选择似乎导致了RaspAP的安装脚本偏离了轨道，并导致RaspAP被错误地安装。</p><p id="8a37" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<code class="fe mh mi mj mk b">raspi-config</code>中进行这些设置更改:</p><ul class=""><li id="cc13" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">设置你喜欢的主机名——我用的是<code class="fe mh mi mj mk b">router</code></li><li id="85bf" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">要求控制台要求使用用户名和密码登录，而不是支持自动登录</li><li id="692b" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">启用SSH登录</li></ul><p id="edb7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当我进行额外的设置更改时，失败了。如果使用<code class="fe mh mi mj mk b">raspi-config</code>使WiFi连接到我的家庭局域网，那么RaspAP安装在这里失败:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/5695ce9d3335835b5ca86eae75d50694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R8JXsG0RiZp0jx9Q.jpg"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">作者图片</figcaption></figure><p id="143d" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这个屏幕截图显示了应该发生的事情。两个<em class="lr">添加规则</em>行被打印出来，它询问是否启用RaspAP等等。最后，脚本运行到最后并重启系统。</p><p id="b9ef" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在故障模式下，我使用<code class="fe mh mi mj mk b">raspi-config</code>启用了WiFi，在第一行显示<em class="lr">添加规则:-t nat之后...</em>，进程停止打印任何东西。过了一会儿，我点击<em class="lr"> RETURN </em>，SSH会话断开。我可以重新连接到Raspberry Pi，它看起来很好，并且RaspAP GUI正在运行，但是出现了前面讨论过的故障。</p><p id="3143" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我经历了这个过程足够多次，我确信在<code class="fe mh mi mj mk b">raspi-config</code>步骤中启用WiFi时会出现错误。当我使用<code class="fe mh mi mj mk b">raspi-config</code>跳过启用WiFi之后，安装脚本就正确地运行完成了。此外，RaspAP GUI工作正常，这意味着在热点部分所做的更改可以正确注册。</p><h1 id="dab1" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">使用RaspAP web GUI启用WiFi</h1><p id="acaa" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">在上一节中，我已经说得很清楚了——不要使用<code class="fe mh mi mj mk b">raspi-config</code>来启用WiFi，因为这会导致不正确的安装。</p><p id="afa1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在RaspAP中，我可以在热点区域进行设置更改，但无法启动热点——这意味着WiFi无法打开。RaspAP GUI的左上角是一些指示灯，闪烁的红灯表示热点处于非活动状态。所有其他指标表明，它无法启动我配置的WiFi热点。在<code class="fe mh mi mj mk b">hostapd</code>日志区，出现了以下消息:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="f756" class="nm mm iu mk b gz nn no l np nq">Configuration file: /etc/hostapd/hostapd.conf <br/>rfkill: WLAN soft blocked wlan0: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE <br/>Using interface wlan0 with hwaddr dc:a6:32:3d:f4:7c and ssid "HotSpot" <br/>Failed to set beacon parameters <br/>wlan0: Could not connect to kernel driver <br/>Interface initialization failed wlan0: interface state COUNTRY_UPDATE-&gt;DISABLED <br/>wlan0: AP-DISABLED  <br/>wlan0: Unable to setup interface. <br/>wlan0: interface state DISABLED-&gt;DISABLED <br/>wlan0: AP-DISABLED  <br/>wlan0: CTRL-EVENT-TERMINATING <br/> hostapd_free_hapd_data: Interface wlan0 wasn't started <br/>nl80211: deinit ifname=wlan0 disabled_11b_rates=0</span></pre><p id="fe00" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">注意第二行讨论了<code class="fe mh mi mj mk b">rfkill</code>。在RaspAP文档中，手动配置说明包含讨论<code class="fe mh mi mj mk b">rfkill</code>阻止WiFi系统的章节。</p><p id="0674" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">给出的解决方案是:</p><ol class=""><li id="00b9" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq nw ly lz ma bi translated">使用<code class="fe mh mi mj mk b">raspi-config</code>来设置WiFi区域设置——但没有使用它来打开WiFi——可以使用RaspAP GUI来设置WiFi区域设置</li><li id="ec80" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq nw ly lz ma bi translated">之后需要重新启动(通过raspi-config)</li><li id="b5a8" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq nw ly lz ma bi translated">重启后:<code class="fe mh mi mj mk b">sudo rfkill unblock wlan</code></li></ol><p id="5301" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在RaspAP中，指示器“热点激活”立即变为绿色，而之前它一直是红色闪烁的。</p><p id="253e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在运行了<code class="fe mh mi mj mk b">rfkill unblock</code>之后，我能够对RaspAP进行一些修改，并以正常的方式反映出来。</p><h1 id="2f0c" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">配置RaspAP以通告WiFi网络</h1><p id="4300" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">第一个实验是用你的树莓派做一个WiFi路由器。这意味着使用以太网线将Raspberry Pi连接到您的常规互联网路由器，然后使用Raspberry Pi的内置WiFi创建一个新的WiFi网络。从技术上来说，会配置成WiFi接入点。</p><p id="811b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">默认情况下，RaspAP配置<code class="fe mh mi mj mk b">eth0</code>，即内置以太网端口的设备名称，以从网络上的DHCP服务器接收网络配置和IP地址。该DHCP服务器内置于您的互联网路由器中。您需要调查以找到它被分配的IP地址，例如通过查看路由器管理页面。另一种方法是，当你有一个显示器/键盘连接，登录到命令行，并运行<code class="fe mh mi mj mk b">ifconfig -a</code>。</p><p id="4b75" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于分配给<code class="fe mh mi mj mk b">eth0</code>接口的IP地址，可以在<code class="fe mh mi mj mk b">http://IP-ADDRESS</code>到达RaspAP web GUI。或者，在运行<code class="fe mh mi mj mk b">raspi-config</code>时，您给了Raspberry Pi一个主机名。您可以使用<code class="fe mh mi mj mk b"><a class="ae mb" href="http://HOST-NAME.local." rel="noopener ugc nofollow" target="_blank">http://HOST-NAME.local</a></code> <a class="ae mb" href="http://HOST-NAME.local." rel="noopener ugc nofollow" target="_blank">进行连接。</a></p><p id="de80" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">下一步是转到RaspAP web GUI的热点部分。有三个感兴趣的选项卡。在选项卡中进行如下设置更改:</p><ul class=""><li id="df23" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><em class="lr">基础设置</em></li><li id="1a10" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">接口</em> —保留为<code class="fe mh mi mj mk b">wlan0</code></li><li id="be12" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr"> SSID </em> —选择一个网络名称</li><li id="41f1" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">无线模式</em> —别管这个？</li><li id="15be" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">频道</em> —如果需要，选择一个频道号</li><li id="19bd" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">安全</em></li><li id="d5ba" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">安全类型</em> — WPA2</li><li id="3173" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">加密类型</em> — CCMP</li><li id="87b4" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr"> PSK </em> —选择密码</li><li id="c0b4" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">高级设置</em></li><li id="1e47" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">将<em class="lr">发射功率</em>设置为<code class="fe mh mi mj mk b">auto</code></li><li id="9979" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">将<em class="lr">国家代码</em>设置为您所在的国家</li></ul><p id="90ac" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">点击<em class="lr">保存设置</em>按钮，将设置写入配置文件。然后点击<em class="lr">重启热点</em>实施设置更改。</p><p id="9130" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr"> DHCP服务器</em>部分，选择<code class="fe mh mi mj mk b">wlan0</code>接口，确保其配置如下:</p><ul class=""><li id="c43b" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated">选择<em class="lr">静态IP </em>地址</li><li id="38fc" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">静态IP选项</em></li><li id="1c96" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr"> IP地址</em> —选择一个地址，如<code class="fe mh mi mj mk b">10.71.71.1</code></li><li id="2e3d" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">子网掩码</em> —定义相应的掩码，如<code class="fe mh mi mj mk b">255.255.255.0</code></li><li id="4d58" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">默认网关</em> —与IP地址相同</li><li id="8bcb" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr"> DHCP选项</em></li><li id="2a13" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated">设置<em class="lr">启用该接口的DHCP</em></li><li id="0f87" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">起始IP地址</em> —选择网络内的IP地址，例如<code class="fe mh mi mj mk b">10.71.71.20</code></li><li id="3d16" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr">结束IP地址</em> —选择网络内的IP地址，例如<code class="fe mh mi mj mk b">10.71.71.120</code></li><li id="8f37" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><em class="lr"> DNS服务器1 </em>和<em class="lr"> DNS服务器2 </em> —如有需要，选择DNS服务器，如<code class="fe mh mi mj mk b">1.1.1.1</code>或<code class="fe mh mi mj mk b">8.8.8.8</code></li></ul><p id="c787" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">再次点击<em class="lr">保存设置</em>启用这些更改。这确保了WiFi网络上DHCP地址分配的合理设置。创建WiFi网络可能是明智的选择。</p><p id="1538" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在网络区域，您可能会看到如下状态:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nx"><img src="../Images/f23740ff431204bdc20b520d2b9b7ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bRvmoca-o80LhV8T.png"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">作者图片</figcaption></figure><p id="7bf0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mh mi mj mk b">eth0</code>设备是有线以太网，其IP地址与互联网路由器的IP地址相同。<code class="fe mh mi mj mk b">wlan0</code>是内置WiFi，它为您刚刚创建的WiFi网络分配了网络的IP地址。</p><p id="5220" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果你有其他设备，比如智能手机，你可以扫描WiFi网络。新创建的网络应该会出现，并且您应该能够使用您选择的密码加入网络。加入网络后，您的设备应该显示路由器分配的IP地址。</p><p id="a532" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">你应该可以使用这个热点来浏览互联网和做任何其他事情。</p><p id="0388" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">到目前为止，结果是两个网络接口:本地局域网和新的WiFi热点，Raspberry Pi在两者之间路由流量。</p><h1 id="75c0" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">使用第二个WiFi适配器作为WiFi客户端</h1><p id="9dd6" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">RaspAP能够将WiFi接口配置为现有WiFi网络的客户端。我们正在使用内置的WiFi接口来创建我们自己的WiFi网络。我们可以轻松添加一个USB WiFi加密狗来连接现有网络，这样路由器就可以在我们的新WiFi网络和现有网络之间路由。</p><p id="3fd7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">例如，你可能在一家咖啡店。第二个WiFi接口可以连接咖啡店提供的WiFi，你的笔记本电脑或平板电脑可以连接RaspAP创建的WiFi网络。</p><p id="bd1a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于这个测试，我有一个EDIMAX EW-7811UN WiFi加密狗。盒子正面明确写着<em class="lr">非常适合树莓酱</em>。</p><p id="4030" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我只是简单地将它插入树莓Pi上的一个USB端口。查看<code class="fe mh mi mj mk b">/var/log/kern.log</code>和<code class="fe mh mi mj mk b">/var/log/syslog</code>，立即显示消息，确认操作系统识别设备:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="5576" class="nm mm iu mk b gz nn no l np nq"># /var/log/kern.log<br/><br/>Jul  7 20:46:09 router kernel: [86914.640754] usb 1-1.3: new high-speed USB device number 3 using xhci_hcd<br/>Jul  7 20:46:10 router kernel: [86914.772283] usb 1-1.3: New USB device found, idVendor=7392, idProduct=7811, bcdDevice= 2.00<br/>Jul  7 20:46:10 router kernel: [86914.772313] usb 1-1.3: New USB device strings: Mfr=1, Product=2, SerialNumber=3<br/>Jul  7 20:46:10 router kernel: [86914.772335] usb 1-1.3: Product: 802.11n WLAN Adapter<br/>Jul  7 20:46:10 router kernel: [86914.772353] usb 1-1.3: Manufacturer: Realtek<br/>Jul  7 20:46:10 router kernel: [86914.772370] usb 1-1.3: SerialNumber: 00e04c000001<br/>Jul  7 20:46:10 router kernel: [86914.905863] rtl8192cu: Chip version 0x10<br/>Jul  7 20:46:10 router kernel: [86914.974023] rtl8192cu: Board Type 0<br/>Jul  7 20:46:10 router kernel: [86914.974159] rtl_usb: rx_max_size 15360, rx_urb_num 8, in_ep 1<br/>Jul  7 20:46:10 router kernel: [86914.974216] rtl8192cu: Loading firmware rtlwifi/rtl8192cufw_TMSC.bin<br/><br/># /var/log/syslog<br/><br/>Jul  7 20:46:10 router dhcpcd[1488]: wlan1: adding address fe80::fd26:84c3:b23f:d43c<br/>Jul  7 20:46:10 router avahi-daemon[361]: Joining mDNS multicast group on interface wlan1.IPv6 with address fe80::fd26:84c3:b23f:d43c.<br/>Jul  7 20:46:10 router dhcpcd[1488]: wlan1: carrier lost<br/>Jul  7 20:46:10 router avahi-daemon[361]: New relevant interface wlan1.IPv6 for mDNS.<br/>Jul  7 20:46:10 router avahi-daemon[361]: Registering new address record for fe80::fd26:84c3:b23f:d43c on wlan1.*.<br/>Jul  7 20:46:11 router dhcpcd[1488]: wlan1: deleting address fe80::fd26:84c3:b23f:d43c<br/>Jul  7 20:46:11 router avahi-daemon[361]: Withdrawing address record for fe80::fd26:84c3:b23f:d43c on wlan1.<br/>Jul  7 20:46:11 router avahi-daemon[361]: Leaving mDNS multicast group on interface wlan1.IPv6 with address fe80::fd26:84c3:b23f:d43c.<br/>Jul  7 20:46:11 router avahi-daemon[361]: Interface wlan1.IPv6 no longer relevant for mDNS.</span></pre><p id="83e8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr">热点</em>区域，一个新的设备<code class="fe mh mi mj mk b">wlan1</code>出现了。根据RaspAP文档，可以通过手动干预来配置两个多个WiFi网络热点。但是，这不是我们在这部分要做的。注意到RaspAP识别<code class="fe mh mi mj mk b">wlan1</code>是很有用的。</p><p id="f3b3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr"> WiFi客户端</em>部分，它会显示可以看到的WiFi网络。还有一个<em class="lr">重新扫描</em>按钮来扫描网络。</p><p id="ff18" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我只需输入我的WiFi网络的密码，然后点击<em class="lr">添加</em>按钮</p><p id="936b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<em class="lr">网络</em>部分，您现在有三个条目:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ny"><img src="../Images/4b4d1ebf89b3cd754f331b153d57d877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iwtBrdsnAM2neo8D.png"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">作者图片</figcaption></figure><p id="1c6f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mh mi mj mk b">wlan1</code>接口已通过WiFi连接到互联网路由器，并接收到IP地址分配。现在，您可以使用这个IP地址将您的浏览器连接到RaspAP。就此而言，您可以使用<code class="fe mh mi mj mk b">ROUTER-NAME.local</code>连接到RaspAP Web GUI。无论哪种方式，GUI的行为都是一样的。</p><p id="8e69" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，从Raspberry Pi上断开以太网线。您应该仍然能够浏览RaspAP Web GUI，现在<em class="lr">网络</em>部分将如下所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nz"><img src="../Images/4f84e8b325ea0f0b7258c7701709fd16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TRD5IX-eMQj-mp0W.png"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">作者图片</figcaption></figure><p id="5fa3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在仅有的接口是<code class="fe mh mi mj mk b">wlan0</code>和<code class="fe mh mi mj mk b">wlan1</code>。</p><p id="ae32" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">状态是:</p><ul class=""><li id="d315" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq lx ly lz ma bi translated"><code class="fe mh mi mj mk b">wlan0</code>树莓派创造了新的WiFi网络</li><li id="82da" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq lx ly lz ma bi translated"><code class="fe mh mi mj mk b">wlan1</code>用作WiFi客户端，连接到您现有的WiFi网络</li></ul><p id="2ee7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">理想情况下，你现在应该能够将一个设备(比如你的智能手机或另一台电脑)连接到WiFi网络，并且路由器可以让你浏览互联网。它会将你的查询通过WiFi路由到你的互联网路由器，一切都会好的。</p><p id="7922" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我在这方面遇到了一些麻烦。在RaspAP FAQ中，建议取消勾选<em class="lr">为该接口安装默认路由</em>选项。</p><h1 id="989c" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">使用RaspAP的WiFi速度测试比较</h1><p id="05d0" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">有三种情况可用于比较互联网速度。为了测试，我使用了一个iPhone速度测试应用程序——速度测试<em class="lr">WiFi分析器&amp;——它是从App Store新安装的。我确保它是通过WiFi进行测试的，对于性能测试的每个阶段，我都确保WiFi是按照每个场景指示的那样连接的。</em></p><p id="511e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我的家庭互联网连接是通过Sonic DSL提供的DSL线路，这绝不是最好的线路，但对于我的需求来说已经足够快了。</p><ol class=""><li id="2951" class="ls lt iu kx b ky kz lb lc le lu li lv lm lw lq nw ly lz ma bi translated">通过为WiFi配置的RaspAP连接WiFi-WiFi到互联网路由器</li><li id="7a53" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq nw ly lz ma bi translated">通过为WiFi-以太网到互联网路由器配置的RaspAP连接WiFi</li><li id="8f5c" class="ls lt iu kx b ky mc lb md le me li mf lm mg lq nw ly lz ma bi translated">WiFi直接连接到互联网路由器的WiFi</li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/036e7d114b30a5c0eb7877f69cbe018e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9Z98IumlIh-fHp-h.jpg"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">通过RaspAP连接，通过WiFi连接到互联网路由器，图片由作者提供</figcaption></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/83b1e4b939064126e7c5919208b871b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kqvxFN_BJaR2x14h.jpg"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">通过RaspAP连接，通过以太网连接到互联网路由器，图片由作者提供</figcaption></figure><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj nr"><img src="../Images/76f9394c1f75e9c94362758dda68442f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*StzQUeatWd0WLeUn.jpg"/></div></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">直接连上网路由器WiFi，图片由作者提供</figcaption></figure><p id="7391" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如你所见，WiFi-WiFi性能慢了很多。可能是因为WiFi加密狗只支持USB2。可能有树莓Pi OS支持的USB3 WiFi加密狗。安装应用程序时，手机通过路由器连接到互联网。虽然App Store应用程序在RaspAP路由器上运行良好，但应用程序下载速度似乎非常慢。</p><h1 id="ec3b" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">使用运行RaspAP的Raspberry Pi实现文件共享</h1><p id="c347" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">因为RaspAP与我们安装在Raspberry Pi上的任何东西一起运行，所以运行其他应用程序应该很容易。</p><p id="35d8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于文件共享，让我们从在默认模式下设置Samba开始。</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="de70" class="nm mm iu mk b gz nn no l np nq">$ sudo apt-get install samba samba-common-bin<br/>$ ls /opt<br/>$ mkdir /opt/share<br/>$ sudo mkdir /opt/share<br/>$ sudo chown david /opt/share<br/>$ sudo chown david.david /opt/share<br/>$ sudo vi /etc/samba/smb.conf <br/>$ sudo smbpasswd -a david<br/>$ sudo service smbd restart</span></pre><p id="b00b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这将安装Samba包，创建一个目录(<code class="fe mh mi mj mk b">/opt/share</code>)，我将把它设置为文件共享区，将它的所有权更改为我的登录。然后我编辑<code class="fe mh mi mj mk b">smb.conf</code>,这是我马上要展示的配置。我确保为我的帐户设置了Samba密码。然后我重启Samba服务。</p><p id="92ad" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于<code class="fe mh mi mj mk b">smb.conf</code>,唯一的改变是在默认配置文件的<em class="lr"> Misc </em>部分。当然，根据你的目标，你可以在其他地方做出无数的改变。这可能是最简单的设置。在<em class="lr"> Misc </em>部分，我注释掉了那里的所有内容，并添加了以下条目:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="79b1" class="nm mm iu mk b gz nn no l np nq">[david]<br/>    comment = David<br/>    path = /home/david<br/>    browsable = yes<br/>    guest ok = no<br/>    read only = no<br/>    create mask = 0755<br/>    valid users = david<br/><br/>[share]<br/>    comment = Share<br/>    path = /opt/share<br/>    browsable = yes<br/>    guest ok = no<br/>    read only = no<br/>    create mask = 0755<br/>    valid users = david</span></pre><p id="2897" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">这设置了一对可浏览的共享，并支持使用我刚刚创建的密码进行连接。</p><p id="24ac" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我的笔记本电脑运行的是Ubuntu Linux，这两个共享立即出现在Nautilis中，我可以轻松地附加到文件共享并添加文件。</p><p id="b58e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">因此，一种可能的情况是——在咖啡店——通过该路由器连接到咖啡店WiFi同时在SSD驱动器上携带一些文件。</p><h1 id="d801" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">在RaspAP旁边的树莓码头上安装Docker</h1><p id="43e8" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">我感兴趣的一件事是运行基于Docker的服务。我有一些在各种操作系统上安装Docker的说明:<a class="ae mb" href="https://techsparx.com/software-development/docker/damp/getting-started.html" rel="noopener ugc nofollow" target="_blank">Docker入门:安装，第一步</a></p><p id="6b14" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对于在Raspberry Pi操作系统上安装，官方说明是:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="0a12" class="nm mm iu mk b gz nn no l np nq">$ sudo apt-get remove docker docker-engine docker.io containerd runc<br/>$ sudo apt-get install     ca-certificates     curl     gnupg     lsb-release<br/>$ sudo mkdir -p /etc/apt/keyrings<br/>$ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg<br/>$ echo   "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \<br/>   $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null<br/>$ sudo apt-get update<br/>$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin<br/>$ sudo groupadd docker<br/>$ sudo usermod -aG docker $USER</span></pre><p id="ec7b" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">因为Docker包已经改变了，所以使用新的包是很重要的。然后它会添加一个基于<code class="fe mh mi mj mk b">docker.com</code>的包源，并安装Docker引擎的当前版本。默认情况下，这会启动Docker引擎作为系统服务运行。最后一步是确保<code class="fe mh mi mj mk b">docker</code>组存在，并将您的用户ID添加到该组中。</p><p id="7fe1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在最后一步之后，从Raspberry Pi中注销，然后再次登录，这样您的新登录shell就有了<code class="fe mh mi mj mk b">docker</code>组。然后，您应该能够运行以下命令:</p><pre class="kk kl km kn gu ni mk nj nk aw nl bi"><span id="7f6a" class="nm mm iu mk b gz nn no l np nq">$ docker run hello-world <br/>Unable to find image 'hello-world:latest' locally <br/>latest: Pulling from library/hello-world <br/>9b157615502d: Pull complete <br/>Digest: sha256:13e367d31ae85359f42d637adf6da428f76d75dc9afeb3c21faea0d976f5c651 <br/>Status: Downloaded newer image for hello-world:latest </span><span id="fe51" class="nm mm iu mk b gz oa no l np nq">Hello from Docker! This message shows that your installation appears to be working correctly. ...</span></pre><p id="88f0" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe mh mi mj mk b">hello-world</code>镜像是一种快速简单的方法来验证Docker已经安装，并且您可以自己执行Docker命令。</p><h1 id="c1a3" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">摘要</h1><p id="2e2b" class="pw-post-body-paragraph kv kw iu kx b ky nd jv la lb ne jy ld le nf lg lh li ng lk ll lm nh lo lp lq in bi translated">我们在树莓派上安装了一个非常有趣的装置。使用RaspAP，我们可以设置复杂的互联网路由器配置。很容易安装该软件，此外还可以安装RaspAP旁边的其他软件。</p><p id="6869" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">RaspAP GUI的功能并不全。直接在GUI中可以做的事情是有限制的。例如，RaspAP常见问题解答说，可以设置两个接入点网络，也就是说，在同一台设备上托管两个WiFi网络，但GUI不支持这样做。相反，您可以转到命令行，在那里进行一些配置。</p><p id="6713" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">换句话说，RaspAP允许您使用命令行工具进行任何您想要的复杂配置。但是，GUI的目的是照顾尽可能多的用例。</p><p id="527a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在本文中，我没有讨论OpenVPN或Wireguard的设置。这是为了空间的利益。</p><p id="73d8" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">OpenVPN似乎能够通过第三方VPN服务隧道传输您的出站流量。因此，如果你在星巴克或酒店使用公共WiFi，通过外部VPN传输流量意味着公共WiFi网络上的任何人都无法窥探你的流量。Wireguard是需要特定软件的备用VPN服务。</p><p id="ae15" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我上面展示的组合——RaspAP+Samba+Docker——对像我这样的软件工程师很有用。例如，我可以在Raspberry Pi中添加一个Gitea服务器作为本地Git服务器，或者在Raspberry Pi上运行一个数据库，或者任何其他可能性。</p><p id="0eb2" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">另一个看起来很吸引人的想法是4G LTE或5G WWAN调制解调器。有连接Raspberry Pi GPIO头的设备，也有连接USB口的其他设备。应该可以配置RaspAP来设置带有这种调制解调器的例程，使您能够创建一个通过WAN网络连接的便携式热点。</p><p id="dfce" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我的硬件配置如下所示:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ob"><img src="../Images/555ff13cc1a3fbc5fc48504ff987c805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uZmXnuWPrZhI58FC.jpg"/></div></div></figure><p id="ceb1" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">Raspberry Pi 4安装在FLIRC外壳中。这些器件在非常时尚/小巧的外壳中提供出色的被动散热性能。USB驱动器是一个简单的2.5英寸外壳，是一个总线供电的固态硬盘，根据您的预算，可能有2TB的便携式存储空间。这里显示的是一个微型HDMI到HDMI适配器电缆，允许在常规HDMI显示器上显示。通过USB端口添加键盘/鼠标很容易。通过便携式USB电源组、USB充电器或其他5v电源(未显示)，可以轻松满足电源需求。这个系统很容易放在包里随身携带。</p><p id="2536" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">将此设置提升到下一个级别需要一个通电的USB3集线器和几个连接到该集线器的USB磁盘。</p><p id="fb0c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">最重要的是，这演示了如何构建一个灵活的微服务器，您可以随身携带，在现场使用。</p><h1 id="d8e3" class="ml mm iu bd mn mo mp mq mr ms mt mu mv ka mw kb mx kd my ke mz kg na kh nb nc bi translated">关于作者</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj oc"><img src="../Images/d04ec28495721635f750574e742508ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*wBhzbl-RTmqjtVMA.jpg"/></div><figcaption class="ns nt gk gi gj nu nv bd b be z dk translated">奥索作者的图片</figcaption></figure><p id="4366" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><a class="ae mb" href="https://davidherron.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv">大卫·赫伦</strong> </a> <strong class="kx iv"> </strong>:大卫·赫伦是一名作家和软件工程师，专注于技术的明智使用。他对太阳能、风能和电动汽车等清洁能源技术特别感兴趣。David在硅谷从事了近30年的软件工作，从电子邮件系统到视频流，再到Java编程语言，他已经出版了几本关于Node.js编程和电动汽车的书籍。</p></div><div class="ab cl od oe hy of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="in io ip iq ir"><p id="01bb" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><em class="lr">原载于</em><a class="ae mb" href="https://techsparx.com/linux-sbc/raspberry-pi/pi4-raspap.html" rel="noopener ugc nofollow" target="_blank"><em class="lr">https://techsparx.com</em></a><em class="lr">。</em></p></div></div>    
</body>
</html>