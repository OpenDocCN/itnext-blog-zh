<html>
<head>
<title>The Key To Improve Your API’s Quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提高API质量的关键</h1>
<blockquote>原文：<a href="https://itnext.io/the-key-to-improve-your-apis-quality-31c5d5a32505?source=collection_archive---------3-----------------------#2020-02-23">https://itnext.io/the-key-to-improve-your-apis-quality-31c5d5a32505?source=collection_archive---------3-----------------------#2020-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="6a98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能正在考虑或者正在为您最新的关键API项目进行各种测试。这可以从单元测试到集成测试。</p><p id="224d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">太好了！</strong>一旦专门的团队将您的API连接到您的前端，您还需要测试它的行为。您计划直接从您的UI测试它。</p><p id="7c55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，即使你和你的QA团队已经在那里测试了各个方面，你也没有足够的信心来发布你的产品。<br/>为什么？因为你不知道当它面向你的消费者时，它在现实世界中的表现如何。</p><p id="35c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为了理解你为什么不自信，让我们来看看你的API在某些时候可能出现的一些故障:</strong></p><ul class=""><li id="79ea" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">API响应时间长</li><li id="c5c4" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">您可能会从缓存中获得过时的响应</li><li id="9eff" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">外部服务不可用</li><li id="2bad" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">最糟糕的是:你没有得到预期的回应</li></ul><p id="0166" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在没有任何东西保护的情况下，很难在生产中测量这些东西。当你的消费者最终报告它或者当你深入挖掘你的日志时，你可能会知道它。</p><p id="cfa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了减轻这种情况，您可以进行额外的测试。如果我们仔细观察敏捷测试象限，你可能会发现那些你已经在做的方法。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/1c33b89939f7a40b5da27d9e0a2c3c0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/0*y83gyzmRQunu6n47"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated"><a class="ae ll" href="https://lisacrispin.com/2011/11/08/using-the-agile-testing-quadrants/" rel="noopener ugc nofollow" target="_blank">lisacrispin.com的敏捷测试象限</a></figcaption></figure><p id="fbc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们想要批评我们的产品并支持团队的东西。基于测试象限，我们最好的选择是采用面向技术的方法，这是自动化测试和支持我们开发旅程的工具之间的完美结合。</p><p id="adea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">许多工具可以帮助完成这项任务。你可能正在寻找一些免费的、文档完善的、易于使用的、功能丰富的、轻量级的东西。例如，Loadmill 有一个免费的工具，可以轻松地运行自动化API和负载测试，而不需要修改整个API项目。</p><p id="dd02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，你可以在Loadmill的网站上注册一个免费计划。注册之后，进入API测试并创建第一个测试套件。</p><h1 id="9689" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">所有功能的简要概述:</h1><ul class=""><li id="da7a" class="kl km iq jp b jq ml ju mm jy mn kc mo kg mp kk kq kr ks kt bi translated">在流中，您可以创建单独的流，<em class="lm">一个接一个地执行请求</em>。对于每个请求，您可以在当前的测试会话中设置额外的头、提供验证参数和分配变量。</li><li id="db8c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">基于流，您可以设置一个登录流，每次访问需要某种身份验证的路由时都会执行该登录流。您不需要在每次执行特定请求时重新进行身份验证。</li><li id="9d8f" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">参数允许您为您的测试套件设置会话范围的参数。这些可以在运行时更改。如果您喜欢存储某些令牌或简单的参数，如id等，这将很有帮助。</li><li id="ad38" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">CI部分指导您如何在CI环境中运行API测试。Loadmill附带了一个npm包。你只需要运行它伴随着你的测试套件的令牌。</li></ul><p id="2334" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是你需要知道的关于Loadmill的API测试特性的全部内容。</p><h1 id="0fb2" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">动作时间</h1><p id="f2fc" class="pw-post-body-paragraph jn jo iq jp b jq ml js jt ju mm jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">让我们动手吧。为此，我们将使用我们喜爱的API，GitHub的API，所以您还不需要为这个快速介绍的范围设置您的环境。</p><p id="731e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们想做什么？我们想要查询我们的组织及其存储库，并挖掘细节。为此，我们希望尽可能灵活，允许我们自己替换掉某些参数，如组织的ID。我们还想在运行时测量响应时间和设置参数。</p><p id="ae39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们将组织存储为一个参数，以后再访问它。我们转到参数并添加一个新参数。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/4bf1a324db35b60c129b91fe4bbfab78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9pR2ReI4n5ZNWP9c"/></div></div></figure><p id="3ee3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们回到流程，创建我们的第一个。为此，我们只想查询我们组织的存储库。</p><p id="5b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个简单的任务，因为我们已经知道了它的URL和参数。为了查询存储库，我们需要调用<code class="fe my mz na nb b"><a class="ae ll" href="https://api.github.com/orgs/loadmill/repos" rel="noopener ugc nofollow" target="_blank">https://api.github.com/orgs/loadmill/repos</a></code>。</p><p id="6d3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们希望尽可能灵活地使用组织的名称，所以我们通过使用我们的参数名称来交换它:<code class="fe my mz na nb b"><a class="ae ll" href="https://api.github.com/orgs/${org}/repos" rel="noopener ugc nofollow" target="_blank">https://api.github.com/orgs/${org}/repos</a></code></p><p id="50b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们单击Run按钮，您会注意到我们的测试通过了。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nc"><img src="../Images/789cdef3c8e7cf70f5e3dc45bf2d819a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*of4tG8CExn8AOiMN"/></div></div></figure><p id="6806" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了验证我们的请求，我们展开高级选项并查看“验证响应”部分。在这里，我们可以用JSONPath验证我们的响应消息。出于测试目的，我们可以用类似于下面的JSONPath来验证最顶层的存储库:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7c3730e9f97c63451975625dfe12d769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/0*AKyaBVJZ6ZD4CJ1L"/></div></figure><p id="18ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们只是将存储库规范名称存储为一个新的会话参数，并根据下面的测试平台对其进行验证。我们再次点击run，看到我们的测试顺利通过。</p><p id="b27c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(哦，您还可以在那里检查请求和响应头)</p><p id="8c74" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，我们继续。现在我们想查询最顶层的存储库，看看它是如何工作的。我们已经存储了存储库ID，所以没有任何遗漏。我们知道我们可以通过请求<code class="fe my mz na nb b">https://api.github.com/repos/loadmill/express-loadmill</code>来访问它。像<code class="fe my mz na nb b">https://api.github.com/repos/${org}/${repoId}</code>这样的一点改变就能让它按照我们需要的方式运行。Loadmill会自动为我们填充参数。</p><p id="1677" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们希望我们的API返回与存储库相同的名称，所以我们可以在响应处理部分根据它进行验证。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ne"><img src="../Images/2e8801c5a3dad287bea39ac336eaebdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*86gPAlvK-dV1bfS-"/></div></div></figure><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/e6c7132275c9db03484d1fee0a6904e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/0*2o1OnhkoiFMRgQ-e"/></div></figure><p id="8ab6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们运行了这个套件，我们会注意到流程没有错误地通过了。</p><p id="2678" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经注意到创建这些测试很容易。你没有理由害怕做这件事，也没有浪费你或任何人的时间。</p><p id="1834" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请随意玩，并确保查看<a class="ae ll" href="https://docs.loadmill.com/" rel="noopener ugc nofollow" target="_blank"> Loadmill的文档</a>以了解更多信息。</p><p id="2157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试愉快。</p></div></div>    
</body>
</html>