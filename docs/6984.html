<html>
<head>
<title>Govern and distribute secret settings with Azure App Configuration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure应用配置管理和分发机密设置</h1>
<blockquote>原文：<a href="https://itnext.io/govern-and-distribute-secret-settings-with-azure-app-configuration-96d120d12f14?source=collection_archive---------3-----------------------#2022-05-04">https://itnext.io/govern-and-distribute-secret-settings-with-azure-app-configuration-96d120d12f14?source=collection_archive---------3-----------------------#2022-05-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="43d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">管理为同一个项目工作的多个开发人员可能是一个真正的挑战。必须达成明确的协议来防止灾难的发生。有些协议是显而易见的；这些是每个开发人员都熟悉的最佳实践。</p><p id="3668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，项目秘密设置不存储在代码库中，这是一个不成文的规则。它们是秘密的，必须保密，因此必须小心分发。然而，为了能够开发和测试，所有开发人员都必须有正确的秘密设置。你如何管理这些秘密，控制发行并保持秘密？</p><p id="e019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Azure App配置</strong></p><p id="3676" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.microsoft.com/nl-nl/azure/azure-app-configuration/overview" rel="noopener ugc nofollow" target="_blank"> Azure App配置</a>在这里提供了一个解决方案。通过这项服务，您可以集中管理这些设置，并让您的开发人员可以轻松使用它们。</p><p id="3bdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，在资源组中创建一个应用程序配置资源。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ee4cbde0a34668eb15c2f86f7164431e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IFG7qV-J8enuAW5WcQiJ5w.gif"/></div></div></figure><p id="d49d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在应用配置资源的刀片中，导航到<em class="ky">配置浏览器</em>并创建一个设置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/3b9a031c59f1545070b9dba953e9393f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j70ok1WjILXHkDeYsadoKw.gif"/></div></div></figure><p id="5be3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，导航到刀片中的只读访问键，并复制连接字符串。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/df4c9832433cf57c6a37f653a795da2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-g7Dki-qxZyLg0mil5yULA.gif"/></div></div></figure><p id="a202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当资源准备就绪时，就是在项目中实现功能的时候了。</p><p id="e3b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用于的Azure应用配置客户端库。网</p><p id="3c20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序配置的实现很容易。只需将<a class="ae kl" href="https://www.nuget.org/packages/Microsoft.Azure.AppConfiguration.AspNetCore" rel="noopener ugc nofollow" target="_blank"> NuGet包</a>添加到您的项目中，并创建您的配置源，如下例所示，这也可以在我的<a class="ae kl" href="https://github.com/Bengkel/Article.AppConfiguration" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>中找到。</p><p id="6984" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📄<em class="ky"> CoreConfiguration.cs </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/b06da842596c22a8e26cf59dbf2f032a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dVYXrSCjocAGsiag17Qm_A.png"/></div></div></figure><p id="0cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将您从Azure门户复制的应用配置连接字符串添加到您的项目设置文件中，您就可以开始了！</p><p id="4312" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📄<em class="ky"> appsettings.json </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/94a498f3fa6e78b37377a21183df9670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiEHMb8z3hUCwrw55CNpsw.png"/></div></div></figure><p id="df5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以编写一个单元测试TestMethod来验证您的实现。在下面的示例中，我将尝试检索设置'<strong class="jp ir"><em class="ky">my-secre</em></strong><em class="ky">T '</em>并检查值，该值应为'<strong class="jp ir"><em class="ky">S # CR # T</em></strong><em class="ky">'</em>。</p><p id="ff9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📄CoreTest.cs </p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/e7a32af75653b7535b974b5a15616454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*StkJ0iMg461CMM_9q0YAlg.png"/></div></div></figure><p id="5afe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当一切正常时，测试应该是成功的。</p><p id="f7be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">环境</strong></p><p id="e606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个最佳实践是在不同的环境下分阶段发布您的软件。开发、测试、验收和生产的环境。很可能这些阶段之间的秘密设置会有所不同。应用程序配置允许您通过在设置中添加标签来区分不同的阶段。</p><p id="ff87" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，返回Azure门户，向现有设置添加一个值。这次我们将为其提供标签'<strong class="jp ir"> local </strong>'，用于本地开发。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/89cef5d1f7bddb7484c8c957bd078307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m_roTOn_Yhws--q_ozRahg.gif"/></div></div></figure><p id="8d9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了区分不同的环境，我们将在项目设置文件中引入一个设置来指定我们想要使用的标签。该标签指示我们想要接收秘密设置的环境。我把这个设置命名为'<strong class="jp ir">app configuration<em class="ky">_ Stage</em></strong><em class="ky">'</em>。我将赋值为'<strong class="jp ir"> <em class="ky"> local </em> </strong> <em class="ky">'。</em></p><p id="c60e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📝<em class="ky"> appsettings.json </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/ca77facd18f85a70f58436473c7cc36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XU_5DnBiUStysri6Ekzd2A.png"/></div></div></figure><p id="787c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要检索这个标签，我们必须更改CoreConfiguration类，如下图所示。下面的代码将检索所有不带标签和带标签'<strong class="jp ir"> local </strong>'的设置。在我们的例子中，由于顺序的原因，值'<strong class="jp ir"> local </strong> ' <strong class="jp ir"> </strong>将是前导。</p><p id="f7d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📝<em class="ky"> CoreConfiguration.cs </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/52ebf45ee7127d47ce36bec1c9b0ff20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8CPj5KtdknGd9Kn4ni7plQ.png"/></div></div></figure><p id="0f7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了验证这个功能，我们可以运行我们之前创建的单元测试。在这种情况下，UnitTest将会失败，因为带有标签'<strong class="jp ir"><em class="ky">local</em></strong><em class="ky">'</em>的值将会有不同的值。因此，我们更改代码，如下例所示。</p><p id="746e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">📝<em class="ky"> CoreTest.cs </em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi kz"><img src="../Images/bc59387155bd6b67c28c74140e189a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pa33ERNRgXYcD3JHp_vj8A.png"/></div></div></figure><p id="ca62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论</strong></p><p id="b995" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过Azure App Configuration，您可以控制团队中开发人员所需的所有项目机密设置。设置可以被集中管理，这使得在开发者之间分发秘密设置变得没有必要。</p><p id="e237" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的团队中，我们通过共享密码管理器<a class="ae kl" href="https://www.lastpass.com/nl" rel="noopener ugc nofollow" target="_blank"> LastPass </a>安全地共享应用配置连接字符串。由于这种入职和离职，开发人员很容易加入团队。</p><p id="8a0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，部署期间的配置也得到简化，因为有了应用程序配置，我们不需要添加所有设置。</p><p id="c330" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是一个应用程序配置的粉丝，我也可能通过这个博客用我的热情激励其他开发者。</p></div></div>    
</body>
</html>