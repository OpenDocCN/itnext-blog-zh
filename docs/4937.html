<html>
<head>
<title>Develop an iOS 14 Widget in Flutter with SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SwiftUI在Flutter中开发一个iOS 14 Widget</h1>
<blockquote>原文：<a href="https://itnext.io/develop-an-ios-14-widget-in-flutter-with-swiftui-e98eaff2c606?source=collection_archive---------0-----------------------#2020-10-29">https://itnext.io/develop-an-ios-14-widget-in-flutter-with-swiftui-e98eaff2c606?source=collection_archive---------0-----------------------#2020-10-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="e331" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">该死，我真的很想创建一个iOS 14主屏小工具，但我的应用程序在Flutter上运行。所以我猜这是不可能的？🤕</p></blockquote><div class="kp kq kr ks gt ab cb"><figure class="kt ku kv kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/517dd2b6eb111a802f62b5905f70a1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*GJINZoTXoOP3gqUH8-gZqQ.png"/></div></figure><figure class="kt ku lg kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/30e42683e6d52556ca80b517516d5f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*0eJiATFZJi569WOIt2tKkw.png"/></div></figure><figure class="kt ku kv kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/a8604c6089b89c7fde9f708234a1cd47.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*KmSohvBXNp9Jyu9fyXu_Mw.png"/></div></figure></div><p id="4ce0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">感谢上帝，你错了，你在正确的地方。在本文中，我将向您展示如何为您的Flutter应用程序创建一个iOS小部件扩展。</p><p id="1b27" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">2020年9月16日，iOS14发布，这是自苹果移动操作系统发布以来，主屏幕首次发生变化。现在可以在主屏幕上显示小应用程序(widgets)，用户无需打开相应的应用程序就可以看到重要信息。一个众所周知的例子是天气小部件，它绝对是小部件的一个很好的用例。</p><p id="9e9c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">从正面来看:不幸的是，目前不可能在Flutter中编写小部件。小部件必须像往常一样用Xcode和SwiftUI编程。但最有可能的是实现与Flutter的通信，而这正是这一切的意义所在。所以让我们开始吧。</p><h2 id="fb76" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">先决条件</h2><ul class=""><li id="97f8" class="md me iq jt b ju mf jy mg lh mh li mi lj mj ko mk ml mm mn bi translated">颤振和SwiftUI的基本知识</li><li id="1447" class="md me iq jt b ju mo jy mp lh mq li mr lj ms ko mk ml mm mn bi translated">颤振设置(<a class="ae mt" href="https://flutter.dev/docs/get-started/install" rel="noopener ugc nofollow" target="_blank">https://flutter.dev/docs/get-started/install</a></li><li id="8850" class="md me iq jt b ju mo jy mp lh mq li mr lj ms ko mk ml mm mn bi translated">Xcode版本≥ 12</li></ul><h2 id="11ce" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">应用程序创建</h2><p id="4537" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">我们将创建一个小的示例应用程序，展示带有Flutter的小部件扩展的概念。要创建应用程序，请在您的终端中执行以下命令。</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="3687" class="lk ll iq my b gy nc nd l ne nf">flutter create &lt;app_name&gt;</span></pre><h2 id="27dc" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">小部件创建</h2><p id="9064" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">接下来，让我们创建小部件。打开ios文件夹中的<code class="fe ng nh ni my b">Runner.xcworkspace</code>，添加一个新的Widget-Extension目标(File - &gt; New Target)并给它一个合适的名字。</p><figure class="kp kq kr ks gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nj"><img src="../Images/3ab70b4c5c40912d7f4003cd474a6e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xmFtsuZTO4J6-lUkqoGB4w.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">添加小部件扩展</figcaption></figure><p id="cbd2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">很简单，对吧？所以我们使用Xcode运行应用程序，发现我们的应用程序现在支持widgets 🥳，要添加一个widget，你必须点击并按住主屏幕，直到左上角出现一个➕。当你点击图标时，会出现一个应用程序列表。我们新创建的应用程序应该包括在内。</p><figure class="kp kq kr ks gt ku gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b4aeeb858cedd6d4ec12be89de474761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*iZOY7taqJyrwAHY9XFbqSQ.png"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">我们新创建的小工具</figcaption></figure><h2 id="ab38" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">小部件代码结构</h2><p id="9de5" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">让我们深入Swift，看看小部件扩展的代码结构。如果你打开你的<em class="js"> &lt; WidgetName &gt;。斯威夫特</em>你会看到5个重要的结构。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">FlutterWidget.swift</figcaption></figure><p id="769b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"> <em class="js"> func占位符</em></strong>widget kit第一次显示小部件时，会将小部件的视图渲染为占位符。占位符视图显示小部件的一般表示，让用户大致了解小部件显示的内容。</p><p id="8aeb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"><em class="js">func getTimeline</em></strong>使用此方法，您可以使用当前日期时间创建一个时间线条目数组，如果需要，还可以创建未来的条目。因此，您不用一直运行扩展，而是通过“时间线”来允许您在不同的时间触发(例如每小时)更新小部件。在我们的例子中，我们将只创建一个条目，并用Flutter手动触发更新😎</p><p id="363b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"> <em class="js"> func getSnapshot </em> </strong>此函数应返回一个包含虚拟数据的“时间线”条目。它用于在widget gallery中呈现预览。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">FlutterWidget.swift</figcaption></figure><p id="ec64" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"> <em class="js"> SimpleEntry </em> </strong>定义时间线的数据。这些数据随后用于呈现小部件。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">FlutterWidget.swift</figcaption></figure><p id="46fa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"><em class="js">FlutterWidgetEntryView</em></strong>负责用SwiftUI渲染小部件。如前所述,<code class="fe ng nh ni my b">entry</code>属于SimpleEntry类型。</p><p id="b2f4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"><em class="js">flutter Widget</em></strong>允许您设置种类和一些其他配置，如显示名称和描述(显示在Widget图库中)</p><p id="7eb8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated"><strong class="jt ir"><em class="js">flutter Widget _ Previews</em></strong>负责Widget图库/预览画布</p><h2 id="65e9" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">通信抖动➡️小部件</h2><p id="9fc7" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">对于通信部分，我们使用<a class="ae mt" href="https://developer.apple.com/documentation/foundation/userdefaults" rel="noopener ugc nofollow" target="_blank">用户默认值</a>。用户默认数据库的一个接口，在这个接口中，您可以在应用程序启动时持久地存储键值对。</p><figure class="kp kq kr ks gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nr"><img src="../Images/712312aaeef92b43d3b94329e5ba61db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GmFV878oZCvX8VdQzQfrw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">Xcode —应用程序群组</figcaption></figure><p id="f514" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">将功能<em class="js">“应用程序组”</em>添加到您的Flutter应用程序和您的小部件扩展中。在两个目标中，组名(<em class="js"/>)必须相同，这一点非常重要。</p><p id="a1b0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">我们的“应用程序组”中存储的值现在可以从我们的应用程序和我们的小部件✅中读取和写入</p><p id="40f7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">在<a class="ae mt" href="https://github.com/fasky-software/flutter_widgetkit" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">flutter _ widget kit</strong></a>的帮助下，我们可以使用Flutter访问我们新创建的应用程序组，并且我们还可以触发时间线重新加载。</p><h2 id="3b93" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">我们的Showcase Flutter应用</h2><p id="1fbe" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">计划是创建一个小部件，将增加我们的应用程序的用户体验。简单的原理:小部件要求用户打开应用程序，并输入一个简单的文本。按下按钮后，小工具的视图发生变化，并显示文本。</p><p id="42fa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">现在是时候安装前面提到的库了—<a class="ae mt" href="http://Now the time has come to install a very useful library - flutter_widgetkit" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">flutter _ widget kit</strong></a>。将<code class="fe ng nh ni my b">flutter_widgetkit</code>添加到您的<code class="fe ng nh ni my b">pubspec.yaml</code>中，然后运行<code class="fe ng nh ni my b">flutter pub get</code></p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">主.镖</figcaption></figure><p id="bb3c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">打开main.dart并导入库。我们还引入了类<code class="fe ng nh ni my b">FlutterWidgetData</code>,它定义了发送给我们的小部件的数据。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">主.镖</figcaption></figure><p id="5aec" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">在我们的<code class="fe ng nh ni my b">build</code>方法中，我们声明了一个文本字段，用户可以在其中键入一条消息，这条消息稍后会显示在我们的小部件上，我们还声明了一个按钮，它设置了<code class="fe ng nh ni my b">widgetData</code>并触发了所有时间线的重新加载。这就是✅的应用程序部分</p><h2 id="c073" class="lk ll iq bd lm ln lo dn lp lq lr dp ls lh lt lu lv li lw lx ly lj lz ma mb mc bi translated">我们的展示窗口小部件</h2><p id="3fe5" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">现在我们回到小部件，完成它的实现。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">FlutterWidget.swift</figcaption></figure><p id="73fa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">首先我们声明我们的数据结构。当然这和我们在Flutter app里声明的是一样的。带有字符串类型文本的简单结构。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">getTimeline—flutter widget . swift</figcaption></figure><p id="8355" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">我们的<em class="js"> getTimeline </em>方法变得有点大。我们用我们的组名初始化一个新的UserDefault对象，并读取键<code class="fe ng nh ni my b">widgetData</code>的值。然后我们把这个JSON解码，存入变量<code class="fe ng nh ni my b">flutterData</code>。之后，我们用之前收集的数据创建一个时间轴条目。</p><figure class="kp kq kr ks gt ku"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">FlutterWidget.swift</figcaption></figure><p id="08f3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">我们的SwiftUI视图非常简单。如果用户还没有在应用程序中输入文本，entry.flutterData将是<code class="fe ng nh ni my b">nil</code>，小部件显示<code class="fe ng nh ni my b">No Data found! Got to the Flutter App</code>，否则它将显示文本。</p><div class="kp kq kr ks gt ab cb"><figure class="kt ku ns kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/e90aaf4e15d4de7146aa722f15158101.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*dqa1pytNpUbuAQ-F3mHRBA.png"/></div></figure><figure class="kt ku ns kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/06b1e1eca37b9b90b6aa6629e0a761cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*rMCIgxH_-E3qHYurCxF9tg.png"/></div></figure><figure class="kt ku ns kw kx ky kz paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><img src="../Images/4d1fda7bff303ad3d55fdc4d3b8c204a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*c5xtTdflw0KB36Qn-ChikQ.png"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk nt di nu nv translated">带有微件❤️的Flutter应用程序</figcaption></figure></div><h1 id="4e45" class="nw ll iq bd lm nx ny nz lp oa ob oc ls od oe of lv og oh oi ly oj ok ol mb om bi translated">结论</h1><p id="7b05" class="pw-post-body-paragraph jq jr iq jt b ju mf jw jx jy mg ka kb lh mu ke kf li mv ki kj lj mw km kn ko ij bi translated">我们已经到达了旅程的终点。我希望我可以向你展示，为你的Flutter应用程序创建一个小部件是非常容易的。如果有什么问题或者功能要求，<a class="ae mt" href="https://github.com/fasky-software/flutter_widgetkit" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">flutter _ widget kit</strong></a>就是提问的地方。本博客中显示的所有源代码都在这个库中(子文件夹示例)。</p><p id="5daa" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lh kd ke kf li kh ki kj lj kl km kn ko ij bi translated">除了flutter库，我还开发了<a class="ae mt" href="https://github.com/fasky-software/react-native-widgetkit" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">React-Native-widget kit</strong></a>，它提供了与React Native相同的功能。如果你喜欢这个博客，请鼓掌告诉我👏</p></div></div>    
</body>
</html>