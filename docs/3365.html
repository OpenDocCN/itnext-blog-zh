<html>
<head>
<title>Nginx + Create-React-App + gzip: Tripple Your Lighthouse Performance Score in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Nginx + Create-React-App + gzip:在5分钟内将你的Lighthouse性能分数翻三倍</h1>
<blockquote>原文：<a href="https://itnext.io/nginx-create-react-app-gzip-tripple-your-lighthouse-performance-score-in-5-minutes-627465c3f445?source=collection_archive---------0-----------------------#2019-11-29">https://itnext.io/nginx-create-react-app-gzip-tripple-your-lighthouse-performance-score-in-5-minutes-627465c3f445?source=collection_archive---------0-----------------------#2019-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/11d033d46acec528346ed0cd8c656e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aaJPUE0cq4Dn9ICTrt-b2w.png"/></div></div></figure><p id="3a50" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">At</em><a class="ae kx" href="https://partwell.io" rel="noopener ugc nofollow" target="_blank"><em class="kw">part well</em></a><em class="kw">我们帮助公司深入了解员工决定离职的原因。最重要的是，我们想出了一个独特的解决方案，帮助您在5年内重新雇用高达40%的最佳流失人才。更多信息请访问</em><a class="ae kx" href="https://partwell.io" rel="noopener ugc nofollow" target="_blank"><em class="kw">part well . io</em></a><em class="kw">。</em></p><p id="3feb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">许多react开发人员使用样板文件来开始他们的项目。最流行的样板设置是create-react-app。Create-react-app消除了编写自己的Webpack配置的麻烦。但是，使用预定义的Webpack配置会删除使用Webpack压缩文件的选项。这并不一定是坏事，因为有很多其他方法可以将压缩引入到你的应用程序中。你只需要记得去做…</p><p id="9b7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行快速Lighthouse审计，您可以很容易地发现您是否已经在压缩文件。在本文中，我将向您介绍我如何通过使用Nginx压缩服务器响应，将个人应用程序的Lighthouse性能分数提高了两倍。</p><h1 id="bd7b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">灯塔:一个巧妙的小把戏</h1><p id="d0f9" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">Lighthouse是一个嵌入Chrome的小型审计工具。灯塔测试性能，最佳实践，基本搜索引擎优化和可访问性。它也是帮助你在谷歌搜索上排名更好的工具。您可以在Chrome inspect面板中找到Lighthouse(您可能需要按下小箭头才能找到它):</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/ec69c1bcaa4c14d6488ce598266e5f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*YOru9-wuY5StffMgRd-U0A.png"/></div></figure><p id="3ec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在对SEO、最佳实践和可访问性进行了一些相当直接的改进后，我的create-react-app的性能得分停留在32分:</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/0bb24ea2d20ffb66ed7b8aff1d6d131e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7X21VK9S7IuhY3R2ixqBQ.png"/></div></div></figure><p id="a188" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我尝试了几种方法来提高我的网站的性能:</p><ul class=""><li id="c623" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated"><strong class="ka ir">代码拆分</strong>用动态导入()和React。悬念(我的分数上升到33)</li><li id="a9fc" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir">通过分析我的渲染树和增加PureComponent的使用来优化</strong>渲染(我的分数保持在33)</li></ul><p id="25c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自然，这并不令人满意。令我惊讶的是，我在生产中的Lighthouse性能得分(33)与我在开发期间看到的几乎相同(29)，并且Lighthouse突出地建议在生产中运行审计时启用文本压缩。</p><p id="4941" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是要点:Webpack不会自动压缩对客户端的响应。</p><p id="211a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在googling上搜索这个问题时，我发现Webpack能够压缩对客户端(您的用户)的响应，但是您不能在不弹出的情况下使用create-react-app样板文件的这一功能。您应该在服务器端实现压缩。Nginx出现了。</p><p id="b390" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简短声明:启用gzip后，我的分数增加了两倍(敬请关注):</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/678c5d83e3950282e34eb3c292823bf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*5EGlucYXMTO5xcJ5IkSI3w.png"/></div></figure><h1 id="050e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Nginx:一个非常流行的反向反应代理</h1><p id="e778" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">有一些关于Nginx的功能和工作方式的精彩文章。对于本文，我将假设您熟悉Nginx的基本工作原理。</p><p id="a463" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">事实证明，使用Nginx启用gzip非常简单。但是有些陷阱最好避免。</p><p id="2bc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个Nginx服务器块，它为您启用了gzip:</p><figure class="mc md me mf gt jr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="12ad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看一下设置:</p><p id="862d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">基础设置:</strong></p><ul class=""><li id="3545" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated"><strong class="ka ir"> gzip on: </strong>这是许多Nginx服务器的默认配置。它将启用gzip，但只针对MIME类型text/html</li><li id="850b" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_disable "msie6": </strong>禁用不支持gzip的浏览器——这将禁用IE4–6的gzip</li><li id="c32a" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_vary on: </strong>让浏览器决定是否接受gzip。如果它不接受gzip发送的未压缩文件。这个决定是通过Accept编码头做出的。用现代浏览器发出的典型请求会包含标题:"<strong class="ka ir"> accept-encoding </strong> gzip，deflate，br "(在您自己的请求中检查)</li><li id="b68c" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_proxied any </strong>:为所有代理请求启用压缩。或者，您可以将压缩限制在包含无缓存或无存储头的响应中。</li><li id="953b" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_comp_level: </strong>该设置将设置gzip的压缩级别(这是一个压缩功能，并不特定于nginx)。默认级别是6，这应该适用于大多数用例。但是要注意，Nginx的默认值为1。<strong class="ka ir">启动它会增加你的服务器的工作——如果你运行一个大的应用程序会有所不同！</strong></li><li id="dbd3" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_buffers: </strong>设置用于压缩响应的缓冲区的数量和大小。默认情况下，缓冲区大小等于一个内存页面。这要么是4K，要么是8K，取决于平台。您可以编辑这个值，或者使用Nginx的默认值:gzip_buffers 32 4k|16 8k这应该可以很好地工作！</li><li id="fdf7" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_http_version: </strong>设置压缩响应所需的请求的最低http版本——您可以选择忽略此设置，因为1.1是默认值。</li><li id="b143" class="mh mi iq ka b kb mq kf mr kj ms kn mt kr mu kv mm mn mo mp bi translated"><strong class="ka ir"> gzip_min_length 0: </strong>只能是有一定大小的gzip文件(你可以在这里插入一个字节大小)。许多人会告诉你将这个值设置为大约1000甚至10000，但是我发现首先确保你的包有好的大小，并且只包含好的gzip_types(见下面)更有用。</li></ul><p id="35fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">陷阱:</strong></p><ul class=""><li id="a7d6" class="mh mi iq ka b kb kc kf kg kj mj kn mk kr ml kv mm mn mo mp bi translated"><strong class="ka ir">gzip _ types text/plain text/CSS application/JSON application/x-JavaScript text/XML application/XML+RSS text/JavaScript application/vnd . ms-font object application/x-font-TTF font/opentype:</strong>这告诉Nginx它应该gzip哪些文件格式。通常，对于包含大量文本的文件，如HTML、CSS或JavaScript文件，好处最大。对于已经压缩的文件格式，如。jpg或者. png也可以gzip。svg文件，但是我发现它的方式(！)如果您优化您的，性能会更好。svg文件，然后发送它们(SVGO是一个伟大的工具)。<strong class="ka ir">请注意:使用gzip对服务器来说是一项要求很高的任务。不要简单地盲目压缩所有文件，因为这会对你的网站性能产生不良影响。你需要尝试这些设置，为你的应用找到最佳设置！</strong></li></ul><blockquote class="mx my mz"><p id="3c5f" class="jy jz kw ka b kb kc kd ke kf kg kh ki na kk kl km nb ko kp kq nc ks kt ku kv ij bi translated"><strong class="ka ir">这种设置的一个快速提示:</strong> Nginx使用MIME类型来决定它应该压缩哪些文件。你可以在所有现代浏览器的网络标签中检查文件的MIME类型，<strong class="ka ir">使用列出的MIME类型</strong>。这里有一个例子:</p></blockquote><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3aab188f2192c4b1c4622ce5badccc3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*hqrTsvC0skJq8VhsfFHGtQ.png"/></div></figure><h1 id="468c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安全性</h1><p id="cd1a" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">请注意，通过HTTPS发送的gziped文件可能会受到<a class="ae kx" href="https://en.wikipedia.org/wiki/BREACH" rel="noopener ugc nofollow" target="_blank">违规</a>攻击。现代浏览器大大降低了这种风险。尽管如此，如果你运行一个有严格安全要求的应用程序，一定要了解通过HTTP和HTTPS发送压缩文件的安全方面。</p><h1 id="8400" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">结论</strong>🎉🎉🎉</h1><p id="56da" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">用Nginx和create-react-app设置gzip非常简单，大约5分钟就可以完成。在进入更高级的优化技术之前，比如代码分割(一旦你有了React + Redux应用程序，这可能会变得很麻烦)，这绝对应该是你的首选优化之一。我希望你已经成功地提高了应用程序的性能！</p><p id="cee6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">如果你有兴趣增加你在所有社交渠道的有机接触，请查看</em><a class="ae kx" href="https://gosquad.cc" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="kw">https://gosquad . cc</em></strong></a></p></div></div>    
</body>
</html>