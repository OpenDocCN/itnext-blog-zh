<html>
<head>
<title>Constructing YAML with Kubectl only</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅用Kubectl构建YAML</h1>
<blockquote>原文：<a href="https://itnext.io/constructing-yaml-with-kubectl-only-15b3fbff7485?source=collection_archive---------1-----------------------#2020-08-29">https://itnext.io/constructing-yaml-with-kubectl-only-15b3fbff7485?source=collection_archive---------1-----------------------#2020-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/80d3891854301bd50ebee387b2d5bfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tts95NXxgmCuE6Dd.jpg"/></div></div></figure><p id="cacc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我迫切需要在一个空气间隙的环境中创造一些K8s资源，可惜我的备忘单也不在身边:(</p><p id="02ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“不可能完成的任务”仍然可以在kubectl命令行工具的帮助下完成。</p><p id="6652" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们看看，我们需要限制名称空间中的最大Pod资源限制，这通常是通过“limits”K8s资源来实现的。似乎没有办法通过命令行用kubectl工具创建它，我们必须使用通用的YAML文件。但是我记不起确切的语法了。</p><p id="9a91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们通过找出资源的正式名称</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="994f" class="li lj it le b gy lk ll l lm ln"><strong class="le iu">kubectl api-resources | grep -i limit</strong></span></pre><p id="b5e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这让我，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d810" class="li lj it le b gy lk ll l lm ln">limitranges                       limits                                      true         LimitRange</span></pre><p id="ef98" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以我知道资源的全名是limitranges，简称是limits，种类名是LimitRange。所以至少现在，我可以开始我的YAML了</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="08ac" class="li lj it le b gy lk ll l lm ln">kind: LimitRange<br/>metadata:<br/>  name: mylimit<br/>spec:</span></pre><p id="5dc2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">apiVersion和确切的规格是什么？第二个kubectl命令会告诉我们，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="de87" class="li lj it le b gy lk ll l lm ln"><strong class="le iu">kubectl explain limits</strong></span></pre><p id="0555" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这给了我，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="757f" class="li lj it le b gy lk ll l lm ln">KIND:     LimitRange<br/>VERSION:  v1</span><span id="0deb" class="li lj it le b gy lo ll l lm ln">DESCRIPTION:<br/>     LimitRange sets resource usage limits for each kind of resource in a<br/>     Namespace.</span><span id="c4af" class="li lj it le b gy lo ll l lm ln">FIELDS:<br/>   apiVersion &lt;string&gt;<br/>     APIVersion defines the versioned schema of this representation of an...</span><span id="01de" class="li lj it le b gy lo ll l lm ln">   ...SKIPPED MANY LINES...</span><span id="bbe8" class="li lj it le b gy lo ll l lm ln">   spec &lt;Object&gt;<br/>     Spec defines the limits enforced. More info:<br/>     <a class="ae lp" href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status" rel="noopener ugc nofollow" target="_blank">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></span></pre><p id="f008" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以apiVersion应该设置为“v1”。</p><p id="bbd9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我可以进一步寻求帮助</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="5978" class="li lj it le b gy lk ll l lm ln"><strong class="le iu">kubectl explain limits.spec</strong></span></pre><p id="2135" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的结果是，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="b64e" class="li lj it le b gy lk ll l lm ln">KIND:     LimitRange<br/>VERSION:  v1</span><span id="9b06" class="li lj it le b gy lo ll l lm ln">RESOURCE: spec &lt;Object&gt;</span><span id="e544" class="li lj it le b gy lo ll l lm ln">DESCRIPTION:<br/>     Spec defines the limits enforced. More info:<br/>     <a class="ae lp" href="https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status" rel="noopener ugc nofollow" target="_blank">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</a></span><span id="02f8" class="li lj it le b gy lo ll l lm ln">LimitRangeSpec defines a min/max usage limit for resources that match on<br/>     kind.</span><span id="8722" class="li lj it le b gy lo ll l lm ln">FIELDS:<br/>   limits &lt;[]Object&gt; -required-<br/>     Limits is the list of LimitRangeItem objects that are enforced.</span></pre><p id="20b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以对于规范，我必须用键“limits”定义一个数组对象。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="13ce" class="li lj it le b gy lk ll l lm ln">apiVersion: v1<br/>kind: LimitRange<br/>metadata:<br/>  name: mylimit<br/>spec:<br/>  limits:<br/>    - </span></pre><p id="a640" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">遵循树形结构，运行<code class="fe lq lr ls le b">kubectl explain limits.spec.limits</code>将返回，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="4ede" class="li lj it le b gy lk ll l lm ln">KIND:     LimitRange<br/>VERSION:  v1</span><span id="aebf" class="li lj it le b gy lo ll l lm ln">RESOURCE: limits &lt;[]Object&gt;</span><span id="1866" class="li lj it le b gy lo ll l lm ln">DESCRIPTION:<br/>     Limits is the list of LimitRangeItem objects that are enforced.</span><span id="fa42" class="li lj it le b gy lo ll l lm ln">     LimitRangeItem defines a min/max usage limit for any resource that matches on kind.</span><span id="f134" class="li lj it le b gy lo ll l lm ln">FIELDS:<br/>   default &lt;map[string]string&gt;<br/>     Default resource requirement limit value by resource name if resource limit is omitted.</span><span id="3415" class="li lj it le b gy lo ll l lm ln">   defaultRequest &lt;map[string]string&gt;<br/>     DefaultRequest is the default resource requirement request value by resource name if resource request is omitted.</span><span id="29c3" class="li lj it le b gy lo ll l lm ln">   max &lt;map[string]string&gt;<br/>     Max usage constraints on this kind by resource name.</span><span id="003f" class="li lj it le b gy lo ll l lm ln">   maxLimitRequestRatio &lt;map[string]string&gt;<br/>     MaxLimitRequestRatio if specified, the named resource must have a request and limit that are both non-zero where limit divided by request is less than or equal to the enumerated value; this represents the max burst for the named resource.</span><span id="7583" class="li lj it le b gy lo ll l lm ln">  min &lt;map[string]string&gt;<br/>     Min usage constraints on this kind by resource name.</span><span id="bc64" class="li lj it le b gy lo ll l lm ln">  type &lt;string&gt;<br/>     Type of resource that this limit applies to.</span></pre><p id="6163" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以现在极限需要定义类型和极限的不同组合。极限范围的知识现在可以联系起来了。所以我可以写我的YAML，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="59dd" class="li lj it le b gy lk ll l lm ln">apiVersion: v1<br/>kind: LimitRange<br/>metadata:<br/>  name: mylimit<br/>spec:<br/>  limits:<br/>    - type: Pod<br/>      max:<br/>        cpu: 1<br/>        memory: 2Gi</span></pre><p id="a9c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我可以将YAML应用于K8s来实现我的“使命”。</p><p id="d000" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">事实上，进行“解释”的一种快捷方式是添加“—递归”选项，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="dd30" class="li lj it le b gy lk ll l lm ln">kubectl explain limits --recursive</span></pre><p id="93d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就给出了，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7c07" class="li lj it le b gy lk ll l lm ln">KIND:     LimitRange<br/>VERSION:  v1</span><span id="47a6" class="li lj it le b gy lo ll l lm ln">DESCRIPTION:<br/>     LimitRange sets resource usage limits for each kind of resource in a<br/>     Namespace.</span><span id="3358" class="li lj it le b gy lo ll l lm ln">FIELDS:<br/>   apiVersion &lt;string&gt;<br/>   kind &lt;string&gt;<br/>   metadata &lt;Object&gt;</span><span id="b467" class="li lj it le b gy lo ll l lm ln">     ...SKIPPED MANY LINES...</span><span id="e36a" class="li lj it le b gy lo ll l lm ln">   spec &lt;Object&gt;<br/>      limits &lt;[]Object&gt;<br/>         default &lt;map[string]string&gt;<br/>         defaultRequest &lt;map[string]string&gt;<br/>         max &lt;map[string]string&gt;<br/>         maxLimitRequestRatio &lt;map[string]string&gt;<br/>         min &lt;map[string]string&gt;<br/>         type &lt;string&gt;</span></pre><p id="0754" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它保持缩进，使它更直观。</p></div></div>    
</body>
</html>