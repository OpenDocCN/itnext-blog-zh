<html>
<head>
<title>Tutorial Part 2: Kubernetes up and running on LXC/LXD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程第2部分:在LXC/LXD运行Kubernetes</h1>
<blockquote>原文：<a href="https://itnext.io/tutorial-part-2-kubernetes-up-and-running-on-lxc-lxd-6d60e98f22df?source=collection_archive---------3-----------------------#2018-05-20">https://itnext.io/tutorial-part-2-kubernetes-up-and-running-on-lxc-lxd-6d60e98f22df?source=collection_archive---------3-----------------------#2018-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5fa6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，本教程仅供学习之用。</p><p id="de31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以查看<a class="ae kl" href="https://bit.ly/2LcdKEy" rel="noopener ugc nofollow" target="_blank">教程第1部分:Kubernetes在LXC/LXD运行</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e35711d13a2063d969e687510a676cb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qklMJNbxFRexwd571afm0g.png"/></div></div></figure><p id="3a79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们部署kubernetes。我们有3个部署选项。我们还可以尝试Kubernetes的规范分布，其中包括:</p><ul class=""><li id="0ee1" class="ky kz iq jp b jq jr ju jv jy la kc lb kg lc kk ld le lf lg bi translated">灰色日志</li><li id="b6da" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">舵</li><li id="451d" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">JFrog Artifactory</li><li id="894e" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">库贝弗洛</li><li id="31d8" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">普罗米修斯</li><li id="9156" class="ky kz iq jp b jq lh ju li jy lj kc lk kg ll kk ld le lf lg bi translated">Rancher2.0(测试版)</li></ul><p id="d686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是在本教程中，我们将选择Kubernetes核心并部署在本地主机上。</p><pre class="kn ko kp kq gt lm ln lo lp aw lq bi"><span id="a873" class="lr ls iq ln b gy lt lu l lv lw">ubuntu@ip-172-31-1-4:~$ conjure-up kubernetes</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lx"><img src="../Images/e42c07f99eeaafce5426afd5daa09ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s4kADgAUROA5X3Lh6Ok6yA.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ly"><img src="../Images/c7ad48ce2a2af81ae498f0d427d65d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S49C5NGi-cDJ-efcInjLQw.png"/></div></div></figure><p id="d2dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择“网桥”和“存储池”。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ly"><img src="../Images/5bd3b135b6dc934055e12022f206fc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49zAhnp_w7bJBm6ci3fl_g.png"/></div></div></figure><p id="5342" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为Kubernetes网络插件选择“法兰绒”。法兰绒是一个虚拟网络，它为每个主机提供一个子网，供容器运行时使用。一个屏幕一个屏幕地跟着做。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lz"><img src="../Images/4d58fb2442b1efdd8313c8de11fd2eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPr3UrkeWuHw9VmrwImPbQ.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lz"><img src="../Images/0eb298eb4b730e25622f164f00396bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0T-JbE-F7E8EL90AWRB9hg.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ly"><img src="../Images/eab45ec6a1800c6a09e91767e1b55836.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UBjnrOX096MBRqZfovSDkA.png"/></div></div></figure><p id="9b0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在等待Juju控制器时，我们可以在运行MacOS的笔记本电脑上设置“lxc客户端”。我们可以通过远程管理运行在AWS EC2上的LXD。</p><p id="4db0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开一个新的终端并安装lxc(🍺/usr/local/Cellar/lxc/3.1: 6文件，17.6MB) — lxc是MacOS的LXD客户端。</p><pre class="kn ko kp kq gt lm ln lo lp aw lq bi"><span id="f345" class="lr ls iq ln b gy lt lu l lv lw">$ brew install lxc</span><span id="95c7" class="lr ls iq ln b gy ma lu l lv lw">$ lxc remote list<br/>+-----------------+------------------------------------------+---------------+-----------+--------+--------+<br/>|      NAME       |                   URL                    |   PROTOCOL    | AUTH TYPE | PUBLIC | STATIC |<br/>+-----------------+------------------------------------------+---------------+-----------+--------+--------+<br/>| images          | https:<em class="mb">//images.linuxcontainers.org       | simplestreams |           | YES    | NO     |</em><br/>+-----------------+------------------------------------------+---------------+-----------+--------+--------+<br/>| local (default) | unix:<em class="mb">//                                  | lxd           | tls       | NO     | YES    |</em><br/>+-----------------+------------------------------------------+---------------+-----------+--------+--------+<br/>| ubuntu          | https:<em class="mb">//cloud-images.ubuntu.com/releases | simplestreams |           | YES    | YES    |</em><br/>+-----------------+------------------------------------------+---------------+-----------+--------+--------+<br/>| ubuntu-daily    | https:<em class="mb">//cloud-images.ubuntu.com/daily    | simplestreams |           | YES    | YES    |</em><br/>+-----------------+------------------------------------------+---------------+-----------+--------+————+</span></pre><p id="5bb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们在笔记本电脑上配置“lxc客户端”来管理LXD，它在AWS上作为EC2实例运行。<strong class="jp ir">“13 . 250 . 45 . 177”</strong>是LXD正在运行的EC2实例的公有IP。</p><pre class="kn ko kp kq gt lm ln lo lp aw lq bi"><span id="9784" class="lr ls iq ln b gy lt lu l lv lw">$ lxc remote add mylxd 13.250.45.177<br/>Certificate fingerprint: 438e80f5dcca7c26acbeef60fff82615feda7cb43e49cc794c199788113ce960<br/>ok (y/n)? yes<br/>Admin password for mylxd:<br/>Client certificate stored at server:  mylxd<br/><br/>$ lxc remote set-default mylxd<br/><br/>$ lxc remote list<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>|      NAME       |                   URL                    |   PROTOCOL    | AUTH TYPE | PUBLIC | STATIC |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>| images          | https://images.linuxcontainers.org       | simplestreams |           | YES    | NO     |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>| local           | unix://                                  | lxd           | tls       | NO     | YES    |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>| mylxd (default) | https://13.250.45.177:8443               | lxd           | tls       | NO     | NO     |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>| ubuntu          | https://cloud-images.ubuntu.com/releases | simplestreams |           | YES    | YES    |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+--------+</em><br/>| ubuntu-daily    | https://cloud-images.ubuntu.com/daily    | simplestreams |           | YES    | YES    |<br/>+<em class="mb">-----------------+------------------------------------------+---------------+-----------+--------+————+</em></span></pre><p id="c4c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的笔记本上运行“lxc列表”。</p><pre class="kn ko kp kq gt lm ln lo lp aw lq bi"><span id="b58e" class="lr ls iq ln b gy lt lu l lv lw">$ lxc list<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>|          NAME           |  STATE  |         IPV4          | IPV6 |    TYPE    | SNAPSHOTS |<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>| juju-0ed97e-0           | RUNNING | 10.217.72.120 (eth0)  |      | PERSISTENT | 0         |<br/>|                         |         | 10.1.14.0 (flannel.1) |      |            |           |<br/>|                         |         | 10.0.224.1 (lxdbr0)   |      |            |           |<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>| juju-0ed97e-1           | RUNNING | 172.17.0.1 (docker0)  |      | PERSISTENT | 0         |<br/>|                         |         | 10.217.72.136 (eth0)  |      |            |           |<br/>|                         |         | 10.1.12.1 (cni0)      |      |            |           |<br/>|                         |         | 10.1.12.0 (flannel.1) |      |            |           |<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>| juju-a8bbdd-0           | RUNNING | 10.217.72.54 (eth0)   |      | PERSISTENT | 0         |<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>| my-alpine-lxd-container | RUNNING | 10.217.72.102 (eth0)  |      | PERSISTENT | 0         |<br/>+-------------------------+---------+-----------------------+------+------------+-----------+<br/>| webserver               | RUNNING | 10.217.72.74 (eth0)   |      | PERSISTENT | 0         |<br/>+-------------------------+---------+-----------------------+------+------------+—————+</span></pre><p id="4542" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷！！！现在，我们可以远程管理我们的LXD。</p><p id="9127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们回去检查kubernetes部署的状态。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ly"><img src="../Images/2e8f39c062d05e2ae0a249a5ab69fb03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLTL-si-2LwgWt2dhZ0uDQ.png"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mc"><img src="../Images/03fd418620bf2dbff480c73d6ca3a3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcUbhs8Ni-gSBMiKxGSp4A.png"/></div></div></figure><p id="50bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你！！！我们在LXD集装箱上的Kubernetes部署已经完成。</p><p id="2812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以验证我们的k8s主节点和工作节点，如下所示:</p><pre class="kn ko kp kq gt lm ln lo lp aw lq bi"><span id="94d1" class="lr ls iq ln b gy lt lu l lv lw">$ lxc info juju-0ed97e-0<br/>Name: juju-0ed97e-0<br/>Remote: https:<em class="mb">//13.250.45.177:8443</em><br/>Architecture: x86_64<br/>Created: 2018/05/20 04:20 UTC<br/>Status: Running<br/>Type: persistent<br/>Profiles: default, juju-conjure-kubernetes-core-a2d<br/>Pid: 25540<br/>Ips:<br/>  lo:inet127.0.0.1<br/>  lo:inet6::1<br/>  lxdbr0:inet10.0.224.1<br/>  lxdbr0:inet6fe80::6432:3cff:fe07:f32f<br/>  veth58AEPD:inet6fe80::fcf7:9dff:fe0a:a91d<br/>  eth0:inet10.217.72.120vethHIBQEA<br/>  eth0:inet6fe80::216:3eff:feca:580cvethHIBQEA<br/>  flannel.1:inet10.1.14.0<br/>  flannel.1:inet6fe80::fc96:25ff:fe8e:ca77<br/>Resources:<br/>  Processes: 242<br/>  CPU usage:<br/>    CPU usage (in seconds): 665<br/>  Memory usage:<br/>    Memory (current): 3.44GB<br/>    Memory (peak): 3.51GB<br/>  Network usage:<br/>    eth0:<br/>      Bytes received: 689.96MB<br/>      Bytes sent: 15.48MB<br/>      Packets received: 184636<br/>      Packets sent: 118813<br/>    flannel.1:<br/>      Bytes received: 41.31kB<br/>      Bytes sent: 24.28kB<br/>      Packets received: 269<br/>      Packets sent: 249<br/>    lo:<br/>      Bytes received: 25.61MB<br/>      Bytes sent: 25.61MB<br/>      Packets received: 87787<br/>      Packets sent: 87787<br/>    lxdbr0:<br/>      Bytes received: 1.98MB<br/>      Bytes sent: 141.17MB<br/>      Packets received: 27299<br/>      Packets sent: 31633<br/>    veth58AEPD:<br/>      Bytes received: 2.34MB<br/>      Bytes sent: 141.17MB<br/>      Packets received: 27299<br/>      Packets sent: 31634</span><span id="8df2" class="lr ls iq ln b gy ma lu l lv lw">$ lxc info juju-0ed97e-1<br/>Name: juju-0ed97e-1<br/>Remote: https:<em class="mb">//13.250.45.177:8443</em><br/>Architecture: x86_64<br/>Created: 2018/05/20 04:21 UTC<br/>Status: Running<br/>Type: persistent<br/>Profiles: default, juju-conjure-kubernetes-core-a2d<br/>Pid: 27193<br/>Ips:<br/>  lxdbr0:inet6fe80::d4ed:47ff:fe80:e006<br/>  lxdbr0:inet6fe80::1<br/>  vethd8be2574:inet6fe80::c19:b7ff:fe97:6a9a<br/>  cni0:inet10.1.12.1<br/>  cni0:inet6fe80::9085:81ff:fe0b:dcf4<br/>  flannel.1:inet10.1.12.0<br/>  flannel.1:inet6fe80::c4e8:e3ff:fe76:fb54<br/>  lo:inet127.0.0.1<br/>  lo:inet6::1<br/>  veth46d4a179:inet6fe80::e8ea:d2ff:fe9a:d27<br/>  veth5c0422eb:inet6fe80::fcfe:40ff:fe51:927b<br/>  veth65e39fc3:inet6fe80::784b:5bff:fe06:5e36<br/>  vetha5902530:inet6fe80::b0d7:68ff:fe18:f041<br/>  docker0:inet172.17.0.1<br/>  eth0:inet10.217.72.136vethJ6HM6I<br/>  eth0:inet6fe80::216:3eff:fea4:64e0vethJ6HM6I<br/>  veth23e516ee:inet6fe80::1448:60ff:fe59:7530<br/>Resources:<br/>  Processes: 716<br/>  CPU usage:<br/>    CPU usage (in seconds): 398<br/>  Memory usage:<br/>    Memory (current): 2.60GB<br/>    Memory (peak): 2.64GB<br/>  Network usage:<br/>    flannel.1:<br/>      Bytes received: 25.18kB<br/>      Bytes sent: 42.69kB<br/>      Packets received: 258<br/>      Packets sent: 278<br/>    lo:<br/>      Bytes received: 72.62kB<br/>      Bytes sent: 72.62kB<br/>      Packets received: 814<br/>      Packets sent: 814<br/>    lxdbr0:<br/>      Bytes received: 0B<br/>      Bytes sent: 650B<br/>      Packets received: 0<br/>      Packets sent: 7<br/>    vethd8be2574:<br/>      Bytes received: 126.58kB<br/>      Bytes sent: 95.45kB<br/>      Packets received: 669<br/>      Packets sent: 849<br/>    cni0:<br/>      Bytes received: 1.98MB<br/>      Bytes sent: 5.95MB<br/>      Packets received: 6802<br/>      Packets sent: 7026<br/>    eth0:<br/>      Bytes received: 655.55MB<br/>      Bytes sent: 8.16MB<br/>      Packets received: 181509<br/>      Packets sent: 98928<br/>    veth23e516ee:<br/>      Bytes received: 144.94kB<br/>      Bytes sent: 1.51MB<br/>      Packets received: 1278<br/>      Packets sent: 1332<br/>    veth46d4a179:<br/>      Bytes received: 26.00kB<br/>      Bytes sent: 28.80kB<br/>      Packets received: 282<br/>      Packets sent: 339<br/>    veth5c0422eb:<br/>      Bytes received: 40.95kB<br/>      Bytes sent: 1.30MB<br/>      Packets received: 406<br/>      Packets sent: 435<br/>    veth65e39fc3:<br/>      Bytes received: 1.41MB<br/>      Bytes sent: 1.95MB<br/>      Packets received: 1687<br/>      Packets sent: 1833<br/>    vetha5902530:<br/>      Bytes received: 290.38kB<br/>      Bytes sent: 510.22kB<br/>      Packets received: 2074<br/>      Packets sent: 2309<br/>    docker0:<br/>      Bytes received: 0B<br/>      Bytes sent: 0B<br/>      Packets received: 0<br/>      Packets sent: 0</span></pre><p id="3019" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>