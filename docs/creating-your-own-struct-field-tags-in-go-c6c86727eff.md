# 标记 Go 中的结构字段

> 原文：<https://itnext.io/creating-your-own-struct-field-tags-in-go-c6c86727eff?source=collection_archive---------2----------------------->

![](img/6025751da7846ddb821403ae90a8e9fa.png)

所以，您已经开始在 Go 中探索了一点，并且您现在开始想知道您有什么样的元编程选项可供选择。在大多数编程语言中，你有一个选择，就是使用反射。Go 中反射的一种用法是处理 struct 字段标签。

# 什么是结构字段标记？

如果你曾经在 Go 中编写过 RESTful JSON api，你可能已经知道了，或者至少你见过它们。这是大多数地鼠第一次遇到这些字段标签。

在上面的例子中，你会注意到我声明了两个结构，它们都有一个类型为*字符串*的字段*栏*。我试图指出的主要区别是，第二个结构 *FooWithTag* 也声明了一个字段标签。这个标签由 *json* 包在编组和解组数据时使用。如果您密切注意输出，您会注意到*条*在第一个输出中是大写的，在第二个输出中是小写的。在这种情况下，field 标签告诉 *json* 包将键写为*栏*而不是*栏*。如果我将我的标签声明为:

```
***type*** FooWithTag ***struct*** {
    Bar **string** `json:"tomato"`
}
```

它会打印:

```
{"tomato":"something"}
```

既然我们已经看到了 *json* 包是如何使用字段标签的，那么让我们探索一下如何创建我们自己的标签。

# 定义我们自己的自定义标签

让我们先玩得快一点，放松一点。当一个人如此行事时，他们往往会忘记自己的礼仪。因此，让我们制作一个 struct 字段标记，使我们的代码更有礼貌一些。

```
**type** Foo **struct** {
    Bar **string** `manners`
}
```

每当我们看到带有标签*礼仪*的字段，我们就应该用 *pretty please 对字符串进行后置处理。下面的片段概述了我们正在努力实现的目标。*

为了实现这种行为，我们需要依靠我们的好朋友*反射*包。

## 反射

反射是我们可以在运行时计算出一个结构包含的所有标签的方法。让我们首先打印出我们在结构中看到的所有标签。

现在我们需要专注于我们真正想要使用的标签。为了获取特定的标签，*反射*包提供了一个*查找*方法。

请注意，没有输出。

> 🤔为什么不呢？

因为我们打得太快太松了😱。让我们来看看来自*反射*包的一些文档。

> 按照惯例，标记字符串是可选空格分隔的键:“值”对的串联。每个键都是非空字符串，由除空格(U+0020 ' ')、引号(U+0022 ' " ')和冒号(U+003A ':')以外的非控制字符组成。每个值都使用 U+0022 ' " '字符和 Go 字符串文字语法引用。

既然我们已经阅读了文档，我们知道我们需要改变我们的结构字段标签的定义方式。一旦我们知道该字段正确地标记了我们正在寻找的标签，我们就需要找出一种方法来访问该字段的值。我们也可以用*反射*包来完成这个任务。完成所有这些编辑后，代码应该看起来像这样…

## 更进一步

太好了。我们定义了我们的自定义标签，让它做我们想做的事情，现在一切都好了，对吗？不完全是。你看，任何时候你使用*反射*软件包，你都在让自己陷入恐慌。为了安全起见，我们应该检查我们正在操作的*类*田地。对于这个标签，让我们保持简单，说它应该只对类型为 *string 的字段起作用。*此外，既然我们现在知道我们可以将一个值与我们的 struct field 标记相关联，那么我们说这个标记可以有选择地提供一个数字来定义单词 *pretty* 被打印的次数。

> 🎉恭喜🎉，我们现在已经创建了一个标签，使我们的代码更有礼貌！

# 我做了什么

现在，您已经了解了到野外探险并开始创建自己的定制标签所需的一切。如果你想引用一个稍微复杂一点的例子，我鼓励你[看一看 ***验证***](https://github.com/codyoss/verify) 。这是一个我扔在一起的包，它模仿了你可能在*javax . validation . constraints*中找到的一些东西，如果你熟悉的话。Go 社区中还有其他更完整的包，它们做的事情与我创建的包一样，但我想构建一些小而真实的东西来帮助自己理解 Go 中的标记。希望这些对你有帮助！

[](https://github.com/codyoss/verify) [## codyoss/验证

### 用字段标签验证你的结构！通过在 GitHub 上创建一个帐户来为 codyoss/verify 开发做贡献。

github.com](https://github.com/codyoss/verify) 

如果你能走到这一步，谢谢你。🙌