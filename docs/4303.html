<html>
<head>
<title>Laravel and Vue: Creating a Portfolio website with a CRUD admin panel — Chapter 22</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel和Vue:用CRUD管理面板创建作品集网站——第22章</h1>
<blockquote>原文：<a href="https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-22-72866624bd4d?source=collection_archive---------0-----------------------#2020-06-03">https://itnext.io/laravel-and-vue-creating-a-portfolio-website-with-a-crud-admin-panel-chapter-22-72866624bd4d?source=collection_archive---------0-----------------------#2020-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ef16" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">管理主页和登录系统</h2></div><p id="5edf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的管理员主页应该是这样的:</p><p id="9b0c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">admin/home.vue👇</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="df9c" class="ln lo it lj b gy lp lq l lr ls">&lt;template&gt;<br/>    &lt;div <em class="lt">id</em>="admin-home"&gt;<br/>        &lt;ProfileEditor/&gt;<br/>        &lt;PortfolioEditor/&gt;<br/>        &lt;AboutEditor/&gt;<br/>        &lt;social-media-links-editor/&gt;<br/>    &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>    <em class="lt">import </em>ProfileEditor <em class="lt">from </em>"./sections/ProfileEditor";<br/>    <em class="lt">import </em>PortfolioEditor <em class="lt">from </em>"./sections/PortfolioEditor";<br/>    <em class="lt">import </em>AboutEditor <em class="lt">from </em>"./sections/AboutEditor";<br/>    <em class="lt">import </em>SocialMediaLinksEditor <em class="lt">from </em>"./sections/socialMediaLinksEditor";<br/><br/>    <em class="lt">export default </em>{<br/>        name: "AdminHome",<br/>        components: {<br/>            SocialMediaLinksEditor,<br/>            AboutEditor,<br/>            PortfolioEditor,<br/>            ProfileEditor<br/>        },<br/>    }<br/>&lt;/script&gt;</span></pre><p id="70c9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们考虑一下登录系统。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lu"><img src="../Images/10648ea059866c3b08368b4e5a4fba93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzgQ444QL_E4ChuYwUZSCQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">【https://unsplash.com/@robschreckhise T4】</figcaption></figure><h2 id="b09a" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">为什么我们需要一个登录系统？</h2><p id="e58f" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们需要它，因为有一些<strong class="kk iu">函数/api路径</strong>我们不想对公众开放。我们只希望他们由管理员运行。</p><h2 id="4df9" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">这些函数/api路径在哪里？</h2><p id="d5a8" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">管理功能在<strong class="kk iu">api.php</strong>路线文件中。我们需要保护这些路线。</p><h2 id="e17a" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">我们如何保护路线？</h2><p id="c9b9" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们可以通过安装和使用<strong class="kk iu"> santum中间件</strong>来保护api路由。</p><p id="1d11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本章中，我们将:</p><ol class=""><li id="bfe0" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">安装圣所中间件</li><li id="7310" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">分配santum中间件</li><li id="d86b" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">阻止未经身份验证的用户访问管理组件</li><li id="b942" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">创建登录组件</li><li id="90a9" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">创建用户</li><li id="f8a0" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">重定向经过身份验证的用户</li></ol></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="98f8" class="ny lo it bd mh nz oa ob mk oc od oe mn jz of ka mq kc og kd mt kf oh kg mw oi bi translated">安装圣所中间件</h1><p id="120a" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们应该转到terminal/cmd并键入以下内容:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="7d96" class="ln lo it lj b gy lp lq l lr ls"><strong class="lj iu">composer require laravel/sanctum</strong></span></pre><blockquote class="oj"><p id="d426" class="ok ol it bd om on oo op oq or os ld dk translated">故障排除:结论不要安装</p></blockquote><p id="f812" class="pw-post-body-paragraph ki kj it kk b kl ot ju kn ko ou jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">如果你得到一个类似于<strong class="kk iu">的错误——结论:不要在控制台中安装…</strong>this，通过在终端中运行<code class="fe oy oz pa lj b"><strong class="kk iu">composer update</strong></code> <strong class="kk iu"> </strong>来更新composer。</p><p id="cff9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并在composer更新完成后运行<code class="fe oy oz pa lj b"><strong class="kk iu">composer require laravel/sanctum</strong></code> <strong class="kk iu"> </strong>。</p><p id="b5a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi pb translated"><span class="l pc pd pe bm pf pg ph pi pj di"> N </span> ext，我们必须在终端运行以下命令:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="c290" class="ln lo it lj b gy lp lq l lr ls"><strong class="lj iu">php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"</strong></span></pre><p id="f343" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将给我们在配置文件夹中的<strong class="kk iu">sanctum.php</strong>。</p><p id="54a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi pb translated">现在，我们应该在<strong class="kk iu">vendor/laravel/sanctum/src/Http/Middleware</strong>中有一个名为<strong class="kk iu">EnsureFrontendRequestsAreStateful.php</strong>的文件</p><p id="f910" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们必须通过添加下面的<strong class="kk iu">使用行</strong>在<strong class="kk iu"> app/Http/Kernal.php </strong>中使用这个文件</p><p id="28f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe oy oz pa lj b"><strong class="kk iu">use Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful;</strong></code></p><p id="2b55" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要将它插入内核的受保护中间件的<strong class="kk iu"> api数组</strong></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="92dc" class="ln lo it lj b gy lp lq l lr ls">'api' =&gt; [<br/>    EnsureFrontendRequestsAreStateful::class,<br/>    ...<br/>],</span></pre><p id="c675" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们应该去我们的。env文件，并添加以下内容:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4ae0" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">SANCTUM_STATEFUL_DOMAINS</em>=domain.example</span></pre><p id="bd7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们可以说圣所安装。现在，我们需要通过将中间件分配给一些路由来使用它。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h2 id="3fac" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">分配圣所中间件</h2><p id="d724" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">要将中间件分配给一条路线，必须添加<code class="fe oy oz pa lj b"><strong class="kk iu">-&gt;middleware('INSERT NAME OF MIDDLEWARE')</strong></code> <strong class="kk iu">。</strong></p><p id="d922" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们想要使用的中间件是<strong class="kk iu"> auth:sanctum </strong>，因此我们将保护<strong class="kk iu"> /profile </strong> post路由，如下所示:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="42ee" class="ln lo it lj b gy lp lq l lr ls">Route::<em class="lt">post</em>('/profile','ProfileController@store')-&gt;middleware('auth:sanctum');</span></pre><p id="2cbf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们<strong class="kk iu"> <em class="lt">可以</em> </strong> <em class="lt"> </em>将代码<code class="fe oy oz pa lj b"><strong class="kk iu">-&gt;middleware('auth:sanctum') </strong></code>添加到我们想要受密室保护的每条路线。这很好，但是很费时间。</p><p id="79db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您不想将相同的代码键入或复制粘贴到不同的路由中，那么您可以将中间件应用到一组路由中，如下所示:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="e7e5" class="ln lo it lj b gy lp lq l lr ls">Route::<em class="lt">middleware</em>('<strong class="lj iu">auth:sanctum</strong>')-&gt;group(<em class="lt">function </em>() {<br/>    // INSERT ROUTES HERE<br/>});</span></pre><p id="763b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们去<strong class="kk iu">api.php</strong>创建一个中间件路由组，如下所示:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="233d" class="ln lo it lj b gy lp lq l lr ls">Route::<em class="lt">middleware</em>('<strong class="lj iu">auth:sanctum</strong>')-&gt;group(<em class="lt">function </em>() {<br/>    Route::<em class="lt">post</em>('/profile', 'ProfileController@store');<br/>    ...<br/>});</span></pre><p id="eed5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，如果我们发布到<strong class="kk iu"> api/profile，</strong>它将通过sanctum中间件，并在您未登录的情况下，在网络选项卡中显示401错误。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi pk"><img src="../Images/4fb74576cecb2cb7476cbbcec0365afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HhioDYXmPzwdCyBEqdTi-g.png"/></div></div></figure><p id="5c85" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时:</p><ul class=""><li id="09a2" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld pl nj nk nl bi translated">未经认证的用户不能使用<strong class="kk iu"><em class="lt"/></strong>管理组件😃👍</li><li id="029a" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld pl nj nk nl bi translated">未经认证的用户可以<strong class="kk iu"> <em class="lt">访问</em> </strong>管理组件🙁👎</li></ul><blockquote class="pm pn po"><p id="dc0a" class="ki kj lt kk b kl km ju kn ko kp jx kq pp ks kt ku pq kw kx ky pr la lb lc ld im bi translated">是时候把眉头拧下来了</p><p id="ebd8" class="ki kj lt kk b kl km ju kn ko kp jx kq pp ks kt ku pq kw kx ky pr la lb lc ld im bi translated">让我们阻止未经身份验证的用户访问管理组件。</p></blockquote></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h2 id="3df4" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">阻止未经身份验证的用户访问管理组件</h2><p id="e916" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们需要去<strong class="kk iu"> router.js </strong>加一个<strong class="kk iu">导航卫士。</strong></p><h2 id="598e" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">导航防护装置</h2><p id="48c5" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">导航守卫是Vue.js的一项功能，如果不满足条件，它可以帮助您重定向或取消对某条路线的访问。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/27cb6bc9272bc6b00e9d1f5dd615d766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZGRVBfSzPr0QX58dK-Pcg.png"/></div></figure><p id="6a09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们要用的导航护板是<strong class="kk iu"> beforeEnter。</strong></p><p id="85c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们必须编辑路由器的管理路径对象，以包含beforeEnter保护:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="6bfc" class="ln lo it lj b gy lp lq l lr ls">{<br/>    path: '/admin',<br/>    component: AdminHome,<br/>    <strong class="lj iu">beforeEnter: INSERT FUNCTION NAME HERE</strong><br/>},</span></pre><p id="8d94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要创建一个功能，它将:</p><ul class=""><li id="e1e8" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld pl nj nk nl bi translated">检查用户是否未经身份验证</li><li id="b3c7" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld pl nj nk nl bi translated">如果未经认证，请转到<strong class="kk iu">/登录路径</strong></li><li id="4bd9" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld pl nj nk nl bi translated">如果通过验证，则转到所需的路线</li></ul><p id="04e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看如何构建这样一个函数:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="74d8" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">function </em>requireAuth (to, from, next) {<br/>    <em class="lt">if </em>(USER IS UNAUTHENTICATED) {<br/>        next({<br/>            path: '/login',<br/>        })<br/>    } <em class="lt">else </em>{<br/>        next()<br/>    }<br/>}</span></pre><p id="d7ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了让这样的函数工作，数据必须从Laravel传递到Vue。我们需要到<strong class="kk iu">welcome.blade.php</strong>并在&lt; head &gt; &lt; /head &gt;元素中插入以下脚本。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="1f9f" class="ln lo it lj b gy lp lq l lr ls">&lt;script&gt;<br/>    window.AuthCheck = "{{ Auth::<em class="lt">check</em>() ? 1 : 0}}"<br/>&lt;/script&gt;</span></pre><p id="d9b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Laravel将检查用户是否登录，并返回1或0。我们可以访问浏览器控制台，看到如果我们键入<code class="fe oy oz pa lj b"><strong class="kk iu">window.AuthCheck</strong></code> <strong class="kk iu"> </strong>，我们要么得到1，要么得到0。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/d43f8be1484915891303059d37252e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/1*PBZy2ZQFaU1cIVwdTWq93Q.png"/></div></figure><p id="c195" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们正在构建的函数现在可以更改如下:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="3830" class="ln lo it lj b gy lp lq l lr ls"><em class="lt">function </em>requireAuth (to, from, next) {<br/>    <em class="lt">let </em>AuthCheck = window.AuthCheck;<br/>    <em class="lt">if </em>(AuthCheck === "0") {<br/>        next({<br/>            path: '/login',<br/>        })<br/>    } <em class="lt">else </em>{<br/>        next()<br/>    }<br/>}</span></pre><p id="9cfb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在进入之前，我们可以把它用作<strong class="kk iu">导航护栏。</strong></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="20b9" class="ln lo it lj b gy lp lq l lr ls">{<br/>    path: '/admin',<br/>    component: AdminHome,<br/>    <strong class="lj iu">beforeEnter: requireAuth</strong><br/>},</span></pre><p id="f4b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们转到管理路径，我们将被重定向到登录路径。</p><p id="89ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此时:</p><ul class=""><li id="115a" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld pl nj nk nl bi translated">未经认证的用户无法使用<strong class="kk iu"><em class="lt"/></strong>Admin组件😃👍</li><li id="6dab" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld pl nj nk nl bi translated">未经认证的用户无法<strong class="kk iu"> <em class="lt">访问</em> </strong>管理组件😃👍</li></ul><p id="60c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在面临的问题是缺少登录组件。我们被重定向到登录路由，但是我们在该路由上没有看到任何组件。这意味着我们需要创建一个登录组件。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h1 id="5121" class="ny lo it bd mh nz oa ob mk oc od oe mn jz of ka mq kc og kd mt kf oh kg mw oi bi translated">登录组件</h1><p id="3ee5" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">我们从绑定到数据返回对象的简单登录表单开始。</p><figure class="le lf lg lh gt lv"><div class="bz fp l di"><div class="pu pv l"/></div></figure><p id="310f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在需要通过添加登录函数/方法来使它起作用。</p><p id="2b40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当使用sanctum中间件时，我们必须做的第一件事是对<strong class="kk iu"> /sanctum/csrf-cookie </strong>执行一个get请求，在then块中我们可以编写让用户登录的代码。</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="dcab" class="ln lo it lj b gy lp lq l lr ls">methods: {<br/>    login() {<br/>        <strong class="lj iu">axios.get('/sanctum/csrf-cookie').then(response =&gt; {<br/>            <br/>        })</strong><br/>    }<br/>}</span></pre><p id="1cba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我们执行get请求之后，我们<strong class="kk iu">将</strong>发送到<strong class="kk iu"> api/login </strong></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="e45d" class="ln lo it lj b gy lp lq l lr ls">login() {<br/>    axios.get('/sanctum/csrf-cookie').then(response =&gt; {<br/>        <strong class="lj iu">axios.post('/api/login', {<br/>            email: <em class="lt">this</em>.email,<br/>            password: <em class="lt">this</em>.password,<br/>        })</strong><br/>    })<br/>},</span></pre><p id="5c03" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在api.php的相应路线应该是:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="1302" class="ln lo it lj b gy lp lq l lr ls">Route::<em class="lt">post</em>('/login', 'Auth\LoginController@login');</span></pre><p id="1330" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们有了一个登录组件，我们需要创建一个用户。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h2 id="8e4b" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">创建用户</h2><p id="651a" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">创建用户将通过tinker完成。我们应该从终端键入<code class="fe oy oz pa lj b">php artisan tinker</code>开始修补。</p><p id="d47f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">重要—密码必须经过哈希处理</strong></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4598" class="ln lo it lj b gy lp lq l lr ls">Hash::make(‘INSERT PASSWORD HERE’)</span></pre><figure class="le lf lg lh gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi pw"><img src="../Images/09a62469452d608a48673ec94fb8e194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pmg1T-n4N8Hgg_eb7822sQ.png"/></div></div></figure><p id="73fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要在用户通过身份验证后将他们重定向到管理组件。</p></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><h2 id="2e91" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">重定向经过身份验证的用户</h2><p id="c0bf" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">这里，我们应该添加一个<code class="fe oy oz pa lj b"><strong class="kk iu">then block</strong></code>来编程用户登录后会发生什么。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi px"><img src="../Images/8964261e02297d930a90f6f3c4a2d83c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dm-eU2NjeZPe5Lxsp_yy5A.png"/></div></div></figure><p id="71f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用户登录后，我们应该使用<code class="fe oy oz pa lj b"><strong class="kk iu">this.$router.push({path: ‘/admin’})</strong></code> <strong class="kk iu"> </strong>，这样经过验证的用户就会被重定向到<strong class="kk iu"> /admin </strong></p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="50d8" class="ln lo it lj b gy lp lq l lr ls">login() {<br/>    axios.get('/sanctum/csrf-cookie').then(response =&gt; {<br/>        axios.post('/api/login', {<br/>            email: <em class="lt">this</em>.email,<br/>            password: <em class="lt">this</em>.password,<br/>        })<br/>            .then(response =&gt; {<br/>                <strong class="lj iu">this.$router.push({path: ‘/admin’})</strong><br/>            })<br/>    })<br/>},</span></pre><p id="0229" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们插入正确的电子邮件和密码，Vue会将我们重定向到<strong class="kk iu"> /admin </strong>路径，但我们会遇到一个导航守卫(<strong class="kk iu">before enter:require auth)</strong>。</p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div class="gh gi py"><img src="../Images/8a0e381663b98b058e9581ec82aca1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*avB9YmQ_Rly7d2_hR8xeOw.png"/></div></figure><p id="031f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">导航卫士将我们重定向回登录组件，因为<strong class="kk iu">welcome.blade.php</strong>中的<code class="fe oy oz pa lj b"><strong class="kk iu">window.AuthCheck</strong></code><strong class="kk iu">T22的值仍然为0。</strong></p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/6390137d5400a99e80edd87b213bab0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*RiHI-cikdoNrD3dwQPKEIQ.png"/></div></figure><p id="3462" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们在浏览器中加载刀片文件时，我们得到这个值。这意味着我们要么需要在登录时<strong class="kk iu">重新加载+重定向站点</strong>，要么在登录时<strong class="kk iu">更改值</strong>。</p><h2 id="aa2a" class="ln lo it bd mh mi mj dn mk ml mm dp mn kr mo mp mq kv mr ms mt kz mu mv mw mx bi translated">重新加载+重定向与更改值</h2><p id="5d41" class="pw-post-body-paragraph ki kj it kk b kl my ju kn ko mz jx kq kr na kt ku kv nb kx ky kz nc lb lc ld im bi translated">重新加载+重定向网站并转到管理路径的代码是<code class="fe oy oz pa lj b">window.location.href = "/admin";</code></p><figure class="le lf lg lh gt lv gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/e575efaf1421854bc0e886da11ea8655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*WfJazEH9fZHvRwXQSjYMAg.png"/></div></figure><p id="ed76" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是可行的，但效率不高。我们希望避免网站重新加载，因此改变窗口的价值。手动授权更好。</p><p id="e4d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的登录方法应该是这样的:</p><figure class="le lf lg lh gt lv"><div class="bz fp l di"><div class="pu pv l"/></div></figure><p id="46b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，导航员会看着窗户。AuthCheck并发现它的值为1，让经过身份验证的用户转到admin路径。</p><p id="ae4a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完成后，我们现在有了一个投资组合网站，使用Laravel和Vue创建了一个CRUD管理面板。</p><p id="08b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是该网站活动版本的链接:</p><p id="ed27" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae mg" href="https://umar.app/portfolio/" rel="noopener ugc nofollow" target="_blank">umar.app/portfolio</a></p><p id="77fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae mg" href="https://umar.app/portfolio/admin" rel="noopener ugc nofollow" target="_blank">umar.app/portfolio/admin</a></p><blockquote class="oj"><p id="10a4" class="ok ol it bd om on qb qc qd qe qf ld dk translated">谢谢你</p></blockquote></div></div>    
</body>
</html>