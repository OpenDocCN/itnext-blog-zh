<html>
<head>
<title>Which environment is this? — or making Pushwoosh “intelligent”.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这是什么环境？—或者让Pushwoosh变得“智能”。</h1>
<blockquote>原文：<a href="https://itnext.io/which-environment-is-this-or-making-pushwoosh-intelligent-b319739fca26?source=collection_archive---------2-----------------------#2020-04-09">https://itnext.io/which-environment-is-this-or-making-pushwoosh-intelligent-b319739fca26?source=collection_archive---------2-----------------------#2020-04-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/5d81142e32f896ada837705ba5daba7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ccLs5B_V-Dm2HBaDPofD5g.jpeg"/></div></div></figure><div class=""/><p id="e9a4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你好。你在那里过得怎么样？我们生活在困难时期，但我们需要相信一切都会迎刃而解。如果可以，请#StayAtHome。如果你不能，那么…祝你好运，谢谢你的服务！是的，我假设你离开家是因为你需要提供一项基本服务。</p><h2 id="48c3" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">闲聊</h2><p id="09aa" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated"><em class="lu">aaaaahhh</em>，自从我上一篇文章以来，发生了这么多事情！我去了比利时，为一家使用Adyen的在线商店部署了一个全功能的支付网关——我的个人资料中有几篇关于这方面的文章，但Adyen从那以后发生了一些变化(我自己注意:也许会写新的)——然后去了纽约度假。在世界开启“疯狂模式”之前。</p><p id="e2a2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，斗争是真实的:一些公司不知道没有业务他们将如何生存。其他公司都在尽最大努力，所以我们不会错过任何重要的东西。裁员、失业、财政削减……艰难的时刻即将到来。但是，希望一切都会迎刃而解。</p><p id="d859" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">你在家吗，想找些有趣的事情做吗？</strong>前往outsystems.com/learn<a class="ae lv" href="https://www.outsystems.com/learn" rel="noopener ugc nofollow" target="_blank"/>看看一些课程和引导路径，这样你就可以进入低代码世界了！不用担心，这不是一个附属链接——但是因为我是OutSystems的MVP，所以我建议它是有意义的，对吗？</p><p id="f43c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">鉴于当前的事件，我将帮助世界各地的一些人/公司。因此，<strong class="ka jc">如果你有兴趣和我进行一次免费的会话，这样我们就可以讨论一些与OutSystems生态系统相关的东西，请访问</strong><a class="ae lv" href="https://www.volitionalsoftware.com/StayAtHome" rel="noopener ugc nofollow" target="_blank"><strong class="ka jc">https://www.volitionalsoftware.com/StayAtHome</strong></a><strong class="ka jc">。是的，我说的免费就是免费。没有附加条件。检查链接，自己看看它应该如何工作。</strong></p><p id="aab4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，OutSystems将在4月15日前免费发放认证券。有关更多信息，请访问上面的OutSystems网站。不过，要知道:“在家工作”、裁员等等已经影响到了每个人，包括监考公司。<a class="ae lv" href="https://www.outsystems.com/forums/discussion/59325/covid-19-free-certificate-offer-no-respoonse/#Post226293" rel="noopener ugc nofollow" target="_blank">预计在获得响应方面会有延迟</a>。</p><p id="4c58" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经进行了一些很酷的闲聊，是时候进入有趣的部分了。</p><h2 id="e60f" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">环境和更多的环境！</h2><p id="f94b" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">大约在2019年的某个时候，对Pushwoosh插件(嗯，不完全是插件)进行了更改，要求如下:您的Android应用程序需要有一个“google-services.zip ”,其中包含google-services目标目录中的google-services.json文件。迷惑？嗯，没那么多。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lw"><img src="../Images/a2f458033e941eefc75e54c17da9de55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZNJenSW8GS9i5Or5noc2g.png"/></div></div></figure><p id="96b2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要做的第一件事是在Firebase控制台中创建一个项目，然后将其添加到“一个android应用程序”中。你填写细节，然后它会给你一个下载google-services.json文件的选项。这个文件包含关于你的应用的信息，比如包名(非常非常重要)。为什么包名很重要？因为如果它不匹配你的应用标识符，<strong class="ka jc">就不会编译</strong>。或者建造。或者生成。我说编译是因为没有一个软件工程师说过“它正在生成”或“它正在构建”。它已经并将永远是“它正在编译”。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/db527eac705b6cbf73ce7fb6f8e2e21c.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/0*jPHon9dt0Cyc8diL.png"/></div></figure><p id="d096" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的例子中，包名是com . volitionalsoftware . whiteridge，为什么是white ridge？大家都知道曼哈顿计划。当我在写硕士论文的时候，我想给我的git库起一个很酷的名字。所以我最有可能去找一个名字生成器，比如<a class="ae lv" href="http://www.codenamegenerator.com/" rel="noopener ugc nofollow" target="_blank">这个</a>，名字就出来了。因此，Project Whiteridge是OutSystems平台中单元测试生成的自动化工具。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/8cbb1599a64dbd071b35ee9514623d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*4txyWzsWfkBNzJr0hUbGMA.png"/></div></figure><p id="8c5a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，回到正题。让我们创建一个移动应用程序作为我们的基线。我们将使用Pushwoosh插件，并且只在我们的登录逻辑中使用RegisterUser客户端动作。我们发布模块(没有任何资源)，让我们尝试生成一个Android应用程序。猜猜会发生什么？如果你的猜测是BADABOOOOOOOOOM！，你是对的！</p><p id="8054" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些是我们生成应用程序的设置:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi md"><img src="../Images/57ca2f786f95a8aea0fa2b273312dad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJpkOl0OkMtUHHEfEFhG9Q.png"/></div></div></figure><p id="d6c8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所料，它失败了。让我们来看看构建日志。这里有两个<strong class="ka jc"> <em class="lu">突起</em> </strong>:</p><ul class=""><li id="1589" class="me mf jb ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated">在进入OutSystems论坛——或者几乎任何人——寻求帮助之前，先检查一下构建日志。我们——在论坛中提供帮助的人——OutSystems support或几乎任何人肯定会要求这样做。大多数情况下，Service Studio中显示的错误消息并没有反映出问题背后的真正原因，因此您(和我们)不查看日志就无法发现问题。</li><li id="3716" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">(Advanced protip)如果您的插件代码出现问题，而您不知道“为什么”,您可以使用著名的<em class="lu"> console.log </em>函数在构建过程中写入构建日志。那是我的救世主。</li></ul><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/76159ccbbcc97c291a78adac5f7f6dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNAHypGUKACl1N817ReOGg.png"/></div></div></figure><p id="3e04" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嘣！让我们来看看构建日志。如果您不知道在哪里可以找到它，请转到服务中心，搜索有问题的应用程序，并在其中检查本机选项卡。你会有一个“文件”图标，你可以下载它。</p><p id="ba51" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将把它拆成最相关的部分，所以请耐心听我说:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="b7df" class="kw kx jb mu b gy my mz l na nb">[2020–04–03T13:58:52.071Z] [INFO] Plugin Id: <a class="ae lv" href="https://github.com/OutSystems/pushwoosh-phonegap-plugin.git#7.17.1-OS1" rel="noopener ugc nofollow" target="_blank">https://github.com/OutSystems/pushwoosh-phonegap-plugin.git#7.17.1-OS1</a><br/>[2020–04–03T13:58:52.073Z] [INFO] Plugin Action: add</span></pre><p id="bbb6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一切从添加插件开始。</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="ac67" class="kw kx jb mu b gy my mz l na nb">Installing “pushwoosh-cordova-plugin” for android</span></pre><p id="aa3d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从存储库中获得了代码，现在是时候将它安装到我们的应用程序中了。</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="5d04" class="kw kx jb mu b gy my mz l na nb">Failed to install ‘pushwoosh-cordova-plugin’: undefined<br/>Error: Failed to install Pushwoosh plugin. Reason: Configuration zip file not found.</span></pre><p id="8268" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们的错误消息。我们的应用程序在所需的目录中没有文件作为资源，因此无法构建。</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="7eaf" class="kw kx jb mu b gy my mz l na nb">[2020–04–03T13:59:00.982Z] [ERROR] Build failed with the following error: Error installing Cordova plugin: pushwoosh-cordova-plugin.</span></pre><p id="6248" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是您在Service Studio中看到的错误。它讲述了整个故事吗？嗯，不。鉴于Pushwoosh是一个受支持的插件，你的第一个猜测可能是“那我们开一个支持票吧”。记住，总是检查构建日志！</p><p id="0ad2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们按照<a class="ae lv" href="https://success.outsystems.com/Documentation/How-to_Guides/Integrations/How_to_Use_Push_Notifications_with_Pushwoosh" rel="noopener ugc nofollow" target="_blank">文档</a>中的说明添加我们的google-services.zip，然后再试一次。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/6b95cf8e5a156beed6902bf3f516500e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Anu_N2hOuds3oU774FuCZQ.png"/></div></div></figure><p id="6fee" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">哦，看那个。有用！但这不是我写这些的原因。我写这封信是为了回答最有可能的后续问题，即:</p><blockquote class="nd"><p id="c55b" class="ne nf jb bd ng nh ni nj nk nl nm kv dk translated">“好的，这很公平。但是我有一个从开发到QA再到生产的应用程序。我该如何解决这个问题？”</p></blockquote><p id="17a8" class="pw-post-body-paragraph jy jz jb ka b kb nn kd ke kf no kh ki kj np kl km kn nq kp kq kr nr kt ku kv ij bi translated">当您将代码从环境A部署到环境B时，resources文件夹也将被部署。因此，您可以:</p><ol class=""><li id="0788" class="me mf jb ka b kb kc kf kg kj mg kn mh kr mi kv ns mk ml mm bi translated">对3+环境(至少是开发、测试和生产)使用相同的应用程序标识符，或者</li><li id="0973" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv ns mk ml mm bi translated">部署代码，然后手动更新文件，这样您就可以正确地生成应用程序。</li></ol><p id="6401" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这有用吗？是的。够好吗？对我来说不是。</p><h2 id="3551" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">别人是做什么的？</h2><p id="a664" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">我联系了负责维护Pushwoosh插件的团队成员，询问他们如何处理这种情况。</p><p id="2d1a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">他们的回答是，他们在部署后进行手动文件上传，他们知道这不是一个非常愉快的体验。但是，目前，这是他们所拥有的。</p><h2 id="6365" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">跨环境管理应用</h2><p id="2388" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">嗯，有几种方法可以跨环境管理应用程序，但我通常只对不同的环境使用不同的标识符。对于这个例子，一种可能性是:</p><ul class=""><li id="724d" class="me mf jb ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated">发展:<code class="fe nt nu nv mu b">com.volitionalsoftware.whiteridge.<strong class="ka jc">dev</strong></code></li><li id="fd37" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">测试:<code class="fe nt nu nv mu b">com.volitionalsoftware.whiteridge.<strong class="ka jc">test</strong></code></li><li id="8b3d" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">生产:<code class="fe nt nu nv mu b">com.volitionalsoftware.whiteridge</code></li></ul><p id="407b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着我可以同时在我的设备中保留这三种环境，这很有用。我也对Pushwoosh做了同样的事情——N个不同环境下的不同Pushwoosh应用程序。虽然这并不意味着您需要为N个环境准备N个Pushwoosh应用程序，但是我强烈建议您至少准备一个“生产”应用程序和一个非生产应用程序。你不想给你的用户发送不想要的通知，对吗？</p><p id="8731" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您相当清楚生存期部署是如何工作的，那么您不能指定资源的版本，也不能让它们是动态的。因此，假设我们需要在安装Pushwoosh插件时，在给定的目录中有正确的<em class="lu"> google-services.zip </em>文件，我们如何实现自动化呢？</p><h2 id="e3c3" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">亲爱的读者，来见见胡克斯。</h2><p id="c7b5" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">OutSystems移动应用程序运行在Cordova之上，Cordova有一个叫做“钩子”的东西。<a class="ae lv" href="https://cordova.apache.org/docs/en/latest/guide/appdev/hooks/" rel="noopener ugc nofollow" target="_blank">来自他们的文档</a>:</p><blockquote class="nw nx ny"><p id="a782" class="jy jz lu ka b kb kc kd ke kf kg kh ki nz kk kl km oa ko kp kq ob ks kt ku kv ij bi translated">cordova钩子代表特殊的脚本，可以由应用程序和插件开发者添加，甚至可以由你自己的构建系统定制Cordova命令。</p><p id="79c6" class="jy jz lu ka b kb kc kd ke kf kg kh ki nz kk kl km oa ko kp kq ob ks kt ku kv ij bi translated">cordova钩子允许你在Cordova命令周围执行特殊的活动。例如，您可能有一个自定义工具来检查javascript文件中的代码格式。而且，您希望在每次构建之前运行这个工具。在这种情况下，您可以使用“before_build”挂钩，并指示cordova运行时在每次构建之前运行要调用的自定义工具。</p></blockquote><p id="cf14" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，有两种方法可以运行钩子:要么把它放在应用程序的钩子文件夹中，要么使用一个插件。我们走第二条路(插件),因为第一条路不容易实现。下面你可以看到添加了android平台的Cordova项目的文件夹结构:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="456c" class="kw kx jb mu b gy my mz l na nb">├── hooks<br/>├── platforms<br/>│   └── android<br/>│       ├── cordova<br/>│       └── platform_www<br/>├── plugins<br/>├── res<br/>├── www<br/>└── config.xml</span></pre><p id="f33d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如你所见(感谢joo！)，钩子文件夹和<code class="fe nt nu nv mu b">www</code>文件夹在同一层。我们放入OutSystems应用程序的资源中的任何东西，以及我们部署到给定的目标目录中的任何东西，都会部署到<code class="fe nt nu nv mu b">www/&lt;target directory&gt;/filename.extension</code>中。因此，无法使用应用程序的hooks文件夹。</p><p id="909f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以还是走外挂路线吧，一个空的。你知道如何创建一个包含两个平台(android和iOS)所需的所有东西的空插件吗？没有吗？别担心，我们是来帮助你的。前往timbotnik的<a class="ae lv" href="https://github.com/timbotnik/cordova-plugin-empty" rel="noopener ugc nofollow" target="_blank"> cordova-plugin-empty </a>并将其分叉或克隆。如果你克隆它，确保你把它放入你控制的存储库中——如果你想走那条路的话。在OutSystems中使用原生插件还有其他可能性,但是对于本文，我们将使用公共git库。</p><p id="8bca" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于“本地”代码的结果可以在<a class="ae lv" href="https://github.com/aportuguesecoder/pushwoosh-google-services-management" rel="noopener ugc nofollow" target="_blank">https://github . com/aportuguesecoder/pushwoosh-Google-services-management</a>上看到。我决定称之为Pushwoosh谷歌服务管理，因为，嗯…这就是我们想要做的，对不对？我们将为正确的环境管理google-services文件。</p><p id="5eb3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们深入研究插件本身之前，让我们先看一下这个实现的外部系统部分。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/511bbc9d64cf80be1bd545e0813d6ae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OwOHg95LSQyz5YwxKtXUTw.png"/></div></div></figure><p id="ab70" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的插件只有一个公共web块——所以我们可以引用它，并确保插件的代码包含在生成的二进制文件中——并按照OutSystems的要求定义可扩展性配置:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/bf1e6c7b46d6c23db0dc2eb5cb2561c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ff9b79vFvzVI1iiQMLh5pQ.png"/></div></div></figure><p id="3858" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是外部系统部分。很快，是吧？</p><p id="93c2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们进入插件部分。如果您查看了上面的链接，您应该会看到类似这样的内容:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/bedd3edf710cc85bd459042b4f9acd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cpTDtxs93rYYLFY0rw0-w.png"/></div></div></figure><p id="f488" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">忘记<em class="lu"> src </em>和<em class="lu"> www </em>文件夹。也忘记了<em class="lu"> package.json </em>文件。我们只是真正关心<em class="lu"> plugin.xml </em>文件和<code class="fe nt nu nv mu b">hooks</code>文件夹。让我们先进入<em class="lu"> plugin.xml </em>文件。</p><p id="7ed5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据Cordova的文档，<em class="lu"> Plugin.xml文件定义了插件所需的结构和设置。它有几个元素来提供关于你的插件的细节。</em></p><p id="d164" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以查看整个plugin.xml文件的细节，但是现在，让我们只关注(最)相关的部分。下面是我们将要分析的摘录:</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="5c07" class="kw kx jb mu b gy my mz l na nb">&lt;js-module src="www/GoogleServices.js" name="GoogleServices"&gt;<br/> &lt;clobbers target="plugins.GoogleServices" /&gt;<br/>&lt;/js-module&gt;<br/>&lt;platform name='android'&gt;<br/> &lt;config-file target="res/xml/config.xml" parent="/*"&gt;<br/>  &lt;feature name="GoogleServices"&gt;<br/>    &lt;param name="android-package" value="com.armandogomes.cordova.plugin.GoogleServices" /&gt;<br/>  &lt;/feature&gt;<br/> &lt;/config-file&gt;<br/>  &lt;source-file src="src/android/GoogleServices.java" target-dir="src/com/armandogomes/cordova/plugin" /&gt;<br/>  &lt;hook type="before_plugin_add" src="hooks/before_build_MoveGoogleServices.js" /&gt;<br/>&lt;/platform&gt;</span></pre><p id="8b61" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">js-module入口指向我们的“代码”文件，该文件可以在我们的外部系统应用程序中使用。这需要匹配本地文件，否则，它不会工作。除此之外，它在这里只是一个占位符。</p><p id="b9eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们需要看到的是<code class="fe nt nu nv mu b">&lt;platform name=’android'&gt;</code>元素下的<code class="fe nt nu nv mu b">&lt;hook&gt;</code>元素。您可能已经猜到了，不同的钩子可以应用于不同的平台。鉴于我们只需要在android上这样做，没有必要在iOS上使用相同的钩子。</p><p id="20c8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的钩子是做什么的？</p><p id="8f8d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的钩子有一个非常明确的目标:确保我们能够构建我们的应用程序。为此，我们将工作分为三个阶段:</p><ol class=""><li id="4b23" class="me mf jb ka b kb kc kf kg kj mg kn mh kr mi kv ns mk ml mm bi translated">获取我们的应用程序的config.xml文件。</li><li id="3332" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv ns mk ml mm bi translated">处理config.xml文件，搜索正在生成的应用程序的标识符。</li><li id="8465" class="me mf jb ka b kb mn kf mo kj mp kn mq kr mr kv ns mk ml mm bi translated">将正确的文件复制到最终文件夹。</li></ol><p id="4586" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">步骤1 —获取config.xml文件</strong></p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="ff69" class="kw kx jb mu b gy my mz l na nb">// determine appId (read it from config.xml)<br/>var configFile = "config.xml";<br/>var xmlData = fs.readFileSync(configFile).toString('utf8');</span></pre><p id="caec" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您还记得前面显示的文件夹结构，config.xml文件将位于生成的Cordova项目的根目录下。虽然我似乎没有找到任何文档资料指出——而且我对这个“完整的Cordova”世界还是有点陌生——但是钩子似乎运行在项目的根目录下，因此允许我们直接调用config.xml文件，而不是试图找出路径。</p><p id="e14d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">(如果你愿意，可以跳过这一段)</strong>如果我可以推断正在发生什么，我会说所有plugin.xml文件的内容都将“嵌入”在一个“master config.xml”文件中，然后该文件将按照所需的顺序执行钩子。也许我需要做一些测试来找出答案——或者只是问一些有知识的人。</p><p id="d325" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从文件系统节点模块调用fs.readFileSync函数，这样我们可以同步读取它。为什么同步？因为我们希望确保脚本的其余部分按预期执行，所以当脚本的其余部分需要它们的“饮料”时，“<a class="ae lv" href="https://www.youtube.com/watch?v=hI0Q7IPWjOk" rel="noopener ugc nofollow" target="_blank">将有饮料</a>”！啊，我想念Kimi。#Bwoah</p><p id="93b4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nt nu nv mu b">toString('utf8')</code>函数只是获取可读字符串形式的输出。我们可以在readFileSync函数中传递编码，但这将在这个钩子的v2.0中完成，同时还会有更多的变化。有人曾经说过，如果你看着6个月前的代码，你仍然做着同样的事情，你就没有进步。</p><p id="3d44" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">步骤2 —识别应用程序的标识符</strong></p><p id="6b5f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们现在有了config.xml文件的全部内容。<a class="ae lv" href="https://cordova.apache.org/docs/en/latest/config_ref/index.html" rel="noopener ugc nofollow" target="_blank">如果我们看一下Cordova的文档</a>，我们可以看到根元素widget有一个名为<strong class="ka jc"> id </strong>的属性，它指定了反向域标识符。鉴于这是我们想要的——因为这唯一地标识了正在构建的应用程序——我们将在文本中进行简单的搜索来检索它。我们能把config.xml映射到一个对象吗？很有可能。</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="8810" class="kw kx jb mu b gy my mz l na nb">var n = xmlData.search(" id=\"");<br/>if(n &gt; 0) {  <br/>  n += 5;  <br/>  var count = 0;  <br/>  var cont = true;  <br/>  while(cont) {    <br/>    if(xmlData[n+count] == "\"") {<br/>      cont = false;<br/>    } else {<br/>      count++;<br/>    }<br/>  }<br/>  appId = xmlData.substring(n, n+count);<br/>  console.log("[PUSHWOOSH HELPER] App Identifier detected: " + appId);<br/>}</span></pre><p id="1889" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们知道这个属性被命名为<strong class="ka jc"> id </strong>。我们该怎么办？搜索一下。搜索函数将返回搜索文本开始的字符串中的索引。如果仔细观察，您会发现在id<strong class="ka jc">和id </strong>之前有一个空格。这意味着获得仅id属性。如果我们在我们想要的id属性前有一个，比如说，“somethingid=”，这将是匹配——是的，又是badaboom。</p><p id="75c8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们搜索的是“<strong class="ka jc"> id=\" </strong>”(回退是转义字符，所以不计入字符数)，我们知道返回的索引将是空格的起点。我们还知道我们的搜索字符串有五个字符的长度，所以我们可以在索引中增加五个字符(用n表示)。然后，用最有效、最漂亮的方式去做——绝对不行！——我们只是迭代字符串搜索下一个<strong class="ka jc"> " </strong>字符，这意味着属性的值已经结束——我们为此使用了一个while循环。最后，一旦找到了<strong class="ka jc"> " </strong>，我们只需将substring函数从n(第一个<strong class="ka jc"> " </strong>之后，标识符开始的地方)应用到<strong class="ka jc"> n + count </strong>，其中count是标识符的长度。哦，我们会记录我们发现的问题，因此这些问题会显示在您可以在服务中心获得的构建日志中。</p><p id="f09a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第三步——复制这该死的文件！</p><pre class="lx ly lz ma gt mt mu mv mw aw mx bi"><span id="3913" class="kw kx jb mu b gy my mz l na nb">function copyGoogleServicesFile() {<br/>  var srcFile = path.join(<br/>    "www/google-services", appId, "google-services.zip");<br/>  console.log("[PUSHWOOSH HELPER] Source file path: " + srcFile);<br/>  if(fs.existsSync(srcFile)) {<br/>    var buildPath = "platforms/android/app/src/main/assets/www/google-services";<br/>    fs.mkdirSync(buildPath, { recursive: true });<br/>    console.log("[PUSHWOOSH HELPER] File exists.");<br/>    fs.createReadStream(srcFile).pipe(<br/>      fs.createWriteStream(path.join(<br/>        buildPath, "google-services.zip")<br/>      )<br/>    );<br/>    console.log("[PUSHWOOSH HELPER] File was copied into " +<br/>      path.join(buildPath, "google-services.zip") + ".");<br/>  }<br/>};</span></pre><p id="985f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">准备好我们的可识别标识符后，我们可以进入这个过程的最后一步:将适当的文件从给定的源文件夹复制到正确的(最终的)文件夹中。</p><p id="1533" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当你试图构建一个Cordova项目时会发生什么，请稍微解释一下(就像我18岁时一样):在之前显示的树结构中，我们有一个<code class="fe nt nu nv mu b">www </code>文件夹和一个<code class="fe nt nu nv mu b">platform_www</code>文件夹(<code class="fe nt nu nv mu b">platforms/android</code>的嵌套元素)。当我们准备应用程序时(构建过程的步骤之一— <code class="fe nt nu nv mu b">cordova build</code> build是<code class="fe nt nu nv mu b">cordova prepare</code> + <code class="fe nt nu nv mu b">cordova compile</code>的快捷方式)，www目录的内容被复制到<code class="fe nt nu nv mu b">platforms/android/platform_www</code>文件夹中。总而言之，你在<code class="fe nt nu nv mu b">www</code>目录中的任何改变都会影响所有的平台。你在<code class="fe nt nu nv mu b">platforms/&lt;platform&gt;/platform_www</code>做的任何事情都只会影响那个特定的平台。预计会被覆盖，因此请谨慎操作。</p><p id="5542" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们在OutSystems中添加一个新资源时，我们说它应该被部署到目标目录，这与说“部署到<code class="fe nt nu nv mu b">www/&lt;target directory&gt;/filename.extension</code>”是一样的。所以，在编译时，Cordova会将文件复制到<code class="fe nt nu nv mu b">platforms/android/platform_www/&lt;target directory&gt;/filename.extension</code>中。</p><p id="8a4e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到代码部分。我们要做的第一件事是确保我们想要的文件存在。我们通过检查<code class="fe nt nu nv mu b"> www/&lt;application identifier&gt;/google-services.json</code>是否存在来实现。如果文件存在，我们将文件复制到<code class="fe nt nu nv mu b">platforms/android/app/src/main/assets/www/google-services</code>中。</p><p id="dc43" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">为什么是这个文件夹？</strong>我试着复制到<code class="fe nt nu nv mu b">platforms/android/platform_www</code>中，但是很明显，由于Pushwoosh插件找不到文件，它没有被及时发送。一些“面向打印的调试”之后，我发现文件夹做的把戏。</p><p id="776d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">步骤4 —在Service Studio中组织文件</strong></p><p id="9990" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是最后一步，它不是插件本身的一部分，但我们需要这样做——否则，我们所做的就没有任何意义。我们需要确保我们的文件符合我们期望的命名约定。因此，三个环境的管道应该是这样的:</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div class="gh gi of"><img src="../Images/1699066db14bbe154d4ba17a5880927d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*Y4k6fJeU5u0Xn2AQt-LjhA.png"/></div></figure><p id="b46d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">瞧，我们的“即时文件管理”成功了，现在Pushwoosh构建成功了。</p><h2 id="2d6f" class="kw kx jb bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">这是最后的倒计时！</h2><p id="5663" class="pw-post-body-paragraph jy jz jb ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">嗯，这里有太多需要改进的地方了！错误管理，代码“美化”，提高性能等等。这个插件的第一个版本将在未来几天内发布，正如你可能已经猜到的，它只适用于移动应用。</p><p id="4856" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在使用它时遇到任何问题，请通过forge组件支持标签让我知道，这样我(或社区的任何其他成员)就可以回复您的帮助请求。</p><figure class="lx ly lz ma gt is gh gi paragraph-image"><div class="gh gi og"><img src="../Images/505ecc2ac22bbd2e32e81e7a3ef5bedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*fI5uN32mrDZ4yhFw3xr2PQ.png"/></div></figure><p id="9883" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在结束之前，你可能会想:为什么他要从这个“意志软件”公司推广免费咨询？事实是，我有点厌倦了独自工作，鉴于外部系统生态系统的性质，你只能做这么多。因此，我决定接受新的挑战，并创建了意志软件。我仍在构建它——我认为从现在开始这是一项不间断的工作——但请随时联系我们，让我们讨论如何合作。请在<a class="ae lv" href="https://www.volitionalsoftware.com" rel="noopener ugc nofollow" target="_blank">volitionalsoftware.com</a>访问我们，或者在hello@ &lt; ourdomain &gt;留言(这样我们就不会收到太多垃圾邮件)。</p><p id="a49d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">非常感谢你和我一起拥抱这个旅程。很高兴能和你分享这一切，和往常一样，如果你有任何问题或建议，请告诉我。</p><p id="369d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保重，呆在家里！</p></div></div>    
</body>
</html>