<html>
<head>
<title>Advanced NestJS techniques — Part 4 — Logging Redis commands</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级NestJS技术—第4部分—记录Redis命令</h1>
<blockquote>原文：<a href="https://itnext.io/advanced-nestjs-techniques-part-4-logging-redis-commands-7a93b7a309bd?source=collection_archive---------2-----------------------#2020-08-19">https://itnext.io/advanced-nestjs-techniques-part-4-logging-redis-commands-7a93b7a309bd?source=collection_archive---------2-----------------------#2020-08-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f85c209947a65ccd6b2c54347bd3c46f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrQbBDgJW7d4nwwKRgYJgQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">“不管天气如何，黑足猫都会在10到35摄氏度的温度下夜间捕猎。”~维基百科</figcaption></figure><p id="a8e5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了记录我们的NestJS应用程序所依赖的服务的每个调用，今天我们将看看如何记录Redis命令。</p><p id="c6ae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">NestJS提供了一个带有一些有用的装饰器和拦截器的<a class="ae la" href="https://docs.nestjs.com/techniques/caching" rel="noopener ugc nofollow" target="_blank"> CacheModule </a>,可以非常容易地为HTTP路由和响应提供缓存。但是，如果您想要缓存不一定或不直接是HTTP响应内容的内容，它还提供了对底层缓存管理器和Redis实例的访问。<br/>在幕后，CacheModule使用节点包<a class="ae la" href="https://www.npmjs.com/package/cache-manager" rel="noopener ugc nofollow" target="_blank"> cache-manager </a>，无论您使用哪种底层存储或客户端(内存、Redis、Redis + ioredis等),它都会提供一致的接口。).在这个例子中，我们将使用ioredis，但是它可以很容易地适用于其他redis客户机。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3edd" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">基础应用程序</h1><p id="469f" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">今天的用例是一个高性能、并发、高可伸缩、可配置的“Hello World！”app-).让我们从下面开始，接下来我们将添加Redis命令的日志记录。</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="f98a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">旁注:如果你知道一个很好的方法来防止NestJS应用程序在连接Redis失败时启动，请在评论中告诉我，我真的很感兴趣。<br/> IMHO，我觉得app连不上Redis就允许启动是个缺陷。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="f0e1" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">添加日志记录</h1><p id="8e16" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">按照我们在<a class="ae la" href="https://medium.com/@paztek/advanced-nestjs-techniques-part-2-logging-outgoing-http-requests-3c75d47c5768" rel="noopener">第2部分</a>和<a class="ae la" href="https://medium.com/@paztek/advanced-nestjs-techniques-part-3-logging-elasticsearch-queries-ae118a7a9d4c" rel="noopener">第3部分</a>中建立的模式，我们将创建一个单独的缓存模块，导入、修改和重新导出核心缓存模块:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="df24" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">仅此而已。代码是很容易解释的。它生成如下所示的日志:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/f35fd6fb14eccba46e17779cd234ab5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QCmQxY0drDS7dDDTEYi7pw.png"/></div></div></figure><p id="f1ca" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这里是Github知识库的链接:<a class="ae la" href="https://github.com/paztek/nestjs-redis-example" rel="noopener ugc nofollow" target="_blank">https://github.com/paztek/nestjs-redis-example</a>。一旦我找到一个好方法来解决这个“NestJS应用程序可以从一个错误/错误配置的Redis开始”的问题，我可能会提交更改。</p><p id="aa38" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这篇文章是“高级NestJS技术”的最后一篇。</p></div></div>    
</body>
</html>