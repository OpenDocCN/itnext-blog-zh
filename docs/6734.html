<html>
<head>
<title>How to use Netmaker v0.10, a WireGuard® Virtual Networking Platform (Deep Dive)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Netmaker v0.10，一个WireGuard虚拟网络平台(深入探讨)</h1>
<blockquote>原文：<a href="https://itnext.io/netmaker-v0-10-a-wireguard-virtual-network-management-deep-dive-b4ce93c6e715?source=collection_archive---------1-----------------------#2022-02-14">https://itnext.io/netmaker-v0-10-a-wireguard-virtual-network-management-deep-dive-b4ce93c6e715?source=collection_archive---------1-----------------------#2022-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1cd9500631b8d41af2ec58986a10a5eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RmxFao6Mqx92vZjBSu7wcQ.png"/></div></div></figure><p id="e356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本指南中，我们将逐步介绍Netmaker v0.10的安装、配置和使用。如果您不熟悉，Netmaker是建立在WireGuard之上的虚拟网络平台，wire guard是一种性能极高的VPN协议。非常非常快，效率极高。你可能会认为Netmaker是:</p><ul class=""><li id="59dd" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">电线保护控制器</li><li id="e1a4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">网络对接器</li><li id="c289" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">一个虚拟的VPC(是的，我知道，多余的)</li></ul><p id="df2e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker使网络变得一次性和即时。在您需要的地方，在您需要的时候，您都可以拥有安全、可控的网络。就像容器为计算所做的一样，Netmaker在WireGuard的帮助下为网络做了很多事情。</p><p id="625c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个演练是这个长达一小时的YouTube教程的一个更有条理的版本。如果你喜欢看视频，那就看视频吧！</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/9ab2bfda2402872d66217216155ecdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wzO5QjPekeGJ9qm2OPOMOg.gif"/></div></div></figure><h1 id="517b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">介绍</h1><p id="e803" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">Netmaker可用于创建各种网络拓扑。默认情况下，它会创建一个“全网状”网络，这意味着所有连接都是点对点的。</p><p id="d82b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Netmaker还可以创建入站(入口)和出站(出口)网关。出口网关对于您可能希望一组机器能够访问只有其中一台机器可用的资源的情况特别有用。</p><p id="966c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，假设您在以下任何环境中拥有一台机器:</p><ul class=""><li id="08f4" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">自动警报系统</li><li id="77dc" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">库伯内特星团</li><li id="a855" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">办公网络</li><li id="78a2" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">你的房子</li><li id="b84a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">数据中心</li></ul><p id="b4b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这台机器可以充当“出口网关”，允许从外部进行安全的远程访问。</p><p id="ba2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看一些您可以使用Netmaker创建的网络拓扑:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/31dd5835582e1389322c17fa75937bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lENP332Zyqbrj9r2pVvCPQ.jpeg"/></div></div></figure><h1 id="9127" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">索引</h1><ul class=""><li id="619e" class="kw kx iq ka b kb mo kf mp kj mu kn mv kr mw kv lb lc ld le bi translated">服务器安装</li><li id="8158" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">初始设置</li><li id="f19e" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">网络创建和配置</li><li id="e9cf" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">服务器节点</li><li id="a336" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">访问键和安装简介</li><li id="78cf" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">如何使用Netclient建立平面(网状)网络</li><li id="3aec" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">入口网关和外部客户端</li><li id="7fe7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">出口网关</li><li id="613d" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">中继服务器</li><li id="6ab1" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">情节</li><li id="cba3" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">结论</li></ul><h1 id="35ce" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">服务器安装</h1><p id="0961" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">你需要一台服务器。可以很小，但是要公开。为什么？Netmaker的全部目的是从分散在各处的机器中创建分布式虚拟网络。</p><p id="f194" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些机器都需要从同一个服务器(或者多个服务器，如果配置了高可用性的话)获取配置。如果Netmaker服务器运行在私有数据中心或NAT之后，那么该环境之外的机器将无法访问它。</p><p id="9913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于更高级的用户，您可以设置端口转发，将服务器放在您自己的私有环境中，但对于典型用户，我们建议购买便宜的VPS。<a class="ae lk" href="https://m.do.co/c/496ffcf1e252" rel="noopener ugc nofollow" target="_blank">你可以从DigitalOcean得到一个，每个月5美元</a>，他们有非常好的带宽定价。</p><p id="df17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Linux部署机器。我们更喜欢Ubuntu 20.04。然后，您需要确保正确的端口是打开的。</p><p id="a3ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">至少，您需要打开端口443和51821。为了快速开始，您还需要:</p><ul class=""><li id="5566" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">51821–51830(您创建的每个网络一个端口。这些是WireGuard端口)</li><li id="d016" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">22(用于SSH)</li><li id="aeb5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">80(如果使用快速安装。这只是为了让Caddy使用LetsEncrypt请求SSL证书)</li><li id="4669" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">53(针对DNS)</li></ul><p id="5fa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于本演练，我们将使用来自<a class="ae lk" href="https://github.com/gravitl/netmaker#get-started-in-5-minutes" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> GitHub自述文件</strong> </a>的简单的“5分钟安装”脚本。</p><p id="4549" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">wget -qO -https://raw.githubusercontent.com/gravitl/netmaker/master/scripts/nm-quick.sh | sudo bash</code></p><p id="a781" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果想使用自己的域(而不是自动生成的. nip.io域)，按照<a class="ae lk" href="https://docs.netmaker.org/quick-start.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">快速安装文档</strong> </a>操作。这里唯一的区别是，你需要将你的通配符域名指向你的VPS的公共IP，并告诉Caddy使用它。</p><p id="d6d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是人们在安装过程中关心的一些典型问题，以及如何解决这些问题:</p><h2 id="9874" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated"><strong class="ak">“我不想用球童！”</strong></h2><p id="6639" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">Caddy是Netmaker附带的反向代理。什么是反向代理？它将外部世界的流量带到您的实例中。在我们的例子中，它将dashboard.yourdomain.com映射到UI (127.0.0.1:8082)，将api.yourdomain.com映射到http API (127.0.0.1:8081)，将grpc.yourdomain.com映射到gRPC端点(127.0.0.1:50051)。</p><p id="a072" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以排除Netmaker的Caddy组件，代之以你自己的反向代理，不管是Traefik，Nginx，HAProxy，还是别的什么。<a class="ae lk" href="https://github.com/gravitl/netmaker/blob/master/compose/docker-compose.nocaddy.yml" rel="noopener ugc nofollow" target="_blank">此docker-compose不包括Caddy。</a></p><p id="5452" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，您需要为UI、API和gRPC创建域映射。gRPC流量也很特殊，经常需要反向代理上的额外插件(老的通常甚至不支持)。</p><p id="1fb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在已经有负载平衡器并使用端口443的地方部署Netmaker，这是非常有用的信息。这种情况下，往往需要整合。</p><p id="8d0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Nginx文档:</strong><a class="ae lk" href="https://docs.netmaker.org/server-installation.html#nginx-reverse-proxy-setup-with-https" rel="noopener ugc nofollow" target="_blank">https://Docs . net maker . org/server-installation . html # Nginx-reverse-proxy-setup-with-https</a></p><p id="2fcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> Traefik文档:</strong><a class="ae lk" href="https://github.com/bsherman/netmaker-traefik" rel="noopener ugc nofollow" target="_blank">https://github.com/bsherman/netmaker-traefik</a></p><p id="e744" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果您的环境有其他配置，请考虑为我们的文档</strong> 提供 <a class="ae lk" href="https://github.com/gravitl/netmaker/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">！</strong></a></p><h2 id="5b91" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated">"我要在主机上安装Netmaker networks！"</h2><p id="eb77" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">默认的docker-compose以“包含”模式部署Netmaker。这意味着VPN流量直接流入容器，根本不会影响主机网络。这对于保持Netmaker的包容性非常好，并且使调试更容易(您可以重启容器来重置所有接口)。然而，用户通常希望Netmaker网络位于主机上，因为他们打算将Netmaker服务器视为某种“堡垒服务器”,用于访问他们的机器。</p><p id="997c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，您可以使用这个docker-compose，它直接在主机 上运行网络<a class="ae lk" href="https://github.com/gravitl/netmaker/blob/master/compose/docker-compose.hostnetwork.yml" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">。</strong></a></p><p id="e1e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只是要小心，如果出现问题，网络可能需要一些手动清理。</p><h2 id="b549" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated"><strong class="ak">“我需要Netmaker高度可用！”</strong></h2><p id="bbd6" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">考虑使用我们的<a class="ae lk" href="https://github.com/gravitl/netmaker-helm" rel="noopener ugc nofollow" target="_blank"> HA helm模板</a>在Kubernetes上部署Netmaker。或者，使用rqlite 设置您自己的HA配置<a class="ae lk" href="https://docs.netmaker.org/server-installation.html#highly-available-installation-vms-bare-metal" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="ef83" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated">“我的组织需要OAuth！”</h2><p id="78f7" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">你很幸运，除了基本auth(默认)，Netmaker还支持带有Azure AD、GitHub或Google的OAuth。如果您需要2fa，您可以通过您的提供商启用它。</p><p id="71f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要进行设置，请遵循常规的快速安装文档，但是在运行<strong class="ka ir"> docker-compose up -d </strong>，<a class="ae lk" href="https://docs.netmaker.org/oauth.html" rel="noopener ugc nofollow" target="_blank">之前，请遵循以下步骤添加适当的环境变量以启用OAuth。</a></p></div><div class="ab cl nn no hu np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ij ik il im in"><p id="e4ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于我们安装程序，我们将回到README安装脚本。</p><p id="cfe6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们假设您已经使用Ubuntu 20.04部署了一个VPS/VM，这是一个可公开访问的IP地址，并且端口443、80、53和51821–51830是开放的和可访问的。让我们假设这台机器只用于Netmaker。我们还假设您不需要OAuth。如果是这种情况，您可以运行安装脚本:</p><p id="27aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mx my mz na b">wget -qO -https://raw.githubusercontent.com/gravitl/netmaker/master/scripts/nm-quick.sh | sudo bash</code></p><p id="84e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将…</p><ol class=""><li id="ea0e" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nu lc ld le bi translated">安装电线保护装置和对接装置</li><li id="7170" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nu lc ld le bi translated">使用<a class="ae lk" href="https://nip.io" rel="noopener ugc nofollow" target="_blank"> nip.io </a>发现公共IP并设置子域。</li><li id="b585" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nu lc ld le bi translated">下载并配置合成文件，以及Caddy和Mosquitto (MQTT)的配置文件。</li><li id="5748" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nu lc ld le bi translated">启动Netmaker</li><li id="d7ee" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv nu lc ld le bi translated">创建“默认”网络、访问密钥，并将服务器设置为“入口网关”</li></ol><p id="d0be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">输出将显示仪表板URL，或者您可以在Caddyfile中找到它。使用此链接并在浏览器中打开它。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/017734f49b56fd11021f628a5a73a3a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KWl_38zxtxFHdWKnQIykSw.gif"/></div></div></figure><h1 id="7357" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">用户管理</h1><p id="f274" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">首次登录时，您将看到“创建管理员”屏幕。这将是系统上的“超级用户”,能够运行所有命令。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/95fb41a3b83a5face329d3fe5788880c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhf8XpzEvmGBkixD583oDg.png"/></div></div></figure><p id="f030" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">选择用户名和密码，点击“创建管理员”，然后用该管理员登录。</p><p id="2e53" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您会注意到OAuth登录屏幕的一角有一个小按钮。如果您启用了OAuth，您可以使用它登录。</p><p id="d591" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">管理员可以创建其他用户。只需点击侧边栏中的<strong class="ka ir">用户</strong>标签。这些用户可以是具有完全服务器访问权限的额外“超级用户”,也可以局限于有限数量的网络。</p><p id="5889" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果用户不是管理员，他们可以编辑和控制网络，但不能编辑服务器级设置。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/c68d085a2caf79c4197e810705f7b7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GjvlItjS7bmsUJPFDTYDXA.gif"/></div></div></figure><h1 id="c27c" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">网络创建和配置</h1><p id="30e1" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">创建用户后，您可以创建网络。部署脚本中部署了一个默认的<strong class="ka ir"/>，但是您可能想要创建自己的。如果你想重新开始，你也可以删除默认值。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/24373cbec2a92c99b6bfeecf40640bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zlcMUHEH9yHN5EL8ZFh6Xg.png"/></div></div></figure><p id="6ad2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的新网络应该有一个有效、唯一的CIDR和一个简短的描述性名称。</p><p id="180f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除此之外，决定是否要打开<strong class="ka ir"> UDP打孔</strong>。</p><p id="6482" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您在云/数据中心环境中主要处理静态服务器，最好不要使用它。如果您主要处理像笔记本电脑这样的终端用户设备，或者NAT后的设备，最好保持开启。如果启用，可以在节点级别为任何不应该有UDP穿孔的节点关闭UDP穿孔。</p><p id="5a88" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通常我们建议关闭“是本地的”。这仅适用于节点不应该通过公共网络进行通信的情况(例如，它们都在数据中心网络内)。</p><p id="c008" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使您关闭此设置，如果节点在同一个本地网络上，Netmaker也会尝试检测并使用本地网络，因此最好禁用此选项。</p><p id="a324" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，如果您希望您的节点拥有ipv6地址，您可以为双堆栈添加ipv6网络。</p><p id="5e69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建网络后，您可以在“网络”列表中编辑它。这里还有一些额外的选项。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/902095bdefe3f976de4925677c8679c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkPdQbAaM3-pEFfjRyXY8Q.png"/></div></div></figure><p id="222f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">特别值得注意的是:</p><ul class=""><li id="5984" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">默认监听端口:</strong>如果UDP打洞关闭，节点将从<strong class="ka ir">默认监听端口开始，将其端口设置为本地第一个空闲的可用端口。</strong>例如，在Kubernetes中，我们将其更改为31821，以便与默认的节点端口范围保持一致。</li><li id="d384" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">默认外部客户端DNS: </strong>如果使用外部客户端(稍后讨论)，您可以使用该字段设置它们的名称服务器。如果未设置，外部客户端将不会设置名称服务器，并将依赖主机的DNS。</li><li id="09b4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">默认MTU: </strong>在某些环境中，您可能希望将默认MTU设置得更高或更低。一般来说，MTU越高，性能越好，但可能会导致连接丢失。MTU越低，连接性越好，但性能越低。值得记住的是，这将设置默认的网络MTU，但也可以在单个节点级别进行设置。<a class="ae lk" href="https://www.reddit.com/r/WireGuard/comments/mjcbcc/mtu_issuequestions/" rel="noopener ugc nofollow" target="_blank">这里是Wireguard MTU </a>的一个很好的讲解者。</li><li id="4f9a" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir"> UDP打孔:</strong>您可以通过此选项打开/关闭全网UDP打孔。如果您遇到一般的网络连接问题，并且UDP打孔已打开，请尝试将其关闭，反之亦然。</li></ul><p id="09b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于其他领域的解释者，<a class="ae lk" href="https://docs.netmaker.org/ui-reference.html#edit" rel="noopener ugc nofollow" target="_blank">查看UI参考</a>。</p><h1 id="652b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">服务器节点</h1><p id="2a4b" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">创建网络后，您可以开始添加节点。</p><p id="b10e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，每个网络中都有一个<strong class="ka ir">服务器节点</strong>。这是netmaker正在运行的机器(通常是docker化的)。此节点不能被删除，并且对于MQ通信以及专用DNS流量是必需的。它总是使用网络CIDR的最后一个IP，以便其他节点知道在哪里找到它。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/534392d8a93623826a12b9c6177715d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLlDPvsC2Dotzz_r7So_Eg.png"/></div></div></figure><p id="310b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您通常没有理由编辑该节点。但是，有一些可编辑的设置，如MTU。值得注意的是，在当前版本中，有时服务器节点会不同步。要排除故障，您可以更改节点上的设置，如MTU或Keepalive，或者重新启动主机上的netmaker容器。</p><h1 id="17f2" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">访问键和安装简介</h1><p id="2d40" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">要开始构建我们的网络，我们需要一个访问密钥。</p><p id="f92e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以单击访问密钥选项卡并创建一个密钥，赋予它多种用途。通常情况下，使用次数与您想要创建的节点数量有关。目前还没有“无限”键的概念，但是如果你打算自动化地使用它，你可以给这个键一个很高的使用次数(例如9999999)。如果您不设置名称或用途字段，它将生成一个随机名称并有一个<strong class="ka ir">使用</strong>。</p><p id="cad9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可以通过删除密钥来使其失效。当“使用”达到零时，它们将自动删除。</p><h2 id="1dde" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated">客户端安装命令</h2><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/489c251dbad124523b9b9c26df3102fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*imLyD02gpuQCYhnXJpXWRQ.png"/></div></div></figure><p id="d76b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击netclient键将显示安装说明。通常，您会忽略“访问密钥”和“访问令牌”字段，只使用正确的“客户端安装”命令。</p><p id="d7d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为Linux、FreeBSD和Mac列出了一个命令，它只是一个安装程序脚本。还有一个Windows安装程序脚本。最后，还有一个“docker run”命令，用于将netclient作为容器运行。</p><p id="d62b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在所有这些下面是“手动安装”命令，它只是:</p><pre class="lm ln lo lp gt oc na od oe aw of bi"><span id="9d8d" class="nb lr iq na b gy og oh l oi oj">“netclient join -t &lt;token&gt;”</span></pre><p id="5cee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里假设您已经从Github 上的<a class="ae lk" href="https://github.com/gravitl/netmaker/releases" rel="noopener ugc nofollow" target="_blank">发布页面下载了合适的netclient。</a></p><p id="9864" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还应该使用<strong class="ka ir">加入</strong>命令(而不是安装脚本)从同一台机器加入<strong class="ka ir">附加</strong>网络，因为安装脚本试图下载依赖关系。</p><h1 id="2bb8" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">使用网络客户端进行网络设置</h1><p id="e320" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">一旦有了访问密钥，就很容易将节点加入网络。只需对您想要加入网络的每台机器进行SSH，然后运行install命令，例如:</p><pre class="lm ln lo lp gt oc na od oe aw of bi"><span id="90b2" class="nb lr iq na b gy og oh l oi oj">curl -sfL <a class="ae lk" href="https://raw.githubusercontent.com/gravitl/netmaker/master/scripts/netclient-install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/gravitl/netmaker/master/scripts/netclient-install.sh</a> | sudo VERSION=v0.10.0 KEY=eyJjb3JlcGN3Z3B1YmtleSI6IiIsI....cGN3Z2VuZHBvaW50IjoiIn0= sh -</span></pre><p id="cbab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要记住的事情:如果运行安装程序，它会尝试安装WireGuard。如果没有运行安装程序，必须已经安装了WireGuard(内核或wireguard-go)。此外，它将尝试在Linux上为DNS安装resolvectl。</p><p id="acf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你是<strong class="ka ir">而不是</strong>使用UDP打孔，确保适当的端口是打开的(通常是51821)。</p><p id="1f06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">加入网络时，您可以设置许多选项。只需查看帮助者文本:</p><figure class="lm ln lo lp gt jr"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="0332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">需要注意的几个重要事项:</strong></p><ul class=""><li id="150a" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">端口:更改使用的端口(当udp打孔关闭时)</li><li id="bd63" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">udpholepunch:即使在网络级别设置为“是”,也可以设置为“否”</li><li id="58da" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">dnson:可以设置为“否”以防止设置dns</li><li id="1e3b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">守护程序:可以设置为“关”以避免创建系统守护程序(有利于测试/故障排除)</li></ul><p id="fbe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">加入后，您应该可以立即看到网络中的其他节点，并且很快就可以进行通信:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/33fe948d0a3e5dbf8d68921ed69d6452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3uo_mLIBEaskKmh4lJ49Yg.gif"/></div></div></figure><p id="4d5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以像在大多数系统(如Linux、Mac、Windows和FreeBSD)上检查和管理常规WireGuard接口一样检查和管理这些接口。该接口通常被命名为“nm-”+“网络名称”例如“nm-mynet”</p><p id="7af9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住，当netclient运行时，它会尝试用正确的配置同步接口。如果您手动编辑接口/ wireguard配置，它可能会恢复。但是，您可以通过运行<strong class="ka ir"> systemctl stop netclient来停止守护进程。</strong></p><p id="e74a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过运行…来监视Linux上正在运行的netclient守护进程</p><p id="8a03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">福网客户端</strong></p><p id="b9f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">系统状态网络客户端</strong></p><p id="985e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个有用的提示是，如果没有收到更新，运行<strong class="ka ir"> systemctl重新启动netclient </strong>。另一个有用的故障排除技巧是运行</p><p id="bc20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">网络客户端拉</strong>或<strong class="ka ir">网络客户端签入</strong></p><p id="125d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将同步最新设置。</p><p id="1a40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，您可以运行<strong class="ka ir">net client leave-n&lt;net name&gt;</strong>来退出网络，或者运行<strong class="ka ir"> netclient uninstall </strong>来完全卸载。</p><p id="9d2a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，您可以跳过这一切，通过用户界面进行管理。</p><h2 id="93eb" class="nb lr iq bd ls nc nd dn lw ne nf dp ma kj ng nh me kn ni nj mi kr nk nl mm nm bi translated">UI节点管理</h2><p id="27bf" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">一旦添加了一些节点，通过UI进行管理就变得非常容易。你有几个不同的选择。</p><p id="f39e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> #1:节点列表</strong></p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/f849096b75cf83c73033b99fef4f585a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ps4FaHNkPcpSzCfUf61fZg.png"/></div></div></figure><p id="348a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> #2:图形视图</strong></p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/ec169bd1417f88f5d64d58652fc527e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-V6ZSVC0FFBQ3ddrFuvuw.png"/></div></div></figure><p id="eb9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两种视图为您提供了相同的信息和管理选项，但是图形视图看起来更酷。无论哪种方式，您都可以单击任何节点并编辑其设置。</p><p id="c1e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务器将向节点发送更新，如果所有对等端也必须更新其配置(例如，如果您更改了私有IP)，则会通知所有对等端:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/ca594bf8ec67e6e2bdeb85b0fd6f2f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCz8IlWRztUxirRGFTIVXg.png"/></div></div></figure><p id="d3a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">需要记住的几个关键配置选项:</strong></p><ul class=""><li id="2257" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir"> IP地址:</strong>机器在CIDR网络中的私有IP</li><li id="8922" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir"> AllowedIPs: </strong>您想要分配给节点的任何附加私有地址</li><li id="a0a9" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">端点:</strong>可到达的公共IP:如果设置时，必须打开“是静态的”，否则它会自动复位。</li><li id="540f" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir"> UDP打孔:</strong>如果您希望它使用静态端口，请将其关闭(对于服务器来说是个好主意)。</li></ul><p id="e082" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">您可以在这里找到所有字段的详细列表:</strong></p><div class="oq or gp gr os ot"><a href="https://docs.netmaker.org/ui-reference.html#edit-node-node-details" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab fo"><div class="ov ab ow cl cj ox"><h2 class="bd ir gy z fp oy fr fs oz fu fw ip bi translated">UI参考- Netmaker 0.10.0文档</h2><div class="pa l"><h3 class="bd b gy z fp oy fr fs oz fu fw dk translated">此页面包含大多数UI组件的注释截图，详细说明了每个字段的配置选项…</h3></div><div class="pb l"><p class="bd b dl z fp oy fr fs oz fu fw dk translated">docs.netmaker.org</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph jw ot"/></div></div></a></div><h1 id="f8fc" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">入口网关和外部客户端</h1><p id="c543" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">创建网络后，您将拥有一个扁平的对等网络，其中所有节点都可以到达所有其他节点。这被称为“网状VPN”但是，您可能希望实现其他模式。</p><p id="82de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">入口网关为您的“网状网络”创建了一个单点入口这对远程访问很有用。对于不能运行netclient的设备，这也是必要的。这包括Android和iOS设备。如果您想将它们添加到网络，您必须将一台机器设置为“入口网关”，创建一个外部客户端配置，并使用官方WireGuard应用程序在您的手机上设置该配置。</p><p id="08c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通常，入口网关应该是公共场所中的可靠服务器。因为Netmaker服务器也有这个要求，所以通常可以使用Netmaker服务器作为入口网关。</p><p id="ff5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需点击按钮即可创建。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pi"><img src="../Images/7cac7ec18cf42ab250ca02fead378b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6kXWhnfWFNS0oayYdwy3lQ.gif"/></div></div></figure><p id="5d2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建之后，您可以通过网关将“外部客户端”添加到您的网络中。请转到分机。客户端页面并单击以创建:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pj"><img src="../Images/38ad8fe87a5b0f688318e64db7d6851a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HsZvhUpVbsx0C_MqVsyu7g.gif"/></div></div></figure><p id="592f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认名称是高飞，但可编辑(您可以点击并更改名称)。</p><p id="21f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从这里，你所要做的就是把配置文件下载到你的机器上，或者扫描二维码。配置文件只是一个标准的WireGuard配置文件，如下所示:</p><pre class="lm ln lo lp gt oc na od oe aw of bi"><span id="a1ad" class="nb lr iq na b gy og oh l oi oj">[Interface]<br/>Address = 10.1.1.1/32<br/>PrivateKey = yLX3ftDsnuGxNIoZujFBLi3DBDClRc2I=</span><span id="a6a0" class="nb lr iq na b gy pk oh l oi oj">[Peer]<br/>PublicKey = WFeTWh1t7QiM1+G+k7QnrZqMVAo=<br/>AllowedIPs = 10.1.1.0/24<br/>Endpoint = 52.23.167.144:51821<br/>PersistentKeepalive = 20</span></pre><p id="99a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">客户端将只有一个对等体(网关)。</p><p id="659b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">需要注意的是，外部客户端上没有运行代理(netclient ),这意味着它们不能自动更新。</strong></p><p id="a2b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果网关配置发生变化(端点、端口或公钥)，客户端将需要新的配置文件来访问网关。这就是为什么我们推荐一个稳定的公共服务器作为网关节点。</p><p id="6e6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦激活，外部客户端就可以通过入口网关服务器访问整个网络，包括出口网关范围。</p><p id="b484" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一般来说，如果你在通过网络客户端添加设备时遇到困难，我们建议你只需通过入口网关连接设备。</p><h1 id="2a5a" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">出口网关</h1><p id="7062" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">出口网关与入口网关相反。它们允许网络中的节点(包括外部客户端)到达外部地址范围。这可能是…</p><ul class=""><li id="13c3" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">家庭网络</li><li id="2b62" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">办公网络</li><li id="c5f5" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">kubernetes集群网络</li><li id="240f" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">一片云VPC</li><li id="ead9" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">数据中心</li></ul><p id="8095" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…实际上是任何子网。如果远程子网需要可访问，出口网关就可以做到。它可以处理任意数量的范围(至少几十个，可能几百个)，甚至可以处理单个地址。如果您的AWS帐户中有三个ec2实例需要远程访问，您可以访问填充子网，或者只需输入带有/32掩码的地址。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pj"><img src="../Images/31282e3ae0b69e2070e9282e087afb6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*x7YOztBNSCPDcQdvI7KI1w.gif"/></div></div></figure><p id="87b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建出口网关需要两条关键信息:范围和接口。范围是您需要访问的子网/CIDR/IP(用逗号分隔),接口是该机器上映射到这些IP地址的接口。</p><p id="b570" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过编辑节点和更改“出口范围”字段，可以在创建后添加/删除地址。</p><h1 id="1f56" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">中继服务器</h1><p id="4658" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">中继服务器使得通过直接p2p连接不可到达的机器可到达。发生这种情况的原因有很多，例如CGNAT、4g LTE路由器或双重NAT。</p><p id="c8f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在任何一种情况下，直接对等连接都是不可能的。这里，您可以简单地使用一个可靠的公共节点(比如Netmaker服务器)作为中继。</p><p id="4256" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为中继是公共的，所以对等体总是可以与中继建立连接。然后，该机器将向/从该机器和网络中的其他节点传递流量。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/391baac0d2c6f408554d9bf008df1a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hqLj73KLlAiMt8P5WDPtYA.gif"/></div></div></figure><p id="f0a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">出口网关也可以存在于中继节点之后，这有助于建立到通常无法到达的网络的深度连接。</p><h1 id="1bd3" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">模式/用例</h1><p id="9ffc" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">这些工具支持一些模式，我们不会深入探讨，但您应该知道:</p><p id="594e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> #1远程访问:</strong>使用双节点网络设置对网络的远程访问，一个作为入口，一个作为出口。然后创建ext客户端配置，添加到您的电话/笔记本电脑，使远程网络可访问(也可以只使用常规的netclient + egress网关)。</p><p id="fec1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> #2 Kubernetes: </strong>我们使用Netmaker创建分布式集群，使用mesh VPN作为“底层”子网。我们还使用Netmaker建立多集群网络(类似于submariner)，其中每个集群上的出口网关充当pod/服务网络的入口点。</p><p id="e5c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">#3 <strong class="ka ir">互联网VPN / NAT网关:</strong>您可以创建一个互联网VPN / NAT网关，作为管理来自节点的互联网流量的一种方式。在出口网关中，只需使用以下范围。用这个代替0.0.0.0/0。网络客户端将忽略0.0.0.0/0:</p><pre class="lm ln lo lp gt oc na od oe aw of bi"><span id="60e0" class="nb lr iq na b gy og oh l oi oj">0.0.0.0/5,8.0.0.0/7,11.0.0.0/8,12.0.0.0/6,16.0.0.0/4,32.0.0.0/3,64.0.0.0/2,128.0.0.0/3,160.0.0.0/5,168.0.0.0/6,172.0.0.0/12,172.32.0.0/11,172.64.0.0/10,172.128.0.0/9,173.0.0.0/8,174.0.0.0/7,176.0.0.0/4,192.0.0.0/9,192.128.0.0/11,192.160.0.0/13,192.169.0.0/16,192.170.0.0/15,192.172.0.0/14,192.176.0.0/12,192.192.0.0/10,193.0.0.0/8,194.0.0.0/7,196.0.0.0/6,200.0.0.0/5,208.0.0.0/4</span></pre><h1 id="cea7" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">结论</h1><p id="09a8" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">我们讨论了安装、初始设置、网络创建、节点创建以及通过出口、入口和中继的网络管理。</p><p id="65e9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以更深入地讨论这些话题，但是最好留给下一个教程。如果您想继续学习，请查看以下资源:</p><ul class=""><li id="d732" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><a class="ae lk" href="http://docs.netmaker.org" rel="noopener ugc nofollow" target="_blank">官方文件</a></li><li id="3a76" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><a class="ae lk" href="https://www.youtube.com/channel/UCach3lJY_xBV7rGrbUSvkZQ" rel="noopener ugc nofollow" target="_blank">Gravitl YouTube频道</a></li><li id="01f8" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">我的<a class="ae lk" href="https://afeiszli.medium.com/" rel="noopener">中型账户</a></li></ul><p id="e4c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望你喜欢！最后一点，你可以随时<a class="ae lk" href="https://discord.gg/zRb9Vfhk8A" rel="noopener ugc nofollow" target="_blank">加入我们的discord服务器</a>并在那里提问。</p><p id="b0d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">免责声明:</strong> <a class="ae lk" href="https://wireguard.com/" rel="noopener ugc nofollow" target="_blank"> <br/> WireGuard </a>是Jason A. Donenfeld的注册商标。</p></div></div>    
</body>
</html>