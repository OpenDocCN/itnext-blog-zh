<html>
<head>
<title>Node.js app continuous deployment with AWS, PM2, and Github Actions.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过AWS、PM2和Github操作持续部署Node.js应用程序。</h1>
<blockquote>原文：<a href="https://itnext.io/node-js-app-continuous-deployment-with-aws-pm2-and-github-actions-69a30ca29e9e?source=collection_archive---------1-----------------------#2021-01-15">https://itnext.io/node-js-app-continuous-deployment-with-aws-pm2-and-github-actions-69a30ca29e9e?source=collection_archive---------1-----------------------#2021-01-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以你有了这个<strong class="jp ir"> node.js </strong>应用。它不是静态的，它是在Vue中，React，Angular，无论什么…它已经准备好并稳定地发布和部署。但是在哪里，怎么做？在本文中，我将介绍如何自动部署您的应用程序并保持其持续交付的一些步骤。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/ef64ea3e314f250a0f5f064d050e6ee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7c3va-xleNv7mesmd-mog.jpeg"/></div></div></figure><p id="c04c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">下面是一个快速总结</strong>:</p><ol class=""><li id="4212" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lc ld le lf bi translated">在AWS上运行EC2实例</li><li id="e808" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">PM2设置</li><li id="c5fa" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">部署脚本</li><li id="8504" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lc ld le lf bi translated">GitHub操作</li></ol><p id="111c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">题外话:如果你的应用没有任何后端相关的功能，我几乎可以肯定它可以用静态模式构建。因此，你可以使用ie <a class="ae ll" href="https://netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>并跳过这个线程。🙃</p><p id="6583" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">静态应用产生较小的碳足迹</strong>。</p><p id="9656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，让我们回到正题。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="8638" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 1。在AWS上运行EC2实例。</strong></p><p id="13f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，我们将在AWS上使用EC2。如果您不熟悉安装过程，您需要做的就是:</p><ul class=""><li id="071b" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lt ld le lf bi translated"><a class="ae ll" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">在AWS上创建账户</a></li><li id="a623" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated"><a class="ae ll" href="https://docs.aws.amazon.com/efs/latest/ug/gs-step-one-create-ec2-resources.html" rel="noopener ugc nofollow" target="_blank">启动您的EC2实例</a></li><li id="8e02" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated"><a class="ae ll" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html" rel="noopener ugc nofollow" target="_blank">创建EC2密钥对</a></li></ul><p id="a2ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">别担心，这非常简单，我们不需要移动。只要看指导方针就没问题了。然而，也许对你来说，数字海洋水滴将是最好的解决方案；或者任何其他的。用你最喜欢的，我们只需要一个普通的Ubuntu实例。但是，请注意下面配置中的路径是特定于AWS的。</p><p id="0396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，登录到您新创建的实例。</p><pre class="km kn ko kp gt lu lv lw lx aw ly bi"><span id="5287" class="lz ma iq lv b gy mb mc l md me">ssh -i key.pem ubuntu@12.345.67.891</span></pre><p id="6b89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，对于新机器，您需要配置web服务器，很可能是Nginx。关于这个的更多信息，你可以在这里找到<a class="ae ll" href="http://nginx.org/en/docs/beginners_guide.html" rel="noopener ugc nofollow" target="_blank"/>或者直接使用这个预定义的。</p><pre class="km kn ko kp gt lu lv lw lx aw ly bi"><span id="4456" class="lz ma iq lv b gy mb mc l md me">$ sudo vim /etc/nginx/conf.d/nodejs-basic.conf</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="5850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。PM2设置。</strong></p><p id="5cde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">PM2，搞什么鬼？PM2是一个守护进程管理器，它将帮助你管理和保持你的应用程序24/7在线。因此，这将有助于我们的应用程序保持活跃和运行。让我们安装它。</p><pre class="km kn ko kp gt lu lv lw lx aw ly bi"><span id="ebf3" class="lz ma iq lv b gy mb mc l md me">npm install pm2 -g</span></pre><p id="579a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，在您的主文件夹中创建一个简单的配置文件(<code class="fe mh mi mj lv b">eccosystem.json</code>)。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="9e6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。部署脚本。</strong></p><p id="1a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们需要一些简单的bash脚本(<code class="fe mh mi mj lv b">deploy.sh</code>)来运行应用程序构建，然后调用PM2过程。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="6083" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以使用<code class="fe mh mi mj lv b">sh deploy.sh</code>命令来测试它。</p><p id="2432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，我们快到了。服务器配置相对简单，您几乎可以毫不费力地完成。如果您的日常环境是MacOS或Linux，这将非常简单。</p><p id="cea0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在——只是为了测试——我们可以手动运行整个过程。为此，请遵循以下步骤。</p><ul class=""><li id="38af" class="kx ky iq jp b jq jr ju jv jy kz kc la kg lb kk lt ld le lf bi translated">配置web服务器</li><li id="cce6" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated">在实例上克隆/获取您的应用程序</li><li id="1e51" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated">构建应用程序</li><li id="5c6f" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated">安装PM2管理器</li><li id="db53" class="kx ky iq jp b jq lg ju lh jy li kc lj kg lk kk lt ld le lf bi translated">运行<code class="fe mh mi mj lv b">sudo pm2 start npm --name "process" -- start</code></li></ul><p id="3d42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者将其设置为实例设置的简单清单。</p><p id="fadd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。GitHub行动。</strong></p><p id="7da3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们可以创建一个GitHub动作来运行我们的部署流程。对于我们的例子，我们将创建一个动作，每次合并到<code class="fe mh mi mj lv b">develop</code>分支时都会调用这个动作。</p><p id="0558" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你的主应用程序目录中创建<code class="fe mh mi mj lv b">.github</code>文件夹，里面有<code class="fe mh mi mj lv b">workflows</code>文件。然后创建一个<code class="fe mh mi mj lv b">deploy.yaml</code>文件。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="4174" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如你所见，这里有一些变量。这些是GitHub特有的秘密。您可以在您的帐户设置中定义它们。AWS相关凭证的值可以在控制台中找到。<a class="ae ll" href="https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/" rel="noopener ugc nofollow" target="_blank">这里</a>你有一些详细的说明。</p><p id="c9cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">记住！始终将敏感数据放在存储库之外。</strong></p><p id="8bbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅此而已。将工作流推进到您的repo中，并等待您的第一次自动部署。大约需要几分钟(最多)。完成了。</p><p id="7230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">干杯，卢卡斯。</p></div></div>    
</body>
</html>