<html>
<head>
<title>Quickly Building RESTful UI’s in NuxtJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在NuxtJS中快速构建RESTful UI</h1>
<blockquote>原文：<a href="https://itnext.io/quickly-building-restful-uis-in-nuxtjs-782bce539440?source=collection_archive---------0-----------------------#2018-07-19">https://itnext.io/quickly-building-restful-uis-in-nuxtjs-782bce539440?source=collection_archive---------0-----------------------#2018-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d944" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经使用NuxtJS 大约一年了，我对它赞不绝口。Vue是一个很好的框架:它足够灵活，只关心HTML，并且有能力满足财富500强公司的更大需求。</p><p id="3a14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将介绍如何快速启动一个NuxtJS应用程序，以及如何创建一个基本的RESTful风格布局。我假设你已经遵循了Nuxt的入门说明，并且正盯着起始页面。从这一点上，我们将忙于使它变得有用。我将使用<code class="fe km kn ko kp b"><a class="ae kl" href="https://yarnpkg.org" rel="noopener ugc nofollow" target="_blank">yarn</a></code>来安装依赖项，但是当然可以随意转换成任何适合您需求的包管理器。</p><h1 id="c189" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">关于应用程序</h1><p id="101c" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">我们首先需要向<code class="fe km kn ko kp b">package.json</code>添加几个关键依赖项:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="9c48" class="mb kr iq kp b gy mc md l me mf">...<br/>"dependencies": {<br/>  "@nuxtjs/auth": "^4.5.1",<br/>  "@nuxtjs/axios": "^5.3.1",<br/>  "bootstrap-vue": "^2.0.0-rc.11",<br/>  "lodash.assign": "^4.2.0",<br/>  "lodash.merge": "^4.6.1",<br/>  "nuxt": "^1.0.0",<br/>  "nuxt-i18n": "^3.3.0",<br/>  "vee-validate": "^2.1.0-beta.6",<br/>  "velocity-animate": "^1.5.1",<br/>  "vue-moment": "^4.0.0",<br/>  "vue-notification": "^1.3.10"<br/>},<br/>"devDependencies": {<br/>  "babel-eslint": "^8.2.1",<br/>  "eslint": "^4.15.0",<br/>  "eslint-friendly-formatter": "^3.0.0",<br/>  "eslint-loader": "^1.7.1",<br/>  "eslint-plugin-vue": "^4.0.0",<br/>  "node-sass": "^4.9.0",<br/>  "postcss-preset-env": "^5.1.0",<br/>  "sass-loader": "^7.0.3"<br/>}<br/>...</span></pre><ul class=""><li id="9116" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">用于用户登录的@nuxtjs/auth</li><li id="67e1" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">@nuxtjs/axios用于使用axios http客户端</li><li id="bafb" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">bootstrap-vue是我们的UI组件工具包</li><li id="612e" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">总是著名的处理对象和数组合并的lodash助手</li><li id="6cfe" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">vee-validate用于处理表单验证</li><li id="113c" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">速度-动画/vue-通知，用于出色的toast通知</li><li id="cb8b" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">vue——著名的日期时间格式库与vue集成的时刻</li></ul><p id="7890" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来我们运行<code class="fe km kn ko kp b">yarn</code>来安装所有东西。开始配置<code class="fe km kn ko kp b">nuxt.config.js:</code></p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="1cdf" class="mb kr iq kp b gy mc md l me mf"><strong class="kp ir">const </strong>i18n = require('./config/locales');<br/>module.exports = {<br/>  /*<br/>  ** Headers of the page<br/>  */<br/>  head: {<br/>    title: 'My App',<br/>    meta: [<br/>      {charset: 'utf-8'},<br/>      {name: 'viewport', content: 'width=device-width, initial-scale=1'},<br/>      {hid: 'description', name: 'description', content: 'My App'}<br/>    ],<br/>    link: [<br/>      {rel: 'icon', type: 'image/x-icon', href: '/favicon.ico'}<br/>    ]<br/>  },<br/>  css: [<br/>    '@/assets/scss/app.scss'<br/>  ],<br/>  /*<br/>  ** Customize the progress bar color<br/>  */<br/>  loading: {color: '#3B8070'},<br/>  /*<br/>  ** Build configuration<br/>  */<br/>  build: {<br/>    /*<br/>    ** Run ESLint on save<br/>    */<br/>    extend(config, {isDev, isClient}) {<br/>      <strong class="kp ir">const </strong>vueLoader = config.module.rules.find((rule) =&gt; rule.loader === 'vue-loader')<br/>      vueLoader.options.transformToRequire = {<br/>        'img': 'src',<br/>        'image': 'xlink:href',<br/>        'b-img': 'src',<br/>        'b-img-lazy': ['src', 'blank-src'],<br/>        'b-card': 'img-src',<br/>        'b-card-img': 'img-src',<br/>        'b-carousel-slide': 'img-src',<br/>        'b-embed': 'src'<br/>      };<br/>      <strong class="kp ir">if </strong>(isDev &amp;&amp; isClient) {<br/>        config.module.rules.push({<br/>          enforce: 'pre',<br/>          test: /\.(js|vue)$/,<br/>          loader: 'eslint-loader',<br/>          exclude: /(node_modules)/<br/>        })<br/>      }<br/>    }<br/>  },<br/>  modules: [<br/>    ['bootstrap-vue/nuxt', {css: <strong class="kp ir">false</strong>}],<br/>    ['nuxt-i18n', i18n],<br/>    ['@nuxtjs/axios'],<br/>    ['@nuxtjs/auth']<br/><br/>  ],<br/>  plugins: [<br/>    {src: '~/plugins/vue-notifications', ssr: <strong class="kp ir">false</strong>},<br/>    {src: '~/plugins/vee-validate'},<br/>    {src: '~/plugins/vue-moment'}<br/>  ],<br/>  router: {<br/>    middleware: ['auth']<br/>  },<br/>  auth: {<br/>    strategies: {<br/>      local: {<br/>        endpoints: {<br/>          login: {url: '/auth/login', method: 'post', propertyName: 'jwt'},<br/>          logout: {url: '/auth/logout', method: 'post'},<br/>          user: {url: '/auth/user', method: 'get', propertyName: 'user'}<br/>        }<br/>      }<br/>    }<br/>  },<br/>  axios: {<br/>    /* set API_URL environment variable to configure access to the API<br/>    */<br/>    baseURL: process.env.API_URL || 'http://localhost:3001/',<br/>    redirectError: {<br/>      401: '/login',<br/>      404: '/notfound'<br/>    }<br/>  }<br/>}</span></pre><p id="766b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上到下，主要新增内容如下:</p><ul class=""><li id="afd6" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated">在顶部导入一个<code class="fe km kn ko kp b">nuxt-i18n</code>配置脚本，然后在模块定义中使用它。</li><li id="a5aa" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe km kn ko kp b">css</code>使用SCSS以我们喜欢的方式处理配置引导的属性</li><li id="a5df" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe km kn ko kp b">build</code>部分有<code class="fe km kn ko kp b">vueLoader</code>配置，用于为相关<code class="fe km kn ko kp b">bootstrap-vue</code>组件转换nuxtjs中的图像路径</li><li id="cdb7" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe km kn ko kp b">modules</code>包括<code class="fe km kn ko kp b">bootstrap-vue</code>、<code class="fe km kn ko kp b">nuxt-i18n</code>、<code class="fe km kn ko kp b">axios</code>和<code class="fe km kn ko kp b">auth</code>模块。</li><li id="be37" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe km kn ko kp b">plugins</code>通知、验证和时刻的配置脚本</li><li id="46df" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe km kn ko kp b">router</code>增加了<code class="fe km kn ko kp b">auth</code>中间件</li><li id="416f" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated">最后是auth和axios的配置部分</li></ul><p id="22ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你给Nuxt添加插件时，它们实际上每次都是一样的。如果您遇到未定义<code class="fe km kn ko kp b">document</code>或<code class="fe km kn ko kp b">window</code>的问题，那是因为依赖项需要浏览器，但Nuxt默认情况下会进行nodejs服务器端渲染，而这两者并不存在。</p><h2 id="1a02" class="mb kr iq bd ks mu mv dn kw mw mx dp la jy my mz le kc na nb li kg nc nd lm ne bi translated">添加一些风格</h2><p id="14c4" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">创建<code class="fe km kn ko kp b">~/app/scss/app.scss</code>:</p><p id="74fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b"><a class="ae kl" href="http://twitter.com/import" rel="noopener ugc nofollow" target="_blank">@import</a> ‘~bootstrap/scss/bootstrap’;</code></p><h1 id="129f" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">制作一些插件文件</h1><p id="9110" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/plugins/vue-notifications.js</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="17ed" class="mb kr iq kp b gy mc md l me mf"><strong class="kp ir">import </strong>Vue <strong class="kp ir">from </strong>'vue';<br/><strong class="kp ir">import </strong>Notifications <strong class="kp ir">from </strong>'vue-notification'<br/><strong class="kp ir">import </strong>velocity <strong class="kp ir">from </strong>'velocity-animate'<br/><br/>Vue.use(Notifications, {velocity});</span></pre><p id="fee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/plugins/vue-moment.js</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="1128" class="mb kr iq kp b gy mc md l me mf"><strong class="kp ir">import </strong>Vue <strong class="kp ir">from </strong>'vue'<br/><strong class="kp ir">import </strong>VueMoment <strong class="kp ir">from </strong>'vue-moment'<br/><br/>Vue.use(VueMoment);</span></pre><p id="8130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/plugins/vee-validate.js</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="52af" class="mb kr iq kp b gy mc md l me mf"><strong class="kp ir">import </strong>Vue <strong class="kp ir">from </strong>'vue'<br/><strong class="kp ir">import </strong>VeeValidate <strong class="kp ir">from </strong>'vee-validate'<br/><br/>Vue.use(VeeValidate, {<br/>  inject: <strong class="kp ir">true</strong>,<br/>  fieldsBagName: 'veeFields'<br/>});</span></pre><p id="447c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有更多的工作来添加对i18n的支持。创建一个名为<code class="fe km kn ko kp b">config/locales</code>的文件夹，并在其中创建一个<code class="fe km kn ko kp b">index.js</code>文件:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="6a80" class="mb kr iq kp b gy mc md l me mf">module.exports = {<br/>  locales: [<br/>    {<br/>      code: 'en',<br/>      iso: 'en-US',<br/>      name: 'English',<br/>      file: 'en.json'<br/>    }<br/>  ],<br/>  defaultLocale: 'en',<br/>  seo: <strong class="kp ir">true</strong>,<br/>  lazy: <strong class="kp ir">true</strong>,<br/>  detectBrowserLanguage: {<br/>    cookieKey: 'redirected',<br/>    useCookie: <strong class="kp ir">true<br/>  </strong>},<br/>  langDir: 'config/locales/',<br/>  parsePages: <strong class="kp ir">false</strong>,<br/>  pages: {},<br/>  vueI18n: {<br/>    fallbackLocale: 'en'<br/>  }<br/>}</span></pre><p id="f0fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将会看到添加一个新的区域设置非常容易，只需复制<code class="fe km kn ko kp b">locales</code>数组中的对象并添加所需的值。对于<code class="fe km kn ko kp b">en.json</code>并不奇怪，因为它是一个标准的JSON格式的文件。</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="1110" class="mb kr iq kp b gy mc md l me mf">{<br/>  "actions": "Actions",<br/>  "yes": "Yes",<br/>  "no": "No",<br/>  "edit": "Edit",<br/>  "password": "Password",<br/>  "password_confirm": "Confirm Password",<br/>  "login": "Log In",<br/>  "forgot_password": "Forgot Password?",<br/>  "remove": "Remove",<br/>  "destroy_confirm_title": "Please Confirm",<br/>  "destroy_confirm": "Are you sure you want to remove this?",<br/>  "logout": "Log Out",<br/>  "back": "Back",<br/>  "save": "Save",<br/>  "update": "Update",<br/>  "forms": {<br/>    "errors": {<br/>      "required": "Please fill this out.",<br/>      "standard": "A server error occurred."<br/>    }<br/>  },<br/>  "cars": {<br/>    "singular": "car",<br/>    "plural": "cars",<br/>    "new": "New Car",<br/>    "edit": "Edit Car"<br/>  }<br/>}</span></pre><p id="0a0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有些人想让这个文件尽可能扁平，然后按字母顺序排列。我喜欢定义我的实体对象，并从那里翻译我的页面。这里真的是想用什么风格就用什么风格。保持一致就好。</p><p id="1cd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们的应用程序配置，现在让我们建立东西。</p><p id="ed7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可能首先需要一个更加自举的布局。打开<code class="fe km kn ko kp b">~/layouts/default.vue</code>并添加以下内容:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="9286" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>  &lt;main&gt;<br/>    &lt;no-ssr&gt;<br/>    &lt;notifications group="alerts"<br/>                   position="bottom right"&gt;<br/>      &lt;template slot="body" slot-scope="props"&gt;<br/>        &lt;b-alert :show="props.item.duration || 3000"<br/>                 dismissible<br/>                 :variant="props.item.type || 'info'"<br/>                 @dismissed="props.item.timer=0"&gt;<br/>          &lt;p&gt;{{props.item.text}}&lt;/p&gt;<br/>          &lt;b-progress :variant="props.item.type"<br/>                      striped<br/>                      :animated="true"<br/>                      :max="props.item.duration"<br/>                      :value="props.item.timer"<br/>                      height="4px"&gt;<br/>          &lt;/b-progress&gt;<br/>        &lt;/b-alert&gt;<br/>      &lt;/template&gt;<br/>    &lt;/notifications&gt;<br/>    &lt;/no-ssr&gt;<br/>    &lt;b-row no-gutters class="mb-3"&gt;<br/>      &lt;b-col class="bg-dark"&gt;<br/>        &lt;b-navbar toggleable="md" type="dark" variant="dark"&gt;<br/>          &lt;b-navbar-toggle target="nav_collapse"&gt;&lt;/b-navbar-toggle&gt;<br/>          &lt;b-navbar-brand href="/"&gt;My App&lt;/b-navbar-brand&gt;<br/>          &lt;b-collapse is-nav id="nav_collapse"&gt;<br/>            &lt;b-navbar-nav&gt;<br/>              &lt;b-nav-item class="text-white" :to="'/cars'"&gt;{{$t('new_car')}}&lt;/b-nav-item&gt;<br/>              &lt;b-nav-item class="text-white" :to="'/admin'" v-if="admin"&gt;{{$t('admin')}}&lt;/b-nav-item&gt;<br/>            &lt;/b-navbar-nav&gt;<br/>            &lt;b-navbar-nav class="ml-auto"&gt;<br/>              &lt;b-nav-item class="text-white" :to="'login'" v-if="!$auth.loggedIn"&gt;{{$t('login')}}&lt;/b-nav-item&gt;<br/>              &lt;b-nav-item class="text-white" @click="logout" v-if="$auth.loggedIn"&gt;{{$t('logout')}}&lt;/b-nav-item&gt;<br/>            &lt;/b-navbar-nav&gt;<br/>          &lt;/b-collapse&gt;<br/>        &lt;/b-navbar&gt;<br/>      &lt;/b-col&gt;<br/>    &lt;/b-row&gt;<br/>    &lt;b-container fluid&gt;<br/>      &lt;nuxt/&gt;<br/>    &lt;/b-container&gt;<br/>  &lt;/main&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>  <strong class="kp ir">export default </strong>{<br/>    methods: {<br/>      logout() {<br/>        <strong class="kp ir">this</strong>.$auth.logout()<br/>      },<br/>      admin() {<br/>        <strong class="kp ir">return this</strong>.$auth.loggedIn &amp;&amp; <strong class="kp ir">this</strong>.$auth.user.admin<br/>      }<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="9408" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们已经将通知与引导程序集成在一起，显示了一个倒计时定时器。很酷吧？旁边是一个非常平淡无奇的基本引导导航条。我展示了一个用户在登录时有一个“admin”布尔设置，它可以打开或关闭元素。<code class="fe km kn ko kp b">nuxt-auth</code>为我们登录时提供用户对象。在底部，你可以看到一个<code class="fe km kn ko kp b">b-container </code>组件，它保存了我们特殊的<code class="fe km kn ko kp b">nuxt</code>组件渲染标签，我们的页面将在这里结束。</p><p id="63d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑:注意，如果你用<code class="fe km kn ko kp b">ssr: false</code>配置一个插件，那么你也可以在模板中使用<code class="fe km kn ko kp b">no-ssr</code>组件。否则，您会从HMR那里得到一个错误，抱怨服务器内容与呈现的内容不匹配。</p><h1 id="0b98" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">使用Vuex获取、存储和改变数据</h1><p id="3d97" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">Nuxt使得为vuex配置模块变得非常简单。您只需将其命名为您想要管理的实体。在这种情况下，我们使用<em class="nf">汽车，</em>所以让我们制作<code class="fe km kn ko kp b">~/store/cars.js</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="8882" class="mb kr iq kp b gy mc md l me mf"><strong class="kp ir">import </strong><em class="nf">merge </em><strong class="kp ir">from </strong>"lodash.merge";<br/><strong class="kp ir">import </strong><em class="nf">assign </em><strong class="kp ir">from </strong>'lodash.assign';<br/><br/><strong class="kp ir">export const </strong>state = () =&gt; ({<br/>  list: [],<br/>  car: {},<br/>});<br/><br/><strong class="kp ir">export const </strong>mutations = {<br/>  set(state, car) {<br/>    state.list = car<br/>  },<br/>  add(state, value) {<br/>    merge(state.list, value)<br/>  },<br/>  remove(state, {car}) {<br/>    state.list.filter(c =&gt; car.id !== c.id)<br/>  },<br/>  mergeCars(state, form) {<br/>    assign(state.car, form)<br/>  },<br/>  setCars(state, form) {<br/>    state.car = form<br/>  }<br/>};<br/><br/><strong class="kp ir">export const </strong>actions = {<br/>  <strong class="kp ir">async </strong>get({commit}) {<br/>    <strong class="kp ir">await this</strong>.$axios.get(`/cars`)<br/>      .then((res) =&gt; {<br/>        <strong class="kp ir">if </strong>(res.status === 200) {<br/>          commit('set', res.data)<br/>        }<br/>      })<br/>  },<br/>  <strong class="kp ir">async </strong>show({commit}, params) {<br/>    <strong class="kp ir">await this</strong>.$axios.get(`/cars/${params.car_id}`)<br/>      .then((res) =&gt; {<br/>        <strong class="kp ir">if </strong>(res.status === 200) {<br/>          commit('mergeCars', res.data)<br/>        }<br/>      })<br/>  },<br/>  <strong class="kp ir">async </strong>set({commit}, cars) {<br/>    <strong class="kp ir">await </strong>commit('set', cars)<br/>  },<br/>  <strong class="kp ir">async </strong>form({commit}, form) {<br/>    <strong class="kp ir">await </strong>commit('mergeCars', form)<br/>  },<br/>  <strong class="kp ir">async </strong>add({commit}, car) {<br/>    <strong class="kp ir">await </strong>commit('add', car)<br/>  },<br/>  create({commit}, params) {<br/>    <strong class="kp ir">return this</strong>.$axios.post(`/cars`, {car: params})<br/>  },<br/>  update({commit}, params) {<br/>    <strong class="kp ir">return this</strong>.$axios.put(`/cars/${params.id}`, {car: params})<br/>  },<br/>  <strong class="kp ir">delete</strong>({commit}, params) {<br/>    <strong class="kp ir">return this</strong>.$axios.delete(`/cars/${params.id}`)<br/>  }<br/>};</span></pre><p id="6073" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的<code class="fe km kn ko kp b">state</code>中，我们有两个键，一个用于保存汽车列表，一个用于我们正在查看的当前汽车。</p><p id="e151" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在vuex中突变是同步的，这一点值得注意。这被组织成使得<code class="fe km kn ko kp b">set, add, remove</code>都处理<code class="fe km kn ko kp b">list</code>状态的突变，而<code class="fe km kn ko kp b">mergeCars, setCars</code>处理<code class="fe km kn ko kp b">car</code>状态。</p><p id="ef6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，动作不必是同步的。这使得它们成为Ajax调用的好地方。我们可以在这里返回承诺，处理突变，等等。轻而易举。</p><h1 id="331a" class="kq kr iq bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">关于Nuxt路由</h1><p id="b260" class="pw-post-body-paragraph jn jo iq jp b jq lo js jt ju lp jw jx jy lq ka kb kc lr ke kf kg ls ki kj kk ij bi translated">我花了一点时间来理解自动路由器是如何工作的，所以我希望这也能让你明白。</p><figure class="lt lu lv lw gt nh gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/577486fffba5780a7b61f609d4a77431.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*6jXrn5wMESvEroBKvdOBHA.png"/></div></figure><p id="d5ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此文件夹结构导致生成以下URL:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="6a55" class="mb kr iq kp b gy mc md l me mf">/cars -&gt; cars/index.vue (view all)<br/>/cars/:id -&gt; cars/_car_id/index.vue (view one)<br/>/cars/:id/edit -&gt; cars/_car_id/edit.vue (edit view)<br/>/cars/new -&gt; cars/new.vue (new view)</span></pre><p id="5117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当nuxt看到一个以下划线开头的文件夹时，它假定文件夹名是组件需要接收的URL参数。您也可以将其与新文件夹(cars/_car_id/pickups/_id等)嵌套。</p><p id="95b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/cars/index.vue</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="f1f7" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>  &lt;b-row&gt;<br/>    &lt;b-col&gt;<br/>      &lt;b-btn variant="outline-success" class="mb-3" :to="'/cars/new'"&gt;<br/>        {{$t('cars.new')}}<br/>      &lt;/b-btn&gt;<br/>      &lt;b-table striped hover :items="list" :fields="fields"&gt;<br/>        &lt;template slot="name" slot-scope="data"&gt;<br/>          &lt;b-link :to="`/cars/${data.item.id}/edit`"&gt;{{data.item.name}}&lt;/b-link&gt;<br/>        &lt;/template&gt;<br/>        &lt;template slot="members" slot-scope="data"&gt;<br/>          {{data.item.users.length}}<br/>        &lt;/template&gt;<br/>        &lt;template slot="updated_at" slot-scope="data"&gt;<br/>          {{data.item.updated_at | moment("from", "now")}}<br/>        &lt;/template&gt;<br/>        &lt;template slot="actions" slot-scope="data"&gt;<br/>          &lt;b-btn variant="primary" :to="'cars/'+data.item.id+'/edit'"&gt;<br/>            {{$t('edit')}}<br/>          &lt;/b-btn&gt;<br/>          &amp;nbsp;<br/>          &lt;b-btn variant="outline-secondary" @click="id = data.item.id" v-b-modal.confirmDestroy&gt;<br/>            {{$t('remove')}}<br/>          &lt;/b-btn&gt;<br/>        &lt;/template&gt;<br/>      &lt;/b-table&gt;<br/>      &lt;b-modal id="confirmDestroy" :title="$t('destroy_confirm_title')" @ok="destroy"&gt;<br/>        {{$t('destroy_confirm')}}<br/>      &lt;/b-modal&gt;<br/>    &lt;/b-col&gt;<br/>  &lt;/b-row&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>  <strong class="kp ir">import </strong>{mapState} <strong class="kp ir">from </strong>'vuex';<br/><br/>  <strong class="kp ir">export default </strong>{<br/>    <strong class="kp ir">async </strong>fetch({store}) {<br/>      <strong class="kp ir">await </strong>store.dispatch('cars/get')<br/>    },<br/>    computed: {<br/>      ...mapState({<br/>        list: state =&gt; {<br/>          <strong class="kp ir">return </strong>state.cars.list<br/>        }<br/>      })<br/>    },<br/>    data() {<br/>      <strong class="kp ir">return </strong>{<br/>        id: 0,<br/>        fields: [<br/>          {<br/>            key: 'name',<br/>            label: <strong class="kp ir">this</strong>.$t('name'),<br/>            sortable: <strong class="kp ir">true</strong>,<br/>          },<br/>          {<br/>            key: 'updated_at',<br/>            sortable: <strong class="kp ir">true</strong>,<br/>            label: <strong class="kp ir">this</strong>.$t('updated_at')<br/>          },<br/>          {<br/>            key: 'actions',<br/>            label: <strong class="kp ir">this</strong>.$t('actions')<br/>          }<br/>        ]<br/>      }<br/>    },<br/>    methods: {<br/>      destroy() {<br/>        <strong class="kp ir">this</strong>.$store.dispatch('cars/delete', {id: <strong class="kp ir">this</strong>.id}).then(() =&gt; <strong class="kp ir">this</strong>.$store.dispatch('cars/get'))<br/>      }<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="9189" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在这里对他们的<code class="fe km kn ko kp b">mapState</code>助手使用了一点vuex魔法。这是字面上的意思。它获取汽车列表的状态，并将其映射到一个名为list的局部变量。bootstrap-vue中的表格组件真的很牛逼。无需任何配置，您就可以呈现所有的字段，但它仍然暴露了自己，足以使用动态模板标签进行超级定制。您会注意到我添加了一个带有编辑和删除按钮的“操作”列。删除按钮触发一个确认模式。该模态正在监听<code class="fe km kn ko kp b">@ok</code>事件，然后在单击ok按钮时调用<code class="fe km kn ko kp b">destroy</code>方法。</p><p id="b274" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">新视图和编辑视图实际上是相同的，只有一个小的变化。看看你是否能发现它:</p><p id="08d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/cars/new.vue</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="6747" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>    &lt;car-form&gt;&lt;/car-form&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>  <strong class="kp ir">import </strong>CarForm <strong class="kp ir">from </strong>'~/components/CarForm';<br/>  <strong class="kp ir">export default </strong>{<br/>    components: {CarForm},<br/>    fetch({store}) {<br/>      store.commit('car/setCar', {})<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="2c0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">~/cars/_car_id/edit.vue</code>:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="39f7" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>  &lt;car-form&gt;&lt;/car-form&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>  <strong class="kp ir">import </strong>CarForm <strong class="kp ir">from </strong>"~/components/CarForm";<br/>  <strong class="kp ir">export default </strong>{<br/>    name: "editCar",<br/>    components: {CarForm},<br/>    <strong class="kp ir">async </strong>fetch({store, params}) {<br/>      <strong class="kp ir">await </strong>store.dispatch('car/show', {car_id: params.car_id});<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="c2a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在两种情况下都使用了<code class="fe km kn ko kp b">fetch</code>，但是我在新方法中告诉vuex从一个新的<code class="fe km kn ko kp b">state.cars.car</code>对象开始。在编辑模式下，我需要获取当前值，所以我使用params从后端获取。</p><p id="de58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我只有一个用于新建和编辑的表单:</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="fa45" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>    &lt;b-form <a class="ae kl" href="http://twitter.com/submit" rel="noopener ugc nofollow" target="_blank">@submit</a>.prevent="submit"&gt;<br/>      &lt;b-row align-h="end"&gt;<br/>        &lt;b-col class="text-right"&gt;<br/>          &lt;b-link :to="'/cars'"&gt;<br/>            {{$t('back')}}<br/>          &lt;/b-link&gt;<br/>        &lt;/b-col&gt;<br/>      &lt;/b-row&gt;<br/>      &lt;b-form-group :label="$t('name')"&gt;<br/>        &lt;b-form-input id="carNameInput"<br/>                      name="car[name]"<br/>                      ref="name"<br/>                      :state="validateState('name')"<br/>                      type="text"<br/>                      v-validate="{required: true}"<br/>                      data-vv-delay="500"<br/>                      :placeholder="$t('cars.name_placeholder')"<br/>                      <a class="ae kl" href="http://twitter.com/input" rel="noopener ugc nofollow" target="_blank">@input</a>="mergeCar({'name': $event})"<br/>                      :value="car.name"&gt;&lt;/b-form-input&gt;<br/>        &lt;b-form-invalid-feedback&gt;{{$t('forms.errors.required')}}&lt;/b-form-invalid-feedback&gt;<br/>      &lt;/b-form-group&gt;<br/>      &lt;b-btn class="my-3" type="submit"&gt;{{isUpdate() ? $t('update') : $t('save')}}&lt;/b-btn&gt;<br/>    &lt;/b-form&gt;<br/>&lt;/template&gt;</span><span id="bd06" class="mb kr iq kp b gy nk md l me mf">&lt;script&gt;<br/>  import {mapMutations, mapState} from 'vuex';</span><span id="46b0" class="mb kr iq kp b gy nk md l me mf">export default {<br/>    name: "CarForm",<br/>    computed: {<br/>      ...mapState('cars', [<br/>        'car'<br/>      ])<br/>    },<br/>    methods: {<br/>      ...mapMutations('cars', ['mergeCar']),<br/>      isUpdate() { return this.car.hasOwnProperty('id') },<br/>      submit() {<br/>        let vm = this;<br/>        let action = 'cars/' + (this.isUpdate() ? 'update' : 'create');<br/>        this.$validator.validateAll().then((result) =&gt; {<br/>          if(result) {<br/>            this.$store.dispatch(action, this.car)<br/>              .then((resp) =&gt; {<br/>                let msg = resp.data.name + " " + (vm.$t('car.' + this.isUpdate() ? 'updated' : 'created'));<br/>                vm.$notify({text: msg, type: 'success', group: 'alerts'});<br/>                vm.$router.push('/cars')<br/>              })<br/>              .catch((resp) =&gt; {<br/>                vm.$notify({text: vm.$t('forms.errors.standard'), type: 'warning', group: 'alerts'})<br/>              })<br/>          } else {<br/>            vm.$notify({text: vm.$t('forms.errors.invalid'), type: 'warning', group: 'alerts'})<br/>          }<br/>        })<br/>      },<br/>      validateState(ref) {<br/>        if (this.veeFields[ref] &amp;&amp; this.veeFields[ref].dirty) {<br/>          return !this.errors.has(ref)<br/>        } else {<br/>          return null<br/>        }<br/>      }<br/>    }<br/>  }<br/>&lt;/script&gt;</span></pre><p id="8cb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会注意到我没有使用v-model。虽然我很想这样做，但vuex并不支持这一点。你不能在严格模式下直接改变状态，撤销严格模式是个坏主意。</p><p id="90f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后一个视图是<code class="fe km kn ko kp b">show</code>视图。这基本上是edit的“只读”版本。这是本教程中的一块空白画布。</p><pre class="lt lu lv lw gt lx kp ly lz aw ma bi"><span id="25b4" class="mb kr iq kp b gy mc md l me mf">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;h3&gt;{{$store.state.cars.car.title}}&lt;/h3&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>  <strong class="kp ir">export default </strong>{<br/>    name: "showCar",<br/>    <strong class="kp ir">async </strong>fetch({store, params}) {<br/>      <strong class="kp ir">await </strong>store.dispatch('car/show', {car_id: params.car_id});<br/>    }<br/>  }<br/>&lt;/script&gt;<br/><br/>&lt;style scoped&gt;<br/><br/>&lt;/style&gt;</span></pre><p id="ee0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经采取了相同的方法来使用<code class="fe km kn ko kp b">fetch</code>填充商店，然后我们将状态中的内容显示给视图。</p><p id="645c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你，你已经为只有一个属性的汽车建立了一个完整的CRUD MVC设计模式！我希望您发现这很有用，并且您的想象力可以从这里尽情发挥。如果你需要帮助，欢迎在下面评论。如果你需要帮助，你也可以在Nuxt gitter或bootstrap-vue slack room找到我。</p><p id="6a36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑:很多很棒的反馈，最大的请求是<em class="nf">“代码在哪里？”</em></p><p id="e3b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是:<a class="ae kl" href="https://github.com/toadkicker/nuxt-crud-example" rel="noopener ugc nofollow" target="_blank">https://github.com/toadkicker/nuxt-crud-example</a></p></div></div>    
</body>
</html>