<html>
<head>
<title>How you can Control your Android Device with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Python控制你的Android设备</h1>
<blockquote>原文：<a href="https://itnext.io/how-you-can-control-your-android-device-with-python-45c3ab15e260?source=collection_archive---------0-----------------------#2021-04-15">https://itnext.io/how-you-can-control-your-android-device-with-python-45c3ab15e260?source=collection_archive---------0-----------------------#2021-04-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b47c0600c0b0c62e1af475eec0e2fe6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VStEGWJRRFZXIBXpe8ZmwQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">卡斯帕·卡米尔·鲁宾在<a class="ae kf" href="https://unsplash.com/s/photos/phone-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="1398" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="f4f1" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">不久前，我在想办法给我的朋友发几分钟的垃圾信息，以此来激怒他们，在做一些研究时，我发现了Android调试桥。在这篇快速指南中，我将向你展示如何使用Python与它交互，以及如何创建2个快速脚本。</p><p id="bd7a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">ADB (Android Debug Bridge)是一个命令行工具(CLI ),可用于控制Android设备并与之通信。你可以做许多事情，如安装应用程序，调试应用程序，找到隐藏的功能，并使用外壳直接与设备接口。要启用ADB，您的设备必须首先解锁开发者选项并启用USB调试。要解锁开发者选项，您可以转到设备设置，向下滚动到“关于”部分，找到设备上当前软件的内部版本号。点击<em class="mh">构建号</em> 7次，开发者选项将被启用。然后，您可以进入设置中的开发者选项面板，并从那里启用USB调试。现在你唯一需要的是一根USB线来连接你的设备和电脑。</p><p id="702d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">以下是今天的旅程:</p><ol class=""><li id="b52e" class="mi mj it lg b lh mc ll md lp mk lt ml lx mm mb mn mo mp mq bi translated">安装需求</li><li id="1dc5" class="mi mj it lg b lh mr ll ms lp mt lt mu lx mv mb mn mo mp mq bi translated">入门指南</li><li id="1ec3" class="mi mj it lg b lh mr ll ms lp mt lt mu lx mv mb mn mo mp mq bi translated">编写脚本的基础</li><li id="40d7" class="mi mj it lg b lh mr ll ms lp mt lt mu lx mv mb mn mo mp mq bi translated">创建自拍定时器</li><li id="1ad6" class="mi mj it lg b lh mr ll ms lp mt lt mu lx mv mb mn mo mp mq bi translated">创建定义搜索器</li></ol></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="a1f6" class="kg kh it bd ki kj nd kl km kn ne kp kq kr nf kt ku kv ng kx ky kz nh lb lc ld bi translated">安装需求</h1><p id="ccad" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们需要安装的两件东西中的第一件是我们电脑上的ADB工具。这是自动与Android Studio捆绑在一起的，所以如果你已经有了，也不用担心。否则，你可以前往<a class="ae kf" href="https://developer.android.com/studio/command-line/adb" rel="noopener ugc nofollow" target="_blank">官方文档</a>，在页面顶部应该有如何安装的说明。</p><p id="caa0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">安装ADB工具后，您需要获得python库，我们将使用该库与ADB和我们的设备进行交互。您可以使用<code class="fe ni nj nk nl b">pip install pure-python-adb</code>安装pure-python-adb库。</p><p id="5115" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu">可选</strong>:为了让我们在开发脚本时更容易，我们可以安装一个名为scrcpy的开源程序，它允许我们使用鼠标和键盘在电脑上显示和控制我们的android设备。要安装它，你可以去<a class="ae kf" href="https://github.com/Genymobile/scrcpy" rel="noopener ugc nofollow" target="_blank"> Github repo </a>下载适合你的操作系统(Windows、macOS或Linux)的正确版本。如果您在Windows上，那么将zip文件解压缩到一个目录中，并将该目录添加到您的路径中。这样我们就可以从系统的任何地方访问该程序，只需在终端窗口中键入scrcpy。</p><h1 id="5605" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">入门指南</h1><p id="d6d1" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">既然所有的依赖项都已安装，我们就可以启动ADB并连接我们的设备了。首先，用USB线把你的设备连接到你的电脑，如果USB调试被激活，那么会弹出一条信息，询问你的电脑是否可以控制设备，简单的回答是。然后在你的电脑上，打开一个终端窗口，输入adb start-server启动ADB服务器。这将打印出以下消息:</p><pre class="nm nn no np gt nq nl nr ns aw nt bi"><span id="e741" class="nu kh it nl b gy nv nw l nx ny">* daemon not running; starting now at tcp:5037<br/>* daemon started successfully</span></pre><p id="f127" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果您也安装了scrcpy，那么您只需在终端中键入<code class="fe ni nj nk nl b">scrcpy</code>就可以启动它。然而，这只有在您将它添加到您的路径中时才有效，否则您可以通过将您的终端目录更改为您安装scrcpy的目录并键入<code class="fe ni nj nk nl b">scrcpy.exe</code>来打开可执行文件。如果一切顺利的话，你应该可以在你的电脑上看到你的设备，并且可以用你的鼠标和键盘控制它。</p><p id="1fe5" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，我们可以创建一个新的python文件，并检查是否可以使用该库找到我们连接的设备:</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="e171" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里我们导入AdbClient类并使用它创建一个客户机对象。然后我们可以得到连接的设备列表。最后，我们从列表中取出第一个设备(如果只连接了一个设备，它通常是唯一的一个)。</p><h1 id="3ddc" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">编写脚本的基础</h1><p id="58fe" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们与设备交互的主要方式是使用外壳，通过它我们可以发送命令来模拟特定位置的触摸或从A到b的滑动。要模拟屏幕触摸(点击),我们首先需要了解屏幕坐标是如何工作的。为了帮助解决这些问题，我们可以在开发者选项中激活指针位置设置。一旦激活，无论你触摸屏幕上的什么地方，你都可以看到该点的坐标出现在顶部。坐标系是这样工作的:</p><figure class="nm nn no np gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/77f0cd0d86b309c4f831661049c2e277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*VCKZWOpxz_dgLtYXbxgFPA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">显示坐标系如何工作的图表</figcaption></figure><p id="0b86" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">显示屏的左上角分别有<em class="mh"> x </em>和<em class="mh"> y </em>坐标(0，0)，右下角的坐标是<em class="mh"> x </em>和<em class="mh"> y </em>的最大可能值。</p><p id="216d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们知道了坐标系是如何工作的，我们需要检查我们可以运行的不同命令。我在下面列出了一些命令以及如何使用它们，以供快速参考:</p><pre class="nm nn no np gt nq nl nr ns aw nt bi"><span id="a8a0" class="nu kh it nl b gy nv nw l nx ny">Input tap x y</span><span id="c834" class="nu kh it nl b gy oc nw l nx ny">Input text “hello world!”</span><span id="4da9" class="nu kh it nl b gy oc nw l nx ny">Input keyevent eventID</span><span id="17b1" class="nu kh it nl b gy oc nw l nx ny">Here is a list of some common eventID’s:</span><span id="8d94" class="nu kh it nl b gy oc nw l nx ny">3: home button</span><span id="a61e" class="nu kh it nl b gy oc nw l nx ny">4: back button</span><span id="0e7b" class="nu kh it nl b gy oc nw l nx ny">5: call</span><span id="c87e" class="nu kh it nl b gy oc nw l nx ny">6: end call</span><span id="0a63" class="nu kh it nl b gy oc nw l nx ny">24: volume up</span><span id="cbd7" class="nu kh it nl b gy oc nw l nx ny">25: volume down</span><span id="89f7" class="nu kh it nl b gy oc nw l nx ny">26: turn device on or off</span><span id="039a" class="nu kh it nl b gy oc nw l nx ny">27: open camera</span><span id="c6ba" class="nu kh it nl b gy oc nw l nx ny">64: open browser</span><span id="8898" class="nu kh it nl b gy oc nw l nx ny">66: enter</span><span id="9189" class="nu kh it nl b gy oc nw l nx ny">67: backspace</span><span id="2380" class="nu kh it nl b gy oc nw l nx ny">207: contacts</span><span id="c82d" class="nu kh it nl b gy oc nw l nx ny">220: brightness down</span><span id="fa1c" class="nu kh it nl b gy oc nw l nx ny">221: brightness up</span><span id="4c23" class="nu kh it nl b gy oc nw l nx ny">277: cut</span><span id="dd40" class="nu kh it nl b gy oc nw l nx ny">278: copy</span><span id="91ce" class="nu kh it nl b gy oc nw l nx ny">279: paste</span></pre><p id="af6e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果你想找到更多，这里有一个长长的列表<a class="ae kf" href="https://forum.xda-developers.com/t/q-adb-input-keyevent-for-long-press-on-power-button.2063741/post-64890206" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="0a4c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">创建自拍定时器</h1><p id="889b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">现在我们知道我们能做什么，让我们开始做吧。在第一个例子中，我将向你展示如何创建一个快速自拍定时器。首先，我们需要导入我们的库并创建一个连接函数来连接到我们的设备:</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="42e8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">您可以看到，connect函数与前一个如何连接到您的设备的示例是相同的，只是这里我们返回了设备和客户端对象供以后使用。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="fd29" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在我们的主代码中，我们可以调用connect函数来检索设备和客户端对象。在那里，我们可以打开相机应用程序，等待5秒钟，然后拍照。真的就这么简单！正如我之前所说的，这只是简单地复制你通常会做的事情，所以思考如何做事情是最好的，如果你先自己手动做，并写下步骤。</p><h1 id="a2d4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">创建定义搜索器</h1><p id="adb7" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们现在可以做一些更复杂的事情，那就是让浏览器找到一个特定单词的定义，并截图保存在我们的电脑上。</p><p id="c586" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">该计划的基本流程如下:</p><pre class="nm nn no np gt nq nl nr ns aw nt bi"><span id="963d" class="nu kh it nl b gy nv nw l nx ny">1. Open the browser</span><span id="19db" class="nu kh it nl b gy oc nw l nx ny">2. Click the search bar</span><span id="a41c" class="nu kh it nl b gy oc nw l nx ny">3. Enter the search query</span><span id="91c5" class="nu kh it nl b gy oc nw l nx ny">4. Wait a few seconds</span><span id="cf3f" class="nu kh it nl b gy oc nw l nx ny">5. Take a screenshot and save it</span></pre><p id="1428" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">但是，在我们开始之前，您需要在默认浏览器中找到您的搜索栏的坐标，您可以使用我之前建议的方法轻松找到它们。对我来说他们是(440，200)。</p><p id="bcbc" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">首先，我们必须像以前一样导入相同的库，并且我们还将拥有相同的连接方法。</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="91e2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在我们的主函数中，我们可以调用connect函数，并为搜索栏的<em class="mh"> x </em>和<em class="mh"> y </em>坐标分配一个变量。注意这是一个字符串，而不是一个列表或元组，这样我们可以很容易地将坐标合并到shell命令中。我们还可以接受用户的输入，看看他们想得到什么词的定义:</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="31da" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们会将该查询添加到一个完整的句子中，然后进行搜索，这样我们就可以随时获得定义。之后，我们可以打开浏览器，在搜索栏中输入我们的搜索查询，如下所示:</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="b6bf" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里我们使用eventID 66来模拟按下enter键来执行我们的搜索。如果你愿意，你可以根据需要改变等待时间。</p><p id="a0a3" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">最后，我们将使用screencap方法对我们的设备对象进行截图，并将其保存为<em class="mh">。png </em>文件:</p><figure class="nm nn no np gt ju"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="5a8d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">这里我们必须以写字节模式打开文件，因为screencap方法返回代表图像的字节。</p><p id="2546" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果一切按计划进行，您应该有一个搜索特定单词的快速脚本。这是我的手机:</p><figure class="nm nn no np gt ju gh gi paragraph-image"><div class="gh gi od"><img src="../Images/51eb98fc4e94756c87d514f3c38ae08c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/1*RTrZSDwHxdHDloqP2z3jYg.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">一个GIF展示了如何在我的手机上使用定义搜索器的例子</figcaption></figure><h1 id="9892" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">最后的想法</h1><p id="d069" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">希望你今天学到了一些新的东西，就我个人而言，在我做一些研究之前，我甚至不知道这是一件事。酷的是，你可以做任何你平常能做的事情，甚至更多，因为它只是模拟你自己的触摸和动作！</p><p id="74d0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我希望你喜欢这篇文章，并感谢您的阅读！💖</p></div></div>    
</body>
</html>