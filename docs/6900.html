<html>
<head>
<title>Setting up Scalr with Azure DevOps — Picking a workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure DevOps设置Scalr选择工作流</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-scalr-with-azure-devops-picking-a-workflow-d91124a4748c?source=collection_archive---------3-----------------------#2022-04-07">https://itnext.io/setting-up-scalr-with-azure-devops-picking-a-workflow-d91124a4748c?source=collection_archive---------3-----------------------#2022-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="fdf4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要开始在Azure DevOps中使用Scalr，需要经历3个初始阶段。在这一系列3篇关于使用Scalr和Azure DevOps的文章中，我将一步一步地介绍每个阶段。</p><p id="a9a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本系列的第一篇文章将关注第一阶段— <strong class="js iu">选择工作流。</strong></p><p id="0032" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/setting-up-scalr-with-azure-devops-add-azure-credentials-979ddc17d90d">系列文章第二篇</a>将描述<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/setting-up-scalr-with-azure-devops-add-azure-credentials-979ddc17d90d"> <strong class="js iu">如何添加Azure凭证</strong> </a>并将它们链接到一个环境。</p><p id="0c2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/setting-up-scalr-with-azure-devops-how-to-execute-your-terraform-code-and-create-a-workspace-6b54fa686fd3">系列文章3 </a>将重点关注<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/setting-up-scalr-with-azure-devops-how-to-execute-your-terraform-code-and-create-a-workspace-6b54fa686fd3"> <strong class="js iu">如何执行您的Terraform代码并创建一个工作区</strong> </a> <strong class="js iu">，</strong>两者都使用PR自动化，并通过将CLI插入Azure DevOps。还有第三种方法可以使用模块注册表来创建工作区，但是这仍然使用VCS连接。</p><p id="6826" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们走吧！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/098468f3dede67997b31f0e3d47b3d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3wzkUvvtbqEKQtDi.png"/></div></div></figure><h2 id="ea71" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">Scalr是什么？</h2><p id="8904" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">Scalr是Terraform Automation and Collaboration(TACO)软件，支持拉请求自动化、原生Terraform CLI或模块驱动的工作流。Scalr通过其分层模型帮助各种规模的组织进行扩展，该模型通过OPA、操作视图和私有模块注册表集中管理操作(如RBAC)、策略控制，从而实现Terraform操作的受控分散化，允许开发人员在环境中独立执行Terraform工作流。</p><p id="58a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样来自<a class="ae ko" href="https://docs.scalr.com/en/latest/introduction.html" rel="noopener ugc nofollow" target="_blank">https://docs.scalr.com/en/latest/introduction.html</a>:</p><blockquote class="lz ma mb"><p id="ce57" class="jq jr mc js b jt ju jv jw jx jy jz ka md kc kd ke me kg kh ki mf kk kl km kn im bi translated">Scalr是Terraform的远程操作后端。用基本术语来说，这意味着什么？它执行Terraform操作，并在Scalr中存储状态，而不管工作流是什么，这使得跨组织的协作变得容易。这意味着您可以轻松地将现有的GitOps或原生的基于Terraform CLI的工作流加载到Scalr中，只需对您的实际代码进行很少甚至没有修改。</p></blockquote><h2 id="9d72" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">入门指南</h2><p id="e229" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">根据您的工作流程，有两种方法可以开始使用Scalr:</p><ol class=""><li id="f5f5" class="mg mh it js b jt ju jx jy kb mi kf mj kj mk kn ml mm mn mo bi translated">添加版本控制系统(VCS)提供者，在本例中是Azure DevOps。</li><li id="26cd" class="mg mh it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated">在Azure DevOps管道中使用Terraform CLI。</li></ol><h2 id="ce49" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">使用Azure DevOps向Scalr认证</h2><p id="98d7" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">首先，我们需要在Azure DevOps中选择您想要与Scalr链接的项目。我做了一个测试:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/729c36331f36c14c476afc254f07b737.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*FXcI6uRZEX31I9dM14UeWA.png"/></div></figure><p id="d707" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的项目中，我有一个名为Scalr的repo，其中包含一些基本的terraform文件。应用时，该配置将创建给定数量的Azure AD组。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/23788b1af9851651d75336fc3eb76016.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*lTULwJfc8xyA3chkBdq-eQ.png"/></div></figure><h2 id="7e08" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">main.tf</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="ba03" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">变量. tf</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="8778" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">terraform.tfvars</h2><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="819f" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">使用web界面设置Azure DevOps集成</h2><p id="be0a" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">Scalr可以与几个<strong class="js iu"> VCS提供商</strong>集成，以自动化您的GitOps工作流。让我们一步一步地通过我们的Azure DevOps repo设置它！</p><p id="3e6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您第一次登录您的Scalr帐户时，您会看到以下信息:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi my"><img src="../Images/3c7b335b8600b428a28ff869da490169.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*XTpDh3RTRtrbBY8eBQW0XQ.png"/></div></figure><p id="8d86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">点击“创建VCS提供商”,然后点击“Azure ”,会出现以下选项:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mz"><img src="../Images/48888606f17281838c02ae40cd2c5670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNS4VDM0BTwqucNHrndA_A.png"/></div></div></figure><ol class=""><li id="c678" class="mg mh it js b jt ju jx jy kb mi kf mj kj mk kn ml mm mn mo bi translated">输入您的提供商名称(例如AzureDevOpsProject)</li><li id="d697" class="mg mh it js b jt mp jx mq kb mr kf ms kj mt kn ml mm mn mo bi translated">点击“在Azure中注册一个新的OAuth应用程序”按钮，这将带你在Azure DevOps中注册一个应用程序—<a class="ae ko" href="https://aex.dev.azure.com/app/register" rel="noopener ugc nofollow" target="_blank">https://aex.dev.azure.com/app/register</a></li></ol><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi na"><img src="../Images/478c5cfa1472cecc1993d58496ddc179.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*7qtCCODvaTiv6hTxwnqPPA.png"/></div></figure><p id="ea9e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.复制回调URL并将其粘贴到Azure DevOps页面中的授权回调URL中</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4d7604d207667c0e63e0b11e1a03800e.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*2A79AzAdX1BQNpVYpEeD1A.png"/></div></figure><p id="c2e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.在授权范围下，勾选代码(已读)和代码(状态)。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nc"><img src="../Images/1bd9eac351e33ad59cbc189b7bc0e72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMvOrKzPMMnFBp3BsFhkcQ.png"/></div></div></figure><p id="854c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">5.填写公司名称、应用程序名称和应用程序网站字段，然后点击“创建应用程序”。将显示您的应用程序设置:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7bb4056ae4d3466a9a437ac0265092a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*WJ4BHwYn8HbOuVaelRZ1VQ.png"/></div></figure><p id="f9f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">6.回到Scalr，粘贴你的应用ID和客户端密码，然后按“创建”:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/9054e46cf4bef482a5cac4dd1456201c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0LZTgKYpn3m7mSdPiFlSQ.png"/></div></div></figure><p id="43b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">7.点击接受:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nf"><img src="../Images/fc54b0254db8e1d8edb4f9fa792ad9eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gQ-NwBzWIw24Fvg8GqvxZg.png"/></div></div></figure><p id="1ef3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">8.Scalr现在将显示Azure DevOps已连接。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ng"><img src="../Images/85de58189098afda2c1ab3bd851038cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d9WdaC3dvGVzsOidiJ6qVQ.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nh"><img src="../Images/d0c3c6360fcbc571aeb3f74b5f0fcf86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lg6VTSKEl1aS2y59QH6Y-g.png"/></div></div></figure><h2 id="4e56" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">使用Terraform CLI向Scalr认证</h2><blockquote class="lz ma mb"><p id="7914" class="jq jr mc js b jt ju jv jw jx jy jz ka md kc kd ke me kg kh ki mf kk kl km kn im bi translated">如果已经存在使用原生Terraform CLI的工作流，或者您只是想灵活地使用它，您可以继续使用Terraform CLI，因为它在Scalr中完全受支持。Scalr将在Scalr后端的容器中执行运行，但是日志和输出仍然会发送回您的控制台。要将Scalr用作远程支持，有几个简单的步骤:</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b7fac4361752638c0f43a60126e0005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*P77B5TnBmkPKr13cj1Erag.png"/></div></figure><blockquote class="lz ma mb"><p id="1491" class="jq jr mc js b jt ju jv jw jx jy jz ka md kc kd ke me kg kh ki mf kk kl km kn im bi translated">1.通过运行<code class="fe nj nk nl nm b">terraform login &lt;account-name&gt;.scalr.io</code>获得API令牌</p><p id="c1bb" class="jq jr mc js b jt ju jv jw jx jy jz ka md kc kd ke me kg kh ki mf kk kl km kn im bi translated">2.创建工作区</p><p id="ae6a" class="jq jr mc js b jt ju jv jw jx jy jz ka md kc kd ke me kg kh ki mf kk kl km kn im bi translated">3.执行<code class="fe nj nk nl nm b">terraform init</code></p></blockquote><ol class=""><li id="4c56" class="mg mh it js b jt ju jx jy kb mi kf mj kj mk kn ml mm mn mo bi translated"><code class="fe nj nk nl nm b">terraform login jackwesleyroper.scalr.io</code></li></ol><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nn"><img src="../Images/7832d0258ff2d9b496c036e2cd0d9201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ymy4C0p07sBBvwtSr_Grww.png"/></div></div></figure><p id="b8c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.按“创建API令牌”，然后复制生成的ID和令牌。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fc4f4c6b40fb0b1d1ea7368ac2ef1297.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*70SdiiEY83pUKAOOKwZMOw.png"/></div></figure><p id="efa3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">令牌应该显示在Scalr中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/b7fac4361752638c0f43a60126e0005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*P77B5TnBmkPKr13cj1Erag.png"/></div></figure><p id="6a92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.将令牌粘贴回命令窗口:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi np"><img src="../Images/85105063dabf57f83e478298277a8a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDJsphcd3jZ2v-A79PDIWw.png"/></div></div></figure><h2 id="f522" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">Scalr Terraform提供程序</h2><p id="6a2e" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">注意，Scalr Terraform提供程序可用于管理Scalr中的组件。这将允许您自动创建工作区、变量、VCS提供者等等。</p><h2 id="c270" class="lb lc it bd ld le lf dn lg lh li dp lj kb lk ll lm kf ln lo lp kj lq lr ls lt bi translated">摘要</h2><p id="c6b7" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">我们已经将我们的VCS提供商(Azure DevOps)连接到Scalr，并展示了如何使用Terraform CLI向Scalr进行身份验证。</p><p id="4291" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来,<a class="ae ko" rel="noopener ugc nofollow" target="_blank" href="/setting-up-scalr-with-azure-devops-add-azure-credentials-979ddc17d90d">Scalr系列的第2部分</a>将关注<strong class="js iu">如何添加Azure凭证</strong>并将它们链接到一个环境。</p><p id="3b4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">干杯！🍻</p><div class="nq nr gp gr ns nt"><a href="https://www.buymeacoffee.com/jackwesleyroper" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">Jack Roper正在Azure、Azure DevOps、Terraform、Kubernetes和Cloud tech上写博客！</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">希望我的博客能帮到你，你会喜欢它的内容！我真的很喜欢写技术内容和分享…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kz nt"/></div></div></a></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/7719a662c95d837aa94b3f1836514491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*5oqdPMWKmEFsEDQxV68oSA.png"/></div></figure><div class="nq nr gp gr ns nt"><a href="https://docs.scalr.com/en/latest/scalr-terraform-provider/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">Scalr Terraform Provider - TACO 8.0文档</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">Terraform自动化和协作软件</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">docs.scalr.com</p></div></div><div class="oc l"><div class="oj l oe of og oc oh kz nt"/></div></div></a></div></div></div>    
</body>
</html>