<html>
<head>
<title>Go continuous integration with Travis CI and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">继续与Travis CI和Docker集成</h1>
<blockquote>原文：<a href="https://itnext.io/go-continuous-integration-with-travis-ci-and-docker-4b26379e54b7?source=collection_archive---------3-----------------------#2019-05-01">https://itnext.io/go-continuous-integration-with-travis-ci-and-docker-4b26379e54b7?source=collection_archive---------3-----------------------#2019-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d6d28c94542cf9a33747c7b8d9043651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERV04zdYEz2XSyRToiPHJw.png"/></div></div></figure><p id="2c11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">简介</strong></p><p id="0aee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将了解如何使用<a class="ae kw" href="https://github.com" rel="noopener ugc nofollow" target="_blank"> Github </a>、<a class="ae kw" href="https://travis-ci.org" rel="noopener ugc nofollow" target="_blank"> Travis-CI </a>和<a class="ae kw" href="https://cloud.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker HUB </a>创建一个简单的持续集成流程，这里使用的文件可以在<a class="ae kw" href="https://github.com/kainlite/whatismyip-go" rel="noopener ugc nofollow" target="_blank">这里找到</a>，在下一篇文章中，我们将继续使用这里的内容来提供持续部署，可能使用Jenkins，也可能使用Travis，请告诉我您更喜欢哪一个。</p><p id="8975" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看第2部分<a class="ae kw" href="https://medium.com/@kainlite_32799/go-continuous-delivery-with-terraform-and-kubernetes-c088a65534f1" rel="noopener">请点击此处</a></p><p id="0175" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">首先要做的事情</strong></p><p id="2127" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用</p><p id="e5d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将回顾docker文件、应用程序代码和travis-ci文件，所以让我们从应用程序<code class="fe kx ky kz la b">main.go</code>开始:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="725b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们快速检查一下这段代码做了什么，首先我们检查要使用的端口，然后将它转换成一个数字，为我们的HTTP函数注册处理程序并监听请求，这段代码应该打印出我们的ip地址，正如您所期望的那样。</p><p id="154e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后是<code class="fe kx ky kz la b">main_test.go</code>代码:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="e692" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">测试相当简单，它只是通过尝试获取<code class="fe kx ky kz la b">/</code>并检查空主体和<code class="fe kx ky kz la b">200</code>状态代码来检查web服务器是否工作。</p><p id="390c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">码头工人</p><p id="8865" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个<code class="fe kx ky kz la b">Dockerfile</code>:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="49a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将工作目录设置为please go，然后获取依赖项并安装我们的二进制文件，我们还生成一个测试二进制文件，暴露我们想要使用的端口，并将用户设置为nobody，以防有人可以利用我们的应用程序并跳入我们的容器，然后只需设置命令在<code class="fe kx ky kz la b">docker run</code>执行。</p><p id="2eaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">特拉维斯</p><p id="b526" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后但同样重要的是<code class="fe kx ky kz la b">.travis.yml</code>文件:</p><figure class="lb lc ld le gt jr"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="d8b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们让travis知道，我们将运行一些go代码和docker，然后构建映像，运行测试，然后初始化应用程序，之后我们验证应用程序是否工作，最后登录dockerhub并推送映像，这里需要记住的重要事情是，我们以安全的方式使用变量，例如回购名称、提交SHA以及docker用户名和密码，因为travis-ci隐藏了我们告诉它们的值。</p><p id="0d94" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">把所有东西放在一起</strong></p><p id="1747" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们已经完成了<a class="ae kw" href="https://github.com/kainlite/whatismyip-go" rel="noopener ugc nofollow" target="_blank"> repo </a>的运行、travis的配置、dockerfile、app，但是现在我们需要使用它，因此您需要创建一个travis帐户来运行它，然后将您的github帐户链接到它，然后您将能够同步您的存储库，您应该会看到类似这样的内容:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lh"><img src="../Images/fa3d0ed8cd6f4b9d69169c69a6ba00ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*d29IE5Ot3P9zJK-v.png"/></div></div></figure><p id="c565" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦你有你的帐户链接，你将能够同步和启用仓库建立。</p><p id="0ca6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启用存储库后，您可以配置一些细节，如环境变量，这里我们将为dockerhub设置凭证。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/c45ad4d839cbfda660a25bb50bbb0a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Qneql3m2L0YM4DIt.png"/></div></div></figure><p id="5c35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们将在dockerhub中创建存储库:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lj"><img src="../Images/4fa656ee03d6a3d461cc85990cd97f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UAGyrOTEySBqdp0e.png"/></div></div></figure><p id="7602" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建存储库后，我们可以从travis触发构建，或者将提交推送到repo，以便触发构建并验证一切正常。</p><p id="cc19" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果一切顺利，你应该在特拉维斯身上看到这样的东西:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/90367918ad1eb261c723d34880045e10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aPnF4Ke2BAqkLVVK.png"/></div></div></figure><p id="4536" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过检查触发构建的提交SHA来验证一切顺利。</p><p id="ce9b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和dockerhub:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lk"><img src="../Images/7196258cd2b22125474ba7011c4ebbde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ugfK82Tay2dENFRS.png"/></div></div></figure><p id="a5c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相同的SHA将用于标记图像。</p><p id="964a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">闭幕词</strong></p><p id="1bf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将发布一些关于CI和CD的文章，以及DevOps/SREs应该记住的良好实践、提示、技巧和完整的部署示例，这是可能的两到三篇文章系列的第一部分，首先是CI的完整但基本的示例，然后是CD。这当然可以改变，任何反馈都将不胜感激:)。</p><p id="c49f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一些对特拉维斯和<a class="ae kw" href="https://docs.travis-ci.com/user/docker/" rel="noopener ugc nofollow" target="_blank"> docker </a>有用的链接和<a class="ae kw" href="https://docs.travis-ci.com/user/environment-variables/" rel="noopener ugc nofollow" target="_blank">环境变量列表</a>可以使用。</p><h1 id="c1da" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">正误表</h1><p id="c727" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">如果您发现任何错误或有任何建议，请给我发消息，以便解决问题。</p><p id="f82b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，您可以在这里查看源代码和<a class="ae kw" href="https://github.com/kainlite/kainlite.github.io" rel="noopener ugc nofollow" target="_blank">生成代码</a>和<a class="ae kw" href="https://github.com/kainlite/blog" rel="noopener ugc nofollow" target="_blank">源代码</a>的变化</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="8f79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mv">最初发布于</em><a class="ae kw" href="https://techsquad.rocks/blog/go_continuous_integration_with_travis_ci_and_docker/" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://tech squad . rocks</em></a><em class="mv">。</em></p></div></div>    
</body>
</html>