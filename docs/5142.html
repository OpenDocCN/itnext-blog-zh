<html>
<head>
<title>Reviewing The Worst Piece of Code Ever</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回顾有史以来最糟糕的代码</h1>
<blockquote>原文：<a href="https://itnext.io/reviewing-the-worst-piece-of-code-ever-db2df8730c76?source=collection_archive---------1-----------------------#2020-12-21">https://itnext.io/reviewing-the-worst-piece-of-code-ever-db2df8730c76?source=collection_archive---------1-----------------------#2020-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/df4511b07ca7a5ff3af51ff41b40d59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Xb4jRXKU1zA5zAnzQ-qWA.jpeg"/></div></div></figure><p id="e61a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有一个意大利脸书页面叫做“<strong class="kd iu"> Il Programmatore di梅尔达</strong>”(可以翻译成“<strong class="kd iu">傻逼程序员</strong>”)。我喜欢那一页。</p><p id="6941" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">他们经常分享关于编程的糟糕代码和迷因，但今天我看到了一些非常不可思议的事情:</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi kz"><img src="../Images/3053307bffbf1c750bbd4572c535ea9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iZwosftym5YTacTWQmIb3A.png"/></div></div></figure><p id="b164" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里有太多错误的东西，我不知道从哪里开始。如果你是初级开发人员，这篇文章将帮助你理解上面代码中的一些可怕错误。</p><h1 id="a9a9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">28行错误</h1><p id="7d89" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">我们把上面的代码写下来，以便讨论:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="5aef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好吧，我真的不知道从何说起。<br/>让我们将上述错误分为3类:</p><ol class=""><li id="faca" class="mj mk it kd b ke kf ki kj km ml kq mm ku mn ky mo mp mq mr bi translated"><a class="ae ms" href="https://www.hackdoor.io/articles/reviewing-the-worst-piece-of-code-ever-2dd33ae21850#security-issues" rel="noopener ugc nofollow" target="_blank">安全问题</a></li><li id="5a04" class="mj mk it kd b ke mt ki mu km mv kq mw ku mx ky mo mp mq mr bi translated"><a class="ae ms" href="https://www.hackdoor.io/articles/reviewing-the-worst-piece-of-code-ever-2dd33ae21850#basic-programming-knowledge" rel="noopener ugc nofollow" target="_blank">基础编程知识</a></li><li id="a8e2" class="mj mk it kd b ke mt ki mu km mv kq mw ku mx ky mo mp mq mr bi translated"><a class="ae ms" href="https://www.hackdoor.io/articles/reviewing-the-worst-piece-of-code-ever-2dd33ae21850#code-formatting" rel="noopener ugc nofollow" target="_blank">代码格式化</a></li></ol><h1 id="727f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">安全问题</h1><p id="8af0" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">我们非常确定下面的代码运行在客户端，因为它被包装在两个<code class="fe my mz na nb b">&lt;script&gt;</code>标签之间(也使用jQuery)。不要误解我的意思，即使在服务器端也很糟糕，但是在客户端运行这段代码会将你的数据库暴露给…所有人。</p><p id="7a90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们来看看<code class="fe my mz na nb b">authenticateUser</code>函数:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="9b31" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们在某个地方有一个名为<code class="fe my mz na nb b">apiServices</code>的函数，它公开了一个<code class="fe my mz na nb b">.sql</code>方法，在这里你可以对数据库运行SQL查询。<br/>这意味着，如果您在托管上述代码的网页上打开控制台，您将能够生成各种查询。</p><p id="8298" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以这样做:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="496f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它将使用自己的API返回数据库表的完整列表。<br/>不过嘿，好吧，我们就当这不是个现实问题吧。但是看看这个:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="acfd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以你告诉我你没有散列就保存了所有的密码？<br/>大招！现在，我可以在Chrome控制台上安装一个调试器，查看每个用户的密码。<br/>我也很确定很高比例的用户在社交网络、电子邮件服务、银行账户等方面使用相同的用户名/密码元组。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="nc mi l"/></div></figure><p id="f523" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">他们试图设置<code class="fe my mz na nb b">loggedin</code> cookie的方式也有问题:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="2a1b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以他们基本上是使用jQuery来设置一个cookie，告诉web应用程序用户是否经过身份验证。</p><p id="af12" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">嗯，<strong class="kd iu">千万不要用JAVASCRIPT </strong>设置这种COOKIES。</p><p id="9e7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你需要存储那种信息，cookies是最常见的选择，也没关系！但是使用JavaScript设置它们意味着您不能设置<code class="fe my mz na nb b">httpOnly</code>属性，这样每个恶意脚本都可以访问您的cookies。</p><p id="641f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是的，我知道，他们只是存储一个键值，所以事实并非如此，但这是一种邪恶的做法。</p><p id="f251" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，打开我的Chrome控制台，我可以随时输入<code class="fe my mz na nb b">$.cookie('loggedin', 'yes', { expires: 1000000000000 });</code>，我将永远保持登录状态，甚至没有帐户。</p><h1 id="68c1" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">基本编程知识</h1><p id="d81e" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">有这么多事情要说，时间却这么少。<br/>显然<code class="fe my mz na nb b">authenticateUser</code>函数是纯粹的垃圾，表现出一些基本编程知识的欠缺。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="18e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">与其选择数据库中的每个用户，为什么他/她不选择具有给定用户名和密码的用户呢？<br/>如果他/她在那个数据库中有数百万用户会怎样？</p><p id="8607" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我以前说过，现在再重复一遍，<strong class="kd iu">他们为什么不在数据库中散列密码</strong>？</p><p id="a4d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们继续讨论<code class="fe my mz na nb b">authenticateUser</code>的返回值。<br/>据我所知，它接受两个类型为<code class="fe my mz na nb b">string</code>的参数，并返回一个值<code class="fe my mz na nb b">boolean</code>。</p><p id="bef4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以，下面这段代码，即使很糟糕，也有点道理:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="40e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“是否存在拥有X用户名和Y密码的用户？是的，所以我会返回<code class="fe my mz na nb b">true</code>”。<br/>但是这个:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="68f8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这根本说不通。<br/>如果没有这个永远为真的条件，这个函数为什么不返回<code class="fe my mz na nb b">false</code>？</p><p id="9ab5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们分析下面的代码:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a6a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用jQuery获取值的部分是可以的。<br/>问题在于它如何处理<code class="fe my mz na nb b">loggedin</code> cookie。</p><p id="b402" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们之前讨论过这样一个事实，我可以打开我的Chrome控制台并输入<code class="fe my mz na nb b">$.cookie('loggedin', 'yes', { expires: 1 });</code>来保持一天的认证，甚至不需要一个帐户。</p><p id="288a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么，这个网页到底是怎么知道我是谁的？<br/>可能只是在用户名/密码认证下显示一些私人内容，所以并没有显示任何个人数据。没人会知道。</p><h1 id="e433" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">代码格式</h1><p id="34f5" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">整个代码中不太关键的部分很可能就是不太关键的部分，但是我们可以很清楚的看到这个开发者复制/粘贴了一些取自某些网站的代码。</p><p id="8f0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我们可以看到双引号用于编写字符串:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="b3bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里我们可以看到单引号:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="b654" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这可能看起来不重要，但它实际上告诉我们，开发人员可能已经从StackOverflow复制了一些代码，甚至没有按照整个代码库的通用样式指南重写它。<br/>当然，这是一个小问题，但它表明开发人员并不真正关心理解代码是如何工作的；它只是想让它以某种方式工作。</p><p id="c760" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不要误会我的意思，我确实每天在谷歌上搜索一些东西，但是理解(例如)如何设置一个cookie比复制粘贴一些东西使其工作更重要。<br/>如果由于某种原因，整个过程中断了怎么办？您如何知道您的脚本的哪一部分不起作用？</p><h1 id="5aea" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="b264" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">我确定上面的代码是假的。<br/>这是我第一次看到同步SQL查询:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="1c0f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">通常，我会这样想:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="bc49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">或者像这样:</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="69c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">即使<code class="fe my mz na nb b">apiService.sql</code>同步返回一个值(我对此表示怀疑)，它也必须在内部打开一个到数据库的连接，进行查询并发回响应，这(您可能已经猜到了)不可能是同步的。</p><p id="f59d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但即使上面的代码不是假的，我肯定是一个初级开发人员写的。<br/>在我作为开发人员的第一周，我非常确定我为我的旧公司写了这么糟糕的代码(抱歉😄).</p><p id="bad7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不是初级开发者的错。<br/>我们假设上面的代码是真实的。这里的初级开发人员正在尽力使它工作。他/她还没有学会如何正确处理SQL查询、cookies和其他东西，这完全没问题！</p><p id="9763" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">高级开发人员应该提供某种形式的指导，以确保初级开发人员能够理解他们的错误，这样的糟糕代码不会投入生产。</p><p id="f465" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我确信某些公司并不真正关心他们发布的代码。<br/>解决问题了吗？部署它。<br/>是不是学弟学妹写的，连资深dev都没批？部署它。</p><p id="445e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">倒霉事时有发生。</p><h1 id="651b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2020年8月3日更新</h1><p id="f7f4" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">在<a class="ae ms" href="https://www.reddit.com/r/programming/comments/i1ph52/reviewing_the_worst_piece_of_code_ever" rel="noopener ugc nofollow" target="_blank"> Reddit </a>上讨论完这篇文章后，一个很不错的家伙伸手分享了下面的Reddit线程:<a class="ae ms" href="https://www.reddit.com/r/programminghorror/comments/66klvc/this_javascript_code_powers_a_1500_user_intranet" rel="noopener ugc nofollow" target="_blank">https://www . Reddit . com/r/programming horror/comments/66 klvc/this _ JavaScript _ code _ powers _ a _ 1500 _ user _ intranet</a>。</p><p id="1693" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“这段JavaScript代码支持1500个用户的内部网应用程序”，所以很明显，我错了。这段代码不是假的！</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><a href="https://github.com/sponsors/micheleriva"><div class="gh gi nd"><img src="../Images/e05f00ed2cddfd2907284cb397168c3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAIiY1uBKSNdw12oq2BbjA.png"/></div></a></figure></div></div>    
</body>
</html>