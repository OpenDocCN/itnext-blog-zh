<html>
<head>
<title>Render Multiple Colored Lines on a React Map with Polylines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用折线在React贴图上渲染多条彩色线</h1>
<blockquote>原文：<a href="https://itnext.io/render-multiple-colored-lines-on-a-react-map-with-polylines-2bedd8ae5af?source=collection_archive---------3-----------------------#2022-08-10">https://itnext.io/render-multiple-colored-lines-on-a-react-map-with-polylines-2bedd8ae5af?source=collection_archive---------3-----------------------#2022-08-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="586d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">React传单地图中需要多种颜色的线条？折线是解决方案。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2347ca74535f958bfea95f31e652daff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*d0NzTZmFqWKc5GAm.png"/></div></div></figure><h1 id="6d5b" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="5757" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">去年夏天，我开始为一家物联网初创公司<a class="ae mf" href="https://blues.io/?&amp;utm_source=medium&amp;utm_medium=web&amp;utm_campaign=niedringhaus-effect&amp;utm_content=ep-2" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Blues Wireless </strong> </a>工作，该公司的目标是通过使用一种<a class="ae mf" href="https://blues.io/products/notecard/?&amp;utm_source=medium&amp;utm_medium=web&amp;utm_campaign=niedringhaus-effect&amp;utm_content=ep-2" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Notecard </strong> </a>将传感器数据作为JSON传输到安全云<a class="ae mf" href="https://notehub.io/?&amp;utm_source=medium&amp;utm_medium=web&amp;utm_campaign=niedringhaus-effect&amp;utm_content=ep-2" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Notehub </strong> </a>来为任何物联网设备提供预付费蜂窝互联网连接，从而使物联网开发变得更加容易。</p><p id="5563" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在之前的一篇<a class="ae mf" href="https://www.paigeniedringhaus.com/blog/create-an-asset-tracker-with-next-js-and-react-leaflet" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir"/></a>文章中，我展示了我如何使用Next.js和React传单来构建一个资产追踪器地图，以近乎实时的方式显示移动的便笺在哪里(在我的车内)。当感恩节假期我父母的车在车道上被偷的时候，这个练习变得比我想象的更加方便，我在拜访的时候在后座上放了一张卡片。</p><p id="dd3d" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">尽管便签卡是在汽车被偷并被扔出窗外后不久被发现的，但在很短的时间内，我们(和警察)能够凭借我的仪表盘地图在镇上跟随汽车，这一经历在几个月后的一次全公司黑客马拉松中启发了我。</p><p id="2d18" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在汽车被盗期间，如果地图上的点与点之间的线除了标准的蓝色之外，还可以是其他颜色，以便更容易识别汽车被盗后的位置，这将非常有帮助。因此，对于黑客马拉松，我创建了一个具有“SOS模式”的新仪表板，不仅在启用SOS模式后在地图上用红色绘制线条，还增加了笔记卡获取位置读数的频率，以获得更好的准确性。</p><p id="ff27" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">今天，我将向您展示如何使用Next.js中的React传单创建地图，能够在正常或紧急情况下通过触摸按钮渲染不同颜色的线条来进行资产跟踪。</strong></p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="0063" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">在Next.js应用程序中设置地图组件</h1><p id="414e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><strong class="ll ir">请注意:</strong>这篇文章不会介绍如何建立一个全新的Next项目，也不会深入解释如何从Blues Wireless Notecard获取资产跟踪数据，因为我已经在<a class="ae mf" href="https://www.paigeniedringhaus.com/blog/create-an-asset-tracker-with-next-js-and-react-leaflet" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中介绍过了。</p><blockquote class="mx my mz"><p id="3c25" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><em class="iq">要看完代码，可以在这里</em>   <strong class="ll ir"> <em class="iq">查看我的GitHub repo </em> <a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> <em class="iq">。</em> </strong></a></strong></p></blockquote><h2 id="44c6" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">安装地图项目依赖项</h2><p id="3242" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在本教程中，我们要做的第一件事是将地图添加到下一个项目中。这将需要一些新的npm包添加到我们的项目中:<a class="ae mf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">传单</strong> </a>，<a class="ae mf" href="https://react-leaflet.js.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">react-传单</strong> </a>和<a class="ae mf" href="https://github.com/ghybs/leaflet-defaulticon-compatibility" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">传单-默认-兼容性</strong> </a>。</p><p id="2ac1" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在终端中运行以下代码行。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="9853" class="ne ks iq nr b gy nv nw l nx ny">$ npm install leaflet react-leaflet leaflet-defaulticon-compatibility</span></pre><blockquote class="mx my mz"><p id="c44d" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><strong class="ll ir"> <em class="iq">注意:</em> </strong> <em class="iq">如果</em> <code class="fe nz oa ob nr b"><em class="iq">react</em></code> <em class="iq">和</em> <code class="fe nz oa ob nr b"><em class="iq">react-dom</em></code> <em class="iq">还没有出现在您的项目中，您还需要它们作为对等依赖项。</em></p></blockquote><p id="da0a" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><strong class="ll ir">打字稿备注:</strong></p><p id="d68c" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果您在项目中使用TypeScript，您还会希望安装以下dev依赖项以避免TypeScript错误:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="a387" class="ne ks iq nr b gy nv nw l nx ny">$ npm install @types/leaflet --save-dev</span></pre><p id="a5aa" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">安装新的项目依赖项后，我们将设置组件来使用它们。</p><h2 id="6dff" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">为地图的显示样式生成地图框标记，并将其添加到工程中</h2><p id="48d9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">对于资产跟踪器将要显示的地图，我选择使用样式。它有多种可供选择，开发者可以创建自己的<a class="ae mf" href="https://docs.mapbox.com/help/getting-started/access-tokens/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Mapbox API令牌</strong> </a>通过注册一个免费的<a class="ae mf" href="https://account.mapbox.com/auth/signup/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir"> Mapbox帐户</strong> </a>来访问这些样式。</p><p id="0278" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">注册并创建新的API令牌后，复制令牌值。在项目根目录下的Next.js应用程序的<code class="fe nz oa ob nr b">next.config.js</code>文件中，添加API令牌，如下所示:</p><p id="035e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard/blob/main/next.config.js" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">next.config.js</strong></a></code></p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="4987" class="ne ks iq nr b gy nv nw l nx ny">/** @type {import('next').NextConfig} */<br/>module.exports = {<br/>  reactStrictMode: true,<br/>  env: {<br/>    MAPBOX_ACCESS_TOKEN:<br/>      "[MAPBOX_TOKEN]",<br/>  },<br/>};</span></pre><p id="7666" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">从这个文件中，Next可以在需要调用Mapbox API端点时访问令牌。现在我们可以继续在我们的项目中创建<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件。</p><h2 id="a524" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">创建<map>组件</map></h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/68fdbef141839c18283dfd18fae10d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*KfB_NgdKCBIl5wZ4.png"/></div></figure><p id="2b33" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">这是正常情况下显示资产位置的地图外观。</p><p id="d9b3" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">因为这是一个React项目，单独的、可重用的组件是游戏的名字，所以创建一个名为<code class="fe nz oa ob nr b">Map.tsx</code>的新文件并粘贴以下代码。</p><blockquote class="mx my mz"><p id="2f5c" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><em class="iq">点击下面的文件标题可获得实际代码。</em></p></blockquote><p id="055e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard/blob/main/src/components/Map.tsx" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">Map.tsx</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oc"><img src="../Images/d27154ca8926c6e630d4cd00ab7749f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9vZ4OZb3UhodxNhC-KCSA.png"/></div></div></figure><p id="1d25" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">让我们简单讨论一下这里发生了什么。</p><p id="4400" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在文件的开头，我们导入所有必要的React传单组件、传单CSS和传单默认图标兼容性CSS和JS(这是<a class="ae mf" href="https://www.npmjs.com/package/leaflet-defaulticon-compatibility#usage" rel="noopener ugc nofollow" target="_blank">推荐的</a>以使传单的图标按预期工作)。</p><p id="bfd4" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">然后我们看到了<code class="fe nz oa ob nr b">Map</code>组件期望的道具:</p><ul class=""><li id="f3eb" class="od oe iq ll b lm mg lp mh ls of lw og ma oh me oi oj ok ol bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">coords</strong></code> -具有GPS纬度和经度的数组列表:这在地图标记之间绘制连接线。</li><li id="5403" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">lastPosition</strong></code> -当用户点击地图上的图标时，在弹出窗口中显示的最新GPS纬度和经度。</li><li id="f76c" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">markers</strong></code> -另一个具有GPS纬度和经度的数组列表，用于显示地图上追踪器过去所在位置的蓝色圆圈。</li><li id="09a6" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">latestTimestamp</strong></code> -收到的GPS坐标的最新时间戳(也用于显示在地图的弹出窗口中)。</li><li id="16f4" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">sosCoords</strong></code> -当在应用程序中启用“SOS模式”时，创建一个单独的GPS坐标列表:它将以红色绘制地图标记之间的连接线。</li></ul><p id="29ea" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在把你的注意力转向文件中更下面的JSX。</p><p id="94b4" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">&lt;MapContainer /&gt;</strong></code>组件负责创建传单地图实例。没有这个组件，地图将无法工作，我们还定义了地图的<code class="fe nz oa ob nr b">center</code>坐标、默认缩放级别和组件的基本样式。</p><p id="c005" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">组件是我们的Mapbox样式和新的API令牌的来源。选择适合您的样式，替换字符串的<code class="fe nz oa ob nr b">streets-v11</code>部分，并确保地图框标记出现在<code class="fe nz oa ob nr b">next.config.js</code>文件中，我在上一步中已经展示过了。如果没有这个组件，没有坐标的地图背景将会被渲染，取而代之的是一个空白的画布。</p><p id="7241" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">&lt;Marker /&gt;</strong></code>接受<code class="fe nz oa ob nr b">lastPosition</code>道具，在地图上显示跟踪器最后记录位置的图标，并包装<code class="fe nz oa ob nr b">&lt;Popup /&gt;</code>组件、<code class="fe nz oa ob nr b">&lt;Polyline /&gt;</code>组件和<code class="fe nz oa ob nr b">&lt;CircleMarker /&gt;</code>组件列表。</p><p id="7b04" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">组件是一个好看的工具提示，可以显示信息。当用户点击时，我的<code class="fe nz oa ob nr b">&lt;Popup /&gt;</code>显示跟踪器的最后GPS坐标和报告时间。</p><p id="cdce" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><strong class="ll ir">&lt;Polyline /&gt;</strong></code>组件是传递GPS坐标的<code class="fe nz oa ob nr b">coords</code>列表或<code class="fe nz oa ob nr b">sosCoords</code>列表以绘制地图标记之间的连接线的地方。<code class="fe nz oa ob nr b">Polyline</code>对象接受<code class="fe nz oa ob nr b">positions</code>，在本例中是<code class="fe nz oa ob nr b">geoJsonObj</code>或<code class="fe nz oa ob nr b">sosGeoJsonObj</code>，而<code class="fe nz oa ob nr b">pathOptions</code>决定了所呈现线条的颜色。</p><blockquote class="mx my mz"><p id="6165" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><strong class="ll ir"/></p></blockquote><p id="04b2" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">最后但并非最不重要的是组件，在组件的JSX中显示为<code class="fe nz oa ob nr b">{mapMarkers}</code>。</p><blockquote class="mx my mz"><p id="5244" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><strong class="ll ir"> <em class="iq">注:</em> </strong> <em class="iq">为了将列表中的所有</em> <code class="fe nz oa ob nr b"><em class="iq">markers</em></code> <em class="iq">渲染为地图上的单个圆圈，我必须创建这个小函数来迭代列表并生成所有的圆圈，然后将其直接注入JSX。</em></p><p id="c89d" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated">试图迭代JSX中的所有值是行不通的。</p></blockquote><p id="657e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在我们的<code class="fe nz oa ob nr b">Map</code>组件已经被剖析了，让我们继续用数据填充地图，从蓝线到红线，然后再返回。</p><h2 id="80a3" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">在Next.js应用程序中渲染地图</h2><p id="eb1b" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">让这个地图在我们的Next.js应用程序中工作的下一步是导入带有<code class="fe nz oa ob nr b">ssr: false</code>选项的<code class="fe nz oa ob nr b">Map</code>组件。</p><p id="1ecd" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b">react-leaflet</code>库只在客户端工作，所以Next的<code class="fe nz oa ob nr b"><a class="ae mf" href="https://nextjs.org/docs/advanced-features/dynamic-import#with-no-ssr" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">dynamic import()</strong></a></code> <a class="ae mf" href="https://nextjs.org/docs/advanced-features/dynamic-import#with-no-ssr" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">支持没有SSR </strong> </a>特性，必须保证组件不会试图在服务器端渲染。</p><p id="f269" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">下面是这个组件将在其中显示的<code class="fe nz oa ob nr b">index.tsx</code>文件的代码，为了清楚起见，进行了压缩。如果你想在GitHub中看到完整的代码，点击文件名。</p><p id="82f3" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard/blob/main/pages/index.tsx" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">pages/index.tsx</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/0c7b187d95c3bef8324990e0b151df7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drdhLnucdh3juLJ-nkZv9Q.png"/></div></div></figure><p id="645b" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在还不要太担心被传递给组件的道具——我们很快就会设置它们。</p><p id="3b61" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在，我们的<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件被动态导入，Next的服务器端渲染被禁用，该组件可以像应用程序中的任何其他组件一样使用。</p><h1 id="81e8" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">为地图提取数据</h1><p id="d6cf" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在我之前的<a class="ae mf" href="https://www.paigeniedringhaus.com/blog/create-an-asset-tracker-with-next-js-and-react-leaflet" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">资产跟踪仪表板文章</strong> </a>中，我详细介绍了如何创建自己的资产跟踪器，使用Blues无线硬件为应用程序生成真实数据，并通过Notehub cloud的API将这些数据提取到应用程序中。</p><p id="85e4" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果您想沿着这条路构建自己的跟踪器并将数据发送到Notehub，请自便。</p><p id="49b7" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在这篇文章中，我将跳到我们已经通过Next.js <code class="fe nz oa ob nr b">getStaticProps</code> API调用将数据拉入应用程序的部分。第一次到达时，来自Notehub云的JSON数据如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/bc4d813acb4c1bd342574f77fc98f863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWxpdaNKZ9YpUaSVi4vIQg.png"/></div></div></figure><p id="7c45" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">这个数组中的每个JSON对象都是一个单独的<code class="fe nz oa ob nr b">_track.qo</code>运动事件，显示记事卡的当前位置和传感器读数。在这篇文章中，我们关心的对象部分是<code class="fe nz oa ob nr b">gps_location</code>值:<code class="fe nz oa ob nr b">latitude</code>、<code class="fe nz oa ob nr b">longitude</code>和<code class="fe nz oa ob nr b">captured</code>值。这是我们绘制地图所需的数据。</p><p id="bd1f" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">很快，我们将转换这些数据以适应我们的<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件的道具——我们将在为应用程序创建SOS模式后立即处理这些数据。</p><h2 id="7aaf" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">在应用程序中配置SOS模式</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/28a19b9a1e16ecb78f47b3fe861af622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*ZUPbDvOfvZE0C4Ng.png"/></div><figcaption class="ot ou gj gh gi ov ow bd b be z dk translated">SOS按钮在应用程序中切换SOS模式。</figcaption></figure><p id="a433" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在转换这个JSON数据之前，我们需要为应用程序提供打开或关闭SOS模式的选项(这会改变地图中呈现的折线的颜色)。</p><p id="cd86" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">为了构建这个，我们需要在我们的<code class="fe nz oa ob nr b">index.tsx</code>文件中添加一个新的状态变量、函数和按钮。</p><p id="268c" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard/blob/main/pages/index.tsx" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">pages/index.tsx</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/9674aa69ff04e98f41a13ec2cac6407a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11NyqFoaTowai5__qSZCZw.png"/></div></div></figure><p id="c0fe" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在上面的文件中，我们添加了一个新的<code class="fe nz oa ob nr b">isSosModeEnabled</code>布尔值:这将让应用程序知道在紧急跟踪情况下是否有新的位置事件发生。</p><p id="9479" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">接下来，我们创建一个名为<code class="fe nz oa ob nr b">toggleSosMode()</code>的新函数。这个函数将改变<code class="fe nz oa ob nr b">isSosModeEnabled</code>的状态，并在浏览器的本地存储器中存储一个名为<code class="fe nz oa ob nr b">sos-timestamp</code>的时间戳。我将这个时间戳存储在本地存储中，以便它可以与启用SOS模式后到达应用程序的事件进行比较，应用程序将知道它是否需要用红色或蓝色渲染地图上的折线。我们将在下一节讨论这部分的逻辑。</p><p id="19d2" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">最后，在组件的JSX中，我们将创建一个新的<code class="fe nz oa ob nr b">&lt;button&gt;</code>元素，并将<code class="fe nz oa ob nr b">toggleSosMode()</code>函数附加到它的<code class="fe nz oa ob nr b">onClick()</code>方法上。我还在按钮下方添加了一个<code class="fe nz oa ob nr b">&lt;p&gt;</code>标签，以显示SOS模式在应用程序中的生效时间。</p><p id="7541" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在应用模式后按下按钮将打开它，再次按下它将关闭它。</p><blockquote class="mx my mz"><p id="31a0" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><strong class="ll ir"/></p></blockquote><p id="0476" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在我们可以在浏览器中随意打开和关闭SOS模式，是时候获取我们的位置数据并将其转换到地图中了。</p><h2 id="9452" class="ne ks iq bd kt nf ng dn kx nh ni dp lb ls nj nk ld lw nl nm lf ma nn no lh np bi translated">重塑跟踪器事件数据</h2><p id="84eb" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们的<code class="fe nz oa ob nr b">index.tsx</code>文件将需要更多的状态变量来满足<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件需要的所有不同的数据属性。我再次精简了逻辑，使这个文件更容易阅读，但您可以随时单击文件名在线查看其完整内容。</p><p id="7fc6" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard/blob/main/pages/index.tsx" rel="noopener ugc nofollow" target="_blank"><strong class="ll ir">pages/index.tsx</strong></a></code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/e7c39c725ed2d887a5b707e1345f918b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-o-SXFWEGb6PYx0mjIUvQ.png"/></div></div></figure><p id="b87d" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">在我们的主组件中，一旦从Notehub获取了数据，我们就设置以下新的React <code class="fe nz oa ob nr b">useState</code>变量来保存要传递给<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件的数据。</p><p id="8d3f" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><code class="fe nz oa ob nr b">lastPosition</code>、<code class="fe nz oa ob nr b">latestTimestamp</code>、<code class="fe nz oa ob nr b">latLngMarkerPositions</code>和<code class="fe nz oa ob nr b">sosCoords</code>，是我们需要的新的状态变量。</p><p id="5a68" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">声明这些状态后，无论何时从Notehub(在组件挂载时)获取数据或切换应用程序的SOS模式，都会运行<code class="fe nz oa ob nr b">useEffect()</code>函数。在函数内部，来自Notehub的事件被排序并遍历。</p><p id="a26b" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果<code class="fe nz oa ob nr b">isSosModeEnabled</code>布尔值为真，则从浏览器的本地存储中取出<code class="fe nz oa ob nr b">sos-timestamp</code>，并将该时间戳的日期与每个事件的<code class="fe nz oa ob nr b">captured</code>时间戳进行比较，从而可以将该事件正确分类到<code class="fe nz oa ob nr b">sosLatLngArray</code>列表或<code class="fe nz oa ob nr b">latLngArray</code>列表中。</p><p id="f7da" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">一旦这些局部数组被组装到<code class="fe nz oa ob nr b">useEffect()</code>中，它们就被设置为等于状态变量<code class="fe nz oa ob nr b">latLngMarkerPositions</code>和<code class="fe nz oa ob nr b">sosCoords</code>。</p><p id="d7f1" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果<code class="fe nz oa ob nr b">isSosModeEnabled</code>为假，那么所有事件都将自动添加到<code class="fe nz oa ob nr b">latLngArray</code>列表中。</p><p id="9af9" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">其他变量<code class="fe nz oa ob nr b">lastPosition</code>和<code class="fe nz oa ob nr b">latestTimestamp</code>通过从排序后的数据数组中取出最后一个事件并从中提取属性来设置。</p><p id="98cc" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">然后所有这些变量被传递给<code class="fe nz oa ob nr b">&lt;Map /&gt;</code>组件，它知道如何处理标记、弹出窗口和线条颜色。</p><h1 id="1e77" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">测试一下</h1><p id="0107" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">好吧！我想我们正在阅读来测试我们的地图和彩色线条！</p><p id="9c5b" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果你使用的是我们的模拟数据，而不是来自Notehub cloud的实时数据流，测试该应用程序最简单的方法是通过浏览器中的按钮打开SOS模式，然后将<a class="ae mf" href="https://developer.chrome.com/docs/devtools/storage/localstorage/" rel="noopener ugc nofollow" target="_blank">浏览器的DevTool本地存储</a>中的时间戳调整为至少在某些事件<code class="fe nz oa ob nr b">captured</code>时间戳之前。</p><p id="6d40" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果一切都按计划进行，你应该会看到一个彩色线条的组合，这取决于SOS模式的时间设置和事件发生的时间。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1693f0fd8afaa395aeadd9f39798782b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*d9va-fOQNYEh2lq5.png"/></div></div><figcaption class="ot ou gj gh gi ov ow bd b be z dk translated">当SOS模式开启时，启用后发生的新事件显示为红线。</figcaption></figure><blockquote class="mx my mz"><p id="c8d9" class="lj lk na ll b lm mg jr lo lp mh ju lr nb mi lu lv nc mj ly lz nd mk mc md me ij bi translated"><em class="iq">请记住，这个应用程序是在一天内完成的，所以它还很粗糙，当然还没有准备好迎接黄金时间。如果你愿意的话，我建议在把它放入prod之前，对它进行分叉，并做一些额外的润色和测试。</em></p></blockquote><p id="0398" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">现在你有了:React应用程序中地图上的彩色线条。对于一天的工作来说还不算太寒酸。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="1c07" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">结论</h1><p id="5637" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">去年夏天我加入了一家物联网初创公司后，我开始开发web应用程序，以反映我们的物联网设备在现实世界中捕获和传输的数据，并将其发送到云端。在一次全公司的黑客马拉松中，我创建了一个仪表板，不仅可以显示位置数据，还可以随意将位置线从蓝色更改为红色。</p><p id="9009" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">这似乎是一个很好的特性，可以在紧急情况下提高地图的可读性。</p><p id="5953" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">Next.js与React传单库的结合使这一切成为可能，在这个时间框架内，我有了一个工作原型(虽然非常粗糙)给我的同事看。从事这项工作非常有趣，在此过程中我学到了很多新东西。这是我心目中成功的黑客马拉松。</p><p id="888e" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">过几周再来看看——我会写更多关于JavaScript、React、IoT或其他与web开发相关的东西。</p><p id="5edc" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">如果你想确保你不会错过我写的一篇文章，在这里注册我的时事通讯:<a class="ae mf" href="https://paigeniedringhaus.substack.com/" rel="noopener ugc nofollow" target="_blank">https://paigeniedringhaus.substack.com</a></p><p id="c191" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">感谢阅读。我希望看到如何在Next.js中设置一个交互式地图，并根据不同的情况在不同的位置点之间呈现多种颜色的旅行线，对您有所帮助。快乐映射！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h1 id="d0fa" class="kr ks iq bd kt ku ms kw kx ky mt la lb jw mu jx ld jz mv ka lf kc mw kd lh li bi translated">参考资料和更多资源</h1><ul class=""><li id="4c2b" class="od oe iq ll b lm ln lp lq ls oy lw oz ma pa me oi oj ok ol bi translated"><a class="ae mf" href="https://www.hackster.io/paige-niedringhaus/low-code-gps-asset-tracker-and-map-display-b10419" rel="noopener ugc nofollow" target="_blank"> Hackster.io原始资产跟踪项目</a></li><li id="a6a2" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><a class="ae mf" href="https://github.com/paigen11/notelink-tracker-dashboard" rel="noopener ugc nofollow" target="_blank"> SOS资产追踪GitHub回购</a></li><li id="917b" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><a class="ae mf" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">传单文件</a></li><li id="57ff" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><a class="ae mf" href="https://react-leaflet.js.org/" rel="noopener ugc nofollow" target="_blank"> React传单文件</a></li><li id="fdb7" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated"><a class="ae mf" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank">地图框网站</a></li><li id="477b" class="od oe iq ll b lm om lp on ls oo lw op ma oq me oi oj ok ol bi translated">蓝调无线<a class="ae mf" href="https://blues.io/?&amp;utm_source=paigeniedringhaus.com&amp;utm_medium=web&amp;utm_campaign=niedringhaus-effect&amp;utm_content=ep-2" rel="noopener ugc nofollow" target="_blank">网站</a></li></ul></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="c621" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><em class="na">原载于</em><a class="ae mf" href="https://www.paigeniedringhaus.com/blog/render-multiple-colored-lines-on-a-react-map-with-polylines" rel="noopener ugc nofollow" target="_blank"><em class="na">https://www.paigeniedringhaus.com</em></a><em class="na">。</em></p></div></div>    
</body>
</html>