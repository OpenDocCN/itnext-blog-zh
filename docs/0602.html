<html>
<head>
<title>Kubernetes Is Hard: Why EKS Makes It Easier for Network and Security Architects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes很难:为什么EKS让网络和安全架构师更容易</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-is-hard-why-eks-makes-it-easier-for-network-and-security-architects-ea6d8b2ca965?source=collection_archive---------0-----------------------#2018-04-10">https://itnext.io/kubernetes-is-hard-why-eks-makes-it-easier-for-network-and-security-architects-ea6d8b2ca965?source=collection_archive---------0-----------------------#2018-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ba41067a52acb04f3cf84b58fc053fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wAzMMay6dc7dEx6p."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">《打结的绳子》由<a class="ae kc" href="https://unsplash.com/@toboote?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">蒂姆·布特</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上演唱</figcaption></figure><p id="ba0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如今运行Kubernetes集群非常困难…您首先需要决定将它部署到哪个云(或数据中心),然后仔细选择合适的网络、存储、用户和日志集成。</p><p id="7d0b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您的需求超出了正常范围，那么祝您好运，找到一个工具来为您解决这个问题！</p><p id="e99f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在Google Cloud上运行，你在GKE已经有了一个久经考验的、生产就绪的Kubernetes服务，但是根据Cloud Native Computing Foundation，<a class="ae kc" href="https://www.cncf.io/announcement/2017/08/09/amazon-web-services-joins-cloud-native-computing-foundation-platinum-member/" rel="noopener ugc nofollow" target="_blank"> 63%的Kubernetes工作负载目前位于AWS </a>上。作为回应，AWS已经宣布计划向EKS提供Kubernetes托管服务。如果你想了解更多关于EKS和法盖特的声明，请点击这里查看卡洛斯的博客文章<a class="ae kc" href="https://www.contino.io/insights/what-do-amazon-ecs-kubernetes-service-and-fargate-mean-for-you" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="10a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天，我们将了解为什么Kubernetes网络堆栈过于复杂，AWS的VPC容器网络接口(CNI)如何简化堆栈，以及它如何实现跨安全组的微分段。</p><h2 id="eed7" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">当心:Kubernetes网络堆栈！</h2><p id="b9e4" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">构建Kubernetes集群最有争议的一点是网络堆栈。有大量的提供商可以使用，如果你以前从未部署过K8s，这可能会令人望而生畏！</p><p id="45b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubernetes使用一种不同于正常的“Docker方式”的方式来处理网络。Docker使用虚拟桥接网络从主机向底层容器进行端口转发。这意味着跨多个设备协调端口是一件很难大规模实现的事情，并且会使用户面临他们无法控制的集群级问题。</p><p id="596b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，Kubernetes对其网络实施提出了以下要求:</p><ul class=""><li id="3731" class="lz ma iq kf b kg kh kk kl ko mb ks mc kw md la me mf mg mh bi translated">所有的容器都应该有自己的IP地址，容器应该能够看到自己和其他人看到的是同一个IP</li><li id="75b1" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">所有容器无需NAT就可以相互通信</li><li id="4e33" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">所有节点都可以在没有NAT的情况下与所有容器通信(反之亦然)</li></ul><p id="78fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Kubernetes提供了一个名为<a class="ae kc" href="https://kubernetes.io/docs/concepts/cluster-administration/networking/" rel="noopener ugc nofollow" target="_blank">容器网络接口(CNI) </a>的插件规范，将平台与底层网络基础设施集成在一起。只要满足上述要求，供应商就可以根据需要自由实施网络堆栈，并且通常使用覆盖网络来支持<strong class="kf ir">多子网</strong>、<strong class="kf ir">多az </strong>集群。</p><h2 id="2648" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">什么是覆盖网络？</h2><p id="6e14" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">覆盖网络是一种网络类型，管理员通过它在物理基础架构之上创建多个原子和离散的虚拟化网络层。它利用封装技术(如NVGRE或VXLan)将一个数据包封装在另一个数据包中，从而将网络服务与底层基础设施分离开来。</p><p id="cabf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">覆盖网络的一个常见例子是AWS虚拟私有云，它允许亚马逊在数百万台设备上运行数千个私有的原子网络，跨越多个站点和地区。</p><p id="17aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Kubernetes的环境中，覆盖网络允许Kubernetes集群中的pod通过独立IP范围内的多个集群与底层VPC进行通信。</p><p id="ea79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在下面的例子中，我们可以看到如何通过使用一种叫做<a class="ae kc" href="https://github.com/coreos/flannel" rel="noopener ugc nofollow" target="_blank">法兰绒</a>的流行CNI来实现覆盖网络。假设位于<strong class="kf ir">节点1 </strong>的Pod <strong class="kf ir"> Web App前端1 </strong>想要与位于<strong class="kf ir">节点2的pod <strong class="kf ir">后端服务2 </strong>进行对话。</strong></p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/92de934eadb5f15dc742243947d96661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pf1N1JU3AvPerS1R."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带法兰绒的Kubernetes中的典型叠加网络流</figcaption></figure><p id="caf4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> Web App前端1 </strong>用<strong class="kf ir">创建一个IP包来源:10.1.15.2 - &gt;目的地:10.1.20.3 </strong>。该数据包将离开连接到该pod的虚拟适配器(veth0 ),并前往<strong class="kf ir"> docker0 </strong>桥。Docker0随后将查阅其路由表，在那里它看到<strong class="kf ir"> 10.1.15.0/24 </strong>之外的所有端点都位于<em class="ms">其他</em>主机上，并相应地将其转发给<strong class="kf ir"> flannel0 </strong>端点。</p><p id="ee1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在ETCD的Kubernetes KV商店中,<strong class="kf ir"> flannel0 </strong>桥与flanneld进程一起管理主机到网络区域的映射。在这种情况下，它知道<strong class="kf ir"> 10.1.20.3位于主机<strong class="kf ir"> 192.168.0.200 </strong>的</strong>中，并将该数据包封装在<em class="ms">另一个</em>数据包中，该数据包带有<strong class="kf ir">源:192.168.0.100 - &gt;目的地192.168.0.200。</strong></p><p id="c95e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，数据包将通过VPC网络到达目的主机，并到达目的地flanneld。从那里，它逆转上述过程，并前往目的地吊舱。</p><p id="c398" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在请记住，VPC也是封装数据包的覆盖层。那就是三个网络层！</p><p id="4672" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这太复杂了！</p><p id="91d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在请记住，VPC也是一个覆盖层，用于封装数据包。<strong class="kf ir">那是3个网络层！</strong></p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/d6bf3c5f96c6fc75d1480bc66ea54019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*LNG2mWIbU_7GNmvT."/></div></figure><h2 id="076b" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">在AWS中运行覆盖图很糟糕…</h2><p id="97c2" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated"><strong class="kf ir"> VPC流日志不起作用:</strong>底层VPC没有运行于其上的封装覆盖网络的上下文。VPC流量日志将仅显示Kubernetes集群中主机之间的流量，这使得对任何网络相关问题进行故障排除变得非常困难。</p><p id="c011" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">安全组不起作用:</strong>由于VPC没有覆盖网络的上下文，它无法将安全策略应用到单个pod，而只能将它们应用到Kubernetes集群本身。这意味着您需要运行、管理和维护两套网络策略控制。</p><p id="2d44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">我还有另一个可以打破的东西:</strong>通过实现一个覆盖网络，我为我的应用程序堆栈创建了另一个容错域。我需要担心的故障域越多，我就越有可能在凌晨3点被影响集群中每个应用程序的问题吵醒。</p><p id="bed9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">我不想再管理这些东西了:</strong>我们转向云的原因是将责任从我身上转移到一家能够比我想象的更大、更好、更快、更高效地扩展这些服务的公司。通过创建另一个网络堆栈供我管理，我感觉自己又回到了本地网络的黑暗时代。</p><p id="a064" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">不过不用担心！AWS来救援了！</strong></p><p id="e30f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS没有利用现有的提供商，而是构建自己的… <em class="ms">并且结果相当不错。</em></p><h2 id="bff1" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">AWS VPC CNI</h2><p id="286e" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">AWS同意覆盖网络并不是管理AWS EKS网络的最理想方式，而是建立了他们自己的CNI接口，并且<a class="ae kc" href="https://github.com/aws/amazon-vpc-cni-k8s" rel="noopener ugc nofollow" target="_blank">已经将其开源。</a>虽然仍然<strong class="kf ir">在Alpha </strong>中，我们可以看到该实现试图解决一些我们在覆盖网络中看到的非常令人沮丧的问题。</p><p id="b6a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它希望实现以下目标:</p><ul class=""><li id="67a6" class="lz ma iq kf b kg kh kk kl ko mb ks mc kw md la me mf mg mh bi translated">Pod网络连接性能必须类似于AWS VPC网络。即低延迟、最小抖动、高吞吐量和高可用性</li><li id="0e29" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">用户必须能够表达和实施精细的网络策略和隔离，与本地EC2网络和安全组可实现的策略和隔离相媲美</li><li id="67fd" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">网络操作必须简单安全。用户必须能够应用现有的AWS VPC网络和安全最佳实践，在AWS VPC上构建Kubernetes集群</li><li id="0be7" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">VPC流量测井必须工作</li><li id="b001" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">VPC路由策略必须奏效</li><li id="1c94" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">数秒内完成Pod网络设置</li><li id="7db9" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">豆荚必须能够在几秒钟内连接到网络</li><li id="cf9a" class="lz ma iq kf b kg mi kk mj ko mk ks ml kw mm la me mf mg mh bi translated">集群应该能够扩展到大约2000个节点。</li></ul><p id="bb32" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了实现这一结果，AWS <em class="ms">滥用</em>其将多个弹性网络接口(ENIs或vNICs)连接到虚拟机的能力，并将多个辅助IP地址与每个ENI相关联。然后，每个pod能够选择一个空闲的辅助IP地址，将其分配给pod，并允许它通过该接口进行入站/出站通信。</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/827ce99e23a428b14ceddd9a1d3233c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97YZWBwS7Be3w4T3CQj2Ag.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">CNI网络流量</figcaption></figure><p id="6e76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用与之前相同的图表，我们可以看到，要从A-&gt;B路由，我们不再需要担心Kubernetes封装数据包，因为所有通信都可以使用VPC中的IP地址进行。</p><p id="3eef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">网络架构师可以松一口气了:<em class="ms">这大大简化了堆栈！</em></p><blockquote class="mu mv mw"><p id="61bf" class="kd ke ms kf b kg kh ki kj kk kl km kn mx kp kq kr my kt ku kv mz kx ky kz la ij bi translated">Lyft已经使用了与AWS CNI几乎相同的方法。你可以在这里找到更多信息<a class="ae kc" href="https://github.com/lyft/cni-ipvlan-vpc-k8s" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><h2 id="cf8f" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">安全架构师和微分段</h2><p id="3549" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">现在来看看这对我们的安全架构师意味着什么！</p><p id="b59b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS VPC CNI意味着我们可能很快就会看到使用AWS安全组的<em class="ms">本机微分段</em>！</p><p id="d960" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">微分段是将网络安全策略应用于虚拟机的能力，是通过应用应用上下文网络策略来降低数据中心中东/西入侵可能性的关键控制措施，而不是像过去的网络设计那样，简单地在DMZ、应用和数据库区域的边缘安装防火墙。<a class="ae kc" href="https://www.sdxcentral.com/sdn/network-virtualization/definitions/how-does-micro-segmentation-help-security-explanation/" rel="noopener ugc nofollow" target="_blank"> SDXCentral有一篇很好的文章进一步解释了微分段。</a></p><p id="1660" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你已经在AWS、谷歌或NSX运行了一段时间，你会非常熟悉微分段的概念，即使你没有意识到这一点！</p><p id="41db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">下面是AWS中微分段的一个相当典型的例子。</strong></p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/869d33365b05923d41df41c1df1c8806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PKfUK8ysql28M2dg."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">典型AWS微分段示例</figcaption></figure><p id="ae51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本例中，我们可以看到一个极其简单的投资应用程序，它分为三层:AWS ALB前端的负载平衡层、EC2上运行的应用程序层和数据库层RDS。这些层中的每一层都有自己的安全组，该组明确允许各层之间的流量流动，并隐式拒绝所有其他流量。</p><p id="9239" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在另一个工作负载受到损害的情况下，我们有一个适当的控制，使工作负载不可能东/西升级到同一子网中的其他服务。</p><p id="8f51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是当你把Kubernetes引入这个组合时会发生什么呢？</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/e0ca60d9787df60aea39ef0efbaf2f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*02uhfv8F4VWdr3Mr."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">添加Kubernetes时的AWS安全组</figcaption></figure><p id="f7aa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在印花布/织物/法兰绒的旧世界，VPC没有容器的上下文，只能对运行容器的主机应用安全组。实际上，这意味着任何Pod都可以路由到已经暴露给集群的任何服务。如果其中一个豆荚受到损害，它可能会升级到它可以访问的数据库。</p><p id="e68c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">但我以为Kubernetes有纳米分割？</strong></p><p id="d713" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有点…有很多工具可以用来解决集群中的网络分段问题。它们通常是通过混合使用操作系统包、容器端cars或docker守护进程集来实现的，但是这些<em class="ms">给你的部署栈</em>又增加了一层复杂性！</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/8949eb4b51e6e16c857e385f3864e1f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sIaAvwqKQhAwk13y."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">同样的，但现在有一个覆盖安全结构</figcaption></figure><p id="38d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大多数情况下，这些分段工具没有集群外部的环境，这意味着它们可以阻止集群内的东/西攻击，但无法阻止到数据库等支持服务的出站连接。在某些情况下，他们可能有针对pod的黑名单/白名单功能，但是在两个位置维护这些规则是乏味且无效的。</p><p id="7e16" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">但是我听说过这个工具在集群内外都管用？</strong></p><p id="c7e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有些工具允许您在群集内外应用策略，但它们是通过在群集外的虚拟机上安装代理来工作的。这意味着您不能将您的细分策略应用于RDS等服务，因为这些服务不允许您访问底层主机，而是必须运行您自己的… <em class="ms">这首先就违背了在云中存在的意义。</em></p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/b38b757a277fc4f2b4a2658daf4c1061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OO9BxUHnFxDqhCz_."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">安全组，但带有基于代理的防火墙</figcaption></figure><p id="d4d8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么EKS呢？</p><p id="0d53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS CNI的目标之一是能够像其他VPC资源一样将安全组应用于pod。在发布时，我们应该能够在集群内部<em class="ms">和集群外部</em>应用安全组进行微分段！</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/12874b59d13d1c2aeb45d2db21d4421d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e1wB-hfIYDWE01Cd."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">EKS会让我们做什么</figcaption></figure><p id="426a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编辑:发布已经一个月了。正如我们所见，集群内部和外部的微分段目标没有实现。但愿他们能在ENI的未来版本中解决这个问题。</p><h2 id="a8a3" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">我什么时候不会使用CNI开发的AWS？</h2><p id="9cef" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">AWS中的虚拟机对任何时候可以连接到任何单个虚拟机的弹性网络接口的数量有最大限制。该数量因<a class="ae kc" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI" rel="noopener ugc nofollow" target="_blank">实例类型</a>而异。这可以通过以下方式计算:</p><p id="8faa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">每个ENI的ENIs x辅助IP =每个节点的最大pod数</strong></p><p id="d417" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您正在构建的应用程序需要极高密度的pods到节点，您最好使用其他CNI解决方案，如Calico或Weave，或者Hashicorp的Nomad，该解决方案已被证明可在5k主机上扩展到一百万个容器。</p><p id="f901" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS CNI的另一个问题是它对IP地址的低效使用。为了尽快将IP地址连接到Pod，CNI会将大量IP地址预加载到节点上。如果集群部署在一个特别小的VPC中，您可能会用完地址，即使它们没有被真正的工作负载使用。</p><h2 id="d2a3" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">最后的想法</h2><p id="7d72" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为了让EKS在AWS中获得成功，它需要与应用程序生态系统的其余部分进行适当的集成。通过简化网络堆栈，Kubernetes降低了令人望而生畏的准入门槛，使新受众更容易访问它，高级受众更安全，需要它的人性能更好。</p><p id="1d1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就我而言，我真的很兴奋地看到这如何扩展到EKS·法盖特，以及当容器成为像EC2这样的真正的计算原语时会发生什么！</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><blockquote class="mu mv mw"><p id="d27e" class="kd ke ms kf b kg kh ki kj kk kl km kn mx kp kq kr my kt ku kv mz kx ky kz la ij bi translated">为了更深入地了解法兰绒网络后台程序，请阅读韩笑的博客<a class="ae kc" href="https://blog.laputa.io/kubernetes-flannel-networking-6a1cb1f8ec7c" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p></blockquote></div></div>    
</body>
</html>