<html>
<head>
<title>AWS Cognito example using React UI and Node.js REST APIs — part 2 (React UI app with Redux)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React UI和Node.js REST APIs的AWS Cognito示例—第2部分(React UI app with Redux)</h1>
<blockquote>原文：<a href="https://itnext.io/aws-cognito-example-using-react-ui-and-node-js-rest-apis-part-2-react-ui-app-with-redux-6cc22610affe?source=collection_archive---------0-----------------------#2019-07-29">https://itnext.io/aws-cognito-example-using-react-ui-and-node-js-rest-apis-part-2-react-ui-app-with-redux-6cc22610affe?source=collection_archive---------0-----------------------#2019-07-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="244e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">在本系列的第二篇文章中，我将介绍如何将一个简单的React UI应用程序与我们在第一篇文章中配置的AWS Cognito用户池相集成。我将展示如何使用Cognito提供的内置登录和注册UI内容，以及如何将它们与React UI结合起来。我们还将探索这种内置UI内容的定制选项，并展示如何向它们添加我们自己的徽标和品牌。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/346dcfe7a14cf3fc95cc326f1b7cd010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnJzq1jZ5cJ3EmwtnNsruQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">与Cognito集成的skeleton React应用程序</figcaption></figure><p id="6d68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">回顾一下<a class="ae ln" href="https://medium.com/@arron.harden/aws-cognito-example-using-react-ui-and-node-js-rest-apis-part-1-cognito-setup-5597acb02db4" rel="noopener">的第一篇帖子</a>，我们创建了一个Cognito用户池，并对其进行了配置，以便可以从客户端应用程序中使用。我们还为用户池配置了自定义域名，然后测试我们可以访问内置的登录和注册页面。</p><h1 id="08e4" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建React UI应用程序</h1><p id="dfbe" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">当我开始查看Cogntio时，我以为AWS文档中会有一个简单的例子，展示如何使用现有的AWS库将Cogntio巧妙地添加到React应用程序中——不幸的是没有，所以就交给Google了。再说一次，我发现没有什么是完全符合标准的。也许我的谷歌搜索还不够好，因为我找到的大多数例子都是展示如何使用自己的登录和注册页面，或者如何从更传统的JavaScript UIs调用AWS库，而不是我正在寻找的单页应用程序(SPA)方法。</p><p id="342f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以回到绘图板，我决定从标准的skeleton React应用程序开始，编写我需要的代码，以演示与Cognito的集成。</p><h2 id="8241" class="mr lp it bd lq ms mt dn lu mu mv dp ly kb mw mx mc kf my mz mg kj na nb mk nc bi translated">React应用概述</h2><p id="0db8" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">我的简单React应用程序将使用React路由器配置2个UI路由。第一个是附加在<em class="nd"> / </em>路由上的，是常规的欢迎使用React页面，我将对其进行修改，以显示一条消息，指示用户当前是否登录。第二个附属于<em class="nd"> /callback </em>路由，将处理来自内置Cognito登录和注册内容的回调。</p><p id="481e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将路由绑定在一起是一个Redux存储，它包含会话信息，并使需要它的UI组件可以使用它。应用程序的最后一部分是位于AWS Cognito JavaScript库之上的一小组实用方法。</p><p id="51e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">应用程序将被绑定到URL<a class="ae ln" href="https://cognito-demo.arronharden.com" rel="noopener ugc nofollow" target="_blank">https://cognito-demo.arronharden.com</a>以匹配我们的用户池回调中配置的URL。我使用AWS Amplify来管理GitHub的构建和部署，但是细节问题将留待下次讨论。完整的应用程序源代码可在https://github.com/arronharden/cognito-demo-ui的<a class="ae ln" href="https://github.com/arronharden/cognito-demo-ui" rel="noopener ugc nofollow" target="_blank">GitHub获得。</a></p><p id="514e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了开始并使这个例子尽可能简单，我创建了一个样板React应用程序，并将其命名为<em class="nd"> cognito-demo-ui。</em></p><pre class="ky kz la lb gt ne nf ng nh aw ni bi"><span id="7d01" class="mr lp it nf b gy nj nk l nl nm">npm init react-app cognito-demo-ui</span></pre><h2 id="ba06" class="mr lp it bd lq ms mt dn lu mu mv dp ly kb mw mx mc kf my mz mg kj na nb mk nc bi translated">Redux</h2><p id="6040" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">应用程序的Redux部分由reducers、动作和存储组成。如果你是Redux的新手或者已经有一段时间没有使用它了，像<a class="ae ln" href="https://www.valentinog.com/blog/redux/" rel="noopener ugc nofollow" target="_blank">https://www.valentinog.com/blog/redux/</a>这样的东西是一个好的开始。</p><p id="2330" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个示例应用程序的Redux状态非常简单:</p><pre class="ky kz la lb gt ne nf ng nh aw ni bi"><span id="ac4c" class="mr lp it nf b gy nj nk l nl nm">session: {<br/>    isLoggedIn: &lt;boolean&gt;,<br/>    user: {<br/>        userName: &lt;string&gt;,<br/>        email: &lt;string&gt;<br/>    },<br/>    credentials: &lt;CognitoIdentityCredentials&gt;<br/>}</span></pre><p id="b26c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">定义了3个动作；<em class="nd"> clearSession </em>，<em class="nd"> setSession </em>和最有趣的<em class="nd">initSessionFromCallbackURI</em>。这最后一个动作使用<em class="nd"> react-thunk </em>来启动一个异步进程，以验证通过URL中的<em class="nd"> code </em>查询参数传递给应用程序回调路由的验证码(例如，以<a class="ae ln" href="https://cognito-demo.arronharden.com/callback?code=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" rel="noopener ugc nofollow" target="_blank">https:<em class="nd">//cognito-demo . arronharden . com/callback？代码= xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</em></a>)。一旦验证码被验证，它就会从Cognito获得一个会话，其中包含我们调用后端REST APIs所需的JWT令牌。一旦完成，它将使用从Cognito返回的会话在商店上调度<em class="nd"> setSession </em>动作，该会话将包含用户信息和凭证。这些操作的代码如下所示:</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">会话还原操作(session.js)</figcaption></figure><p id="f348" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Cognito实用程序方法的相应代码如下所示。这独立于Redux实现，使其尽可能可重用。<em class="nd">(需要注意的一点是，它使用的AWS提供的库主要只支持浏览器，因为它们通常使用XHR进行REST API调用。对于我们的例子来说这不是问题，但是如果代码直接在Node.js中执行，这可能是个问题)。</em></p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">Cognito实用方法(cognitoUtils.js)</figcaption></figure><h2 id="29e3" class="mr lp it bd lq ms mt dn lu mu mv dp ly kb mw mx mc kf my mz mg kj na nb mk nc bi translated">申请途径</h2><p id="59b4" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">如前所述，应用程序需要定义2条路由，我们将使用React路由器来实现。/路由将会转到<em class="nd"> Home </em>组件，而<em class="nd"> /callback </em>路由将会转到<em class="nd"> Callback </em>组件。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">定义了两条路线的主应用程序(App.js)</figcaption></figure><h2 id="febf" class="mr lp it bd lq ms mt dn lu mu mv dp ly kb mw mx mc kf my mz mg kj na nb mk nc bi translated">家用部件</h2><p id="14ea" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">根据用户是否登录，Home组件将显示不同的消息。如果他们已经登录，它将显示他们登录时使用的用户名和电子邮件地址(来自Redux store)以及一个可用于注销的链接。如果他们没有登录，它将显示一个到Cognito提供的登录页面的链接。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">主页组件(Home.js)</figcaption></figure><h2 id="633d" class="mr lp it bd lq ms mt dn lu mu mv dp ly kb mw mx mc kf my mz mg kj na nb mk nc bi translated">回调组件</h2><p id="f0c7" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">回调组件将简单地使用调用它的URL在存储上调用<em class="nd">initSessionFromCallbackURI</em>动作。一旦在存储中设置了会话细节，React将自动调用<em class="nd"> render() </em>方法，因为来自Redux存储的会话是回调组件的会话属性。回调部件然后将使用重定向部件重定向到路由部件，即归属部件。因为我们使用重定向组件，而不是window.location样式的重定向，所以Redux存储状态不会被清除，这使得Home组件能够检索会话细节。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">回调组件(Callback.js)</figcaption></figure><h1 id="4201" class="lo lp it bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">定制Cognito托管的用户界面</h1><p id="b724" class="pw-post-body-paragraph jq jr it js b jt mm jv jw jx mn jz ka kb mo kd ke kf mp kh ki kj mq kl km kn im bi translated">您可能已经注意到，Cognito用户池配置允许用户界面定制。在这里，我们将进行一些定制:</p><ul class=""><li id="2ad2" class="np nq it js b jt ju jx jy kb nr kf ns kj nt kn nu nv nw nx bi translated">上传一个简单的标志</li><li id="3554" class="np nq it js b jt ny jx nz kb oa kf ob kj oc kn nu nv nw nx bi translated">横幅<code class="fe od oe of nf b">background-color</code>至<code class="fe od oe of nf b">white</code></li><li id="1c1b" class="np nq it js b jt ny jx nz kb oa kf ob kj oc kn nu nv nw nx bi translated">背景<code class="fe od oe of nf b">background-color</code>到<code class="fe od oe of nf b">#ddd</code></li></ul><p id="d68f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦这样做了，我们可以通过登录流程立即看到不同之处。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi og"><img src="../Images/ba9c37ee5e814167128cbecf5c4676a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5FeFLOJ0BmdD9pFLlMpxw.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">定制前后</figcaption></figure><p id="ae68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然定制功能确实允许对托管登录和注册UI内容进行一些控制，但它在可以改变什么方面非常有限。例如，如果你试图定制内容来匹配React skeleton应用程序的样式(白色文本在<code class="fe od oe of nf b">#282c34</code>背景上),你很快就会发现你做不到，因为你不能改变所有文本组件的颜色。定制也仅限于CSS的改变——目前不可能改变文本本身。还值得注意的是，文本语言似乎只硬编码为英语，它没有使用<em class="nd"> Accept-Language </em>或URL查询参数来显示不同语言的选项。</p><p id="0791" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总的来说，我认为内置的托管登录和注册UI内容对于入门、演示和小型项目来说是很好的，但在大多数情况下，您更可能希望为这些内容构建自己的UI，并使用AWS库作为该UI的后端。</p><p id="8156" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下一部分中，我们将离开UI，向下移动堆栈，查看Node.js中实现的REST API，以及如何使用UI从Cognito获得的JWT令牌安全地调用它。</p></div></div>    
</body>
</html>