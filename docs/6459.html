<html>
<head>
<title>Jenkins Tutorial — Part 8 — Triggering Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins教程—第8部分—触发管道</h1>
<blockquote>原文：<a href="https://itnext.io/jenkins-tutorial-part-8-triggering-pipeline-d53dbba539d6?source=collection_archive---------0-----------------------#2021-11-22">https://itnext.io/jenkins-tutorial-part-8-triggering-pipeline-d53dbba539d6?source=collection_archive---------0-----------------------#2021-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c518273176f996c36d381a98cf53ea9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isD_dDi7u493JTm4ZudxOw.jpeg"/></div></div></figure><p id="daaa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">手动运行CI/CD作业不是启动管道流程的好方法，因为手动完成的所有工作都会与自动化竞争。Jenkins提供了各种自动启动作业的方法。这些方法在<strong class="ka ir">构建触发器</strong>部分进行了分类。在Jenkins教程的这一部分，我将解释触发管道的常用方法。请注意，一些方法由于安装插件而存在，可能在Jenkins bare安装中找不到。所以，我建议你使用下面的Jenkins栈，它有你需要的所有东西。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/jenkins-stack-kubernetes" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/jenkins-stack-kubernetes:在Kubernetes上部署Jenkins的脚本和清单</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果你觉得有用，就看星星。在Kubernetes上部署Jenkins containers CI/CD堆栈的脚本和清单。的…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="lj l lk ll lm li ln jw kz"/></div></div></a></div><p id="be07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你发现这一系列的文章是有帮助的，请查看教程的官方资源库。您也可以在这个资源库中找到所有示例。</p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/jenkins-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/jenkins-tutorial:完整的Jenkins教程，参考，牛逼，示例</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果你觉得有用，就看星星。Jenkins系列教程的参考和示例库。版权所有2021…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="lo l lk ll lm li ln jw kz"/></div></div></a></div><h1 id="9c24" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Jenkins构建触发器:</h1><p id="77f6" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">我说过，Jenkins有各种构建触发方式，cron，webhook，URL，upstream等。我来解释一下流行的。所有触发器都应在管道的<strong class="ka ir">触发器</strong>块中定义。</p><p id="4d6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron</strong></code>是Unix/Linux cron之类的东西。要编写cron触发器，请使用<code class="fe ms mt mu mv b">cron "MINUTE HOUR DOM MONTH DOW"</code>语法。您应该注意到，许多不同的触发器可以用于相同的作业。</p><p id="f408" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> DOM </strong>是一个月中的某一天，而<strong class="ka ir"> DOW </strong>是一周中的某一天。</p><p id="1a49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有一个简单的例子:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="eef2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "0 * * * *"</strong></code>在每小时的0分钟运行。</p><p id="f59e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "0 0 * * *"</strong></code>00:00运行(每天一次)。</p><p id="0dfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "0 0 * 2,4,6,8,10,12 *"</strong></code>双月每天运行一次。</p><p id="9623" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "* 1-7 * * *"</strong></code>从1小时到7小时每分钟运行一次。</p><p id="327a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "*/10 * * * *"</strong></code>每10分钟运行一次。</p><p id="c323" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">重要提示(H "hash" magic keyword): </strong>如果您有许多使用触发器的作业<code class="fe ms mt mu mv b">cron "0 0 * * *"</code>，所有作业都将在午夜(00:00)开始。同时开始大量的工作会给Jenkins带来很大的压力，并可能导致失败。为了解决这种应变，我们可以使用<strong class="ka ir"> H </strong>符号。这个符号告诉Jenkins对给定的cron触发器使用散列模型。因此，为了解决我们的例子，我们应该使用<code class="fe ms mt mu mv b">cron "H H * * *"</code>而不是<code class="fe ms mt mu mv b">cron "0 0 * * *"</code>。这个cron将像前一个一样每天运行一次作业，但不是同时运行。</p><p id="67dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "H H * * *"</strong></code>每天运行一次。</p><p id="b53f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">cron "H H(0-4) * * *"</strong></code>运行时间为00:00至04:59(一次)。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a13a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">pollSCM</strong></code>接受cron风格的模式，并在项目版本控制系统中寻找源代码变更，例如Git。cron样式的模式用于定义所需的时间间隔。您应该注意到，它仅在从SCM源读取管道脚本时起作用。</p><p id="2775" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下触发器每10分钟检查一次源代码更改。如果检测到任何变化，管道将被触发。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f141" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">upstream</strong></code>接受上游项目的逗号分隔列表，当其中任何一个项目完成时，当前作业被触发。除了项目列表，你可以设置上游项目的期望状态，不稳定，失败等。<strong class="ka ir">默认</strong>为<strong class="ka ir">成功</strong>构建状态。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e6ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个关于阈值的示例:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4831" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">Hudson . model . result . aborted</strong>:构建被手动中止。</p><p id="479d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">Hudson . model . result . failure</strong>:构建出现致命错误。</p><p id="4724" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Hudson . model . result . success:构建没有错误。</p><p id="b9e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">Hudson . model . result . unstable</strong>:构建结果不稳定。</p><h1 id="5da7" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Jenkins通用Webhook触发器:</h1><p id="6f69" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">通用Webhook触发器是一个允许从webhook触发管道的插件。这个插件对于将Jenkins与SCM、脚本、小程序等外部应用程序集成非常有用。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="50ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">若要从命令行触发管道，请运行以下命令:</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="d7b8" class="ng lq iq mv b gy nh ni l nj nk">curl -i http://<strong class="mv ir">YOUR_JENKINS_URL</strong>/generic-webhook-trigger/invoke?token=<strong class="mv ir">unique-token-to-start-the-current-pipeline</strong></span></pre><p id="1ef7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要了解更多信息，请参见<a class="ae nl" href="https://plugins.jenkins.io/generic-webhook-trigger" rel="noopener ugc nofollow" target="_blank">插件</a>文档。</p><h1 id="14f7" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">一体化示例:</h1><p id="dabe" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">以下管道每10分钟检查一次源更改，并在检测到任何更改时运行。每一小时定期运行一次。当上游项目my-base-project成功构建时运行，并且可以由带有给定令牌的webhook触发。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="c358" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">结尾字母:</h1><p id="abe7" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">构建触发器对于自动化管道非常有帮助。通用的Webhook触发器是一个很棒的触发器，我将在后面详细解释。有了触发器，我们可以为我们的环境创建一个非凡的生命周期。您可以在下面的资源库中找到所有使用的示例。祝你好运。</p><p id="dfe6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae nl" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p><div class="kw kx gp gr ky kz"><a href="https://github.com/ssbostan/jenkins-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">GitHub-ssbo stan/jenkins-tutorial:完整的Jenkins教程，参考，牛逼，示例</h2><div class="lg l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如果你觉得有用，就看星星。Jenkins系列教程的参考和示例库。版权所有2021…</h3></div><div class="lh l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="li l"><div class="nm l lk ll lm li ln jw kz"/></div></div></a></div></div></div>    
</body>
</html>