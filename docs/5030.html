<html>
<head>
<title>Architecture for a startup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初创企业的架构</h1>
<blockquote>原文：<a href="https://itnext.io/architecture-for-a-startup-86651962bc99?source=collection_archive---------1-----------------------#2020-11-21">https://itnext.io/architecture-for-a-startup-86651962bc99?source=collection_archive---------1-----------------------#2020-11-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9b82c0e23f9c0245181b5b282af732b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DIzaRLhJPX4-IJxi"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@medbadrc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Med Badr Chemmaoui </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="b8ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我最近的工作中，我有机会为一家初创公司从头开始设计后端架构。这是探索和创建一个最小化、易于理解且安全的架构的时候了。我在个人项目中使用terraform和ansible已经有一段时间了。这是使用一切的最佳地点。我决定用这些工具从代码开始写一切。<a class="ae kc" href="https://medium.com/@mitesh_shamra/infrastructure-as-a-code-with-terraform-e7021bf28d7d" rel="noopener"> Terraform </a>作为代码用于基础设施<a class="ae kc" href="https://medium.com/@mitesh_shamra/introduction-to-ansible-e5b56ee76b8c" rel="noopener"> Ansible </a>作为配置管理。</p><p id="ddd7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在编写任何代码之前，第一件事就是设计一个可伸缩的系统，当初创公司成长为尤尼克隆时，这个系统可以扩展。经过大量的头脑风暴，我想出了下面的设计，这似乎是完美的考虑到这是一个启动，并会随着时间的推移而演变，所以需要灵活性，因为更多的组件将随着时间的推移而增加。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/6461a03f5ad816eb14c95b5d5eb20d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5y8hDXoZ23Ll_FQkH4g0Q.png"/></div></div></figure><p id="749e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将整个系统分成不同的模块:</p><ol class=""><li id="f49c" class="lg lh iq kf b kg kh kk kl ko li ks lj kw lk la ll lm ln lo bi translated">静态web应用:我们有一个静态网站，部署在S3上，使用S3提供的静态web托管功能。我在S3前面加了一个CloudFront CDN来更快的服务用户，因为CDN会缓存内容。所有域都通过Route53路由。</li><li id="7257" class="lg lh iq kf b kg lp kk lq ko lr ks ls kw lt la ll lm ln lo bi translated">后端生产系统:后端应用服务器部署在通过自动扩展组管理的EC2实例上。这个应用服务器使用Redis (AWS ElasticCache)进行数据缓存，使用MySQL (RDS)进行数据持久化。我对Mysql实例使用了主-从配置，其中从实例也用作任何数据相关需求的读取副本。应用层和数据层位于不同的私有子网中。没有从公共互联网到应用服务器和数据库的SSH访问。为了访问这些实例上的日志，我们在公共子网中添加了一个具有SSH访问权限的bastion主机，这是任何生产系统的单一入口点。Bastion主机被添加到一个单独的自动扩展组中，以防止对专用子网中关键系统的访问。私有子网内的实例通过NAT网关访问互联网，这有助于向外部服务发出请求。我使用ALB通过路由规则向应用服务器发出请求，使用<a class="ae kc" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> Cognito </a> (google auth)来保护一些管理API。</li><li id="a7f8" class="lg lh iq kf b kg lp kk lq ko lr ks ls kw lt la ll lm ln lo bi translated">分析系统:我们使用元数据库，通过MySql读取副本进行分析。Metabase是一款开源商业分析服务器。这被部署在应用子网中，并使用带有Cognito (google auth)的ALB来公开，以保持内部用户的访问安全。</li><li id="345b" class="lg lh iq kf b kg lp kk lq ko lr ks ls kw lt la ll lm ln lo bi translated">监控:我们使用NewRelic免费层来监控系统，并使用自托管的sentry服务器来捕捉所有服务器问题。Sentry对于捕捉应用程序运行时出现的后端错误非常有帮助。哨兵是部署在单独的管理VPC，因为这是相同的所有环境。</li><li id="6f4a" class="lg lh iq kf b kg lp kk lq ko lr ks ls kw lt la ll lm ln lo bi translated">部署:我们使用詹金斯进行部署。我试着使用其他工具，但和詹金斯在一起感觉很自在。总体理念是一次构建，随处部署。我们对每个部署都有两个任务，一个构建分支，另一个部署这个构建。这样，我们可以在任何环境中部署相同的版本。这是部署在管理VPC，这是用于常见的用例。</li></ol><p id="e416" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总的来说，我们的完整生产系统分为三层(公共层、应用程序层和数据层)，每层都有自己的子网，跨越一个区域中的两个可用性区域。我们将S3 VPC端点添加到我们的VPC中，这样就可以在所有情况下访问S3，而无需通过公共互联网。每个EC2实例都有一个附加的实例角色，可以访问AWS资源。</p><p id="609e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不想深入细节，因为每个组件都是不言自明的一个小谷歌搜索。我只是想给出一个架构设计的概述，任何初创公司都可以在考虑安全性的同时使用。一旦我们知道了系统的外观，使用terraform和ansible这样的工具创建它们就非常容易了。</p><p id="4f23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢<a class="lu lv ep" href="https://medium.com/u/61c0a24121f4?source=post_page-----86651962bc99--------------------------------" rel="noopener" target="_blank"> Devashish Meena </a>帮助完成这一设计。</p><p id="7fc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> <em class="lw"> PS:如果你喜欢这篇文章，请鼓掌支持</em> </strong>👏<strong class="kf ir"> <em class="lw">。欢呼</em> </strong></p></div></div>    
</body>
</html>