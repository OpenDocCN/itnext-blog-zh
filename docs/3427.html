<html>
<head>
<title>Serverless application development with Node.js on AWS platform using Serverless framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器框架在AWS平台上使用Node.js开发无服务器应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/serverless-application-development-with-node-js-on-aws-platform-using-serverless-framework-63e79fcf9409?source=collection_archive---------0-----------------------#2019-12-13">https://itnext.io/serverless-application-development-with-node-js-on-aws-platform-using-serverless-framework-63e79fcf9409?source=collection_archive---------0-----------------------#2019-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="0480" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本教程中，我们将使用各种<strong class="jw ir"> AWS服务</strong>在<strong class="jw ir"> AWS </strong>平台上<strong class="jw ir">创建和部署一个无服务器Node.js应用程序</strong>，例如使用<a class="ae ks" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">无服务器框架</strong> </a>的<strong class="jw ir"> Lambda </strong>、<strong class="jw ir">层</strong>、<strong class="jw ir"> DynamoDB </strong>、<strong class="jw ir"> API网关</strong>。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/26f472a360964cb146fad198bce491fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FE3KE3VOqec44eXbmWFBzw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">来源:<a class="ae ks" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">http://serverless.com</a></figcaption></figure><p id="c490" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们先安装无服务器框架。</p><pre class="ku kv kw kx gt lj lk ll lm aw ln bi"><span id="d14d" class="lo lp iq lk b gy lq lr l ls lt">sudo npm install -g serverless</span></pre><p id="1082" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装完成后，<strong class="jw ir">您需要配置您的AWS凭证</strong>。您可以在下面找到所需的信息:</p><div class="lu lv gp gr lw lx"><a href="https://serverless.com/framework/docs/providers/aws/guide/credentials/" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">无服务器框架— AWS Lambda指南—凭据</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">无服务器框架需要访问您的云提供商帐户，以便能够在您的上创建和管理资源…</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">serverless.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ld lx"/></div></div></a></div><p id="ec77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我会选择<code class="fe mm mn mo lk b">aws configure</code>来保持简单，但是我强烈建议你使用<em class="mp">IAM roles</em>T37】来代替。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/27eb3b132fac71de36b872c44997cdd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*gI3Zqq2bQnT4lP7Wwum9Ww.png"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">AWS SDK配置</figcaption></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="5832" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成配置后，您可以使用以下命令测试无服务器框架。</p><p id="fb89" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用<code class="fe mm mn mo lk b">aws-nodejs</code>模板创建新服务:</p><pre class="ku kv kw kx gt lj lk ll lm aw ln bi"><span id="27b5" class="lo lp iq lk b gy lq lr l ls lt">sls create --template aws-nodejs --path myService</span></pre><p id="f4c0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">无服务器CLI将为您创建一个空的<code class="fe mm mn mo lk b">hello world</code>服务，带有<code class="fe mm mn mo lk b">serverless.yml</code>和<code class="fe mm mn mo lk b">handler.js</code>，您可以使用它们来测试您的<code class="fe mm mn mo lk b">serverless</code>配置。</p><p id="4dac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们要做的是从头开始创建一个无服务器应用程序，并将其部署到AWS平台。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="be19" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，在项目目录的根目录下创建<code class="fe mm mn mo lk b">serverless.yml</code>文件。</p><p id="2511" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们开始配置无服务器应用程序。</p><p id="0031" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe mm mn mo lk b">serverless.yml</code>文件的这一部分，我们定义了我们将要使用的服务和提供者资源。在我们的例子中，提供者是AWS。</p><p id="5c77" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将下列行添加到<code class="fe mm mn mo lk b">serverless.yml</code>文件中。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="2640" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们在<code class="fe mm mn mo lk b">dev</code>阶段配置了我们的服务，并且<strong class="jw ir">分配了访问<code class="fe mm mn mo lk b">messages</code> DynamoDB表所需的权限</strong>;因此，我们需要创建<code class="fe mm mn mo lk b">messages</code>表。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="7a3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在是时候<strong class="jw ir">创建我们的Lambda函数</strong>了。</p><p id="85be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在项目目录的根目录下创建一个<code class="fe mm mn mo lk b">functions</code>目录，并将以下JavaScript文件放入其中。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">getMessages.js</figcaption></figure><p id="ded2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe mm mn mo lk b">getMessages</code> Lambda函数将允许我们<strong class="jw ir">从我们的DynamoDB表中检索消息。</strong></p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">putMessage.js</figcaption></figure><p id="7246" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><code class="fe mm mn mo lk b">putMessage</code> Lambda函数将让我们<strong class="jw ir">把消息放到我们的DynamoDB表中。</strong></p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="ef44" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们准备在<code class="fe mm mn mo lk b">serverless.yml</code>文件中配置我们的Lambda函数。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="43f6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们配置了我们的函数处理程序，并使用API Gateway将它们连接到HTTP端点。</p><p id="6f22" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可能注意到了，我们在应用程序中引用了我们的层。</p><blockquote class="mt mu mv"><p id="9a5a" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><strong class="jw ir">来自AWS文档:</strong></p><p id="4026" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><strong class="jw ir">层</strong>是包含库、<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" rel="noopener ugc nofollow" target="_blank">自定义运行时</a>或其他依赖项的ZIP存档。<strong class="jw ir">有了层，您可以在您的函数中使用库，而不需要将它们包含在您的部署包中。</strong></p><p id="bfd4" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><strong class="jw ir">关于图层的重要提示:</strong></p><p id="e263" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated">您的功能可以在 <code class="fe mm mn mo lk b"><strong class="jw ir">/opt</strong></code> <strong class="jw ir">目录</strong>中访问执行期间该层的内容。图层按指定的顺序应用，合并任何同名的文件夹。如果同一文件出现在多个图层中，则使用最后一个应用图层中的版本。</p><p id="d130" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/lambda/last/DG/configuration-layers . html</a></p></blockquote><p id="c309" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在是时候配置我们的图层了。</p><p id="ab0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在项目目录的根目录下创建<code class="fe mm mn mo lk b">layers/reverser</code>目录，并将下面的JavaScript文件放入其中。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="7b18" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这只是一个<strong class="jw ir">简单的JavaScript模块，用来反转我们将用来测试我们的层实现的输入字符串</strong>。</p><p id="1ffe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们在<code class="fe mm mn mo lk b">serverless.yml</code>文件中添加以下几行来配置我们刚刚创建的<code class="fe mm mn mo lk b">Reverser</code>层。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mr ms l"/></div></figure><blockquote class="mt mu mv"><p id="537d" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><strong class="jw ir">来自AWS文档的重要提示:</strong></p><p id="389a" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated">一个功能<strong class="jw ir">一次最多可以使用5层</strong>。功能和所有层的总解压缩大小<strong class="jw ir">不能超过</strong>250 MB的解压缩部署包大小<strong class="jw ir">限制</strong>。更多信息参见<a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/limits.html" rel="noopener ugc nofollow" target="_blank"> AWS Lambda Limits </a>。</p><p id="28c1" class="ju jv mp jw b jx jy jz ka kb kc kd ke mw kg kh ki mx kk kl km my ko kp kq kr ij bi translated"><a class="ae ks" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/lambda/latest/DG/configuration-layers . html</a></p></blockquote><p id="69a5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后，<strong class="jw ir">通过在终端中执行以下命令，我们已经准备好将无服务器应用程序</strong>部署到AWS平台。</p><pre class="ku kv kw kx gt lj lk ll lm aw ln bi"><span id="a949" class="lo lp iq lk b gy lq lr l ls lt">sls deploy</span></pre><p id="c7b8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为该执行的结果，您应该会看到类似于下面的屏幕。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi mz"><img src="../Images/711c4d79f7026d281099af2524b2c50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfGfcHO9_Kjr5Ki2FV3GxA.png"/></div></div></figure><p id="72c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了测试你的应用程序，你可以使用<strong class="jw ir">你的</strong> <code class="fe mm mn mo lk b">sls deploy</code>的输出中声明的端点，或者你可以在你的项目的根目录中用<code class="fe mm mn mo lk b">sls</code>CLI<strong class="jw ir">调用你的Lambda函数</strong>。</p><p id="aae2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们用<code class="fe mm mn mo lk b">sls</code> CLI试试。</p><pre class="ku kv kw kx gt lj lk ll lm aw ln bi"><span id="98f0" class="lo lp iq lk b gy lq lr l ls lt">sls invoke -f putMessage --data '{"message":"test message"}'</span></pre><p id="4f93" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">结果应该如下所示:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi na"><img src="../Images/5adf5c4019baa06ab45bda4999d4687e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fW3K1-TaA-IIxLUzyzbOGg.png"/></div></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="18fc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，让我们试着获取放入<code class="fe mm mn mo lk b">messages</code>表的消息。</p><pre class="ku kv kw kx gt lj lk ll lm aw ln bi"><span id="a67f" class="lo lp iq lk b gy lq lr l ls lt">sls invoke -f getMessage</span></pre><p id="8c65" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">结果应该如下所示:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ce72eeb756cb0b81801270d981ab034a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*GZiIG3tu6DrpUVVV_Bm12g.png"/></div></figure></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="c910" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，您可以在<strong class="jw ir"> AWS控制台</strong>上的DynamoDB表中看到您的消息<strong class="jw ir">。</strong></p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi nc"><img src="../Images/0e5f12655f2c369163998359f8a58788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GuM7K-6YmHdc8YWa2umlsA.png"/></div></div></figure><p id="9a2b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">字符串反向模块工作正常，表中的消息似乎是反向的。</p></div><div class="ab cl jn jo hu jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ij ik il im in"><p id="e1e7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以在下面的<a class="ae ks" href="https://github.com/gkhn/ServerlessAppWithLayers" rel="noopener ugc nofollow" target="_blank"> Github资源库</a>中找到包含本教程中使用的文件的项目。</p><div class="lu lv gp gr lw lx"><a href="https://github.com/gkhn/ServerlessAppWithLayers" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd ir gy z fp mc fr fs md fu fw ip bi translated">gkhn/ServerlessAppWithLayers</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">演示使用AWS API Gateway、Lambda、Layers和DynamoDB构建的无服务器应用程序</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">github.com</p></div></div><div class="mg l"><div class="nd l mi mj mk mg ml ld lx"/></div></div></a></div></div></div>    
</body>
</html>