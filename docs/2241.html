<html>
<head>
<title>AWS Elastic Beanstalk — Setting up a Mysql datasource with Glassfish preconfigured docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS Elastic Beanstalk —使用Glassfish预配置的docker设置Mysql数据源</h1>
<blockquote>原文：<a href="https://itnext.io/aws-elastic-beanstalk-setting-up-a-mysql-datasource-with-glassfish-preconfigured-docker-d8d91cdcfe62?source=collection_archive---------2-----------------------#2019-04-22">https://itnext.io/aws-elastic-beanstalk-setting-up-a-mysql-datasource-with-glassfish-preconfigured-docker-d8d91cdcfe62?source=collection_archive---------2-----------------------#2019-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/022cefed4e48c1e28b686d73cdaa1d03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9pQvj1UAqt8CAeMpsmjmw.jpeg"/></div></div></figure><p id="f028" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您愿意将java web应用程序部署到AWS，而不必处理基础设施配置，那么您可能会考虑使用Elastic Beanstalk来实现这一点。Amazon Elastic Beanstalk服务提供了两个预配置的java web应用程序平台供选择，一个是Tomcat自带的，另一个是Glassfish自带的。如果您想使用Glassfish，这篇文章可能对您有用。</p><p id="d7c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Glassfish平台是使用docker设置的，因此，如果您需要在您的环境中做进一步的配置，比如添加JDBC连接，那么docker文件将是定制基本映像所必需的。也就是说，让我们开始展示在Glassfish Elastic Beanstalk平台上设置Mysql数据源所需的步骤。</p><p id="d7e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，我们要做的是使用下面的命令编写一个docker文件:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="4975" class="lf lg iq lb b gy lh li l lj lk"># Use the AWS Elastic Beanstalk Glassfish image<br/>FROM        amazon/aws-eb-glassfish:5.0-al-onbuild-2.11.1</span><span id="4164" class="lf lg iq lb b gy ll li l lj lk"># Exposes port 8080<br/>EXPOSE      8080</span><span id="53e5" class="lf lg iq lb b gy ll li l lj lk"># Install Datasource dependencies and configure datasource in Glassfish<br/>RUN         curl -L -o /usr/local/glassfish5/glassfish/domains/domain1/lib/mysql-connector-java-8.0.13.jar <a class="ae lm" href="http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar" rel="noopener ugc nofollow" target="_blank">http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar</a> &amp;&amp; \<br/>            asadmin start-domain domain1 &amp;&amp; \<br/>            asadmin create-jdbc-connection-pool --datasourceclassname com.mysql.cj.jdbc.MysqlDataSource --restype javax.sql.DataSource --property user=your_username:password=your_password:serverName=your_server_name:portNumber=3306:databaseName=ebdb:useSSL=false MysqlConnPool &amp;&amp; \<br/>            asadmin create-jdbc-resource --connectionpoolid MysqlConnPool jdbc/your_jdni</span></pre><p id="104c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我会试着解释文件的每一部分。</p><p id="526e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们有一个FROM部分，它是必需的，定义了将用于构建定制docker容器映像的基础映像。你可以在这里找到你正在使用的平台的基础镜像名:h<a class="ae lm" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/platforms/platforms-supported.html#platforms-supported.dockerpreconfig" rel="noopener ugc nofollow" target="_blank">ttps://docs . AWS . Amazon . com/elastic beanstalk/latest/platforms/platforms-supported . html # platforms-supported . docker preconfig</a>。</p><p id="4989" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于这个例子，我们使用“Amazon/AWS-e b-glassfish:5.0-al-onbuild-2 . 11 . 1”图像。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="d207" class="lf lg iq lb b gy lh li l lj lk"># Use the AWS Elastic Beanstalk Glassfish image<br/>FROM        amazon/aws-eb-glassfish:5.0-al-onbuild-2.11.1</span></pre><p id="9e34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，我们有包含一个或多个端口号的EXPOSE部分。Elastic Beanstalk使用此端口在主机和docker容器之间建立连接，因此可以路由公共internet请求。对于Glassfish，我们需要使用8080。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0ceb" class="lf lg iq lb b gy lh li l lj lk"># Exposes port 8080<br/>EXPOSE      8080</span></pre><p id="7e6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们在这篇文章中有我们想要做的最重要的部分。跑步部分。在这里，我们可以发出命令，根据需要定制预配置的映像。请注意，每个命令都需要用字符串“&amp;&amp;”分隔。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="a288" class="lf lg iq lb b gy lh li l lj lk"># Install Datasource dependencies and configure datasource in Glassfish<br/>RUN         curl -L -o /usr/local/glassfish5/glassfish/domains/domain1/lib/mysql-connector-java-8.0.13.jar <a class="ae lm" href="http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar" rel="noopener ugc nofollow" target="_blank">http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar</a> &amp;&amp; \<br/>            asadmin start-domain domain1 &amp;&amp; \<br/>            asadmin create-jdbc-connection-pool --datasourceclassname com.mysql.cj.jdbc.MysqlDataSource --restype javax.sql.DataSource --property user=your_username:password=your_password:serverName=your_server_name:portNumber=3306:databaseName=ebdb:useSSL=false MysqlConnPool &amp;&amp; \<br/>            asadmin create-jdbc-resource --connectionpoolid MysqlConnPool jdbc/your_jdni</span></pre><p id="30e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们一个命令一个命令地看看Docker文件在做什么。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="425c" class="lf lg iq lb b gy lh li l lj lk">curl -L -o /usr/local/glassfish5/glassfish/domains/domain1/lib/mysql-connector-java-8.0.13.jar <a class="ae lm" href="http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar" rel="noopener ugc nofollow" target="_blank">http://central.maven.org/maven2/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar</a></span></pre><p id="c201" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码片段中，我们使用curl将mysql jdbc连接器从maven资源库下载到Glassfish lib文件夹。我们将需要它来设置我们的数据源。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="2223" class="lf lg iq lb b gy lh li l lj lk">asadmin start-domain domain1</span></pre><p id="5765" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在lib下载之后，我们调用asadmin，glassfish命令行工具，使用start-domain启动由弹性Beanstalk映像配置的默认域，该域称为“domain1”。</p><p id="a58d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的命令中，我们使用create-jdbc-connection-pool命令在glassfish中为应用程序创建一个jdbc连接池。我们需要在这里传递一些参数:</p><ul class=""><li id="7f86" class="ln lo iq ka b kb kc kf kg kj lp kn lq kr lr kv ls lt lu lv bi translated">data source class name:Mysql lib中数据源的类名。在本例中为“com . MySQL . CJ . JDBC . MySQL data source”</li><li id="3792" class="ln lo iq ka b kb lw kf lx kj ly kn lz kr ma kv ls lt lu lv bi translated">restype:连接池资源类型。在本例中是“javax.sql.DataSource”</li><li id="1237" class="ln lo iq ka b kb lw kf lx kj ly kn lz kr ma kv ls lt lu lv bi translated">属性:数据库特定的属性，如用户、密码、端口号、数据库名称。在我的例子中，我需要用useSSL=false禁用SSL。这是可选的。所有属性都用冒号分隔。</li></ul><p id="54c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在命令的末尾，我们提供了连接池的名称。这里的名称被设置为“MysqlConnPool”。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="921a" class="lf lg iq lb b gy lh li l lj lk">asadmin create-jdbc-connection-pool --datasourceclassname com.mysql.cj.jdbc.MysqlDataSource --restype javax.sql.DataSource --property user=your_username:password=your_password:serverName=your_server_name:portNumber=3306:databaseName=ebdb:useSSL=false MysqlConnPool</span></pre><p id="106c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了完成文件内容，我们使用了create-jdbc-resource命令，该命令用于配置与之前通过参数connectionpoolid创建的连接池相关联的JNDI资源。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="675f" class="lf lg iq lb b gy lh li l lj lk">asadmin create-jdbc-resource --connectionpoolid MysqlConnPool jdbc/your_jdni</span></pre><p id="cf42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在命令的最后一部分，我们给资源命名。在本例中是“jdbc/your_jdni”。</p><p id="28ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，准备好Dockerfile后，您所要做的就是将其命名为“Dockerfile ”,并将其打包到war文件的顶层目录结构中。如果一切正常，那么当您将war文件部署到服务器时，配置就会发生。</p><p id="548b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢你的阅读。:)</p></div></div>    
</body>
</html>