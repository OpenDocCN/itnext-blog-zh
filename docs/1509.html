<html>
<head>
<title>Redux middleware compatible React Hooks library for easy global state management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux中间件兼容React Hooks库，便于全局状态管理</h1>
<blockquote>原文：<a href="https://itnext.io/redux-middleware-compatible-react-hooks-library-for-easy-global-state-management-4fe73623e69e?source=collection_archive---------4-----------------------#2018-11-06">https://itnext.io/redux-middleware-compatible-react-hooks-library-for-easy-global-state-management-4fe73623e69e?source=collection_archive---------4-----------------------#2018-11-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="02e2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">React钩子很牛逼。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/277bb8d8a19043b0a4718a2a739f3c58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEcgn01UG23TqT1gSbz82w.png"/></div></div></figure><h2 id="9607" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">图书馆</h2><p id="7a49" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">我一直在开发一个库来利用React Hooks API。这个库是用于全局状态管理的，目的是用它来代替Redux，特别是对于较小的应用程序。有关更多信息和源代码，请参见资源库。</p><div class="ly lz gp gr ma mb"><a href="https://github.com/dai-shi/react-hooks-global-state" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">戴式/反应钩式-全局-状态</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">钩子API反应的简单全局状态。通过创造一个新的世界，为Dai-Shi/react-hooks-global-state的发展作出贡献</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp ky mb"/></div></div></a></div><p id="6e4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也请看看我以前的帖子[ <a class="ae mq" rel="noopener ugc nofollow" target="_blank" href="/typescript-aware-react-hooks-for-global-state-b6e2dfc0e9a7"> 1 </a> ] [ <a class="ae mq" rel="noopener ugc nofollow" target="_blank" href="/an-alternative-to-react-redux-by-react-hooks-api-for-both-javascript-and-typescript-c5e9a351ba0b"> 2 </a>。</p><h2 id="0633" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">支持Redux中间件</h2><p id="1dd4" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">最初，该库扩展了全局状态的useState。后来，减速器得到了支持。现在，增加了中间件支持。下面是工作示例中的代码片段，用来说明如何使用它。</p><p id="4d9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们从我们的库中导入<code class="fe mr ms mt mu b">createStore</code>,从Redux中导入两个助手。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="c962" class="la lb it mu b gy mz na l nb nc">import { createStore } from 'react-hooks-global-state';<br/>import { applyMiddleware, combineReducers } from 'redux';</span></pre><p id="15de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后我们定义初始状态。注意，初始状态在我们的库中是强制的，而在Redux中是可选的。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="6b0e" class="la lb it mu b gy mz na l nb nc">const initialState = {<br/>  counter: 0,<br/>  person: {<br/>    age: 0,<br/>    firstName: '',<br/>    lastName: '',<br/>  },<br/>};</span></pre><p id="bdb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们为每个状态项定义了两个归约器(<code class="fe mr ms mt mu b">counter</code>和<code class="fe mr ms mt mu b">person</code>)。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="95ff" class="la lb it mu b gy mz na l nb nc">const counterReducer = (state = initialState.counter, action) =&gt; {<br/>  switch (action.type) {<br/>    case 'increment': return state + 1;<br/>    case 'decrement': return state - 1;<br/>    default: return state;<br/>  }<br/>};</span><span id="a48b" class="la lb it mu b gy nd na l nb nc">const personReducer = (state = initialState.person, action) =&gt; {<br/>  switch (action.type) {<br/>    case 'setFirstName': return {<br/>      ...state,<br/>      firstName: action.firstName,<br/>    };<br/>    case 'setLastName': return {<br/>      ...state,<br/>      lastName: action.lastName,<br/>    };<br/>    case 'setAge': return {<br/>      ...state,<br/>      age: action.age,<br/>    };<br/>    default: return state;<br/>  }<br/>};</span></pre><p id="fc04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，用<code class="fe mr ms mt mu b">combineReducers</code>把它们组合起来。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="626a" class="la lb it mu b gy mz na l nb nc">const reducer = combineReducers({<br/>  counter: counterReducer,<br/>  person: personReducer,<br/>});</span></pre><p id="f19e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们定义了来自Redux文档的日志中间件。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="e400" class="la lb it mu b gy mz na l nb nc">const logger = ({ getState }) =&gt; next =&gt; (action) =&gt; {<br/>  console.log('will dispatch', action);<br/>  const returnValue = next(action);<br/>  console.log('state after dispatch', getState());<br/>  return returnValue;<br/>};</span></pre><p id="b182" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们根据上面定义的内容创建一个商店，并导出结果函数。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="8fb2" class="la lb it mu b gy mz na l nb nc">export const { GlobalStateProvider, dispatch, useGlobalState } = createStore(<br/>  reducer,<br/>  initialState,<br/>  applyMiddleware(logger),<br/>);</span></pre><p id="afb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，计数器组件的实现如下。</p><pre class="kp kq kr ks gt mv mu mw mx aw my bi"><span id="c817" class="la lb it mu b gy mz na l nb nc">const Counter = () =&gt; {<br/>  const [value] = useGlobalState('counter');<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;span&gt;Count: {value}&lt;/span&gt;<br/>      &lt;button<br/>        type="button"<br/>        onClick={() =&gt; dispatch({ type: 'increment' })}<br/>      &gt;<br/>        Increment<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><h2 id="ede9" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">TypeScript中的完整示例代码</h2><p id="be57" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">您可以在<a class="ae mq" href="https://github.com/dai-shi/react-hooks-global-state/tree/master/examples/07_middleware" rel="noopener ugc nofollow" target="_blank">库</a>中看到完整的示例代码。它是用TypeScript编写的，但是JavaScript开发人员可以通过忽略类型定义(<code class="fe mr ms mt mu b">type Foo = ...;</code>)和类型注释(<code class="fe mr ms mt mu b">: Foo</code>就在变量后面)来阅读它。</p><h2 id="eb20" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">这是可行的，但是还需要更多的实验</h2><p id="a846" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">据我所知，日志中间件工作正常。我还没有尝试过其他的中间件。特别是，应该尝试异步库。如果有人对尝试其他中间件感兴趣，我很乐意帮忙。</p><h2 id="ff36" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">最后一点</h2><p id="3bb5" class="pw-post-body-paragraph jq jr it js b jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn im bi translated">引入钩子API的React 16.7还没有发布。在正式发布之前，任何依赖钩子的东西都应该是实验性的。但是，无论如何你都要试一试。</p><h2 id="394e" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">变更日志</h2><ul class=""><li id="95c9" class="ne nf it js b jt lt jx lu kb ng kf nh kj ni kn nj nk nl nm bi translated"><em class="nn">【2018–11–07】:首次发布。</em></li><li id="02f0" class="ne nf it js b jt no jx np kb nq kf nr kj ns kn nj nk nl nm bi translated"><em class="nn">【2018–11–08】:跟随库API变化，让例子更直观。</em></li><li id="707b" class="ne nf it js b jt no jx np kb nq kf nr kj ns kn nj nk nl nm bi translated"><em class="nn">【2018–11–12】:基于上下文API再次改变库API。</em></li></ul></div></div>    
</body>
</html>