<html>
<head>
<title>On Updating Dependencies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于更新依赖关系</h1>
<blockquote>原文：<a href="https://itnext.io/on-updating-dependencies-d298f2509af5?source=collection_archive---------3-----------------------#2020-12-12">https://itnext.io/on-updating-dependencies-d298f2509af5?source=collection_archive---------3-----------------------#2020-12-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="8846" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">以及开源的互联网络。</h1><p id="6e6e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这不是另一个谈论开源代码中有多少CVE(<a class="ae lj" href="https://www.coreinfrastructure.org/programs/census-program-ii/" rel="noopener ugc nofollow" target="_blank">很多</a>)或者CVE系统有多难用(<a class="ae lj" href="https://www.csoonline.com/article/3444496/autonomy-and-the-death-of-cves.html" rel="noopener ugc nofollow" target="_blank">非常</a>)的帖子。它也不是关于维护人员如何低薪超负荷工作(<a class="ae lj" href="http://antirez.com/news/129" rel="noopener ugc nofollow" target="_blank">令人沮丧地如此</a>)，尽管它确实触及了这些话题。这是一个关于更新依赖关系的另一个原因的帖子，一个我刚刚意识到的原因。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/3ba766ad4956a4ac9bae2b6bcf7c9868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*DDGhHbYB-ddGUJnT"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">为什么不呢？只需要一分钟…</figcaption></figure><p id="11ef" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我正在使用snyk CLI查看我的一些代码库中的CVE。我有一些空闲时间，想看看能不能修几个。我从tek ton<a class="ae lj" href="http://tekton.dev" rel="noopener ugc nofollow" target="_blank">开始，这是一个我帮助维护的项目。运行snyk显示了一个高严重性漏洞！</a></p><pre class="ll lm ln lo gt mb mc md me aw mf bi"><span id="aa8c" class="mg jo iq mc b gy mh mi l mj mk">$ snyk test</span><span id="b656" class="mg jo iq mc b gy ml mi l mj mk">Testing /Users/dlorenc/go/src/github.com/tektoncd/pipeline…</span><span id="47b5" class="mg jo iq mc b gy ml mi l mj mk">✗ High severity vulnerability found in github.com/dgrijalva/jwt-go</span></pre><p id="88ea" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">不知何故，我记得在Twitter上听说过这个问题，并决定尝试修复它，看看会发生什么。我不认为JSON Web令牌在Tekton中的任何地方都被使用过，所以这可能不会影响我们的代码，但是让红色x消失也无妨。</p><p id="c5c5" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我真的不知道这种依赖性从何而来，也不知道如何着手解决这个问题。<a class="ae lj" href="https://blog.golang.org/migrating-to-go-modules" rel="noopener ugc nofollow" target="_blank"> Go modules </a>附带了一个很好的工具来解释你的依赖树，所以我尝试了一下，并且能够快速地追踪到依赖来自我代码中的什么地方。</p><pre class="ll lm ln lo gt mb mc md me aw mf bi"><span id="57d7" class="mg jo iq mc b gy mh mi l mj mk">$ go mod why github.com/dgrijalva/jwt-go<br/># github.com/dgrijalva/jwt-go</span><span id="8805" class="mg jo iq mc b gy ml mi l mj mk">github.com/tektoncd/pipeline/pkg/pod<br/>github.com/google/go-containerregistry/pkg/authn/k8schain<br/>github.com/vdemeester/k8s-pkg-credentialprovider/azure<br/>github.com/Azure/go-autorest/autorest/adal<br/>github.com/dgrijalva/jwt-go</span></pre><p id="a3b2" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">在这种情况下，它是一个间接依赖，所以我不能通过直接更新来修复它。我需要用它来更新东西。我浏览了一下软件包repo，看看修复了什么，是否可以更新一下，然后我碰到了开源中最可悲的事情之一——一个被放弃的项目。一个<a class="ae lj" href="https://github.com/dgrijalva/jwt-go/issues/428" rel="noopener ugc nofollow" target="_blank">修复</a>已经等待了一段时间，但是没有人来合并它:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/465d1662264ec780425a59d3f388519a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_rmrZxa78wfHKayrV-USDQ.png"/></div></div></figure><p id="4e87" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">这对维护者来说是悲哀的，对依赖这个库的人来说也是悲哀的——总的来说是悲哀的。这是另一个更大的讨论主题，我会在其他时间写。从阅读关于公关/问题的讨论中，看起来有一些分叉，但没有一个明确的替代物。我在<a class="ae lj" href="http://github.com/azure/go-autorest" rel="noopener ugc nofollow" target="_blank"> Azure/go-autorest </a>库中看到了一个问题的参考，这是我列表中的下一个问题:</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mr"><img src="../Images/ebc23cb06b37ab5dbcb34309aca4182c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zQ-nEqDt5AxW6cPS"/></div></div></figure><p id="d5c5" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我在那里跳起来，看到他们能够通过用一个<a class="ae lj" href="https://github.com/form3tech-oss/jwt-go" rel="noopener ugc nofollow" target="_blank">分支</a>替换这种依赖性来前进。对我来说是个好消息！我只需要将更新后的Azure/go-autorest库放入我的树中。接下来是<a class="ae lj" href="https://twitter.com/vdemeest" rel="noopener ugc nofollow" target="_blank">文森特·德米斯特</a>的<a class="ae lj" href="https://github.com/vdemeester/k8s-pkg-credentialprovider" rel="noopener ugc nofollow" target="_blank">k8s-pkg-凭证提供者</a>图书馆。我对这些代码非常熟悉，所以我很有信心，如果他还没有修复的话，我也能修复。我早该知道的，当然文森特几个月前就已经说过了。他是台机器！</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ms"><img src="../Images/2cee14b04264366c09d1e1c320bb5957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XjQDdircUSSVUo-h"/></div></div></figure><p id="8806" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">好了，现在我们开始我维护的代码。名单上的下一个是google/go-containerregistry 。我开始感觉有点糟糕——我没有足够密切地注意到这个多少被广泛使用的<a class="ae lj" href="https://pkg.go.dev/github.com/google/go-containerregistry/pkg/name" rel="noopener ugc nofollow" target="_blank">库(200多个导入)被标记为高严重性漏洞。幸运的是，网上一个善良的陌生人(感谢</a><a class="ae lj" href="https://twitter.com/markusthoemmes" rel="noopener ugc nofollow" target="_blank">马库斯·托姆斯</a>！)已经<a class="ae lj" href="https://github.com/google/go-containerregistry/pull/787" rel="noopener ugc nofollow" target="_blank">处理好</a>了，我的共同维护者<a class="ae lj" href="https://twitter.com/imjasonh" rel="noopener ugc nofollow" target="_blank">杰森·霍尔</a>和<a class="ae lj" href="https://twitter.com/mattomata" rel="noopener ugc nofollow" target="_blank">马特·摩尔</a>已经把它合并了。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mt"><img src="../Images/08490d633fe86e432154adceee4ed027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sQ640FNToMLacJSS"/></div></div></figure><p id="3d24" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">所以我所要做的就是在泰克顿应用补丁。一次快速的<a class="ae lj" href="https://github.com/tektoncd/pipeline/pull/3628" rel="noopener ugc nofollow" target="_blank">公关</a>(然后花了几天时间调试和修复新<a class="ae lj" href="https://github.com/tektoncd/pipeline/pull/3629" rel="noopener ugc nofollow" target="_blank"/>未能通过<a class="ae lj" href="https://github.com/tektoncd/pipeline/pull/3632" rel="noopener ugc nofollow" target="_blank">测试</a>)让我开始做生意。在这一点上，我真的只是出于某种模糊的动机去实际修复一些东西，尽管我不认为这个漏洞真的影响了Tekton。其他任何一周，我可能会停下来，或者被一些重要的事情分心。</p><p id="0c0a" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">也许这只是我想出了花这么多时间修复一个可能不相关的CVE警告的事后合理化，但我说服自己这根本不是浪费时间。我刚刚解除了依赖图中的下一组项目(很可能是我负责的更多项目，抱歉是互联网……)的更新和修复。他们甚至可能以不同的方式使用依赖关系，导致CVE影响他们！</p><p id="4b74" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我并没有假装我在这里做了大量的社区服务，但它确实让我意识到，一旦你发布了供他人重用的代码，你就成为了更大的开源图的一部分。</p><p id="b14a" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">在这个网络中，做一个负责任的公民需要跟上时代，接受变化，即使这些变化与你的代码无关。</p><p id="9cf6" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我很高兴看到所有新的自动化工作在开源世界中起飞，使这变得更容易和更快。<a class="ae lj" href="https://dependabot.com/" rel="noopener ugc nofollow" target="_blank">依赖机器人</a>公关是可怕的。CI服务使合并这些PRs变得更容易，风险更低。<strong class="kn ir">更快、更频繁的更新使得更新更快更容易。</strong></p><p id="ed94" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">我的同事<a class="ae lj" href="http://twitter.com/drdavidawheeler" rel="noopener ugc nofollow" target="_blank"> David Wheeler </a>最近和我分享了<a class="ae lj" href="https://libyear.com/" rel="noopener ugc nofollow" target="_blank"> libyear </a>指标，我真的很喜欢。Libyears反映了一种几乎看得见摸得着的方法来衡量一棵依赖树到底有多老。令我兴奋的是，我们甚至可以随着时间的推移来跟踪这一点，看看像<a class="ae lj" href="https://dependabot.com/" rel="noopener ugc nofollow" target="_blank">dependent bot</a>和其他工具对降低整个语言生态系统的寿命有何影响！</p><p id="ec3a" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">也许真正的CVE修复是我们一路上结交的朋友？</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="7f15" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">如果你对这些话题感兴趣，来和我一起努力为每个人改善开源的状态吧！我与<a class="ae lj" href="http://cd.foundation" rel="noopener ugc nofollow" target="_blank"> CDF </a>合作，让发布安全软件变得更加容易和安全；与<a class="ae lj" href="http://openssf.org" rel="noopener ugc nofollow" target="_blank"> OpenSSF </a>合作，提高我们都依赖的关键开源软件的安全性；当我想玩yaml和cats时，与<a class="ae lj" href="http://tek" rel="noopener ugc nofollow" target="_blank"> Tekton </a>项目合作。</p><p id="086b" class="pw-post-body-paragraph kl km iq kn b ko lw kq kr ks lx ku kv kw ly ky kz la lz lc ld le ma lg lh li ij bi translated">特别感谢:</p><ul class=""><li id="1898" class="nc nd iq kn b ko lw ks lx kw ne la nf le ng li nh ni nj nk bi translated">戴夫·格里贾尔瓦(Dave Grijalva)费力不讨好地让这么多人用了这么长时间的图书馆。</li><li id="a604" class="nc nd iq kn b ko nl ks nm kw nn la no le np li nh ni nj nk bi translated"><a class="ae lj" href="https://github.com/form3tech-oss" rel="noopener ugc nofollow" target="_blank"> Form3.tech </a>这么快就准备好替换库。</li><li id="c738" class="nc nd iq kn b ko nl ks nm kw nn la no le np li nh ni nj nk bi translated">azure/go-autorest的维护者、<a class="ae lj" href="https://twitter.com/vdemeest" rel="noopener ugc nofollow" target="_blank"> Vincent Demeester </a>、<a class="ae lj" href="https://twitter.com/markusthoemmes" rel="noopener ugc nofollow" target="_blank">Markus th Mme</a>、杰森·霍尔和<a class="ae lj" href="http://twitter.com/mattomata" rel="noopener ugc nofollow" target="_blank"> Matt Moore </a>在整个go模块生态系统中快速应用了这个补丁。</li><li id="06a8" class="nc nd iq kn b ko nl ks nm kw nn la no le np li nh ni nj nk bi translated">当然，还有我一路使用或接触过其代码的所有人！</li></ul></div></div>    
</body>
</html>