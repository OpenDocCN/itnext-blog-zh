<html>
<head>
<title>Face Detector with VisionKit and SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带VisionKit和SwiftUI的人脸检测器</h1>
<blockquote>原文：<a href="https://itnext.io/face-detector-with-visionkit-and-swiftui-fc4fe18542e8?source=collection_archive---------1-----------------------#2022-02-18">https://itnext.io/face-detector-with-visionkit-and-swiftui-fc4fe18542e8?source=collection_archive---------1-----------------------#2022-02-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73ea" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">实时检测和跟踪人脸和人脸标志</h2></div><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/85724893171e3b1743ee8e5c7c396ddb.png" data-original-src="https://miro.medium.com/v2/format:webp/1*_viqYtnkIWM0RZ7x02EBCw.png"/></div></figure><p id="9f11" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">欢迎阅读另一篇探讨苹果愿景和VisionKit框架的文章。我已经写了两篇使用这些框架的文章和代码示例。</p><p id="4df9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我过去写过的第一个是“<a class="ae lm" rel="noopener ugc nofollow" target="_blank" href="/barcode-scanner-in-swiftui-c6d5fc35cf60">swift ui</a>中的条形码扫描仪”。</p><p id="458e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第二篇文章相当年轻，叫做“SwiftUI 中的<a class="ae lm" rel="noopener ugc nofollow" target="_blank" href="/document-scanner-in-swiftui-709753af367b">文档扫描仪”。</a></p><p id="e16d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，是时候做一些新的甚至更有趣的事情了。</p><h2 id="e647" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">介绍</h2><p id="5723" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">探索现有的人脸检测和人脸标志检测的框架是我很久以前就想做的事情。</p><p id="726d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我发现令人着迷的是，一些聪明的算法甚至可以在戴着眼镜或面具的情况下检测和跟踪人脸。</p><p id="a7ed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">多亏了苹果，我们可以在手机上拥有所有这些功能。不需要将任何东西发送到任何服务器进行处理。不管怎么说，那太慢了。</p><p id="ad9b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们希望一切都在我们的设备上实时进行。</p><p id="c46a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">因此，我开始了这个项目，产生了这篇文章和一个完整的iOS应用程序。您可以下载附带的Xcode项目，并在自己的项目中自由使用源代码。</p><p id="6122" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">先说说app实际在做什么？</p><h2 id="4594" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">应用程序功能</h2><p id="3872" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">标题已经说明了这篇文章是关于人脸检测和人脸标志检测的。这个应用程序做的更多。</p><p id="5aed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">苹果的Vision和VisionKit框架提供了所有现成的算法，我在示例应用程序中包含了以下功能:</p><ol class=""><li id="7f8f" class="ml mm it ks b kt ku kw kx kz mn ld mo lh mp ll mq mr ms mt bi translated">检测和可视化边界框</li><li id="5ac6" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll mq mr ms mt bi translated">检测和可视化面部标志</li><li id="b9b3" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll mq mr ms mt bi translated">确定图像捕获质量</li><li id="c008" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll mq mr ms mt bi translated">确定头部位置</li></ol><p id="6c21" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">从这里</strong>  <strong class="ks iu">可以下载完整的Xcode工作区以及功能齐全的app</strong><a class="ae lm" href="https://www.buymeacoffee.com/twissmueller/e/57029" rel="noopener ugc nofollow" target="_blank"><strong class="ks iu">。</strong></a></p><p id="969e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是应用程序运行时的样子:</p><figure class="ki kj kk kl gt km"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="b642" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">该应用程序用Xcode 13.2.1 Swift语言版本5编写，并在装有iOS 15.2.1的iPhone 11 Pro Max上进行测试。</p><p id="e4b6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在下一部分，我将更详细地解释这些特性。</p><h2 id="50b9" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">什么是边界框？</h2><p id="94bc" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">当我们想把一个人的脸作为一个整体来跟踪时，我们使用边界框。我们直接从检测算法中获得这些值，并可以用它们来可视化例如脸部周围的绿色正方形。</p><p id="6e95" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这正是示例应用程序所做的。你可以根据你的用例改变边界框的可视化。也许你需要另一种颜色或者你需要虚线而不是实线？使用SwiftUI和我将检测逻辑从可视化中分离出来的方法，这是一个简单的任务。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/ca01da04a74004b522cc192f778f2a01.png" data-original-src="https://miro.medium.com/v2/format:webp/1*twsjApa1s7EELPY7InddNA.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae lm" href="https://developer.apple.com/machine-learning/api/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/machine-learning/api/</a></figcaption></figure><h2 id="6ca9" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">什么是人脸地标？</h2><p id="d9cf" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">面部标志给我们提供了面部特定特征的更多细节，而不是将整个面部视为一个实体。我们从检测算法中得到的是一组描绘面部特征的坐标，比如嘴、鼻子、眼睛等等。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/14fcd20736229c2b4c498786fbc3cda9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*an0ZK_GSx_vckyYIMnSyRw.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae lm" href="https://developer.apple.com/machine-learning/api/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/machine-learning/api/</a></figcaption></figure><h2 id="6add" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">什么是捕获质量？</h2><p id="8937" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">捕获质量指标提供了一个特定值，指示图像用于检测的质量。价值越高，质量越好。范围从0.0到1.0。</p><p id="8f4c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">当您拥有同一主题的一系列图像时，这一点尤其有用，例如，用于选择最佳镜头进行进一步处理。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/f9e3939b9246bd154414825b6d37cd8d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ov1OniYcvSGF026tlyvFrA.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae lm" href="https://developer.apple.com/machine-learning/api/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/machine-learning/api/</a></figcaption></figure><h2 id="9f5b" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">有哪些不同的头部位置？</h2><p id="bc73" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">另一个有趣的指标是头部位置。实际上，我们有三个指标，一个是滚动，一个是偏航，一个是磁头的俯仰位置。下图描述了这些值的差异。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/88b7f191437b85076311aecdf61c22fe.png" data-original-src="https://miro.medium.com/v2/format:webp/1*b9TwGKxMwyYYfE9ZLk85ww.png"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae lm" href="https://developer.apple.com/videos/play/wwdc2021/10040/" rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/videos/play/wwdc2021/10040/</a></figcaption></figure><p id="1b4e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，我们知道了示例应用程序的功能，我们将学习如何组织its来实现这些功能。</p><h2 id="8aeb" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">应用架构和代码组织</h2><p id="05b7" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">在为这篇文章做研究时，我遇到了许多例子。几乎所有这些都有同一个问题，即“大规模视图控制器”反模式。</p><p id="6fba" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">概括地说，示例应用程序有三个处理步骤:</p><ul class=""><li id="9931" class="ml mm it ks b kt ku kw kx kz mn ld mo lh mp ll nf mr ms mt bi translated">捕捉图像序列</li><li id="cc4d" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated">运行检测算法</li><li id="9680" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated">想象结果</li></ul><p id="c92a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在“大规模视图控制器”风格的应用程序中，几乎所有这些步骤都是由一个巨大的类实现的。在经典UIKit应用中，这通常在<code class="fe ng nh ni nj b">UIViewControllers</code>中完成，因此得名。去过那里，做过那个。</p><p id="7ec9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">相反，我们想要的是“关注点分离”形式的良好代码设计，其中一个类服务于一个特定的目的。我们也可以看看鲍勃大叔(罗伯特·c·马丁)的坚实原理。我们想要的是“单一责任原则”。</p><p id="d434" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">因此，我这个项目的主要目标是通过将关注点捕获、检测和可视化分成不同的类，并通过管道机制将它们连接起来，从而拥有一个清晰简洁的代码结构。</p><p id="3c2a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Xcode中项目结构如下:</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/892e83aab98e849d9f4e528db17bdcd5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ptUMEcIwZim_gej5V6LqEA.png"/></div></figure><ul class=""><li id="8738" class="ml mm it ks b kt ku kw kx kz mn ld mo lh mp ll nf mr ms mt bi translated">这是我们的应用程序的入口点，它拥有应用程序委托。应用程序委托是我们实例化应用程序的不同功能组件并连接它们的地方。</li><li id="5079" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated"><code class="fe ng nh ni nj b">ContentView</code>:应用程序的最顶层视图。</li><li id="7bb1" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated"><code class="fe ng nh ni nj b">CameraView</code>:swift ui还没有自带的摄像头视图。因此，我们需要这个助手类来包装UIKit固有的视频预览层。</li><li id="8d72" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated"><code class="fe ng nh ni nj b">CaptureSession</code>:顾名思义，这个类负责捕获图像序列，也就是视频提要。</li><li id="235b" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated"><code class="fe ng nh ni nj b">FaceDetector</code>:这就是神奇发生的地方！所有的检测算法都是从这个类调用的。</li><li id="93c0" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated"><code class="fe ng nh ni nj b">AVCaptureVideoOrientation</code>:将<code class="fe ng nh ni nj b">UIDeviceOrientation</code>转换为<code class="fe ng nh ni nj b">AVCaptureVideoOrientation</code>的辅助函数，这是正确可视化所需要的。</li></ul><p id="873a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这些类本身并不真正有用。因此，他们需要连接。我更喜欢管道模式。我喜欢通过实现管道的元素来编写代码，然后以声明的方式将它们连接起来。这就是为什么我支持苹果引入联合收割机框架的原因。我在我的代码中经常使用它，但是只在它有意义并且不影响代码的清晰性和可理解性的地方使用。</p><p id="7c03" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">下图显示了我们的管道元素及其输入和输出数据类型。所有输出变量通过联合收割机发布器(<code class="fe ng nh ni nj b">@Published</code>)实现。然后，下一个管道元素将订阅该发布者。</p><figure class="ki kj kk kl gt km gh gi paragraph-image"><div class="ab gu cl kn"><img src="../Images/865d55660c603f3254aa147bdd4dc25b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*LT3tvGe9x1QA_nNuor4Hqg.png"/></div></figure><p id="6c15" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这就是如何构建示例应用程序来实现我们所需的特性。</p><p id="afb5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在是总结的时候了。</p><h2 id="23dc" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">结论</h2><p id="b9ff" class="pw-post-body-paragraph kq kr it ks b kt mg ju kv kw mh jx ky kz mi lb lc ld mj lf lg lh mk lj lk ll im bi translated">本教程应该让你深入了解实现人脸和人脸标志检测的必要条件。</p><p id="396a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在开始并解释了我们可以从苹果算法中收集什么样的信息之后，我详细地展示了我是如何构建示例应用程序的代码的。</p><p id="d7ea" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我的主要目标是为您提供一个清晰的代码设计，将检测代码嵌入到一个简单易懂且可重用的管道中。</p><p id="c8be" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">完整的Xcode工作区和功能齐全的app可以从这里</strong> <a class="ae lm" href="https://www.buymeacoffee.com/twissmueller/e/57029" rel="noopener ugc nofollow" target="_blank"> <strong class="ks iu">下载。</strong> </a></p><p id="583a" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">感谢您的阅读！</p><ul class=""><li id="f7b0" class="ml mm it ks b kt ku kw kx kz mn ld mo lh mp ll nf mr ms mt bi translated">如果你喜欢这个，请<a class="ae lm" href="https://twissmueller.medium.com/" rel="noopener">在Medium </a>上跟随我</li><li id="cb05" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated">给我买杯咖啡让我继续前进</li><li id="6298" class="ml mm it ks b kt mu kw mv kz mw ld mx lh my ll nf mr ms mt bi translated">支持我和其他媒体作者<a class="ae lm" href="https://twissmueller.medium.com/membership" rel="noopener">在这里注册</a></li></ul><div class="nk nl gp gr nm nn"><a href="https://twissmueller.medium.com/membership" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">通过我的推荐链接加入媒体</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">twissmueller.medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ko nn"/></div></div></a></div></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h2 id="9d98" class="ln lo it bd lp lq lr dn ls lt lu dp lv kz lw lx ly ld lz ma mb lh mc md me mf bi translated">资源</h2><ul class=""><li id="c145" class="ml mm it ks b kt mg kw mh kz oj ld ok lh ol ll nf mr ms mt bi translated"><a class="ae lm" href="https://developer.apple.com/videos/play/wwdc2021/10040/" rel="noopener ugc nofollow" target="_blank"> <strong class="ks iu">用视觉检测人、脸、姿势</strong> </a></li></ul></div></div>    
</body>
</html>