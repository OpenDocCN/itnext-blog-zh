<html>
<head>
<title>Installing Otomi on Minikube</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Minikube上安装Otomi</h1>
<blockquote>原文：<a href="https://itnext.io/installing-otomi-on-minikube-2f83dfc421d2?source=collection_archive---------0-----------------------#2022-04-12">https://itnext.io/installing-otomi-on-minikube-2f83dfc421d2?source=collection_archive---------0-----------------------#2022-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a0c74325801c2cd149533bfef74652b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSPh5sj-LM-kWZTW3TXBTA.png"/></div></div></figure><p id="6762" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/redkubes/otomi-core" rel="noopener ugc nofollow" target="_blank"> Otomi </a>是一个面向Kubernetes的自托管平台即服务(PaaS ),提供一整套集成的、预配置的应用程序，并结合自动化。Otomi针对在托管的Kubernetes服务(如AKS、EKS和GCP)上运行进行了优化，但现在可以安装在任何K8s集群上，甚至是Minikube上。因此，如果你想尝试Otomi，但不想在云中旋转集群，现在你可以了！</p><p id="7da9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，新版本的Otomi现在安装了一个最小的应用程序集，称为核心。该内核提供了基于Istio、Nginx入口控制器、Keycloak、Oauth2代理和cert-manager的高级入口架构。通过web UI (Otomi控制台),您可以将服务添加到网格中，并且只需一次点击就可以安全地公开它们。所有其他集成的应用程序现在都是可选的，可以通过将它们拖到已启用的应用程序部分来激活。在这篇文章中，我将解释如何在Minikube(在Mac上)上安装Otomi，以便您可以在cloud K8s集群上运行它并启用更多应用程序和功能之前使用它。</p><p id="a721" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你曾经运行过Minikube，你可能会使用Docker驱动程序。遗憾的是，使用Docker驱动时，无法从Mac访问Minikube IP。只能用127.0.0.1。在很多情况下这不是问题，但是Otomi需要一个可以从你的机器浏览器和集群内部解析的IP。</p><p id="bd43" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，为了能够在Minikube上安装Otomi，我将使用hyperkit驱动程序(参见:<a class="ae kw" href="https://minikube.sigs.k8s.io/docs/drivers/hyperkit/" rel="noopener ugc nofollow" target="_blank">https://minikube.sigs.k8s.io/docs/drivers/hyperkit/</a>)和metallb(参见:<a class="ae kw" href="https://metallb.universe.tf/" rel="noopener ugc nofollow" target="_blank">https://metallb.universe.tf/</a>)</p><p id="cbb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧:</p><p id="1b0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">确保您安装了以下软件:</p><ul class=""><li id="cb6e" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">库贝特尔</li><li id="4757" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">舵</li><li id="7fd3" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">码头工人</li><li id="035b" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">Minikube版本1.25.2(已测试)</li></ul><p id="157d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，配置minikube:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="4952" class="lu lv iq lq b gy lw lx l ly lz">minikube config set memory 8g</span><span id="d373" class="lu lv iq lq b gy ma lx l ly lz">minikube config set cpus 8</span></pre><p id="3e20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是如果你有多余的，请使用它们；-)</p><p id="342b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想玩Otomi中的网络策略功能，那么也需要使用Calico CLI。</p><p id="6e65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在启动Minikube:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="8338" class="lu lv iq lq b gy lw lx l ly lz">&gt; minikube start --driver=hyperkit --kubernetes-version=v1.22.4 --cni calico</span><span id="6d0e" class="lu lv iq lq b gy ma lx l ly lz">😄  minikube v1.25.2 on Darwin 11.1</span><span id="0e4a" class="lu lv iq lq b gy ma lx l ly lz">✨  Using the hyperkit driver based on user configuration</span><span id="ca81" class="lu lv iq lq b gy ma lx l ly lz">👍  Starting control plane node minikube in cluster minikube</span><span id="03c2" class="lu lv iq lq b gy ma lx l ly lz">💾  Downloading Kubernetes v1.21.9 preload ...</span><span id="745c" class="lu lv iq lq b gy ma lx l ly lz">&gt; preloaded-images-k8s-v17-v1...: 478.87 MiB / 478.87 MiB  100.00% 10.77 Mi</span><span id="dcac" class="lu lv iq lq b gy ma lx l ly lz">🔥  Creating hyperkit VM (CPUs=8, Memory=8192MB, Disk=20000MB) ...</span><span id="da1d" class="lu lv iq lq b gy ma lx l ly lz">🐳  Preparing Kubernetes v1.21.9 on Docker 20.10.12 ...</span><span id="294a" class="lu lv iq lq b gy ma lx l ly lz">▪ kubelet.housekeeping-interval=5m</span><span id="b365" class="lu lv iq lq b gy ma lx l ly lz">▪ Generating certificates and keys ...</span><span id="03c6" class="lu lv iq lq b gy ma lx l ly lz">▪ Booting up control plane ...</span><span id="c7e6" class="lu lv iq lq b gy ma lx l ly lz">▪ Configuring RBAC rules ...</span><span id="8483" class="lu lv iq lq b gy ma lx l ly lz">🔎  Verifying Kubernetes components...</span><span id="c61a" class="lu lv iq lq b gy ma lx l ly lz">▪ Using image gcr.io/k8s-minikube/storage-provisioner:v5</span><span id="dc21" class="lu lv iq lq b gy ma lx l ly lz">🌟  Enabled addons: storage-provisioner, default-storageclass</span><span id="72f8" class="lu lv iq lq b gy ma lx l ly lz">🏄  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default</span></pre><p id="582e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在启用metallb:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="04a6" class="lu lv iq lq b gy lw lx l ly lz">&gt; minikube addons enable metallb</span><span id="4d5b" class="lu lv iq lq b gy ma lx l ly lz">▪ Using image metallb/speaker:v0.9.6</span><span id="079e" class="lu lv iq lq b gy ma lx l ly lz">▪ Using image metallb/controller:v0.9.6</span><span id="8f03" class="lu lv iq lq b gy ma lx l ly lz">🌟  The 'metallb' addon is enabled</span></pre><p id="595f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要用Minikube IP配置metallb。所以首先要问IP地址</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="4858" class="lu lv iq lq b gy lw lx l ly lz">&gt; minikube ip</span><span id="6e9a" class="lu lv iq lq b gy ma lx l ly lz">192.168.64.16</span></pre><p id="de13" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并使用IP配置metallb</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6064" class="lu lv iq lq b gy lw lx l ly lz">&gt; minikube addons configure metallb</span><span id="5526" class="lu lv iq lq b gy ma lx l ly lz">-- Enter Load Balancer Start IP: 192.168.64.16</span><span id="fc6b" class="lu lv iq lq b gy ma lx l ly lz">-- Enter Load Balancer End IP: 192.168.64.16</span><span id="968b" class="lu lv iq lq b gy ma lx l ly lz">▪ Using image metallb/controller:v0.9.6</span><span id="410b" class="lu lv iq lq b gy ma lx l ly lz">▪ Using image metallb/speaker:v0.9.6</span><span id="2f09" class="lu lv iq lq b gy ma lx l ly lz">✅  metallb was successfully configured</span><span id="b17f" class="lu lv iq lq b gy ma lx l ly lz">kubectl is now configured to use "minikube" cluster and "default" namespace by default</span></pre><p id="4600" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以安装大友了。首先添加存储库</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="0b31" class="lu lv iq lq b gy lw lx l ly lz">helm repo add otomi https://otomi.io/otomi-core \</span><span id="6610" class="lu lv iq lq b gy ma lx l ly lz">helm repo update</span></pre><p id="efcd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后安装图表</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="d7ca" class="lu lv iq lq b gy lw lx l ly lz">helm install otomi otomi/otomi \<br/>--set cluster.k8sVersion="1.22" \<br/>--set cluster.name=minikube \<br/>--set cluster.provider=custom \<br/>--set apps.host-mods.enabled=false</span></pre><p id="96d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以监控图表安装</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="2796" class="lu lv iq lq b gy lw lx l ly lz">kubectl get job otomi -w</span><span id="e2d1" class="lu lv iq lq b gy ma lx l ly lz"># or watch the helm chart install status (optional)</span><span id="3ea0" class="lu lv iq lq b gy ma lx l ly lz">watch helm list -Aa</span></pre><p id="51b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装程序作业完成后，转到安装程序作业日志的末尾</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="fce4" class="lu lv iq lq b gy lw lx l ly lz">kubectl logs jobs/otomi -n default -f</span></pre><p id="eb1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在那里，您将看到以下内容:</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="7d83" class="lu lv iq lq b gy lw lx l ly lz">####################################################################<br/>#  To start using Otomi, go to https://192.168.64.16.nip.io and sign in to the web console<br/>#  with username "otomi-admin" and password "password".<br/>#  Then activate Drone. For more information see: <a class="ae kw" href="https://otomi.io/docs/installation//activation" rel="noopener ugc nofollow" target="_blank">https://otomi.io/docs/installation//activation</a><br/>####################################################################</span></pre><p id="2b25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在打开web UI，使用用户<code class="fe mb mc md lq b">otomi-admin</code>和提供的密码登录。</p><p id="b713" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于我们安装Otomi时没有提供自定义CA或使用LetsEncrypt，安装程序生成了一个CA。这个CA在您的本地机器上当然是不可信的。为了防止您点开浏览器中的大量安全警告，您可以将生成的CA添加到您的钥匙串中。在控制台的左侧菜单中，单击“下载CA”。</p><p id="7373" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们只需要激活无人机:</p><ul class=""><li id="3a34" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">在Otomi控制台的侧菜单平台下点击无人机应用程序</li><li id="82fc" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">点击右上角的播放按钮。将为无人机打开一个新标签</li><li id="390d" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">使用otomi-admin和安装程序作业日志中提供的密码在本地登录</li><li id="210d" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">点击<em class="me">授权申请</em></li><li id="a136" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">点击完成无人机注册页面上的<em class="me">提交</em>。如果你不愿意，你可以不填写你的电子邮件、全名或公司名称</li><li id="46d6" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">点击<em class="me"> otomi/values </em>储存库</li><li id="8364" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">点击<em class="me"> +激活存储库</em></li></ul><p id="6f12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">搞定了。现在你可以创建一个团队，添加服务，公开它们，配置网络策略和探索Otomi。</p><figure class="ll lm ln lo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/fe4407196298a3f557234c639adf7e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEwLmn94VD3igz4z7s7Qfg.png"/></div></div></figure><p id="91f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">喜欢你看到的吗？请加入观星者来支持我们:<a class="ae kw" href="https://github.com/redkubes/otomi-core" rel="noopener ugc nofollow" target="_blank">https://github.com/redkubes/otomi-core</a></p></div></div>    
</body>
</html>