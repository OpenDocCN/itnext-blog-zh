<html>
<head>
<title>Using Micro-Frontends in WordPress with Gutenberg Blocks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在WordPress中使用带有Gutenberg块的微前端</h1>
<blockquote>原文：<a href="https://itnext.io/using-micro-frontends-in-wordpress-with-gutenberg-blocks-882faad8cd62?source=collection_archive---------5-----------------------#2019-05-20">https://itnext.io/using-micro-frontends-in-wordpress-with-gutenberg-blocks-882faad8cd62?source=collection_archive---------5-----------------------#2019-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/243534e61c317868fd215573893d61e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ip1kBz7j17GLmC_e00GvXg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">古腾堡的票务中心</figcaption></figure><p id="e241" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">WordPress是最受欢迎的CMS平台之一，它使公司能够轻松管理他们的在线内容，并以最少的开发工作创建网站。WordPress有一堆插件和主题来添加新的行为，而无需编写任何代码，甚至我们可以开发自己的插件和主题。</p><p id="5800" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://wordpress.org/gutenberg/" rel="noopener ugc nofollow" target="_blank"> Gutenberg </a>是WordPress的新编辑器，它引入了块的概念，块是组织和组成内容的抽象单元，串在一起为网页创建内容。</p><blockquote class="lb lc ld"><p id="fc6c" class="kc kd le ke b kf kg kh ki kj kk kl km lf ko kp kq lg ks kt ku lh kw kx ky kz ij bi translated">这当然是一种压力，但这种压力将源源不断地流出……通过它，上帝将传播他的话语。真理之泉将从中涌出:像一颗新星，它将驱散无知的黑暗，并在人类中间点燃一盏迄今未知的明灯——约翰内斯·古腾堡</p></blockquote></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="c3d4" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">微前端在这里扮演什么角色？</h1><h2 id="6b6b" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">场景</h2><p id="21ad" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">我们可以想象我们是一家媒体公司，我们的主要收入来自发布关于音乐、艺术和节日活动的文章。我们是一家<a class="ae la" href="https://www.ticketmaster.se/feature/affiliate/?language=en-us" rel="noopener ugc nofollow" target="_blank"> Ticketmaster附属公司</a>，我们通过向与我们页面内容相关的Ticketmaster页面推荐流量来赚钱。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/155cd50b51cf1765edff182e36ddb50b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P9eyAvfihX_JigmDjob35w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Ticketmaster附属计划。</figcaption></figure><h2 id="49de" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">一般要点和限制</h2><ol class=""><li id="e670" class="nj nk iq ke b kf mz kj na kn nl kr nm kv nn kz no np nq nr bi translated">我们编辑的创作工作流程完全驻留在WordPress和Gutenberg中。我们需要让他们根据一个术语列出即将到来的事件，而不改变他们当前的工作流程。</li><li id="8730" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">该公司在其路线图中计划实施一种<a class="ae la" href="https://medium.com/tech-tajawal/why-headless-cms-is-becoming-so-popular-57d262b1e096" rel="noopener">无头CMS </a>方法。我们需要在WordPress上实现Ticketmaster视图，并在新的前端重用它，而无需重写任何代码。</li><li id="c5f2" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz no np nq nr bi translated">维护CMS平台的团队成长了很多。我们需要按领域分配团队。</li></ol><h2 id="3195" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">方法</h2><p id="41bb" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">我们可以在Gutenberg中使用自定义块，使编辑能够在文章或页面中列出即将发生的事件。然而，WordPress需要知道如何与Ticketmaster API交互，以便收集必要的数据来呈现视图，当新的前端出现时，我们需要重新编写逻辑。</p><p id="844e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">微前端使我们能够将视图作为服务进行分发，在此前提下，我们可以拥有一个独立的团队，该团队是Ticketmaster微前端的所有者，知道如何与Ticketmaster API进行通信，以便呈现和分发他们的视图。</p><h2 id="34d2" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">解决方案</h2><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="nx ny l"/></div></figure><p id="3bcf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此处代码</p><div class="nz oa gp gr ob oc"><a href="https://github.com/marconi1992/micro-frontends-gutenberg-example" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd ir gy z fp oh fr fs oi fu fw ip bi translated">马可尼1992/微前端-古腾堡-示例</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">使用Gutenberg - marconi1992在Wordpress中使用微前端的演示</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">github.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq jw oc"/></div></div></a></div></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="4e2d" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Ticketmaster微前端</h1><p id="ace8" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这个微前端是用<a class="ae la" href="https://github.com/marconi1992/hypernova" rel="noopener ugc nofollow" target="_blank"> Hypernova </a>和<a class="ae la" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>开发的。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi or"><img src="../Images/c0c4c51cb635bebc674faeb8da01ba46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*JFuXXV_YpES5DBx05gux7w.png"/></div></figure><ul class=""><li id="6c1d" class="nj nk iq ke b kf kg kj kk kn os kr ot kv ou kz ov np nq nr bi translated">消费者请求查看Ticketmaster微前端。</li></ul><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><ul class=""><li id="2a65" class="nj nk iq ke b kf kg kj kk kn os kr ot kv ou kz ov np nq nr bi translated">微前端从Ticketmaster API收集所有数据。</li><li id="162b" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">微前端使用收集的数据和Vue.js组件呈现视图。</li><li id="215b" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">微前端发回带有所请求视图的HTML的响应。</li></ul><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><h2 id="985e" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">入口点</h2><p id="f790" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">我们有一个入口点，微前端在这里定义它可以服务的视图。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><p id="9bb2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们定义了一个<strong class="ke ir">事件列表</strong>视图，并使用hypernova绑定<strong class="ke ir"> renderVuex </strong>将其绑定到Vue.js组件。</p><p id="e045" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Vue.js组件正在使用Vuex存储，因此我们在hypernova绑定中传递函数<strong class="ke ir"> createEventListingStore </strong>来启用hypernova为每个请求的视图创建一个唯一的存储。</p><h2 id="da8d" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">事件列表视图</h2><p id="a0e8" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这是一个Vue.js组件，它使用Vuex存储来获取和列出与使用卡片这个术语相匹配的事件。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><h2 id="309c" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">事件列表存储</h2><p id="95b2" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这个Vuex存储基于与Ticketmaster API交互的术语获取事件，转换它们并在存储状态中设置它们。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="1f3e" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated"><strong class="ak">ticket master WordPress插件</strong></h1><p id="ba5e" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这个插件在Gutenberg中为事件列表视图添加了一个自定义块。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/937c77c32ff979ce06f600e0b20bc110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jaklXgtJhKySFAMl2iq9Lg.png"/></div></div></figure><h2 id="09c3" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">PHP入口点</h2><p id="c6d4" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">插件的入口点注册了WordPress中新的<a class="ae la" href="https://developer.wordpress.org/block-editor/tutorials/block-tutorial/writing-your-first-block-type/" rel="noopener ugc nofollow" target="_blank">块类型</a>和Gutenberg编辑器的javascript。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><p id="dedd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> register_block_type </strong>选项中的<strong class="ke ir"> render_callback </strong>属性让WordPress知道如何在服务器端呈现已发布和草稿页面中的块。我们正在使用一个由<strong class="ke ir"> render_nova_directive </strong>修饰的函数，它只返回一个带有块属性的占位符。</p><p id="106a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">稍后我会解释为什么WordPress只渲染占位符而不从微前端获取视图。</p><h2 id="246c" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">Javascript入口点</h2><p id="2275" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这个脚本在Gutenberg中注册块类型，让它知道如何呈现可编辑的块和修改块属性的表单。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="ow ny l"/></div></figure><p id="3f30" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> NovaPreview </strong>组件渲染从微前端获取视图的块，并且每当块属性改变时，它再次渲染。</p></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="5ba4" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">WordPress网站</h1><p id="dd27" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">一旦创建了一个页面，站点只呈现一个带有文本“Nova Directive”的占位符。这种行为是意料之中的，接下来是最精彩的部分。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oy"><img src="../Images/9e51a2804c621ce5fa43ff15fd776d69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruo1jWMrnX0YCCL2nvSd_g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">渲染页面</figcaption></figure><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/c4fc994f4c44eab61bc9c0e7c19524c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxJL9I7v5CGTAHiXpMcRHQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Nova指令占位符</figcaption></figure><p id="cce2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以注意到占位符包含了关于视图及其属性的信息。我们将把<a class="ae la" href="https://www.infoq.com/news/2018/08/experiences-micro-frontends" rel="noopener ugc nofollow" target="_blank"> Transclusion </a>与Nova Proxy一起使用，以便向微前端请求视图，并将它们包含在页面中。</p><p id="2a1b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我写了两篇文章解释这种方法，您可以阅读它们以获得更多细节。</p><p id="1b0a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://medium.com/js-dojo/strangling-a-monolith-to-micro-frontends-decoupling-presentation-layer-18a33ddf591b" rel="noopener">用Laravel、Vue.js和Hypernova把一个庞然大物扼杀在微前端</a></p><p id="8418" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae la" href="https://medium.com/js-dojo/page-building-using-micro-frontends-c13c157958c8" rel="noopener">使用微前端构建页面</a></p><h2 id="0f1a" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">使用Nova代理的微前端跨集群</h2><p id="d09d" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">这是一个服务器端的包含服务器，它解析来自源服务器(WordPress)的响应。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pa"><img src="../Images/0cf4672f8b114f20e061863f16d421fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GXEE4jMJWXPfXgOoWOiLqw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">服务器端包含Nova代理</figcaption></figure><ul class=""><li id="1bb0" class="nj nk iq ke b kf kg kj kk kn os kr ot kv ou kz ov np nq nr bi translated">用户向Nova代理请求页面。</li><li id="8121" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">Nova代理将请求传递给WordPress(源服务器)。</li><li id="d68e" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">WordPress使用存储的内容以及自定义块呈现的Nova指令来呈现页面。</li><li id="3d90" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">WordPress将HTML发送回Nova代理。</li><li id="2e1b" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">Nova代理解析HTML并获取存储在占位符中的必要数据，用于向微前端请求视图。</li><li id="03b7" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">Nova代理向微前端请求视图。</li><li id="deff" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">微前端呈现视图，并将JSON和为视图生成的HTML发送回Nova代理。</li><li id="4c25" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">Nova代理包含了替代占位符的生成视图。</li><li id="7e21" class="nj nk iq ke b kf ns kj nt kn nu kr nv kv nw kz ov np nq nr bi translated">Nova代理将页面发送回浏览器。</li></ul><h2 id="2afe" class="mn lq iq bd lr mo mp dn lv mq mr dp lz kn ms mt md kr mu mv mh kv mw mx ml my bi translated">结果呢</h2><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pb"><img src="../Images/88ca9affba8d7cc4180b46fdf10b58ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GsGKpBoU5TA5qbKorKLAw.png"/></div></div></figure></div><div class="ab cl li lj hu lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ij ik il im in"><h1 id="8464" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">最后的想法</h1><p id="43d8" class="pw-post-body-paragraph kc kd iq ke b kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv nd kx ky kz ij bi translated">使用这种解决方案，WordPress不知道视图将如何呈现，它只使用Nova指令呈现占位符，该指令使Nova代理能够请求视图并将它们包含在页面中。</p><p id="6929" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此外，这个解决方案使WordPress迁移到一个无头架构变得更加容易，不需要重写任何代码，新的前端站点只需要基于来自WordPress Rest API的块属性呈现一个占位符。</p></div></div>    
</body>
</html>