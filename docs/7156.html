<html>
<head>
<title>Terraform Tutorial — Part 1 — Intro and Basic Concepts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform教程—第1部分—简介和基本概念</h1>
<blockquote>原文：<a href="https://itnext.io/terraform-tutorial-part-1-intro-and-basic-concepts-7a27ae7722b6?source=collection_archive---------0-----------------------#2022-06-30">https://itnext.io/terraform-tutorial-part-1-intro-and-basic-concepts-7a27ae7722b6?source=collection_archive---------0-----------------------#2022-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/41c9d380d66f15ce3a617460c9f8c65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubPEM_ajVaqE9J6C2m1eKA.png"/></div></div></figure><p id="51dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我有好消息给Terraform爱好者！我打算写一个最完整的地形教程，就像Jenkins教程一样。在几十篇文章中，你会学到你需要的关于地形的一切，从零到英雄。让我们开始吧。</p><h1 id="46a1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">从过去到现在！改变了什么？</h1><p id="a666" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在过去，通常情况下，任何事情都是通过手动或脚本来管理的。基础设施部署在裸机上，大多数基础设施平台不提供基于API的服务。在那些日子里，新版本应用程序的发布速度和部署速度都不高，应用程序的生命周期(从开发到部署)进展缓慢，开发团队已经从运营团队(系统管理员)中分离出来，但如今，一切都在改变，一切的速度都在提高。应用程序以敏捷的方式开发。基础设施平台提供基于API的服务，企业每天发布数百个应用程序版本(新版本)。公司有新需求！他们需要更快的方法来部署基础架构和应用程序。他们需要新的方法来使其基础架构可重复使用。他们需要新的东西！你知道什么是DevOps，正因为如此，你才在这里。作为一名DevOps工程师，您工作的一个典型部分是创建更易管理和可重复的基础设施，但是您如何做到这一点呢？你的答案是通过代码实现基础设施！和以前完全不同的方式。</p><h1 id="c991" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是作为代码的基础设施？</h1><p id="c99a" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">基础设施即代码，简称IaC，是一种实现基础设施的新方法。在这种基础设施实现模型中，不是手动实现基础设施，而是用代码编写所需的基础设施，IaC工具负责在真实的基础设施上实现它。例如，您的VMware基础架构上需要一台虚拟机。以手动方式，您必须打开VMware控制台，登录到它，转到您的数据中心，创建一个新的虚拟机，将其分配到适当的池、数据存储区和网络，并指定其资源，如CPU、RAM、硬盘大小等。，但是使用IaC，您可以编写一些代码，IaC工具会在您的VMware基础架构上创建虚拟机，而无需任何直接的人工交互或手动操作。以下IaC代码是用Terraform DSL语言HCL编写的，它在VMware基础架构上创建了一个新的虚拟机。这只是一个将基础设施作为代码引入的例子。我很快会解释一切。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="49a8" class="mi kx iq me b gy mj mk l ml mm">provider "vsphere" {<br/>  user                 = "ssbostan"<br/>  password             = "justfortest"<br/>  vsphere_server       = "myvcenter.test.local"<br/>  allow_unverified_ssl = true<br/>}</span><span id="457b" class="mi kx iq me b gy mn mk l ml mm">data "vsphere_datacenter" "mydatacenter" {<br/>  name = "mydatacenter"<br/>}</span><span id="7157" class="mi kx iq me b gy mn mk l ml mm">data "vsphere_datastore" "mydatastore" {<br/>  name          = "mydatastore"<br/>  datacenter_id = data.vsphere_datacenter.mydatacenter.id<br/>}</span><span id="7ae5" class="mi kx iq me b gy mn mk l ml mm">data "vsphere_resource_pool" "mypool" {<br/>  name          = "mycluster/Resources"<br/>  datacenter_id = data.vsphere_datacenter.mydatacenter.id<br/>}</span><span id="86d5" class="mi kx iq me b gy mn mk l ml mm">data "vsphere_network" "mynetwork" {<br/>  name          = "public"<br/>  datacenter_id = data.vsphere_datacenter.mydatacenter.id<br/>}</span><span id="c4a1" class="mi kx iq me b gy mn mk l ml mm">resource "vsphere_virtual_machine" "myvirtualmachine" {<br/>  name             = "myvirtualmachine"<br/>  datastore_id     = data.vsphere_datastore.mydatastore.id<br/>  resource_pool_id = data.vsphere_resource_pool.mypool.id<br/>  num_cpus         = 2<br/>  memory           = 1024<br/>  guest_id         = "ubuntu64Guest"<br/>  network_interface {<br/>    network_id = data.vsphere_network.mynetwork.id<br/>  }<br/>  disk {<br/>    label = "mydisk"<br/>    size  = 20<br/>  }<br/>}</span></pre><p id="9fbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述代码登录到VMware infrastructure，并创建一个具有指定数量的RAM、CPU、硬盘等的新虚拟机。</p><h1 id="2bf3" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">为什么我们需要代码形式的基础设施:</h1><p id="2776" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">作为代码的基础架构IaC减少了人为错误，允许我们编写一次并部署多次，使生命周期可重复，防止手动部署模型的任何错误配置，允许我们以更好的方式管理我们的基础架构，提供更好的方法来大规模管理基础架构，以及许多其他好处。在阅读本文之前，您已经检查并了解了它的许多好处。</p><h1 id="1197" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">作为代码编程语言的基础设施:</h1><p id="080d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">从技术上来说，你可以用你选择的任何编程语言编写IaC代码，比如Python、Typescript、Golang等。，但在现实世界中，它依赖于IaC工具及其支持的语言。例如，使用terra form CDKTF(terra form的云开发工具包)，可以用Python、Typescript、Java、C#和Go编写IaC代码。除了众所周知的编程语言之外，IaC工具还可以提供它的DSL语言。对于Terraform，您也可以用HCL(HashiCorp配置语言)编写IaC代码。除了普通的编程语言之外，其他一些IaC工具如Pulumi可以让你用YAML语言编写IaC。我将很快发布最完整的Pulumi教程。</p><h1 id="7560" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">什么是Terraform？</h1><p id="12d0" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Terraform是DevOps领域中一个众所周知的IaC工具，但我想称之为生命周期-代码工具，因为除了基础设施之外，您还可以管理众多应用程序的生命周期，如Grafana、Elasticsearch、Gitlab、Jenkins等。在Terraform及其提供商的帮助下，您可以专注于编写代码，而将部署和管理阶段留给Terraform。如今，Terraform已经成为DevOps生命周期中最重要的部分之一。</p><h1 id="20f2" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">地形建筑:</h1><p id="213b" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Terraform是一个基于插件的工具。因此，它有一个核心应用程序terraform和数百个插件。核心应用程序提供了一个统一的层来管理IaC代码，它负责安装所需的插件，调用它们，管理状态等。另一方面，插件在这里与真正的基础设施平台和应用程序通信，如AWS、GCP、Azure、Grafana、Jenkins、Gitlab等。这些插件有些是由HashiCorp团队官方维护的，有些是由第三方维护的。每个人都可以编写和分发自己的插件。你可以在<a class="ae mo" href="https://registry.terraform.io" rel="noopener ugc nofollow" target="_blank"> Terraform Registry </a>网站上找到数百个插件。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/fe7a03058607284b3d53962351a8cc93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kURbxzaN71vbmZEBN3unLA.png"/></div></div></figure><p id="a229" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Terraform插件分为两种类型:<strong class="ka ir">提供者</strong>和<strong class="ka ir">提供者</strong>。提供者是一个插件，负责通过API连接到真实的基础设施或应用程序，并创建、修改和删除对象和资源，而供应者是一个插件，负责连接到被供应的基础设施，并对其进行一些更改。例如，您可以使用AWS PROVIDER来提供EC2实例，并在提供后使用remote-exec PROVISIONER在其上执行一些命令。您应该注意，使用置备程序根本不是最佳做法，它们是作为最后的解决方案提供的。</p><h1 id="da7e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">现在就开始，用Terraform做:</h1><p id="cef5" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">在这一系列教程和文章中，我打算用HCL语言解释Terraform。我将为CDKTF发布另一门使用通用编程语言的课程。所以让我们开始吧。看看下面的代码。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="85f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有terraform代码都应写入带有<strong class="ka ir">的文件中。tf </strong>扩展，对于小型和非模块化代码通常为<em class="ms"> main.tf </em>。每个地形文件可以由各种代码块组成，如资源、数据、变量、输出等。例如，在上面的代码中，我们有一个资源块。所有terraform块都使用以下编码约定。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2d1d" class="mi kx iq me b gy mj mk l ml mm">&lt;BLOCK TYPE&gt; [&lt;BLOCK PARAMETER1&gt; &lt;BLOCK PARAMETER2&gt; ...] {<br/>  &lt;ARGUMENT NAME1&gt; = &lt;ARGUMENT VALUE1&gt;<br/>  &lt;ARGUMENT NAME2&gt; = &lt;ARGUMENT VALUE2&gt;<br/>  ....<br/>  &lt;INNER BLOCK&gt; {<br/>      &lt;ARGUMENT NAME1&gt; = &lt;ARGUMENT VALUE1&gt;<br/>      &lt;ARGUMENT NAME2&gt; = &lt;ARGUMENT VALUE2&gt;<br/>  }<br/>}</span></pre><p id="fca8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个块由其类型标识，并且可以有零个或多个参数。例如，terraform块没有参数，variable块有一个参数，resource块有两个参数。每个块可以有零个或多个参数和内部块。例如，在上面的代码<em class="ms"> intro1.tf </em>中，我们有一个资源块有两个参数和两个自变量。下面的代码是一个例子，让你的眼睛熟悉各种块。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="8d5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<a class="ae mo" href="https://www.terraform.io/downloads" rel="noopener ugc nofollow" target="_blank">官方安装</a>方法安装Terraform。</p><p id="1427" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将上述代码保存到<em class="ms"> main.tf </em>文件中，并运行以下命令。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3129" class="mi kx iq me b gy mj mk l ml mm">terraform init</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/9318d02a275a3a1213b9d419aebf6fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdhmoMa1mt2fL7UwNF8Xzw.png"/></div></div></figure><p id="919b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<strong class="ka ir"> init </strong>命令后，可以看到<em class="ms">。terraform </em>目录和你的<em class="ms"> main.tf </em>文件旁边的<em class="ms"> .terraform.lock.hcl </em>。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/9086e34b4a0fa6b18c8177dd7db93ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*pyxOecQdyx4KsUYc--aZyw.png"/></div></figure><p id="7250" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">初始化后，运行plan命令。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3f59" class="mi kx iq me b gy mj mk l ml mm">terraform plan</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/5205712ec3761eec9b901a467453584d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJI1_Sh9hPh4qA1F_Vh1Qg.png"/></div></div></figure><p id="9be8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后运行应用命令。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="5f59" class="mi kx iq me b gy mj mk l ml mm">terraform apply</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/63242eea4bb37f45f2193c4e87f52006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5BGdGx55Y7hBx4-qN6oXQ.png"/></div></div></figure><p id="8e1b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行apply命令后，您可以在前面的文件旁边看到myfile.txt以及terraform.tfstate文件。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/23edee017ed92916fefcaa6d89bf5a46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*-QdxusDmdgAGSFUZaDwuSw.png"/></div></figure><p id="9b27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们来描述一下流程、文件、目录等。</p><p id="6b6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行<code class="fe mw mx my me b">terraform init</code>命令，terraform通过创建初始文件、加载远程状态、下载插件、模块等方式初始化当前工作目录。当前项目中所有使用过的插件都将被下载到<em class="ms">中。terraform </em>目录和<em class="ms"> .terraform.lock.hcl </em>指向所用插件的版本及其签名。</p><p id="556d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您使用远程后端来存储您的Terraform状态文件，<em class="ms"> terraform.tfstate </em>，init命令将在初始化过程中加载它。后面我会完整的解释。</p><p id="79a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过运行<code class="fe mw mx my me b">terraform plan</code>命令，你可以检查terraform打算做什么，创建/销毁等等。使用这个命令，您可以看到接下来会发生什么。plan命令不会改变实际基础设施中的任何东西。您可以在不运行计划步骤的情况下应用更改。这只是在采取行动前的检查。</p><p id="2afd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，通过运行<code class="fe mw mx my me b">terraform apply</code>命令，Terraform将执行一个真正的操作，资源将在远程端创建/销毁，真正的基础设施。通过运行这个命令，你会看到会有什么改变，就像<strong class="ka ir">计划</strong>命令一样，接受它之后，部署过程就开始了，之后Terraform制作<em class="ms"> terraform.tfstate </em>文件，这是terraform生态系统的重要文件。我将在接下来的文章中深入解释它。</p><p id="f5d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">解释的IaC代码将创建一个名为myfile.txt的文件，其中包含指定的内容。从已定义的变量中读取内容，在创建文件后，其id将显示为输出。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a4fc" class="mi kx iq me b gy mj mk l ml mm">terraform output</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/417725798f370c3f799b70b8a3a3251c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PARrbH9BhaxMH7c5Bg2TWg.png"/></div></div></figure><p id="2199" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想要销毁基础设施或任何以前部署的资源，我们可以使用destroy命令。使用destroy命令，所有Terraform部署的资源都将被销毁。请注意，如果你破坏了某样东西，你不能用Terraform恢复它。如果某样东西被破坏了，那它就彻底没了。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="1ac4" class="mi kx iq me b gy mj mk l ml mm">terraform destroy</span></pre><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/af5583179b3fc03b42eb13d158efb371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C08CcAoi6FJJzcoDsiVrgQ.png"/></div></div></figure><h1 id="8ae6" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">最后的话和结论:</h1><p id="d364" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Terraform是DevOps领域的一个很酷的工具。它让DevOps工程师的生活变得更加甜蜜和轻松。借助Terraform，你可以用代码管理很多事情。它使您的基础架构和应用程序生命周期可重复且更易于管理。关于地球，我有很多东西要教你。要支持这个教程，就拍拍它，星星星星下面的GitHub库。</p><p id="f528" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae mo" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p><div class="mz na gp gr nb nc"><a href="https://github.com/ssbostan/terraform-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">ssbostan/terra form-教程</h2><div class="nj l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nk l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nl l"><div class="nm l nn no np nl nq jw nc"/></div></div></a></div></div></div>    
</body>
</html>