<html>
<head>
<title>Build a modern chat application with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React构建现代聊天应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-modern-chat-application-with-r-407f9f907705?source=collection_archive---------7-----------------------#2019-05-06">https://itnext.io/build-a-modern-chat-application-with-r-407f9f907705?source=collection_archive---------7-----------------------#2019-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d38e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本教程中，我将指导您使用React、React Router和<a class="ae ko" href="https://www.cometchat.com/pro" rel="noopener ugc nofollow" target="_blank"> CometChat Pro </a>构建自己的群聊应用程序。是的，我们将使用CometChat Pro来处理聊天消息的实时发送和接收，而不是使用我们自己的服务器。</p><p id="dc0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，您应该有一个功能性的聊天应用程序，看起来像这样(当然，欢迎您在进行过程中进行调整和试验):</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/1f1a50395bf3c3ca3d4c3ea9ba2cd1ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/0*IpnWjyBeWYjGJVd3.png"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/9e740a0ea28bef291b8d798ce4ec0eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*TKrPoNolzv3Qv15Q.png"/></div></figure><p id="707a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将本教程组织成一系列步骤，以便于理解。如果你只是想检查代码，<a class="ae ko" href="https://github.com/cometchat-pro-samples/react-comet-chat-app" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><h1 id="3db6" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置项目</h1><p id="1d36" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">在我们走得太远之前，我们必须首先设置我们的React项目。为此，我们将使用一个不太知名的gem，名为Create React App。</p><p id="3e1f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最好的事？因为您已经安装了npm，所以您可以使用npx在一个步骤中安装并运行create-react-app:</p><p id="acd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mb mc md me b">npx create-react-app chatapp // note: npm v5.2+</code></p><p id="1243" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行此命令后，将创建一个名为“chatapp”的新文件夹，其结构如下:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/7dd5101b53955128872261f090fa2041.png" data-original-src="https://miro.medium.com/v2/resize:fit:366/format:webp/0*3aVmRHFivRJnoEdd.png"/></div></figure><p id="d567" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了React，我们还需要安装React路由器和CometChat Pro SDK。为此，转到chatapp目录并运行:</p><p id="6948" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mb mc md me b">npm install react-router-dom @cometchat-pro/chat --save</code></p><h1 id="df38" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">添加React路由器</h1><p id="45c8" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">最后，我们的应用程序将有两个页面——一个叫做<code class="fe mb mc md me b">Login</code>,用户将在那里登录，另一个叫做<code class="fe mb mc md me b">Groupchat</code>,我们将在那里呈现聊天室。我们将使用React Router将用户路由到他们需要的页面。</p><p id="6d93" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要设置React路由器，我们必须首先在index.js文件中导入<code class="fe mb mc md me b">Router</code> <em class="mg">包装器</em>组件。我称它为包装组件，因为我们将我们的<code class="fe mb mc md me b">App</code>包装在<code class="fe mb mc md me b">Router</code>组件中。</p><p id="8313" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用以下代码片段替换index.js:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="c167" class="ml kz it me b gy mm mn l mo mp">import React from 'react';<br/>import { BrowserRouter as Router } from 'react-router-dom'; // added<br/>import ReactDOM from 'react-dom';<br/>import './index.css';<br/>import App from './App';<br/>ReactDOM.render(<br/>  &lt;Router&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Router&gt;<br/>  , document.getElementById('root'));</span></pre><p id="e921" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mb mc md me b">index.js</code>是我们应用程序的入口点。它唯一真正的工作是呈现我们的React应用程序。我们的大多数“真正的”逻辑发生在一个名为App.js的文件中，我们接下来将修改这个文件。</p><p id="5c86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在App.js中，我们必须导入额外的React路由器依赖项，这将使我们能够根据用户加载的路由呈现不同的组件。例如，如果用户转到“/login”路径，我们应该呈现login组件。同样，如果用户转到“/chat”路径，我们应该呈现<code class="fe mb mc md me b">Groupchat</code>组件:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="3448" class="ml kz it me b gy mm mn l mo mp">import React, { Component } from "react";<br/>import { Route, Redirect, Switch } from "react-router-dom";<br/>import "./App.css";<br/>// the below components will be created shortly<br/>import Login from "./components/Login";<br/>import Groupchat from "./components/Groupchat";<br/>class App extends Component {<br/>  constructor(props) {<br/>    super(props);<br/>  }<br/>render() {<br/>    return (<br/>      &lt;Switch&gt;<br/>        &lt;Redirect exact from="/" to="/login" /&gt;<br/>        &lt;Route path="/login" component={Login} /&gt;<br/>        &lt;Route path="/chat" component={Groupchat} /&gt;<br/>      &lt;/Switch&gt;<br/>    );<br/>  }<br/>}<br/>export default App;</span></pre><p id="a98e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您试图运行这段代码，它肯定会抛出一些错误，因为我们还没有制作<code class="fe mb mc md me b">Login</code>和<code class="fe mb mc md me b">Groupchat</code>组件。让我们现在做那件事。</p><h1 id="04b8" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建登录组件</h1><p id="2293" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">为了保持我们的项目整洁，创建一个名为<code class="fe mb mc md me b">components</code>的文件夹来保存我们的定制组件。</p><p id="c635" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，在新创建的文件夹中，使用以下代码创建一个名为Login.js的文件:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="2e87" class="ml kz it me b gy mm mn l mo mp">import React from "react";<br/>class Login extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>    };<br/>  }<br/>  render() {<br/>    return ( <br/>      &lt;div className="App"&gt;<br/>        &lt;h1&gt;Login&lt;/h1&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/>export default Login;</span></pre><p id="cf75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里所做的只是导出一个带有标题文本“Login”的组件。我们将很快充实这个组件，但目前，我们只是创建样板文件。</p><h1 id="3505" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建Groupchat组件</h1><p id="617d" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">在同一个components文件夹中，创建一个名为Groupchat.js的新组件:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="01e6" class="ml kz it me b gy mm mn l mo mp">import React from "react";<br/>class Groupchat extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>  }<br/>  render() {<br/>    return &lt;div className="chatWindow" /&gt;;<br/>  }<br/>}<br/>export default Groupchat;</span></pre><p id="4690" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着教程的深入，我们将把这个不起眼的组件开发成我们聊天应用程序的核心。</p><p id="1c05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了<code class="fe mb mc md me b">Groupchat</code>和<code class="fe mb mc md me b">Login</code>组件，您应该能够无错误地运行应用程序。在localhost上打开应用程序，导航到localhost:3000/login，然后导航到localhost:3000/chat，查看运行中的组件。</p><h1 id="1aac" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建CometChat应用程序ID和API密钥</h1><p id="b7ea" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">就像我在教程开始时提到的，我们不会在本教程中使用我们自己的服务器。相反，我们将使用托管服务<a class="ae ko" href="http://cometchat.com/pro" rel="noopener ugc nofollow" target="_blank"> CometChat Pro </a>。</p><p id="fd4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在连接到CometChat之前，我们必须首先从仪表板创建一个CometChat应用程序:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/c2f3238302128d4170dce760c522f1ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1TkxtVgIsY9KgVjF.png"/></div></div></figure><p id="1cf9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建应用程序后，点击“Explore ”,然后转到“API Keys”选项卡:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/9e94454875b5a87f9d0c048aac9d0860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FgI4S2_2V3rwQgq3.png"/></div></div></figure><p id="0502" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">单击“创建API密钥”并填写表单，选择仅授权范围。从表中，您可以记下您的应用程序ID和应用程序密钥，我们很快就会用到它们。</p><h1 id="c4a6" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建CometChat组ID</h1><p id="80f8" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">当我们打开仪表板时，让我们也创建一个<em class="mg">组</em>。通常你可以通过代码来实现这一点(例如，你可以允许用户通过你的应用程序为他们的团队或项目创建一个自定义的聊天组)，但是对于学习和测试来说，仪表板是很好的。</p><p id="0212" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">转到“Groups”选项卡，创建一个名为testgroup的新组:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/7238cea103bd7218b49c6c6fd3a02743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6_UKGXjdU13YYY0s.png"/></div></div></figure><p id="1837" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">像上次一样，您将被带回到一个表格，在那里您可以记下组ID:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/18c474c6ac74f75b8466dca0b767bce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Si24Sez51fJwN5di.png"/></div></div></figure><p id="0811" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请记下来，因为我们在下一步中需要用到它。</p><h1 id="af69" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建配置文件</h1><p id="30f8" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">为了便于引用我们的配置，创建一个名为config.js的新文件并粘贴您的凭证:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="2e72" class="ml kz it me b gy mm mn l mo mp">export default {<br/>  appId: "", //Enter your App ID<br/>  apiKey: "", //Enter your API KEY<br/>  GUID: "", // Enter your group UID<br/>};</span></pre><p id="52b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您现在可以关闭仪表板了。一旦你设置了CometChat，所有的交互都是通过代码进行的。</p><h1 id="4ea3" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建一个CometChat管理器类</h1><p id="637d" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">React的一个优点是它有助于分离关注点。我们的组件可以完全专注于表示，而我们可以创建其他模块来处理诸如数据获取和状态管理之类的事情。</p><p id="1314" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了充分利用这一点，让我们创建一个名为“lib”的新文件夹，并在该新文件夹中创建一个名为chat.js的文件。这是我们与CometChat进行所有交互的地方:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="b7e2" class="ml kz it me b gy mm mn l mo mp">import { CometChat } from "@cometchat-pro/chat";<br/>import config from "../config";<br/>export default class CCManager {<br/>  static LISTENER_KEY_MESSAGE = "msglistener";<br/>  static appId = config.appId;<br/>  static apiKey = config.apiKey;<br/>  static LISTENER_KEY_GROUP = "grouplistener";<br/>  static init() {<br/>    return CometChat.init(CCManager.appId);<br/>  }<br/>  static getTextMessage(uid, text, msgType) {<br/>    if (msgType === "user") {<br/>      return new CometChat.TextMessage(<br/>        uid,<br/>        text,<br/>        CometChat.MESSAGE_TYPE.TEXT,<br/>        CometChat.RECEIVER_TYPE.USER<br/>      );<br/>    } else {<br/>      return new CometChat.TextMessage(<br/>        uid,<br/>        text,<br/>        CometChat.MESSAGE_TYPE.TEXT,<br/>        CometChat.RECEIVER_TYPE.GROUP<br/>      );<br/>    }<br/>  }<br/>  static getLoggedinUser() {<br/>    return CometChat.getLoggedinUser();<br/>  }<br/>  static login(UID) {<br/>    return CometChat.login(UID, this.apiKey);<br/>  }<br/>  static getGroupMessages(GUID, callback, limit = 30) {<br/>    const messagesRequest = new CometChat.MessagesRequestBuilder()<br/>      .setGUID(GUID)<br/>      .setLimit(limit)<br/>      .build();<br/>    callback();<br/>    return messagesRequest.fetchPrevious();<br/>  }<br/>  static sendGroupMessage(UID, message) {<br/>    const textMessage = this.getTextMessage(UID, message, "group");<br/>    return CometChat.sendMessage(textMessage);<br/>  }<br/>  static joinGroup(GUID) {<br/>    return CometChat.joinGroup(GUID, CometChat.GROUP_TYPE.PUBLIC, "");<br/>  }<br/>  static addMessageListener(callback) {<br/>    CometChat.addMessageListener(<br/>      this.LISTENER_KEY_MESSAGE,<br/>      new CometChat.MessageListener({<br/>        onTextMessageReceived: textMessage =&gt; {<br/>          callback(textMessage);<br/>        }<br/>      })<br/>    );<br/>  }<br/>}</span></pre><p id="40a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了允许我们创建关注点分离之外，这样表示代码也使它更容易消化。</p><p id="1c2b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我从顶部开始解释本模块的一些重要部分:</p><ul class=""><li id="110e" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated"><code class="fe mb mc md me b">LISTENER_KEY_MESSAGE</code>–这是消息监听器所要求的。</li><li id="826e" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">init()</code>–在应用程序的整个生命周期中只需要调用一次，它用appID调用CometChat <code class="fe mb mc md me b">init</code>方法。</li><li id="0512" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">getTextMessage(uid, text, msgType)</code>–它基于<code class="fe mb mc md me b">CometChat.TextMessage</code>方法创建消息对象，它接受UID(在我们的例子中是GUID)和要发送的文本消息。</li><li id="150c" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">getLoggedInUser()</code>–用于获取当前登录的用户。</li><li id="a54d" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">login()</code>–它用于基于CometChat.login方法登录用户，它接受UID(在我们的例子中是GUID)和apiKey。</li><li id="cdf2" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">getGroupMessages(GUID, callback, limit = 30)</code>–使用<code class="fe mb mc md me b">CometChat.MessagesRequestBuilder()</code>方法从CometChat获取之前的组消息，该方法将GUID和limit作为参数。</li><li id="1983" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">sendGroupMessage(UID, message)</code>–用于使用<code class="fe mb mc md me b">CometChat.sendMessage()</code>方法发送消息，并接受GUID和消息作为参数。</li><li id="2871" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">joinGroup(GUID)</code>–用于使用GUID加入选定的群组。</li><li id="43f6" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">addMessageListener(callback)</code>–使用<code class="fe mb mc md me b">CometChat.addMessageListener()</code>收听消息(我提到过这叫做实时吗？)，它需要将<code class="fe mb mc md me b">LISTENER_KEY_MESSAGE</code>作为一个参数，还需要一个在收到消息时调用的回调。</li></ul><p id="9ec5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里没有任何特定于这个应用程序的内容。您可以很好地利用这个模块，如果需要的话可以扩展它，并将其导入到另一个项目中。不过，一般来说，这只是SDK的一层薄薄的包装。</p><h1 id="29da" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更新登录组件</h1><p id="e9de" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">有了所有的配置和聊天代码，我们现在可以从<code class="fe mb mc md me b">Login</code>组件开始快速构建UI。</p><p id="dd51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提醒您一下，这是登录组件的外观:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/1c5cbead7ef30766bc77a1b83085dcea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/0*ScE7ItNtGZY-N8Cj.png"/></div></figure><p id="d3c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你所看到的，它的主要功能是询问用户的名字。一旦提供了名称，我们就呈现出<code class="fe mb mc md me b">Groupchat</code>组件。</p><p id="6ae8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将<code class="fe mb mc md me b">Login.js</code>替换为:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="3313" class="ml kz it me b gy mm mn l mo mp">import React from "react";<br/>import { Redirect } from "react-router-dom";<br/>import chat from "../lib/chat";<br/>import spinner from "../logo.svg";<br/>class Login extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    this.state = {<br/>      username: "",<br/>      isAuthenticated: false,<br/>      user: null,<br/>      isSubmitting: false,<br/>      errorMessage: ""<br/>    };<br/>  }<br/>  onSubmit = e =&gt; {<br/>    if (this.state.username !== "") {<br/>      e.preventDefault();<br/>      this.login();<br/>    }<br/>  };<br/>  login = () =&gt; {<br/>    this.toggleIsSubmitting();<br/>    chat<br/>    .login(this.state.username)<br/>    .then(user =&gt; {<br/>      this.setState({<br/>        user,<br/>        isAuthenticated: true<br/>      });<br/>    })<br/>    .catch(error =&gt; {<br/>      this.setState({<br/>        errorMessage: "Please enter a valid username"<br/>      });<br/>      this.toggleIsSubmitting();<br/>      console.log(error);<br/>    });<br/>  };<br/>  toggleIsSubmitting = () =&gt; {<br/>    this.setState(prevState =&gt; ({<br/>      isSubmitting: !prevState.isSubmitting<br/>    }));<br/>  };<br/>  handleInputChange = e =&gt; {<br/>    this.setState({<br/>      username: e.target.value<br/>    });<br/>  };<br/>  render() {<br/>    if (this.state.isAuthenticated) {<br/>      return (<br/>        &lt;Redirect<br/>          to={{<br/>            pathname: "/chat",<br/>            state: { user: this.state.user }<br/>          }}<br/>        /&gt;<br/>      );<br/>    }<br/>    return (<br/>      &lt;div className="App"&gt;<br/>        &lt;h1&gt;COMETCHAT&lt;/h1&gt;<br/>        &lt;p&gt;Create an account through your CometChat dashboard or login with one of our test users, superhero1, superhero2, etc.&lt;/p&gt;<br/>        &lt;form className="form" onSubmit={this.onSubmit}&gt;<br/>          &lt;input onChange={this.handleInputChange} type="text" /&gt;<br/>          &lt;span className="error"&gt;{this.state.errorMessage}&lt;/span&gt;<br/>          {this.state.isSubmitting ? (<br/>            &lt;img src={spinner} alt="Spinner component" className="App-logo" /&gt;<br/>          ) : (<br/>            &lt;input<br/>              type="submit"<br/>              disabled={this.state.username === ""}<br/>              value="LOGIN"<br/>            /&gt;<br/>          )}<br/>        &lt;/form&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/>export default Login;</span></pre><p id="39e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了表示性的HTML，这里的大部分代码都致力于处理一个<a class="ae ko" href="https://reactjs.org/docs/forms.html" rel="noopener ugc nofollow" target="_blank"> React表单</a>。</p><h1 id="81cb" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更新Groupchat组件</h1><p id="e81f" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">Groupchat组件的职责比Login组件多得多。快速提醒一下，这是它的样子:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/d41e3843404516f4080698f50ffd3d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*GPxdbaorrXZdXN9j.png"/></div></figure><p id="5ce0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在很大程度上，<code class="fe mb mc md me b">Groupchat</code>组件的工作是连接聊天库模块和我们将呈现给用户的UI。例如，当用户发送一条消息时，我们调用<code class="fe mb mc md me b">chat.sendMessage</code>,随着新消息的流入，调用一个回调函数:</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="929f" class="ml kz it me b gy mm mn l mo mp">import React from "react";<br/>import { Redirect } from "react-router-dom";<br/>import chat from "../lib/chat";<br/>import config from "../config";<br/>class Groupchat extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>this.state = {<br/>      receiverID: "",<br/>      messageText: null,<br/>      groupMessage: [],<br/>      user: {},<br/>      isAuthenticated: true<br/>    };<br/>this.GUID = config.GUID;<br/>  }<br/>sendMessage = () =&gt; {<br/>    chat.sendGroupMessage(this.GUID, this.state.messageText).then(<br/>      message =&gt; {<br/>        console.log("Message sent successfully:", message);<br/>        this.setState({ messageText: null });<br/>      },<br/>      error =&gt; {<br/>        if (error.code === "ERR_NOT_A_MEMBER") {<br/>          chat.joinGroup(this.GUID).then(response =&gt; {<br/>            this.sendMessage();<br/>          });<br/>        }<br/>      }<br/>    );<br/>  };<br/>scrollToBottom = () =&gt; {<br/>    const chat = document.getElementById("chatList");<br/>    chat.scrollTop = chat.scrollHeight;<br/>  };<br/>handleSubmit = event =&gt; {<br/>    event.preventDefault();<br/>    this.sendMessage();<br/>    event.target.reset();<br/>  };<br/>handleChange = event =&gt; {<br/>    this.setState({ messageText: event.target.value });<br/>  };<br/>getUser = () =&gt; {<br/>    chat<br/>      .getLoggedinUser()<br/>      .then(user =&gt; {<br/>        console.log("user details:", { user });<br/>        this.setState({ user });<br/>      })<br/>      .catch(({ error }) =&gt; {<br/>        if (error.code === "USER_NOT_LOGED_IN") {<br/>          this.setState({<br/>            isAuthenticated: false<br/>          });<br/>        }<br/>      });<br/>  };<br/>messageListener = () =&gt; {<br/>    chat.addMessageListener((data, error) =&gt; {<br/>      if (error) return console.log(`error: ${error}`);<br/>      this.setState(<br/>        prevState =&gt; ({<br/>          groupMessage: [...prevState.groupMessage, data]<br/>        }),<br/>        () =&gt; {<br/>          this.scrollToBottom();<br/>        }<br/>      );<br/>    });<br/>  };<br/>componentDidMount() {<br/>    this.getUser();<br/>    this.messageListener();<br/>    // chat.joinGroup(this.GUID)<br/>  }<br/>render() {<br/>    const { isAuthenticated } = this.state;<br/>    if (!isAuthenticated) {<br/>      return &lt;Redirect to="/" /&gt;;<br/>    }<br/>    return (<br/>      &lt;div className="chatWindow"&gt;<br/>        &lt;ul className="chat" id="chatList"&gt;<br/>          {this.state.groupMessage.map(data =&gt; (<br/>            &lt;div key={data.id}&gt;<br/>              {this.state.user.uid === data.sender.uid ? (<br/>                &lt;li className="self"&gt;<br/>                  &lt;div className="msg"&gt;<br/>                    &lt;p&gt;{data.sender.uid}&lt;/p&gt;<br/>                    &lt;div className="message"&gt; {data.data.text}&lt;/div&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/li&gt;<br/>              ) : (<br/>                &lt;li className="other"&gt;<br/>                  &lt;div className="msg"&gt;<br/>                    &lt;p&gt;{data.sender.uid}&lt;/p&gt;<br/>                   &lt;div className="message"&gt; {data.data.text} &lt;/div&gt;<br/>                  &lt;/div&gt;<br/>                &lt;/li&gt;<br/>              )}<br/>            &lt;/div&gt;<br/>          ))}<br/>        &lt;/ul&gt;<br/>        &lt;div className="chatInputWrapper"&gt;<br/>          &lt;form onSubmit={this.handleSubmit}&gt;<br/>            &lt;input<br/>              className="textarea input"<br/>              type="text"<br/>              placeholder="Enter your message..."<br/>              onChange={this.handleChange}<br/>            /&gt;<br/>          &lt;/form&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/>export default Groupchat;&lt;</span></pre><p id="69a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有很多东西需要消化，所以让我们把重要的部分分解开来:</p><ul class=""><li id="15e7" class="mv mw it js b jt ju jx jy kb mx kf my kj mz kn na nb nc nd bi translated"><code class="fe mb mc md me b">sendMessage()</code>–该函数处理向组发送消息，传递GUID和存储在组件状态中的文本消息。如果用户不是该组的一部分，我们就请求加入该组，然后再次调用sendMessage函数。</li><li id="38d9" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">scrollToBottom()</code>–该函数将用作消息监听器的回调函数，它只是确保最新消息显示在聊天列表中。</li><li id="1418" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">handleSubmit()</code>–这将调用sendMessage函数。</li><li id="7fd6" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">getUser()</code>–调用chat.getLoggedInUser()方法，并将用户对象存储在组件的状态中。</li><li id="86f9" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">messageListener()</code>–调用chat.addMessageListener()函数，并将收到的每条新消息添加到<code class="fe mb mc md me b">groupMessage</code>数组中，该数组存储在组件的状态中，并在应用程序中呈现。</li><li id="a40f" class="mv mw it js b jt ne jx nf kb ng kf nh kj ni kn na nb nc nd bi translated"><code class="fe mb mc md me b">componentDidMount()</code>–调用getUser和messageListener函数。</li></ul><p id="3098" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们根据消息是我们的还是别人的来呈现一个类。这样，我们可以应用不同的风格，这是下一节的主题。</p><h1 id="e2da" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更新样式</h1><p id="fe27" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">如果你现在运行这个应用程序，它将会工作，但是到目前为止还没有CSS，看起来会很奇怪。</p><p id="ad92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这不是一个关于CSS的教程，所以我不会详细解释，但是为了帮助你理解，你可以将下面的内容粘贴到你的App.css文件中(你已经有一个了，因为它是由前面的<code class="fe mb mc md me b">create-react-app</code>生成的):</p><pre class="kq kr ks kt gt mh me mi mj aw mk bi"><span id="8bcd" class="ml kz it me b gy mm mn l mo mp">.App {<br/>  text-align: center;<br/>  display: flex;<br/>  width: 100%;<br/>  flex-direction: column;<br/>  align-items: center;<br/>  justify-content: center;<br/>  height: 50vh;<br/>}<br/>.App p{<br/>  font-size: 12px;<br/>  width: 50%;<br/>}<br/>.App-logo {<br/>  animation: App-logo-spin infinite 0.5s linear;<br/>  height: 10vmin;<br/>}<br/>.form {<br/>  display: flex;<br/>  flex-direction: column;<br/>}<br/>.form input[type="text"] {<br/>  width: 300px;<br/>  height: 30px;<br/>  margin-bottom: 10px;<br/>}<br/>.form input[type="submit"] {<br/>  padding: 5px;<br/>  height: 30px;<br/>  border: none;<br/>  background-color: #187dbc;<br/>  color: #fff;<br/>}<br/>.form input[type="submit"]:hover {<br/>  border: #fff;<br/>  cursor: pointer;<br/>  background-color: #000;<br/>  color: #fff;<br/>}<br/>.error{<br/>  color: red;<br/>  font-size: 10px;<br/>  text-align: center;<br/>}<br/>@keyframes App-logo-spin {<br/>  from {<br/>    transform: rotate(0deg);<br/>  }<br/>  to {<br/>    transform: rotate(360deg);<br/>  }<br/>}<br/>.message {<br/>  font-size: 15px <strong class="me iu">!important</strong>;<br/>}<br/>body {<br/>  background-color: #f5f5f5;<br/>  font: 600 18px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Lato,<br/>    Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;<br/>  color: #4b4b4b;<br/>}<br/>.container {<br/>  display: grid;<br/>  grid-template-columns: repeat(4, 1fr);<br/>  grid-template-rows: repeat(1, 50px);<br/>  grid-gap: 3px;<br/>  margin-top: 15px;<br/>}<br/>.group {<br/>  background: #4eb5e5;<br/>  grid-column-start: 1;<br/>  grid-column-end: 2;<br/>  grid-row-start: 1;<br/>  grid-row-end: 190;<br/>  border-radius: 5px;<br/>}<br/>.chatWindow {<br/>  display: grid;<br/>  grid-column-start: 2;<br/>  grid-column-end: 9;<br/>  grid-row-start: 1;<br/>  grid-row-end: 190;<br/>  background: rgb(233, 229, 229);<br/>  border-radius: 5px;<br/>}<br/>.chatInputWrapper {<br/>  display: grid;<br/>  grid-row-start: 190;<br/>  grid-row-end: 190;<br/>}<br/>::-webkit-scrollbar {<br/>  display: none;<br/>}<br/>/* M E S S A G E S */<br/>.chat {<br/>  list-style: none;<br/>  background: none;<br/>  margin: 0;<br/>  padding: 0 0 50px 0;<br/>  margin-top: 60px;<br/>  margin-bottom: 10px;<br/>  max-height: 400px;<br/>  overflow: scroll;<br/>  scroll-behavior: smooth;<br/>}<br/>.chat li {<br/>  padding: 0.5rem;<br/>  overflow: hidden;<br/>  display: flex;<br/>}<br/>.chat .avatar {<br/>  position: relative;<br/>  display: block;<br/>  z-index: 2;<br/>}<br/>.chat .avatar img {<br/>  background-color: rgba(255, 255, 255, 0.9);<br/>  -webkit-touch-callout: none;<br/>  -webkit-user-select: none;<br/>  -moz-user-select: none;<br/>  -ms-user-select: none;<br/>}<br/>.chat .uid img {<br/>  background-color: rgba(255, 255, 255, 0.9);<br/>  -webkit-touch-callout: none;<br/>  -webkit-user-select: none;<br/>  -moz-user-select: none;<br/>  -ms-user-select: none;<br/>}<br/>.chat .day {<br/>  position: relative;<br/>  display: block;<br/>  text-align: center;<br/>  color: #c0c0c0;<br/>  height: 20px;<br/>  text-shadow: 7px 0px 0px #e5e5e5, 6px 0px 0px #e5e5e5, 5px 0px 0px #e5e5e5,<br/>    4px 0px 0px #e5e5e5, 3px 0px 0px #e5e5e5, 2px 0px 0px #e5e5e5,<br/>    1px 0px 0px #e5e5e5, 1px 0px 0px #e5e5e5, 0px 0px 0px #e5e5e5,<br/>    -1px 0px 0px #e5e5e5, -2px 0px 0px #e5e5e5, -3px 0px 0px #e5e5e5,<br/>    -4px 0px 0px #e5e5e5, -5px 0px 0px #e5e5e5, -6px 0px 0px #e5e5e5,<br/>    -7px 0px 0px #e5e5e5;<br/>  box-shadow: inset 20px 0px 0px #e5e5e5, inset -20px 0px 0px #e5e5e5,<br/>    inset 0px -2px 0px #d7d7d7;<br/>  line-height: 38px;<br/>  margin-top: 5px;<br/>  margin-bottom: 20px;<br/>  cursor: default;<br/>  -webkit-touch-callout: none;<br/>  -webkit-user-select: none;<br/>  -moz-user-select: none;<br/>  -ms-user-select: none;<br/>}<br/>.other .msg {<br/>  order: 1;<br/>  border-top-left-radius: 0px;<br/>  box-shadow: -1px 2px 0px #d4d4d4;<br/>}<br/>.other:before {<br/>  content: "";<br/>  position: relative;<br/>  top: 0px;<br/>  right: 0px;<br/>  left: 40px;<br/>  width: 0px;<br/>  height: 0px;<br/>  border: 5px solid #fff;<br/>  border-left-color: transparent;<br/>  border-bottom-color: transparent;<br/>}<br/>.self {<br/>  justify-content: flex-end;<br/>  align-items: flex-end;<br/>}<br/>.self .msg {<br/>  order: 1;<br/>  border-bottom-right-radius: 0px;<br/>  box-shadow: 1px 2px 0px #d4d4d4;<br/>}<br/>.self .avatar {<br/>  order: 2;<br/>}<br/>.self .avatar:after {<br/>  content: "";<br/>  position: relative;<br/>  display: inline-block;<br/>  bottom: 19px;<br/>  right: 0px;<br/>  width: 0px;<br/>  height: 0px;<br/>  border: 5px solid #fff;<br/>  border-right-color: transparent;<br/>  border-top-color: transparent;<br/>  box-shadow: 0px 2px 0px #d4d4d4;<br/>}<br/>.msg {<br/>  background: white;<br/>  min-width: fit-content;<br/>  padding: 10px;<br/>  border-radius: 10px;<br/>  box-shadow: 0px 2px 0px rgba(0, 0, 0, 0.07);<br/>}<br/>.msg p {<br/>  font-size: 0.8rem;<br/>  margin: 0 0 0.2rem 0;<br/>  color: rgb(81, 84, 255);<br/>}<br/>.msg img {<br/>  position: relative;<br/>  display: block;<br/>  width: 450px;<br/>  border-radius: 5px;<br/>  box-shadow: 0px 0px 3px #eee;<br/>  transition: all 0.4s cubic-bezier(0.565, -0.26, 0.255, 1.41);<br/>  cursor: default;<br/>  -webkit-touch-callout: none;<br/>  -webkit-user-select: none;<br/>  -moz-user-select: none;<br/>  -ms-user-select: none;<br/>}<br/>@media screen and (max-width: 800px) {<br/>  .msg img {<br/>    width: 300px;<br/>  }<br/>}<br/>@media screen and (max-width: 550px) {<br/>  .msg img {<br/>    width: 200px;<br/>  }<br/>}<br/>.msg time {<br/>  font-size: 0.7rem;<br/>  color: #ccc;<br/>  margin-top: 3px;<br/>  float: right;<br/>  cursor: default;<br/>  -webkit-touch-callout: none;<br/>  -webkit-user-select: none;<br/>  -moz-user-select: none;<br/>  -ms-user-select: none;<br/>}<br/>.msg time:before {<br/>  content: " ";<br/>  color: #ddd;<br/>  font-family: FontAwesome;<br/>  display: inline-block;<br/>  margin-right: 4px;<br/>}<br/>::-webkit-scrollbar {<br/>  min-width: 12px;<br/>  width: 12px;<br/>  max-width: 12px;<br/>  min-height: 12px;<br/>  height: 12px;<br/>  max-height: 12px;<br/>  background: #e5e5e5;<br/>}<br/>::-webkit-scrollbar-thumb {<br/>  background: rgb(48, 87, 158);<br/>  border: none;<br/>  border-radius: 100px;<br/>  border: solid 3px #e5e5e5;<br/>  box-shadow: inset 0px 0px 3px #999;<br/>}<br/>::-webkit-scrollbar-thumb:hover {<br/>  background: #b0b0b0;<br/>  box-shadow: inset 0px 0px 3px #888;<br/>}<br/>::-webkit-scrollbar-thumb:active {<br/>  background: #aaa;<br/>  box-shadow: inset 0px 0px 3px #7f7f7f;<br/>}<br/>::-webkit-scrollbar-button {<br/>  display: block;<br/>  height: 26px;<br/>}<br/>/* T Y P E */<br/>input.textarea {<br/>  width: 100%;<br/>  height: 50px;<br/>  background: #fafafa;<br/>  border: none;<br/>  outline: none;<br/>  padding-left: 55px;<br/>  padding-right: 55px;<br/>  color: #666;<br/>  font-weight: 400;<br/>}</span></pre><h1 id="0e46" class="ky kz it bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="1966" class="pw-post-body-paragraph jq jr it js b jt lw jv jw jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn im bi translated">用<code class="fe mb mc md me b">npm start</code>和low运行应用程序，看，你的聊天应用程序就完成了。至少，基本的功能已经到位。有了CometChat，你可以很容易地扩展应用程序，使其包括“谁在线名单”、直接消息、媒体消息和一系列其他功能。</p></div></div>    
</body>
</html>