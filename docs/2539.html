<html>
<head>
<title>Getting Started with OAuth2 in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go中的OAuth2入门</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-oauth2-in-go-1c692420e03?source=collection_archive---------1-----------------------#2019-06-11">https://itnext.io/getting-started-with-oauth2-in-go-1c692420e03?source=collection_archive---------1-----------------------#2019-06-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7e434187a1f40fd2deb790db6440f0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lz31bP6cVTWrYUChGBXeKQ.jpeg"/></div></div></figure><p id="e045" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是本视频的文字版:<a class="ae kw" href="https://youtu.be/OdyXIi6DGYw" rel="noopener ugc nofollow" target="_blank">package main # 11:Go中OAuth2入门</a>。</p><h1 id="4695" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Go中的OAuth2入门</h1><p id="5a7f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在任何应用程序中，身份验证通常都是非常重要的部分。你总是可以实现你自己的认证系统，但是这需要很多工作，注册，忘记密码表格等等。这就是OAuth2被创建的原因，它允许用户使用已经拥有的众多帐户中的一个来登录。</p><p id="37d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个视频中，我们将使用oauth2 Go包创建一个简单的Google登录网页。</p><h1 id="c442" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">谷歌项目，OAuth2键</h1><p id="52a9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">首先，让我们创建我们的Google OAuth2键。</p><ul class=""><li id="81d8" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">前往<a class="ae kw" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a></li><li id="d241" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">创建新项目或使用现有项目</li><li id="8392" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">转到凭据</li><li id="d148" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">单击“创建凭据”</li><li id="58c5" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">选择“OAuth客户端ID”</li><li id="8e5b" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">添加授权的重定向URL，在我们的例子中是<code class="fe mo mp mq mr b">localhost:8080/callback</code></li><li id="788b" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">获取客户端id和客户端密码</li><li id="0136" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">把它保存在安全的地方</li></ul><h1 id="052c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">OAuth2如何与谷歌合作</h1><ul class=""><li id="bf2c" class="ma mb iq ka b kb lv kf lw kj ms kn mt kr mu kv mf mg mh mi bi translated">从Google API控制台获取OAuth 2.0凭证。</li><li id="dfac" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">从Google授权服务器获取一个访问令牌。</li><li id="b05f" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">将访问令牌发送给API。</li><li id="9d46" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">如有必要，刷新访问令牌。</li></ul><h1 id="b438" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结构</h1><p id="5dfa" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们将在1个main.go文件中完成所有工作，并注册3个URL处理程序:</p><ul class=""><li id="87ff" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi">/</li><li id="71be" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">/登录</li><li id="7652" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">/回调</li></ul><h1 id="c944" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">初始处理程序和OAuth2配置</h1><pre class="mv mw mx my gt mz mr na nb aw nc bi"><span id="9547" class="nd ky iq mr b gy ne nf l ng nh">go <strong class="mr ir">get</strong> <a class="ae kw" href="http://golang.org/x/oauth2" rel="noopener ugc nofollow" target="_blank">golang.org/x/oauth2</a></span></pre><p id="c349" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将google客户端id和secret保存在env变量中，并且只使用os。代码中的Getenv。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="c9df" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi">/</h1><p id="d194" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">现在让我们在索引页面上呈现一个HTML。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="6bbe" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">/登录</h1><p id="7ec9" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我们发送随机状态字符串。在我们的事业中，这不是随机的。</p><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="6bff" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">/回调</h1><ol class=""><li id="0130" class="ma mb iq ka b kb lv kf lw kj ms kn mt kr mu kv nk mg mh mi bi translated">检查状态</li><li id="b527" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nk mg mh mi bi translated">使用<code class="fe mo mp mq mr b">code</code>获取令牌</li><li id="533b" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv nk mg mh mi bi translated">使用令牌获取用户信息</li></ol><figure class="mv mw mx my gt jr"><div class="bz fp l di"><div class="ni nj l"/></div></figure><h1 id="e8cb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">测试一下</h1><pre class="mv mw mx my gt mz mr na nb aw nc bi"><span id="a65e" class="nd ky iq mr b gy ne nf l ng nh">go run main.go</span></pre><h1 id="bfdc" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="3218" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">这就是我们在Go中整合OAath2和Google所需要做的一切。如您所见，它只有70行代码。</p><p id="bd33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，马克·贝茨提供了一个不错的包<a class="ae kw" href="https://github.com/markbates/goth" rel="noopener ugc nofollow" target="_blank">https://github.com/markbates/goth</a>，它提供了多提供商认证。</p><p id="ad98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/plutov/packagemain/tree/master/11-oauth2" rel="noopener ugc nofollow" target="_blank">全码</a>。</p></div></div>    
</body>
</html>