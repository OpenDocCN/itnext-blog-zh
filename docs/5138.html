<html>
<head>
<title>Why third-party cookies are NOT sent where you think they should</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么第三方cookies没有发送到您认为应该发送的地方</h1>
<blockquote>原文：<a href="https://itnext.io/why-third-party-cookies-are-not-sent-where-you-think-they-should-1ebc60f4f314?source=collection_archive---------1-----------------------#2020-12-19">https://itnext.io/why-third-party-cookies-are-not-sent-where-you-think-they-should-1ebc60f4f314?source=collection_archive---------1-----------------------#2020-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a363179f60f7fcfaef09d99890988fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8avfbISyc8DVxdJvUbmrOQ.png"/></div></div></figure><div class=""/><h1 id="e3e6" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">什么是第三方cookies</h1><p id="ce58" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">cookie与一个域相关联。如果该域与您所在页面的域相同，则该cookie称为第一方cookie。如果域不同，则它是第三方cookie。</p><p id="fa6f" class="pw-post-body-paragraph kw kx jb ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">你可以按照以下步骤在chrome上查看第一方cookies:打开开发控制台-&gt;<code class="fe lz ma mb mc b">Application Tab</code>-&gt;-<code class="fe lz ma mb mc b">Storage</code>-&gt;-<code class="fe lz ma mb mc b">Cookies</code>。</p><h1 id="bd9e" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">我们需要第三方cookies的环境</h1><p id="9cd9" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">使用CORS的跨来源请求。</p><h1 id="0d72" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated"><code class="fe lz ma mb mc b">OPTIONS</code>请求</h1><p id="c509" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">CORS预检请求是一种CORS请求，它使用特定的方法和报头检查服务器是否理解CORS协议。</p><p id="4948" class="pw-post-body-paragraph kw kx jb ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">这是一个OPTIONS请求，使用三个HTTP请求头:Access-Control-Request-Method、Access-Control-Request-Headers和Origin头。</p><p id="872e" class="pw-post-body-paragraph kw kx jb ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">正常情况下，预检请求由浏览器自动发出。当请求被限定为“待预检”时出现，对于简单请求则省略。</p><h1 id="0c8d" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Cookies属性</h1><h1 id="3231" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">httpOnly</h1><p id="1091" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">使用<code class="fe lz ma mb mc b">HttpOnly</code>属性来防止通过JavaScript访问cookie值。这是防止XSS袭击的一种方式。</p><h1 id="48b6" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">领域</h1><p id="2542" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe lz ma mb mc b">Domain</code>属性指定允许哪些主机接收cookie。如果未指定，则默认为设置cookie的相同来源，不包括子域。如果指定了域，则始终包括子域。</p><h1 id="d39e" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">安全的</h1><p id="cad1" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">Cookies只设置在https上。</p><h1 id="96b9" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">同一地点</h1><p id="9a77" class="pw-post-body-paragraph kw kx jb ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated"><code class="fe lz ma mb mc b">SameSite</code>属性让服务器指定cookies是否/何时与跨来源请求一起发送(其中站点由可注册域定义)，这提供了一些针对跨站点请求伪造攻击的保护(CSRF)。</p><p id="cbc6" class="pw-post-body-paragraph kw kx jb ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">它有三个可能的值:严格、宽松和无。使用<code class="fe lz ma mb mc b">Strict</code>，cookie只被发送到产生它的同一个站点；<code class="fe lz ma mb mc b">Lax</code>是类似的，除了当用户导航到cookie的源站点时发送cookie，例如，通过跟随来自外部站点的链接；<code class="fe lz ma mb mc b">None</code>指定在发起和跨站点请求上发送cookies，但仅在安全上下文中发送(即，如果SameSite=None，则还必须设置安全属性)。</p><h1 id="86b7" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">发送第三方cookies的要求</h1><ol class=""><li id="4a51" class="md me jb ky b kz la ld le lh mf ll mg lp mh lt mi mj mk ml bi translated">浏览器设置应支持设置第三方cookies。对于Chrome，通过路径检查设置:设置-&gt;隐私和安全-&gt; cookie和其他网站数据-&gt;允许所有cookie</li><li id="a233" class="md me jb ky b kz mm ld mn lh mo ll mp lp mq lt mi mj mk ml bi translated">服务器在<code class="fe lz ma mb mc b">Set-Cookie</code>响应头中正确设置<code class="fe lz ma mb mc b">Same-Site</code>属性，</li><li id="9d40" class="md me jb ky b kz mm ld mn lh mo ll mp lp mq lt mi mj mk ml bi translated">在<code class="fe lz ma mb mc b">OPTIONS</code>预点火请求中设置<code class="fe lz ma mb mc b">Access-Control-Allow-Credentails: true</code>。</li><li id="de5f" class="md me jb ky b kz mm ld mn lh mo ll mp lp mq lt mi mj mk ml bi translated">客户端应该在请求中显式包含凭据。</li></ol><h1 id="1a43" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">取得</h1><pre class="mr ms mt mu gt mv mc mw mx aw my bi"><span id="b011" class="mz jz jb mc b gy na nb l nc nd">fetch('https://example.com', {<br/>  credentials: 'include' | 'same-origin' | 'omit'<br/>});</span></pre><h1 id="b0bd" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">Axios</h1><pre class="mr ms mt mu gt mv mc mw mx aw my bi"><span id="f2f3" class="mz jz jb mc b gy na nb l nc nd">axios.defaults.withCredentials = true;</span></pre><h1 id="551d" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">通知；注意</h1><ul class=""><li id="9485" class="md me jb ky b kz la ld le lh mf ll mg lp mh lt ne mj mk ml bi translated">如果您想关注我的博客系列的最新消息/文章，请点击<a class="ae nf" href="https://github.com/n0ruSh/blogs/" rel="noopener ugc nofollow" target="_blank">【观看】</a>订阅</li></ul></div></div>    
</body>
</html>