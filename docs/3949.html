<html>
<head>
<title>Reusing angular component— The RIGHT way (from scratch)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重用角度组件—正确的方法(从头开始)</h1>
<blockquote>原文：<a href="https://itnext.io/reusing-angular-component-the-right-way-from-scratch-cb906e374e30?source=collection_archive---------0-----------------------#2020-03-31">https://itnext.io/reusing-angular-component-the-right-way-from-scratch-cb906e374e30?source=collection_archive---------0-----------------------#2020-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e5bc840837b78f7c42e0a6800decad42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yovxvYye9S32OtmiJhNZog.jpeg"/></div></div></figure><p id="3735" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Angular允许我们创建和重用组件，但是通常，我们做得不对。我见过很多次开发者只是把一个项目的组件复制到另一个项目，我们都知道ctrl+c，ctrl+v并不是一个很好的复用东西的方法，因为组件会在每个项目上单独进化。</p><p id="b24f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了避免这种情况，我们有npm存储库，允许我们发布一个独立的组件，并将其作为项目的依赖项。有一个公共版本的npm库(每个人都可以使用发布的组件)，但是你也可以使用私有的npm库。这有助于保护您公司的数据。</p><p id="5424" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个好主意是将一个组件看作一个项目，而不是“仅仅是一个简单的组件”。我这样说是因为组件应该有它们自己的版本、测试，并与应用程序分离。实际上，为什么不直接创建一个git组件库，然后我们为它设置一个CI/CD管道呢？这就是我们在这篇文章中要做的。</p><p id="ae2c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我将使用<strong class="kd iu"> Gitlab </strong>，我将使用<a class="ae kz" href="https://www.sonatype.com/product-nexus-repository" rel="noopener ugc nofollow" target="_blank">T5】NexusT7】创建一个私有的npm库，因为它适合大多数项目，因为它支持其他注册表，如Maven、Nuget、Docker等。为了制作到组件的CI/CD管道，我将使用<strong class="kd iu"> Jenkins </strong>。一切都将在localhost中完成，但可以使用服务器轻松复制。</a></p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="d8a5" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">在这篇文章中我们将做什么？</h1><p id="cc68" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">目标是为角度组件设置自动化CI/CD。您可以根据需要定制您的管道，一切由您决定。在这篇文章中，我只想用最简单的方法。</p><p id="f708" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上图说明了流程:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/6935c4fca8c8b0304f2f2e403358af8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32Bs1K4H9rErOTUHEXe8Qw.jpeg"/></div></div></figure><h2 id="fde9" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">工作流程</h2><ol class=""><li id="5917" class="nb nc it kd b ke mf ki mg km nd kq ne ku nf ky ng nh ni nj bi translated">有人创建了组件的新版本(源代码已更改)</li><li id="09d8" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">Gitlab自动对Jenkins说(通过webhook):“嘿，我有一个组件的新版本，你能在nexus上构建并发布一个新版本吗？”</li><li id="90b8" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">所以詹金斯向Gitlab询问源代码。Gitlab表示，只会提供源代码和凭证🔒。但是Jenkins有资格并且得到了它(关于Jenkins的SCM部分)。</li><li id="dd58" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">Jenkins自动开始构建过程，然后将这个新版本发送给Nexus (npm publish)</li><li id="3661" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">如果一切正常，詹金斯对gitlab说:一切正常。</li></ol></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="fac6" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">要求</h1><p id="7b2e" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">要完成本指南，您必须安装以下工具:</p><ul class=""><li id="e703" class="nb nc it kd b ke kf ki kj km np kq nq ku nr ky ns nh ni nj bi translated">码头工人</li><li id="b79b" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">Nodejs</li><li id="b3e7" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">角度CLI</li><li id="40e3" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">饭桶</li></ul><h2 id="e118" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">实际上，我们将通过docker运行这些产品:</h2><ul class=""><li id="5b41" class="nb nc it kd b ke mf ki mg km nd kq ne ku nf ky ns nh ni nj bi translated">詹金斯</li><li id="6461" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">Gitlab</li><li id="5cd4" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">关系</li></ul></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="f1b1" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">1.装置</h1><p id="d911" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">首先我们在localhost上运行Nexus，Jenkins和Gitlab。为此，请运行以下命令:</p><h2 id="7ba8" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">1.1.联系:</h2><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="eaba" class="mp li it nu b gy ny nz l oa ob">docker pull sonatype/nexus3</span><span id="9d65" class="mp li it nu b gy oc nz l oa ob">docker run -d -p 8081:8081 --name nexus sonatype/nexus3</span></pre><p id="f7db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在新容器中启动服务可能需要一些时间(2-3分钟)。您可以跟踪日志以确定Nexus是否就绪:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="8e21" class="mp li it nu b gy ny nz l oa ob">docker logs -f nexus</span></pre><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/17798415bff3d543a96c058aea1cd477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-X9ozl-H-lsT3bcBYa86w.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">运行此程序后，您将转到<a class="ae kz" href="http://localhost:8081" rel="noopener ugc nofollow" target="_blank"> http://localhost:8081 </a>，并且必须看到此屏幕:</figcaption></figure><p id="44dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要获得Nexus的管理员密码。为此，我们必须执行以下命令:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="f91e" class="mp li it nu b gy ny nz l oa ob">docker exec -i -t nexus /bin/bash</span><span id="af25" class="mp li it nu b gy oc nz l oa ob">cat /nexus-data/admin.password</span></pre><p id="dfc4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后一个命令会给你密码</p><p id="4c6e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后单击登录，然后使用如下图所示的凭据:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/fca9c82a598be04f299591913470644e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4Xvjuq6JzyQm187yOYhcQ.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Nexus中的身份验证</figcaption></figure><p id="25f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用户:管理员<br/>密码:(在上一步中提供)</p><p id="e72d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，将出现一个向导弹出窗口，您必须按照自己的方式进行配置。</p><h2 id="454f" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">1.2.詹金斯:</h2><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="e037" class="mp li it nu b gy ny nz l oa ob">docker pull jenkins/jenkins:lts</span><span id="2563" class="mp li it nu b gy oc nz l oa ob">docker run -p 8080:8080 -p 50000:50000 -d — name jenkins jenkins/jenkins:lts</span></pre><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/c035f47b3a7132f52f94446b74150e5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTbcWKHIn_dHLKbVQZx27w.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">运行此程序后，您将转到<a class="ae kz" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>，并且必须看到此屏幕:</figcaption></figure><p id="7294" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">默认情况下，jenkins会在首次初始化时要求输入管理员密码。要获取此密码，请运行上面的命令</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="2139" class="mp li it nu b gy ny nz l oa ob">docker exec -i -t jenkins /bin/bash</span><span id="8485" class="mp li it nu b gy oc nz l oa ob">cat /var/jenkins_home/secrets/initialAdminPassword</span></pre><p id="e629" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制并粘贴屏幕上显示的代码，然后您将看到:</p><p id="99d8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个屏幕中，点击“安装推荐的插件”</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/ea0a9c5535485364f50d6d57dbdbc8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MSSgVaX6lgKATHQRcbOHw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">在此创建您的jenkins管理员用户。</figcaption></figure><p id="e8d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，创建您的管理员并登录，您将看到如下屏幕:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/d082e0c5e5ff8afa5978b8e5e7dfc00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qjSI_d38Wg7WsCAJEqPf3Q.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">詹金斯的初始页面</figcaption></figure><h2 id="0909" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">1.3.Gitlab:</h2><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="3164" class="mp li it nu b gy ny nz l oa ob">docker pull gitlab/gitlab-ce</span><span id="33aa" class="mp li it nu b gy oc nz l oa ob">sudo docker run -detach \<br/> -hostname localhost \<br/> -publish 443:443 -publish 80:80 -publish 22:22 \<br/> -name gitlab \<br/> -restart always \<br/>gitlab/gitlab-ce:latest</span></pre><p id="d828" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在新容器中启动服务可能需要一些时间(2-5分钟)。您可以跟踪日志以确定Gitlab是否准备好了:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="60cd" class="mp li it nu b gy ny nz l oa ob">docker logs -f gitlab</span></pre><p id="2590" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:当gitlab准备就绪时，您将看到一个更改root用户密码的屏幕。不要忘记此密码，它将在本指南的后续步骤中使用。</strong></p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/09226cecd766b4788f2d374d49585c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mlnd7vkfYy3MhtvnN-nYg.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Gitlab首屏</figcaption></figure><p id="cb40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击注册并创建您的帐户。</p><p id="76bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">登录，这将是屏幕。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi on"><img src="../Images/a8d34f59696563b85e24b06c26eb6199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OoIAGri_8DcwgXZTzuMtrw.png"/></div></div></figure><p id="0e9b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您已经具备了开始配置CI/CD管道的所有要求。所以，我们开始吧。</p></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="a043" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">2.创建项目</h1><p id="6ced" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">现在我们需要创建一个包含这个包的angular项目📦。</p><p id="c93f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，让我们运行以下命令来创建我们的angular应用程序:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="f6cf" class="mp li it nu b gy ny nz l oa ob">ng new &lt;my-app-name&gt;</span></pre><p id="961c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将创建一个angular应用程序，<strong class="kd iu">，但实际上它还不是库。</strong>这一点很重要，因为<strong class="kd iu">角度应用</strong>和<strong class="kd iu">角度库</strong>是两回事。本文的主题是库(或者我们在这里称之为组件/模块)。应用程序需要看到组件运行，但是组件(库)被隔离在其他地方。</p><p id="bdf1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">生成库的命令是</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="4e09" class="mp li it nu b gy ny nz l oa ob">ng generate library &lt;my-lib-name&gt;</span></pre><p id="5d40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将在“projects/ <my-lib-name>”上创建一个新目录，这是<strong class="kd iu">您的组件代码。</strong>在实践中，您将在此目录下编写组件。</my-lib-name></p><p id="c180" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，您的lib文件夹中有一个package.json。这意味着你实际上是在编写一个孤立的nodejs应用程序，你需要在组件中设置的所有东西(比如依赖关系、版本控制等)都必须在那里编辑。</p><p id="89a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要查看关于如何编写组件的更多细节，并查看它在项目中的运行情况，我建议阅读本文的<strong class="kd iu">部分1 </strong>:</p><div class="oo op gp gr oq or"><a href="https://medium.com/@esanjiv/complete-beginner-guide-to-publish-an-angular-library-to-npm-d42343801660" rel="noopener follow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd iu gy z fp ow fr fs ox fu fw is bi translated">向npm发布Angular库的完整初学者指南。</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">角度&gt; 6.0.0和角度&gt; 6.0.0的逐步指南</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf jz or"/></div></div></a></div><p id="8ed3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，是时候在gitlab发表了。发布整个angular应用程序是很重要的，因为这使得贡献者测试组件变得容易。</p><p id="3ba9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要在github上发布，运行以下命令:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="3119" class="mp li it nu b gy ny nz l oa ob">git init<br/>git remote add origin &lt;my-git-url&gt;<br/>git add .<br/>git commit -m "Initial commit"<br/>git push -u origin master</span></pre></div><div class="ab cl la lb hx lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="im in io ip iq"><h1 id="e4bb" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">3.配置Github、Gitlab和Jenkins</h1><p id="598f" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">一旦用angular项目创建了存储库，就需要将Jenkins与Gitlab连接起来。所以首先你需要在Jenkins中安装Gitlab插件。因此，点击“管理詹金斯”，然后转到“管理插件”。然后找到GitLab插件并安装它。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pg"><img src="../Images/4d68e94d11d94805cbc38dc47e4857d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0B985_54GPeEhMBqu3t66A.png"/></div></div></figure><p id="5ed3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要配置Jenkins和Gitlab。</p><h2 id="2630" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.1.配置Jenkins和Gitlab</h2><p id="726f" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">我们需要在詹金斯和Gitlab之间建立双向通信。但是为什么呢？</p><ol class=""><li id="0127" class="nb nc it kd b ke kf ki kj km np kq nq ku nr ky ng nh ni nj bi translated">需要Gitlab webhook通知Jenkins关于存储库的变化(Gitlab =&gt; Jenkins)。</li><li id="3e2b" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">Jenkins需要能够克隆存储库(Jenkins =&gt; Gitlab)。</li></ol><h2 id="6ecf" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated"><strong class="ak"> 3.2。将Gitlab Webhook预配置给Jenkins </strong></h2><p id="a36a" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">我们之前需要这个额外的步骤，<strong class="kd iu">因为在本文中我们通过docker </strong>在localhost上运行一切，而gitlab的webhook默认不允许设置本地地址。<strong class="kd iu">如果您没有在本地主机上运行，请跳过这一步。</strong></p><p id="9628" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要使gitlab允许webhook上的本地地址，您必须使用root凭证登录。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ph"><img src="../Images/2179aba5f1621377406bf942614f9d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-7He5zl9Kn4YU5AYMTXGw.png"/></div></div></figure><p id="081d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">登录后，您必须访问管理区(<a class="ae kz" href="http://localhost/admin" rel="noopener ugc nofollow" target="_blank"> http://localhost/admin </a>)</p><p id="c123" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您需要进入设置= &gt;网络</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pi"><img src="../Images/38eb6892c207df141666b55e049f48fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gHcDCroSzAkzoAS6FjXQUQ.png"/></div></div></figure><p id="e53b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后单击“出站请求”选项卡上的“扩展”，然后选中“允许从web挂钩和服务到本地网络的请求”</p><p id="5f02" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您需要将Jenkins的IP添加到白名单中。要获取Jenkins的IP，请运行以下命令:</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="6183" class="mp li it nu b gy ny nz l oa ob">docker inspect jenkins | grep IPAddress</span></pre><p id="c67d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">毕竟你的屏幕肯定是那样的:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pj"><img src="../Images/5cf5ac960677083cdadf78775973f21e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Md13IEDql4ZFKbDidkm2lw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">允许本地地址上的webhook</figcaption></figure><p id="f8ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，点击保存更改，一切都准备好了。</p><p id="3c6c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们需要配置詹金斯。</p><p id="5d1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击“管理詹金斯”，然后进入“配置系统”。现在我们需要在“Jenkins URL”配置上设置Jenkins的IP:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pk"><img src="../Images/cbed50f7a231e010bf6bdf2889f7a093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GLAcvULoMjTxoblvn2c8g.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">设置Jenkins URL</figcaption></figure><h2 id="386b" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.3.在Jenkins上配置Gitlab。</h2><p id="4939" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">在Gitlab上，你需要生成一个供Jenkins使用的令牌。为此，您必须进入“用户设置”= &gt;“访问令牌”。为这个令牌命名(我使用了“jenkins”)，并选择范围“API”(“Expire at”可以为空)，屏幕截图如下:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pl"><img src="../Images/dfd26216b68d61ff7b8a341bd22a27fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSYMaGX8ui-eq1w7g_2T-g.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">生成Gitlab令牌</figcaption></figure><p id="a4f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:在实际场景中，建议在gitlab上创建一个新用户，以便在jenkins上使用。在这篇文章中，我使用自己的帐户，这是不推荐的。</strong></p><p id="5b06" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击创建个人访问令牌，它将“生成一个访问令牌”。</p><p id="788e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:请记住，如果您离开此页面，您将无法再次看到此令牌。</strong></p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pm"><img src="../Images/307ff2c2ea8022ddb393252be4b725d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zrYzw6KdaXe8V8pRaxeSVA.png"/></div></div></figure><p id="f3b1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要转到Jenkins并在凭据上添加此令牌。要做到这一点，访问“凭证”，然后去范围詹金斯。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/14a8f980d1bf8a4300d312c6d38e71c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EOZHbC_dzrPhZlToQmZbMQ.png"/></div></div></figure><p id="7a83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，将鼠标放在上面，会出现一个插入符号，单击它，然后单击“添加凭证”。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi po"><img src="../Images/cd2bc2cd5120f1e8fc578bb81d2cf289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruySR1X5mXjbcNZUtWXC2A.png"/></div></div></figure><p id="d8ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，选择“GitLab API token ”,将上一步生成的令牌放入“API token ”,并在“ID”和“Description”中填写您想要的内容，然后单击“Ok”。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/a72ea079a90edeb270b276e25a026bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5cs7Jj-Q5SBMedl5oTctXw.png"/></div></div></figure><p id="550a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，转到“管理詹金斯”，然后“配置詹金斯”。在此页面中查找“gitlab”部分。像这样配置:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pp"><img src="../Images/9031a814b4102851941cadb12df8fcfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1i96Z8RTRB8oGjk8vxNbYA.png"/></div></div></figure><p id="e7f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:要发现Gitlab主机URL，请运行以下命令:</strong></p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="ad2b" class="mp li it nu b gy ny nz l oa ob">docker inspect gitlab | grep IPAddress</span></pre><h2 id="66a9" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.4.在詹金斯身上创造新的工作</h2><p id="68b4" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">之后，我们需要创建一个关于詹金斯的工作。为此，请登录Jenkins并点击“创建新工作”。</p><p id="82c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输入名称，选择自由式项目，然后单击确定。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pq"><img src="../Images/92bd311c6af50a43c9ae5696a954f078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfxbhfqX34tLGDQkArby5g.png"/></div></div></figure><p id="bcf8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一页是设置Gitlab库和webhook。</p><ul class=""><li id="48fa" class="nb nc it kd b ke kf ki kj km np kq nq ku nr ky ns nh ni nj bi translated">在存储库URL上放置Gitlab IP，而不是localhost(当您使用docker运行local时)</li><li id="8f96" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">在凭证中，点击“添加”,然后提供您的Gitlab帐户的用户名/密码。</li><li id="257f" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">在“分支说明符”中使用“主”</li><li id="dc48" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ns nh ni nj bi translated">在“构建触发器”部分，选中“将变更推送到GitLab时构建”选项。这将允许詹金斯建立一个包后，在主分支推动</li></ul><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pr"><img src="../Images/e5c6947b5d24423931b6ee012f775397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYor7aCfvspIOfbCQBnvAg.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">构建配置示例</figcaption></figure><p id="9843" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在复制Gitlab webhook url(在我的例子中是<a class="ae kz" href="http://172.17.0.3:8080/project/my-component-pipeline" rel="noopener ugc nofollow" target="_blank">http://172 . 17 . 0 . 3:8080/project/my-component-pipeline</a>)，让我们在Gitlab中设置webhook。</p><p id="39f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们需要从Jenkins生成一个令牌，以便Gitlab Webhook工作。为此，单击您的姓名，然后配置。所以在“API令牌部分”。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ps"><img src="../Images/b35e5795a1ae7a1e5ba56d40cea7ce30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a7o9_MMAk1JmVg0Sz6h1Pg.png"/></div></div></figure><p id="d667" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，您需要创建一个遵循以下格式的URL:</p><blockquote class="pt pu pv"><p id="011e" class="kb kc pw kd b ke kf kg kh ki kj kk kl px kn ko kp py kr ks kt pz kv kw kx ky im bi translated">http(s)://登录:token @ Jenkins _ URL:Jenkins _ port/project/job</p></blockquote><p id="70dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:这个URL是你在上一步复制的Gitlab webhook url。您只需在ip地址前添加“login:token@”(其中login是您的jenkins登录名，token是您在此步骤中生成的值)。</strong></p><p id="a778" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我的例子中，我制作了这个URL:</p><blockquote class="pt pu pv"><p id="7073" class="kb kc pw kd b ke kf kg kh ki kj kk kl px kn ko kp py kr ks kt pz kv kw kx ky im bi translated"><a class="ae kz" href="http://lucassklp:11390b872e4bf0ae3d661664f724f36c70@172.17.0.3:8080/project/my-component-pipeline" rel="noopener ugc nofollow" target="_blank">http://lucassklp:11390 b 872 e 4 BF 0 AE 3d 661664 f 724 f 36 c 70 @ 172 . 17 . 0 . 3:8080/project/my-component-pipeline</a></p></blockquote><h2 id="67e4" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.5.配置Gitlab webhook</h2><p id="52c0" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">现在我们需要配置gitlab webhook。要做到这一点，进入你的项目，然后去“设置”，然后“集成”。用您生成的URL填充“URL”字段。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qa"><img src="../Images/7b4eafafc74086bec0dbad7cf38e88ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrt1jXoHw6CDBFxLKwXlaw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Gitlab中的Webhook配置</figcaption></figure><p id="d8c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">添加webhook后，您可以对其进行测试。预期的结果是一切正常。在“项目挂钩”中，通过发送push事件来测试它。钩子必须返回HTTP 200:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qb"><img src="../Images/1ec07cecd4ed6df78340841fbd141cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNzYqOfRzlswEn6jbkgBgw.png"/></div></div></figure><p id="4fe5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后最后！！！！</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi gj"><img src="../Images/58aa52b4157c70b3d416bb4ac326fdcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C9uV-BoJ5dljKBCjUr3qRw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">构建从gitlab推送开始</figcaption></figure><h2 id="f1e5" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.6.配置构建过程</h2><p id="a657" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">Jenkins与Gitlab集成在一起，现在每次在master branch上进行推送时，它都能够获得源代码。</p><p id="572a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是我们需要构建组件。为此，我们需要在Jenkins上安装<a class="ae kz" href="https://plugins.jenkins.io/nodejs/" rel="noopener ugc nofollow" target="_blank"> nodejs插件</a>。</p><p id="5d56" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">安装插件后，进入“管理Jenkins”，然后进入“全局工具配置”。</p><p id="4b1b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，添加具有所需版本的nodejs的新安装，如下图所示:</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qc"><img src="../Images/0aa51ed2e47b8a72c6b8c4cbc1634db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eygfe9DWJ8YPTNc1kdRbvA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">Jenkins上的Nodejs插件配置</figcaption></figure><p id="c59b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，转到您的管道并设置您在“构建环境”中创建的nodejs安装。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qd"><img src="../Images/5887ec66fc0e5253dcf4ca678b91a95d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FTW2V-45z8-thxQK5JXIJw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">组件构建环境</figcaption></figure><p id="5f3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注意:为了完成这项工作，你必须在你的包中添加下面一行</strong></p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="6c35" class="mp li it nu b gy ny nz l oa ob">“scripts”: {<br/>   “build-component”: “ng build &lt;my-lib-name&gt;”<br/>}</span></pre><h2 id="c2f4" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.将Jenkins配置到Nexus</h2><p id="c468" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">首先我们需要配置Nexus。</p><p id="5029" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如本文开头所介绍的，Nexus提供了对许多存储库的支持，但是我们现在感兴趣的是npm存储库。</p><p id="8b7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要设置三个Nexus的存储库(我不会解释每个组件的细节，但会给你一个简介):</p><ol class=""><li id="4d3f" class="nb nc it kd b ke kf ki kj km np kq nq ku nr ky ng nh ni nj bi translated">托管-是放置您的包的“容器”。</li><li id="eae1" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">代理——如果在存储库中没有找到一个包，那么我们设置一个代理来在其他存储库中找到这个包。</li><li id="b354" class="nb nc it kd b ke nk ki nl km nm kq nn ku no ky ng nh ni nj bi translated">组——将多个存储库聚合成一个存储库。</li></ol><h2 id="50bb" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.1.创建存储库</h2><p id="8d92" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated"><strong class="kd iu">注意:你需要与管理员认证这样做。</strong></p><p id="996a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击“齿轮”</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qe"><img src="../Images/a9dae46360fc040646192e1398410c5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVsnSO6mLEl2KhN34jO7JA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">创建存储库—步骤1</figcaption></figure><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qf"><img src="../Images/1617a16fc57485f4a0e3ab531bdb6e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C38xaSyQTIQV3THJ46l9Yg.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">创建存储库—步骤2</figcaption></figure><h2 id="2746" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.2.创建托管的</h2><p id="c1c8" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">我们需要在nexus中存储我们的组件，所以我们需要创建一个托管存储库。</p><p id="af15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，重复第3.7.1节<strong class="kd iu">中定义的步骤，然后选择<strong class="kd iu"> npm(托管)。</strong></strong></p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qg"><img src="../Images/e789232044e2162e987b016584d06ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ivsAwM21d82FC4kdcS4fQ.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">创建托管存储库</figcaption></figure><p id="7e07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据需要填写名称(在本指南中，我将使用npm-private ),然后单击“创建存储库”</p><h2 id="4656" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.3.创建代理存储库</h2><p id="ff7d" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">现在，我们需要设置代理。为此，在选择<strong class="kd iu"> npm(代理)时，重复<strong class="kd iu">第3.7.1节中定义的步骤。</strong></strong></p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qh"><img src="../Images/8c41d250b3f961c0ae32692f0886c748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I_P-lkbcAQumdHEE46CFeA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">在nexus上创建npm代理存储库</figcaption></figure><p id="2167" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用您想要的任何东西填充名称(我将使用npm-proxy ),远程存储将使用公共npm注册表。URL地址是:</p><p id="152d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://registry.npmjs.org" rel="noopener ugc nofollow" target="_blank">https://registry.npmjs.org</a></p><h2 id="bf32" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.4.创建群组</h2><p id="4905" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">组是存储库的集合。我们需要就内部国家预防机制和国家预防机制代理达成一致。为此，在选择<strong class="kd iu"> npm(组)时，重复<strong class="kd iu">第3.7.1节中定义的步骤。</strong></strong></p><p id="119b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后设置组名，并移动存储库。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qi"><img src="../Images/73fe5f36096ce2b649ecd524ad347525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7s2eRXrtG3g99VJnaGrsw.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">在nexus上创建群组</figcaption></figure><h2 id="1b49" class="mp li it bd lj mq mr dn ln ms mt dp lr km mu mv lv kq mw mx lz ku my mz md na bi translated">3.7.5.在项目上设置默认存储库</h2><p id="bac3" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">首先，我们需要激活“npm承载令牌领域”。该领域允许拥有先前生成的不记名令牌的用户发布<em class="pw"> npm </em>包。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qj"><img src="../Images/69a9b702384b2fb3fcdffb88dcd108f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0txAbgn8IqN0K7XSKZ1tWQ.png"/></div></div></figure><p id="9aa8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，我们被允许使用nexus帐户发布来自Jenkins的包。</p><p id="901b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一点上，我们有一个接受新包的存储库，但我们不会从Jenkins发布它。那么，让我们来设置一下。</p><p id="1338" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要告诉npm默认的存储库来获取和发布包📦。这可以通过使用。npmrc文件。</p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="3b63" class="mp li it nu b gy ny nz l oa ob">registry=http://&lt;nexus-ip&gt;:&lt;nexus-port&gt;/repository/&lt;npm-group-repository&gt;/<br/>email=my-email@mail.com<br/>_auth=base64(“&lt;nexus-user&gt;:&lt;nexus-pass&gt;”)</span></pre><p id="b428" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">注1:此文件必须放在您的项目/ &lt; my-lib-name &gt; <br/>注2:这是您的群组库<br/>注3:不建议使用管理员帐户。请创建一个Jenkins帐户。</strong></p><p id="c386" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以获得依赖项，但是我们不能发布，因为托管存储库没有设置。为此，将以下节点添加到您的“项目/ <my-lib-name> /package.json”中:</my-lib-name></p><pre class="ml mm mn mo gt nt nu nv nw aw nx bi"><span id="78c1" class="mp li it nu b gy ny nz l oa ob">“publishConfig”: {<br/>   “registry”: “&lt;nexus-ip&gt;:&lt;nexus-port&gt;/repository/&lt;npm-hosted-repository&gt;/"<br/>},</span></pre><p id="9737" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们需要更新Jenkins上的脚本，以便在Nexus上发布软件包🚀。</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qk"><img src="../Images/f9cff596dd9e6fcfa90ed33f578f16fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvWLp1LZdHvFQXEiV4pKcQ.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">这是脚本的最终版本</figcaption></figure><p id="8d99" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，当您进行下一次提交时，您将在nexus上看到新版本的库，如示例所示🎉</p><figure class="ml mm mn mo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi qj"><img src="../Images/d89207c84891f5588c07eff458d6917f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RR0d-yLTCTBHaLtoJjgIXA.png"/></div></div><figcaption class="oe of gj gh gi og oh bd b be z dk translated">组件发生变化后，将发布新版本🎉</figcaption></figure><h1 id="4546" class="lh li it bd lj lk ql lm ln lo qm lq lr ls qn lu lv lw qo ly lz ma qp mc md me bi translated">4.结论</h1><p id="2d92" class="pw-post-body-paragraph kb kc it kd b ke mf kg kh ki mg kk kl km mh ko kp kq mi ks kt ku mj kw kx ky im bi translated">我们已经完成了重用角度组件的所有设置。现在，您可以跨项目重用您公司中的组件。尽管这篇文章很长，我还是错过了一些东西(比如开发过程、良好实践、自动测试等等)，但是我想以后再写这些要点。</p><p id="c8cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样。感谢你们的阅读，有任何问题，请告诉我=)</p></div></div>    
</body>
</html>