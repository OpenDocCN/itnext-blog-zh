<html>
<head>
<title>Deploy your react app on Backblaze and Cloudflare with Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github Actions在Backblaze和Cloudflare上部署react应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-your-react-app-on-backblaze-and-cloudflare-with-github-actions-93f09f2c67d5?source=collection_archive---------4-----------------------#2021-12-09">https://itnext.io/deploy-your-react-app-on-backblaze-and-cloudflare-with-github-actions-93f09f2c67d5?source=collection_archive---------4-----------------------#2021-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ddc8885036fa615198ac995156a008d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Far25Bk9CoTGTOcaQcceTw.png"/></div></div></figure><p id="d7de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署静态webapp有多种方式。静态的优点是一个简单的对象存储就足以服务于您的页面。您可以使用S3+Cloudfront或Github/Gitlab页面，今天我们将了解如何利用Backblaze + Cloudflare的低价来存储和提供您的内容。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="f581" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有一篇关于Backblaze使用他们的Cloudflare服务的<a class="ae ld" href="https://help.backblaze.com/hc/en-us/articles/217666928-Using-Backblaze-B2-with-the-Cloudflare-CDN" rel="noopener ugc nofollow" target="_blank">好文章</a>，我建议您在继续之前阅读。<strong class="ka ir">事实上，我已经看过几次几乎相同的文章，但对于一个个人项目，我发现它遗漏了2点。如何从您的CI/CD管道轻松部署，最重要的是，内容不是在域的根处提供</strong>。例句:https://photos.sarahandnilay.com/file/nilayp/*<a class="ae ld" href="https://photos.sarahandnilay.com/file/nilayp/*" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="b349" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">先决条件:</h1><ul class=""><li id="f1d4" class="mc md iq ka b kb me kf mf kj mg kn mh kr mi kv mj mk ml mm bi translated">backblaze中的公共桶(如Backblaze的帖子中所解释的)</li><li id="0695" class="mc md iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">在Cloudflare上配置了DNS的域。</li><li id="9046" class="mc md iq ka b kb mn kf mo kj mp kn mq kr mr kv mj mk ml mm bi translated">一个github repo和你的静态应用程序(react，hugo，…)</li></ul><h1 id="39e7" class="le lf iq bd lg lh ms lj lk ll mt ln lo lp mu lr ls lt mv lv lw lx mw lz ma mb bi translated">1/使用Github操作部署react应用程序</h1><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/bb7df4da1b76da9f441899c80a0d95c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bT6I9A2iny0WEWlgQk9-4w.png"/></div></div></figure><p id="c81f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Github actions是一个允许你在不同的事件上自动执行一些动作的特性，比如推一个分支，合并一个拉请求等等</p><p id="76e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们这里想要的工作流是测试我们的应用程序，然后将其构建为生产就绪，然后将其部署在Backblaze上。为此，我们需要安装b2，这是backblaze cli，我们将使用它来同步我们的文件。为了简化这个过程，我构建了这个动作，并将其明确命名为<a class="ae ld" href="https://github.com/marketplace/actions/install-backblaze-b2-cli" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">https://github . com/market place/actions/install-backblaze-B2-CLI</strong></a><strong class="ka ir">。</strong>喜欢就别忘了上星:)</p><p id="68e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是要复制到中的工作流程。github/worflows目录</p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="20e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里没有什么特别的，我们安装nodeJS，然后我们构建应用程序(这里是一个NextJS)，我们运行我们的测试，我们构建应用程序及其所有优化，并为生产做好准备。这一步的输出是我们需要部署的./out文件夹。</p><p id="d7df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在安装b2 cli，通过提供2个环境变量，我们将通过身份验证。在Backblaze中创建一个应用密钥，并在github secrets中报告key_id和密钥。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/fedf0ba341a71d52b094c18a3425277f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*7S2RVW-CkmA-CAF13calzA.png"/></div></figure><p id="cb00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，最后一步是同步我们的新应用程序到我们的b2桶。此时，您应该能够列出您的存储桶中的文件。点击任何一个和，然后点击“友好的网址”。<a class="ae ld" href="https://f000.backblazeb2.com/file/mybucket/index.html" rel="noopener ugc nofollow" target="_blank">https://f000.backblazeb2.com/file/mybucket/index.html</a>记下这个URL的域名。</p><h1 id="0fce" class="le lf iq bd lg lh ms lj lk ll mt ln lo lp mu lr ls lt mv lv lw lx mw lz ma mb bi translated">2/配置Cloudflare</h1><p id="3ad9" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">现在这里是其他帖子缺乏信息的地方。我们不希望我们的应用程序在https://my-awesome-app.com/file/mybucket/index.html的<a class="ae ld" href="https://my-awesome-app.com/file/mybucket/index.html" rel="noopener ugc nofollow" target="_blank">被提供，而是在https://my-awesome-app.com的</a><a class="ae ld" href="https://my-awesome-app.com" rel="noopener ugc nofollow" target="_blank">被提供，对吗？</a></p><p id="008f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据下面的截图配置您的DNS。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/f16df40a877f539fbeeeea0fc1c29a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WtRCwckpQKhUaffiDnukEQ.png"/></div></div></figure><p id="f2d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们现在需要2个转换规则。</p><h2 id="01e8" class="nj lf iq bd lg nk nl dn lk nm nn dp lo kj no np ls kn nq nr lw kr ns nt ma nu bi translated">1/剥离URL中的文件/我的存储桶</h2><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/6ab0eb7ea3cb715642e5e4a7e4fe9d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fx-fBsOGxAVayUGFhb6Rw.png"/></div></div></figure><p id="9649" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上这个规则说，如果域没有子域，对于所有的URL，用/file/my-awesome-app在内部重写URL。这将把正确的文件作为存储桶的目标。</p><h2 id="a131" class="nj lf iq bd lg nk nl dn lk nm nn dp lo kj no np ls kn nq nr lw kr ns nt ma nu bi translated">2/除掉index.html</h2><p id="5fff" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">不要忘记Backblaze是一个对象存储器，这意味着你必须指定你想要访问哪个对象。因为我们不想指定index.html，我们必须创建第二个转换规则。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/948b977d25cffb09d193045011de300d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cDp17nhXIQD5sE8omdXcGg.png"/></div></div></figure><p id="b4bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一条说，如果路径严格等于“/”，那么得到index.html对象。</p><p id="8f11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记在严格模式下配置您的SSL</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/95b4073384115e4f195e5fd41157205f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anHZg7-TLS88tmcdYvRXRQ.png"/></div></div></figure><p id="3082" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">瞧，你现在可以从你的域访问你的应用了。</p><h1 id="a3a2" class="le lf iq bd lg lh ms lj lk ll mt ln lo lp mu lr ls lt mv lv lw lx mw lz ma mb bi translated">结论</h1><p id="7383" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj nf kl km kn ng kp kq kr nh kt ku kv ij bi translated">我们已经看到了如何通过Github Actions和Cloudflare在Backblaze上轻松部署静态应用程序。这是一个非常简单的过程，也非常划算。</p></div></div>    
</body>
</html>