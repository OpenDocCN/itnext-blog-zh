<html>
<head>
<title>BLoC Pattern in Flutter explained with Real Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用实例解释颤振中阻塞模式</h1>
<blockquote>原文：<a href="https://itnext.io/bloc-pattern-in-flutter-explained-with-real-example-a858e69eb5b8?source=collection_archive---------0-----------------------#2020-10-05">https://itnext.io/bloc-pattern-in-flutter-explained-with-real-example-a858e69eb5b8?source=collection_archive---------0-----------------------#2020-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="aa25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将通过一个简单实际例子来学习状态管理中的阻塞模式。你可以在这里找到本教程的第二部分<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/theming-your-app-in-flutter-using-bloc-save-reload-62048a330584">。</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e1efe4383cb4274c7f672995f42c8b08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Vmnu_HtZsZDpZwL8.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">阻塞颤振状态管理</figcaption></figure><h1 id="3315" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak">观看视频教程</strong></h1><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="e084" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">订阅我的<a class="ae kl" href="https://www.youtube.com/channel/UC5lbdURzjB0irr-FTbjWN1A" rel="noopener ugc nofollow" target="_blank">频道</a>获取更多视频。</p><p id="d524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个例子，我们将尝试使用一个web服务。我们将要使用的服务是</p><p id="8e52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://jsonplaceholder.typicode.com/albums</p><p id="bb30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mc">什么集团？</em>T11】</strong></p><p id="c5e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">块有助于分离表示和业务逻辑。</p><p id="3dd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，简单地说，我们将在bloc文件中编写所有的业务逻辑。</p><p id="3812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mc">Bloc基本上做的是，它接受一个事件和一个状态，并返回一个新的状态，我们将使用它来更新UI。</em></p><p id="2ee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果已经阻塞，就不需要在应用程序中维护任何本地状态。</p><p id="b64e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始…</p><p id="2b4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将首先编写一个使用web服务的服务类。</p><h1 id="c957" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">添加依赖关系</h1><p id="67f1" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">打开您的<em class="mc"> pubspec.yaml </em>文件添加依赖项</p><p id="e0a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加本例所需的所有依赖项</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="2064" class="mn ld iq mj b gy mo mp l mq mr">dependencies:<br/>    flutter:<br/>        sdk: flutter    cupertino_icons: ^0.1.2<br/>    flutter_bloc: ^6.0.4<br/>    equatable: ^1.2.4<br/>    http: ^0.12.2</span></pre><p id="06cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> http </strong>包从web服务中获取数据。</p><p id="c355" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">颤振_阻塞</strong>用于使用阻塞模式。</p><p id="1772" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">等价的</strong>用于比较对象。</p><p id="dec6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们首先为服务响应创建模型类。</p><h1 id="b2f4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">模型类</h1><p id="b859" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">下面是服务响应的响应类</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="e459" class="mn ld iq mj b gy mo mp l mq mr">import 'dart:convert';</span><span id="7798" class="mn ld iq mj b gy ms mp l mq mr">List&lt;Album&gt; albumFromJson(String str) =&gt;<br/>    List&lt;Album&gt;.from(json.decode(str).map((x) =&gt; Album.fromJson(x)));</span><span id="435b" class="mn ld iq mj b gy ms mp l mq mr">String albumToJson(List&lt;Album&gt; data) =&gt;<br/>    json.encode(List&lt;dynamic&gt;.from(data.map((x) =&gt; x.toJson())));</span><span id="4747" class="mn ld iq mj b gy ms mp l mq mr">class Album {<br/>  Album({<br/>    this.userId,<br/>    this.id,<br/>    this.title,<br/>  });int userId;</span><span id="1c36" class="mn ld iq mj b gy ms mp l mq mr">  int id;<br/>  String title;</span><span id="4e27" class="mn ld iq mj b gy ms mp l mq mr">factory Album.fromJson(Map&lt;String, dynamic&gt; json) =&gt; Album(<br/>        userId: json["userId"],<br/>        id: json["id"],<br/>        title: json["title"],<br/>      );Map&lt;String, dynamic&gt; toJson() =&gt; {<br/>        "userId": userId,<br/>        "id": id,<br/>        "title": title,<br/>      };<br/>}</span></pre><p id="935a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们有了模型类，我们就为服务消费做好了准备。</p><p id="7012" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建服务文件并获取数据。</p><p id="fb89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个名为“<em class="mc"> services.dart </em>的新文件，并复制下面的。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a73d" class="mn ld iq mj b gy mo mp l mq mr">import 'package:flutter_demos/model/albums_list.dart';<br/>import 'package:http/http.dart' as http;<br/>import 'package:http/http.dart';abstract class AlbumsRepo {<br/>  Future&lt;List&lt;Album&gt;&gt; getAlbumList();<br/>}class AlbumServices implements AlbumsRepo {<br/>  //<br/>  static const _baseUrl = 'jsonplaceholder.typicode.com';<br/>  static const String _GET_ALBUMS = '/albums';<a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Future&lt;List&lt;Album&gt;&gt; getAlbumList() async {<br/>    Uri uri = Uri.https(_baseUrl, _GET_ALBUMS);<br/>    Response response = await http.get(uri);<br/>    List&lt;Album&gt; albums = albumFromJson(response.body);<br/>    return albums;<br/>  }<br/>}</span></pre><p id="bdce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们使用BLOC将数据发送到UI。</p><h1 id="f91a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">事件</h1><p id="54cf" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">这里我们只有一个事件— <em class="mc"> fetchAlbums </em>。</p><p id="235f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建一个名为<em class="mc"> events.dart </em>的类，并添加下面的枚举。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="417d" class="mn ld iq mj b gy mo mp l mq mr">enum AlbumEvents {<br/>  fetchAlbums,<br/>}</span></pre><h1 id="9560" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">州</h1><p id="40b6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">以下是我们开始从服务中获取相册时的状态。</p><p id="dd49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以通常我们会有状态…</p><ol class=""><li id="1b02" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">白蛋白初始状态</li><li id="62fa" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">白蛋白加载</li><li id="0734" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">装载白蛋白</li><li id="39d6" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">白蛋白列表错误</li></ol><p id="eb4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个名为“<em class="mc"> states.dart </em>的文件，并复制下面的代码。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="9170" class="mn ld iq mj b gy mo mp l mq mr">import 'package:equatable/equatable.dart';<br/>import 'package:flutter_demos/model/albums_list.dart';</span><span id="691b" class="mn ld iq mj b gy ms mp l mq mr">abstract class AlbumsState extends Equatable {<br/>  <a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  List&lt;Object&gt; get props =&gt; [];<br/>}</span><span id="772e" class="mn ld iq mj b gy ms mp l mq mr">class AlbumsInitState extends AlbumsState {}</span><span id="ee66" class="mn ld iq mj b gy ms mp l mq mr">class AlbumsLoading extends AlbumsState {}</span><span id="6996" class="mn ld iq mj b gy ms mp l mq mr">class AlbumsLoaded extends AlbumsState {<br/>  final List&lt;Album&gt; albums;<br/>  AlbumsLoaded({this.albums});<br/>}</span><span id="b698" class="mn ld iq mj b gy ms mp l mq mr">class AlbumsListError extends AlbumsState {<br/>  final error;<br/>  AlbumsListError({this.error});<br/>}</span></pre><p id="41cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们扩展了“Equatable”类，它有助于比较对象。它需要一个覆盖，我们可以提供需要比较的属性，以确定两个对象是否相等。为了简单起见，我们将保持它为空。</p><h1 id="81ee" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">阻止获取相册</h1><p id="e928" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">让我们创建一个名为“<strong class="jp ir"> AlbumsBloc </strong>的类，它扩展了Bloc。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5bbc" class="mn ld iq mj b gy mo mp l mq mr">import 'dart:io';<br/>import 'package:flutter_bloc/flutter_bloc.dart';<br/>import 'package:flutter_demos/api/exceptions.dart';<br/>import 'package:flutter_demos/api/services.dart';<br/>import 'package:flutter_demos/bloc/albums/events.dart';<br/>import 'package:flutter_demos/bloc/albums/states.dart';<br/>import 'package:flutter_demos/model/albums_list.dart';class AlbumsBloc extends Bloc&lt;AlbumEvents, AlbumsState&gt; {<br/>  <br/>  final AlbumsRepo albumsRepo;<br/>  List&lt;Album&gt; albums;AlbumsBloc({this.albumsRepo}) : super(AlbumsInitState());<a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Stream&lt;AlbumsState&gt; mapEventToState(AlbumEvents event) async* {<br/>    switch (event) {<br/>      case AlbumEvents.fetchAlbums:<br/>        yield AlbumsLoading();<br/>        try {<br/>          albums = await albumsRepo.getAlbumList();<br/>          yield AlbumsLoaded(albums: albums);<br/>        } on SocketException {<br/>          yield AlbumsListError(<br/>            error: NoInternetException('No Internet'),<br/>          );<br/>        } on HttpException {<br/>          yield AlbumsListError(<br/>            error: NoServiceFoundException('No Service Found'),<br/>          );<br/>        } on FormatException {<br/>          yield AlbumsListError(<br/>            error: InvalidFormatException('Invalid Response format'),<br/>          );<br/>        } catch (e) {<br/>          yield AlbumsListError(<br/>            error: UnknownException('Unknown Error'),<br/>          );<br/>        }break;<br/>    }<br/>  }<br/>}</span></pre><p id="1a16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的bloc类中，您可以看到我们有一个实例变量“AlbumsRepo”。</p><p id="9950" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您需要向BLoC构造函数提供一个初始状态。</p><p id="557f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们有了“AlbumsInitState”。</p><p id="1098" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“mapEventToState”是一个异步*函数，这意味着它可以在不终止函数的情况下返回数据。这里我们使用<strong class="jp ir"> yield </strong>在适当的时候返回专辑状态之一。</p><p id="7b22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">即当加载开始时…上述函数将向UI返回<em class="mc"> AlbumsLoading </em>状态，然后当数据返回时，随同相册返回'<em class="mc"> AlbumsLoaded </em>'，然后如果有任何错误，返回'<em class="mc"> AlbumsListError </em>'并带有适当的异常，最后这里是我们的异常类。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5862" class="mn ld iq mj b gy mo mp l mq mr">class NoInternetException {<br/>  var message;<br/>  NoInternetException(this.message);<br/>}class NoServiceFoundException {<br/>  var message;<br/>  NoServiceFoundException(this.message);<br/>}class InvalidFormatException {<br/>  var message;<br/>  InvalidFormatException(this.message);<br/>}class UnknownException {<br/>  var message;<br/>  UnknownException(this.message);<br/>}</span></pre><p id="e5ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你愿意，Dart允许抛出任何类作为异常。</p><h1 id="557c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">屏幕</h1><p id="1b97" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">现在让我们创建一个监听这些事件的屏幕。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="2c0c" class="mn ld iq mj b gy mo mp l mq mr">import 'package:flutter/material.dart';<br/>import 'package:flutter_bloc/flutter_bloc.dart';<br/>import 'package:flutter_demos/bloc/albums/bloc.dart';<br/>import 'package:flutter_demos/bloc/albums/events.dart';<br/>import 'package:flutter_demos/bloc/albums/states.dart';<br/>import 'package:flutter_demos/model/albums_list.dart';<br/>import 'package:flutter_demos/widgets/error.dart';<br/>import 'package:flutter_demos/widgets/list_row.dart';<br/>import 'package:flutter_demos/widgets/loading.dart';</span><span id="721b" class="mn ld iq mj b gy ms mp l mq mr">class AlbumsScreen extends StatefulWidget {<br/>  <a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  _AlbumsScreenState createState() =&gt; _AlbumsScreenState();<br/>}</span><span id="0005" class="mn ld iq mj b gy ms mp l mq mr">class _AlbumsScreenState extends State&lt;AlbumsScreen&gt; {<br/>  //<br/>  <a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  void initState() {<br/>    super.initState();<br/>    _loadAlbums();<br/>  }</span><span id="8d06" class="mn ld iq mj b gy ms mp l mq mr">_loadAlbums() async {<br/>    context.bloc&lt;AlbumsBloc&gt;().add(AlbumEvents.fetchAlbums);<br/>  }</span><span id="b789" class="mn ld iq mj b gy ms mp l mq mr"><a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Text('Albums'),<br/>      ),<br/>      body: Container(<br/>        child: _body(),<br/>      ),<br/>    );<br/>  }</span><span id="84f8" class="mn ld iq mj b gy ms mp l mq mr">_body() {<br/>    return Column(<br/>      children: [<br/>        BlocBuilder&lt;AlbumsBloc, AlbumsState&gt;(<br/>            builder: (BuildContext context, AlbumsState state) {<br/>          if (state is AlbumsListError) {<br/>            final error = state.error;<br/>            String message = '${error.message}\nTap to Retry.';<br/>            return ErrorTxt(<br/>              message: message,<br/>              onTap: _loadAlbums,<br/>            );<br/>          }<br/>          if (state is AlbumsLoaded) {<br/>            List&lt;Album&gt; albums = state.albums;<br/>            return _list(albums);<br/>          }<br/>          return Loading();<br/>        }),<br/>      ],<br/>    );<br/>  }</span><span id="1647" class="mn ld iq mj b gy ms mp l mq mr">Widget _list(List&lt;Album&gt; albums) {<br/>    return Expanded(<br/>      child: ListView.builder(<br/>        itemCount: albums.length,<br/>        itemBuilder: (_, index) {<br/>          Album album = albums[index];<br/>          return ListRow(album: album);<br/>        },<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="9b16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们创建的AlbumsScreen有一个名为BlocBuilder的小部件，它具有类型“AlbumsBloc和AlbumsState”。这个小部件将监听来自bloc文件的更改并更新UI。</p><p id="1dcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，您可以看到BlocBuilder有一个“Builder”属性，该属性有一个状态变量，可以让我们访问返回的状态。</p><p id="a41f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那我们怎么触发它。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="c2e7" class="mn ld iq mj b gy mo mp l mq mr">context.bloc&lt;AlbumsBloc&gt;().add(AlbumEvents.fetchAlbums);</span></pre><p id="ce8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述调用将触发“fetchAlbums”事件，该事件将触发阻塞并返回状态。最初它将返回AlbumLoading状态，然后如果调用成功，它将返回AlbumsLoaded状态等。Rest很简单，根据状态更新UI。当调用成功时，我们在这里显示一个相册列表。</p><h1 id="dd6e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">主要部分</h1><p id="fbe6" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated"><strong class="jp ir"> BlocBuilder </strong>接收事件来更新UI。但是应该有提供者，正确。所以您需要用BlocProvider包装AlbumsScreen。所以我们的想法是，想要监听AlbumBloc更新的屏幕应该用下面的<strong class="jp ir"> BlocProvider </strong>包装自己。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4b38" class="mn ld iq mj b gy mo mp l mq mr">class MyApp extends StatelessWidget {<br/>  <a class="ae kl" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Bloc Demo',<br/>      debugShowCheckedModeBanner: false,<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.blue,<br/>        visualDensity: VisualDensity.adaptivePlatformDensity,<br/>      ),<br/>      home: BlocProvider(<br/>        create: (context) =&gt; AlbumsBloc(albumsRepo: AlbumServices()),<br/>        child: AlbumsScreen(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="d037" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，您可以看到“AlbumsBloc”正在接收“album services”repo，该repo获取相册。</p><p id="75e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/a2027443ce23d14fa76229c4edc7431d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kKGv_1v-K1W4lyWw.png"/></div></div></figure><p id="b4da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">喜欢这个帖子的请鼓掌…</p><p id="1110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住，你最多可以打50个拍子。</p><p id="8b02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="mc">如果你觉得我的文章有用，请给我买杯咖啡</em> </strong></p><div class="ni nj gp gr nk nl"><a href="https://www.buymeacoffee.com/vipinvijayan" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd ir gy z fp nq fr fs nr fu fw ip bi translated">Vipin Vijayan</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">嘿👋我刚刚在这里创建了一个页面。你现在可以给我买杯咖啡了！</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.buymeacoffee.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz kw nl"/></div></div></a></div><h1 id="1429" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">源代码</h1><p id="657a" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated"><a class="ae kl" href="https://bitbucket.org/vipinvijayan1987/tutorialprojects/src/BlocSimple/FlutterTutorialProjects/flutter_demos/" rel="noopener ugc nofollow" target="_blank">https://bit bucket . org/vipinvijayan 1987/tutorial projects/src/bloc simple/fluttertutorial projects/flutter _ demos/</a></p></div></div>    
</body>
</html>