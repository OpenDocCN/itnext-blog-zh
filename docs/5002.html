<html>
<head>
<title>This is more than a MicroK8s GitHub action</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这不仅仅是一个MicroK8s GitHub动作</h1>
<blockquote>原文：<a href="https://itnext.io/this-is-more-than-a-microk8s-github-action-6a531cdc7b95?source=collection_archive---------3-----------------------#2020-11-14">https://itnext.io/this-is-more-than-a-microk8s-github-action-6a531cdc7b95?source=collection_archive---------3-----------------------#2020-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/90206e290faeb5c25eec0c2d559803a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*X8BNuPL8-R6s4Xs1KiaQEA.png"/></div></figure><p id="b76b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你现在可能听说过<a class="ae ks" href="https://microk8s.io/" rel="noopener ugc nofollow" target="_blank">micro k8s</a>；“适用于集群、笔记本电脑、物联网和边缘的最小、最简单的纯生产Kubernetes ”,只需一个命令即可安装:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="ddc4" class="lc ld iq ky b gy le lf l lg lh">sudo snap install microk8s --classic</span></pre><p id="c828" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在有一个MicroK8s <a class="ae ks" href="https://github.com/marketplace/actions/microk8s-action" rel="noopener ugc nofollow" target="_blank"> GitHub action </a>可以用来CI你的项目。让我们看看如何利用它。</p><h1 id="c0f4" class="li ld iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">您的简单项目到CI</h1><p id="ce23" class="pw-post-body-paragraph ju jv iq jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">我们拥有的<a class="ae ks" href="https://github.com/ktsakalozos/SimpleProject" rel="noopener ugc nofollow" target="_blank">玩具项目</a>包含一个部署清单:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="1e3d" class="lc ld iq ky b gy le lf l lg lh">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: nginx-deployment<br/>  labels:<br/>    app: nginx<br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: nginx<br/>        image: nginx:1.14.2<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="d3c7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对于每个拉取请求，我们都希望<code class="fe mk ml mm ky b">kubectl apply</code>这个部署，并确保nginx仍然能够响应。为此，我们在<code class="fe mk ml mm ky b">.github/workflows/</code>下创建一个包含以下内容的文件:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="088f" class="lc ld iq ky b gy le lf l lg lh">name: Test Microk8s<br/>on:<br/>  pull_request:<br/>    branches: [ master ]<br/>jobs:<br/>  test:<br/>    runs-on: ubuntu-latest<br/>    name: Install MicroK8s<br/>    steps:<br/>    - uses: balchua/microk8s-actions@v0.1.3<br/>      with:<br/>        channel: 'latest/stable'<br/>    - name: Checkout<br/>      uses: actions/checkout@v2<br/>    - name: Test nginx<br/>      id: Nginx<br/>      run: |<br/>        set -ex<br/>        kubectl apply -f ${{ github.workspace }}/deploy/nginx.yaml<br/>        kubectl expose deployment nginx-deployment --name nginx-srv2 --cluster-ip=10.152.183.210<br/>        kubectl rollout status deployment/nginx-deployment<br/>        curl 10.152.183.210 | grep nginx<br/></span></pre><p id="1f3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在此工作流文件的最顶端，我们请求在针对主分支的每个拉请求上运行操作:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="74cc" class="lc ld iq ky b gy le lf l lg lh">on:<br/>  pull_request:<br/>    branches: [ master ]</span></pre><p id="4b90" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在准备阶段，这个工作流从<code class="fe mk ml mm ky b">latest/stable</code>渠道安装MicroK8s，并检查要测试的代码:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="deec" class="lc ld iq ky b gy le lf l lg lh">    - uses: balchua/microk8s-actions@v0.1.3<br/>      with:<br/>        channel: 'latest/stable'<br/>    - name: Checkout<br/>      uses: actions/checkout@v2</span></pre><p id="a70d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们针对某个特定的Kubernetes版本，我们可以设置适当的<code class="fe mk ml mm ky b"><a class="ae ks" href="https://microk8s.io/docs/setting-snap-channel" rel="noopener ugc nofollow" target="_blank">channel</a>.</code> MicroK8s包，并在几乎与上游相同的日子发布Kubernetes。发行版包括补丁和预稳定修订版。K8s发布日你没有被破的借口:)。</p><p id="8db1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">除了<code class="fe mk ml mm ky b">channel</code>之外，此时您还可以启用<code class="fe mk ml mm ky b">dns</code>和<code class="fe mk ml mm ky b">RBAC</code>。请务必查看<a class="ae ks" href="https://github.com/marketplace/actions/microk8s-action" rel="noopener ugc nofollow" target="_blank">行动页面</a>以获取更新。</p><p id="5c39" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来是我们进行实际测试的部分:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d1cf" class="lc ld iq ky b gy le lf l lg lh">- name: Test nginx<br/>      id: Nginx<br/>      run: |<br/>        set -ex<br/>        kubectl apply -f ${{ github.workspace }}/deploy/nginx.yaml<br/>        kubectl expose deployment nginx-deployment --name nginx-srv2 --cluster-ip=10.152.183.210<br/>        kubectl rollout status deployment/nginx-deployment<br/>        curl 10.152.183.210 | grep nginx</span></pre><p id="c47f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们应用<code class="fe mk ml mm ky b">nginx.yaml</code>清单，将其暴露在特定的集群IP中，并测试nginx是否响应。</p><p id="4c69" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">实际上，你的测试工作流程会更加复杂。例如，您可能希望启用本地注册表，构建一个或多个docker映像，部署基础设施的迷你版本，并运行一些集成测试。看看关于如何使用本地注册表来完成这些任务的官方文档。</p><p id="4f6c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">去吧！提交一份PR，让GitHub行动让你保持正轨。</p><h1 id="237a" class="li ld iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">这怎么比GitHub的动作还多？</h1><p id="5eb2" class="pw-post-body-paragraph ju jv iq jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">你可能已经注意到MicroK8s GitHub动作不是由Canonical或Ubuntu提供的，而是来自于<a class="ae ks" href="https://github.com/balchua" rel="noopener ugc nofollow" target="_blank"> @balchua </a>。<a class="ae ks" href="https://github.com/balchua" rel="noopener ugc nofollow" target="_blank"> @balchua </a>是MicroK8s社区非常活跃的成员。本着真正的ubuntu精神，他一直在bug分类、代码审查、功能提议/实现/维护方面提供帮助，并在一些伟大的MicroK8s相关项目中工作，如我们展示的GitHub action和<a class="ae ks" href="https://github.com/balchua/do-microk8s" rel="noopener ugc nofollow" target="_blank"> Terraforming DigitalOcean </a>。</p><p id="4b59" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果没有你们<a class="ae ks" href="https://github.com/balchua" rel="noopener ugc nofollow" target="_blank"> @balchua </a>，MicroK8s就不会这样。我个人非常感谢您和其他贡献者所做的工作，<a class="ae ks" href="https://github.com/inercia" rel="noopener ugc nofollow" target="_blank"> @inercia </a> <a class="ae ks" href="https://github.com/apnar" rel="noopener ugc nofollow" target="_blank">、</a><a class="ae ks" href="https://github.com/iskitsas" rel="noopener ugc nofollow" target="_blank">@ apnar</a>、<a class="ae ks" href="https://github.com/iskitsas" rel="noopener ugc nofollow" target="_blank"> @iskitsas </a>、<a class="ae ks" href="https://github.com/cyril-corbon" rel="noopener ugc nofollow" target="_blank"> @cyril-corbon </a>、<a class="ae ks" href="https://github.com/trulede" rel="noopener ugc nofollow" target="_blank">、@trulede </a>、<a class="ae ks" href="https://github.com/marcobellaccini" rel="noopener ugc nofollow" target="_blank">、@marcobellaccini </a>、<a class="ae ks" href="https://github.com/hpidcock" rel="noopener ugc nofollow" target="_blank">、@hpidcock </a>、<a class="ae ks" href="https://github.com/double73" rel="noopener ugc nofollow" target="_blank"> @double73 </a>、<a class="ae ks" href="https://github.com/nepython" rel="noopener ugc nofollow" target="_blank"> @nepython </a>、<a class="ae ks" href="https://github.com/nepython" rel="noopener ugc nofollow" target="_blank"> </a><a class="ae ks" href="https://github.com/giorgos-apo" rel="noopener ugc nofollow" target="_blank"> @giorgos-apo </a>、<a class="ae ks" href="https://github.com/davecahill" rel="noopener ugc nofollow" target="_blank"> @davecahill </a>、<a class="ae ks" href="https://github.com/dangtrinhnt" rel="noopener ugc nofollow" target="_blank"> @dangtrinhnt </a>、<a class="ae ks" href="https://github.com/giner" rel="noopener ugc nofollow" target="_blank"> @giner </a>、<a class="ae ks" href="https://github.com/rlankfo" rel="noopener ugc nofollow" target="_blank"> @rlankfo </a>、<a class="ae ks" href="https://github.com/nobusugi246" rel="noopener ugc nofollow" target="_blank"> @nobusugi246 </a>、<a class="ae ks" href="https://github.com/fabrichter" rel="noopener ugc nofollow" target="_blank"> @fabrichter </a>、<a class="ae ks" href="https://github.com/icanhazbroccoli" rel="noopener ugc nofollow" target="_blank"> @icanhazbroccoli </a>、<a class="ae ks" href="https://github.com/greenyouse" rel="noopener ugc nofollow" target="_blank"> @greenyouse </a>、<a class="ae ks" href="https://github.com/joestringer" rel="noopener ugc nofollow" target="_blank"> </a><a class="ae ks" href="https://github.com/waquidvp" rel="noopener ugc nofollow" target="_blank"> @waquidvp </a>，<a class="ae ks" href="https://github.com/khteh" rel="noopener ugc nofollow" target="_blank"> @khteh </a>，<a class="ae ks" href="https://github.com/keshavdv" rel="noopener ugc nofollow" target="_blank">@ keshadvv</a>，<a class="ae ks" href="https://github.com/klarose" rel="noopener ugc nofollow" target="_blank"> @klarose </a>，<a class="ae ks" href="https://github.com/davefinster" rel="noopener ugc nofollow" target="_blank"> @davefinster </a>，<a class="ae ks" href="https://github.com/miguelgarcia" rel="noopener ugc nofollow" target="_blank"> @miguelgarcia </a>，<a class="ae ks" href="https://github.com/lhotari" rel="noopener ugc nofollow" target="_blank"> @lhotari </a>，do。</p><h1 id="9927" class="li ld iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">链接</h1><div class="mn mo gp gr mp mq"><a href="https://microk8s.io/" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">MicroK8s -面向开发人员、edge和物联网的零运营Kubernetes | MicroK8s</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">sudo snap安装microk8s - classic没有snap命令？获取快照设置microk8s启用仪表板dns…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">microk8s.io</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne js mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://github.com/ubuntu/microk8s" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">ubuntu/microk8s</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">单包完全兼容的轻量级Kubernetes，可在42种风格的Linux上运行。完美适用于:典范力量…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="nf l nb nc nd mz ne js mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://github.com/marketplace/actions/microk8s-action" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">MicroK8s行动- GitHub市场</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">GitHub Action MicroK8s是轻量级纯上游K8s。最小最简单的纯量产K8s。对于集群…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="ng l nb nc nd mz ne js mq"/></div></div></a></div><div class="mn mo gp gr mp mq"><a href="https://github.com/balchua/do-microk8s" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">balchua/do-microk8s</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">使用Terraform引导数字海洋中的高可用MicroK8s集群。例如，引导1个主节点和…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">github.com</p></div></div><div class="mz l"><div class="nh l nb nc nd mz ne js mq"/></div></div></a></div></div></div>    
</body>
</html>