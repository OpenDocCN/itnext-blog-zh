<html>
<head>
<title>Velo by Wix: Imitating hover event on repeater container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Velo by Wix:模仿repeater容器上的悬停事件</h1>
<blockquote>原文：<a href="https://itnext.io/corvid-by-wix-imitating-hover-event-on-repeater-container-a65f4b6e0301?source=collection_archive---------1-----------------------#2019-10-29">https://itnext.io/corvid-by-wix-imitating-hover-event-on-repeater-container-a65f4b6e0301?source=collection_archive---------1-----------------------#2019-10-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bacf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl"> Velo API不提供repeater容器上的悬停事件。在这篇文章中，我们看看如何模仿悬停事件的一种方法。</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/a02242d823dd42c06930a2aa07aab733.png" data-original-src="https://miro.medium.com/v2/resize:fit:574/format:webp/1*lxBFPT5ZZSL2NwnbDMkowQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><a class="ae ky" href="https://shoonia.site/corvid-imitate-hover-event" rel="noopener ugc nofollow" target="_blank">我博客上的这篇文章</a></figcaption></figure><h1 id="9ac3" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">动机</h1><p id="5bc2" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我们有一个包含用户卡项目的<code class="fe mc md me mf b">$w.Repeater</code>组件。当我们用鼠标光标指向某个项目时，我们希望将该项目的背景色改为浅蓝色<code class="fe mc md me mf b">#CCE4F7</code>,当光标离开该项时，我们希望返回初始的白色。</p><p id="f0dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，我们将使用另外两个提供repeater API的事件:</p><ul class=""><li id="c620" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><code class="fe mc md me mf b"><a class="ae ky" href="https://www.wix.com/velo/reference/$w/element/onmousein" rel="noopener ugc nofollow" target="_blank">onMouseIn()</a></code>当鼠标指针移动到元素上时运行。</li><li id="8b68" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe mc md me mf b"><a class="ae ky" href="https://www.wix.com/velo/reference/$w/element#onMouseOut" rel="noopener ugc nofollow" target="_blank">onMouseOut()</a></code>当鼠标指针离开元素时运行</li></ul><p id="eb70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，重复项没有属性<code class="fe mc md me mf b"><a class="ae ky" href="https://www.wix.com/velo/reference/$w/style/backgroundcolor" rel="noopener ugc nofollow" target="_blank">style.backgroundColor</a></code>来改变元素的背景颜色。但是我们可以使用<code class="fe mc md me mf b"><a class="ae ky" href="https://www.wix.com/velo/reference/$w/background/background" rel="noopener ugc nofollow" target="_blank">background.src</a> </code>属性来改变背景图像。这样，我们将使用单像素图像。</p><p id="8507" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ky" href="https://static.wixstatic.com/media/e3b156_df544ca8daff4e66bc7714ebc7bf95f1~mv2.png" rel="noopener ugc nofollow" target="_blank">这里是单像素图像</a></p><h1 id="5464" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated"><strong class="ak">事件处理程序</strong></h1><p id="88e1" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">首先，为<code class="fe mc md me mf b">onMouse{<strong class="jp ir">In</strong>/<strong class="jp ir">Out</strong>}</code>事件设置处理程序。我们将通过repeaters容器为两个事件使用一个函数。我们在上面声明了处理函数，并将函数名作为参数传递给容器方法。</p><pre class="kn ko kp kq gt mu mf mv mw aw mx bi"><span id="c234" class="my la iq mf b gy mz na l nb nc"><strong class="mf ir">const</strong> items = [ <em class="kl">/* here are our users */</em> ];</span><span id="333c" class="my la iq mf b gy nd na l nb nc"><strong class="mf ir">function</strong> imitateHover(event) {<br/>  <em class="kl">// our handler for containers</em><br/>}<br/><br/>$w.onReady(<strong class="mf ir">function</strong> () {<br/>  $w("#repeater1").data = items;</span><span id="9aff" class="my la iq mf b gy nd na l nb nc">  $w("#container1").onMouseIn(imitateHover); <em class="kl">// set handler</em><br/>  $w("#container1").onMouseOut(imitateHover);<br/>});</span></pre><p id="2047" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我们不会为了添加处理程序而将任何容器项嵌套到repeater中。像这样:</p><pre class="kn ko kp kq gt mu mf mv mw aw mx bi"><span id="3eff" class="my la iq mf b gy mz na l nb nc"><em class="kl">// In this way, each time when onItemReady starts would be set a new handler for containers.</em></span><span id="04e5" class="my la iq mf b gy nd na l nb nc">$w("#repeater1").onItemReady( (<!-- -->$item, itemData, index) =&gt;<!-- --> {<br/>  $item("#container1").onMouseIn(imitateHover);<br/>  $item("#container1").onMouseOut(imitateHover);<br/>});</span></pre><p id="7e2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们用<code class="fe mc md me mf b">$w()</code>选择器在所有<code class="fe mc md me mf b">#container1</code>上全局设置我们的处理程序。而且效果很好！</p><h1 id="c053" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">模仿悬停</h1><p id="f522" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我们对两个事件使用一个函数，因此我们需要监听哪种类型的事件正在发生。我们预计有两种事件类型:</p><ul class=""><li id="9968" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><code class="fe mc md me mf b">event.type === "mouseenter"</code>当<code class="fe mc md me mf b">onMouse<strong class="jp ir">In</strong>()</code>运行时。</li><li id="5048" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><code class="fe mc md me mf b">event.type === "mouseleave"</code>当<code class="fe mc md me mf b">onMouse<strong class="jp ir">Out</strong>()</code>运行时。</li></ul><p id="2c25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看代码:</p><pre class="kn ko kp kq gt mu mf mv mw aw mx bi"><span id="f68a" class="my la iq mf b gy mz na l nb nc"><strong class="mf ir">function</strong> imitateHover(event) {<br/>  <strong class="mf ir">if</strong> (event.type === "mouseenter") {<br/>    console.log("we have mouseenter if onMouseIn() is running");<br/>  }<br/><br/>  <strong class="mf ir">if</strong> (event.type === "mouseleave") {<br/>    console.log("we have mouseleave if onMouseOut() is running");<br/>  }<br/>}<br/><br/>$w.onReady(<strong class="mf ir">function</strong> () {<br/>  $w("#repeater1").data = items;<br/>  $w("#container1").onMouseIn(imitateHover);<br/>  $w("#container1").onMouseOut(imitateHover);<br/>});</span></pre><p id="8ead" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对象<code class="fe mc md me mf b">event</code>总是会与当前容器中的项目保持一致，也就是我们所指的鼠标光标。我们可以通过<code class="fe mc md me mf b">event.target</code>改变容器的<code class="fe mc md me mf b">background.src </code>属性。</p><pre class="kn ko kp kq gt mu mf mv mw aw mx bi"><span id="b855" class="my la iq mf b gy mz na l nb nc"><em class="kl">// link to one pixel image</em><br/><strong class="mf ir">const</strong> HOVER_PNG = "https://static.wixstatic.com/media/e3b156_df544ca8daff4e66bc7714ebc7bf95f1~mv2.png";</span><span id="7bc1" class="my la iq mf b gy nd na l nb nc"><strong class="mf ir">function</strong> imitateHover(event) {<br/>  <em class="kl">// when the cursor over container then set image.</em><br/>  <strong class="mf ir">if</strong> (event.type === "mouseenter") {<br/>    event.target.background.src = HOVER_PNG;<br/>  }<br/>  <strong class="mf ir">if</strong> (event.type === "mouseleave") {<br/>    <em class="kl">// when the cursor is gone then remove the pixel image.</em><br/>    event.target.background.src = "";<br/>  }<br/>}<br/><br/>$w.onReady(<strong class="mf ir">function</strong> () {<br/>  $w("#repeater1").data = items;<br/>  $w("#container1").onMouseIn(imitateHover);<br/>  $w("#container1").onMouseOut(imitateHover);<br/>});</span></pre><p id="c357" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了！有效:<a class="ae ky" href="https://shoonia.wixsite.com/blog/imitate-hover-event-on-corvid" rel="noopener ugc nofollow" target="_blank">演示</a></p><h1 id="eba7" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">单像素图像</h1><p id="907c" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我们使用了到单像素图像的直接链接。这个图像的大小只有70字节。例如，这个图片的链接有82个字符长，82个字节。链接比图像占用更多的内存。\_(ツ)_/</p><h2 id="8f1d" class="my la iq bd lb ne nf dn lf ng nh dp lj jy ni nj ln kc nk nl lr kg nm nn lv no bi translated">数据:URL</h2><p id="7b79" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URL</a>，这是一种协议，允许将嵌入式小文件作为字符串内嵌在文档中。这意味着我们可以将一个像素的PNG图像转换成字符串，并将其传递给<code class="fe mc md me mf b">background.src.</code></p><p id="c609" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过<a class="ae ky" href="https://shoonia.github.io/1x1/#cce4f7ff" rel="noopener ugc nofollow" target="_blank"> 1x1 PNG生成器</a>创建需要的图像。</p><pre class="kn ko kp kq gt mu mf mv mw aw mx bi"><span id="11cd" class="my la iq mf b gy mz na l nb nc">// <em class="kl">one-pixel image encoded to base64</em><strong class="mf ir"><br/>const</strong> HOVER_PNG = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM88+R7PQAIUwMo5M6pSAAAAABJRU5ErkJggg==';</span><span id="b97c" class="my la iq mf b gy nd na l nb nc"><strong class="mf ir">function</strong> imitateHover(event) {<br/>  <strong class="mf ir">if</strong> (event.type === "mouseenter") {<br/>    event.target.background.src = HOVER_PNG;<br/>  }<br/>  <strong class="mf ir">if</strong> (event.type === "mouseleave") {<br/>    event.target.background.src = "";<br/>  }<br/>}<br/><br/>$w.onReady(<strong class="mf ir">function</strong> () {<br/>  $w("#repeater1").data = items;<br/>  $w("#container1").onMouseIn(imitateHover);<br/>  $w("#container1").onMouseOut(imitateHover);<br/>});</span></pre><p id="5a3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mc md me mf b">data:URL</code>图像比该图像的直接链接稍长。和其他原因使用<code class="fe mc md me mf b">data:URL</code>的小图像，我们不发送HTTP请求获取这个图像。</p><h1 id="12b9" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">资源</h1><ul class=""><li id="3ea9" class="mg mh iq jp b jq lx ju ly jy np kc nq kg nr kk ml mm mn mo bi translated"><a class="ae ky" href="https://www.wix.com/velo/reference/api-overview/introduction" rel="noopener ugc nofollow" target="_blank">Velo API</a></li><li id="a8ab" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URL MDN</a></li><li id="8f21" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><a class="ae ky" href="https://shoonia.github.io/1x1/" rel="noopener ugc nofollow" target="_blank"> 1x1 PNG发生器</a></li><li id="937b" class="mg mh iq jp b jq mp ju mq jy mr kc ms kg mt kk ml mm mn mo bi translated"><a class="ae ky" href="https://shoonia.site/corvid-imitate-hover-event/" rel="noopener ugc nofollow" target="_blank">我博客上的这篇文章</a></li></ul></div></div>    
</body>
</html>