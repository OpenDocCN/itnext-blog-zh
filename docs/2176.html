<html>
<head>
<title>Benchmark results of Kubernetes network plugins (CNI) over 10Gbit/s network (Updated: April 2019)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes网络插件(CNI)在10Gbit/s网络上的性能指标评测结果(更新时间:2019年4月)</h1>
<blockquote>原文：<a href="https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-april-2019-4a9886efe9c4?source=collection_archive---------1-----------------------#2019-04-12">https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-april-2019-4a9886efe9c4?source=collection_archive---------1-----------------------#2019-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="251e" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">新版本可用时间:2020年</strong></h1><p id="7d16" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章现在有点旧了，已经更新了。看看吧！</p><p id="430c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><a class="ae lo" rel="noopener ugc nofollow" target="_blank" href="/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-august-2020-6e1b757b9e49">https://it next . io/benchmark-results-of-kubernetes-network-plugins-CNI-over-10g bit-s-network-updated-August-2020-6 E1 b 757 B9 e 49</a></p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="290b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这篇文章是我的<a class="ae lo" rel="noopener ugc nofollow" target="_blank" href="/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-36475925a560">之前的基准</a>的更新，现在运行在Kubernetes 1.14上，CNI版本在2019年4月更新。</p><p id="0ce4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">首先，非常感谢Cilium团队，他们帮助我检查和纠正了我的指标监控脚本。</p><h1 id="2379" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">2018年11月以来有什么新消息</h1><p id="2c0a" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你只是想知道自上次以来发生了什么变化，这里有一个快速总结:</p><p id="09ab" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">法兰绒仍然是CNI竞争中最快和最瘦的，但仍然不支持网络策略，也不支持加密。</p><p id="af85" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Romana不再维护了，所以我们决定把它从基准测试中去掉。</p><p id="7bd6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">WeaveNet现在支持入口和出口网络策略！但是性能比以前低。</p><p id="3605" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果想要获得最佳性能，Calico仍然需要手动定制MTU。Calico为安装他们的CNI提供了两种新的选择，无需专门的ETCD商店:</p><ul class=""><li id="f45b" class="lw lx iq kn b ko lj ks lk kw ly la lz le ma li mb mc md me bi translated">将Kubernetes API中的状态存储为数据存储(集群&lt; 50 nodes)</li><li id="df89" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">storing state in Kubernetes API as datastore with Typha proxy to reduce the pressure on the K8S API (cluster &gt; 50个节点)</li></ul><p id="2f71" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Calico宣布在Istio之上支持<a class="ae lo" href="https://docs.projectcalico.org/v3.6/getting-started/kubernetes/installation/app-layer-policy" rel="noopener ugc nofollow" target="_blank">应用层策略</a>，为应用层带来安全性。</p><p id="573b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Cilium现在支持加密！Cilium通过IPSec隧道提供加密，并为加密网络提供了WeaveNet的替代方案。然而，在启用加密的情况下，WeaveNet比Cilium快。这是由于Cilium 1.4.2仅支持CBC加密，GCM会更好，因为它可以是网络适配器卸载的硬件，但它将是Cilium 1.5版本的一部分。</p><p id="bdb7" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">由于嵌入了ETCD算子，Cilium现在更容易部署。</p><p id="5062" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Cilium团队还努力通过减少内存消耗和CPU成本来减少CNI占用空间。但还是比其他选手重。</p><h1 id="a940" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">基准上下文</h1><p id="95ff" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">基准测试在三台通过Supermicro 10Gbit交换机连接的Supermicro裸机服务器上进行。服务器通过DAC SFP+无源电缆直接连接到交换机，并设置在激活巨型帧(MTU 9000)的同一VLAN中。</p><p id="3324" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Kubernetes 1.14.0安装在Ubuntu 18.04 LTS上，运行Docker 18.09.2(本版本默认Docker版本)。</p><p id="9e65" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为了提高可再现性，我们选择总是在第一个节点上设置主节点，在第二台服务器上托管基准的服务器部分，在第三台服务器上托管客户端部分。这是通过Kubernetes部署中的NodeSelector实现的。</p><p id="08ea" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">下面是我们将用来描述基准测试结果和解释的尺度:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/ba2e20a1d3a7f38d38b728b70c6976ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*CejvF2mlwcV27sAy-sz1VQ.png"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">结果解释的尺度</figcaption></figure><h1 id="507b" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">为基准选择CNI</h1><p id="f40a" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">该基准测试只关注集成到官方kubernetes文档的“<a class="ae lo" href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" rel="noopener ugc nofollow" target="_blank">create a single master cluster with kube ADM</a>”<strong class="kn ir"/>部分的CNI列表。在提到的9个CNI中，我们将只测试其中的6个，排除那些我们不容易安装和/或不能按照文档开箱即用的(罗马纳、康蒂夫-VPP和JuniperContrail/钨制造)</p><p id="6833" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是我们将比较的CNI列表:</p><ul class=""><li id="fa8f" class="lw lx iq kn b ko lj ks lk kw ly la lz le ma li mb mc md me bi translated">Calico v3.6</li><li id="88c8" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">Canal v3.6(实际上是网络的法兰绒+防火墙的印花棉布)</li><li id="5061" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">纤毛</li><li id="89af" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">法兰绒</li><li id="96ed" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">kube-路由器0.2.5</li><li id="bf49" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">编织网2.5.1</li></ul><h1 id="92cf" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">装置</h1><p id="31a6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">CNI越容易建立，我们的第一印象就越好。所有基准CNI都非常容易设置(一两个命令行)。</p><p id="6cfe" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如前所述，服务器和交换机都配置了激活的巨型帧(通过将MTU设置为9000)。我们非常希望CNI能够根据适配器自动发现要使用的MTU。事实上，纤毛和法兰绒是唯一正确自动检测MTU的。大多数其他CNI在GitHub中出现了启用MTU自动检测的问题，但目前，我们需要通过修改Calico、Canal和Kube-router的配置图或通过WeaveNet的ENV var来手动修复它。</p><p id="3f46" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">也许您想知道不正确的MTU会有什么影响？下面的图表显示了带有默认MTU的WeaveNet与带有巨型帧的WeaveNet之间的差异:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/88ed37d394eea1505ee92f8478575a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQcutZL8nDrncSUbFAdcag.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">MTU设置对带宽性能的影响</figcaption></figure><p id="d5e0" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">既然我们知道MTU对性能非常重要，那么这些CNI如何自动检测MTU:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/87a8c0e9d8872a3fcbe1cd55ba093010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nr--EbXRgNeHQzyLdFvinQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">CNIs自动检测的MTU</figcaption></figure><p id="d157" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">正如我们在上图中看到的，我们必须对Calico、Canal、Kube-router和WeaveNet进行一些MTU调优，以获得最佳性能。Cilium和法兰绒能够自行正确地自动检测MTU，确保开箱即用的最佳性能。</p><h1 id="32ee" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">安全性</h1><p id="3712" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在比较这些CNI的安全性时，我们谈论的是两件事:它们对通信进行加密的能力，以及它们对Kubernetes网络策略的实施(根据真实的测试，而不是来自它们的文档)。</p><p id="ef00" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">只有两个CNI可以加密通信:Cilium和WeaveNet。<strong class="kn ir"> WeaveNet </strong>通过将加密密码设置为CNI的ENV变量来启用加密。织网<a class="ae lo" href="https://www.weave.works/docs/net/latest/tasks/manage/security-untrusted-networks/" rel="noopener ugc nofollow" target="_blank">文档</a>有点混乱，但这很容易做到。<strong class="kn ir"> Cilium </strong>使用创建Kubernetes秘密的命令并通过daemonSet修改来设置加密(比WeaveNet稍微复杂一点，但Cilium已经<a class="ae lo" href="http://docs.cilium.io/en/v1.4/gettingstarted/encryption/" rel="noopener ugc nofollow" target="_blank">很好地记录了它</a>)。</p><p id="d250" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">说到网络策略实现，<strong class="kn ir"> Calico </strong>、<strong class="kn ir"> Canal </strong>、<strong class="kn ir"> Cilium </strong>和<strong class="kn ir"> WeaveNet </strong>是面板中最好的，它们实现了入口和出口规则。Kube路由器实际上只执行入口规则。</p><p id="d299" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated"><strong class="kn ir">法兰绒</strong>不实现网络策略。</p><p id="4444" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是结果摘要:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/4c79ec2ef187efc9b693ef7f5ab163db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8IXpUtCARPmm1W91nzWAxw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">安全基准测试结果摘要</figcaption></figure><h1 id="a2c0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">表演</h1><p id="e72f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">该基准测试显示了每次测试(至少)三次运行的平均带宽。我们正在测试TCP和UDP性能(使用iperf3)，像HTTP(使用Nginx和curl)或FTP(使用vsftpd和curl)这样的真实应用程序，最后是使用SCP协议的应用程序加密的行为(使用OpenSSH服务器和客户端)。</p><p id="27f6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">对于所有测试，我们还在裸机节点(绿色条)上运行基准测试，以比较CNI与本地网络性能的有效性。为了与我们的基准标度保持一致，我们在图表上使用以下颜色:</p><ul class=""><li id="dd71" class="lw lx iq kn b ko lj ks lk kw ly la lz le ma li mb mc md me bi translated">黄色=非常好</li><li id="3582" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">橙色=好</li><li id="dfa9" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">蓝色=公平</li><li id="f098" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">红色=贫穷</li></ul><p id="e57c" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">因为我们在这里不关注错误配置的CNI的性能，所以我们将只显示MTU调优的CNI基准测试结果。(注意:如果您激活加密，Cilium不会正确计算MTU，因此您必须在1.4版中手动将MTU减少到8900。下一个版本1.5将自动适应。)</p><p id="8802" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">结果如下:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/04f0494d7c54319bea09b059624ccb08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kuH6qDyQqqG7Nnex9PT4dg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">TCP性能</figcaption></figure><p id="de40" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">每个CNI在TCP基准测试中都表现良好。由于加密的成本，启用加密的CNI远远落后于其他CNI。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/f1397c24e530c3fb7e5a1fdd38a57c40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68nsITzOCSYw829nH0doTQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">UDP性能</figcaption></figure><p id="ebe2" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">同样，在UDP基准测试中，所有CNI都表现良好。加密的CNI现在彼此非常接近。Cilium稍微落后于竞争对手，但事实上，它仅落后裸机结果2.3%，这很公平。我们应该记住的是，纤毛和法兰绒是唯一正确自动检测MTU的CNI，因此提供了开箱即用的结果。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/05ac5d76281228770d69140d550173a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8i95V9158G7EzMdwGuWdrQ.png"/></div></div></figure><p id="94a4" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">现实世界的应用呢？使用HTTP基准测试，我们可以看到全局性能比使用TCP测试要低一些。即使HTTP由TCP支持，在TCP基准中iperf3被配置为避免任何“TCP慢启动”副作用，这可以有效地影响HTTP基准。这里大家都挺好的，Kube-router优势明显，WeaveNet在这个测试上表现相当差，比裸机少20%左右。Cilium encrypted和WeaveNet encrypted现在都离裸机性能很远了。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/d4553ed352e775d811dbd0ca13237525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Riy2SAc46FcYgUqyAXypPg.png"/></div></div></figure><p id="f226" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">对于FTP，另一个TCP支持的协议，结果更加复杂。虽然法兰绒和Kube-router表现非常好，但Calico、Canal和Cilium稍显落后，在裸机速度下落后约10%。WeaveNet离裸机性能真的有17%的差距。无论如何，加密版本的WeaveNet比Cilium encrypted的性能高40%左右。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/23daf3ceaa61215845cb8aada5b396e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kv4J0qVlG7uEMlJEhw3RnQ.png"/></div></div></figure><p id="3e39" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">通过SCP，我们可以清楚地看到SSH协议的加密成本。大多数CNI表现良好，但WeaveNet再次有点落后于其他公司。Cilium encrypted和WeaveNet encrypted当然是因为双倍加密成本(SSH加密+ CNI加密)而落后。</p><p id="4512" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是表演总结:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nc"><img src="../Images/7bc9590f0bc57437af8c76225407ed43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcLeju0yLgd6CwKMxBqcaw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">CNI绩效总结</figcaption></figure><h1 id="3613" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">资源消耗</h1><p id="ae90" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在让我们比较一下这些CNI在高负载下(在TCP 10Gbit传输期间)如何处理资源消耗。在性能测试中，我们将CNIs与裸机进行比较(绿色条)。对于资源消耗测试，我们还显示了没有任何CNI设置的新空闲Kubernetes(紫色条)的消耗。然后我们可以计算出CNI真正消耗了多少开销。</p><p id="053e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">让我们从记忆方面开始。这是传输期间的平均节点RAM使用量(不包括缓冲区/缓存),以MB为单位。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/22e26b9fd46f480508511f339a162871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnPPDLyxIBbASVCXb_c1BA.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">内存消耗</figcaption></figure><p id="e7b5" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">法兰绒和Kube-router的表现都非常好，只有大约50MB的内存占用，其次是Calico和Canal，有70MB。WeaveNet的消耗量明显高于其竞争对手，约为130MB。Cilium拥有400MB的内存，是基准测试中内存消耗最高的。</p><p id="a546" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">现在，让我们检查一下CPU消耗。<strong class="kn ir">警告</strong>:图形单位不是百分数而是permil。所以裸机38 permil其实是3.8%。结果如下:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/17c6e85308cd7a05dc32959bdd4dad37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*le6lgtbArrW9x5bVkerUNQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">CPU消耗</figcaption></figure><p id="cf9e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Calico、Canal、法兰绒和Kube-router的CPU效率都很高，与没有CNI的kubernetes相比，开销只有2%。远远落后的是开销在5%左右的WeaveNet，然后是CPU开销超过7%的Cilium。</p><p id="3341" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是资源消耗的摘要:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/b6bee4e97740051281d09e7089c8a8f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Hj9aTvF-tJ6A90sfIlFTw.png"/></div></div></figure><h1 id="1ea2" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">摘要</h1><p id="2109" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">以下是所有结果的汇总概述:</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nd"><img src="../Images/ccbecf60f2da0efe7097b0fc084a096c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vN2PBlNLOs--eHgNUuKHCg.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">基准测试结果概述</figcaption></figure><h1 id="951f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="9121" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这最后一部分是主观的，传达了我自己对结果的解释。请记住，该基准测试只是在一个非常小的集群(3个节点)上测试单个连接的吞吐速度。它不反映大型集群(&gt; 50个节点)的网络行为，也不反映许多连接的并发性。</p><p id="e47b" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果您处于相应的场景中，我建议使用以下CNI:</p><ul class=""><li id="ec4c" class="lw lx iq kn b ko lj ks lk kw ly la lz le ma li mb mc md me bi translated">您的集群中有<strong class="kn ir">个低资源节点</strong>(只有几GB的RAM，几个内核)，并且您不需要安全特性，那么就使用<strong class="kn ir">法兰绒</strong>。这是我们测试过的最瘦的CNI之一。此外，它还兼容大量架构(amd64、arm、arm64等。).这是唯一一个，连同纤毛，能够正确地自动检测你的MTU，所以你不必配置任何东西让它工作。Kube-router也不错，但是不太标准，需要您手动设置MTU。</li><li id="39cd" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">出于安全原因，你需要<strong class="kn ir">加密你的网络</strong>，使用<strong class="kn ir"> WeaveNet。</strong>如果您使用巨型帧，不要忘记设置您的MTU大小，并通过在环境变量中给出密码来激活加密。但是话说回来，忘掉性能吧，这是加密的代价。</li><li id="9eba" class="lw lx iq kn b ko mf ks mg kw mh la mi le mj li mb mc md me bi translated">对于<strong class="kn ir">其他常用用法</strong>，我会推荐<strong class="kn ir">印花布</strong>。这个CNI被广泛应用于很多kubernetes部署工具(Kops，Kubespray，Rancher等。).就像WeaveNet一样，如果您使用巨型帧，不要忘记在ConfigMap中设置MTU。在资源消耗、性能和安全性方面，它已被证明是多用途和高效的。</li></ul><p id="0b6e" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">最后但同样重要的是，我会推荐你跟随<strong class="kn ir">纤毛</strong>工作。他们的团队非常活跃，他们正在努力提高他们的CNI(功能、资源节约、性能、安全性、多集群跨越等)，他们的路线图听起来非常有趣。</p><figure class="ml mm mn mo gt mp gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi ne"><img src="../Images/4f96cc414b3f811f74b4943a081514d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRQ8B9lcHL2LlImVbppoEQ.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">放大CNI选区</figcaption></figure><p id="ff62" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">编辑:摘要视图已经更新，以显示原始的CPU和RAM值，而不是计算出来的值，因为计算没有明显的解释。</p></div></div>    
</body>
</html>