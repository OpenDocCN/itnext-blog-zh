<html>
<head>
<title>Monitor and measure the availability of applications running on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监控和测量Kubernetes上运行的应用程序的可用性</h1>
<blockquote>原文：<a href="https://itnext.io/monitor-and-measure-the-availability-of-applications-running-on-kubernetes-b286bf309b8c?source=collection_archive---------0-----------------------#2020-11-08">https://itnext.io/monitor-and-measure-the-availability-of-applications-running-on-kubernetes-b286bf309b8c?source=collection_archive---------0-----------------------#2020-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ce3f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">观察应用程序可用性的概念和实施—跟踪SLA/SLO目标的基础。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b695c9ab161099a7d671d42bec864d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_H6PVD9-0_38g0E-CpT0g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">一段时间内观察探测器事件的仪表板示例</figcaption></figure><p id="de01" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当应用程序投入生产时，我们主要关注的问题之一是确保它们得到适当的监控，特别是通过适当的检查和合适的指标来报告它们随时间的可用性。本文旨在解决这一问题。它特别关注在Kubernetes上运行的应用程序，建立了一个监控、测量和观察应用程序可用性的标准。<em class="lr">目标是帮助组织定义服务水平目标(SLO)和/或服务水平协议(SLA ),同时能够通过实际KPI随时跟踪它们。</em></p><p id="a12d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文由两个主要部分组成。第一个是概念性的，介绍我们定义、监控和测量Kubernetes上应用程序可用性的基础和假设。第二个是实用的，展示了一个由<a class="ae ls" href="https://realopinsight.com/" rel="noopener ugc nofollow" target="_blank"> RealOpInsight </a>支持的实现——一个<a class="ae ls" href="https://github.com/rchakode/realopinsight" rel="noopener ugc nofollow" target="_blank">开源</a>应用操作监控框架，设计用于在Kubernetes之上工作，同时利用后者的基本探测功能。</p><h1 id="087a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">工作说明书</h1><p id="6de2" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">给定一个或多个Kubernetes实例，目标是能够监控、测量和跟踪应用程序的可用性，如以下原则所建立的:</p><ul class=""><li id="fedc" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated"><strong class="kx ir">定义Kubernetes应用程序:</strong>正如前面讨论过的<a class="ae ls" href="https://rodrigue-chakode.medium.com/kubernetes-on-tv-watch-how-your-services-are-operating-in-production-100cd00a0d45" rel="noopener">这里的</a>，我们以这两种方式之一定义应用程序。一方面，一个简单的应用程序可以被建模为一组<a class="ae ls" href="https://kubernetes.io/fr/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank"> Kubernetes服务</a>以及它们在单个名称空间内的<a class="ae ls" href="https://kubernetes.io/docs/concepts/workloads/pods/pod/" rel="noopener ugc nofollow" target="_blank"> pods </a>。正如在前面的故事中已经讨论过的<a class="ae ls" href="https://rodrigue-chakode.medium.com/kubernetes-on-tv-watch-how-your-services-are-operating-in-production-100cd00a0d45" rel="noopener">，这种情况下的应用程序可以被看作是<em class="lr">图1.a </em>(如下)上的依赖树。具体地说，依赖关系树是服务以及位于它们下面的容器和容器的分层组合。每个容器都与其pod相关联，pod又与其服务相关联，服务最终与顶层的应用程序相关联。另一方面，复杂的应用程序可以被建模为两个或更多命名空间范围的应用程序的组合。</a></li><li id="2dfc" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated"><strong class="kx ir">计算应用程序状态:</strong>在后台，应用程序的状态是通过收集底层pod(以及它们的容器)的状态来计算的，然后通过依赖关系树聚集和传播这些低级状态。本质上，Kubernetes实现了pod和容器级别的探测。沿着树的状态聚集考虑了管理不同后备pod的资源控制器的类型。通常，ReplicatSet中的pod假定具有相同的功能(即相同的重要性)，而StatefulSet中的pod并不总是这样。例如，在图1.a 中，我们突出显示了ReplicatSet中的一个pod出错的情况，但是该服务只是标记了一个警告状态。这种高级状态聚合的目的是帮助运营团队触发具有适当优先级的事件解决方案。</li><li id="6bd1" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated"><strong class="kx ir">定义应用程序可用性:</strong>每次，应用程序的整体当前状态由应用程序依赖关系树顶层的状态决定。此状态可让您快速了解应用程序的运行情况(例如，绿色表示正常，红色表示严重问题，橙色表示非严重问题)。如果应用程序的整体状态不是关键的，则意味着它是可用的。</li><li id="7dfc" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated"><strong class="kx ir">观察应用程序可用性。</strong>在这种方法的顶层(<em class="lr">图1.b </em>)，我们在每个时间都有每个应用程序的健康状态。<em class="lr">我们的标准设计假设每五分钟(任意周期)计算一次每个应用程序的状态，并记录下来用于未来的可用性分析。</em>不仅要记录应用的状态，还要记录探针状态的总结(即故障和正常状态下容器的比率)。</li><li id="b30e" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated"><strong class="kx ir">定义SLA/SLO目标:</strong>基于上述考虑，可以基于应用在由开始和结束日期设置的给定时间段内的可用性来定义应用的SLO/SLO目标。例如，考虑为期7天的5分钟应用程序可用性检查(即总共1440次检查)，如果应用程序在2次检查期间不可用，则该期间的可用性可以计算如下:<code class="fe ne nf ng nh b">(1440 — 2)/1444 = 99.9986%</code>。有了这个基础，我们就可以轻松地跟踪Kubernetes应用程序的运行情况。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/c1fd47a5af93df1e86228d788208406b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6ywJScQCxytAJpCeG4qGA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图Kubernetes应用程序可用性监控的概念视图— <strong class="bd lv"> (a) </strong>命名空间范围的应用程序依赖关系树示例— <strong class="bd lv"> (b) </strong>显示一组应用程序的当前整合状态的高级仪表板示例。</figcaption></figure><p id="ae02" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">记住上述原则，目标仍然是能够为Kubernetes应用程序定义和跟踪SLA/SLOs目标，下一节将重点演示所介绍概念的实现(即<a class="ae ls" href="http://realopinsight.com/" rel="noopener ugc nofollow" target="_blank"> RealOpInsight </a>)。我们将展示架构构建块，演示在Kubernetes集群上的快速部署。部署之后，将快速演示不同的内置控制面板和可用性分析功能。</p><h1 id="9ef0" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">RealOpInsight设计</h1><p id="02c5" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated"><em class="lr">图2 </em>展示了与Kubernetes集成时RealOpInsight的简化流程。在图中，直箭头表示处理路径或内部数据流，而虚线箭头突出显示处理步骤期间的外部数据检索。以下段落描述了该流程的主要组成部分。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/51762bf3f6eb12efe2255fd7f77fa9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJ9nCNDgDSd4Vn1hZpEctA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图2:RealOpInsight——处理和数据流概述</figcaption></figure><p id="c892" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">人物角色—</strong>RealOpInsight的设计引入了两个人物角色(见图中<em class="lr">用户</em>)。一方面，<strong class="kx ir">管理员</strong>是负责配置和各种管理任务的用户。具体来说，他们的职责包括建立与Kubernetes源的集成，创建和管理操作员用户以及允许他们每个人观看的信息(参见下文介绍的<em class="lr">操作简介</em>)。另一方面，<strong class="kx ir">操作员</strong>是用户，其主要职责是查看与其操作简档相关的信息。对于每个组织，管理员可以根据组织的监控和操作需求，自由定义如何定义每个操作员的操作配置文件。</p><p id="5644" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">操作配置文件— </strong>这是指允许操作员查看的一组信息。操作配置文件由管理员创建和管理。具体地说，一个操作配置文件将一个操作员绑定到一组允许他观看的应用程序。成功登录后，操作员可以访问控制台，在该控制台上，他只能查看和浏览与绑定到其操作配置文件的应用程序相关的信息。</p><p id="500a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">一个或多个Kubernetes源—</strong>RealOpInsight的一个实例可以处理多个Kubernetes实例。每个源都是根据API端点URL定义的，可能还有一个令牌来验证它。对于代理访问，或者如果实例作为具有适当服务帐户和Kubernetes上的RBAC权限的pod运行，令牌是可选的。</p><p id="5178" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">应用程序的发现和组合— </strong>添加Kubernetes源时，RealOpInsight会自动触发一个发现操作，包括查询Kubernetes API以检索所有现有应用程序。应用程序列表存储在内部，在定义操作配置文件时使用。如前所述，应用程序基本上绑定到一个名称空间。然而，由于内置的编辑器，管理员还可以基于其他应用程序设置复合/丰富的应用程序。</p><p id="404c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">可用性监控&amp;Prometheus metrics—</strong>RealOpInsight具有一个由可配置定时器(默认为5分钟)调度的内部组件，用于计算应用可用性并存储它们以供将来分析。该组件还使Prometheus exporter能够向外部第三方系统(如Prometheus/Grafana堆栈)公开当前可用性指标。RealOpInsight与内置仪表板一起发布，可处理每个操作配置文件的可用性分析。演示部分(这一部分的下一部分)提供了这个特性的快速浏览。</p><h1 id="832b" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">演示旅游</h1><p id="5e10" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">本节将介绍在Kubernetes上安装RealOpInsight，并使用它来观察应用程序的可用性，如上所述。我们将看到建立一个Kubernetes源、创建一个操作配置文件以及监视和测量生产中应用程序的可用性是多么容易。除了通过内置仪表板的可视化，我们还将展示一个由Promeheus exporter支持的Grafana仪表板。</p><h2 id="f1a3" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">在Kubernetes上安装RealOpInsight</h2><p id="01f9" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">有一个<a class="ae ls" href="https://github.com/rchakode/realopinsight/tree/master/helm" rel="noopener ugc nofollow" target="_blank">掌舵图</a>来简化RealOpInsight在Kubernetes上的部署。以下命令套件将在名称空间<code class="fe ne nf ng nh b">monitoring</code>中安装RealOpInsight的最新版本(该名称空间必须存在，或者可以更改为任何其他现有名称空间)。</p><pre class="kg kh ki kj gt nw nh nx ny aw nz bi"><span id="0069" class="nk lu iq nh b gy oa ob l oc od">git clone <a class="ae ls" href="https://github.com/rchakode/realopinsight.git" rel="noopener ugc nofollow" target="_blank">https://github.com/rchakode/realopinsight.git</a> &amp;&amp; \<br/>  cd realopinsight &amp;&amp; \<br/>  helm upgrade \<br/>  --namespace monitoring \<br/>  --install realopinsight \<br/>  helm/realopinsight/</span></pre><p id="5d67" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">部署(参见<a class="ae ls" href="https://github.com/rchakode/realopinsight/tree/master/helm/realopinsight" rel="noopener ugc nofollow" target="_blank"> Helm manifests </a>)还启用了名为<code class="fe ne nf ng nh b">realopinsiht</code>的ClusterIP服务，公开了端口<code class="fe ne nf ng nh b">80</code>(集群内URL:<a class="ae ls" href="http://realopinsight/ui" rel="noopener ugc nofollow" target="_blank">http://realopinsight.monitoring/ui</a>)上的UI和端口<code class="fe ne nf ng nh b">4584</code>(集群内URL:<a class="ae ls" href="http://realopinsight.monitoring:4583/metrics" rel="noopener ugc nofollow" target="_blank">http://realopinsight.monitoring:4583/metrics</a>)上的普罗米修斯度量。</p><h2 id="35a6" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">配置Kubernetes探测源</h2><p id="d5d3" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">这需要以管理员身份登录RealOpInsight(默认用户名和密码为<code class="fe ne nf ng nh b">admin</code>和<code class="fe ne nf ng nh b">password</code>)。</p><ul class=""><li id="3326" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">选择菜单<code class="fe ne nf ng nh b">Monitoring Sources</code>打开源配置页面(<em class="lr">截图1 </em>)。</li><li id="1171" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">将<code class="fe ne nf ng nh b">API Endpoint URL</code>设置为<code class="fe ne nf ng nh b"><a class="ae ls" href="https://kubernetes.defaulth" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default/</a></code>(集群内API URL)，如果集群使用自签名证书，则可选地检查<code class="fe ne nf ng nh b">Don't verify SSL certificate</code>。</li><li id="4086" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">将字段<code class="fe ne nf ng nh b">Auth String Token</code>留空，这意味着RealOpInsight使用其RBAC服务帐户对Kubernetes API进行身份验证。该服务帐户(名为<code class="fe ne nf ng nh b">realopinsight</code>)及其RBAC权限是在Helm部署期间创建的。</li><li id="f2b2" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">出现提示时，点击<code class="fe ne nf ng nh b">Add as source</code>并选择信号源的ID。</li><li id="5945" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">点击<code class="fe ne nf ng nh b">Apply</code>完成操作。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/ad86379b37fbb15513d33527d5a6aa69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uqbyriztiy8VKEreVaHQg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图1: RealOpInsight —源代码配置页面。</figcaption></figure><h2 id="5525" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">可用性指标</h2><p id="e386" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">一旦创建了源，负责处理可用性指标的组件开始在后台工作，计算应用程序的状态，并将它们作为普罗米修斯指标公开(<em class="lr">截图2 </em>)。</p><p id="f301" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">根据这些指标，不同的应用由<code class="fe ne nf ng nh b">scope</code>标签设定。前缀<code class="fe ne nf ng nh b">Source0</code>是Kubernetes源的ID，允许突出显示发现的应用程序(即绑定到名称空间和通过内置编辑器创建的复合应用程序)。</p><p id="3295" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于每个应用程序，我们有以下指标:</p><ul class=""><li id="9029" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">总体聚合状态(参见标签<code class="fe ne nf ng nh b">status="summary"</code>)，其值可以是以下值之一:0→正常/健康状态；1 →影响较小的问题状态；2 →有重大影响的问题状态；3→具有关键影响的问题状态；4→未知状态。</li><li id="9d43" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">给定状态下底层容器的比率(%)(见标签<code class="fe ne nf ng nh b">status="minor"</code>、<code class="fe ne nf ng nh b">status="major"</code>、<code class="fe ne nf ng nh b">status="critical"</code>、<code class="fe ne nf ng nh b">status="unknown"</code>)。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/bf8fef0eaf19f12d07e19f0df7756bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIcIAynWDD77Nnq0TfBLmA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">截图2:RealOpInsight——暴露的普罗米修斯指标样本</figcaption></figure><h2 id="fae7" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">配置操作配置文件</h2><p id="8616" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">下面的步骤演示了如何创建一个名为<code class="fe ne nf ng nh b">itops</code>的操作者概要文件，以监控在<code class="fe ne nf ng nh b">Source0</code>上设置的Kubernetes集群中的名称空间<code class="fe ne nf ng nh b">kube-system</code>、<code class="fe ne nf ng nh b">monitoring</code>和<code class="fe ne nf ng nh b">redis</code>中的应用程序的可用性。</p><ul class=""><li id="cf41" class="mq mr iq kx b ky kz lb lc le ms li mt lm mu lq mv mw mx my bi translated">以管理员身份登录(默认凭证:<code class="fe ne nf ng nh b">admin/password</code>，选择菜单<code class="fe ne nf ng nh b">New User</code>。</li><li id="c465" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">填写所需的用户信息。对于本例，将用户名和密码分别设置为<code class="fe ne nf ng nh b">itops</code>和<code class="fe ne nf ng nh b">123itsops</code>。点击<code class="fe ne nf ng nh b">Submit</code>确认创建。</li><li id="04e7" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">用户创建后，选择菜单<code class="fe ne nf ng nh b">Operations Profiles</code>配置其操作配置文件。</li><li id="b852" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">在用户列表中选择用户<code class="fe ne nf ng nh b">itops</code>(<em class="lr">截图3 </em>)，然后在右侧选择要关联到其个人资料的项目。</li><li id="e432" class="mq mr iq kx b ky mz lb na le nb li nc lm nd lq mv mw mx my bi translated">点击<code class="fe ne nf ng nh b">Assign</code>我们就完成了。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi og"><img src="../Images/d652411159c53ba46cc80520234c834e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3QitY8lIEzvJVSV7yvxo2w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图3: RealOpInsight —为用户定义操作配置文件</figcaption></figure><h2 id="a3ac" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">观察应用程序可用性</h2><p id="4e14" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">要查看应用程序的可用性，需要作为操作员用户登录。在我们的例子中，它是在上一步中创建的<code class="fe ne nf ng nh b">itops</code>。</p><p id="2595" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">操作控制台的欢迎页面显示了应用程序运行状况的战术概述。每个应用程序都由一个带有标题和探针当前状态摘要的小块表示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/7dafb744e06f871dbe0f762a9b5d192d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPffwfnKUxJf3toBgosqUA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">截图4:RealOpInsight——战术概述</figcaption></figure><p id="1052" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击一个磁贴(或者点击<code class="fe ne nf ng nh b">Active View</code>字段中的相关条目)打开相关的应用仪表板(<em class="lr">屏幕截图5 </em>)。这个仪表板提供了一些小部件，以获得关于应用程序当前状态的更多详细信息。在上部，一个树形视图(左)和一个地图(右)显示了应用程序组件之间的依赖关系。这两个小部件还强调了每个事件如何影响应用程序的整体状态。仪表板的底部由一个统计面板(左)和一个事件控制台(右)组成，前者显示探测器状态的综合视图，后者显示探测器状态的详细信息。默认情况下，事件控制台只显示问题，但操作员也可以选择查看正常消息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/d334ff6cd4f5779ff15843160137a6ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dCj2_q7ce4rYF3Xw2psG6g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图5: RealOpInsight —应用程序的详细操作视图，显示了依赖关系树和深入的根本原因探索功能。</figcaption></figure><h2 id="c0a6" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">可用性分析仪表板</h2><p id="1e62" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">从<code class="fe ne nf ng nh b">Active View</code>字段中选择<code class="fe ne nf ng nh b">Platform Availability Analytics</code>，切换到应用可用性分析仪表板(<em class="lr">截图7 </em>)。</p><p id="285a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在左侧，该控制面板显示了每个应用程序在选定时间段(默认为30天，请参见页面顶部的日期筛选器)内的探测器状态历史图表。</p><p id="40bf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有一个链接可以下载与此图相关的CSV格式的数据，以便通过三方分析工具进行进一步分析，例如Microsoft Excel、<a class="ae ls" href="https://aws.amazon.com/athena" rel="noopener ugc nofollow" target="_blank"> AWS Athena </a>、<a class="ae ls" href="https://cloud.google.com/bigtable" rel="noopener ugc nofollow" target="_blank"> Google Bigtable </a>、<a class="ae ls" href="https://www.tableau.com/" rel="noopener ugc nofollow" target="_blank"> Tableau </a>等。</p><p id="ac86" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在右侧，饼图提供了所选时间段内应用程序可用性的分析摘要。显示的可用性比率是应用程序处于正常状态的时间部分(在所选时间段之外)的计算结果。</p><p id="3fb7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">用户可以通过利用内置的Prometheus exporter来扩展这种本机分析仪表板。例如，可以使用像Grafana.shboard这样的三方工具来构建等效的甚至更好的仪表板，以观察p</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/34c5c0f59aff21b39793dd93fc174f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nVFyoInCH1Ug3UCRLO_CQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">屏幕截图6: RealOpInsight —应用可用性分析仪表板。</figcaption></figure><h2 id="7ffb" class="nk lu iq bd lv nl nm dn lz nn no dp md le np nq mf li nr ns mh lm nt nu mj nv bi translated">自定义Grafana仪表板</h2><p id="877a" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">下面这个由dashboard和RealOpInsight的Prometheus exporter构建的仪表板展示了监控应用程序可用性的另一个例子。对于每个应用程序或一组应用程序，我们可以观察一段时间内探测事件的比例。这种指标通常有助于设定事故及其解决方案的目标。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b695c9ab161099a7d671d42bec864d9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_H6PVD9-0_38g0E-CpT0g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">RealOpInsight—Grafana仪表板示例，用于观察探测器上的事件随时间的变化</figcaption></figure><h1 id="4845" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">结论</h1><p id="5e8a" class="pw-post-body-paragraph kv kw iq kx b ky ml jr la lb mm ju ld le mn lg lh li mo lk ll lm mp lo lp lq ij bi translated">在本文中，我们讨论了一些概念，并提出了一种方法来监控和测量运行Kubernetes的应用程序的可用性。目标是能够随着时间的推移定义和跟踪SLA/SLO目标。除了概念之外，本文的第二部分演示了如何使用实际的实现，即<a class="ae ls" href="http://realopinsight.com/" rel="noopener ugc nofollow" target="_blank"> RealOpInsight </a>。在此之前，我们展示了架构构建块，演示了在Kubernetes集群上的快速部署。</p><p id="e02f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在结束这项工作之前，可能值得一提的是，除了Kubernetes，RealOpInsight还与Zabbix和Nagios一起工作。这样，它通过打破传统监控工具的孤岛，支持应用程序操作监控的全球战略。最后，我们记得RealOpInsight是开源的，可以在<a class="ae ls" href="https://github.com/rchakode/realopinsight" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。不要犹豫，试一试。</p><p id="cd99" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尽情享受，不要犹豫，分享您的反馈！</p></div></div>    
</body>
</html>