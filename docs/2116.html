<html>
<head>
<title>Siri Shortcut: How to add a Siri button</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Siri快捷方式:如何添加Siri按钮</h1>
<blockquote>原文：<a href="https://itnext.io/siri-shortcut-how-to-add-a-siri-button-c0458e279ab8?source=collection_archive---------0-----------------------#2019-04-03">https://itnext.io/siri-shortcut-how-to-add-a-siri-button-c0458e279ab8?source=collection_archive---------0-----------------------#2019-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9076" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">苹果提供的<span class="l kp kq kr bm ks kt ku kv kw di"> S </span> ample项目(<a class="ae kx" href="https://developer.apple.com/documentation/sirikit/soup_chef_accelerating_app_interactions_with_shortcuts" rel="noopener ugc nofollow" target="_blank">汤厨</a>)目前需要我们通过<strong class="js iu">设置&gt; Siri &amp;搜索</strong>添加Siri快捷方式。然而，我们，iOS开发者，更喜欢在我们的应用程序中添加一个Siri快捷按钮，这样我们的用户就更有可能使用这个功能。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/4230abccac77f1707aa27e7713819cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y__S72jANrZkDcmEWnmTYw.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi lk"><img src="../Images/c79cb6abfcf860e1cdb6427745d0ff10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rlwkKcTdQxwRaSqcZQyJFA.png"/></div></div></figure><p id="ad7a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本教程将演示<strong class="js iu"> <em class="ll">“如何在</em> </strong> <a class="ae kx" href="https://developer.apple.com/documentation/sirikit/media_intent_shortcuts/playing_media_through_siri_shortcuts" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> <em class="ll">内添加响应式Siri按钮</em></strong></a><strong class="js iu"><em class="ll"/></strong><em class="ll">”。</em></p><p id="580b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，在我们开始之前，有一件事你需要先知道…</p><h2 id="6788" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">不活跃与不活跃</h2><p id="a0fb" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di"> T </span>下面是<a class="ae kx" href="https://developer.apple.com/documentation/sirikit/donating_shortcuts" rel="noopener ugc nofollow" target="_blank">创建快捷方式</a>的两种方式，分别是<code class="fe mk ml mm mn b">NSUserActivity</code>和<code class="fe mk ml mm mn b">INIntent</code>。它们之间的主要区别是<code class="fe mk ml mm mn b">NSUserActivity</code>从Siri进入你的应用程序来完成任务，而<code class="fe mk ml mm mn b">INIntent</code>允许你的用户在不打开你的应用程序的情况下通过Siri进行交流。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mo"><img src="../Images/0a196f37d16075bd0f0e9a31fe37520f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qf11-NYfGuQB4yP3mDTFRg.png"/></div></div></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="a26e" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">编码前的基本设置</h2><p id="d7da" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi translated"><code class="fe mk ml mm mn b">NSUserActivity</code>和<code class="fe mk ml mm mn b">INIntent</code>都需要我们打开Siri功能。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mw"><img src="../Images/e7fa01c21965be5082dca2964658d703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rYvttQ8TkioQEtcJNBulA.png"/></div></div></figure><p id="048a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<a class="ae kx" href="https://developer.apple.com/documentation/sirikit/media_intent_shortcuts/playing_media_through_siri_shortcuts" rel="noopener ugc nofollow" target="_blank">音频转换</a>中，你还需要配置<a class="ae kx" href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html" rel="noopener ugc nofollow" target="_blank">应用程序组</a>以使项目能够使用带有Siri扩展的共享容器。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mx"><img src="../Images/3dbd9d9425298470ff689c297dbcfa3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6IuFFx4fcC4TGySk.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi my"><img src="../Images/02a9f8cac47e00416ef0d941829e6eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DV1d-yeGH-7j58dbM2sfkQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated"><a class="ae kx" href="https://developer.apple.com/documentation/sirikit/media_intent_shortcuts/playing_media_through_siri_shortcuts" rel="noopener ugc nofollow" target="_blank">音频广播中的自述文件</a></figcaption></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="e3b2" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">通过NSUserActivity添加Siri按钮</h2><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nd"><img src="../Images/0e7c84d3dc4e9df5627adc2870860e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BB_2qoJgs_0sQmXFu1hoiA.png"/></div></div></figure><p id="d999" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<em class="ll">episodetableviewcontroller . swift</em>内部，我们来添加Siri按钮。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6c7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们通过<code class="fe mk ml mm mn b">NSUserActivity</code>设置意图。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f2aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后编译器会要求你遵守三个协议:<code class="fe mk ml mm mn b">INUIAddVoiceShortcutViewControllerDelegate</code>、<code class="fe mk ml mm mn b">INUISAddShortcutButtonDelegate</code>和<code class="fe mk ml mm mn b">INUIEditVoiceShortcutViewControllerDelegate</code>。只需在<em class="ll">episotedableviewcontroller . swift .</em>的最底部添加代码</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6ad0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了允许<em class="ll"> AppDelegate </em>播放<em class="ll">EpisodeTableViewController</em>中的剧集，在<em class="ll">EpisodeTableViewController</em>中添加一个公共<code class="fe mk ml mm mn b">play()</code>函数。</p><pre class="kz la lb lc gt ng mn nh ni aw nj bi"><span id="e512" class="lm ln it mn b gy nk nl l nm nn">public func play() {<br/>    play(episodes: nil)<br/>}</span></pre><p id="346e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，转到<em class="ll"> AppDelegate </em>并添加一个变量<code class="fe mk ml mm mn b">libraryManager</code>来请求播放列表。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="2a44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，让你的应用程序根据<code class="fe mk ml mm mn b">application(_:continueUserActivity:restorationHandler)</code>中的<code class="fe mk ml mm mn b">userActivity.activityType</code>播放想要的播放列表。下面的代码对于编写重复的代码来说绝对是糟糕的实践，但是足以说明它是如何工作的。😜</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="70d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">干得好。运行应用，添加Siri快捷方式，然后召唤你的应用来玩！🎊</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi no"><img src="../Images/119d79b36dcb5b32b30cc6aceef6c781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCTG23AkbqxOxR06DfisrA.png"/></div></div></figure><p id="ab41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想通过nsuractivity查看<a class="ae kx" href="https://github.com/ji3g4kami/Siri-shortcut-button/tree/NSUserAvtivity" rel="noopener ugc nofollow" target="_blank">添加Siri按钮的整个项目，请点击nsuractivity分支的</a>。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="2b75" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">通过内容添加Siri按钮</h2><p id="d28e" class="pw-post-body-paragraph jq jr it js b jt mf jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj mj kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di">U</span>n就像用<code class="fe mk ml mm mn b">NSUserActivity</code>添加Siri按钮一样，用<code class="fe mk ml mm mn b">INIntent</code>添加它在默认情况下是没有反应的，这意味着它不会向你显示“已添加到Siri”，除非我们将正确的<code class="fe mk ml mm mn b">INShortcut</code>分配给Siri按钮。</p><p id="0a62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe mk ml mm mn b">INVoiceShortcutCenter</code> singleton，我们能够获得所有注册的快捷方式。然后，我们必须过滤掉想要的快捷方式。这里我们将使用系统创建的UUID标识符。如果用户尚未注册快捷方式，则创建按钮的意图和快捷方式。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="5f3c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，遵守三项协议。同时，我们将快捷方式标识符(UUID)保存到UserDefaults，这样按钮就可以获得所需的快捷方式。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0352" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">哇啦。就是这样。测试一下，享受通过Siri播放的剧集。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi np"><img src="../Images/b263957ae2b7ba8105662511e5e62272.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAPlNXXXuyyQcCr16nCU6g.png"/></div></div></figure><p id="23fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想在master branch的这里看到添加Siri按钮的整个项目。</p></div></div>    
</body>
</html>