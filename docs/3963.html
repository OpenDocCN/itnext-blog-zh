<html>
<head>
<title>A Few Dozen Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">几十行代码</h1>
<blockquote>原文：<a href="https://itnext.io/a-few-dozen-lines-of-code-4068a863cf20?source=collection_archive---------5-----------------------#2020-04-02">https://itnext.io/a-few-dozen-lines-of-code-4068a863cf20?source=collection_archive---------5-----------------------#2020-04-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="5d69" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">第1部分:Kubernetes平台</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b7788edf9028b59080bdfa37236a120b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xCzB-b4iZNk5kx-B.jpg"/></div></div></figure><p id="09f2" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><em class="lv">关于如何使用基于Kubernetes的平台轻松获得集中式日志记录、更好的安全性、性能指标和身份验证的深入系列。</em></p><h1 id="d6a7" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="f03f" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">这篇文章标志着我们关于创建在云原生平台上运行的云原生应用的系列文章的开始。我们所说的“云原生平台”不仅仅指Kubernetes，而是一个功能全面的解决方案，包括不同的应用程序，可以帮助您管理日志、安全性和基于微服务的解决方案的可观察性。</p><p id="7f32" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们将一步步向您展示如何在Go from scratch中创建微服务应用程序。这将说明无需修改您的应用程序即可获得云原生堆栈的所有优势，因此它也可以轻松应用于现有应用程序。</p><p id="4634" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">在本教程中，我们想给你一个平台和代码的完整概述。我们的目标是用尽可能少的工具获得应用程序的企业操作属性。</p><ul class=""><li id="f1c5" class="mb mc iq kz b la lb le lf li md lm me lq mf lu mg mh mi mj bi translated">我们将首先创建一个开发环境，引入我们想要使用的云原生应用程序堆栈。</li><li id="144c" class="mb mc iq kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">然后，我们将向您展示创建一个可以从该设置中受益的应用程序是多么容易。</li><li id="8805" class="mb mc iq kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">稍后，我们将转到应用程序的部署，向您展示我们如何利用云原生特性解决多个问题。</li><li id="4e56" class="mb mc iq kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">完成后，我们将探索我们创建的平台的功能，并向您展示如何将它们用于运营。</li></ul><h1 id="0f89" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Kubernetes作为企业应用程序的平台</h1><p id="08cc" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">在这个系列中，我想更多地关注我们可以在Kubernetes之上构建的平台以及我们需要编写的代码。但是，不能忽略Kubernetes本身提供的一些元素。所以，让我介绍一下我们故事中的英雄，我们与云原生世界的接口，既有来自Kubernetes API的，也有来自社区的其他工具。</p><p id="ea60" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">下面列出了一些我们会特别感兴趣的Kubernetes本地特性:</p><p id="d4c1" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir">部署<br/> </strong>部署是Kubernetes的一个概念，它允许您运行特定数量的应用程序容器副本(称为pod)。它会观察这个数字，并重新创建任何失败的pod，无论是由于软件还是硬件问题。它还允许您滚动发布新版本的软件。</p><p id="4d7e" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们在之前的<a class="ae mp" href="https://blog.giantswarm.io/understanding-basic-kubernetes-concepts-using-deployments-manage-services-declaratively/" rel="noopener ugc nofollow" target="_blank">博客文章</a>中写到了这一点。你也可以从<a class="ae mp" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">官方文件</a>中了解更多。</p><p id="22d7" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir">服务<br/> </strong>服务充当一组pod的软件负载平衡器。它通常针对单个部署，并向外部用户公开其pod。</p><p id="db2d" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们在另一篇博客文章中有更多的细节，你也可以阅读<a class="ae mp" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>的概念解释。</p><p id="bd55" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir">网络策略<br/> </strong>网络策略定义了您的pod可以通过网络与谁对话。基本上，它们是Kubernetes的一种防火墙形式。我们需要它们来提供网络层安全。</p><p id="caef" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">查看<a class="ae mp" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">网络政策</a>解释器了解更多细节。</p><p id="1b60" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir"> Pod安全策略<br/> </strong> PSP是一种权限控制框架。它允许您设置和执行规则，禁止您的pod执行一些会带来安全风险且对您的pod不必要的特权系统操作。</p><p id="c7f7" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">如果您想了解更多信息，请探索<a class="ae mp" href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/" rel="noopener ugc nofollow" target="_blank"> Pod安全策略</a>。</p><p id="5ec5" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir">基于角色的访问控制(RBAC) <br/> </strong> RBAC是一组规则，控制哪些Kubernetes API对象(如部署、服务、PSP)可以被您的pod访问。我们的应用程序不需要任何Kubernetes API访问，但是我们需要一组简单的RBAC规则，允许应用程序访问我们需要设置的PSP对象。</p><p id="aaf5" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">深入研究这个主题，将它添加到您的书签中:<a class="ae mp" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" rel="noopener ugc nofollow" target="_blank">基于角色的访问控制</a>。</p><p id="f5dc" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在，让我介绍一下我们将在Kubernetes基础上创建微服务平台的项目:</p><p id="7c87" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir"> Linkerd </strong>是一个服务网格。这是一款让您能够更好地了解和控制微服务设置的工具。我们将使用Linkerd来提供更好的安全性(<a class="ae mp" href="https://linkerd.io/2/features/automatic-mtls/" rel="noopener ugc nofollow" target="_blank">服务到服务通信的自动TLS加密</a>)，获取<a class="ae mp" href="https://linkerd.io/2/features/dashboard/" rel="noopener ugc nofollow" target="_blank">基本性能指标</a>，以及<a class="ae mp" href="https://linkerd.io/2/features/distributed-tracing/" rel="noopener ugc nofollow" target="_blank">执行跟踪</a>。Linkerd最大的一个优点就是用起来真的很简单。</p><p id="341c" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">Loki仍然是一个相当新的日志管理系统。这是弹性搜索领域的一个新项目。尽管如此，我们将使用Loki，因为它易于设置，并且与Grafana集成，无论如何我们都需要它用于Linkerd。</p><p id="d144" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们在<a class="ae mp" href="https://blog.giantswarm.io/grafana-logging-using-loki/" rel="noopener ugc nofollow" target="_blank">之前的博客文章</a>中写过洛基。</p><p id="22ce" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated"><strong class="kz ir"> Grafana </strong>是一款数据可视化工具。我们将使用它来绘制来自Linkerd的性能指标，并显示来自Loki的日志。</p><h1 id="8294" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">准备开发平台</h1><p id="9951" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">我们希望我们的应用程序具有生产级的特性，但是我们需要在某个地方开发和测试它。正如我在介绍中提到的，设置和运行Kubernetes平台本身就是一个话题。在这里，我们设置了一个开发环境，它将允许我们运行并查看我们的应用程序。</p><p id="806d" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">让我们从查看这个博客条目的存储库开始。完成后，让我们切换到“基本”分支:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="9656" class="mv jo iq mr b gy mw mx l my mz">git clone https://github.com/giantswarm/giantswarm-todo-app.git cd giantswarm-todo-app git checkout blog_v1</span></pre><h1 id="be0b" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">发展环境</h1><p id="3ee8" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">我们的应用程序将用Go编写，所以请访问<a class="ae mp" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">安装文档</a>并安装Go，如果你还没有的话。我将使用Go 1.13.1。</p><p id="43a4" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">对于代码编辑，使用任何适合你的，但是如果你正在寻找一个好的开始，我推荐使用<a class="ae mp" href="https://code.visualstudio.com/docs/languages/go" rel="noopener ugc nofollow" target="_blank"> Go插件</a>的<a class="ae mp" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>。我们还将使用Makefiles来构建我们的代码，所以要确保安装了<code class="fe na nb nc mr b">make</code>工具。</p><h1 id="ae76" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Kubernetes工具</h1><p id="45fe" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">有几个很好的项目可以让你建立一个开发Kubernetes环境，Minikube可能是最受欢迎的一个。请按照本指南<a class="ae mp" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank">为您的操作系统安装<code class="fe na nb nc mr b">minikube</code>。我们还需要<code class="fe na nb nc mr b">kubectl</code>——如果你没有，看看这里的</a><a class="ae mp" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"/>。也请安装VirtualBox作为minikube的虚拟化平台。要安装这个，请遵循此处的说明<a class="ae mp" href="https://www.virtualbox.org/wiki/Downloads" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="4a0c" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">暂时不要启动任何集群。只要确保以下工具是可操作的:</p><ul class=""><li id="eaf6" class="mb mc iq kz b la lb le lf li md lm me lq mf lu mg mh mi mj bi translated">VirtualBox(我用的是6.1.4版)</li><li id="3ed0" class="mb mc iq kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">Kubectl(我用的是v1.17.0)</li><li id="cb0a" class="mb mc iq kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">Minikube(我用的是v1.9.0)</li></ul><p id="51a6" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">此外，我们需要再安装两个工具:</p><p id="c6c1" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">实际上，Docker已经被Minikube安装为一个容器运行时，但是它将在一个虚拟机中运行。为了让我们的生活更容易，我们也直接在我们的开发机器上安装Docker(我使用的是Docker Engine — Community v19.03.6)。</p><p id="8024" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">Helm就像是你在Kubernetes上运行的包管理器或软件安装器。我们将使用它来部署我们的Kubernetes平台的组件(我使用的是Helm v 2 . 16 . 5；注意现在不要使用头盔3，我们仍然使用头盔2)。</p><h1 id="fe7e" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Kubernetes平台环境</h1><p id="e614" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">准备好所有工具后，我们可以开始创建Kubernetes安装，Minikube运行在一个具有4 GB内存和2个CPU内核(这是本教程的推荐大小)的虚拟机上。</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="8af0" class="mv jo iq mr b gy mw mx l my mz">minikube start --kubernetes-version='v1.17.0' --memory='4g' --network-plugin='cni' --vm-driver='virtualbox' --cpus='4'</span></pre><p id="f0cf" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在，等到Minikube启动虚拟机。</p><p id="691c" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">Minikube完成后，我们需要向<code class="fe na nb nc mr b">kube-system</code>名称空间添加一个标签——稍后将使用它来选择去往该名称空间的网络流量:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="5e9b" class="mv jo iq mr b gy mw mx l my mz">kubectl label ns kube-system name=kube-system</span></pre><p id="6e53" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">Kubernetes没有任何默认的网络(CNI)驱动程序，所以我们需要自己安装一个。我们用<a class="ae mp" href="https://github.com/projectcalico/cni-plugin" rel="noopener ugc nofollow" target="_blank">印花布</a>做这个。运行:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="f0d4" class="mv jo iq mr b gy mw mx l my mz">kubectl apply -f <a class="ae mp" href="https://docs.projectcalico.org/v3.13/manifests/calico.yaml" rel="noopener ugc nofollow" target="_blank">https://docs.projectcalico.org/v3.13/manifests/calico.yaml</a></span></pre><p id="07bb" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在，开始:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="0a95" class="mv jo iq mr b gy mw mx l my mz">kubectl -n kube-system get pods -w</span></pre><p id="0c13" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">并且等到一切都有了“状态:正在运行”和“就绪:1/1”。</p><p id="c117" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在我们的Kubernetes已经准备好了，我们使用Helm部署Linkerd、Loki和Grafana。首先，让我们初始化Helm:</p><p id="770c" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">然后，确认名称以<code class="fe na nb nc mr b">tiller-deploy</code>开头的pod处于“就绪:1/1”和“状态:运行”状态:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="504c" class="mv jo iq mr b gy mw mx l my mz">kubectl -n kube-system get po</span></pre><p id="866f" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">最后，我们需要添加巨虫群的头盔库到我们的头盔配置中。我们用它们来安装我们团队准备的应用程序，包括Loki、Grafana和Linkerd。我们添加了主要的“巨人温暖”目录，以及“游乐场”目录。您可以点击了解更多关于我们的应用目录<a class="ae mp" href="https://docs.giantswarm.io/basics/app-catalog/" rel="noopener ugc nofollow" target="_blank">。在这里，我们把它们作为普通的舵图表库。</a></p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="48af" class="mv jo iq mr b gy mw mx l my mz">$ helm repo add giantswarm https://giantswarm.github.io/giantswarm-catalog $ helm repo add giantswarm-playground https://giantswarm.github.io/giantswarm-playground-catalog $ helm repo update</span></pre><p id="a285" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">如上所述，Linkerd可以通过引入<a class="ae mp" href="https://linkerd.io/2/features/automatic-mtls/" rel="noopener ugc nofollow" target="_blank"> mTLS </a>来提供更好的安全性。不过，它需要加密证书来做到这一点。</p><p id="218f" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">为了更简单，我们将安装一个名为<code class="fe na nb nc mr b">cert-manager</code>的应用程序，它将为Linkerd动态创建证书。我们安装了:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="e1f1" class="mv jo iq mr b gy mw mx l my mz">helm install --namespace kube-system -n cert-manager --version=1.0.6 giantswarm/cert-manager-app</span></pre><p id="eba2" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在我们可以安装Linkerd了。</p><p id="c37f" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们需要在安装过程中设置两个选项。第一个将图表配置为使用由<code class="fe na nb nc mr b">cert-manager</code>创建的证书。</p><p id="75d0" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">第二个是在Grafana中创建一个admin级别(而不是只读)的帐户，它包含在图表中，所以我们可以在以后定制Grafana。</p><p id="ea02" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">为了使它更容易，存储库包含一个随时可用的配置文件，用于使用Helm部署的Linkerd我们只需要指向”。/helm/configs/linkerd.yaml ":</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="af02" class="mv jo iq mr b gy mw mx l my mz">helm install --namespace linkerd -n linkerd -f ./helm/configs/linkerd.yaml --version 0.2.1 giantswarm-playground/linkerd2-app</span></pre><p id="6ea2" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">给它几分钟时间进行初始化，然后检查Linkerd名称空间中的所有pod是否都准备好了:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="411c" class="mv jo iq mr b gy mw mx l my mz">kubectl -n linkerd get po</span></pre><p id="adb4" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">检查您是否可以访问Linkerd web dashboard。在您的终端中运行以下命令:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="65e3" class="mv jo iq mr b gy mw mx l my mz">kubectl -n linkerd port-forward service/linkerd-web 8084</span></pre><p id="b181" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在，在你的浏览器中访问<a class="ae mp" href="http://localhost:8084/overview" rel="noopener ugc nofollow" target="_blank">http://localhost:8084/overview</a>。</p><p id="c26e" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">您应该会看到一个默认的仪表板，如下所示。在仪表板中，单击“Grafana”列中的任何图标。您将被重定向到grafana web界面。</p><p id="0c3e" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">在终端中保持端口转发，让我们转到下一个应用程序。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nd"><img src="../Images/cb61d797f4fdd7de895b2e39f69f5374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qhHxFOhiG9QTXLqb.jpg"/></div></div></figure><h1 id="cb09" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">安装Loki</h1><p id="df8f" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated">出于开发目的安装带有Helm的Loki非常容易。部署Loki后，我们需要Grafana作为web UI来显示Loki的日志。Grafana已经被Linkerd部署了，所以我们将重用它。通过运行以下命令安装Loki:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="ba0c" class="mv jo iq mr b gy mw mx l my mz">helm install --namespace loki -n loki --version 0.2.0 giantswarm-playground/loki-stack-app</span></pre><p id="cbc1" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">等待命名空间Loki中的pod启动:</p><pre class="km kn ko kp gt mq mr ms mt aw mu bi"><span id="b444" class="mv jo iq mr b gy mw mx l my mz">kubectl -n loki get po</span></pre><p id="4071" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">现在，在Linkerd设置步骤中仍然启用端口转发，请访问<a class="ae mp" href="http://localhost:8084/grafana." rel="noopener ugc nofollow" target="_blank">http://localhost:8084/grafana。</a></p><p id="d242" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">在最左侧的菜单中，选择cog图标，然后转到“配置-&gt;数据源”。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/8c5dd83bd371026208955f164611141d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eRtq6kPUfMIZEyOL.jpg"/></div></div></figure><p id="4c80" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">单击绿色的“添加数据源按钮”并选择“Loki”。</p><p id="3b8f" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">仅在URL字段中填入<code class="fe na nb nc mr b">http://loki.loki:3100</code>，然后点击“添加并测试”。</p><p id="328b" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们的Loki现在应该可以作为数据源使用了。要进行检查，请从左侧菜单中选择指南针图标，然后单击“探索”。确保顶部的数据源类型设置为“Loki”，然后从“日志标签”值中选择“app -&gt; loki”:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/915ee43446e71a8c949d664f4d0c3c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8Uu4ugKcjT1Z5K1v.jpg"/></div></div></figure><p id="9036" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">您应该会看到显示在Grafana中的Loki日志。如果一切正常，用Ctrl+c终止终端中的“port-forward”命令。</p><p id="2bfd" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们的开发平台现在已经100%准备好了，让我们来写一些代码吧！在本系列的第2部分中，我们将创建实际的微服务应用程序，敬请关注！</p><h1 id="81d0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">我们的平台和巨型蜂群</h1><p id="fa34" class="pw-post-body-paragraph kx ky iq kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ij bi translated"><a class="ae mp" href="https://www.giantswarm.io/" rel="noopener ugc nofollow" target="_blank">在Giant Swarm </a>，我们体会到了开发环境和企业级生产环境之间的巨大差异。我们的使命是为您弥合这一鸿沟，这样您就不必独自面对这一复杂性。</p><p id="27f7" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">我们可以在几分钟内让您启动并运行生产级Kubernetes集群。如果在AWS上运行，上面提到的cert manager已经是内置的了。Giant Swarm的客户也已经在<a class="ae mp" href="https://docs.giantswarm.io/basics/app-catalog/" rel="noopener ugc nofollow" target="_blank">游乐场目录</a>中提供了Loki、LinkerD和Grafana。</p><p id="f888" class="pw-post-body-paragraph kx ky iq kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ij bi translated">由<a class="ae mp" href="https://twitter.com/piontec" rel="noopener ugc nofollow" target="_blank">尤卡兹·piątkowski</a>撰写:<strong class="kz ir"> </strong> Kubernetes平台架构师@ <a class="ae mp" href="https://twitter.com/giantswarm" rel="noopener ugc nofollow" target="_blank">巨型蜂群</a></p><div class="nf ng gp gr nh ni"><a href="https://twitter.com/piontec" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">皮翁泰克</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">来自piontec (@piontec)的最新推文:“验证我自己:我是https://t.co/VALQh9fW3B…上的piontec</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">twitter.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kv ni"/></div></div></a></div></div></div>    
</body>
</html>