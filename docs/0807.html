<html>
<head>
<title>Setting Up Cloud Firestore Security Rules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置云Firestore安全规则</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-cloud-firestore-security-rules-1ad24438805a?source=collection_archive---------0-----------------------#2018-06-01">https://itnext.io/setting-up-cloud-firestore-security-rules-1ad24438805a?source=collection_archive---------0-----------------------#2018-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/701750c75d9da6d8b742bdb1207c3780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qK3XfC6olCxJcygxPx1zBA.png"/></div></div></figure><p id="2b9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你设计了一个使用云Firestore作为数据库平台的应用程序或web应用程序，这太棒了。它工作得很好，直到有一天，你的整个数据库都不见了或被破坏。这是一场灾难，没有人希望它发生。这就是为什么我们需要安全规则！</p><ol class=""><li id="8b3a" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">如何设置云Firestore的规则？</strong></li></ol><p id="3973" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你登录到你的<strong class="ka ir"> Firebase控制台&gt; Firestore &gt;规则</strong>，然后你会看到你当前的安全规则。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lf"><img src="../Images/48d4ef5628d68d876ff2440e8110b6e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0sPjM3AjSU6EYh2M_doPDw.png"/></div></div></figure><p id="dca2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安全性也有版本控制，所以你可以随时回到以前的规则。上述规则将允许任何人读写您的云Firestore。</p><p id="cdcb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.<strong class="ka ir">如何设置安全规则</strong></p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="cea4" class="lp lq iq ll b gy lr ls l lt lu">service cloud.firestore {<br/>  match /databases/{database}/documents {<br/>    // All rules goes here</span><span id="937b" class="lp lq iq ll b gy lv ls l lt lu">  }<br/>}</span></pre><p id="78fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以为整个数据库或每个集合本身设置规则</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="88a9" class="lp lq iq ll b gy lr ls l lt lu">// The {document=**} will match any document in the entire database. <br/>match /{document=**} {<br/>   allow read, write: if &lt;condition&gt;;<br/>}</span></pre><p id="f6aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.<strong class="ka ir">为每个集合设置安全规则</strong></p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="946c" class="lp lq iq ll b gy lr ls l lt lu">match /customers/{customer} {<br/>   allow read: if true;<br/>   allow write: if request.auth != null;<br/>}</span></pre><p id="0b0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的规则将允许公众<strong class="ka ir">读取</strong>客户集合中的任何内容，但是，他们需要登录才能<strong class="ka ir">写入(创建、更新和删除)</strong>数据。</p><p id="56a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以使用函数，而不是直接在匹配中给出条件。通过利用函数，您可以在其他规则中重用条件，而不必每次都更改条件。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="3620" class="lp lq iq ll b gy lr ls l lt lu">match /customers/{customer} {<br/>   allow read: if true;<br/>   allow write: if isSignedIn();<br/>}</span><span id="53ba" class="lp lq iq ll b gy lv ls l lt lu">// Functions //<br/><strong class="ll ir">function isSignedIn(){<br/>   return request.auth != null;<br/>}</strong></span></pre><p id="a802" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.<strong class="ka ir">测试安全规则</strong></p><p id="1c25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一种方法可以让您在不发布规则的情况下测试安全规则。通过这样做，您不会弄乱当前的部署。您的客户会对此感到高兴。</p><p id="58ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用嵌入式模拟器来测试所有的安全规则。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/6768e5d17899dabd2c76a2d1ac6134b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ImIMISnEHJ82-GxnVHd8Mw.png"/></div></div></figure><p id="493d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我正在客户集合上测试读取规则。任何人都可以在不登录的情况下评估客户集合。</p><p id="96ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，没有认证就不能编辑数据库——这很好；)</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lx"><img src="../Images/ca430a7544b7be5530a109028f976e52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aCqbqSHU7IChu8rEJ_S4Q.png"/></div></div></figure><p id="a442" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将尝试在登录Firebase后是否可以写。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/8c3c5560c55b67e2ec7b85b57a50de4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ctYwf-s7PHWoOQ9FyBeiAA.png"/></div></div></figure><p id="5978" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，在认证之后，写规则是pass。在这个测试中，我尝试使用电子邮件和密码登录。有更多的方法供你测试。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/053808540a78f322aad101a12123cf41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdHWbGU_jrQPSIaf2KNHlQ.png"/></div></div></figure><p id="0c79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过这样做，您将减少在部署安全规则时可能犯的错误。</p><p id="6787" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.<strong class="ka ir">其他有用的招数</strong></p><p id="7ad5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我可能不是一个诡计，它只是一些代码，您可以使用部署到您的安全规则</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="885c" class="lp lq iq ll b gy lr ls l lt lu">// Check if document is exists<br/>function documentIdExists() {<br/>     return exists(/databases/$(database)/documents/users/$(request.auth.uid));<br/>}</span><span id="b856" class="lp lq iq ll b gy lv ls l lt lu">// Check if userId exists in the document <br/>function userExistsInDocument() {<br/>     return resource.data.userId == request.auth.uid;<br/>}</span><span id="3041" class="lp lq iq ll b gy lv ls l lt lu">// Check if email exists in the document <br/>function userExistsInDocument() {<br/>     return resource.data.email == request.auth.token.email;<br/>}</span></pre><p id="7261" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您找不到您想要的内容，请留下评论或阅读<a class="ae ma" href="https://firebase.google.com/docs/firestore/security/get-started" rel="noopener ugc nofollow" target="_blank">云Firestore安全文档</a>。</p></div></div>    
</body>
</html>