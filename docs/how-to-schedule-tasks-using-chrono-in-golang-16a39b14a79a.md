# 如何在 Golang 中使用 Chrono 安排任务

> 原文：<https://itnext.io/how-to-schedule-tasks-using-chrono-in-golang-16a39b14a79a?source=collection_archive---------0----------------------->

![](img/f2471a544158a35ea8da3adfe97decd9.png)

在本文中，您将学习如何使用 [**Chrono**](https://github.com/procyon-projects/chrono) 调度任务和取消已调度的任务，这是一个调度程序库，允许您定期运行任务和代码。

借助 Chrono 库，在 Golang 中安排任务非常容易。

现在让我们跳到例子中，看看它有多简单。

# 安排一次性任务

**Schedule** 方法帮助我们安排任务在指定的时间运行一次。在下面的示例中，任务将在当前时间 1 秒后首先执行。

> `WithStartTime`选项用于指定执行时间。

# 以固定速率调度任务

让我们安排一个任务以固定的秒速率运行。

无论前一个任务的状态如何，下一个任务总是在 5 秒钟后运行，前一个任务可能仍在运行。因此，即使上一个任务没有完成，下一个任务也会运行。

我们还可以使用`WithStartTime`选项来指定任务期望的第一次执行时间。

当我们使用这个选项时，任务将在指定的执行时间运行，随后在给定的时间内运行。在上面的例子中，任务将首先在当前时间之后 2 秒执行。

根据我们的要求，我们也可以将这个选项与`WithLocation`结合起来。

在上面的示例中，任务将首先在美国/纽约时间当前日期的 18:45 执行。

> **如果开始时间已经过去，任务将立即执行。**

# 调度具有固定延迟的任务

让我们调度一个任务，使其在上次执行任务的结束时间和下次执行任务的开始时间之间有一个固定的延迟。

固定延迟计算最后一次执行完成后的延迟。

考虑下面的例子:

由于任务本身需要 3 秒钟才能完成，并且我们已经指定了任务上一次执行的完成时间和任务下一次执行的开始时间之间的 5 秒钟延迟，因此两次执行之间将有 8 秒钟的延迟。

> `WithStartTime`和`WithLocation`选项可以与此结合。

# 使用 Cron 表达式调度任务

有时固定速率和固定延迟不能满足您的需求，我们需要 cron 表达式的灵活性来调度您的任务的执行。借助提供的***ScheduleWithCron***方法，我们可以基于 Cron 表达式调度任务。

在这种情况下，我们将任务安排在每月第 10 天的 18:45 执行。

默认情况下，cron 表达式使用本地时间。然而，我们可以使用`WithLocation`选项来改变这一点。

在上面的示例中，任务将被安排在美国/纽约时间每月第 10 天的 18:45 执行。

> `WithStartTime`选项不能与 **ScheduleWithCron 一起使用。**

# 取消计划任务

调度方法返回一个类型为 **ScheduledTask** 的实例，它允许我们取消一个任务或者检查任务是否被取消。 ***取消*** 方法取消已调度的任务，但不会中断正在运行的任务。

# 关闭调度程序

***shut down()****方法不会导致*调度器*立即关闭并返回一个通道。它将使*调度器*停止接受新任务，并在所有正在运行的任务完成当前工作后关闭。*

# *结论*

*在本文中，您了解了如何使用 Chrono 来安排和取消任务。*

*感谢您的阅读。我希望你喜欢它。*

*下一篇文章再见。*

*[](https://github.com/procyon-projects/chrono) [## procyon 项目/chrono

### Chrono 是一个调度程序库，可以让你运行你的任务和代码，定期调度一个任务，在一个固定的延迟可以…

github.com](https://github.com/procyon-projects/chrono)*