<html>
<head>
<title>Developing JavaScript Applications on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上开发JavaScript应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/developing-javascript-applications-on-kubernetes-307775c1fb84?source=collection_archive---------2-----------------------#2021-03-03">https://itnext.io/developing-javascript-applications-on-kubernetes-307775c1fb84?source=collection_archive---------2-----------------------#2021-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f918" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用远程呈现和节点构建云开发环境</h2></div><p id="a940" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现代组织采用Kubernetes来更快地发布特性。使用Kubernetes，用户可以部署和扩展任何规模的容器化应用程序:从一个服务到数千个服务。通常，Kubernetes的学习曲线特别陡峭，尤其是对于应用程序开发人员来说。Kubernetes应用程序开发需要新流程和新工具。那么JavaScript开发者如何在Kubernetes上创建一个快速有效的开发工作流呢？</p><p id="d9a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Kubernetes上构建生产性开发实验有两个主要挑战:</p><ol class=""><li id="22fb" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">Kubernetes应用程序被设计为原生于云，但是大多数遗留开发工作流是为本地开发而构建的。</li><li id="12cd" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">Kubernetes应用程序建立在微服务架构之上。随着新的微服务向您的应用程序添加额外的依赖项，开发环境变得更加复杂。这些<a class="ae lp" href="https://www.getambassador.io/resources/eliminate-local-resource-constraints/" rel="noopener ugc nofollow" target="_blank">服务很快变得过于消耗资源</a>，并且超出了本地机器的限制。</li></ol><p id="f79b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将为Kubernetes设置一个开发环境，并对NodeJS微服务进行更改。要进行本地开发，我们必须等待容器构建，推进到注册中心并进行部署，以查看代码更改的效果。相反，我们将使用<a class="ae lp" href="http://www.getambassador.io/products/telepresence/" rel="noopener ugc nofollow" target="_blank">网真</a>来立即看到我们改变的结果。</p><h1 id="4759" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">步骤1:部署一个示例微服务应用程序</h1><p id="a8f8" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">对于本例，我们将对在资源密集型Java服务和大型数据存储之间运行的NodeJS服务进行代码更改。我们将从部署一个由3个服务组成的示例微服务应用程序开始:</p><ul class=""><li id="c40a" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mn lh li lj bi translated"><strong class="kh ir">verlargejavaservice</strong>:用Java编写的内存密集型服务，为我们的应用程序生成前端图形和网页</li><li id="b698" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mn lh li lj bi translated"><strong class="kh ir"> DataProcessingService </strong>:一个NodeJS服务，管理两个服务之间的信息请求。</li><li id="6cde" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mn lh li lj bi translated"><strong class="kh ir">verylagedatastore</strong>:一个大型数据存储服务，包含Edgey公司商店的样本数据。</li></ul><p id="f85d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:我们调用这些非常大的服务是为了强调这样一个事实，即您的本地环境可能没有足够的CPU和RAM，或者您可能不想为每个开发人员支付所有额外的开销。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mo"><img src="../Images/dedd67adb82f7cf6bdff68573d148eae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RhejSLeQ-XND_gOtnCohw.png"/></div></div></figure><p id="dae6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个架构图中，您会注意到来自用户的请求通过入口控制器路由到我们的服务。为了简单起见，我们将在本教程中跳过<a class="ae lp" href="https://www.getambassador.io/docs/latest/topics/install/install-ambassador-oss/#kubernetes-yaml" rel="noopener ugc nofollow" target="_blank">部署入口控制器</a>的步骤。如果您准备在自己的设置中使用网真，并且需要一种简单的方法来设置入口控制器，我们建议查看<a class="ae lp" href="https://www.getambassador.io/products/edge-stack/" rel="noopener ugc nofollow" target="_blank"> Ambassador Edge Stack </a>，它可以通过<a class="ae lp" href="https://app.getambassador.io/initializer" rel="noopener ugc nofollow" target="_blank"> K8s初始化器</a>轻松配置。</p><ol class=""><li id="6eab" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">将示例应用程序部署到您的Kubernetes集群</li></ol><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="1067" class="nf lr iq nb b gy ng nh l ni nj">kubectl apply -f <a class="ae lp" href="https://raw.githubusercontent.com/datawire/edgey-corp-nodejs/main/k8s-config/edgey-corp-web-app-no-mapping.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/datawire/edgey-corp-nodejs/main/k8s-config/edgey-corp-web-app-no-mapping.yaml</a></span></pre><h1 id="d574" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">步骤2:设置您的本地开发环境</h1><p id="f4ac" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我们需要一个本地开发环境，这样我们就可以编辑<code class="fe nk nl nm nb b">DataProcessingService</code>服务。正如您在上面的架构图中所看到的，<code class="fe nk nl nm nb b">DataProcessingService</code>依赖于<code class="fe nk nl nm nb b">VeryLargeJavaService</code>和<code class="fe nk nl nm nb b">VeryLargeDataStore</code>，因此为了对此服务进行更改，我们还必须与这些其他服务进行交互。我们开始吧！</p><ol class=""><li id="7d9e" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">从GitHub克隆这个应用程序的存储库。</li></ol><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="dc07" class="nf lr iq nb b gy ng nh l ni nj">$ git clone <a class="ae lp" href="https://github.com/datawire/edgey-corp-nodejs" rel="noopener ugc nofollow" target="_blank">https://github.com/datawire/edgey-corp-nodejs</a>.git</span></pre><p id="fe29" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.将目录更改为数据处理服务</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="fb1c" class="nf lr iq nb b gy ng nh l ni nj">$ cd edgey-corp-nodejs/DataProcessingService</span></pre><p id="a8b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.安装依赖项并在本地启动服务。</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="4f04" class="nf lr iq nb b gy ng nh l ni nj">$ npm install &amp;&amp; npm start</span></pre><p id="493b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.您现在应该看到您的服务正在运行！</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="8d37" class="nf lr iq nb b gy ng nh l ni nj">==trimmed===<br/>Welcome to the DataProcessingNodeService!<br/>{ _: [] }</span><span id="846d" class="nf lr iq nb b gy nn nh l ni nj">Server running on port 3000</span></pre><p id="5d08" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5.测试应用程序。在另一个终端中，我们将向服务发送一个请求，它应该返回‘blue’。</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="0fb9" class="nf lr iq nb b gy ng nh l ni nj">$ curl localhost:3000/color</span><span id="29a4" class="nf lr iq nb b gy nn nh l ni nj">“blue”</span></pre><h1 id="c4ee" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">步骤3:使用网真快速开发</h1><p id="0573" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">我们将使用Telepresence，这是一个开源云本地计算基金会项目，而不是等待容器映像构建、推送到存储库并部署到Kubernetes集群。Telepresence在您的本地开发和Kubernetes集群之间创建了一个双向网络连接，以实现快速、高效的Kubernetes开发。</p><ol class=""><li id="9488" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">下载网真(约60MB)</li></ol><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="62b0" class="nf lr iq nb b gy ng nh l ni nj"># Mac OS X<br/>sudo curl -fL <a class="ae lp" href="https://app.getambassador.io/download/tel2/darwin/amd64/latest/telepresence" rel="noopener ugc nofollow" target="_blank">https://app.getambassador.io/download/tel2/darwin/amd64/latest/telepresence</a> -o /usr/local/bin/telepresence</span><span id="4668" class="nf lr iq nb b gy nn nh l ni nj">#Linux<br/>sudo curl -fL https://app.getambassador.io/download/tel2/linux/amd64/latest/telepresence -o /usr/local/bin/telepresence </span></pre><p id="7c3f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.使二进制文件可执行</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="343e" class="nf lr iq nb b gy ng nh l ni nj">$ sudo chmod a+x /usr/loca/bin/telepresence</span></pre><p id="2c1b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.通过连接到远程集群来测试远程呈现</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="f1c8" class="nf lr iq nb b gy ng nh l ni nj">$ telepresence connect</span></pre><p id="9bf2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">4.向Kubernetes API服务器发送请求:</p><pre class="mp mq mr ms gt na nb nc nd aw ne bi"><span id="3fea" class="nf lr iq nb b gy ng nh l ni nj">$ curl -ik <a class="ae lp" href="https://kubernetes.default.svc.cluster.local" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc.cluster.local</a></span><span id="2fb9" class="nf lr iq nb b gy nn nh l ni nj">HTTP/1.1 401 Unauthorized<br/>Cache-Control: no-cache, private<br/>Content-Type: application/json<br/>Www-Authenticate: Basic realm="kubernetes-master"<br/>Date: Tue, 09 Feb 2021 23:21:51 GMT</span></pre><p id="bc90" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了！您已经成功配置了网真。现在，Telepresence正在拦截您向Kubernetes API服务器发出的请求，并通过其直接连接路由到集群，而不是通过互联网。</p><h1 id="9112" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">步骤4:拦截NodeJS服务</h1><p id="983a" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">截取是远程呈现的路由规则。我们可以创建一个拦截来路由去往集群中的<code class="fe nk nl nm nb b">DataProcessingService</code>的流量，而是将所有流量路由到在端口3000上运行的<code class="fe nk nl nm nb b">DataProcessingService</code>的<em class="no">本地</em>版本。</p><ol class=""><li id="fb51" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">创造拦截<code class="fe nk nl nm nb b">telepresence intercept dataprocessingservice --port 3000</code></li><li id="9801" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">通过网真直接访问应用程序。拜访<code class="fe nk nl nm nb b"><a class="ae lp" href="http://verylargejavaservice:8080" rel="noopener ugc nofollow" target="_blank">http://verylargejavaservice:8080</a></code>。同样，网真拦截来自浏览器的请求，并将它们直接路由到Kubernetes集群。</li><li id="17a4" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">现在，我们将更改代码。打开<code class="fe nk nl nm nb b">edgey-corp-nodejs/DataProcessingService/app.js</code>，将<code class="fe nk nl nm nb b">DEFAULT_COLOR</code>从<code class="fe nk nl nm nb b">blue</code>改为<code class="fe nk nl nm nb b">orange</code>。保存文件。</li><li id="d79e" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">在浏览器中重新加载页面，看看颜色是如何从蓝色变成橙色的！</li></ol><p id="22b9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！借助网真，我们看到了从编辑本地服务到查看这些变化在部署到更大的应用程序时会是什么样子的速度。当您将它与我们在每次更改后构建和部署容器的原始过程进行比较时，很容易看到您可以节省多少时间，尤其是当我们进行更复杂的更改或运行更大的服务时。</p><h1 id="8bdd" class="lq lr iq bd ls lt lu lv lw lx ly lz ma jw mb jx mc jz md ka me kc mf kd mg mh bi translated">了解有关网真的更多信息</h1><p id="9873" class="pw-post-body-paragraph kf kg iq kh b ki mi jr kk kl mj ju kn ko mk kq kr ks ml ku kv kw mm ky kz la ij bi translated">今天，我们已经了解了如何使用网真来快速迭代运行在Kubernetes中的NodeJS微服务。现在，我们不用等待缓慢的本地开发过程，而是可以通过即时反馈循环和高效的云原生开发环境快速迭代。</p><p id="0a63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想了解更多有关网真的信息，请查看以下资源:</p><ul class=""><li id="6148" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la mn lh li lj bi translated">观看<a class="ae lp" href="https://www.youtube.com/watch?v=W_a3aErN3NU" rel="noopener ugc nofollow" target="_blank">演示视频</a></li><li id="3fed" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mn lh li lj bi translated">阅读更多关于<a class="ae lp" href="https://www.getambassador.io/docs/latest/telepresence/howtos/intercepts/#intercepts" rel="noopener ugc nofollow" target="_blank">拦截的信息</a></li><li id="5524" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mn lh li lj bi translated">了解<a class="ae lp" href="https://www.getambassador.io/docs/pre-release/telepresence/howtos/preview-urls/#collaboration-with-preview-urls" rel="noopener ugc nofollow" target="_blank">预览URL</a>以便与队友轻松协作</li><li id="49fc" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la mn lh li lj bi translated"><a class="ae lp" href="https://d6e.co/slack" rel="noopener ugc nofollow" target="_blank">加入我们的Slack频道</a>与网真社区建立联系</li></ul><p id="8c05" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的下一个教程中，我们将使用Telepresence来设置一个本地Kubernetes开发环境，然后使用VSCode来设置断点和调试一个中断的服务。当有更多教程可用时，我们会通知您，请务必<a class="ae lp" href="http://www.getambassador.io" rel="noopener ugc nofollow" target="_blank">查看我们的网站</a>或<a class="ae lp" href="http://www.twitter.com/ambassadorlabs" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我们</a>。</p></div></div>    
</body>
</html>