# JavaScript 性能的现实

> 原文：<https://itnext.io/the-reality-of-javascript-performance-4ec9747882d3?source=collection_archive---------4----------------------->

![](img/44c78a531eaea594faeced2b827a6389.png)

由[乔尔·M·马修](https://unsplash.com/@joelmmathey?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

## 速度妖龟！

如果你想知道如何让 JavaScript 更快，这篇文章将解释这在现实世界中是多么的无关紧要。

我特别指的是普通的 JavaScript 开发人员。如果你是一名数据科学家，大量的数据就是你的生命；我明白了。

# JavaScript 开发则不同

在典型的 web 应用程序中，您一次处理 3-20 个项目，因此性能可以忽略不计。

您知道 JavaScript 中不同数据结构的性能差异吗？我知道我没有，但我有一些想法。问题是，我在 JavaScript 中很少遇到大型数据集。大多数时候，我在遗留应用程序中发现它们。尽管如此，通常还有更大的性能瓶颈。

您可能正在处理大型数据集。即使在 Node.js 中，通常也是对数据进行分页，让数据库来处理繁重的工作。考虑到很少能看到多个条目，我遇到过很多真正关心 JavaScript 性能的人。

我认识的一个人在嵌入式系统领域工作了多年。我也在里面工作过。性能、内存、输出代码大小，在这些场景中，一切都很重要。但是他喜欢把这种心态带到我们的前端代码中。因为他对速度的需求，他创造了许多不可读的代码，这些代码最终被删除并重写。

还有一种情况是 2016 年左右我开始写功能代码的时候。我记得在一次代码审查中，有人抱怨连续两次使用`map`函数。

这是一个由 3 个条目组成的数组，使用了两个`map`语句使得它更容易阅读，但是在那个评论中有人担心它会降低执行速度。速度上的差异可能只有几微秒，但这对那些开发者来说很重要。

几乎在所有情况下，我都担心代码的可读性和可维护性。我关心的是，其他开发人员是否很容易进来并弄清楚发生了什么。我担心 6 个月后我可能不得不重构或修复代码中的一个 bug。

在 JavaScript 领域，我的观点是性能应该被忽略。让它工作，让它可维护，然后再考虑改进它。因为改进 JavaScript 很可能会使代码变得不可读。

# 当下的表现

应用程序的性能在很大程度上取决于 JavaScript 解释器。在很大程度上，随着未来解释器的更新，你过去写的很多东西会变得更快。

但也可能是相反的。你可以用 janky 方法 X 写你的代码，因为你听说它更快。

当 V8 得到升级时，方法 Y 突然变得和它应该的一样快，但是现在你有了用 janky 方式编写的所有遗留代码。除非您真的需要这种性能，否则您只是让自己成为了一个传统的应用程序。

不相信我？不讨论节点 10 与节点 8 的性能数据，让我们来看一个几年前让我着迷的真实例子。

我们来看看这个 2010 年的 StackOverflow 回答:
https://stack overflow . com/questions/2781686/JavaScript-string-concatenation-slow-performance-array-join/2781854 # 2781854

> 看来 Array.join()在大多数情况下跨浏览器更快。

而这篇文章也出自 2010:
[https://www . site point . com/JavaScript-fast-string-concatenation/](https://www.sitepoint.com/javascript-fast-string-concatenation/)

> Chrome 6.0 :标准的字符串追加通常比数组连接更快，但都在 10 毫秒内完成。
> 
> **Opera 10.6** :同样，标准追加更快，但差别很小——通常是 15 毫秒，而数组连接是 17 毫秒。
> 
> **Firefox 3.6** :浏览器通常需要 30 毫秒左右的时间。数组连接通常有边缘，但只有几毫秒。
> 
> **IE 8.0** :标准的追加需要 30 毫秒，而数组连接需要两倍以上的时间——通常为 70 毫秒。
> 
> **Safari 5.0.1** :奇怪的是，一个标准的 append 不超过 5ms，但是一个数组 join 却慢了十倍以上，为 55ms。

字符串串联和`Array.prototype.join`相比真的那么慢吗？没有。不再是了。但是由于这篇文章，您可能会看到一些遗留代码仍然在使用它。为什么？

> IE7 和更低版本使用串联处理程序重复复制字符串，导致时间和内存使用呈指数级增长。相比之下，阵列连接在不到 200 毫秒的时间内完成，快了 800 多倍。

多年前，我搞砸了一个代码项目，因为我选择了“更快”`join`的方法。我的代码根本不可读，更不用说速度了。

因为 IE7，我曾经不得不做一些奇怪的事情来提高性能。但是你猜怎么着？在现实世界中，这些表现都无关紧要；至少，不包括我正在开发的应用程序。

# 真是个伪君子

实际上，我最近遇到了一种情况，我需要更快的执行时间。为此我使用了转换器，并写了几篇关于 T2 JavaScript 处理速度的文章。那个项目有一个 20K 项的列表，这无疑导致了一个性能瓶颈。

但是我不是说过你不会碰到这种东西吗？

对于这种独一无二的情况，真正的解决方案不是自己解决，而是获得一个预先格式化的 JSON 文件。

这样，我就不必处理数据，公司也可以静态托管数据。即使在客户端创建文件需要一分钟，这也是一台工作机的时间和资源，而不是每次打开浏览器时每台客户机的时间和资源。

我写了自己的解决方案作为临时措施，但是在证明了那个解决方案之后，他们接管格式化是有意义的。

所以真正的解决方案是让别人来写代码。有点逃避，但这也是我在行业中遇到的:“让后端开发人员管理他们自己的数据”。

# DOM 渲染

我认为很多性能问题都来自于没有处理异步代码。这就是我在职业生涯中发现真正性能瓶颈的地方。

比如:

*   点击一个按钮，但没有给出任何迹象表明后台正在发生的事情(看看你的蒸汽注册过程！).
*   呈现文本输入，但不允许用户一看到它就点击并开始输入。

允许您的应用程序并发运行可以解决用户感觉到的性能问题。例如，React 有异步模式，现在称为并发模式。它允许以更高的优先级呈现对某些用户难以处理的组件的更改。

更快地加载数据没有帮助，因为这是一个更深层次的基本问题:DOM 很慢。事实上，任何“打印”命令都会很慢。想想输出到控制台，甚至一个真正的纸打印机。

# 结论

处理速度重要吗？只有在非常特殊的情况下。找出那些在哪里，并在那些部分上工作。不要为了获得几微秒的额外执行时间而使整个代码库不可读。

请记住，你必须雇用其他开发人员来从事这些项目，你希望他们高兴！当你可以把时间花在改善用户体验上时，不要浪费时间担心性能。

# 更多阅读

如果您想了解更多关于 JavaScript 性能的内容，请查看以下文章:

*   [加速 JavaScript 数组处理](/speed-up-javascript-array-processing-8d601c57bb0d)
*   [使用转换器加速 JavaScript 数组](/using-transducers-to-speed-up-javascript-arrays-92677d000096)

如果你喜欢你所读的，请查看我关于类似的令人大开眼界的主题的其他文章:

*   [试听:权威指南](/the-definitive-guide-to-callbacks-in-javascript-44a39c065292)
*   [承诺:权威指南](/promises-the-definitive-guide-6a49e0dbf3b7)
*   [特性标志:真正敏捷](/feature-flags-be-truly-agile-820ff50294c)
*   用食物表情符号制作便便