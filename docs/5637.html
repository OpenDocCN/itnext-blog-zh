<html>
<head>
<title>Getting started with Elasticsearch 7 in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的Elasticsearch 7入门</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-elasticsearch-7-in-python-520ddc8d2d8d?source=collection_archive---------3-----------------------#2021-04-21">https://itnext.io/getting-started-with-elasticsearch-7-in-python-520ddc8d2d8d?source=collection_archive---------3-----------------------#2021-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4263af470aa00f4317bf6e46d49523cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mL_-8takTq2_Bs_I.png"/></div></div></figure><p id="f019" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大约3年前，也就是2018年6月，我曾<a class="ae kw" href="http://blog.adnansiddiqi.me/getting-started-with-elasticsearch-in-python/" rel="noopener ugc nofollow" target="_blank">写过关于Elasticsearch的</a>。在此期间，一个新的Elasticsearch版本推出，其中有一些新的功能和变化。我会在这篇文章中重复一些概念，所以人们不必去旧的文章中了解它。那么，让我们开始吧！</p><h1 id="58d7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是ElasticSearch？</h1><p id="0011" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">ElasticSearch (ES)是一个分布式的、高度可用的开源搜索引擎，构建于Apache Lucene之上。它是用Java构建的开源软件，因此适用于许多平台。你以JSON格式存储非结构化数据，这也使它成为一个NoSQL数据库。因此，与其他NoSQL数据库不同，es还提供搜索引擎功能和其他相关功能。</p><h1 id="994c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">弹性搜索用例</h1><p id="7b86" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">您可以将ES用于多种目的，下面给出了其中的几种:</p><ul class=""><li id="c8e5" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated">你正在运营一个提供大量动态内容的网站；无论是电子商务网站还是博客。通过实现ES，你不仅可以为你的web应用提供一个强大的搜索引擎，还可以在你的应用中提供原生的自动完成功能。</li><li id="2f9d" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">您可以接收不同种类的日志数据，然后使用来查找趋势和统计数据。</li><li id="23a1" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">全文搜索。</li><li id="1533" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated">事件数据和指标</li></ul><h1 id="cb9d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置和运行</h1><p id="6579" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">安装ElasticSearch最简单的方法就是<a class="ae kw" href="https://www.elastic.co/downloads/elasticsearch" rel="noopener ugc nofollow" target="_blank">下载</a>并运行可执行文件。您必须确保您使用的是Java 7或更高版本。</p><p id="b879" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下载后，解压并运行它的二进制文件。</p><p id="8973" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr ms b">elasticsearch-7.11.1/bin/elasticsearch</code></p><p id="fe76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">滚动窗口中会有很多文本。如果你看到下面这样的东西，那么它似乎是向上的。</p><p id="99e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr ms b">publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}</code></p><p id="4f73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，既然，眼见为实，在你的浏览器中或者通过cURL访问URL <code class="fe mp mq mr ms b">http://localhost:9200</code>，下面这样的东西应该会欢迎你:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/7d7d47243d01de6da9fefe89ec217585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yrk8L7jpH5xNKsF2.png"/></div></div></figure><p id="fea1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">版本号为<code class="fe mp mq mr ms b">7.11.1</code>，是ES版本。</p><p id="8855" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在我继续使用Python访问弹性搜索之前，让我们做一些基本的事情。正如我提到的，ES提供了一个<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs.html" rel="noopener ugc nofollow" target="_blank"> REST API </a>接口，我们将使用它来执行不同的任务。我将使用<a class="ae kw" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Postman应用</a>来执行REST APIs。</p><h1 id="1a3a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">基本示例</h1><h1 id="1566" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建索引</h1><p id="b06b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">您要做的第一件事就是创建一个索引<em class="ma"/>。一切都存储在索引中。与<em class="ma">索引</em>相对应的RDBMS是一个<em class="ma">数据库</em>,所以不要将它与您在RDBMS中学习的典型索引概念相混淆。请注意PUT是用来代替POST的。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/bb23457270f51c58d9a98dd509e69f06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IfeuIokw_Qo2OoqR.png"/></div></div></figure><p id="a219" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我再跑，它会拼命尖叫。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/59b2685444ec3d4f052b7db623ada3c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*honwFNce_qLbHKN1.png"/></div></div></figure><p id="11d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我们创建了一个名为<em class="ma"> company </em>的数据库。换句话说，我们创建了一个名为<em class="ma">公司</em>的<em class="ma">指数</em>。如果您从浏览器访问<code class="fe mp mq mr ms b">http://localhost:9200/company</code>,您会看到如下内容:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/dc203095fed809daeb502cf4e2a8c6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OcjtaNd4nP-0j-oC.png"/></div></div></figure><p id="d199" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">暂时忽略<code class="fe mp mq mr ms b">mappings</code>,我们稍后会讨论它。它实际上只是为你的文档创建一个模式。<code class="fe mp mq mr ms b">creation_date</code>不言自明。<code class="fe mp mq mr ms b">number_of_shards</code>告知将保存该<em class="ma">索引</em>的数据的分区数量。将全部数据保存在一个磁盘上毫无意义。如果您正在运行一个由多个弹性节点组成的集群，那么整个数据将在这些节点之间进行分割。简而言之，如果有5个分片，那么整个数据在5个分片上都是可用的，ElasticSearch集群可以为来自任何节点的请求提供服务。</p><p id="0d6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">复制品谈论镜像你的数据。如果你熟悉<em class="ma">主从</em>概念，那么这对你来说应该不陌生。你可以在这里了解更多基本的ES概念。</p><p id="af35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以一次完成索引创建和记录插入。你所要做的就是以JSON格式传递你的记录。你可以在<em class="ma">邮差</em>里看到如下内容:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/ad10a29d7361af06e5d517a975abb597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cuHC2XVQZwdx1SMY.png"/></div></div></figure><p id="9aa6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你读过我之前的版本，你会注意到我提到了<code class="fe mp mq mr ms b">/employees</code>而不是<code class="fe mp mq mr ms b">doc</code></p><p id="23b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是因为从ES7+文档类型已经被<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/removal-of-types.html" rel="noopener ugc nofollow" target="_blank">移除</a>，因此也不能用于映射。现在建议为每种文档类型创建一个索引，因此现在将使用通用的<code class="fe mp mq mr ms b">doc</code>。您仍然可以创建旧的方式，但会面临的问题，而创建映射。</p><h1 id="4c87" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建/更新文档</h1><p id="44e4" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">之前我同时创建了索引和文档，但并不总是这样。如果您必须创建更多的文档，该怎么办？</p><p id="0b28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我正在删除之前创建的索引和文档，并重新创建没有文档信息的<em class="ma">公司</em>索引。顺便说一下，如果你只是删除索引，它会删除所有相关的文件。</p><p id="5a75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我将在现有索引中创建一个文档。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/36cd94531b14a31f1a93dd02b08bec9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-ZZ1pvYjkO9z2WIG.png"/></div></div></figure><p id="e69d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，我传递了一个JSON结构，它返回了一个JSON响应。注意设置为<code class="fe mp mq mr ms b">created</code>的字段<code class="fe mp mq mr ms b">result</code>。如果我再次发出同样的请求，它会被改成<code class="fe mp mq mr ms b">updated</code>。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/0c22ece4e68c7c19d10a5c38bf5db0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3uEOJ_ZvBUpPXsyL.png"/></div></div></figure><p id="517e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以下是一些需要注意的事项:<code class="fe mp mq mr ms b">result</code>改为<code class="fe mp mq mr ms b">updated</code>。虽然我把<code class="fe mp mq mr ms b">NAME</code>改成了<code class="fe mp mq mr ms b">Jhon Duh</code>。即使我不修改它，它仍然会被认为是Elasticsearch的更新文档。注意<code class="fe mp mq mr ms b">version</code>字段，它现在变成了<code class="fe mp mq mr ms b">3</code>，因为第一个版本是<code class="fe mp mq mr ms b">1</code>(检查上面的图片)，然后我就把它和现在这个。每次你点击请求，它就会更新版本。请记住这种版本控制是为了内部目的，您不能通过提及版本号来检索文档的以前版本。您必须自己实现该机制。</p><p id="4ac2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的URL中，我将<code class="fe mp mq mr ms b">1</code>作为ID传递。Elasticsearch将文档类型和<code class="fe mp mq mr ms b">/</code>后的任何内容设置到<code class="fe mp mq mr ms b">ID</code>中。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/d9e19995d6dcb8bee6b514b4fbda4b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ojo3vSEgF9jHA_2w.png"/></div></div></figure><p id="2382" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意这里的<code class="fe mp mq mr ms b">_id</code>字段。它是一串随机的字母数字字符。IMO不提及ID更好，因为它不是RDBMS，提供随机ID有助于避免猜测ID，因此不能运行自动过程来获取所有文档。</p><h1 id="8b02" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">取一份文件</h1><p id="bebc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">获取一份文件不是火箭科学。您所要做的就是通过传递ID向您的文档发出一个<code class="fe mp mq mr ms b">GET</code>请求。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/cc0dffc83e6246affd3a2cc0ff371ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nPstFKyQwFByi3ec.png"/></div></div></figure><p id="f1ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过提及ID，您可以检索文档</p><h1 id="a738" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">获取索引中的所有文档</h1><p id="6521" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">通过访问URL <code class="fe mp mq mr ms b">http://localhost:9200/company/doc/_search</code>，您可以获取索引中的所有文档。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/0f2c27a4fe117dcf8a4d2ec404e6335a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/0*V2iEMIkIW3TGfMzC.png"/></div></figure><p id="2d99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你只需在<code class="fe mp mq mr ms b">/doc</code>后提到<code class="fe mp mq mr ms b">_search</code>，它就会返回所有。类似于<code class="fe mp mq mr ms b">SELECT * FROm TABLE</code>。</p><h1 id="94f1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">删除索引/文档</h1><p id="a072" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">删除索引或文档是一件非常简单的事情。你所要做的就是发送一个<strong class="ka ir">删除</strong>请求。</p><ul class=""><li id="a050" class="mb mc iq ka b kb kc kf kg kj md kn me kr mf kv mg mh mi mj bi translated"><strong class="ka ir"> <em class="ma">删除文档:- </em> </strong> <code class="fe mp mq mr ms b">curl -X DELETE \ http://localhost:9200/company/_doc/1 \ -H 'cache-control: no-cache' \ -H 'content-type: application/json' \ -H 'postman-token: 92e4cbf1-0019-16ec-bc1c-4ed8ffa16e99'</code></li><li id="9bd2" class="mb mc iq ka b kb mk kf ml kj mm kn mn kr mo kv mg mh mi mj bi translated"><strong class="ka ir"> <em class="ma">删除一个指标:- </em> </strong> <em class="ma"> </em> <code class="fe mp mq mr ms b"><em class="ma">curl -X DELETE \ http://localhost:9200/company/ \ -H 'cache-control: no-cache' \ -H 'content-type: application/json' \ -H 'postman-token: c67845af-5c96-a6ce-06dd-50ad3d8070b0'</em></code></li></ul><h1 id="08ca" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建映射</h1><p id="79f0" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如上所述，映射实际上是定义文档的模式。当您在索引中创建一个文档时，Elasticsearch通过推断文档字段来定义它自己的映射，并且您可以在单个索引中存储灵活的文档。如果您想严格控制应该存储哪些字段和哪种数据，该怎么办？映射是答案。</p><p id="58e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将删除旧的索引，并使用适当的映射重新创建它。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/8eeb02323932ddae44f5285d9bb4bc53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rTHsinoe1rNwXkjx.png"/></div></div></figure><p id="40a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我定义了两个字段的映射。也就是说，文档必须包含这些字段以及这些特定的类型。</p><p id="1df8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，让我们试着添加错误的文档。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/65b01be1ff3f64f87e0ee1abfe68a6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yfV2GmFiE2Mbpoeb.png"/></div></div></figure><p id="f91e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kewl！我把<code class="fe mp mq mr ms b">DOJ</code>换成了<code class="fe mp mq mr ms b">LOL</code>，它立刻抱怨起来。现在我传递以下信息。字段名相同，但数据错误。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/6dff7cde383ea594f4509bcdc9913010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/0*Nx2xqOnbzCKg0BDu.png"/></div></figure><p id="feb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在它给出了错误:</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/f35736fb9bcbdf528bf4381621a8c898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NbHUrUA_o_ymcC9U.png"/></div></div></figure><p id="d28f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">厉害！正如你所看到的，它立刻抱怨说我发送的是<code class="fe mp mq mr ms b">text</code>而不是<code class="fe mp mq mr ms b">date</code>类型的数据。在非常早的阶段定义模式可以省去很多麻烦。</p><h1 id="86b8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">用Python访问ElasticSearch</h1><p id="5592" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">说实话，ES的REST APIs已经足够好了，你可以用<code class="fe mp mq mr ms b">requests</code>库来执行你所有的任务。尽管如此，你可以使用一个<a class="ae kw" href="https://elasticsearch-py.readthedocs.io/en/master/" rel="noopener ugc nofollow" target="_blank"> Python库</a>进行ElasticSearch来专注于你的主要任务，而不是担心如何创建请求。</p><p id="c9da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过pip安装它，然后你可以在你的Python程序中访问它。</p><p id="4288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mp mq mr ms b">pip install elasticsearch</code></p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/de219a77c41fffeb6ac402850a59b5af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B8Or9XxvJx3fdijG.png"/></div></div></figure><p id="03fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，lib已经安装好了，现在让我们连接ES并在Python应用程序的<code class="fe mp mq mr ms b">company</code>索引中插入一个文档。</p><pre class="mu mv mw mx gt na ms nb nc aw nd bi"><span id="0a03" class="ne ky iq ms b gy nf ng l nh ni">import json</span><span id="68ac" class="ne ky iq ms b gy nj ng l nh ni">from elasticsearch import Elasticsearch</span><span id="1c74" class="ne ky iq ms b gy nj ng l nh ni">def connect_elasticsearch():<br/>    _es = None<br/>    _es = Elasticsearch([{'host': 'localhost', 'port': 9200}])<br/>    if _es.ping():<br/>        print('Yay Connected')<br/>    else:<br/>        print('Awww it could not connect!')<br/>    return _es</span><span id="4cb4" class="ne ky iq ms b gy nj ng l nh ni">def store_record(es_object, index, data):<br/>    is_stored = True</span><span id="5469" class="ne ky iq ms b gy nj ng l nh ni">try:<br/>        outcome = es_object.index(index=index, doc_type='_doc', body=json.dumps(data))<br/>        print(outcome)<br/>    except Exception as ex:<br/>        print('Error in indexing data')<br/>        print(str(ex))<br/>        is_stored = False<br/>    finally:<br/>        return is_stored</span><span id="9005" class="ne ky iq ms b gy nj ng l nh ni">if __name__ == '__main__':<br/>    data = {<br/>        "NAME": "ES",<br/>        "DOJ": "2012-04-02"<br/>    }<br/>    es = connect_elasticsearch()<br/>    r = store_record(es, 'company', data)<br/>    print(r)</span></pre><p id="cd99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码是不言自明的。在连接到ES的实例后，我发送一个JSON有效负载进行存储。当它运行时，它生成以下输出。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/83ff63d835ad466be7ef770a81c86dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O3vAq7v39VBBcxdk.png"/></div></div></figure><p id="e4d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">生成一个新文档，其id在此处，您可以在<code class="fe mp mq mr ms b">_id</code>字段中看到。您也可以传递<code class="fe mp mq mr ms b">id</code>参数，但是我依赖内部生成的id。为了验证文档是否真的生成了，我只是提出了一个我们之前讨论过的搜索请求。</p><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/e5bf4378c48f4754d7c0b05b1823c6c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ltJ-RPwTktmJW_jh.png"/></div></div></figure><h1 id="8bd6" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="3d82" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Elasticsearch是一款功能强大的工具，通过提供强大的功能来返回最准确的结果集，可以帮助您搜索现有或新的应用程序。我刚刚谈到了它的要点。一定要阅读文档，熟悉这个强大的工具。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="f173" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ma">原载于2021年4月21日</em><a class="ae kw" href="http://blog.adnansiddiqi.me/getting-started-with-elasticsearch-7-in-python/" rel="noopener ugc nofollow" target="_blank"><em class="ma">http://blog . adnansiddiqi . me</em></a><em class="ma">。</em></p></div></div>    
</body>
</html>