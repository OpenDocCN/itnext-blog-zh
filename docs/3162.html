<html>
<head>
<title>Angular Unit Test Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度单元测试自动化</h1>
<blockquote>原文：<a href="https://itnext.io/angular-unit-test-automation-8f6efcb1f1b6?source=collection_archive---------0-----------------------#2019-10-15">https://itnext.io/angular-unit-test-automation-8f6efcb1f1b6?source=collection_archive---------0-----------------------#2019-10-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/4d39b84be3ea603b8944e355b58550a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdF8L6GRBFBS8P8m5pRNmA.png"/></div></div></figure><div class=""/><p id="ece3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我如何自动化我的单元测试创建和更新工作？</p><h1 id="62fb" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如果我告诉你我可以自动生成你的单元测试会怎么样？然后维护它们？</h1><h2 id="237b" class="lu kx jb bd ky lv lw dn lc lx ly dp lg kj lz ma lk kn mb mc lo kr md me ls mf bi translated">TL；DR；</h2><blockquote class="mg mh mi"><p id="0c55" class="jy jz mj ka b kb kc kd ke kf kg kh ki mk kk kl km ml ko kp kq mm ks kt ku kv ij bi translated">没有杂务。没有无聊的样板。只是测试。</p></blockquote><p id="23e1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装SCuri和<strong class="ka jc">创建</strong>或<strong class="ka jc">更新</strong>一个<strong class="ka jc">规格</strong>文件通过:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="c820" class="lu kx jb ms b gy mw mx l my mz"><strong class="ms jc">npm install scuri</strong><br/><strong class="ms jc">ng g scuri:spec --name src/app/my.component.ts </strong><br/><em class="mj"># OR to update an existing spec</em><br/><strong class="ms jc">ng g scuri:spec --name src/app/with-spec.component.ts --update</strong></span></pre><blockquote class="mg mh mi"><p id="cbcb" class="jy jz mj ka b kb kc kd ke kf kg kh ki mk kk kl km ml ko kp kq mm ks kt ku kv ij bi translated">这就需要<a class="ae na" href="https://github.com/angular/angular-cli/releases/tag/v6.0.0" rel="noopener ugc nofollow" target="_blank"> <strong class="ka jc">角度CLI 6 </strong> </a>。对于以前的版本，请参见自述文件中的<a class="ae na" href="https://github.com/gparlakov/scuri#rule-result-function" rel="noopener ugc nofollow" target="_blank">故障排除部分。</a></p></blockquote><figure class="mn mo mp mq gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nb"><img src="../Images/092772518bcf94c318df1490cbe6d7a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dAWU-QVKc5zSyBR_.gif"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">标题实际上使用了支持角度&lt; 6的<a class="ae na" href="https://www.npmjs.com/package/@angular-devkit/schematics-cli" rel="noopener ugc nofollow" target="_blank">原理图CLI </a></figcaption></figure><p id="32c5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它还带有一个<strong class="ka jc"> VS代码扩展</strong>！<a class="ae na" href="https://marketplace.visualstudio.com/items?itemName=gparlakov.scuri-code" rel="noopener ugc nofollow" target="_blank">https://marketplace.visualstudio.com/items?itemName = gparlakov . scuri-code</a></p><h1 id="1555" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">哇，这看起来太棒了。但是有什么问题呢？</h1><p id="3ee8" class="pw-post-body-paragraph jy jz jb ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">实际上只有一个:</p><ol class=""><li id="8c24" class="nl nm jb ka b kb kc kf kg kj nn kn no kr np kv nq nr ns nt bi translated">以特定的方式组织你的测试。*</li></ol><p id="ef6c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj">*或者更确切地说，当工具生成它们时保留它</em></p><p id="8da8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SCuri 假设测试将有一个特定的<strong class="ka jc">结构</strong>。它<strong class="ka jc">假设</strong>有一个<code class="fe nu nv nw ms b"><strong class="ka jc">setup</strong></code> <strong class="ka jc"> </strong>函数(或者如果缺少的话创建一个)发生在<strong class="ka jc">设置</strong>规格<strong class="ka jc">条件</strong>的地方。并且测试的<strong class="ka jc">名称</strong>包括被测试类上的<strong class="ka jc">公共方法</strong>的名称。在本文的<a class="ae na" href="https://medium.com/ng-gotchas/an-opinionated-approach-to-testing-angular-4cf14ef7463f" rel="noopener">中阅读更多相关信息(参见第4点和第</a>)。</p><p id="8dd1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些假设<strong class="ka jc">允许</strong>it(SCuri)<strong class="ka jc">自动化</strong>为角度组件、服务和普通的旧类型脚本类创建和更新单元测试的<strong class="ka jc">任务</strong>。</p><h2 id="6dc8" class="lu kx jb bd ky lv lw dn lc lx ly dp lg kj lz ma lk kn mb mc lo kr md me ls mf bi translated">但是等等，“<code class="fe nu nv nw ms b"><strong class="ak"><em class="nx">ng generate component" </em></strong></code>已经生成了一个spec，对吧？为什么我需要另一个工具？</h2><p id="2d4f" class="pw-post-body-paragraph jy jz jb ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">是的，确实如此。但是一旦第一个<strong class="ka jc">依赖</strong>被添加到那个生成的组件，并且<strong class="ka jc">测试</strong>需要被<strong class="ka jc">更新</strong>，那就是Angular CLI从<strong class="ka jc">下降到</strong>的地方。而这就是SCuri <strong class="ka jc">闪耀</strong>的地方！</p><h1 id="518e" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">我们试试吧！</h1><p id="f617" class="pw-post-body-paragraph jy jz jb ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated"><em class="mj">假设SCuri安装在</em> <code class="fe nu nv nw ms b"><strong class="ka jc">npm install scuri</strong></code> <em class="mj">项目文件夹中，并且</em><strong class="ka jc"><em class="mj"/></strong><em class="mj"/><strong class="ka jc"><em class="mj">CLI</em></strong><em class="mj">是版本</em> <strong class="ka jc"> <em class="mj"> 6 </em> </strong> <em class="mj">或更高版本。</em></p><figure class="mn mo mp mq gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ny"><img src="../Images/a65e878a0777b25292b1fcfd96439142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chBXG2HVQT5Lcpr67oPv3w.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">我已经创建了一个没有测试的演示组件</figcaption></figure><p id="1e49" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nu nv nw ms b">ng g demo --skipTests</code></p><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="9a34" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nu nv nw ms b">ng g scuri:spec --name src/app/demo/demo.component.ts</code></p><figure class="mn mo mp mq gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/7906a8ee9168a394a99159040318e77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UqIH5jf0Ftxei3IZuhz9A.png"/></div></div></figure><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">嘣，你有了你的第一个魔法天赋！</figcaption></figure><p id="099a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有几件事需要注意:<br/> 1。<code class="fe nu nv nw ms b"><strong class="ka jc">setup</strong></code>功能。这是所有设置测试前提和依赖的地方。<br/> 2。<code class="fe nu nv nw ms b"><strong class="ka jc">autoSpy</strong></code>功能。这将为您的依赖项创建自动模拟。它将带<strong class="ka jc">任意类</strong>和<strong class="ka jc">嘲弄</strong>其<strong class="ka jc">公共</strong> <strong class="ka jc">方法</strong> (s <em class="mj"> ee详情见</em><a class="ae na" href="https://github.com/gparlakov/scuri#autospy-path-in-tsconfigjson" rel="noopener ugc nofollow" target="_blank"><em class="mj">scurie自述</em> </a>)。并且可以通过工具<strong class="ka jc">为你生成</strong><strong class="ka jc"/>！<br/> <code class="fe nu nv nw ms b">ng g scuri:autospy — for jasmine</code>:</p><figure class="mn mo mp mq gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/ee634907c8faa61ff22346a692ecc7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_lUzyRjzhJ2wV_bDTE1gg.png"/></div></div></figure><p id="8b0f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是有趣的部分:</p><p id="5115" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建服务:</p><p id="c111" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nu nv nw ms b">ng g service my</code></p><figure class="mn mo mp mq gt is gh gi paragraph-image"><div class="gh gi od"><img src="../Images/59c989a0a55bd018ef8ec3cfbd345c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*5LBTamsm5sVGQIsiNgI3pQ.png"/></div></figure><p id="cbef" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将它包含在组件依赖项中。让我们也添加一个公共事件处理方法来更好地衡量。</p><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="727f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行<code class="fe nu nv nw ms b">ng g scuri:spec --name src/app/demo/demo.component.ts --update</code></p><figure class="mn mo mp mq gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/6cbcd384a2fb2eb343dc7ce0f811bbc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWcLuIqE_HuPvikHnOm7XA.png"/></div></div></figure><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="4deb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而现在<strong class="ka jc">依赖</strong>被<strong class="ka jc">嘲讽</strong>，在<strong class="ka jc"> MyComponent build </strong>函数中<strong class="ka jc">包含了</strong>！并且<strong class="ka jc">新方法</strong>有一个<strong class="ka jc">测试支架</strong>供其使用！</p><p id="3618" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">剩下的就是逻辑，只有你这个人类可以创作。</p><h2 id="57e4" class="lu kx jb bd ky lv lw dn lc lx ly dp lg kj lz ma lk kn mb mc lo kr md me ls mf bi translated">我还可以用<code class="fe nu nv nw ms b">setup</code>功能做什么？</h2><p id="cc64" class="pw-post-body-paragraph jy jz jb ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">对于每个测试用例，我们通常需要一些设置。并且把它留在<code class="fe nu nv nw ms b">it</code>主体中会使它难以阅读。所以我们可以使用<code class="fe nu nv nw ms b">setup</code>返回的builder并在上面附加方法来设置具体的细节。</p><p id="a7f4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，假设我们需要在<code class="fe nu nv nw ms b">ngOnInit</code>中获取一些数据</p><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="24eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们再次运行<code class="fe nu nv nw ms b">ng g scuri:spec --name src/app/demo/demo.component.ts --update</code>来更新依赖关系。现在我们可以在测试中使用由<code class="fe nu nv nw ms b">autoSpy</code>创建的模拟:</p><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="9304" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，我们可以在设置生成器中移动模拟零件:</p><figure class="mn mo mp mq gt is"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="cf78" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们的测试是<strong class="ka jc"> cleaner </strong>并调用一个方法，该方法的命名是为了让<strong class="ka jc">告诉<strong class="ka jc">读者</strong>目标是什么，而不是期望他们<strong class="ka jc">通读</strong>模拟声明并<strong class="ka jc">推断</strong>作者的意思。名字承载了作者的<strong class="ka jc">意图</strong>！(这是一个虚构的琐碎例子——想想你的组件做了什么，以及你是如何嘲笑它的！)</strong></p><p id="adf4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意我们如何在<code class="fe nu nv nw ms b">default</code>构建器方法中调用<code class="fe nu nv nw ms b">withHeroes</code>。这是因为每次我们调用<code class="fe nu nv nw ms b">ngOnInit</code>时，我们都需要订阅一个可观察对象，否则我们会得到一个异常，即<code class="fe nu nv nw ms b">undefined</code>上没有<code class="fe nu nv nw ms b">subscribe</code>方法</p><h2 id="1848" class="lu kx jb bd ky lv lw dn lc lx ly dp lg kj lz ma lk kn mb mc lo kr md me ls mf bi translated">让我们来测试一下SCuri吧！(:</h2><p id="ea70" class="pw-post-body-paragraph jy jz jb ka b kb ng kd ke kf nh kh ki kj ni kl km kn nj kp kq kr nk kt ku kv ij bi translated">让我们在现实世界的项目中尝试一下吧！还有什么比<a class="ae na" href="https://github.com/gothinkster/angular-realworld-example-app" rel="noopener ugc nofollow" target="_blank">现实世界的例子App </a>更好的呢！这是一个示例中型克隆Angular应用程序，只是碰巧没有单元测试(截至今天)。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="bde4" class="lu kx jb ms b gy mw mx l my mz">git clone <a class="ae na" href="https://github.com/gothinkster/angular-realworld-example-app" rel="noopener ugc nofollow" target="_blank">https://github.com/gothinkster/angular-realworld-example-app</a><br/>cd angular-realworld-example-app<br/>npm install scuri<br/>ng g scuri:spec --name src/app/home/home.component.ts</span></pre><p id="0eb2" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在<code class="fe nu nv nw ms b">src/app/home/home.component.spec.ts</code>已经模拟并准备好了依赖项，公共方法测试也搭建好了。准备好让你做测试了，魔术师。</p><p id="c376" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有杂务。没有无聊的样板。只是测试。</p></div></div>    
</body>
</html>