<html>
<head>
<title>How to activate VMware vNUMA with lower vCPU count</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何激活vCPU数量较少的VMware vNUMA</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-activate-vmware-vnuma-with-lower-vcpu-count-156ba88e26f8?source=collection_archive---------2-----------------------#2018-11-15">https://itnext.io/how-to-activate-vmware-vnuma-with-lower-vcpu-count-156ba88e26f8?source=collection_archive---------2-----------------------#2018-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9b38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自从我们发布了<a class="ae kl" href="https://www.opvizor.com" rel="noopener ugc nofollow" target="_blank"> NUMA度量仪表板</a>以来，数百名客户能够检测到NUMA使用的问题和不平衡。由于使用NUMA远程节点而导致的性能下降可能非常严重，很容易达到75%的性能损失。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/8a357a7a89d03826bb89082f08c934dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6RYd5M544UYMX7xF.png"/></div></div></figure><p id="704b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还收到许多关于vNUMA以及如何以最佳方式配置NUMA的问题。因此，我们从这篇文章开始一系列关于NUMA，vNUMA。</p><p id="a0dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何激活CPU数量较少的VMware vNUMA</p><h1 id="d92d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">什么是NUMA</h1><blockquote class="lw lx ly"><p id="a584" class="jn jo lz jp b jq jr js jt ju jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj kk ij bi translated">非均匀内存访问(NUMA)是一种用于多处理的计算机内存设计，其中内存访问时间取决于内存相对于处理器的位置。在NUMA下，一个处理器可以比非本地内存(另一个处理器的本地内存或处理器之间共享的内存)更快地访问自己的本地内存。NUMA的优势仅限于特定的工作负载，特别是在数据通常与特定任务或用户紧密相关的服务器上。维基百科—</p></blockquote><p id="bdc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【Https://En.Wikipedia.Org/Wiki/Non-Uniform_memory_access T2】号</p><p id="d356" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就vNUMA而言，这意味着VMware ESXi向虚拟机显示底层硬件的物理NUMA配置，而不是隐藏它。</p><p id="4a70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在此阅读有关NUMA、vNUMA和性能问题的更多信息:</p><p id="9117" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/vmware-vsphere-why-checking-numa-configuration-is-so-important-9764c16a7e73"> Https://Itnext。io/Vmware-VSP here-Why-Checking-Numa-Configuration-So-Important-9764 C16 a7e 73</a></p><p id="588b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，对于vcpu少于9个的虚拟机，vNUMA处于停用状态，或者CPU或内存热添加处于激活状态。</p><h1 id="5d33" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">vNUMA控件</h1><p id="a004" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">VMware提供了一系列高级参数来调整vNUMA，可在此处找到:</p><p id="50da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-3E956FB5-8ACB-42C3-B068-664989C3FF44.html" rel="noopener ugc nofollow" target="_blank"> Https://Docs。Vmware.Com/En/VMware-VSphere/6.7/Com.VMware . VSP here . resmgmt . doc/GUID-3e 956 FB 5-8ac b-42 C3-B068-664989 C3 ff 44。Html </a></p><h1 id="8ce6" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">为具有较少vcpu核心(即4、6或8个vcpu)的虚拟机激活vNUMA</h1><p id="09d5" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">虚拟机必须关闭才能继续。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mi"><img src="../Images/64cc477b1b94e8603f87e75cb1d31ede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ixCuDG3ZaxDlzTfe.png"/></div></div></figure><h1 id="e21c" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">停用热插拔</h1><p id="ec5c" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">首先确保CPU热插拔被禁用。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mj"><img src="../Images/1076fa86613657a8e0f5ba2aeb55b052.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LOhz-cm9PKYBVyio.png"/></div></div></figure><p id="8fd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">内存热插拔也是如此</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mk"><img src="../Images/79c7942494d4b8fc65b8a33354a0149c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XiKqk1LR8TM7kr-F.png"/></div></div></figure><h1 id="d1cc" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">现在，我们更改虚拟机选项</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ml"><img src="../Images/1410be91ac740bc51ea399fafa48317f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RiJbK0N2mFw0rJWA.png"/></div></div></figure><h1 id="641e" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更改NUMA选项</h1><p id="0def" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">请记住，列表中没有最高级的NUMA选项，所以您需要添加它们。如果选项已经在列表中，您只需更改值并保存配置。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/6c065fcc6826bfbfc2dc79cfe9ef1be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lvHmRdwJLNQ9ecX_.png"/></div></div></figure><h1 id="0262" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">添加参数numa.vcpu.min</h1><p id="ffc8" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">由于默认情况下，NUMA体系结构只有9个或更多的vCPU，因此您应该将该值设置为当前的vCPU数量，也就是说，如果您有2个vCPU插槽和2个vCPU核心，则应该将该值设置为4。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ff0cfe68430aa1a5b7580709cde35ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WM5J87_Uv8cHUZ5V.png"/></div></div></figure><p id="9752" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动虚拟机后，客户操作系统可以看到NUMA体系结构并相应地采取行动。</p><p id="a9c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，VMware VMkernel在管理NUMA方面做得非常好，但是有时，尤其是当您发现系统的NUMA不平衡时，优先选择vNUMA是有意义的。</p><p id="1173" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想亲自查看VMware NUMA指标和潜在的性能损失，请开始免费试用性能分析器:<a class="ae kl" href="https://www.opvizor.com" rel="noopener ugc nofollow" target="_blank">www.opvizor.com</a></p></div></div>    
</body>
</html>