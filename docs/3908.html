<html>
<head>
<title>Azure DevOps Pipelines: Multiple Jobs in YAML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps管道:YAML的多项工作</h1>
<blockquote>原文：<a href="https://itnext.io/azure-devops-pipelines-multiple-jobs-in-yaml-de21b06e3cbc?source=collection_archive---------5-----------------------#2020-03-23">https://itnext.io/azure-devops-pipelines-multiple-jobs-in-yaml-de21b06e3cbc?source=collection_archive---------5-----------------------#2020-03-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e435" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将展示如何通过Azure DevOps管道从一个YAML文件中运行多个作业。这篇文章将建立在前几篇文章中创建的Azure DevOps项目之上。如果您刚刚加入这个系列，请查看以前的帖子，了解项目的进展情况。</p><p id="f57b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2020/02/getting-started-with-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS入门</a><br/><a class="ae kl" href="https://elanderson.net/2020/03/pipeline-creation-in-azure-devops/" rel="noopener ugc nofollow" target="_blank">Azure devo PS中的管道创建</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-publish-asp-net-core/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps为ASP.NET核心发布工件</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/d3c9eb847a64dcbacf9833b1ced2a8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*5csGq1f4txVw63wT.png"/></div></figure><h2 id="779b" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">起点和计划</h2><p id="07a6" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">就目前的示例而言，我们有一个单独的管道，它使用以下YAML在一个作业中构建了两个不同的ASP.NET核心web应用程序。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="d5d2" class="ku kv iq lt b gy lx ly l lz ma">trigger:<br/>- master<br/><br/>pool:<br/>  vmImage: 'ubuntu-latest'<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>steps:<br/>- task: UseDotNet@2<br/>  inputs:<br/>    packageType: 'sdk'<br/>    version: '3.1.x'<br/><br/>- script: dotnet build --configuration $(buildConfiguration)<br/>  displayName: 'dotnet build $(buildConfiguration)'<br/>  <br/>- task: DotNetCoreCLI@2<br/>  inputs:<br/>    command: 'publish'<br/>    publishWebProjects: true<br/>    arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'<br/><br/>- task: PublishPipelineArtifact@1<br/>  inputs:<br/>    targetPath: '$(Build.ArtifactStagingDirectory)'<br/>    publishLocation: 'pipeline'</span></pre><p id="a982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将利用这条管道，将两个web应用程序的构建和发布分开，并使每个应用程序成为自己的工作。在管道中，作业是单个代理接受并运行的东西。如果有足够的构建代理可用，通过拆分成多个作业，管道可以同时运行多个作业。这样做的一个原因是，如果您的构建有独立的部分，那么可以加速整个管道的运行。为什么需要作业的另一个例子是不同的作业需要不同的代理，例如一个需要Windows代理，另一个需要Linux代理。</p><h2 id="e142" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">创造就业机会</h2><p id="5d4d" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">拥有不同的作业意味着我们必须将诸如使用什么代理池和作业的步骤之类的事情移到一个<strong class="jp ir">作业</strong>元素下，然后声明一个特定的<strong class="jp ir">作业</strong>和该作业需要运行的细节。正如您在下面的示例中看到的，最终目标与上面的YAML相同(除了它正在处理一个特定的项目)，但是细节嵌套在<strong class="jp ir">作业</strong>下，并在<strong class="jp ir">作业</strong>下定义。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="3834" class="ku kv iq lt b gy lx ly l lz ma">trigger:<br/>- master<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>jobs:<br/>- job: WebApp1<br/>  displayName: 'Build WebApp1'<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/><br/>  steps:<br/>  - task: UseDotNet@2<br/>    displayName: 'Use .NET 3.1.x'<br/>    inputs:<br/>      packageType: 'sdk'<br/>      version: '3.1.x'<br/><br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Build'<br/>    inputs:<br/>      command: 'build'<br/>      projects: '**/WebApp1.csproj'<br/>      arguments: '--configuration $(buildConfiguration)' <br/>  <br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Publish Application'<br/>    inputs:<br/>      command: 'publish'<br/>      publishWebProjects: false<br/>      projects: '**/WebApp1.csproj'<br/>      arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'<br/><br/>  - task: PublishPipelineArtifact@1<br/>    displayName: 'Publish Artifacts'<br/>    inputs:<br/>      targetPath: '$(Build.ArtifactStagingDirectory)'<br/>      artifact: 'WebApp1'<br/>      publishLocation: 'pipeline'</span></pre><p id="a15d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还要注意，你仍然可以定义可以跨任务使用的变量，就像上面用<strong class="jp ir"> buildConfiguration </strong>变量所做的那样。下面是完整的YAML文件，它为这两个web应用程序构建和发布工件。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="ce79" class="ku kv iq lt b gy lx ly l lz ma">trigger:<br/>- master<br/><br/>variables:<br/>  buildConfiguration: 'Release'<br/><br/>jobs:<br/>- job: WebApp1<br/>  displayName: 'Build WebApp1'<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/><br/>  steps:<br/>  - task: UseDotNet@2<br/>    displayName: 'Use .NET 3.1.x'<br/>    inputs:<br/>      packageType: 'sdk'<br/>      version: '3.1.x'<br/><br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Build'<br/>    inputs:<br/>      command: 'build'<br/>      projects: '**/WebApp1.csproj'<br/>      arguments: '--configuration $(buildConfiguration)' <br/>  <br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Publish Application'<br/>    inputs:<br/>      command: 'publish'<br/>      publishWebProjects: false<br/>      projects: '**/WebApp1.csproj'<br/>      arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'<br/><br/>  - task: PublishPipelineArtifact@1<br/>    displayName: 'Publish Artifacts'<br/>    inputs:<br/>      targetPath: '$(Build.ArtifactStagingDirectory)'<br/>      artifact: 'WebApp1'<br/>      publishLocation: 'pipeline'<br/><br/>- job: WebApp2<br/>  displayName: 'Build WebApp2'<br/>  pool:<br/>    vmImage: 'ubuntu-latest'<br/><br/>  steps:<br/>  - task: UseDotNet@2<br/>    displayName: 'Use .NET 3.1.x'<br/>    inputs:<br/>      packageType: 'sdk'<br/>      version: '3.1.x'<br/><br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Build'<br/>    inputs:<br/>      command: 'build'<br/>      projects: '**/WebApp2.csproj'<br/>      arguments: '--configuration $(buildConfiguration)' <br/>  <br/>  - task: DotNetCoreCLI@2<br/>    displayName: 'Publish Application'<br/>    inputs:<br/>      command: 'publish'<br/>      publishWebProjects: false<br/>      projects: '**/WebApp2.csproj'<br/>      arguments: '--configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)'<br/><br/>  - task: PublishPipelineArtifact@1<br/>    displayName: 'Publish Artifacts'<br/>    inputs:<br/>      targetPath: '$(Build.ArtifactStagingDirectory)'<br/>      artifact: 'WebApp2'<br/>      publishLocation: 'pipeline'</span></pre><p id="5763" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成所有编辑后，提交对YAML文件的更改，然后运行管道。正如您从下面我的示例管道运行的屏幕截图中看到的，管道有两个作业，而不是最初的YAML产生的一个作业。另外，请注意，管道会产生两个已发布的工件(在我们的例子中，每个作业一个)，而不是包含原始工件的工件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/c2e831acdaebfa44d27e5f5be717864a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HE0Co4O7IyzRKqOr.png"/></div></div></figure><h2 id="0c90" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="aa39" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">如上所述，您可能有很多原因想要将您的管道拆分为多个作业，并且希望您现在对如何完成有一个好的想法。确保并在未来查看一篇关于如何重复任务并使其可重用的帖子。</p></div><div class="ab cl mg mh hu mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ij ik il im in"><p id="0fc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">原载于</em><a class="ae kl" href="https://elanderson.net/2020/03/azure-devops-pipelines-multiple-jobs-in-yaml/" rel="noopener ugc nofollow" target="_blank"><em class="mn"/></a><em class="mn">。</em></p></div></div>    
</body>
</html>