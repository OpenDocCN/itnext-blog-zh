<html>
<head>
<title>Using Socket.io with a MERN Stack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过MERN堆栈使用Socket.io</h1>
<blockquote>原文：<a href="https://itnext.io/using-socket-io-with-a-mern-stack-93f4245e86e7?source=collection_archive---------2-----------------------#2018-03-28">https://itnext.io/using-socket-io-with-a-mern-stack-93f4245e86e7?source=collection_archive---------2-----------------------#2018-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cc05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我将为你提供一套在MERN堆栈上设置<a class="ae kl" href="https://socket.io/" rel="noopener ugc nofollow" target="_blank"> Socket.io </a>的说明。这个想法是你可以用它作为你未来项目的起点。</p><blockquote class="km"><p id="4114" class="kn ko iq bd kp kq kr ks kt ku kv kk dk translated">插座。IO支持基于事件的实时双向通信。</p></blockquote><p id="e98e" class="pw-post-body-paragraph jn jo iq jp b jq kw js jt ju kx jw jx jy ky ka kb kc kz ke kf kg la ki kj kk ij bi translated">Socket.io是在网站中创建实时事件的常用工具。这是一个用户订阅的想法，你可以推送到他们的应用程序实例。这方面的例子包括实时消息、实时反馈、即时更新数据等等。</p><h2 id="d19f" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">设置</h2><p id="dc7c" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">像我的大多数MERN项目一样，我们将从设置<a class="ae kl" href="https://github.com/keithweaver/MERN-boilerplate" rel="noopener ugc nofollow" target="_blank">这个样板代码</a>开始。下载或者分叉。您需要安装MongoDB、Node.js等。在文本编辑器中打开代码，并将<code class="fe lz ma mb mc b">/config/config.example.js</code>重命名为<code class="fe lz ma mb mc b">/config/config.js</code>。您还需要为开发环境创建一个到MongoDB的连接，因此在该文件中将其更改为:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="fb61" class="lb lc iq mc b gy ml mm l mn mo">module.exports = {<br/>  db: 'mongodb://username:password@url:port/db',<br/>  db_dev: 'mongodb://localhost:27017/db_name_demo',<br/>};</span></pre><p id="e418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lz ma mb mc b">db_name_demo</code>是我的数据库名。设置样板代码的下一步是安装所有需要的包。打开您的终端，导航到文件夹并运行:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="3564" class="lb lc iq mc b gy ml mm l mn mo">npm install</span></pre><p id="679c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几分钟后，这应该完成。运行:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="ee1e" class="lb lc iq mc b gy ml mm l mn mo">npm run start:dev</span></pre><p id="c7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您在浏览器中打开<a class="ae kl" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>，您应该会看到下图。样板代码的设置已经完成。</p><figure class="md me mf mg gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mp"><img src="../Images/75fd8635859bb0ff94b342d6c3853832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YYMBjh0TAq_10uz7b8ipcQ.png"/></div></div></figure><h2 id="3447" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">添加Socket.io包</h2><p id="64fa" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">您需要两个包来使用Socket.io，所以运行:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="d218" class="lb lc iq mc b gy ml mm l mn mo">npm install socket.io --save<br/>npm install socket.io-client --save</span></pre><p id="ec3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很明显，一个包是前端的，另一个是后端的。如果你不像我一样把所有东西都放在一个仓库里，你需要把它安装在特定的地方。</p><p id="c906" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe lz ma mb mc b">/server/server.js</code>，我们将添加所需的Socket.io代码。在这些线下面:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="225d" class="lb lc iq mc b gy ml mm l mn mo">const app = express();<br/>app.use(bodyParser.urlencoded({ extended: true }));<br/>app.use(bodyParser.json());</span></pre><p id="24e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你会把:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="4521" class="lb lc iq mc b gy ml mm l mn mo">// Socket.io<br/>const http = require('http').Server(app);<br/>const io = require('socket.io')(http);<br/>io.on('connection', function(socket){<br/>  console.log('a user connected');<br/>  socket.on('disconnect', function(){<br/>    console.log('User Disconnected');<br/>  });</span><span id="ace5" class="lb lc iq mc b gy mx mm l mn mo">socket.on('example_message', function(msg){<br/>    console.log('message: ' + msg);<br/>  });<br/>});<br/>io.listen(8000);</span></pre><p id="1105" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在上面的代码片段中，我们可以看到三个事件:<code class="fe lz ma mb mc b">connection</code>、<code class="fe lz ma mb mc b">disconnect</code>、&amp;一个名为<code class="fe lz ma mb mc b">example_message</code>的自定义事件。如果您有许多自定义消息，我建议将它们移动到类似于routes的自己的文件中。</p><p id="fca1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当浏览器打开我们的应用程序时，就会调用连接。断开就是app关闭的时候。我们将设置一个按钮来触发自定义消息。</p><h2 id="72c1" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">前端的Socket.io</h2><p id="0c1e" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">在前端，我们将在React中添加一个按钮来触发Socket.io客户端，该客户端将发送带有数据的自定义消息。打开<code class="fe lz ma mb mc b">/client/app/components/Home/Home.js</code>，你会看到我们项目的索引页面(加载的第一个东西)。在这里，我们将导入客户端，因此在导入下面:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="6045" class="lb lc iq mc b gy ml mm l mn mo">import React, { Component } from 'react';<br/>import 'whatwg-fetch';<br/>import openSocket from 'socket.io-client';<br/>const socket = openSocket('<a class="ae kl" href="http://localhost:8000'" rel="noopener ugc nofollow" target="_blank">http://localhost:8000'</a>);</span></pre><p id="9f38" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还将添加一个被绑定的函数。在构造函数中，将这一行添加到底部:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="0197" class="lb lc iq mc b gy ml mm l mn mo">this.sendSocketIO = this.sendSocketIO.bind(this);</span></pre><p id="dd65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">渲染之上(在组件类内部，但在渲染外部):</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="c7b5" class="lb lc iq mc b gy ml mm l mn mo">sendSocketIO() {<br/>    socket.emit('example_message', 'demo');<br/>}</span></pre><p id="48b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在新计数器按钮下方的渲染中，添加一个新按钮:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="1993" class="lb lc iq mc b gy ml mm l mn mo">&lt;div&gt;<br/>  &lt;button onClick={this.sendSocketIO}&gt;Send Socket.io&lt;/button&gt;<br/>&lt;/div&gt;</span></pre><p id="5f64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样。前端设置完毕。如果你在添加前端文件时迷路了，这里有<a class="ae kl" href="https://gist.github.com/keithweaver/06fb43df85f956eccaa7ef18b277ed00" rel="noopener ugc nofollow" target="_blank">一个完整文件的要点</a>。</p><p id="3b58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我提一下，<code class="fe lz ma mb mc b">socket.emit</code>是我们用来向后端发送消息的。<code class="fe lz ma mb mc b">demo</code>是字符串数据，所以如果你想传递更多，它可以是一个字符串化的对象。<code class="fe lz ma mb mc b">example_message</code>与后台<code class="fe lz ma mb mc b">.on</code>消息完全相同。</p><h2 id="b4f3" class="lb lc iq bd ld le lf dn lg lh li dp lj jy lk ll lm kc ln lo lp kg lq lr ls lt bi translated">结果</h2><p id="3a1e" class="pw-post-body-paragraph jn jo iq jp b jq lu js jt ju lv jw jx jy lw ka kb kc lx ke kf kg ly ki kj kk ij bi translated">现在再运行一次:</p><pre class="md me mf mg gt mh mc mi mj aw mk bi"><span id="477c" class="lb lc iq mc b gy ml mm l mn mo">npm run start:dev</span></pre><p id="1c6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到:</p><figure class="md me mf mg gt mq gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi my"><img src="../Images/0b8db768047fa70303cfaf4055abb8fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kt4_nvUVnfi92Byo585OtA.png"/></div></div></figure><p id="6650" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您查看您的终端窗口，请单击发送Socket.io按钮，然后再查看您的终端窗口。您应该看到:</p><figure class="md me mf mg gt mq gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/120d394f2e3995bfb4ae2e14818d8b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*w85nGmbMnnOAah-lI7V08g.png"/></div></figure><p id="d279" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是MERN的设置。将来我可能会发布更多的帖子，用Socket.io做更多的事情。</p><p id="12e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请给我一个👏如果你喜欢这篇文章。我尽可能多地发布类似的文章，并且每周发布一个Youtube视频。 <a class="ae kl" href="https://medium.com/@Keithweaver_/using-socket-io-with-a-mern-stack-2a7049f94b85" rel="noopener"> <em class="na">原帖</em> </a> <em class="na">。</em></p></div></div>    
</body>
</html>