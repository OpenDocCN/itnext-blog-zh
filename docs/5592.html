<html>
<head>
<title>Istio: an overview and running Service Mesh in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">istio:Kubernetes中的概述和运行服务网格</h1>
<blockquote>原文：<a href="https://itnext.io/istio-an-overview-and-running-service-mesh-in-kubernetes-d1077fe5dcb7?source=collection_archive---------4-----------------------#2021-04-11">https://itnext.io/istio-an-overview-and-running-service-mesh-in-kubernetes-d1077fe5dcb7?source=collection_archive---------4-----------------------#2021-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9c7a7de0c44d361f9a00c341ac7e8722.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-hc5p49iJX0i7tU-6oKZNg.jpeg"/></div></div></figure><p id="883f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Istio是一个服务网格解决方案，允许执行服务发现、负载平衡、流量控制、金丝雀部署和蓝绿部署，以及微服务之间的流量监控。</p><p id="42af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在AWS Elastic Kubernetes服务中使用Istio进行流量监控，作为API网关服务，用于流量策略和各种<a class="ae kw" href="https://www.infoworld.com/article/3565750/4-deployment-strategies-for-resilient-microservices.html" rel="noopener ugc nofollow" target="_blank">部署策略</a>。</p><p id="9702" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将从总体上讲述服务网格的概念，然后概述Istio架构和组件、它的安装过程以及如何运行一个测试应用程序。</p><h1 id="0c9a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">内容</h1><ul class=""><li id="45bc" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Service_Mesh" rel="noopener ugc nofollow" target="_blank">什么是服务网格</a>？</li><li id="4a5d" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Istio_architecture" rel="noopener ugc nofollow" target="_blank"> Istio建筑公司</a></li><li id="d9ee" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Control_Plane" rel="noopener ugc nofollow" target="_blank">控制平面</a></li><li id="3439" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Data_Plane" rel="noopener ugc nofollow" target="_blank">数据平面</a></li><li id="7cdb" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Istio_network_model" rel="noopener ugc nofollow" target="_blank"> Istio网络模型</a></li><li id="8158" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Running_Istio_in_Kubernetes" rel="noopener ugc nofollow" target="_blank">在Kubernetes中运行Istio</a></li><li id="be24" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Running_test_application" rel="noopener ugc nofollow" target="_blank">运行测试应用</a></li><li id="3abc" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Istio_Ingress_Gateway" rel="noopener ugc nofollow" target="_blank"> Istio入口网关</a></li><li id="adaa" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Gateway" rel="noopener ugc nofollow" target="_blank">网关</a></li><li id="9a25" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">虚拟服务</li><li id="b333" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Kiali_-_traffic_observation" rel="noopener ugc nofollow" target="_blank">吉利—交通观察</a></li><li id="05f1" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Sidecar_-_Envoy_proxy" rel="noopener ugc nofollow" target="_blank">边车—特使代理</a></li><li id="cbf4" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Istio_and_iptables" rel="noopener ugc nofollow" target="_blank"> Istio和iptables </a></li><li id="0b9f" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Running_Sidecar" rel="noopener ugc nofollow" target="_blank">跑边车</a></li><li id="8b50" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/#Useful_links" rel="noopener ugc nofollow" target="_blank">有用的链接</a></li></ul><h1 id="8982" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">服务网格</h1><p id="253b" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">本质上，它是一个代理服务管理器。作为代理服务，可以有类似NGINX、HAProxy或Envoy的系统，工作在<a class="ae kw" href="https://rtfm.co.ua/what-is-model-osi/" rel="noopener ugc nofollow" target="_blank">网络OSI </a>第7层，允许动态流量控制和应用程序通信配置。</p><p id="b5a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务网格执行新的应用/服务发现、负载平衡、认证和流量加密。</p><p id="abb1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于每个应用程序的服务网格中的流量控制，或者对于每个pod的Kubernetes，在应用程序旁边启动一个名为<em class="mo"> sidecar </em>的代理服务。</p><p id="e2c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些边车集装箱一起被称为<em class="mo">数据平面</em>。</p><p id="fbd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于它们的配置和管理，还有另一个称为<em class="mo">控制平面</em>的进程组。它们用于新应用程序发现、加密密钥管理、指标收集和聚合等。</p><p id="7e9e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">服务网格可以显示为这样的方案:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/af43ee948f557ae476fb3c0fbd8a5fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mslilQvkYDR_fsFe.png"/></div></div></figure><p id="1ece" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在众多服务网格解决方案中，我想提到以下几个:</p><ul class=""><li id="b1f7" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><a class="ae kw" href="https://aws.amazon.com/ru/app-mesh/" rel="noopener ugc nofollow" target="_blank"> AWS应用网格</a></li><li id="4977" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://learn.hashicorp.com/tutorials/consul/service-mesh" rel="noopener ugc nofollow" target="_blank"> Hashicop领事</a></li><li id="9fab" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">林克尔德</li><li id="0418" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://servicecomb.apache.org/docs/introduction/" rel="noopener ugc nofollow" target="_blank">阿帕奇服务梳</a></li><li id="b31e" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://traefik.io/traefik-mesh/" rel="noopener ugc nofollow" target="_blank"> Traefik网格</a></li><li id="6cc9" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a></li></ul><p id="af2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读更多(Rus中的所有链接):</p><ul class=""><li id="e38d" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><a class="ae kw" href="https://habr.com/ru/company/otus/blog/506916/" rel="noopener ugc nofollow" target="_blank">чтотакое服务网？</a></li><li id="d632" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://habr.com/ru/company/flant/blog/478306/" rel="noopener ugc nofollow" target="_blank">服务网格:что нужно знать каждому软件工程师осамойхакповойтехнологии</a></li><li id="2f7d" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://habr.com/ru/company/flant/blog/327536/" rel="noopener ugc nofollow" target="_blank">что·почему·нужен？</a></li><li id="1429" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://habr.com/ru/company/flant/blog/533686/" rel="noopener ugc nofollow" target="_blank">服务网格— это всё ещё сложно </a></li></ul><h1 id="5858" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Istio建筑</h1><p id="9ff8" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">因此，Istio as a service mesh由两个主要部分组成，即<em class="mo">数据平面</em>和<em class="mo">控制平面</em>:</p><ul class=""><li id="c97d" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><strong class="ka ir">数据层</strong>(“数据层”):包含一组代理服务，在每个Kubernetes Pod中表示为sidecar容器，使用扩展的<a class="ae kw" href="https://www.envoyproxy.io/" rel="noopener ugc nofollow" target="_blank"> Envoy </a>代理服务器。这些边车链接和控制应用程序之间的流量，收集和发送指标</li><li id="bc61" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><strong class="ka ir">控制平面</strong>(“控制层”):管理和配置侧柜、聚合监控指标、TLS证书管理</li></ul><p id="9e1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Isitio架构可表示为下图:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/9da431cf32896c4e51e335447601a370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fRjgCPJUHy_UJv1R.png"/></div></div></figure><p id="bf76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者另一个:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/ca1d0a72ee5640f51e44c2e1e801d988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8HJDyW-zQU5fcD0_.png"/></div></div></figure><h2 id="4a6f" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">制导机</h2><p id="9c22" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">Istio控制平面包括主要组件:</p><ul class=""><li id="517b" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><em class="mo"> Pilot </em>:中央控制器，负责使用<a class="ae kw" href="https://www.envoyproxy.io/docs/envoy/latest/api/api" rel="noopener ugc nofollow" target="_blank"> Envoy API </a>与边车通信。它读取istio清单中描述的规则，并将它们发送给Envoy代理进行配置。此外，它还用于<a class="ae kw" href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/" rel="noopener ugc nofollow" target="_blank">服务发现</a>、流量控制、路由、网络抗超时能力和<a class="ae kw" href="https://en.wikipedia.org/wiki/Circuit_breaker_design_pattern" rel="noopener ugc nofollow" target="_blank">电路中断</a>。</li><li id="45b6" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">Citadel :身份和访问管理——流量加密、用户和服务认证、TLS密钥管理。参见<a class="ae kw" href="https://istio.io/v1.4/docs/concepts/security/" rel="noopener ugc nofollow" target="_blank"> Istio Security </a>。</li><li id="f462" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><em class="mo"> Galley </em>:配置管理——验证新配置并通过网格发送它们</li><li id="1674" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><em class="mo">混合器</em>:监控、度量、日志、流量控制</li></ul><p id="3911" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从Istio版本1.9.1开始，除了在专用Docker容器中运行的Pilot之外，它们都被构建为一个名为<code class="fe nl nm nn no b">istiod</code>的二进制文件，外加额外的入口和出口控制器。</p><h2 id="4673" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">数据平面</h2><p id="bef1" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">由作为附加进程运行的边车容器组成，这些进程通过<code class="fe nl nm nn no b">kube-inject</code>在Kubernetes中运行，参见<a class="ae kw" href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/" rel="noopener ugc nofollow" target="_blank">安装边车</a>。</p><p id="d4c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些容器和特使代理实例允许:</p><ul class=""><li id="6310" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated">动态<a class="ae kw" href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/" rel="noopener ugc nofollow" target="_blank">服务发现</a></li><li id="988c" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">负载平衡</li><li id="657f" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">TLS终止</li><li id="eec8" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">HTTP/2和gRPC代理</li><li id="61c7" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Circuit_breaker" rel="noopener ugc nofollow" target="_blank">断路器</a></li><li id="0ca6" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">健康检查</li><li id="df73" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.infoworld.com/article/3565750/4-deployment-strategies-for-resilient-microservices.html" rel="noopener ugc nofollow" target="_blank">部署分阶段展开</a></li><li id="87c3" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">丰富的指标</li></ul><p id="cfba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读更多信息:</p><ul class=""><li id="3084" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/latest/docs/ops/deployment/architecture/" rel="noopener ugc nofollow" target="_blank">架构</a></li><li id="2167" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.istioworkshop.io/03-servicemesh-overview/istio-architecture/" rel="noopener ugc nofollow" target="_blank"> Istio建筑</a></li></ul><h1 id="82a1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Istio网络模型</h1><p id="42bd" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在运行我们的Istio之前，让我们先简单了解一下用于管理流量的资源。</p><p id="1f80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在安装过程中，Istio创建一个入口网关服务(和出口网关，如果在安装过程中设置了的话)——在Istio安装过程中，一个新的Kubernetes对象被描述为<a class="ae kw" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" rel="noopener ugc nofollow" target="_blank"> Kubernetes CRD </a>。</p><p id="50fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在具有默认设置的AWS中，入口网关将创建一个AWS经典负载平衡器，因为入口网关表示为具有负载平衡器类型的Kubernetes入口对象。</p><p id="9bbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在入口网关的“背后”创建了另一种资源——<a class="ae kw" href="https://istio.io/latest/docs/reference/config/networking/gateway/" rel="noopener ugc nofollow" target="_blank">网关</a>，在安装过程中也被称为Kubernetes CRD，用于描述通过该网关发送流量的主机和端口。</p><p id="8cf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，另一个资源将到达现场VirtualService，它描述了通过网关发送的流量路由，并将其发送到Kubernetes服务，如<a class="ae kw" href="https://istio.io/latest/docs/concepts/traffic-management/#destination-rules" rel="noopener ugc nofollow" target="_blank">目的地规则</a>中所述。</p><p id="06cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">入口网关由两部分组成:一个Kubernetes Pod和一个Kubernetes Ingress，前者具有控制流量的Envoy实例，后者接受新的连接。</p><p id="4a61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">反过来，网关和虚拟服务配置用作入口网关控制器的特使代理实例。</p><p id="1569" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，一般来说，交通流量如下:</p><ol class=""><li id="a527" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv np md me mf bi translated">一个数据包将到达一个外部负载平衡器，然后被发送到一个Kubernetes WorkerNode TCP端口</li><li id="25f0" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">在那里，数据包被发送到Istio IngressGateway服务</li><li id="69b9" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">并被重定向到Istio IngressGateway窗格</li><li id="3179" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">此Pod上的特使实例配置有网关和虚拟服务</li><li id="e8d5" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">网关描述端口、协议、SSL证书</li><li id="02fc" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">VirtualService描述了到我们应用程序的Kubernetes服务的流量路由</li><li id="2152" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">Istio IngressGateway Pod将此数据包发送给应用程序的服务</li><li id="a8a4" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv np md me mf bi translated">服务将数据包路由到应用程序的Pod</li></ol><p id="1ce9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读更多信息:</p><ul class=""><li id="9a68" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><a class="ae kw" href="https://blog.jayway.com/2018/10/22/understanding-istio-ingress-gateway-in-kubernetes/" rel="noopener ugc nofollow" target="_blank">了解Kubernetes中的Istio入口网关</a></li><li id="be74" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/latest/docs/concepts/traffic-management" rel="noopener ugc nofollow" target="_blank">交通管理</a> и <a class="ae kw" href="https://istio.io/latest/docs/reference/config/networking/" rel="noopener ugc nofollow" target="_blank">交通管理</a></li></ul><h1 id="5ef2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">在Kubernetes经营Istio</h1><p id="7bab" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">Istio支持不同的<a class="ae kw" href="https://istio.io/latest/docs/ops/deployment/deployment-models/" rel="noopener ugc nofollow" target="_blank">部署模型</a>。在目前的情况下，我们使用一个AWS弹性Kubernetes服务集群，所有的pods都运行在同一个VPC网络中。</p><p id="553c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，还有不同的<a class="ae kw" href="https://istio.io/latest/docs/setup/additional-setup/config-profiles/" rel="noopener ugc nofollow" target="_blank">配置文件</a>,其中包含要安装的预配置组件。在这里，我们可以感兴趣的是<em class="mo">默认</em>——安装<code class="fe nl nm nn no b">istiod</code>和<code class="fe nl nm nn no b">istio-ingressgateway</code>，<em class="mo">演示</em>——类似，但也将安装<code class="fe nl nm nn no b">istio-egressgateway</code>服务，以及<em class="mo">预览</em>——调查尚未包含在主Istion版本中的新能力。</p><p id="6eda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过多种方式安装Istio:使用<code class="fe nl nm nn no b">istioctl</code>实用程序、使用清单文件、使用Helm或Ansible。</p><p id="5524" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">值得注意的是相互TLS(mTLS)——参见<a class="ae kw" href="https://istio.io/latest/docs/concepts/security/#mutual-tls-authentication" rel="noopener ugc nofollow" target="_blank">许可模式</a>。简而言之:默认情况下，Istion安装在许可的mTLS模式下，这允许现有的应用程序使用明文流量进行通信。但是所有通过特使代理的新连接都将使用TLS加密。</p><p id="6da1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们用<code class="fe nl nm nn no b">istioctl</code>手动安装Istio，稍后开发和生产集群将安装Ansible及其<code class="fe nl nm nn no b"><a class="ae kw" href="https://docs.ansible.com/ansible/latest/collections/community/kubernetes/helm_module.html" rel="noopener ugc nofollow" target="_blank">helm</a></code>模块。</p><p id="f9c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读更多信息:</p><ul class=""><li id="52cf" class="lv lw iq ka b kb kc kf kg kj mu kn mv kr mw kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/latest/docs/setup/install/istioctl/" rel="noopener ugc nofollow" target="_blank">用Istioctl </a>安装</li><li id="19d6" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/latest/docs/setup/install/" rel="noopener ugc nofollow" target="_blank">安装导轨</a>。</li></ul><p id="4333" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下载Istio:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="118e" class="mz ky iq no b gy nu nv l nw nx">$ curl -L <a class="ae kw" href="https://istio.io/downloadIstio" rel="noopener ugc nofollow" target="_blank">https://istio.io/downloadIstio</a> | sh -<br/>$ cd istio-1.9.1/</span></pre><p id="ea4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe nl nm nn no b"><a class="ae kw" href="https://istio.io/latest/docs/reference/commands/istioctl/" rel="noopener ugc nofollow" target="_blank">istioctl</a></code>使用<code class="fe nl nm nn no b">~/.kube/config</code>文件，或者您可以使用<code class="fe nl nm nn no b">--kubeconfig</code>选项指定您自己的文件，或者使用<code class="fe nl nm nn no b">--context</code>设置另一个上下文。</p><p id="ce84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">位于<code class="fe nl nm nn no b">bin</code>中的<code class="fe nl nm nn no b"><a class="ae kw" href="https://istio.io/latest/docs/reference/commands/istioctl/" rel="noopener ugc nofollow" target="_blank">istioctl</a></code>文件——将其添加到<code class="fe nl nm nn no b">$PATH</code>变量中(Linux/macOS:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="30ae" class="mz ky iq no b gy nu nv l nw nx">$ export PATH=$PWD/bin:$PATH</span></pre><p id="c0a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查它是否工作:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="3fa5" class="mz ky iq no b gy nu nv l nw nx">$ istioctl version<br/>no running Istio pods in “istio-system”<br/>1.9.1</span></pre><p id="7299" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果需要，为测试集群生成kubeconfig(如果使用Minicube，将自动生成):</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="658f" class="mz ky iq no b gy nu nv l nw nx">$ aws eks update-kubeconfig — name bttrm-eks-test-1–18 — alias iam-bttrm-eks-root-role-kubectl@bttrm-eks-test-1–18<br/>Added new context iam-bttrm-eks-root-role-kubectl@bttrm-eks-test-1–18 to /home/setevoy/.kube/config</span></pre><p id="1cc0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并使用<em class="mo">默认</em>配置文件安装Istio:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="4da5" class="mz ky iq no b gy nu nv l nw nx">$ istioctl install — set profile=default -y<br/>✔ Istio core installed<br/>✔ Istiod installed<br/>✔ Ingress gateways installed<br/>✔ Installation complete</span></pre><p id="9822" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次检查版本:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="c0d9" class="mz ky iq no b gy nu nv l nw nx">$ istioctl version<br/>client version: 1.9.1<br/>control plane version: 1.9.1<br/>data plane version: 1.9.1 (1 proxies)</span></pre><p id="27fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">和Istio吊舱:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="20a6" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n istio-system get pod<br/>NAME READY STATUS RESTARTS AGE<br/>istio-ingressgateway-d45fb4b48-jsz9z 1/1 Running 0 64s<br/>istiod-7475457497–6xskm 1/1 Running 0 77s</span></pre><p id="3f9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们部署一个测试应用程序，并通过Istio入口网关配置路由。</p><h2 id="90ba" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">运行测试应用程序</h2><p id="507a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">我们将不使用来自<a class="ae kw" href="https://istio.io/latest/docs/setup/getting-started/#bookinfo" rel="noopener ugc nofollow" target="_blank"> Istio Gettings Started </a>指南的默认Bookinfo，而是让我们定义我们自己的名称空间，一个带有NGINX的pod的部署，以及一个服务——我想模拟需要在Istio控制下迁移的现有应用程序。</p><p id="a036" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，目前我们不会配置自动边车进样，稍后我们会回到这一点。</p><p id="7a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">清单如下所示:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="f8a4" class="mz ky iq no b gy nu nv l nw nx">---<br/>apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: test-namespace<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: test-deployment<br/>  namespace: test-namespace<br/>  labels:<br/>    app: test<br/>    version: v1<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: test<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: test<br/>        version: v1<br/>    spec:<br/>      containers:<br/>      - name: web<br/>        image: nginx<br/>        ports:<br/>        - containerPort: 80<br/>        resources:<br/>          requests:<br/>            cpu: 100m<br/>            memory: 100Mi<br/>        readinessProbe:<br/>          httpGet:<br/>            path: /<br/>            port: 80<br/>      nodeSelector:<br/>        role: common-workers<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: test-svc<br/>  namespace: test-namespace<br/>spec:<br/>  selector:<br/>    app: test<br/>  ports:<br/>    - name: http<br/>      protocol: TCP<br/>      port: 80<br/>      targetPort: 80</span></pre><p id="a32d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">建议在应用中使用<code class="fe nl nm nn no b">version</code>标签，因为稍后这将允许实现金丝雀和蓝绿色部署，请参见<a class="ae kw" href="https://www.digitalocean.com/community/tutorials/how-to-do-canary-deployments-with-istio-and-kubernetes" rel="noopener ugc nofollow" target="_blank">如何使用Istio和Kubernetes进行金丝雀部署</a> и <a class="ae kw" href="https://istio.io/latest/docs/concepts/traffic-management/" rel="noopener ugc nofollow" target="_blank">流量管理</a>。</p><p id="85fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署它:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="1079" class="mz ky iq no b gy nu nv l nw nx">$ kubectl apply -f test-istio.yaml<br/>namespace/test-namespace created<br/>deployment.apps/test-deployment created<br/>service/test-svc created</span></pre><p id="c9a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查我们创建的pod中的容器:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="a99a" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n tkk -n test-namespace get pod -o jsonpath={.items[*].spec.containers[*].name}<br/>web</span></pre><p id="4f42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，一个如上面部署中描述的分离舱。</p><p id="501b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe nl nm nn no b">kubectl port-forward</code>连接到服务:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="e4fd" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace port-forward services/test-svc 8080:80<br/>Forwarding from 127.0.0.1:8080 -&gt; 80<br/>Forwarding from [::1]:8080 -&gt; 80</span></pre><p id="a64f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并检查我们的应用程序是否正常工作:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="eb5f" class="mz ky iq no b gy nu nv l nw nx">$ curl localhost:8080<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>…</span></pre><p id="2cc7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好——一切正常。</p><h2 id="4ebb" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">Istio入口网关</h2><p id="1378" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">因此，目前我们有一个在Istio安装期间创建的Istio入口网关，它由一个AWS Classic负载平衡器表示:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/0958bd2a74acb7c9c23ccc292126bfc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nu5xolc3HsWGjteY.png"/></div></div></figure><p id="6462" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是如果现在尝试访问它，我们将得到一个错误，因为它不知道将流量路由到哪里:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="e807" class="mz ky iq no b gy nu nv l nw nx">$ curl a6f***037.eu-west-3.elb.amazonaws.com<br/>curl: (52) Empty reply from server</span></pre><p id="ec24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要配置它，需要添加一个Istio网关。</p><h2 id="1e13" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">门</h2><p id="c77d" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated"><a class="ae kw" href="https://istio.io/latest/docs/reference/config/networking/gateway/" rel="noopener ugc nofollow" target="_blank">网关</a>描述<a class="ae kw" href="https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/" rel="noopener ugc nofollow" target="_blank"> Istio入口网关</a>配置——使用哪些端口和接受哪些流量。此外，在这里您可以执行SSL终止(但是在本例中，这是由AWS负载平衡器完成的)。</p><p id="6eb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">向我们的<code class="fe nl nm nn no b">test-istio.yaml</code>添加新资源——网关:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="dc19" class="mz ky iq no b gy nu nv l nw nx">---<br/>apiVersion: networking.istio.io/v1alpha3<br/>kind: Gateway<br/>metadata:<br/>  name: test-gateway<br/>  namespace: test-namespace<br/>spec:<br/>  selector:<br/>    istio: ingressgateway<br/>  servers:<br/>  - port:<br/>      number: 80<br/>      name: http<br/>      protocol: HTTP<br/>    hosts:<br/>    - "*"</span></pre><p id="bd45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe nl nm nn no b">spec.selector.istio</code>中，我们指定了Istio入口网关，该清单将应用于该网关。</p><p id="79a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我们的应用程序位于一个专用的名称空间中，因此Gateway和VirtualService(见下文)需要创建在同一个名称空间中。</p><p id="0d2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建网关:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="7202" class="mz ky iq no b gy nu nv l nw nx">$ kubectl apply -f test-istio.yaml<br/>namespace/test-namespace unchanged<br/>deployment.apps/test-deployment unchanged<br/>service/test-svc unchanged<br/>gateway.networking.istio.io/test-gateway created</span></pre><p id="0ca1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一下:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="3f6b" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace get gateways<br/>NAME AGE<br/>test-gateway 17s</span></pre><h2 id="8f6e" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">虚拟服务</h2><p id="8362" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">接下来，我们将添加一个<a class="ae kw" href="https://istio.io/latest/docs/reference/config/networking/virtual-service/" rel="noopener ugc nofollow" target="_blank"> VirtualService </a>，在这里我们将描述我们的“后端”,流量将被发送到这里。</p><p id="3859" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为“后端”,这里只是我们应用程序的一个普通Kubernetes服务——<em class="mo">test-SVC</em>:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="5066" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace get svc<br/>NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>test-svc NodePort 172.20.195.107 &lt;none&gt; 80:31581/TCP 15h</span></pre><p id="2557" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">描述与我们的应用程序和我们在上面创建的网关在同一个名称空间中的虚拟服务:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="2a44" class="mz ky iq no b gy nu nv l nw nx">---<br/>apiVersion: networking.istio.io/v1alpha3<br/>kind: VirtualService<br/>metadata:<br/>  name: test-virtualservice<br/>  namespace: test-namespace<br/>spec:<br/>  hosts:<br/>  - "*"<br/>  gateways:<br/>  - test-gateway<br/>  http:<br/>  - match:<br/>    - uri:<br/>        prefix: /<br/>    route:<br/>    - destination:<br/>        host: test-svc<br/>        port:<br/>          number: 80</span></pre><p id="5b7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建它:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="078f" class="mz ky iq no b gy nu nv l nw nx">$ kubectl apply -f test-istio.yaml<br/>namespace/test-namespace unchanged<br/>deployment.apps/test-deployment unchanged<br/>service/test-svc unchanged<br/>gateway.networking.istio.io/test-gateway unchanged<br/>virtualservice.networking.istio.io/test-virtualservice created</span></pre><p id="03dc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="4719" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace get virtualservice<br/>NAME GATEWAYS HOSTS AGE<br/>test-virtualservice [test-gateway] [*] 42s</span></pre><p id="07a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并再次检查Istio入口网关的负载平衡器的URL:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="d104" class="mz ky iq no b gy nu nv l nw nx">$ curl a6f***037.eu-west-3.elb.amazonaws.com<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br/>…</span></pre><p id="2cf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，我们在应用程序的Pod中没有特使代理(又名sidecar)的情况下工作:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="ecb1" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n tkk -n test-namespace get pod -o jsonpath={.items[*].spec.containers[*].name}<br/>web</span></pre><p id="ed39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">稍后我会检查为什么这是可行的。</p><h1 id="0bdd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Kiali —交通观察</h1><p id="8658" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">Istio有很多插件:<a class="ae kw" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>用于指标收集和警报，<a class="ae kw" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>用于指标可视化，<a class="ae kw" href="https://www.jaegertracing.io/" rel="noopener ugc nofollow" target="_blank"> Jaeger </a>用于请求跟踪，以及<a class="ae kw" href="https://kiali.io/" rel="noopener ugc nofollow" target="_blank"> Kiali </a>用于构建网络和服务地图。在<a class="ae kw" href="https://istio.io/latest/docs/ops/integrations/" rel="noopener ugc nofollow" target="_blank">集成</a>阅读更多信息。</p><p id="8086" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装所有插件:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="d506" class="mz ky iq no b gy nu nv l nw nx">$ kubectl apply -f samples/addons</span></pre><p id="e4cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并执行<code class="fe nl nm nn no b">istioctl dashboard kiali</code>——Kiali将在默认浏览器中打开:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/1449fe3e2c43580c62e97f7c4f220078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y_ITCge-RzbvBTd3.png"/></div></div></figure><p id="6f9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，如果导航到<em class="mo">应用程序</em>，我们会看到我们的应用程序标记为“<em class="mo">缺失边车</em>”:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/5fd9c2df8584500bc3e0b17f426a2458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2REy6QhctKVrWqQQ.png"/></div></div></figure><p id="e364" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且没有服务映射<em class="mo">图</em>:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/443c5724add998f5abad3decfe73e6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tsY0LN2VapIOvr0z.png"/></div></div></figure><h1 id="63eb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">边车—特使代理</h1><p id="899f" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">正如我们所记得的，尽管网络在工作，但是我们的pod没有包含Envoy实例的容器，因为此时Istio通过iptables规则将流量直接发送到包含NGINX的容器。在<a class="ae kw" href="https://istio.io/latest/blog/2019/data-plane-setup/#traffic-flow-from-application-container-to-sidecar-proxy" rel="noopener ugc nofollow" target="_blank">从应用程序容器到边车代理</a>的流量上阅读更多信息。</p><p id="0295" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Iptalbes规则在pod启动时配置了一个额外的init container—<code class="fe nl nm nn no b">istio-init</code>——但此时它们是默认的，在我们的应用程序部署期间配置了<code class="fe nl nm nn no b">kube-proxy</code>。查看<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-service-load-balancing-kube-proxy-and-iptables/" rel="noopener ugc nofollow" target="_blank"> Kubernetes: Service、load balancing、kube-proxy和iptables </a>的帖子，了解更多详细信息。</p><p id="55b9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在接下来的文章中，我们将更深入地研究Istio网络，现在，让我们将sidecars injection添加到我们的名称空间的pod中，并比较之前和之后的Iptables规则。</p><h2 id="fe82" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">Istio和iptables</h2><p id="5816" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在我们添加边车和<code class="fe nl nm nn no b">istio-init</code>之前，请查看Iptables规则。</p><p id="8587" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过SSH连接到您的Pod所在的Kubernetes WorkerNode节点，并找到NGINX Docker容器:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="22da" class="mz ky iq no b gy nu nv l nw nx">[root@ip-10–22–35–66 ec2-user]# docker ps | grep nginx<br/>22d64b132490 nginx “/docker-entrypoint.…” 3 minutes ago Up 3 minutes k8s_web_test-deployment-6864c5bf84-mk98r_test-namespace_8b88caf0–237a-4c94-ac71–186f8e701a7c_0</span></pre><p id="880a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此容器中查找进程的PID:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="e868" class="mz ky iq no b gy nu nv l nw nx">[root@ip-10–22–35–66 ec2-user]# docker top k8s_web_test-deployment-6864c5bf84-mk98r_test-namespace_8b88caf0–237a-4c94-ac71–186f8e701a7c_0<br/>UID PID PPID C STIME TTY TIME CMD<br/>root 31548 31517 0 10:36 ? 00:00:00 nginx: master process nginx -g daemon off;<br/>101 31591 31548 0 10:36 ? 00:00:00 nginx: worker process</span></pre><p id="0ef5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe nl nm nn no b"><a class="ae kw" href="https://man7.org/linux/man-pages/man1/nsenter.1.html" rel="noopener ugc nofollow" target="_blank">nsenter</a></code>实用程序检查PID为31548的进程的network-namespace上的Ipables规则——目前没有什么异常——所有流量都直接发送到我们的容器:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="d1f1" class="mz ky iq no b gy nu nv l nw nx">[root@ip-10–22–35–66 ec2-user]# nsenter -t 31548 -n iptables -t nat -L<br/>Chain PREROUTING (policy ACCEPT)<br/>target prot opt source destination<br/>Chain INPUT (policy ACCEPT)<br/>target prot opt source destination<br/>Chain OUTPUT (policy ACCEPT)<br/>target prot opt source destination<br/>Chain POSTROUTING (policy ACCEPT)<br/>target prot opt source destination</span></pre><h2 id="5470" class="mz ky iq bd kz na nb dn ld nc nd dp lh kj ne nf ll kn ng nh lp kr ni nj lt nk bi translated">运行边车</h2><p id="071c" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">文档— <a class="ae kw" href="https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/" rel="noopener ugc nofollow" target="_blank">安装边车</a>。</p><p id="51be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要将Envoy代理实例自动注入到<em class="mo">测试名称空间</em>名称空间中的pod，请运行以下命令:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="9f56" class="mz ky iq no b gy nu nv l nw nx">$ kubectl label namespace test-namespace istio-injection=enabled<br/>namespace/test-namespace labeled</span></pre><p id="77fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查标签:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="16e2" class="mz ky iq no b gy nu nv l nw nx">$ kubectl get namespace test-namespace — show-labels<br/>NAME STATUS AGE LABELS<br/>test-namespace Active 11m istio-injection=enabled</span></pre><p id="f2a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是sidecars将只为这个名称空间中的新pod添加。</p><p id="0521" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以通过使用<code class="fe nl nm nn no b"><a class="ae kw" href="https://istio.io/latest/docs/reference/commands/istioctl/#istioctl-kube-inject" rel="noopener ugc nofollow" target="_blank">kube-inject</a></code>手动添加它们，或者只是通过重新创建pod:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="1fa9" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace scale deployment test-deployment — replicas=0<br/>deployment.apps/test-deployment scaled<br/>kubectl -n test-namespace scale deployment test-deployment — replicas=1<br/>deployment.apps/test-deployment scaled</span></pre><p id="b7b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次检查容器中的容器:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="cd66" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace get pod -o jsonpath={.items[*].spec.containers[*].name}<br/>web istio-proxy</span></pre><p id="b874" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以看到<code class="fe nl nm nn no b">istio-proxy</code>集装箱——这是用特使倒边车的集装箱。</p><p id="63bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，检查Pod的<code class="fe nl nm nn no b">initContainers</code>:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="f3fc" class="mz ky iq no b gy nu nv l nw nx">$ kubectl -n test-namespace get pod -o jsonpath={.items[*].spec.initContainers[*].name}<br/>istio-init</span></pre><p id="215b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次检查Iptables规则——找到容器及其PID，并检查规则:</p><pre class="mq mr ms mt gt nq no nr ns aw nt bi"><span id="f273" class="mz ky iq no b gy nu nv l nw nx">[root@ip-10–22–35–66 ec2-user]# nsenter -t 4194 -n iptables -t nat -L</span><span id="15a8" class="mz ky iq no b gy oc nv l nw nx">Chain PREROUTING (policy ACCEPT)<br/>target prot opt source destination<br/>ISTIO_INBOUND tcp — anywhere anywhere</span><span id="f703" class="mz ky iq no b gy oc nv l nw nx">Chain INPUT (policy ACCEPT)<br/>target prot opt source destination</span><span id="8a0e" class="mz ky iq no b gy oc nv l nw nx">Chain OUTPUT (policy ACCEPT)<br/>target prot opt source destination<br/>ISTIO_OUTPUT tcp — anywhere anywhere</span><span id="b77a" class="mz ky iq no b gy oc nv l nw nx">Chain POSTROUTING (policy ACCEPT)<br/>target prot opt source destination</span><span id="04d3" class="mz ky iq no b gy oc nv l nw nx">Chain ISTIO_INBOUND (1 references)<br/>target prot opt source destination<br/>RETURN tcp — anywhere anywhere tcp dpt:15008<br/>RETURN tcp — anywhere anywhere tcp dpt:ssh<br/>RETURN tcp — anywhere anywhere tcp dpt:15090<br/>RETURN tcp — anywhere anywhere tcp dpt:15021<br/>RETURN tcp — anywhere anywhere tcp dpt:15020<br/>ISTIO_IN_REDIRECT tcp — anywhere anywhere</span><span id="8e3e" class="mz ky iq no b gy oc nv l nw nx">Chain ISTIO_IN_REDIRECT (3 references)<br/>target prot opt source destination<br/>REDIRECT tcp — anywhere anywhere redir ports 15006</span><span id="11d7" class="mz ky iq no b gy oc nv l nw nx">Chain ISTIO_OUTPUT (1 references)<br/>target prot opt source destination<br/>RETURN all — ip-127–0–0–6.eu-west-3.compute.internal anywhere<br/>ISTIO_IN_REDIRECT all — anywhere !localhost owner UID match 1337<br/>RETURN all — anywhere anywhere ! owner UID match 1337<br/>RETURN all — anywhere anywhere owner UID match 1337<br/>ISTIO_IN_REDIRECT all — anywhere !localhost owner GID match 1337<br/>RETURN all — anywhere anywhere ! owner GID match 1337<br/>RETURN all — anywhere anywhere owner GID match 1337<br/>RETURN all — anywhere localhost<br/>ISTIO_REDIRECT all — anywhere anywhere</span><span id="de73" class="mz ky iq no b gy oc nv l nw nx">Chain ISTIO_REDIRECT (1 references)<br/>target prot opt source destination<br/>REDIRECT tcp — anywhere anywhere redir ports 15001</span></pre><p id="cb91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以看到Isio创建的附加Iptables链和规则，它将流量发送到Envoy sidecar容器，然后发送到应用程序的容器，再返回。</p><p id="4f29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">回到Kiali仪表盘，查看地图:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi od"><img src="../Images/74e994c1818449713a8e3529c2d5f88e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4JBCCOorL-kphoH_.png"/></div></div></figure><p id="b0e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并请求跟踪:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/b574bf60abf298a86f07c12fa721f178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i5i696TKHDMKSlkv.png"/></div></div></figure><p id="3e21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还可以通过Jaeger仪表盘查看轨迹，可通过<code class="fe nl nm nn no b">istioctl dashboard jaeger</code>进入:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/03b26febaa0adb603f57c54daf1d52bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XfsmoxnncQ1FxiTV.png"/></div></div></figure><p id="cd8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，使用<code class="fe nl nm nn no b">istioctl dashboard prometheus</code>您可以打开普罗米修斯并检查可用的指标，更多信息请参见<a class="ae kw" href="https://istio.io/latest/docs/tasks/observability/metrics/querying-metrics/" rel="noopener ugc nofollow" target="_blank">从普罗米修斯</a>查询指标:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/379c8fd8854dd00e0ca81bce67091638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LaXZ7765tgLJJsqt.png"/></div></div></figure><p id="3ec7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其实暂时就这些了。</p><p id="923a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">稍后，我们将把Istio与AWS Application LoadBalncer集成，将Isitio实例部署和配置到AWS Elastic Kubernetes服务，并进行Ansible和Helm、Gateway和VirtualServices配置和调试。</p><h1 id="fb07" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">有用的链接</h1><ul class=""><li id="c1b5" class="lv lw iq ka b kb lx kf ly kj lz kn ma kr mb kv mc md me mf bi translated"><a class="ae kw" href="https://www.katacoda.com/courses/istio" rel="noopener ugc nofollow" target="_blank">使用基于交互式浏览器的场景学习Istio</a>——关于Katacoda的基础课程</li><li id="593e" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.istioworkshop.io/" rel="noopener ugc nofollow" target="_blank"> Istio服务网车间</a> — Istio概述</li><li id="10c4" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.eksworkshop.com/advanced/310_servicemesh_with_istio/" rel="noopener ugc nofollow" target="_blank">与Istio </a>的服务网络—AWS EKS公司的另一个车间</li><li id="14bc" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://betterprogramming.pub/how-istio-works-behind-the-scenes-on-kubernetes-aeb8003f2cb5" rel="noopener ugc nofollow" target="_blank">Istio如何在Kubernetes上幕后工作</a> —架构、组件</li><li id="fa93" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://istio.io/latest/docs/ops/diagnostic-tools/proxy-cmd/" rel="noopener ugc nofollow" target="_blank">调试特使和Istio</a>—用<code class="fe nl nm nn no b">istioctl</code>调试Istio</li><li id="795f" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://medium.com/ww-engineering/starting-with-istio-610421f5a815" rel="noopener">从Istio </a>开始，另见<a class="ae kw" href="https://medium.com/ww-engineering/istio-part-ii-e219a2e771bb" rel="noopener"> Istio，Part II </a> и <a class="ae kw" href="https://medium.com/ww-engineering/istio-iii-why-use-it-2ba2500cceda" rel="noopener"> Istio，Part III，为什么要用？</a>—Istio中的概述、架构和网络</li><li id="c250" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.alibabacloud.com/blog/north-south-traffic-management-of-istio-gateways-with-answers-from-service-mesh-experts_596658" rel="noopener ugc nofollow" target="_blank">Istio网关南北流量管理(服务网格专家解答)</a>—Istio网络</li><li id="328c" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated">运行Istio的速成班——Istio，Envoy，iptables，Istio中的组件，非常好的帖子</li><li id="08b3" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.stackrox.com/post/2019/11/how-to-make-istio-work-with-your-apps/" rel="noopener ugc nofollow" target="_blank">如何让Istio与您的应用程序协同工作</a> —故障排除和代理状态示例</li><li id="cfcc" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://banzaicloud.com/blog/istio-sidecar/" rel="noopener ugc nofollow" target="_blank">通过出站流量限制减少Istio代理资源消耗</a>—Istio和sidecars中的资源调整</li><li id="c7c5" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://www.infoq.com/presentations/life-packet-istio/" rel="noopener ugc nofollow" target="_blank">通过Istio </a>的一个包的生活——在Istio看来是一个不错的网络概述，但我没有看视频</li><li id="23c8" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://jimmysong.io/en/blog/sidecar-injection-iptables-and-traffic-routing/" rel="noopener ugc nofollow" target="_blank">详细讲解Istio中的Sidecar注入和透明流量劫持流程</a> — sidecars、iptables和routing</li><li id="37a3" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://banzaicloud.com/blog/backyards-ingress/" rel="noopener ugc nofollow" target="_blank">深入介绍Istio Ingress </a> — Ingress、网关和虚拟服务示例</li><li id="0bdb" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://blog.jayway.com/2018/10/22/understanding-istio-ingress-gateway-in-kubernetes/" rel="noopener ugc nofollow" target="_blank">了解Kubernetes中的Istio入口网关</a> —同上</li><li id="a807" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://freecontent.manning.com/istio-gateway/" rel="noopener ugc nofollow" target="_blank"> Istio网关</a> —同上</li><li id="686e" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://rinormaloku.com/getting-started-istio/" rel="noopener ugc nofollow" target="_blank">开始使用Istio </a>和后续部分— <a class="ae kw" href="https://rinormaloku.com/istio-practice-gateways/" rel="noopener ugc nofollow" target="_blank"> Istio实践—入口网关</a>、<a class="ae kw" href="https://rinormaloku.com/istio-practice-routing-virtualservices/" rel="noopener ugc nofollow" target="_blank"> Istio实践—使用虚拟服务进行路由</a></li><li id="d437" class="lv lw iq ka b kb mg kf mh kj mi kn mj kr mk kv mc md me mf bi translated"><a class="ae kw" href="https://livebook.manning.com/book/istio-in-action/chapter-4/v-5/50" rel="noopener ugc nofollow" target="_blank"> 4 Istio Gateway:让流量进入您的集群</a> —同样是关于Gateway和VirtualService</li></ul></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><p id="8fd7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">最初发表于</em> <a class="ae kw" href="https://rtfm.co.ua/en/istio-an-overview-and-running-service-mesh-in-kubernetes/" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> RTFM: Linux，devo PSисистемноеадмииитиованиииованиде</em>T25<em class="mo">。</em></a></p></div></div>    
</body>
</html>