<html>
<head>
<title>Coroutines: an ELI5 glossary</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">协程:ELI5词汇表</h1>
<blockquote>原文：<a href="https://itnext.io/coroutines-an-eli5-glossary-715c5317283d?source=collection_archive---------0-----------------------#2020-05-31">https://itnext.io/coroutines-an-eli5-glossary-715c5317283d?source=collection_archive---------0-----------------------#2020-05-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ca24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated"><span class="l km kn ko bm kp kq kr ks kt di"> S </span>简单、简短、快速——这个术语表最适合用作协程的介绍，或者快速提醒您在使用协程时应该了解的内容。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/ee2f2c9712c58d8b9c37449fd1305f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGKmUaYSV1OUoaUoDwSl7Q.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">埃里克·汤普金斯在<a class="ae lk" href="https://unsplash.com/s/photos/circus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="77ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，让我们弄清楚一件事:这并不是对Kotlin协程的深入指导。不会有深入的源代码或一个1000字的段落来解释为什么事情会这样。虽然知道这些都很重要，但它们根本不是这篇文章的主题。<br/> <br/>这是一个非常方便的小参考文档，当你深陷协程，突然忘记了<code class="fe ll lm ln lo b">async</code>和<code class="fe ll lm ln lo b">launch</code>之间的区别时，你可以翻阅一下。</p><h2 id="b735" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">目录</h2><p id="49d2" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">我试图制作一个功能性的内容，但显然链接就是不工作。</p><ol class=""><li id="849a" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><a class="ae lk" href="#5519" rel="noopener ugc nofollow">什么是协程？</a> <br/> 1.1 <a class="ae lk" href="#abb3" rel="noopener ugc nofollow">关于暂停功能</a> <br/> 1.2的说明。我一直听说的工作是什么？</li><li id="4dd1" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae lk" href="#69d9" rel="noopener ugc nofollow">什么是协程？</a> <br/> 2.1。<a class="ae lk" href="#f5a1" rel="noopener ugc nofollow">协程范围—准备就绪… </a> <br/> 2.2。<a class="ae lk" href="#3733" rel="noopener ugc nofollow">协程上下文—设置这一切… </a> <br/> 2.3。协程生成器——我们出发了！</li><li id="3a42" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae lk" href="#42e8" rel="noopener ugc nofollow">启动器:启动vs异步</a> <br/> 3.1。<a class="ae lk" href="#a570" rel="noopener ugc nofollow">关于例外和取消的说明</a></li><li id="c661" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae lk" href="#236c" rel="noopener ugc nofollow">切换上下文，或者如何从UI跳转到IO，然后再返回</a></li></ol><h1 id="5519" class="nc lq iq bd lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np nq nr mg ns bi translated">什么是协程？</h1><p id="8628" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">正如Kotlin博士所说，协程就像一个轻量级线程。一次发射10 000枚导弹不会比预期的更多，它们会起作用的。</p><h2 id="abb3" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">关于暂停函数的一个注记</h2><p id="623a" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">Kotlin协同程序依赖于挂起函数——带有修饰符<code class="fe ll lm ln lo b">suspend</code> <em class="mn">的函数。</em>一个常见的错误是，仅仅因为函数是挂起的，就认为它是自动异步的。</p><p id="d932" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实并非如此。挂起函数仅仅意味着函数可以在某个时刻被挂起，<em class="mn">但这并不是必须的。</em></p><p id="6a1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多关于阻塞和暂停的细节在这里<a class="ae lk" href="https://medium.com/@elizarov/blocking-threads-suspending-coroutines-d33e11bf4761" rel="noopener"/>。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="8616" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">了解更多… </em></p><p id="9c4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能想知道轻量级线程到底是什么。如果你很好奇，想绕道走，可以看看这些视频:<a class="ae lk" href="https://www.youtube.com/watch?v=_hfBv0a09Jc" rel="noopener ugc nofollow" target="_blank">这里</a>，这里<a class="ae lk" href="https://www.youtube.com/watch?v=a3agLJQ6vt8" rel="noopener ugc nofollow" target="_blank">这里</a>，这里<a class="ae lk" href="https://www.youtube.com/watch?v=YrrUCSi72E8" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="cb4c" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">我一直听说的工作是怎么回事？</h2><p id="bf5f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">每次由<code class="fe ll lm ln lo b">launch</code>或<code class="fe ll lm ln lo b">async</code>启动协程时，结果返回值是一个作业。Job告诉您协程是否正在运行，这意味着您可以使用它来操纵协程的生命周期(例如，取消它)，以及它与另一个线程的关系。</p><p id="bf52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Job而不仅仅是<code class="fe ll lm ln lo b">launch</code><em class="mn">-</em>-ing或者<code class="fe ll lm ln lo b">async</code> -ing你的协程可以让你对协程本身有更多的控制。一般来说，工作是很有帮助的，但是，对于这个特殊的术语表来说有点多。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="f871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">了解更多… </em></p><p id="c3cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您希望尽可能控制您的协程时，作业尤其有价值。你可以在这里找到更深入的解释<a class="ae lk" href="https://proandroiddev.com/kotlin-coroutine-job-hierarchy-finish-cancel-and-fail-2d3d42a768a9" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="69d9" class="nc lq iq bd lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np nq nr mg ns bi translated">什么构成了协程？</h1><p id="c8f1" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">没有这三位就没有协程:作用域、上下文和构建器。你可以把它们看作是现成的语句。范围在准备，背景在设置，一个建造者最终出发并完成任务。</p><p id="9a5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们一个一个地检查它们。</p><h2 id="f5a1" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">协程作用域—准备就绪…</h2><p id="8f72" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">协程作用域处理协程的生命周期，即<strong class="jp ir"> <em class="mn">和<strong class="jp ir"><em class="mn"/></strong>何时结束。</em></strong></p><blockquote class="ob oc od"><p id="3e1f" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">作用域就像一个(马戏团)帐篷——每个协程都在里面执行，当帐篷倒下时，里面的所有东西也倒下。</p></blockquote><p id="d097" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这主要归功于Kotlin的结构化并发。我们不会在这里深入讨论这个问题，但是一个非常简单的观点是，如果一个特定范围内的任何协程失败，所有的工作都会被取消。你可以通过一种叫做<code class="fe ll lm ln lo b">SupervisorJob</code>的特殊工作来逃避这个问题。我们不会在这篇文章中讨论这个问题。</p><p id="0589" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建作用域的最简单方法是这样的:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="641f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个瞄准镜！这里的工作是当我们需要时，我们可以很容易地取消作用域，这里的<code class="fe ll lm ln lo b">Dispatchers.Main</code>是说用于代码执行的线程将是UI线程。</p><p id="4da2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">稍后，我们想要取消我们的<code class="fe ll lm ln lo b">circusTent</code>范围内所有协程的执行。因为我们定义了一个我们自己的作业并将其传递给了作用域，所以我们稍后要做的就是调用</p><pre class="kv kw kx ky gt oj lo ok ol aw om bi"><span id="755e" class="lp lq iq lo b gy on oo l op oq">eveningShow.cancel()</span></pre><p id="3bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">马戏团帐篷里正在进行的任何工作都将被取消。</p><p id="d075" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里需要注意的一点是,<code class="fe ll lm ln lo b">CoroutineScope</code>构造函数只接受一个参数——协程上下文。</p><p id="f301" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着，我们可以像这样编写与上面相同的代码:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="34d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">了解更多… </em></p><p id="da04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里阅读更多关于结构化并发的文章(我强烈建议你这样做)。</p><p id="b874" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对主管工作感兴趣，看看这篇文章。</p><p id="e453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">CoroutineScope</code>和<code class="fe ll lm ln lo b">coroutineScope</code>实际上是不同的。前者是一个构造函数，在创建父子协程层次结构时，您可以将后者视为一个助手(它必须一如既往地在某种范围内)。在<a class="ae lk" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html" rel="noopener ugc nofollow" target="_blank">文档</a>中有一些关于它的小东西。关于何时使用<code class="fe ll lm ln lo b">coroutineScope</code>合适的另一个例子是这里的<a class="ae lk" href="https://proandroiddev.com/kotlin-coroutines-patterns-anti-patterns-f9d12984c68e" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="3733" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">协程上下文—设置一切…</h2><p id="070f" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">一个上下文负责告诉你的协程<strong class="jp ir"> <em class="mn">它应该在哪里执行</em> </strong>。</p><blockquote class="ob oc od"><p id="be01" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">所以，再次使用马戏团帐篷的比喻，上下文就像马戏团的老板，他负责告诉小丑、杂技演员和其他表演者他们应该在哪里工作。老板，如果你愿意的话。<br/>就像在现实生活中一样，你的老板是个多头，他也可能会改变。</p></blockquote><p id="5ad7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上下文本身实际上是对<code class="fe ll lm ln lo b">CoroutineContext.Elements</code> <em class="mn">的包装。</em>这些元素中的每一个(这么多的头)负责协程的组成部分:</p><ul class=""><li id="842b" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk or mu mv mw bi translated">如前所述，你可以使用作业来控制协程的生命周期，也就是取消它。</li><li id="101a" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">分派器<br/> 分派器记录哪个线程上启动了什么，哪个线程应该被使用，以及如何回到适当的线程。<br/>整个事情依赖于一个<code class="fe ll lm ln lo b">ContinuationInterceptor</code>are——一个紧密跟随协程延续的机制(更深入的解释，再一次，太多了，无法放进这个小小的手工词汇表中)。</li><li id="b086" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">异常处理程序<br/> 非常简单明了——它处理协程中的任何异常。</li></ul><p id="0994" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们看一下我们的<code class="fe ll lm ln lo b">circusTent</code>范围，我们注意到我们可以添加一个<code class="fe ll lm ln lo b">CoroutineExceptionHandler</code> <em class="mn"> : </em></p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="524f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">上下文切换</strong>是协程不可分割的一部分。在我们介绍了协程启动程序及其类型之后，我们将回到这个问题，并更仔细地研究一下调度程序。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="834c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">了解更多… </em></p><p id="0ce6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要找出调度程序和上下文背后的具体细节，请查看教程  <em class="mn">中的第6章和第7章。你也可以查看<a class="ae lk" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.coroutines/-continuation-interceptor/" rel="noopener ugc nofollow" target="_blank">文档</a>。</em></p><h2 id="f00d" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">协程构建器—我们出发了！</h2><p id="970a" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">构建器，你的<code class="fe ll lm ln lo b">launch</code>和<code class="fe ll lm ln lo b">async</code> <em class="mn">，</em> <strong class="jp ir">创建</strong>协程，并使其中的代码能够执行。</p><blockquote class="ob oc od"><p id="f07a" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">建筑工人是舞台，马戏团演员是你的代码。</p><p id="2be0" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">不可思议的Melrosas(你的代码)只有在一切都准备好了之后才会骑着他们的自行车走钢丝:一个帐篷(协程范围)，一个马戏团团长或任何其他类型的老板(协程上下文)，以及舞台本身(协程构建者)。</p></blockquote><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi os"><img src="../Images/a89b113ae9a265baae51cb06c2c767c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFEgN7Mj7Z8h3bxWf7tNkQ.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated"><a class="ae lk" href="https://unsplash.com/@libraryofcongress?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">美国国会图书馆</a>在<a class="ae lk" href="https://unsplash.com/s/photos/circus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="42e8" class="nc lq iq bd lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np nq nr mg ns bi translated"><em class="nt">启动器:启动vs异步</em></h1><p id="e5b0" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">两人都是建筑工人。两者都启动协程。一旦你启动它们，它们就会执行你的代码。那么，有什么区别呢？</p><p id="b0c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最明显的一个是<code class="fe ll lm ln lo b">async</code>根据Futures/Promises原理运行，它返回一个<code class="fe ll lm ln lo b">Deferred&lt;T&gt;</code>对象——这个对象携带一个在异步块中计算的值(注意，Deferred实现了Job，所以两种“类型”的协程仍然以某种方式返回一个Job)。</p><p id="d7ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">launch</code>其实没有这样的东西——它只有一份工作。一个<code class="fe ll lm ln lo b">launch</code>不会返回一个“正确的”计算值。</p><p id="6f24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以异步和启动的区别主要在于<strong class="jp ir">暂停点</strong>和<strong class="jp ir">异常处理</strong>。</p><p id="54a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看悬挂点。</p><p id="9e1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当像这样启动一个协程时:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="d8de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在2点上暂停上面的代码。首先，我们在等待<code class="fe ll lm ln lo b">isOnHighWire</code>的结果时冻结一切，然后我们在<code class="fe ll lm ln lo b">isRidingBike</code>再次做同样的事情。</p><blockquote class="ob oc od"><p id="912b" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">一旦在协程作用域内，代码就按顺序执行<strong class="jp ir"><em class="iq"/></strong>，除非另有说明。</p></blockquote><p id="58f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们使用<em class="mn">异步:</em></p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="5f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在只有一个暂停点——当我们返回最终值时。</p><blockquote class="ob oc od"><p id="f5c9" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">我们现在有了一个协同程序范围内的代码的<strong class="jp ir"> <em class="iq">并发</em> </strong>执行。</p></blockquote><h2 id="a570" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">关于例外和取消的说明</h2><p id="f483" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">当谈到<code class="fe ll lm ln lo b">launch</code> vs <code class="fe ll lm ln lo b">async</code> <em class="mn">，</em>时，每一个都以不同的方式处理异常。</p><p id="e5c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ll lm ln lo b">launch</code>总是立即抛出异常，而在<code class="fe ll lm ln lo b">async</code>中触发的异常直到你调用<code class="fe ll lm ln lo b">await()</code> <em class="mn">才会抛出。</em>如果你不小心的话，在使用<em class="mn"> </em> <code class="fe ll lm ln lo b">async</code> <em class="mn">的时候，你可能最终会悄悄地抛出异常。</em></p><p id="b1be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正确处理帖子中的异常，所以我们现在不会深入讨论。</p><p id="54de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">鉴于这篇文章已经太长了，我们将简单地讨论一下取消协程时最重要的部分:</p><ul class=""><li id="3243" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk or mu mv mw bi translated">一旦协程的作用域被取消，它也将被取消。除非你使用现成的示波器(像Android的<code class="fe ll lm ln lo b">viewModelScope</code>)，否则你负责调用<code class="fe ll lm ln lo b">cancel</code></li><li id="dbfc" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">如果父协程被取消，协程层次结构中的任何子协程都将被取消。</li><li id="8691" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">如果您想在一个子进程失败时避开父进程的取消，请使用<code class="fe ll lm ln lo b">SupervisorJob</code>。</li></ul></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="44ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">了解更多信息</em></p><p id="b4dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于异常处理，<a class="ae lk" href="https://kotlinlang.org/docs/reference/coroutines/exception-handling.html" rel="noopener ugc nofollow" target="_blank">文档</a>给出了很好的解释，你也可以通过教程查看Kotlin <a class="ae lk" href="https://www.goodreads.com/book/show/50033186-kotlin-coroutines-by-tutorials-first-edition" rel="noopener ugc nofollow" target="_blank">协程的第8章。</a></p><p id="0219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于协程取消，请参考同一本书的第9章，您也可以在此处查看文章<a class="ae lk" href="https://medium.com/androiddevelopers/cancellation-in-coroutines-aa6b90163629" rel="noopener">、</a>以及文档中的资源。</p><h1 id="236c" class="nc lq iq bd lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np nq nr mg ns bi translated">切换上下文，或者如何从UI跳到IO，然后再跳回来</h1><p id="d86d" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">还记得我们说过的马戏团老板吗？</p><p id="1a2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">说到上下文切换，可以说协程上下文中最重要的元素是调度程序。</p><p id="d7a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调度程序负责你的协程在哪里执行。决定协程如何耗尽可用资源、在哪个线程池的哪个线程上执行的是调度程序。</p><p id="d816" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果协程上下文是我们马戏团团长的身体，那么调度员实际上就是大脑。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ot"><img src="../Images/aabd877c8bccc45fdca60baf40a5d753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdY66I6XNyiM_hD4bK4ZvA.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">有趣的事实:克里斯汀·米歇尔·威尔逊是林林兄弟马戏团146年历史上的第一位女领班！</figcaption></figure><p id="18a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种主要类型的调度程序:受限的和非受限的。前者总是依赖于预定义的系统上下文，而后者则不依赖。</p><ul class=""><li id="9a02" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk or mu mv mw bi translated">受限调度程序包括:主调度程序、io调度程序和默认调度程序</li><li id="f45b" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">未限制的调度程序为:未限制</li></ul><p id="1e12" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一些关于他们的小东西:</p><h2 id="a8a1" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">调度员。主要的</h2><ul class=""><li id="bd47" class="mo mp iq jp b jq mi ju mj jy ou kc ov kg ow kk or mu mv mw bi translated">意味着在UI线程上工作</li><li id="f6e3" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">非常简单的操作</li></ul><h2 id="f152" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">调度员。超正析象管(Image Orthicon)</h2><ul class=""><li id="13f2" class="mo mp iq jp b jq mi ju mj jy ou kc ov kg ow kk or mu mv mw bi translated">处理输入/输出</li><li id="4f4d" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">磁盘、数据库、网络操作等等</li><li id="5b6d" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">绑定到JVM →不能在Kotlin/JS或Kotlin/Native项目上使用它</li></ul><h2 id="c377" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">调度员。默认</h2><ul class=""><li id="0803" class="mo mp iq jp b jq mi ju mj jy ou kc ov kg ow kk or mu mv mw bi translated">每当您不指定调度程序时使用</li><li id="c751" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">推荐用于CPU密集型操作(排序列表，Android的DiffUtil等。)</li><li id="67be" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">由工作线程支持；它的任务数量等于系统的内核数量(至少2个)</li></ul><h2 id="c570" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">调度员。自由的</h2><ul class=""><li id="d5e1" class="mo mp iq jp b jq mi ju mj jy ou kc ov kg ow kk or mu mv mw bi translated">为协程创建新线程或在当前线程中工作；大多数情况下，它会在当时使用它的线程上运行</li><li id="b16a" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk or mu mv mw bi translated">不可预知的</li></ul><p id="947a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们开始切换！</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/0c825e8e2decc40aa5ef99cc83a19400.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*RUgEQYWmadPZXQoz_GEcwg.png"/></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">不可思议的Melrosas是我们希望在协程中执行的代码的替身</figcaption></figure><p id="d638" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用出色的Melrosas作为我们希望在协程范围内执行的代码的替身。</p><p id="724b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经创建了在UI线程上执行的作用域，<code class="fe ll lm ln lo b">circusTent</code> <em class="mn">，</em>——这代表了公众可以看到的一切。但是梅尔罗萨一家需要在上台前做好准备。</p><p id="e17b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一项费力的任务，需要花费太多的时间，而且无论如何，没有人真的想看到梅尔罗萨在彼此之间斗嘴，就像他们在每次表演之前所做的那样——有人的服装总是被撕破，有人的化妆品总是不见了，也许有人仍然对在木星的那段时间感到愤怒，当时某个人不得不开了一个伤人的玩笑。</p><p id="a6e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让所有这些远离观众，马戏团团长命令梅尔罗萨夫妇在后台做准备。</p><blockquote class="ob oc od"><p id="c635" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">如果我们想要执行繁重的操作(例如，从API获取数据)，然后在UI线程上显示它，同时防止UI冻结，这也是我们需要做的。</p></blockquote><p id="49c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是为什么我们上下文切换，就像这样:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="4dc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住，<em class="mn">作用域内的一切都是顺序发生的。</em>在上面的例子中，我们有一个暂停点——当梅尔罗萨准备他们的高空钢丝表演时。</p><p id="cdd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lk" href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/with-context.html" rel="noopener ugc nofollow" target="_blank"><em class="mn">with context</em></a><em class="mn"/>是一个暂停调用，所以在它完成之前不会移动到下一行。与常规的<code class="fe ll lm ln lo b">launch</code>不同，就像<code class="fe ll lm ln lo b">async</code>一样，它也可以返回一个计算值。</p><p id="c84d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果梅尔罗萨斯在登台前需要完成多项任务，我们决定多次使用<code class="fe ll lm ln lo b">withContext</code>，代码将按顺序执行<em class="mn">，</em>可能会降低速度和效率。</p><p id="1387" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们想让Melrosas并发执行所有准备任务，我们需要使用<code class="fe ll lm ln lo b">async</code>，就像这样:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="3b41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<code class="fe ll lm ln lo b">async</code>告诉梅尔罗萨斯在准备好高空钢丝的同时<em class="mn">准备好自己，而不是等待高空钢丝准备好(暂停代码)，然后再次等待梅尔罗萨斯穿上服装(另一个暂停点)。</em></p><blockquote class="ob oc od"><p id="8234" class="jn jo mn jp b jq jr js jt ju jv jw jx oe jz ka kb of kd ke kf og kh ki kj kk ij bi translated">切换上下文时使用<code class="fe ll lm ln lo b">async</code>使我们在作用域内只有一个暂停点，而不是多个。</p></blockquote></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="ab8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你的协程初级读本就差不多了！</p><p id="591b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当谈到协程时，有太多很酷的东西需要发现，但是这篇文章应该在您开始自己的探索之前为您提供一些基础知识。</p><p id="2280" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">这个术语表哪里出错了</strong></p><p id="5e57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个术语表主要是对Kotlin的协程的简化，如果您打算使用它们，它会向您提供最基本的知识。如果有帮助就鼓掌吧！</p><p id="8286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果你注意到这篇文章中的一些信息是错误的，请在评论中告诉我。我一定会相应地更新帖子:)</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><h2 id="cafd" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">来源:</h2><p id="83c3" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">1.疯狂的谷歌搜索。<a class="ae lk" href="https://www.goodreads.com/book/show/50033186-kotlin-coroutines-by-tutorials-first-edition" rel="noopener ugc nofollow" target="_blank">kot Lin Coroutines by Tutorials</a>，这是我极力推荐的一本书，也是我能够写出这整本书的原因<br/> 3。<a class="ae lk" href="https://kotlinlang.org/docs/reference/coroutines/coroutines-guide.html" rel="noopener ugc nofollow" target="_blank">科特林文件</a></p><h2 id="beff" class="lp lq iq bd lr ls lt dn lu lv lw dp lx jy ly lz ma kc mb mc md kg me mf mg mh bi translated">关于马戏团的一个注记</h2><p id="ae2e" class="pw-post-body-paragraph jn jo iq jp b jq mi js jt ju mj jw jx jy mk ka kb kc ml ke kf kg mm ki kj kk ij bi translated">如果你对马戏团感兴趣，我可以推荐:</p><p id="d62d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1.乔·尼克尔的《杂耍的秘密》2。多米尼克·简多和诺埃尔·丹尼尔创作的19世纪70年代至1950年的马戏团。罗伯特·波格丹一世的《畸形秀:展示人类的古怪行为以获取娱乐和利润》</p></div></div>    
</body>
</html>