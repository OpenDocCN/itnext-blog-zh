<html>
<head>
<title>Jenkins Tutorial — Part 9 — Basic Pipeline Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins教程—第9部分—基本流水线步骤</h1>
<blockquote>原文：<a href="https://itnext.io/jenkins-tutorial-part-9-basic-pipeline-steps-eeb1b9ed79f8?source=collection_archive---------1-----------------------#2022-05-28">https://itnext.io/jenkins-tutorial-part-9-basic-pipeline-steps-eeb1b9ed79f8?source=collection_archive---------1-----------------------#2022-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c518273176f996c36d381a98cf53ea9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isD_dDi7u493JTm4ZudxOw.jpeg"/></div></div></figure><p id="f78b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有步骤和命令，活在管道中是无法完成的。Jenkins<a class="ae kw" href="https://plugins.jenkins.io/workflow-basic-steps" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">workflow-basic-steps</strong></a>插件提供了几个常用的编写管道的步骤/命令。在完整的Jenkins教程的这一部分中，我们将深入讨论插件提供的命令。你应该注意到大量的Jenkins插件可能会添加一些步骤和命令。所有这些步骤都可以在下面的Jenkins堆栈中找到，并将在以后的文章中解释。</p><div class="kx ky gp gr kz la"><a href="https://github.com/ssbostan/jenkins-stack-kubernetes" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">GitHub-ssbo stan/jenkins-stack-kubernetes:在…上部署完整的Jenkins的脚本和清单</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">如果你觉得有用，就看星星。在Kubernetes上部署Jenkins containers CI/CD堆栈的脚本和清单。的…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">github.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jw la"/></div></div></a></div><h1 id="fe38" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">Jenkins基本流水线步骤:</h1><p id="d84e" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">以下命令可用于流水线的<code class="fe ms mt mu mv b"><strong class="ka ir">steps</strong></code>块。除了步骤块，这些命令也可用于<code class="fe ms mt mu mv b"><strong class="ka ir">post</strong></code>块的所有条件块。</p><p id="76de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">echo</strong></code>用于<strong class="ka ir">打印信息</strong>。除了可以用来调用方法的方式之外，下面的代码还显示了echo方法。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="fa37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">dir</strong></code>用于改变当前工作目录。dir块中存在的任何代码都在该目录中执行。</p><p id="efe0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">pwd</strong></code>用于返回当前工作目录。它接受一个名为<strong class="ka ir"> tmp </strong>的布尔参数，该参数返回作业工作区的一个临时目录，一个用于存储临时文件的特殊目录。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="2274" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">isUnix</strong></code>如果正在运行的代理是类似Unix的机器(Linux、macOS等),则返回True。)如果运行的代理是Windows，则为False。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7d20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果给定的文件存在，返回True。</p><p id="7b38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">readFile</strong></code>读取文件并返回其内容。它还接受一个名为encoding的可选参数，用指定的编码算法对文件内容进行编码。编码可用于读取二进制文件。</p><p id="0717" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">writeFile</strong></code>将内容写入给定文件。如果指定了可选参数encoding，则解码内容，并将解码后的内容写入文件。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e82e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">deleteDir</strong></code>删除当前目录，通常是工作空间。它会删除活动路径中的所有文件和子目录。如果你想删除特定的目录，你应该首先<strong class="ka ir"> dir() </strong>到它并使用<strong class="ka ir"> deleteDir() </strong>在它的块里面。<strong class="ka ir">删除目录</strong>命令通常用于post阶段。</p><p id="4447" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">catchError</strong></code>捕捉错误并继续流水线。流水线的默认行为是，如果在每个步骤中出现任何错误，则整个流水线都会失败。在大多数情况下，您需要继续管道来运行一些命令、发送通知等。catchError用于实现这一功能。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="7a27" class="ng lq iq mv b gy nh ni l nj nk">catchError(<br/>    stageResult: "SUCCESS",<br/>    buildResult: "FAILURE",<br/>    catchInterruptions: true,<br/>    message: "Error"<br/>) {<br/>    // your pipeline codes.<br/>}</span></pre><p id="9f35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">catchInterruptions用于捕获管道中断，如手动中止管道。默认情况下，如果在管道位于catchError块中时中止管道，管道不会中止，其他步骤也将运行。要防止这种行为，请将该参数设置为false。</p><p id="b50f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">warnError</strong></code>类似于catchError，但是如果在其块内运行管道时出现任何错误，它会将stageResult和buildResult设置为不稳定状态。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="947f" class="ng lq iq mv b gy nh ni l nj nk">warnError(<br/>    catchInterruptions: true,<br/>    message: "Unstable build message"<br/>) {<br/>    // your pipeline codes.<br/>}</span></pre><p id="298f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">mail</strong></code>用于在管道内部发送邮件。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="49a7" class="ng lq iq mv b gy nh ni l nj nk">mail(<br/>    subject: "Subject",<br/>    body: "Body",<br/>    from: "jenkins@localhost",<br/>    to: "ssbostan@yahoo.com"<br/>)</span></pre><p id="22a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，您应该在Jenkins机器上有一个SMTP服务器或一个端口转发器，以便向外部SMTP服务器发送请求。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8520" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">unstable</strong></code>将阶段结果设置为不稳定。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="e5f3" class="ng lq iq mv b gy nh ni l nj nk">unstable(message: "Your stage is unstable!")</span></pre><p id="556d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">timeout</strong></code>用于设置在其块内执行的命令的执行时间限制。例如，您想运行一个命令来检查“服务可用性、健康检查等”它应该在30秒内做出响应。在这种情况下，您必须使用超时命令。该命令的默认单位是分钟，可以更改为纳秒、微秒、毫秒、秒、分钟、小时、天。除了传统的超时方案，它还支持基于活动的超时。通过将activity参数设置为true，可以启用基于活动的方案。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="acc8" class="ng lq iq mv b gy nh ni l nj nk">timeout(<br/>    time: 15,<br/>    unit: "SECONDS",<br/>    activity: true<br/>) {<br/>    // your pipeline codes.<br/>}</span></pre><p id="6bd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果超时，管道将以中止状态终止。您可以使用catchError或warnError来捕获它。</p><p id="8eb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">sleep</strong></code>暂停管道指定的时间。默认单位是秒，可以像timeout命令一样更改。</p><pre class="mw mx my mz gt nc mv nd ne aw nf bi"><span id="7006" class="ng lq iq mv b gy nh ni l nj nk">sleep(10)<br/>sleep(time: 1, unit: "MINUTES")</span></pre><p id="f8cf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe ms mt mu mv b"><strong class="ka ir">retry</strong></code>如果在其主体执行期间发生任何异常，重试其主体(最多N次)。如果最后一次尝试返回异常，它将以失败状态退出。例如，您想在运行应用程序测试之前检查您的数据库。在这种情况下，您需要类似下面的管道。</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><h1 id="601d" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">最后的话:</h1><p id="0c0d" class="pw-post-body-paragraph jy jz iq ka b kb mn kd ke kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ij bi translated">关于Jenkins和Jenkins管道，我们有很多东西要学，因为它有很多插件，可以添加各种命令、函数、类等。我将在下一篇文章中解释更多关于Jenkins、管道指令和命令以及插件的内容。你可以在下面的GitHub资源库中找到以前的。祝你好运。</p><p id="e519" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关注我的LinkedIn<a class="ae kw" href="https://www.linkedin.com/in/ssbostan" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/ssbostan</a></p><div class="kx ky gp gr kz la"><a href="https://github.com/ssbostan/jenkins-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab fo"><div class="lc ab ld cl cj le"><h2 class="bd ir gy z fp lf fr fs lg fu fw ip bi translated">GitHub-ssbo stan/jenkins-tutorial:完整的Jenkins教程，参考，牛逼，示例</h2><div class="lh l"><h3 class="bd b gy z fp lf fr fs lg fu fw dk translated">如果你觉得有用，就看星星。Jenkins系列教程的参考和示例库。版权所有2021…</h3></div><div class="li l"><p class="bd b dl z fp lf fr fs lg fu fw dk translated">github.com</p></div></div><div class="lj l"><div class="nl l ll lm ln lj lo jw la"/></div></div></a></div></div></div>    
</body>
</html>