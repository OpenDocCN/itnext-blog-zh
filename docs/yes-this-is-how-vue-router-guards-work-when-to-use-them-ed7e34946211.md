# 是的，这就是 vue 路由器防护的工作方式&何时使用它们

> 原文：<https://itnext.io/yes-this-is-how-vue-router-guards-work-when-to-use-them-ed7e34946211?source=collection_archive---------0----------------------->

吼吼吼！圣诞快乐！是的，我知道这太早了，但是，在 12 月 25 日之前我不会写任何故事，所以提前祝你圣诞快乐。

现在，让我们深入主题:Vue 路由器警卫。

## 什么是 Vue 路由器？

如果你已经知道答案，跳到下一个标题。对于其他人来说， **Vue Router** 在 github 上也被称为 **vue-router** ，是官方的第三方插件，用于处理 Vue JS 应用的路由/ URL 状态。

## 什么是 Vue 路由器卫士？

基本上，Vue 路由器只根据 URL 为您切换组件。例如，它不处理对服务器的 AJAX 调用或基于角色的身份验证保护。为什么？仅仅因为这不是它的初衷。

但是！它有**护板**，我们也可以称之为**挂钩**，你可以插在上面。

Vue 路由器有 3 种防护装置:

*   全局守卫(在实例上)
    -每次 URL 改变
    时这些都被调用**-守卫: [**b**](https://jsfiddle.net/darkylmnx/xo5ra1jt/) **每次**、**解析**、**每次**之后**
*   路线守卫(在路线定义上)
    -这些仅在相关路线匹配
    时调用**-守卫:**在进入**之前**
*   路由组件保护
    -这些**仅在路由组件被使用/未被使用时调用** -保护: **beforeRouteEnter，beforeRouteUpdate，beforeRouteLeave**

**注**:除了每个后面的**外，所有的防护都是“异步”的。它们是按顺序调用的，因此，你需要显式调用“ **next()** ”方法告诉路由器你完成了，他可以继续这个序列。
这也被称为**中间件模式**。**

换句话说，守卫可以阻止或确认 URL 更改。

**注 2** :只有与路线相关的组件才会调用它们的保护装置。没有出现在路由定义中的子组件不会调用它们的保护，因为路由器不知道它们。

## 何时使用它们中的每一个？

首先，让我们看看它们被调用的顺序。
假设我们从**"/**导航到 **"/contact"** :

1.  **beforeRouteLeave** —调用**“/”路径组件**
2.  **每次**之前——新导航开始时，全局称为
3.  ****输入**之前——当**“/contact”路径**匹配时调用**
4.  ****beforeRouteEnter** —当 **"/contact "路由组件**匹配时调用**
5.  ****beforeResolve** —当路由组件保护完成时全局调用**
6.  ******afterEach** —当所有事情都解决后，全局称为****

******现在，假设我们从 **"/page/1"** 导航到 **"/page/2"** ，相同的路由和组件将被**重用**，只有 URL 发生了变化:******

1.  ******before each**——当一个新的导航开始时，全球称为****
2.  ********beforeRouteUpdate** —重用时调用**路由组件********
3.  ******在解决**之前——当路线组件防护完成时，全局称为****
4.  ********每次**之后——当所有事情都解决后，统称为******

********注**:当一个路径组件被重用时，所有的“回车”保护都被跳过。******

****既然我们已经看到了它们的执行顺序，就很容易想象何时使用它们:****

*   ****全局守卫:
    -不管每个之前的
    - **路径都有**公共逻辑时使用:进入任何路径之前的操作(基于角色的保护…)
    - **在解析**之前:完成路径组件守卫**之后的操作 **-**在每个**之后:因为路径已完全解析(跟踪页面浏览量…)而确定路径组件将被实例化时要执行的操作********
*   route guard:
    -如果逻辑为**则仅用于特定路由**
    - **在进入**之前，不使用全局保护并在其中添加多个条件，而是使用路由保护:预取数据以在存储上设置，任何路由特定的动作，无论是同步还是异步
*   路由组件保护:
    -当您**需要访问组件实例** -**before route enter**:获取组件呈现前的日期
    -**before route update**:当 URL 改变但组件被重用时更新本地数据，处理组件数据缓存
    - **beforeRouteLeave** :防止用户离开路由组件

差不多就是这样。我希望你现在明白所有这些保护装置之间的区别以及为什么要使用它们。

大多数用例将用于数据获取，分析，认证，布局系统或其他基于 URL 的东西。

这里有一个添加了所有守卫的 jsfiddle，看看顺序如何:
[https://jsfiddle.net/darkylmnx/xo5ra1jt/](https://jsfiddle.net/darkylmnx/xo5ra1jt/)
这里有另一个添加了异步守卫的 jsfiddle 进行比较:
[https://jsfiddle.net/darkylmnx/xo5ra1jt/2/](https://jsfiddle.net/darkylmnx/xo5ra1jt/2/)

打开控制台查看。

PS:冬天来了。如果你所在的地方阳光明媚(你好，迈阿密！)我们也有 t 恤:)