<html>
<head>
<title>Using Device_Calendar Library in Flutter to Communicate with Android/iOS Calendar</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter中的Device_Calendar库与Android/iOS日历通信</h1>
<blockquote>原文：<a href="https://itnext.io/using-device-calendar-library-in-flutter-to-communicate-with-android-ios-calendar-95b2d8c77b40?source=collection_archive---------4-----------------------#2019-04-11">https://itnext.io/using-device-calendar-library-in-flutter-to-communicate-with-android-ios-calendar-95b2d8c77b40?source=collection_archive---------4-----------------------#2019-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9d41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Built to Roam创建了一个“device _ calendar”Flutter/Dart库，用于与移动设备日历进行通信(即添加、更新、检索、删除Android/iOS日历事件)。他们当前的Github页面包括一个实现这个库的示例应用程序，我推荐你去看看。</p><div class="ko kp gp gr kq kr"><a href="https://github.com/builttoroam/flutter_plugins/tree/develop/device_calendar" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab fo"><div class="kt ab ku cl cj kv"><h2 class="bd iu gy z fp kw fr fs kx fu fw is bi translated">builttoroam/flutter_plugins</h2><div class="ky l"><h3 class="bd b gy z fp kw fr fs kx fu fw dk translated">通过在GitHub上创建一个帐户，为builttoroam/flutter_plugins开发做贡献。</h3></div><div class="kz l"><p class="bd b dl z fp kw fr fs kx fu fw dk translated">github.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf lg kr"/></div></div></a></div><p id="4529" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">他们的Github页面目前没有关于如何使用这个库的详细信息，所以我想我应该记录一些说明来节省其他人的时间。我将以我的应用程序为例，展示如何使用这个库。我的app叫<strong class="js iu"> MMA日历</strong>。它从网络上检索未来的MMA(混合武术)事件，并自动为用户创建/更新日历事件。</p><p id="ae5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的app可以在下面的链接看到，以供参考(请务必关注我的Github😎)<br/><a class="ae lh" href="https://github.com/patpatchpatrick/MMACalendarFlutter-v2-" rel="noopener ugc nofollow" target="_blank">https://github.com/patpatchpatrick/MMACalendarFlutter-v2-</a></p><ol class=""><li id="1fed" class="li lj it js b jt ju jx jy kb lk kf ll kj lm kn ln lo lp lq bi translated">首先，有必要将包依赖性添加到<strong class="js iu"> pubspec.yaml </strong>文件依赖性部分，这对于任何其他Flutter外部库都是必要的</li></ol><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="fd93" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">dependencies</strong>:<br/>  <strong class="lw iu">flutter</strong>:<br/>    <strong class="lw iu">sdk</strong>: flutter<br/><br/>  <strong class="lw iu">device_calendar</strong>: ^0.1.1</span></pre><p id="a3cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.<strong class="js iu">日历使用权限</strong><strong class="js iu"/>也必须添加到Android(<strong class="js iu">androidmanifest . XML</strong>)和iOS ( <strong class="js iu"> Info.plist </strong>)中的相应文件中</p><p id="d76f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mg">安卓清单:</em></p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="6ffb" class="ma mb it lw b gy mc md l me mf">&lt;uses-permission android:name="android.permission.READ_CALENDAR" /&gt;<br/>&lt;uses-permission android:name="android.permission.WRITE_CALENDAR" /&gt;</span></pre><p id="f69e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mg">信息列表:</em></p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="69f4" class="ma mb it lw b gy mc md l me mf">&lt;key&gt;NSCalendarsUsageDescription&lt;/key&gt;<br/>&lt;string&gt;REASON_TO_USE_CALENDAR&lt;/string&gt;</span></pre><p id="0dbd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.确保将<strong class="js iu"> device_calendar </strong>包导入到您当前正在处理的应用程序dart文件中。在我的MMA日历应用程序中，我在我的mainpage.dart文件和calendarpage.dart文件中使用这个库，所以我在这两个文件中导入这个包</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="cdac" class="ma mb it lw b gy mc md l me mf"><br/><strong class="lw iu">import </strong>'package:device_calendar/device_calendar.dart';</span></pre><p id="15da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4.在我的应用程序中，我在calendarpage.dart文件中创建了一个CalendarPage小部件。在创建这个小部件时，我使用了Github device_calendar示例应用程序作为参考，但对它进行了轻微的调整。My CalendarPage小部件包含一个ListView，它显示用户日历的列表。然后，用户可以选择他们想要使用的日历(即，应该将网络查询的MMA事件添加到哪个日历)。然后，当用户点击“<strong class="js iu">载入比赛并添加到日历</strong>”按钮时，日历事件将自动为用户创建(或者事件将被更新，如果它们是先前创建的)。日历页面如何工作的示例如下所示:</p><figure class="lr ls lt lu gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/843b3f9f787617222469167247ac7c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*VsYo1PuaJvkEFtfEKXX2zA.gif"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">用户在应用程序中选择日历的示例</figcaption></figure><p id="3b04" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">5.在与移动设备日历通信之前，您需要创建一个<strong class="js iu"> DeviceCalendarPlugin </strong>对象。当我构造我的日历页面小部件的状态(<strong class="js iu"> CalendarPageState </strong>)时，我在构造函数中创建了一个新的DeviceCalendarPlugin实例。我这样做是因为CalendarPage小部件立即需要插件可用于与移动设备日历通信的方法。</p><figure class="lr ls lt lu gt mi"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="a639" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">6.您还会注意到，在构造状态时创建了<strong class="js iu"> DeviceCalendarPlugin </strong>之后，在初始化状态时会调用<strong class="js iu"> _retrieveCalendars </strong>方法(在overidden initState()方法中)。本质上，这里发生的事情是，在构造状态之后，立即从设备中检索日历列表。</p><p id="a01f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的代码中，您将看到<strong class="js iu"> _retrieveCalendars </strong>方法从设备中异步检索日历，并将<strong class="js iu"> _calendars </strong>对象(这是一个<strong class="js iu"> List &lt; Calendar &gt; </strong>对象)设置为日历列表。在此之前，您必须检查设备是否被授予了适当的日历权限，如果没有，您必须请求从设备检索日历列表所需的日历权限。如果成功授予权限，DeviceCalendarPlugin的<strong class="js iu"> retrieveCalendars() </strong>方法可用于从移动设备检索日历列表(<strong class="js iu"> List &lt; Calendar &gt; </strong>)。总而言之，当创建CalendarPage小部件时，会创建一个新的DeviceCalendarPlugin，然后使用该插件的retrieveCalendars()方法从设备中检索日历。</p><figure class="lr ls lt lu gt mi"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="8927" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">7.有了日历列表后，我们就可以开始使用它们了！这里有几个选项，您可以从日历中检索事件、添加事件、删除事件、更新事件等</p><p id="11b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的MMA日历应用程序中，我只添加和更新事件，所以这就是我在这里关注的。如步骤4所述，我的CalendarPage小部件包含一个显示用户日历的<strong class="js iu"> ListView </strong>。如果日历是只读的，这个ListView还会显示一个锁图标(这些代码都来自device_calendar示例应用程序)。ListView中有一个<strong class="js iu">手势检测器</strong>，它将获取使用ListView的索引选择的日历。然后，我创建了一个回调函数，将这个日历ID、日历名称和deviceCalendarPlugin返回到我的应用程序的主页，以便它们可以在我的主页小部件中使用。在这里，我不打算深入研究如何在Dart中使用回调的细节，但概括地说，您只需在小部件(MainPage)中创建一个函数，并将该函数传递给子小部件(CalendarPage)的构造函数。然后，您可以从子进程调用这个回调函数来为父进程提供所需的对象(例如calendarID、calendarName、deviceCalendarPlugin)。(在我的code _calendarCallback函数中可以看到这样的例子)。</p><figure class="lr ls lt lu gt mi"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">回调发送ID，名称，插件到父部件(mainpage.dart)</figcaption></figure><p id="772d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">8.在我的主页小工具中通过回调接收到日历信息后，用户已经正式选择了一个日历，所以我启用了“<strong class="js iu">加载战斗并添加到日历</strong>”按钮供用户选择。我还向用户显示了选定的日历名称，如上面我的应用程序的GIF所示(第4步)。</p><p id="fe46" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当用户点击这个加载比赛按钮时，MMA事件数据从网络上被抓取并且MMA事件被创建，这些事件可以被添加到用户的移动设备日历中。我的代码使用一个名为<strong class="js iu"> _addEventsToCalendar </strong>的方法来创建/更新用户日历中的事件。在用户日历中添加/更新事件相对简单。首先，您必须创建一个新的<strong class="js iu">事件(calendarID) </strong>，使用所选的日历ID作为构造函数。然后，您需要向事件添加某些数据(开始时间、持续时间、标题、描述等)。创建事件后，使用<strong class="js iu">devicecalendarplugin . createorupdateevent(event)</strong>方法将其添加到用户的日历中，并插入您创建的事件作为唯一参数。完成了。您将通过您调用的事件创建方法接收一个结果变量(<strong class="js iu"> createEventResult </strong>)。如果您的事件创建成功，<strong class="js iu">createeventresult . issuccess</strong>bool将为真。</p><p id="d4ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一个重要的注意事项是，您的createEventResult对象还将有一个数据字符串变量(<strong class="js iu"> createEventResult.data </strong>)，它对应于您在移动设备中创建的事件的ID。如果需要，您可以使用此ID来更新事件。要更新一个事件，必须在该事件上设置ID属性(即<strong class="js iu">事件)。ID = createEventResult.data </strong>。然后，当您调用事件的<strong class="js iu">createOrUpdateEvent(event)</strong>方法时，它将被更新，而不是创建一个新的/重复的事件。</p><p id="fec3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我个人使用<strong class="js iu">shared preferences</strong>(shared _ preferences库)<strong class="js iu"> </strong>来处理我的事件id。当我创建MMA事件时，我将事件名称/日期与ID相关联，然后如果用户已经有了与事件相关联的ID，我会确保更新事件，而不是在他们的日历中创建新的/重复的事件。</p><figure class="lr ls lt lu gt mi"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">在日历中添加/更新事件</figcaption></figure><figure class="lr ls lt lu gt mi gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/6f3076e63aeafb944fe86137e3c9d754.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*mK9XuKCFaCVKIDLQBJ8zcw.gif"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">添加到Android日历的事件</figcaption></figure><p id="7936" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是所有的乡亲。</p><p id="f942" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，请务必查看内置漫游设备日历插件示例应用程序，如果您喜欢，不要忘记在Github上关注我😎。</p><p id="1b77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">设备_日历插件:</strong><a class="ae lh" href="https://pub.dartlang.org/packages/device_calendar" rel="noopener ugc nofollow" target="_blank">https://pub.dartlang.org/packages/device_calendar</a></p><p id="adfd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我的Github:</strong><a class="ae lh" href="https://github.com/patpatchpatrick" rel="noopener ugc nofollow" target="_blank">https://github.com/patpatchpatrick</a></p><p id="b960" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> MMA日历App:</strong><a class="ae lh" href="https://github.com/patpatchpatrick/MMACalendarFlutter-v2-" rel="noopener ugc nofollow" target="_blank">https://github.com/patpatchpatrick/MMACalendarFlutter-v2-</a></p></div></div>    
</body>
</html>