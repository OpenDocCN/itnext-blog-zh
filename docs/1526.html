<html>
<head>
<title>Test Driven Development with CI/CD Example: NPM Package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CI/CD的测试驱动开发示例:NPM包</h1>
<blockquote>原文：<a href="https://itnext.io/test-driven-development-with-ci-cd-example-npm-package-1169aa5df746?source=collection_archive---------0-----------------------#2018-11-15">https://itnext.io/test-driven-development-with-ci-cd-example-npm-package-1169aa5df746?source=collection_archive---------0-----------------------#2018-11-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/09e64a56d325a6ce241108c4e31251bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*7sSR_gIb6qLa8NrKtQ-Hsw.png"/></div></figure><p id="c263" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">光看标题，就觉得引擎盖下有很多事。这是真的，这些是我们应该知道的事情，因为这将使我们的生活变得更容易。我是说，差很多！</p><p id="4bdc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">创建并发布NPM包—常规方法</strong></p><div class="ks kt gp gr ku kv"><a href="https://www.npmjs.com/package/urls-checker" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd ir gy z fp la fr fs lb fu fw ip bi translated">urls检查器</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">从一个页面中获取所有的URL/图片，然后检查所有的URL是否工作正常。</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">www.npmjs.com</p></div></div><div class="le l"><div class="lf l lg lh li le lj js kv"/></div></div></a></div><p id="55e0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是我写的一个NPM包，用来检查网页中URL和图片的真实性。</p><p id="a7f4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通常，当我完成开发并准备发布时。我将把它提交到GitHub，然后发布到NPMJS——冒着包可能不工作或丢失某些元素的风险。</p><p id="aad3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在借助于测试驱动的开发方法、持续集成和持续部署。我再也不用担心我的代码不能工作了。我所需要做的就是向Github提交一个请求。在那之后，一切都被处理好了。</p><figure class="ll lm ln lo gt jr gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/a11c63c4baf2ed06a5445c7a5f65444e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/format:webp/1*znAsbNotzQrJhb3rIUiTgg.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">我的包的状态显示一切正常</figcaption></figure><p id="bc6b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">测试驱动开发</strong></p><p id="f2eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我猜你可能听说过这个软件开发过程。<strong class="jw ir"> <em class="lt">简而言之，这种类型的开发依赖于非常短的开发周期的重复:需求被转化为非常具体的测试用例，然后软件被改进以通过新的测试，只有</em> </strong>。如果你想了解更多关于测试驱动开发的内容，维基百科<a class="ae lu" href="https://en.wikipedia.org/wiki/Test-driven_development" rel="noopener ugc nofollow" target="_blank">上有一个很好的读物。</a></p><figure class="ll lm ln lo gt jr gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/0606136552bdf7340b92ed5129a1e13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*75OFawwOp3cFdrOtN_a1-Q.jpeg"/></div></figure><p id="9a0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我没有用这种方法开始我的包，但是这些是我应该开始的步骤。我不打算谈论如何开始和发布一个全新项目的细节。如果你想看完整的代码，请访问<a class="ae lu" href="https://github.com/dalenguyen/urls-checker" rel="noopener ugc nofollow" target="_blank"> urls-checker资源库</a>。</p><ol class=""><li id="f23d" class="lw lx iq jw b jx jy kb kc kf ly kj lz kn ma kr mb mc md me bi translated"><strong class="jw ir">开始新项目</strong></li></ol><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="da9f" class="mk ml iq mg b gy mm mn l mo mp">npm init -y</span></pre><p id="3e47" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">2.<strong class="jw ir">添加需求包</strong></p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="8a0a" class="mk ml iq mg b gy mm mn l mo mp">npm install mocha chai --save-dev</span></pre><p id="a447" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">3.<strong class="jw ir">编写一些测试用例并运行测试</strong></p><p id="f941" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">是的，您必须编写测试用例，就好像您的方法已经存在并且完全正常工作一样。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="d668" class="mk ml iq mg b gy mm mn l mo mp">// test/urls.js</span><span id="c4b9" class="mk ml iq mg b gy mq mn l mo mp">'use strict';</span><span id="29b7" class="mk ml iq mg b gy mq mn l mo mp">const { urlsChecker } = require('../index');<br/>const expect = require('chai').expect;</span><span id="1a6f" class="mk ml iq mg b gy mq mn l mo mp">describe('Urls Checker Test:', () =&gt; {<br/>    it('Get URLs result', async () =&gt; {        <br/>        let results = await urlsChecker('<a class="ae lu" href="https://google.ca'" rel="noopener ugc nofollow" target="_blank">https://google.ca'</a>);               <br/>        expect(results.ok.length).to.be.above(0);<br/>    });<br/>})</span></pre><p id="577e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">当然，跑了也会失败，这才是重点。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="08a1" class="mk ml iq mg b gy mm mn l mo mp">mocha --timeout 10000 --exit</span></pre><p id="9ec9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">4.<strong class="jw ir">编写通过测试用例的方法</strong></p><p id="0453" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">太长太复杂，请参考知识库:P</p><p id="6e29" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">5.<strong class="jw ir">添加CI/CD配置(Travis) </strong></p><p id="d051" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，它是主要部分。通常，在完成项目后，我们会将其发布到NPMJS。推你的包超级容易。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="5b48" class="mk ml iq mg b gy mm mn l mo mp">npm login // <a class="ae lu" href="https://www.npmjs.com/signup" rel="noopener ugc nofollow" target="_blank">Create an account</a> if you don't have<br/>npm publish</span></pre><p id="b9dc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是，在CI/CD的帮助下，每次你提交GitHub，你的代码都会被检查，如果通过。您的包将自动发布。于是告别了<strong class="jw ir"> <em class="lt"> npm发布</em></strong>；)</p><p id="6894" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">与特拉维斯的持续融合</strong></p><p id="67ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">有很多工具可以帮助你做CI/CD，比如Jenkins，Travis CI，Bamboo，Gitlab CI…在这篇文章中，我将尝试<a class="ae lu" href="https://travis-ci.org" rel="noopener ugc nofollow" target="_blank"> Travis </a>。我们需要做的是一个Github账户和一个Travis账户。实际上，您将通过您的Github帐户登录Travis。因此，您将在Travis dashboard中列出您的所有公共项目。</p><figure class="ll lm ln lo gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/79d4164aa3ec91a55d877fbfa04f821f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*JgtRUx_IM42DOOTwNkbICQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk translated">您可以选择启用或禁用与任何项目的集成</figcaption></figure><p id="3a55" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了让您的项目利用Travis的持续集成，您必须为它添加一个配置文件。这是一个NodeJS项目，Node的版本是8。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="5ead" class="mk ml iq mg b gy mm mn l mo mp">// .travis.yml<br/>language: node_js<br/>node_js:<br/> - '8'</span></pre><p id="af48" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，您可以将构建状态标记添加到您的<strong class="jw ir"> readme.md </strong>文件中。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="37a9" class="mk ml iq mg b gy mm mn l mo mp">// Replace the username and project name with yours</span><span id="b16e" class="mk ml iq mg b gy mq mn l mo mp">[![Build Status](https://travis-ci.org/dalenguyen/urls-checker.svg?branch=master)](https://travis-ci.org/dalenguyen/urls-checker)</span></pre><p id="ac60" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从现在开始，每次推送Github。Travis将运行并测试您的项目，所以请确保您已经准备好了测试用例，并将测试脚本添加到package.json中</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="2723" class="mk ml iq mg b gy mm mn l mo mp">// package.json</span><span id="5c36" class="mk ml iq mg b gy mq mn l mo mp">"scripts": {<br/>    "test": "mocha --timeout 10000 --exit"<br/>},</span></pre><p id="6721" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">持续部署到NPMJS </strong></p><p id="1b53" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后一步是确保如果一切都通过了，您的包将被发布到NPMJS。为此，我们需要编辑travis的配置。</p><p id="12a6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以从travis cli运行以下命令:</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="30c4" class="mk ml iq mg b gy mm mn l mo mp">travis setup npm</span></pre><p id="82ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">或者手动添加到<strong class="jw ir"> <em class="lt"> .travis.yml </em> </strong>文件中</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="4977" class="mk ml iq mg b gy mm mn l mo mp">// .travis.yml</span><span id="d3fb" class="mk ml iq mg b gy mq mn l mo mp">...<br/>deploy:<br/>  provider: npm<br/>  email: "YOUR_EMAIL_ADDRESS"<br/>  api_key: "YOUR_AUTH_TOKEN"</span></pre><p id="fb63" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您的机器上没有travis cli，请查看<a class="ae lu" href="https://github.com/travis-ci/travis.rb#installation" rel="noopener ugc nofollow" target="_blank"> Travis说明页</a>。这就是在MacOS上安装的方法。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="c60a" class="mk ml iq mg b gy mm mn l mo mp">brew install travis</span></pre><p id="b5ed" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了获得api_key，您需要从您的帐户创建新的令牌:</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="4d08" class="mk ml iq mg b gy mm mn l mo mp">https://www.npmjs.com/settings/your-username/tokens/</span></pre><p id="aeeb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是，请不要将您的令牌放在公共网站上。按照这个步骤来保护它。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="042f" class="mk ml iq mg b gy mm mn l mo mp">travis encrypt your-npm-token --add deploy.api_key</span></pre><p id="67e4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后我的. travis.yml正在更新中</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="c887" class="mk ml iq mg b gy mm mn l mo mp">// .travis.yml<br/>language: node_js<br/>node_js:<br/>- '8'<br/>deploy:<br/>  provider: npm<br/>  email: <a class="ae lu" href="mailto:dungnq@itbox4vn.com" rel="noopener ugc nofollow" target="_blank">dungnq@itbox4vn.com</a><br/>  api_key:<br/>    secure: BSjy5UrLZOgrTnaA...<br/>  on:<br/>    branch: master<br/>    tags: true</span></pre><p id="f2b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以删除<strong class="jw ir"> <em class="lt">标签:true </em> </strong>，因为只有当您使用标签提交时，它才会部署到NPMJS。</p><pre class="ll lm ln lo gt mf mg mh mi aw mj bi"><span id="6d75" class="mk ml iq mg b gy mm mn l mo mp">git push --tags</span></pre><p id="1541" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">开始部署</p><figure class="ll lm ln lo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ms"><img src="../Images/056c5cdc96e7e3252dc7012bcb02f42a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WvDW-nJ_Lo1N0rQhhhwQw.png"/></div></div></figure><p id="305b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">从现在开始，我的包是安全的，并且在Github和NPMJS上总是最新的。希望这篇文章对你有所帮助；)</p></div></div>    
</body>
</html>