<html>
<head>
<title>K0s Multi-node Cluster With K0sctl</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用K0sctl的K0s多节点集群</h1>
<blockquote>原文：<a href="https://itnext.io/k0s-multi-node-cluster-with-k0sctl-922fc2cb4dc8?source=collection_archive---------3-----------------------#2021-04-27">https://itnext.io/k0s-multi-node-cluster-with-k0sctl-922fc2cb4dc8?source=collection_archive---------3-----------------------#2021-04-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="92f9" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">轻松运行单节点或多节点k0s集群</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/b50b637fd35e3483afe4bd73d2cb1b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*upRN4DbbQbrBoTFSgXewTA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由<a class="ae ky" href="https://unsplash.com/@vmokry?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Vladimir Mokry </a>在<a class="ae ky" href="https://unsplash.com/s/photos/cluster?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="2d8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自从几个月前我写了关于k0s 的第一篇文章以来，k0s环境中发生了很多事情。在这篇新文章中，我们将首先展示单节点集群的简化设置，接下来我们将展示k0s的配套工具<a class="ae ky" href="https://github.com/k0sproject/k0sctl" rel="noopener ugc nofollow" target="_blank"> k0sctl </a>的用法，它以一种非常简单的方式设置多节点集群。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="6ff3" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建单节点集群</h2><p id="1f96" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">由于在0.12版本中引入了一个<code class="fe na nb nc nd b">--single</code>标志，k0s使得单节点集群的创建变得更加简单。基本上，一旦下载了k0s二进制文件，只需两个命令就可以运行单节点k0s集群:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="18de" class="mc md it nd b gy ni nj l nk nl">$ k0s install controller --single<br/>$ systemctl start k0scontroller</span></pre><ul class=""><li id="3ecd" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">第一个创建systemd单元文件</li><li id="d741" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">第二个开始这个过程</li></ul><p id="0c25" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您想在本地机器上运行k0s，一个简单的解决方案是创建一个VM并在其中安装k0s。我们将使用<a class="ae ky" href="https://vagrantup.com" rel="noopener ugc nofollow" target="_blank">流浪者</a>来说明这些步骤，这是来自<a class="ae ky" href="https://hashicorp.com" rel="noopener ugc nofollow" target="_blank"> Hashicorp </a>的一个很棒的工具。vagger专注于开发环境，它可以轻松地供应和配置虚拟机。让我们按照以下步骤进行操作:</p><ul class=""><li id="788e" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">按照各自网站上的说明安装<a class="ae ky" href="https://vagrantup.com" rel="noopener ugc nofollow" target="_blank">vagger</a>和<a class="ae ky" href="https://virtualbox.org" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a></li><li id="b1bd" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">创建一个新文件夹和一个名为<em class="oa">的文件，内容如下:</em></li></ul><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="7b33" class="mc md it nd b gy ni nj l nk nl">Vagrant.configure("2") do |config|<br/>  config.vm.box = "hashicorp/bionic64"<br/>  config.vm.network "private_network", ip: "192.168.33.11"<br/>  config.vm.provision "shell", inline: &lt;&lt;-SHELL<br/>    curl -sSLf <a class="ae ky" href="https://get.k0s.sh" rel="noopener ugc nofollow" target="_blank">https://get.k0s.sh</a> | sudo sh<br/>    sudo k0s default-config &gt; /tmp/k0s.yaml<br/>    sudo k0s install controller --single -c /tmp/k0s.yaml<br/>    sudo systemctl start k0scontroller &amp;&amp; sleep 10<br/>    sudo cp /var/lib/k0s/pki/admin.conf /vagrant/kubeconfig<br/>    sed -i "s/localhost/192.168.33.11/" /vagrant/kubeconfig<br/>  SHELL<br/>end</span></pre><p id="a4da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件告诉vagger创建一个VM并在其中安装k0s。</p><ul class=""><li id="de27" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">在同一文件夹中，运行以下命令:</li></ul><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="67c5" class="mc md it nd b gy ni nj l nk nl">$ vagrant up</span></pre><p id="7020" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">完成安装只需要几十秒钟，群集启动并运行只需要多一点时间。<code class="fe na nb nc nd b">kubeconfig</code>文件已被复制到当前文件夹中，可以像往常一样用于访问集群:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="523f" class="mc md it nd b gy ni nj l nk nl">$ export KUBECONFIG=$PWD/kubeconfig</span><span id="97ac" class="mc md it nd b gy ob nj l nk nl">$ kubeclt get nodes<br/>NAME      STATUS   ROLES    AGE     VERSION<br/>vagrant   Ready    &lt;none&gt;   2m57s   v1.20.5-k0s1</span></pre><p id="56ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到创建本地单节点k0s集群非常容易。现在，如何创建一个高可用性多节点集群呢？这就是我们将在下一部分阐述的内容。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="d974" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">创建多节点集群</h2><p id="8ecf" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">除了k0s 0.10 <a class="oc od ep" href="https://medium.com/u/fedcaa2e9074?source=post_page-----922fc2cb4dc8--------------------------------" rel="noopener" target="_blank">之外，Mirantis </a>还推出了<a class="ae ky" href="https://github.com/k0sproject/k0sctl" rel="noopener ugc nofollow" target="_blank"> k0sctl </a>，这是一款使用一个命令部署多节点集群的工具。在这一部分中，我们将看到k0sctl的实际应用，并使用它来创建我们自己的HA集群，该集群由3个控制器节点和3个workers组成。我们将遵循以下步骤:</p><ul class=""><li id="2809" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated">基础设施的创建</li><li id="8e4e" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">k0sctl的安装</li><li id="8cab" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">创建集群的配置文件</li><li id="da0a" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">集群的创建</li><li id="9f48" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">清除</li></ul><p id="6983" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建虚拟机开始，稍后将在这些虚拟机上安装集群。</p><ol class=""><li id="2b73" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu oe ns nt nu bi translated"><strong class="lb iu">创建基础设施</strong></li></ol><p id="0292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将在欧洲云提供商<a class="ae ky" href="https://exoscale.com" rel="noopener ugc nofollow" target="_blank"> Exoscale </a>上部署一个集群。为了部署我们的6个ubuntu虚拟机，我们可以使用Exoscale的web界面，因为它简洁且非常直观，但我们也可以使用<a class="ae ky" href="https://registry.terraform.io/providers/exoscale/exoscale/latest" rel="noopener ugc nofollow" target="_blank"> Terraform provider </a>。</p><p id="ea08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:如果您想尝试Exoscale Terraform提供程序，您可以使用<a class="ae ky" href="https://gitlab.com/lucj/infra/-/tree/master/terraform/exoscale-instances" rel="noopener ugc nofollow" target="_blank"> this GitLab repository </a>中的配置文件。</p><p id="3cec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本例中，我使用Terraform创建虚拟机，并获得每个虚拟机的名称和IP地址作为输出。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="11a1" class="mc md it nd b gy ni nj l nk nl">instances_names = {<br/>  "exo-0" = "89.145.162.84"<br/>  "exo-1" = "89.145.162.193"<br/>  "exo-2" = "194.182.171.240"<br/>  "exo-3" = "89.145.160.110"<br/>  "exo-4" = "89.145.161.64"<br/>  "exo-5" = "89.145.162.204"<br/>}</span></pre><p id="cc26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在群集的配置步骤中使用这些IP。</p><p id="e0de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 2。安装k0sctl </strong></p><p id="92e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">k0sctl二进制文件可以从GitHub发布页面下载。有适用于MacOS、Linux和Windows的软件包，但也可以从其Go源代码安装。</p><p id="bbec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">不带任何参数运行k0sctl会列出所有可用的命令:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="e4de" class="mc md it nd b gy ni nj l nk nl"><strong class="nd iu">$ k0sctl<br/></strong>NAME:<br/>   k0sctl - k0s cluster management tool</span><span id="c62f" class="mc md it nd b gy ob nj l nk nl">USAGE:<br/>   k0sctl [global options] command [command options] [arguments...]</span><span id="7a2f" class="mc md it nd b gy ob nj l nk nl">COMMANDS:<br/>   version     Output k0sctl version<br/>   apply       Apply a k0sctl configuration<br/>   kubeconfig  Output the admin kubeconfig of the cluster<br/>   init        Create a configuration template<br/>   reset       Remove traces of k0s from all of the hosts<br/>   help, h     Shows a list of commands or help for one command</span><span id="9448" class="mc md it nd b gy ob nj l nk nl">GLOBAL OPTIONS:<br/>   --debug, -d  Enable debug logging (default: false) [$DEBUG]<br/>   --help, -h   show help (default: false)</span></pre><p id="04c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将在以下步骤中演示每个命令。</p><p id="ec60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 3。创建集群的配置文件</strong></p><p id="d397" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这一步中，我们将创建集群的配置文件，该文件包含k0sctl创建和配置集群所需的所有信息。</p><p id="5432" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">由于我们不知道这个配置文件是什么样子，我们可以使用下面的命令让k0sctl为我们生成一个示例文件:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="b80c" class="mc md it nd b gy ni nj l nk nl">$ k0sctl init &gt; cluster.yaml</span></pre><p id="e4a6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个文件提供了一个有用的例子。它基本上定义了一个2节点集群，一个控制器和一个工作器。对于每个节点，都提供了IP地址和ssh密钥(k0sctl连接到节点时需要)。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="9ce0" class="mc md it nd b gy ni nj l nk nl"><strong class="nd iu">$ cat cluster.yaml<br/></strong>apiVersion: k0sctl.k0sproject.io/v1beta1<br/>kind: Cluster<br/>metadata:<br/>  name: k0s-cluster<br/>spec:<br/>  hosts:<br/>  - ssh:<br/>      address: 10.0.0.1<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/id_rsa<br/>    role: controller<br/>    os: ""<br/>  - ssh:<br/>      address: 10.0.0.2<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/id_rsa<br/>    role: worker<br/>    os: ""<br/>  k0s:<br/>    version: 0.13.1</span></pre><p id="f34e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将对此文件稍加修改，使其使用我们自己的虚拟机:</p><ul class=""><li id="f2f2" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><code class="fe na nb nc nd b">exo-0</code>、<code class="fe na nb nc nd b">exo-1</code>和<code class="fe na nb nc nd b">exo-2</code>将作为控制器</li><li id="2f6f" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated"><code class="fe na nb nc nd b">exo-4</code>、<code class="fe na nb nc nd b">exo-5</code>和<code class="fe na nb nc nd b">exo-6</code>将充当工人</li></ul><p id="fd47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是该配置文件的新版本:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="0a9f" class="mc md it nd b gy ni nj l nk nl">apiVersion: k0sctl.k0sproject.io/v1beta1<br/>kind: Cluster<br/>metadata:<br/>  name: k0s-cluster<br/>spec:<br/>  hosts:<br/>  - ssh:<br/>      address: 89.145.162.84<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: controller<br/>    os: ""<br/>  - ssh:<br/>      address: 89.145.162.193<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: controller<br/>    os: ""<br/>  - ssh:<br/>      address: 194.182.171.240<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: controller<br/>    os: ""  <br/>  - ssh:<br/>      address: 89.145.160.110<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: worker<br/>    os: ""<br/>  - ssh:<br/>      address: 89.145.161.64<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: worker<br/>    os: ""<br/>  - ssh:<br/>      address: 89.145.162.204<br/>      user: root<br/>      port: 22<br/>      keyPath: /Users/luc/.ssh/training<br/>    role: worker<br/>    os: ""<br/>  k0s:<br/>    version: 0.13.1</span></pre><p id="3151" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意事项:</p><ul class=""><li id="01cc" class="nm nn it lb b lc ld lf lg li no lm np lq nq lu nr ns nt nu bi translated"><em class="oa"> /Users/luc/。ssh/training </em>是我的本地私钥，对应于在创建过程中自动添加到每个实例的公钥(参数提供给Terraform配置文件)</li><li id="6f1a" class="nm nn it lb b lc nv lf nw li nx lm ny lq nz lu nr ns nt nu bi translated">在这个阶段，可以指定许多附加的配置选项，但是这些选项对于了解全局来说是很好的</li></ul><p id="b7d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一步中，我们将使用此配置文件在我们的基础架构上创建集群。</p><p id="2e68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 4。集群的创建</strong></p><p id="24e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用k0sctl创建集群，我们只需向<code class="fe na nb nc nd b">apply</code>子命令提供我们的配置文件:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="d00f" class="mc md it nd b gy ni nj l nk nl">$ k0sctl apply --config cluster.yaml</span></pre><p id="69bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">K0sctl将连接到每个节点并相应地配置它们</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="8ed9" class="mc md it nd b gy ni nj l nk nl">⠀⣿⣿⡇⠀⠀⢀⣴⣾⣿⠟⠁⢸⣿⣿⣿⣿⣿⣿⣿⡿⠛⠁⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀█████████ █████████ ███<br/>⠀⣿⣿⡇⣠⣶⣿⡿⠋⠀⠀⠀⢸⣿⡇⠀⠀⠀⣠⠀⠀⢀⣠⡆⢸⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀███          ███    ███<br/>⠀⣿⣿⣿⣿⣟⠋⠀⠀⠀⠀⠀⢸⣿⡇⠀⢰⣾⣿⠀⠀⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀███          ███    ███<br/>⠀⣿⣿⡏⠻⣿⣷⣤⡀⠀⠀⠀⠸⠛⠁⠀⠸⠋⠁⠀⠀⣿⣿⡇⠈⠉⠉⠉⠉⠉⠉⠉⠉⢹⣿⣿⠀███          ███    ███<br/>⠀⣿⣿⡇⠀⠀⠙⢿⣿⣦⣀⠀⠀⠀⣠⣶⣶⣶⣶⣶⣶⣿⣿⡇⢰⣶⣶⣶⣶⣶⣶⣶⣶⣾⣿⣿⠀█████████    ███    ██████</span><span id="14ae" class="mc md it nd b gy ob nj l nk nl">k0sctl v0.8.2 Copyright 2021, k0sctl authors.<br/>Anonymized telemetry of usage will be sent to the authors.<br/>By continuing to use k0sctl you agree to these terms:<br/><a class="ae ky" href="https://k0sproject.io/licenses/eula" rel="noopener ugc nofollow" target="_blank">https://k0sproject.io/licenses/eula</a><br/><strong class="nd iu">INFO ==&gt; Running phase: Connect to hosts<br/></strong>INFO [ssh] 89.145.162.204:22: connected<br/>INFO [ssh] 89.145.162.84:22: connected<br/>INFO [ssh] 89.145.160.110:22: connected<br/>INFO [ssh] 89.145.161.64:22: connected<br/>INFO [ssh] 194.182.171.240:22: connected<br/>INFO [ssh] 89.145.162.193:22: connected<br/><strong class="nd iu">INFO ==&gt; Running phase: Detect host operating systems<br/></strong>INFO [ssh] 89.145.160.110:22: is running Ubuntu 20.04.2 LTS<br/>INFO [ssh] 89.145.162.84:22: is running Ubuntu 20.04.2 LTS<br/>INFO [ssh] 89.145.162.204:22: is running Ubuntu 20.04.2 LTS<br/>INFO [ssh] 194.182.171.240:22: is running Ubuntu 20.04.2 LTS<br/>INFO [ssh] 89.145.161.64:22: is running Ubuntu 20.04.2 LTS<br/>INFO [ssh] 89.145.162.193:22: is running Ubuntu 20.04.2 LTS<br/><strong class="nd iu">INFO ==&gt; Running phase: Prepare hosts<br/>INFO ==&gt; Running phase: Gather host facts<br/></strong>INFO [ssh] 89.145.162.193:22: discovered eth0 as private interface<br/>INFO [ssh] 89.145.162.84:22: discovered eth0 as private interface<br/>INFO [ssh] 194.182.171.240:22: discovered eth0 as private interface<br/><strong class="nd iu">INFO ==&gt; Running phase: Download k0s on hosts<br/></strong>INFO [ssh] 89.145.162.84:22: downloading k0s 0.13.1<br/>INFO [ssh] 89.145.160.110:22: downloading k0s 0.13.1<br/>INFO [ssh] 194.182.171.240:22: downloading k0s 0.13.1<br/>INFO [ssh] 89.145.162.204:22: downloading k0s 0.13.1<br/>INFO [ssh] 89.145.161.64:22: downloading k0s 0.13.1<br/>INFO [ssh] 89.145.162.193:22: downloading k0s 0.13.1<br/><strong class="nd iu">INFO ==&gt; Running phase: Validate hosts<br/>INFO ==&gt; Running phase: Gather k0s facts<br/>INFO ==&gt; Running phase: Validate facts<br/>INFO ==&gt; Running phase: Configure k0s</strong><br/>WARN [ssh] 89.145.162.84:22: generating default configuration<br/>INFO [ssh] 89.145.162.84:22: validating configuration<br/>INFO [ssh] 89.145.162.84:22: configuration was changed<br/>INFO [ssh] 89.145.162.193:22: validating configuration<br/>INFO [ssh] 89.145.162.193:22: configuration was changed<br/>INFO [ssh] 194.182.171.240:22: validating configuration<br/>INFO [ssh] 194.182.171.240:22: configuration was changed<br/><strong class="nd iu">INFO ==&gt; Running phase: Initialize the k0s cluster<br/></strong>INFO [ssh] 89.145.162.84:22: installing k0s controller<br/>INFO [ssh] 89.145.162.84:22: waiting for the k0s service to start<br/>INFO [ssh] 89.145.162.84:22: waiting for kubernetes api to respond<br/><strong class="nd iu">INFO ==&gt; Running phase: Install controllers<br/></strong>INFO [ssh] 89.145.162.84:22: generating token<br/>INFO [ssh] 89.145.162.193:22: writing join token<br/>INFO [ssh] 89.145.162.193:22: installing k0s controller<br/>INFO [ssh] 89.145.162.193:22: starting service<br/>INFO [ssh] 89.145.162.193:22: waiting for the k0s service to start<br/>INFO [ssh] 89.145.162.193:22: waiting for kubernetes api to respond<br/>INFO [ssh] 89.145.162.84:22: generating token<br/>INFO [ssh] 194.182.171.240:22: writing join token<br/>INFO [ssh] 194.182.171.240:22: installing k0s controller<br/>INFO [ssh] 194.182.171.240:22: starting service<br/>INFO [ssh] 194.182.171.240:22: waiting for the k0s service to start<br/>INFO [ssh] 194.182.171.240:22: waiting for kubernetes api to respond<br/><strong class="nd iu">INFO ==&gt; Running phase: Install workers<br/></strong>INFO [ssh] 89.145.162.84:22: generating token<br/>INFO [ssh] 89.145.161.64:22: writing join token<br/>INFO [ssh] 89.145.160.110:22: writing join token<br/>INFO [ssh] 89.145.162.204:22: writing join token<br/>INFO [ssh] 89.145.160.110:22: installing k0s worker<br/>INFO [ssh] 89.145.162.204:22: installing k0s worker<br/>INFO [ssh] 89.145.161.64:22: installing k0s worker<br/>INFO [ssh] 89.145.160.110:22: starting service<br/>INFO [ssh] 89.145.162.204:22: starting service<br/>INFO [ssh] 89.145.161.64:22: starting service<br/>INFO [ssh] 89.145.160.110:22: waiting for node to become ready<br/>INFO [ssh] 89.145.162.204:22: waiting for node to become ready<br/>INFO [ssh] 89.145.161.64:22: waiting for node to become ready<br/><strong class="nd iu">INFO ==&gt; Running phase: Disconnect from hosts<br/></strong>INFO ==&gt; Finished in 1m35s<br/>INFO k0s cluster version 0.13.1 is now installed<br/>INFO Tip: To access the cluster you can now fetch the admin kubeconfig using:<br/>INFO      k0sctl kubeconfig</span></pre><p id="5833" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我留下了整个输出，因为看到设置过程中涉及的不同阶段非常有趣(粗体文本)。</p><p id="9dd8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们可以使用以下命令获得集群的<code class="fe na nb nc nd b">kubeconfig</code>:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="fff4" class="mc md it nd b gy ni nj l nk nl">$ k0sctl kubeconfig -c cluster.yaml &gt; kubeconfig</span></pre><p id="ab05" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，我们设置KUBECONFIG环境变量，使它指向这个<code class="fe na nb nc nd b">kubeconfig</code>:</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="b7b4" class="mc md it nd b gy ni nj l nk nl">$ export KUBECONFIG=$PWD/kubeconfig</span></pre><p id="c6e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的本地kubectl客户机现在可以与集群通信了。列出集群的节点，我们只能看到工作节点，这是k0s的特性之一，确保控制器和工作节点是隔离的。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="ed77" class="mc md it nd b gy ni nj l nk nl"><strong class="nd iu">$ kubectl get nodes<br/></strong>NAME    STATUS   ROLES    AGE     VERSION<br/>exo-3   Ready    &lt;none&gt;   4m54s   v1.20.5-k0s1<br/>exo-4   Ready    &lt;none&gt;   4m53s   v1.20.5-k0s1<br/>exo-5   Ready    &lt;none&gt;   4m54s   v1.20.5-k0s1</span></pre><p id="68ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> 5。清理</strong></p><p id="c90e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">k0sctl附带了一个方便的<code class="fe na nb nc nd b">reset</code>命令，可以从基础设施中删除所有与k0s相关的组件。当使用相同的基础设施来测试多种配置时，这非常有用。</p><pre class="kj kk kl km gt ne nd nf ng aw nh bi"><span id="7b3a" class="mc md it nd b gy ni nj l nk nl">$ k0sctl reset -c cluster.yaml</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h2 id="5258" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">摘要</h2><p id="363c" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">k0s仍然很新，但它发展得非常快。几个版本之前引入的额外的k0sctl工具无疑是一个伟大的举动，因为它隐藏了许多内部复杂性。k0s和k0sctl绝对是两个值得密切关注的有前途的项目。请继续关注未来版本的评论。</p></div></div>    
</body>
</html>