<html>
<head>
<title>Using sourcemaps on production without exposing the source code 🕵️‍</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在不公开源代码的情况下在生产中使用source maps🕵️‍</h1>
<blockquote>原文：<a href="https://itnext.io/using-sourcemaps-on-production-without-revealing-the-source-code-%EF%B8%8F-d41e78e20c89?source=collection_archive---------2-----------------------#2018-06-12">https://itnext.io/using-sourcemaps-on-production-without-revealing-the-source-code-%EF%B8%8F-d41e78e20c89?source=collection_archive---------2-----------------------#2018-06-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e3d4c6fd8ca9ce179342a55baaca910f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQlWyN7jd_d83d_9b_mceg.jpeg"/></div></div></figure><p id="fcee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在大多数web开发人员使用webpack和babel等工具来构建他们的前端代码。它允许编写现代的javascript，同时支持过时的浏览器。但这也是有代价的。你的代码在编译和缩小过程中被大量修改，在生产中几乎不可能调试。</p><p id="2bca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个问题有一个很好的解决方案——<a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map" rel="noopener ugc nofollow" target="_blank">source maps</a>。它允许你调试缩小的代码，就像它没有被修改一样。这不是一个理想的解决方案，但它在大多数情况下是有效的。</p><p id="f40e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用webpack可以很容易地配置Sourcemaps，你所需要做的就是将你的<code class="fe kx ky kz la b">webpack.config.js</code>中的<code class="fe kx ky kz la b"><a class="ae kw" href="https://webpack.js.org/configuration/devtool/" rel="noopener ugc nofollow" target="_blank">devTool</a></code>属性设置为<code class="fe kx ky kz la b">'sourcemap'</code>或<code class="fe kx ky kz la b">'hidden-sourcemap'</code>。听起来很简单，对吧？你可能已经用过了。但是这种方法仍然有一个问题— <strong class="ka ir">源地图需要和精简代码一起上传</strong>,以便浏览器的开发工具可以下载和使用它。</p><p id="cf68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将允许任何访问者调试你的网站，并看到源代码，这并不总是可取的。</p><p id="74b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以做几件事来解决这个问题:</p><ol class=""><li id="d9d3" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">如果您使用的是AWS S3或类似的存储设备，请将资源上传到S3，并使用ACL来限制特定用户对sourcemaps的访问。这种解决方案有一定的局限性，因为如果你在S3上使用CDN，它就不起作用。</li><li id="38e3" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">不要将sourcemaps暴露在互联网上，而是让开发工具从开发人员的机器上加载它们。</li></ol><p id="6f03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">第二种选择对我来说更有趣。在深入研究实现细节之前，让我们回顾一下源地图通常是如何工作的。</p><p id="27b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当babel编译您的javascript代码时，它会生成一个sourcemap文件以及javascript包，这同样适用于minifier (UglifyJS或smth else)。稍后，wepback在生成的javascript文件的末尾添加了一个特殊的pragma，如下所示:</p><pre class="lq lr ls lt gt lu la lv lw aw lx bi"><span id="45d8" class="ly lz iq la b gy ma mb l mc md">//# sourceMappingURL=main.js.map</span></pre><p id="7775" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个pragma帮助浏览器找到特定包的源映射。在这个例子中，url是相对的，所以sourcemap文件应该存储在js包本身的旁边。好消息是我们可以指定一个指向本地开发环境的绝对URL。但是我们怎么做呢？🤔</p><p id="462a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，这并不复杂，但它确实需要一些额外的webpack调优。还记得<code class="fe kx ky kz la b">devTool</code>属性吗？原来它是<code class="fe kx ky kz la b"><a class="ae kw" href="https://webpack.js.org/plugins/source-map-dev-tool-plugin/" rel="noopener ugc nofollow" target="_blank">SourceMapDevToolPlugin</a></code>的简写，可以对源地图生成过程进行更细粒度的控制。这个插件将一个配置对象作为参数，这允许我们指定一个自定义的<code class="fe kx ky kz la b">sourceMappingUrl</code>杂注。因此，我们将使用<code class="fe kx ky kz la b">SourceMapDevToolPlugin</code>代替<code class="fe kx ky kz la b">devTool</code>，就像这样:</p><figure class="lq lr ls lt gt jr"><div class="bz fp l di"><div class="me mf l"/></div></figure><p id="45b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要做的就是:</p><ol class=""><li id="ca32" class="lc ld iq ka b kb kc kf kg kj le kn lf kr lg kv lh li lj lk bi translated">配置CI服务器，将sourcemaps存储为一个工件，您可以在以后下载。</li><li id="654a" class="lc ld iq ka b kb ll kf lm kj ln kn lo kr lp kv lh li lj lk bi translated">启动一个静态http服务器来服务生成的源地图。</li></ol><p id="3d46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来看看这一切是如何协同工作的:</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/1a082eabd252453b34306e70ddb9c044.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*tPH9ZIGtdDUIm9Vi4cvtNg.png"/></div></figure><p id="c06b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是一个可能用法的例子，您可以修改它以适应您的工作流，例如，您可以将这个静态服务器部署在某个地方，并且只能通过内部网络访问。</p><h2 id="06d8" class="ly lz iq bd mh mi mj dn mk ml mm dp mn kj mo mp mq kn mr ms mt kr mu mv mw mx bi translated">主要的好处是，您可以指定加载sourcemaps的url，这允许您在生产中调试简化的应用程序，而无需向外界公开源代码🙂。</h2><p id="3204" class="pw-post-body-paragraph jy jz iq ka b kb my kd ke kf mz kh ki kj na kl km kn nb kp kq kr nc kt ku kv ij bi translated">顺便提一下，还有另一种方法来指定sourcemaps的位置— <a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/SourceMap" rel="noopener ugc nofollow" target="_blank"> SourceMap </a> HTTP header，这在某些情况下也很有用。</p><p id="ee62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我猜，可能有更好的方法来达到同样的结果，但谷歌没有帮我找到它，所以我想出了这个方法，并希望分享它。如果你知道更好的方法，请在评论中告诉我。</p><p id="6ef2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢，祝编码愉快！😉</p></div></div>    
</body>
</html>