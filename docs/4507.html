<html>
<head>
<title>How To Build A GitOps Pipeline On A Stack Of AWS Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AWS服务堆栈上构建GitOps管道</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-a-gitops-pipeline-on-a-stack-of-aws-services-63f7670b5f95?source=collection_archive---------1-----------------------#2020-07-15">https://itnext.io/how-to-build-a-gitops-pipeline-on-a-stack-of-aws-services-63f7670b5f95?source=collection_archive---------1-----------------------#2020-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7c72" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">软件工程</h2><div class=""/><div class=""><h2 id="f768" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用ArgoCD和其他AWS服务，如CodeCommit、CodePipeline、CodeBuild、亚马逊EKS</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/e866e1a73c5335e49394afb581ab064c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81oVjlRcufPVKjZ2kuWXqg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@ffstop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Fotis Fotopoulos </a>在<a class="ae lh" href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="66ff" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在本帖中，我们将探讨如何构建GitOps管道来在亚马逊EKS(弹性Kubernetes服务)上部署应用程序。我们将使用ArgoCD和各种AWS服务，如CodeCommit、CodePipeline、CodeBuild和Amazon Elastic Container Registry(ECR)。</p><blockquote class="me mf mg"><p id="dcc7" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">不久前，我写了一篇关于<a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/gitops-is-powerful-but-is-your-organization-ready-a18288238a21"> GitOps和我们通常会遇到的一些挑战的帖子，以及在采用GitOps </a>之前需要考虑的一些要点。如果你想快速复习，请随意看看。</p><p id="ec90" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">或者，如果您是GitOps的新手，在我们研究这篇文章中更多的实现细节之前，也花几分钟浏览一下这篇文章。</p><p id="1cd3" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">如果你想深入了解，也可以参考<a class="ae lh" href="https://www.weave.works/technologies/gitops/" rel="noopener ugc nofollow" target="_blank"> Weaveworks博客</a>。</p></blockquote></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="6240" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">挑选工具</h1><p id="ea16" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">虽然Kubernetes的GitOps可以通过FluxCD或ArgoCD来实现，但我选择ArgoCD来完成这篇文章，主要是因为ArgoCD有一个直观的GUI，可以帮助以更好的方式交互和理解GitOps模式。对于喜欢CLI胜过GUI的人来说，这不是问题。</p><p id="76f6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">ArgoCD和FluxCD各有优缺点。两支队伍都可能很快缩小差距。我们永远不知道。我在这两方面都不是专家，所以，我将避免进一步进行任何深入的特性比较。</p><p id="f5a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh"> Segue: </em>值得一提的是<a class="ae lh" href="https://github.com/argoproj/gitops-engine" rel="noopener ugc nofollow" target="_blank"> gitops-engine </a>的诞生是为了汇聚各方力量，为gitops社区提供尽可能好的价值。它正在积极开发中，并且发展迅速。让我们拭目以待，直到它可以使用。</p><p id="7444" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关于AWS服务，我们将使用<strong class="lk jd"> AWS CodeCommit </strong>进行代码存储；<strong class="lk jd"> AWS代码管道</strong>为DevSecOps持续集成管道提供结构；<strong class="lk jd"> AWS CloudWatch事件</strong>(现在是Amazon EventBridge的一部分)来触发构建；AWS代码构建来运行构建；<strong class="lk jd">亚马逊ECR </strong>存储Docker图片。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="9dbb" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">管道如何工作</h1><p id="6d31" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">管道架构如下图所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/7979173fa82ec064e9a70ad56350bc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3uqyy6y3Wo4G8BPiY7vwA.png"/></div></div></figure><p id="e071" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">那么，为什么会发生CloudWatch事件呢？</em>我们可以让CodeBuild轮询CodeCommit存储库中的代码变更，并触发构建。是的，但是让我们保持基于事件。我们将在后面的小节中查看事件配置细节。</p><p id="5329" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">为什么有两个CodeCommit存储库？我们将在后面的章节中看到这一点。</em></p><p id="76a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">关键组件ArgoCD operator负责将声明的所需状态配置从Git存储库(CodeCommit)同步到EKS集群。期望的状态可以是任何东西，比如更新的映像版本、Kubernetes部署对象规范、副本数量、端口配置等等。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="0b3a" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">设置亚马逊EKS集群</h1><p id="1313" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">为了简单起见，我不会涉及太多关于提供一个强化的亚马逊EKS集群的细节。在这篇文章中，让我们考虑一个使用类似于<code class="fe nq nr ns nt b">eksctl create cluster -f ../eks-cluster-config.yml</code>的<code class="fe nq nr ns nt b">eksctl</code>命令创建的公共可访问集群，其配置如下所示。或者，您可以使用现有的EKS集群。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="092e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">有关所有支持的配置属性的详细信息，请参考<a class="ae lh" href="https://eksctl.io/usage/schema/" rel="noopener ugc nofollow" target="_blank"> eksctl模式</a>。</p><p id="d3ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">请注意，<code class="fe nq nr ns nt b">eksctl</code>将为EKS集群创建所有必需的AWS服务和组件—专用VPC、子网、安全组、IAM策略等。</p><p id="aef6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在幕后，eksctl创建CloudFormation堆栈。您可以参考堆栈的所有详细信息和资源，如下所示—</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/fe016b43061b11441058ca6215d36564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vDVqE3a6GLfy92pXeKJQwQ.png"/></div></div></figure><blockquote class="me mf mg"><p id="833f" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated"><strong class="lk jd">注意:不要使用可能不符合您特定安全性和合规性要求的集群。</strong></p></blockquote></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="8e95" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">代码提交配置</h1><p id="05d3" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">我已经为这个管道建立了两个AWS CodeCommit存储库。</p><p id="2db0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们是否需要单独的存储库或者单一的存储库就足够了，这是有争议的。根据您的选择，管道工具配置需要相应地调整。</p><p id="1f47" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于这篇文章，我选择使用两个存储库，主要有两个原因:</p><ul class=""><li id="ec45" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">没有直接的方法可以根据特定的文件更改，通过CodePipeline或CodeBuild有条件地触发构建。例如，如果我们将Kubernetes文件放在与应用程序代码相同的存储库中的一个文件夹中，那么即使只在Kubernetes文件中有一个更改，构建过程也会被触发。这可能是不可取的。下面的链接解释了一些解决方法，但对我来说它看起来像是一个黑客。 r <em class="mh">的原因是，如果文件/文件夹名称模式有任何变化，它可能会破坏功能，除非工程师在每次有变化时保持逻辑同步。</em>参考h<a class="ae lh" href="https://aws.amazon.com/blogs/infrastructure-and-automation/how-to-trigger-aws-codebuild-jobs-for-selective-file-changes-in-aws-codecommit/" rel="noopener ugc nofollow" target="_blank">ttps://AWS . Amazon . com/blogs/infra structure-and-automation/how-to-trigger-AWS-code build-jobs-for-selective-file-changes-in-AWS-code commit/</a>。</li><li id="fa25" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md oc od oe of bi translated">独立的存储库有助于保持整洁，对于本文来说，管道配置简单易懂。</li></ul><p id="8d91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="mh"> #1)一个应用程序代码库。</em>T9】</strong></p><p id="65d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个包含以下文件的示例代码库。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/0527653cb4c60a5fd5be07cf84bf7d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96FUa64kp__NLKiuDjPBjA.png"/></div></div></figure><ul class=""><li id="e454" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">Node.js图像的Dockerfile</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="a163" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">server.js运行一个返回HTML页面的简单Node.js web服务器。</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="9ef2" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">AWS CodeBuild项目配置的buildspec.yml。</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="e474" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"><em class="mh"># 2)Kubernetes配置文件的另一个存储库。</em>T13】</strong></p><p id="95a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它有一个包含Node.js docker映像的简单部署规范，以及一个LoadBalancer类型的服务规范来公开部署。</p><p id="d1bf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">您可以根据需要调整设置。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/4221879d75a9fce680d09ff12a22d6f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcEXT8KBcQ5PdmCPa9P-1Q.png"/></div></div></figure><p id="2018" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">deployment.yaml &amp; service.yaml —</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="7b30" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我现在只使用一个副本。因此，滚动更新策略会在终止旧pod之前创建一个新pod。如果我们使用5个副本，一次将更新1个pod。有关部署策略配置的更多详细信息，请参考<a class="ae lh" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/concepts/workloads/controllers/deployment/</a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="a8cb" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">设置Amazon ECR存储库、AWS代码管道、AWS代码构建</h1><p id="f281" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">我使用下面的CloudFormation模板来设置所有需要的AWS组件。它创造了以下资源—</p><ol class=""><li id="0ef9" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md on od oe of bi translated">亚马逊ECR知识库</li><li id="e048" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md on od oe of bi translated">云观察事件规则</li><li id="8d12" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md on od oe of bi translated">代码构建项目</li><li id="c0d9" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md on od oe of bi translated">代码管道</li><li id="1c41" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md on od oe of bi translated">管道工件的S3桶</li><li id="6029" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md on od oe of bi translated">代码构建、代码管道、云观察事件规则的IAM服务角色</li></ol><p id="7205" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果这个模板不适用于您的特定安全标准或管道功能需求，请根据您的需要随意调整它。</p><h2 id="9b95" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">使用CloudWatch事件规则触发代码管道</h2><p id="5a3b" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">AWS CloudBuild使我们能够配置构建触发器，这些触发器可以轮询代码库中的任何更改。但是，我更喜欢基于事件的模型，主要是作为避免不必要的处理开销的最佳实践。</p><p id="0fed" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh"> CloudWatch Events现隶属于</em> <a class="ae lh" href="https://docs.aws.amazon.com/eventbridge/index.html" rel="noopener ugc nofollow" target="_blank"> <em class="mh">亚马逊EventBridge </em> </a> <em class="mh">。EventBridge还可以让我们为整体架构构建未来的可扩展性。</em></p><h2 id="db7b" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">基于拉取请求(PR)合并构建与基于每次提交构建</h2><p id="1e9f" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">在这个模板中，我在CloudWatch事件规则中使用了<code class="fe nq nr ns nt b">pullRequestMergeStatusUpdated</code>事件。而且，构建是为作为拉请求目的地的<code class="fe nq nr ns nt b">master</code>分支配置的。</p><p id="8d6f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">参考<a class="ae lh" href="https://docs.aws.amazon.com/codecommit/latest/userguide/monitoring-events.html#pullRequestMergeStatusUpdated" rel="noopener ugc nofollow" target="_blank">此链接</a>了解可支持的其他事件类型。为了前任。如果你想在每次提交时触发构建，那么你应该使用<code class="fe nq nr ns nt b">referenceUpdated</code>事件类型。</p><p id="798c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">因此，事件配置可能需要根据何时需要触发构建的决策标准进行相应的调整。</em></p><p id="3a1d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在将请求合并到目标分支之前，建议对请求本身运行构建&amp;测试。PR构建可以提供第一级的健全性检查和对交付的代码质量的可见性。您可以进一步探索如何使用CloudWatch事件来自动化PR构建。提示:<code class="fe nq nr ns nt b">pullRequestCreated</code>和<code class="fe nq nr ns nt b">pullRequestSourceBranchUpdated</code>事件。</p><h2 id="85b1" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">云形成模板:</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="e647" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">亚马逊ECR图像扫描</h2><p id="20c4" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">容器静态扫描是DevSecOps管道的关键部分。亚马逊ECR允许扫描某些docker图像类型。可以在将图像推送到存储库时或稍后执行扫描。如果ECR扫描不能满足您的安全需求，可以使用其他第三方工具和服务作为管道的一部分。</p><p id="060d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">a̶l̶t̶h̶o̶u̶g̶h̶̶q̶u̶i̶t̶e̶̶u̶n̶e̶x̶p̶e̶c̶t̶e̶d̶,̶̶c̶l̶o̶u̶d̶f̶o̶r̶m̶a̶t̶i̶o̶n̶̶d̶o̶e̶s̶̶n̶o̶t̶̶s̶u̶p̶p̶o̶r̶t̶̶s̶c̶a̶n̶-̶o̶n̶-̶p̶u̶s̶h̶̶o̶u̶t̶̶o̶f̶̶t̶h̶e̶̶b̶o̶x̶.̶̶i̶f̶̶y̶o̶u̶̶d̶e̶c̶i̶d̶e̶̶t̶o̶̶b̶u̶i̶l̶d̶̶t̶h̶e̶̶e̶c̶r̶̶r̶e̶p̶o̶s̶i̶t̶o̶r̶y̶̶u̶s̶i̶n̶g̶̶t̶e̶r̶r̶a̶f̶o̶r̶m̶̶y̶o̶u̶̶w̶o̶u̶l̶d̶̶n̶o̶t̶̶b̶e̶̶d̶i̶s̶a̶p̶p̶o̶i̶n̶t̶e̶d̶.̶̶t̶e̶r̶r̶a̶f̶o̶r̶m̶̶s̶u̶p̶p̶o̶r̶t̶s̶̶t̶h̶i̶s̶̶o̶p̶t̶i̶o̶n̶.̶</p><blockquote class="me mf mg"><p id="8af8" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">̶t̶h̶e̶r̶e̶̶i̶s̶̶a̶n̶̶o̶p̶e̶n̶̶i̶s̶s̶u̶e̶̶f̶o̶r̶̶c̶l̶o̶u̶d̶f̶o̶r̶m̶a̶t̶i̶o̶n̶̶t̶o̶̶s̶u̶p̶p̶o̶r̶t̶̶i̶t̶,̶̶b̶u̶t̶̶u̶n̶t̶i̶l̶̶t̶h̶e̶n̶,̶̶w̶e̶̶c̶a̶n̶̶e̶i̶t̶h̶e̶r̶̶w̶r̶i̶t̶e̶̶a̶̶c̶u̶s̶t̶o̶m̶̶r̶e̶s̶o̶u̶r̶c̶e̶̶t̶o̶̶a̶c̶h̶i̶e̶v̶e̶̶t̶h̶e̶̶s̶a̶m̶e̶,̶̶o̶r̶̶u̶s̶e̶̶a̶n̶y̶̶o̶t̶h̶e̶r̶̶a̶p̶p̶r̶o̶a̶c̶h̶̶a̶s̶̶y̶o̶u̶̶s̶e̶e̶̶f̶i̶t̶.̶</p></blockquote><div class="oz pa gp gr pb pc"><a href="https://github.com/aws/containers-roadmap/issues/552" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jd gy z fp ph fr fs pi fu fw jc bi translated">[ECR][请求]:ECR漏洞扫描问题#552的云信息集成…</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">解散GitHub是超过5000万开发者的家园，他们一起工作来托管和审查代码，管理项目，以及…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">github.com</p></div></div><div class="pl l"><div class="pm l pn po pp pl pq lb pc"/></div></div></a></div><p id="6fbc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">【更新:CloudFormation现在支持ECR的扫描推送模式。以上门票已关闭。]</p><p id="e645" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在这里使用的图像不是受支持的类型。所以，你会看到<code class="fe nq nr ns nt b">UnsupportedImageError</code>错误。有关图像扫描的相关问题，请参考此链接。</p><div class="oz pa gp gr pb pc"><a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning-troubleshooting.html" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jd gy z fp ph fr fs pi fu fw jc bi translated">图像扫描问题疑难解答</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">以下是常见的图像扫描故障。您可以在Amazon ECR控制台中查看这样的错误，方法是显示…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="73b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是，如果您使用受支持的映像，如果检测到漏洞，您可能会看到如下所示的漏洞报告。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pr"><img src="../Images/3b557ed7ac0c7a23c6703c6e35172ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbleio_4mAV2BvNGHqSd4w.png"/></div></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="8c81" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">ArgoCD配置</h1><p id="0d3b" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">您可以按照我在下面提到的命令进行操作，或者使用下面的文档为您的Kubernetes集群安装和配置ArgoCD。</p><div class="oz pa gp gr pb pc"><a href="https://argoproj.github.io/argo-cd/getting_started/" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jd gy z fp ph fr fs pi fu fw jc bi translated">用于Kubernetes的声明性GitOps CD</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">提示本指南假设您对Argo CD所基于的工具有所了解。请阅读理解…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">argoproj.github.io</p></div></div><div class="pl l"><div class="ps l pn po pp pl pq lb pc"/></div></div></a></div><p id="4d4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在这篇文章中使用了下面的命令。</p><h2 id="bf02" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated"><strong class="ak">安装ArgoCD </strong></h2><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="65b1" class="oo mt it nt b gy px py l pz qa">#Install Argo CD<br/>kubectl create namespace argocd</span><span id="0656" class="oo mt it nt b gy qb py l pz qa">kubectl apply -n argocd -f <a class="ae lh" href="https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</a></span></pre><h2 id="d491" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">安装ArgoCD CLI</h2><p id="a8d3" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">我用的是Linux服务器。查找适用于您的系统的说明。</p><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="ac4d" class="oo mt it nt b gy px py l pz qa">VERSION=$(curl --silent "<a class="ae lh" href="https://api.github.com/repos/argoproj/argo-cd/releases/latest" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/argoproj/argo-cd/releases/latest</a>" | grep '"tag_name"' | sed -E 's/.*"([^"]+)".*/\1/')</span><span id="db5f" class="oo mt it nt b gy qb py l pz qa">sudo curl --silent --location -o /usr/local/bin/argocd <a class="ae lh" href="https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64</a></span><span id="101c" class="oo mt it nt b gy qb py l pz qa">sudo chmod +x /usr/local/bin/argocd</span></pre><h2 id="c4ed" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">公开ArgoCD API服务器</h2><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="9081" class="oo mt it nt b gy px py l pz qa">kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'</span><span id="0c21" class="oo mt it nt b gy qb py l pz qa">export ARGOCD_SERVER=`kubectl get svc argocd-server -n argocd -o json | jq --raw-output .status.loadBalancer.ingress[0].hostname`</span></pre><h2 id="885c" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">登录到服务器</h2><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="83ec" class="oo mt it nt b gy px py l pz qa">ARGO_PWD=`kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2`</span><span id="e320" class="oo mt it nt b gy qb py l pz qa">argocd login $ARGOCD_SERVER --username admin --password $ARGO_PWD --insecure</span><span id="0f6f" class="oo mt it nt b gy qb py l pz qa">#It is better to change the default password.<br/>argocd account update-password</span></pre><h2 id="1f1c" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">创建EKS集群配置</h2><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="89d5" class="oo mt it nt b gy px py l pz qa">CONTEXT_NAME=`kubectl config view -o jsonpath='{.contexts[].name}'`</span><span id="6402" class="oo mt it nt b gy qb py l pz qa">argocd cluster add $CONTEXT_NAME</span></pre><h2 id="413a" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">使用AWS代码提交存储库配置ArgoCD</h2><p id="1852" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">我们可以建立SSH或HTTPS连接。按照以下步骤创建一个SSH连接—</p><ul class=""><li id="8314" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">创建有权访问代码提交的AWS IAM用户。</li><li id="75a8" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md oc od oe of bi translated">使用<code class="fe nq nr ns nt b">ssh-keygen</code>生成一个SSH密钥对。</li><li id="b82c" class="nx ny it lk b ll og lo oh lr oi lv oj lz ok md oc od oe of bi translated">在IAM用户的“安全凭据”部分，上传公钥以设置用户的CodeCommit凭据。这也可以通过AWS CLI来完成。记下密钥ID。我们以后会需要它。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/fdbb3be5bfca1224ff6684fdbf033838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*MYEHcE3QwlLAcdY_2gy5Xw.png"/></div></figure><ul class=""><li id="a37c" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">将CodeCommit证书添加到ArgoCD，这样我们就不必在建立连接时跳过服务器验证。</li></ul><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="fc4d" class="oo mt it nt b gy px py l pz qa">ssh-keyscan git-codecommit.&lt;AWS REGION&gt;.amazonaws.com | argocd cert add-ssh --batch</span></pre><ul class=""><li id="165e" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">将CodeCommit repo添加到ArgoCD服务器。这也可以通过ArgoCD GUI来完成。注意，当我们从CodeCommit复制SSH URL时，它没有SSH密钥ID。因此，我们需要提供上面复制的SSH密钥ID作为存储库URL的一部分。私钥是我们在上面第二步中生成的。</li></ul><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="7aa6" class="oo mt it nt b gy px py l pz qa">argocd repo add ssh://<a class="ae lh" href="mailto:APKA4B2MCB3T3CRIP3ME@git-codecommit.us-east-1.amazonaws.com" rel="noopener ugc nofollow" target="_blank"><strong class="nt jd">&lt;SSH KEY ID&gt;</strong>@git-codecommit.us-east-1.amazonaws.com</a>/v1/repos/gitops-demo-k8s-config --ssh-private-key-path ~/.ssh/123_codecommituser_rsa</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="18b4" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">让我们部署我们的应用程序</h1><p id="6c9f" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">GitOps支持基于拉的方法，而不是通常的基于推的连续部署方法。ArgoCD提供了支持基于推和基于拉的部署的能力。无论哪种方式，部署都是通过ArgoCD操作员进行的。在ArgoCD上下文中，为应用程序启用自动同步使其成为基于拉的模型。并且，手动同步过程使其基于推送。</p><h2 id="b61d" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">在ArgoCD中创建应用程序</h2><p id="4bf2" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">在ArgoCD和CodeCommit之间建立连接后，我们就可以使用ArgoCD在EKS集群上部署应用程序了。</p><ul class=""><li id="950a" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">让我们为应用程序创建一个单独的Kubernetes名称空间。然后，创建应用程序。根据您的要求替换名称空间和应用程序名称。</li></ul><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="8b50" class="oo mt it nt b gy px py l pz qa">kubectl create namespace gitops-demo</span><span id="557a" class="oo mt it nt b gy qb py l pz qa">argocd app create <strong class="nt jd">gitops-demo</strong> --repo ssh://<a class="ae lh" href="mailto:APKA4B2MCB3T3CRIP3ME@git-codecommit.us-east-1.amazonaws.com" rel="noopener ugc nofollow" target="_blank">&lt;SSH KEY ID&gt;@git-codecommit.us-east-1.amazonaws.com</a>/v1/repos/gitops-demo-k8s-config --path ./ --dest-server <a class="ae lh" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a> --dest-namespace <strong class="nt jd">gitops-demo</strong></span></pre><p id="e768" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">接下来:</em>如果您使用HTTPS连接，那么repo URL将类似于<code class="fe nq nr ns nt b"><a class="ae lh" href="https://git-codecommit.us-east-1.amazonaws.com/v1/repos/gitops-demo-k8s-config" rel="noopener ugc nofollow" target="_blank">https://git-codecommit.us-east-1.amazonaws.com/v1/repos/gitops-demo-k8s-config</a></code>，您必须提供IAM用户的用户名和密码。您需要为用户创建相应的凭证。下面是一个可以访问CodeCommit的IAM用户的安全凭据部分的屏幕截图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qd"><img src="../Images/b0a44afa29b5a64e10633b72774b944c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S38Yj2kmbKKRjmQFtKLTyA.png"/></div></div></figure><p id="06ab" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你的Kubernetes文件在一个非根目录下，比如文件夹<code class="fe nq nr ns nt b">k8s-files</code>，那么路径应该是<code class="fe nq nr ns nt b">--path k8s-files</code>而不是<code class="fe nq nr ns nt b">./</code>。如果一个回购下的文件被多个文件夹分割，这将非常方便。</p><p id="ea76" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此时，我们应该在ArgoCD GUI中看到应用程序处于OutOfSync状态，除非我们将同步策略设置为<code class="fe nq nr ns nt b">automated</code>。检查<code class="fe nq nr ns nt b">argocd app create --help</code>下的<code class="fe nq nr ns nt b">--sync-policy, --auto-prune, --self-heal</code>选项。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qe"><img src="../Images/ecc35bf902a7d8606e7250ae5eef0042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SPkJB-66sEFTkfX9Sqbwlg.png"/></div></div></figure><ul class=""><li id="73f5" class="nx ny it lk b ll lm lo lp lr nz lv oa lz ob md oc od oe of bi translated">使用以下命令或ArgoCD GUI本身同步应用程序状态。</li></ul><pre class="ks kt ku kv gt pt nt pu pv aw pw bi"><span id="1a67" class="oo mt it nt b gy px py l pz qa">argocd app sync gitops-demo</span></pre><p id="5fb7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦同步完成，我们可以在ArgoCD GUI中看到状态，Kubernetes对象也成功创建。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qf"><img src="../Images/4304db8f70ffa1dec80507608c2b7b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SReub1_VNedwdu_Z9CvQZg.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qg"><img src="../Images/1a9c005062c9a6919a1ce59320ccb6d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qV-eO-GgkpRYwIFzmH08Fg.png"/></div></div></figure><p id="0c0c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在检查AWS负载平衡器URL时，我们得到一个亮蓝色的页面。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qh"><img src="../Images/c9d5cd0e8ba9c04da1314e83987bb559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMMdr4rAsiRl4Aa2gnai8Q.png"/></div></div></figure><p id="529f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">任务完成！！</p><h2 id="ba78" class="oo mt it bd mu op oq dn my or os dp nc lr ot ou ne lv ov ow ng lz ox oy ni iz bi translated">现在更新怎么样？</h2><p id="0648" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">不确定蓝色是否好看。我们换个颜色吧！</p><p id="c800" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">能否在server.js中改变颜色，创建一个新的docker镜像，ArgoCD会部署这个新镜像吗？不完全是。</p><blockquote class="me mf mg"><p id="b0c6" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">这是FluxCD战胜ArgoCD的一个领域。</p></blockquote><p id="54c8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">FluxCD可以监控映像库，并使用新映像自动更新部署。有一个功能增强请求，但是在撰写本文时它仍然是开放的。参考—</p><div class="oz pa gp gr pb pc"><a href="https://github.com/argoproj/argo-cd/issues/1648" rel="noopener  ugc nofollow" target="_blank"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jd gy z fp ph fr fs pi fu fw jc bi translated">图像标签更新问题#1648 argoproj/argo-cd</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">Weave Flux的一个很好的特性是能够监控docker图像报告以发布新图像…</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">github.com</p></div></div><div class="pl l"><div class="qi l pn po pp pl pq lb pc"/></div></div></a></div><p id="47e9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">到今天为止，ArgoCD对这个问题有不同的观点。请将此评论作为上述已创建问题的一部分阅读:<a class="ae lh" href="https://github.com/argoproj/argo-cd/issues/1648#issuecomment-546006238" rel="noopener ugc nofollow" target="_blank">https://github . com/argoproj/Argo-CD/issues/1648 # issue comment-546006238</a></p><p id="07a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh"> ArgoCD检测为应用程序定义的路径下的任何Git更改。因此，更新清单文件就可以了。</em></p><p id="1783" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">那么，我们需要做些什么来改变颜色呢？我们需要更新颜色并提交代码。CodePipeline将被触发来构建新图像并将其上传到ECR。假设我们将颜色改为<code class="fe nq nr ns nt b">background-color: lightskyblue</code>。</em></p><p id="c098" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，我们可以使用这些注释中列出的步骤更新部署规范中的映像<a class="ae lh" href="https://github.com/argoproj/argo-cd/issues/1648#issuecomment-546006238" rel="noopener ugc nofollow" target="_blank">https://github . com/Argo proj/Argo-CD/issues/1648 # issue comment-546006238</a>，或者任何适合您的类似方法。</p><p id="2ff7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，新图像可以同步到ArgoCD。在这个阶段，我们可以在同步状态之前看到ArgoCD中的差异。如果自动同步已使能，我们无需担心这一部分。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qj"><img src="../Images/c12de19e8dd65bbe5850a7a9c0affff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LxoS2eLhGomE9if7VzCaaQ.png"/></div></div></figure><p id="4004" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦同步，瞧！我们得到了具有新颜色的新部署的图像。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi qk"><img src="../Images/b6e45db1cd548fc773eed408955a6831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TamsI92oWTucXs0z4jsLWA.png"/></div></div></figure></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="11bd" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">包扎</h1><p id="8e69" class="pw-post-body-paragraph li lj it lk b ll nk kd ln lo nl kg lq lr nm lt lu lv nn lx ly lz no mb mc md im bi translated">因此，我们已经看到了如何在完整的AWS服务堆栈上构建GitOps管道。</p><p id="ce96" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GitOps模式不要求使用任何特定的工具。基本原则是在基于Git的存储库中定义期望的集群状态(真实的来源),并让操作者(ArgoCD/FluxCD)按照期望的方式维护集群状态。</p><p id="38fb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然我们使用ArgoCD创建了这个管道，但是我也强烈推荐探索FluxCD。</p><p id="69a5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">FluxCD有一个不同的架构，对GitOps采取了稍微不同的方法。正如我前面提到的，它可以监控映像存储库的任何更新，并相应地同步部署。</p><p id="58b9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">它究竟是优势还是风险因素还存在争议。这将取决于各种因素，如团队的成熟度、职责分离和其他企业准则。</p><p id="474c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在另一篇文章中，我试图介绍GitOps的一些方面(优势和挑战)。如果觉得有用，请随意探讨。</p><div class="oz pa gp gr pb pc"><a rel="noopener  ugc nofollow" target="_blank" href="/gitops-is-powerful-but-is-your-organization-ready-a18288238a21"><div class="pd ab fo"><div class="pe ab pf cl cj pg"><h2 class="bd jd gy z fp ph fr fs pi fu fw jc bi translated">GitOps功能强大；但是，您的组织准备好了吗？</h2><div class="pj l"><h3 class="bd b gy z fp ph fr fs pi fu fw dk translated">GitOps为什么强大？采用GitOps之前的主要考虑事项。</h3></div><div class="pk l"><p class="bd b dl z fp ph fr fs pi fu fw dk translated">itnext.io</p></div></div><div class="pl l"><div class="ql l pn po pp pl pq lb pc"/></div></div></a></div></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><p id="d2d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="mh">关注我</em><a class="ae lh" href="https://www.linkedin.com/in/bideep/" rel="noopener ugc nofollow" target="_blank"><em class="mh">LinkedIn</em></a><em class="mh">，</em><a class="ae lh" href="https://twitter.com/bbideep" rel="noopener ugc nofollow" target="_blank"><em class="mh">Twitter</em></a><em class="mh">。</em></p><p id="ed99" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://bbideep.medium.com/subscribe" rel="noopener"> <em class="mh">订阅上媒</em> </a> <em class="mh">获取更多此类帖子。</em></p></div></div>    
</body>
</html>