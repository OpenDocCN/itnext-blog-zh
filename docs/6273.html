<html>
<head>
<title>Flutter-Dart Cron Jobs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">飞镖克朗乔布斯</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-dart-cron-jobs-90fa065ba8d2?source=collection_archive---------2-----------------------#2021-10-05">https://itnext.io/flutter-dart-cron-jobs-90fa065ba8d2?source=collection_archive---------2-----------------------#2021-10-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8b0bdf7df75649e17b4e47054853e694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJuNJ-FOxMMjHwZH_KRfOA.png"/></div></div></figure><p id="e6f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时我们需要运行定期操作，无论是在前端还是后端。</p><p id="06a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">包<code class="fe kw kx ky kz b"><a class="ae la" href="https://pub.dev/packages/style_cron_job" rel="noopener ugc nofollow" target="_blank">style_cron_job</a></code>为您的作业提供了简单的语法和执行器。</p><p id="4fe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于<code class="fe kw kx ky kz b">second</code>、<code class="fe kw kx ky kz b">minute</code>、<code class="fe kw kx ky kz b">hour</code>、<code class="fe kw kx ky kz b">day</code>、<code class="fe kw kx ky kz b">week</code>和<code class="fe kw kx ky kz b">month</code>时计，您可以指定“y时间内每个x”或“y时间内每个x”等时间段。</p><p id="8871" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用<code class="fe kw kx ky kz b">only</code>添加自定义条件</p><p id="c86c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并控制<code class="fe kw kx ky kz b">CronJobController</code>中的所有作业</p><h1 id="7873" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">开始第一项工作</h1><p id="adbd" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated"><em class="me">除了13秒，每隔一秒说一声你好。秒</em></p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="3c88" class="mn lc iq kz b gy mo mp l mq mr">every.x(3).second.only((t) =&gt; t.second != 13).listen((time) {<br/>  print("Hello World!");<br/>});</span></pre><h1 id="894e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用</h1><p id="7d19" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">将<a class="ae la" href="https://pub.dev/packages/style_cron_job" rel="noopener ugc nofollow" target="_blank">包</a>添加到您的pubspec.yaml</p><p id="9d2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开始定义周期有两种不同的选项:<code class="fe kw kx ky kz b">each</code>、<code class="fe kw kx ky kz b">every</code>。<br/> <br/> <code class="fe kw kx ky kz b">each</code>用于各月、周、日、时、分、秒。<br/> <code class="fe kw kx ky kz b">every</code>用于每3天一次、每2个月一次等需求。</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="bd31" class="mn lc iq kz b gy mo mp l mq mr">each.**<br/>every.x(3).**</span></pre><p id="3fd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">**</code>必须是<code class="fe kw kx ky kz b">month</code>，<code class="fe kw kx ky kz b">week</code>，<code class="fe kw kx ky kz b">day</code>，<code class="fe kw kx ky kz b">hour</code>，<code class="fe kw kx ky kz b">minute</code>，<code class="fe kw kx ky kz b">second</code>两者都有，</p><blockquote class="ms mt mu"><p id="67bb" class="jy jz me ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated">每天的示例:<code class="fe kw kx ky kz b">each.day..;</code></p><p id="7571" class="jy jz me ka b kb kc kd ke kf kg kh ki mv kk kl km mw ko kp kq mx ks kt ku kv ij bi translated">每3分钟一次:<code class="fe kw kx ky kz b">every.x(3).minute..;</code></p></blockquote><h2 id="5871" class="mn lc iq bd ld my mz dn lh na nb dp ll kj nc nd lp kn ne nf lt kr ng nh lx ni bi translated">可以指定钟表的子分段</h2><p id="44d7" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">例如<code class="fe kw kx ky kz b">Each day ay 10:20:30</code></p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="4edd" class="mn lc iq kz b gy mo mp l mq mr">each.day.atHour(10).atMinute(20).atSecond(30);</span></pre><p id="3985" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者当时</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="055b" class="mn lc iq kz b gy mo mp l mq mr">each.day.fromNowOn(DateTime(1970 , 1 , 1 , 10 , 20 , 30));</span></pre><h2 id="6943" class="mn lc iq bd ld my mz dn lh na nb dp ll kj nc nd lp kn ne nf lt kr ng nh lx ni bi translated">添加自定义条件</h2><p id="6747" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">每天10:20，星期日除外</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="15f5" class="mn lc iq kz b gy mo mp l mq mr">each.day.atHour(10).atMinute(20).only((time) {  <br/>  return time.weekday != 7; // except sunday<br/>});</span></pre><h2 id="f7e9" class="mn lc iq bd ld my mz dn lh na nb dp ll kj nc nd lp kn ne nf lt kr ng nh lx ni bi translated">开始倾听</h2><p id="7a28" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">倾听有四种方式</p><ol class=""><li id="8ea6" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv no np nq nr bi translated">创建一个流</li></ol><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="2344" class="mn lc iq kz b gy mo mp l mq mr">var stream = each.minute.fromNowOn().asStream();<br/>// eg starting 00:10:38<br/>stream.listen((time){<br/>   // Do on each minute on 38. second<br/>});<br/>// Don't forget<br/>stream.cancel();</span></pre><p id="357f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.直接听</p><p id="c3b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与流相同</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="5159" class="mn lc iq kz b gy mo mp l mq mr">var period = each.day.onMinute(10);<br/>period.listen((t) {  <br/>    // do on each day 00:10<br/>});<br/>period.dispose();</span></pre><p id="d0b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.控制器</p><p id="bd8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">控制器用单个流管理所有操作。所以这是最有效的使用方式。</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="5aa5" class="mn lc iq kz b gy mo mp l mq mr">var runner = CronJobController();</span><span id="734b" class="mn lc iq kz b gy ns mp l mq mr">runner.add(each.second.asRunner((time) {  <br/>  // Do on each second<br/>}));<br/>runner.add(every.x(10).second.asRunner((time) {  <br/>  // Do on every 10 seconds<br/>}));<br/><br/>// Start<br/>runner.start();</span></pre><p id="5aec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.习俗</p><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="3355" class="mn lc iq kz b gy mo mp l mq mr">var period = each.second.period;<br/>var necessary = period.isNecessary(DateTime.now());<br/>if (necessary) {<br/>   // Do<br/>}</span></pre><p id="b61d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用法示例</p><ul class=""><li id="4fe8" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每3分钟</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="f5b9" class="mn lc iq kz b gy mo mp l mq mr">every.x(3).minute</span></pre><ul class=""><li id="433d" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每10秒钟</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="d630" class="mn lc iq kz b gy mo mp l mq mr">every.x(10).second</span></pre><ul class=""><li id="9379" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每30分钟一次。第二</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="4f06" class="mn lc iq kz b gy mo mp l mq mr">each.minute.atSecond(30)</span></pre><ul class=""><li id="957d" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每周周六23:45(晚上11:45)</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="97a8" class="mn lc iq kz b gy mo mp l mq mr">each.week.onWeekDay(6).atHour(23).atMinute(45);</span></pre><ul class=""><li id="7348" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每周一09:00</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="9808" class="mn lc iq kz b gy mo mp l mq mr">each.week.onWeekDay(1).atHour(9);</span></pre><ul class=""><li id="6edd" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每月15日09:00</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="9ed5" class="mn lc iq kz b gy mo mp l mq mr">each.month.onDay(15).atHour(9);</span></pre><ul class=""><li id="56cc" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv nt np nq nr bi translated">每3天一次，时间为00:00:59</li></ul><pre class="mf mg mh mi gt mj kz mk ml aw mm bi"><span id="06bb" class="mn lc iq kz b gy mo mp l mq mr">every.x(3).day.atSecond(59);</span></pre></div></div>    
</body>
</html>