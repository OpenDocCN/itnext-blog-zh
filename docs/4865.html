<html>
<head>
<title>Angular Testing Series: How to add Jest to Angular project smoothly?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度测试系列:如何顺利给角度项目添加Jest？</h1>
<blockquote>原文：<a href="https://itnext.io/angular-testing-series-how-to-add-jest-to-angular-project-smoothly-afffd77cc1cb?source=collection_archive---------0-----------------------#2020-10-10">https://itnext.io/angular-testing-series-how-to-add-jest-to-angular-project-smoothly-afffd77cc1cb?source=collection_archive---------0-----------------------#2020-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="10f9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在Angular项目中加入Jest，为什么要考虑？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/a946a8525798a4c96ff127e99ecd2d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*E0AcUvRIImi5GxeuChvNRw.jpeg"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">照片由<a class="ae kr" href="https://unsplash.com/@nci?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">国家癌症研究所</a>在<a class="ae kr" href="https://unsplash.com/s/photos/testing?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9bd6" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">当我们有机会从一开始就参与一个有角度的项目时，我们可能会对许多架构方面产生影响。其中一个方面是选择合适的技术和测试工具。在过多的项目中，Angular附带的标准工具被使用:<a class="ae kr" href="https://karma-runner.github.io/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Karma </a>和<a class="ae kr" href="https://jasmine.github.io/" rel="noopener ugc nofollow" target="_blank"> Jasmine </a>。</p><p id="a8e5" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然而，重要的是要认识到，测试运行程序的选择并不仅限于因果报应。出于某些原因，对笑话感兴趣是值得的。</p><h2 id="6a61" class="lo lp iq bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">Jest给你的项目带来了哪些可能的好处？📘</h2><ul class=""><li id="2352" class="mh mi iq ku b kv mj ky mk lb ml lf mm lj mn ln mo mp mq mr bi translated">更快的体验和开箱即用的并行测试</li><li id="a73a" class="mh mi iq ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">Jest CLI提供的支持工作效率的各种功能</li><li id="9af5" class="mh mi iq ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">简单的伪装、侦察和嘲弄</li><li id="fbbb" class="mh mi iq ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">内置断言和代码覆盖率</li><li id="c1c2" class="mh mi iq ku b kv ms ky mt lb mu lf mv lj mw ln mo mp mq mr bi translated">类型脚本支持</li></ul><p id="03d2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">…老实说，你可以在<a class="ae kr" href="https://jestjs.io/docs/en/getting-started" rel="noopener ugc nofollow" target="_blank">文档</a>中读到更多的功能。现在，让我们把重点放在实际的方面和目的上，这是给你的角度项目添加笑话。</p><h2 id="d6d0" class="lo lp iq bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">安装所有必需的依赖项🌱</h2><p id="9f1f" class="pw-post-body-paragraph ks kt iq ku b kv mj jr kx ky mk ju la lb mx ld le lf my lh li lj mz ll lm ln ij bi translated">如果您选择<code class="fe na nb nc nd b">npm</code>作为项目中的包管理器</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="5852" class="lo lp iq nd b gy ni nj l nk nl">npm install jest jest-preset-angular @types/jest --save-dev</span></pre><p id="88bc" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">或者<code class="fe na nb nc nd b">yarn</code>是否是你在项目中的选择</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="4237" class="lo lp iq nd b gy ni nj l nk nl">yarn add jest jest-preset-angular @types/jest --dev</span></pre><h2 id="44ff" class="lo lp iq bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">创建基本配置🚧</h2><p id="3547" class="pw-post-body-paragraph ks kt iq ku b kv mj jr kx ky mk ju la lb mx ld le lf my lh li lj mz ll lm ln ij bi translated">让我们在你的项目目录下创建<code class="fe na nb nc nd b">jest.config.js</code>文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="279f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">或者，您可以在<code class="fe na nb nc nd b">package.json</code>中提供上述配置。</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="7a02" class="lo lp iq nd b gy ni nj l nk nl">{<br/>  "jest": {<br/>    "preset": "jest-preset-angular",<br/>    "roots": ["&lt;rootDir&gt;/src/"],<br/>    ....<br/> }<br/>}</span></pre><p id="88f0" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">但是我不喜欢给<code class="fe na nb nc nd b">package.json</code>增加所有的配置。这不是一个可扩展的解决方案，随着向项目中添加其他功能，它可能会变成一种混乱的方式。</p><p id="6f03" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">然后，找到<code class="fe na nb nc nd b">&lt;root-dir&gt;/src/test.ts</code>文件，并用下面的代码完全替换它的内容</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="817b" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">在第一(1)行，我们导入适当的“jest-preset-angular”库。其余的需要能够使用Jest附带的<a class="ae kr" href="https://github.com/jsdom/jsdom" rel="noopener ugc nofollow" target="_blank"> JSDOM </a>。</p><p id="8c4c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后一件事，你需要做的是修改小<code class="fe na nb nc nd b">tsconfig.spec.json</code>文件</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="d5d7" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">第(6)行是避免以下警告所必需的</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="063c" class="lo lp iq nd b gy ni nj l nk nl">If you have issues related to imports, you should consider setting `esModuleInterop` to `true` in your TypeScript configuration file (usually `tsconfig.json`).</span></pre><p id="3e9c" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">Jest运行时中的元数据反射需要第(7)行</p><blockquote class="no"><p id="47dc" class="np nq iq bd nr ns nt nu nv nw nx ln dk translated"><a class="ae kr" href="https://twitter.com/marcin_milewicz" rel="noopener ugc nofollow" target="_blank">如果你想了解新的伟大的角度和前端的东西，请在Twitter上关注我</a>!😄</p></blockquote><h2 id="a332" class="lo lp iq bd lq lr ny dn lt lu nz dp lw lb oa ly lz lf ob mb mc lj oc me mf mg bi translated">用Jest runner运行测试🚗</h2><p id="f7a3" class="pw-post-body-paragraph ks kt iq ku b kv mj jr kx ky mk ju la lb mx ld le lf my lh li lj mz ll lm ln ij bi translated">只需输入命令行<code class="fe na nb nc nd b">jest</code>，如果一切都设置正确，Jest执行测试套装并准备报告</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi od"><img src="../Images/3ea05729effb13d66cb236e2f0094016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*joTnRPxjIc9wYG6CdU38KA.png"/></div></div></figure><p id="d3fe" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">而且，覆盖率作为内置功能是在<code class="fe na nb nc nd b">./coverage</code>目录下生成的</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi oi"><img src="../Images/d49997237f60399655771f776d7851f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*FpTWu2HhOao2TYIAchDQoA.png"/></div></div></figure><p id="3973" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">当您在浏览器中打开<code class="fe na nb nc nd b">index.html</code>文件时，您会看到关于项目代码覆盖率的基本报告</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="oe of di og bf oh"><div class="gh gi oj"><img src="../Images/9493ba542a81e8d6196577daa0e6059e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frU08A6e0frL6PhD8wGCMg.png"/></div></div></figure><h2 id="3e45" class="lo lp iq bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">移除Karma runner🍂</h2><p id="efe6" class="pw-post-body-paragraph ks kt iq ku b kv mj jr kx ky mk ju la lb mx ld le lf my lh li lj mz ll lm ln ij bi translated">最后，同样重要的是，在引入改进之后，保持项目的整洁。如果Jest成为我们Angular项目的主要测试者，就不再需要Karma了。我们可以用一种简单的方式做到这一点</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="4502" class="lo lp iq nd b gy ni nj l nk nl">npm uninstall karma karma-chrome-launcher karma-coverage-istanbul-reporter karma-jasmine karma-jasmine-html-reporter</span></pre><p id="bf21" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">或者<code class="fe na nb nc nd b">yarn</code>是否是你在项目中的选择</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="61b8" class="lo lp iq nd b gy ni nj l nk nl">yarn remove karma karma-chrome-launcher karma-coverage-istanbul-reporter karma-jasmine karma-jasmine-html-reporter</span></pre><p id="c2a2" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">默认情况下，Angular使用Karma通过在<code class="fe na nb nc nd b">angular.json</code>文件的<code class="fe na nb nc nd b">architect</code>部分配置适当的<code class="fe na nb nc nd b">builder</code>来执行测试。现在，它可以被删除，因为不再使用。</p><pre class="kg kh ki kj gt ne nd nf ng aw nh bi"><span id="bf27" class="lo lp iq nd b gy ni nj l nk nl">"test": {<br/>  "builder": "@angular-devkit/build-angular:karma",<br/>  "options": {<br/>    "main": "src/test.ts",<br/>    "polyfills": "src/polyfills.ts",<br/>    "tsConfig": "tsconfig.spec.json",<br/>    "karmaConfig": "karma.conf.js",<br/>    "assets": [<br/>      "src/favicon.ico",<br/>      "src/assets"<br/>    ],<br/>    "styles": [<br/>      "src/styles.scss"<br/>    ],<br/>    "scripts": []<br/>  }<br/>}, // REMOVE ALL "test" section</span></pre><p id="5c48" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">请记住，如果您之前使用了<code class="fe na nb nc nd b">ng test</code>命令来运行您的测试，那么这个命令将不再可用。现在，您的测试将由<code class="fe na nb nc nd b">jest</code>命令启动。</p><p id="213f" class="pw-post-body-paragraph ks kt iq ku b kv kw jr kx ky kz ju la lb lc ld le lf lg lh li lj lk ll lm ln ij bi translated">最后一步是<code class="fe na nb nc nd b">karma.conf.js</code>文件删除</p><h2 id="98d3" class="lo lp iq bd lq lr ls dn lt lu lv dp lw lb lx ly lz lf ma mb mc lj md me mf mg bi translated">例子📕</h2><p id="13ee" class="pw-post-body-paragraph ks kt iq ku b kv mj jr kx ky mk ju la lb mx ld le lf my lh li lj mz ll lm ln ij bi translated">我已经将上述所有步骤包含在一个专门准备的存储库中。请随意检查并尝试Jest如何与Angular集成。</p><div class="ok ol gp gr om on"><a href="https://github.com/marcinmilewicz/angular-testing/tree/1-Add-Jest" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">marcinmilewicz/角度测试</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb kl on"/></div></div></a></div><blockquote class="no"><p id="af26" class="np nq iq bd nr ns pc pd pe pf pg ln dk translated"><a class="ae kr" href="https://twitter.com/marcin_milewicz" rel="noopener ugc nofollow" target="_blank">如果你想了解新的伟大的角度和前端的东西，请在Twitter上关注我</a>！😄</p></blockquote><h1 id="e558" class="ph lp iq bd lq pi pj pk lt pl pm pn lw jw po jx lz jz pp ka mc kc pq kd mf pr bi translated">角度测试系列</h1><blockquote class="no"><p id="5a4e" class="np nq iq bd nr ns nt nu nv nw nx ln dk translated">本文是角度测试系列的一部分，该系列收集了在角度框架中进行测试的有用技巧。这是该系列的第一篇就职文章，所以我将非常感谢您的反馈。不要犹豫，留下你喜欢或不喜欢的评论。</p><p id="6bc9" class="np nq iq bd nr ns nt nu nv nw nx ln dk translated">如果您能告诉我您对角度测试的惊愕是什么，我将不胜感激，并且我将很乐意准备一个实用的解决方案来帮助您。</p></blockquote></div></div>    
</body>
</html>