<html>
<head>
<title>THE CHRISTMAS MACHINE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">圣诞机器</h1>
<blockquote>原文：<a href="https://itnext.io/the-christmas-machine-fca7184cbe50?source=collection_archive---------2-----------------------#2020-12-16">https://itnext.io/the-christmas-machine-fca7184cbe50?source=collection_archive---------2-----------------------#2020-12-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="87c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个MIDI驱动的交流灯光控制器建立在一个树莓派和几个有问题的布线决定</h2></div><p id="5e7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我妻子非常喜欢节日装饰品。她非常喜欢圣诞灯。随着音乐舞动的圣诞灯？合法的狗屁。大约12年前，她告诉我，她的梦想是有一天能让舞动的圣诞彩灯配上音乐。当时我们住在一个公寓里，没有真正的外部空间来装饰这些东西，但它确实让我思考了一下。我当时已经开始粗略地组合这种方法，但当时有很多障碍，真的挫伤了我完成它的热情，尤其是我讨厌从头开始布线交流组件，可能会烧毁一套甚至没有装饰空间的公寓。</p><p id="fbc2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然它的硬件方面确实让我因为害怕火灾而犹豫不决，但这在当时至少是一个相当解决的问题:使用继电器控制简单的交流电路是一个非常简单的命题:一边是低压，另一边是高压。如果你有什么东西可以点亮GPIO引脚，你可以打开/关闭交流开关。当谈到灯光表演时，真正的婊子是想出一种用户友好的方式来排序这个过程，而不是拔你的头发。我一直认为MIDI是最好的解决方案，即使它并不是MIDI的本意，但是多年来我的整个方法都在发展，直到我最终完成了这个东西。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="1550" class="li lj iq bd lk ll lm ln lo lp lq lr ls jw lt jx lu jz lv ka lw kc lx kd ly lz bi translated">迷迪</h1><p id="7bf9" class="pw-post-body-paragraph kf kg iq kh b ki ma jr kk kl mb ju kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">如果你不熟悉MIDI，它代表“乐器数字接口”这是一个在兼容系统之间发送数据的非常简单的系统。例如，它可以让您将键盘(音乐键盘，而不是PC键盘)连接到合成器并控制它们。最简单的方式是通过串行连接发送编码信息，包括时间戳、音符信息和“音符开/关”数据。因此，如果你把手指放在键盘上的一个中C音符上，你的合成器会知道演奏中C，当你把手指从那个音符上拿开时，你的合成器会知道停止演奏。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/50b5bd3f319616b05885499f7d228d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*ShKsI26EMya8BJR7j5wBmg.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">显示MIDI-OX中采集的实时MIDI数据的监视器</figcaption></figure><p id="973a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然MIDI在技术上是用于音乐而不是硬件控制的，但不难看出它拥有硬件控制所需的一切。通过将音符映射到您想要二进制(开/关)控制的设备，MIDI为您提供了一个简单、低延迟的控制协议，可以快速调整以控制灯光。</p><p id="4eda" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，敏锐的读者可能会认为DMX更适合这一点，因为DMX是专门用于照明的类似标准。如果你已经注意到了，那你就没有错。使用DMX可能很容易做到这一点。我对DMX一无所知，但我对MIDI一窍不通，所以我们来了。更重要的是，我12年前的目标是能够用WAV/MP3音频按时间顺序排列灯光，使用MIDI似乎是用我已有的软件实现这一目标的最直观的方式。对于这个圣诞机器的构建，我一直使用一个名为Reason的音乐制作软件套件来给灯光排序，当我这样做时，它看起来像这样:</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/30cfe0ec2c675e84e038dc6af501e56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xWwYqWUOunG-Iv2Yt2hLGg.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">合理的轻排序</figcaption></figure><p id="f3d2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这张图片中，你可以看到我是如何排列灯光的:每个“音符”对应于树莓Pi上的一个GPIO引脚。顶道有一个“铃儿响叮当”的WAV文件，我基本上只是及时绘制区块，以配合歌曲的变化。这有点乏味，但总比用python手工编写时间延迟要好。此外，这是一个我非常熟悉的界面，所以我可以喝几杯啤酒就能上手。</p><p id="6fa6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我12年前最初设想使用MIDI时，我的计划是通过有线MIDI连接来实现，基本上是将MIDI输出从我的笔记本电脑(使用USB到5针MIDI接口)连接到类似Arduino的黑客串行连接。这是可以做到的，但是你需要更多的电缆。</p><h1 id="62e3" class="li lj iq bd lk ll mw ln lo lp mx lr ls jw my jx lu jz mz ka lw kc na kd ly lz bi translated">RTP-MIDI拯救世界</h1><p id="4945" class="pw-post-body-paragraph kf kg iq kh b ki ma jr kk kl mb ju kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">就像我提到的，已经12年了。从那以后，很多事情都变了。我们最近买了一栋房子，它有很大的外部装饰面积。此外，如果我用劣质交流电线点火，那是我的问题。我决定重新审视这个项目。</p><p id="6030" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在十多年后选择一个乏味的技术项目的一个好处是，随着时间的推移，许多瓶颈和约束会自行解决。当我第一次把这种方法放在一起时，我假设我需要运行一个硬连线的串行连接来处理MIDI，完全知道MIDI-over-network (RTP-MIDI)是一个更好的选择。那时候，通过网络接收MIDI并不划算，基本上需要一台专用电脑来接收信号。当我决定再次选择这个项目时，我想我应该四处看看是否有Raspberry Pi的RTP-MIDI实现。让我非常高兴的是，有这样一个人。pymidi是一个特别为Raspberry Pi编写的非常简单的python RTP-MIDI服务器实现，正是我一直在寻找的。它打包了一个样本事件处理程序，通过一点粗略的python和用于引脚控制的<a class="ae nb" href="https://gpiozero.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank"> gpiozero </a>，我能够将传入的音符开/音符关消息映射到引脚开/引脚关控制。</p><p id="2c4d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那里，我安装了<a class="ae nb" href="https://www.tobias-erichsen.de/software/rtpmidi.html" rel="noopener ugc nofollow" target="_blank"> rtpMIDI </a>，这是一个虚拟的MIDI驱动程序，允许你以低延迟将任何MIDI输出从任何Windows软件MIDI-out传输到你网络上的任何东西。pymidi位于Raspberry Pi上监听midi数据，rtpMIDI位于Windows计算机上，将MIDI数据路由到pymidi。这是一个很好的结合。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/e1a206c839cf6280d32891b8e9ec358f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*DKliByL5cMz23DdoBFiVSw.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">rtpMIDI —将灯光序列直接传输到您的树莓Pi</figcaption></figure><p id="af28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:Mac支持开箱即用的网络MIDI，所以如果你是Mac用户就不需要安装rtpMIDI。我也一直在试图寻找和测试一个linux兼容的解决方案，因为我希望能够得到一个端到端的免费解决方案。</p><h1 id="e7d1" class="li lj iq bd lk ll mw ln lo lp mx lr ls jw my jx lu jz mz ka lw kc na kd ly lz bi translated">五金器具</h1><p id="71a4" class="pw-post-body-paragraph kf kg iq kh b ki ma jr kk kl mb ju kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">当我用交流电源工作时，我真的很紧张，因为我完全意识到我不是很聪明，也没有注意力持续时间。为此，我会建议你不要做我所做的任何事情，也不要假设我所做的任何事情是安全或合理的。在交流电源上出错会害死你，烧掉你的房子。妈的，即使你做的一切都是正确的，你仍然可以用交流电杀死自己。</p><p id="5afb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我怀疑我所做的一切是代码，甚至是合法的。</p><p id="6924" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是既然你已经做到了这一步，我要指出我发现了这个非常详细的记录，我把它作为一个起点:</p><div class="nd ne gp gr nf ng"><a href="https://twosortoftechguys.wordpress.com/2018/08/13/how-we-made-a-raspberry-pi-controlled-8-outlet-power-box/" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">我们如何制作树莓Pi控制的8插座电源盒</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">Raspberry PI你有没有想过能够通过你的局域网或者互联网来控制交流电源插座？我们…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">twosortoftechguys.wordpress.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ml ng"/></div></div></a></div><p id="5ad3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">基本上，我从一个Raspberry Pi 3b、几个8继电器板、一吨电线和一盒交流插座开始，并连接了硬件。</p><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nv"><img src="../Images/79a737a5b79fd5abbdc589480915b01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqfpU2qDP1cdIH_a9PRbMg.jpeg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">我构建的前半部分，八个通道。</figcaption></figure><p id="be7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我的构建与我所链接的文章中的构建之间的一个区别是，我对大多数接线使用了端子板，这减少了我必须使用的粗略接线螺母连接的数量，并且可以说使其更容易扩展。我从亚马逊购买了几套这样的模块和跳线，基本上用来创建一条接地总线、一条中性总线和一条“热”总线，使交流连接更容易管理，并分配到它们需要触及的各个触点:</p><div class="nd ne gp gr nf ng"><a href="https://www.amazon.com/gp/product/B08D3J19FT/ref=ppx_yo_dt_b_asin_title_o03_s00?ie=UTF8&amp;psc=1" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd ir gy z fp nl fr fs nm fu fw ip bi translated">FIXITOK 6套端子板，4/5/6位置600V 15A双排螺丝端子板，带400V…</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">FIXITOK 6套端子板，4/5/6位置600V 15A双排螺丝端子板，带400V 15A预绝缘…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">www.amazon.com</p></div></div><div class="np l"><div class="nw l nr ns nt np nu ml ng"/></div></div></a></div><figure class="mg mh mi mj gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nx"><img src="../Images/ea7f306e6e29300d499017010c2aad51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkTzQdqPfs0FlRPcRUl_zA.jpeg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">我的中性总线截图——左侧的四个连接器连接到四个插座上的中性连接器。右边的红色线连接交流电源线的中性线。顶部的黑色跳线将它们连接在一起。</figcaption></figure><h1 id="ff90" class="li lj iq bd lk ll mw ln lo lp mx lr ls jw my jx lu jz mz ka lw kc na kd ly lz bi translated">把所有的放在一起</h1><p id="ee34" class="pw-post-body-paragraph kf kg iq kh b ki ma jr kk kl mb ju kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">所以基本上我在台式电脑上运行Reason和rtpMIDI。我的Raspberry Pi通过wifi接收MIDI数据，并启动继电器来打开和关闭插座。我昨天让它单独控制八个插座，现在我正在完成扩展，它将增加到十六个插座。我使用端子板总线构建它的方式，从8个扩展到16个，基本上只是将三根交流电线连接到第二组插座/总线，然后将新继电器的低压DC连接到树莓Pi上的引脚。</p><p id="fd46" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个接近完成的产品的简短视频，在我插入交流电之前，启动继电器测试低压部分:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="90cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是另一个继电器在外面点火的短片，插座里有一些灯，用来测试交流开关。令我惊讶的是，它很有效:</p><figure class="mg mh mi mj gt mk"><div class="bz fp l di"><div class="oa nz l"/></div></figure><p id="9e7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我完成扩展(希望如此)后，我将把它安装在木板上，并把它放在一个防风雨的桶里。</p><p id="9ec1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在接下来的几个晚上，我会在房子周围挂灯，并让灯与WAV/MP3音频同步。然后，我将通过调频发射机传输音频，并成为邻居的麻烦。</p><p id="4cb2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有什么问题尽管问！</p></div></div>    
</body>
</html>