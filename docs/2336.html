<html>
<head>
<title>How to debug JavaScript applications and tests (Jest, Mocha, Jasmine, Karma)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何调试JavaScript应用和测试(Jest，Mocha，Jasmine，Karma)</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-debug-javascript-applications-and-tests-9718fe610f7d?source=collection_archive---------9-----------------------#2019-05-07">https://itnext.io/how-to-debug-javascript-applications-and-tests-9718fe610f7d?source=collection_archive---------9-----------------------#2019-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="fece" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在商业世界中，有许多遗留的JavaScript应用程序。尽管客户端应用程序是JavaScript中的常见用例，但近年来，越来越多的Node.js应用程序正在被构建。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/64cf60bd60bd2ff28d75b25e23dbeb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPMITzWoSQ0t39i9eh2BHg.png"/></div></div></figure><p id="ac60" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在这里遇到的问题是，应用程序构建得非常复杂，因此很难调试。谁没有开发过这个用Node.js编写的巨型遗留单片主应用程序，它是公司的核心？Express、Sequelize、中间件无处不在和意大利面条代码。加入一些MongoDB，到处做些讨厌的事情，你就知道你的企业项目环境了。</p><p id="2d68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试这些东西是相当困难的，因为它们可能有许多抽象和副作用。所以编写测试是理解代码行为的第一步，但实际上理解代码的行为和它应该做什么是第一步。大多数情况下，企业会编写关于如何做事情的文档，但你知道，总是有太聪明的工程师为了达到这个目标而在抽象上做一些粗糙的抽象，所以对于不熟悉代码的开发人员来说，代码不是真正可以理解的。</p><p id="6fee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，一个新的开发人员编写测试几乎是不可能的，因为他/她可能不理解业务案例，但更糟糕的是，他/她可能甚至不理解代码在做什么。为了理解这一点，开发人员将编写一个调试语句。在JavaScript中，这通常看起来像:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="c8aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我们在这里得到的是命令行中的视觉反馈。命令行或多或少是这里调试代码的UI。但实际上，命令行从来不是为调试而设计的。此外，这种调试适用于简单的代码片段，没有很多副作用，但是当您进入复杂的if-else结构或具有很多副作用和条件的代码，而您不想一直调试这些代码时(想象一下，如果状态x和y发生，然后向我展示结果)，那么这种技术可能会非常糟糕。</p><p id="792c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总的来说，JavaScript为此提供了一个解决方案。就是<code class="fe lc ld le lf b">debugger</code>关键词。在你的程序中设置断点，基本上就是一个关键字。断点是您的应用程序代码将停止运行以便您可以检查它的一个步骤。这类似于一个程序的视频播放，您只需在播放过程中停止视频，以检查该特定视频中发生的动作周围的不同事情。您可以在此找到关于调试器语句的更多资源:</p><ul class=""><li id="0639" class="lg lh it js b jt ju jx jy kb li kf lj kj lk kn ll lm ln lo bi translated"><a class="ae lp" href="https://www.ecma-international.org/ecma-262/6.0/#sec-debugger-statement" rel="noopener ugc nofollow" target="_blank">https://www . ECMA-international . org/ECMA-262/6.0/# sec-debugger-statement</a></li><li id="656e" class="lg lh it js b jt lq jx lr kb ls kf lt kj lu kn ll lm ln lo bi translated"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Statements/debugger</a></li></ul><p id="210e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ECMAScript官方文档中的一段重要引文如下:</p><blockquote class="lv lw lx"><p id="b1d0" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">[……]如果调试器不存在或不活动，此语句没有明显效果。</p></blockquote><p id="f4b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe lc ld le lf b">node index.js</code>运行应用程序时就是这种情况。这或多或少是Node.js运行的生产环境，因为Node.js很聪明，它没有为应用程序附加调试器。这主要是性能增益造成的。运行调试器总是会影响应用程序的性能，因为应用程序必须绑定到调试器才能启用变量监视、堆栈跟踪框架或断点等功能。当然，这是一个繁重的操作，会降低应用程序的速度。</p><p id="6fea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要在运行Node.js应用程序时启用调试器，只需用<code class="fe lc ld le lf b">--inspect</code>参数启动它。这将在<code class="fe lc ld le lf b">127.0.01:9229</code>上公开Node.js应用程序的一个端点。端点基本上实现了一个调试器规范。有不同的调试器，如<a class="ae lp" href="https://github.com/nodejs/node-inspect" rel="noopener ugc nofollow" target="_blank"> node-inspect </a>、<a class="ae lp" href="https://github.com/ChromeDevTools/devtools-frontend" rel="noopener ugc nofollow" target="_blank"> Chrome dev tools </a>等等，你也可以在这里找到:<a class="ae lp" href="https://nodejs.org/de/docs/guides/debugging-getting-started/" rel="noopener ugc nofollow" target="_blank">https://nodejs . org/de/docs/guides/debugging-getting-started/</a>。附加调试器通常是至少一次的手动过程，对于一些结构不良的应用程序来说，这可能会变得相当棘手。这也是为什么你几乎看不到有人真正使用调试器的原因🤷对于一点点调试来说，设置太难了，所以大多数人更喜欢使用简单的<code class="fe lc ld le lf b">console.log</code>而不是附加调试器。在客户端应用程序中，这可能会有所不同，因为Chrome和Firefox有自己的开发工具，能够调试并自动连接到网站的JavaScript代码。但是在Node.js应用程序中，您必须以另一种“模式”运行应用程序。但是对于这些问题，有一个解决方案叫做<code class="fe lc ld le lf b">ndb</code>。</p><blockquote class="lv lw lx"><p id="65ca" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">ndb是Node.js的改进调试体验，由Chrome DevTools启用—<a class="ae lp" href="https://github.com/GoogleChromeLabs/ndb" rel="noopener ugc nofollow" target="_blank">ndb的GitHub库描述</a></p></blockquote><p id="e219" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe lc ld le lf b">ndb</code>相当容易。您唯一要做的就是安装它，然后用<code class="fe lc ld le lf b">ndb yarn start</code>运行您的Node.js应用程序。<code class="fe lc ld le lf b">ndb</code>建议全球安装。您可以通过以下方式做到这一点:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="b9c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则，您也可以添加<code class="fe lc ld le lf b">ndb</code>作为devDependency，并创建一个Node.js脚本命令来启动带有前缀<code class="fe lc ld le lf b">ndb</code>的应用程序。</p><p id="3ae7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，我们只是专注于启动一个附带调试器或ndb的成熟Node.js应用程序，但<code class="fe lc ld le lf b">ndb</code>变得非常强大，因为您可以将其附加到基本上每个Node.js进程。例如，当测试你的应用程序时，你可以使用<code class="fe lc ld le lf b">ndb yarn test</code>来调用你的测试命令。因为这些测试是在Node.js环境中执行的，所以您将拥有完整的调试器选项。我准备了一个简单的Node.js应用程序，可以在这里找到:</p><div class="mc md gp gr me mf"><a href="https://github.com/igeligel/ndb-showcase" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd iu gy z fp mk fr fs ml fu fw is bi translated">IGE ligel/nd b-展示区</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">展示如何轻松调试Node.js应用程序的项目</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">github.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt ky mf"/></div></div></a></div><p id="c025" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个项目只是在index.js文件中公开了一个模块，并导出了一个名为<code class="fe lc ld le lf b">add</code>的函数，它接受两个参数并将它们相加。该功能也包含在<code class="fe lc ld le lf b">__tests__</code>目录中的测试中。看起来奇怪的是，<code class="fe lc ld le lf b">debugger</code>语句仍然包含在JavaScript文件中。<em class="ly">不要在生产级代码</em>中这样做。这只是为了展示。这个项目中的<code class="fe lc ld le lf b">package.json</code>文件创建了开发人员可以运行的四个脚本:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="la lb l"/></div></figure><p id="8145" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您运行<code class="fe lc ld le lf b">start</code>或<code class="fe lc ld le lf b">start:debug</code>，它将运行“CLI”示例，否则，您可以使用<code class="fe lc ld le lf b">test</code>或<code class="fe lc ld le lf b">test:debug</code>来运行测试。一个命令和一个附加了<code class="fe lc ld le lf b">:debug</code>后缀的命令之间的唯一区别是用普通命令运行<code class="fe lc ld le lf b">ndb</code>。当运行这些时，它会打开一个Chrome开发工具的Chrome窗口。如果用<code class="fe lc ld le lf b">debugger</code>语句设置了断点，应用程序实际上会在这些语句处停止。例子可以在下面的截图中看到:</p><div class="kp kq kr ks gt ab cb"><figure class="mu kt mv mw mx my mz paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/ace2e45629dbba5b43488254804bf167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9-h3cRSTMhI6LpNq9zgzEw.png"/></div></figure><figure class="mu kt mv mw mx my mz paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><img src="../Images/1c907cd1bc61bf7be0f276f0270866d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WlOEBZ0IUDEhWSUS17Q_Iw.png"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk ne di nf ng translated">Chrome开发工具示例</figcaption></figure></div><p id="b730" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以看到你有正常的Chrome开发工具功能，而没有设置很多样板文件，这使得<code class="fe lc ld le lf b">ndb</code>超级棒。它使开发人员更容易进行调试，并减少了实际使用适当调试器的障碍。</p><p id="a555" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里最有用的特性可能是变量检查。你可以将鼠标悬停在变量上并查看值，而不用将它们放入<code class="fe lc ld le lf b">console.log</code>语句中，更好的是，你可以检查可能有副作用的变量。超级牛逼。Chrome开发团队在本视频中展示了更多功能:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nh lb l"/></div><figcaption class="na nb gj gh gi nc nd bd b be z dk translated">调试JavaScript — Chrome DevTools 101</figcaption></figure><p id="627c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是人们如何轻松调试Node.js应用程序的方法。请使用<code class="fe lc ld le lf b">ndb</code>，向您的同事展示并分享这篇文章。</p><blockquote class="lv lw lx"><p id="7dbd" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">开发者❤️调试器</p></blockquote></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><blockquote class="lv lw lx"><p id="b702" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">感谢你阅读这篇文章。你摇滚<em class="it">🤘</em></p><p id="5f48" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">也可以查看我的其他博客文章，比如JavaScript中的<a class="ae lp" href="https://medium.com/@kevin_peters/function-parameters-in-javascript-clean-code-4caac109159b" rel="noopener">函数参数</a>、<a class="ae lp" href="https://medium.com/@kevin_peters/learn-how-to-refactor-vue-js-single-file-components-on-a-real-world-example-501b3952ae49" rel="noopener">通过一个真实的例子</a>或<a class="ae lp" href="https://medium.com/3yourmind/auto-formatters-for-python-8925065f9505" rel="noopener">Python的自动格式化器</a>了解如何重构Vue.js单个文件组件。</p><p id="32f2" class="jq jr ly js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated">如果你有任何反馈或者想给这篇文章添加一些东西，请在这里评论。您也可以在<a class="ae lp" href="https://twitter.com/kevinpeters_" rel="noopener ugc nofollow" target="_blank"> twitter </a>上关注我，或者访问我的<a class="ae lp" href="https://www.kevinpeters.net/" rel="noopener ugc nofollow" target="_blank">个人网站</a>来了解我的博客文章和许多其他内容。</p></blockquote></div></div>    
</body>
</html>