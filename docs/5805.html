<html>
<head>
<title>Create a crypto Telegram bot in Python using Yahoo Finance API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Yahoo Finance API在Python中创建一个加密电报机器人</h1>
<blockquote>原文：<a href="https://itnext.io/create-a-crypto-telegram-bot-in-python-using-yahoo-finance-api-a5da9975c31c?source=collection_archive---------3-----------------------#2021-05-28">https://itnext.io/create-a-crypto-telegram-bot-in-python-using-yahoo-finance-api-a5da9975c31c?source=collection_archive---------3-----------------------#2021-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93e933fdc5e80754d73e122a22b8f429.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-TLBCE2NMNzZ1LLE.png"/></div></div></figure><p id="954c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，我正在为一个项目探索Telegram APIs，这个项目有人让我去做。该脚本实际上是一个cron作业，每天发送消息。在使用它的过程中，我发现你可以想出自己的命令，这些命令可以从一些远程API中提取数据，并将结果显示给Telegram用户。我发现这是我写下一篇博文的机会🙂</p><p id="2c65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Telegram在通信方面与WhatsApp非常相似，在密码爱好者中非常受欢迎。许多密码交易员使用Telegram和Discord向他们的团队成员发送密码和股票信号。</p><p id="b800" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">电报应用程序被称为机器人。您创建了一个bot，并获得了一个API/Token密钥，用于您的程序连接电报服务器。您可以创建一个无需任何用户干预就能持续发送消息的机器人，也可以创建一个将command作为输入并做出相应响应的机器人。我打算晚一点做。</p><h1 id="274a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">创建一个机器人</h1><p id="6621" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">你要做的第一件事就是发送一条<code class="fe lz ma mb mc b">/start</code>消息给<strong class="ka ir">机器人父亲</strong>机器人。这个机器人有一个经过验证的勾号，将它与其他<em class="md">假</em>机器人区分开来。当你发送一个<code class="fe lz ma mb mc b">/start</code>命令时，它会给你一个大菜单命令来管理你的机器人。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/f1b079129d1ac0edf6025f2429040c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y6YYXWSIQF_0HM7R.png"/></div></div></figure><p id="2b59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以使用<code class="fe lz ma mb mc b">/newbot</code>命令，它会要求你按照几个步骤来生成你的机器人。最后，它还会向您发送如下消息:</p><blockquote class="mj mk ml"><p id="b790" class="jy jz md ka b kb kc kd ke kf kg kh ki mm kk kl km mn ko kp kq mo ks kt ku kv ij bi translated">搞定了。祝贺你的新机器人。你会发现它在t.me/mybot.你现在可以添加一个描述，关于你的机器人的部分和剖面图，见/帮助命令列表。顺便说一下，当你完成创建你的酷机器人，平我们的机器人支持，如果你想要一个更好的用户名。在你这样做之前，确保机器人是完全可操作的。使用此令牌访问HTTP API:2815346687:aahzir 1 iocwskemg 21–7 ilal 4 GH 78 jml 3 _ 4保持您的令牌<strong class="ka ir">安全</strong>和<strong class="ka ir">安全存储它</strong>，它可以被任何人用来控制您的bot。</p></blockquote><p id="7a15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将这个令牌密钥保存在某个地方，因为这是您与您的机器人进行交互的唯一方式。为了让你的机器人可以被群组邀请，你必须发送<code class="fe lz ma mb mc b">/setjoingroups</code>命令。它会要求你用@符号提到你的机器人名。例如，如果我的机器人名字是<code class="fe lz ma mb mc b">mybot</code>，那么我会写<code class="fe lz ma mb mc b">@mybot</code>并点击回车键。它将显示一个类似对话框的界面，您可以在其中选择<em class="md">启用</em>选项。</p><p id="f2ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可以轻松地邀请您的新机器人加入该群组</p><h1 id="15e9" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">发展</h1><p id="de88" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">好了，你的机器人准备好了。现在你将不得不写代码来自动化这个机器人。为了做到这一点，你必须为电报安装<a class="ae mp" href="https://python-telegram-bot.org/" rel="noopener ugc nofollow" target="_blank"> python库。</a></p><p id="7d75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我要做的第一件事是在一个单独的文件中设置令牌密钥。你可以使用一个<em class="md">文本/xml/JSON </em>，无论你想要什么。我只是创建了<code class="fe lz ma mb mc b">config.py</code>并将<code class="fe lz ma mb mc b">TOKEN</code>中的令牌设置为常量。</p><p id="8d86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我将创建一个名为<code class="fe lz ma mb mc b">crypto.py</code>的主脚本文件，它将作为一个机器人控制器。在文件中导入如下内容:</p><pre class="mf mg mh mi gt mq mc mr ms aw mt bi"><span id="d1b5" class="mu kx iq mc b gy mv mw l mx my">from config import TOKEN<br/>from telegram.ext import Updater, CommandHandler</span><span id="3041" class="mu kx iq mc b gy mz mw l mx my">USAGE = '/ticker &lt;SYMBOL&gt;: For example: /ticker BTC or /ticker ETH'</span><span id="7289" class="mu kx iq mc b gy mz mw l mx my">def start(update, context):<br/>    update.message.reply_text(USAGE)</span><span id="148b" class="mu kx iq mc b gy mz mw l mx my">def main():<br/>    updater = Updater(TOKEN, use_context=True)<br/>    dp = updater.dispatcher</span><span id="86ce" class="mu kx iq mc b gy mz mw l mx my"># on different commands - answer in Telegram<br/>    dp.add_handler(CommandHandler("start", start))</span><span id="9311" class="mu kx iq mc b gy mz mw l mx my"># Start the Bot<br/>    updater.start_polling()<br/>    updater.idle()</span></pre><p id="a5d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您运行此脚本时，它将循环运行。转到您添加bot的组，它会发送在<code class="fe lz ma mb mc b">USAGE</code>变量中设置的文本。非常简单。您创建一个调度，它是<code class="fe lz ma mb mc b">Updater</code>类的对象，然后创建<code class="fe lz ma mb mc b">CommandHandler</code>来处理您的定制命令。<code class="fe lz ma mb mc b">add_handler</code>的第一个参数是你要发送的命令，第二个参数是收到命令后要调用的函数。脚本会丢弃未知的命令。<code class="fe lz ma mb mc b">start_polling</code>将循环启动脚本，接受来自机器人的命令。尝试<code class="fe lz ma mb mc b">/start</code>命令，它应该会打印出您在<code class="fe lz ma mb mc b">USAGE</code>变量中设置的文本。</p><p id="87e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，我们已经测试了我们的机器人，现在是时候写真正的代码来获取加密价格了。为此，我使用了雅虎财经API，因为它们可以免费使用，而且相当全面。我创建了另一个名为<code class="fe lz ma mb mc b">yf.py</code>的文件，其中包含以下代码:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/b8a807d537fd047f29df93974f05e827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0t5QwSmref19T2I_.png"/></div></div></figure><p id="8d7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">非常简单。现在，我通过如下所示的导入来调用这个函数:</p><p id="772e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lz ma mb mc b">from yf import get_ticker_info</code></p><p id="2d38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将创建一个名为<code class="fe lz ma mb mc b">ticker_command</code>的新函数，它包含以下代码:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/3d5dbe0bde573f479b03390f3ae6ad52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VKggza60J92MKuhg.png"/></div></div></figure><p id="35d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在<code class="fe lz ma mb mc b">main()</code>函数，ticker handler命令将如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/4cfad2115d08cf7cfde5393a0e24164e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nXkcs4PvL0DH-rsn.png"/></div></div></figure><p id="8ef9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样。如果一切顺利，这就是你的机器人的反应:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/a9b273e2df3624294b6546e2130ccb71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*UKnBldbD6UwxwI0Q.gif"/></div></figure><p id="7d35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很酷，不是吗？在我结束之前，您应该注意到这个命令:</p><p id="2914" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe lz ma mb mc b">update.message.reply_text(msg, parse_mode='html', disable_web_page_preview=True)</code></p><p id="d712" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我将消息格式设置为<code class="fe lz ma mb mc b">HTML</code>。默认情况下，它是文本。您也可以使用<em class="md">降价</em>进行文本格式化。我还禁用了链接预览，我还发送了验证硬币价格的主要来源的URL</p><h1 id="9b5e" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="9e79" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">所以你知道了用Python写一个基本的电报机器人有多简单。你可以通过在数据库或其他东西中记录事情来使它变得更复杂。基本结构是一样的。该代码可在<a class="ae mp" href="https://github.com/kadnan/PythonTelegramCryptoBot" rel="noopener ugc nofollow" target="_blank"> Github </a>上获得。</p><p id="fc90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="md"> PS:如果你喜欢这个帖子，那么你可以通过</em> </strong> <a class="ae mp" href="http://blog.adnansiddiqi.me/support-this-content/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="md">支持</em> </strong> </a> <strong class="ka ir"> <em class="md">这个博客来表达你的爱。你友好的姿态将帮助我学习新的东西，并与像你这样的人分享。</em>T15】</strong></p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="59df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="md">原载于2021年5月28日</em><a class="ae mp" href="http://blog.adnansiddiqi.me/create-crypto-telegram-bot-in-python-using-yahoo-finance-api/" rel="noopener ugc nofollow" target="_blank"><em class="md">http://blog . adnansiddiqi . me</em></a><em class="md">。</em></p></div></div>    
</body>
</html>