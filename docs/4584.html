<html>
<head>
<title>Two Quick Ways to Apply Zero Trust in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes中应用零信任的两种快速方法</h1>
<blockquote>原文：<a href="https://itnext.io/two-quick-ways-to-apply-zero-trust-to-kubernetes-79764dd420bf?source=collection_archive---------2-----------------------#2020-07-30">https://itnext.io/two-quick-ways-to-apply-zero-trust-to-kubernetes-79764dd420bf?source=collection_archive---------2-----------------------#2020-07-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="c0b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如今，零信任风靡一时，但考虑到现代应用程序在整个云(或多个云)中的成熟性，它离大肆宣传并迅速成为现实还差得很远。传统上，敏感数据位于一个数据中心(您的城堡)内，外围安全的<a class="ae ko" href="https://en.wikipedia.org/wiki/Perimeter_security" rel="noopener ugc nofollow" target="_blank">层</a>(您的护城河)用于保护数据的进出。然而，当今的世界更加复杂，因此安全模式已经适应了新的模式。攻击者总是试图(并成功地)在门口获得一个“立足点”，但零信任确保他们只是呆在大厅里！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/08a07f5f85fde0416ad0fb128e0f33d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lVDSGOItpaU398IR"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk translated">传统安全是围绕数据城堡的护城河，零信任更像是围绕小城堡的小护城河</figcaption></figure><h1 id="899e" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">今天的多重云</h1><p id="9c6f" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">对于一个组织来说，将销售数据保存在SaaS CRM中，将客户数据保存在公共云中(使用类似Kubernetes的东西)，将内部数据保存在本地数据中心(使用裸机)并不罕见。更有甚者，访问这些数据的员工和客户遍布世界各地，不再连接到办公室的局域网，而且一如既往，黑客不断试图进入。零信任非常直观，因为数据会在不同的信任区域中传输，您必须在每一步都验证其完整性和真实性。现在我们已经有了零信任的心态，让我们把它应用到Kubernetes上吧！</p><h1 id="8191" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.网络策略</h1><p id="979d" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">开箱即用，Kubernetes提供了一些可怕的，但不安全的默认设置。所有pod都可以与其他pod对话，并且所有pod都可以与互联网对话。这是一个很好的开始，但最终你会想把事情锁定下来。<a class="ae ko" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">网络政策</a>正是这么做的。我们将从真正的零信任开始——默认的拒绝所有策略，不允许任何东西与任何东西对话。</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="cf11" class="mn lg it mj b gy mo mp l mq mr">// Default Deny All Network Policy</span><span id="d1cd" class="mn lg it mj b gy ms mp l mq mr">apiVersion: networking.k8s.io/v1 <br/>kind: NetworkPolicy <br/>metadata:   <br/>  name: <strong class="mj iu">default-deny-all</strong> <br/>spec:   <br/>  podSelector: {}   <br/>  policyTypes:   <br/>  - Ingress   <br/>  - Egress</span></pre><p id="7bc8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个策略对我来说确实巩固了零信任的概念，这里的策略是默认拒绝一切，然后慢慢地添加更多的许可策略来覆盖最初的<code class="fe mt mu mv mj b">default-deny-all</code>策略。在信息安全社区中，我们称之为最小特权原则。与许多新的安全趋势一样，零信任依赖于这一久经考验的原则。下面是我们如何覆盖<code class="fe mt mu mv mj b">default-deny-all</code>策略:</p><pre class="kq kr ks kt gt mi mj mk ml aw mm bi"><span id="ab4a" class="mn lg it mj b gy mo mp l mq mr">// Allow Access from App A to App B</span><span id="3ba4" class="mn lg it mj b gy ms mp l mq mr">apiVersion<strong class="mj iu">:</strong> networking.k8s.io/v1<br/>kind:<strong class="mj iu"> </strong>NetworkPolicy<br/>metadata:<br/>  name: access-my-app<br/>spec:<br/>  podSelector:<br/>    <strong class="mj iu">matchLabels:<br/>      app: app-1</strong><br/>  ingress:<br/>  - from:<br/>    - podSelector:<br/>        <strong class="mj iu">matchLabels:<br/>          app: app-2<br/>  </strong>egress:<br/>  - to:<br/>    - podSelector:<br/>        <strong class="mj iu">matchLabels:<br/>          app: app-2</strong></span></pre><p id="c9a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">起初看起来可能有点混乱，但像Kubernetes的其他部分一样，<em class="mw">标签是这里的关键，</em>和<code class="fe mt mu mv mj b">matchLabels</code>是我们希望连接的点。从入口和出口的角度来看，这个策略本质上是将带有一个标签的pod连接到下一个标签(我已经用粗体显示了)。在这种情况下，标签为<code class="fe mt mu mv mj b">app: app-1</code>的Pod只能接收流量(入口)并向标签为<code class="fe mt mu mv mj b">app: app-2</code>的Pod发送流量(出口)。</p><p id="654e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更直观地说——入口部分允许<strong class="js iu"> app-1 ← app-2 </strong></p><p id="e0b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="mw">出口</em>部分允许<strong class="js iu"> app-1 → app-2 </strong></p><p id="2e65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总的来说，这为我们提供了<strong class="js iu"> app-1 ← → app-2 </strong></p><p id="8f5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">网络策略是锁定您的Kubernetes集群开箱即用的完美工具——当它们成为强大的<a class="ae ko" href="https://www.f5.com/solutions/automate-dev-ops-and-secops-deployments-with-ci-cd-pipeline-integrations" rel="noopener ugc nofollow" target="_blank">持续集成/持续部署管道</a>的一部分时，其功能极其强大(这是开发人员的梦想！)</p><h1 id="9188" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.<strong class="ak">工作负载标识的SPIFFE</strong></h1><p id="fdaf" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">信任的一个重要方面是身份，随之而来的是了解他们所说的东西(身份验证)。<a class="ae ko" href="https://spiffe.io/" rel="noopener ugc nofollow" target="_blank"> SPIFFE </a> ( <strong class="js iu">安全生产<em class="mw">面向所有人的身份</em>框架</strong>)是一个开放标准，它试图为节点、容器或其他任何运行数据工作负载的东西赋予身份。最终目标是，每次您的数据跨您的集群移动到另一个云或其他方向时，都会断言身份(有时我们称这些方向为信任壁垒)。这听起来可能真的是理论上的胡言乱语(比如为什么我的电脑需要一个身份？)，所以让我把它归结为:<strong class="js iu">当我们知道两个事物的身份时，我们可以颁发证书并创建加密的TLS连接</strong>。TLS连接在传输过程中为我们提供了加密，并帮助我们安全地跨越信任壁垒。</p><p id="f393" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">SPIFFE实际上是<a class="ae ko" href="https://istio.io/latest/docs/concepts/security/" rel="noopener ugc nofollow" target="_blank"> Istio's mutual TLS </a>背后的魔法，它有一个美好的未来(<a class="ae ko" href="https://spiffe.io/community/" rel="noopener ugc nofollow" target="_blank">和一个伟大的社区</a>！).从技术层面来看，Istio的Citadel(现在是<code class="fe mt mu mv mj b">istiod</code>)在每个worker节点上创建和管理证书和密钥。因此，当pod通过sidecar网络代理(Istio中的Envoy)相互通信时，连接是加密的和可信的。我们在这里真正获得的是跨我们的pod的零信任——一个网络请求可能看起来好像来自一个已知的位置，但mutual TLS告诉我们它<em class="mw">实际上</em>是一个已知的位置，并且还阻止窃听者监听通信。Istio和其他服务网状网通常提供现成的相互TLS，但是这会增加运营开销。在接下来的几年里，我认为这将变得越来越容易。</p><h1 id="bad4" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">摘要</h1><p id="42bd" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">总的来说，我发现零信任是安全中的一个概念，是实现最小特权原则旧模式的一种新方法。网络策略和SPIFFE是通过实际实施进入零信任思维和架构的好方法。很容易假设在您的集群中运行的pods没有受到危害，但是由于安全性完全是关于深度防御的，这是两个增加深度的好方法。感谢你的阅读，如果你喜欢阅读这篇文章，请在Medium上关注我！</p></div></div>    
</body>
</html>