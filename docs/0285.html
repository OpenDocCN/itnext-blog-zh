<html>
<head>
<title>Fixing ‘expect’ assertions in Nightwatch.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">修复Nightwatch.js中的“expect”断言</h1>
<blockquote>原文：<a href="https://itnext.io/fixing-expect-assertions-in-nightwatch-js-a84a244467b6?source=collection_archive---------2-----------------------#2018-02-08">https://itnext.io/fixing-expect-assertions-in-nightwatch-js-a84a244467b6?source=collection_archive---------2-----------------------#2018-02-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b6c8e9967270154142c49574540cb335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPrfh9gWpKAbR-zGR5TFyQ.png"/></div></div></figure><p id="6339" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是Nightwatch.js进行功能测试的忠实粉丝，但是有一点一直让我很恼火，那就是expect API。我更喜欢使用expect而不是assert，但是因为Nightwatch在幕后使用Chai.js，所以它继承了Chai在属性访问方面的蹩脚断言。如果你不知道为什么断言属性访问不好，<a class="ae kw" href="https://github.com/moll/js-must#asserting-on-property-access" rel="noopener ugc nofollow" target="_blank">读一下这个</a>。</p><p id="0c6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用以下代码检查登录页面元素，并填写表单:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="dcba" class="lg lh iq lc b gy li lj l lk ll">login.expect.element('@username').to.be.visible;<br/>login.setValue('@username', username);<br/><br/>login.expect.element('@password').to.be.visible;<br/>login.setValue('@password', password);<br/><br/>login.expect.element('@submit').to.be.visible;<br/>login.click('@submit');</span></pre><p id="c310" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">毫无疑问，如果你的IDE中有任何形式的林挺代码，你会看到各种红色的曲线和警告。事实证明，这很容易解决，尽管使用一个名为<a class="ae kw" href="https://github.com/prodatakey/dirty-chai" rel="noopener ugc nofollow" target="_blank"> dirty-chai </a>的包。也许你已经用它进行单元测试，但是不知道如何把它转移到Nightwatch中。</p><p id="052d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，您需要安装dirty-chai。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="b21b" class="lg lh iq lc b gy li lj l lk ll">npm install --save-dev dirty-chai</span></pre><p id="9c71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后在你的Nightwatch配置文件中添加一个全局文件(如果你还没有的话)。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="bf6e" class="lg lh iq lc b gy li lj l lk ll">/* nightwatch.conf.js */</span><span id="e195" class="lg lh iq lc b gy lm lj l lk ll">module.exports = {<br/>    /* ... */</span><span id="0b77" class="lg lh iq lc b gy lm lj l lk ll">    globals: './globals.js'</span><span id="e90d" class="lg lh iq lc b gy lm lj l lk ll">    /* ... */<br/>}</span></pre><p id="e79a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后用dirty-chai扩展Nightwatchs自定义Chai库。在node_modules中已经有了chai-nightwatch，因为它是nightwatch的一个依赖项。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0b01" class="lg lh iq lc b gy li lj l lk ll">/* globals.js */</span><span id="e549" class="lg lh iq lc b gy lm lj l lk ll">module.exports = {<br/><br/>   before: <strong class="lc ir">function </strong>(done) {<br/>      <strong class="lc ir">var </strong>chai = require('chai-nightwatch');<br/>      chai.use(require('dirty-chai'));<br/>      done();<br/>   }<br/><br/>};</span></pre><p id="4846" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，所有expect API断言都将是函数，而不是属性访问器！最初的测试片段现在看起来像这样:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="5e8f" class="lg lh iq lc b gy li lj l lk ll">login.expect.element('@username').to.be.visible();<br/>login.setValue('@username', username);<br/><br/>login.expect.element('@password').to.be.visible();<br/>login.setValue('@password', password);<br/><br/>login.expect.element('@submit').to.be.visible();<br/>login.click('@submit');</span></pre><p id="11db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">轻松搞定！</p></div></div>    
</body>
</html>