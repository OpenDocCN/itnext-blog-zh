<html>
<head>
<title>ASP.NET Core 2.1: ActionResult</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ASP.NET核心2.1:行动结果</h1>
<blockquote>原文：<a href="https://itnext.io/asp-net-core-2-1-actionresult-3e031e90cee5?source=collection_archive---------1-----------------------#2018-09-09">https://itnext.io/asp-net-core-2-1-actionresult-3e031e90cee5?source=collection_archive---------1-----------------------#2018-09-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d2a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将从我的ASP.NET基础系列文章中提取联系人API，并将其从使用IActionResult转移到2.1版本中引入的ActionResult <t>。这些变化真的很简单，但是如果你使用OpenAPI/Swagger，我会在文章后面提到我注意到的一些事情。之前的代码任何改动都可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics/tree/d64360a3688b648b574b9354675029cc51bf9e8d" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</t></p><h2 id="0504" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">IActionResult vs ActionResult <t/></h2><p id="7179" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated"><a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/web-api/action-return-types?view=aspnetcore-2.1" rel="noopener ugc nofollow" target="_blank">官方文档</a>解释了在API中返回数据的三种不同方式，即特定类型、IActionResult类型或ActionResult &lt; T &gt;类型。</p><p id="7812" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您不需要进行任何类型的验证或类似操作，那么特定的类型是很好的，但是一旦您需要返回不同的HTTP状态，OK就不再足够了。这是您必须移动到IActionResult的地方。</p><p id="20ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">IActionResult允许返回不同的HTTP状态。在以下示例中，如果找不到具有所提供ID的联系人，则返回NotFound如果找到了联系人，则返回OK(contact)。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="5c79" class="km kn iq lp b gy lt lu l lv lw">public async Task&lt;IActionResult&gt; GetContact([FromRoute] int id)<br/>{<br/>     var contact = await _context.Contact<br/>                                 .SingleOrDefaultAsync(m =&gt; m.Id == id);<br/><br/>     if (contact == null)<br/>     {<br/>        return NotFound();<br/>     }<br/>    <br/>     return Ok(contact);<br/>}</span></pre><p id="dd70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">ActionResult <t>它的优点是函数的返回类型很明确。在下面的例子中，您可以看到GetContact已经改为使用ActionResult <t>，如果一切顺利，您最终将处理一个Contact对象，而不需要将结果包装在OK中。</t></t></p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="b76f" class="km kn iq lp b gy lt lu l lv lw">public async Task&lt;ActionResult&lt;Contact&gt;&gt; GetContact([FromRoute] int id)<br/>{<br/>     var contact = await _context.Contact<br/>                             .SingleOrDefaultAsync(m =&gt; m.Id == id);<br/><br/>     if (contact == null)<br/>     {<br/>        return NotFound();<br/>    }<br/><br/>    return contact;<br/>}</span></pre><h2 id="5179" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">OpenAPI/Swagger</h2><p id="22de" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">如果您在您的项目中使用OpenAPI/Swagger，并且函数具有以下定义，那么当您切换到使用ActionResult <t>时，它将自动选择返回类型。</t></p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="6b97" class="km kn iq lp b gy lt lu l lv lw">public async Task&lt;ActionResult&lt;Contact&gt;&gt; GetContact([FromRoute] int id)</span></pre><p id="afde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述函数在OpenAPI/Swagger UI中产生以下结果。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lx"><img src="../Images/94437b2bc717df1e8e1723defafb0db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ucHvPaKi62y5zUwq.png"/></div></div></figure><p id="f133" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这太棒了，让您不必为API函数生成ResponseType属性。请注意，一旦您为NotFound响应添加了ProducesResponseType，您仍然需要用正确的类型包含OK响应，否则您将在OpenAPI/Swagger UI中丢失返回类型。</p><p id="1d81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我调用最后一点是因为我花了时间试图弄清楚为什么我看到的所有返回类型的示例都被自动选取，但在我的示例应用程序中却没有。</p><h2 id="e038" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="fdef" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我是ActionResult <t>的超级粉丝，主要是因为它增加了API函数定义的清晰度。事实上，OpenAPI/Swagger可以在简单的情况下使用它，这是一个额外的好处。</t></p><p id="b42f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想了解更多信息，请查看由<a class="ae kl" href="https://twitter.com/JoonasWestlin" rel="noopener ugc nofollow" target="_blank"> Joonas Westlin </a>发布的ASP.NET核心2.1 中的<a class="ae kl" href="https://joonasw.net/view/aspnet-core-2-1-actionresult-of-t" rel="noopener ugc nofollow" target="_blank">探索行动结果&lt; T &gt;，其中有更多关于该功能实际上是如何实现的信息。如果您还没有确定，请查看官方文档中的ASP.NET核心Web API </a>页面中的<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/web-api/action-return-types?view=aspnetcore-2.1" rel="noopener ugc nofollow" target="_blank">控制器动作返回类型，了解API返回类型选项的详细比较。</a></p><p id="e8fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的代码可以在这里找到<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics/tree/55f63d28df6e278efe3b714b4b5bdc3dc89b57b4" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="7cf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">最初发表于</em> <a class="ae kl" href="https://elanderson.net/2018/09/asp-net-core-2-1-actionresult/" rel="noopener ugc nofollow" target="_blank"> <em class="mm">埃里克·安德森</em> </a> <em class="mm">。</em></p></div></div>    
</body>
</html>