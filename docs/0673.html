<html>
<head>
<title>Cert-manager: native x509 certificate management for Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">cert-manager:Kubernetes的本地x509证书管理</h1>
<blockquote>原文：<a href="https://itnext.io/cert-manager-native-x509-certificate-management-for-kubernetes-80ac478d314f?source=collection_archive---------2-----------------------#2018-05-03">https://itnext.io/cert-manager-native-x509-certificate-management-for-kubernetes-80ac478d314f?source=collection_archive---------2-----------------------#2018-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/696af5858c5e58d18f9a0d26661c8300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GpqfRPR9vwcbfLlL59sQQQ.jpeg"/></div></div></figure><p id="3102" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated">密切关注Jetstack的<a class="ae lf" href="https://www.jetstack.io/open-source" rel="noopener ugc nofollow" target="_blank">开源项目</a>的各位可能已经注意到，我们的新证书管理工具<a class="ae lf" href="https://github.com/jetstack/cert-manager" rel="noopener ugc nofollow" target="_blank"> cert-manager </a>已经推出有一段时间了。事实上，我们现在在GitHub上有超过1000颗星星！</p><p id="e56d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Cert-manager是用于Kubernetes的通用x509证书管理工具。在当今的现代网络中，保护应用流量至关重要。cert-manager旨在简化组织内证书的管理、颁发和更新。</p><p id="b2dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lf" href="https://github.com/jetstack/kube-lego" rel="noopener ugc nofollow" target="_blank"> kube-lego </a>，我们的<a class="ae lf" href="https://blog.jetstack.io/blog/kube-lego/" rel="noopener ugc nofollow" target="_blank">原创</a><a class="ae lf" href="https://www.letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">Let ' s Encrypt</a>Kubernetes Ingress资源证书供应工具，取得了巨大的成功。它使保护用户和集群入口点之间的流量变得简单。然而，随着时间的推移，仅仅围绕Kubernetes入口构建控制器的局限性变得显而易见。</p><p id="7719" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过围绕Kubernetes<a class="ae lf" href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/" rel="noopener ugc nofollow" target="_blank">customresourceditions</a>构建cert-manager，我们已经能够极大地增加配置的灵活性、调试功能，并且支持比单独加密更广泛的ca。</p><p id="81fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章高度概括了cert-manager的工作方式，并将重点介绍该项目的一些新特性和最新进展。</p><h1 id="47c7" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">发行人和证书</h1><p id="efdf" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在x509证书的真实世界中，ca(证书颁发机构)是一个信任点，负责以签名和受信任的x509证书的形式向各种客户端颁发身份。</p><p id="e0f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们介绍一下ACME加密协议，但是，并不是所有的ca都支持这个协议。</p><p id="dcc2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了支持许多不同类型的认证机构，我们在Kubernetes API中以“发行者”的形式引入了CA的概念。</p><p id="77f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">cert-manager“Issuer”资源代表能够签署x509证书请求的实体。</p><p id="85b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">今天，我们支持ACME，CA(即存储在秘密资源中的简单签名密钥对)和从v0.3.0版本开始的Hashicorp Vault！</p><p id="d169" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个发行者资源的示例:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="a63e" class="ms lh iq mo b gy mt mu l mv mw">apiVersion: certmanager.k8s.io/v1alpha1 kind: ClusterIssuer metadata: name: letsencrypt-staging spec: acme: server: https://acme-staging-v02.api.letsencrypt.org/directory email: <a class="ae lf" href="https://blog.jetstack.io/cdn-cgi/l/email-protection" rel="noopener ugc nofollow" target="_blank">[email protected]</a> privateKeySecretRef: name: letsencrypt-private-key http01: {}</span></pre><p id="4509" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了向这些发行者请求证书，我们还引入了证书资源。这些资源引用相应的发行者资源，以指示它们应该由哪个CA发行。</p><p id="a913" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个证书资源的示例，使用前面显示的颁发者:</p><pre class="mj mk ml mm gt mn mo mp mq aw mr bi"><span id="67e5" class="ms lh iq mo b gy mt mu l mv mw">apiVersion: certmanager.k8s.io/v1alpha1 kind: Certificate metadata: name: example-com spec: secretName: example-com-tls dnsNames: - example.com - www.example.com issuerRef: name: letsencrypt-staging kind: ClusterIssuer acme: config: - http01: ingressClass: nginx domains: - example.com - <a class="ae lf" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">www.example.com</a></span></pre><p id="a343" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于发行人和证书的更多信息可以在我们的<a class="ae lf" href="https://cert-manager.readthedocs.io/" rel="noopener ugc nofollow" target="_blank">文档</a>中找到。</p><h1 id="9cd9" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">0.3中的新功能</h1><p id="a69a" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在过去的几周里，我们一直在测试v0.3的alpha候选版本，这是我们即将发布的新版本。</p><p id="84b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个版本包含了新的特性和错误修复，本节描述了主要的特性。</p><h1 id="0203" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">ACMEv2和通配符证书</h1><p id="27af" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">让我们加密最近发布的ACME协议v2，除了其他改进之外，它现在支持通配符证书。这是一个期待已久并被要求的特性，直到最近才成为可能。</p><p id="bdd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了允许cert-manager用户请求和使用通配符证书，我们在v0.3版本中专门使用了ACMEv2。</p><p id="0f26" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这允许用户像请求任何其他证书一样请求通配符证书——包括通过带注释的入口资源完全支持这样做(就像kube-lego！).</p><p id="0380" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个很好的例子，说明了我们如何向cert-manager添加新的和更复杂的功能，同时继续支持从kube-lego采用的长期遗留行为。</p><p id="9295" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想开始尝试，请在我们的GitHub页面上查看最新的v0.3 alpha版本。通过将<code class="fe mx my mz mo b">*.domain.com</code>指定为您的DNS名称之一，您可以像请求任何其他证书一样请求通配符证书。参见<a class="ae lf" href="http://docs.cert-manager.io/en/master/tutorials/acme/dns-validation.html" rel="noopener ugc nofollow" target="_blank"> ACME DNS验证教程</a>了解更多关于如何开始DNS-01挑战的信息。</p><h1 id="c784" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">保管库颁发者支持</h1><p id="0aa0" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">经过大量的艰苦工作，对<a class="ae lf" href="https://vaultproject.io/" rel="noopener ugc nofollow" target="_blank"> Hashicorp金库</a>的初始支持已经合并到cert-manager中！</p><p id="6497" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是另一个长期要求的特性，也是我们支持的发行者类型的一大补充。</p><p id="5288" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">特别感谢<a class="ae lf" href="https://github.com/vdesjardins" rel="noopener ugc nofollow" target="_blank"> @vdesjardins </a>，他独自自发地承担了这项工作，并推动其通过审查流程，直到最后。</p><p id="a54c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这允许最终用户创建一个“保险库”颁发者，它与单个保险库PKI后端角色配对。</p><p id="8ae7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最初，我们支持令牌认证和Vault的“AppRole”认证机制，以针对Vault服务器安全地授权cert-manager。</p><p id="4fd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Vault Issuer的加入巩固了我们作为通用证书管理器的地位，并展示了在众多不同类型的ca之上提供单一清晰抽象的价值。</p><p id="9fe4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在文档中阅读更多关于<a class="ae lf" href="http://docs.cert-manager.io/en/latest/tutorials/index.html" rel="noopener ugc nofollow" target="_blank">创建和使用保管库发行者</a>的信息。</p><h1 id="a430" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">新文档网站</h1><p id="1458" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">在任何项目中，文档化都是困难的。它需要为全新用户提供清晰的入职体验，同时为更高级的用户提供深入的细节。同时考虑到这些用户不同的技能水平(例如，有些用户可能对Kubernetes本身来说是全新的！).</p><p id="6ce6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有一些出色的社区贡献，包括用户指南和教程，解释如何开始使用cert-manager。</p><p id="ff40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们一直使用存储在GitHub中的markdown来托管我们的文档。当我们开始更严格地对cert-manager进行版本控制，并发布alpha/beta候选版本时，这开始引起混乱。为了解决这个问题，也为了让用户更容易浏览和发现我们<em class="na">所做的</em>的各种教程——我们已经将我们的文档转移到一个托管的readthedocs网站上。</p><p id="1b95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以在<a class="ae lf" href="https://cert-manager.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> readthedocs </a>上查看新文档——注意，如果你在寻找最新0.3版本的信息，我们在左下角也有一个“版本切换器”。</p><p id="fb3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文档的每一页右上角都有一个“在GitHub中编辑”的链接，所以如果你发现了一个错误或者你有了一个新教程的想法，请进入并提交PRs！</p><h1 id="266e" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">下一步是什么？</h1><p id="4991" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Cert-manager还年轻，未来有很多计划！以下是我们路线图中的几个亮点:</p><h1 id="bf5b" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">定义证书策略</h1><p id="fba7" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">现在，任何能够创建证书资源的用户都可以从任何ClusterIssuer或同一名称空间内的颁发者请求任何种类的证书。</p><p id="32e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们打算为管理员提供机制来定义谁可以获得证书的“策略”,和/或这些证书必须如何构造。这可能包括最短和最长持续时间，或者允许的DNS名称的有限集合。</p><p id="00eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过在Kubernetes内部定义该策略，我们可以从组织内所有不同ca之间的通用策略控制级别中获益。这将帮助您的组织审计和管理谁可以做什么。</p><h1 id="db08" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">高级资源验证</h1><p id="ece9" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Kubernetes最近增加了对ValidatingAdmissionWebhooks的支持(以及它们的‘变异’对应物)。</p><p id="224a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些可用于提供资源验证(例如，确保所有字段都设置为可接受的值)，以及资源的高级“变异”(例如，应用“默认值”)。</p><p id="b438" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">配置这些webhooks时的一个常见问题是，它们需要x509证书才能设置和运行。这个过程可能很麻烦，这正是cert-manager设计要解决的问题！</p><p id="9bed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在cert-manager的未来版本中，我们将引入<em class="na">我们自己的</em>验证webhook，以便为开发者提供无效配置的预警。这将涉及一个新颖的“引导”过程，以便允许“自托管webhooks”(即由cert-manager托管的为cert-manager供电的webhooks)。</p><p id="ec39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除此之外，我们将创建教程，解释我们对这些类型的webhooks的“推荐部署实践”,以及您如何利用cert-manager来处理保护它们的所有方面！</p><h1 id="13de" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">可插拔/进程外发行者</h1><p id="3137" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">cert-manager的一些企业用户有他们自己的CA流程，这是为他们的组织定制的新颖流程。</p><p id="1c2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">考虑到如此多的不同业务单位依赖x509证书平台，在短时间内将整个组织切换到新协议并不总是可行的。</p><p id="4aeb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了缓解这些公司的过渡期，我们正在探索增加“基于gRPC的发行人”。这类似于CNI(容器网络接口)和CRI(容器运行时接口)。目标是提供一个通用的gRPC接口，任何人都可以实现它来签署和更新证书。</p><p id="490e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实现该接口的用户将立即受益于cert-manager已经实现的附加策略和续订功能。</p><h1 id="b2cb" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">参与其中</h1><p id="a6c4" class="pw-post-body-paragraph jy jz iq ka b kb me kd ke kf mf kh ki kj mg kl km kn mh kp kq kr mi kt ku kv ij bi translated">Cert-manager发展迅速，围绕它的社区每天都在壮大。</p><p id="5ec2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们<strong class="ka ir">希望</strong>看到新成员加入社区，并且相信如果我们想要项目继续下去，这是必要的。</p><p id="2773" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想参与进来，看看我们在GitHub上的发布版，或者在<a class="ae lf" href="https://slack.k8s.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes Slack </a>上进入#cert-manager并打个招呼！</p><p id="9d04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想在社区项目中工作，比如日常工作中的cert-manager？Jetstack正在招聘软件工程师，包括远程(EU)职位。查看我们的<a class="ae lf" href="https://www.jetstack.io/careers" rel="noopener ugc nofollow" target="_blank">职业页面</a>了解更多关于职位和如何申请的信息。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="6904" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="na">原载于</em><a class="ae lf" href="https://blog.jetstack.io/blog/cert-manager" rel="noopener ugc nofollow" target="_blank"><em class="na">blog . jet stack . io</em></a><em class="na">作者</em></p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/e796741afed91a915871f29e8078d952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w618afzW9OadaExaU8iD2g.jpeg"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">James Munnelly，Jetstack解决方案工程师</figcaption></figure><p id="36e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">詹姆斯做软件工程师已经有10年了。他于2015年初加入Kubernetes，在公共云和裸机环境中拥有近2年的生产经验。当不在Kubernetes上工作的时候，他就修补Golang，并在其他开源项目上进行合作。</p></div></div>    
</body>
</html>