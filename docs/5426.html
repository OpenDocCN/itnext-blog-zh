<html>
<head>
<title>5 useful PHPUnit Assertions you should start using today</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">今天你应该开始使用的5个有用的PHPUnit断言</h1>
<blockquote>原文：<a href="https://itnext.io/phpunit-assertions-fabd4b16df38?source=collection_archive---------4-----------------------#2021-03-02">https://itnext.io/phpunit-assertions-fabd4b16df38?source=collection_archive---------4-----------------------#2021-03-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/146ae8da40d9798b2b3683dc76765d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rj5s9wKbQrlEulfgjvUaPw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://unsplash.com/@benofthenorth?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">本</a>在<a class="ae kf" href="https://unsplash.com/photos/Bj6ENZDMSDY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="2f82" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">PHPUnit击败竞争对手已经超过5年了。通过使用正确的PHPUnit断言，您可以从PHPUnit中获得最大的好处。在本帖中，我们将研究一些流行且非常有用的PHPUnit断言，您应该在日常的PHPUnit测试中使用它们。让我们开始吧！</p><h1 id="93f3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">需要了解的PHPUnit断言</h1><p id="bfdb" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">目前，PHPUnit处于版本<a class="ae kf" href="https://github.com/sebastianbergmann/phpunit/releases/tag/9.5.0" rel="noopener ugc nofollow" target="_blank"> 9.5 </a>。根据最新的<a class="ae kf" href="https://phpunit.readthedocs.io/en/9.5/assertions.html" rel="noopener ugc nofollow" target="_blank">文档</a>，有60个assert方法可以在PHPUnit测试中使用。</p><blockquote class="mh"><p id="1286" class="mi mj it bd mk ml mm mn mo mp mq ld dk translated"><em class="mr">这些PHPUnit断言的范围从检查</em> <a class="ae kf" href="https://phpunit.readthedocs.io/en/9.5/assertions.html#assertarrayhaskey" rel="noopener ugc nofollow" target="_blank"> <em class="mr">数组是否有键</em> </a> <em class="mr">到一直流行的</em> <a class="ae kf" href="https://phpunit.readthedocs.io/en/9.5/assertions.html#assertequals" rel="noopener ugc nofollow" target="_blank"> <em class="mr">断言等于</em> </a> <em class="mr">到不那么广泛使用的</em> <a class="ae kf" href="https://phpunit.readthedocs.io/en/9.5/assertions.html#assertxmlstringequalsxmlstring" rel="noopener ugc nofollow" target="_blank"> <em class="mr"> XML字符串比较</em> </a> <em class="mr"> PHPUnit断言。</em></p></blockquote><h1 id="a1cf" class="le lf it bd lg lh li lj lk ll lm ln lo lp ms lr ls lt mt lv lw lx mu lz ma mb bi translated">分析PHPUnit断言在小型、中型和大型项目中的使用</h1><p id="d625" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了了解在我过去几年参与的项目中哪些PHPUnit断言使用得最多，我运行了以下命令:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><blockquote class="nb nc nd"><p id="641e" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">上面的命令应该运行在你的</em> <code class="fe ni nj nk nl b"><em class="it">tests</em></code> <em class="it">文件夹中。它主要在代码中寻找</em> <code class="fe ni nj nk nl b"><em class="it">&gt;assert*</em></code> <em class="it">并对它们进行排序，然后统计唯一出现的次数，并在出现次数最多的末尾再次排序。</em></p></blockquote><p id="58fe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将采取三个项目，一个小的，第二个中型的，第三个是大型的。规模不仅仅是代码，还包括项目中测试和断言的数量。</p><blockquote class="nb nc nd"><p id="da3b" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">这些项目是用Symfony和另一个框架构建的。其中两个是REST APIs，其中一个大的也有用户界面。</em></p></blockquote><h1 id="6433" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">带有PHPUnit断言的小项目</h1><p id="5278" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">用Symfony作为REST API构建的小项目只有104个测试和306个PHPUnit断言。在该项目的tests文件夹上执行上述命令时，会产生以下输出:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/0580ea635eee5ab580e01555c905940c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ToFag7m1CXB4uaV4BDuLig.jpeg"/></div></div></figure><blockquote class="nb nc nd"><p id="9e06" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">我们可以看到，这个项目中使用最多的PHPUnit断言是</em> <code class="fe ni nj nk nl b"><em class="it">assertEquals</em></code> <em class="it">，它被使用了73次。</em></p></blockquote><p id="c987" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，<code class="fe ni nj nk nl b">assertSame</code>在这个相对较小的项目中使用了51次。这意味着这个项目几乎四分之一的PHPUnit断言是<code class="fe ni nj nk nl b">assertEquals</code>。</p><h1 id="c055" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">PHPUnit断言理事会的中型项目</h1><p id="6317" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">用Symfony(一个REST API)构建的中型项目有221个测试和472个PHPUnit断言。上面的命令在它的tests目录下运行时看起来如下:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/a62ceb39025798c48fe3dcdad5768a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8LILUJ1RGZOR4GvM9ocMA.jpeg"/></div></div></figure><blockquote class="nb nc nd"><p id="634d" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">我们可以清楚的看到</em> <code class="fe ni nj nk nl b"><em class="it">assertSame</em></code> <em class="it">和</em> <code class="fe ni nj nk nl b"><em class="it">assertEquals</em></code> <em class="it">在这个小项目中使用次数最多，各有37次。</em></p></blockquote><p id="e673" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">断言的数量加起来不到221，因为在这些测试中使用了大量的<a class="ae kf" href="https://geshan.com.np/blog/2014/02/using-phpunit-data-provider-for-less/" rel="noopener ugc nofollow" target="_blank"> PHPUnit数据提供者</a>。</p><p id="4599" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">尽管如此，<code class="fe ni nj nk nl b">assertSame</code>和<code class="fe ni nj nk nl b">assertEquals</code>仍然占据了这个项目中使用的断言的16%。最近，我们将代码覆盖驱动从Xdebug改为PCov。这使得测试覆盖更快。如果你感兴趣，我过去也在Laravel 中写过关于<a class="ae kf" href="https://geshan.com.np/blog/2015/07/getting-started-with-unit-testing-in-laravel/" rel="noopener ugc nofollow" target="_blank">单元测试的博客。</a></p><h1 id="0a59" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">一个计算PHPUnit断言的大项目</h1><p id="318e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">接下来是大型项目，它既有API又有用户界面。它有单元测试和一些集成测试。这个项目有多达5824个测试和13975个PHPUnit断言。当我们在这个项目的tests文件夹上运行上面的PHPUnit断言计数器命令时，它会产生:</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/786db4b111450d3c5acd530229aad2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VQE7XeYWKx16DDle-J1KA.jpeg"/></div></div></figure><blockquote class="nb nc nd"><p id="f246" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">即使在这里，</em> <code class="fe ni nj nk nl b"><em class="it">assertEquals</em></code> <em class="it">仍然是使用最多的PHPUnit断言，出现了3145次。</em></p></blockquote><p id="3c41" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这占测试套件中所有断言的22.5%。接下来是被使用了942次的<code class="fe ni nj nk nl b">assertTrue</code>，这使得它获得了6.74%的份额。让我们看看更多的PHPUnit断言，它们非常有帮助，但不是那么明显。</p><h1 id="e96a" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">PHPUnit断言剖析</h1><p id="2bde" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">PHPUnit中的断言遵循一种模式，例如，<code class="fe ni nj nk nl b">assertEquals</code>接受3个参数。第一个是<code class="fe ni nj nk nl b">expected</code>，第二个是<code class="fe ni nj nk nl b">actual</code>，第三个可选但很重要的是<code class="fe ni nj nk nl b">message</code>。</p><blockquote class="nb nc nd"><p id="655c" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">当测试失败时，打印该消息。</em></p></blockquote><p id="90e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如下面的测试:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="819a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将导致:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8687" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意<code class="fe ni nj nk nl b">check if 1 is 1</code>，这些类型的消息将有助于您调试哪些测试没有通过以及如何修复它们。</p><h1 id="0d8b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">一些你今天必须开始使用的PHPUnit断言</h1><p id="2ace" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">过去，我在60多种可用的PHPUnit断言中使用了许多。以下是其中一些特别有用的方法:</p><h2 id="a5f5" class="nn lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">assertjsonstring equalsjsonstring</h2><p id="d216" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这个PHPUnit断言在测试API的响应时非常方便。您可以使用这个<code class="fe ni nj nk nl b">assertJsonStringEqualsJsonString</code>断言来检查接收到的JSON响应是否符合您的预期。要匹配JSON字符串，您可以这样做:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="21d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个是关于正则表达式匹配的。</p><h2 id="b046" class="nn lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">assertMatchesRegularExpression或assertRegExp</h2><p id="9068" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">顾名思义，断言将匹配正则表达式。我发现测试以某事开始或具有已定义模式的错误消息很有帮助。它在PHPUnit <a class="ae kf" href="https://phpunit.readthedocs.io/en/8.5/assertions.html#assertregexp" rel="noopener ugc nofollow" target="_blank"> 8.5 </a>中被称为<code class="fe ni nj nk nl b">assertRegExp</code>。以下是检查字符串<code class="fe ni nj nk nl b">Exception 40\d</code> so 40和任何数字的示例，下面的测试将作为测试字符串<code class="fe ni nj nk nl b">Exception 501</code>:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="d99d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个是关于弦乐的。</p><h2 id="2d37" class="nn lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">assertStringContainsString</h2><p id="bac1" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这也是检查给定字符串是否有另一个字符串的一个非常方便的断言。如果你想忽略字母大小写，你可以使用<code class="fe ni nj nk nl b">assertStringContainsStringIgnoringCase</code>。<code class="fe ni nj nk nl b">assertStringStartsWith</code>和<code class="fe ni nj nk nl b">assertStringEndsWith</code> PHPUnit断言也非常有用。下面是字符串包含字符串的快速示例:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="983f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们有了非常流行的assert Equals PHPUnit断言。</p><h2 id="1bb8" class="nn lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">资产质量与增量</h2><p id="d23e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">另一个有用的PHPUnit断言是<code class="fe ni nj nk nl b">assertEqualsWithDelta</code>。当你有一个预期会有一些变化的测试时，这个断言是非常有用的。下面是一个例子:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="e7d7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随后，我们有了一个与PHP数组相关的PHPUnit断言。</p><h2 id="2f2b" class="nn lf it bd lg no np dn lk nq nr dp lo kr ns nt ls kv nu nv lw kz nw nx ma ny bi translated">阿瑟塔拉·哈斯基</h2><p id="21ad" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">PHPUnit中的<code class="fe ni nj nk nl b">assertArrayHasKey</code>断言也很有帮助。如果您使用的数组是返回类型，那么您可以使用该断言在检查值之前检查返回的数组是否有某个键。下面是一个实际PHPUnit断言的例子:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="3076" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在这个<a class="ae kf" href="https://gist.github.com/geshan/75153b39e6277dd8ece4048cf1d44ae5" rel="noopener ugc nofollow" target="_blank">要点</a>中查看所有5个PHPUnit断言的例子。</p><h1 id="64ee" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="87ca" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">您也可以在这个<a class="ae kf" href="https://gist.github.com/briankip/35e3506be8b1ecbcf3bb" rel="noopener ugc nofollow" target="_blank">列表</a>中找到PHPUnit断言的列表。</p><blockquote class="nb nc nd"><p id="3447" class="kg kh ne ki b kj kk kl km kn ko kp kq nf ks kt ku ng kw kx ky nh la lb lc ld im bi translated"><em class="it">在连接2或3个PHPUnit断言之前，请检查</em> <a class="ae kf" href="https://phpunit.readthedocs.io/en/9.5/assertions.html" rel="noopener ugc nofollow" target="_blank"> <em class="it">文档</em> </a> <em class="it">中是否有适合您的用例的现有断言。</em></p></blockquote><p id="5a55" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据需要，您还可以编写您的<a class="ae kf" href="https://matthiasnoback.nl/2012/02/phpunit-writing-a-custom-assertion/" rel="noopener ugc nofollow" target="_blank">自定义断言</a>。PHPUnit测试快乐！</p></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="225b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ne">原载于</em><a class="ae kf" href="https://geshan.com.np/blog/2021/01/phpunit-assertions/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://geshan.com.np</em></a></p></div></div>    
</body>
</html>