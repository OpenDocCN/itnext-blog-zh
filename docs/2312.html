<html>
<head>
<title>Dropbox to S3: How to port all that data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dropbox到S3:如何移植所有数据</h1>
<blockquote>原文：<a href="https://itnext.io/dropbox-to-s3-how-to-port-all-that-data-5cebae6d6e40?source=collection_archive---------5-----------------------#2019-05-05">https://itnext.io/dropbox-to-s3-how-to-port-all-that-data-5cebae6d6e40?source=collection_archive---------5-----------------------#2019-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="899d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为当你看到信用卡上每月10美元的dropbox费用时，你会想“我可以做得更好”。</p><p id="bd5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你和我一样，你已经丢失了损坏的硬盘上的数据。随着时间的推移，我们开始学习并把我们的电脑备份到云端。此外，有了像Dropbox和Google Drive这样的强大选项，这很容易，但在免费空间用完之后，我们必须满足于每月的费用吗？还是有B计划？</p><h1 id="3ba3" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">钱</h1><p id="232f" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">迄今为止，Dropbox对1TB的空间每月收费10美元。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/8872a5bd98b3f8583dca50cc261f2a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5S3wMgqVge2uPhUYOm2BA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><a class="ae me" href="https://www.dropbox.com/individual/plans-comparison" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/individual/plans-comparison</a></figcaption></figure><p id="432a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">亚马逊S3每月每GB收费0.023美元。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mf"><img src="../Images/75f36105d3ba35d886d8e37a660387e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hJ3NnCGYpjEOWQeOAJV2g.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">https://aws.amazon.com/s3/pricing/?nc1=h_ls<a class="ae me" href="https://aws.amazon.com/s3/pricing/?nc1=h_ls" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="2900" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，如果你打算存储超过434 GB的数据，更经济的选择是Dropbox，少于434 GB的话，你可以用S3来省钱。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="b0c8" class="ml km iq mh b gy mm mn l mo mp">434GB*0.023 = $9.98</span></pre><h1 id="5e80" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">物流</h1><p id="ecef" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在决定移动我的数据后，下一个意识是这些年来我收集了多少数据。这与450GB的盈亏平衡点相去甚远，但77GB仍然超出了我想下载到我的本地计算机的容量，因为我不得不再次上传和删除。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4ad8f1b428950ec176e2e55eb750bde9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*dkIngVc20LY5oY0_mGd5JA.png"/></div></figure><p id="5296" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">答案是启动一个专用于数据传输的临时EC2实例。该实例将同步到我的Dropbox，下载所有数据，然后将这些数据推送到s3存储桶进行长期存储。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/15bbbb205dd02204d987a2bfa1edad8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*8AQAbH5EE-VvqLpJexBeXA.png"/></div></figure><h2 id="ba2d" class="ml km iq bd kn ms mt dn kr mu mv dp kv jy mw mx kz kc my mz ld kg na nb lh nc bi translated"><strong class="ak"> DropBox账号</strong></h2><p id="82dd" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">要估计您需要移动多少数据，请查看您的DropBox帐户页面上的用户下拉列表。</p><h2 id="1df5" class="ml km iq bd kn ms mt dn kr mu mv dp kv jy mw mx kz kc my mz ld kg na nb lh nc bi translated">EC2实例</h2><p id="727b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">该实例是一台<strong class="jp ir"> m5.large </strong>机器上的一个<strong class="jp ir"> Ubuntu Server 18.04 LTS </strong>。我个人有77GB的数据，所以我选择添加100 GiB的实例存储(1GB等于0.931323 GiB) <a class="ae me" href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-custom-ami-boot-volume-size.html" rel="noopener ugc nofollow" target="_blank"> * </a>。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nd"><img src="../Images/2cb1d42e779f2b360cbf2a1547e69c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mV3Bc99i_sJifCAZNzZY9g.png"/></div></div></figure><p id="7c62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为该实例分配一个对您将存储数据的S3存储桶具有读/写权限的角色，这一点很重要。快速而肮脏的方法是给角色<strong class="jp ir"> AmazonS3FullAccess </strong>。然而，更安全和更可取的方法是修改JSON文件中的<em class="ne">资源</em>字段，使其只包含目标bucket。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/aebdaa90bd07627bd1ed9967d3083a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*t3mNAZmK5Z5sRvoLts6ZBA.png"/></div></figure><h2 id="ea95" class="ml km iq bd kn ms mt dn kr mu mv dp kv jy mw mx kz kc my mz ld kg na nb lh nc bi translated">S3水桶</h2><p id="310b" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">S3铲斗可以是现有的，也可以是新的，只要最适合您的情况。也就是说，建议将其保存在与EC2实例相同的区域中，以减少延迟。</p><h1 id="21f7" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">设置</h1><p id="f1e9" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">启动所有资源后，我们将需要ssh到EC2实例。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="2ae2" class="ml km iq mh b gy mm mn l mo mp">ssh -i *YOUR-PEM-FILE-LOCATION* ubuntu@**YOUR-EC2-ADDRESS*</span></pre><p id="0eb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是修改<em class="ne"> inotify.max_users。</em>这些实体用于监控Linux操作系统中的单个文件或目录。然而，在我们的例子中，我们将移动如此多的文件，以至于默认的最大用户数将导致系统错误并停止DropBox同步。</p><p id="690d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要避免这种情况，请将该设置至少增加到100，000，并重新启动实例。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="a8d5" class="ml km iq mh b gy mm mn l mo mp">echo fs.inotify.max_user_watches=100000 | sudo tee -a /etc/sysctl.conf; sudo sy$</span><span id="a475" class="ml km iq mh b gy ng mn l mo mp">sudo reboot</span></pre><p id="1d21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新启动将终止ssh会话，因此您需要再次连接。</p><h1 id="6582" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">同步DropBox</h1><p id="0caf" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">现在实例已经准备好了，我们可以将Dropbox帐户同步到它。下载/解压官方的Linux64 tar文件，运行预先配置好的安装脚本(<em class="ne"> dropboxd </em>)。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="379b" class="ml km iq mh b gy mm mn l mo mp">cd ~ &amp;&amp; wget -O - "<a class="ae me" href="https://www.dropbox.com/download?plat=lnx.x86_64" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/download?plat=lnx.x86_64</a>" | tar xzf -</span><span id="7da4" class="ml km iq mh b gy ng mn l mo mp">~/.dropbox-dist/dropboxd</span></pre><p id="2705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你运行<em class="ne"> dropboxd </em>脚本时，它会输出一个链接到DropBox网页，要求你验证你是一个真实的人，你想同步帐户。将此链接复制粘贴到浏览器中并确认。</p><p id="031a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确认帐户后，<em class="ne"> dropboxd </em>脚本将需要继续运行，直到实例终止。这意味着您需要从另一个终端再次ssh到该实例，以完成剩余的任务。</p><p id="13a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一种方法是将<em class="ne"> dropboxd </em>脚本的输出写入一个文本文件。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="dec1" class="ml km iq mh b gy mm mn l mo mp">~/.dropbox-dist/dropboxd &gt;&gt; DropBoxSync_output.txt 2&gt;&amp;1</span></pre><p id="3d57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下，您将需要读取tail<em class="ne">Dropbox sync _ output . txt</em>文件的结尾来获取网页链接。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="0116" class="ml km iq mh b gy mm mn l mo mp">tail ~/DropBoxSync_output.txt</span></pre><p id="1eb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该实例现已同步到DropBox，并将开始自动下载您的所有文件。</p><h1 id="a980" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">同步到S3</h1><p id="d331" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">将我们的整个DropBox驱动器下载到实例后，最后一步是将数据从EC2实例传输到S3存储桶。</p><p id="400c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们必须安装AWS命令行。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="f4de" class="ml km iq mh b gy mm mn l mo mp">sudo apt -y install awscli</span></pre><p id="eb15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们将数据推送到S3。</p><pre class="lp lq lr ls gt mg mh mi mj aw mk bi"><span id="35e4" class="ml km iq mh b gy mm mn l mo mp">aws s3 sync ~/Dropbox s3://**YOUR-BUCKET-LOCATION**/Dropbox</span></pre><h1 id="ae94" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">完成</h1><p id="15e8" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">就是这样。根据您要移动的数据量，该过程可能需要几分钟到几天的时间。最好监控S3存储桶大小(字节)指标，以了解有多少百分比的数据已经被传输。</p></div></div>    
</body>
</html>