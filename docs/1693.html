<html>
<head>
<title>Integrating DropzoneJS with a JavaScript Image Cropper to Optimise Image Uploads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">集成DropzoneJS和JavaScript图像裁剪器来优化图像上传</h1>
<blockquote>原文：<a href="https://itnext.io/integrating-dropzone-with-javascript-image-cropper-optimise-image-upload-e22b12ac0d8a?source=collection_archive---------0-----------------------#2019-01-03">https://itnext.io/integrating-dropzone-with-javascript-image-cropper-optimise-image-upload-e22b12ac0d8a?source=collection_archive---------0-----------------------#2019-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cd80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将集成Dropzone与三个不同的图像裁剪插件，以优化图像数据上传到服务器之前。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/578a8c2546423b0a7e6302688dd9e965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*atO19Z0pHrGmOgRdqIGbSQ.jpeg"/></div></div></figure><p id="35ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们能在图像发送到服务器之前对其进行优化，那不是很好吗？这可以节省带宽，使数据库更干净，并允许用户对自己的内容有更多的控制。使用本文中描述的技术，使您的用户能够编辑他们上传到服务器的个人资料图片、相册或任何其他图像。</p><p id="32bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将设置一个基本的<a class="ae kx" href="https://www.dropzonejs.com" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">drop zone js</strong></a>vanilla JavaScript拖放区，扩展它以更好地与第三方图像裁剪器集成，然后展示如何将它与三个流行的图像裁剪器链接起来:<a class="ae kx" href="https://github.com/fengyuanchen/cropperjs" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Cropper.js </strong> </a>、<a class="ae kx" href="https://github.com/foliotek/croppie" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Croppie </strong> </a>，最后但同样重要的是<a class="ae kx" href="https://pqina.nl/doka/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">多卡</strong> </a></p><p id="3ed7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们先从设置DropzoneJS开始。</p><h1 id="ea05" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">设置拖放区JS</h1><p id="a13b" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">我们将创建一个基本的HTML页面，并添加DropzoneJS样式和脚本，如下所示。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="a4ce" class="mg kz iq mc b gy mh mi l mj mk">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;JavaScript Image Cropping with DropzoneJS&lt;/title&gt;<br/>  <strong class="mc ir">&lt;link href="https://unpkg.com/dropzone/dist/dropzone.css" rel="stylesheet"/&gt;</strong><br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  <strong class="mc ir">&lt;div class="dropzone" id="myDropzone"&gt;&lt;/div&gt;</strong><br/>  <strong class="mc ir">&lt;script src="https://unpkg.com/dropzone"&gt;&lt;/script&gt;</strong><br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="332c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置好基本页面后，我们现在可以专注于配置DropzoneJS了。在它要做任何事情之前，它希望我们设置一个上传文件的位置，让我们现在就这样做。我们可以使用分配给DropzoneJS <code class="fe ml mm mn mc b">&lt;div&gt;</code>的<code class="fe ml mm mn mc b">id</code>将选项传递给我们特定的上传者。</p><p id="0e0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们已经放大了刚刚结束</em> <code class="fe ml mm mn mc b"><em class="mo">body</em></code> <em class="mo">标签之前的代码。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="79a2" class="mg kz iq mc b gy mh mi l mj mk">&lt;div class="dropzone" id="myDropzone"&gt;&lt;/div&gt;<br/>&lt;script src="https://unpkg.com/dropzone"&gt;&lt;/script&gt;</span><span id="11ba" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">&lt;script&gt;<br/>Dropzone.options.myDropzone = {<br/> url: '/post'<br/>};<br/>&lt;/script&gt;</strong></span></pre><p id="174e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在应该看到页面上出现以下内容，如果我们拖放一个图像，DropzoneJS将显示一个小缩略图。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/db02b9259b2a505f0c5e98447184b84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*sTcXQ-aM2zLTUeDjjTSOWA.gif"/></div></figure><p id="947b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在服务器上处理文件对象，就像使用经典多部分表单的<code class="fe ml mm mn mc b">&lt;input type=”file”/&gt;</code>提交普通文件一样。本教程将侧重于在图像上传到服务器之前，在前端编辑图像。因此，我们将暂时保留服务器解决方案。</p><h1 id="7b6b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">用图像编辑器弹出窗口扩展Dropzone</h1><p id="9c1f" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">Dropzone有一个名为<code class="fe ml mm mn mc b">transformFile</code>的特殊回调函数，当这个函数被调用时，我们可以让用户编辑一个文件。让我们</p><p id="e5c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们已经放大了</em> <code class="fe ml mm mn mc b"><em class="mo">&lt;script&gt;</em></code> <em class="mo">标签内的代码。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="9553" class="mg kz iq mc b gy mh mi l mj mk">Dropzone.options.myDropzone = {<br/>  url: '/post',<br/>  <strong class="mc ir">transformFile: function(file, done) { </strong></span><span id="aabc" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">  }</strong><br/>};</span></pre><p id="88a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dropzone锁定。编辑完文件后，我们需要调用<code class="fe ml mm mn mc b">done</code>函数(第二个参数),我们会记住这一点。就目前而言，这很好。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/b2775fa15fdb12ca342d975b947403b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*HSDOae5oZMFvlDRGVfDn1w.gif"/></div></figure><p id="c93c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，我们想要在一个图像编辑器覆盖图中编辑文件，在Dropzone的顶部，这自动地移动用户焦点到编辑器。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="e91d" class="mg kz iq mc b gy mh mi l mj mk">transformFile: function(file, done) {</span><span id="1dbe" class="mg kz iq mc b gy mp mi l mj mk">  // Create the image editor overlay<br/>  <strong class="mc ir">var editor = document.createElement('div');<br/>  editor.style.position = 'fixed';<br/>  editor.style.left = 0;<br/>  editor.style.right = 0;<br/>  editor.style.top = 0;<br/>  editor.style.bottom = 0;<br/>  editor.style.zIndex = 9999;<br/>  editor.style.backgroundColor = '#000';<br/>  document.body.appendChild(editor);</strong></span><span id="6ec3" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="b021" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的结果看起来各种各样的错误，但它实际上是我们想要的。黑色层将是我们稍后编辑的位置。坚持住。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/b9e548e1b97caf242a5b61f7077cbec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*fmQSsmXpciiS32creN6rRg.gif"/></div></figure><p id="80a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要一种方法来逃离这个黑色的空白，所以让我们向编辑器元素添加一个带有click事件的按钮。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="672e" class="mg kz iq mc b gy mh mi l mj mk">transformFile: function(file, done) {</span><span id="6af1" class="mg kz iq mc b gy mp mi l mj mk">  // Create the image editor overlay<br/>  var editor = document.createElement('div');<br/>  editor.style.position = 'fixed';<br/>  editor.style.left = 0;<br/>  editor.style.right = 0;<br/>  editor.style.top = 0;<br/>  editor.style.bottom = 0;<br/>  editor.style.zIndex = 9999;<br/>  editor.style.backgroundColor = '#000';<br/>  document.body.appendChild(editor);</span><span id="e874" class="mg kz iq mc b gy mp mi l mj mk">  // Create confirm button at the top left of the viewport<br/>  <strong class="mc ir">var buttonConfirm = document.createElement('button');<br/>  buttonConfirm.style.position = 'absolute';<br/>  buttonConfirm.style.left = '10px';<br/>  buttonConfirm.style.top = '10px';<br/>  buttonConfirm.style.zIndex = 9999;<br/>  buttonConfirm.textContent = 'Confirm';<br/>  editor.appendChild(buttonConfirm);<br/>  buttonConfirm.addEventListener('click', function() {</strong></span><span id="2820" class="mg kz iq mc b gy mp mi l mj mk">    // Remove the editor from the view<br/>    <strong class="mc ir">document.body.removeChild(editor);</strong></span><span id="17a8" class="mg kz iq mc b gy mp mi l mj mk">  <strong class="mc ir">});</strong></span><span id="9304" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="4a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶！我们现在可以逃离虚空。精彩！</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a7c9857e7c28d61468d78e05f9441147.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*x85rH-odZww7iQumQ5OCEw.gif"/></div></figure><p id="ad9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们需要设置的与第一个和第二个图像裁剪器候选对象集成的全部内容，让我们试一试Cropper.js。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="6edf" class="ky kz iq bd la lb my ld le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv bi translated">将Dropzone与Cropper.js集成</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/d8a9729cbd61b59e0c69f17084805e9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lrxxiFyoHt0v5GWbYMwZg.png"/></div></figure><p id="9e36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是时候连接我们的第一个图像裁剪器了。让我们添加<a class="ae kx" href="https://github.com/fengyuanchen/cropperjs" rel="noopener ugc nofollow" target="_blank"> Cropper.js </a>所需的样式和脚本。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="a204" class="mg kz iq mc b gy mh mi l mj mk">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;JavaScript Image Cropping with DropzoneJS&lt;/title&gt;<br/>  &lt;link href="https://unpkg.com/dropzone/dist/dropzone.css" rel="stylesheet"/&gt;<br/>  <strong class="mc ir">&lt;link href="https://unpkg.com/cropperjs/dist/cropper.css" rel="stylesheet"/&gt;</strong><br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;div class="dropzone" id="myDropzone"&gt;&lt;/div&gt;<br/>  &lt;script src="https://unpkg.com/dropzone"&gt;&lt;/script&gt;<br/>  <strong class="mc ir">&lt;script src="https://unpkg.com/cropperjs"&gt;&lt;/script&gt;<br/></strong>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="abc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切还是老样子，没关系。</p><p id="79dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们将Cropper.js添加到编辑器元素中，并加载拖放的图像。Cropper.js需要一个<code class="fe ml mm mn mc b">&lt;img&gt;</code>元素，所以让我们将<code class="fe ml mm mn mc b">file</code>对象转换成一个URL，并将其提供给一个新的图像。</p><p id="79ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们已经放大了</em> <code class="fe ml mm mn mc b"><em class="mo">transformFile</em></code> <em class="mo">函数本身。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="7c35" class="mg kz iq mc b gy mh mi l mj mk">transformFile: function(file, done) {</span><span id="a6a2" class="mg kz iq mc b gy mp mi l mj mk">  // Create the image editor overlay<br/>  var editor = document.createElement('div');<br/>  editor.style.position = 'fixed';<br/>  editor.style.left = 0;<br/>  editor.style.right = 0;<br/>  editor.style.top = 0;<br/>  editor.style.bottom = 0;<br/>  editor.style.zIndex = 9999;<br/>  editor.style.backgroundColor = '#000';<br/>  document.body.appendChild(editor);</span><span id="fa2b" class="mg kz iq mc b gy mp mi l mj mk">  // Create confirm button at the top left of the viewport<br/>  var buttonConfirm = document.createElement('button');<br/>  buttonConfirm.style.position = 'absolute';<br/>  buttonConfirm.style.left = '10px';<br/>  buttonConfirm.style.top = '10px';<br/>  buttonConfirm.style.zIndex = 9999;<br/>  buttonConfirm.textContent = 'Confirm';<br/>  editor.appendChild(buttonConfirm);<br/>  buttonConfirm.addEventListener('click', function() {</span><span id="66b3" class="mg kz iq mc b gy mp mi l mj mk">    // Remove the editor from the view<br/>    document.body.removeChild(editor);</span><span id="c5dc" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">  </strong>});</span><span id="0994" class="mg kz iq mc b gy mp mi l mj mk">  // Create an image node for Cropper.js<br/><strong class="mc ir">  var image = new Image();<br/>  image.src = URL.createObjectURL(file);<br/>  editor.appendChild(image);<br/>  <br/>  </strong>// Create Cropper.js<br/>  <strong class="mc ir">var cropper = new Cropper(image, { aspectRatio: 1 });</strong></span><span id="2a97" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="2043" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Cropper.js现在可以在编辑器弹出窗口中打开拖放的图像。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/d0c08695c99ec8340e696343d425ab1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*S9SHM4izvzaYzwFTA8ysIw.gif"/></div></figure><p id="5deb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们点击按钮时，编辑器关闭。我们希望它告诉Cropper.js进行裁剪并更新DropzoneJS文件。</p><p id="6900" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们放大了确认按钮addEventListener函数。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="d5f1" class="mg kz iq mc b gy mh mi l mj mk">buttonConfirm.addEventListener('click', function() {</span><span id="96f2" class="mg kz iq mc b gy mp mi l mj mk">  // Get the canvas with image data from Cropper.js<br/>  <strong class="mc ir">var canvas = cropper.getCroppedCanvas({<br/>    width: 256,<br/>    height: 256<br/>  });</strong></span><span id="8065" class="mg kz iq mc b gy mp mi l mj mk">  // Turn the canvas into a Blob (file object without a name)<br/>  <strong class="mc ir">canvas.toBlob(function(blob) {</strong></span><span id="60cf" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">    </strong>// Return the file to Dropzone<strong class="mc ir"><br/>    done(blob);</strong></span><span id="ba17" class="mg kz iq mc b gy mp mi l mj mk">  <strong class="mc ir">});</strong></span><span id="0867" class="mg kz iq mc b gy mp mi l mj mk">  // Remove the editor from the view<strong class="mc ir"><br/>  </strong>document.body.removeChild(editor);</span><span id="e5ba" class="mg kz iq mc b gy mp mi l mj mk">});</span></pre><p id="1933" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">奇怪！文件缩略图不会更新。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2e3f33d8cb2057ee672323a03bdd5366.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*FrJeY_5c1al2EflYnlRaQQ.gif"/></div></figure><p id="ddd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dropzone不会自动创建新缩略图。我们将不得不指示它根据更新后的文件重新绘制它。我们可以使用Dropzone <code class="fe ml mm mn mc b">createThumbnail</code>函数来实现。但是由于我们需要访问Dropzone实例，我们还必须创建对该实例的引用(我们称之为<code class="fe ml mm mn mc b">myDropZone</code>)。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="fc52" class="mg kz iq mc b gy mh mi l mj mk">transformFile: function(file, done) {</span><span id="b29c" class="mg kz iq mc b gy mp mi l mj mk">  // Create Dropzone reference for use in confirm button click handler<br/>  <strong class="mc ir">var myDropZone = this;</strong></span><span id="78af" class="mg kz iq mc b gy mp mi l mj mk">  // Create the image editor overlay<br/>  var editor = document.createElement('div');<br/>  editor.style.position = 'fixed';<br/>  editor.style.left = 0;<br/>  editor.style.right = 0;<br/>  editor.style.top = 0;<br/>  editor.style.bottom = 0;<br/>  editor.style.zIndex = 9999;<br/>  editor.style.backgroundColor = '#000';<br/>  document.body.appendChild(editor);</span><span id="bb26" class="mg kz iq mc b gy mp mi l mj mk">  // Create confirm button at the top left of the viewport<br/>  var buttonConfirm = document.createElement('button');<br/>  buttonConfirm.style.position = 'absolute';<br/>  buttonConfirm.style.left = '10px';<br/>  buttonConfirm.style.top = '10px';<br/>  buttonConfirm.style.zIndex = 9999;<br/>  buttonConfirm.textContent = 'Confirm';<br/>  editor.appendChild(buttonConfirm);<br/>  buttonConfirm.addEventListener('click', function() {</span><span id="15db" class="mg kz iq mc b gy mp mi l mj mk">    // Get the canvas with image data from Cropper.js<br/>    var canvas = cropper.getCroppedCanvas({<br/>      width: 256,<br/>      height: 256<br/>    });</span><span id="70f4" class="mg kz iq mc b gy mp mi l mj mk">    // Turn the canvas into a Blob (file object without a name)<br/>    canvas.toBlob(function(blob) {</span><span id="ee6f" class="mg kz iq mc b gy mp mi l mj mk">      // Create a new Dropzone file thumbnail<br/>      <strong class="mc ir">myDropZone.createThumbnail(<br/>        blob,<br/>        myDropZone.options.thumbnailWidth,<br/>        myDropZone.options.thumbnailHeight,<br/>        myDropZone.options.thumbnailMethod,<br/>        false, <br/>        function(dataURL) {<br/>          <br/>          </strong>// Update the Dropzone file thumbnail<strong class="mc ir"><br/>          myDropZone.emit('thumbnail', file, dataURL);</strong></span><span id="b76e" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">          </strong>// Return the file to Dropzone<strong class="mc ir"><br/>          done(blob);</strong></span><span id="3576" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">      });</strong></span><span id="e3cb" class="mg kz iq mc b gy mp mi l mj mk">    });</span><span id="2e5c" class="mg kz iq mc b gy mp mi l mj mk">    // Remove the editor from the view<strong class="mc ir"><br/>    </strong>document.body.removeChild(editor);</span><span id="6e60" class="mg kz iq mc b gy mp mi l mj mk">  });</span><span id="6ab2" class="mg kz iq mc b gy mp mi l mj mk">  // Create an image node for Cropper.js<br/><strong class="mc ir">  </strong>var image = new Image();<br/>  image.src = URL.createObjectURL(file);<br/>  editor.appendChild(image);<strong class="mc ir"><br/>  <br/>  </strong>// Create Cropper.js<br/>  var cropper = new Cropper(image, { aspectRatio: 1 });</span><span id="bb22" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="9e86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！</p><p id="26fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参见下面的动画了解最终的解决方案，或者使用CodePen 上的代码<a class="ae kx" href="https://codepen.io/rikschennink/pen/de53582f0ce6d723a47e0a99716a8cfd" rel="noopener ugc nofollow" target="_blank">进行试验。</a></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/167bbdf72e0658dcccc5a76b565c84d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*gzlT7cUFz11VoDquaWpK6w.gif"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">DropzoneJS和Cropper.js集成</figcaption></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="f8f7" class="ky kz iq bd la lb my ld le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv bi translated">连接作物</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/9826252703e005fa6b26a951b48a9421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzRM_tryTAG0Y4yoLp6Euw.png"/></div></div></figure><p id="a832" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">链接DropzoneJS和<a class="ae kx" href="https://github.com/foliotek/croppie" rel="noopener ugc nofollow" target="_blank"> Croppie </a>所需的大量代码与我们刚刚看到的Cropper.js相同。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="c190" class="mg kz iq mc b gy mh mi l mj mk">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;JavaScript Image Cropping with DropzoneJS&lt;/title&gt;<br/>  &lt;link href="https://unpkg.com/dropzone/dist/dropzone.css" rel="stylesheet"/&gt;<br/>  <strong class="mc ir">&lt;link href="https://unpkg.com/croppie/croppie.css" rel="stylesheet"/&gt;</strong><br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;div class="dropzone" id="myDropzone"&gt;&lt;/div&gt;<br/>  &lt;script src="https://unpkg.com/dropzone"&gt;&lt;/script&gt;<br/>  <strong class="mc ir">&lt;script src="https://unpkg.com/croppie"&gt;&lt;/script&gt;</strong><br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ced4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">加载正确的文件后，我们可以放大<code class="fe ml mm mn mc b">transformFile</code>功能。Croppie可以加载一个<code class="fe ml mm mn mc b">file</code>对象，而不需要先创建一个图像，它需要一个URL。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="9fc5" class="mg kz iq mc b gy mh mi l mj mk">function(file, done) {</span><span id="5d62" class="mg kz iq mc b gy mp mi l mj mk">  // Create Dropzone reference for use in confirm button click handler<br/>  var myDropZone = this;</span><span id="6757" class="mg kz iq mc b gy mp mi l mj mk">  // Create the image editor overlay<br/>  var editor = document.createElement('div');<br/>  editor.style.position = 'fixed';<br/>  editor.style.left = 0;<br/>  editor.style.right = 0;<br/>  editor.style.top = 0;<br/>  editor.style.bottom = 0;<br/>  editor.style.zIndex = 9999;<br/>  editor.style.backgroundColor = '#000';<br/>  document.body.appendChild(editor);</span><span id="5bf0" class="mg kz iq mc b gy mp mi l mj mk">  // Create confirm button at the top left of the viewport<br/>  var buttonConfirm = document.createElement('button');<br/>  buttonConfirm.style.position = 'absolute';<br/>  buttonConfirm.style.left = '10px';<br/>  buttonConfirm.style.top = '10px';<br/>  buttonConfirm.style.zIndex = 9999;<br/>  buttonConfirm.textContent = 'Confirm';<br/>  editor.appendChild(buttonConfirm);<br/>  buttonConfirm.addEventListener('click', function() {</span><span id="6a1d" class="mg kz iq mc b gy mp mi l mj mk">    // Remove the editor from the view<strong class="mc ir"><br/>    </strong>document.body.removeChild(editor);</span><span id="9d58" class="mg kz iq mc b gy mp mi l mj mk">  });</span><span id="f5e5" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">  </strong>// Create the Croppie editor<strong class="mc ir"><br/>  var croppie = new Croppie(editor, {<br/>    enableResize: true<br/>  });</strong></span><span id="797b" class="mg kz iq mc b gy mp mi l mj mk">  // Tell Croppie to load the file<br/><strong class="mc ir">  croppie.bind({<br/>    url: URL.createObjectURL(file)<br/>  });</strong></span><span id="a642" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="e65e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们放大确认按钮点击处理程序，并添加使其与Croppie一起工作所需的代码。</p><p id="918d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们还添加了Dropzone缩略图创建逻辑。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="73e5" class="mg kz iq mc b gy mh mi l mj mk">confirm.addEventListener('click', function() {</span><span id="bcb5" class="mg kz iq mc b gy mp mi l mj mk">  // Get the output file data from Croppie<br/>  <strong class="mc ir">croppie.result({<br/>      type:'blob',<br/>      size: {<br/>        width: 256,<br/>        height: 256<br/>      }<br/>    }).then(function(blob) {<br/>    <br/>      </strong>// Create a new Dropzone file thumbnail<strong class="mc ir"><br/>      </strong>myDropZone.createThumbnail(<br/>        blob,<br/>        myDropZone.options.thumbnailWidth,<br/>        myDropZone.options.thumbnailHeight,<br/>        myDropZone.options.thumbnailMethod,<br/>        false, <br/>        function(dataURL) {<br/>          <br/>          // Update the Dropzone file thumbnail<br/>          myDropZone.emit('thumbnail', file, dataURL);</span><span id="9cde" class="mg kz iq mc b gy mp mi l mj mk">          // Tell Dropzone of the new file<br/>          done(blob);</span><span id="9efd" class="mg kz iq mc b gy mp mi l mj mk">        });</span><span id="ed1b" class="mg kz iq mc b gy mp mi l mj mk"><strong class="mc ir">    </strong>});</span><span id="3010" class="mg kz iq mc b gy mp mi l mj mk">  // Remove the editor from view<strong class="mc ir"><br/>  </strong>editor.parentNode.removeChild(editor);</span><span id="2888" class="mg kz iq mc b gy mp mi l mj mk">});</span></pre><p id="73e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！我们已经做完了！</p><p id="23a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当一个文件被删除时，它会自动发送到Croppie。裁剪过程接管，当点击确认按钮时，文件被返回到Dropzone进行上传。</p><p id="428d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的动画展示了结果，<a class="ae kx" href="https://codepen.io/rikschennink/details/87fdcbf565d3dba6e248cf1788619493" rel="noopener ugc nofollow" target="_blank">CodePen上的一个例子也是可用的</a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/1386a2c38127676bbdd840da4b3ed518.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*JXT3trvk3dw-AkoDLz4Nvg.gif"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">DropzoneJS和Croppie集成</figcaption></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="d455" class="ky kz iq bd la lb my ld le lf mz lh li lj na ll lm ln nb lp lq lr nc lt lu lv bi translated">将DropzoneJS与多卡整合</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/4b567b12af53eda4e9d18bd663c9abc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m6Z0poHJb6021TxIlvwR2g.png"/></div></div></figure><p id="cb16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Doka.js 走了一条不同的路，它没有嵌入到页面中，而是带来了自己的编辑器弹出窗口。这意味着我们可以删除我们亲爱的编辑器和确认按钮代码。</p><p id="f92b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">请注意，多卡是一个商业JavaScript插件，因此源文件是从服务器而不是CDN加载的。</em></p><p id="a560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看。首先，我们将链接CSS和JavaScript文件。</p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="ed8e" class="mg kz iq mc b gy mh mi l mj mk">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;title&gt;JavaScript Image Cropping with DropzoneJS&lt;/title&gt;<br/>  &lt;link href="https://unpkg.com/dropzone/dist/dropzone.css" rel="stylesheet"/&gt;<br/>  <strong class="mc ir">&lt;link href="doka.min.css" rel="stylesheet"/&gt;</strong><br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;div class="dropzone" id="myDropzone"&gt;&lt;/div&gt;<br/>  &lt;script src="https://unpkg.com/dropzone"&gt;&lt;/script&gt;<br/>  <strong class="mc ir">&lt;script src="doka.min.js"&gt;&lt;/script&gt;</strong><br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c017" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">源文件链接起来后，我们现在可以再看一下<code class="fe ml mm mn mc b">transformFile</code>函数。使用多卡，我们将在Dropzone配置之外创建一个编辑器，如下所示。</p><p id="3a75" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">注意，我们再次放大了最后一个</em> <code class="fe ml mm mn mc b"><em class="mo">&lt;script&gt;</em></code> <em class="mo">标签。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="868f" class="mg kz iq mc b gy mh mi l mj mk">&lt;script&gt;<br/>// Create our Doka image editor<br/><strong class="mc ir">var doka = Doka.create({<br/>  cropAspectRatio: 1<br/>});</strong></span><span id="abda" class="mg kz iq mc b gy mp mi l mj mk">// Configure Dropzone<br/>Dropzone.options.myDropzone = {<br/>  url: '/post',<br/>  transformFile: function(file, done) {</span><span id="4946" class="mg kz iq mc b gy mp mi l mj mk">  }<br/>};<br/>&lt;/script&gt;</span></pre><p id="b9d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了多卡，我们可以调用<code class="fe ml mm mn mc b">doka.edit</code>来打开文件。当作物得到确认时，它会自动解决一个承诺。让我们给<code class="fe ml mm mn mc b">transformFile</code>函数添加所需的逻辑。</p><p id="e26d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">drop zone缩略图创建逻辑保持不变。</em></p><pre class="km kn ko kp gt mb mc md me aw mf bi"><span id="b5e4" class="mg kz iq mc b gy mh mi l mj mk">function(file, done) {<br/>  <br/>  // Shortcut to this dropzone<br/>  var myDropZone = this;</span><span id="04ef" class="mg kz iq mc b gy mp mi l mj mk">  // Edit the file and wait for confirm<br/>  <strong class="mc ir">doka.edit(file).then(function(output) {</strong></span><span id="0880" class="mg kz iq mc b gy mp mi l mj mk">    // Get blob from Doka output object<br/>    <strong class="mc ir">var blob = output.file;</strong><br/>    <br/>    // Create a new Dropzone file thumbnail<strong class="mc ir"><br/>    </strong>myDropZone.createThumbnail(<br/>      blob,<br/>      myDropZone.options.thumbnailWidth,<br/>      myDropZone.options.thumbnailHeight,<br/>      myDropZone.options.thumbnailMethod,<br/>      false, <br/>      function(dataURL) {<br/>          <br/>        // Update the Dropzone file thumbnail<br/>        myDropZone.emit('thumbnail', file, dataURL);</span><span id="6f67" class="mg kz iq mc b gy mp mi l mj mk">        // Tell Dropzone of the new file<br/>        done(blob);</span><span id="edd7" class="mg kz iq mc b gy mp mi l mj mk">     });</span><span id="a292" class="mg kz iq mc b gy mp mi l mj mk">  });</span><span id="8d54" class="mg kz iq mc b gy mp mi l mj mk">}</span></pre><p id="d638" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们完了！🎉</p><p id="aba3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参见下面的结果，<a class="ae kx" href="https://pqina.nl/doka/" rel="noopener ugc nofollow" target="_blank">在产品网站</a>了解更多关于多卡的信息。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b3008eb4c68af8d30d5b4b4bb43e9d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/1*fZi8RyuiY1lW28aJtNRC4Q.gif"/></div></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><p id="22cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这篇文章或者有任何问题，请在推特上告诉我</p></div></div>    
</body>
</html>