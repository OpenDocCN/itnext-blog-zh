<html>
<head>
<title>Add Google Login to a FastAPI app with EasyAuth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EasyAuth将Google登录添加到FastAPI应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/add-google-login-to-a-fastapi-app-with-easyauth-c8c3e926ad0a?source=collection_archive---------0-----------------------#2021-06-14">https://itnext.io/add-google-login-to-a-fastapi-app-with-easyauth-c8c3e926ad0a?source=collection_archive---------0-----------------------#2021-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/53f29582b9e90269136bd9f2e99515b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1EtZTArgBliVFhaC.png"/></div></div></figure><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jy"><img src="../Images/eedbfdbc3109dd9d80801194156968f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*STQjmjj5S_tZ7YoS.png"/></div></div></figure><p id="27f8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用<a class="ae lb" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>创建API很容易！在我的上一篇<a class="ae lb" href="https://medium.com/analytics-vidhya/creating-secure-apis-with-easyauth-fastapi-6996a5e42d07" rel="noopener">文章</a>中，我讨论了EasyAuth如何让认证/授权变得更简单。</p><p id="5114" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">EasyAuth还旨在让通过谷歌等提供商添加第三方认证变得更容易。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="739e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们开始之前，让我们创建一个非常基本的“Hello World”API。我们稍后将添加身份验证。</p><figure class="jz ka kb kc gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><pre class="jz ka kb kc gt ll lm ln lo aw lp bi"><span id="149a" class="lq lr iq lm b gy ls lt l lu lv">$ uvicorn --host 0.0.0.0 --port 8450 basic:app<br/>INFO:     Started server process [997908]<br/>INFO:     Waiting for application startup.<br/>INFO:     Application startup complete.<br/>INFO:     Uvicorn running on <a class="ae lb" href="http://0.0.0.0:8450" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8450</a> (Press CTRL+C to quit)<br/>INFO:     127.0.0.1:54704 - "GET / HTTP/1.1" 200 OK</span></pre><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/e094e858e230f6170d80d131006e1930.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*6WgmaBM5TxjfDtga1Z7Nww.png"/></div></figure><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/5b6c479ec2035c70d2415804bbd1aa90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*xLsaIO67l-OjSh01ghM2Mw.png"/></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="d626" class="ly lr iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated"><strong class="ak">安装EasyAuth </strong></h1><pre class="jz ka kb kc gt ll lm ln lo aw lp bi"><span id="820e" class="lq lr iq lm b gy ls lt l lu lv">pip install easy-auth[server]</span></pre></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="a83c" class="lq lr iq bd lz mv mw dn md mx my dp mh ko mz na ml ks nb nc mp kw nd ne mt nf bi translated"><strong class="ak">向我们的应用添加easy auth</strong></h2><p id="e81c" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">首先创建一个JSON文件，其中包含easyauth所需的环境变量。</p><figure class="jz ka kb kc gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="9d69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们将easyauth添加到我们的基本应用程序中。</p><figure class="jz ka kb kc gt jr"><div class="bz fp l di"><div class="lj lk l"/></div></figure><pre class="jz ka kb kc gt ll lm ln lo aw lp bi"><span id="f752" class="lq lr iq lm b gy ls lt l lu lv">$ uvicorn --host 0.0.0.0 --port 8450 basic:app<br/>.<br/>...<br/>06-12 00:33 EasyAuthServer ERROR    detected new EasyAuth server, created admin user with password: hmhjdfvg<br/>INFO:     Application startup complete.<br/>06-12 00:34 uvicorn.error INFO     Application startup complete.<br/>INFO:     Uvicorn running on <a class="ae lb" href="http://0.0.0.0:8450" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8450</a> (Press CTRL+C to quit)</span></pre><p id="6032" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">访问同一个端点，注意所需的身份验证，输入admin / pw进行访问。</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/e46f57114d70c27d9314c47150093b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkURsJcLSi_jb18S6TpMtw.png"/></div></div></figure><p id="89ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次查看/docs页面来查看API，注意新的锁图标，表示身份验证要求。</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/96a5b7d3eb78e4605a557ddad62d0ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*543FOkorP_LalIefR-wmBA.png"/></div></div></figure><p id="79d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了位于/login的登录页面之外，默认端点也位于/register，允许创建新用户。</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/38a953f888f03ad38610ed38d426bc1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPp349DwAz358qTfwvybsA.png"/></div></div></figure><h2 id="12bd" class="lq lr iq bd lz mv mw dn md mx my dp mh ko mz na ml ks nb nc mp kw nd ne mt nf bi translated"><strong class="ak">管理图形用户界面</strong></h2><p id="d9ad" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">在/admin中有一个管理GUI，提供基本的用户管理任务，并允许额外的配置:电子邮件/ google身份验证。</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/22c4c490ea3309644f0b0929d74943f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hH9BupMM0xnbGy1lzjRC1A.png"/></div></div></figure><p id="5a09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在身份提供者中，google认证可以与<strong class="kf ir"> default_groups </strong>(分配给新注册用户的组)一起配置。</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/d869d15b12e0a9323c03f96b60ee3faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ave7snAEt8EGsBh5BaXAFw.png"/></div></div></figure><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/f1e649e1f9713158916a763f61b17493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruPUBOgfl1hMsNi7i2xxLQ.png"/></div></div></figure><h2 id="7695" class="lq lr iq bd lz mv mw dn md mx my dp mh ko mz na ml ks nb nc mp kw nd ne mt nf bi translated"><strong class="ak">配置谷歌认证</strong></h2><p id="16e5" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko ni kq kr ks nj ku kv kw nk ky kz la ij bi translated">google client_id应该与在<a class="ae lb" href="https://console.cloud.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/apis/credentials</a>配置的凭证相对应</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/ef6c2859a9b1dcb8589737546b6c1542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nCttj1x4QgSjqNlmB2WTtw.png"/></div></div></figure><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f27dfdb460243ae4fd7070234771c41a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*OTB-z8l5RK8lOXkJpbp0WA.png"/></div></figure><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/859eedea472acf689773a7c298411c7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*TI48srwYAn9pI8boGYUWLg.png"/></div></figure><p id="954b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于生产用途，URIs应与外部世界拥有并可访问的域名相对应。</p><p id="1426" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于测试，客户端可以简单地将其/etc/hosts中的本地DNS重定向到127.0.0.1。</p><pre class="jz ka kb kc gt ll lm ln lo aw lp bi"><span id="7221" class="lq lr iq lm b gy ls lt l lu lv">$ cat /etc/hosts<br/>127.0.0.1 localhost easyauth.com</span></pre><p id="d329" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了创建的凭证和client_id，就可以配置google了</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/689081dc96ba903a0f8b27b6fb57ad83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9e_T6EuIbPtul4A46lbd9Q.png"/></div></div></figure><p id="436e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导航到<a class="ae lb" href="http://easyauth.com:8320/login" rel="noopener ugc nofollow" target="_blank">http://easyauth.com:8320/login</a>并观察登录选项的变化</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/75394584d091c37b323d507c9c7fda35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dyDBPOm_y4FQr6-4kYmC8w.png"/></div></div></figure><p id="d509" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">立即尝试使用google帐户登录:</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/682c542d591fec85aacd9d4abea820c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ltVt0oXMWvAaDUhSRKPp0A.png"/></div></div></figure><p id="2689" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，创建了一个与google帐户匹配的新用户，以及身份提供者中的<strong class="kf ir"> default_groups </strong>。</p><p id="084b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Google Sign In登录后，只要easyauth令牌过期，浏览器就会被重定向到/login，并且会自动创建一个新令牌(登录时)。这种行为会一直发生，直到注销:</p><figure class="jz ka kb kc gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/e12c6cc7faa3c505de06d7b302d544ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*swHCmUgwi1c8HFUUmwd2DQ.png"/></div></figure><p id="ac85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了避免阻止每个新用户成为管理员，创建一些新的组、角色、动作并调整身份提供者中的<strong class="kf ir"> default_groups </strong>。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="06e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">文件</strong>:【https://easyauth.readthedocs.io/en/latest/ T2】</p><p id="93e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Github:<a class="ae lb" href="https://github.com/codemation/easyauth" rel="noopener ugc nofollow" target="_blank">https://github.com/codemation/easyauth</a></p></div></div>    
</body>
</html>