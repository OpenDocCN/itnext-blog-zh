<html>
<head>
<title>Unit Testing the Composition API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">组合API的单元测试</h1>
<blockquote>原文：<a href="https://itnext.io/testing-the-composition-api-fae3bae3f592?source=collection_archive---------2-----------------------#2019-11-20">https://itnext.io/testing-the-composition-api-fae3bae3f592?source=collection_archive---------2-----------------------#2019-11-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4294ec0a86ff45952efef481807fdd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGWFAoGl8jmpow7799Fd7g.png"/></div></div></figure><p id="d047" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用Vue 3的<a class="ae kw" href="https://vue-composition-api-rfc.netlify.com/#basic-example" rel="noopener ugc nofollow" target="_blank">组合API </a>进行单元测试会怎么样？</p><p id="945f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了让用户尽早尝试复合API，Vue团队发布了一个插件，让我们在Vue 2中试用。这里可以找到<a class="ae kw" href="https://github.com/vuejs/composition-api" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="36af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一篇超级快速的文章，验证了新的Composition API如何与Vue组件的官方单元测试库<code class="fe kx ky kz la b">vue-test-utils</code>一起使用。剧透:工作原理完全一样。</p><p id="548b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用组合API测试一个组件构建应该和测试一个标准组件没有什么不同，因为我们测试的不是实现，而是输出(组件做了什么，而不是如何做)。本文将展示一个使用Vue 2中的Composition API的组件的简单示例，以及测试策略如何与任何其他组件相同。</p><figure class="ld le lf lg gt jr gh gi paragraph-image"><a href="http://vuejs-course.com/"><div class="gh gi lc"><img src="../Images/8860e8ef1f39967845929ca6a9e3821a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_RGGAoqizZjbVse93Z4TQ.png"/></div></a><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">来看看我的<a class="ae kw" href="https://vuejs-course.com/" rel="noopener ugc nofollow" target="_blank"> Vue.js 3课程</a>！我们涵盖了组合API、类型脚本、单元测试、Vuex和Vue路由器。</figcaption></figure><h1 id="113b" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">测试组件</h1><p id="1cdd" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">下面是Composition API的“Hello，World”，或多或少。有不懂的地方，<a class="ae kw" href="https://vue-composition-api-rfc.netlify.com/" rel="noopener ugc nofollow" target="_blank">看RFC </a>或者我的<a class="ae kw" href="https://medium.com/js-dojo/compiling-vue-3-from-scratch-and-trying-the-new-composition-api-6d997f32e5b4" rel="noopener">文章</a>或者有Google有很多关于组合API的资源。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="2429" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里我们需要测试的两件事是:</p><ol class=""><li id="520a" class="mq mr iq ka b kb kc kf kg kj ms kn mt kr mu kv mv mw mx my bi translated">点击增量按钮会使<code class="fe kx ky kz la b">state.count</code>增加1吗？</li><li id="5f61" class="mq mr iq ka b kb mz kf na kj nb kn nc kr nd kv mv mw mx my bi translated">props中收到的消息是否正确呈现(转换为大写字母)？</li></ol><h1 id="7845" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">测试道具信息</h1><p id="dffd" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">测试消息是否被正确呈现是微不足道的。我们只是使用<code class="fe kx ky kz la b">propsData</code>来设置道具的值，如这里所描述的<a class="ae kw" href="https://gist.github.com/components-with-props.html" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="f064" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如所料，这非常简单——不管我们以何种方式组成组件，我们都使用相同的API和相同的策略进行测试。您应该能够完全改变实现，而不需要接触测试。记住，要基于给定的输入(道具、触发事件)而不是实现来测试输出(通常是呈现的HTML)。</p><h1 id="8555" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">测试按钮点击</h1><p id="032d" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">编写一个测试来确保点击按钮增加<code class="fe kx ky kz la b">state.count</code>同样简单。请注意，测试标记为<code class="fe kx ky kz la b">async</code>；在<a class="ae kw" href="https://gist.github.com/lmiller1990/simulating-user-input.html#writing-the-test" rel="noopener ugc nofollow" target="_blank">模拟用户输入</a>中阅读更多关于为什么需要这样做的信息。</p><figure class="ld le lf lg gt jr"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="0f4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，完全没意思——我们<code class="fe kx ky kz la b">trigger</code>了点击事件，并断言呈现的<code class="fe kx ky kz la b">count</code>增加了。</p><h1 id="427a" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">结论</h1><p id="6b6d" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">本文演示了使用组合API测试组件与使用传统选项API测试组件是如何相同的。想法和概念是一样的。要学习的要点是当编写测试时，根据输入和输出做出断言。<code class="fe kx ky kz la b">vue-test-utils</code>不关心你如何组成你的组件；所有现有的方法和API都适用于组合API。好消息！</p><p id="f1b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应该可以重构任何传统的Vue组件来使用组合API，而不需要改变单元测试。如果你发现自己在重构时需要改变测试，你可能测试的是<em class="lb">实现</em>，而不是输出。</p><p id="2ca3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然这是一个令人兴奋的新特性，但是Composition API完全是附加的，所以不需要立即使用它，但是不管您的选择如何，记住一个好的单元测试断言组件的最终状态，而不考虑实现细节。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="c0c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lb">原发表于</em> <a class="ae kw" href="https://lmiller1990.github.io/vue-testing-handbook/" rel="noopener ugc nofollow" target="_blank"> <em class="lb"> Vue测试手册</em> </a> <em class="lb">。</em></p></div></div>    
</body>
</html>