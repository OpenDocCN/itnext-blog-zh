# VueJS 中更好的组件组合

> 原文：<https://itnext.io/better-composition-in-vue-fd35b9fe9c79?source=collection_archive---------3----------------------->

![](img/1bc0b09074bce0e316d8aa1b495d0720.png)

由 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的 [uniqsurface](https://unsplash.com/@uniqsurface?utm_source=medium&utm_medium=referral) 拍摄的照片

在 *VueJS* 中，组合组件和重用逻辑的方法很少。在本文中，我将演示一种在 vue js(2 . 0)中提高合成的方法。*和 3。*).

我真的很喜欢最近关于*组合 API* 的提议，但我认为那可以是更广泛观点的一部分。

下面，您可以找到一个实现一般用例的组件(从远程端点获取简单数据并显示不同的转换和数据)，尽管当相同的逻辑应用于其他位置或组件时，大多数逻辑总是与模板、数据和其他变量一起复制。

我们如何重构这个组件并改进它？让我们一步一步来，使这个组件更可读和可重用。

## Vue 组合 API

多亏了新的 Vue Composition API，我们可以取出一些逻辑来重用它，而不会失去 Vue 组件提供的反应能力或特性。

这种方法有助于组织代码，使组件更具可读性，并有助于降低整体复杂性。作为一个建议，我相信这应该是重构庞大、复杂和混乱的组件时要做的第一件事。

我们将提取与数据获取和相关变量相关的部分(*加载，错误*等…)，但我不想讨论什么是 Composition API，有什么特性和优缺点。

让我们创建一个简单的函数，它为获取反应变量提供了必要的东西:

创建的函数现在返回一组反应性变量( *loading、error、data* 和 *hasData* )，这些变量可以由我们的组件和一个异步函数使用，以便执行数据获取( *fetchData* ，它将改变返回的反应性变量)。

并且，让我们重构我们的组件来使用组合 API:

正如您所注意到的，我们的组件还包含 setup 方法，该方法调用 *useFetchData* 函数，同时析构返回的变量/函数并将它们返回给组件实例。

在这个例子中，我在挂载的生命周期钩子中使用了 *fetchData* 函数，但是它可以在任何你想要的地方被调用。每当调用的函数对某个东西进行评估/更改时，结果都会反映在我们的组件中，因为它们是反应性属性。

## JSX 和 TSX

现在让我们假设我们想要将数据传递给一个内部组件。使用 VueJS 有多种方法可以做到这一点，但是我想重新构建一下，使用 *TSX* (或者 *JSX* ，如果你喜欢的话:

我知道这可能看起来很像 React，但我相信这为以更好的方式创作打开了许多大门。

其实理解起来挺简单的，和模板是一回事，但是我们把 HTML 部分移到了 Render 函数里。

我们还没有完成将它传递给内部组件的任务，我们实际上可以改进它，如下面这段代码，它将整个东西导出为一个我们可以重用的函数:

现在我们把它带到了下一个层次，去掉 *SFC* (单个文件组件文件)我们实际上可以提高合成。

在这个阶段，我们使用 defineComponent 来创建一个使用组合 API 的组件，并依靠 JSX/TSX 来避免模板部分。这种方法的美妙之处在于，我们可以将组件视为一个函数，并依赖于函数式编程范式的原则(例如，一级函数、纯函数等)

例如，Render 函数也包含一个包含数据的 div，但是想象一下将一个组件作为导出函数的参数传递，并在返回的 JSX/TSX 中使用它(将响应/数据作为道具传递给请求的组件)。

它可能看起来像这样:

现在我们期待一个组件作为参数，并在 Render 函数的返回值中使用它。

我们可以做得更多。

实际上，我们还可以期望将 *useFetchData* 函数作为导出函数中的一个参数。

有了这些变化，在组件之上，作为一个可接受的参数，我们期待一个类型为 *FetchData* 的*函数*，它返回一组期望的变量/函数/计算值，以便在我们的组件中使用。

这对于取代继承/扩展并依赖于更具功能性的方法非常有用。因此，我们实际上可以传入所需的组件和函数，而不是扩展已经存在的组件和覆盖组件的函数。Typescript 在这里只帮助打字和推理，所以 Javascript 也足够了。

例如，如果我们想使用它，它可能看起来像下面这样:

我们把上面的最后一个例子叫做 *withLoaderAndFetcher* ，我们用它来传递 3 个不同的组件和 3 个不同的函数(期望在装饰器中实现想要的东西)。

这甚至可以进一步推进，但我想展示如何可能达到这种状态，并增加功能组合的解决方案的数量。这是示例代码，可能不会完美地工作，但是想法和概念是最重要的。

干杯:)