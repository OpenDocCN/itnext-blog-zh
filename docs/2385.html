<html>
<head>
<title>Setup logger for Node-Express app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node-Express应用程序的设置记录器</h1>
<blockquote>原文：<a href="https://itnext.io/setup-logger-for-node-express-app-9ef4e8f73dac?source=collection_archive---------0-----------------------#2019-05-16">https://itnext.io/setup-logger-for-node-express-app-9ef4e8f73dac?source=collection_archive---------0-----------------------#2019-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9976" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将描述如何使用Express路由器为节点应用程序设置HTTP + events logger。</p><h1 id="7e50" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">问题的表述</h1><p id="be2d" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在开发基于节点和快速路由器的服务器端应用程序时，我遇到了一个准备记录器的问题。解决方案的要求:</p><ul class=""><li id="03f3" class="lo lp iq jp b jq jr ju jv jy lq kc lr kg ls kk lt lu lv lw bi translated">记录应用程序事件</li><li id="a850" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">能够指定多个日志级别</li><li id="3a7a" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">记录HTTP请求</li><li id="a19a" class="lo lp iq jp b jq lx ju ly jy lz kc ma kg mb kk lt lu lv lw bi translated">能够将日志写入不同的源(控制台和文件)</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/62a7e0387dd0868862544fdd7cdcac56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0EUmURFddtzX7Ldw4arsw.jpeg"/></div></div></figure><h1 id="f043" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">发现可能的解决方案</h1><p id="75bb" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在发现的过程中，我找到了两种可能的解决方案，可以满足我的问题需求</p><p id="14a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mo" href="https://www.npmjs.com/package/morgan" rel="noopener ugc nofollow" target="_blank">摩根</a> —用于express的HTTP日志中间件。通过根据不同的请求相关信息指定日志实例的格式，它提供了记录传入请求的能力。例如:</p><pre class="md me mf mg gt mp mq mr ms aw mt bi"><span id="e533" class="mu km iq mq b gy mv mw l mx my">:method :url :status :response-time ms - :res[content-length]</span></pre><p id="77ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据npm下载统计数据，我可以假设这是一个广泛使用的软件包。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/5913cfe81a2826efe37616b1f2acab1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*ljCfWAjE52djR3wWhXGtsw.png"/></div></figure><p id="aadd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个强大而简单的工具，所以我喜欢用它。</p><p id="51dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mo" href="https://www.npmjs.com/package/winston" rel="noopener ugc nofollow" target="_blank"> Winston </a> —简单而强大的日志库，支持多种类型的传输。这个有用的能力对我来说非常重要，因为我想同时将事件记录到控制台和文件中。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi na"><img src="../Images/db77d7c8d926a055c2aa72dd0be46270.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*ADskPurRI9SAMyWqDXf3qg.png"/></div></figure><p id="550a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据下载统计，它也是一个广泛使用的包，所以我假设它可以用来解决我的日志问题。</p><p id="3a93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我不会使用或概述所描述的工具的所有功能，我只是解决本文开始时设置的任务。</p><h1 id="f068" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">溶液的制备</h1><p id="63be" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">所以我将从准备基于Winston的日志开始。在这里，我配置日志和传输的格式——发布日志的通道。在我的情况下，它是一个文件和控制台。日志文件将出现在指定的文件夹中，日志将追加到文件中，直到文件超过指定的文件大小。此后，将创建一个名称中带有数字索引的新文件。达到最大文件数量后，最新的文件将在创建新文件时被删除。示例中描述的配置对于大量的日志来说确实足够了。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="57df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导出的记录器实例允许使用不同的日志级别记录应用程序事件。例如:</p><pre class="md me mf mg gt mp mq mr ms aw mt bi"><span id="e338" class="mu km iq mq b gy mv mw l mx my">logger.info('some info logging message');</span><span id="bff9" class="mu km iq mq b gy nd mw l mx my">logger.warn('some warn logging message');</span><span id="4ef9" class="mu km iq mq b gy nd mw l mx my">logger.error('some error logging message');</span></pre><p id="599b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每条消息都将被写入控制台和文件。此外，Winston提供了将不同日志级别的事件记录到不同源的能力。例如，将错误和信息记录到不同的文件中。你可以在Winston docs中找到更多信息，但我的项目不需要这些，所以我会继续。</p><p id="7289" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个问题是Winston不记录HTTP请求。出于这些目的，我发现了将Morgan HTTP logger连接到Winston base logger的能力。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="24e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，我将扩展Winston logger之前创建的HTTP请求日志功能。下面是代码片段，显示了如何使用上述记录器功能。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="07fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里的第8行，我使用了之前为快速应用程序创建的HTTP logger中间件。因此它将记录所有传入的HTTP请求信息。另一个测井仪被导入第三行，准备进行任何上述类型的测井。最后一种类型的记录器可以导入并在我的应用程序中的任何地方使用。</p><p id="3b5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果，所有带有时间戳和事件详细信息的日志都将出现在控制台中，并将被写入配置日志文件中指定的。</p><h1 id="657e" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">结论</h1><p id="4861" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">在本文中，描述了一种为Node+Express应用程序配置简单而强大的日志系统的简单方法。这个日志记录系统允许将HTTP传入请求和内部应用程序事件日志存储到多个源:控制台和文件。这不是最佳解决方案或最佳实践，这只是举例说明我如何以最简单的方式满足开发过程中出现的任务条件。</p><p id="9e57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个<a class="ae mo" href="https://github.com/BagrijRoman/node-logger" rel="noopener ugc nofollow" target="_blank">链接</a>到一个带有完整代码示例的存储库。</p></div></div>    
</body>
</html>