<html>
<head>
<title>Deep dive into SyntheticEvent in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入探究React中的合成事件</h1>
<blockquote>原文：<a href="https://itnext.io/deep-dive-into-syntheticevent-in-react-325486d9baad?source=collection_archive---------0-----------------------#2020-12-19">https://itnext.io/deep-dive-into-syntheticevent-in-react-325486d9baad?source=collection_archive---------0-----------------------#2020-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/417b79541fc0a025f7382aafb6245290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmZyPxd-Ry08TV3kNRwiWg.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="78a9" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe la lb lc ld b"><em class="jb">SyntheticEvent</em></code> <em class="jb">是一个包装器，它是React事件系统</em>的一部分</p></blockquote><h1 id="6aed" class="le lf jb bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">为什么它有用</h1><ul class=""><li id="ab77" class="mc md jb ke b kf me kj mf mg mh mi mj mk ml kz mm mn mo mp bi translated">跨浏览器:通过<code class="fe la lb lc ld b">nativeEvent</code>属性包装浏览器的本地事件，并在顶层提供统一的api和一致的行为</li><li id="0e2f" class="mc md jb ke b kf mq kj mr mg ms mi mt mk mu kz mm mn mo mp bi translated">更好的性能:事件通过冒泡<a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events" rel="noopener ugc nofollow" target="_blank">委托</a>给文档。<a class="ae mv" href="https://reactjs.org/blog/2020/08/10/react-v17-rc.html#no-event-pooling" rel="noopener ugc nofollow" target="_blank">注意React 17中删除了事件池</a></li></ul><h1 id="5c1e" class="le lf jb bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">它是什么样的</h1><p id="e9f4" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km mg mw kp kq mi mx kt ku mk my kx ky kz ij bi translated">每个<code class="fe la lb lc ld b">SyntheticEvent</code>对象都有以下属性</p><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="477c" class="nh lf jb ld b gy ni nj l nk nl">boolean bubbles<br/>boolean cancelable<br/>DOMEventTarget currentTarget // the element that the handler is registered<br/>boolean defaultPrevented<br/>number eventPhase<br/>boolean isTrusted<br/>DOMEvent nativeEvent<br/>void preventDefault()<br/>boolean isDefaultPrevented()<br/>void stopPropagation()<br/>boolean isPropagationStopped()<br/>void persist()<br/>DOMEventTarget target // the element that the handler is triggered<br/>number timeStamp<br/>string type</span></pre><h1 id="4403" class="le lf jb bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">当本地和合成事件混合时</h1><p id="1e0f" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km mg mw kp kq mi mx kt ku mk my kx ky kz ij bi translated">合成事件被委托给<code class="fe la lb lc ld b">document</code>节点。因此，本地事件首先被触发，并且事件冒泡到doucment，之后合成事件被触发。</p><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="c06a" class="nh lf jb ld b gy ni nj l nk nl">import React, { useEffect } from "react";</span><span id="e350" class="nh lf jb ld b gy nm nj l nk nl">export default function App() {<br/>  useEffect(() =&gt; {<br/>    document.addEventListener('click', e =&gt; {<br/>      // @4 stop parent native propogation<br/>      // e.stopPropagation();<br/>      console.log('[document] native dom event triggered');<br/>    });<br/>    const parentDiv = document.getElementById('parent');<br/>    parentDiv.addEventListener('click', e =&gt; {<br/>      // @1 stop parent native propogation<br/>      // e.stopPropagation();<br/>      console.log('[parent div] native dom event triggered');<br/>    });<br/>  }, []);</span><span id="495f" class="nh lf jb ld b gy nm nj l nk nl">  const onParentClick = e =&gt; {<br/>    // @2 stop parent propogation<br/>    // e.stopPropagation();<br/>    console.log('[parent div] synthetic event triggered');<br/>  };</span><span id="7c9b" class="nh lf jb ld b gy nm nj l nk nl">  const onChildClick = e =&gt; {<br/>    // @3 stop child propogation<br/>    // e.stopPropagation();<br/>    console.log('[child button] synthetic event triggered');<br/>  };</span><span id="b01c" class="nh lf jb ld b gy nm nj l nk nl">  return &lt;div id="parent" onClick={onParentClick}&gt;<br/>    &lt;button onClick={onChildClick}&gt;child&lt;/button&gt;<br/>  &lt;/div&gt;;<br/>}</span></pre><p id="3261" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km mg ko kp kq mi ks kt ku mk kw kx ky kz ij bi translated">点击各种设置的<code class="fe la lb lc ld b">child</code>按钮的输出将是:</p><h2 id="f56e" class="nh lf jb bd lg nn no dn lk np nq dp lo mg nr ns ls mi nt nu lw mk nv nw ma nx bi translated">不停止发布—输出:</h2><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="7f7e" class="nh lf jb ld b gy ni nj l nk nl">[parent div] native dom event triggered<br/>[child button] synthetic event triggered<br/>[parent div] synthetic event triggered<br/>[document] native dom event triggered</span></pre><p id="93d2" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km mg ko kp kq mi ks kt ku mk kw kx ky kz ij bi translated">本机dom事件是在组件挂载后调用时注册的。</p><h2 id="42e0" class="nh lf jb bd lg nn no dn lk np nq dp lo mg nr ns ls mi nt nu lw mk nv nw ma nx bi translated">停止在父节点的本机节点(即@1)上的传播—输出:</h2><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="d792" class="nh lf jb ld b gy ni nj l nk nl">[parent div] native dom event triggered</span></pre><p id="6e39" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km mg ko kp kq mi ks kt ku mk kw kx ky kz ij bi translated">没有冒泡到文档，就好像文档上没有发生单击事件= &gt;没有触发合成事件</p><h2 id="5a81" class="nh lf jb bd lg nn no dn lk np nq dp lo mg nr ns ls mi nt nu lw mk nv nw ma nx bi translated">停止对父合成事件(即@2)的提交—输出:</h2><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="9a95" class="nh lf jb ld b gy ni nj l nk nl">[parent div] native dom event triggered<br/>[child button] synthetic event triggered<br/>[parent div] synthetic event triggered<br/>[document] native dom event triggered</span></pre><h2 id="1124" class="nh lf jb bd lg nn no dn lk np nq dp lo mg nr ns ls mi nt nu lw mk nv nw ma nx bi translated">停止对孩子的合成事件(即@3)的建议—输出:</h2><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="6537" class="nh lf jb ld b gy ni nj l nk nl">[parent div] native dom event triggered<br/>[child button] synthetic event triggered<br/>[document] native dom event triggered</span></pre><h2 id="3b59" class="nh lf jb bd lg nn no dn lk np nq dp lo mg nr ns ls mi nt nu lw mk nv nw ma nx bi translated">停止对孩子的合成事件(即@4)的查询—输出:</h2><pre class="mz na nb nc gt nd ld ne nf aw ng bi"><span id="8322" class="nh lf jb ld b gy ni nj l nk nl">[parent div] native dom event triggered<br/>[child button] synthetic event triggered<br/>[parent div] synthetic event triggered<br/>[document] native dom event triggered</span></pre><h1 id="6790" class="le lf jb bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">要点</h1><ul class=""><li id="4ca5" class="mc md jb ke b kf me kj mf mg mh mi mj mk ml kz mm mn mo mp bi translated">如果您想在所有React处理程序之后接收事件，请在<code class="fe la lb lc ld b">document</code>上监听。在任何其他地方监听，以便在React处理程序之前接收</li><li id="6c8b" class="mc md jb ke b kf mq kj mr mg ms mi mt mk mu kz mm mn mo mp bi translated">React事件处理程序将始终在本机捕获处理程序之后执行</li></ul><p id="dcd6" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km mg ko kp kq mi ks kt ku mk kw kx ky kz ij bi translated"><a class="ae mv" href="https://codesandbox.io/s/synthetic-event-ruv3f?file=/src/App.js" rel="noopener ugc nofollow" target="_blank">代码</a></p><h1 id="b29e" class="le lf jb bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">通知；注意</h1><ul class=""><li id="6ad0" class="mc md jb ke b kf me kj mf mg mh mi mj mk ml kz mm mn mo mp bi translated">如果您想关注我的博客系列的最新消息/文章，请<a class="ae mv" href="https://github.com/n0ruSh/blogs/" rel="noopener ugc nofollow" target="_blank">【观看】</a>订阅。</li></ul></div></div>    
</body>
</html>