<html>
<head>
<title>How to use Firebase Auth with a custom (node) backend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在自定义(节点)后端使用Firebase Auth</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-use-firebase-auth-with-a-custom-node-backend-99a106376c8a?source=collection_archive---------0-----------------------#2019-10-03">https://itnext.io/how-to-use-firebase-auth-with-a-custom-node-backend-99a106376c8a?source=collection_archive---------0-----------------------#2019-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ec95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将经历一个非常基本的应用程序设置。带有vue前端的节点后端。如果您已经有了后端和前端设置，只需要Firebase Auth部分，<a class="ae kl" href="#36c6" rel="noopener ugc nofollow">跳到这里。</a></p><p id="2735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你只是想要代码示例，嘿，我明白了。给你。</p><h1 id="ad0e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Node.js后端</h1><p id="d329" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">您需要安装节点和npm。如果你没有，你可以在这里做:【https://nodejs.org/en/ T21】</p><p id="0a8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从express-generator创建我们的基本应用程序。打开您的终端，用<code class="fe lp lq lr ls b">npm i -g express-generator</code>进行安装。现在创建一个文件夹，<code class="fe lp lq lr ls b">mkdir fbAuthDemo</code>并进入它，<code class="fe lp lq lr ls b">cd fbAuthDemo</code>。现在使用express-generator创建我们的节点后端<code class="fe lp lq lr ls b">express server</code>。现在打开你的文本编辑器，给我<code class="fe lp lq lr ls b">code .</code>。您应该会看到类似这样的内容:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/97ccb5761df685d92bf0911c3d415ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJrAngVaQJmqTGc7pUnf3w.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">香草快递应用程序</figcaption></figure><p id="0099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">马上，让我们删除<code class="fe lp lq lr ls b">public/</code>、<code class="fe lp lq lr ls b">routes/</code>和<code class="fe lp lq lr ls b">views/</code>文件夹，我们不需要它们。您还可以删除<code class="fe lp lq lr ls b">app.use(&lt;route&gt;, &lt;func&gt;)</code>调用，以及错误处理程序、查看引擎设置调用和所有现在未使用的导入。您的app.js现在应该看起来像这样:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8424" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将添加一条基本路线:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="da9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以通过运行我们的应用程序来测试这一点(如果你还没有运行<code class="fe lp lq lr ls b">npm install &amp;&amp; npm i nodemon</code>，然后运行<code class="fe lp lq lr ls b">DEBUG=server:* nodemon start</code>。然后通过点击<code class="fe lp lq lr ls b"><a class="ae kl" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></code>路线来点击Postman、curl或您的浏览器中的端点。你应该回去:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/522326beda107008772a5a28a0a6aac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*Sd0UhGrGkywweOArHt3i_Q.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们的第一反应</figcaption></figure><p id="a64c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，让我们添加一个用于授权的虚拟函数，稍后我们将使用Firebase的逻辑来填充它。我们将添加一个虚拟的<code class="fe lp lq lr ls b">authorized</code>布尔值，并在一些定制的中间件中使用它来检查认证。如果用户被授权，我们将继续，如果没有，我们将发回一个<code class="fe lp lq lr ls b">403: Unauthorized</code>。以上<code class="fe lp lq lr ls b">app.get(..)</code>:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2df7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你现在应该可以在<code class="fe lp lq lr ls b">authorized = true</code>时进入路线，在<code class="fe lp lq lr ls b">authorized = false</code>时被阻挡。</p><p id="cd84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们移动到前端之前，最后一件事是，我们需要添加<a class="ae kl" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"> cors </a>以便我们的前端能够与后端对话。很简单，就<code class="fe lp lq lr ls b">npm i cors</code>，然后把这两行加到你的app.js里:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们最终的app.js文件应该是这样的:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><h1 id="b929" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Vue.js前端</h1><p id="9f8e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">请随意使用任何前端，但由于Vue的工作更愉快，我将使用它。</p><p id="02d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将以与后端类似的方式开始。在你的终端进入我们创建的<code class="fe lp lq lr ls b">fbAuthDemo/</code>文件夹。我们将使用vue cli来实例化我们的项目，所以如果你没有它，<code class="fe lp lq lr ls b">npm i -g @vue/cli</code>。然后就可以<code class="fe lp lq lr ls b">vue create client</code>了。为了简单起见，我手动选择选项，通常只选择Babel，并将其放在package.json中。在vue cli完成后，我们将进入客户端文件夹<code class="fe lp lq lr ls b">cd client</code>，并在我们的代码编辑器<code class="fe lp lq lr ls b">code .</code>中打开它。它应该看起来像这样</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mm"><img src="../Images/cb595ffb13a8a22cffaea0a3e771ab64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFS1CO4Afgugcbdw_1hHug.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们的香草Vue项目</figcaption></figure><p id="5201" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用<code class="fe lp lq lr ls b">npm run serve</code>在终端中运行这个程序，并检查默认页面</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mn"><img src="../Images/98dd5e7083c1cbfb2c4f1d20a47c3d06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hRygwZ-E-MrHG8Hhxba6jA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">默认的vue项目页面</figcaption></figure><p id="a973" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们不需要所有这些链接，所以让我们去<code class="fe lp lq lr ls b">src/components/HelloWorld.vue</code>把它们去掉。我们将去掉主标签<code class="fe lp lq lr ls b">&lt;h1&gt;{{ msg }}&lt;/h1&gt;</code>下面的<code class="fe lp lq lr ls b">&lt;div&gt;</code>中的所有内容。然后让我们添加一个按钮和我们自己的p标签</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="82ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该注意到两件事:我们正在使用bootstrap类，并且我们正在引用一个尚未定义的变量<code class="fe lp lq lr ls b">response</code>。让我们先定义变量，然后将bootstrap添加到我们的项目中，这样事情看起来就好办了。</p><p id="f706" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要添加响应变量，我们需要给我们的Vue组件一个<code class="fe lp lq lr ls b">data</code>属性。现在记住，它需要是一个函数(我在这上面花了太长时间)。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="3f3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在转到<code class="fe lp lq lr ls b">public/index.html</code>，将<a class="ae kl" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap的CDN链接</a>添加到标题中:</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="1fad" class="ms kn iq ls b gy mt mu l mv mw">&lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;</span></pre><p id="87ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在一切都应该看起来不错，我们有所有的变量来显示我们的数据。但是发送请求按钮呢？让我们在Vue组件中创建一个方法，并将其绑定到按钮上。这个方法能做什么？当然是发请求啦！让我们使用<a class="ae kl" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>来完成这项工作。前进到您的项目，然后在Vue组件的脚本标签中，我们可以导入axios并使用它创建一个客户端。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="bf01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们将在我们的视图组件中创建一个方法，使用这个客户端向<code class="fe lp lq lr ls b">/</code>空白路由发送一个默认的get请求。该方法应该在成功时将来自axios调用的消息存储到我们的Vue组件的<code class="fe lp lq lr ls b">response</code>数据变量中，而不是在失败时存储错误。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="5f83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们将它绑定到我们的按钮:</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="2907" class="ms kn iq ls b gy mt mu l mv mw">&lt;button @click="sendRequest" class="btn btn-outline-success my-4"&gt;Send Request &gt;&lt;/button&gt;</span></pre><p id="3f08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们最终的<code class="fe lp lq lr ls b">HelloWorld.vue</code>文件此时应该是这样的:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="c6c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我们像以前一样运行我们的服务器<code class="fe lp lq lr ls b">DEBUG=server:* nodemon start</code>，像以前一样运行我们的客户端<code class="fe lp lq lr ls b">npm run serve</code>，我们应该看到我们得到‘Hello World！’从我们的服务器返回并向我们展示:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/f0de39fbd57b1d8c2e643c575bbb56bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/1*yq_8zYzn1P5o_4kCJe3UFw.png"/></div></figure><p id="88f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您得到“错误:请求失败，状态代码为403！”相反，这是因为您将服务器中的哑变量<code class="fe lp lq lr ls b">authorized</code>设置为<code class="fe lp lq lr ls b">false</code>。因此，切换回来，并测试它的工作。或者，将其切换到false，并查看伪authCheck函数是否工作。不管怎样，我们现在已经准备好在自定义后端实现Firebase身份验证了！</p><h1 id="8d07" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">将Firebase Auth添加到我们的自定义后端</h1><p id="b504" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">如果您遵循了前两个部分，您应该有一个连接到您的工作前端的工作后端。或者，如果您有自己的后端和前端设置和连接，那也可以，只要Firebase在您以前使用的语言中受支持。(很可能是)你可能只需要稍微改变这些指令(也许你使用的是pip，而不是npm，你的代码看起来会不同，只要检查一下<a class="ae kl" href="https://firebase.google.com/docs" rel="noopener ugc nofollow" target="_blank">文档</a>等)</p><p id="75da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，去firebase创建一个新项目。叫它你喜欢的，我建议不要使用谷歌分析，这个项目没有意义。一旦完成，我们需要将它添加到我们的Vue和后端。为什么都是？嗯…</p><p id="e595" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了测试这一点，我们必须使用Firebase Auth将一个用户登录到我们的前端，为该用户获取一个AuthToken，然后将该令牌发送到我们的服务器，并使用Firebase Admin来验证该令牌。所以前端和后端都需要使用Firebase。因此，让我们先将它添加到我们的前端，并让一个虚拟用户登录。</p><h1 id="6494" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">前端的Firebase Auth</h1><p id="87aa" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先，<code class="fe lp lq lr ls b">npm i firebase</code>在我们的Vue项目中。然后转到<code class="fe lp lq lr ls b">main.js</code>，用<code class="fe lp lq lr ls b">import firebase from 'firebase'</code>导入。</p><p id="f7b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">点击firebase应用程序首页的&gt;图标，创建一个客户端项目。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi my"><img src="../Images/faf350c54656bd3beb56be1d1cc3304a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*oh5C7070kYEhv-EYhwR-lg.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">首先添加一个客户端项目</figcaption></figure><p id="a8b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，您应该会看到一个配置文件。继续复制看起来类似于</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="1c3e" class="ms kn iq ls b gy mt mu l mv mw">{<br/>  apiKey: "AIzaSyBqLUasFAKEBvY94anzYi1P1o19DKs",<br/>  authDomain: "fbauthdemo-2a451.firebaseapp.com",<br/>  databaseURL: "https://fbauthdemo-2a451.firebaseio.com",<br/>  projectId: "fbauthdemo-2a451",<br/>  storageBucket: "",<br/>  messagingSenderId: "839675573680",<br/>  appId: "1:839675573680:web:b7e921f299469934659275"<br/>}</span></pre><p id="ce71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后转到我们的Vue项目，转到我们导入firebase的<code class="fe lp lq lr ls b">main.js</code>文件，我们可以用</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="b7f9" class="ms kn iq ls b gy mt mu l mv mw">firebase.initializeApp({<br/>  apiKey: "AIzaSyBqLUXaDFAKEY94anzYi1P1o19DKs",<br/>  authDomain: "fbauthdemo-2a451.firebaseapp.com",<br/>  databaseURL: "https://fbauthdemo-2a451.firebaseio.com",<br/>  projectId: "fbauthdemo-2a451",<br/>  storageBucket: "",<br/>  messagingSenderId: "839675573680",<br/>  appId: "1:839675573680:web:b7e921f299469934659275"<br/>})</span></pre><p id="e5f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们创建这个虚拟用户。回到Firebase，如果你不在那里，点击“继续控制台”。现在在侧边栏上，选择“认证”，然后在中间点击“设置登录方法”。接下来，您可以选择电子邮件，并启用它(不是电子邮件无密码链接部分)。既然已经启用，请返回“身份验证”页面，并在右侧单击“添加用户”。填写一些虚拟数据并记住它，因为我们将把它硬编码到我们的应用程序中。我将使用“dummy@gmail.com”和“pass123！”。</p><p id="56b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">显然，如果你有自己的前端，或者打算把它变成一个真正的应用，添加实际的用户注册和登录，不要硬编码。但这只是为了演示的目的。</p><p id="7801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们转到Vue应用程序，添加一种登录方式。首先，进口firebase。接下来，让我们创建两个方法，<code class="fe lp lq lr ls b">signIn</code>和<code class="fe lp lq lr ls b">signOut</code>，以及另一个数据变量和p标签来显示该状态。</p><p id="4d51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，如果用户已经登录，我们希望将AuthToken添加到请求头中。</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="b6a3" class="ms kn iq ls b gy mt mu l mv mw">...<br/>firebase.auth().currentUser.getIdToken(true)<br/>  .then((idToken) =&gt; {<br/>    client({<br/>    method: 'get',<br/>    url: '/',<br/>    headers: {<br/>      'AuthToken': idToken<br/>    }<br/>...</span></pre><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">完整的Vue应用程序代码</figcaption></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/4af3920fdeddecc95c75252a74a8d319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRpo66F9tpRmivBFAhiQJQ.png"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">我们完整的Vue应用</figcaption></figure><p id="b7d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然我们的前端已经完成，无论我们是否登录，我们都应该从后端得到相同的响应，这取决于<code class="fe lp lq lr ls b">authorized</code>虚拟变量是什么。让我们改变这一点，在后端使用真正的Firebase管理验证。</p><h1 id="36c6" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">后端的Firebase管理</h1><p id="5d47" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">现在终于可以进入教程的正题了！让我们去掉虚拟数据，使用firebase来检查请求的授权！首先，让我们来看一下<code class="fe lp lq lr ls b">npm i firebase-admin</code>的服务器项目。然后导入到我们的app.js <code class="fe lp lq lr ls b">const admin = require('firebase-admin')</code>。</p><p id="2696" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们的项目需要一个服务帐户。进入你的firebase控制台，点击左边的设置图标，然后选择“项目设置”。然后转到“服务帐户”选项卡。在那里，我们将单击“生成新的私钥”，并将其存储在我们的客户端项目中的<code class="fe lp lq lr ls b">config/fbServiceAccountKey.json</code>下。<strong class="jp ir">注意:不要把这个上传到github，或者公开分享。</strong></p><p id="894c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们可以复制他们给我们的代码来初始化管理应用程序，用我们存储密钥的真实路径替换虚拟路径。</p><pre class="lu lv lw lx gt mo ls mp mq aw mr bi"><span id="7a7f" class="ms kn iq ls b gy mt mu l mv mw">const serviceAccount = require("config/fbServiceAccountKey.json");</span><span id="1d0a" class="ms kn iq ls b gy na mu l mv mw">admin.initializeApp({<br/>  credential: admin.credential.cert(serviceAccount),<br/>  databaseURL: "https://fbauthdemo-2a451.firebaseio.com"<br/>});</span></pre><p id="0f79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你的应用应该略有不同，因为你的应用不是我的应用。因此您的数据库URL将会不同。</p><p id="a9fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们使用firebase来检查请求头中的AuthToken，而不是检查我们的<code class="fe lp lq lr ls b">checkAuth()</code>函数中的虚拟变量。首先，我们检查它是否存在，如果存在，我们使用Firebase Admin来验证它。如果它被验证，我们继续，否则我们返回一个“403:未授权”。</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a682" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的代码是完整的！我们最终的app.js应该是这样的:</p><figure class="lu lv lw lx gt ly"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="569a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我们像以前一样运行我们的服务器<code class="fe lp lq lr ls b">DEBUG=server:* nodemon start</code>，像以前一样运行我们的客户机<code class="fe lp lq lr ls b">npm run serve</code>，我们就可以测试认证检查了！如果我们点击前端的“登录&gt;”，然后点击“发送请求&gt;”，我们就可以成功收到Hello World消息了！如果我们点击“注销&gt;”，然后尝试点击“发送请求&gt;”，我们将得到403:未授权！</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e802055307b1d6ea41b11b8d75862d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*MwH9b8xbMQ8OeRtlF6SYPA.gif"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">成功！</figcaption></figure><p id="20e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你成功了，恭喜你，我希望这有所帮助。这是我的第一篇媒体文章，花费的时间比我想象的要长！我猜掌声是受欢迎的，如果你需要源代码，请查看我的<a class="ae kl" href="https://github.com/djpeach/fbAuthDemo" rel="noopener ugc nofollow" target="_blank"> github </a>中的“fbAuthDemo”。我可能会在这里添加一个视频教程！直到下一次…</p></div></div>    
</body>
</html>