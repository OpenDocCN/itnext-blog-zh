<html>
<head>
<title>Add Smart Attacking to Your PySC2 Agent</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">给你的PySC2代理添加智能攻击</h1>
<blockquote>原文：<a href="https://itnext.io/add-smart-attacking-to-your-pysc2-agent-17fd5caad578?source=collection_archive---------1-----------------------#2017-11-14">https://itnext.io/add-smart-attacking-to-your-pysc2-agent-17fd5caad578?source=collection_archive---------1-----------------------#2017-11-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9b32964eb76b80a460d4d524f655cfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fdYSlOOqN30ZM8Y7excxjg.png"/></div></div></figure><p id="8f5b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的上一个教程中，我们给我们的PySC2代理添加了一个Q-Learning表，但是攻击坐标是预先编程的，这意味着代理实际上只在Simple64地图上工作，并且当敌人单位或建筑一旦到达攻击坐标就在单位的攻击半径之外时，很容易陷入僵局。</p><p id="4d11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我们将为代理添加智能攻击，这样它可以根据探测到的敌人单位或建筑的位置来学习攻击哪里。</p><p id="63ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，本教程是从上一个教程停止的地方开始的。为了遵循这些步骤，您应该从教程中复制最终代码。</p><p id="65f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">致暴雪/深度思维AI工作坊</em>  <em class="kx">的朋友们，这是第一个涵盖我演讲细节的教程。</em></p><h1 id="9175" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">1.建立</h1><p id="0d8f" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">首先，让我们对现有代码进行一些调整，我们将在本教程的剩余部分使用这些代码。</p><p id="6518" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，让我们添加一个常数:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="a034" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们重命名我们的类:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="975a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记父<code class="fe mh mi mj mk b">step</code>方法调用:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="892d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您遵循了我以前教程的一些早期版本，似乎有些人在未定义的属性方面有问题，所以让我们将我们的init方法级联到父类(这在以前的教程中已经解决了):</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="b18e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还将使用小地图做一些有趣的事情，所以让我们将现有的<code class="fe mh mi mj mk b">transformLocation</code>方法重命名为<code class="fe mh mi mj mk b">transformDistance</code>，并添加一个新的<code class="fe mh mi mj mk b">transformLocation</code>方法，如下所示:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="159a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">新的<code class="fe mh mi mj mk b">transformLocation</code>方法将基于你的基地的位置，而不仅仅是距离，来转换绝对的<em class="kx"> x </em>和<em class="kx"> y </em>值。</p><p id="0e77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经将我们的<code class="fe mh mi mj mk b">transformLocation</code>方法重命名为<code class="fe mh mi mj mk b">transformDistance</code>，我们应该更新使用旧<code class="fe mh mi mj mk b">transformLocation</code>方法的动作:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="7793" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以开始添加智能攻击功能。</p><h1 id="ae00" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2.改变攻击动作</h1><p id="52b0" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">以前我们只有一个单一的“攻击”动作，我们要用几个动作来代替那个动作，这样我们的机器人就可以攻击小地图上几个点中的一个。</p><p id="6db1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用以下内容替换现有的<code class="fe mh mi mj mk b">smart_actions</code>定义:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e53a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的<code class="fe mh mi mj mk b">smart_actions</code>变量现在包含一个攻击小地图上每个单独的<em class="kx"> x </em>和<em class="kx"> y </em>坐标组合的动作。</p><p id="e49b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然机器人可以从可能的动作列表中选择攻击动作，我们需要确保它正确地执行攻击。</p><p id="9e66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在整个IF条件段之前插入以下代码:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="5e85" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在这里做的是检测smart_action变量中下划线的存在，因为没有其他包含下划线的操作，我们可以假设它是一个小地图攻击操作。接下来，我们拆分智能动作以获得<em class="kx"> x </em>和<em class="kx"> y </em>坐标。</p><p id="a0a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以更新攻击条件如下:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="7af7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，我们将x和y值转换为整数，因为它们仍然是来自<code class="fe mh mi mj mk b">split</code>命令的字符串。</p><p id="ab5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是测试它的好时机，看看它的表现如何:</p><pre class="mb mc md me gt ml mk mm mn aw mo bi"><span id="e465" class="mp kz iq mk b gy mq mr l ms mt">python -m pysc2.bin.agent \<br/>--map Simple64 \<br/>--agent attack_agent.AttackAgent \<br/>--agent_race T \<br/>--max_agent_steps 0 \<br/>--norender</span></pre><p id="ed3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看起来你的机器人好像什么都没做，因为在某种程度上它就是这样！由于可能的行动非常多，大多数时候它会试图攻击一个地点，即使它没有选择一个单位。我们将在下一步处理这个问题。</p><h1 id="3c34" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">3.简化动作</h1><p id="fc66" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">虽然我们的小地图是64x64的网格，但海军陆战队的攻击半径足够大，你只需要一个4x4的网格就可以有效地覆盖所有的Simple64地图，所以我们将减少我们的攻击点如下:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/ac2f4f142aeb1d69509d241589d0fdc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*hX0oEKfqbyIvkle4fNwW8Q.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">减少简单64地图的攻击点</figcaption></figure><p id="3d77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这可以使用以下代码将您的攻击操作减少到16种组合:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="7595" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在每个方块实际上覆盖了一个16x16的子方块网格，我们通过将每个轴上的值移动8来移动较大方块中间的攻击坐标。这比贴在每个方块的左上角提供了更好的地图覆盖。</p><p id="f43e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">试运行一下，看看你的机器人发现建造补给站和兵营的速度有多快。</p><h1 id="fd81" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">4.添加敌人的位置</h1><p id="aa86" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">过一会儿，你的机器人可能会认为它应该攻击敌人基地的一般区域，但是如果地图上没有单位，它也可以学习在那个区域攻击，不管那里是否有敌人单位。这是因为你的奖励与位置有关，而不是与敌人单位的存在有关。</p><p id="617e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以通过将小地图中的敌人位置添加到<code class="fe mh mi mj mk b">current_state</code>变量中来改善这一点。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="fb90" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在你可以再次运行代理程序，通过足够多的游戏，它将开始学习攻击包含敌人单位或建筑的坐标。</p><h1 id="94cd" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">5.简化状态</h1><p id="6953" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">这么多敌人坐标的一个问题是你的机器人会花很长时间去探索所有可能的选项。正如我们的小地图可以减少到16个方块的攻击空间，我们也可以减少到16个方块的状态空间，从而减少探索时间:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/5e1bffe883cd45322b2b56b58e851398.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*U6DGYoRtnOpJnuV1fFURxQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">简单64地图的敌人位置网格</figcaption></figure><p id="5ee5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了做到这一点，我们检查每个方块内的每个坐标，如果任何坐标包含一个敌人单位，整个方块被标记为“热点”。</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="b403" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行你的代码，你会发现你的机器人的攻击组件更加智能了！</p><h1 id="b95b" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">6.SCV攻击作弊</h1><p id="0116" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">有一件事可能会让你对你现在的机器人感到沮丧，那就是它仍然会花很多时间派scv去攻击敌人。在未来的教程中，我们将会介绍一个更完善的奖励系统，它可以阻止这种行为，但是现在你可以简单地通过替换这段代码来欺骗和禁止scv攻击的能力:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="354f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这个:</p><figure class="mb mc md me gt jr"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e936" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦这个代码到位，我发现我的代理能够在很少的游戏中击败敌人。</p><p id="cbb0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本教程的所有代码都可以在<a class="ae kw" href="https://github.com/skjb/pysc2-tutorial/tree/master/Building%20an%20Attack%20Agent" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><p id="4612" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" href="https://medium.com/@skjb/build-a-sparse-reward-pysc2-agent-a44e94ba5255" rel="noopener">我的下一个教程</a>中，你会发现如何使用稀疏奖励来训练你的代理。</p><p id="f532" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢这个教程，请在<a class="ae kw" href="https://www.patreon.com/skjb" rel="noopener ugc nofollow" target="_blank">上支持我。也请和我一起上</a><a class="ae kw" href="https://discord.gg/qTZ65sh" rel="noopener ugc nofollow" target="_blank"> Discord </a>，或者关注我上<a class="ae kw" href="https://www.twitch.tv/skjb" rel="noopener ugc nofollow" target="_blank"> Twitch </a>、<a class="ae kw" href="https://medium.com/@skjb" rel="noopener"> Medium </a>、<a class="ae kw" href="https://github.com/skjb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae kw" href="https://twitter.com/theskjb" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae kw" href="https://www.youtube.com/channel/UCZcEvhpV4_6llcrWrWQ2wsg" rel="noopener ugc nofollow" target="_blank"> YouTube </a>。</p></div></div>    
</body>
</html>