<html>
<head>
<title>Building a custom dashboard for JenkinsX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为JenkinsX构建自定义仪表板</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-custom-dashboard-for-jenkinsx-6d10bbd18b6?source=collection_archive---------7-----------------------#2018-11-22">https://itnext.io/building-a-custom-dashboard-for-jenkinsx-6d10bbd18b6?source=collection_archive---------7-----------------------#2018-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dd66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何在动态信息图中可视化复杂的技术流程。</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b3ae27e5ae766ce5923e9a4cf2ebaf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbAacT8mzYKvz0BuIlwCVw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用各种来源的PPT和事件的Mashup</figcaption></figure><p id="435f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近在苏黎世的一次聚会上，我第一次见到了JenkinsX，这是基于Kubernetes的Jenkins CI的新版本。对目前正在建造的东西印象非常深刻，我很快意识到这个怪兽是多么强大和复杂。</p><p id="591d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">JenkinsX现在正在精心策划一个完整的生态系统，包括git源回购、掌舵图和工件回购、登台和生产环境，甚至基于PR的预览环境。相当酷。</p><p id="d617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我发现很难详细了解正在发生的事情。您实际上可以使用新的cli客户端:<code class="fe lb lc ld le b">jx get activities</code> <em class="lf">跟踪管道的状态。然而，我决定用我的事件监控工具MetaControl创建我自己的小仪表板。</em></p><blockquote class="lg lh li"><p id="b98c" class="jn jo lf jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated">元控制聚合来自各种来源的元事件，并提供状态/严重性级别的聚合视图。它目前处于测试阶段，可以免费访问。看看这里。</p></blockquote><p id="d70a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其结果是整个过程的混搭，结合现场发生的事件，给我一个整体结构的鸟瞰图。它由构建为SVG的图形元素(用Powerpoint和Inkscape绘制)和一系列嵌入的显示当前状态的小部件组成。</p><p id="181e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些小部件显示类似交通灯的状态指示器和严重级别。根据布局，它们还显示历史状态和事件的身份/类别。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b59b01ef874a9017fa970eb6f81cdec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WfNhMrCsPnFGcSHFy8rPxg.png"/></div></div></figure><p id="65ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lf">点击小部件将提供2级列表/详细视图，用于深入查看单个事件。</em></p><p id="2fdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lf">您还会发现事件附带的完整元信息，有助于更深入的调查。</em></p><h1 id="401d" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">佐料</h1><p id="72b2" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">为了将事件从管道的各个部分带到仪表板上，需要与元控制进行一些集成:</p><h2 id="e07a" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">来自各种名称空间的Kubernetes API事件</h2><p id="cacb" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">如前所述，JenkinsX使用了相当多的k8s资源来提供构建容器、预览/登台/生产环境以及相关的实用服务。当操作管道时，在API级别上发生的任何事件也是有趣的。</p><p id="68d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我写了一个附加在k8s API上的小探针，它使用一个<a class="ae nb" href="https://github.com/verticle-io/oculus" rel="noopener ugc nofollow" target="_blank">https://github.com/verticle-io/oculus</a>的变体将事件转发给元控制。</p><h2 id="0c1d" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">jx管道活动</h2><p id="43c0" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">基本上，jx管道事件是Kubernetes中的自定义资源定义(CRD)。您可以像关注API事件一样关注它们。它们包含关于CI阶段、它们的处理步骤的信息，以及关于构建和工件的详细信息。</p><h2 id="286b" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">Github事件</h2><p id="edc4" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">JX也挂钩到Github回购。它甚至管理促销，并使用gitops来处理k8s环境的部署状态，因此它在各种回购中非常活跃。为了跟踪这些操作，我将webhooks应用于每个repo，这些repo将所有操作发送到MetaControl上的特定webhook处理器。有效载荷被处理并转换成元控制兼容事件。</p><h2 id="347d" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">其他来源</h2><p id="60a2" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我跳过了其他值得监控的资源，比如舵图和构建工件的存储库。尽管它们可能是即将到来的版本的候选者。</p><p id="b88b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以将事件从您部署的应用程序发送到仪表板(例如，健康状态或类似的内容)或发送机器统计数据，这只是几个潜在的扩展。</p><h1 id="dea0" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">在元控件中观察事件</h1><p id="e3ab" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">一旦附加了所有的源，它们就会在元控件UI中可见。启动JX演示应用程序并从Github启动CI流将会产生如下结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nc"><img src="../Images/eecf8420fe965251d9b7fbda439cf638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VbgGESUBcPwoaxQBBQIFOQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">MetaControl Fireboard视图，Github、JX和Kubernetes有单独的通道</figcaption></figure><p id="b943" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">四个通道中的流显示所有接收到的事件以及运行时传入的事件，这对于探索非常有用。连同其他可视化，如24小时热图，最新状态网格或事件分布的一般统计，你会对正在发生的事情有一个好印象。</p><p id="1162" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们希望为事件添加更多的上下文来定位和映射它们。这是通过元控制<em class="lf">原理图</em>完成的。</p><h1 id="ebb5" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">元控制示意图</h1><p id="9c08" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated"><em class="lf"> Schematics </em>应用程序生成了本文开头的仪表盘。</p><p id="27e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，<em class="lf">示意图</em>是一种视觉方法的尝试，提供了比标准元控制事件流、热图或网格更可定制的体验。</p><p id="c3f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从技术上来说，它是一个小角度的应用程序，从一个yaml文件配置呈现仪表板元素。它通过websockets从MetaControl获取事件流，并即时操纵svg小部件。</p><h2 id="d830" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">仪表板配置</h2><p id="b38f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">yaml配置提供了数据绑定(数据桶)和小部件配置部分，包括数据选择器、过滤器和布局选项。</p><p id="1b86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以从事件元数据呈现标签，并使用类别、标识符或元键/值选择器进行过滤。</p><pre class="km kn ko kp gt nd le ne nf aw ng bi"><span id="878a" class="mp ln iq le b gy nh ni l nj nk">github-demo-push-label:<br/> type: label<br/> title: github-demo-push-hash<br/> description: |<br/>   Commit hash on the github repository for the project.<br/> origin: github webhook<br/> pos:<br/>  x: 227<br/>  y: 63<br/> matchCategory: github.push<br/> matchIdent: demo<br/> eventTextSelectorMetaSection: meta<br/> eventTextSelectorMetaProperty: hash<br/> backgroundOpacity: 0.0<br/> textColor: rgb(255, 255, 255)<br/> widgetBackgroundColor: rgb(255, 255, 255)<br/> mode: compact</span></pre><p id="c882" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这为设计仪表板留下了大量的选项，并使它看起来像你想要的那样，显示你认为重要的信息，并提供必要时更深入挖掘的方法。</p><h2 id="6407" class="mp ln iq bd lo mq mr dn ls ms mt dp lw jy mu mv ma kc mw mx me kg my mz mi na bi translated">事件流</h2><p id="3dd4" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">与元控制(也显示过去24小时的历史事件)不同的是，<em class="lf"> Schematics </em>将只显示来自数据流的实时事件。然而，它有一个每个部件的选项，在一些TTL后清除事件，所以它显示了最近活动的清理视图，而不是显示过时的信息。</p><h1 id="cd3f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">摘要</h1><p id="99b2" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mm ka kb kc mn ke kf kg mo ki kj kk ij bi translated">我喜欢创造这个小橱窗。它帮助我更好地理解了JenkinsX的整个过程和它的活动部分，希望你喜欢创建动态信息图的想法。当事情稍微复杂一点时，它确实有助于清楚地了解正在发生的事情。</p><p id="f56a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果MetaControl引起了您的兴趣，并且您想了解更多相关信息，请访问<a class="ae nb" href="https://fireboard.verticle.io" rel="noopener ugc nofollow" target="_blank"> https://verticle.io </a>查看。</p><p id="3279" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lf">示意图</em>正在大量开发中，但我会尽快在网上提供一个粗略的版本。</p></div></div>    
</body>
</html>