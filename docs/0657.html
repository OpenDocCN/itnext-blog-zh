<html>
<head>
<title>Minishift + Istio up and running</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Minishift + Istio启动并运行</h1>
<blockquote>原文：<a href="https://itnext.io/minishift-istio-up-and-running-93bd125fe310?source=collection_archive---------3-----------------------#2018-05-01">https://itnext.io/minishift-istio-up-and-running-93bd125fe310?source=collection_archive---------3-----------------------#2018-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">定义</strong> : Minishift，Service Mesh，Istio。</p><p id="328d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Minishift </strong> —一个帮助我们通过在虚拟机内部运行单节点OpenShift集群来本地运行OpenShift的工具。</p><p id="c03c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">服务网格</strong> —需要专用基础设施层的微服务网络，该基础设施层提供负载平衡、流量管理、路由、可观察性，如监控、日志记录、指标、跟踪、安全策略、身份验证以及针对入侵和DDoS攻击的保护。基本上，如果我们要构建云原生微服务应用，我们需要服务网格。服务网格的一般概念包括:</p><ul class=""><li id="f60f" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">控制平面:Linkerd、NGINX、Envoy、Traefik</li><li id="1cc0" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">数据平面:Istio、Nelson、SmartStack</li></ul><p id="5436" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Istio  —连接、管理和保护微服务的开放平台。默认情况下，Istio的数据平面由一组部署为sidecars的智能代理(Envoy)组成。Istio可以与Linkerd和NGINX集成，作为Envoy的替代。Istio可以部署在各种环境中，例如:</p><ul class=""><li id="4250" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">库伯内特斯</li><li id="bb7f" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">游牧者和执政官</li><li id="94ba" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">尤里卡</li><li id="3eef" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">云铸造厂</li><li id="9749" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">阿帕奇Mesos</li></ul><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/3bb9118f8358758014c1bb90411e2859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*_jCdH526MxXtGH28XaJgGg.jpeg"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">图片由Istio提供</figcaption></figure><p id="5501" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将在MacOS Sierra上设置Minishift + Istio，用于本地开发、测试和学习。</p><p id="1728" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">先决条件:</strong></p><p id="40f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">1 —自制</p><p id="cd8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2 —虚拟框</p><p id="061f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用家酿安装Minishift。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="9a15" class="lx ly iq lt b gy lz ma l mb mc">$ brew cask install minishift<br/><br/>Updating Homebrew...<br/><br/>==&gt; Auto-updated Homebrew!<br/><br/>Updated 2 taps (caskroom/cask, homebrew/core).<br/><br/>==&gt; New Formulae<br/><br/>gitlab-gem<br/><br/>==&gt; Satisfying dependencies<br/><br/>==&gt; Downloading https://github.com/minishift/minishift/releases/download/v1.15.1/minishift-1.15.1-darwin-amd64.tgz<br/><br/>Already downloaded: /Users/sai/Library/Caches/Homebrew/Cask/minishift<em class="md">--1.15.1.tgz</em><br/><br/>==&gt; Verifying checksum for Cask minishift<br/><br/>==&gt; Installing Cask minishift<br/><br/>==&gt; Linking Binary 'minishift' to '/usr/local/bin/minishift'.<br/><br/>🍺  minishift was successfully installed!</span></pre><p id="4207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用virtualbox启动Minishift。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="52dc" class="lx ly iq lt b gy lz ma l mb mc">$ minishift start <em class="md">--vm-driver=virtualbox</em><br/><br/><em class="md">-- Starting profile 'minishift'</em><br/><em class="md">-- Checking if requested OpenShift version 'v3.7.2' is valid ... OK</em><br/><em class="md">-- Checking if requested OpenShift version 'v3.7.2' is supported ... OK</em><br/><em class="md">-- Checking if requested hypervisor 'virtualbox' is supported on this platform ... OK</em><br/><em class="md">-- Checking if VirtualBox is installed ... OK</em><br/><em class="md">-- Checking the ISO URL ... OK</em><br/><em class="md">-- Downloading OpenShift binary 'oc' version 'v3.7.2'</em><br/> 38.18 MiB / 38.18 MiB [======================================================================================================================================================================] 100.00% 0s<em class="md">-- Downloading OpenShift v3.7.2 checksums ... OK</em><br/><em class="md">-- Checking if provided oc flags are supported ... OK</em><br/><em class="md">-- Starting local OpenShift cluster using 'virtualbox' hypervisor ...</em><br/><em class="md">-- Minishift VM will be configured with ...</em><br/>   Memory:    2 GB<br/>   vCPUs :    2<br/>   Disk size: 20 GB<br/><br/>   Downloading ISO 'https://github.com/minishift/minishift-b2d-iso/releases/download/v1.2.0/minishift-b2d.iso'<br/> 40.00 MiB / 40.00 MiB [======================================================================================================================================================================] 100.00% 0s<br/><em class="md">-- Starting Minishift VM .......................... OK</em><br/><em class="md">-- Checking for IP address ... OK</em><br/><em class="md">-- Checking for nameservers ... OK</em><br/><em class="md">-- Checking if external host is reachable from the Minishift VM ...</em><br/>   Pinging 8.8.8.8 ... OK<br/><em class="md">-- Checking HTTP connectivity from the VM ...</em><br/>   Retrieving http://minishift.io/index.html ... OK<br/><em class="md">-- Checking if persistent storage volume is mounted ... OK</em><br/><em class="md">-- Checking available disk space ... 0% used OK</em><br/>   Importing 'openshift/origin:v3.7.2'  CACHE MISS<br/>   Importing 'openshift/origin-docker-registry:v3.7.2'  CACHE MISS<br/>   Importing 'openshift/origin-haproxy-router:v3.7.2'  CACHE MISS<br/><em class="md">-- OpenShift cluster will be configured with ...</em><br/>   Version: v3.7.2<br/>Starting OpenShift using openshift/origin:v3.7.2 ...<br/>Pulling image openshift/origin:v3.7.2<br/>Pulled 1/4 layers, 26% complete<br/>Pulled 2/4 layers, 62% complete<br/>Pulled 3/4 layers, 81% complete<br/>Pulled 4/4 layers, 100% complete<br/>Extracting<br/>Image pull complete<br/>OpenShift server started.<br/><br/>The server is accessible via web console at:<br/>    https://192.168.99.102:8443<br/><br/>You are logged in as:<br/>    User:     developer<br/>    Password: &lt;any value&gt;<br/><br/>To login as administrator:<br/>    oc login -u system:admin<br/><br/><em class="md">-- Exporting of OpenShift images is occuring in background process with pid 43990.</em></span></pre><p id="1bd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">设置环境。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="41cf" class="lx ly iq lt b gy lz ma l mb mc">$ eval $(minishift oc-env)<br/>$ eval $(minishift docker-env)<br/>$ oc login $(minishift ip):8443 -u admin -p admin<br/>Login successful.<br/><br/>You don't have any projects. You can try to create a new project, by running<br/><br/>    oc new-project &lt;projectname&gt;</span></pre><p id="6ddd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">浏览OpenShift Web控制台</strong></p><p id="bd0c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> $(minishift ip):8443。登录用户名:admin，密码:admin </strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/0361e2a20ed30c6d19a77e42141eaf1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9duwCBp4Z7BGY-Rn5CMJ6A.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">OpenShift Web控制台</figcaption></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="af2c" class="lx ly iq lt b gy lz ma l mb mc">$ oc get users<br/>Error from server (Forbidden): User "admin" cannot list users at the cluster scope: User "admin" cannot list all users in the cluster (get users)<br/><br/>$ oc get projects<br/>No resources found.</span></pre><p id="0c92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">以“开发者”身份登录。请查看输出的详细信息。(例如:开发者帐户没有列出用户的权限。)</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="76d4" class="lx ly iq lt b gy lz ma l mb mc">$ oc login -u developer -p developer<br/>Login successful.<br/><br/>You have one project on this server: "myproject"<br/><br/>Using project "myproject".<br/>$ oc get users<br/>Error from server (Forbidden): User "developer" cannot list users at the cluster scope: User "developer" cannot list all users in the cluster (get users)<br/><br/>$ oc whoami<br/>developer</span></pre><p id="c5df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用system:admin登录(作为集群管理员运行)。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="3954" class="lx ly iq lt b gy lz ma l mb mc">$ oc login -u system:admin<br/><br/>You have access to the following projects and can switch between them with 'oc project &lt;projectname&gt;':<br/><br/>  * default<br/>    kube-public<br/>    kube-system<br/>    myproject<br/>    openshift<br/>    openshift-infra<br/>    openshift-node<br/><br/>Using project "default".<br/><br/>Sais-MacBook-Pro:~ sai$ oc whoami<br/>system:admin<br/><br/>$ oc get users<br/>NAME        UID                                    FULL NAME   IDENTITIES<br/>admin       a25341a0-3f43-11e8-8fd4-c2b0403aac41               anypassword:admin<br/>developer   1cfb7fd1-3f43-11e8-8fd4-c2b0403aac41               anypassword:developer</span></pre><p id="093a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">将集群管理员角色分配给管理员，并使用管理员重新登录。现在管理员用户帐户可以做“oc获取用户”。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="be49" class="lx ly iq lt b gy lz ma l mb mc">$ oc adm policy add-cluster-role-to-user cluster-admin admin<br/>cluster role "cluster-admin" added: “admin"</span><span id="b86b" class="lx ly iq lt b gy mj ma l mb mc">$ oc login $(minishift ip):8443 -u admin -p admin<br/>Login successful.<br/><br/>You have access to the following projects and can switch between them with 'oc project &lt;projectname&gt;':<br/><br/>  * default<br/>    kube-public<br/>    kube-system<br/>    myproject<br/>    openshift<br/>    openshift-infra<br/>    openshift-node<br/><br/>Using project "default".<br/><br/>$ oc get users<br/>NAME        UID                                    FULL NAME   IDENTITIES<br/>admin       a25341a0-3f43-11e8-8fd4-c2b0403aac41               anypassword:admin<br/>developer   1cfb7fd1-3f43-11e8-8fd4-c2b0403aac41               anypassword:developer</span></pre><p id="5679" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用管理员帐户在OpenShift Web控制台中进行验证。</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/302b9014b94f0a5778e00e07804cc0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JEuB1jqVKKRuIutFve1zDA.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">使用管理员帐户打开Shift Web控制台访问</figcaption></figure><p id="21da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">下载Istio并在~/中设置路径。bash_profile。</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/0667a99ab8c61035724e793a3fe161d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*248wzXJPa5ByBAgMpKuFAw.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">已下载Istio 0.6.0</figcaption></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="3585" class="lx ly iq lt b gy lz ma l mb mc">$ ls -la istio-0.6.0/<br/>total 48<br/>drwxr-xr-x   9 sai  staff    306 Mar  1 03:51 .<br/>drwxr-xr-x+ 84 sai  staff   2856 Apr 14 18:43 ..<br/>-rw-r<em class="md">--r--   1 sai  staff  11343 Mar  1 03:51 LICENSE</em><br/>-rw-r<em class="md">--r--   1 sai  staff   5855 Mar  1 03:51 README.md</em><br/>drwxr-xr-x   3 sai  staff    102 Mar  1 03:51 bin<br/>drwxr-xr-x   9 sai  staff    306 Mar  1 03:51 install<br/>-rw-r<em class="md">--r--   1 sai  staff    685 Mar  1 03:51 istio.VERSION</em><br/>drwxr-xr-x  10 sai  staff    340 Mar  1 03:51 samples<br/>drwxr-xr-x  16 sai  staff    544 Mar  1 03:51 tools<br/><br/>$ more .bash_profile<br/>export PATH="$PATH:/Users/sai/istio-0.6.0/bin"<br/><br/>$ which istioctl<br/>/Users/sai/istio-0.6.0/bin/istioctl</span></pre><p id="ee45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为Istio设置必要的权限。<br/>请阅读此处的</strong> <a class="ae mk" href="https://blog.openshift.com/understanding-service-accounts-sccs/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">了解服务帐户和SCC。</strong> </a></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="354a" class="lx ly iq lt b gy lz ma l mb mc">$ oc new-project istio-system<br/>$ oc adm policy add-scc-to-user anyuid -z istio-ingress-service-account<br/>$ oc adm policy add-scc-to-user privileged -z istio-ingress-service-account<br/>$ oc adm policy add-scc-to-user anyuid -z istio-egress-service-account<br/>$ oc adm policy add-scc-to-user privileged -z istio-egress-service-account<br/>$ oc adm policy add-scc-to-user anyuid -z istio-pilot-service-account<br/>$ oc adm policy add-scc-to-user privileged -z istio-pilot-service-account<br/>$ oc adm policy add-scc-to-user anyuid -z istio-grafana-service-account -n istio-system<br/>$ oc adm policy add-scc-to-user anyuid -z istio-prometheus-service-account -n istio-system<br/>$ oc adm policy add-scc-to-user anyuid -z prometheus -n istio-system<br/>$ oc adm policy add-scc-to-user privileged -z prometheus<br/>$ oc adm policy add-scc-to-user anyuid -z grafana -n istio-system<br/>$ oc adm policy add-scc-to-user privileged -z grafana<br/>$ oc adm policy add-scc-to-user anyuid -z default<br/>$ oc adm policy add-scc-to-user privileged -z default<br/>$ oc adm policy add-cluster-role-to-user cluster-admin -z default</span></pre><p id="833e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装Istio组件和附加组件。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="ad3a" class="lx ly iq lt b gy lz ma l mb mc">$ cd istio-0.6.0/<br/><br/>$ oc apply -f install/kubernetes/istio.yaml<br/><br/>Warning: kubectl apply should be used on resource created by either kubectl create <em class="md">--save-config or kubectl apply</em><br/>namespace "istio-system" configured<br/>clusterrole "istio-pilot-istio-system" created<br/>clusterrole "istio-sidecar-injector-istio-system" created<br/>clusterrole "istio-mixer-istio-system" created<br/>clusterrole "istio-ca-istio-system" created<br/>clusterrole "istio-sidecar-istio-system" created<br/>clusterrolebinding "istio-pilot-admin-role-binding-istio-system" created<br/>clusterrolebinding "istio-sidecar-injector-admin-role-binding-istio-system" created<br/>clusterrolebinding "istio-ca-role-binding-istio-system" created<br/>clusterrolebinding "istio-ingress-admin-role-binding-istio-system" created<br/>clusterrolebinding "istio-sidecar-role-binding-istio-system" created<br/>clusterrolebinding "istio-mixer-admin-role-binding-istio-system" created<br/>configmap "istio-mixer" created<br/>service "istio-mixer" created<br/>serviceaccount "istio-mixer-service-account" created<br/>deployment "istio-mixer" created<br/>customresourcedefinition "rules.config.istio.io" created<br/>customresourcedefinition "attributemanifests.config.istio.io" created<br/>customresourcedefinition "circonuses.config.istio.io" created<br/>customresourcedefinition "deniers.config.istio.io" created<br/>customresourcedefinition "fluentds.config.istio.io" created<br/>customresourcedefinition "kubernetesenvs.config.istio.io" created<br/>customresourcedefinition "listcheckers.config.istio.io" created<br/>customresourcedefinition "memquotas.config.istio.io" created<br/>customresourcedefinition "noops.config.istio.io" created<br/>customresourcedefinition "opas.config.istio.io" created<br/>customresourcedefinition "prometheuses.config.istio.io" created<br/>customresourcedefinition "rbacs.config.istio.io" created<br/>customresourcedefinition "servicecontrols.config.istio.io" created<br/>customresourcedefinition "solarwindses.config.istio.io" created<br/>customresourcedefinition "stackdrivers.config.istio.io" created<br/>customresourcedefinition "statsds.config.istio.io" created<br/>customresourcedefinition "stdios.config.istio.io" created<br/>customresourcedefinition "apikeys.config.istio.io" created<br/>customresourcedefinition "authorizations.config.istio.io" created<br/>customresourcedefinition "checknothings.config.istio.io" created<br/>customresourcedefinition "kuberneteses.config.istio.io" created<br/>customresourcedefinition "listentries.config.istio.io" created<br/>customresourcedefinition "logentries.config.istio.io" created<br/>customresourcedefinition "metrics.config.istio.io" created<br/>customresourcedefinition "quotas.config.istio.io" created<br/>customresourcedefinition "reportnothings.config.istio.io" created<br/>customresourcedefinition "servicecontrolreports.config.istio.io" created<br/>customresourcedefinition "tracespans.config.istio.io" created<br/>customresourcedefinition "serviceroles.config.istio.io" created<br/>customresourcedefinition "servicerolebindings.config.istio.io" created<br/>attributemanifest "istioproxy" created<br/>attributemanifest "kubernetes" created<br/>stdio "handler" created<br/>logentry "accesslog" created<br/>rule "stdio" created<br/>metric "requestcount" created<br/>metric "requestduration" created<br/>metric "requestsize" created<br/>metric "responsesize" created<br/>metric "tcpbytesent" created<br/>metric "tcpbytereceived" created<br/>prometheus "handler" created<br/>rule "promhttp" created<br/>rule "promtcp" created<br/>kubernetesenv "handler" created<br/>rule "kubeattrgenrulerule" created<br/>kubernetes "attributes" created<br/>configmap "istio" created<br/>customresourcedefinition "destinationpolicies.config.istio.io" created<br/>customresourcedefinition "egressrules.config.istio.io" created<br/>customresourcedefinition "routerules.config.istio.io" created<br/>customresourcedefinition "v1alpha2routerules.config.istio.io" created<br/>customresourcedefinition "destinationrules.config.istio.io" created<br/>customresourcedefinition "externalservices.config.istio.io" created<br/>service "istio-pilot" created<br/>serviceaccount "istio-pilot-service-account" created<br/>deployment "istio-pilot" created<br/>service "istio-ingress" created<br/>serviceaccount "istio-ingress-service-account" created<br/>deployment "istio-ingress" created<br/>serviceaccount "istio-ca-service-account" created<br/>deployment "istio-ca" created<br/><br/><br/>$ oc create -f install/kubernetes/addons/prometheus.yaml<br/><br/>configmap "prometheus" created<br/>service "prometheus" created<br/>deployment "prometheus" created<br/>serviceaccount "prometheus" created<br/>clusterrole "prometheus" created<br/>clusterrolebinding "prometheus” created<br/><br/>$ oc create -f install/kubernetes/addons/grafana.yaml<br/><br/>service "grafana" created<br/>deployment "grafana" created<br/>serviceaccount "grafana” created<br/><br/>$ oc create -f install/kubernetes/addons/servicegraph.yaml<br/><br/>deployment "servicegraph" created<br/>service "servicegraph” created<br/><br/>$ oc process -f https://raw.githubusercontent.com/jaegertracing/jaeger-openshift/master/all-in-one/jaeger-all-in-one-template.yml | oc create -f -<br/> <br/>deployment "jaeger" created<br/>service "jaeger-query" created<br/>service "jaeger-collector" created<br/>service "jaeger-agent" created<br/>service "zipkin" created<br/>route "jaeger-query" created<br/><br/>$ oc expose svc grafana<br/>$ oc expose svc servicegraph<br/>$ oc expose svc jaeger-query<br/>$ oc expose svc istio-ingress<br/>$ oc expose svc prometheus</span></pre><p id="7f8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通过OpenShift Web控制台验证Istio已启动并正在运行。</strong></p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi me"><img src="../Images/cc9e342fd16ac140a27d99642d5e309c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A4hPO7v7urHATSKZS8F07w.png"/></div></div><figcaption class="lh li gj gh gi lj lk bd b be z dk translated">Istio已经启动并运行。</figcaption></figure><p id="b78f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通过oc验证Istio启动并运行。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="ea85" class="lx ly iq lt b gy lz ma l mb mc">$ oc get all<br/>NAME                   HOST/PORT                                          PATH      SERVICES        PORT         TERMINATION   WILDCARD<br/>routes/grafana         grafana-istio-system.192.168.99.102.nip.io                   grafana         http                       None<br/>routes/istio-ingress   istio-ingress-istio-system.192.168.99.102.nip.io             istio-ingress   http                       None<br/>routes/jaeger-query    jaeger-query-istio-system.192.168.99.102.nip.io              jaeger-query    query-http   edge/Allow    None<br/>routes/prometheus      prometheus-istio-system.192.168.99.102.nip.io                prometheus      prometheus                 None<br/>routes/servicegraph    servicegraph-istio-system.192.168.99.102.nip.io              servicegraph    http                       None<br/><br/>NAME                                READY     STATUS    RESTARTS   AGE<br/>po/grafana-4183644701-psfrl         1/1       Running   0          6m<br/>po/istio-ca-418645489-54rbt         1/1       Running   0          10m<br/>po/istio-ingress-1688831668-hh8fs   1/1       Running   0          10m<br/>po/istio-mixer-3303323913-stm6l     3/3       Running   0          11m<br/>po/istio-pilot-3625647026-c7zvh     2/2       Running   0          10m<br/>po/jaeger-210917857-sqk9l           1/1       Running   0          6m<br/>po/prometheus-3936029847-7mwwk      1/1       Running   0          6m<br/>po/servicegraph-3780797009-nl4cn    1/1       Running   0          6m<br/><br/>NAME                   CLUSTER-IP       EXTERNAL-IP                 PORT(S)                                                            AGE<br/>svc/grafana            172.30.114.78    &lt;none&gt;                      3000/TCP                                                           6m<br/>svc/istio-ingress      172.30.255.29    172.29.12.49,172.29.12.49   80:31407/TCP,443:31039/TCP                                         11m<br/>svc/istio-mixer        172.30.146.243   &lt;none&gt;                      9091/TCP,15004/TCP,9093/TCP,9094/TCP,9102/TCP,9125/UDP,42422/TCP   11m<br/>svc/istio-pilot        172.30.100.155   &lt;none&gt;                      15003/TCP,8080/TCP,9093/TCP,443/TCP                                11m<br/>svc/jaeger-agent       None             &lt;none&gt;                      5775/UDP,6831/UDP,6832/UDP                                         6m<br/>svc/jaeger-collector   172.30.152.81    &lt;none&gt;                      14267/TCP,14268/TCP,9411/TCP                                       6m<br/>svc/jaeger-query       172.30.168.73    172.29.57.65,172.29.57.65   80:30542/TCP                                                       6m<br/>svc/prometheus         172.30.111.137   &lt;none&gt;                      9090/TCP                                                           6m<br/>svc/servicegraph       172.30.228.213   &lt;none&gt;                      8088/TCP                                                           6m<br/>svc/zipkin             172.30.46.210    &lt;none&gt;                      9411/TCP                                                           6m<br/><br/>NAME                   DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE<br/>deploy/grafana         1         1         1            1           6m<br/>deploy/istio-ca        1         1         1            1           10m<br/>deploy/istio-ingress   1         1         1            1           10m<br/>deploy/istio-mixer     1         1         1            1           11m<br/>deploy/istio-pilot     1         1         1            1           11m<br/>deploy/jaeger          1         1         1            1           6m<br/>deploy/prometheus      1         1         1            1           6m<br/>deploy/servicegraph    1         1         1            1           6m<br/><br/>NAME                          DESIRED   CURRENT   READY     AGE<br/>rs/grafana-4183644701         1         1         1         6m<br/>rs/istio-ca-418645489         1         1         1         10m<br/>rs/istio-ingress-1688831668   1         1         1         10m<br/>rs/istio-mixer-3303323913     1         1         1         11m<br/>rs/istio-pilot-3625647026     1         1         1         11m<br/>rs/jaeger-210917857           1         1         1         6m<br/>rs/prometheus-3936029847      1         1         1         6m<br/>rs/servicegraph-3780797009    1         1         1         6m</span></pre><p id="00ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们部署样本HelloWorld微服务。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="e68a" class="lx ly iq lt b gy lz ma l mb mc">$ istioctl kube-inject -f samples/helloworld/helloworld.yaml | oc apply -f -<br/><br/>service "helloworld" created<br/>deployment "helloworld-v1" created<br/>deployment "helloworld-v2" created<br/>ingress "helloworld” created</span></pre><p id="dc96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">验证Istio-proxy sidecar容器是否与HelloWorld微服务一起实施。</strong></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><pre class="la lb lc ld gt ls lt lu lv aw lw bi"><span id="cc3d" class="lx ly iq lt b gy lz ma l mb mc">$ oc get all -o wide | grep hello<br/><br/>po/helloworld-v1-1336331808-9n25r   2/2       Running   0          2m        172.17.0.12   localhost<br/>po/helloworld-v2-3977317532-pmctf   2/2       Running   0          2m        172.17.0.11   localhost<br/><br/>svc/helloworld         172.30.0.186     &lt;nodes&gt;                     5000:30866/TCP     2m        app=helloworld<br/><br/>deploy/helloworld-v1   1         1         1            1           2m        helloworld,istio-proxy      istio/examples-helloworld-v1,docker.io/istio/proxy:0.6.0     app=helloworld,version=v1<br/>deploy/helloworld-v2   1         1         1            1           2m        helloworld,istio-proxy      istio/examples-helloworld-v2,docker.io/istio/proxy:0.6.0     app=helloworld,version=v2<br/><br/>rs/helloworld-v1-1336331808   1         1         1         2m        helloworld,istio-proxy   istio/examples-helloworld-v1,docker.io/istio/proxy:0.6.0     app=helloworld,pod-template-hash=1336331808,version=v1<br/>rs/helloworld-v2-3977317532   1         1         1         2m        helloworld,istio-proxy   istio/examples-helloworld-v2,docker.io/istio/proxy:0.6.0     app=helloworld,pod-template-hash=3977317532,version=v2</span></pre><p id="09a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你！！！Minishift + Istio现已启动并运行！！！</p><p id="96c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">请查看:</strong></p><ul class=""><li id="f714" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated"><a class="ae mk" href="https://www.openshift.org/minishift/" rel="noopener ugc nofollow" target="_blank">微移</a></li><li id="b725" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated"><a class="ae mk" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a></li></ul></div></div>    
</body>
</html>