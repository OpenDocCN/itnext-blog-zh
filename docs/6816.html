<html>
<head>
<title>Bitwarden Self-Hosting - 12 Months Later</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Bitwarden自托管- 12个月后</h1>
<blockquote>原文：<a href="https://itnext.io/bitwarden-self-hosting-12-months-later-b2c0e0d9d62d?source=collection_archive---------1-----------------------#2022-03-10">https://itnext.io/bitwarden-self-hosting-12-months-later-b2c0e0d9d62d?source=collection_archive---------1-----------------------#2022-03-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/9f491cbd55e94f3531c78bff2549e8c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ByN4wL7HnElxKQlb80jyZw.png"/></div></div></figure><p id="18ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在很长一段时间里，我使用LastPass作为我的密码管理器。它很容易使用，我不需要托管任何东西，因此我不必担心监控服务器、安排备份或设置SSL证书。然而，2021年初<a class="ae kw" href="https://blog.lastpass.com/2021/02/changes-to-lastpass-free/" rel="noopener ugc nofollow" target="_blank"> LastPass宣布</a>从2021年3月16日起，它将不再支持完全免费层。LastPass的一个奇怪举动是，只有一种类型的设备可以免费使用，对于任何其他类型的设备，你都需要支付订阅费，每个用户每月大约3美元。无论如何，对我来说，通过设备类型来限制免费计划违背了设置密码管理器的目的。</p><p id="3073" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我对此想了很多，并决定开始寻找替代方案。我不再想使用SaaS服务，那里的服务条款可以在短时间内改变，我想要一些开源的东西。由于像LastPass这样的平台不是开源的，使用这样的服务需要一定程度的信任，即他们网站上的声明确实是真实的——但最终，根本没有办法知道。</p><p id="383e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章不会详细介绍Bitwarden的所有功能，因为这些功能在Bitwarden网站上很容易找到。</p><h1 id="aba4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">比特监狱长</h1><p id="245f" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">在做了我的研究后，我选定了<a class="ae kw" href="https://bitwarden.com/" rel="noopener ugc nofollow" target="_blank"> Bitwarden的</a>自主托管选项，它完全没有许可费。该软件是开源的，对我来说是一个重要的选择，可以安装在一个相对较小的VPS上。稍后将详细介绍。还有一个基于Rust的Bitwarden版本，可以在<a class="ae kw" href="https://github.com/dani-garcia/vaultwarden" rel="noopener ugc nofollow" target="_blank">这里</a>找到。我选择不走这条路，因为它不是一个官方的Bitwarden项目。</p><p id="58e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">官方的Bitwarden提供了一个个人选项，每月多花几欧元，你就可以启用一些企业功能，允许一个组织内的用户之间共享密码或秘密。这个额外的选择性加入还允许您上传文件附件，但是，这在个人版中是功能锁定的。我选择放弃这些功能，因为我从未在LastPass上使用过它们，也不需要在Bitwarden上使用它们，但是，您的用例可能会不同。</p><h2 id="613e" class="ma ky iq bd kz mb mc dn ld md me dp lh kj mf mg ll kn mh mi lp kr mj mk lt ml bi translated">选择VPS</h2><p id="2daa" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">最初，我在具有2GB内存和1个VCPU的DigitalOcean droplet上运行Bitwarden，但是，我最近将我的所有工作负载迁移到了Microsoft Azure。我现在在Azure的1 VCPU、2GB B系列虚拟机上运行Bitwarden。b系列虚拟机是Azure的可爆发系列虚拟机。当CPU利用率低于某个阈值时，这些虚拟机会累积CPU信用。然后，当CPU因执行某项任务(备份、升级等)所需的CPU峰值超过阈值时，这些配额就会被消耗掉。</p><p id="48fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当您的应用程序长时间空闲时，b系列虚拟机是一个不错的选择，例如Bitwarden，这样可以节省资金。此外，我选择了3年保留价格，这大大降低了每月成本。</p><p id="c4e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="mm">更新</em> </strong> <em class="mm">:我遇到了一个问题，虚拟机随机停止响应——可能是由于SQL Server内存不足。我仍在排除故障，但现在，每夜重启似乎做的工作</em></p><h2 id="0a75" class="ma ky iq bd kz mb mc dn ld md me dp lh kj mf mg ll kn mh mi lp kr mj mk lt ml bi translated">装置</h2><p id="70ef" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Bitwarden要求在服务器上安装docker和docker-compose，以便部署其容器。安装相当容易，并且<a class="ae kw" href="https://bitwarden.com/help/install-on-premise-linux/" rel="noopener ugc nofollow" target="_blank">有很好的文档记录</a>。一个简单的shell脚本启动安装程序并下载一组docker容器，其中一个是SQL Server。由于它的内存需求，我不是这个数据库的最大粉丝，但是，这不是一个大问题，它工作得很好。</p><p id="cf08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在安装过程中，请确保在自签名证书生成或LetsEncrypt证书SSL加密之间进行选择。当然，这取决于您如何运行Bitwarden，在我的例子中，我在Nginx反向代理后面运行Bitwarden服务器，所以我选择由安装程序生成自签名SSL证书。如果您希望让Bitwarden在您自己的域上直接暴露于互联网，您也可以选择使用直接内置于Bitwarden核心的LetsEncrypt特性。这省去了很多额外的努力。</p><h2 id="d73a" class="ma ky iq bd kz mb mc dn ld md me dp lh kj mf mg ll kn mh mi lp kr mj mk lt ml bi translated">系统管理</h2><p id="3b5b" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Bitwarden将其所有数据文件存储在一个名为<em class="mm"> bwdata的文件夹中。日志、证书、SQL数据库、配置文件等都可以在这个文件夹中找到。这使得系统管理变得非常简单，因为人们可以简单地备份该文件夹，以确保备份整个安装。</em></p><h1 id="6158" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">保护Bitwarden</h1><p id="fb11" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我有很多方法来保护我的Bitwarden安装。我建议Bitwarden的任何新用户都这样做:</p><ul class=""><li id="0c40" class="mn mo iq ka b kb kc kf kg kj mp kn mq kr mr kv ms mt mu mv bi translated">在反向代理后面运行Bitwarden，该代理只接受来自反向代理服务器的流量，从不直接接受来自internet的流量。在Azure中，这可以通过网络策略轻松实现。</li><li id="8018" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">登录Bitwarden时启用双因素身份验证。</li><li id="418f" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">在Bitwarden设置中禁用新帐户创建。你不希望随机的人在你的服务器上创建帐户，所以把它关掉。</li><li id="beb0" class="mn mo iq ka b kb mw kf mx kj my kn mz kr na kv ms mt mu mv bi translated">只有在面向互联网的安装中，才考虑限制对家庭路由器IP的访问。由于Bitwarden的移动应用程序和浏览器插件会缓存你的所有密码，所以当你外出时，很少需要访问实际的实时服务器。限制对您家庭IP的访问意味着Bitwarden只能在您连接到家庭网络时进行同步。如果您准备好迎接挑战，这需要一点额外的脚本，但是要确保除了您之外没有人可以访问您的安装。</li></ul><h1 id="56cd" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">备份本地实例</h1><p id="6179" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">为了确保我永远不会远离我的密码，我在家里的TrueNAS服务器上的虚拟机上运行了我的主Bitwarden安装的第二个实例。我在这里写了一篇关于这个设置的帖子<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/3-2-1-backups-f62305159bdb">。</a></p><figure class="nc nd ne nf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/d4979b3b8dd8b7181fe62f863889b380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKaW5o1RYMIVnrKRpRW-fw.jpeg"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">Bitwarden辅助实例架构</figcaption></figure><p id="b03e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此设置中，计划作业每晚运行Bitwarden服务器的备份，并将备份文件上传到Azure Blob存储，保留期为7天。从这里，TrueNAS上的每周云同步作业将备份文件同步到我的家庭服务器。由于我不经常更新或添加Bitwarden的密码，每周一次的工作有助于减少Azure Blob存储上的一点支出，这是数据传输的账单。</p><p id="a8ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我的家庭服务器上的虚拟机上手动设置了Bitwarden的辅助实例。通过从TrueNAS进行NFS装载，虚拟机可以访问备份。我编写了一个自定义脚本，通过用主服务器上的文件夹覆盖<em class="mm"> bwdata </em>文件夹，来停止正在运行的Bitwarden实例，并将备份应用到我的本地服务器上。一旦文件夹被覆盖，我将在以下文件中更新服务器主机名:</p><pre class="nc nd ne nf gt nk nl nm nn aw no bi"><span id="54ec" class="ma ky iq nl b gy np nq l nr ns">bwdata/config.yml<br/>bwdata/env/global.override.env<br/>bwdata/web/assetlinks.json</span></pre><p id="9c09" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，Bitwarden再次启动。在我的辅助服务器上，我还使用了一个反向代理，所以我再次简单地使用自签名证书。</p><h1 id="b299" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后的想法</h1><p id="28ca" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Bitwarden满足了我对密码管理平台的需求，可以在我的所有设备上同步。作为一个开源项目，它给了我一种安慰，许多人正在研究并致力于使Bitwarden足够安全，以存储您最有价值的秘密。一年过去了，我和Bitwarden没有什么大问题，并强烈推荐它。</p><p id="4c79" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mm">注意:这篇文章不是由Bitwarden </em>赞助的</p></div></div>    
</body>
</html>