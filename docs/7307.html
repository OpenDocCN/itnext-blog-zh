<html>
<head>
<title>Install and configure a high available Kubernetes cluster with Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible安装和配置高可用性Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/install-and-configure-a-high-available-kubernetes-cluster-with-ansible-ecaf77fe333f?source=collection_archive---------2-----------------------#2022-08-17">https://itnext.io/install-and-configure-a-high-available-kubernetes-cluster-with-ansible-ecaf77fe333f?source=collection_archive---------2-----------------------#2022-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d0bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个<a class="ae kl" href="https://github.com/garutilorenzo/ansible-role-linux-kubernetes" rel="noopener ugc nofollow" target="_blank">职责</a>将安装和配置一个高可用性的Kubernetes集群。这个repo使用<a class="ae kl" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/" rel="noopener ugc nofollow" target="_blank"> kubeadm </a>自动化了Kubernetes的安装过程。</p><p id="bcf2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个repo只是如何使用Ansible automation安装和配置Kubernetes集群的一个例子。对于生产环境，使用<a class="ae kl" href="https://kubernetes.io/docs/setup/production-environment/tools/kubespray/" rel="noopener ugc nofollow" target="_blank"> Kubespray </a></p><h1 id="bacc" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">要求</h1><p id="e41d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">安装ansible、ipaddr和netaddr:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="3dc5" class="ly kn iq lu b gy lz ma l mb mc">pip install -r requirements.txt</span></pre><p id="f4c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从GitHub下载角色:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="53c9" class="ly kn iq lu b gy lz ma l mb mc">ansible-galaxy install git+https://github.com/garutilorenzo/ansible-role-linux-kubernetes.git</span></pre><h1 id="de24" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">角色变量</h1><p id="8c7d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">该角色接受以下<a class="ae kl" href="https://github.com/garutilorenzo/ansible-role-linux-kubernetes#role-variables" rel="noopener ugc nofollow" target="_blank">变量</a>。</p><h1 id="9afd" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">额外变量</h1><p id="7ea6" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">这个角色接受一个额外的变量<em class="md"> kubernetes_init_host </em>。第一次引导集群时使用该变量。该变量的值必须是其中一个主节点的主机名。当ansible在匹配的主机上运行时，kubernetes将被初始化。</p><h1 id="f50b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">已部署群集资源</h1><p id="ecea" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">该角色<a class="ae kl" href="https://garutilorenzo.github.io/ansible-role-kubernetes-cluster/#nginx-ingress-controller" rel="noopener ugc nofollow" target="_blank">将安装Nginx入口控制器</a>和<a class="ae kl" href="https://garutilorenzo.github.io/ansible-role-kubernetes-cluster/#longhorn" rel="noopener ugc nofollow" target="_blank"> Longhorn </a>。</p><h2 id="2071" class="ly kn iq bd ko me mf dn ks mg mh dp kw jy mi mj la kc mk ml le kg mm mn li mo bi translated">Nginx入口控制器</h2><p id="dc88" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated"><a class="ae kl" href="https://kubernetes.github.io/ingress-nginx/" rel="noopener ugc nofollow" target="_blank"> Nginx入口控制器</a>用作入口控制器。</p><p id="ed54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该安装是<a class="ae kl" href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters" rel="noopener ugc nofollow" target="_blank">裸机</a>安装，然后通过节点端口服务暴露入口控制器。您可以自定义节点端口服务所公开的端口，使用<a class="ae kl" href="https://garutilorenzo.github.io/ansible-role-kubernetes-cluster/#role-variables" rel="noopener ugc nofollow" target="_blank">角色变量</a>来更改这些值。</p><h2 id="bcc2" class="ly kn iq bd ko me mf dn ks mg mh dp kw jy mi mj la kc mk ml le kg mm mn li mo bi translated">长角牛</h2><p id="dcdc" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">Longhorn 是一个轻量级的、可靠的、强大的分布式块存储系统。</p><p id="5094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Longhorn使用容器和微服务实现分布式块存储。Longhorn为每个块设备卷创建一个专用的存储控制器，并跨存储在多个节点上的多个副本同步复制该卷。存储控制器和副本本身是使用Kubernetes编排的。</p><h1 id="0572" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">无赖</h1><p id="db52" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了测试这个角色，你可以使用<a class="ae kl" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">流浪者</a>和<a class="ae kl" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>来调出一个示例基础设施。一旦您下载了此repo，请使用vagger启动虚拟机:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f30c" class="ly kn iq lu b gy lz ma l mb mc">vagrant up</span></pre><p id="8fa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在流浪者文件中，您可以直接在流浪者用户的authorized_keys中注入您的公共ssh密钥。你必须更改流浪者文件中的<em class="md"> CHANGE_ME </em>占位符。您还可以通过更改NNODES变量(默认值:6)来调整部署的虚拟机数量</p><h1 id="0781" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">使用此角色</h1><p id="e43d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">要使用该角色，您需要遵循<a class="ae kl" href="https://github.com/garutilorenzo/ansible-role-linux-kubernetes/tree/master/examples" rel="noopener ugc nofollow" target="_blank">示例</a>目录中的示例。使用您的主机调整hosts.ini文件，并运行行动手册:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6f35" class="ly kn iq lu b gy lz ma l mb mc">lorenzo@mint-virtual:~$ ansible-playbook -i hosts-ubuntu.ini site.yml -e kubernetes_init_host=k8s-ubuntu-0</span></pre><p id="07c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待Ansible完成:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="4796" class="ly kn iq lu b gy lz ma l mb mc">PLAY [kubemaster] ***************************************************************************************************************************************************</span><span id="904a" class="ly kn iq lu b gy mp ma l mb mc">TASK [Gathering Facts] **********************************************************************************************************************************************<br/>ok: [k8s-ubuntu-2]<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-0]</span><span id="bcc7" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : include_tasks] **********************************************************************************************************************<br/>included: /home/lorenzo/workspaces-local/ansible-role-kubernetes/tasks/setup_repo_Debian.yml for k8s-ubuntu-0, k8s-ubuntu-1, k8s-ubuntu-2 =&gt; (item=/home/lorenzo/workspaces-local/ansible-role-kubernetes/tasks/setup_repo_Debian.yml)</span><span id="53d9" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install required system packages] ***************************************************************************************************<br/>ok: [k8s-ubuntu-2]<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-0]</span><span id="82d3" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add Google GPG apt Key] *************************************************************************************************************<br/>ok: [k8s-ubuntu-0]<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-2]</span><span id="5dd9" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add K8s Repository] *****************************************************************************************************************<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-2]<br/>ok: [k8s-ubuntu-0]</span><span id="47cf" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add Docker GPG apt Key] *************************************************************************************************************<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-0]<br/>ok: [k8s-ubuntu-2]</span><span id="2f07" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : shell] ******************************************************************************************************************************<br/>changed: [k8s-ubuntu-1]<br/>changed: [k8s-ubuntu-2]<br/>changed: [k8s-ubuntu-0]</span><span id="6337" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add Docker Repository] **************************************************************************************************************<br/>ok: [k8s-ubuntu-0]<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-2]</span><span id="ceb3" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : setup] ******************************************************************************************************************************<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-0]<br/>ok: [k8s-ubuntu-2]</span><span id="97cc" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : include_tasks] **********************************************************************************************************************<br/>included: /home/lorenzo/workspaces-local/ansible-role-kubernetes/tasks/preflight.yml for k8s-ubuntu-0, k8s-ubuntu-1, k8s-ubuntu-2</span><span id="7b2b" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : disable ufw] ************************************************************************************************************************<br/>ok: [k8s-ubuntu-2]<br/>ok: [k8s-ubuntu-0]<br/>ok: [k8s-ubuntu-1]</span><span id="27b0" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install iptables-legacy] ************************************************************************************************************<br/>skipping: [k8s-ubuntu-0]<br/>skipping: [k8s-ubuntu-1]<br/>skipping: [k8s-ubuntu-2]</span><span id="386a" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Remove zram-generator-defaults] *****************************************************************************************************<br/>skipping: [k8s-ubuntu-0]<br/>skipping: [k8s-ubuntu-1]<br/>skipping: [k8s-ubuntu-2]</span><span id="6c80" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : disable firewalld] ******************************************************************************************************************<br/>skipping: [k8s-ubuntu-0]<br/>skipping: [k8s-ubuntu-1]<br/>skipping: [k8s-ubuntu-2]</span><span id="053a" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Put SELinux in permissive mode, logging actions that would be blocked.] *************************************************************<br/>skipping: [k8s-ubuntu-0]<br/>skipping: [k8s-ubuntu-1]<br/>skipping: [k8s-ubuntu-2]</span><span id="682d" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Disable SELinux] ********************************************************************************************************************<br/>skipping: [k8s-ubuntu-0]<br/>skipping: [k8s-ubuntu-1]<br/>skipping: [k8s-ubuntu-2]</span><span id="6831" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install openssl] ********************************************************************************************************************<br/>ok: [k8s-ubuntu-2]<br/>ok: [k8s-ubuntu-1]<br/>ok: [k8s-ubuntu-0]</span><span id="26f4" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : load overlay kernel module] *********************************************************************************************************<br/>changed: [k8s-ubuntu-1]<br/>changed: [k8s-ubuntu-0]<br/>changed: [k8s-ubuntu-2]</span><span id="0bce" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : load br_netfilter kernel module] ****************************************************************************************************<br/>changed: [k8s-ubuntu-1]<br/>changed: [k8s-ubuntu-0]<br/>changed: [k8s-ubuntu-2]</span><span id="aa3d" class="ly kn iq lu b gy mp ma l mb mc">[...]<br/>[...]<br/>[...]</span><span id="65d9" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add KUBELET_ROOT_DIR env var] *******************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="8b43" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Add KUBELET_ROOT_DIR env var, set value] ********************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="44d8" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install longhorn] *******************************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="6283" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install longhorn storageclass] ******************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="bb7b" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : include_tasks] **********************************************************************************************************************<br/>included: /home/lorenzo/workspaces-local/ansible-role-kubernetes/tasks/install_nginx_ingress.yml for k8s-ubuntu-3, k8s-ubuntu-4, k8s-ubuntu-5</span><span id="0c34" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Check if ingress-nginx is installed] ************************************************************************************************<br/>changed: [k8s-ubuntu-3 -&gt; k8s-ubuntu-0(192.168.25.110)]</span><span id="b90d" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Install ingress-nginx] **************************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="bfcd" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : render nginx_ingress_config.yml] ****************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="a9de" class="ly kn iq lu b gy mp ma l mb mc">TASK [ansible-role-kubernetes : Apply nginx ingress config] *********************************************************************************************************<br/>skipping: [k8s-ubuntu-3]</span><span id="e326" class="ly kn iq lu b gy mp ma l mb mc">PLAY RECAP **********************************************************************************************************************************************************<br/>k8s-ubuntu-0               : ok=78   changed=24   unreachable=0    failed=0    skipped=25   rescued=0    ignored=3   <br/>k8s-ubuntu-1               : ok=52   changed=12   unreachable=0    failed=0    skipped=30   rescued=0    ignored=1   <br/>k8s-ubuntu-2               : ok=52   changed=12   unreachable=0    failed=0    skipped=30   rescued=0    ignored=1<br/>k8s-ubuntu-3               : ok=58   changed=30   unreachable=0    failed=0    skipped=35   rescued=0    ignored=1   <br/>k8s-ubuntu-4               : ok=52   changed=28   unreachable=0    failed=0    skipped=27   rescued=0    ignored=1   <br/>k8s-ubuntu-5               : ok=52   changed=28   unreachable=0    failed=0    skipped=27   rescued=0    ignored=1</span></pre><p id="2624" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了一个以高可用性模式部署的Kubernetes集群，我们可以检查集群的状态:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f810" class="ly kn iq lu b gy lz ma l mb mc">root@k8s-ubuntu-0:~# kubectl get nodes<br/>NAME           STATUS   ROLES           AGE    VERSION<br/>k8s-ubuntu-0   Ready    control-plane   139m   v1.24.3<br/>k8s-ubuntu-1   Ready    control-plane   136m   v1.24.3<br/>k8s-ubuntu-2   Ready    control-plane   136m   v1.24.3<br/>k8s-ubuntu-3   Ready    &lt;none&gt;          117m   v1.24.3<br/>k8s-ubuntu-4   Ready    &lt;none&gt;          117m   v1.24.3<br/>k8s-ubuntu-5   Ready    &lt;none&gt;          117m   v1.24.3</span></pre><p id="e784" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查pod状态:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="ae5e" class="ly kn iq lu b gy lz ma l mb mc">root@k8s-ubuntu-0:~# kubectl get pods --all-namespaces<br/>NAMESPACE         NAME                                           READY   STATUS      RESTARTS       AGE<br/>ingress-nginx     ingress-nginx-admission-create-tsc8p           0/1     Completed   0              135m<br/>ingress-nginx     ingress-nginx-admission-patch-48tpn            0/1     Completed   0              135m<br/>ingress-nginx     ingress-nginx-controller-6dc865cd86-kfq88      1/1     Running     0              135m<br/>kube-flannel      kube-flannel-ds-fm4s6                          1/1     Running     0              117m<br/>kube-flannel      kube-flannel-ds-hhvxx                          1/1     Running     0              117m<br/>kube-flannel      kube-flannel-ds-ngdtc                          1/1     Running     0              117m<br/>kube-flannel      kube-flannel-ds-q5ncb                          1/1     Running     0              136m<br/>kube-flannel      kube-flannel-ds-vq4kk                          1/1     Running     0              139m<br/>kube-flannel      kube-flannel-ds-zshpf                          1/1     Running     0              137m<br/>kube-system       coredns-6d4b75cb6d-8dh9h                       1/1     Running     0              139m<br/>kube-system       coredns-6d4b75cb6d-xq98k                       1/1     Running     0              139m<br/>kube-system       etcd-k8s-ubuntu-0                              1/1     Running     0              139m<br/>kube-system       etcd-k8s-ubuntu-1                              1/1     Running     0              136m<br/>kube-system       etcd-k8s-ubuntu-2                              1/1     Running     0              136m<br/>kube-system       kube-apiserver-k8s-ubuntu-0                    1/1     Running     0              139m<br/>kube-system       kube-apiserver-k8s-ubuntu-1                    1/1     Running     0              135m<br/>kube-system       kube-apiserver-k8s-ubuntu-2                    1/1     Running     0              136m<br/>kube-system       kube-controller-manager-k8s-ubuntu-0           1/1     Running     0              139m<br/>kube-system       kube-controller-manager-k8s-ubuntu-1           1/1     Running     0              136m<br/>kube-system       kube-controller-manager-k8s-ubuntu-2           1/1     Running     0              135m<br/>kube-system       kube-proxy-59jqx                               1/1     Running     0              136m<br/>kube-system       kube-proxy-8mjwr                               1/1     Running     0              139m<br/>kube-system       kube-proxy-8nhbw                               1/1     Running     0              117m<br/>kube-system       kube-proxy-j2rrx                               1/1     Running     0              117m<br/>kube-system       kube-proxy-qwd5r                               1/1     Running     0              117m<br/>kube-system       kube-proxy-vcs7g                               1/1     Running     0              137m<br/>kube-system       kube-scheduler-k8s-ubuntu-0                    1/1     Running     0              139m<br/>kube-system       kube-scheduler-k8s-ubuntu-1                    1/1     Running     0              136m<br/>kube-system       kube-scheduler-k8s-ubuntu-2                    1/1     Running     0              135m<br/>kube-system       kube-vip-k8s-ubuntu-0                          1/1     Running     1 (136m ago)   139m<br/>kube-system       kube-vip-k8s-ubuntu-1                          1/1     Running     0              136m<br/>kube-system       kube-vip-k8s-ubuntu-2                          1/1     Running     0              136m<br/>longhorn-system   csi-attacher-dcb85d774-jrggr                   1/1     Running     0              114m<br/>longhorn-system   csi-attacher-dcb85d774-slhqt                   1/1     Running     0              114m<br/>longhorn-system   csi-attacher-dcb85d774-xcbxn                   1/1     Running     0              114m<br/>longhorn-system   csi-provisioner-5d8dd96b57-74x6h               1/1     Running     0              114m<br/>longhorn-system   csi-provisioner-5d8dd96b57-kdzdf               1/1     Running     0              114m<br/>longhorn-system   csi-provisioner-5d8dd96b57-xmpjf               1/1     Running     0              114m<br/>longhorn-system   csi-resizer-7c5bb5fd65-4262v                   1/1     Running     0              114m<br/>longhorn-system   csi-resizer-7c5bb5fd65-mfjgv                   1/1     Running     0              114m<br/>longhorn-system   csi-resizer-7c5bb5fd65-qw944                   1/1     Running     0              114m<br/>longhorn-system   csi-snapshotter-5586bc7c79-bs2xn               1/1     Running     0              114m<br/>longhorn-system   csi-snapshotter-5586bc7c79-d927b               1/1     Running     0              114m<br/>longhorn-system   csi-snapshotter-5586bc7c79-v99t6               1/1     Running     0              114m<br/>longhorn-system   engine-image-ei-766a591b-hrs6g                 1/1     Running     0              114m<br/>longhorn-system   engine-image-ei-766a591b-n9fsn                 1/1     Running     0              114m<br/>longhorn-system   engine-image-ei-766a591b-vxhbb                 1/1     Running     0              114m<br/>longhorn-system   instance-manager-e-3dba6914                    1/1     Running     0              114m<br/>longhorn-system   instance-manager-e-7bd8b1ff                    1/1     Running     0              114m<br/>longhorn-system   instance-manager-e-aca0fdc4                    1/1     Running     0              114m<br/>longhorn-system   instance-manager-r-244c040c                    1/1     Running     0              114m<br/>longhorn-system   instance-manager-r-39bd81b1                    1/1     Running     0              114m<br/>longhorn-system   instance-manager-r-3b7f12b1                    1/1     Running     0              114m<br/>longhorn-system   longhorn-admission-webhook-858d86b96b-j5rcv    1/1     Running     0              135m<br/>longhorn-system   longhorn-admission-webhook-858d86b96b-lphkq    1/1     Running     0              135m<br/>longhorn-system   longhorn-conversion-webhook-576b5c45c7-4p55x   1/1     Running     0              135m<br/>longhorn-system   longhorn-conversion-webhook-576b5c45c7-lq686   1/1     Running     0              135m<br/>longhorn-system   longhorn-csi-plugin-f7zmn                      2/2     Running     0              114m<br/>longhorn-system   longhorn-csi-plugin-hs58p                      2/2     Running     0              114m<br/>longhorn-system   longhorn-csi-plugin-wfpfs                      2/2     Running     0              114m<br/>longhorn-system   longhorn-driver-deployer-96cf98c98-7hzft       1/1     Running     0              135m<br/>longhorn-system   longhorn-manager-92xws                         1/1     Running     0              116m<br/>longhorn-system   longhorn-manager-b6knm                         1/1     Running     0              116m<br/>longhorn-system   longhorn-manager-tg2zc                         1/1     Running     0              116m<br/>longhorn-system   longhorn-ui-86b56b95c8-ctbvf                   1/1     Running     0              135m</span></pre><p id="e4c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，longhorn，nginx ingress和所有的kube系统吊舱。</p><p id="1563" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还可以检查nginx入口控制器的服务:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="787c" class="ly kn iq lu b gy lz ma l mb mc">root@k8s-ubuntu-0:~# kubectl get svc -n ingress-nginx<br/>NAME                                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE<br/>ingress-nginx-controller                NodePort    10.111.203.177   &lt;none&gt;        80:30080/TCP,443:30443/TCP   136m<br/>ingress-nginx-controller-admission      ClusterIP   10.105.11.11     &lt;none&gt;        443/TCP                      136m</span></pre><p id="24df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到nginx入口控制器监听端口，在本例中，http端口是30080，https端口是30443。我们可以从外部机器测试入口控制器:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e175" class="ly kn iq lu b gy lz ma l mb mc">lorenzo@mint-virtual:~$ curl -v <a class="ae kl" href="http://192.168.25.110:30080" rel="noopener ugc nofollow" target="_blank">http://192.168.25.110:30080</a><br/>*   Trying 192.168.25.110:30080...<br/>* TCP_NODELAY set<br/>* Connected to 192.168.25.110 (192.168.25.110) port 30080 (#0)<br/>&gt; GET / HTTP/1.1<br/>&gt; Host: 192.168.25.110:30080<br/>&gt; User-Agent: curl/7.68.0<br/>&gt; Accept: */*<br/>&gt; <br/>* Mark bundle as not supporting multiuse<br/>&lt; HTTP/1.1 404 Not Found<br/>&lt; Date: Wed, 17 Aug 2022 12:26:17 GMT<br/>&lt; Content-Type: text/html<br/>&lt; Content-Length: 146<br/>&lt; Connection: keep-alive<br/>&lt; <br/>&lt;html&gt;<br/>&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;<br/>&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>* Connection #0 to host 192.168.25.110 left intact</span></pre><h1 id="4704" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">恭喜</h1><p id="6486" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">您已经成功部署了一个高可用性的Kubernetes集群，现在您可以部署您的应用程序了！</p></div></div>    
</body>
</html>