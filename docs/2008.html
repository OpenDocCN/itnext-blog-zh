<html>
<head>
<title>Learning Data Science — Predict Stock Price with Support Vector Regression (SVR)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习数据科学—使用支持向量回归(SVR)预测股票价格</h1>
<blockquote>原文：<a href="https://itnext.io/learning-data-science-predict-stock-price-with-support-vector-regression-svr-2c4fdc36662?source=collection_archive---------0-----------------------#2019-03-15">https://itnext.io/learning-data-science-predict-stock-price-with-support-vector-regression-svr-2c4fdc36662?source=collection_archive---------0-----------------------#2019-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/6a57e7a798fb89c90de70509c20db798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*jxtW98_gbItw728vFB-0HA.png"/></div></figure><p id="2518" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="ks">免责声明:这是一个研究项目，请不要将此作为您的交易顾问。</em></p><p id="7241" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">为什么选择支持向量回归</strong></p><p id="daa2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae kt" href="https://en.wikipedia.org/wiki/Support-vector_machine" rel="noopener ugc nofollow" target="_blank">支持向量机</a> (SVM)分析是一个流行的分类和回归的机器学习工具，它支持线性和非线性回归，我们可以称之为<a class="ae kt" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html" rel="noopener ugc nofollow" target="_blank"> SVR </a>。</p><p id="6f5a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这篇文章中，我将使用SVR来预测TD股票(TD US Small-Cap Equity-I)在Python v3和Jupyter Notebook下一个日期的价格。</p><p id="6ac2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">导入依赖关系</strong></p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="de3c" class="ld le iq kz b gy lf lg l lh li"><strong class="kz ir">import</strong> <strong class="kz ir">numpy</strong> <strong class="kz ir">as</strong> <strong class="kz ir">np</strong><br/><strong class="kz ir">from</strong> <strong class="kz ir">sklearn.svm</strong> <strong class="kz ir">import</strong> SVR <br/><strong class="kz ir">import</strong> <strong class="kz ir">matplotlib.pyplot</strong> <strong class="kz ir">as</strong> <strong class="kz ir">plt</strong> <br/><strong class="kz ir">import</strong> <strong class="kz ir">pandas</strong> <strong class="kz ir">as</strong> <strong class="kz ir">pd</strong> <br/><br/>%matplotlib inline</span></pre><p id="5147" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果您有任何未找到的模块，请使用pip安装它。</p><p id="05b0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">准备数据</strong></p><p id="01f7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我将使用<a class="ae kt" href="https://github.com/dalenguyen/stockai" rel="noopener ugc nofollow" target="_blank"> stockai </a>包从Yahoo！金融。价格从2019年1月1日到2019年1月30日。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="4f55" class="ld le iq kz b gy lf lg l lh li">from stockai import Stock<br/><br/>td = Stock('TD.TO')<br/>prices_list = td.get_historical_prices('2019-01-01', '2019-01-30')<br/><br/>df = pd.DataFrame.from_dict(prices_list)<br/>df.head()</span></pre><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/a4ad7f1f5dcba6010e5d84ab909291a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*WOKu-Oo87UvfSMliGtt16w.png"/></div></figure><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="0103" class="ld le iq kz b gy lf lg l lh li"><em class="ks"># Get data function</em></span><span id="b399" class="ld le iq kz b gy lk lg l lh li"><strong class="kz ir">def</strong> get_data(df):  <br/>    data = df.copy()<br/>    data['date'] = data['date'].str.split('-').str[2]<br/>    data['date'] = pd.to_numeric(data['date'])<br/>    <strong class="kz ir">return</strong> [ data['date'].tolist(), data['close'].tolist() ] <em class="ks"># Convert Series to list</em></span><span id="c5f7" class="ld le iq kz b gy lk lg l lh li">dates, prices = get_data(df)</span></pre><p id="627c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">建立模型并开始预测</strong></p><p id="b1eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是一个非常简单的任务，我将使用日期和价格数据来预测TD股票的下一个日期价格，即2019年1月31日。</p><p id="d217" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">请记住，这是一个非常简单的预测方法，仅供研究之用。有很多东西需要考虑，比如情绪分析、基本面分析、技术分析、递归神经网络(RNN)、时间延迟神经网络(TDNN)……<strong class="jw ir"><em class="ks">所以我不把这作为你的投资方法。</em>T19】</strong></p><p id="0eaa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这个例子中，我将使用三种模型:线性、多项式和径向基函数(SVR的默认内核)。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="9b41" class="ld le iq kz b gy lf lg l lh li"><em class="ks"># predict and plot function</em></span><span id="c080" class="ld le iq kz b gy lk lg l lh li">def predict_prices(dates, prices, x):<br/>    dates = np.reshape(dates,(len(dates), 1)) <em class="ks"># convert to 1xn dimension</em><br/>    x = np.reshape(x,(len(x), 1))<br/>    <br/>    svr_lin  = SVR(kernel='linear', C=1e3)<br/>    svr_poly = SVR(kernel='poly', C=1e3, degree=2)<br/>    svr_rbf = SVR(kernel='rbf', C=1e3, gamma=0.1)<br/>    <br/>    <em class="ks"># Fit regression model</em><br/>    svr_lin .fit(dates, prices)<br/>    svr_poly.fit(dates, prices)<br/>    svr_rbf.fit(dates, prices)<br/>    <br/>    plt.scatter(dates, prices, c='k', label='Data')<br/>    plt.plot(dates, svr_lin.predict(dates), c='g', label='Linear model')<br/>    plt.plot(dates, svr_rbf.predict(dates), c='r', label='RBF model')    <br/>    plt.plot(dates, svr_poly.predict(dates), c='b', label='Polynomial model')<br/>    <br/>    plt.xlabel('Date')<br/>    plt.ylabel('Price')<br/>    plt.title('Support Vector Regression')<br/>    plt.legend()<br/>    plt.show()<br/>    <br/>    return svr_rbf.predict(x)[0], svr_lin.predict(x)[0], svr_poly.predict(x)[0]</span></pre><p id="6532" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">获得预测并绘制预测模型</strong></p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="1550" class="ld le iq kz b gy lf lg l lh li">predicted_price = predict_prices(dates, prices, [31])</span><span id="a2e3" class="ld le iq kz b gy lk lg l lh li"># (73.18055746816138, 74.23818331643184, 75.30920098568245)</span></pre><figure class="ku kv kw kx gt jr gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/687234262de31cf4fc549a7cba0611cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*WweWMoicJTyNIf11azRC2w.png"/></div></figure><p id="e42c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果我们想查看TD股票在2019年1月31日的收盘价，我们可以使用<a class="ae kt" href="https://github.com/dalenguyen/stockai" rel="noopener ugc nofollow" target="_blank"> stockai </a>来获取。</p><pre class="ku kv kw kx gt ky kz la lb aw lc bi"><span id="1dbb" class="ld le iq kz b gy lf lg l lh li">from stockai import Stock<br/>price = td.get_historical_prices('2019-01-31', '2019-01-31')</span><span id="975e" class="ld le iq kz b gy lk lg l lh li">print(price['close']) # $74.0</span></pre><p id="42ae" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我很惊讶线性模型的预测显示了最佳匹配，因为股票价格通常不遵循线性模型。然而，预测价格非常接近真实价格。</p><p id="989e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这就是我对这个课题的研究和实践的结束。如果您有任何建议，请随时开始讨论。我很想听听你的想法，这是<a class="ae kt" href="https://github.com/dalenguyen/stockai/blob/master/examples/support_vector_regression.ipynb" rel="noopener ugc nofollow" target="_blank">这个股票预测例子</a>的代码。</p></div></div>    
</body>
</html>