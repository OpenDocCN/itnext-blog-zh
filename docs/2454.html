<html>
<head>
<title>Managing state in Vue.js with Vuex</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Vuex管理Vue.js中的状态</h1>
<blockquote>原文：<a href="https://itnext.io/managing-state-in-vue-js-with-vuex-f036fd71f432?source=collection_archive---------4-----------------------#2019-05-27">https://itnext.io/managing-state-in-vue-js-with-vuex-f036fd71f432?source=collection_archive---------4-----------------------#2019-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/66262e752f3ae76943d3dc35d66f99d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoi3nw0sLYDPv0wr6HGI_Q.png"/></div></div></figure><div class=""/><p id="624b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在大型Vue应用程序中，不可避免地会遇到不同组件必须使用相同变量的问题。为了实现这一点，你经常需要在许多组件之间传递相同的变量。变量沿着树从一个组件传递到另一个组件，这使得您的代码一片混乱。如果您继续这样做足够长的时间，您将会到达管理状态变得非常复杂的某个点。</p><h2 id="b68e" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">Vuex</h2><p id="9bef" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">当然，解决方案是Vuex。Vuex是Vue.js应用程序的状态管理库。每个Vuex应用程序的中心是一个商店，它基本上是一个保存应用程序状态的容器。</p><blockquote class="lx"><p id="d238" class="ly lz je bd ma mb mc md me mf mg ky dk translated">使用Vuex时，组件使用相同的数据源。这意味着真理只有一个来源。如果没有Vuex，组件可能会有自己的状态版本。</p></blockquote><p id="05f5" class="pw-post-body-paragraph kb kc je kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">在本文中，我将向您展示如何设置Vuex商店，以及如何在Vue组件中使用这个商店。我将从零开始一个新的Vue项目。</p><h2 id="ed41" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">装置</h2><p id="f915" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">要在我们的Vue应用程序中使用Vuex，我们必须首先安装它:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="b5ea" class="kz la je mr b gy mv mw l mx my">npm install vuex --save</span></pre><h1 id="4329" class="mz la je bd lb na nb nc le nd ne nf lh ng nh ni lk nj nk nl ln nm nn no lq np bi translated">创建商店</h1><h2 id="c76e" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">文件夹结构</h2><p id="d47e" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">我们将要创建的存储将有自己的文件夹。所以让我们从在<code class="fe nq nr ns mr b">src</code>文件夹中创建一个<code class="fe nq nr ns mr b">store </code>文件夹开始。一个存储可以包含多个模块，我更喜欢将它们存储在各自的文件夹中。在刚刚创建的<code class="fe nq nr ns mr b">store</code>文件夹中创建一个名为<code class="fe nq nr ns mr b">modules</code>的新文件夹。在<code class="fe nq nr ns mr b">modules</code>文件夹中，我们将创建另一个名为<code class="fe nq nr ns mr b">products</code>的文件夹，它将管理我们应用程序中产品的状态。</p><h2 id="9647" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">商店索引</h2><p id="a51a" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">在<code class="fe nq nr ns mr b">store</code>文件夹中，我们将创建一个名为<code class="fe nq nr ns mr b">index.js</code>的文件。这个文件包含了我们商店的定义。如您所见，模块被导入到商店中。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="5e25" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">模块</h2><p id="3da4" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">Vue应用程序的所有状态都包含在一个对象中。随着应用程序的增长，这可能会变得非常大。幸运的是，Vuex允许你将商店分成模块。每个模块都包含自己的状态、获取器、动作和变异。</p><p id="ccc7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个模块包含以下文件:</p><ul class=""><li id="010f" class="nv nw je kd b ke kf ki kj km nx kq ny ku nz ky oa ob oc od bi translated">索引. js</li><li id="b6f6" class="nv nw je kd b ke oe ki of km og kq oh ku oi ky oa ob oc od bi translated">getters.js</li><li id="5547" class="nv nw je kd b ke oe ki of km og kq oh ku oi ky oa ob oc od bi translated">actions.js</li><li id="41f0" class="nv nw je kd b ke oe ki of km og kq oh ku oi ky oa ob oc od bi translated">突变. js</li></ul><h2 id="5141" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">索引. js</h2><p id="95a9" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">index.js是定义模块状态的地方。此外，这个文件将getters、actions和mutations捆绑到一个表示模块的对象中。</p><p id="9a63" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">比起命名空间，我更喜欢我的模块。默认情况下，模块中的所有内容都注册在全局名称空间下。这允许多个模块对相同的突变或动作做出反应。我不喜欢这种默认行为，所以我在模块中选择了for <code class="fe nq nr ns mr b">namespaced = true;</code>。这样模块更加独立。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="ec45" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如您在示例中看到的，状态只是一个具有产品模块的一些属性的对象。</p><blockquote class="lx"><p id="43cf" class="ly lz je bd ma mb mc md me mf mg ky dk translated">状态只不过是一个需要在应用程序中共享的对象。</p></blockquote><h2 id="06f1" class="kz la je bd lb lc ok dn le lf ol dp lh km om lj lk kq on lm ln ku oo lp lq lr bi translated">突变. js</h2><p id="3229" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><em class="oj">突变. js </em>文件包含了所有的突变函数。突变，顾名思义，就是对状态的突变负责。</p><blockquote class="lx"><p id="79bc" class="ly lz je bd ma mb mc md me mf mg ky dk translated">突变是改变你的状态的唯一方法</p></blockquote><p id="1044" class="pw-post-body-paragraph kb kc je kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">在Vuex中，变异函数的第一个参数总是状态对象。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="13cb" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">actions.js</h2><p id="6cd5" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><em class="oj"> actions.js </em> <strong class="kd jf"> </strong>文件包含了所有的动作函数。动作就像突变，但是它们<em class="oj">不会</em>改变状态。动作提交突变。此外，动作可以包含异步操作。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="d3ad" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我们有两个动作都提交了一个突变。<em class="oj"> addProducts </em>动作提交了<em class="oj"> addProduct </em>变异，我们稍后会用到它。</p><p id="6312" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们将要创建的示例中，我们不会使用<em class="oj"> getProducts </em>操作。我创建这个动作作为一个额外的(异步的)例子来展示一个动作可能是什么样子。<em class="oj"> getProducts </em>动作向API发送请求，并根据响应提交变异。</p><h2 id="8781" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">getters.js</h2><p id="8af5" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><em class="oj"> getters.js </em>包含了所有的getter函数。Getters用于存储，就像计算属性用于组件一样。Getters也可以通过第一个参数访问状态。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h1 id="3461" class="mz la je bd lb na nb nc le nd ne nf lh ng nh ni lk nj nk nl ln nm nn no lq np bi translated">在组件中使用存储</h1><p id="10a2" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">在开始使用组件中的存储之前，我们必须将存储注入到根组件的所有子组件中。我们在<code class="fe nq nr ns mr b">main.js</code>中这样做，在那里我们的Vue实例被创建。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="cf8c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="oj">注意:<br/>您可以删除第4、5和7行，因为在这个例子中您不需要axios。如果你想使用axios，你需要安装它:</em></p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="83ce" class="kz la je mr b gy mv mw l mx my">npm install --save axios vue-axios</span></pre><h2 id="9182" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">组件</h2><p id="404c" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">为了演示商店如何使用组件，我们将在<code class="fe nq nr ns mr b">components</code>文件夹中创建三个组件:</p><ul class=""><li id="ce30" class="nv nw je kd b ke kf ki kj km nx kq ny ku nz ky oa ob oc od bi translated">产品表单. vue</li><li id="521f" class="nv nw je kd b ke oe ki of km og kq oh ku oi ky oa ob oc od bi translated">产品列表. vue</li><li id="898b" class="nv nw je kd b ke oe ki of km og kq oh ku oi ky oa ob oc od bi translated">InStockList.vue</li></ul><h2 id="1bf2" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">产品表单. vue</h2><p id="0e40" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">该组件有一个表单，一旦按钮被点击，该表单将向商店发送一个添加产品的动作。正如您在第29行看到的，我们向商店发送了一个动作。因为我们给模块命名了空间，所以我们必须在动作名前面加上模块名。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="1037" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">产品列表. vue</h2><p id="0eb5" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated"><em class="oj"> ProductList </em>组件包含所有产品的列表，包括库存和非库存产品。只有当产品列表不为空时，才会显示该列表。</p><p id="9378" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意<code class="fe nq nr ns mr b">products</code>变量来自状态对象。为此，我们使用了<em class="oj"> mapState </em>助手。这个助手为我们生成计算的getter函数。</p><p id="b02b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为我们命名了模块，所以我们需要将模块的名称作为第一个参数传递。第二个参数是我们想要为其创建getter函数的属性列表。</p><p id="bdec" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用扩展操作符(…)，这样我们就能够将本地计算的属性与<em class="oj"> mapState </em>返回的对象混合在一起。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="2310" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">InStockList.vue</h2><p id="1a0d" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">就像<em class="oj">产品列表</em>组件一样，该组件包含产品列表。不同之处在于，该组件仅显示库存中的产品。为此，它使用了商店中的<em class="oj"> inStock </em> getter函数。该功能对处于状态的<code class="fe nq nr ns mr b"><em class="oj">products</em></code> <em class="oj"> </em>变量应用过滤器。</p><p id="6b98" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，<em class="oj"> mapGetters </em>函数的使用方式与<em class="oj"> mapState </em>函数完全相同。</p><figure class="mm mn mo mp gt iv"><div class="bz fp l di"><div class="nt nu l"/></div></figure><h2 id="1121" class="kz la je bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">让我们看看它的实际效果吧！</h2><p id="ff94" class="pw-post-body-paragraph kb kc je kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">现在我们已经创建了商店和组件，是时候看看我们的代码了。</p><p id="3b50" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为我们对两个列表组件使用相同的state属性，所以两个列表组件都应该对<code class="fe nq nr ns mr b">products</code>属性的变化做出反应。这种变化将通过添加产品来触发。</p><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/02bd7d34de971556f117447b215fd03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GELWaNvXqybrwNXe-DcoNQ.gif"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">我们的行动准则！</figcaption></figure><figure class="mm mn mo mp gt iv gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/eae91084993f61058664b8c4d5c13224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*Ujv3jKkFaWjE9DvxwIyowg.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">Vuex商店中的状态</figcaption></figure><p id="e2e4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如上图所示，添加产品会更新状态，这将导致列表组件更新。</p></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="3351" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！您刚刚创建了一个Vue组件正在使用的Vuex商店。我希望这篇文章能帮助你理解和实现Vuex商店。一定要看看我的其他职位。如果您有任何反馈、问题或希望我写另一个与Vue相关的主题，请随时发表评论。</p><p id="262c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编码快乐！</p></div></div>    
</body>
</html>