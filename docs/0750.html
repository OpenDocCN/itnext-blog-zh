<html>
<head>
<title>Building RESTful Web APIs with Node.js, Express, MongoDB and TypeScript — Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js、Express、MongoDB和TypeScript构建RESTful Web APIs第4部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4?source=collection_archive---------2-----------------------#2018-05-21">https://itnext.io/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4?source=collection_archive---------2-----------------------#2018-05-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/e448896648e7a16f3be0c2707c5a95ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ZZRtwzUVGyBkfkKurbHjwg.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">(图片来自OctoPerf)</figcaption></figure><p id="6d24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有一个关于<a class="ae kw" href="https://www.lynda.com/Node-js-tutorials/Next-steps/633869/671263-4.html" rel="noopener ugc nofollow" target="_blank">如何在Lynda </a>上构建Web APIs的课程，但是他们没有使用TypeScript。所以我决定用TypeScript做一个。这个项目中有许多需要改进的地方。如果你找到了，请留下评论。我很感激。)</p><p id="3fd0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-1-2-195bdaf129cf" rel="noopener"> <strong class="ka ir">第一部分:设置项目</strong> </a></p><p id="4cf5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-2-98c34e3513a2" rel="noopener"> <strong class="ka ir">第二部分:实现路由和CRUD </strong> </a></p><p id="2ebf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-3-d545b243541e" rel="noopener"> <strong class="ka ir">第3部分:为Web APIs使用控制器和模型</strong> </a></p><p id="7273" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-4-954c8c059cd4" rel="noopener"> <strong class="ka ir">第4部分:将Web APIs连接到MongoDB或其他</strong> </a></p><p id="fcc3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-5-a80e5a7f03db" rel="noopener"> <strong class="ka ir">第5部分:我们的Web APIs的安全性</strong> </a></p><p id="ee25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-a-serverless-restful-api-with-cloud-functions-firestore-and-express-f917a305d4e6"> <strong class="ka ir">奖励:用云函数、Firestore和Express </strong> </a>构建“无服务器”RESTful API</p><p id="59c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/handling-long-running-api-requests-in-nodejs-403bd566d47"> <strong class="ka ir">奖励:在Nodejs </strong> </a>中处理长时间运行的API请求</p><p id="7059" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一部分中，我们将把RESTful API应用程序连接到本地MongoDB，但是您可以连接到任何其他数据库服务。请阅读<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-1-2-195bdaf129cf">第1部分</a>将MongoDB安装到您的机器上。</p><p id="4d62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你需要做的就是导入<strong class="ka ir">mongose包</strong>，并在<strong class="ka ir"> app.ts </strong>文件中为你的MongoDB声明<strong class="ka ir"> URL </strong>。之后，你将通过<strong class="ka ir">mongose</strong>连接你的应用和数据库。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="111b" class="lg lh iq lc b gy li lj l lk ll">// lib/app.ts</span><span id="02bc" class="lg lh iq lc b gy lm lj l lk ll">...<br/><strong class="lc ir">import * as mongoose from "mongoose";</strong><br/><br/>class App {<br/><br/>    ...<br/><strong class="lc ir">    public mongoUrl: string = 'mongodb://localhost/CRMdb';  </strong><br/><br/>    constructor() {<br/>        ...<br/><strong class="lc ir">        this.mongoSetup();</strong><br/>    }<br/><br/><strong class="lc ir">    private mongoSetup(): void{<br/>        mongoose.Promise = global.Promise;<br/>        mongoose.connect(this.mongoUrl);    <br/>    }</strong><br/><br/>}<br/><br/>export default new App().app;</span></pre><p id="aad4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，您的应用程序就可以启动了(<em class="ln"> npm run dev </em>)</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/15f5b3365cdd7358d2681eb35d9de6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*lRjKcjTyGb8Bm2ELthm1HA.png"/></div></figure><p id="6a8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过网络浏览器(<em class="ln"> http://127.0.0.1:3000 </em>)测试您的第一条路线(GET /)</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/abad12f04b97d335f59b5f23c8defce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*Tycq3zwiPdDprUcyxcTeWQ.png"/></div></figure><p id="70bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记住，我们设置的所有路由都在<strong class="ka ir"> lib/routes/crmRoutes.ts </strong>文件中。</p><p id="d1cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将通过<a class="ae kw" href="https://www.getpostman.com/apps" rel="noopener ugc nofollow" target="_blank"> Postman </a>测试<strong class="ka ir">C</strong>reate-<strong class="ka ir">R</strong>EAD-<strong class="ka ir">U</strong>pdate-<strong class="ka ir">D</strong>elete特性。</p><ol class=""><li id="3382" class="lq lr iq ka b kb kc kf kg kj ls kn lt kr lu kv lv lw lx ly bi translated"><strong class="ka ir">创建您的第一个联系人</strong></li></ol><p id="5e61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我会发送一个<strong class="ka ir"> POST </strong>请求到<a class="ae kw" href="http://127.0.0.1:3000/contact" rel="noopener ugc nofollow" target="_blank"><em class="ln">http://127 . 0 . 0 . 1:3000/contact</em></a><em class="ln"/>正文中有联系人的信息。</p><p id="5815" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">记得在头中设置内容类型</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="190b" class="lg lh iq lc b gy li lj l lk ll">Content-Type: application/x-www-form-urlencoded</span></pre><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lz"><img src="../Images/0bc44baada95caf5cebab5120814d244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOlR6-RsRzjgfaWqZkb_Gw.png"/></div></div></figure><p id="0acf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">发送之后，服务器返回状态200以及数据库中的联系信息。</p><p id="7aee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。获取所有联系人</strong></p><p id="00cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要获取所有联系人，我们只需要向<a class="ae kw" href="http://127.0.0.1:3000/contact" rel="noopener ugc nofollow" target="_blank"> <em class="ln">发送一个<strong class="ka ir"> GET </strong>请求http://127 . 0 . 0 . 1:3000/contact</em></a>。您将获得数据库中所有联系人的数组。现在只有一个我刚刚创建的联系人。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi me"><img src="../Images/f953cfbcd246cebe4231e7530b93ebe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5lUux3eQIXJERjIEjiFiVg.png"/></div></div></figure><p id="4c0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。通过Id </strong>获取联系人</p><p id="74f4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想通过Id获取单个联系人，我们会向<a class="ae kw" href="http://127.0.0.1:3000/contact/:contactId" rel="noopener ugc nofollow" target="_blank"> <em class="ln">发送一个<strong class="ka ir"> GET </strong>请求http://127 . 0 . 0 . 1:3000/contact/:contact Id</em></a><em class="ln">。它将返回一个你联系的对象。记住，我们传递给URL的ID是联系人的<strong class="ka ir"> _id </strong>。</em></p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mf"><img src="../Images/2b2746a1fd087dcab277367be6c47ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*32r7mZSuwwtz-BklH72AYg.png"/></div></div></figure><p id="7f25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 4。更新现有联系人</strong></p><p id="3e9d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想要更新一个现有的联系人，我们将发送一个<strong class="ka ir"> PUT </strong>请求到<a class="ae kw" href="http://127.0.0.1:3000/contact/:contactId" rel="noopener ugc nofollow" target="_blank"><em class="ln">http://127 . 0 . 0 . 1:3000/contact/:contact id</em></a><em class="ln"/>以及详细信息。例如，我将使用<strong class="ka ir">_ id:5b 03015 E3 C4 B1 a 1164212 ff 4</strong>更新联系人的电话号码</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mg"><img src="../Images/f23ea32050c95d2332630b4d483dd9aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kkMqzjb-HmtKmrsn_ou9g.png"/></div></div></figure><p id="251c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 5。删除联系人</strong></p><p id="f553" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要删除一个联系人，我们会向<a class="ae kw" href="http://127.0.0.1:3000/contact/:contactId" rel="noopener ugc nofollow" target="_blank"> <em class="ln">发送一个<strong class="ka ir">删除</strong>请求http://127 . 0 . 0 . 1:3000/contact/:contact id</em></a><em class="ln">。</em>会返回“成功删除联系人！”</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi mh"><img src="../Images/af6a597e281b23c34434880234080bf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qExazdgPUz4ifYTVJ6pWyA.png"/></div></div></figure><p id="89ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这之后，现在我们有了一个完全工作的RESTful Web APIs应用程序，带有TypeScript和Nodejs。在<a class="ae kw" href="https://medium.com/@dalenguyen/building-restful-web-apis-with-node-js-express-mongodb-and-typescript-part-5-a80e5a7f03db" rel="noopener"> <strong class="ka ir">第五部分</strong> </a>中，我会为这个项目增加一些额外的安全措施。以防你需要跳过一个头。请访问我的<a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript" rel="noopener ugc nofollow" target="_blank"> github库</a>获取完整代码。</p><p id="e876" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/dalenguyen/rest-api-node-typescript" rel="noopener ugc nofollow" target="_blank">https://github.com/dalenguyen/rest-api-node-typescript</a></p></div></div>    
</body>
</html>