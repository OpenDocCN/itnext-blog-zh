<html>
<head>
<title>Architecting Kubernetes clusters — choosing a worker node size</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Kubernetes集群—选择工作节点大小</h1>
<blockquote>原文：<a href="https://itnext.io/architecting-kubernetes-clusters-choosing-a-worker-node-size-b3729cc0c78f?source=collection_archive---------2-----------------------#2020-06-09">https://itnext.io/architecting-kubernetes-clusters-choosing-a-worker-node-size-b3729cc0c78f?source=collection_archive---------2-----------------------#2020-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="0079" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文讨论了在Kubernetes集群中使用许多小型或少数大型工作节点的利弊。</p><blockquote class="ko kp kq"><p id="642e" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">在文章<a class="ae kv" href="https://medium.com/@weibeld/architecting-kubernetes-clusters-choosing-a-cluster-size-92f6feaa2908" rel="noopener"> <strong class="js iu">“构建Kubernetes集群—选择集群规模”</strong> </a>中讨论了使用许多小型或少数大型Kubernetes集群来运行一组给定的应用程序的相关主题。</p></blockquote><p id="e8b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">本文原载于</em><a class="ae kv" href="https://learnk8s.io/kubernetes-node-size" rel="noopener ugc nofollow" target="_blank"><em class="kr">learn k8s . io</em></a><em class="kr">。</em></p><h1 id="e1e1" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">内容</h1><p id="f255" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">作为快速参考，以下是讨论过的优点(👍)和缺点(👎)的大小节点。</p><p id="d973" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">大型节点:</strong></p><ul class=""><li id="d9d3" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn me mf mg mh bi translated"><strong class="js iu">👍</strong> <a class="ae kv" href="#75c9" rel="noopener ugc nofollow"> <strong class="js iu"> 1。管理开销少</strong> </a></li><li id="3087" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👍</strong> <a class="ae kv" href="#38db" rel="noopener ugc nofollow"> <strong class="js iu"> 2。降低每个节点的成本</strong> </a></li><li id="bc15" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👍</strong> <a class="ae kv" href="#db6f" rel="noopener ugc nofollow"> <strong class="js iu"> 3。允许运行资源密集型应用</strong> </a></li><li id="ba8a" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#ac83" rel="noopener ugc nofollow"> <strong class="js iu"> 1。每个节点的大量单元</strong> </a></li><li id="dd5e" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#f79c" rel="noopener ugc nofollow"> <strong class="js iu"> 2。有限复制</strong> </a></li><li id="dda5" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#4619" rel="noopener ugc nofollow"> <strong class="js iu"> 3。更高的爆炸半径</strong>和</a></li><li id="3075" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#3b27" rel="noopener ugc nofollow"> <strong class="js iu"> 4。大比例增量</strong> </a></li></ul><p id="75ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">小节点:</strong></p><ul class=""><li id="05a2" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn me mf mg mh bi translated"><strong class="js iu">👍</strong> <a class="ae kv" href="#58e6" rel="noopener ugc nofollow"> <strong class="js iu"> 1。减小爆炸半径</strong> </a></li><li id="1153" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👍</strong> <a class="ae kv" href="#b9ca" rel="noopener ugc nofollow"> <strong class="js iu"> 2。允许高复制</strong> </a></li><li id="37ce" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#648d" rel="noopener ugc nofollow"> <strong class="js iu"> 1。大量节点</strong> </a></li><li id="439f" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#5de5" rel="noopener ugc nofollow"> <strong class="js iu"> 2。更多系统开销</strong> </a></li><li id="bae7" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#f842" rel="noopener ugc nofollow"> <strong class="js iu"> 3。降低资源利用率</strong> </a></li><li id="c9d0" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated"><strong class="js iu">👎</strong> <a class="ae kv" href="#f0bc" rel="noopener ugc nofollow"> <strong class="js iu"> 4。小节点上的Pod限制</strong> </a></li></ul><h1 id="21c5" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h1><p id="d6ac" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">当您创建一个Kubernetes集群时，首先出现的一个问题是:“我应该使用什么类型的工作节点，应该有多少个？”。</p><p id="06bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您正在构建一个本地集群，您应该订购一些最新一代的power服务器，还是使用您数据中心中的十几台旧机器？</p><p id="a1e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者，如果你正在使用一个托管的Kubernetes服务，比如<a class="ae kv" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank">谷歌Kubernetes引擎(GKE) </a>，你应该使用八个<code class="fe mn mo mp mq b">n1-standard-1</code>还是两个<code class="fe mn mo mp mq b">n1-standard-4</code>实例来实现你想要的计算能力？</p><h1 id="07c2" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">集群容量</h1><p id="987f" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">一般来说，Kubernetes集群可以被看作是将一组单独的节点抽象为一个大的“超级节点”。</p><p id="3b77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个超级节点的总计算能力(就CPU和内存而言)是所有组成节点能力的总和。</p><p id="cf28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有多种方法可以实现群集的预期目标容量。</p><p id="f3a6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，假设您需要一个总容量为8个CPU内核和32gb RAM的集群。</p><blockquote class="ko kp kq"><p id="b402" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">例如，因为您希望在群集上运行的应用程序集需要这么多资源。</p></blockquote><p id="c3f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是设计集群的两种可能方式:</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mr"><img src="../Images/f857f13d79a492824f139c57ce49ca4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UeM028YE3COy0rORwBSnFg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">组织总容量为8个CPU内核和32 GB内存的集群的两种方式。</figcaption></figure><p id="f96a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这两个选项都会产生具有相同容量的群集，但是左边的选项使用4个较小的节点，而右边的选项使用2个较大的节点。</p><p id="5de9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">哪个比较好？</em></p><p id="f9a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">走近这个问题，我们先来看看“大节点少”和“小节点多”这两个对立方向的利弊。</p><blockquote class="ko kp kq"><p id="34f5" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">注意，本文中的“节点”总是指工作节点。主节点的数量和大小的选择是一个完全不同的话题。</p></blockquote><h1 id="6198" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">几个大节点</h1><p id="8233" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">这方面最极端的情况是由一个工作节点提供所需的全部集群容量。</p><p id="c777" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的示例中，这将是一个具有16个CPU内核和16gb RAM的工作节点。</p><p id="a66e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">让我们来看看这种方法的优势。</em></p><h2 id="75c9" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👍 1.更少的管理开销</h2><p id="d69f" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">简单地说，管理少量机器比管理大量机器更省力。</p><p id="72ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新和补丁可以更快地应用，机器可以更容易地保持同步。</p><p id="4fe0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，机器数量少的情况下，预期故障的绝对数量比机器数量多的情况下少。</p><p id="9f4e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">但是，请注意，这主要适用于裸机服务器，不适用于云实例。</em></p><p id="2643" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您使用云实例(作为托管Kubernetes服务的一部分或您自己在云基础设施上安装的Kubernetes)，您将底层机器的管理外包给了云提供商。</p><p id="41ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，管理云中的10个节点并不比管理云中的单个节点多多少。</p><h2 id="38db" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👍 2.降低每个节点的成本</h2><p id="c5ad" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">虽然更强大的机器比低端机器更贵，但价格上涨不一定是线性的。</p><p id="62fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">换句话说，拥有10个CPU内核和10gb RAM的单台机器可能比拥有1个CPU内核和1gb RAM的10台机器便宜。</p><p id="e157" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">但是，请注意，如果您使用云实例，这可能不适用。</em></p><p id="3c71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在目前主要云提供商<a class="ae kv" href="https://aws.amazon.com/ec2/pricing/on-demand/" rel="noopener ugc nofollow" target="_blank">亚马逊Web服务</a>、<a class="ae kv" href="https://cloud.google.com/compute/vm-instance-pricing" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>、<a class="ae kv" href="https://azure.microsoft.com/en-us/pricing/calculator/#virtual-machines" rel="noopener ugc nofollow" target="_blank">微软Azure </a>的定价方案中，实例价格随容量线性增长。</p><p id="ea34" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，在谷歌云平台上，64个<code class="fe mn mo mp mq b">n1-standard-1</code>实例的成本与单个<code class="fe mn mo mp mq b">n1-standard-64</code>实例完全相同——两个选项都提供64个CPU内核和240 GB内存。</p><p id="26e1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，在云中，你通常不能通过使用更大的机器来节省任何钱。</p><h2 id="db6f" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👍 3.允许运行资源密集型应用程序</h2><p id="e3d8" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">拥有大型节点可能只是您希望在集群中运行的应用程序类型的一个需求。</p><p id="33cc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您有一个需要8 GB内存的机器学习应用程序，您就不能在只有1 GB内存的节点的集群上运行它。</p><p id="c626" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是您可以在具有10 GB内存的节点的集群上运行它。</p><p id="08d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">看到了优点，让我们看看缺点是什么。</em></p><h2 id="ac83" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 1.每个节点有大量机架</h2><p id="2b1b" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">在更少的节点上运行相同的工作负载自然意味着在每个节点上运行更多的pod。</p><p id="3128" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">这可能会成为一个问题。</em></p><p id="ea15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">原因是每个pod都会给运行在节点上的Kubernetes代理带来一些开销，比如容器运行时(例如Docker)、kubelet和cAdvisor。</p><p id="34b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，kubelet对节点上的每个容器执行定期的活性和就绪性探测——容器越多，kubelet在每次迭代中的工作量就越大。</p><p id="583e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">cAdvisor收集节点上所有容器的资源使用统计信息，kubelet定期查询这些信息，并在其API上公开这些信息——同样，这意味着cAdvisor和kubelet在每次迭代中都要做更多的工作。</p><p id="21f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果吊舱的数量变大，这些东西可能会开始降低系统的速度，甚至使其不可靠。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nt"><img src="../Images/0a349a47873a938f22768d8f897926bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IyRGXk8p4Rf-k_NWNoED0A.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">每个节点上的大量pod可能会使节点代理(如kubelet)过载。</figcaption></figure><p id="4a55" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有报告称<a class="ae kv" href="https://github.com/kubernetes/kubernetes/issues/45419" rel="noopener ugc nofollow" target="_blank">节点被报告为未就绪</a>，因为常规的kubelet健康检查花费了太长时间来遍历节点上的所有容器。</p><p id="aa32" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">由于这些原因，Kubernetes </em> <a class="ae kv" href="https://kubernetes.io/docs/setup/best-practices/cluster-large/" rel="noopener ugc nofollow" target="_blank"> <em class="kr">推荐每个节点最多110个pod</em></a><em class="kr">。</em></p><p id="3c1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，Kubernetes已经过测试，可以在常见的节点类型上可靠地工作。</p><p id="02ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据节点的性能，您可能能够成功地在每个节点上运行更多的pods但是很难预测事情是否会顺利运行或者您是否会遇到问题。</p><p id="f123" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">大多数托管的Kubernetes服务甚至对每个节点的pod数量进行了硬性限制:</em></p><ul class=""><li id="93b2" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn me mf mg mh bi translated">在<a class="ae kv" href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt" rel="noopener ugc nofollow" target="_blank">Amazon Elastic Kubernetes Service(EKS)</a>上，每个节点的最大pod数量取决于节点类型，范围从4到737。</li><li id="4f31" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated">在<a class="ae kv" href="https://cloud.google.com/kubernetes-engine/quotas" rel="noopener ugc nofollow" target="_blank">谷歌Kubernetes引擎(GKE) </a>上，限制是每个节点100个pod，不管节点的类型。</li><li id="ac80" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated">在<a class="ae kv" href="https://docs.microsoft.com/bs-latn-ba/azure/aks/configure-azure-cni#maximum-pods-per-node" rel="noopener ugc nofollow" target="_blank">Azure Kubernetes Service(AKS)</a>上，默认限制是每个节点30个pod，但可以增加到250个。</li></ul><p id="7d49" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您计划在每个节点上运行大量的pods，那么您可能应该预先测试事情是否按预期工作。</p><h2 id="f79c" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 2.有限复制</h2><p id="1df8" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">少量的节点可能会限制应用程序的有效复制程度。</p><p id="4ec5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您有一个由5个副本组成的高可用性应用程序，但您只有2个节点，那么该应用程序的有效复制程度将降低到2。</p><p id="e7d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是因为这5个复制副本只能分布在2个节点上，如果其中一个出现故障，它可能会一次关闭多个复制副本。</p><p id="b582" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，如果您至少有5个节点，每个副本可以在单独的节点上运行，单个节点的故障最多会导致一个副本停止运行。</p><p id="2e8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您有高可用性需求，您可能需要集群中一定数量的最小节点。</p><h2 id="4619" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 3.更大的爆炸半径</h2><p id="7113" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果只有几个节点，那么一个故障节点的影响会比有很多节点时更大。</p><p id="13c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您只有两个节点，其中一个出现故障，那么大约一半的pod会消失。</p><p id="fdb2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kubernetes可以将故障节点的工作负载重新安排到其他节点上。</p><p id="217d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，如果只有几个节点，则剩余节点上没有足够的备用容量来容纳故障节点的所有工作负载的风险会更高。</p><p id="b0f4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其结果是，您的部分应用程序将永久关闭，直到您再次启动故障节点。</p><p id="b518" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您希望减少硬件故障的影响，您可能希望选择更多的节点。</p><h2 id="3b27" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 4.大比例增量</h2><p id="4321" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">Kubernetes为云基础设施提供了一个<a class="ae kv" href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" rel="noopener ugc nofollow" target="_blank">集群自动缩放器</a>，允许根据当前需求自动添加或删除节点。</p><p id="fa72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您使用大节点，那么您有一个大的缩放增量，这使得缩放更加笨拙。</p><p id="5e90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您只有2个节点，那么添加一个额外的节点意味着将集群的容量增加50%。</p><p id="af25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可能比您实际需要的要多得多，这意味着您要为未使用的资源付费。</p><p id="7d57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您计划使用集群自动扩展，那么较小的节点可以实现更加流畅和经济高效的扩展行为。</p><p id="4998" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">在讨论了几个大节点的利弊之后，让我们转向许多小节点的场景。</em></p><h1 id="9aca" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">许多小节点</h1><p id="7606" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">这种方法包括用许多小节点而不是几个大节点组成集群。</p><p id="1751" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">这种方法的利弊是什么？</em></p><p id="ed84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用许多小节点的优点主要对应于使用少数大节点的缺点。</p><h2 id="58e6" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👍 1.减小爆炸半径</h2><p id="b5a8" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果节点越多，每个节点上的pod自然就越少。</p><p id="b53e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您有100个单元和10个节点，那么每个节点平均只包含10个单元。</p><p id="9695" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果其中一个节点出现故障，影响仅限于总工作负载的一小部分。</p><p id="2407" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有可能只有你的一些应用程序受到影响，而且可能只有少量的副本，所以应用程序作为一个整体保持运行。</p><p id="a553" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，剩余节点上很可能有足够的备用资源来容纳故障节点的工作负载，以便Kubernetes可以重新调度所有的pods，并且您的应用程序可以相对较快地恢复到全功能状态。</p><h2 id="b9ca" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👍 2.允许高度复制</h2><p id="1c5c" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果您已经复制了高可用性应用程序和足够多的可用节点，Kubernetes调度程序可以将每个副本分配给不同的节点。</p><blockquote class="ko kp kq"><p id="0c46" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">您可以通过<a class="ae kv" href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity" rel="noopener ugc nofollow" target="_blank">节点亲合性</a>、<a class="ae kv" href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity" rel="noopener ugc nofollow" target="_blank"> pod亲合性/反亲合性</a>和<a class="ae kv" href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" rel="noopener ugc nofollow" target="_blank">污染和容忍</a>来影响调度程序的pod放置。</p></blockquote><p id="d2ec" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这意味着，如果一个节点出现故障，最多会有一个副本受到影响，而您的应用程序仍然可用。</p><p id="00aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">已经看到了使用许多小节点的优点，缺点是什么？</em></p><h2 id="648d" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 1.大量节点</h2><p id="cf50" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果使用较小的节点，自然需要更多的节点来实现给定的集群容量。</p><p id="658c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">但是大量的节点对于Kubernetes控制平面来说是一个挑战。</em></p><p id="bbfa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，每个节点都需要能够与所有其他节点通信，这使得可能的通信路径数量以节点数量的平方增长，所有这些都必须由控制平面管理。</p><p id="afc9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Kubernetes控制器管理器中的节点控制器定期遍历集群中的所有节点来运行健康检查——更多的节点意味着节点控制器的更多负载。</p><p id="d8d7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更多的节点也意味着更多的etcd数据库负载——每个kubelet和kube-proxy都会产生一个etcd的<a class="ae kv" href="https://etcd.io/docs/v3.3.12/dev-guide/interacting_v3/#watch-key-changes" rel="noopener ugc nofollow" target="_blank"> watcher </a>客户端(通过API服务器), etcd必须向其广播对象更新。</p><p id="0983" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一般来说，每个工作节点都会给主节点上的系统组件带来一些开销。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nu"><img src="../Images/03e9eda6f6633a68e85b59b4d25ef540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0b8ir44Fv7tggb5FzXZn8g.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">集群中的大量工作节点可能会使Kubernetes控制平面过载。</figcaption></figure><p id="1caf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据官方说法，Kubernetes声称支持多达5000个节点的集群。</p><p id="26c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，在实践中，500个节点可能已经<a class="ae kv" href="https://www.lfasiallc.com/wp-content/uploads/2017/11/BoF_-Not-One-Size-Fits-All-How-to-Size-Kubernetes-Clusters_Guang-Ya-Liu-_-Sahdev-Zala.pdf" rel="noopener ugc nofollow" target="_blank">构成了不小的挑战</a>。</p><p id="692a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">大量工作节点的影响可以通过使用更高性能的主节点来减轻。</p><p id="5689" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">实践中就是这么做的。</em></p><p id="1c7f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下是<code class="fe mn mo mp mq b">kube-up</code>在<a class="ae kv" href="https://cloud.google.com/compute/docs/machine-types" rel="noopener ugc nofollow" target="_blank">谷歌云平台(GCP) </a>上针对不同数量的工作节点使用的<a class="ae kv" href="https://kubernetes.io/docs/setup/best-practices/cluster-large/#size-of-master-and-master-components" rel="noopener ugc nofollow" target="_blank">主节点大小</a>:</p><ul class=""><li id="c30e" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn me mf mg mh bi translated">5个工作节点→ <code class="fe mn mo mp mq b">n1-standard-1</code>主节点</li><li id="13c9" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated">500个工人节点→ <code class="fe mn mo mp mq b">n1-standard-32</code>主节点</li></ul><p id="977c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有这里的<a class="ae kv" href="https://aws.amazon.com/ec2/instance-types/" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务(AWS) </a>:</p><ul class=""><li id="871c" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn me mf mg mh bi translated">5个工作节点→ <code class="fe mn mo mp mq b">m3.medium</code>主节点</li><li id="ffaa" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn me mf mg mh bi translated">500个工人节点→ <code class="fe mn mo mp mq b">c4.8xlarge</code>主节点</li></ul><p id="a490" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如您所见，对于500个工作节点，所使用的主节点分别有32个和36个CPU内核以及120 GB和60 GB的内存。</p><p id="41f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些都是相当大的机器！</p><p id="9321" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您打算使用大量小节点，您需要记住两件事:</p><ol class=""><li id="e37b" class="lz ma it js b jt ju jx jy kb mb kf mc kj md kn nv mf mg mh bi translated">您拥有的工作节点越多，您需要的高性能主节点就越多。</li><li id="525a" class="lz ma it js b jt mi jx mj kb mk kf ml kj mm kn nv mf mg mh bi translated">如果您计划使用500个以上的节点，您可能会遇到一些性能瓶颈，需要一些努力来解决。</li></ol><blockquote class="ko kp kq"><p id="0779" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">像<a class="ae kv" href="https://www.youtube.com/watch?v=v9cwYvuzROs" rel="noopener ugc nofollow" target="_blank"> Virtual Kubelet </a>这样的新开发允许绕过这些限制，允许集群拥有大量的工作节点。</p></blockquote><h2 id="5de5" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 2.更多系统开销</h2><p id="996e" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">Kubernetes在每个worker节点上运行一组系统守护进程，包括容器运行时(例如Docker)、kube-proxy和包含cAdvisor的kubelet。</p><blockquote class="ko kp kq"><p id="0edb" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">cAdvisor包含在kubelet二进制文件中。</p></blockquote><p id="10ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所有这些守护进程一起消耗固定数量的资源。</p><p id="7b03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您使用许多小节点，那么这些系统组件使用的资源部分会更大。</p><p id="3f85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，假设单个节点的所有系统守护程序一起使用0.1个CPU核心和0.1 GB内存。</p><p id="8550" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您有一个包含10个CPU内核和10 GB内存的节点，那么守护程序将占用集群容量的1%。</p><p id="fab8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，如果您有10个节点，每个节点有1个CPU内核和1 GB内存，那么守护程序会消耗10%的集群容量。</p><p id="26fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，在第二种情况下，你账单的10%用于运行系统，而在第一种情况下，只有1%。</p><p id="201d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果您想最大限度地提高基础设施支出的回报，那么您可能会选择更少的节点。</p><h2 id="f842" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 3.较低的资源利用率</h2><p id="789a" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">如果您使用较小的节点，那么您最终可能会得到大量的资源碎片，这些资源碎片太小而无法分配给任何工作负载，因此处于未使用状态。</p><p id="7e70" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，假设您的所有pod都需要0.75 GB的内存。</p><p id="9058" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您有10个1 GB内存的节点，那么您可以运行10个这样的pod，最终您会在每个节点上得到一块无法再使用的0.25 GB内存。</p><p id="c994" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这意味着，集群总内存的25%被浪费了。</p><p id="8503" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一方面，如果您使用具有10 GB内存的单个节点，那么您可以运行13个这样的pods——最终您只能得到一个无法使用的0.25 GB的块。</p><p id="15dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这种情况下，您只浪费了2.5%的内存。</p><p id="cd44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以，如果你想最小化资源浪费，使用更大的节点可能会提供更好的结果。</p><h2 id="f0bc" class="nh kx it bd ky ni nj dn lc nk nl dp lg kb nm nn lk kf no np lo kj nq nr ls ns bi translated">👎 4.小节点上的Pod限制</h2><p id="2b09" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated"><em class="kr">在一些云基础设施上，小节点上允许的最大pod数量比您想象的更受限制。</em></p><p id="f43e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这就是<a class="ae kv" href="https://aws.amazon.com/eks/" rel="noopener ugc nofollow" target="_blank">Amazon Elastic Kubernetes Service(EKS)</a>的情况，其中<a class="ae kv" href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt" rel="noopener ugc nofollow" target="_blank">每个节点的最大pod数量</a>取决于实例类型。</p><p id="1b26" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，对于一个<code class="fe mn mo mp mq b">t2.medium</code>实例，pod的最大数量是17，对于<code class="fe mn mo mp mq b">t2.small</code>是11，对于<code class="fe mn mo mp mq b">t2.micro</code>是4。</p><blockquote class="ko kp kq"><p id="f7a5" class="jq jr kr js b jt ju jv jw jx jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kn im bi translated">您可以在这个文件的<a class="ae kv" href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt" rel="noopener ugc nofollow" target="_blank">中找到每个AWS EC2实例类型的最大pod数量的概述。</a></p></blockquote><p id="5460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">这些都是非常小的数字！</em></p><p id="dc5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">任何超出这些限制的pod都无法被Kubernetes调度程序调度，并无限期地保持在<em class="kr">挂起</em>状态。</p><p id="50de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您没有意识到这些限制，这可能会导致难以发现的错误。</p><p id="01fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，如果你计划在亚马逊EKS上使用小节点，<a class="ae kv" href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt" rel="noopener ugc nofollow" target="_blank">检查相应的每个节点的pod限制</a>，并计算两次节点是否能容纳你所有的pod。</p><h1 id="0522" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">结论</h1><p id="cbdb" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated"><em class="kr">那么，您应该在集群中使用少量大节点还是大量小节点呢？</em></p><p id="fd30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一如既往，没有明确的答案。</p><p id="df69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您希望部署到集群的应用程序类型可能会指导您的决策。</p><p id="7b28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，如果您的应用程序需要10 GB的内存，您可能不应该使用小节点——集群中的节点应该至少有10 GB的内存。</p><p id="8da9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者，如果您的应用程序需要10倍复制来实现高可用性，那么您可能不应该只使用2个节点，您的集群应该至少有10个节点。</p><p id="cb02" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于介于两者之间的所有场景，这取决于您的具体需求。</p><p id="8bc9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kr">以上哪些优点和缺点与你相关？哪些不是？</em></p><p id="2164" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也就是说，没有规则要求所有节点必须具有相同的大小。</p><p id="6e0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">没有什么可以阻止您在集群中混合使用不同大小的节点——Kubernetes集群的工作节点可以是完全异构的，这可能允许您权衡两种方法的优缺点。</p></div></div>    
</body>
</html>