<html>
<head>
<title>Web Security — Part 1, Subresource Integrity (SRI)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络安全—第1部分，子资源完整性(SRI)</h1>
<blockquote>原文：<a href="https://itnext.io/web-security-part-1-subresource-integrity-sri-61e3878c3a9e?source=collection_archive---------4-----------------------#2019-03-21">https://itnext.io/web-security-part-1-subresource-integrity-sri-61e3878c3a9e?source=collection_archive---------4-----------------------#2019-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4d8464802323b64b95b6461e044b4c6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSh75cGDTQg1Wm8AnL9qJw.jpeg"/></div></div></figure><p id="8f82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在与其他工程师交流的过程中，我一有机会就会想办法提出web安全的话题。起初，在最开始，这是出于好奇，以了解最新的和流行的流行语有关的主题。但随着时间的推移，我越来越有兴趣了解这些工程师在保护他们的应用程序免受什么攻击，以及如何保护。</p><p id="e6f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">可悲的是，经常听到人们直截了当地说他们的平台是安全的；就像安全是一个开关，你只需要打开或关闭它。安全性是一个非常广泛的领域，并且在不断发展。您的安全性取决于您意识到的安全威胁类型。有很多提供安全报告服务的在线工具:Netsparker的<a class="ae kw" href="https://www.ssllabs.com/" rel="noopener ugc nofollow" target="_blank"> SSL Labs </a>、T2的【安全标题】T3、Mozilla的<a class="ae kw" href="https://observatory.mozilla.org/" rel="noopener ugc nofollow" target="_blank"> Observatory </a>等等。</p><h1 id="f516" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">子资源完整性(SRI)</h1><p id="b438" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果攻击者能够篡改和改变已经加载到您的站点上的第三方脚本，他们会做哪些事情？简单的回答——几乎任何事情。加载外部内容、访问本地存储、重定向用户、修改DOM、抛出要求用户安装程序的侵入性弹出窗口等等。作为一名开发人员，这是一个非常可怕的处境。</p><p id="6223" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SRI是一种安全特性，它让开发人员确信，他们的应用程序正在获取的任何资源都是在没有被篡改的情况下实际交付的。无论何时从第三方来源加载库，这都是一个最佳实践。这在内容交付网络(cdn)中很常见，但并不仅限于此。</p><p id="d3c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是一个加载到站点中的jQuery脚本示例:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/7d560ce0cf8f6abc33461d7947a79c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULn9mNCREtrA2x63ZcikCg.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">jQuery集成脚本</figcaption></figure><p id="a8f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj">完整性</em>属性允许浏览器确定托管在第三方服务器上的资源没有被操纵。它是如何工作的？库的第三方来源提供了资源的加密哈希，每次获取资源时，浏览器都会对其进行哈希处理，并确认它是否与最初提供的哈希匹配。浏览器每次遇到带有完整性属性的<em class="mj"> &lt;脚本&gt; </em>或<em class="mj"> &lt;链接&gt; </em>元素时都会这样做。这使得中路的<a class="ae kw" href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="noopener ugc nofollow" target="_blank">人</a> (MITM)进攻非常困难。</p><p id="7eab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj"> integrity </em>属性的值<em class="mj">SHA 256-BbhdlvQf/xty 9 gja 0 D3 hi wqf 8 lacrtxzkrutelt 44 =</em>告诉浏览器在<a class="ae kw" href="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" rel="noopener ugc nofollow" target="_blank">https://cdnjs . cloud flare . com/Ajax/libs/jquery/2 . 2 . 4/jquery . min . js</a>找到的文件的SHA-256(有不同版本的SHA) hash是<em class="mj">BbhdlvQf/xty 99通过下载文件并在终端上运行以下命令，我们可以很容易地确认这是生成的摘要:</em></p><p id="847c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mj">OpenSSL dgst-sha 256-binary</em><strong class="ka ir"><em class="mj">filename . js</em></strong><em class="mj">| OpenSSL base 64-A</em></p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/d5d5029e2e1cce23a8b39ba3753d7531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U8yIWgYYUnXw40JO6qKfaA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">生成SRI哈希</figcaption></figure><p id="2af7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，如果MITM攻击发生并且文件被修改，会发生什么呢？那么，浏览器将生成接收到的资源的加密散列，并且在比较时，浏览器将发现由第三方源提供的初始散列与生成的散列不同。因此，浏览器会抛出网络错误。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/66925315248b15c9ca0af689d75918b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ymabIcmtpqpkVx7MjlbFA.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">被阻止的资源截图</figcaption></figure><h1 id="5355" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">子资源完整性的优势</h1><ul class=""><li id="7900" class="mm mn iq ka b kb lv kf lw kj mo kn mp kr mq kv mr ms mt mu bi translated">增加开发人员对第三方库的信任，以及用户对应用程序的信心</li><li id="05d9" class="mm mn iq ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">报告违规提醒开发人员注意事件</li></ul><h1 id="1687" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">包扎</h1><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/6fcb0d96731e3e3b5947c04994a858cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W5KCAjcz_uNrRBopelsc_w.png"/></div></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">子资源完整性说明。贷项:堆栈路径</figcaption></figure><p id="1ad8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧。所以一次袭击被减轻了。资源已被阻止，其内容尚未在浏览器上执行。浏览器抛出了一个网络错误。灾难避免了。干得好。</p><p id="b889" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是我们能更进一步吗？如果发生这种情况，我们现在知道应用程序会自动崩溃，因为没有加载所需的脚本，应用程序将处于不可用状态。更糟糕的是，开发者或网站所有者不太可能知道这样的事件已经发生，因为这是在用户的浏览器上运行的。在下一篇文章中，我将讨论如何使用<strong class="ka ir">内容安全策略</strong> (CSP)及其报告违规的能力来解决后面这些问题。</p><p id="b09a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了模拟MITM攻击并修改传输中的资源，我们可以使用网络嗅探工具来编辑web会话。一个例子是<a class="ae kw" href="https://www.telerik.com/fiddler" rel="noopener ugc nofollow" target="_blank">提琴手</a>。Fiddler提供了一个<em class="mj"> OnBeforeResponse() </em>钩子，允许您设置一个断点来暂停会话的处理，并允许更改请求/响应。虽然这一点超出了本文的范围，但我可以考虑将来写一篇文章来演示这一点。</p></div></div>    
</body>
</html>