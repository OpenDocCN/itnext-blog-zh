<html>
<head>
<title>Local Notifications in Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter中的本地通知</h1>
<blockquote>原文：<a href="https://itnext.io/local-notifications-in-flutter-6136235e1b51?source=collection_archive---------1-----------------------#2020-07-04">https://itnext.io/local-notifications-in-flutter-6136235e1b51?source=collection_archive---------1-----------------------#2020-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d1aab287b6a4f14db52ce9d1e5e43c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0u2P0n6byBXJjfxRxsU6kA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Flutter中的本地通知</figcaption></figure><p id="24bb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">大家好，</p><p id="7ca3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我们将学习如何在Flutter中显示本地通知。</p><p id="556f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们要学什么？</p><ul class=""><li id="185e" class="lb lc iq ke b kf kg kj kk kn ld kr le kv lf kz lg lh li lj bi translated"><em class="la">显示简单通知</em></li><li id="d624" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">显示重复通知</em></li><li id="3fdc" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">显示预定通知</em></li><li id="21dd" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">在一周的特定时间和日期显示通知</em></li><li id="3844" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">显示带附件的通知</em></li><li id="51a3" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">显示带有HTML内容的通知</em></li><li id="42da" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">取消通知。</em></li><li id="9935" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">取消所有通知</em></li><li id="3bb9" class="lb lc iq ke b kf lk kj ll kn lm kr ln kv lo kz lg lh li lj bi translated"><em class="la">处理通知抽头。</em></li></ul><p id="7dac" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所以让我们开始…</p><h1 id="0aad" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated"><strong class="ak">观看视频教程</strong></h1><figure class="mn mo mp mq gt jr"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Flutter中的本地通知</figcaption></figure><h1 id="dcaf" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">添加依赖关系</h1><p id="6504" class="pw-post-body-paragraph kc kd iq ke b kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz ij bi translated">打开您的<strong class="ke ir"> <em class="la"> pubspec.yaml </em> </strong>文件，并在依赖项中添加以下内容</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="13ca" class="nd lq iq mz b gy ne nf l ng nh"><strong class="mz ir">flutter_local_notifications: ^1.4.4+1<br/></strong>// Add below dependencies based on your requirement<strong class="mz ir"><br/>rxdart: ^0.24.1<br/>path_provider: ^1.6.11<br/>http: ^0.12.1</strong></span></pre><p id="2072" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">初始Android和iOS设置请按照这个</em> <a class="ae ni" href="https://pub.dev/packages/flutter_local_notifications#-installing-tab-" rel="noopener ugc nofollow" target="_blank"> <em class="la">链接</em> </a> <em class="la">。</em></p><p id="520c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦你完成了设置，让我们移动到颤振编码部分。</p><p id="71af" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于这个例子，我将大部分与通知相关的代码保存在一个单独的文件中。所以让我们创建一个名为“NotificationPlugin.dart”的新文件。</p><p id="23aa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我首先需要的是一个通知插件的句柄。</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="d4ec" class="nd lq iq mz b gy ne nf l ng nh">FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin;</span></pre><h1 id="b7eb" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">获得用户的许可</h1><p id="a5b9" class="pw-post-body-paragraph kc kd iq ke b kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz ij bi translated">接下来是获得用户的许可。只有在iOS中需要这个权限，在Android中不需要。</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="14f3" class="nd lq iq mz b gy ne nf l ng nh">_requestIOSPermission() {<br/>    flutterLocalNotificationsPlugin<br/>        .resolvePlatformSpecificImplementation&lt;<br/>            IOSFlutterLocalNotificationsPlugin&gt;()<br/>        .requestPermissions(<br/>          alert: false,<br/>          badge: true,<br/>          sound: true,<br/>        );<br/> }</span></pre><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/dd4d9d2fa46a0ff08ad8d020d78ad7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*87QTdvdzr4OXaEAQDhsR-w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">iOS中使用Flutter的通知权限</figcaption></figure><p id="9256" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们假设用户点击允许。</p><p id="3bc9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">太好了，现在我们得到了用户的许可。</p><p id="adb1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们初始化通知的设置。</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="23f3" class="nd lq iq mz b gy ne nf l ng nh">initializePlatformSpecifics() {<br/>    var initializationSettingsAndroid =<br/>        AndroidInitializationSettings('app_notf_icon');<br/>    var initializationSettingsIOS = IOSInitializationSettings(<br/>      requestAlertPermission: true,<br/>      requestBadgePermission: true,<br/>      requestSoundPermission: false,<br/>      onDidReceiveLocalNotification: (id, title, body, payload) async {<br/>        // your call back to the UI<br/>      },<br/>    );</span><span id="801f" class="nd lq iq mz b gy nk nf l ng nh">initializationSettings = InitializationSettings(<br/>        initializationSettingsAndroid, initializationSettingsIOS);<br/>  }</span></pre><p id="cfb5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">' app_notf_icon '是android Studio中创建的图标，我在上面的youtube视频中解释了同样的内容。一旦你有了图标，确保复制到Android res/drawable文件夹中。现在我们对Android通知设置很满意。</p><p id="10f0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来对于iOS，和上面的requestAlertPermission的代码一样，requestBadgePermission和requestSoundPermission按照你想要的方式设置。</p><p id="b12c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“<em class="la">onDidReceiveLocalNotification</em>”适用于低于10的iOS版本。当。应用程序在前台运行，当一个通知被触发。在低于10的版本中，当应用程序在前台运行时，不会有任何通知出现。</p><p id="12f2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么如何获得10版本以上的回调呢？</p><p id="09ba" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是做这件事的方法…</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="137d" class="nd lq iq mz b gy ne nf l ng nh">await flutterLocalNotificationsPlugin.initialize(initializationSettings,<br/>        onSelectNotification: (String payload) async {<br/>      onNotificationClick(payload);    // your call back to the UI<br/>});</span></pre><p id="edad" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们进入主要部分…</p><p id="945f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通知…</p><h1 id="81a2" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">简单通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="5193" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; showNotification() async {<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID',<br/>      'CHANNEL_NAME',<br/>      "CHANNEL_DESCRIPTION",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      playSound: true,<br/>      timeoutAfter: 5000,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.show(<br/>      0,  // Notification ID<br/>      'Test Title', // Notification Title<br/>      'Test Body', // Notification Body, set as null to remove the body<br/>      platformChannelSpecifics,<br/>      payload: 'New Payload', // Notification Payload<br/>    );<br/>}</span></pre><p id="d955" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于Android频道规范，如果您已经为该频道id设置了一些设置，则在此之后不会更改，但您可以使用新的通知ID、标题、正文和有效负载在该频道上触发进一步的通知。您可能需要更改频道ID或重新安装应用程序来重置它。</p><p id="e839" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一组</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="cb30" class="nd lq iq mz b gy ne nf l ng nh">importance: Importance.Max,<br/>priority: Priority.High,</span></pre><p id="4a4c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将通知显示为屏幕顶部的弹出窗口。否则它将被触发，但不会显示在屏幕上方，而是会出现在Android通知区域。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/7a8d3ccd5e7e89a9c45450b9355b008f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dp0fItcshRwWzJrwclJUJw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用Flutter的简单通知</figcaption></figure><h1 id="fc67" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">安排通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="2015" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; scheduleNotification() async {<br/>    var scheduleNotificationDateTime = DateTime.now().add(Duration(seconds: 5));<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 1',<br/>      'CHANNEL_NAME 1',<br/>      "CHANNEL_DESCRIPTION 1",<br/>      icon: 'secondary_icon',<br/>      sound: RawResourceAndroidNotificationSound('my_sound'),<br/>      largeIcon: DrawableResourceAndroidBitmap('large_notf_icon'),<br/>      enableLights: true,<br/>      color: const Color.fromARGB(255, 255, 0, 0),<br/>      ledColor: const Color.fromARGB(255, 255, 0, 0),<br/>      ledOnMs: 1000,<br/>      ledOffMs: 500,<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      playSound: true,<br/>      timeoutAfter: 5000,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails(<br/>      sound: 'my_sound.aiff',<br/>    );<br/>    var platformChannelSpecifics = NotificationDetails(<br/>      androidChannelSpecifics,<br/>      iosChannelSpecifics,<br/>    );<br/>    await flutterLocalNotificationsPlugin.schedule(<br/>      0,<br/>      'Test Title',<br/>      'Test Body',<br/>      scheduleNotificationDateTime,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span></pre><p id="a824" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此通知将在触发5秒后触发，如果用户没有与之交互，它将在5秒后消失。</p><h1 id="ab72" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">每天一次显示通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="a10b" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; showDailyAtTime() async {<br/>    var time = Time(18, 0, 0);<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 4',<br/>      'CHANNEL_NAME 4',<br/>      "CHANNEL_DESCRIPTION 4",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.showDailyAtTime(<br/>      0,<br/>      'Test Title at ${time.hour}:${time.minute}.${time.second}',<br/>      'Test Body', //null<br/>      time,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/> }</span></pre><p id="081d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上面的通知将在每天下午6点准时发出。</p><h1 id="0397" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">显示每周的日期和时间</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="adb0" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; showWeeklyAtDayTime() async {<br/>    var time = Time(10, 0, 0);<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 5',<br/>      'CHANNEL_NAME 5',<br/>      "CHANNEL_DESCRIPTION 5",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.showWeeklyAtDayAndTime(<br/>      0,<br/>      'Test Title at ${time.hour}:${time.minute}.${time.second}',<br/>      'Test Body', //null<br/>      Day.Saturday,<br/>      time,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span></pre><p id="32e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上述通知将于每周六上午10点整发出。</p><h1 id="057f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">重复通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="ae23" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; repeatNotification() async {<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 3',<br/>      'CHANNEL_NAME 3',<br/>      "CHANNEL_DESCRIPTION 3",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.periodicallyShow(<br/>      0,<br/>      'Repeating Test Title',<br/>      'Repeating Test Body',<br/>      RepeatInterval.EveryMinute,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span></pre><p id="41b9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个通知将会每分钟重复一次。</p><p id="e2bd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">显示带附件的通知。</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="51e0" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; showNotificationWithAttachment() async {<br/>    var attachmentPicturePath = await _downloadAndSaveFile(<br/>        '<a class="ae ni" href="https://via.placeholder.com/800x200'" rel="noopener ugc nofollow" target="_blank">https://via.placeholder.com/800x200'</a>, 'attachment_img.jpg');<br/>    var iOSPlatformSpecifics = IOSNotificationDetails(<br/>      attachments: [IOSNotificationAttachment(attachmentPicturePath)],<br/>    );<br/>    var bigPictureStyleInformation = BigPictureStyleInformation(<br/>      FilePathAndroidBitmap(attachmentPicturePath),<br/>      contentTitle: '&lt;b&gt;Attached Image&lt;/b&gt;',<br/>      htmlFormatContentTitle: true,<br/>      summaryText: 'Test Image',<br/>      htmlFormatSummaryText: true,<br/>    );<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL ID 2',<br/>      'CHANNEL NAME 2',<br/>      'CHANNEL DESCRIPTION 2',<br/>      importance: Importance.High,<br/>      priority: Priority.High,<br/>      styleInformation: bigPictureStyleInformation,<br/>    );<br/>    var notificationDetails =<br/>        NotificationDetails(androidChannelSpecifics, iOSPlatformSpecifics);<br/>    await flutterLocalNotificationsPlugin.show(<br/>      0,<br/>      'Title with attachment',<br/>      'Body with Attachment',<br/>      notificationDetails,<br/>    );<br/>  }</span><span id="84da" class="nd lq iq mz b gy nk nf l ng nh">_downloadAndSaveFile(String url, String fileName) async {<br/>    var directory = await getApplicationDocumentsDirectory();<br/>    var filePath = '${directory.path}/$fileName';<br/>    var response = await http.get(url);<br/>    var file = File(filePath);<br/>    await file.writeAsBytes(response.bodyBytes);<br/>    return filePath;<br/>  }</span></pre><p id="2078" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这个例子中，通知将从指定的URL下载一个图像，并将其设置在Android和iOS的附件中。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/564bc3037f5a7e99c8691d2dbfaab353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QSyYzi-5u5mf214HnYPQvg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带附件的通知(未展开)</figcaption></figure><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/33cb6667488e426986565e343222f9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PEWbBVCvyav_74co8o3JDg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带附件的通知(扩展)</figcaption></figure><h1 id="1d90" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">获取待定通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="7610" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;int&gt; getPendingNotificationCount() async {<br/>    List&lt;PendingNotificationRequest&gt; p =<br/>        await flutterLocalNotificationsPlugin.pendingNotificationRequests();<br/>    return p.length;<br/>}</span></pre><p id="d7e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这将返回号码。尚未触发的通知。</p><h1 id="b299" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">取消通知</h1><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="a48f" class="nd lq iq mz b gy ne nf l ng nh">Future&lt;void&gt; cancelNotification() async {<br/>    await flutterLocalNotificationsPlugin.cancel(0);<br/>}</span><span id="3cac" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; cancelAllNotification() async {<br/>    await flutterLocalNotificationsPlugin.cancelAll();<br/>}</span></pre><p id="5146" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">取消(0)将取消ID = 0的通知</p><p id="cfa8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">cancelAll()将取消所有通知。</p><p id="84f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面是完整的“NotificationPlugin.dart”文件内容。</p><pre class="mn mo mp mq gt my mz na nb aw nc bi"><span id="a3a5" class="nd lq iq mz b gy ne nf l ng nh">import 'package:flutter/material.dart';<br/>import 'package:flutter_local_notifications/flutter_local_notifications.dart';<br/>import 'package:path_provider/path_provider.dart';<br/>import 'dart:io' show File, Platform;<br/>import 'package:http/http.dart' as http;</span><span id="8ddd" class="nd lq iq mz b gy nk nf l ng nh">import 'package:rxdart/subjects.dart';</span><span id="0448" class="nd lq iq mz b gy nk nf l ng nh">class NotificationPlugin {<br/>  //<br/>  FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin;<br/>  final BehaviorSubject&lt;ReceivedNotification&gt;<br/>      didReceivedLocalNotificationSubject =<br/>      BehaviorSubject&lt;ReceivedNotification&gt;();<br/>  var initializationSettings;</span><span id="33a2" class="nd lq iq mz b gy nk nf l ng nh">NotificationPlugin._() {<br/>    init();<br/>  }</span><span id="d89f" class="nd lq iq mz b gy nk nf l ng nh">init() async {<br/>    flutterLocalNotificationsPlugin = FlutterLocalNotificationsPlugin();<br/>    if (Platform.isIOS) {<br/>      _requestIOSPermission();<br/>    }<br/>    initializePlatformSpecifics();<br/>  }</span><span id="9f59" class="nd lq iq mz b gy nk nf l ng nh">initializePlatformSpecifics() {<br/>    var initializationSettingsAndroid =<br/>        AndroidInitializationSettings('app_notf_icon');<br/>    var initializationSettingsIOS = IOSInitializationSettings(<br/>      requestAlertPermission: true,<br/>      requestBadgePermission: true,<br/>      requestSoundPermission: false,<br/>      onDidReceiveLocalNotification: (id, title, body, payload) async {<br/>        ReceivedNotification receivedNotification = ReceivedNotification(<br/>            id: id, title: title, body: body, payload: payload);<br/>        didReceivedLocalNotificationSubject.add(receivedNotification);<br/>      },<br/>    );</span><span id="9848" class="nd lq iq mz b gy nk nf l ng nh">initializationSettings = InitializationSettings(<br/>        initializationSettingsAndroid, initializationSettingsIOS);<br/>  }</span><span id="db69" class="nd lq iq mz b gy nk nf l ng nh">_requestIOSPermission() {<br/>    flutterLocalNotificationsPlugin<br/>        .resolvePlatformSpecificImplementation&lt;<br/>            IOSFlutterLocalNotificationsPlugin&gt;()<br/>        .requestPermissions(<br/>          alert: false,<br/>          badge: true,<br/>          sound: true,<br/>        );<br/>  }</span><span id="7c87" class="nd lq iq mz b gy nk nf l ng nh">setListenerForLowerVersions(Function onNotificationInLowerVersions) {<br/>    didReceivedLocalNotificationSubject.listen((receivedNotification) {<br/>      onNotificationInLowerVersions(receivedNotification);<br/>    });<br/>  }</span><span id="231e" class="nd lq iq mz b gy nk nf l ng nh">setOnNotificationClick(Function onNotificationClick) async {<br/>    await flutterLocalNotificationsPlugin.initialize(initializationSettings,<br/>        onSelectNotification: (String payload) async {<br/>      onNotificationClick(payload);<br/>    });<br/>  }</span><span id="891d" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; showNotification() async {<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID',<br/>      'CHANNEL_NAME',<br/>      "CHANNEL_DESCRIPTION",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      playSound: true,<br/>      timeoutAfter: 5000,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.show(<br/>      0,<br/>      'Test Title',<br/>      'Test Body', //null<br/>      platformChannelSpecifics,<br/>      payload: 'New Payload',<br/>    );<br/>  }</span><span id="b3af" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; showDailyAtTime() async {<br/>    var time = Time(21, 3, 0);<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 4',<br/>      'CHANNEL_NAME 4',<br/>      "CHANNEL_DESCRIPTION 4",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.showDailyAtTime(<br/>      0,<br/>      'Test Title at ${time.hour}:${time.minute}.${time.second}',<br/>      'Test Body', //null<br/>      time,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span><span id="c786" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; showWeeklyAtDayTime() async {<br/>    var time = Time(21, 5, 0);<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 5',<br/>      'CHANNEL_NAME 5',<br/>      "CHANNEL_DESCRIPTION 5",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.showWeeklyAtDayAndTime(<br/>      0,<br/>      'Test Title at ${time.hour}:${time.minute}.${time.second}',<br/>      'Test Body', //null<br/>      Day.Saturday,<br/>      time,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span><span id="dfdd" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; repeatNotification() async {<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 3',<br/>      'CHANNEL_NAME 3',<br/>      "CHANNEL_DESCRIPTION 3",<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails();<br/>    var platformChannelSpecifics =<br/>        NotificationDetails(androidChannelSpecifics, iosChannelSpecifics);<br/>    await flutterLocalNotificationsPlugin.periodicallyShow(<br/>      0,<br/>      'Repeating Test Title',<br/>      'Repeating Test Body',<br/>      RepeatInterval.EveryMinute,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span><span id="81af" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; scheduleNotification() async {<br/>    var scheduleNotificationDateTime = DateTime.now().add(Duration(seconds: 5));<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL_ID 1',<br/>      'CHANNEL_NAME 1',<br/>      "CHANNEL_DESCRIPTION 1",<br/>      icon: 'secondary_icon',<br/>      sound: RawResourceAndroidNotificationSound('my_sound'),<br/>      largeIcon: DrawableResourceAndroidBitmap('large_notf_icon'),<br/>      enableLights: true,<br/>      color: const Color.fromARGB(255, 255, 0, 0),<br/>      ledColor: const Color.fromARGB(255, 255, 0, 0),<br/>      ledOnMs: 1000,<br/>      ledOffMs: 500,<br/>      importance: Importance.Max,<br/>      priority: Priority.High,<br/>      playSound: true,<br/>      timeoutAfter: 5000,<br/>      styleInformation: DefaultStyleInformation(true, true),<br/>    );<br/>    var iosChannelSpecifics = IOSNotificationDetails(<br/>      sound: 'my_sound.aiff',<br/>    );<br/>    var platformChannelSpecifics = NotificationDetails(<br/>      androidChannelSpecifics,<br/>      iosChannelSpecifics,<br/>    );<br/>    await flutterLocalNotificationsPlugin.schedule(<br/>      0,<br/>      'Test Title',<br/>      'Test Body',<br/>      scheduleNotificationDateTime,<br/>      platformChannelSpecifics,<br/>      payload: 'Test Payload',<br/>    );<br/>  }</span><span id="e768" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; showNotificationWithAttachment() async {<br/>    var attachmentPicturePath = await _downloadAndSaveFile(<br/>        '<a class="ae ni" href="https://via.placeholder.com/800x200'" rel="noopener ugc nofollow" target="_blank">https://via.placeholder.com/800x200'</a>, 'attachment_img.jpg');<br/>    var iOSPlatformSpecifics = IOSNotificationDetails(<br/>      attachments: [IOSNotificationAttachment(attachmentPicturePath)],<br/>    );<br/>    var bigPictureStyleInformation = BigPictureStyleInformation(<br/>      FilePathAndroidBitmap(attachmentPicturePath),<br/>      contentTitle: '&lt;b&gt;Attached Image&lt;/b&gt;',<br/>      htmlFormatContentTitle: true,<br/>      summaryText: 'Test Image',<br/>      htmlFormatSummaryText: true,<br/>    );<br/>    var androidChannelSpecifics = AndroidNotificationDetails(<br/>      'CHANNEL ID 2',<br/>      'CHANNEL NAME 2',<br/>      'CHANNEL DESCRIPTION 2',<br/>      importance: Importance.High,<br/>      priority: Priority.High,<br/>      styleInformation: bigPictureStyleInformation,<br/>    );<br/>    var notificationDetails =<br/>        NotificationDetails(androidChannelSpecifics, iOSPlatformSpecifics);<br/>    await flutterLocalNotificationsPlugin.show(<br/>      0,<br/>      'Title with attachment',<br/>      'Body with Attachment',<br/>      notificationDetails,<br/>    );<br/>  }</span><span id="3232" class="nd lq iq mz b gy nk nf l ng nh">_downloadAndSaveFile(String url, String fileName) async {<br/>    var directory = await getApplicationDocumentsDirectory();<br/>    var filePath = '${directory.path}/$fileName';<br/>    var response = await http.get(url);<br/>    var file = File(filePath);<br/>    await file.writeAsBytes(response.bodyBytes);<br/>    return filePath;<br/>  }</span><span id="6169" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;int&gt; getPendingNotificationCount() async {<br/>    List&lt;PendingNotificationRequest&gt; p =<br/>        await flutterLocalNotificationsPlugin.pendingNotificationRequests();<br/>    return p.length;<br/>  }</span><span id="4e7a" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; cancelNotification() async {<br/>    await flutterLocalNotificationsPlugin.cancel(0);<br/>  }</span><span id="4ec1" class="nd lq iq mz b gy nk nf l ng nh">Future&lt;void&gt; cancelAllNotification() async {<br/>    await flutterLocalNotificationsPlugin.cancelAll();<br/>  }<br/>}</span><span id="69ac" class="nd lq iq mz b gy nk nf l ng nh">NotificationPlugin notificationPlugin = NotificationPlugin._();</span><span id="acf2" class="nd lq iq mz b gy nk nf l ng nh">class ReceivedNotification {<br/>  final int id;<br/>  final String title;<br/>  final String body;<br/>  final String payload;</span><span id="1637" class="nd lq iq mz b gy nk nf l ng nh">ReceivedNotification({<br/>    <a class="ae ni" href="http://twitter.com/required" rel="noopener ugc nofollow" target="_blank">@required</a> this.id,<br/>    <a class="ae ni" href="http://twitter.com/required" rel="noopener ugc nofollow" target="_blank">@required</a> this.title,<br/>    <a class="ae ni" href="http://twitter.com/required" rel="noopener ugc nofollow" target="_blank">@required</a> this.body,<br/>    <a class="ae ni" href="http://twitter.com/required" rel="noopener ugc nofollow" target="_blank">@required</a> this.payload,<br/>  });<br/>}</span></pre><p id="6c88" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">你可以用flutter通知插件做很多其他的事情。这些是你将经常使用的基本材料。</p><p id="1e57" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">原来如此。</p><p id="023e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请在下面留下您的宝贵意见。</p><p id="8ae9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">谢了。</p></div></div>    
</body>
</html>