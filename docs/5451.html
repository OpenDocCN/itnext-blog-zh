<html>
<head>
<title>Lithops, a Multi-cloud Serverless Programming Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Lithops，一个多云无服务器编程框架</h1>
<blockquote>原文：<a href="https://itnext.io/lithops-a-multi-cloud-serverless-programming-framework-fd97f0d5e9e4?source=collection_archive---------2-----------------------#2021-03-09">https://itnext.io/lithops-a-multi-cloud-serverless-programming-framework-fd97f0d5e9e4?source=collection_archive---------2-----------------------#2021-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b59c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">无服务器计算的兴起</em></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/73db5b3bdce025836c20c02c383b684b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7qjIrJ2E-8hXYlFF"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">照片由<a class="ae lc" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯里德</a>在<a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="0470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出人意料的是，无服务器计算的兴起也间接启动了云中大规模数据并行的民主化。从这个意义上说，<strong class="jp ir"> Lithops </strong>是第一个受益于使用无服务器计算优势的计算框架，比如即时资源供应和可伸缩性。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ld"><img src="../Images/004c4ee615b6ff54f619f0234899deef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iqJwE1DfeoJ4dnnqLtGoUw.png"/></div></div></figure><p id="067f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，<strong class="jp ir"> Lithops可以被定义为一个强大的多云工具包，它允许透明地将本地、多进程、python应用程序扩展到云中的大量资源中。Lithops使生成成百上千个任务的任务变得简单，从开始到执行一个大型任务只需几秒钟。从这个意义上来说，Lithops可以被看作是一个动态的作业编排器，经过优化可以在一个无服务器的计算平台上运行作业。</strong></p><p id="d848" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lithops是一个开源项目，可以在Github 上获得。</p><div class="le lf gp gr lg lh"><a href="https://github.com/lithops-cloud/lithops" rel="noopener  ugc nofollow" target="_blank"><div class="li ab fo"><div class="lj ab lk cl cj ll"><h2 class="bd ir gy z fp lm fr fs ln fu fw ip bi translated">石质云/石质</h2><div class="lo l"><h3 class="bd b gy z fp lm fr fs ln fu fw dk translated">Lithops是一个Python多云分布式计算框架。它允许在…上运行未修改的本地python代码</h3></div><div class="lp l"><p class="bd b dl z fp lm fr fs ln fu fw dk translated">github.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv kw lh"/></div></div></a></div><p id="1947" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">为什么选择Lithops？</strong>与传统计算框架的一个关键区别是，Lithops不需要集群供应和管理的繁琐任务。相反，Lithops利用公开可用的无服务器计算平台，如<strong class="jp ir"> AWS Lambda </strong>、<strong class="jp ir"> Google Cloud Run </strong>或<strong class="jp ir"> IBM Cloud Functions </strong>(等等)，来运行应用程序。使用无服务器计算平台的主要好处之一是，它们可以在几秒钟内提供巨大的CPU能力和内存，只需为您使用它们的确切时间付费。</p><p id="9d0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是如何工作的？Lithops获取本地定义的函数、类和变量，并将它们传输到云中。这发生在运行时，也就是你在计算机上运行应用程序的时候。在后台，它通常使用一个对象存储服务(如S3自动气象站)来存储这些信息和其他中间数据。在任何情况下，Lithops将用户的代码和数据交付到云中，而不需要了解它如何部署和运行到无服务器平台中。从这个意义上说，Lithops消除了大多数阻碍部署、打包和任务执行的障碍，这些障碍抑制了大多数用户轻松进入云。从用户的角度来看，就好像你在电脑上运行应用程序一样。</p><p id="c75c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">它适合在哪里？</strong>当今无服务器平台的无状态特性使得Lithops非常适合运行以下作业:超参数优化、对象存储数据(预)处理、搜索和处理日志、大数据分析、蒙特卡罗模拟、基因组分析、网页抓取、模型评分等。所有这些应用都体现了Lithops将单机代码计算扩展到云中数千个内核的能力。非常重要的是，不需要引导冷集群或为临时任务保留热集群。</p><h1 id="01db" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">蜜蜂石蛾</h1><p id="c86b" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">在高层，Lithops附带了两个不同的<strong class="jp ir">计算API</strong>，允许与底层计算平台交互，抽象出管理和使用这些服务的复杂性。这些API是<strong class="jp ir">未来API </strong>和<strong class="jp ir">多重处理API </strong>。此外，Lithops提供了一个<strong class="jp ir">存储API </strong>，允许与存储后端进行交互，以一种简单的方式管理数据(上传/下载/移动/删除)。</p><p id="5ed0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Futures API: </strong> Lithops实现了一个类似于<a class="ae lc" href="https://docs.python.org/3/library/concurrent.futures.html" rel="noopener ugc nofollow" target="_blank">内置python<em class="kl">concurrent . Futures</em>库</a>的API。这个API基于名为<em class="kl"> Futures </em>的对象，当Lithops产生一个函数时创建。有了这个<em class="kl">未来</em>对象，就有可能访问结果和一些关于执行的统计数据。例如，我们可以使用<em class="kl"> call_async() </em> API方法只生成一个函数，并通过管理生成的<em class="kl"> Future </em>来获得结果:</p><pre class="kn ko kp kq gt mz na nb bn nc nd bi"><span id="2d68" class="ne lx iq na b be nf ng l nh ni">from lithops import FunctionExecutor<br/><br/>def hello(name):<br/>    return f'Hello {name}!'<br/><br/>with FunctionExecutor() as fexec:<br/>    future = fexec.call_async(hello, 'World')<br/>    print(future.result())</span></pre><p id="bebc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">多处理API: </strong> Lithops实现了大部分的<a class="ae lc" href="https://docs.python.org/3/library/multiprocessing.html" rel="noopener ugc nofollow" target="_blank">内置python <em class="kl">多处理</em>库</a>方法和抽象，用熟悉的API在云端运行任务。例如，我们可以创建一个<em class="kl"> pool() </em>并使用<em class="kl"> map() </em>方法为可迭代列表中的每个条目生成一个函数:</p><pre class="kn ko kp kq gt mz na nb bn nc nd bi"><span id="1281" class="ne lx iq na b be nf ng l nh ni">from lithops.multiprocessing import Pool<br/><br/>def double(i):<br/>    return i * 2<br/><br/>if __name__ == "__main__":<br/>    with Pool() as pool:<br/>        result = pool.map(double, [1, 2, 3, 4, 5])<br/>        print(result)</span></pre><p id="f723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">存储API: </strong>存储API使得用类似于<a class="ae lc" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> python boto3库</a>的简单API方法操作存储后端变得容易。存储API与计算API相结合，提供了前所未有的灵活性，可以向云运行任务，如大数据分析或其他涉及数据分析或管理的应用程序。例如，我们可以使用存储API将文件从我们的计算机上传到云存储服务，然后从使用<em class="kl"> call_async() </em>方法生成的函数中获取该文件:</p><pre class="kn ko kp kq gt mz na nb bn nc nd bi"><span id="407b" class="ne lx iq na b be nf ng l nh ni">from lithops import FunctionExecutor, Storage<br/><br/>BUCKET = 'my-bucket'<br/><br/>def get_file(key, storage):<br/>    return storage.get_object(bucket=BUCKET, key=key))<br/><br/>if __name__ == "__main__":<br/>    storage = Storage()<br/>    storage.put_object(bucket=BUCKET, key='test.txt', body='Hello World')<br/>    <br/>    with FunctionExecutor() as fexec:<br/>        fut = fexec.call_async(get_file, 'test.txt')<br/>        print(fut.result())</span></pre><h1 id="4d89" class="lw lx iq bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">多云无服务器编程</h1><p id="c23e" class="pw-post-body-paragraph jn jo iq jp b jq mu js jt ju mv jw jx jy mw ka kb kc mx ke kf kg my ki kj kk ij bi translated">Lithops遵循一个基本原则；<strong class="jp ir">编写一次随处运行。</strong>从一开始，Lithops就被设计成一个可扩展的框架，它引用可用的<strong class="jp ir">后端</strong>来执行应用程序。在这个意义上，Lithops提供了对大量云提供商、无服务器平台(<em class="kl">计算后端</em>)和存储服务(<em class="kl">存储后端</em>)的支持。</p><p id="c6c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可用的云提供商列表包括<strong class="jp ir"> IBM Cloud </strong>、<strong class="jp ir"> AWS </strong>、<strong class="jp ir">微软Azure </strong>、<strong class="jp ir">谷歌云</strong>和<strong class="jp ir">阿里云</strong>。在这些云提供商内部，你可以利用他们的<strong class="jp ir"> <em class="kl">功能即服务(FaaS) </em> </strong>平台，比如<strong class="jp ir"> AWS Lambda </strong>、<strong class="jp ir"> IBM Cloud Functions </strong>或者<strong class="jp ir"> Google Cloud Functions </strong>来运行应用。此外，Lithops还支持<strong class="jp ir"> <em class="kl">无服务器容器服务</em> </strong>像<strong class="jp ir"> IBM代码引擎</strong>和<strong class="jp ir"> Google Cloud Run </strong>。关于存储，Lithops主要支持这些云提供商提供的<strong class="jp ir"><em class="kl"/></strong>对象存储服务，如<strong class="jp ir"> AWS S3 </strong>和<strong class="jp ir"> IBM云存储</strong>。</p><p id="b63c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了支持这些公共云提供商，Lithops还允许使用<strong class="jp ir"> Kubernetes </strong>或<strong class="jp ir">本地集群</strong>运行应用程序。从这个意义上来说，Lithops允许使用<strong class="jp ir"> kubernetes </strong> <strong class="jp ir">批处理/作业API、</strong>或使用<strong class="jp ir"> <em class="kl">开源无服务器平台</em> </strong>，如<strong class="jp ir"> Knative </strong>或<strong class="jp ir">open whish</strong>来运行作业。在这种情况下，关于存储，Lithops可以使用服务的<em class="kl">定制/私有</em>安装，如<strong class="jp ir"> OpenStack Swift </strong>、<strong class="jp ir"> Redis </strong>、<strong class="jp ir"> Ceph </strong>或<strong class="jp ir"> Infinispan </strong></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nj"><img src="../Images/f33d580aebbc600c438301969ce7f43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*04xKRsml3ur4ap7MPkOisQ.jpeg"/></div></div></figure><p id="27f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Lithops，你可以编写一个应用程序，并在任何云或计算后端不加修改地运行它。为此，只需创建一个配置文件，并按照配置说明设置所需的计算和存储服务。一旦创建了配置文件，Lithops将开始在云中运行作业。如果您配置了多个计算或存储后端，则可以通过编辑配置文件中的<em class="kl">默认计算后端</em>和<em class="kl">默认存储后端</em>来切换应用程序的执行，而无需更改代码中的任何内容。例如，下一个代码将在任何已配置的云或后端上不明显地运行。</p><pre class="kn ko kp kq gt mz na nb bn nc nd bi"><span id="1673" class="ne lx iq na b be nf ng l nh ni">from lithops import FunctionExecutor<br/><br/>def double(i):<br/>    return i * 2<br/><br/>if __name__ == "__main__":<br/>    fexec = FunctionExecutor()<br/>    fexec.map(double, [1, 2, 3, 4])<br/>    print(fexec.get_result())</span></pre><p id="7c96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，为了更加灵活，Lithops允许在代码中指定在哪里运行应用程序。从这个意义上说，我们可以在同一个脚本中利用多个计算后端。例如，查看下一个代码，它将运行<strong class="jp ir"> AWS Lambda </strong>中的一个作业和<strong class="jp ir"> IBM Cloud Functions </strong>中的一个作业，然后等待所有结果同时就绪。</p><pre class="kn ko kp kq gt mz na nb bn nc nd bi"><span id="ec11" class="ne lx iq na b be nf ng l nh ni">from lithops import FunctionExecutor<br/>from lithops import get_result<br/><br/><br/>def double(i):<br/>    return i * 2<br/><br/>if __name__ == '__main__':<br/>    fexec_aws = FunctionExecutor(backend='aws_lambda', storage='aws_s3')<br/>    futures_aws = fexec_aws.map(double, [1, 2, 3, 4])<br/><br/>    fexec_ibm = FunctionExecutor(backend='ibm_cf', storage='ibm_cos')<br/>    futures_ibm = fexec_ibm.map(double, [5, 6, 7, 8])<br/><br/>    print(get_result(futures_aws + futures_ibm))</span></pre></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="9593" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，使用Lithops，您可以使用熟悉的API来受益于使用无服务器平台的所有优势，例如<strong class="jp ir">无服务器管理</strong>、<strong class="jp ir">降低成本、</strong>以更细粒度的方式为用户使用的服务器资源付费、<strong class="jp ir">即时可伸缩性</strong>以及<strong class="jp ir">快速部署</strong>和更新。此外，它的<strong class="jp ir">多云不可知架构</strong>确保跨云提供商的可移植性，<strong class="jp ir">克服供应商锁定</strong>。</p><p id="8992" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lithops是一个具有更多功能的扩展框架，更多详情请查看<a class="ae lc" href="https://lithops-cloud.github.io/docs/" rel="noopener ugc nofollow" target="_blank"> Lithops用户指南</a>。</p><p id="ac67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">开始用Lithops对云编程吧！</strong></p></div></div>    
</body>
</html>