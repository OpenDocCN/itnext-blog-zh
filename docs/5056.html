<html>
<head>
<title>Building Your Home Raspberry PI Kubernetes Cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您的家庭树莓PI Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/building-your-home-raspberry-pi-kubernetes-cluster-14eeeb3c521e?source=collection_archive---------0-----------------------#2020-11-29">https://itnext.io/building-your-home-raspberry-pi-kubernetes-cluster-14eeeb3c521e?source=collection_archive---------0-----------------------#2020-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ad25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有Kubernetes的粉丝吗？我在工作和私人项目中运行它已经有一段时间了，但有时我需要一个地方来快速开发和测试新功能，而不会产生额外的成本，或者只是运行我的家庭娱乐、备份、文件共享和kettle。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/e464e18b5ce07b2edc44dc5ec657d658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCtgSpjwj5R7BSAk99fibA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">还有几个节点在路上，集群几乎准备好了。</figcaption></figure><h1 id="c840" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">使用的硬件(黑色星期五价格</strong> 🥳 <strong class="ak"> ) </strong></h1><ul class=""><li id="0b63" class="mc md it js b jt me jx mf kb mg kf mh kj mi kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07TC2BK1X" rel="noopener ugc nofollow" target="_blank">四个覆盆子酱4B 4GB(每个50个)</a></li><li id="6ada" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07FCMKK5X" rel="noopener ugc nofollow" target="_blank">四张128 GB U3存储卡(每张15张)</a></li><li id="9f3b" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B07MJ9ZMDM/" rel="noopener ugc nofollow" target="_blank">一个多USB电源(20 ) </a></li><li id="4901" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated"><a class="ae mn" href="https://www.amazon.co.uk/gp/product/B085ZJQMXF/" rel="noopener ugc nofollow" target="_blank">一个机架箱用于多个Pi(15)</a></li><li id="0736" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">值得一提的是:散热器、4根USB-B转USB-C电缆</li></ul><h1 id="c81e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">为什么是树莓派？</h1><p id="731c" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">TL；DR:成本与处理能力。</p><p id="38a5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">4节点群集提供4个(1.5Ghz、4核ARM cpu和4 GB RAM)，即16个1.5 Ghz内核和16 GB RAM。我算过了，集群的总体成本仍然比类似的处理能力/节点云产品便宜。不多说…</p><h1 id="af20" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">存储卡准备</strong></h1><p id="8591" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">从下载操作系统开始，它将完成繁重的工作。我每天大部分时间都在与docker和Kubernetes一起工作，我的任何一个爱好都是将docker图像精简到绝对最小——这大部分是由于Alpine Linux实现的——因此我将我的集群基于这种精确的分布。</p><p id="3489" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前往<a class="ae mn" href="https://alpinelinux.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Alpine Linux下载</a>部分，为您的Raspberry Pi 4 Model B选择AARCH64版本。</p><p id="3ac6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同时，让我们准备存储卡，首先用FAT32文件系统格式化它。我是OSX人，所以使用下面的命令来获取你的存储卡的磁盘标识符</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="9039" class="nb lf it mx b gy nc nd l ne nf">diskutil list</span></pre><p id="d20e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">按照它来格式化整个内存卡——我把我的内存卡叫做<strong class="js iu"> RPI </strong></p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="1e89" class="nb lf it mx b gy nc nd l ne nf">sudo diskutil eraseDisk FAT32 RPI MBRFormat /dev/diskX</span></pre><p id="e7f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将下载的Alpine linux软件包解压到存储卡上</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="1035" class="nb lf it mx b gy nc nd l ne nf">sudo tar xf alpine-rpi-3.12.1-aarch64.tar.gz -C /Volumes/RPI</span></pre><h1 id="c495" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">基础系统配置</strong></h1><p id="ce47" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">恭喜你，你离自己客厅里的kubernetes世界又近了一步。将存储卡滑动到您的Raspberry Pi、显示器(或电视)以及键盘中，然后打开电源。系统启动并要求您登录后，使用<strong class="js iu"> root </strong>作为用户名和密码。</p><p id="c09d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行以下命令启动设置过程。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b2b6" class="nb lf it mx b gy nc nd l ne nf">setup-alpine</span></pre><p id="6afa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我在家里运行我的集群，由于可用的路由器端口越来越少，我决定使用WiFi网络。你将选择的选项没有太大的区别——但是要明智地选择。</p><p id="6597" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成设置后，您还需要做一些事情。默认情况下，Alpine从RAM运行，但是我们希望我们的更改在磁盘上以及潜在的重新启动之间保持不变。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="10a7" class="nb lf it mx b gy nc nd l ne nf">apk update<br/>apk add cfdisk e2fsprogs # Install disk tools<br/>cfdisk /dev/mmcblk0      # Run cfdisk on your memory card</span></pre><p id="552b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在此步骤中，您需要:</p><ul class=""><li id="5a8f" class="mc md it js b jt ju jx jy kb ng kf nh kj ni kn mj mk ml mm bi translated">将FAT32分区的大小调整到合理的最小值——在我的例子中，我给了它1GB。</li><li id="bc7a" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">使用所有剩余的可用空间创建新的可引导分区。</li><li id="7ee5" class="mc md it js b jt mo jx mp kb mq kf mr kj ms kn mj mk ml mm bi translated">别忘了写下你刚刚做的修改。</li></ul><p id="e443" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有用教程:<a class="ae mn" href="https://www.thegeekdiary.com/understanding-linux-cfdisk-utility/" rel="noopener ugc nofollow" target="_blank">如何使用cfdisk？</a></p><p id="87ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在只需要执行几个命令就可以完成整个过程。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3f36" class="nb lf it mx b gy nc nd l ne nf">mkfs.ext4 /dev/mmcblk0p2  # Format newly created partition as EXT4<br/>mount /dev/mmcblk0p2 /mnt # Mount it<br/>setup-disk -m sys /mnt    # Install system files<br/>mount -o remount,rw /media/mmcblk0p1 # Remount old partition in RW</span><span id="e96e" class="nb lf it mx b gy nj nd l ne nf"># Let's do some housekeeping <br/>rm -f /media/mmcblk0p1/boot/*  <br/>cd /mnt<br/>rm boot/boot<br/>mv boot/* /media/mmcblk0p1/boot/  <br/>rm -Rf boot<br/>mkdir media/mmcblk0p1<br/>ln -s media/mmcblk0p1/boot boot</span></pre><p id="e4ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新<code class="fe nk nl nm mx b">/etc/fstab</code>记录</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="c3ab" class="nb lf it mx b gy nc nd l ne nf">echo "/dev/mmcblk0p1 /media/mmcblk0p1 vfat defaults 0 0" &gt;&gt; etc/fstab<br/>sed -i '/cdrom/d' etc/fstab<br/>sed -i '/floppy/d' etc/fstab<br/>cd /media/mmcblk0p1</span></pre><p id="4801" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">系统重启后的最后接触—请记住，如果没有启用适当的cgroups，kubeadm步骤将会失败。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="2e43" class="nb lf it mx b gy nc nd l ne nf"># Enable edge repository for Alpine <br/>sed -i '/edge/s/^#//' /mnt/etc/apk/repositories<br/># Force use of new partition as the root one<br/>sed -i 's/^/root=\/dev\/mmcblk0p2 /' /media/mmcblk0p1/cmdline.txt<br/># Make sure that appropriate cgroups are enabled<br/>echo "cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1" &gt;&gt; /media/mmcblk0p1/cmdline.txt<br/>sed -i ':a;N;$!ba;s/\n/ /g' /media/mmcblk0p1/cmdline.txt</span><span id="5164" class="nb lf it mx b gy nj nd l ne nf">rc-update add wpa_supplicant boot # Make sure your wifi will come back up after restart</span></pre><p id="cc81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，在完成上述所有步骤后，真正重要的事情是备份您刚才所做的更改并重启系统</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3292" class="nb lf it mx b gy nc nd l ne nf">lbu_commit -d<br/>reboot</span></pre><h1 id="e239" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">系统配置的其余部分</h1><p id="1898" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我提到过，我打算在家庭环境中使用这个kubernetes集群——在你问之前——它也可以在办公室网络中工作，尽管——我们应该添加一些额外的东西</p><p id="35a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">在本地网络中宣布主机名— avahi守护进程</strong></p><p id="57e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为什么是这一步？与试图找到正确的IP地址相比，<code class="fe nk nl nm mx b">ssh pi0.local</code>要容易得多。它还将使您的连接和集群配置更加容易，尤其是当您不能依赖静态IP时。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="69cd" class="nb lf it mx b gy nc nd l ne nf">apk add dbus avahi<br/>rc-update add dbus boot   # avahi won't start without dbus<br/>rc-update add avahi-daemon boot</span></pre><p id="3ff3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">允许ssh作为根用户访问</strong></p><p id="cb82" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编辑<code class="fe nk nl nm mx b">/etc/ssh/sshd_config</code>文件——向其中添加下面一行，以便能够以root用户身份访问ssh。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="e137" class="nb lf it mx b gy nc nd l ne nf">PermitRootLogin yes</span></pre><p id="dd56" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">安装docker、kubernetes和您稍后需要的其余软件包</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b2d5" class="nb lf it mx b gy nc nd l ne nf">apk update<br/>apk add kubernetes docker cni-plugins kubelet kubeadm<br/>rc-update add docker default<br/>rc-update add kubelet default</span></pre><h1 id="04de" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">小帮手说:你可以省力气了</h1><p id="386b" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">在这个阶段，你应该为你的旅行做好一切准备。我利用这个机会关掉了我的Raspberry Pi，把存储卡带回我的笔记本电脑，并创建了一个卡的图像，这样我就可以在剩余的三张卡上恢复它，从而节省时间。<br/>记住为每个新重新创建的机器更改<code class="fe nk nl nm mx b">/etc/hostname</code>内容，以避免冲突。我选择了<code class="fe nk nl nm mx b">pi0, pi1, pi2</code>,以便更容易记忆(并在我的本地ssh配置中使用),尽管没有限制。</p><h1 id="2e85" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建您的kubernetes大师</h1><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="a8a4" class="nb lf it mx b gy nc nd l ne nf">service docker start<br/>kubeadm config images pull   # Get the necessary images<br/>kubeadm init --pod-network-cidr=10.244.0.0/16</span></pre><p id="1228" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您看到任何停止初始化过程的与cgroups相关的错误——您之前错过了其中一个步骤，否则您应该会看到以“您的Kubernetes控制平面已成功初始化”开始的消息！`.</p><p id="b3a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">将来自输出</strong>(以<code class="fe nk nl nm mx b">kubeadm join</code>开头的那个)的命令保存在安全的地方。您将需要它来允许剩余的节点加入您的集群。</p><p id="0ae2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行以下命令将凭据存储在您的主目录中</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="630f" class="nb lf it mx b gy nc nd l ne nf">mkdir -p $HOME/.kube<br/>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></pre><h1 id="ff60" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">如何访问节点？</h1><p id="0b5f" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">我已经将<code class="fe nk nl nm mx b">$HOME/.kube/config</code>的内容从节点复制到我的本地机器上，更改了一些默认值以避免潜在的冲突。多亏了这个，我可以在我的笔记本电脑上使用像<code class="fe nk nl nm mx b">kubectl</code>或<code class="fe nk nl nm mx b">k9s</code>这样的工具，并确保我总能找到正确的服务器。</p><h1 id="1420" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">主人跑了，还能做什么？</h1><p id="1caa" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">豆荚之间的网络——没有它，你的节点将永远保持感染和未就绪状态。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="e662" class="nb lf it mx b gy nc nd l ne nf">kubectl apply -f <a class="ae mn" href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></span></pre><p id="2532" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">默认情况下，您不能在主节点上部署任何东西</strong>，节点显示为已感染，但是不要担心——我们可以用这个命令来改变它</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="72f8" class="nb lf it mx b gy nc nd l ne nf">kubectl taint nodes --all node-role.kubernetes.io/master-</span></pre><p id="d17b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">仪表板。你遇到过说“我不喜欢仪表盘”的人吗？Kubernetes有自己的、相当通用的仪表板，可以让您很好地了解您的集群(以及其中的任何内容)。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="49e1" class="nb lf it mx b gy nc nd l ne nf"><em class="nn"># Add kubernetes-dashboard repository</em><br/>helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/<br/><em class="nn"># Deploy a Helm Release named "kubernetes-dashboard" using the kubernetes-dashboard chart</em><br/>helm install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --set protocolHttp=true,ingress.enabled=true,rbac.create=true,serviceAccount.create=true,service.externalPort=9090,networkPolicy.enabled=true,podLabels.app=dashboard</span></pre><p id="3933" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你所注意到的，我在舵图设置中增加了一些额外的东西，但这是有原因的。</p><p id="e93c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的仪表板将会启动并运行，但是..它不会显示任何东西。缺少权限。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="d186" class="nb lf it mx b gy nc nd l ne nf">kubectl create clusterrolebinding kubernetes-dashboard --clusterrole=cluster-admin --serviceaccount=default:kubernetes-dashboard</span></pre><p id="0259" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好吧。我们快到了。我们有主节点，我们有仪表板，但我们目前无法访问它。我们可能会使用节点端口来公开dashboard，但这不是我们的方式——要像kubernetes那样做，我们需要一个负载平衡器。Node在我们的本地网络中运行，所以我们不能指望AWS或GoogleCloud提供任何好处，但恐怕不行——有办法对付它。</p><h1 id="9d75" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">家庭网络中的负载平衡</h1><p id="fa6e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">根据清单遵循<a class="ae mn" href="https://metallb.universe.tf/installation/" rel="noopener ugc nofollow" target="_blank">金属LB </a>上的安装步骤，直到<strong class="js iu">安装结束。</strong></p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3621" class="nb lf it mx b gy nc nd l ne nf">ifconfig wlan0 promisc    # Set PROMISC mode for WiFi - for ARP</span></pre><p id="499b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只要您保持Pi运行，上面的命令就会生效。为了避免创建启动脚本，我决定编辑<code class="fe nk nl nm mx b">/etc/network/if-up.d/dad</code>来设置界面出现时的promisc模式。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="2000" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将以下清单创建为my-dashboard.yaml</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="9e6c" class="nb lf it mx b gy nc nd l ne nf">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  namespace: metallb-system<br/>  name: config<br/>data:<br/>  config: |<br/>    address-pools:<br/>    - name: default<br/>      protocol: layer2<br/>      addresses:<br/>      - 192.168.50.200-192.168.50.250<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: k8s-dashboard<br/>  annotations:<br/>    metallb.universe.tf/address-pool: default<br/>spec:<br/>  ports:<br/>  - port: 80<br/>    targetPort: 9090<br/>  selector:<br/>    app: dashboard<br/>  type: LoadBalancer</span></pre><p id="ff50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不要忘记更改地址部分，以符合您的本地网络设置。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b331" class="nb lf it mx b gy nc nd l ne nf">kubectl apply -f my-dashboard.yaml<br/>kubectl get svc k8s-dashboard </span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/9a31cd128089099eb774fff123974db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ei4FWmcaGCH5M31xDw2JTg.png"/></div></div></figure><p id="6808" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从现在起，您可以通过(对我而言)<a class="ae mn" href="http://192.168.50.200/" rel="noopener ugc nofollow" target="_blank"> http://192.168.50.200/ </a>访问您的仪表板</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/f1359afd11e26edd523c98bcb336c78d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klWWDB8X3mvfdKYX2cW0xw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">树莓Pi供电的k8s集群。</figcaption></figure><p id="6078" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">文章由《周六奋斗》、《红牛》和《实验之爱》提供动力。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ns"><img src="../Images/9e3cf62512dba3b4c67c2ba7e4073d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bz9wkFT-8DaZCM7BtNbdg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">K9S提供的集群单元概述</figcaption></figure><h1 id="4257" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">添加其他节点</h1><p id="99f0" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mt kd ke kf mu kh ki kj mv kl km kn im bi translated">当我们干(不要重复自己)吻(保持愚蠢的简单)-滚动到文章的开头，并遵循所有步骤，直到“<em class="nn">在新创建的节点上创建您的kubernetes主节点</em>，然后执行以下操作(记住用您的主节点ip替换IP地址-或者它的主机名(pi0.local，感谢avahi守护进程)</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b099" class="nb lf it mx b gy nc nd l ne nf">service docker start<br/>kubeadm config images pull<br/>kubeadm join 192.168.50.132:6443 --token dugwjt.0k3n \--discovery-token-ca-cert-hash sha256:55cfadHelloSuperSecretHashbf4970f49dcadf533f86e3dba</span></pre><p id="b720" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">提示:如果您在创建主节点的过程中忘记了复制kubeadm命令，我会帮助您——在主节点上执行下面的命令会再次为您打印出来</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="8df7" class="nb lf it mx b gy nc nd l ne nf">kubeadm token create --print-join-command</span></pre><p id="d6fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">既然你设法读完了所有内容，你应该知道……</strong></p><p id="cff8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">截至Pi日(3月14日)的更新:</strong>我刚刚发表了另一篇文章，带有自动化集群设置— <a class="ae mn" href="https://blog.raczylo.com/i-broke-my-kubernetes-cluster-running-on-raspberry-pi-355234a24d" rel="noopener ugc nofollow" target="_blank">“我在Raspberry Pi上中断了我的Kubernetes集群运行”</a>，包含了整个代码库。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7b9a10c97f98642e0d0b22b231fa4783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*OhCO08D9oIzb5ksZ6XSF9Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">圆周率日快乐！</figcaption></figure></div></div>    
</body>
</html>