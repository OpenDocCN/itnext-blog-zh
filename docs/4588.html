<html>
<head>
<title>How to Build and Deploy Serverless Functions to Netlify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在网络中构建和部署无服务器功能</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-and-deploy-serverless-functions-to-netlify-d37418f6f7be?source=collection_archive---------2-----------------------#2020-07-31">https://itnext.io/how-to-build-and-deploy-serverless-functions-to-netlify-d37418f6f7be?source=collection_archive---------2-----------------------#2020-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f3fa21135137132a816c3a81ccbab44d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vS-74Ky6wwHHbIMjKVzwuw.png"/></div></div></figure><h1 id="9480" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">介绍</h1><p id="a92b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">将代码功能的各个部分分离出来，使之独立于其他部分工作，这是一个很好的软件工程实践。因为您的代码基本上是由函数组成的，所以无服务器函数允许您部署这些函数，而不需要管理服务器来运行它们。</p><p id="446d" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在本教程中，我们将学习什么是无服务器函数，如何编写它们，以及如何在几分钟内将它们部署到Netlify上。我们还将涉及无服务器功能的其他用途。</p><h1 id="e133" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">什么是无服务器功能？</h1><p id="8155" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">无服务器功能是托管在云基础设施上的功能，并且执行单一目的。只要它有自己的依赖项并能独立运行，它就和你写的其他函数非常相似。它是无服务器的，因为它减轻了您维护服务器和扩展功能的压力。</p><p id="0408" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">Netlify 使得编写任何后端任务变得非常容易，并且只需简单的步骤就可以独立地或与项目一起部署它。如果与GitHub库链接，您的功能也可以通过一个简单的<code class="fe md me mf mg b">git push</code>命令来部署。这些功能被称为<a class="ae mc" href="https://www.netlify.com/products/functions/" rel="noopener ugc nofollow" target="_blank">网络功能</a>。</p><p id="06e8" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">无服务器函数就像API端点一样工作</p><h1 id="b481" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们构建我们的无服务器函数</h1><h1 id="0a36" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">创建项目文件夹</h1><p id="f06f" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">手动或通过运行<code class="fe md me mf mg b">mkdir custom-netlify-functions</code>创建一个空文件夹。你想用什么名字就用什么名字。这里我使用“自定义网络功能”。</p><h1 id="3f9b" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">用GitHub设置CI/CD</h1><h2 id="6526" class="mh kc it bd kd mi mj dn kh mk ml dp kl lk mm mn kp lo mo mp kt ls mq mr kx ms bi translated">用GitHub初始化repo</h2><ul class=""><li id="8d13" class="mt mu it lb b lc ld lg lh lk mv lo mw ls mx lw my mz na nb bi translated">换到文件夹<code class="fe md me mf mg b">cd custom-netlify-functions</code></li><li id="f2b1" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">创建一个<a class="ae mc" href="http://readme.md" rel="noopener ugc nofollow" target="_blank"> readme.md </a>文件<code class="fe md me mf mg b">touch readme.md</code></li><li id="de18" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">运行<code class="fe md me mf mg b">git init</code>用Git库初始化文件夹</li><li id="3775" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">运行<code class="fe md me mf mg b">git add . &amp;&amp; git commit -m "initial commit"</code>添加文件并提交更改。</li><li id="61e1" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">去<a class="ae mc" href="http://github.com/new" rel="noopener ugc nofollow" target="_blank">github.com/new</a>，创建一个新的回购协议——最好是同名的</li><li id="e8a4" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">将本地存储库与远程存储库链接起来，如下所示:<code class="fe md me mf mg b">git remote add origin git@github.com:YourGithubName/your-repo-slug.git</code></li><li id="7332" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">运行<code class="fe md me mf mg b">git push -u origin master</code>来推送你的文件</li></ul><h2 id="597f" class="mh kc it bd kd mi mj dn kh mk ml dp kl lk mm mn kp lo mo mp kt ls mq mr kx ms bi translated">安装Netlify CLI</h2><p id="1ec0" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我们将使用Netlify CLI，因为它使我们的项目启动和运行变得非常容易<code class="fe md me mf mg b">npm install -g netlify-cli</code></p><h2 id="0735" class="mh kc it bd kd mi mj dn kh mk ml dp kl lk mm mn kp lo mo mp kt ls mq mr kx ms bi translated">初始化文件夹中的网络生活</h2><p id="7b3b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">如果您没有netlify帐户，请<a class="ae mc" href="https://app.netlify.com/signup" rel="noopener ugc nofollow" target="_blank">现在创建一个</a></p><p id="2b87" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在文件夹内，运行<code class="fe md me mf mg b">netlify init</code>用netlify初始化文件夹。</p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/acc9652d33c20f5da977df872799320d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NjYyimjeFZOrjkvO"/></div></div></figure><p id="63b9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">提示符会问你“你想做什么？”，选择“创建和配置新站点”。此选项在您的netlify帐户上创建一个新站点。</p><p id="7eee" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">如果您已经通过验证，它会要求您选择您的团队(Netlify帐户)。如果你还没有在<a class="ae mc" href="http://netlify.com" rel="noopener ugc nofollow" target="_blank">netlify.com</a>上认证，它会打开一个浏览器，要求你输入登录凭证。</p><p id="1028" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">下一个提示将询问您的网站名称，以及您是否愿意通过Github进行认证。对于站点名称，保留与“custom-netlify-functions”相同的名称，并使用Github进行验证</p><p id="b4ec" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">这一步将您的Netlify帐户和repo与您刚刚在GitHub上创建的帐户连接起来。</p><p id="9803" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">下一个提示。对于“您的构建命令”，只需按回车键。对于要部署到的目录，也要按回车键来使用“.”(当前目录)。</p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/11531819776ec47546d673afd106fb87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mTla75-TIf7KVvCk"/></div></div></figure><h1 id="03dc" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们编码</h1><p id="1bcb" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">为我们的配置创建一个netlify.toml文件，并在其中编写以下代码:</p><pre class="ni nj nk nl gt nn mg no np aw nq bi"><span id="0c6f" class="mh kc it mg b gy nr ns l nt nu">[build]<br/>    functions = "functions"</span></pre><p id="b2fe" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">这段代码告诉Netlify它可以在“functions”文件夹中找到我们的函数</p><p id="39f3" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">创建一个<code class="fe md me mf mg b">functions</code>文件夹，我们将在其中编写我们的函数</p><p id="9316" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">在<em class="nv">功能</em>文件夹中，创建一个名为hello.js的文件</p><p id="19f5" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">您可以通过使用一个以您的文件名结尾的URL来访问您的无服务器功能。所以，每个函数都以<name-of-file>结束(没有。js)</name-of-file></p><p id="0176" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">将被调用的无服务器函数必须被命名为<code class="fe md me mf mg b">handler</code>,它采用以下格式的3个参数:</p><pre class="ni nj nk nl gt nn mg no np aw nq bi"><span id="101a" class="mh kc it mg b gy nr ns l nt nu">//hello.js<br/>exports.handler = function (event, context, callback) {</span><span id="6006" class="mh kc it mg b gy nw ns l nt nu">}</span></pre><ul class=""><li id="05f0" class="mt mu it lb b lc lx lg ly lk nx lo ny ls nz lw my mz na nb bi translated"><code class="fe md me mf mg b">event</code>参数包含所有标题、查询参数和发布数据</li><li id="fc68" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated"><code class="fe md me mf mg b">context</code>参数提供了关于调用无服务器函数的上下文的信息，比如某些用户信息。</li><li id="0b66" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">调用这个无服务器函数时，调用<code class="fe md me mf mg b">callback</code>(可选)参数以返回响应。</li></ul><p id="2fc3" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">回调函数可以返回错误(第一个参数)或响应对象，如下所示:</p><pre class="ni nj nk nl gt nn mg no np aw nq bi"><span id="56f2" class="mh kc it mg b gy nr ns l nt nu">callback(null, {<br/>    "isBase64Encoded": true|false,<br/>    "statusCode": httpStatusCode,<br/>    "headers": { "headerName": "headerValue", ... },<br/>    "body": "..."<br/>})</span></pre><p id="cd45" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">回到我们的hello.js函数，像这样更新。我们就用“Hello World”返回一个对象吧。</p><pre class="ni nj nk nl gt nn mg no np aw nq bi"><span id="6785" class="mh kc it mg b gy nr ns l nt nu">exports.handler = function (event, context, handler) {<br/>    callback(null, { <br/>       statusCode: 200, <br/>        body: "Hello World" <br/>    });<br/>}</span></pre><h1 id="039e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们在本地运行我们的函数</h1><p id="05bd" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">从您的终端运行<code class="fe md me mf mg b">netlify dev</code>或<code class="fe md me mf mg b">ntl dev</code>。</p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/28e37952112cfda3f0701408df3c63dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9LMHXKTNDUrxJuQM"/></div></div></figure><blockquote class="ob oc od"><p id="dc72" class="kz la nv lb b lc lx le lf lg ly li lj oe lz lm ln of ma lq lr og mb lu lv lw im bi translated"><em class="it">要在浏览器中访问您的无服务器功能，请使用URL: </em> <code class="fe md me mf mg b"><em class="it">&lt;host_url&gt;/.netlify/functions/&lt;function_file_name&gt;</em></code></p></blockquote><p id="b3ee" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">通过我们的hello.js应用程序，请访问:<code class="fe md me mf mg b"><a class="ae mc" href="http://localhost:888/.netlify/functions/hello" rel="noopener ugc nofollow" target="_blank">http://localhost:888/.netlify/functions/hello</a></code></p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/db83c09db4b988a50d78a76f9c67833d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5G0H8TqL51S68GNG"/></div></div></figure><p id="18f6" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">…就是这样。我们的网络功能。</p><h1 id="baca" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">让我们将无服务器功能部署到生产中</h1><p id="3a71" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">Netlify使得只需一个命令就可以非常容易地部署到生产环境中。</p><p id="51e9" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">请记住，我们已经将本地回购链接到了GitHub，还从GitHub向我们的Netlify帐户发送了CI/CD。只需运行命令:</p><ul class=""><li id="60ac" class="mt mu it lb b lc lx lg ly lk nx lo ny ls nz lw my mz na nb bi translated"><code class="fe md me mf mg b">git add . &amp;&amp; git commit -m "created the first serverless function "</code></li><li id="754e" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated"><code class="fe md me mf mg b">git push</code>这将我们的代码提交并推送到GitHub，由Netlify自动获取并部署。</li></ul><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/020f8d3490ea708675bd64342c5c1554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O1moz1kAWVham2a-"/></div></div></figure><p id="bac2" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">或者，如果您想直接推送至Netlify。或者您没有设置CI/CD，请使用以下命令:</p><ul class=""><li id="ab88" class="mt mu it lb b lc lx lg ly lk nx lo ny ls nz lw my mz na nb bi translated">运行<code class="fe md me mf mg b">netlify deploy</code>部署到草稿</li><li id="56e4" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">运行<code class="fe md me mf mg b">netlify deploy --prod</code>部署到生产</li></ul><figure class="ni nj nk nl gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/c1df401da45859c4911d368398b03e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VJDD2HUP5H-Xh_Df"/></div></div></figure><p id="5b9b" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">就是这样。无服务器函数(Netlify函数)可以做后端API能做的任何事情。</p><h1 id="bfec" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">无服务器功能的示例:</h1><ul class=""><li id="8646" class="mt mu it lb b lc ld lg lh lk mv lo mw ls mx lw my mz na nb bi translated">执行身份验证</li><li id="e63d" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">使用任何邮件服务器API发送电子邮件</li><li id="dfca" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">处理付款</li><li id="0a07" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">上传文件</li><li id="861f" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">连接到外部API以执行其他功能</li><li id="188a" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated">连接到数据库以执行CRUD操作</li></ul><p id="6e4f" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">…还有更多</p><h1 id="a5db" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">资源</h1><ul class=""><li id="fda9" class="mt mu it lb b lc ld lg lh lk mv lo mw ls mx lw my mz na nb bi translated"><a class="ae mc" href="https://docs.netlify.com/functions/overview/" rel="noopener ugc nofollow" target="_blank">网络功能</a></li><li id="6fee" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated"><a class="ae mc" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank">网络生活</a></li><li id="699c" class="mt mu it lb b lc nc lg nd lk ne lo nf ls ng lw my mz na nb bi translated"><a class="ae mc" href="https://functions.netlify.com/examples/" rel="noopener ugc nofollow" target="_blank">更多网络功能示例代码</a></li></ul><p id="4a0e" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated">如果你觉得这篇文章有帮助，请留言。如果你有任何困难或问题或更好的方式来写这篇文章或更多的见解，请在LinkedIn的<a class="ae mc" href="https://twitter.com/hellotunmbi" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae mc" href="https://github.com/hellotunmbi" rel="noopener ugc nofollow" target="_blank"> Github </a>或<a class="ae mc" href="https://linkedin.com/in/hellotunmbi" rel="noopener ugc nofollow" target="_blank"> Connect上联系我</a></p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="190b" class="pw-post-body-paragraph kz la it lb b lc lx le lf lg ly li lj lk lz lm ln lo ma lq lr ls mb lu lv lw im bi translated"><em class="nv">原发布于</em><a class="ae mc" href="https://hellotunmbi.hashnode.dev/how-to-build-and-deploy-serverless-functions-to-netlify-ckda8hxvz00qqnns13n1h0t0f" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://hello tumbi . hashnode . dev</em></a><em class="nv">。</em></p><figure class="ni nj nk nl gt ju gh gi paragraph-image"><a href="https://www.buymeacoffee.com/hellotunmbi"><div class="gh gi or"><img src="../Images/a629679250bd54970466aa64242e8f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*vzHMBQN2v_dshzof9eJZEQ.png"/></div></a></figure></div></div>    
</body>
</html>