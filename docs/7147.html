<html>
<head>
<title>Upgrade Cert-Manager for Your Production Deployment Without Downtime</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为您的生产部署升级Cert-Manager，无需停机</h1>
<blockquote>原文：<a href="https://itnext.io/upgrade-cert-manager-for-your-production-deployment-without-downtime-ee5d32fabec8?source=collection_archive---------1-----------------------#2022-06-26">https://itnext.io/upgrade-cert-manager-for-your-production-deployment-without-downtime-ee5d32fabec8?source=collection_archive---------1-----------------------#2022-06-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cbe44513bae4adf260a4fc2cfeb3691b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rLeWZJao4lwW_JjY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kc" href="https://unsplash.com/@briangb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Brian Scott </a>拍照</figcaption></figure><h1 id="1201" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是证书管理器？</h1><p id="1cd3" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><a class="ae kc" href="https://cert-manager.io/docs/" rel="noopener ugc nofollow" target="_blank"> Cert-Manager </a>是Kubernetes和OpenShift最广泛采用的云本地证书管理解决方案之一。它简化了从各种来源获取、更新和使用证书的过程，包括著名的非营利认证机构“让我们加密”。为了方便证书管理过程，Cert-Manager添加了许多相关对象，如证书、证书请求和发行者等。，作为定制资源类型，由Kubernetes集群中的<a class="ae kc" href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" rel="noopener ugc nofollow" target="_blank"> CRDs(定制资源定义)</a>定义。</p><p id="7528" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">将Cert-Manager升级到新版本时，通常需要更新这些CRD的定义。不幸的是，这不是一个简单的过程。当问题出现时，您通常必须完全卸载Cert-Manager来解决问题，这会导致生产部署中的停机事件。</p><p id="5e25" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">在本文中，我们将讨论一些确保Cert-Manager顺利升级以避免生产部署停机的选项。</p><h1 id="0eaf" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">推荐的安装/设置选项</h1><p id="bbd1" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">许多选项可用于在您的集群上部署全新的Cert-Manager安装。然而，在升级或出现问题时，并不是每个选项都有很大帮助。如果您要部署一个新的安装，您可能要考虑我推荐的安装/设置选项，以便将来升级和维护。您还将从以下几节中了解更多关于其背后的原因。</p><ul class=""><li id="41b0" class="me mf iq ld b le lz li ma lm mg lq mh lu mi ly mj mk ml mm bi translated"><a class="ae kc" href="https://cert-manager.io/docs/installation/helm/" rel="noopener ugc nofollow" target="_blank">使用</a> <code class="fe mn mo mp mq b"><a class="ae kc" href="https://cert-manager.io/docs/installation/helm/" rel="noopener ugc nofollow" target="_blank">kubectl</a></code> <a class="ae kc" href="https://cert-manager.io/docs/installation/helm/" rel="noopener ugc nofollow" target="_blank">手动安装所需的CRD，并使用Helm </a> <br/>安装Cert-Manager-确保<code class="fe mn mo mp mq b">--enable-certificate-owner-ref</code>标志未设置为真。该标志的默认值为false。然而，如果你在你的helm配置中设置它为true，当相关的Cert-Manager自定义<code class="fe mn mo mp mq b">Certificate</code>资源被删除时，包含X.509证书的<code class="fe mn mo mp mq b">Secret</code>对象将被自动删除。这可能会导致重新安装过程中不必要的停机。</li><li id="fc3b" class="me mf iq ld b le mr li ms lm mt lq mu lu mv ly mj mk ml mm bi translated"><a class="ae kc" href="https://cert-manager.io/docs/usage/certificate/" rel="noopener ugc nofollow" target="_blank">手动创建Cert-Manager自定义</a> <code class="fe mn mo mp mq b"><a class="ae kc" href="https://cert-manager.io/docs/usage/certificate/" rel="noopener ugc nofollow" target="_blank">Certificate</a></code> <a class="ae kc" href="https://cert-manager.io/docs/usage/certificate/" rel="noopener ugc nofollow" target="_blank"> </a>资源，而不是通过添加<a class="ae kc" href="https://cert-manager.io/docs/usage/ingress/" rel="noopener ugc nofollow" target="_blank"> ingress-shim </a>监视的注释来保护您的<code class="fe mn mo mp mq b">Ingress</code>资源。<br/> - <code class="fe mn mo mp mq b">Certificate</code>通过入口填充程序为入口创建的资源将具有指向入口资源的所有者引用。当您必须重新创建您的<code class="fe mn mo mp mq b">Ingress</code>资源时，例如为了迁移到新的集群，此所有者引用将是不正确的。创建/管理没有入口填充的<code class="fe mn mo mp mq b">Certificate</code>资源将省去修复这个潜在问题的麻烦。</li></ul><h1 id="d5d8" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">备份证书管理器资源</h1><p id="384d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">为了避免停机，理想情况下，我们应该尝试升级现有的Cert-Manager安装。但是，在获得新版本的安装以正常工作之前，您总是有可能必须删除当前的安装。发生这种情况时，备份现有的Cert-Manager资源将非常有助于恢复现有的设置并避免停机。</p><p id="c3ca" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要备份所有必要的Cert-Manager配置资源，您可以运行:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="c49a" class="ne ke iq mq b gy nf ng l nh ni">kubectl get --all-namespaces -oyaml issuer,clusterissuer,cert &gt; backup.yaml</span></pre><p id="2074" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">该命令将备份您可能在集群中创建的<code class="fe mn mo mp mq b">Issuer</code>、<code class="fe mn mo mp mq b">ClusterIssuer</code>和<code class="fe mn mo mp mq b">Certificate</code>资源。</p><blockquote class="nj nk nl"><p id="1907" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">请注意，如果您使用ingress-shim自动创建<code class="fe mn mo mp mq b">Certificate</code>资源，您应该从备份中排除<code class="fe mn mo mp mq b">Certificate</code>资源。否则，<code class="fe mn mo mp mq b"><em class="iq">Certificate</em></code>资源的错误所有者引用将导致配置同步问题。即<code class="fe mn mo mp mq b">Ingress</code>的任何更新都不会应用到<code class="fe mn mo mp mq b">Certificate</code>。</p></blockquote><p id="149f" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要在没有<code class="fe mn mo mp mq b">Certificate</code>资源的情况下进行备份，您可以改为运行以下命令:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="9154" class="ne ke iq mq b gy nf ng l nh ni">kubectl get --all-namespaces -oyaml issuer,clusterissuer &gt; backup.yaml</span></pre><p id="34d4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">除了Cert-Manager配置资源之外，您还需要备份包含X.509证书的<code class="fe mn mo mp mq b">Secret</code>资源:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="f2a5" class="ne ke iq mq b gy nf ng l nh ni">kubectl -n [namespace] get secret [secret name] -oyaml &gt; secret-bak.yaml </span></pre><p id="fdd4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">这里，<code class="fe mn mo mp mq b">[namespace]</code>是包含<code class="fe mn mo mp mq b">Secret</code>的名称空间，<code class="fe mn mo mp mq b">[secret name]</code>是<code class="fe mn mo mp mq b">Secret</code>资源的名称。</p><p id="214c" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">除了包含已颁发的X.509证书的<code class="fe mn mo mp mq b">Secret</code>资源之外，如果您正在将数据传输到新的集群，您可能还需要跨您已配置的颁发者引用的其他秘密资源进行复制。更多信息可在<a class="ae kc" href="https://cert-manager.io/docs/tutorials/backup/#backup" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="2814" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">如何使用您的备份</h1><p id="db2d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">当事情出错时，如果<code class="fe mn mo mp mq b">Secret</code>资源由于任何原因丢失，您应该总是首先恢复<code class="fe mn mo mp mq b">Secret</code>资源。这应该在您尝试恢复任何<code class="fe mn mo mp mq b">Issuer</code>、<code class="fe mn mo mp mq b">ClusterIssuer</code>、<code class="fe mn mo mp mq b">Certificate</code>或<code class="fe mn mo mp mq b">Ingress</code>资源之前发生，以避免触发可能导致停机的不必要的证书重新颁发。</p><p id="8b74" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要恢复<code class="fe mn mo mp mq b">Secret</code>资源，您可以运行:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="f137" class="ne ke iq mq b gy nf ng l nh ni">kubectl apply -f secret-bak.yaml</span></pre><p id="c695" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要恢复证书管理器配置资源，您可以运行:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="f854" class="ne ke iq mq b gy nf ng l nh ni">kubectl apply -f &lt;(awk '!/^ *(resourceVersion|uid): [^ ]+$/' backup.yaml)</span></pre><blockquote class="nj nk nl"><p id="2004" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated"><code class="fe mn mo mp mq b">awk</code>命令将删除不需要恢复的<code class="fe mn mo mp mq b">uid</code>和<code class="fe mn mo mp mq b">resourceVersion</code>字段。</p></blockquote><h1 id="4557" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">验证“- enable-certificate-owner-ref”标志</h1><p id="28ec" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在升级您现有的Cert-Manager安装之前，您应该确保在您当前的部署中没有将<code class="fe mn mo mp mq b">--enable-certificate-owner-ref</code>标志设置为true。否则，当<code class="fe mn mo mp mq b">Certificate</code>资源由于任何原因被删除时，包含已颁发的X.509证书的<code class="fe mn mo mp mq b">Secret</code>资源也将被删除，这在大多数情况下会导致停机。</p><p id="81d7" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">该标志的默认值为false。但是，如果在您当前的部署中将该标志设置为true，您应该在将Cert-Manager升级到较新版本之前，更改您的部署配置，将该标志设置回false。</p><h1 id="ef13" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">升级证书管理器资源API版本</h1><p id="7d6e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">如果需要将Cert-Manager升级到1.6版或更高版本，必须首先升级现有Cert-Manager资源的API版本。最简单的选择是使用<a class="ae kc" href="https://cert-manager.io/docs/usage/cmctl" rel="noopener ugc nofollow" target="_blank"/><code class="fe mn mo mp mq b"><a class="ae kc" href="https://cert-manager.io/docs/usage/cmctl" rel="noopener ugc nofollow" target="_blank">cmctl</a></code><a class="ae kc" href="https://cert-manager.io/docs/usage/cmctl" rel="noopener ugc nofollow" target="_blank">CLI工具。</a>你可以从<a class="ae kc" href="https://github.com/cert-manager/cert-manager/releases" rel="noopener ugc nofollow" target="_blank">发布页面</a>为你的系统下载二进制文件。</p><p id="64b4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">安装完<code class="fe mn mo mp mq b">cmctl</code> CLI工具后，您可以运行以下命令来升级集群中现有的Cert-Manager资源API版本。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="7dbb" class="ne ke iq mq b gy nf ng l nh ni">cmctl upgrade migrate-api-version --qps 5 --burst 10</span></pre><p id="bd2d" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated"><code class="fe mn mo mp mq b">cmctl</code>还附带了<a class="ae kc" href="https://cert-manager.io/docs/usage/cmctl/#convert" rel="noopener ugc nofollow" target="_blank">一个转换工具</a>，允许你将保存的Cert-Manager资源清单文件(例如之前生成的备份文件)转换成较新的版本。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="d682" class="ne ke iq mq b gy nf ng l nh ni">cmctl convert -f cert.yaml</span></pre><h1 id="e102" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">升级CRD定义</h1><p id="4a9e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">升级现有Cert-Manager安装的第一步是升级已安装的CRD定义。您可以:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="894f" class="ne ke iq mq b gy nf ng l nh ni">kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/&lt;version&gt;/cert-manager.yaml</span></pre><blockquote class="nj nk nl"><p id="b0de" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">这里，<version>是你打算升级的版本。例如<code class="fe mn mo mp mq b">v1.8.2</code></version></p></blockquote><h1 id="3777" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">升级证书管理器</h1><p id="2604" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">升级CRD定义后，您可以将Cert-Manager helm图表升级到您计划升级的版本。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="f550" class="ne ke iq mq b gy nf ng l nh ni">helm upgrade --namespace &lt;namespace&gt; --version &lt;version&gt; &lt;release_name&gt; jetstack/cert-manager</span></pre><blockquote class="nj nk nl"><p id="8440" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">这里，<namespace>是证书管理器部署名称空间。<version>是您计划升级到的版本。例如<code class="fe mn mo mp mq b">1.8.2</code>(没有起始字母<code class="fe mn mo mp mq b">v</code>)。&lt;发布名称&gt;是你的头盔部署发布名称。</version></namespace></p></blockquote><p id="8aa7" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">您可以使用<code class="fe mn mo mp mq b">cmctl</code> CLI来<a class="ae kc" href="https://cert-manager.io/docs/installation/verify/#check-cert-manager-api" rel="noopener ugc nofollow" target="_blank">验证升级后的安装</a>:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="f5c1" class="ne ke iq mq b gy nf ng l nh ni">$ cmctl check api</span><span id="04d6" class="ne ke iq mq b gy nq ng l nh ni">The cert-manager API is ready</span></pre><h1 id="cc68" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">强制续订证书</h1><p id="123b" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">您可以使用<code class="fe mn mo mp mq b">cmctl</code> CLI工具检查现有证书的状态:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="0e5c" class="ne ke iq mq b gy nf ng l nh ni">cmctl status certificate [cert name]</span></pre><p id="e795" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如果您在升级后卡住了证书续订顺序，您可以使用<code class="fe mn mo mp mq b">cmctl</code> CLI工具强制续订证书:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="c3b2" class="ne ke iq mq b gy nf ng l nh ni">cmctl renew [cert name]</span></pre><h1 id="3b46" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">当事情出错时</h1><p id="90f3" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，您应该检查Cert-Manager控制器pod的日志，以消除任何明显的配置错误。例如，不正确的集群颁发者<a class="ae kc" href="https://cert-manager.io/docs/configuration/acme/" rel="noopener ugc nofollow" target="_blank"> ACME </a>凭证。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="24e2" class="ne ke iq mq b gy nf ng l nh ni">kubectl -n [namespace] logs cert-manager-xxxxxxxxxx-xxxxx</span></pre><blockquote class="nj nk nl"><p id="f443" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">这里，[名称空间]是证书管理器部署名称空间，而“证书管理器-xxxxxxxxxx-xxxxx”是其中一个证书管理器控制器盒的名称。</p></blockquote><p id="caf8" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">然而，您总是有可能无法确定当前安装的根本原因。发生这种情况时，您可能需要完全删除Cert-Manger安装，并在集群中重新安装。</p><h1 id="024f" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">删除证书管理器安装</h1><p id="7cdb" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">要重新安装Cert-Manager，您需要首先完全删除当前安装。只要不删除包含已颁发的X.509证书的<code class="fe mn mo mp mq b">Secret</code>资源，这不一定会导致应用程序停机。这就是为什么我们需要确保您的安装的<code class="fe mn mo mp mq b">--enable-certificate-owner-ref</code>标志没有设置为true，以确保删除<code class="fe mn mo mp mq b">Certificate</code>资源不会删除<code class="fe mn mo mp mq b">Secret</code>资源。</p><p id="4bd4" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">要删除cert-manager安装，我们必须首先确保所有Cert-Manager资源都已删除。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="348b" class="ne ke iq mq b gy nf ng l nh ni">kubectl get Issuers,ClusterIssuers,Certificates,CertificateRequests,Orders,Challenges --all-namespaces</span></pre><p id="bd42" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">删除所有这些资源后，您可以通过以下方式卸载Cert-Manager:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="942c" class="ne ke iq mq b gy nf ng l nh ni">helm --namespace &lt;namespace&gt; delete &lt;release_name&gt;</span></pre><blockquote class="nj nk nl"><p id="9588" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">这里，<namespace>是证书管理器部署名称空间。<release_name>是cert-manager helm chart部署发布名称。</release_name></namespace></p></blockquote><p id="2a1d" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">如果您当前的安装不是使用Helm安装的，您也可以使用<code class="fe mn mo mp mq b">kubectl</code> CLI工具删除安装。</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="e159" class="ne ke iq mq b gy nf ng l nh ni">kubectl delete -f https://github.com/cert-manager/cert-manager/releases/download/vX.Y.Z/cert-manager.yaml</span></pre><blockquote class="nj nk nl"><p id="1b4a" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">给你，vX。Y.Z是您当前的安装版本。例如v1.8.2</p></blockquote><p id="8a10" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">最后，我们需要删除安装的所有CRD定义:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="7441" class="ne ke iq mq b gy nf ng l nh ni">kubectl delete -f https://github.com/cert-manager/cert-manager/releases/download/vX.Y.Z/cert-manager.crds.yaml</span></pre><blockquote class="nj nk nl"><p id="c4b4" class="lb lc nm ld b le lz lg lh li ma lk ll nn mb lo lp no mc ls lt np md lw lx ly ij bi translated">这里，` vX.Y.Z '是已安装版本的版本。例如v1.8.2</p></blockquote><h1 id="665b" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">重新安装证书管理器</h1><p id="3978" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">一旦现有的Cert-Manager安装被完全删除，我们可以通过推荐的安装选项继续安装新版本的Cert-Manager。以前生成的证书管理器配置资源备份可用于恢复以前的设置。</p><p id="a02e" class="pw-post-body-paragraph lb lc iq ld b le lz lg lh li ma lk ll lm mb lo lp lq mc ls lt lu md lw lx ly ij bi translated">恢复所有资源后，我们可以使用前面介绍的<code class="fe mn mo mp mq b">cmctl</code> CLI工具来验证安装，并在必要时强制更新任何现有证书。</p><h1 id="23f9" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="d473" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">Cert-Manager是针对Kubernetes和OpenShift的优秀云原生证书管理解决方案。然而，升级现有的Cert-Manager安装并不简单。本文介绍了帮助平稳升级的一般过程。为了防止任何意外问题导致安装不正常，本文还讨论了如何在重新安装过程中避免停机。</p></div></div>    
</body>
</html>