<html>
<head>
<title>Learning to add git hook tasks: PHP-CS-Fixer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习添加git钩子任务:PHP-CS-Fixer</h1>
<blockquote>原文：<a href="https://itnext.io/learning-to-add-git-hook-tasks-php-cs-fixer-41f34d99aa8a?source=collection_archive---------2-----------------------#2019-05-22">https://itnext.io/learning-to-add-git-hook-tasks-php-cs-fixer-41f34d99aa8a?source=collection_archive---------2-----------------------#2019-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/77f6fe084fdea2f68e7321f98504649f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uuM_SXbOGvRVvVPVV9kHKA.jpeg"/></div></div></figure><div class=""/><p id="92ad" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">(我想知道我是否能把这个标题变得更古怪些？)</p><p id="8489" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们首先描述一下这项任务的各个部分，以及我们今天要做的事情。总体目标是这样的:</p><p id="773e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们希望我们所有的应用程序文件都符合特定的代码风格，因此为了减少强制执行的麻烦，我们希望使用PHP-CS-Fixer(【https://github.com/FriendsOfPHP/PHP-CS-Fixer】T4)。</p><p id="320e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，试图让整个团队总是记得在推送代码之前运行这一点就像放牧猫一样，所以我们也想让这成为提交过程的自动化部分。</p><p id="a464" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要害怕！下面我将向您展示的是一种利用git预提交钩子来设置这一切的方法。我们将这样做来设置PHP-CS-Fixer，但是很明显如何设置它来自动完成几乎任何事情。</p><p id="dddc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们首先使用一个干净的文件或框架(我将使用一个Laravel设置来处理这类事情)并用<code class="fe kx ky kz la b">git init</code>创建一个空的git存储库。(你可以随意使用现有的任何东西，只要你知道你在做什么。)不需要为此设置远程存储库——我们不会进行任何推送，只会提交。</p><p id="d286" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我讨厌那些“不在本文讨论范围之内”的教程，但是我不得不要求你先为你自己的作曲者(<a class="ae kw" href="https://getcomposer.org" rel="noopener ugc nofollow" target="_blank">https://getcomposer.org</a>)设置一些东西，然后引入PHP-CS-Fixer(<a class="ae kw" href="http://PHP-CS-Fixer" rel="noopener ugc nofollow" target="_blank">https://github.com/FriendsOfPHP/PHP-CS-Fixer</a>)包。</p><p id="ead1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PHP-CS-Fixer有很多选项和运行方式；我们将保持简单，只建立一个<code class="fe kx ky kz la b">.php_cs</code>文件并从我们的<code class="fe kx ky kz la b">vendor/bin</code>本地运行。所以把这个文件放在你的根目录下:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="65ff" class="lj lk jb la b gy ll lm l ln lo">&lt;?php // file ".php_cs"<br/><br/>use PhpCsFixer\Config;<br/>use Symfony\Component\Finder\Finder;<br/><br/>$finder = Finder::create()<br/>    -&gt;in(__DIR__)<br/>    -&gt;name('*.php')<br/>    -&gt;ignoreDotFiles(true)<br/>    -&gt;ignoreVCS(true);<br/><br/>return Config::create()<br/>    -&gt;setRules([<br/>        '@PSR2' =&gt; true,<br/>        'array_indentation' =&gt; true,<br/>        'array_syntax' =&gt; ['syntax' =&gt; 'short'],<br/>        'binary_operator_spaces' =&gt; true,<br/>        'blank_line_after_namespace' =&gt; true,<br/>        'blank_line_before_return' =&gt; true,<br/>        'braces' =&gt; true,<br/>        'class_definition' =&gt; true,<br/>        'method_chaining_indentation' =&gt; true,<br/>        'no_extra_consecutive_blank_lines' =&gt; true,<br/>        'no_multiline_whitespace_before_semicolons' =&gt; true,<br/>        'no_short_echo_tag' =&gt; true,<br/>        'no_spaces_around_offset' =&gt; true,<br/>        'no_unused_imports' =&gt; true,<br/>        'no_whitespace_before_comma_in_array' =&gt; true,<br/>        'not_operator_with_successor_space' =&gt; true,<br/>        'ordered_imports' =&gt; ['sortAlgorithm' =&gt; 'length'],<br/>        'trailing_comma_in_multiline_array' =&gt; true,<br/>        'trim_array_spaces' =&gt; true,<br/>        'single_quote' =&gt; true,<br/>    ])<br/>    -&gt;setFinder($finder);</span></pre><p id="8e52" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后从命令行运行<code class="fe kx ky kz la b">php vendor/bin/php-cs-fixer fix</code>。我相信，这是最简单的方式，可以让事情变得……呃，简单。如果有任何运行不正常的地方，请立即停止并确保修复它。这里有一篇来自<a class="lp lq ep" href="https://medium.com/u/3ede9289a22b?source=post_page-----41f34d99aa8a--------------------------------" rel="noopener" target="_blank">Billie Thompson</a>(<a class="ae kw" href="https://dev.to/purplebooth/coding-standards-in-php-using-php-cs-fixer" rel="noopener ugc nofollow" target="_blank">https://dev . to/purple boot/coding-standards-in-PHP-using-PHP-cs-fixer</a>)的优秀文章，它解释了关于这个工具做什么的更多信息，或者询问互联网上的好心人。</p><p id="fca8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，现在设置强制您的文件符合PSR-1和PSR-2(默认)。进入一个文件，做一些违背你对世界上一切美好事物的感觉的改变——比如说，在关键字<code class="fe kx ky kz la b">function</code>的同一行放一个左括号——然后运行这个程序，看看它是否已经被修复。神奇！再次清洗。</p><p id="9083" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">害怕自动乱码脚本化的东西的我会很乐意就此打住，在我的git commits上设置一个别名或其他东西，以确保我不会经常忘记运行它，但不管怎样，大多数时候都会忘记，并经常被抱怨。新的我将自动完成这项工作。</p><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/905dc7f6ceca7d5a7439ff964eac67fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/0*czmyFWRbZwt8vqCq.jpg"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk translated">旧的我，面临着写一个自动混乱的剧本的前景</figcaption></figure><p id="d9d5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我在开始时所说的，有无数种方法来做这种事情，但是我们要做的是使用一个叫做“Husky”(<a class="ae kw" href="https://libraries.io/npm/husky" rel="noopener ugc nofollow" target="_blank">https://libraries.io/npm/husky</a>)的<code class="fe kx ky kz la b">npm</code>包，它被设计成接入现有的Git挂钩(<a class="ae kw" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank">https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks</a>)。在你安装好哈士奇之后，我要你打开你的<code class="fe kx ky kz la b">.git/hooks</code>目录，然后……天哪，看看那些钩子文件！</p><p id="903e" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要担心——我们不会直接与他们合作。其中大部分是在安装Husky时创建的，node.js会知道需要做什么(如果你想打开预提交文件，你会看到Husky确实创建了它。)相反，我们将进入我们的<code class="fe kx ky kz la b">package.json</code>文件，给Husky我们想要的命令:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="1a89" class="lj lk jb la b gy ll lm l ln lo">"husky": {<br/>  "hooks": {<br/>    "pre-commit": "vendor/bin/php-cs-fixer fix &amp;&amp; git add ."<br/>  }<br/>},</span></pre><p id="2241" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="lw">注意命令中没有</em> <code class="fe kx ky kz la b"><em class="lw">php</em></code> <em class="lw">！</em></p><p id="7a39" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们来测试一下。回去把你之前用过的那个文件弄得难看一点，然后用<code class="fe kx ky kz la b">git status</code>快速检查一下，看看它是不是在等着上演。当你准备好了，不要用<code class="fe kx ky kz la b">git add .</code>；只需承诺:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="592e" class="lj lk jb la b gy ll lm l ln lo">git commit -m "Committing prettified version of file" </span></pre><p id="5639" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并再次检查状态。已经上演；该文件已经过清理，符合PSR标准。你做到了！</p><p id="bce7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我们通过管道传输了<code class="fe kx ky kz la b">git add .</code>——因为这是<em class="lw">预提交，</em>我们所做的是首先修复文件样式并暂存任何已更改的内容，<em class="lw">然后</em>提交所有内容。</p><p id="e90d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个例子遵循了我所能找到的最窄的工作路径，但是当你浏览Husky和Git钩子的文档时，你会发现几乎每一步都有定制的方法，直到你找到满足你需要的东西。</p><p id="d93b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望有所帮助！</p></div></div>    
</body>
</html>