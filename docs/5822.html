<html>
<head>
<title>Barcode Scanner in SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI中的条形码扫描仪</h1>
<blockquote>原文：<a href="https://itnext.io/barcode-scanner-in-swiftui-c6d5fc35cf60?source=collection_archive---------3-----------------------#2021-06-02">https://itnext.io/barcode-scanner-in-swiftui-c6d5fc35cf60?source=collection_archive---------3-----------------------#2021-06-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6b5f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">将条形码扫描仪集成到您的SwiftUI应用程序中</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc7cd78c3301987b9511981b0a7c2592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1w-HElyRDzamOAo9W6xTLQ.jpeg"/></div></div></figure><p id="c075" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">条形码无处不在，由于苹果广泛的框架，我们有一切使条形码处理成为一项简单的任务。</p><p id="c8ba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文提供了将条形码扫描纳入基于SwiftUI的iOS应用程序所需的一切。</p><p id="ffe3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">除了SwiftUI应用程序之外，本教程还使用了另外两个框架。</p><p id="7dcf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">首先是<strong class="kw iu"> AVFoundation </strong>，在苹果开发者文档中描述如下:</p><blockquote class="lq lr ls"><p id="3200" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">使用视听资产、控制设备摄像机、处理音频和配置系统音频交互。</p></blockquote><p id="8288" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其次，我们将使用<strong class="kw iu">愿景</strong>框架:</p><blockquote class="lq lr ls"><p id="dd58" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated">应用计算机视觉算法对输入图像和视频执行各种任务。</p></blockquote><p id="a3d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">本文将介绍连接所有相关类的所有步骤，以获得一个显示扫描条形码的SwiftUI应用程序。</p><p id="5fa6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">在这里</strong>  <strong class="kw iu">可以下载到</strong> <a class="ae lx" href="https://www.buymeacoffee.com/twissmueller/e/33853" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">带有全工作应用的Xcode-workspace。</strong></a></p><p id="bcf8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">查看运行中的应用程序:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h2 id="c444" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">应用架构</h2><p id="2737" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">首先，我将快速概述一下在这个应用程序中创建的所有类。</p><p id="cbc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">下面是一个显示所有相关元素的基本类图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl my"><img src="../Images/6484db51a27be677f833e9832facdec7.png" data-original-src="https://miro.medium.com/v2/format:webp/1*GhEanz3yE2xN2DsajjW2iw.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">应用程序结构</figcaption></figure><p id="0a5d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">App</code>:这是Xcode创建的基本应用程序模板，保持原样。</p><p id="45f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">ContentView</code>:持有显示条码扫描结果的<code class="fe nd ne nf ng b">ScannerView</code>和<code class="fe nd ne nf ng b">Text</code>。它有一个被传入<code class="fe nd ne nf ng b">ScannerView</code>的<code class="fe nd ne nf ng b">@State</code>-变量(见下文),当它改变时自动更新<code class="fe nd ne nf ng b">Text</code>。你一定会喜欢SwiftUI的。</p><p id="a078" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">ScannerView</code>:没有原生的SwiftUI来做我们想要的事情，因此我们需要在<code class="fe nd ne nf ng b">UIViewRepresentable</code>中包装一个<code class="fe nd ne nf ng b">UIView</code>来显示我们的摄像机视频馈送，正如我在文章<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/using-uiview-in-swiftui-ec4e2b39451b">“在SwiftUI中使用UIView和UIViewController”</a>中解释的那样。这个视图的任务是通过它的<code class="fe nd ne nf ng b">@Binding</code>-变量将扫描结果暴露给它的父视图。</p><p id="8f2c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">CameraView</code>:这就是我上面提到的被“扫描视图”包装的<code class="fe nd ne nf ng b">UIView</code>。它本身包装了一个<code class="fe nd ne nf ng b">AVCaptureVideoPreviewLayer</code>，这个层显示iPhone或iPad内置摄像头正在捕捉的内容。</p><p id="fee9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">Coordinator</code>:这个班级是<code class="fe nd ne nf ng b">UIViewRepresentable</code>的一部分，大部分事情都发生在这里。首先，我们请求相机许可，然后我们设置一个管道来获取相机输出，最后我们将它输入到执行条形码识别的代码中。</p><h2 id="93e7" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">询问相机用法</h2><p id="32dc" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">为了能够使用摄像机，需要首先在<code class="fe nd ne nf ng b">Info.plist</code>中设置“摄像机使用说明”。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl my"><img src="../Images/76fb80c11f6f71470e3d00abc80c401f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*qQ5RWPK-boo416A64AfmYQ.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">相机使用说明</figcaption></figure><p id="2aa9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">稍后，当应用程序第一次启动时，将弹出以下窗口，询问用户是否允许使用相机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl my"><img src="../Images/e727a63ebaa4efde8200cc3eba1bca92.png" data-original-src="https://miro.medium.com/v2/format:webp/1*QDZN9eNCk_09EPUc1XbSPw.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">请求拍摄许可</figcaption></figure><p id="fb72" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在代码中，我们请求允许</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="c5ce" class="ma mb it ng b gy nl nm l nn no">AVCaptureDevice.requestAccess(for: .video)`</span></pre><h2 id="b89b" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">设置摄像机馈送</h2><p id="e4a7" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">现在，我们可以访问摄像机，我们可以设置整个管道来获取视频帧，然后将这些视频帧输入算法，以提取条形码中的信息。</p><p id="7682" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些是我们需要的元素以及苹果公司提供的描述:</p><blockquote class="lq lr ls"><p id="46fa" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">AVCaptureDevice</code> -为捕获会话提供输入(如音频或视频)并为硬件特定的捕获功能提供控制的设备。</p><p id="36ad" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">AVCaptureDeviceInput</code>‌——从捕获设备向捕获会话提供媒体的捕获输入。</p><p id="eddd" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">AVCaptureSession</code> -管理捕获活动并协调从输入设备到捕获输出的数据流的对象。</p><p id="506c" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">AVCaptureVideoDataOutput</code> -记录视频并提供视频帧访问以进行处理的采集输出。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl my"><img src="../Images/c2c64b26ecd34cc529ddf903f5e80cea.png" data-original-src="https://miro.medium.com/v2/format:webp/1*e3858p0Pb7T7k3951rdcEg.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">加工流水线</figcaption></figure><p id="2cf0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">虽然<code class="fe nd ne nf ng b">AVCaptureSesssion</code>是负责收集和处理必要视频帧的中心，但我们最终感兴趣的是运行条形码检测算法的视频帧本身。</p><p id="3bfb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">AVCaptureVideoDataOutput</code>有一个接收采集输出和样本缓冲的代表。</p><p id="5814" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们的<code class="fe nd ne nf ng b">Coordinator</code>将通过继承<code class="fe nd ne nf ng b">AVCaptureVideoDataOutputSampleBufferDelegate</code>并实现<code class="fe nd ne nf ng b">captureOutput(_:didOutput:from:)</code>来充当这个委托。</p><h2 id="8baa" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">处理捕获的图像</h2><p id="12a5" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">为了接收条形码信息，还需要采取一个步骤:处理从手机摄像头接收的图像。</p><p id="69a5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有两个主要负责的类:</p><blockquote class="lq lr ls"><p id="4747" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">VNImageRequestHandler</code> -处理与单个图像相关的一个或多个图像分析请求的对象。</p><p id="0469" class="ku kv lt kw b kx ky ju kz la lb jx lc lu le lf lg lv li lj lk lw lm ln lo lp im bi translated"><code class="fe nd ne nf ng b">VNDetectBarcodesRequest</code> -在图像中查找和识别条形码的图像分析请求。</p></blockquote><p id="2f7c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">他们是这样合作的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl my"><img src="../Images/e593209eca5716b750a879d048bd6f6b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*At4kY3yNA6bhYjXsX81pXQ.png"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">处理条形码图像</figcaption></figure><p id="a196" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当实例化<code class="fe nd ne nf ng b">VNDetectBarcodesRequest</code>时，我们需要提供一个处理结果的处理器。</p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="6e63" class="ma mb it ng b gy nl nm l nn no">let request = VNDetectBarcodesRequest(completionHandler: self.barcodeRequestHandler)</span></pre><p id="758a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个处理程序然后接收观察到的结果，我们可以进一步处理并提取最终的<code class="fe nd ne nf ng b">String</code></p><pre class="kj kk kl km gt nh ng ni nj aw nk bi"><span id="deab" class="ma mb it ng b gy nl nm l nn no">func barcodeRequestHandler(request: VNRequest, error: Error?) {<br/>        guard let results = request.results as? [VNBarcodeObservation],<br/>              let payloadStringValue = results.last?.payloadStringValue else {<br/>            return<br/>        }<br/>        self.scanResult = payloadStringValue<br/>    }</span></pre><h2 id="b0bc" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">结论</h2><p id="89f6" class="pw-post-body-paragraph ku kv it kw b kx mt ju kz la mu jx lc ld mv lf lg lh mw lj lk ll mx ln lo lp im bi translated">在这篇文章中，我概述了创建一个SwiftUI-app来扫描条形码的必要条件。</p><p id="455b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">在这里</strong>  <strong class="kw iu">可以下载到Xcode-workspace的</strong> <a class="ae lx" href="https://www.buymeacoffee.com/twissmueller/e/33853" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">。</strong></a></p><p id="adfa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢您的阅读！</p><ul class=""><li id="8536" class="np nq it kw b kx ky la lb ld nr lh ns ll nt lp nu nv nw nx bi translated">如果你喜欢这个，请<a class="ae lx" href="https://twissmueller.medium.com/" rel="noopener">跟我上Medium </a></li><li id="6cfd" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">给我买杯咖啡让我继续前进</li><li id="cd90" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated">支持我和其他媒体作者<a class="ae lx" href="https://twissmueller.medium.com/membership" rel="noopener">在这里注册</a></li></ul><p id="89ac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lx" href="https://twissmueller.medium.com/membership" rel="noopener">https://twissmueller.medium.com/membership</a></p><h2 id="a9db" class="ma mb it bd mc md me dn mf mg mh dp mi ld mj mk ml lh mm mn mo ll mp mq mr ms bi translated">资源</h2><ul class=""><li id="7036" class="np nq it kw b kx mt la mu ld od lh oe ll of lp nu nv nw nx bi translated">AVFoundation </li><li id="2c30" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lx" href="https://developer.apple.com/documentation/vision" rel="noopener ugc nofollow" target="_blank">视觉</a></li><li id="9bcb" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lx" href="https://www.hackingwithswift.com/example-code/media/how-to-scan-a-barcode" rel="noopener ugc nofollow" target="_blank">如何扫描条形码</a></li><li id="23f4" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lx" href="https://medium.com/academy-eldoradocps/vision-framework-for-ios-an-introduction-78d02c3e1ef" rel="noopener">iOS愿景框架:基础知识</a></li><li id="8e65" class="np nq it kw b kx ny la nz ld oa lh ob ll oc lp nu nv nw nx bi translated"><a class="ae lx" href="https://www.barcode-generator.de/V2/en/index.jsp" rel="noopener ugc nofollow" target="_blank">在线条形码生成器</a></li></ul></div></div>    
</body>
</html>