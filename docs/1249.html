<html>
<head>
<title>How to receive PayPal webhooks on localhost</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在本地主机上接收PayPal webhooks</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-receive-paypal-webhooks-on-localhost-17c44f494bb3?source=collection_archive---------6-----------------------#2018-08-21">https://itnext.io/how-to-receive-paypal-webhooks-on-localhost-17c44f494bb3?source=collection_archive---------6-----------------------#2018-08-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b5485bf9b8b3bf6300a9d2cfc183bd8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSA3noKb1Q5V9iKgbO4hdQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马里乌斯·克里斯滕森在<a class="ae kc" href="https://unsplash.com/search/photos/mail?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d5e6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我想没有必要谈论贝宝和它变得多么有用。在这篇文章中，我们将用我最喜欢的语言Go编写一个小型web服务器来处理PayPal的webhooks。我将向您展示开始接收webhooks、开发您的应用程序并使用Webhook Relay调试它是多么容易。</p><p id="f5d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据PayPal webhook <a class="ae kc" href="https://developer.paypal.com/docs/integration/direct/webhooks/rest-webhooks/#" rel="noopener ugc nofollow" target="_blank">文档</a>:</p><blockquote class="lb lc ld"><p id="7d6b" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">Webhooks是接收事件通知消息的HTTP回调。要在PayPal创建一个webhook，用户需要配置一个webhook监听器，并为其订阅事件。webhook侦听器是一种服务器，它在特定的URL侦听事件发生时触发的传入HTTP POST通知消息。PayPal会对发送给你的webhook监听器的每条通知信息进行签名。</p></blockquote><p id="4de9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，没什么不寻常的或新的。Webhooks很重要——它们被用在几乎所有订阅模式的SaaS应用程序中。使用webhooks，您可以:</p><ul class=""><li id="2610" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">客户支付计划费用时启用/禁用功能。</li><li id="1c8d" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">通过电子邮件向您的客户发送计划更改确认。</li></ul><p id="fc23" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的目标是这样设置:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/f54b99ed20fd889e990c15f0b5c226a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxXUpm1YBSNdDu4v00tgTg.png"/></div></div></figure><p id="4bff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将让我们在本地主机上接收webhooks，就像我们在公共互联网上接收我们的服务器一样。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="3746" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">没时间解释了，让我们开始吧</h1><ul class=""><li id="cbcb" class="li lj iq kf b kg ng kk nh ko ni ks nj kw nk la ln lo lp lq bi translated">下载CLI并注册以获得您的密钥和机密。说明可以在<a class="ae kc" href="https://webhookrelay.com/v1/guide/#Getting-Started" rel="noopener ugc nofollow" target="_blank">这里</a>找到。如果你已经这样做了(我猜大多数人已经注册了)，你就可以进入下一步了！</li><li id="1bb0" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">下载并安装Go，说明<a class="ae kc" href="https://golang.org/doc/install" rel="noopener ugc nofollow" target="_blank">此处</a>。不像其他语言安装天文数字的软件包，使用Go你通常只需要几个助手包就可以了。</li><li id="9fdf" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">PayPal(这里可能不奇怪)——我们将使用<a class="ae kc" href="https://developer.paypal.com" rel="noopener ugc nofollow" target="_blank">开发者仪表板</a>。</li></ul><p id="1c9f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，创建一个webhook。转到<a class="ae kc" href="https://developer.paypal.com/developer/applications/" rel="noopener ugc nofollow" target="_blank"> PayPal仪表盘</a>并创建一个应用程序，然后选择您想要启用webhooks的应用程序:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/d0f55358f2107cabf0508bcf615ff71e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAvQ-1x78GtprMpsd3DNdw.png"/></div></div></figure><p id="4d68" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们得到我们的公共Webhook中继端点。假设我们未来的应用程序将在<a class="ae kc" href="http://localhost:8080/v1/paypal-webhooks" rel="noopener ugc nofollow" target="_blank"> <em class="le">上接受web hooks http://localhost:8080/v1/paypal-web hooks</em></a>，开始在那里转发它们:</p><pre class="lx ly lz ma gt nm nn no np aw nq bi"><span id="778a" class="nr mj iq nn b gy ns nt l nu nv">relay forward -b paypal <a class="ae kc" href="http://localhost:8080/v1/paypal-webhooks" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v1/paypal-webhooks</a></span></pre><p id="f1a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该会看到类似这样的内容:</p><pre class="lx ly lz ma gt nm nn no np aw nq bi"><span id="6032" class="nr mj iq nn b gy ns nt l nu nv">$ relay forward -b paypal <a class="ae kc" href="http://localhost:8080/v1/paypal-webhooks" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v1/paypal-webhooks</a><br/>Forwarding:<br/>https://my.webhookrelay.com/v1/webhooks/672d0c8f-b742-4a99-96c1-af4de65bc02a -&gt; <a class="ae kc" href="http://localhost:8080/v1/paypal-webhooks" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/v1/paypal-webhooks</a><br/>Starting webhook relay agent...<br/>1.5345938246082163e+09	info	webhook relay ready...	{"host": "my.webhookrelay.com:8080"}</span></pre><p id="37ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里我们可以看到<code class="fe nw nx ny nn b">https://my.webhookrelay.com/v1/webhooks/672d0c8f-b742-4a99-96c1-af4de65bc02a</code>(您将有一个不同的ID:)，这是我们可以提供给PayPal的公共端点:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/e65135d347264f5ecdc90016163893c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zr5D15qoOMkK8mLfFYjqRQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">PayPal webhook配置屏幕</figcaption></figure><p id="f8b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们勾选“所有事件”，因为我们现在真的不关心它，我们总是可以取消勾选框。滚动到底部，然后单击“保存”。</p><h1 id="7fb8" class="mi mj iq bd mk ml oa mn mo mp ob mr ms mt oc mv mw mx od mz na nb oe nd ne nf bi translated">我们走吧</h1><p id="0978" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko of kq kr ks og ku kv kw oh ky kz la ij bi translated">是时候写些围棋了。我开始写这篇文章的时候以为是关于PayPal的IPNs的，但结果是关于webhooks的，我会在后面写另一篇关于IPNs的文章。</p><p id="2b4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将创建一个包来处理我们的webhooks(完整的源代码在这里<a class="ae kc" href="https://github.com/webhookrelay/paypal-ipn" rel="noopener ugc nofollow" target="_blank">https://github.com/webhookrelay/paypal-ipn</a>，请随意克隆它)。</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="bf3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，放置应用程序逻辑的代码看起来像这样:</p><figure class="lx ly lz ma gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="8dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码可以在这里找到:<a class="ae kc" href="https://github.com/webhookrelay/paypal-ipn" rel="noopener ugc nofollow" target="_blank">https://github.com/webhookrelay/paypal-ipn</a>。要启动我们的应用程序，我们只需:</p><pre class="lx ly lz ma gt nm nn no np aw nq bi"><span id="6c92" class="nr mj iq nn b gy ns nt l nu nv">$ go run example/main.go<br/>2018/08/18 20:01:53 server starting on :8080</span></pre><p id="df0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在现实生活中，你可能想要使用<code class="fe nw nx ny nn b">go install</code>(让构建快很多)。</p><h1 id="2afd" class="mi mj iq bd mk ml oa mn mo mp ob mr ms mt oc mv mw mx od mz na nb oe nd ne nf bi translated">进入模拟</h1><p id="78cb" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko of kq kr ks og ku kv kw oh ky kz la ij bi translated">转到<strong class="kf ir">模拟</strong>部分下的web hooks模拟器。现在再次进入我们的公共Webhook中继端点，让我们选择“支付捕获完成”:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/c1a20754713b5b38aaf7b5df9f6cb7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UdLSyYZ5JkloQfMKxatedQ.png"/></div></div></figure><p id="7470" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击“发送测试”。</p><p id="b191" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">几秒钟后，我们应该会在我们的应用程序中看到已接收的webhook:</p><pre class="lx ly lz ma gt nm nn no np aw nq bi"><span id="bab2" class="nr mj iq nn b gy ns nt l nu nv">$ go run example/main.go<br/>2018/08/18 20:01:53 server starting on :8080<br/>2018/08/18 20:02:10 event type: PAYMENT.CAPTURE.COMPLETED<br/>2018/08/18 20:02:10 event resource type: capture<br/>2018/08/18 20:02:10 summary: Payment completed for $ 7.47 USD</span></pre><p id="6433" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">恭喜，我们刚刚赚了7.47美元！</p><p id="98b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不知道为什么，但有时他们会花更多的时间来发送那些虚拟的网页挂钩，所以如果你点击那个按钮后没有任何反应，就等一会儿。或者一旦你已经有了webhook中继，你可以从那里重试，它们会立即被转发。</p><h1 id="d4d6" class="mi mj iq bd mk ml oa mn mo mp ob mr ms mt oc mv mw mx od mz na nb oe nd ne nf bi translated">调试webhooks</h1><p id="e383" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko of kq kr ks og ku kv kw oh ky kz la ij bi translated">我们还可以在我们的buckets页面中看到所有通过Wehboook中继发送的webhooks:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/138a67679a5cb4d4cc18c6a79b0c3f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2-jjOr73kDx20q9nTKmlw.png"/></div></div></figure><p id="0e7f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以从这里检查并重新发送webhooks。这也是获得初始JSON结构并使用这个漂亮的网站将其转换为Go struct的好地方:<a class="ae kc" href="https://mholt.github.io/json-to-go/" rel="noopener ugc nofollow" target="_blank">https://mholt.github.io/json-to-go/</a>。</p><h1 id="0d0f" class="mi mj iq bd mk ml oa mn mo mp ob mr ms mt oc mv mw mx od mz na nb oe nd ne nf bi translated">包扎</h1><p id="ad29" class="pw-post-body-paragraph kd ke iq kf b kg ng ki kj kk nh km kn ko of kq kr ks og ku kv kw oh ky kz la ij bi translated">Webhook中继使得在本地主机或专用网络上接收web hook变得非常简单。如果您不想或不能将webhooks处理服务器暴露在互联网上，它不仅可以用于开发，也可以用于生产。</p><p id="63a4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你正在使用Stripe，请点击这里查看我之前的博文。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="adf8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="le">原载于2018年8月21日</em><a class="ae kc" href="https://webhookrelay.com/blog/2018/08/21/receiving-paypal-webhooks-localhost/" rel="noopener ugc nofollow" target="_blank"><em class="le">【webhookrelay.com</em></a><em class="le">。</em></p></div></div>    
</body>
</html>