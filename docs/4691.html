<html>
<head>
<title>How to Reduce Cost of SAM Artifact Storage using S3 Lifecycle Management &amp; Cloud Formation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用S3生命周期管理和云构建来降低SAM工件存储的成本</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-reduce-cost-of-sam-artifact-storage-using-s3-lifecyle-management-cloud-formation-4e18ef0cab1b?source=collection_archive---------3-----------------------#2020-08-24">https://itnext.io/how-to-reduce-cost-of-sam-artifact-storage-using-s3-lifecyle-management-cloud-formation-4e18ef0cab1b?source=collection_archive---------3-----------------------#2020-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4430d053cb146af3f914a0088b67f4ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AkUjzRrWKrYFe_uN.png"/></div></div></figure><p id="bf89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用AWS SAM时，您需要做的一件微妙的事情是将Lambda部署包(工件)上传到一个staging bucket，Lambda服务在那里检索这些包。在AWS Lambda从S3取回工件之后，那些包经常停留在暂存桶中，并且可能随着时间的推移而累积，特别是对于具有大量Lambda函数的大型项目。随着时间的推移，这通常会导致S3账单缓慢而稳定地增长。</p><p id="11f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我们将探索有哪些常用技术可以降低由SAM部署构件的构建所产生的成本。</p><h2 id="4346" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">选项1:为开发环境工件添加一个1天的到期规则</h2><p id="48e7" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">开发环境的部署工件对一个组织来说基本上是没有价值的，它不允许开发人员从中提取有用的调试信息，除非你真的需要检查包。</p><p id="d6be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了帮助您的组织减少花费在工件存储上的成本，您可以为S3存储桶配置您的开发工件存储，以实现一个对象生命周期管理规则，该规则将终止任何超过一天的构建。您可以使用以下云形成模板来实现这一点:</p><figure class="lu lv lw lx gt jr"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">使用对象生命周期管理在开发S3上管理SAM部署工件的云形成模板。</figcaption></figure><p id="61f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过以下任一方式发布此模板:</p><ol class=""><li id="1230" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mj mk ml mm bi translated">通过从这个<a class="ae mn" href="https://github.com/allanchua101/serverless-ninja/blob/master/013-saving-cost-from-artifact-storage/001-dev-expiration-sample/release.sh" rel="noopener ugc nofollow" target="_blank">链接</a>执行发布脚本来使用引导式部署。它将请求<strong class="ka ir">环境名称</strong>(开发、UAT和生产)&amp;和<strong class="ka ir"> AWS CLI配置文件名称</strong>。</li><li id="6541" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mj mk ml mm bi translated">我的Github页面中的发布脚本是为我的代码示例设计的。如果您想编写自己的自动化脚本，可以使用以下命令:</li></ol><figure class="lu lv lw lx gt jr"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h2 id="8184" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">选项2:为UAT和生产环境工件添加一个合理的截止日期</h2><p id="1c7d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">UAT和生产环境工件与开发环境工件是完全不同的讨论。它们通常对理解产品软件中存在的问题、安全漏洞和缺陷至关重要。</p><p id="4245" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它们为调试和调查活动提供有价值的见解的可能性比它们的开发同行更高。鉴于这一事实，您可能需要考虑为这些环境实现更长的过期日期。</p><p id="0f38" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我无法定义“<strong class="ka ir">合理的到期期限</strong>”对您的组织意味着什么。这通常由以下标准决定:</p><ul class=""><li id="5d0b" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mt mk ml mm bi translated">关于数据安全的国际法</li><li id="2ce4" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">您所在国家/地区关于应用程序数据和工件的监管法律</li><li id="d8de" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">您组织的内部政策</li></ul><p id="940d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以从开发环境中调整示例，方法是将对您组织的用例有意义的值(以天为单位)放入云形成模板的这一部分:</p><figure class="lu lv lw lx gt jr"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">与管理新加坡坏账的应用程序相关的工件的生命周期规则。</figcaption></figure><h2 id="5e1e" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">选项3:使用S3转换规则来更新旧工件的存储层</h2><figure class="lu lv lw lx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/6d5091a14653e50694fbf36a1adf65e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BRR-JrmDm0ckNtST.png"/></div></div></figure><p id="9b74" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以通过确保工件(不经常检索的)在对您的组织很重要的时间范围内被转移到S3的较冷的层，来对您的产品环境中的工件实现缓慢转移的转移规则。</p><p id="ed20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以利用下面的云形成模板来实现这一点:</p><figure class="lu lv lw lx gt jr"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">使用S3和云形成的典型转换规则自动化</figcaption></figure><p id="dd07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的示例应用以下规则来节省S3存储的成本:</p><ul class=""><li id="fb21" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mt mk ml mm bi translated">一年后，它将温暖的文物(年龄不到一年)转移到S3标准IA层。</li><li id="82e5" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">三年后，它将不太暖和的(年龄3岁及以下)文物转移到S3冰川。</li><li id="282c" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">它会删除存储中存在七年的对象</li></ul><h2 id="b7d4" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">包扎</h2><p id="cc23" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">存储在S3存储桶中的SAM工件可能会堆积很长时间，明智的做法是实施一个明智的策略来管理这些工件。本文展示了S3对象生命周期管理和转移规则如何帮助组织降低存储无服务器应用程序工件所产生的成本。</p><ul class=""><li id="b882" class="me mf iq ka b kb kc kf kg kj mg kn mh kr mi kv mt mk ml mm bi translated">使用一天到期的开发工件</li><li id="67b0" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">为产品工件使用合理的到期日期，这取决于您组织的用例。</li><li id="efad" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">合理的工件到期日期因组织和国家而异。州法律可能会影响您可能用于此实施的值。</li><li id="94ae" class="me mf iq ka b kb mo kf mp kj mq kn mr kr ms kv mt mk ml mm bi translated">您可以实现一组S3对象生命周期转换规则，将不太频繁访问的工件慢慢移动到较冷的层。</li></ul><p id="7072" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以使用这个<a class="ae mn" href="https://github.com/allanchua101/serverless-ninja/tree/master/013-saving-cost-from-artifact-storage" rel="noopener ugc nofollow" target="_blank"> Github </a>库来访问这些实现的模板。</p><h1 id="b1b2" class="mv kx iq bd ky mw mx my lb mz na nb le nc nd ne lh nf ng nh lk ni nj nk ln nl bi translated">相关链接</h1><div class="nm nn gp gr no np"><a href="https://medium.com/@ac052790/serverless-ninja-part-01-serverless-efficiency-64cf77915838" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">无服务器忍者第1部分:无服务器=效率</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">本文旨在解释组织和个人如何从无服务器的高效率中获益…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od jw np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://medium.com/@ac052790/serverless-ninja-part-02-reporting-errors-via-chatops-using-aws-lambda-nodejs-8d56dccadc9b" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">无服务器Ninja第2部分:使用AWS Lambda &amp; NodeJS通过ChatOps报告错误</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">这篇文章解释了如何通过ChatOps进行错误报告，以及它如何帮助组织更快地对问题做出反应…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">medium.com</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od jw np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://github.com/allanchua101/serverless-ninja" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">allancha 101/无服务器-忍者</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">成为一名无服务器API忍者你需要知道的事情我要感谢以下的人，他们训练了我…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">github.com</p></div></div><div class="ny l"><div class="of l oa ob oc ny od jw np"/></div></div></a></div><p id="25c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="og">原载于2020年8月24日</em><a class="ae mn" href="https://www.pogsdotnet.com/2020/08/how-to-reduce-cost-of-sam-artifact.html" rel="noopener ugc nofollow" target="_blank"><em class="og">【https://www.pogsdotnet.com】</em></a><em class="og">。</em></p></div></div>    
</body>
</html>