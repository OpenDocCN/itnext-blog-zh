<html>
<head>
<title>Webpack and LESS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络包及更少</h1>
<blockquote>原文：<a href="https://itnext.io/webpack-and-less-a75e04aaf528?source=collection_archive---------1-----------------------#2018-08-01">https://itnext.io/webpack-and-less-a75e04aaf528?source=collection_archive---------1-----------------------#2018-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ae59" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何让他们友好相处</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d9d85dbab2f04f3be4675e69a69bdcf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nBnpDk5b3wmwQb2Q"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">这是Webpack，当他们不配合时就更少了。但是他们可以！艾伦·泰勒在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="54fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以我的一个朋友，Frode，问了我一个关于Webpack和LESS如何工作的问题，以及你是如何设置的。与其写一个一次性的答案，我想我应该在Medium上写一篇快速的文章——这样其他人也可以从我的答案中受益。</p><h2 id="93ae" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">关于依赖性的一个注记</h2><p id="bf8d" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">如果您想跟进，您需要创建一个新文件夹，运行<code class="fe mq mr ms mt b">npm init -y</code>并安装以下依赖项:</p><pre class="kg kh ki kj gt mu mt mv mw aw mx bi"><span id="ebd3" class="ls lt iq mt b gy my mz l na nb">npm install --save-dev webpack webpack-cli less less-loader css-loader style-loader mini-css-extract-plugin</span></pre><p id="f1e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您阅读本文的过程中，将会解释这些依赖项。</p><h1 id="27ab" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">如何开始</h1><p id="e082" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">首先，让我们建立一个基本的<code class="fe mq mr ms mt b">webpack.config.js</code>文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="4b5a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们指定要加载文件<code class="fe mq mr ms mt b">src/index.js</code>，并从那里创建一个依赖图。无论我们最终得到什么，我们都希望在<code class="fe mq mr ms mt b">dist/bundle.js</code>中将其打包到一个大的ol’文件中。如果你以前使用过Webpack，你可能会看到这样的东西。</p><p id="9b8c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为参考，让我们假设我们的<code class="fe mq mr ms mt b">src/index.js</code>看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="5fb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而我们的<code class="fe mq mr ms mt b">src/my-styles.less</code>长这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ee9f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经准备好开始工作了！</p><h1 id="0398" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">使用webpack处理更少的文件</h1><p id="7151" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">每当您导入一个文件时，就像我们在上面的<code class="fe mq mr ms mt b">index.js</code>中所做的，webpack通过一个“规则”数组列表来运行它，并检查是否设置了任何规则来处理这种类型的文件。在我们的例子中，我们还没有指定规则——所以默认情况下只支持JavaScript文件。</p><p id="cd23" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了增加对少文件的支持，我们需要建立一个规则来处理这些文件。我们想告诉webpack，每当需要导入一个LESS文件时，它应该通过LESS编译器运行它，解析任何相对URL，然后以某种方式导出它。</p><p id="1e87" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是它的样子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="2cca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于种种原因，这个规则数组位于一个名为<code class="fe mq mr ms mt b">module</code>的对象中。总之，每个规则都是一个具有<code class="fe mq mr ms mt b">test</code>属性和<code class="fe mq mr ms mt b">use</code>数组的对象，它们指定了加载器。</p><p id="1a34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">test</code>属性是一个正则表达式，它根据文件名运行，以决定是否应该在当前正在处理的文件上运行该规则。在这种情况下，它检查文件是否以<code class="fe mq mr ms mt b">.less</code>结尾。</p><p id="377e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mq mr ms mt b">use</code>数组是一个所谓的加载器列表——或者转换——将在这个文件上运行。它们从右向左读取，并以菊花链方式处理文件。在我们的例子中，情况是这样的:</p><p id="19a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，运行<code class="fe mq mr ms mt b">less-loader</code>。这将文件的内容传递给LESS编译器，后者返回编译后的CSS。</p><p id="bfeb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二，<code class="fe mq mr ms mt b">css-loader</code>跑了。在这里，任何图像、字体等的相对URL都是为我们解析的。解释它的深度超出了本文的范围，但是如果您感兴趣的话，请看看它的<a class="ae kv" href="https://github.com/webpack-contrib/css-loader" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="17f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，运行<code class="fe mq mr ms mt b">style-loader</code>。这个加载器接受传递给它的任何文本(我们编译的带有解析的URL的CSS)，并将其推入一个<code class="fe mq mr ms mt b">&lt;style /&gt;</code>标签。这对于开发来说非常好，并且让我们在样式改变时更新我们的样式，而不用刷新页面(所谓的热重载)。</p><h1 id="171d" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">提取CSS文件</h1><p id="3e88" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">样式加载器对于开发来说很棒，但是对于生产来说并不理想。我们希望提取一个CSS文件，我们可以独立于JavaScript对其进行版本控制、缓存和服务，这样它的运行速度会更快！</p><p id="d562" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了确保在我们将东西投入生产时事情是不同的，我们需要某种标志来指定我们处于“为生产而构建”的模式。社区作为一个整体已经决定设置为<code class="fe mq mr ms mt b">"production"</code>的<code class="fe mq mr ms mt b">NODE_ENV</code>环境就是那个标志。</p><p id="d367" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们正在为生产构建我们的应用程序，我们希望用一个将CSS提取到文件中的转换来切换我们的<code class="fe mq mr ms mt b">style-loader</code>转换。为此，我们使用<code class="fe mq mr ms mt b">mini-css-extract-plugin</code>。它完全按照罐头上说的做——提取你的css。</p><p id="da99" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要使用它，我们需要将它添加到我们用于<code class="fe mq mr ms mt b">less</code>-文件的两个加载器中，并且我们需要将它作为一个“插件”添加。</p><p id="daa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">插件就像超级加载器，因为它可以做大量加载器做不到的事情——比如写文件。webpack文档<a class="ae kv" href="https://webpack.js.org/concepts/plugins/" rel="noopener ugc nofollow" target="_blank">很好地解释了它们的概念，所以我不会在这里跳进去。</a></p><p id="fb50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦添加了所有内容，我们就完成了最终的webpack-config:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="e45b" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">奖金:来源图！</h1><p id="c3ab" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">源代码图对于调试编译后的代码非常有用。它们将已编译代码的特定部分映射到未编译代码的相关部分。</p><p id="1eb5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Webpack让你制作源地图变得非常容易——你所需要做的就是添加<code class="fe mq mr ms mt b">devtool</code>属性。你可以在<a class="ae kv" href="https://webpack.js.org/configuration/devtool/" rel="noopener ugc nofollow" target="_blank">文档</a>中读到如何设置它。现在打开你的开发工具，直接进入源代码！</p><h1 id="e00e" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">奖金奖金:阅读来源！</h1><p id="47af" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我已经创建了一个样例repo来实现上面的代码。请浏览它，并克隆/安装它以查看它的运行。</p><p id="0ef6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以在此处找到代码:</p><div class="np nq gp gr nr ns"><a href="https://github.com/selbekk/webpack-with-less-example" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">sel bekk/web pack-with-less-example</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">这是一个简单的webpack安装程序，文件较少</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og kp ns"/></div></div></a></div><h1 id="2f98" class="nc lt iq bd lu nd ne nf lx ng nh ni ma jw nj jx md jz nk ka mg kc nl kd mj nm bi translated">最后的想法</h1><p id="c859" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">一旦你知道怎么做，用webpack设置LESS并不太难，但是在你第一次这么做的时候就不是很直接了。</p><p id="2e70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇指南能对你有所帮助，并且你能愉快地探索webpack的奇迹。</p></div><div class="ab cl oh oi hu oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ij ik il im in"><p id="ee57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读这篇文章！我希望你喜欢它——如果你喜欢，请为我鼓掌以示谢意。最多可以给50个！</p><p id="dd1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kthxbai</p></div></div>    
</body>
</html>