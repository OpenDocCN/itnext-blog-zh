<html>
<head>
<title>Managing Ingress Controllers on Kubernetes: Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管理Kubernetes上的入口控制器:第4部分</h1>
<blockquote>原文：<a href="https://itnext.io/managing-ingress-controllers-on-kubernetes-part-4-9f201296db28?source=collection_archive---------3-----------------------#2018-12-13">https://itnext.io/managing-ingress-controllers-on-kubernetes-part-4-9f201296db28?source=collection_archive---------3-----------------------#2018-12-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f0f4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">部署多个入口控制器</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/63e104f66e256ca2718cffda6f95a8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NXeV-D1CxubEADJL"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@firdoussross?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">弗多斯·罗斯</a>在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="48fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能认为一旦使用Kubernetes API定义了入口对象，并且部署了入口控制器，那么定义入口的更多选项就完成了……事实并非如此。拥有一个以上的入口定义，甚至一个以上的入口控制器部署，这是完全可能的，也是经常需要的。可能有数不清的场景要求部署多个入口资源，但这里有几个:</p><p id="90c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们已经看到，入口控制器的实现是不同的，可以基于不同的技术，具有不同的功能。您可能会选择首选的入口控制器实现，但需要针对特定服务后端的不同控制器实现的功能。一般入口可由优选的控制器来满足，特定的使用情况由具有独特能力的控制器来满足。</p><p id="a839" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">多个入口要求可能有细微的不同。例如，一些入口定义可能需要TLS，而一些入口定义可能在前端负载平衡器中终止TLS。因此，入口的语义在每种情况下都会不同，这可能需要创建不同的入口资源定义。</p><p id="db48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">除了为面向公众的服务配置入口之外，我们还可能同时需要处理内部流量和组织私有流量的入口。也许我们需要将流量从一个Kubernetes集群路由到另一个集群，或者在非容器化服务和集群内部运行的服务之间路由。显然，在这种情况下，我们需要不同的入口对象和控制器部署，以便区分不同的流量类型。</p><p id="0f9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们满足这些不同场景的唯一方法是部署多个入口定义和/或不同的入口控制器部署。这提出了一些重要的问题——我们如何确保流量被路由到正确的后端服务？我们如何确保不同的入口控制器不会竞争相同的流量？</p><p id="09df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">kubernetes.io/ingress.class</code>注释确定哪个入口控制器将处理对该入口资源的请求。如果我们假设Kubernetes集群部署了k8s-ingress-nginx控制器和Contour Ingress控制器，那么为了确保由特定入口对象定义的流量由Contour Ingress控制器处理，它的定义必须包含注释<code class="fe ls lt lu lv b">kubernetes.io/ingress.class: “contour".</code></p><p id="86bd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有时，部署相同入口控制器类型的两个不同配置版本来处理不同的需求可能是相关的。如果我们部署了两个k8s- ingress-nginx控制器，在入口对象中使用<code class="fe ls lt lu lv b">kubernetes.io/ingress.class: “nginx"</code>定义是不明确的；它可以指两个控制器中的任何一个，并且会导致具有不可预测结果的控制器争用。为了避免这个问题，当使用命令行标志部署控制器时，入口控制器通常允许定义类名。</p><p id="d7c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于k8s-ingress-nginx控制器，这是<code class="fe ls lt lu lv b">— ingress-class</code>，对于Contour ingress控制器，这是<code class="fe ls lt lu lv b">ingress-class-name</code>，对于Traefik Ingress控制器，这是<code class="fe ls lt lu lv b">kubernetes.ingressclass.</code>，因此，具有两个k8s-ingress-nginx控制器的集群可能有一个类别名称为internal的集合，用于处理来自集群内来源的流量，还有一个类别名称为<code class="fe ls lt lu lv b">external</code>的集合，用于处理来自集群外的流量。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://info.giantswarm.io/guide-to-managing-ingress-controllers"><div class="gh gi lw"><img src="../Images/c46c9bc5c32531dc4b9e02fbc12fd9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*VVAGMXjltR6ssPFbThUjFg.png"/></div></a></figure><h2 id="2370" class="lx ly iq bd lz ma mb dn mc md me dp mf lf mg mh mi lj mj mk ml ln mm mn mo mp bi translated">结论</h2><p id="e0c0" class="pw-post-body-paragraph kw kx iq ky b kz mq jr lb lc mr ju le lf ms lh li lj mt ll lm ln mu lp lq lr ij bi translated">Kubernetes Ingress API为将流量从边缘路由到部署在Kubernetes集群上的服务提供了最灵活、最强大的方法。它的实现在固执己见方面取得了平衡；一方面，入口资源在本质上是非常规范的，但是控制器组件特意<br/>留给第三方利用“同类最佳”反向代理技术来提供入口功能。</p><p id="8c39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们考虑了三种流行的入口控制器，每一种都使用不同的底层反向代理技术，并有自己的侧重点和特定功能。还有更多入口控制器实现方式；<a class="ae kv" href="https://github.com/appscode/voyager" rel="noopener ugc nofollow" target="_blank">航海家号</a>、<a class="ae kv" href="https://github.com/Kong/kubernetes-ingress-controller" rel="noopener ugc nofollow" target="_blank">孔</a>、<a class="ae kv" href="https://opensource.zalando.com/skipper/kubernetes/ingress-controller/" rel="noopener ugc nofollow" target="_blank">船长</a>不一而足。虽然一些控制器实现比其他的更受欢迎，但是没有“最佳”控制器，或者事实上的标准。在决定使用哪种控制器实现时，根据手头的技术要求进行完整的评估并适当考虑非技术因素是有意义的，例如“内部是否熟悉底层反向代理技术？”，或者“有可能获得入口控制器的商业支持吗？”。</p><p id="34cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自最初实现以来，Ingress API变化很小，尽管<a class="ae kv" href="https://kubernetes.io/docs/concepts/services-networking/ingress/#future-work" rel="noopener ugc nofollow" target="_blank">声明意图</a>将其开发到超出其有限的能力。这导致了特定于控制器的注释的激增，这些注释的唯一目的是为入口体验改进缺失的功能。Contour入口控制器使用的Ingres route CRD是将讨论向前推进的一种尝试。但是，正如Kubernetes Network  SIG在2018年2月进行的一项调查显示，人们希望有一个更具表现力的API，但也希望入口定义可以在不同的控制器之间移植。也许就什么应该或不应该是API的一部分达成一致是绊脚石？<a class="ae kv" href="https://kubernetes.io/community/" rel="noopener ugc nofollow" target="_blank">如果你有看法，一定要分享给社区。</a></p><p id="f88f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由<a class="ae kv" href="https://twitter.com/puja108" rel="noopener ugc nofollow" target="_blank"> Puja Abbassi </a>撰写——开发者倡导者@ <a class="ae kv" href="https://giantswarm.io/" rel="noopener ugc nofollow" target="_blank">巨型群体</a></p><div class="mv mw gp gr mx my"><a href="https://twitter.com/puja108" rel="noopener  ugc nofollow" target="_blank"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd ir gy z fp nd fr fs ne fu fw ip bi translated">puja Abbas si @ # kube con # kube Khan(@ puja 108)| Twitter</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">Puja Abbassi的最新推文@ #KubeCon #KubeKhan (@puja108)。开发者倡导者@ GiantSwarm &amp; Researcher</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">twitter.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm kp my"/></div></div></a></div><p id="a2d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">准备好将您的云原生项目投入生产了吗？只需在https://giantswarm.io/<a class="ae kv" href="https://giantswarm.io/" rel="noopener ugc nofollow" target="_blank">申请免费试用</a></p></div></div>    
</body>
</html>