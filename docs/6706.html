<html>
<head>
<title>Use Auth0 Actions to Send User Info to Apache Kafka When They Register</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当用户注册时，使用Auth0操作将用户信息发送到Apache Kafka</h1>
<blockquote>原文：<a href="https://itnext.io/use-auth0-actions-to-send-user-info-to-apache-kafka-when-they-register-1fbcce706c3b?source=collection_archive---------2-----------------------#2022-02-04">https://itnext.io/use-auth0-actions-to-send-user-info-to-apache-kafka-when-they-register-1fbcce706c3b?source=collection_archive---------2-----------------------#2022-02-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c52029940b6037e5261ceef52c6bdaab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEPHyMlprYvwICG0rS45Ng.png"/></div></div></figure><p id="952c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，你将学习如何使用Actions将Auth0与Apache Kafka 集成。您将通过编写一个动作来实现这一点，该动作将新用户注册的信息推送到Kafka集群。通过这样做，您打开了许多分析和用户体验的可能性，包括:</p><ul class=""><li id="e70c" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">处理注册事件(与<a class="ae kw" href="https://flink.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Flink </a>或<a class="ae kw" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank"> Spark </a>)以在新用户注册账户时通知您的业务和销售团队。</li><li id="95bf" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">触发流程，例如发送欢迎电子邮件或松弛消息以响应用户注册。</li><li id="916a" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">使用<a class="ae kw" href="https://docs.snowflake.com/en/user-guide/kafka-connector-overview.html" rel="noopener ugc nofollow" target="_blank"> Kafka连接器</a>将从注册过程中收集的用户数据移动到数据库或数据仓库，以提供报告和分析应用程序。</li><li id="f587" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">向您的CRM应用程序提供新的用户数据。</li></ul><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ll"><img src="../Images/8a58c8757d92e7d5bcfb282d7b72522b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WmeQCbOghiE2DsGh"/></div></div></figure><h1 id="0fc5" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">为什么是阿帕奇卡夫卡？</h1><p id="d6a2" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">Apache Kafka是一个分布式消息传递平台，它以事件的形式实时接收来自传感器、移动设备、数据库、应用程序和服务(包括Auth0)等来源的数据，并将这些数据提供给目标系统。它支持发布/订阅和分布式队列场景。Kafka为您提供了对数据进行流处理和批处理的灵活性。Kafka的复制功能和耐用性允许您将其用作数据的持久中心。</p><h1 id="20eb" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Auth0操作</h1><p id="16d6" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">Auth0操作是无服务器Node.js函数，由注册Auth0用户帐户或使用Auth0进行身份验证时发生的某些事件触发。使用操作，您可以使用自定义逻辑自定义和扩展Auth0的功能，您可以将自定义逻辑添加到登录、注册、更改密码等事件中。Auth0操作是无状态的，因此如果您使用它们来收集数据，您将需要一个外部存储。查看<a class="ae kw" href="https://auth0.com/docs/customize/actions/actions-overview" rel="noopener ugc nofollow" target="_blank">这篇文章</a>，了解更多关于行动的信息。</p><p id="d059" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我们将编写一个Auth0动作，它将由post用户注册流程触发，在用户完成注册帐户后发生。</p><h1 id="e444" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">创建Kafka集群</h1><p id="86b5" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">因为Auth0动作是无状态的，所以我们需要一个不需要有状态连接的Kafka服务。我们将使用<a class="ae kw" href="https://upstash.com/kafka" rel="noopener ugc nofollow" target="_blank"> Upstash的Kafka服务</a>，它有一个REST API，是为无服务器环境设计的，并且有一个适合这个项目的免费计划。</p><p id="63b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你还没有暴发户账户，<a class="ae kw" href="https://console.upstash.com/login" rel="noopener ugc nofollow" target="_blank">注册一个</a>。这个过程非常快，尤其是如果你使用亚马逊、GitHub或谷歌账户注册的话。随后，您将立即被带到<a class="ae kw" href="https://console.upstash.com/" rel="noopener ugc nofollow" target="_blank">桌面控制台</a>:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/8e9c7f89c412f37573441f29f965cc15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xghvaIt7W7_H8xFl"/></div></div></figure><p id="2c18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在页面顶部的菜单栏中选择<strong class="ka ir">卡夫卡</strong>。你会被带到这里:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/986d973009df7c83f1810c68addfd4ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O2xMDH-Ji_Eik6Yo"/></div></div></figure><p id="cda2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使用Kafka，您需要一个集群，它是一个或多个运行Apache Kafka的服务器的集合。点击<strong class="ka ir">创建集群</strong>按钮。该表单将会出现:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/c6c999ff1d640744c0500bdfacb445f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/0*PRVmFwiv00iSOA69"/></div></figure><p id="48e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为每个字段提供以下信息:</p><ul class=""><li id="4c4a" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><strong class="ka ir">名称:</strong>选择一个易于识别的名称，例如“Auth0 Actions Test”</li><li id="48d8" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><strong class="ka ir">地区:</strong>选择离你最近的地区。</li><li id="146f" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><strong class="ka ir">类型:</strong>选择<strong class="ka ir">单区</strong></li></ul><p id="dc56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">创建</strong>按钮继续。您将看到表单的第二页:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/122415dccc71d57c80d4171b93f17aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/0*m7sLTDn11VhinhxK"/></div></figure><p id="8672" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您需要为一个<em class="mx">主题提供一个名称，</em>，这就是卡夫卡组织事件的方式。如果你认为事件就像文件，那么主题就像目录。在<strong class="ka ir">名称</strong>字段中输入主题名称<strong class="ka ir">用户-事件-主题</strong>，点击<strong class="ka ir">发送请求</strong>按钮。</p><p id="c0da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Upstash将创建集群，并立即带您进入其<strong class="ka ir">详细信息</strong>页面:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/14ea83cd7fc6d7c3227063867501540a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xx_ZcZ-k2tBvD8z7"/></div></div></figure><p id="28fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">向下滚动到<strong class="ka ir"> REST API </strong>部分，在这里您将看到复制<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_URL </code>、<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_USERNAME </code>和<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_PASSWORD </code>的值的控件，您将在下一步中使用这些控件。</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/77996e04a7a890bd5f0326377a076d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wyRV-NVJP8lXWQ0I"/></div></div></figure><p id="b0f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在浏览器选项卡或窗口中保持此网页打开；你很快就会需要它。</p><h1 id="0055" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">实施行动</h1><p id="2dcd" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">在此步骤中，您需要一个Auth0帐户。如果您还没有帐户，您可以免费注册一个。</p><h1 id="f13b" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">创建新操作</h1><p id="3c93" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">登录Auth0仪表板。在左侧菜单中，选择<strong class="ka ir">动作</strong> → <strong class="ka ir">库</strong>，然后点击<strong class="ka ir">构建定制</strong>按钮。这将打开<strong class="ka ir">创建动作</strong>弹出窗口:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/21d30978bd245e9a3f113ec32c46b756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HnFZjzgBihnFhovJ"/></div></div></figure><p id="23ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为动作提供一个名称(我使用了<strong class="ka ir"> sendKafka </strong>)。</p><p id="762b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于目标是在用户注册帐户后向Kafka发送消息，因此该操作应该由Post用户注册事件触发。从<strong class="ka ir">触发器</strong>菜单中选择<strong class="ka ir">发布用户注册</strong>，然后点击<strong class="ka ir">创建</strong>按钮。</p><p id="e2af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在应该会看到代码编辑器:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/c4e9bba694092fbe5bcbb724fe1221a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FcESnO2xhl9dre3L"/></div></div></figure><h1 id="7a62" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">定义动作的秘密</h1><p id="8159" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">要向Kafka集群发送消息，该操作需要Kafka集群的<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_URL </code>、<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_USERNAME</code>和<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_PASSWORD</code>值，您可以从Upstash控制台复制这些值。您可以简单地使用这些值来定义常量，但是隐藏它们更安全。您可以使用Actions特性来实现这一点，该特性允许您安全地存储敏感值，并将其作为<code class="fe mz na nb nc b">event.secrets</code>对象的属性来访问。</p><p id="c95f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从第一个值开始，<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_USERNAME </code>。切换到带有桌面控制台的浏览器选项卡或窗口，点击<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_USERNAME</code>旁边的图标复制其值。然后切换回动作代码编辑器，并单击“秘密”图标:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/ea2f7da748e643e3fa52efbaba7adc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*au1oiRJTsQZldu8A"/></div></div></figure><p id="25d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个标题为<strong class="ka ir">秘密</strong>的新列将出现在代码编辑器中:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/02dc80166bd849d93cd55acb6d58d404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OI3kzwleu8_0Pmvc"/></div></div></figure><p id="13f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">添加密码</strong>按钮。将出现一个弹出窗口，您可以定义您的第一个密码值:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/a05bb1e95f7796f3d7aa86e864740ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ui1TclIVUUF2kwst"/></div></div></figure><p id="35d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir">键</strong>字段中输入<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_URL</code>，将您从桌面控制台复制的值粘贴到<strong class="ka ir">值</strong>字段中，并点击<strong class="ka ir">创建</strong>按钮。这将创建一个名为<code class="fe mz na nb nc b">event.secrets. UPSTASH_KAFKA_REST_URL </code>的属性，您将能够在您的操作中使用它。</p><p id="7366" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次点击<strong class="ka ir">添加秘密</strong>按钮。这一次，通过从Upstash复制其值并填写如下所示的<strong class="ka ir">定义秘密</strong>表格来定义<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_USERNAME</code>秘密:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/3c195d27e8aa51cfeddeead2954eab2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0F4HZTII_9ZUsdL4"/></div></div></figure><p id="569d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">创建</strong>按钮，然后再次点击<strong class="ka ir">添加秘密</strong>按钮。通过从Upstash复制其值并填写如下所示的<strong class="ka ir">定义秘密</strong>表来定义<code class="fe mz na nb nc b">UPSTASH_KAFKA_REST_PASSWORD</code>秘密...</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/e4c09b58ab775bede36cb3ee532c0452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WaDgI-vCReMeVsou"/></div></div></figure><p id="9d56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">…然后点击<strong class="ka ir">创建</strong>按钮。<strong class="ka ir">机密</strong>列现在应该包含三个机密的列表:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/55625a0363d9f36ba50d69d5ed24ac60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m0TUFaJqOATuPBWG"/></div></div></figure><h1 id="98a2" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">将节点提取模块添加到操作中</h1><p id="9b67" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">您可以将任何npm模块导入到一个动作中，这使得它们非常强大。该操作使用<a class="ae kw" href="https://www.npmjs.com/package/node-fetch" rel="noopener ugc nofollow" target="_blank">节点获取</a>模块向Kafka集群发送事件，因此您需要将它添加为一个依赖项。您可以使用功能来完成此操作。</p><p id="fe75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击“模块”图标，该图标位于“机密”图标的正下方:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/7842f73452c0bd1b8cebea83f717e285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tsgG4GLJ1yH5GIRy"/></div></div></figure><p id="be2b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个标题为<strong class="ka ir">模块</strong>的新列将出现在代码编辑器中:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/cbcdf186c3fba173997f62e92ac86258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o222gtxLy4A-p7yE"/></div></div></figure><p id="a76c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">添加模块</strong>按钮。将出现一个弹出窗口:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/03aba5091fdeab3633efdd4fb2b442cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VhoFaGPD65kWtlfU"/></div></div></figure><p id="063b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<strong class="ka ir">名称</strong>字段中输入<strong class="ka ir">节点提取</strong>，在<strong class="ka ir">版本</strong>字段中输入<strong class="ka ir"> 2 </strong>。不要<em class="mx">不要</em>选择最新版本(编写时为3)，因为它不允许导入。</p><p id="acff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">创建</strong>按钮。<strong class="ka ir">模块</strong>列现在应该列出<em class="mx">节点获取</em>模块:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/f3cb9783d8049d2f7f7c2fd42ccbfc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xWo9TtCyp6e4gC6f"/></div></div></figure><h1 id="82d8" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">写动作</h1><p id="71b1" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">现在你已经提供了先决条件，是时候写动作了！</p><p id="b812" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将下面的代码粘贴到编辑器中:</p><pre class="lm ln lo lp gt nk nc nl nm aw nn bi"><span id="5aee" class="no lr iq nc b gy np nq l nr ns">const fetch = require('node-fetch');<br/> <br/>exports.onExecutePostUserRegistration = async (event) =&gt; {<br/>  const address = event.secrets.UPSTASH_KAFKA_REST_URL<br/>  const user = event.secrets.UPSTASH_KAFKA_REST_USERNAME<br/>  const pass = event.secrets.UPSTASH_KAFKA_REST_PASSWORD<br/>  const auth = Buffer.from(`${user}:${pass}`).toString('base64')<br/>  const topic = 'user-events-topic'<br/><br/>  const userData = JSON.stringify(event.user);<br/>  const x = await fetch(`${address}/produce/${topic}`, {<br/>    method: 'POST',<br/>    headers: {'Authorization': `Basic ${auth}`},<br/>    body: JSON.stringify({"value" : userData})<br/>  })<br/>  const response = await x.json();<br/>  console.log(response)<br/>};</span></pre><p id="ebb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此操作使用Auth0提供的函数。当用户完成注册一个帐户时，调用该函数。它接受一个参数<code class="fe mz na nb nc b">event</code>，其<code class="fe mz na nb nc b">user</code>属性是一个包含新注册用户信息的对象，比如他们的电子邮件地址和用户ID。</p><p id="bf1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该代码检索存储在动作秘密中的秘密值，并使用它们连接到Kafka集群。它接受<code class="fe mz na nb nc b">user</code>对象，将其转换成原始的JSON字符串，并将其发送给Kafka集群中的主题。用户数据到Kafka主题。</p><h1 id="00de" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">测试动作</h1><p id="c3f7" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">现在，我们可以通过点击编辑器侧边栏上的<strong class="ka ir">测试</strong>图标来运行该功能:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/969033866bfe01a9a968e6a7d629b611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0F7F30n7KMYFyuC6"/></div></div></figure><p id="18ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个标题为<strong class="ka ir">测试</strong>的新列将出现在代码编辑器中:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/dac034d27f43c3ffe4129f1bc7d19e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u0t_XwuM0dPgnCbN"/></div></div></figure><p id="cfc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击<strong class="ka ir">运行</strong>按钮运行测试。一个<strong class="ka ir">测试结果</strong>窗格将出现在代码编辑器的下部:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/fbf34144bc72b69c2e109181c0aad8ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_v37sd1d01zSzjKD"/></div></div></figure><p id="cc62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该在<strong class="ka ir">日志</strong>部分看到类似下面的输出:</p><pre class="lm ln lo lp gt nk nc nl nm aw nn bi"><span id="59ee" class="no lr iq nc b gy np nq l nr ns">Logs:<br/>[<br/>  {<br/>    topic: 'user-events-topic',<br/>    partition: 0,<br/>    offset: 317,<br/>    timestamp: 1641950606804<br/>  }<br/>]</span></pre><p id="3107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您现在有一个工作动作。是时候部署了！</p><h1 id="e41a" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">部署行动</h1><p id="8a47" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">点击页面右上角附近的<strong class="ka ir">部署</strong>按钮。这将保存您的操作并使其成为库中的当前版本，</p><p id="a99b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您的操作已经在库中了，您需要将它添加到Post用户注册流中。通过从左侧菜单中选择<strong class="ka ir">动作</strong>导航至流程，然后<strong class="ka ir">流程</strong> → <strong class="ka ir">发布用户注册</strong>。你会看到这个:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/b1cf050774fce65fd3ceaf2e1c79ad9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nmwHDLsC6tert03u"/></div></div></figure><p id="ea49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在页面右侧的<strong class="ka ir">添加动作</strong>部分，选择<strong class="ka ir">自定义</strong>选项卡查看您创建的动作:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/ea8857e347afe54c46f38efac5f393f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V4t7OhoUGdQOLTnK"/></div></div></figure><p id="a0f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该会看到<strong class="ka ir"> sendKafka </strong>动作。拖放到流程中<strong class="ka ir">开始</strong>和<strong class="ka ir">完成</strong>节点之间的区域，如下图所示:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/125dbe8f4914d7c6eeb1fbdd3abdfec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UA10EUaHs4L9vYcR"/></div></div></figure><p id="8105" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在您已经将您的操作添加到了流程中，通过单击页面右上角附近的<strong class="ka ir"> Apply </strong>按钮来应用更改。</p><h1 id="d0a9" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">测试动作</h1><p id="8f40" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">现在行动部署好了，是时候检验一下了！</p><h1 id="58a7" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">创建新用户</h1><p id="d158" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">只要有新用户注册，您刚刚创建的操作就会运行，因此测试它的一种方法是使用Auth0仪表板创建一个新用户。</p><p id="e4bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Auth0仪表盘的左侧菜单中，选择<strong class="ka ir">用户管理</strong> → <strong class="ka ir">用户</strong> → <strong class="ka ir">创建用户</strong>并创建新用户:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/bb2dbc9ab64a5f08004340f62cc0f8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/0*ojuA4D93Adycry2P"/></div></figure><p id="c85a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建用户后，切换到Upstash浏览器选项卡或窗口，选择<strong class="ka ir">主题</strong>选项卡，然后选择<strong class="ka ir">用户-事件-主题</strong>主题:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/61f58b7cf1371b4678b842d023cb7259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QHUWWCj_kVWNL8hC"/></div></div></figure><p id="6ff0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将显示您的Kafka主题的统计数据:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/d74d7437ea81182ca07008995eea8e85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F6rO5qzLBu4_oHEO"/></div></div></figure><p id="3736" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每创建一个新用户，就会有一条新消息被推送到Kafka主题，其计数(显示在<strong class="ka ir">消息</strong>下)增加1。</p><p id="ef7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过使用<strong class="ka ir"> Details </strong>选项卡下的<strong class="ka ir"> REST API </strong>部分中的<strong class="ka ir"> Consumer </strong> curl脚本来检查Kafka主题:</p><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/b31f7369f80d696a7f48c549b0498869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JOuvWsMAi7QIoywT"/></div></div></figure><figure class="lm ln lo lp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/4978fb0868a1ef09d86c07367c05a765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XvnIdKG6B_pUm1i8"/></div></div></figure><p id="99df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在命令行控制台中运行curl脚本。结果应该是这样的:</p><h1 id="24ec" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">结论</h1><p id="d63e" class="pw-post-body-paragraph jy jz iq ka b kb mo kd ke kf mp kh ki kj mq kl km kn mr kp kq kr ms kt ku kv ij bi translated">Auth0操作使开发人员能够将自定义逻辑注入用户生命周期，为登录过程添加额外的行为和功能。在本文中，我们使用Auth0动作为Kafka生成由新用户注册触发的事件。一旦存储在Kafka中，就有无限的可能性来利用这些数据。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="8135" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mx">原载于【https://auth0.com】<a class="ae kw" href="https://auth0.com/blog/send-auth0-events-to-kafka-for-realtime-processing/" rel="noopener ugc nofollow" target="_blank"><em class="mx"/></a><em class="mx">。</em></em></p></div></div>    
</body>
</html>