<html>
<head>
<title>Github Actions — How to ship code to GCP Cloud Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">github Actions——如何将代码交付给GCP云运行</h1>
<blockquote>原文：<a href="https://itnext.io/github-actions-ship-code-to-gcp-cloud-run-8d607f34e1cd?source=collection_archive---------1-----------------------#2020-03-11">https://itnext.io/github-actions-ship-code-to-gcp-cloud-run-8d607f34e1cd?source=collection_archive---------1-----------------------#2020-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dd3a25d36813ae25e2f06aecdd1fdad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*15gbfnEb8070UoN-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://unsplash.com/@finalhugh?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">金赛</a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="a8b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将代码部署到产品中既耗时又棘手。出错可能会让你的服务瘫痪，最终可能会伤害你的用户，让你损失金钱。</p><p id="93d7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解决方案当然是尽可能自动化。</p><p id="8789" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">【参考消息:这篇博客文章假设在node.js/docker,有一个GCP帐户的基本知识，有权限部署代码和创建服务帐户和github帐户。</p><h1 id="d557" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是GCP云运行？</h1><p id="32a8" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">本着托管服务的精神，Google Cloud为我们提供了一项名为Cloud Run的服务。</p><blockquote class="mf"><p id="2312" class="mg mh iq bd mi mj mk ml mm mn mo la dk translated">Cloud Run是一个完全托管的计算平台，可以自动扩展您的无状态容器</p></blockquote><p id="7bae" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">从那句话中我们能理解什么？</p><ol class=""><li id="49e6" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">云运行是一项托管服务</li><li id="be2e" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">云运行用于运行<strong class="kf ir">容器</strong></li><li id="39e7" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">它可以自动扩展</li><li id="9c68" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">它是为无状态服务设计的</li></ol><p id="f3c5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以基本上，任何需要运行容器的人都可以从使用云运行中受益。</p><p id="86d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">我们想要运行容器！</strong></p><p id="a884" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以将我们的代码包装在一个容器中，例如docker，将它推送到gcp的容器注册表(如果我们愿意，也可以是另一个注册表)，并使用gcloud cli工具将其部署到云上运行，或者从GCP控制台网站进行一些更新。</p><p id="4776" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，这是一个重复的过程，容易出现人为错误，而且耗费时间。自动化的绝佳机会。</p><p id="4b49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">市场上有很多CI/CD工具，在这篇文章中，我们将重点关注Github的新动作</p><h1 id="5871" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">什么是Github动作？</h1><blockquote class="mf"><p id="46d3" class="mg mh iq bd mi mj mk ml mm mn mo la dk translated">GitHub Actions现在拥有世界一流的CI/CD，可以轻松实现所有软件工作流程的自动化。直接从GitHub构建、测试和部署您的代码</p></blockquote><p id="ce92" class="pw-post-body-paragraph kd ke iq kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">Github动作给了我们自动化过程的能力，所以我们可以编程我们想做的事情，并且知道当我们需要它时它会完全一样地重复自己。</p><p id="aec1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">动作基本上是描述一系列指令(称为步骤)的yaml文件。每一步都可以是另一个动作。我就不深究了，文档可以在这里找到<a class="ae kc" href="https://help.github.com/en/actions/getting-started-with-github-actions/core-concepts-for-github-actions" rel="noopener ugc nofollow" target="_blank">https://help . github . com/en/actions/getting-started-with-github-actions/core-concepts-for-github-actions</a></p><p id="960b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一个关键点是:Github提供了一个行动的市场，这意味着我们可能不需要发明轮子，除非我们在做真正前沿的东西。市场可以在这里找到:<a class="ae kc" href="https://github.com/marketplace?type=actions" rel="noopener ugc nofollow" target="_blank">https://github.com/marketplace?type=actions</a></p><h1 id="b329" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">好吧，有什么计划？</h1><p id="8fb4" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">我们将遵循以下步骤:</p><ol class=""><li id="d06a" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">创建新的Github repo</li><li id="2b1b" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">创建一个超级简单的node.js服务器</li><li id="a366" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">创建匹配的docker文件，以便我们可以将服务器打包</li><li id="4cae" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">创建Github action yaml来实际构建容器并将其部署到cloud run</li><li id="bcda" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">创建服务帐户</li><li id="b927" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">授予服务帐户操作权限</li><li id="0ce4" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">更新Github机密</li><li id="aef6" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">提交代码并观察奇迹的发生</li></ol><p id="eedc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完整的代码可以在这里找到:<a class="ae kc" href="https://github.com/efiShtain/github-action-cloud-run" rel="noopener ugc nofollow" target="_blank">https://github.com/efiShtain/github-action-cloud-run</a></p><h2 id="c9bf" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">创建新的Github repo</h2><p id="1a43" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">如果你已经有一个正在进行的回购，跳过这一步。否则，去Github.com，登录你的帐户，创建一个新的回购协议，命名为任何你喜欢的名字，并克隆到你的驱动器</p><h2 id="118c" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">创建一个超级简单的node.js服务器</h2><p id="34d2" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">在repo目录中运行以下命令:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="edf6" class="ni ld iq nz b gy od oe l of og">// Initialize an npm package<br/>npm init -y</span><span id="80a6" class="ni ld iq nz b gy oh oe l of og">// create source file directory<br/>mkdir src</span><span id="578d" class="ni ld iq nz b gy oh oe l of og">// create the application server entry point file<br/>touch src/index.js</span><span id="1904" class="ni ld iq nz b gy oh oe l of og">// vi to src/index.js or edit it how over you like and add the following code to it</span><span id="c5bd" class="ni ld iq nz b gy oh oe l of og">const http = require('http');</span><span id="2850" class="ni ld iq nz b gy oh oe l of og">function requestHandler(req, res) {<br/>    res.write('ok');<br/>    res.end();<br/>}</span><span id="f8ce" class="ni ld iq nz b gy oh oe l of og">const server = http.createServer(requestHandler);<br/>const port = process.env.PORT || 8888;<br/>server.listen(port, () =&gt; console.log(`listening on port ${port}`));</span></pre><h2 id="ad73" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">创建匹配的Dockerfile文件</h2><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="9c6c" class="ni ld iq nz b gy od oe l of og">// create the docker file<br/>touch Dockerfile</span><span id="0a45" class="ni ld iq nz b gy oh oe l of og">// Add the follwing lines to Dockerfile<br/>FROM node:alpine<br/>WORKDIR /usr/app/src<br/>COPY package*.json ./</span><span id="a375" class="ni ld iq nz b gy oh oe l of og">RUN npm install --production</span><span id="52ec" class="ni ld iq nz b gy oh oe l of og">COPY src .</span><span id="d835" class="ni ld iq nz b gy oh oe l of og">CMD ["node", "index.js"]</span></pre><h2 id="ed76" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">创建Github action yaml来实际构建容器并将其部署到cloud run</h2><p id="53bc" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">转到:</p><div class="oi oj gp gr ok ol"><a href="https://github.com/google-github-actions/setup-gcloud/blob/main/example-workflows/cloud-run/cloud-run.yml" rel="noopener  ugc nofollow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd ir gy z fp oq fr fs or fu fw ip bi translated">主页面上的setup-g cloud/cloud-run . yml Google-github-actions/setup-g cloud</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">此文件包含双向Unicode文本，其解释或编译可能与下面显示的不同…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">github.com</p></div></div></div></a></div><p id="2732" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是github actions的Google云平台官方云运行实例。在本地repo中创建完全相同的文件。github/workflows/cloud-run.yml</p><p id="954e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们不会深入研究文件结构，让我们只关注几点:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="4c0e" class="ni ld iq nz b gy od oe l of og">PROJECT_ID: ${{ secrets.RUN_PROJECT }}</span></pre><p id="16e5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们将在gcp中使用的项目id。要查找您的项目id，请前往https://console.cloud.google.com/的<a class="ae kc" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"/>。如果需要，请登录，并从左上角的菜单中打开项目列表。在模态窗口中，你会看到你的项目列表，它们的名字和id。</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="9b28" class="ni ld iq nz b gy od oe l of og">RUN_REGION: us-central1  <br/>SERVICE_NAME: helloworld-nodejs</span></pre><p id="9b8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以控制服务名称以及它将在哪个区域运行。</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="ac0b" class="ni ld iq nz b gy od oe l of og">service_account_email: ${{ secrets.SA_EMAIL }}          service_account_key: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS}}</span></pre><p id="e538" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要提供一个服务帐户和凭证，这样github可以控制我们的GCP项目。</p><p id="25e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">这是非常危险和重要的！！！尽可能限制任何服务帐户的访问</em></p><p id="889a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你想看到其他正在进行的事情，就仔细阅读这个文件，但是它是相当基础的，并且确实做了我们在手册部分描述的事情。</p><h2 id="fee8" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">创建服务帐户并更新github机密</h2><p id="3e89" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">转到您的GCP项目控制台-&gt; IAM &amp; Admin-&gt;服务帐户(<a class="ae kc" href="https://console.cloud.google.com/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/iam-admin/serviceaccounts</a>)</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ou"><img src="../Images/8304f4158737f81dbb607b86015e9f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5E8S1TpkT2_324DY8sfBg.png"/></div></div></figure><p id="20b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">点击创建服务帐户</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/cfd88640e60edb0dd7fb221ad9773799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fjSj4GOY72h2wkYX5RrnA.png"/></div></div></figure><p id="4228" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">填写服务帐户名称，即github-action，以及描述</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/b4002a0a2d3b3c23b19b818364dbf3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_DJrmpnbjKeVJsu_H6UPyw.png"/></div></div></figure><p id="b71e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单击Create，并在下面两个屏幕中继续和完成。现在，您应该看到您的服务帐户已成功创建。</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/70a4dce40f3e545f09905aa0303bfa7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVYQIIMkLemB80Z6YkGhUw.png"/></div></div></figure><p id="6e20" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还记得，我们在cloud-run.yml文件中有三个秘密:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="8972" class="ni ld iq nz b gy od oe l of og">secrets.RUN_PROJECET<br/>secrets.GOOGLE_APPLICATION_CREDENTIALS<br/>secrets.SA_EMAIL</span></pre><p id="60af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">SA_EMAIL是:github-action@…iam.gserviceaccount.com</p><p id="51ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要获得GOOGLE_APPLICATION_CREDENTIALS，单击右边的菜单并选择create key</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/ff2b749761330bf2243b27697ef69f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*ed0oMVNo2s4xcGkfXGb-wA.png"/></div></figure><p id="4099" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下窗口将显示:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/5f57c97f198aed10e98d0b4e29870a11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EzSSS7A_zElBrcgNfbaomg.png"/></div></div></figure><p id="e7f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">确保选择JSON，然后单击create。一个JSON文件将被下载到您的计算机上。任何拥有该文件的人都拥有服务帐户权限，可以做任何他想做的事情。保持它的安全，当然不是作为你的仓库的一部分。</p><p id="5ae5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一步，它将JSON文件的内容转换为base64。在mac上，您可以在“终端”中使用以下功能:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="5143" class="ni ld iq nz b gy od oe l of og">cat {PATH_TO_DOWNLOADED_JSON_FILE} | base64</span></pre><p id="0082" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">保存结果，我们很快就会用到它。</p><h2 id="2c96" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">确保服务帐户可以做它需要做的事情</h2><p id="29e9" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">我们的服务帐户现在毫无价值，它没有角色，也不能做任何事情。让我们给它一些力量。</p><p id="09b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">转到IAM页面，单击Add并在“new member”字段中填写我们刚刚创建的服务帐户名称—它应该会自动完成。向服务帐户添加以下角色:</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pa"><img src="../Images/e658ab1f880fe85f5f9a0dd189fd62db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yQF9OrrQujnOcs0gEoe05w.png"/></div></div></figure><ol class=""><li id="701f" class="mu mv iq kf b kg kh kk kl ko mw ks mx kw my la mz na nb nc bi translated">云构建器—允许服务帐户构建和提交映像</li><li id="d73c" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">服务帐户用户—允许服务帐户充当服务</li><li id="fe6b" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">云运行管理—允许服务部署和启动容器</li><li id="fe16" class="mu mv iq kf b kg nd kk ne ko nf ks ng kw nh la mz na nb nc bi translated">项目上的查看器<strong class="kf ir">——允许服务帐户列出存储对象并使用它们(这是我们的容器数据存储的地方)</strong></li></ol><h2 id="889d" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">更新Github机密</h2><p id="377c" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">好了，我们完成了GCP，在Github的网站上打开你的回购。转到“设置”并选择“密码”选项卡</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pb"><img src="../Images/ab6efdcf7c97ce4f432223b94eb62bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2idnNKnj1DzJKL-BIoEVrQ.png"/></div></div></figure><p id="d213" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回购协议中加入3个秘密:</p><pre class="nu nv nw nx gt ny nz oa ob aw oc bi"><span id="d58c" class="ni ld iq nz b gy od oe l of og">RUN_PROJECT - project id<br/>GOOGLE_APPLICATION_CREDENTIALS - service account credentials, in base64 format<br/>SA_EMAIL - the service account email</span></pre><h2 id="9215" class="ni ld iq bd le nj nk dn li nl nm dp lm ko nn no lq ks np nq lu kw nr ns ly nt bi translated">提交代码并观察奇迹的发生</h2><p id="bcf6" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">就是这样！我们都准备好了！您可以提交您的代码，让github来完成这项工作。转到行动页面，在那里你会看到正在发生什么。这里有一个我在操场上使用github动作的例子。</p><figure class="nu nv nw nx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pc"><img src="../Images/60dc55d37d1d904388e7cf5d26f806a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A13Iw7EonDN9vvVynd9mzQ.png"/></div></div></figure><h1 id="ba4b" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="7cee" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">这是一个漫长的过程，但你只需要做一次，我试着详细描述困难的部分。</p><p id="793e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您现在有了一个全功能的Github操作，它部署了一个云运行容器，隐藏了所有微妙的重复任务，因此您可以专注于编码。</p><p id="e22d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也就是说，这只是触及了冰山一角。这个解决方案还没有完全投入生产，因为还有更多的事情需要考虑，比如处理故障、回滚、金丝雀测试、单元测试等等。</p><p id="c758" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我犯了什么错误，或者你能想到更好/更简单的方法，请告诉我</p></div></div>    
</body>
</html>