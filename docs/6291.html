<html>
<head>
<title>Style Development Log 1 : Exception Handling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">风格开发日志1:异常处理</h1>
<blockquote>原文：<a href="https://itnext.io/exception-handling-with-style-6020f01af7d8?source=collection_archive---------4-----------------------#2021-10-10">https://itnext.io/exception-handling-with-style-6020f01af7d8?source=collection_archive---------4-----------------------#2021-10-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="32f8" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">【https://discord.gg/bPcscvBM】加入我们的不和谐社区<a class="ae kp" href="https://discord.gg/hdCdYfwS4C" rel="noopener ugc nofollow" target="_blank"><em class="iq"/></a><em class="iq">获取消息。</em></p></blockquote><p id="2050" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我将在一个系列中分享与风格后端框架相关的开发，我已经在<a class="ae kp" rel="noopener ugc nofollow" target="_blank" href="/style-backend-framework-d544bdb78a36">文章</a>中宣布了。如果你对<br/>风格没有概念或者不理解下面例子中的组件，请看看主要的<br/>文章。</p><p id="9c73" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">您可以通过电子邮件订阅medium帐户，以跟踪事态发展。我不会在这个系列和风格之外的主题上添加文章，所有文章都是免费阅读的。这个系列可以被认为是一个<br/>开发者博客。由于这个原因，我将分享发展情况。文档中预期的主题上下文<br/>不应该出现在本系列中。众所周知，后端在运行时会收到许多意想不到的请求。处理这些意外的<br/>请求和事务，并将错误消息发送给客户端。这些可能是与开发人员相关的(例如，错误的类型转换)，也可能是预计在运行时发生的异常(未经授权的请求)。<br/> <br/>首先，为了最大限度地减少样式中的意外错误，在服务器第一次运行时，从组件<br/>树中提取错误。程序将停止，因为这些错误没有被处理。</p><p id="6fc4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在运行时，来自请求的所有异常都被处理，并且服务器不会停止。由于<a class="ae kp" href="https://dart-lang.github.io/linter/lints/avoid_catches_without_on_clauses.html" rel="noopener ugc nofollow" target="_blank">avid _ catches _ without _ on _ clauses</a>，错误未得到处理。</p><p id="eeb2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我的主文章中的主题对于解释这个主题很重要。</p><h1 id="3fe2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">异常回绕</h1><p id="c55c" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated">使用Style，<code class="fe kt ku kv kw b">ExceptionWrapper&lt;Type&gt;</code>您可以通过类型为发生在包装器下的所有异常定义一个端点。</p><p id="1f7e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果没有用端点上下文中发生的异常的确切类型来包装，则使用为超类创建的包装。如果它不存在，它将被默认包装的“异常”端点处理。</p><p id="708b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">本例中所有异常都由<code class="fe kt ku kv kw b">MyExEnd</code>端点处理。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="91ed" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;Exception&gt;(<br/>    child: Route(<br/>        "exception",<br/>        root: Throw(Exception("always throw"))<br/>    ),<br/>    exceptionEndpoint: MyExEnd()<br/>)</span></pre><h1 id="ffeb" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">等级制度</h1><p id="ac60" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated">在子组件中重新包装时，包装异常会被覆盖。</p><p id="c8bb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">有4层不同的例外。(顶部最具包容性)</p><ul class=""><li id="c42a" class="mn mo iq jt b ju jv jy jz kq mp kr mq ks mr ko ms mt mu mv bi translated">例外</li><li id="9b84" class="mn mo iq jt b ju mw jy mx kq my kr mz ks na ko ms mt mu mv bi translated">样式异常-其他异常</li><li id="a788" class="mn mo iq jt b ju mw jy mx kq my kr mz ks na ko ms mt mu mv bi translated">ExceptionGroup (StyleException实现:客户端错误，服务器错误)</li><li id="4b94" class="mn mo iq jt b ju mw jy mx kq my kr mz ks na ko ms mt mu mv bi translated">ExactType(异常组实现)</li></ul><p id="cfe7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">获取上下文中的异常终结点时，遵循以下顺序。</p><figure class="ma mb mc md gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nb"><img src="../Images/304e3eb662a4f44f3e4a94478ea90846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZDlUMM5Zg3OOH-lkWpE8w.png"/></div></div></figure><h2 id="c8da" class="mi ky iq bd kz nj nk dn ld nl nm dp lh kq nn no ll kr np nq lp ks nr ns lt nt bi translated"><code class="fe kt ku kv kw b">StyleException</code></h2><p id="6290" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated"><code class="fe kt ku kv kw b">StyleException</code>是一个异常实现。这个异常包含一些信息，比如statusCode、异常发生的位置、它正在处理的请求以及客户端信息等。</p><h2 id="a8fa" class="mi ky iq bd kz nj nk dn ld nl nm dp lh kq nn no ll kr np nq lp ks nr ns lt nt bi translated">客户端错误—服务器错误</h2><p id="3fe6" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated">它们是具有4**/5**状态代码的例外。以下链接中的所有例外都已实现。</p><p id="952b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">例如有<code class="fe kt ku kv kw b">NotFoundException</code> (404)。</p><div class="nu nv gp gr nw nx"><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status#client_error_responses" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">HTTP响应状态代码- HTTP | MDN</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">这个临时响应表明客户端应该继续请求或者忽略响应，如果请求…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">developer.mozilla.org</p></div></div><div class="og l"><div class="oh l oi oj ok og ol nh nx"/></div></div></a></div><h2 id="a7cf" class="mi ky iq bd kz nj nk dn ld nl nm dp lh kq nn no ll kr np nq lp ks nr ns lt nt bi translated">例子</h2><p id="02c5" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated">作为最后手段的所有例外。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="c75e" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;Exception&gt;(<br/>    child: ..,<br/>    exceptionEndpoint: MyExceptionEndpoint()),</span></pre><p id="7cd1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果精确类型或中间(客户端-服务器错误)类型没有被包装，则处理所有的<code class="fe kt ku kv kw b">StyleException</code>。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="a20f" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;StyleException&gt;(<br/>    child: ..,<br/>    exceptionEndpoint: MyExceptionEndpoint()),</span></pre><p id="0c00" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果不是精确的包装类型，处理所有的<code class="fe kt ku kv kw b">ClientError</code>。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="4c2d" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;ClientError&gt;(<br/>    child: ..,<br/>    exceptionEndpoint: MyExceptionEndpoint()),</span></pre><p id="69b2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">处理<code class="fe kt ku kv kw b">BadRequests</code>。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="fbb7" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;BadRequest&gt;(<br/>    child: ..,<br/>    exceptionEndpoint: MyExceptionEndpoint()),</span></pre><p id="19cf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">手柄<code class="fe kt ku kv kw b">FormatException</code>。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="f478" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper&lt;<!-- -->FormatException<!-- -->&gt;(<br/>    child: ..,<br/>    exceptionEndpoint: MyExceptionEndpoint()),</span></pre><h2 id="68b4" class="mi ky iq bd kz nj nk dn ld nl nm dp lh kq nn no ll kr np nq lp ks nr ns lt nt bi translated">不止一个定义</h2><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="0cac" class="mi ky iq kw b gy mj mk l ml mm">ExceptionWrapper.fromMap(<br/>  map: {<br/>    InternalServerError : My500Endpoint(),<br/>    MethodNotAllowedException : My405Endpoint()<br/>  },<br/>  child: ..,),</span></pre><h2 id="377c" class="mi ky iq bd kz nj nk dn ld nl nm dp lh kq nn no ll kr np nq lp ks nr ns lt nt bi translated">服务器默认值</h2><p id="99c2" class="pw-post-body-paragraph jq jr iq jt b ju lv jw jx jy lw ka kb kq lx ke kf kr ly ki kj ks lz km kn ko ij bi translated">同<code class="fe kt ku kv kw b">ExceptionWrapper.fromMap</code></p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="6c2d" class="mi ky iq kw b gy mj mk l ml mm">Server(<br/>    defaultExceptionEndpoints: {<br/>      InternalServerError : My500Endpoint(),<br/>      MethodNotAllowedException : My405Endpoint()<br/>    },<br/>    children: []<br/>);</span></pre><h1 id="2e63" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">端点</h1><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="fad1" class="mi ky iq kw b gy mj mk l ml mm"><em class="js">/// TODO: Document<br/></em>class MyStyleExEndpoint extends ExceptionEndpoint&lt;StyleException&gt; {<br/>  MyStyleExEndpoint() : super();<br/><br/>  @override<br/>  FutureOr&lt;Response&gt; onError(<br/>      Message message, StyleException exception, StackTrace stackTrace) {<br/>    return (message as Request).createResponse({<br/>      "err": "client_error_received",<br/>      "type": "${exception.runtimeType}",<br/>      "sup": "${exception.superType}",<br/>      "st": stackTrace.toString()<br/>    });<br/>  }<br/>}</span></pre><p id="9b04" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><code class="fe kt ku kv kw b">Message</code>是五月<code class="fe kt ku kv kw b">Request</code>还是<code class="fe kt ku kv kw b">Response</code>。因为创建响应后可能会出现异常。(例如发生在<code class="fe kt ku kv kw b">ResponseSchemaGate</code>)。</p></div></div>    
</body>
</html>