<html>
<head>
<title>Building accessible and consistent forms in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中构建可访问且一致的表单</h1>
<blockquote>原文：<a href="https://itnext.io/building-accessible-and-consistent-forms-in-react-22f3551e38a4?source=collection_archive---------0-----------------------#2020-03-29">https://itnext.io/building-accessible-and-consistent-forms-in-react-22f3551e38a4?source=collection_archive---------0-----------------------#2020-03-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/26839ad266588d74e7cdcade23588063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrm2gyteuVrzh-i0bAQwoQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">由Paul Flavius Nechita 创建一个新的项目模型</figcaption></figure><p id="4673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为开发人员，我们花费大量时间构建表单、设计验证策略并确保提交数据的一致性。<a class="ae kc" href="https://uxdesign.cc/search?q=better%20forms" rel="noopener" target="_blank">表单是UI/UX人</a>的热门话题，他们写了无数文章剖析完美表单领域，讨论它的解剖结构并细致记录它的行为。然而，开发商在好日子里翻白眼，在其余时间里想掐死他们的UX同行。表格很难，表格很无聊，表格很乏味。</p><p id="5e36" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我认为问题的一部分是我们开发人员在处理表单元素时看不到模式——它们看起来都非常不同，每个都有自己的一套要求和行为，除此之外，我们还为多种状态获得了一套像素级的完美设计，这对于一个简单的表单输入来说似乎是一种巨大的努力。许多界面元素，比如卡片、菜单、标签，都有可预测的模式，并且可以隔离成数据结构，然后映射到特定的组件。然而，当涉及到表单时，我们变得非常有表现力，编写了200行HTML来呈现标签、输入和帮助文本，然后我们开始添加验证逻辑，然后我们意识到我们需要处理错误状态，然后我们需要实现各种状态之间的转换，然后我们需要找出键盘可访问性，等等。如果您从一开始就没有一个策略，您的表单就会变得一团糟，并且您很难在不破坏其他东西的情况下引入修改，并且对标记的任何更改都会变成对大量视图和组件的耗时的演练。</p><p id="8225" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，作为开发人员，我们该如何改进我们的表单工作流程呢？我最近在React 上看到了几篇关于<a class="ae kc" href="https://medium.com/javascript-in-plain-english/data-driven-approach-to-forms-with-react-c69fd4ea7923?source=bookmarks---------5------------------" rel="noopener">数据驱动表单方法的文章，所以我想分享一下我在这方面的知识:我将展示我如何隔离字段模式，使我的表单干燥，同时保持视觉一致性、可访问性和数据完整性。</a></p><p id="7490" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从识别组成表单域的单个元素开始。在这样做的同时，让我们也考虑一下可访问性，尤其是HTML规范给我们带来的机会和需求。</p><h1 id="4325" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">野外解剖学</h1><h2 id="33d5" class="lz lc iq bd ld ma mb dn lh mc md dp ll ko me mf lp ks mg mh lt kw mi mj lx mk bi translated">输入元素</h2><p id="f34d" class="pw-post-body-paragraph kd ke iq kf b kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">为了实现一致性，我们需要做的第一件事是放弃本地浏览器输入事件。我们希望所有字段一致地处理输入事件，也就是将更新后的值传递给更改处理程序，而不是在事件属性中挖掘目标值和状态。最终，我们不关心触发了什么事件，我们关心输入的新值。如果需要的话，您总是可以持久化事件，并通过处理程序参数传递它(我还没有遇到过这种需要)。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9829" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们同意我们所有的输入元素总是接受两个道具:<code class="fe mw mx my mz b">onChange</code>和<code class="fe mw mx my mz b">value</code>，我们就可以构建任意数量的以相同方式运行的自定义输入，从而允许我们在表单中一般化数据流。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h2 id="4eec" class="lz lc iq bd ld ma mb dn lh mc md dp ll ko me mf lp ks mg mh lt kw mi mj lx mk bi translated">标签元素</h2><p id="d375" class="pw-post-body-paragraph kd ke iq kf b kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated"><code class="fe mw mx my mz b">&lt;label&gt;</code>标签是走向现场可及性的重要一步。浏览器和屏幕阅读器识别标签和输入元素之间的关系。因此，让我们确保我们的字段有一个惟一的<strong class="kf ir"> id </strong>。</p><p id="ddeb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同时，让我们也允许传递一些帮助文本，让用户知道我们对他们的期望。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7752" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在有了一个通用的字段组件，它接受输入组件的元素类型，并将其与字段标签和帮助文本一起呈现。</p><p id="8f4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于标签的问题，让我们记住我们可以将我们的<code class="fe mw mx my mz b">&lt;input&gt;</code>嵌套在<code class="fe mw mx my mz b">&lt;label&gt;</code>标签中，这样它就可以在没有id的情况下对键盘/鼠标触发做出反应。这在使用单选按钮、复选框和自定义文件输入时很方便。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="f2e6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">现场可达性</h1><p id="dad8" class="pw-post-body-paragraph kd ke iq kf b kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">当谈到自定义输入的可访问性时，我们希望确保:</p><ul class=""><li id="4409" class="na nb iq kf b kg kh kk kl ko nc ks nd kw ne la nf ng nh ni bi translated">我们的输入有一个<code class="fe mw mx my mz b">tabindex</code>，可以通过使用键盘<code class="fe mw mx my mz b">tab</code>键来实现</li><li id="8344" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">我们的输入有一个明确的焦点状态</li><li id="b27d" class="na nb iq kf b kg nj kk nk ko nl ks nm kw nn la nf ng nh ni bi translated">我们的输入值可以使用鼠标和键盘来更改(例如，按下复选框上的<code class="fe mw mx my mz b">space</code>键)</li></ul><p id="75a2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个拨动开关:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="8c1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，这个开关只能用鼠标来切换。不管出于什么原因，如果用React呈现，标签是不可聚焦的，它们的行为也不像在普通HTML中那样。尝试仅使用键盘在<a class="ae kc" href="https://www.w3schools.com/howto/howto_css_switch.asp" rel="noopener ugc nofollow" target="_blank"> w3schools </a>切换开关，然后在React组件中做同样的操作。</p><p id="6b82" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用的解决方法是在父组件上设置一个<code class="fe mw mx my mz b">tabIndex</code>,并将点击和键盘事件绑定到元素:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e007" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，您可能希望能够以编程方式关注自定义input元素。所以，让我们用<code class="fe mw mx my mz b">useImperativeHandle</code>来实现它。我们可以将自定义输入的焦点方法代理到自定义输入组件树中的特定元素。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="12c3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">现场验证</h1><p id="f9ad" class="pw-post-body-paragraph kd ke iq kf b kg ml ki kj kk mm km kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">我们的字段需要的另一个重要功能是验证。在实现表单验证时要记住的一件事是，有些字段不能自行验证，例如，重复密码字段需要知道原始密码输入的值才能评估其条件。因此，我更喜欢在表单级别验证我的字段，而不是在单个输入中。</p><p id="7318" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://react-hook-form.com/" rel="noopener ugc nofollow" target="_blank"> React Hook Form </a>是我在工作中一直使用的一个神奇工具，我真的很高兴它给了我灵活性。</p><p id="438f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们设置一个表单组件，它将接受一组字段并呈现一个表单。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="d44e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意，我的表单有一个可选的<code class="fe mw mx my mz b">formName</code>。我使用这个值来生成特定于表单的错误消息，我将在后面演示。</p><p id="409c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们更新我们的字段组件以支持验证和错误消息。React Hook表单库提供了一个<code class="fe mw mx my mz b">Controller</code>组件，我们可以使用它将我们的自定义输入与他们的验证API集成在一起。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="ccf7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的字段组件可以基于表单名称、规则名称和字段名称的组合来确定要显示的错误消息，从而为我们提供了很大的灵活性来定位要显示给用户的错误。</p><p id="332e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在要做的就是将我们的字段传递给表单组件，瞧，我们有了一个可访问的表单，带有同步和异步验证，以及多语言上下文特定的错误。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="a01b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">今天到此为止。如果你有问题，请告诉我。</p></div></div>    
</body>
</html>