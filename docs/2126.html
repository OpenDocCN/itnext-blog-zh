<html>
<head>
<title>How to send text messages from your static site using Netlify, Twilio and serverless functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Netlify、Twilio和无服务器功能从静态站点发送文本消息</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-send-text-messages-from-your-static-site-using-netlify-twilio-and-serverless-functions-efd6e383bd1a?source=collection_archive---------3-----------------------#2019-04-04">https://itnext.io/how-to-send-text-messages-from-your-static-site-using-netlify-twilio-and-serverless-functions-efd6e383bd1a?source=collection_archive---------3-----------------------#2019-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a14e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一名前端开发人员，这是令人兴奋的时刻。随着无服务器功能等现代技术的兴起，<a class="ae kl" href="https://thepowerofserverless.info/" rel="noopener ugc nofollow" target="_blank">前端工程师可以做通常只有后端工程师才能做的事情</a>。这需要部署可扩展的站点，<a class="ae kl" href="https://sendgrid.com/" rel="noopener ugc nofollow" target="_blank">发送电子邮件</a>，或者创建HTTP端点。由于新服务提供商和无数API的力量，构建高性能的应用程序已经变成了一个连接点的游戏，而不是从头开始构建一切。</p><p id="2e16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我想分享如何在<a class="ae kl" href="https://www.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>上创建和部署一个可伸缩的静态站点，以及如何使用无服务器功能通过<a class="ae kl" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a>发送文本消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/6462ae7f68bc13288f50e7a319036189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1Hd1fDJCSYuZugHYV0QBA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">8-bit-revolution.netlify.com截图</figcaption></figure><p id="80ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在<a class="ae kl" href="https://8-bit-revolution.netlify.com/" rel="noopener ugc nofollow" target="_blank">8-bit-revolution.netlify.com</a>上看到最终结果。你可以去那里，通过短信告诉我你有多爱那个好的老8位风格。如果你想建立一个类似“8位革命”的网站，你可以看看<a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution" rel="noopener ugc nofollow" target="_blank">项目的自述</a>。它包括一个一键式安装按钮，你可以自己创建一个短信发送网站。在设置中，您可以配置收件人的电话号码和您要发送的文本。</p><p id="f2d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想继续下去，想了解它是如何工作的，你需要做的是:</p><ul class=""><li id="6e3e" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">一个<a class="ae kl" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank"> Twilio </a>账户</li><li id="39c0" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">净收益账户</li><li id="29f9" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">GitHub的一个账户</li><li id="546d" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated"><a class="ae kl" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>已安装</li></ul><h1 id="8d01" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">为什么是静态？</h1><p id="c8b9" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">HTML为web提供了动力，静态服务HTML有几个优点。静态站点更安全，因为涉及的计算更少。HTML是预先生成的，文件可以从服务器一对一地提供，这减少了攻击媒介的数量。另外，静态网站很便宜。GitHub pages和其他服务提供商主要免费提供静态站点托管。最后，静态站点是可伸缩的。在服务器端提供静态文件不需要太多的计算能力，如果你需要的话，你可以在你的网站前快速放置一个CDN，为你数百万的访问者提供服务。</p><p id="ef17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不过，手工编写数百个普通的HTML页面可能会很麻烦。这就是为什么构建工具和静态站点生成器已经成为一种常见的实践。这些工具将模板与降价文件或API数据结合起来生成静态HTML。</p><p id="fd9c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这导致需要更复杂的设置。服务器需要生成HTML，然后将HTML上传到您的静态站点主机。这就是TravisCI这样的持续集成系统(CI)发挥作用的地方。这些服务允许您在推送代码更新或内容更新时重建您的站点。</p><h1 id="82d0" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">Netlify是您的CI、CDN和无服务器平台</h1><p id="105f" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">Netlify是一个相当新的服务，它解决了这个日益复杂的问题。你定义一个目录和一个构建脚本，他们负责创建你的网站，并把它放到全球内容交付网络上。您可以使用额外的功能，如无服务器功能或表单，通过额外的功能来丰富您的静态站点，所有这些都包含在一个平台中。</p><p id="48ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">听起来不错？我们开始吧！</p><h1 id="543d" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">创建你的静态网站</h1><p id="55be" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">创建一个新目录并包含一个<code class="fe mt mu mv mw b">dist</code>子目录。<code class="fe mt mu mv mw b">dist</code>将保存应由Netlify部署的所有文件。你可以在那里放一个类似下面的<code class="fe mt mu mv mw b">index.html</code>文件，你就可以开始了。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="d297" class="nb lr iq mw b gy nc nd l ne nf">&lt;!doctype html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;8-bit revolution&lt;/title&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;meta name="theme-color" content="#fafafa"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;p&gt;8-bit rocks!&lt;/p&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="d94c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，您必须定义一个在部署站点时应该运行的命令。在项目目录中初始化新的npm项目。</p><p id="883c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">--yes</code>标志允许您在创建新项目时跳过通常与npm一起提供的调查问卷。该命令创建一个新的<code class="fe mt mu mv mw b">package.json</code>，它是Node.js项目的配置文件。让我们添加一个虚拟构建命令，该命令只将日志消息回显到包含的JSON对象的<code class="fe mt mu mv mw b">scripts</code>属性中。</p><p id="0612" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的<code class="fe mt mu mv mw b">package.json</code>应该如下所示:</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="24f8" class="nb lr iq mw b gy nc nd l ne nf">{<br/>  "name": "8-bit-revolution-tut",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "index.js",<br/>  "scripts": {<br/>    "build": "echo \"Building your new static site!\""<br/>  },<br/>  "repository": {<br/>    "type": "git",<br/>    "url": "git+https://github.com/stefanjudis/8-bit-revolution-tut.git"<br/>  },<br/>  "keywords": [],<br/>  "author": "stefan judis &lt;sjudis@twilio.com&gt;",<br/>  "license": "MIT",<br/>  "bugs": {<br/>    "url": "https://github.com/stefanjudis/8-bit-revolution-tut/issues"<br/>  },<br/>  "homepage": "https://github.com/stefanjudis/8-bit-revolution-tut#readme"<br/>}</span></pre><p id="7a77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">注意:名称、存储库、作者、bug和主页属性会因用户和项目而异。</em></p><p id="3d54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在终端中使用<code class="fe mt mu mv mw b">npm run</code>后跟属性名来运行所有已定义的<code class="fe mt mu mv mw b">script</code>属性。执行<code class="fe mt mu mv mw b">npm run build</code>将记录“构建你的新静态站点！”到终点站。这还不算多，在本教程的后面部分，您将向该脚本添加更多的功能。</p><p id="6c3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://help.github.com/en/articles/adding-an-existing-project-to-github-using-the-command-line" rel="noopener ugc nofollow" target="_blank">在你的项目根中初始化git，并将其推送到一个新的GitHub存储库中。</a></p><p id="448b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这两个文件提交并推送到GitHub后，就可以部署站点了。转到Netlify，登录，点击“从Git新建站点”,将您的存储库与Netlify连接起来。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/33343439e9b4465728ce54f7940c3db0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YCQt9Zw8t3Vfz-XdFLOy7A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">网络管理区的站点概述</figcaption></figure><p id="4bc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连接GitHub后，你可以选择你新创建的库。Netlify会询问您应该部署哪个分支和目录，以及在部署过程中要执行哪个脚本。在这种情况下，将是<code class="fe mt mu mv mw b">master</code>、<code class="fe mt mu mv mw b">dist</code>和<code class="fe mt mu mv mw b">npm run build</code>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/6d613c6977e587295c147b7b662d8ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0ZcBf1t9WGU5Xy4fm15roA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">用于在网络管理区定义构建脚本和文件夹的新站点对话框</figcaption></figure><p id="d617" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按下“部署网站”,看到你的静态网站进入互联网。部署只需要几秒钟，可以在Netlify的<code class="fe mt mu mv mw b">frosty-mclean-c6c41c</code>这样的随机子域上使用。如果你愿意，你也可以改变这个子域或者连接<a class="ae kl" href="https://www.netlify.com/docs/custom-domains/" rel="noopener ugc nofollow" target="_blank">你自己的域</a>。🎉</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/c58866c3022b56eb2e66f0b0636cbd5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6J8AlE2sBBcjtgl1XL2jw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">首次成功部署</figcaption></figure><p id="153c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">恭喜你。点击“部署站点”,您将建立一个新的部署管道。</p><p id="b37b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Netlify和GitHub连接最酷的一点是，每当你向GitHub推送新代码时，Netlify都会通过<a class="ae kl" href="https://en.wikipedia.org/wiki/Webhook" rel="noopener ugc nofollow" target="_blank"> webhooks </a>得到通知，并自动部署你的站点。它还准备好接受来自您使用的任何系统的请求，以便您可以在不同的事件之后触发重建，例如在<a class="ae kl" href="https://headlesscms.org/" rel="noopener ugc nofollow" target="_blank">远程内容管理系统</a>中更新内容。</p><h1 id="26c1" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">添加允许用户输入的表单</h1><p id="a718" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">对于发送消息的情况，静态HTML是不够的。您必须添加一种方式来允许用户输入，如按下按钮或输入数据。幸运的是，Netlify提供了<a class="ae kl" href="https://www.netlify.com/docs/form-handling/" rel="noopener ugc nofollow" target="_blank">内置的表单处理</a>。替换“8位岩石！”具有以下形式的段落。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="2330" class="nb lr iq mw b gy nc nd l ne nf">&lt;form name="contact" class="form" method="POST" data-netlify="true"&gt;<br/>    &lt;h1&gt;Wanna spread the word?&lt;/h1&gt;<br/>    &lt;button class="btn" type="submit"&gt;Send messages!&lt;/button&gt;<br/>&lt;/form&gt;</span></pre><p id="cab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">表单必须包含一个<code class="fe mt mu mv mw b">data-netlify=”true”</code>属性。这告诉Netlify您希望表单提交由他们的服务器处理。提交并推送代码。等待部署完成，瞧，您现在可以处理表单提交了！</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/0dae73537b90198f905f3d56a652b4de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5yC2qR0Czxt58CzLNQrbA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">首先部署包括表单和按钮</figcaption></figure><p id="7cf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有提交表格的数据将在网络管理区的“表格”下提供。这使得它非常适合从联系人表单等收集数据。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/1ca18c9a7983bf968d9977e0f6fb4fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmbdTE97JxrRBAnt-9M90Q.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">网络表单提交成功对话框</figcaption></figure><p id="3a2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个阶段，当您提交表单时，Netlify将向您显示一条通用的成功消息，告诉您它已收到表单提交。您可以通过定义一个页面来改变这种情况，该页面应该使用表单元素上的<code class="fe mt mu mv mw b">action</code>属性重定向到该页面。</p><p id="2ebd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我更喜欢通过JavaScript提交表单，以避免重定向。</p><h1 id="19f7" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">使用Ajax提交表单</h1><p id="09a9" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">通过实现全球可用的<code class="fe mt mu mv mw b"><a class="ae kl" href="https://developers.google.com/web/updates/2015/03/introduction-to-fetch" rel="noopener ugc nofollow" target="_blank">fetch</a></code>方法，您可以直接在浏览器中发出请求，而不需要添加任何依赖项。</p><p id="62e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在开始实现Ajax功能之前，向页面添加两个HTML元素。这些元素将指示表单提交请求的成功或错误。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="1b00" class="nb lr iq mw b gy nc nd l ne nf">&lt;p class="successMsg" role="alert" hidden&gt;Messages sent...&lt;/p&gt;<br/>&lt;p class="errorMsg" role="alert" hidden&gt;Something went wrong...&lt;/p&gt;</span></pre><p id="8c0f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在页面底部添加一个内嵌的<code class="fe mt mu mv mw b">script</code>元素。使用原生DOM方法，您可以监听表单的提交事件，并应用定制功能，如发出AJAX请求。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="4281" class="nb lr iq mw b gy nc nd l ne nf">&lt;script&gt;<br/>  const form = document.querySelector('form');<br/>  form.addEventListener('submit', async event =&gt; {<br/>    event.preventDefault();<br/>    <br/>    // disable button to prevent multiple submissions<br/>    form.querySelector('button').disabled = true;<br/><br/>    // make the request to submit the form<br/>    try {<br/>      const response = await fetch('/', {<br/>        method: 'post',<br/>        headers: {<br/>          'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8'<br/>        },<br/>        // parse and submit all included form data<br/>        body: new URLSearchParams(new FormData(form)).toString()<br/>      });<br/><br/>      // if it was successful show success message<br/>      if (response.status === 200) {<br/>        document.querySelector('.successMsg').hidden = false;<br/>      } else {<br/>        document.querySelector('.errorMsg').hidden = false;<br/>      }<br/>    } catch (e) {<br/>      console.error(e);<br/>    }<br/>  });<br/>&lt;/script&gt;</span></pre><p id="af1c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mt mu mv mw b">fetch</code>方法返回<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">一个承诺</a>。如果<a class="ae kl" href="https://caniuse.com/#feat=async-functions" rel="noopener ugc nofollow" target="_blank">你的浏览器支持允许的话</a>你可以使用一个<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank">异步函数</a>作为提交处理程序来避免回调和然后链与<code class="fe mt mu mv mw b">await</code>和<code class="fe mt mu mv mw b">try/catch</code>的结合。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/f7ff5ce7dfb221568e0dc8fdcde2922e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqaEkgERcRUwmHVzpaNfMA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">表单提交，带有启用ajax的成功消息</figcaption></figure><p id="756e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">推送代码并等待部署。当您测试表单提交时，您将看到表单提交工作正常，并且站点向您显示一条成功消息，但是它还没有发送任何消息。</p><p id="1723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你实现SMS发送部分之前，让我们把8位风格带回网站。从范例库中复制<a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution/blob/master/dist/styles.css" rel="noopener ugc nofollow" target="_blank">样式，并将它们粘贴到您的<code class="fe mt mu mv mw b">dist</code>目录中的一个新文件<code class="fe mt mu mv mw b">styles.css</code>中。此外，添加一个指向Google字体的链接，该字体在刚刚粘贴到<code class="fe mt mu mv mw b">index.html</code>的样式</a>中被引用<a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution/blob/master/dist/styles.css#L26" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="9b90" class="nb lr iq mw b gy nc nd l ne nf">&lt;head&gt;<br/>  &lt;meta charset="utf-8"&gt;<br/>  &lt;title&gt;8-bit revolution&lt;/title&gt;<br/>  &lt;!-- reference the new stylesheet --&gt;<br/>  &lt;link rel="stylesheet" href="/styles.css" /&gt;<br/>  &lt;!-- load Google Font to get get a nice 8-bit font --&gt;<br/>  &lt;link<br/>    href="https://fonts.googleapis.com/css?family=Maven+Pro|Yrsa|Press+Start+2P"<br/>    rel="stylesheet"<br/>  /&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;meta name="theme-color" content="#fafafa"&gt;<br/>&lt;/head&gt;</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/420e8da7635ee64204248a60c9e60309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5GIAUTvhGwyTlo5YwmAsWA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">8位风格的已部署站点</figcaption></figure><p id="d9c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不算太差！现在你的网站看起来不错，而且是“8位”的，让我们来实现SMS功能。</p><h1 id="4ba7" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">使用无服务器功能响应提交的表单</h1><p id="aa48" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">当用户提交表单时，除了Netlify存储表单数据之外，什么都不会发生。要实现SMS发送功能，您可以使用Netlify提供的<a class="ae kl" href="https://www.twilio.com/docs/glossary/what-is-serverless-architecture" rel="noopener ugc nofollow" target="_blank">无服务器功能</a>。建议使用<a class="ae kl" href="https://www.npmjs.com/package/netlify-lambda" rel="noopener ugc nofollow" target="_blank">netlify-lambda NPM包</a>来创建这些函数。通过命令行安装软件包。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="063b" class="nb lr iq mw b gy nc nd l ne nf">npm install --save netlify-lambda</span></pre><p id="9310" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng"> netlify-lambda </em>内联函数中包含的所有依赖项，这样它们就可以在netlify环境中执行。创建一个名为<code class="fe mt mu mv mw b">functions</code>的目录并添加一个JavaScript文件<code class="fe mt mu mv mw b">submission-created.js</code>。<a class="ae kl" href="https://www.netlify.com/docs/functions/#event-triggered-functions" rel="noopener ugc nofollow" target="_blank"> Netlify遵循命名约定在特定事件后运行函数</a>。此外，您还可以为函数文件指定一个不在列表中的名称，以启动新的HTTP端点。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="9e89" class="nb lr iq mw b gy nc nd l ne nf">// submission-created.js<br/>exports.handler = function(event, context, callback) {<br/>  console.log('Submission created!')<br/>};</span></pre><p id="4395" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在生成函数之前，您必须定义存储函数的目录。在项目根目录下创建一个<code class="fe mt mu mv mw b">netlify.toml</code>文件。定义<code class="fe mt mu mv mw b">[build]</code>属性，并包含您生成的准备运行的函数将存储在<code class="fe mt mu mv mw b">.functions</code>目录中的配置。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="037f" class="nb lr iq mw b gy nc nd l ne nf">[build]<br/>  functions = ".functions"</span></pre><p id="9001" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在部署期间，调整您的<code class="fe mt mu mv mw b">package.json</code>来构建您的无服务器功能。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="6d08" class="nb lr iq mw b gy nc nd l ne nf">{<br/>  "scripts": {<br/>      "build": "netlify-lambda build functions"<br/>    } <br/>}</span></pre><p id="c57c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您在本地运行<code class="fe mt mu mv mw b">npm run build</code>时，它会生成一个新的<code class="fe mt mu mv mw b">.functions</code>目录，其中包含可以在Netlify上运行的函数。新的<code class="fe mt mu mv mw b">.functions</code>目录包含生成的代码，可能不值得签入git并推送到GitHub。确保创建一个包含生成目录的<code class="fe mt mu mv mw b">.gitignore</code>文件。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="2922" class="nb lr iq mw b gy nc nd l ne nf"># .gitignore<br/># generated functions<br/>.functions</span></pre><p id="8580" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过这些调整，您可以提交并推送至GitHub。Netlify将自动部署网站，包括当有人提交表单时运行的功能。</p><p id="858e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你提交表格告诉世界关于8位的信息并进入Netlify的函数日志时，你会看到“提交已创建！”消息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/f866e5b28a7619827c5a83639974d64a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghBAYILK9W6DX9hw-9n9Xw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">网络管理区中的功能日志</figcaption></figure><h1 id="aeae" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">在无服务器功能下发送短信</h1><p id="2803" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">此时，您的函数已经准备好响应表单提交，您可以开始发送文本消息了。要使用Twilio发送消息，您必须定义敏感信息，如您的帐户SID、帐户令牌以及您要向其发送消息的人的电话号码。确保这些不会成为公共的git库。</p><p id="2daa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mt mu mv mw b">npm install --save dotenv</code>安装<a class="ae kl" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a>包。它允许您从根目录下的<code class="fe mt mu mv mw b">.env</code>文件中读取配置变量，并通过<code class="fe mt mu mv mw b">process.env</code>在您的无服务器功能中访问它们。创建<code class="fe mt mu mv mw b">.env</code>文件，将其包含在您的<code class="fe mt mu mv mw b">.gitignore</code>中，并定义以下值，用您自己的值替换它们:</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="5a6d" class="nb lr iq mw b gy nc nd l ne nf">TWILIO_ACCOUNT_SID = “YOUR-TWILIO-ACCOUNT-SID”<br/>TWILIO_AUTH_TOKEN = “YOUR-TWILIO-AUTH-TOKEN”<br/>BOT_NUMBER = “YOUR-BOUGHT-TWILIO-NUMBER”<br/>BOT_MESSAGE = "YOUR-MESSAGE"<br/>CONTACT_NUMBERS = "NUMBERS-THAT-SHOULD-RECEIVE-A-MESSAGE"</span></pre><p id="5f20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要获得所有这些值，<a class="ae kl" href="https://www.twilio.com/console/" rel="noopener ugc nofollow" target="_blank">登录Twilio </a>。您可以在仪表板中找到您的帐户SID和身份验证令牌。auth令牌是非常敏感的信息，因为它可以授予与当前用户相同的访问权限。我建议在继续之前，掌握一些最佳实践来保证您的auth token 的安全。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/9c5db73c38f8300fb8d24f5995896f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1HTAngjTD1SaYmbuJNyFuA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Twilio控制台，包括帐户sid和令牌</figcaption></figure><p id="d94f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，你需要<a class="ae kl" href="https://www.twilio.com/console/phone-numbers/search" rel="noopener ugc nofollow" target="_blank">购买一个Twilio电话号码</a>。确保你买一个有短信功能的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/66b54c08f8e8d51b3f3a859823405309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0SECK74aTKoBVS-X6aheNw.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Twilio控制台购买号码对话框</figcaption></figure><p id="cf1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">购买号码后，您可以自己在配置文件中定义要发送的消息和收件人的号码。</p><p id="5848" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的<code class="fe mt mu mv mw b">.env</code>文件应该是这样的:</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="3432" class="nb lr iq mw b gy nc nd l ne nf">TWILIO_ACCOUNT_SID = "AC..."<br/>TWILIO_AUTH_TOKEN = "a8..."<br/>BOT_NUMBER = "+4915735982595"<br/>BOT_MESSAGE = "8-bit rocks!"<br/>CONTACT_NUMBERS = "+491761234567;+49170987654"</span></pre><p id="4094" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">调整您的函数以访问上面定义的值。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="3409" class="nb lr iq mw b gy nc nd l ne nf">// submission-created.js<br/>// load the env file and make values accessible via process.env<br/>require('dotenv').config();<br/><br/>const {<br/>  TWILIO_ACCOUNT_SID,<br/>  TWILIO_AUTH_TOKEN,<br/>  CONTACT_NUMBERS,<br/>  BOT_NUMBER,<br/>  BOT_MESSAGE<br/>} = process.env;<br/><br/>exports.handler = function(event, context, callback) {<br/>  console.log('Submission created!')<br/>  // the logic for sending the message will go here<br/>};</span></pre><p id="ac23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在命令行上安装Twilio helper库。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="b2c7" class="nb lr iq mw b gy nc nd l ne nf">npm install --save twilio</span></pre><p id="4a98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了Twilio helper库，您现在可以发送文本消息了。替换日志消息并添加以下内容。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="06e1" class="nb lr iq mw b gy nc nd l ne nf">// submission-created.js<br/><br/>// ...<br/>// 👆 dotenv and process.env handling as above<br/><br/>// initialize the helper library client<br/>const client = require('twilio')(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN);<br/><br/>exports.handler = function(event, context, callback) {<br/>  Promise.all(<br/>    // split the string of several messages into single numbers<br/>    // send message to each of them<br/>    CONTACT_NUMBERS.split(';').map(num =&gt; {<br/>      return client.messages.create({<br/>        from: BOT_NUMBER,<br/>        to: num,<br/>        body: BOT_MESSAGE<br/>      });<br/>    })<br/>  )<br/>    .then(() =&gt; callback(null, { statusCode: 200, body: 'Created' }))<br/>    .catch(e =&gt; {<br/>      console.log(e);<br/>      callback(e);<br/>    });<br/>};</span></pre><p id="e35d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要在本地运行您的函数，向<code class="fe mt mu mv mw b">package.json</code>添加一个<code class="fe mt mu mv mw b">serve</code>命令来启动本地开发服务器。</p><pre class="kn ko kp kq gt mx mw my mz aw na bi"><span id="4825" class="nb lr iq mw b gy nc nd l ne nf">{<br/>  "scripts": {<br/>      "serve": "netlify-lambda serve functions"<br/>    } <br/>}</span></pre><p id="c857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的<code class="fe mt mu mv mw b">netlify-lambda</code>命令将构建并生成您的函数，并打开一个HTTP端点。如果你运行<code class="fe mt mu mv mw b">npm run serve</code>然后打开<a class="ae kl" href="http://localhost:9000/submission-created" rel="noopener ugc nofollow" target="_blank">http://localhost:9000/submission-created</a>它会运行你的函数并发送短信。🎉</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/80875f5919a26a3040c321bb27ab06be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSJjxdM8YPD_kbPRoccw0A.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Netlify函数的“已创建”响应</figcaption></figure><p id="a8ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提交和推送新功能，并等待部署。但是等一下…当你试着在已部署的网络生活网站上按下按钮发送短信时，你会发现它还不能工作。还记得你把你的<code class="fe mt mu mv mw b">.env</code>文件放到<code class="fe mt mu mv mw b">.gitignore</code>里吗？</p><p id="a13d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe mt mu mv mw b">.env</code>文件与环境变量结合使用是避免泄露凭证的常见做法。使用<code class="fe mt mu mv mw b">dotenv</code>,您可以确保您的应用程序既可以使用已定义的环境变量，也可以使用<code class="fe mt mu mv mw b">.env</code>配置文件。本地<code class="fe mt mu mv mw b">dotenv</code>读取<code class="fe mt mu mv mw b">.env</code>文件并将值放入<code class="fe mt mu mv mw b">process.env</code>中。在生产中–您必须自己在<code class="fe mt mu mv mw b">process.env</code>中定义这些环境变量。这样就不用把凭证放在公共场所了。</p><p id="a4b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在网络管理区域的“构建”、“构建设置”和“构建环境变量”下定义环境变量。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nh"><img src="../Images/7f7ec83afb8514cd88e16ad293340274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IpQJAUAe8ig7NqJ_FO48sA.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">在网络管理用户界面中定义的环境变量</figcaption></figure><p id="15fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保存值并触发新的构建。现在点击按钮，将显示您的所有收件人，你爱8位。🎉</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ni"><img src="../Images/e294e57a410996fef257c4cc7173436c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-NZnkaFzlAokT5G7aDUy7A.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">android短信对话框中收到的消息</figcaption></figure><p id="f7d5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在GitHub 上找到最终的功能实现<a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution/blob/master/functions/submission-created.js" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="e359" class="lq lr iq bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">结论</h1><p id="8486" class="pw-post-body-paragraph jn jo iq jp b jq mo js jt ju mp jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在本教程中，您学习了如何使用Netlify部署静态站点，使用无服务器功能丰富您的站点，以及使用Twilio发送SMS。</p><p id="bc4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们生活的API驱动的世界中，无服务器函数是完美的连接器。他们可以连接服务，接受网页挂钩，甚至回复短信。</p><p id="20cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我知道你发了什么信息。你可以在GitHub 上找到<a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution" rel="noopener ugc nofollow" target="_blank">完整的代码。它包括</a><a class="ae kl" href="https://github.com/stefanjudis/8-bit-revolution/blob/master/dist/index.html#L77-L91" rel="noopener ugc nofollow" target="_blank">一个更复杂的表单提交流程</a>，你可能想看看。</p><p id="0b8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有任何问题，请通过以下渠道联系我们:</p><ul class=""><li id="c0a2" class="lc ld iq jp b jq jr ju jv jy le kc lf kg lg kk lh li lj lk bi translated">邮箱:【sjudis@twilio.com T4】</li><li id="2c97" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">Github: <a class="ae kl" href="https://github.com/stefanjudis" rel="noopener ugc nofollow" target="_blank"> stefanjudis </a></li><li id="aa01" class="lc ld iq jp b jq ll ju lm jy ln kc lo kg lp kk lh li lj lk bi translated">推特:<a class="ae kl" href="https://twitter.com/stefanjudis" rel="noopener ugc nofollow" target="_blank"> @stefanjudis </a></li></ul></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="0315" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">原载于</em><a class="ae kl" href="https://www.twilio.com/blog/a-how-to-send-text-messages-from-your-static-site-using-netlify-twilio-and-serverless-functions" rel="noopener ugc nofollow" target="_blank"><em class="ng">www.twilio.com</em></a><em class="ng">。</em></p></div></div>    
</body>
</html>