<html>
<head>
<title>5 Steps to Apply TDD More Effectively in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中更有效地应用TDD的5个步骤</h1>
<blockquote>原文：<a href="https://itnext.io/5-steps-to-apply-tdd-more-effectively-in-react-c7b56978153b?source=collection_archive---------4-----------------------#2022-10-09">https://itnext.io/5-steps-to-apply-tdd-more-effectively-in-react-c7b56978153b?source=collection_archive---------4-----------------------#2022-10-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a07b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我将分享在日常工作流程中应用测试驱动开发的五个简单步骤。我相信这些步骤可以帮助你成为一个更好的开发者，我的意思是，一个更好的开发者。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9076a229be9bf94ceb783faad06eb84b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JfpxvGkCRNFalWvO"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">由<a class="ae lb" href="https://unsplash.com/@geraldine_lewa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">杰拉尔丁·莱瓦</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="0103" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我知道这个话题相当值得商榷，我也不想就做不做TDD展开一场战争。我是一名从业者，并从中看到了价值，我试图向人们展示他们如何从中受益，你不必遵循所有的步骤来为你的常规工作流程增加价值。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="3024" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你有兴趣深入这个主题，我已经创建了<a class="ae lb" href="https://icodeit.thinkific.com/courses/test-driven-development-with-react" rel="noopener ugc nofollow" target="_blank">免费在线课程</a>，涵盖了本帖中讨论的所有主题以及更多内容。本课程旨在互动、吸引人，并包含实用的技巧和技术。课程结束时，你将对这门学科有一个扎实的理解，并能够在日常生活中运用所学。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="25c2" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">1.任务分配</h1><p id="e7b6" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">在本文中，我们将使用<code class="fe mm mn mo mp b">Buy Some Milk</code>作为示例，如果您想了解更多关于实现的细节，<a class="ae lb" href="https://youtube.com/playlist?list=PLv8UD0lNnLNKTXyhs9Z3PEh3bon0ZNxqd" rel="noopener ugc nofollow" target="_blank">这里是它的视频</a>。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/a24f11f8a647beb61521fd8b6d5a3e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mav759iwExO6BUUOq9ofw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">买些牛奶应用</figcaption></figure><p id="dba1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多任务根本不起作用，尤其是在编码方面。我们的大脑被设计成一次只专注于一件事，而且只专注一小段时间。因此，要解决复杂的问题，无论是性能测量、重构遗留代码，还是实现复杂的逻辑，我们都需要将其分割成更小、更易管理的部分。</p><p id="9a8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个典型的用户故事(一个特性的子集)通常是一个复杂的问题，我们需要分解它们，分解的过程在这里被称为任务分配。</p><p id="0e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是关键的一环，必须做好。但是不要害怕。像其他事情一样，你只需要一些练习。</p><p id="7198" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为程序员，我们自然会想到相对更深层次的问题，比如如果用户在字段中输入了一些无效文本，如果网络不稳定，如果用户在web应用程序上开始订购并被中断，然后决定在手机上继续订购，又会怎么样？需要考虑的场景很多，很难一下子全部想到。</p><p id="6b0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是为什么我们需要一个任务列表来指导我们，让我们知道我们在哪里，还剩下多少项目来完成这个故事，我们可以将剩余的内容转移到更紧急的事情上等等。换句话说，我们需要战略性地考虑任务分配。</p><h1 id="6625" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">任务</h1><p id="bd3c" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">每项任务一般应遵循<code class="fe mm mn mo mp b">S.M.A.R.T</code>原则，</p><ul class=""><li id="fa48" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">具体——任务必须具体说明必须做什么</li><li id="4657" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">可测量——应该有一些测试可以验证任务的成功</li><li id="50f1" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">可实现——显然，我们不能做超出我们能力的事情</li><li id="8514" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">相关-任务应该链接到我们试图实现的内容，用户登录令牌可能不会直接链接到产品列表。</li><li id="ca24" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">时间限制——我们应该留意它已经使用了多长时间。长任务可能表示任务过大或无法完成。</li></ul><p id="ab66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，根据S.M.A.R.T原则，不难为我们的示例<code class="fe mm mn mo mp b">Buy Some Milk</code>列出一个任务列表:</p><ul class=""><li id="a922" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">呈现项目</li><li id="f861" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">呈现多个项目</li><li id="4af5" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">添加待办事项</li><li id="2c71" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">添加项目后清理输入框</li><li id="8a5f" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">将项目标记为完成</li></ul><h1 id="a8fe" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">2.编写一个失败的测试</h1><p id="2752" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">所以第一步是编写一个失败的测试。</p><h1 id="78a6" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">确保测试机制正常工作</h1><p id="dd40" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如果您要向现有代码添加测试，确保测试与产品代码相关联是很重要的。比如跑步者在听<code class="fe mm mn mo mp b">__tests__/*.test.tsx</code>，当你加了一个<code class="fe mm mn mo mp b">Todo.spec.tsx</code>，那么就会被忽略。当测试通过时，你可能会被误导，继续进行大的重构，直到为时已晚。</p><p id="b667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，我经常做的一个检查(我知道很多其他程序员也在做)是尽力破坏现有的测试。例如，给定当前的<code class="fe mm mn mo mp b">calculate.test.ts</code>正在通过，我改变<code class="fe mm mn mo mp b">calculate.ts</code>中的一些逻辑来查看测试是否失败。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/ad4e4578af4bbae02219a56d83f6a424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hS39gHElkeEAY2Xq5De8Sg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">添加功能</figcaption></figure><p id="f757" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mm mn mo mp b">calculate</code>中，我将<code class="fe mm mn mo mp b">add</code>修改为:</p><pre class="km kn ko kp gt nl mp nm nn aw no bi"><span id="82ea" class="np lk iq mp b gy nq nr l ns nt">export const add = (x, y) =&gt; x - y;</span></pre><p id="b79c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果代码失败，我知道<code class="fe mm mn mo mp b">test</code>和<code class="fe mm mn mo mp b">implementation</code>是连接的，然后我可以通过添加更多来增强测试(别忘了把它改回来:)。</p><h1 id="ad4e" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">编写测试</h1><p id="1173" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">请记住，始终从消费者的角度进行测试。几年前，当<code class="fe mm mn mo mp b">enzyme</code>在<code class="fe mm mn mo mp b">React</code>社区非常流行时，最大的缺点是它倾向于测试内部状态而不是行为。</p><p id="9207" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，使用<code class="fe mm mn mo mp b">enzyme</code>，您可能有如下代码:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/3784fec3cc7e51e1f215f6fd61b7983c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJR46TuVE5F6OmN_22sD8A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用酶进行测试</figcaption></figure><p id="f2ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是使用<code class="fe mm mn mo mp b">react-testing-library</code>，测试更加关注组件的行为，而不是内部状态。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nv"><img src="../Images/bcfa76a880f1f0a8521b4c62baff5a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WGKaFVo89bssztp3LOaagw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">反应-测试-测试行为库</figcaption></figure><p id="5b3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意这里的API，<code class="fe mm mn mo mp b">getByText</code>会检查DOM是否有这个内容(就像真正的用户在浏览器中会做的一样)，以及<code class="fe mm mn mo mp b">toBeInTheDocument</code>，焦点转移到消费者(而不是开发者)。</p><p id="a863" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你写测试的时候，尽可能的描述行为。并验证业务价值，而不是内部状态。</p><h1 id="28d4" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">3.用最少的努力修复测试</h1><p id="15c1" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">在这一步，你的首要任务应该是修复测试，而不是让代码看起来优秀或优雅。俗话说，<strong class="jp ir">做得好不如做得完美</strong>。</p><p id="aab7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幻数、内联函数、嵌套if-else等。在这个阶段一切都很好。</p><p id="1314" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是不要就此打住。一旦你通过了测试(或再次通过)，寻找机会改进它们。</p><h1 id="45ec" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">4.尽可能重构</h1><p id="44e2" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">马丁·福勒在他的书<strong class="jp ir">重构:改进现有代码的设计</strong>中，对重构有几个定义:</p><blockquote class="nw nx ny"><p id="9121" class="jn jo nz jp b jq jr js jt ju jv jw jx oa jz ka kb ob kd ke kf oc kh ki kj kk ij bi translated"><em class="iq">重构(名词):在不改变其可观察行为的情况下，对软件内部结构进行的改变，使其更容易理解，修改成本更低。</em></p></blockquote><p id="c911" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和</p><blockquote class="nw nx ny"><p id="5f16" class="jn jo nz jp b jq jr js jt ju jv jw jx oa jz ka kb ob kd ke kf oc kh ki kj kk ij bi translated">重构(动词):通过应用一系列重构来重构软件，而不改变其可观察到的行为。重复上述步骤，直到完成所有任务，然后进入下一步。</p></blockquote><p id="ec05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的要点是:</p><ol class=""><li id="6321" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk od nc nd ne bi translated">在不改变其可见行为的情况下进行更改</li><li id="1326" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk od nc nd ne bi translated">一系列(较小的)变化</li></ol><p id="609b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在重构过程中，您应该观察测试状态。一旦你完成了重构(重命名、将变量提取为常量或者将代码片段提取为函数)，它们应该总是处于<code class="fe mm mn mo mp b">passing</code>状态。此外，保持每个变化小。一旦我做了一些重构并且测试通过，我通常会进行本地提交。如果您担心多个提交，您总是可以在推送到remote之前挤压它们。</p><p id="ec37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他在他的第二版书中也定义了46个重构。如果你还没有，请在这里停下来，去阅读它。你会被赏识的，不客气。</p><p id="590c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以基本上，你需要识别你的<em class="nz">快速和肮脏的</em>实现中的代码味道，并使用书中讨论的重构使其更容易理解。</p><p id="c982" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能也想阅读我的其他帖子<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/react-clean-code-f7b7946cb9d3">这里</a>一些<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/7-react-clean-code-tips-you-should-know-846b8108fc46">干净代码提示</a>。</p><p id="b160" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对重构后的代码感到满意后，可以重复开始列表中的下一个任务，并遵循步骤2-4，直到完成所有任务。</p><h1 id="6519" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">5.要求同行评审</h1><p id="6ee0" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">起初，我并不热衷于同行评审，但是当我意识到其他开发人员，甚至是初级开发人员，可以给我很好的建议，并惊讶于我可以从中学到很多东西时，现在这是我将代码合并到master之前的默认操作。</p><p id="6cf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我更喜欢走一遍(5-10分钟)来讨论背景、挑战以及我如何解决它们。当我走查的时候，我经常得到一些很棒的建议，这些建议可以使代码更清晰、更容易理解。</p><p id="c322" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了这些建议，同行评审还有其他好处:</p><ul class=""><li id="b22e" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">与团队分享领域知识</li><li id="3170" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">了解其他人是如何看待这个问题的</li><li id="844b" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">讨论其他人可以使用的通用设计模式</li></ul><h1 id="193b" class="lj lk iq bd ll lm mr lo lp lq ms ls lt lu mt lw lx ly mu ma mb mc mv me mf mg bi translated">摘要</h1><p id="d27b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">同样，这不是一篇关于我们是否应该做TDD的文章。更重要的是你是否愿意尝试。你可以按照这些步骤，看看效果如何。这五个简单而有力的步骤是我的常规工作流程，我几乎在所有的任务中都这样做。我认为这让我和我的同事们在不同的项目中受益匪浅。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="fe25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果觉得有用，这里有一个<a class="ae lb" href="https://icodeit.ck.page/5-steps-tdd" rel="noopener ugc nofollow" target="_blank">可打印版本</a>，喜欢可以下载打印。</p><p id="7766" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你好运，工作愉快。</p></div></div>    
</body>
</html>