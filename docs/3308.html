<html>
<head>
<title>(Basic) Authentication with MicroProfile Rest-Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">(基本)使用MicroProfile Rest客户端进行身份验证</h1>
<blockquote>原文：<a href="https://itnext.io/authentication-with-microprofile-rest-client-d1e9da774f70?source=collection_archive---------3-----------------------#2019-11-19">https://itnext.io/authentication-with-microprofile-rest-client-d1e9da774f70?source=collection_archive---------3-----------------------#2019-11-19</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gm go jp jq jr js gi gj paragraph-image"><div class="gi gj jo"><img src="../Images/2abf7f72fd1a48b1f490e7f68567a24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*zYdmvZ2fgq-2Pn7shGL9zA.png"/></div></figure><p id="92b4" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">Eclipse micro profile<a class="ae kt" href="https://github.com/eclipse/microprofile-rest-client" rel="noopener ugc nofollow" target="_blank">Rest-Client</a>是一款非常棒的软件。到处添加一些注释，你就有了一个类型安全的REST客户端。忘记所有http连接等低级的混乱。让我们来看看一些代码。首先是要调用的接口的定义:</p><pre class="ku kv kw kx gu ky kz la lb aw lc bi"><span id="1b72" class="ld le ir kz b gz lf lg l lh li">@Path("/api/verify")<br/><strong class="kz is">@RegisterRestClient</strong><br/>public interface VerifyEngine {<br/><br/>  @POST<br/>  @Consumes("application/json")<br/>  @Produces("application/json")<br/>  public Msg <strong class="kz is">verify</strong>(Msg policy);<br/>}</span></pre><p id="1983" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">在代码中使用它很简单。让CDI用@Inject @RestClient注入上述客户机，然后像使用任何其他方法调用一样使用它。</p><pre class="ku kv kw kx gu ky kz la lb aw lc bi"><span id="1020" class="ld le ir kz b gz lf lg l lh li">public class PolicyCrudService {<br/><br/>  @Inject<br/>  <strong class="kz is">@RestClient</strong><br/>  VerifyEngine engine;<br/>  <br/>  public Msg verifyTheMessage(Msg msg) {<br/>    return engine.<strong class="kz is">verify</strong>(msg);<br/>  }<br/>}</span></pre><p id="592d" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">如果你看了上面的内容，你可能想知道代码如何知道被调用的服务实际上在哪里。您可以通过MicroProfile config设置基本URL例如，如果您在<a class="ae kt" href="https://quarkus.io/" rel="noopener ugc nofollow" target="_blank"> Quarkus </a>上，则在文件application.properties中:</p><pre class="ku kv kw kx gu ky kz la lb aw lc bi"><span id="51e0" class="ld le ir kz b gz lf lg l lh li"><strong class="kz is">org.acme.VerifyEngine/mp-rest/url</strong>=http://localhost:8083</span></pre><p id="6bb9" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">config键以具有@RegisterRestClient注释的接口的完全限定类名开始。</p><p id="0824" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">现在，一些服务存在于授权检查之后。根据您想要的类型，您也可以通过声明的方式进行设置:</p><pre class="ku kv kw kx gu ky kz la lb aw lc bi"><span id="2974" class="ld le ir kz b gz lf lg l lh li">@Path("/api/verify")<br/>@RegisterRestClient<br/><strong class="kz is">@ClientHeaderParam</strong>(name = "Authorization", value = "{<strong class="kz is">lookupAuth</strong>}")<br/>public interface VerifyEngine {<br/><br/>  default String <strong class="kz is">lookupAuth</strong>() {<br/>    return "Basic " + <br/>         Base64.<em class="lj">getEncoder</em>().encodeToString("user:pass".getBytes());<br/>  }</span></pre><p id="70f3" class="pw-post-body-paragraph jv jw ir jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ik bi translated">当然，您不必硬编码用户名和密码，但是可以通过MicroProfile Config再次获得它们，其中一个ConfigSources可以从Kubernetes秘密中获得它们。</p><h2 id="c27d" class="ld le ir bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">更多？</h2><p id="ed09" class="pw-post-body-paragraph jv jw ir jx b jy mb ka kb kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks ik bi translated">如果你想了解更多关于Eclipse MicroProfile的知识，可以看看我也是合著者的书“<a class="ae kt" href="https://www.packtpub.com/web-development/hands-on-enterprise-java-microservices-with-eclipse-microprofile" rel="noopener ugc nofollow" target="_blank"> <strong class="jx is">用Eclipse MicroProfile </strong> </a>实践企业Java微服务”。</p><figure class="ku kv kw kx gu js gi gj paragraph-image"><div class="gi gj mg"><img src="../Images/b98916f13a93c476031ffe4fc6841dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*2TpxgNcoNpjDKmJeiwWY5g.jpeg"/></div></figure></div></div>    
</body>
</html>