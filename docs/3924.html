<html>
<head>
<title>Immutability With Typescript: boosting refactor process</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Typescript的不变性:提升重构过程</h1>
<blockquote>原文：<a href="https://itnext.io/enforce-immutability-with-typescript-to-boost-refactor-process-70055dac5d52?source=collection_archive---------9-----------------------#2020-03-25">https://itnext.io/enforce-immutability-with-typescript-to-boost-refactor-process-70055dac5d52?source=collection_archive---------9-----------------------#2020-03-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/1a0ceb4991bf54868a803c0bd73d0739.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*PlJzyxv0rRgwLgfqH5o8VA.png"/></div></figure><p id="ea24" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最近我一直在重构我们代码库中的一个巨大模块。</p><p id="054c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重构对组织来说是一个昂贵的过程，这意味着我把我的(昂贵的)时间花在改进已经给该领域带来价值的东西上，而不是创造有助于销售产品的新功能。</p><p id="3621" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但这也意味着，下一次有人需要向模块添加新功能时，花费的时间会比以前少，这也是该过程的好处之一。</p><h2 id="80af" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">重构背后的动机:</h2><ul class=""><li id="423c" class="ll lm iq jw b jx ln kb lo kf lp kj lq kn lr kr ls lt lu lv bi translated">码脱钩，使其<a class="ae lw" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">干</a>，减少WTF规模——使其<a class="ae lw" href="https://en.wikipedia.org/wiki/SOLID" rel="noopener ugc nofollow" target="_blank">实</a></li><li id="14b5" class="ll lm iq jw b jx lx kb ly kf lz kj ma kn mb kr ls lt lu lv bi translated">代码应该为下一个开发人员讲述一个清晰的故事，该开发人员将从我停止的最后一点开始维护或继续(<a class="ae lw" href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle" rel="noopener ugc nofollow" target="_blank">开闭原则</a>)。</li><li id="e080" class="ll lm iq jw b jx lx kb ly kf lz kj ma kn mb kr ls lt lu lv bi translated">提高当前性能。</li><li id="ba9c" class="ll lm iq jw b jx lx kb ly kf lz kj ma kn mb kr ls lt lu lv bi translated"><strong class="jw ir">使向模块添加新功能变得更加容易(再次强调开闭原理)。</strong></li></ul><p id="5397" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">代码重构是一门艺术，也是一个巨大的话题——我不会在这篇文章中深入探讨。</p><h2 id="6603" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">使用<readonly>更快地获得单一来源的事实</readonly></h2><p id="0ae8" class="pw-post-body-paragraph ju jv iq jw b jx ln jz ka kb lo kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">我用遗留代码“继承”的一个实体反映了几个状态(它的每个属性都是一个状态)，这些状态在这么多地方被这么多操作修改了，这真的很难跟踪！</p><p id="d1d7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><a class="ae lw" href="https://www.typescriptlang.org/docs/handbook/utility-types.html#readonlyt" rel="noopener ugc nofollow" target="_blank"><strong class="jw ir">Readonly</strong></a><strong class="jw ir">式来救援！</strong></p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/cb1794d827be9332ae6debaa59906422.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*dLQpNkRrrOua0L4VdZf6MQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">自己做的形象</figcaption></figure><blockquote class="mo"><p id="d000" class="mp mq iq bd mr ms mt mu mv mw mx kr dk translated">构造一个类型，其所有属性设置为T1，这意味着构造的类型的属性不能被重新分配。</p></blockquote><p id="264b" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">由于TS惊人的类型系统(因为我在编译时破坏了代码),通过使该实体不可变，我可以很快跟踪它，并且我修复了代码，使其更具声明性，讲述了一个更清晰的故事。</p><p id="7374" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">后来我发了以下微博:</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="45b0" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">不可变对象定义</h2><blockquote class="mo"><p id="b3ce" class="mp mq iq bd mr ms nj nk nl nm nn kr dk translated">“在<a class="ae lw" href="https://en.wikipedia.org/wiki/Object-oriented_computer_programming" rel="noopener ugc nofollow" target="_blank">面向对象</a>和<a class="ae lw" href="https://en.wikipedia.org/wiki/Functional_programming" rel="noopener ugc nofollow" target="_blank">函数式</a>编程中，不可变对象(不可改变的<a class="ae lw" href="https://en.wikipedia.org/wiki/Immutable_object#cite_note-1" rel="noopener ugc nofollow" target="_blank">【1】</a>对象)是一个<a class="ae lw" href="https://en.wikipedia.org/wiki/Object_(computer_science)" rel="noopener ugc nofollow" target="_blank">对象</a>，它的状态在创建后不能被修改。”</p></blockquote><p id="12da" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">该推文被<a class="ae lw" href="https://www.sentinelone.com/" rel="noopener ugc nofollow" target="_blank"> SentinelOne的</a>天才团队架构师<a class="no np ep" href="https://medium.com/u/2ac9b766143e?source=post_page-----70055dac5d52--------------------------------" rel="noopener" target="_blank"> Benny Yashinovsky </a>查看，他向我提出了以下问题:</p><p id="5fd7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">“琐事问题——给出一个超越并发性的不平凡的理由，其中不变性很重要”</p><h2 id="3718" class="ks kt iq bd ku kv kw dn kx ky kz dp la kf lb lc ld kj le lf lg kn lh li lj lk bi translated">案例研究——更快更容易的重构</h2><p id="3cf1" class="pw-post-body-paragraph ju jv iq jw b jx ln jz ka kb lo kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">以下是我对本尼问题的回答总结:</p><ul class=""><li id="c31c" class="ll lm iq jw b jx jy kb kc kf nq kj nr kn ns kr ls lt lu lv bi translated">为了<strong class="jw ir">清晰的叙述性故事的不变性。</strong></li></ul><p id="246d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过清除<strong class="jw ir">声明性故事</strong>我的意思是，当你声明一个变量，给它一个信息性的名字，并把它赋给一个函数——希望它能做一件事——代码变得更“讲故事”,因为你可以通过信息性的名字很容易地预测输出，你保留了一个上下文。这同样适用于使用返回新状态的函数，而不是只获得状态并对其进行变异而不返回值的函数(命令式函数——这比使用对象属性/访问器要好),但这是个人喜好的问题，有人可能会说——所以变异并返回变异，我个人倾向于在审查其他代码时注重实效，变异是可以的。</p><ul class=""><li id="d31e" class="ll lm iq jw b jx jy kb kc kf nq kj nr kn ns kr ls lt lu lv bi translated"><strong class="jw ir">更容易的重构过程</strong>:使用Readonly类型强制TS不变性导致类型系统抛出错误，这帮助我在保持上下文的同时更快地破坏函数:)。</li><li id="aa2f" class="ll lm iq jw b jx lx kb ly kf lz kj ma kn mb kr ls lt lu lv bi translated"><a class="ae lw" href="https://en.wikipedia.org/wiki/Single_source_of_truth" rel="noopener ugc nofollow" target="_blank"/></li><li id="6f30" class="ll lm iq jw b jx lx kb ly kf lz kj ma kn mb kr ls lt lu lv bi translated"><a class="ae lw" href="https://en.wikipedia.org/wiki/Function_composition" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">组合</strong> </a>当你返回一个类型而不仅仅是改变它时，组合就被激活了:)(函数组合——假设你有两个函数(可以更多),第一个函数的结果/输出可以是第二个函数的输入)</li></ul><p id="3c7b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">(<strong class="jw ir">并发</strong>(在同一时间从不同线程写/尝试修改状态的意义上)顺便提一下，当运行在单线程v8抽象上时，并没有考虑到。)</p><p id="9ef9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">享受下面的片段，不要停止变异！就用你的常识:)</p><figure class="mg mh mi mj gt jr"><div class="bz fp l di"><div class="nt ni l"/></div></figure><p id="b1fb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">顺便说一句，如果你喜欢这篇文章，你可能也会喜欢以下内容:</p><div class="nu nv gp gr nw nx"><a rel="noopener  ugc nofollow" target="_blank" href="/a-short-time-learning-haskell-can-shortly-improve-your-typescript-skills-523505900ac0"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">短时间学习Haskell可以很快提高您的打字技能！</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">键入任意函数！仿制药太牛逼了！😎 👏哈斯克尔为了更大的利益。</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">itnext.io</p></div></div><div class="og l"><div class="oh l oi oj ok og ol js nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener  ugc nofollow" target="_blank" href="/recognising-functional-patterns-functors-for-dummies-2a829c875767"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">识别功能模式——虚拟列表函子实现</h2><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">itnext.io</p></div></div><div class="og l"><div class="om l oi oj ok og ol js nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a rel="noopener  ugc nofollow" target="_blank" href="/2-minutes-of-statically-typed-typescript-bb97f894e2f9"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">2分钟静态键入的Typescript！</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">介于静态和动态之间，这意味着什么:TS是一个结构类型系统。</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">itnext.io</p></div></div><div class="og l"><div class="on l oi oj ok og ol js nx"/></div></div></a></div><p id="9974" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">再次感谢<a class="no np ep" href="https://medium.com/u/2ac9b766143e?source=post_page-----70055dac5d52--------------------------------" rel="noopener" target="_blank">本尼·雅辛诺夫斯基</a>一如既往的挑战视角:)</p><p id="0c05" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">感谢<a class="no np ep" href="https://medium.com/u/355b1dfe86ae?source=post_page-----70055dac5d52--------------------------------" rel="noopener" target="_blank"> Uri Shaked </a>为我评论这篇文章:)</p><p id="3305" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">干杯，</p><p id="8b52" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">利伦。</p></div></div>    
</body>
</html>