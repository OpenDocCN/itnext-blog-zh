<html>
<head>
<title>Angular: Develop Faster with Prototyping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度:使用原型开发更快</h1>
<blockquote>原文：<a href="https://itnext.io/angular-develop-faster-with-prototyping-aafdf3376e6e?source=collection_archive---------1-----------------------#2022-07-18">https://itnext.io/angular-develop-faster-with-prototyping-aafdf3376e6e?source=collection_archive---------1-----------------------#2022-07-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1c6c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">快速开发和测试原型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bc1db226d06e9efc4097d1777ee0fece.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNxxrAItOWu7k6aeiQ270Q.png"/></div></div></figure><h1 id="01fd" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">关于我👋</h1><p id="4584" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我目前是一名软件工程师，<strong class="ll ir">和一些业内最好的Angular开发人员一起在<strong class="ll ir">财富100强公司思科</strong>工作。我在业余时间积极从事一些辅助项目，这些项目由Angular &amp; Firebase提供动力。</strong></p><blockquote class="mf mg mh"><p id="fd9f" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">🔥<a class="ae mr" href="https://github.com/Everduin94/poc" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">源代码</strong></a>——或者，每个要点都有一个到其对应文件的链接</p></blockquote><h1 id="a8c9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">目标🗺️</h1><ul class=""><li id="fc5d" class="ms mt iq ll b lm ln lp lq ls mu lw mv ma mw me mx my mz na bi translated">🦠维持一套通用模拟数据</li><li id="9f1e" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧬在e2e (cypress)和单元(jest)测试之间共享模拟数据</li><li id="1ffb" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧙‍♂️高效地为原型开发和测试创建模拟数据</li><li id="5d55" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧪编辑和删除不会影响实时数据</li><li id="60f8" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🔭方便地存根HTTP请求</li></ul><p id="693e" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">原型是指我们利用一些样本或模拟数据来快速测试一个想法。每当我开始一个新项目，我做的第一件事就是有效地建立架构原型。 —不要与<a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes" rel="noopener ugc nofollow" target="_blank"> JavaScript原型</a>混淆🙂</p><p id="af4a" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这在以下情况下很有用</p><ul class=""><li id="c128" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated">🐇快速证明一个想法的概念，而不影响实时数据</li><li id="fc52" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🖥️:相应的API还没有安装在后端</li><li id="36eb" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧪利用真实数据进行单元和e2e测试</li></ul><p id="2f4d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">额外的好处是，这个设置将使我们能够使用一组模拟数据进行所有的手工、单元和e2e测试。—这意味着<strong class="ll ir">我们不必为e2e测试<strong class="ll ir"> </strong>创建JSON fixture</strong>，并且<strong class="ll ir">可以利用来自我们手动测试</strong>的相同数据。</p><h1 id="7ab7" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">装置🔧</h1><p id="5bf0" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">以下仅在利用<strong class="ll ir"> HttpClient </strong>时有效。如果你正在使用<em class="mi"> Angular &amp; Firebase </em>参见<a class="ae mr" href="https://erxk.medium.com/angular-prototyping-firebase-emulator-with-cypress-9ff6f5b3bf8a" rel="noopener">Angular Prototyping:Firebase Emulator&amp;Cypress</a>。</p><p id="ebfa" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在内存中安装<em class="mi">角度API: </em></p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="1954" class="no ks iq nk b gy np nq l nr ns"><strong class="nk ir">npm i angular-in-memory-web-api</strong></span></pre><h2 id="4847" class="no ks iq bd kt nt nu dn kx nv nw dp lb ls nx ny ld lw nz oa lf ma ob oc lh od bi translated">内存API中的Angular是什么？</h2><p id="ea1f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">它本质上是一个运行在您的机器上的伪后端，知道如何模仿HttpClient从Angular服务返回数据。</p><p id="19ee" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">本文将关注如何使用它来原型化测试，而不是深入库本身。</p><h1 id="a583" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">配置⚙️</h1><p id="fa1f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">创建一个角度服务来管理原型数据。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/libs/rest/src/lib/in-memory-database.service.ts" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="4d91" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">上述配置使我们能够:</p><ul class=""><li id="c3ef" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated">通过<code class="fe ok ol om nk b">httpClient.get('api/tickets')</code>获取所有门票</li><li id="e2fa" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">通过<code class="fe ok ol om nk b">httpClient.get('api/tickets/ID')</code>买票</li><li id="9c49" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">通过<code class="fe ok ol om nk b">httpClient.delete('api/tickets/ID')</code>删除车票</li><li id="5ada" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">通过<code class="fe ok ol om nk b">httpClient.put('api/tickets/ID', DATA)</code>更新车票</li></ul><p id="c357" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">要设置服务，我们需要将它导入到我们的<code class="fe ok ol om nk b">app.module</code>中，并添加一个标志来确定它是打开还是关闭。—建议在您的<em class="mi">环境</em>文件中添加一个标志，以确定内存API应该打开还是关闭。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/apps/demo/src/app/app.module.ts#L33-L38" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="6a26" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">为了使这篇文章简短扼要，我已经创建了一篇简短的单独的配套文章，以防您不确定<strong class="ll ir"> </strong> <a class="ae mr" href="https://erxk.medium.com/nx-setup-a-custom-environment-116342b7815b" rel="noopener"> <strong class="ll ir">如何设置自定义环境</strong> </a>。—这允许我们拥有独立的开发、生产和原型环境</p><h1 id="0705" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">使用</h1><p id="6c6c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在内存API <strong class="ll ir">打开的情况下运行您的项目。(</strong>💡<em class="mi">原型</em>是我定制环境的名字。这将是你给它起的名字)</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="bd67" class="no ks iq nk b gy np nq l nr ns">// Nx Project<br/><strong class="nk ir">nx run APP:serve:prototype</strong><br/>// Without Nx<br/><strong class="nk ir">ng serve configuration=prototype</strong></span></pre><p id="d220" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">下面的代码是一个简单的例子来看看我们的模拟器工作。</p><ul class=""><li id="72ba" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated">🧙 <strong class="ll ir">在init上调用</strong> <code class="fe ok ol om nk b"><strong class="ll ir">http.get(‘api/tickets’)</strong></code>(这将调用内存API)</li><li id="27bd" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🔋<strong class="ll ir">将</strong> <code class="fe ok ol om nk b"><strong class="ll ir">tickets</strong></code> <strong class="ll ir">设置为来自内存API的响应</strong></li><li id="a01b" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🌈在模板中的票上循环，<strong class="ll ir">显示票值</strong>。</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/libs/rest/src/lib/ticket/ticket.component.ts" rel="noopener ugc nofollow" target="_blank">组件源</a> | <a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/libs/rest/src/lib/ticket/ticket.service.ts" rel="noopener ugc nofollow" target="_blank">服务源</a></figcaption></figure><p id="f82d" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">接下来的部分将着眼于使用我们刚刚在我们的单元和e2e测试中使用的<strong class="ll ir">、</strong>相同的数据集。</p><h1 id="1fd3" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在笑话中使用(单元测试)🃏</h1><p id="2aec" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将通过向我们的<em class="mi">测试床</em>添加<code class="fe ok ol om nk b">HttpClientInMemoryWebApiModule</code>来设置我们的测试，类似于我们在<code class="fe ok ol om nk b">app.module</code>中设置它的方式。注意，<strong class="ll ir">我们不必在测试文件中向HttpClient </strong>添加mocks或存根请求。</p><p id="9dac" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在我们的<em class="mi">inmemorydataservice</em>中，我定义了5张票。我们将<strong class="ll ir">使用上一节</strong>中的相同组件。回想一下，组件在<em class="mi"> ngOnInit中调用了<code class="fe ok ol om nk b">http.get(‘tickets’)</code>。</em>我们<strong class="ll ir">期望组件在init上返回所有5张票</strong>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oe of l"/></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/libs/rest/src/lib/ticket/ticket.component.spec.ts" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="c4e0" class="no ks iq nk b gy np nq l nr ns">// NX<strong class="nk ir"><br/>nx run YOUR_APP:test<br/></strong>// Without NX<strong class="nk ir"><br/>npm run test</strong></span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi on"><img src="../Images/008cddca1caeba88c4ad3cbcbb766ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cA5k8lcvQnI8BrOigu2G4Q.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">5张票全部退回</figcaption></figure><p id="3f4b" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这在测试时提供了一些好处。</p><ul class=""><li id="9793" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated">🧼自动处理<strong class="ll ir">设置和拆除</strong>数据</li><li id="5d51" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🧙直接调用我们的组件<strong class="ll ir">，而没有显式创建模拟</strong></li><li id="baa4" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated">🦠简单地通过使用另一种服务来传送数据集</li></ul><p id="70cb" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">在大型团队中工作时，我看到了组织模拟数据的混合策略:JSON fixtures、大型Javascript文件、spec文件中的内嵌模拟数据——这个工作流清楚地表明了模拟数据应该存在于何处，为团队提供了<strong class="ll ir">组织优势</strong>。</p><p id="69ca" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">这个例子非常简单，但是作为一个证明，<strong class="ll ir">几年前我在一个专业项目中广泛使用了这个策略</strong>，在那里我有能力做出这样的架构决策。—在我看来，它甚至在复杂的应用程序中也能工作，因为内存API有如此大的灵活性。</p><h1 id="8d00" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">在柏树中使用(E2E试验*)🌳</h1><p id="d205" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">要在上用内存API <strong class="ll ir">运行Cypress，我们需要在运行Cypress时指向原型配置/环境。</strong></p><p id="1b44" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">对于非Nx项目，我一般先运行<code class="fe ok ol om nk b">ng serve --configuration="YOUR_ENV"</code>，然后单独运行<code class="fe ok ol om nk b">cypress open</code>。</p><p id="ac11" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">对于Nx项目，在你的<strong class="ll ir">APP-e2e</strong><em class="mi">project . JSON</em>中设置<code class="fe ok ol om nk b">devServerTarget</code>为你的原型环境名<a class="ae mr" href="https://github.com/Everduin94/poc/blob/main/apps/demo-e2e/project.json#L6-L11" rel="noopener ugc nofollow" target="_blank">【源】</a><a class="ae mr" href="https://erxk.medium.com/nx-setup-a-custom-environment-116342b7815b" rel="noopener">如何设置自定义环境</a></p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="c2b9" class="no ks iq nk b gy np nq l nr ns"><strong class="nk ir">"devServerTarget": "APP:serve:prototype"</strong></span></pre><p id="21b1" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">现在Cypress应该使用内存API运行了:</p><pre class="kg kh ki kj gt nj nk nl nm aw nn bi"><span id="d5d8" class="no ks iq nk b gy np nq l nr ns"><strong class="nk ir">nx run APP-e2e:e2e --watch</strong></span></pre><p id="c7d8" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">我在我所有的附带项目E2E测试中使用了这个策略。下面的例子使用了0 json fixtures和0 cypress截距。这在我的项目中极大地帮助了我构建新想法的原型，测试特性，并维护有用的模拟数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/816fabfa5b5414ae162805edd8a7c2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*OeDhQWvAVwWOH0yy-FJHmA.gif"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated">E2E的例子</figcaption></figure><h1 id="cd6e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结论</h1><p id="5736" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">作为一名开发人员，一个好的原型工作流对我来说是必不可少的。这里列出的内容没有硬性规定。以适合您工作流程的方式使用这些工具。</p><p id="bae6" class="pw-post-body-paragraph lj lk iq ll b lm mj jr lo lp mk ju lr ls mm lu lv lw mo ly lz ma mq mc md me ij bi translated">我离开写文章有很长一段时间了，一直在做大量的工作:Angular、Firebase、Neovim、Linux和Lua。如果你有什么想听我解释的，或者是列表中的某个特定话题，请在评论中告诉我！</p><h1 id="559d" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">参考</h1><blockquote class="mf mg mh"><p id="42e1" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">*注意，E2E在这里被广泛使用。从技术上来说，我称之为“功能性”测试，因为它没有触及一个活动的后端。</p></blockquote><ul class=""><li id="7d77" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated"><a class="ae mr" href="https://lordicon.com/icons/wired/flat" rel="noopener ugc nofollow" target="_blank">缩略图中的图标</a></li><li id="777b" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated"><a class="ae mr" href="https://github.com/angular/in-memory-web-api" rel="noopener ugc nofollow" target="_blank">在内存API文档中</a></li><li id="f0e1" class="ms mt iq ll b lm nb lp nc ls nd lw ne ma nf me mx my mz na bi translated"><a class="ae mr" href="https://erxk.medium.com/nx-setup-a-custom-environment-116342b7815b" rel="noopener">如何用Nx设置自定义环境</a></li></ul><blockquote class="mf mg mh"><p id="1162" class="lj lk mi ll b lm mj jr lo lp mk ju lr ml mm lu lv mn mo ly lz mp mq mc md me ij bi translated">☁️<a class="ae mr" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank">flotes</a>——尝试演示，不需要登录。或者免费报名。Flotes是我记笔记和高效学习的方式，即使在我很忙的时候。</p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/8e468f6e74135bbbc2ecbfce7e2db2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGqAj2R16w33dIiKDnHEUA.png"/></div></div><figcaption class="og oh gj gh gi oi oj bd b be z dk translated"><a class="ae mr" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank"> Flotes </a></figcaption></figure><ul class=""><li id="8df1" class="ms mt iq ll b lm mj lp mk ls ng lw nh ma ni me mx my mz na bi translated"><a class="ae mr" href="https://github.com/Everduin94/poc" rel="noopener ugc nofollow" target="_blank">源代码</a></li></ul></div></div>    
</body>
</html>