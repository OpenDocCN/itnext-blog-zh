<html>
<head>
<title>Installing TensorFlow 2.3.0 for Raspberry Pi3+/4 (Debian Buster)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Raspberry Pi3+/4安装tensor flow 2 . 3 . 0(Debian Buster)</h1>
<blockquote>原文：<a href="https://itnext.io/installing-tensorflow-2-3-0-for-raspberry-pi3-4-debian-buster-11447cb31fc4?source=collection_archive---------0-----------------------#2020-09-05">https://itnext.io/installing-tensorflow-2-3-0-for-raspberry-pi3-4-debian-buster-11447cb31fc4?source=collection_archive---------0-----------------------#2020-09-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90e7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">只有重要的东西。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cef9cd1c2be09fe85abb3c85a787fa17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DrKpzlSs3kfk1Dk7FqqYVQ.png"/></div></div></figure><h1 id="1e62" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">介绍</h1><p id="86e2" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">随着最近发布的用于Raspberry pi的TensorFlow lite，以前在嵌入式系统上缓慢的模型预测率得到了极大的改善。像Raspberry Pi这样的小型单板计算机作为用于机器学习的设备已经变得更加可行。尤其是当与后量化和模型修剪等模型压缩技术结合使用时，情况更是如此。当我试图将TF 2安装到我的覆盆子上时，我遇到了无数的陷阱，我预见到可能会有很多陷阱，因此我写了这篇文章来提供一个清晰可行的步骤指南。</p><p id="f920" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">更多信息:<a class="ae mn" href="https://www.tensorflow.org/lite/performance/post_training_quantization" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/lite/performance/post _ training _ quantization</a></p><p id="199b" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">TLDR:阅读<strong class="lo iu">开始</strong>。</p><h1 id="90af" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">先决条件</h1><p id="0994" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">树莓Pi型号:树莓3/4(在3B上测试)<br/>树莓版本:Debian Buster(Debian 10)<br/>Python版本:3.7(默认python 3.7.3带有清新的树莓镜像)</p><p id="f330" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">安装尝试:<br/> Debian Stretch 9 <br/> python 2.7(无法安装TF2) <br/> python 3.5.3(失败)<br/> python 3.6(错误:<strong class="lo iu">tensor flow . python . platform</strong>未找到)<br/>python 3.7(<strong class="lo iu">GLIBC _ 2.27</strong>未找到)</p><p id="97b6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><a class="ae mn" href="https://medium.com/@cawin.chan/installing-tensorflow-2-3-0-for-raspberry-pi3-4-debian-buster-11447cb31fc4" rel="noopener"> Tensorflow </a> 2要求GNU C库(也称为<strong class="lo iu"> GLIBC </strong> ) <br/>为≥ <strong class="lo iu"> 2.27 </strong>然而Debian Stretch的最高<strong class="lo iu"> GLIBC </strong>版本为<strong class="lo iu"> 2.24 </strong>。因此，Debian Stretch被发现是不可用的。<br/>了解更多信息:<a class="ae mn" href="https://github.com/PINTO0309/Tensorflow-bin/#usage:" rel="noopener ugc nofollow" target="_blank">https://github.com/PINTO0309/Tensorflow-bin/#usage:</a></p><p id="e984" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">判决:Debian Stretch无法支持Tensorflow 2。</strong></p><h1 id="3eb6" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">开始做事:</h1><p id="461d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">如果你已经有一个可启动的Raspberry Pi操作系统，你可以跳过这一步。</p><p id="5bc9" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">从<a class="ae mn" href="https://www.raspberrypi.org/downloads/" rel="noopener ugc nofollow" target="_blank">https://www.raspberrypi.org/downloads/</a>下载Raspberry Pi Imager，用推荐的Raspberry Pi操作系统(32位)(≥16GB)闪存你的SD卡。</p><p id="0481" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">注意:截至<strong class="lo iu"> 06/09/20 </strong>，<strong class="lo iu">不使用Anaconda </strong>，因为Anaconda的python版本最新版本是3.6.3，遇到“错误:<strong class="lo iu">tensor flow . python . platform</strong>未找到”的情况。</p><p id="486e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">第0步:检查树莓Pi (GNU/Linux 10 (Buster))、Python和Pip版本。</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4ee7" class="mt kv it mp b gy mu mv l mw mx">cat /etc/os-release <br/>python3 --version<br/>pip3 --version </span></pre><p id="a4e8" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">第一步:确保所有东西都更新了。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4474" class="mt kv it mp b gy mu mv l mw mx">sudo apt update<br/>sudo apt dist-upgrade<br/>sudo apt clean</span></pre><p id="92d7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">第二步:升级pip ( &gt; 19.0)，setuptools (≥41.0.0)，安装Tensorflow 2依赖项。</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="ecfc" class="mt kv it mp b gy mu mv l mw mx">sudo pip install --upgrade pip<br/>sudo pip3 install --upgrade setuptools<br/>sudo pip3 install numpy==1.19.0</span><span id="fc85" class="mt kv it mp b gy my mv l mw mx">sudo apt-get install -y libhdf5-dev libc-ares-dev libeigen3-dev gcc gfortran python-dev libgfortran5 libatlas3-base libatlas-base-dev libopenblas-dev libopenblas-base libblas-dev liblapack-dev cython libatlas-base-dev openmpi-bin libopenmpi-dev python3-dev</span><span id="5c6d" class="mt kv it mp b gy my mv l mw mx">sudo pip3 install keras_applications==1.0.8 --no-deps<br/>sudo pip3 install keras_preprocessing==1.1.0 --no-deps<br/>sudo pip3 install h5py==2.9.0<br/>sudo pip3 install pybind11</span><span id="9b43" class="mt kv it mp b gy my mv l mw mx">pip3 install -U --user six wheel mock</span></pre><p id="a123" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">第三步:安装Tensorflow 2* </strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="73e4" class="mt kv it mp b gy mu mv l mw mx">$ wget "https://raw.githubusercontent.com/PINTO0309/Tensorflow-bin/master/tensorflow-2.3.0-cp37-none-linux_armv7l_download.sh"</span><span id="98fb" class="mt kv it mp b gy my mv l mw mx">$ sudo chmod +x tensorflow-2.3.0-cp37-none-linux_armv7l_download.sh</span><span id="3eeb" class="mt kv it mp b gy my mv l mw mx">$ ./tensorflow-2.3.0-cp37-none-linux_armv7l_download.sh</span><span id="9c2b" class="mt kv it mp b gy my mv l mw mx">$ sudo pip3 uninstall tensorflow</span><span id="0e53" class="mt kv it mp b gy my mv l mw mx">$ sudo -H pip3 install tensorflow-2.3.0-cp37-none-linux_armv7l.whl</span></pre><p id="8cee" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">其他版本或架构可以在这个链接找到(只需用想要的TF 2版本替换2.3.0即可):<a class="ae mn" href="https://github.com/PINTO0309/Tensorflow-bin/#usage" rel="noopener ugc nofollow" target="_blank">https://github.com/PINTO0309/Tensorflow-bin/#usage</a>:</p><p id="904a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">步骤4:检查TF 2是否安装正确</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="8351" class="mt kv it mp b gy mu mv l mw mx">$ python3 <br/>&gt;&gt;&gt; import tensorflow<br/>&gt;&gt;&gt; tensorflow.__version__<br/>'2.3.0'<br/>&gt;&gt;&gt; exit()</span></pre><p id="89e5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">步骤5:从保存的模型创建一个TF Lite模型文件</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="7455" class="mt kv it mp b gy mu mv l mw mx">import os<br/>import tempfile<br/><br/>from matplotlib import pyplot as plt<br/>import numpy as np<br/>import tensorflow as tf<br/><br/>tmpdir = tempfile.mkdtemp()<br/>#Train model here....</span><span id="0d61" class="mt kv it mp b gy my mv l mw mx">saved_model_dir = os.path.join(tmpdir, "path")<br/>tf.saved_model.save(trained_model, saved_model_dir)<br/><br/>converter = tf.lite.TFLiteConverter.from_saved_model(saved_model_dir)<br/>tflite_model = converter.convert()<br/>open("converted_model.tflite", "wb").write(tflite_model)</span></pre><p id="c081" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">步骤6:创建TF模型文件后测试TF Lite】</strong></p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="4b2d" class="mt kv it mp b gy mu mv l mw mx">import numpy as np<br/>import tensorflow as tf</span><span id="b8f3" class="mt kv it mp b gy my mv l mw mx"># Load the TFLite model and allocate tensors.<br/>interpreter = tf.lite.Interpreter(model_path="converted_model.tflite")<br/>interpreter.allocate_tensors()<br/><br/># Get input and output tensors.<br/>input_details = interpreter.get_input_details()<br/>output_details = interpreter.get_output_details()<br/><br/># Test the model on random input data.<br/>input_shape = input_details[0]['shape']<br/>input_data = np.array(np.random.random_sample(input_shape), dtype=np.float32)<br/>interpreter.set_tensor(input_details[0]['index'], input_data)<br/><br/>interpreter.invoke()<br/><br/># The function `get_tensor()` returns a copy of the tensor data.<br/># Use `tensor()` in order to get a pointer to the tensor.<br/>output_data = interpreter.get_tensor(output_details[0]['index'])<br/>print(output_data)</span></pre><p id="b196" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">*安装Tensorflow的注意事项:</strong> <br/>从<strong class="lo iu"> 06/09/20起，</strong>为了简单地安装tensorflow 2.3.0，我们将使用来自胜矢兵库(PINTO0309)的预构建二进制文件，后者是一家著名的英特尔软件创新公司。因此，这不是正式发布的Tensorflow 2.3.0 <strong class="lo iu">。</strong>请务必始终仔细检查<a class="ae mn" href="https://raw.githubusercontent.com/PINTO0309/Tensorflow-bin/master/tensorflow-2.3.0-cp37-none-linux_armv7l_download.sh" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/pinto 0309/tensor flow-bin/master/tensor flow-2 . 3 . 0-cp37-none-Linux _ arm v7l _ download . sh</a>链接。</p><pre class="kj kk kl km gt mo mp mq mr aw ms bi"><span id="d201" class="mt kv it mp b gy mu mv l mw mx">#!/bin/bash</span><span id="7e74" class="mt kv it mp b gy my mv l mw mx">curl -sc /tmp/cookie "https://drive.google.com/uc?export=download&amp;id=11iycpKFZc267gryq06sdV1zrz0St_Kox" &gt; /dev/null<br/>CODE="$(awk '/_warning_/ {print $NF}' /tmp/cookie)"<br/>curl -Lb /tmp/cookie "https://drive.google.com/uc?export=download&amp;confirm=${CODE}&amp;id=11iycpKFZc267gryq06sdV1zrz0St_Kox" -o tensorflow-2.3.0-cp37-none-linux_armv7l.whl<br/>echo Download finished.</span></pre><p id="5639" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">如你所见，这里有谷歌驱动下载的链接，当你从未知来源下载时，一定要小心。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="677f" class="ku kv it bd kw kx ng kz la lb nh ld le jz ni ka lg kc nj kd li kf nk kg lk ll bi translated">为什么选择TFlite型号而不是传统的h5型号？</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/7e7673957cf612e8e86d88ea0a323704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9YAfeUlGcumEVZ_UY1OkQ.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">总结5次不同运行的平均结果</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/07f29e889f36b6db9a12269e2333dd12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bVYWfVEpd-p-PxH-gpVXg.png"/></div></div><figcaption class="nm nn gj gh gi no np bd b be z dk translated">20次预测后平均预测时间的比较</figcaption></figure><p id="3780" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们看到TensorFlow Lite不仅大大提高了我们的预测速度，而且与我们的基准模型(Relu h5)相比，它还提高了模型的加载速度。这非常适合计算资源有限的设备，比如我们的raspberry pi，甚至可能是微控制器。</p><p id="c776" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">尽管在我的项目和TensorFlow的测试中发现TensorFlow Lite模型转换对准确性的影响可以忽略不计，但每个项目都应该在自己的情况下检查转换和压缩的效果。<br/>链接TensorFlow的TF Lite vs原模型性能:<br/><a class="ae mn" href="https://www.tensorflow.org/lite/performance/model_optimization" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/Lite/performance/model _ optimization</a></p><p id="5293" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">就这样，我们结束了！希望你们不要经历和我一样的痛苦！感谢那些帮助我创建这个步骤指南的人，你们的工作对我来说是非常宝贵的。</p><p id="e54f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">非常感谢<a class="nr ns ep" href="https://medium.com/u/be237ef77756?source=post_page-----11447cb31fc4--------------------------------" rel="noopener" target="_blank"> Chitrung </a>的指导。【https://www.linkedin.com/in/cindy-yu-61a8a01ab/】也要感谢我出色的平面设计师Cindy Yu<a class="ae mn" href="https://www.linkedin.com/in/cindy-yu-61a8a01ab/" rel="noopener ugc nofollow" target="_blank"/></p><p id="dc50" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">支持我的工作，看看吧！</p><div class="nt nu gp gr nv nw"><a href="https://cawin-chan.medium.com/membership" rel="noopener follow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">通过我的推荐链接加入媒体-陈嘉文</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">cawin-chan.medium.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok ks nw"/></div></div></a></div><p id="1f5f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">推荐人:<br/></strong><a class="ae mn" href="https://github.com/PINTO0309/Tensorflow-bin/#usage" rel="noopener ugc nofollow" target="_blank"><em class="ol">https://github.com/PINTO0309/Tensorflow-bin/#usage</em></a><em class="ol">:<br/></em><a class="ae mn" href="https://www.tensorflow.org/guide/saved_model" rel="noopener ugc nofollow" target="_blank"><em class="ol">https://www.tensorflow.org/guide/saved_model</em></a><em class="ol"><br/></em><a class="ae mn" href="https://www.tensorflow.org/lite/guide/inference" rel="noopener ugc nofollow" target="_blank"><em class="ol">https://www.tensorflow.org/lite/guide/inference</em></a></p><p id="8f9e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lo iu">图片来源:</strong><br/><a class="ae mn" href="https://www.tensorflow.org/site-assets/images/project-logos/tensorflow-lite-logo-social.png" rel="noopener ugc nofollow" target="_blank"><em class="ol">https://www . tensor flow . org/site-assets/images/project-logos/tensor flow-lite-logo-social . pn</em></a><em class="ol">g</em></p></div></div>    
</body>
</html>