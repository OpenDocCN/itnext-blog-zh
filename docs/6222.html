<html>
<head>
<title>Stupid Simple Scalability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">愚蠢的简单可伸缩性</h1>
<blockquote>原文：<a href="https://itnext.io/stupid-simple-scalability-dc4a7fbe67d6?source=collection_archive---------2-----------------------#2021-09-22">https://itnext.io/stupid-simple-scalability-dc4a7fbe67d6?source=collection_archive---------2-----------------------#2021-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4334e3dc74f33f4894353c9b555e0b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vEDknw2KQafZi5ceBVIVA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Elena Mozhvilo 在<a class="ae kf" href="https://unsplash.com/s/photos/balance?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="62f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章将定义和解释Kubernetes 中的<strong class="ki iu">软件可伸缩性，并看看不同的可伸缩性类型。然后我们将在Kubernetes中介绍三种自动缩放方法:<strong class="ki iu"> HPA </strong>(水平Pod自动缩放器)<strong class="ki iu"> VPA </strong>(垂直Pod自动缩放器)<strong class="ki iu"> CA </strong>(集群自动缩放器)。</strong></p><h1 id="58ee" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">解释了可扩展性</h1><p id="1b3c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">为了理解软件可伸缩性中的不同概念，让我们举一个真实的例子。</p><p id="3566" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设你刚刚开了一家咖啡店，你买了一台简单的咖啡机，每分钟可以煮三杯咖啡，你雇了一名员工为客户服务。</p><p id="9c91" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">起初，你有几个客户:一切都很顺利，所有的人都对咖啡和服务很满意，因为他们不用等太久就能喝到美味的咖啡。随着时间的推移，你的咖啡店在镇上变得很有名，越来越多的人从你这里购买他们的咖啡。但是有一个问题。你只有一名员工，却有太多的客户，所以等待时间变得相当长，人们开始抱怨你的服务。咖啡机每分钟可以煮三杯咖啡，但是员工每分钟只能处理一个客户。你决定再雇佣两名员工。有了这个，你暂时解决了问题。</p><p id="52f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一段时间后，在咖啡店附近，城市开放了一个有趣的公园，所以越来越多的游客来到你著名的咖啡店，喝他们的咖啡。所以你决定雇佣更多的人，但是即使有更多的员工，等待的时间也是差不多的。问题是你的咖啡机每分钟能煮三杯咖啡，所以现在你的员工都在等咖啡机。解决办法是买一台新的咖啡机。另一个问题是，客户倾向于从他们已经认识的员工那里购买咖啡。结果就是有的员工工作很多，有的员工很闲。这是当你决定你需要雇用另一名员工，他将迎接客户，并把他们重定向到有空或有较少订单要准备的员工。</p><p id="8d1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分析你的收入和支出，你意识到你在夏天比冬天有更多的客户，所以你决定雇佣季节性工人。现在你有三名员工全职工作，其他员工只在夏天为你工作。这样，你可以增加收入，减少开支。此外，你可以在夏天租一些咖啡机，然后在冬天归还，以最大限度地降低成本。这样，你就不会有闲置的咖啡机。</p><p id="2792" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了将这个小故事转化为Kubernetes中的软件可伸缩性，我们可以将<strong class="ki iu">咖啡机</strong>替换为<strong class="ki iu">节点</strong>，将<strong class="ki iu">员工</strong>替换为<strong class="ki iu">pod</strong>，将<strong class="ki iu">咖啡店</strong>替换为<strong class="ki iu">集群</strong>，将与客户打招呼并重定向到客户的<strong class="ki iu">员工是<strong class="ki iu">负载平衡器</strong>。增加<strong class="ki iu">更多员工</strong>意味着<strong class="ki iu">水平Pod缩放</strong>；增加<strong class="ki iu">更多的咖啡机</strong>意味着<strong class="ki iu">集群扩展</strong>。<strong class="ki iu">季节性工人和仅在夏季租赁咖啡机</strong>意味着<strong class="ki iu">自动缩放</strong>因为当负载较高时，我们有更多的pod服务于客户，也有更多的节点供pod使用。当负荷下降时(在冬季)，我们的开支就会减少。在这个类比中，<strong class="ki iu">垂直Pod扩展</strong>将是<strong class="ki iu">雇佣一个更有经验的员工</strong>，他可以在相同的时间内服务更多的客户(高绩效员工)。<strong class="ki iu">自动缩放</strong>的<strong class="ki iu">触发器</strong>将是<strong class="ki iu">季节</strong>；我们在夏季扩大规模，在冬季缩小规模。</strong></p><p id="694e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想<strong class="ki iu">了解更多关于节点、单元、集群</strong>等的信息。，请阅读我的文章<a class="ae kf" href="https://czakozoltan08.medium.com/stupid-simple-kubernetes-e509355fba3d" rel="noopener"> <strong class="ki iu">愚蠢简单的Kubernetes </strong> </a>。</p><h1 id="8529" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">水平Pod自动缩放(HPA)</h1><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/0c19938be8b7d5fdcb92c12eef40cc97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*O2cnQGHtx2_IpE5Hfjt4fg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">水平Pod自动缩放</figcaption></figure><p id="809d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">水平扩展</strong>或<strong class="ki iu">向外扩展</strong>意味着运行单元的数量会随着应用程序使用情况的变化而动态增加或减少。为了准确地知道何时增加或减少副本的数量，Kubernetes使用基于观察到的指标(平均CPU利用率、平均内存利用率或用户定义的自定义指标)的触发器。<a class="ae kf" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu">HPA</strong></a>(Kubernetes资源)循环运行(循环持续时间可以配置，默认设置为15秒)，并从<a class="ae kf" href="https://kubernetes.io/docs/tasks/debug-application-cluster/resource-metrics-pipeline/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">资源指标API </strong> </a> <strong class="ki iu"> </strong>中获取每个pod的资源指标。使用这些指标，它根据所有pod的平均值计算实际资源利用率值，并将它们与HPA定义中定义的指标进行比较。为了计算所需的复制副本数量，HPA使用以下公式:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="dde2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了理解这个公式，让我们采用以下配置:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/2909b95bc778bb438794ff322fd5197e.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*DBnLqSMg9GeTy7wQFmo3Cw.jpeg"/></div></figure><p id="9194" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单元后缀<strong class="ki iu"> m </strong>代表“千分之一的核心”，因此这个资源对象指定容器进程需要200/1000个核心(20%)，并且最多允许使用500/1000个核心(50%)。</p><p id="8694" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用以下命令，我们可以创建一个维护1到10个复制副本的HPA。它将增加或减少副本的数量，以保持50%的平均CPU使用率，或者在这个具体示例中，保持100毫核。</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="e42c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设CPU使用率增加到了210 %;这意味着我们将有<strong class="ki iu">个NR replicas = ceil[1 *(210/50)]= ceil[4.2]= 5个副本</strong>。</p><p id="9572" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当有5个副本时，CPU使用率下降到25%，因此HPA会将副本数量减少到<strong class="ki iu">NR replicas = ceil[5 *(25/50)]= ceil[2.5]= 3个副本</strong>。</p><p id="4864" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有关更多示例，请阅读Kubernetes中使用HPA的<a class="ae kf" href="https://www.velotio.com/engineering-blog/autoscaling-in-kubernetes-using-hpa-vpa" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">自动缩放和VPA </strong> </a> <strong class="ki iu"> </strong>或<a class="ae kf" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> HPA预排</strong> </a>。</p><p id="16b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">配置HPA时，请确保:</p><ol class=""><li id="3c78" class="mp mq it ki b kj kk kn ko kr mr kv ms kz mt ld mu mv mw mx bi translated"><strong class="ki iu">所有pod都配置了资源请求和限制</strong> —这将在HPA做出扩展决策时予以考虑</li><li id="fd3b" class="mp mq it ki b kj my kn mz kr na kv nb kz nc ld mu mv mw mx bi translated"><strong class="ki iu">使用自定义指标或观察指标</strong> —外部指标可能会带来安全风险，因为它们可以提供对大量指标的访问</li><li id="296d" class="mp mq it ki b kj my kn mz kr na kv nb kz nc ld mu mv mw mx bi translated"><strong class="ki iu">尽可能将HPA与CA一起使用</strong></li></ol><h1 id="637f" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">垂直窗格自动缩放(VPA)</h1><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c0a8d57ff7d4fc944f8b51634f9f693d.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*x83UbOdtx9-Y0eh2XtCRJg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">垂直Pod自动缩放</figcaption></figure><p id="cb2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> VPA推荐优化的CPU和内存请求/限制值</strong>(并自动为您更新它们，以便高效地使用集群资源)。<strong class="ki iu"> VPA不会添加更多的Pod副本，但它增加了内存或CPU的限制</strong>。当添加更多副本对您的解决方案没有帮助时，这很有用。例如，有时你不能仅仅通过添加更多的pod来扩展一个数据库。不过，您可以通过增加内存或CPU来让数据库处理更多的连接。当应用程序处理重量级请求时，可以使用VPA，这需要更多的资源。</p><p id="f919" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，当您的应用程序为大量轻量级(即低资源消耗)请求提供服务时，HPA会非常有用。在这种情况下，扩展副本的数量可以将工作负载分布在每个单元上。另一方面，当您的应用程序服务于需要更多资源的重量级请求时，VPA会非常有用。</p><p id="8993" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> HPA和VPA不兼容</strong>。不要将两者一起用于同一组pod。HPA使用资源请求和限制来触发扩展，与此同时，VPA会修改这些限制，因此除非您将HPA配置为使用自定义或外部指标，否则将会一片混乱。点击 了解更多关于VPA和HPA <a class="ae kf" href="https://www.velotio.com/engineering-blog/autoscaling-in-kubernetes-using-hpa-vpa" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">的信息。</strong></a></p><h1 id="ab5d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">聚类自动缩放(CA)</h1><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/2ca5c1d45a7fcb3191de8837cd3b34f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*72ahIFZG9oOmXIhQIxs90w.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">聚类自动缩放</figcaption></figure><p id="4315" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">HPA扩展pod的数量，而<strong class="ki iu"> CA改变节点的数量</strong>。当集群资源不足时，CA会提供一个新的计算单元(物理或虚拟机)并将其添加到集群中。如果有太多的空节点，CA将删除它们以降低成本。</p><p id="0bdf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<a class="ae kf" href="https://learnk8s.io/kubernetes-autoscaling-strategies" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">了解更多关于集群自动扩展的信息构建Kubernetes集群—选择最佳自动扩展策略</strong> </a>。</p><h1 id="7d8d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="c762" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在本文的第一部分，我们提供了一个真实的例子来解释在T2软件可伸缩性中使用的不同概念。然后我们定义并提出了Kubernetes 、<strong class="ki iu"> HPA </strong>(水平Pod自动缩放器)、<strong class="ki iu"> VPA </strong>(垂直Pod自动缩放器)、以及<strong class="ki iu"> CA </strong>(集群自动缩放器)提供的三种<strong class="ki iu">可伸缩性方法。</strong></p><p id="dd50" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想要更多<strong class="ki iu">【愚蠢简单】</strong>的解释，请<strong class="ki iu">跟我上媒</strong>！</p><p id="0c10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有一个正在进行的<strong class="ki iu">《愚蠢的简单AI》</strong>系列。前两篇可以在这里找到:<a class="ae kf" href="https://towardsdatascience.com/svm-and-kernel-svm-fed02bef1200" rel="noopener" target="_blank"> <strong class="ki iu"> SVM和内核SVM</strong></a>T22<a class="ae kf" href="https://towardsdatascience.com/knn-in-python-835643e2fb53" rel="noopener" target="_blank"><strong class="ki iu">KNN在Python </strong> </a>。</p><p id="111a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您阅读本文！</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="736f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我真的很喜欢咖啡，因为它给了我写更多文章的能量。如果你喜欢这篇文章，那么你可以给我买杯咖啡来表达你的欣赏和支持！</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><a href="https://ko-fi.com/zozoczako"><div class="gh gi nl"><img src="../Images/0f03dd542bf76f1125912312a7c936ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*bFjnvelnpwuYa4vfPMGkhA@2x.png"/></div></a></figure></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="1496" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">成为媒介上的作家:</strong><a class="ae kf" href="https://czakozoltan08.medium.com/membership" rel="noopener">https://czakozoltan08.medium.com/membership</a></p></div></div>    
</body>
</html>