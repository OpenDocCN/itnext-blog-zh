<html>
<head>
<title>Create React v18 TypeScript Project with webpack and Babel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用webpack和Babel创建React v18 TypeScript项目</h1>
<blockquote>原文：<a href="https://itnext.io/create-react-typescript-project-with-webpack-and-babel-2431cac8cf5b?source=collection_archive---------0-----------------------#2022-07-31">https://itnext.io/create-react-typescript-project-with-webpack-and-babel-2431cac8cf5b?source=collection_archive---------0-----------------------#2022-07-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6c6eba9153822b7e5c03847e329805e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-AEwhiN6mR5Rt2d1ajlbmg.png"/></div></div></figure><p id="f665" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用create-react-app，您可以非常方便地设置React TypeScript项目。但是，如果您预测您的应用程序会变大，该怎么办呢？你会面临许多问题。例如，你需要多个入口点，性能调优，传输到2022年的ES5。</p><p id="8273" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这种情况下，最好从一开始就使用webpack和Babel。我知道它们是软件工程师不想碰的东西，因为它不是应用程序代码。这只是一个捆绑配置。但是因为看起来很难很无聊，反而加速了你的工程师价值！</p><p id="a95e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，让我们从头开始一步一步地学习捆绑配置。</p><p id="7d7b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">事实上，我在2020年写了<a class="ae kz" href="https://medium.com/swlh/2020-settings-of-react-typescript-project-with-webpack-and-babel-403c92feaa06" rel="noopener">一篇类似的文章，这篇文章是反映技术更新的重写版本。</a></p><h1 id="9634" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">概观</h1><p id="8d8b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">目标是建立React类型脚本项目。要求如下。</p><ul class=""><li id="b80f" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">使用React with TypeScript</li><li id="eb29" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">使工程师能够编写ESNEXT类型脚本</li><li id="1c9e" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">捆绑代码必须是ES5-</li><li id="adf7" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">开发时的实时类型检查</li></ul><p id="1f5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为IE11退役日期是2022年6月15日，所以你们大部分人不需要E55(我希望)设置。但是运输知识仍然值得学习📝</p><p id="12fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些是达到要求的步骤</p><ol class=""><li id="2930" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mr mj mk ml bi translated">用webpack捆绑JavaScript</li><li id="1ad2" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated">介绍反应</li><li id="6fe9" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated">传输和聚合填充至ES5</li><li id="5ae4" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated">添加类型脚本</li></ol><h1 id="ce02" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">用webpack捆绑JavaScript</h1><p id="0944" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">首先，让我们初始化你的目录。你可以跳过所有的问题。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="7da5" class="nb lb it mx b gy nc nd l ne nf">❯ yarn init<br/>yarn init v1.22.17<br/>question name (bundle): test<br/>question version (1.0.0):<br/>question description:<br/>question entry point (index.js):<br/>question repository url:<br/>question author:<br/>question license (MIT):<br/>question private:<br/>success Saved package.json<br/>✨  Done in 91.17s.</span></pre><p id="5668" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那我们就来装一个今天的主角，<a class="ae kz" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> webpack </a>！webpack是一个模块捆绑器。它解决依赖关系并将文件捆绑到一个文件中。</p><p id="b84e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为webpack提供了称为webpack dev server和webpack-cli方便的包，所以让我们也安装它们。</p><ul class=""><li id="3f68" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">webpack开发服务器:热加载的开发服务器</li><li id="e59c" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">web pack-cli:web pack命令的CLI工具</li></ul><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c9f3" class="nb lb it mx b gy nc nd l ne nf">❯ yarn add -D webpack webpack-cli webpack-dev-server</span></pre><p id="c162" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来你应该做的是创建<code class="fe ng nh ni mx b">webpack.config.js</code>文件。这个文件是webpack和您的代码之间的主要连接点。请参见下面的配置。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4b9e" class="nb lb it mx b gy nc nd l ne nf">// webpack.config.js<br/>const path = require('path')</span><span id="9783" class="nb lb it mx b gy nj nd l ne nf">module.exports = {<br/>  entry: './src/main.js',<br/>  output: {<br/>    path: path.resolve(__dirname, './dist'),<br/>    filename: 'bundle.js'<br/>  },<br/>  devServer: {<br/>    static: {       <br/>      directory: path.resolve(__dirname, './dist')<br/>    }<br/>  }<br/>}</span></pre><p id="f41e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有三个主要键，entry、output和devServer。当您构建时，webpack会将您的。/src/main.js并在。/dist目录。</p><p id="283f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一方面，当您运行dev服务器时，会使用devServer配置。</p><p id="62a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">实际上，您已经准备好捆绑js文件了。让我们试一试。请将src设置为director和。/src/main.js文件。写下这个。它现在必须是JavaScript文件，因为没有用于transpile TypeScript的配置。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="efdc" class="nb lb it mx b gy nc nd l ne nf">// ./src/main.js</span><span id="78e0" class="nb lb it mx b gy nj nd l ne nf">console.log('Hello World');</span></pre><p id="cb42" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了进行编译，让我们向package.json添加一些命令。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="30ed" class="nb lb it mx b gy nc nd l ne nf">{<br/>  // ...<br/>  "scripts": {<br/>    "dev": "webpack serve",<br/>    "build": "webpack --mode production --progress --hide-modules"<br/>  }<br/>  // ...<br/>}</span></pre><p id="9517" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，用bundle.js的脚本标签在<code class="fe ng nh ni mx b">/dist</code>中创建一个简单的html文件，如果没有这个脚本标签，你捆绑的js文件将永远不会被读取。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="cd6e" class="nb lb it mx b gy nc nd l ne nf">// dist/index.html<br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width,initial-scale=1.0"&gt;<br/>    &lt;title&gt;TITLE HERE&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;script src="./bundle.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="db89" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">回到命令行并键入<code class="fe ng nh ni mx b">yarn dev</code>。请打开<code class="fe ng nh ni mx b">http://localhost:8080</code>和chrome开发工具。如果你能看到“你好世界”，干得好！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/d61e7731a50d9ee9b8ff2a2aa65a8dfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5mw5t_w78z4_Cqfn7es2A.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">图:使用webpack检查初始设置</figcaption></figure><h1 id="1d38" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">介绍反应</h1><p id="3591" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">我知道你们想开发一个很酷的应用。所以让我们加上React。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="d6cf" class="nb lb it mx b gy nc nd l ne nf">yarn add react react-dom</span></pre><ul class=""><li id="cf69" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated"><code class="fe ng nh ni mx b">react</code>是用于定义组件和处理虚拟DOM的东西</li><li id="5686" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><code class="fe ng nh ni mx b">react-dom</code>提供了一些与浏览器DOM交互的方法。</li></ul><p id="5c33" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如你所知，仅仅安装React是不够的，因为不可能编译React JSX。webpack只是一个捆绑器。没有功能来改变JSX的反应。所以是时候用巴别塔了！</p><p id="db08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Babel是一个可以编译代码的编译器。举个例子，</p><ul class=""><li id="3ea8" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">从新JavaScript (ESNext)到旧JavaScript (ES5)</li><li id="bb0b" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">从React JSX和Vue SFC到普通JavaScript。</li></ul><p id="1919" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们创建巴别塔的初始设置！巴别塔的核心图书馆是<code class="fe ng nh ni mx b">@babel/core</code>。使用Babel搭配webpack，需要使用<code class="fe ng nh ni mx b">babel-loader</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="e6fa" class="nb lb it mx b gy nc nd l ne nf">yarn add -D @babel/core babel-loader</span></pre><p id="402e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后将babel-loader添加到webpack配置中。如果您想添加加载器，您必须添加一个配置到<code class="fe ng nh ni mx b">module.rules</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5020" class="nb lb it mx b gy nc nd l ne nf">// webpack.config.js<br/>const path = require('path')</span><span id="7e69" class="nb lb it mx b gy nj nd l ne nf">module.exports = {<br/>  ...<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.(js)x?$/,<br/>        exclude: /node_modules/,<br/>        use: {<br/>          loader: 'babel-loader',<br/>        },<br/>      },<br/>    ],<br/>  },<br/>  resolve: {<br/>    extensions: ['.jsx', '.js'],<br/>  },<br/>}</span></pre><p id="1a8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！从这里开始，可以编写复杂的配置。</p><p id="3c61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以让我们添加React编译配置。要变身反应JSX，你需要<code class="fe ng nh ni mx b">@babel/preset-react</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b774" class="nb lb it mx b gy nc nd l ne nf">yarn add -D @babel/preset-react</span></pre><p id="741e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在根目录下创建<code class="fe ng nh ni mx b">babel.config.json</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f20c" class="nb lb it mx b gy nc nd l ne nf">// babel.config.json</span><span id="7443" class="nb lb it mx b gy nj nd l ne nf">{<br/>  "presets": [<br/>    "@babel/preset-react"<br/>  ]<br/>}</span></pre><p id="d76a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在react transpilation过程被添加到您的webpack捆绑包过程中！让我们试试react代码，重写<code class="fe ng nh ni mx b">src/main.js</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="40d0" class="nb lb it mx b gy nc nd l ne nf">// src/main.js<br/>import React from 'react';<br/>import { createRoot } from 'react-dom/client';<br/>import { App } from './App';</span><span id="ae85" class="nb lb it mx b gy nj nd l ne nf">createRoot(document.getElementById('app'))<br/>  .render(&lt;App /&gt;);</span></pre><p id="5172" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后加上<code class="fe ng nh ni mx b">App.jsx</code>！</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2167" class="nb lb it mx b gy nc nd l ne nf">// src/App.jsx<br/>import React from 'react';</span><span id="6275" class="nb lb it mx b gy nj nd l ne nf">export const App = () =&gt; (<br/>  &lt;h1&gt;Hello React&lt;/h1&gt;<br/>);</span></pre><p id="00cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了第一个react组件之外，因为react试图挂载在id为<code class="fe ng nh ni mx b">#app</code>的html标签上，所以请在html中添加div标签。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="aeae" class="nb lb it mx b gy nc nd l ne nf">// dist/index.html</span><span id="afda" class="nb lb it mx b gy nj nd l ne nf">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    ...<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app" /&gt;                       // add here<br/>    &lt;script src="./bundle.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ab49" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了babel config，建议写一个<code class="fe ng nh ni mx b">.jsx</code>和<code class="fe ng nh ni mx b">.js</code>的解析器配置。有了它，你可以像写<code class="fe ng nh ni mx b">import App from "./App";</code>而不是<code class="fe ng nh ni mx b">import App from “./App.jsx”</code>一样写导入；</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="fd05" class="nb lb it mx b gy nc nd l ne nf">// webpack.config.js<br/>const path = require('path')</span><span id="bca9" class="nb lb it mx b gy nj nd l ne nf">module.exports = {<br/>  ...<br/>  resolve: {<br/>    extensions: ['.jsx', '.js'],<br/>  },<br/>}</span></pre><p id="d9b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在你可以在你的应用中使用react了，用<code class="fe ng nh ni mx b">yarn dev</code>检查一下！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi np"><img src="../Images/b0f2413a54fe6db47f45761df86a13d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*lz-PHykX6jpYlmi6X1R4gQ.png"/></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated">图:React的初始设置</figcaption></figure><h1 id="f996" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">传输和聚合填充至ES5</h1><p id="1a67" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">到目前为止，您的JavaScript文件是用ES6+编写的。例如<code class="fe ng nh ni mx b">App.jsx</code>中使用了箭头功能。这意味着您的应用程序不能在旧的浏览器中工作。</p><p id="0ab1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要让应用程序在旧浏览器中工作，必须做两件事。</p><ol class=""><li id="ddba" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mr mj mk ml bi translated">将ES6+代码转换为ES5-</li><li id="9f20" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated">聚合填料</li></ol><p id="ee7a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Transpile很好理解。把新的JavaScript替换成旧的JavaScript就行了。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="6480" class="nb lb it mx b gy nc nd l ne nf">// ES6<br/>const sayHello = () =&gt; ("hello")</span><span id="3798" class="nb lb it mx b gy nj nd l ne nf">↓ Transpile// ES5</span><span id="ef32" class="nb lb it mx b gy nj nd l ne nf">function sayHello(){<br/>  return "hello";<br/>}</span></pre><p id="0465" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Polyfill有点不同。它重现了浏览器没有的缺失功能。比如<code class="fe ng nh ni mx b">Array.prototype.find</code>从ES6开始出现。表示<code class="fe ng nh ni mx b">Array.prototype.find</code>没有ES5版本。</p><p id="8db4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了巴别塔，transpile和polyfill就没那么难了。首先，请安装一些模块。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="11ad" class="nb lb it mx b gy nc nd l ne nf">yarn add -D @babel/preset-env core-js regenerator-runtime</span></pre><p id="b937" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关键模块是<code class="fe ng nh ni mx b">@babel/preset-env</code>和<code class="fe ng nh ni mx b">core-js</code>。因为JavaScript发展如此之快，数百个特性必须被转换和填充。但幸运的是，<code class="fe ng nh ni mx b">@babel/preset-env</code>是一个智能transpile预置，涵盖了大部分功能。而<code class="fe ng nh ni mx b">core-js</code>是polyfill预置。当你使用<code class="fe ng nh ni mx b">@babel/preset-env</code>和<code class="fe ng nh ni mx b">core-js</code>不支持的功能时，是时候考虑使用插件了。<code class="fe ng nh ni mx b">regenerator-runtime</code>是为了承诺。</p><p id="796d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">尽管清楚地理解它们很费时间，但配置很容易。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="07eb" class="nb lb it mx b gy nc nd l ne nf">// babel.config.json</span><span id="fd6b" class="nb lb it mx b gy nj nd l ne nf">{<br/>  "presets": [<br/>    [<br/>      "@babel/preset-env",<br/>      {<br/>        "useBuiltIns": "usage",<br/>        "corejs": 3<br/>      }<br/>    ],<br/>    "@babel/preset-react"<br/>  ],<br/>}</span></pre><p id="cf25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当你使用<code class="fe ng nh ni mx b">@babel/preset-env</code>时，应该指定两个。对于<code class="fe ng nh ni mx b">corejs</code>，应该指定3，因为它是维护的。<code class="fe ng nh ni mx b">useBuiltIns</code>定义如何添加聚合填充代码。你有如下两种选择。</p><ol class=""><li id="3ef1" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mr mj mk ml bi translated"><code class="fe ng nh ni mx b">usage</code>:将此文件中使用且目标环境不支持的特征的聚合填充添加到每个文件导入的顶部</li><li id="543e" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated"><code class="fe ng nh ni mx b">entry</code>:替换<code class="fe ng nh ni mx b">core-js</code>的导入，只导入目标环境模块所需。</li></ol><p id="31f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了减小束尺寸，<code class="fe ng nh ni mx b">usage</code>更好。</p><p id="748b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要检查您的应用程序代码是否成功传输和填充，您可以构建并查看ES6+功能是否不存在。</p><h1 id="c5ba" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">添加类型脚本</h1><p id="88ea" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">到目前为止，React、webpack和Babel已经设置得很完美了。但是我猜你们大多数人都想使用TypeScript，因为它可以加快开发速度，减少bug。所以让我们添加打字稿</p><p id="e2f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要添加TypeScript，您有两种编译选择。</p><ol class=""><li id="e1cc" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mr mj mk ml bi translated">TypeScript编译器(tsc)将TS转换为ES5 JS。tsc也做类型检查</li><li id="e78d" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mr mj mk ml bi translated">巴别塔隧道。tsc进行类型检查</li></ol><p id="9cc9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文解释了第二种选择，因为Babel transpiling比tsc有更大的灵活性。另外，责任明确。</p><ul class=""><li id="04ec" class="md me it kd b ke kf ki kj km mf kq mg ku mh ky mi mj mk ml bi translated">巴别塔在运输上有责任</li><li id="ed2e" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated">tsc负责类型检查</li></ul><p id="2e3c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，首先尝试设置Babel类型脚本传输！</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c729" class="nb lb it mx b gy nc nd l ne nf">yarn add -D <a class="ae kz" href="http://twitter.com/babel/preset-typescript" rel="noopener ugc nofollow" target="_blank">@babel/preset-typescript</a></span></pre><p id="926d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe ng nh ni mx b">@babel/preset-typescript</code>是TypeScript的超级预置。因为它没有涵盖TypeScript的所有特性，所以如果需要额外的特性，请添加插件，比如const enum。</p><p id="4eab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">配置很简单。只需将模块添加到<code class="fe ng nh ni mx b">babel.config.json</code>即可。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="59ee" class="nb lb it mx b gy nc nd l ne nf">// babel.config.json</span><span id="291d" class="nb lb it mx b gy nj nd l ne nf">{<br/>  "presets": [<br/>    "@babel/preset-typescript", // add here<br/>    [<br/>      "@babel/preset-env",<br/>     ...<br/>}</span></pre><p id="e82c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！Babel类型脚本传输设置完成🎉</p><p id="ae58" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为设置完成了，我们用TypeScript写React app吧！要用TypeScript编写react，应该添加它们的类型声明。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="e83c" class="nb lb it mx b gy nc nd l ne nf">yarn add -D <a class="ae kz" href="http://twitter.com/types/react" rel="noopener ugc nofollow" target="_blank">@types/react</a> <a class="ae kz" href="http://twitter.com/types/react-dom" rel="noopener ugc nofollow" target="_blank">@types/react-dom</a></span></pre><p id="5d74" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以还是把app代码改成TypeScript吧！。首先，将文件名<code class="fe ng nh ni mx b">main.ts</code>改为<code class="fe ng nh ni mx b">Index.tsx</code>。因为<code class="fe ng nh ni mx b">main.ts</code>有JSX ( <code class="fe ng nh ni mx b">&lt;App /&gt;</code>，所以造成了打字错误。为了防止空类型错误，在Index.tsx中添加空检查。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="bf6c" class="nb lb it mx b gy nc nd l ne nf">// src/Index.tsx<br/>import React from 'react';<br/>import { createRoot } from 'react-dom/client';<br/>import { App } from './App';</span><span id="d2fa" class="nb lb it mx b gy nj nd l ne nf">const rootNode = document.getElementById('app');</span><span id="c12a" class="nb lb it mx b gy nj nd l ne nf">if(rootNode){<br/>  createRoot(rootNode)<br/>    .render(&lt;App /&gt;);<br/>}</span></pre><p id="dfc7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一个<code class="fe ng nh ni mx b">App.jsx</code>。将文件扩展名改为<code class="fe ng nh ni mx b">.tsx</code>。然后，键入App.tsx。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="35a3" class="nb lb it mx b gy nc nd l ne nf">// App.tsx<br/>import React from 'react';</span><span id="cb0c" class="nb lb it mx b gy nj nd l ne nf">export const App: React.FC = () =&gt; (<br/>  &lt;h1&gt;Hello React&lt;/h1&gt;<br/>);</span></pre><p id="96c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为本文不关注类型系统，所以省略了对具体实现的解释。</p><p id="deb0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，添加webpack配置。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4137" class="nb lb it mx b gy nc nd l ne nf">// webpack.config.js<br/>const path = require('path')</span><span id="234c" class="nb lb it mx b gy nj nd l ne nf">module.exports = {<br/>  entry: './src/Index.tsx', // Changed the entry file name<br/>  ...  <br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.(js|ts)x?$/,    // add |ts<br/>        exclude: /node_modules/,<br/>        use: {<br/>          loader: 'babel-loader',<br/>        },<br/>      },<br/>    ],<br/>  },<br/>  resolve: {<br/>    extensions: ['.tsx', '.ts', '.jsx', '.js'], // add .tsx, .ts<br/>  },<br/>  ...<br/>}</span></pre><p id="58a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你现在尝试<code class="fe ng nh ni mx b">yarn dev</code>，你可以看到和以前一样的屏幕，没有控制台错误！</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/a3b274dbc8be7011be50b69cc98b3a34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*5bIjoovn0kalwO3zp6se6g.png"/></div></figure><p id="571e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">到目前为止，您可以传输TypeScript文件，但是检测类型错误并非不可能。所以让我们添加类型检查！</p><p id="029a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先加上<code class="fe ng nh ni mx b">typescript</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="8ab4" class="nb lb it mx b gy nc nd l ne nf">yarn add -D typescript</span></pre><p id="b946" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当您将<code class="fe ng nh ni mx b">typescript</code>添加到项目中时，您应该创建<code class="fe ng nh ni mx b">tsconfig.json</code>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f157" class="nb lb it mx b gy nc nd l ne nf">// tsconfig.json</span><span id="9c29" class="nb lb it mx b gy nj nd l ne nf">{<br/>  "compilerOptions": {<br/>    "target": "ESNext",<br/>    "module": "umd",<br/>    "lib": [<br/>      "ESNext",<br/>      "dom"<br/>    ],<br/>    "jsx": "react",<br/>    "noEmit": true,    <br/>    "sourceMap": true,</span><span id="8acd" class="nb lb it mx b gy nj nd l ne nf">    /* Strict Type-Checking Options */<br/>    "strict": true,<br/>    "noImplicitAny": true,<br/>    "strictNullChecks": true,<br/>   <br/>    /* Module Resolution Options */<br/>    "moduleResolution": "node",<br/>    "forceConsistentCasingInFileNames": true,<br/>    "esModuleInterop": true<br/>  },<br/>  "include": ["src"]<br/>}</span></pre><p id="c02c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">设置完成！</p><p id="51fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为Babel确实会转换文件，<code class="fe ng nh ni mx b">noEmit</code>应该是真的，<code class="fe ng nh ni mx b">target</code>不一定是旧的JavaScript。另外，因为你想使用DOM最新的JavaScript/TypeScript特性，<code class="fe ng nh ni mx b">lib</code>包括<code class="fe ng nh ni mx b">ESNext</code>和<code class="fe ng nh ni mx b">dom</code>。而<code class="fe ng nh ni mx b">jsx</code>应该是<code class="fe ng nh ni mx b">react</code>。类型检查规则应该根据您的需要进行定制。但我建议<code class="fe ng nh ni mx b">strict</code>选项为真。</p><p id="1ff5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您可以方便地添加类型检查命令。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="87fb" class="nb lb it mx b gy nc nd l ne nf">// package.json<br/>{<br/>  ...,<br/>  "scripts": {    <br/>    "dev": "webpack serve",<br/>    "build": "webpack --mode production --progress --hide-modules",<br/>    "tscheck": "tsc" // add here<br/>  }<br/>  ...<br/>}</span></pre><p id="7050" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果运行<code class="fe ng nh ni mx b">yarn tscheck</code>，tsc会检测到类型错误，如下所示。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="bc3e" class="nb lb it mx b gy nc nd l ne nf">❯ yarn tscheck<br/>yarn run v1.22.17<br/>$ tsc<br/>✨  Done in 1.97s.</span></pre><p id="a128" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你想尽快得到一个类型错误，你可以添加<code class="fe ng nh ni mx b">-w</code>选项。它会观察你的代码变化，并通知类型错误。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f698" class="nb lb it mx b gy nc nd l ne nf">❯ yarn tscheck -w</span></pre></div><div class="ab cl nr ns hx nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="im in io ip iq"><p id="ac94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文解释了React TypeScript项目与webpack和Babel的设置。在设置了一个包配置之后，我强烈推荐设置<code class="fe ng nh ni mx b">eslint</code>和<code class="fe ng nh ni mx b">prettier</code>来格式化你的类型脚本以加速你的开发！</p><div class="ny nz gp gr oa ob"><a href="https://egctoru.medium.com/auto-format-with-eslint-and-prettier-for-react-typescript-project-6526a9d44f81" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">React TypeScript项目的ESLint和更漂亮的自动格式</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">自动格式化是DX的一大改进。它节省了您的开发时间，并大大提高了您的生产力…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">egctoru.medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op jz ob"/></div></div></a></div><p id="3499" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">谢谢大家！</p><h1 id="510f" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">参考</h1><ul class=""><li id="60c4" class="md me it kd b ke ly ki lz km oq kq or ku os ky mi mj mk ml bi translated"><a class="ae kz" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank">打字稿</a></li><li id="091d" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><a class="ae kz" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank">反应</a></li><li id="dffd" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><a class="ae kz" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank">网络包</a></li><li id="bc77" class="md me it kd b ke mm ki mn km mo kq mp ku mq ky mi mj mk ml bi translated"><a class="ae kz" href="https://babeljs.io/" rel="noopener ugc nofollow" target="_blank">巴别塔</a></li></ul></div></div>    
</body>
</html>