<html>
<head>
<title>Install react-native-maps with Gradle 3 on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上安装带有Gradle 3的react-native-maps</h1>
<blockquote>原文：<a href="https://itnext.io/install-react-native-maps-with-gradle-3-on-android-44f91a70a395?source=collection_archive---------0-----------------------#2018-04-18">https://itnext.io/install-react-native-maps-with-gradle-3-on-android-44f91a70a395?source=collection_archive---------0-----------------------#2018-04-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="649b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个关于如何正确安装<code class="fe kl km kn ko b">react-native-maps </code>和<strong class="jp ir"> gradle 3 </strong>而不破坏你的应用的快速教程。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/d0b4177128368e9bd8d6988ec7ce4656.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/1*mt_YOkft4dQzrM8J1vZ3IQ.gif"/></div></figure><p id="04a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我试着在安卓系统上安装了<code class="fe kl km kn ko b">react-native-maps</code> <em class="kx">(我已经安装了最新版本的</em><code class="fe kl km kn ko b"><em class="kx">0.21.0</em></code><em class="kx">)</em><strong class="jp ir"/>，不幸的是我不能让它工作。运行<code class="fe kl km kn ko b">react-native run-android</code>时，构建失败并返回以下错误:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="bc8c" class="lc ld iq ko b gy le lf l lg lh">error while run android in(<strong class="ko ir">Could not find method compileOnly()</strong> for arguments [com.facebook.react:react-native:+] on object of type org.gradle.api.internal.artifacts.dsl.dependencies.DefaultDependencyHandler.)</span></pre><blockquote class="li"><p id="01b5" class="lj lk iq bd ll lm ln lo lp lq lr kk dk translated"><a class="ae ls" href="https://github.com/react-community/react-native-maps/issues/2188" rel="noopener ugc nofollow" target="_blank">可以访问</a> <code class="fe kl km kn ko b"><a class="ae ls" href="https://github.com/react-community/react-native-maps/issues/2188" rel="noopener ugc nofollow" target="_blank">react-native-maps</a></code> <a class="ae ls" href="https://github.com/react-community/react-native-maps/issues/2188" rel="noopener ugc nofollow" target="_blank"> github中开通的问题。</a></p></blockquote><p id="45d9" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">即使你正确地遵循了<code class="fe kl km kn ko b">react-native-maps</code>的官方安装指南，它仍然不会工作。所以经过一些研究、尝试和错误之后，我找到了一个让<code class="fe kl km kn ko b">react-native-maps</code>工作的解决方案。</p><p id="2c58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从。。。</p><h1 id="106c" class="ly ld iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">如何正确安装react-native-map</h1><h2 id="038c" class="lc ld iq bd lz mv mw dn md mx my dp mh jy mz na ml kc nb nc mp kg nd ne mt nf bi translated">装置</h2><ol class=""><li id="6826" class="ng nh iq jp b jq ni ju nj jy nk kc nl kg nm kk nn no np nq bi translated">安装<code class="fe kl km kn ko b">react-native-maps</code>库。</li></ol><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="d85b" class="lc ld iq ko b gy le lf l lg lh"># using yarn</span><span id="1cfa" class="lc ld iq ko b gy nr lf l lg lh">yarn add react-native-maps</span><span id="038a" class="lc ld iq ko b gy nr lf l lg lh"># using npm</span><span id="7332" class="lc ld iq ko b gy nr lf l lg lh">npm install react-native-maps --save</span></pre><p id="1d69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.通过运行以下命令将<code class="fe kl km kn ko b">react-native-maps</code>链接到您的项目:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="1eb7" class="lc ld iq ko b gy le lf l lg lh">react-native link</span></pre><p id="8972" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在您的<code class="fe kl km kn ko b">android/app/build.gradle</code>中，将<code class="fe kl km kn ko b">dependencies</code>的内容替换为:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="7c3f" class="lc ld iq ko b gy le lf l lg lh">dependencies {</span><span id="385c" class="lc ld iq ko b gy nr lf l lg lh">  implementation fileTree(dir: "libs", include: ["*.jar"])<br/>  implementation "com.android.support:appcompat-v7:23.0.1"<br/>  implementation "com.facebook.react:react-native:+"<br/>  implementation(project(':react-native-maps')){<br/>    exclude group: 'com.google.android.gms', module: 'play-services-base'<br/>    exclude group: 'com.google.android.gms', module: 'play-services-maps'<br/>  }<br/>  implementation 'com.google.android.gms:play-services-base:10.0.1'<br/>  implementation 'com.google.android.gms:play-services-maps:10.0.1'</span><span id="5580" class="lc ld iq ko b gy nr lf l lg lh">}</span></pre><blockquote class="ns nt nu"><p id="acc2" class="jn jo kx jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">语法<code class="fe kl km kn ko b">compile </code>是针对gradle版本2的。由于<code class="fe kl km kn ko b">react-native-maps</code>现在使用的是gradle版本3，我们必须将<code class="fe kl km kn ko b">compile</code>更新到<code class="fe kl km kn ko b">implementation</code>才能让它工作。</p></blockquote><p id="d8df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.指定您的Google Maps API密钥。在<code class="fe kl km kn ko b">android/app/src/main/AndroidManifest.xml</code>中将您的API密钥添加到您的清单文件中:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="2ac0" class="lc ld iq ko b gy le lf l lg lh"><em class="kx">&lt;application&gt;<br/></em>  &lt;!-- You will only need to add this meta-data tag, but make sure it's a child of application --&gt;</span><span id="746c" class="lc ld iq ko b gy nr lf l lg lh">  &lt;meta-data <br/>    android:name="com.google.android.geo.API_KEY"<br/>    android:value="Your Google maps API Key Here"/&gt;</span><span id="8f8b" class="lc ld iq ko b gy nr lf l lg lh"><em class="kx">&lt;/application&gt;</em></span></pre><blockquote class="ns nt nu"><p id="8ead" class="jn jo kx jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">要获取您的<strong class="jp ir">谷歌地图API密钥，</strong>请访问<a class="ae ls" href="https://developers.google.com/maps/documentation/android-api/signup" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/maps/documentation/android-API/sign up</a>获取您的Android密钥。</p><p id="7ee2" class="jn jo kx jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">确保当前项目启用了Google Maps Android API。<a class="ae ls" href="https://console.developers.google.com/apis/library/maps-android-backend.googleapis.com/" rel="noopener ugc nofollow" target="_blank">https://console . developers . Google . com/APIs/library/maps-Android-back end . Google APIs . com</a></p><p id="3719" class="jn jo kx jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">没有API密匙，谷歌地图不会显示任何内容。</p></blockquote></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="f2bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.<strong class="jp ir">搞定！</strong></p><p id="da1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们对<code class="fe kl km kn ko b">react-native-maps</code>的安装和配置现已完成！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi of"><img src="../Images/3b6964d6b8a063d79e1c4383a03d185c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*g_qGCO1oL7UEkziEcRqpKg.gif"/></div></figure><p id="62c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是现在庆祝还为时过早，因为如果你试图运行<code class="fe kl km kn ko b">react-native run-android</code>——它不会成功构建。</p><p id="9ae1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能会看到类似这样的错误:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oh oi di oj bf ok"><div class="gh gi og"><img src="../Images/2417141ea2f12678c8090c615a60df21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpVsqBBw6SyEBV9HTiSH0A.png"/></div></div></figure><h2 id="00d9" class="lc ld iq bd lz mv mw dn md mx my dp mh jy mz na ml kc nb nc mp kg nd ne mt nf bi translated"><strong class="ak"> <em class="ol"> —问题</em> </strong></h2><p id="3b4a" class="pw-post-body-paragraph jn jo iq jp b jq ni js jt ju nj jw jx jy om ka kb kc on ke kf kg oo ki kj kk ij bi translated">这是一个关于<code class="fe kl km kn ko b">react-native-maps</code>使用gradle版本3语法的问题。我们需要的是直接从<code class="fe kl km kn ko b">node_modules/</code>破解并修改<code class="fe kl km kn ko b">react-native-maps</code>包。是啊！内部<code class="fe kl km kn ko b">node_modules</code>。但是这不是一个好的方法，因为每次一个新的开发者获得你的项目的副本，他们必须总是修改<code class="fe kl km kn ko b">node_modules/</code>里面的库，这是不可取的。</p><h2 id="db31" class="lc ld iq bd lz mv mw dn md mx my dp mh jy mz na ml kc nb nc mp kg nd ne mt nf bi translated"><strong class="ak"> <em class="ol"> —解决方案</em> </strong></h2><p id="1369" class="pw-post-body-paragraph jn jo iq jp b jq ni js jt ju nj jw jx jy om ka kb kc on ke kf kg oo ki kj kk ij bi translated">我们必须将gradle升级到版本3，这样<code class="fe kl km kn ko b">react-native-maps</code>才能在你的项目中工作。</p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><h1 id="90ab" class="ly ld iq bd lz ma op mc md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu bi translated">升级我们的Gradle</h1><p id="f778" class="pw-post-body-paragraph jn jo iq jp b jq ni js jt ju nj jw jx jy om ka kb kc on ke kf kg oo ki kj kk ij bi translated">1 .修改<code class="fe kl km kn ko b">android/build.gradle</code>:</p><p id="1711" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe kl km kn ko b">repositories</code>内添加<code class="fe kl km kn ko b">google()</code></p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="10fa" class="lc ld iq ko b gy le lf l lg lh">buildscript {<br/>    repositories {<br/>        jcenter()<br/>        // add google() here<br/>        <strong class="ko ir">google()</strong></span></pre><p id="3f42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<code class="fe kl km kn ko b">com.android.tools.build.gradle</code>更新为<code class="fe kl km kn ko b">3.1.0</code></p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="312a" class="lc ld iq ko b gy le lf l lg lh">buildscript {<br/>    repositories {<br/>        jcenter()<br/>        google()<br/>    }<br/>    dependencies {<br/>      // classpath 'com.android.tools.build:gradle:2.2.3'<br/>      // update from 2.2.3 to 3.1.0 <br/>      <strong class="ko ir">classpath 'com.android.tools.build:gradle:3.1.0'</strong></span></pre><p id="2864" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe kl km kn ko b">dependencies</code>后的<code class="fe kl km kn ko b">repositories</code>内增加<code class="fe kl km kn ko b">google()</code>:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="f634" class="lc ld iq ko b gy le lf l lg lh">buildscript {<br/>    repositories {<br/>        jcenter()<br/>        google()<br/>    }<br/>    dependencies {<br/>      classpath 'com.android.tools.build:gradle:3.1.0'<br/>    }<br/>    allprojects {<br/>      repositories {<br/>        mavenLocal()<br/>        jcenter()<br/>        // add googgle() here<br/>        <strong class="ko ir">google()</strong></span></pre><p id="1149" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.将<code class="fe kl km kn ko b">android.enableAapt2=false</code>添加到<code class="fe kl km kn ko b">android/gradle.properties</code></p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="f1c3" class="lc ld iq ko b gy le lf l lg lh"><strong class="ko ir">android.enableAapt2=false</strong> // &lt; ---  add here<br/>android.useDeprecatedNdk=true<br/>MYAPP_RELEASE_STORE_FILE=my-release-key.keystore<br/>MYAPP_RELEASE_KEY_ALIAS=my-key-alias</span></pre><p id="5265" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.在<code class="fe kl km kn ko b">android/gradle/wrapper/gradle-wrapper.properties</code>中更新梯度版本:</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="dd9b" class="lc ld iq ko b gy le lf l lg lh">// from version 2.14.1</span><span id="20f2" class="lc ld iq ko b gy nr lf l lg lh">distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip</span><span id="f7c4" class="lc ld iq ko b gy nr lf l lg lh">// change to 4.4</span><span id="f150" class="lc ld iq ko b gy nr lf l lg lh"><strong class="ko ir">distributionUrl=https\://services.gradle.org/distributions/gradle-4.4-all.zip</strong></span></pre><p id="2419" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.<strong class="jp ir"> </strong>运行<code class="fe kl km kn ko b">react-native run-android</code>。这可能需要一段时间，因为它将下载更新的gradle版本。)</p><p id="586c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.如果您的应用程序构建成功并在模拟器中打开。那么我们的升级就完成了。<strong class="jp ir">搞定！</strong></p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><p id="c74b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经在react本地项目中正确安装了<code class="fe kl km kn ko b">react-native-maps</code>。让我们尝试创建一个呈现地图的组件。</p><pre class="kq kr ks kt gt ky ko kz la aw lb bi"><span id="27c3" class="lc ld iq ko b gy le lf l lg lh">import React, { Component } from 'react'<br/>import MapView, { PROVIDER_GOOGLE } from 'react-native-maps'<br/>import { View, StyleSheet } from 'react-native'</span><span id="14a0" class="lc ld iq ko b gy nr lf l lg lh">class MapTest extends Component {<br/>  render () {<br/>    return (<br/>      &lt;View style={styles.container}&gt;<br/>        &lt;MapView<br/>          provider={PROVIDER_GOOGLE}<br/>          style={styles.map}<br/>          region={{<br/>            latitude: 37.78825,<br/>            longitude: -122.4324,<br/>            latitudeDelta: 0.015,<br/>            longitudeDelta: 0.0121,<br/>          }}<br/>        &gt;&lt;/MapView&gt;<br/>      &lt;/View&gt;<br/>    )   <br/>  }<br/>}</span><span id="d5d8" class="lc ld iq ko b gy nr lf l lg lh">const styles = StyleSheet.create({<br/>  container: { ... StyleSheet.absoluteFillObject },<br/>  map: { ...StyleSheet.absoluteFillObject }<br/>})</span><span id="c87e" class="lc ld iq ko b gy nr lf l lg lh">export default MapTest</span></pre><blockquote class="li"><p id="43aa" class="lj lk iq bd ll lm ln lo lp lq lr kk dk translated">重建/重新加载我们的应用程序应该渲染地图</p></blockquote><figure class="ou ov ow ox oy ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/d0b4177128368e9bd8d6988ec7ce4656.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/1*mt_YOkft4dQzrM8J1vZ3IQ.gif"/></div><figcaption class="oz pa gj gh gi pb pc bd b be z dk translated">工作反应原生地图</figcaption></figure><p id="a3b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就结束了我们使用gradle 3安装<code class="fe kl km kn ko b">react-native-maps</code>的快速教程。<strong class="jp ir">谢谢！</strong></p></div><div class="ab cl ny nz hu oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ij ik il im in"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/fe52590c471974d24702e71541e6f661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*kXSbv2omTcaB6EdaAzOCBw.gif"/></div></figure><blockquote class="li"><p id="ebf0" class="lj lk iq bd ll lm ln lo lp lq lr kk dk translated"><em class="ol">你可以按住拍手按钮，留下许多拍手声！\m/谢谢！</em></p></blockquote></div></div>    
</body>
</html>