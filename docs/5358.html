<html>
<head>
<title>Size comparison of Go executables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go可执行文件的大小比较</h1>
<blockquote>原文：<a href="https://itnext.io/size-comparison-of-go-executables-9b4ae2aaebb5?source=collection_archive---------1-----------------------#2021-02-16">https://itnext.io/size-comparison-of-go-executables-9b4ae2aaebb5?source=collection_archive---------1-----------------------#2021-02-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6aa8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从版本1.7.6到1.16rc1</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/533ecfb7e5973efd9fa41198d794d0aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hF6YXPMB94PImIgL80P-g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由Renee French创建的原始地鼠图像，使用由Maria Letta创建的地鼠图像</figcaption></figure><p id="65cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Go编程语言起源于2007年，于2009年公开亮相。和其他编程语言一样，它也在成长和变化。</p><p id="61ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我们公司，我们经常使用Go。我们的系统是不同微服务的组合，并部署在互联网上。每一次更新也通过互联网完成，测试通过互联网完成，配对开发通过互联网完成，…一切都通过互联网完成。</p><p id="83ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是为什么<strong class="la iu">我们喜欢让我们的二进制文件尽可能小。从一个角度来说，我们不是在浪费网络资源。从不同的角度来看，我们没有浪费时间，等待转移完成。</strong></p><p id="9262" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们做了两件事来缩小我们的二进制文件。起初，我们改变了我们的构建来使用<code class="fe lu lv lw lx b">-ldflags=”-s -w”</code>。然后我们开始用<a class="ae ly" href="https://upx.github.io" rel="noopener ugc nofollow" target="_blank"> upx </a>。</p><p id="69f0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这两步都给了我们很大的帮助。</p><p id="c1b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我们并不完美，仍然有一些安装运行遗留代码，由于各种原因没有更新。某天有人问了一个简单的问题。如果将一个Go版本与另一个进行比较，这些可执行文件有多少不同？<strong class="la iu">更新那些运行遗留代码的安装有意义吗？</strong></p><p id="872b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，我们从<em class="lz">大小的角度</em>对Go可执行文件进行了比较。因为我们从1.7.x版本开始在生产中使用Go，所以这个比较也从1.7.x版本开始。</p><p id="25b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们对每一个主要版本都做了比较，包括最新的次要版本。示例:使用1.7.6作为1.7.x的最新次要版本。</p><p id="2070" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想知道，我们到底为什么使用Go，你可以在这里找到一些思路。</p><div class="ma mb gp gr mc md"><a rel="noopener  ugc nofollow" target="_blank" href="/7-reasons-you-should-try-use-go-5fb4714015d1"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">你应该尝试围棋的7个理由</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">原因，我们停止使用Java和C#</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">itnext.io</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr ks md"/></div></div></a></div><p id="7e84" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一个简单的Go程序被用于这个比较。没什么花哨的，可能简单的<em class="lz"> Hello world </em>就够了。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ms mt l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="08f7" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">Go可执行文件的比较</h1><p id="ad9b" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">下图按大小比较了可执行文件。</p><p id="056e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每个Go版本都有三个可执行文件:Windows使用<code class="fe lu lv lw lx b">GOOS=windows</code>，Linux使用<code class="fe lu lv lw lx b">GOOS=linux</code>，MacOS使用<code class="fe lu lv lw lx b">GOOS=darwin</code>。</p><p id="4cbe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">显然，Linux是这里的赢家。从1.8.x版本开始，它的可执行文件是最小的。</p><p id="1a1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里的好处是，从1.10.x版本开始，可执行文件的大小几乎没有显著增加。事实恰恰相反。最新的主要版本1.15.8的可执行文件比版本1.14.15稍小。而即将到来的1.16x版本甚至有更好的效果。</p><p id="3138" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从版本1.9.x(对于上面的代码)开始，可执行文件的平均大小约为2MB。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/1c20b9bf4a56260c3cbe3696dc086c8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sU73xIvyE5kAM5Mm8N9JwA.png"/></div></div></figure><p id="04d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您比较这些可执行文件的增长(它们与版本1.7.6有何不同)，您可以看到增长大约为20–30%，在最近两个主要版本中略有下降。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/dbb8db7750910047562909a39fb32a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2FhrlaaIqZAzKcJy5Q7DeQ.png"/></div></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="2c54" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">添加ldflags</h1><p id="7aae" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">通过添加<code class="fe lu lv lw lx b">-ldflags=”-s -w”</code>，当构建可执行文件时，您可以看到所有版本的预期减少。你可以看出，下降非常显著。</p><p id="e1cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">从版本1.9.x开始，可执行文件的大小约为1.2-1.6MB</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/7ac81df54ff150afb0d69b1b5b94c42c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*voUs5GZmWjr70jJiYelA0w.png"/></div></div></figure><p id="4a10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当我们将新的可执行文件与旧的进行比较时，我们可以看到新的是原始大小的60–80%。平均70%。那还不错。事实上，那真的很好。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/9cee75696b72fd139841f533460f575b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwKxfdswAukqm4YuDWQTug.png"/></div></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="5483" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">使用UPX</h1><p id="5183" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">UPX是可执行文件的终极打包者。如果你熟悉Zip、Rar或其他，这个应用程序做一些类似的事情。它压缩可执行文件并从中生成不同种类的可执行文件。这个压缩的可执行文件仍然可以运行。当您运行它时，它会解压缩回原来的可执行文件(在内存中)，然后执行原来的文件。当您运行这个打包的可执行文件时，应该会有一点延迟，但是对于Go可执行文件来说，这种延迟是人类感觉不到的。</p><p id="5671" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，这些打包的可执行文件小得令人难以置信。几乎都小于0.6MB。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/76e57fd845185f3ce2b2c00d94d2e7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFV-Dr2cQ0CaTE55jNFwmA.png"/></div></div></figure><p id="7011" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，您可以看到这些新的可执行文件是原始大小的23–30%。平均约为原始大小的26%。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/1d566e425b6d7771b8849066b415997d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zC2eoFSzXrbXB_n2aJzIkA.png"/></div></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="c269" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">摘要</h1><p id="6547" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">从<em class="lz">大小来看</em>，始终使用最新版本的Go是明智的。</p><p id="4a63" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">平均来说，使用<code class="fe lu lv lw lx b">ldflags</code>可以减少70%的可执行文件。UPX给你带来了更好的结果:平均高达原始大小的27%。</p><p id="2e5e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们从2018年开始在生产中使用<code class="fe lu lv lw lx b">ldflags</code>和UPX，没有任何问题，所以我建议你尝试一下。</p><p id="a684" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里是最后一个比较:1.15.8版本的可执行文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/bde6805d9348d0a1c20773b9661ffef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f4x5RXAetohPqRsRGGvMHQ.png"/></div></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h1 id="266c" class="nb nc it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">更新:附加UPX信息</h1><p id="9441" class="pw-post-body-paragraph ky kz it la b lb nt ju ld le nu jx lg lh nv lj lk ll nw ln lo lp nx lr ls lt im bi translated">UPX打包的可执行文件可以被一些杀毒软件检测为恶意软件，你应该知道这一点(谢谢<em class="lz"> nindustries </em>和<em class="lz"> PaluMacil </em>)。</p><p id="68d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我测试了所有三个可执行文件。</p><p id="0ec6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个Linux可执行文件的病毒总数结果的链接。这里没有假警报。</p><div class="ma mb gp gr mc md"><a href="https://www.virustotal.com/gui/file/1c4c9cf6580b26172fbaff07cced0b0b87a2d7d9c0616c2b2a58fcba15f26034/detection" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">病毒总数</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">病毒总数</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">VirusTotalwww.virustotal.com</p></div></div></div></a></div><p id="d411" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是一个Windows可执行文件结果的链接。如你所见，这里有一些假警报。</p><div class="ma mb gp gr mc md"><a href="https://www.virustotal.com/gui/file/ad352bfb5103608433ec4249678a533d619f29102c07b7d621ed90cd6677b025/detection" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">病毒总数</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">病毒总数</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">VirusTotalwww.virustotal.com</p></div></div></div></a></div><p id="4ecb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">和一个macOS结果的链接，使它完整。这里没有假警报。</p><div class="ma mb gp gr mc md"><a href="https://www.virustotal.com/gui/file/f8b696f49aad461ca0592ebe8b4d23f769c12a4601d7264cc20ddbb4496e61a3/detection" rel="noopener  ugc nofollow" target="_blank"><div class="me ab fo"><div class="mf ab mg cl cj mh"><h2 class="bd iu gy z fp mi fr fs mj fu fw is bi translated">病毒总数</h2><div class="mk l"><h3 class="bd b gy z fp mi fr fs mj fu fw dk translated">病毒总数</h3></div><div class="ml l"><p class="bd b dl z fp mi fr fs mj fu fw dk translated">VirusTotalwww.virustotal.com</p></div></div></div></a></div><p id="06d9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">在部署之前测试UPX打包的可执行文件是明智的。</strong></p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="0d19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">可能你还不太服气……因为，谁管你10秒还是2.5秒就把可执行文件转移了。但是如果你平均每天转账100次，那么一年就是36 500次。然后，您将100小时与27小时的可执行文件传输进行比较。你节省了73小时的网络流量和73小时的个人时间。</p><p id="8ffd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">而这些时间可以用在更好的事情上:-)。</p></div></div>    
</body>
</html>