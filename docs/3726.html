<html>
<head>
<title>Where to place RxJs operator take(1)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RxJs算子取哪里(1)？</h1>
<blockquote>原文：<a href="https://itnext.io/where-to-place-rxjs-operator-take-1-39a8a00f65cb?source=collection_archive---------2-----------------------#2020-02-11">https://itnext.io/where-to-place-rxjs-operator-take-1-39a8a00f65cb?source=collection_archive---------2-----------------------#2020-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e178b4221f383737c5b89f0edef5f5ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OmfmPRwvQuYt3osJj1P5Yw.png"/></div></div></figure><div class=""/><p id="f187" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们把<code class="fe kx ky kz la b">take(1)</code>放在可见链的开头还是结尾有关系吗？</p><p id="1bc7" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">看看下面两个(伪)RxJs可观测链的例子，我们把<code class="fe kx ky kz la b">take</code>运算符放在哪里有关系吗？</p><h2 id="dfbe" class="lb lc jb bd ld le lf dn lg lh li dp lj kk lk ll lm ko ln lo lp ks lq lr ls lt bi translated">案例1:</h2><figure class="lu lv lw lx gt is"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">在switchMap运算符之前使用take运算符的可观察链的代码片段</figcaption></figure><h2 id="8846" class="lb lc jb bd ld le lf dn lg lh li dp lj kk lk ll lm ko ln lo lp ks lq lr ls lt bi translated">案例二:</h2><figure class="lu lv lw lx gt is"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">在switchMap运算符后使用take运算符的可观察链的代码段。</figcaption></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><blockquote class="ml mm mn"><p id="83b3" class="jz ka mo kb b kc kd ke kf kg kh ki kj mp kl km kn mq kp kq kr mr kt ku kv kw ij bi translated">在<strong class="kb jc">和</strong>两种情况下<strong class="kb jc">会结束</strong>可观察的 <strong class="kb jc">链</strong>(退订)吗？</p><p id="fd34" class="jz ka mo kb b kc kd ke kf kg kh ki kj mp kl km kn mq kp kq kr mr kt ku kv kw ij bi translated">在第一个<strong class="kb jc">和第二个</strong>的情况下，我们会得到多少<strong class="kb jc">和多少</strong>的排放量？</p></blockquote><p id="051f" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">简而言之，我们在第一种情况下得到多次发射，在第二种情况下得到一次发射。所以为了让<code class="fe kx ky kz la b">take</code>在<strong class="kb jc"> 1发射</strong>后<strong class="kb jc">完成</strong>可观测链，需要把<strong class="kb jc">放在最后！</strong></p><figure class="lu lv lw lx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/792dcf48d6ba525d07f175e48a0716a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yHVTzaZiIm5ip4uWWsXOg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">案例1:我们得到多重排放——见例子<a class="ae mt" href="https://rxviz.com/v/zopr69mJ" rel="noopener ugc nofollow" target="_blank">https://rxviz.com/v/zopr69mJ</a></figcaption></figure><figure class="lu lv lw lx gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ms"><img src="../Images/7ea8f4a56b900744e70b6d898d0f4d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wSvUoXGETxyOWzwtdJ7Eug.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">案例2:我们获得一次排放并完成—参见示例<a class="ae mt" href="https://rxviz.com/v/B8ZnLPn8" rel="noopener ugc nofollow" target="_blank">https://rxviz.com/v/B8ZnLPn8</a></figcaption></figure></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="89be" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了更详细地回答这些问题，让我们看一下Stackblitz(或者如果Stackblitz对您来说是不可访问的，则看下面的要点)。</p><figure class="lu lv lw lx gt is"><div class="bz fp l di"><div class="mu lz l"/></div></figure><figure class="lu lv lw lx gt is"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">显示在“switchMap”之前和之后放置“take”运算符的结果的代码段</figcaption></figure><ul class=""><li id="4608" class="mv mw jb kb b kc kd kg kh kk mx ko my ks mz kw na nb nc nd bi translated">两种情况<strong class="kb jc">完成</strong>回调触发，因此<code class="fe kx ky kz la b">take</code>操作员<strong class="kb jc">完成其工作</strong>并且<strong class="kb jc">取消订阅* </strong></li><li id="a8c8" class="mv mw jb kb b kc ne kg nf kk ng ko nh ks ni kw na nb nc nd bi translated">在第一种情况下(<code class="fe kx ky kz la b">take</code>之后的<code class="fe kx ky kz la b">switchMap</code>)，我们在完全回调触发之前得到<strong class="kb jc">多次发射</strong>，而在另一种情况下得到<strong class="kb jc">一次发射</strong></li></ul></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="61bc" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">对于取消订阅的逻辑，在这里看一下<code class="fe kx ky kz la b">take</code>操作符<a class="ae mt" href="https://github.com/ReactiveX/rxjs/blob/338b1746e11247bbdc6d617b634fab900717288f/src/internal/operators/take.ts#L92-L96" rel="noopener ugc nofollow" target="_blank">的源代码</a>。简而言之:</p><figure class="lu lv lw lx gt is"><div class="bz fp l di"><div class="ly lz l"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">github中显示取消订阅逻辑的“take.ts”源代码片段。一旦数量达到给定值，就会完成“获取”并取消订阅。</figcaption></figure><p id="84c4" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="mo"> *实际上在第一种情况下complete fires是因为我们使用了另一个</em> <code class="fe kx ky kz la b"><em class="mo">take</em></code> <em class="mo">运算符来结束后3项。</em></p></div><div class="ab cl me mf hu mg" role="separator"><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj mk"/><span class="mh bw bk mi mj"/></div><div class="ij ik il im in"><p id="2552" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb jc">情况2</strong>:(<code class="fe kx ky kz la b">switchMap</code>后<code class="fe kx ky kz la b">take</code>):take运算符逻辑负责完成并取消订阅第一次发射后<code class="fe kx ky kz la b">switchMap</code>产生的可观察值。</p><p id="93de" class="pw-post-body-paragraph jz ka jb kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb jc">案例1</strong>:<code class="fe kx ky kz la b">switchMap</code>前的<code class="fe kx ky kz la b">take</code>)<code class="fe kx ky kz la b">destination</code>是<code class="fe kx ky kz la b">switchMap</code>运算符的输入。因此<code class="fe kx ky kz la b">take</code>在第一个值之后停止发射，但是<code class="fe kx ky kz la b">switchMap</code>产生的可观测值正在发射，因此整个可观测值持续到完成。</p></div></div>    
</body>
</html>