<html>
<head>
<title>aws-vault to authenticate your aws accounts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">aws-vault验证您的aws帐户</h1>
<blockquote>原文：<a href="https://itnext.io/aws-vault-to-authenticate-your-aws-accounts-696d08446106?source=collection_archive---------0-----------------------#2022-09-02">https://itnext.io/aws-vault-to-authenticate-your-aws-accounts-696d08446106?source=collection_archive---------0-----------------------#2022-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/80772c647a5cfa412685ac3045154acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7K8nKBb2Fmc44_oTvqj-3w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图片来源:spot.io</figcaption></figure><div class=""/><p id="d988" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我当前的项目中，我有机会和团队一起使用<code class="fe la lb lc ld b">aws-vault</code>。我以前只是依靠我配置的<code class="fe la lb lc ld b">aws</code> cli工具登录一个帐户，但我意识到，如果你想从cli访问或执行多个不同aws子帐户的命令，这可能是一个相当棘手的问题。aws-vault解决了这个问题；它允许您配置通过cli访问的多个aws子帐户。最好的方法是只需配置一次，就可以轻松地与任何其他可能需要访问aws服务的cli工具集成。</p><div class="ip iq gp gr ir le"><a href="https://github.com/99designs/aws-vault" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jg gy z fp lj fr fs lk fu fw je bi translated">GitHub - 99designs/aws-vault:一个用于安全地存储和访问aws凭证的保险库…</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">AWS Vault是一个在开发环境中安全存储和访问AWS凭证的工具。AWS保管库存储IAM…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">github.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ix le"/></div></div></a></div><p id="474c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们有三个不同的aws子账户，<code class="fe la lb lc ld b">dev</code>、<code class="fe la lb lc ld b">staging</code>和<code class="fe la lb lc ld b">prod</code>，在我们的aws账户上展示我们的变化。我访问这些账户时，最常用的是使用terraform进行基础设施开发。每次我想在使用<code class="fe la lb lc ld b">aws-vault</code>之前切换到另一个子账户时，我都必须配置<code class="fe la lb lc ld b">aws/config</code>文件。设置它也只需要5分钟！</p><p id="c1e2" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">配置<code class="fe la lb lc ld b">aws-vault</code>的先决条件是已经安装了<code class="fe la lb lc ld b">aws</code> cli，然后通过<code class="fe la lb lc ld b">brew install --cask aws-vault</code>为mac用户安装<code class="fe la lb lc ld b">aws-vault</code>。在理想的aws设置中，用户将被创建在root帐户中，并有一个与之相关联的<code class="fe la lb lc ld b">mfa</code>。在每个aws子帐户中，一个<code class="fe la lb lc ld b">admin</code>或高权限角色将允许用户访问不同的服务。您需要为用户创建访问密钥和密码，以便能够通过cli访问该帐户。创建之后，您需要更新您的<code class="fe la lb lc ld b">aws/config</code>文件来配置所有的账户。</p><div class="ip iq gp gr ir le"><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jg gy z fp lj fr fs lk fu fw je bi translated">安装或更新最新版本的AWS CLI</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">本主题介绍如何在…上安装或更新最新版本的AWS命令行界面(AWS CLI)</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="2ef4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">具有多个子账户的典型设置如下所示:</p><pre class="lt lu lv lw gt lx ld ly lz aw ma bi"><span id="d173" class="mb mc jf ld b gy md me l mf mg">[default]<br/>region=eu-central-1<br/>output=yaml</span><span id="5cdd" class="mb mc jf ld b gy mh me l mf mg"># the role_arn is the admin or similar role<br/># that you need to create in every sub-account</span><span id="d86d" class="mb mc jf ld b gy mh me l mf mg">[profile dev]<br/>mfa_serial=arn:aws:iam::&lt;root-account-id&gt;:mfa/ali<br/>role_arn=arn:aws:iam::&lt;dev-account-id&gt;:role/admin</span><span id="0c81" class="mb mc jf ld b gy mh me l mf mg">[profile staging]<br/>mfa_serial=arn:aws:iam::&lt;root-account-id&gt;:mfa/ali<br/>role_arn=arn:aws:iam::&lt;staging-account-id&gt;:role/admin</span><span id="b66a" class="mb mc jf ld b gy mh me l mf mg">[profile prod]<br/>mfa_serial=arn:aws:iam::&lt;root-account-id&gt;:mfa/ali<br/>role_arn=arn:aws:iam::&lt;prod-account-id&gt;:role/admin</span></pre><p id="cc55" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦你建立了配置文件，你就可以开始为<code class="fe la lb lc ld b">dev</code>、<code class="fe la lb lc ld b">staging</code>和<code class="fe la lb lc ld b">prod</code>添加账号了。那就像执行<code class="fe la lb lc ld b">aws-vault add dev</code>一样简单。cli会提示您输入已经为您的用户创建的<code class="fe la lb lc ld b">ACCESS_KEY_ID</code>和<code class="fe la lb lc ld b">SECRET_ACCESS_KEY</code>。您可以通过执行<code class="fe la lb lc ld b">aws-vault exec dev -- aws sts get-caller-identity</code>并验证您是否能看到您的用户凭证来验证配置是否成功。您可以继续为其余帐户创建<code class="fe la lb lc ld b">aws-vault</code>配置，并且您已经安全地设置了您的<code class="fe la lb lc ld b">aws</code> cli访问。使用<code class="fe la lb lc ld b">aws-vault</code>的一个优点是，您不需要在<code class="fe la lb lc ld b">aws/credentials</code>文件中以纯文本格式存储您的访问凭证。</p><p id="150f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">设置<code class="fe la lb lc ld b">aws-vault</code>在很大程度上简化了我的部署过程。我不再需要修改我的<code class="fe la lb lc ld b">aws/config</code>文件来进行跨帐户部署。我只需要选择相应的帐户并执行我需要的命令。</p><pre class="lt lu lv lw gt lx ld ly lz aw ma bi"><span id="9bc9" class="mb mc jf ld b gy md me l mf mg">aws-vault exec dev -- terraform plan<br/>aws-vault exec staging -- terraform plan<br/>aws-vault exec prod -- terraform plan</span></pre><p id="58cd" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">您可以通过<code class="fe la lb lc ld b">aws-vault exec &lt;sub-account&gt; -- env | grep AWS</code>查看您的<code class="fe la lb lc ld b">aws-vault</code>账户中存储的特定子账户的所有信息。让我知道你如何找到这个工具的用法。</p></div></div>    
</body>
</html>