<html>
<head>
<title>Istio as an Example of When Not to Do Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Istio作为何时不做微服务的例子</h1>
<blockquote>原文：<a href="https://itnext.io/istio-as-an-example-of-when-not-to-do-microservices-50f2619a9e55?source=collection_archive---------2-----------------------#2020-01-16">https://itnext.io/istio-as-an-example-of-when-not-to-do-microservices-50f2619a9e55?source=collection_archive---------2-----------------------#2020-01-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d73f" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">过去五年来，我一直致力于帮助组织实现云原生之旅。现代化和提高一个团队(以及最终一个组织)交付基于软件的技术的速度受到it人员、过程和最终技术决策的严重影响。当应用架构的顶点已经成为进行变更和“更快发展”的瓶颈(由于各种人员/流程/技术因素)时，微服务方法可能是合适的，<a class="ae km" href="https://blog.christianposta.com/microservices/when-not-to-do-microservices/" rel="noopener ugc nofollow" target="_blank">但它不是唯一的方法</a>。</p><blockquote class="kn ko kp"><p id="201a" class="jo jp kq jq b jr js jt ju jv jw jx jy kr ka kb kc ks ke kf kg kt ki kj kk kl ij bi translated">微服务不是“乌托邦式的应用架构”。</p></blockquote><p id="08f6" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">我过去曾写道，我如何不认为许多团队<a class="ae km" href="https://blog.christianposta.com/microservices/youre-not-going-to-do-microservices/" rel="noopener ugc nofollow" target="_blank">能够完成</a>，<a class="ae km" href="https://blog.christianposta.com/microservices/the-hardest-part-about-microservices-data/" rel="noopener ugc nofollow" target="_blank">如何有让它工作的“困难部分”</a>，甚至提到一些可能<a class="ae km" href="https://blog.christianposta.com/microservices/the-hardest-part-of-microservices-calling-your-services/" rel="noopener ugc nofollow" target="_blank">对你的长期努力有益的技术</a>。FWIW我甚至<a class="ae km" href="https://www.oreilly.com/library/view/microservices-for-java/9781492042228/" rel="noopener ugc nofollow" target="_blank">写了一本关于这个话题的书</a>。</p><p id="b56e" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated"><a class="ae km" href="https://blog.christianposta.com/microservices/when-not-to-do-microservices/" rel="noopener ugc nofollow" target="_blank">远离微服务</a>可能是最好的起点，尽管现在许多组织都已经过了这个阶段。</p><h1 id="efd1" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">你已经走上了微服务的道路</h1><p id="1035" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">如果你真的走上了微服务的道路，当它不起作用时，对你自己和组织要诚实。纠正路线可能是你产品成功的正确步骤。</p><h1 id="5f2e" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">当它不起作用时要诚实</h1><p id="b3d6" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">尽管初衷是好的，但一旦你开始使用微服务，回到整体可能是正确的选择，即使是出于正确的原因。如果你的假设或你决策的背景发生了变化，回到一块巨石上去“没关系”。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/cc85dcd88be14daedd7e08e4ce613e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*AJHVxOYdeFzuBw2n.png"/></div></figure><p id="74ce" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">在为微服务通信构建<a class="ae km" href="https://istio.io/docs/concepts/what-is-istio/#what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank">服务网格</a>的<a class="ae km" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio社区</a>中，控制平面的实现将<a class="ae km" href="https://docs.google.com/document/d/1v8BxI07u-mby5f5rCruwF7odSXgb9G8-C9W5hQtSIAg/edit#" rel="noopener ugc nofollow" target="_blank">逐渐从微服务方法转变为更加单一的方法</a>。<a class="ae km" href="https://twitter.com/louiscryan?lang=en" rel="noopener ugc nofollow" target="_blank">谷歌API基础设施的首席工程师和架构师Louis Ryan </a>在KubeConNA 2019的Istio meetup上做了一次演讲，详细介绍了动机以及<a class="ae km" href="https://docs.google.com/document/d/1v8BxI07u-mby5f5rCruwF7odSXgb9G8-C9W5hQtSIAg/edit#" rel="noopener ugc nofollow" target="_blank">在设计文档中概述了案例</a>。从Istio 1.5开始(预计在2020年2月中旬)，我们应该开始看到<code class="fe mf mg mh mi b">istiod</code>方法的效果，以前分配给各种微服务部署的功能将合并到一个守护进程中。</p><p id="ef84" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">Istio用于帮助解决微服务/云架构带来的困难的应用联网挑战，那么为什么Istio本身要脱离微服务架构呢？最直接的回答是:</p><blockquote class="kn ko kp"><p id="a329" class="jo jp kq jq b jr js jt ju jv jw jx jy kr ka kb kc ks ke kf kg kt ki kj kk kl ij bi translated">事实证明，微服务方法的复杂性无法实现其预期的价值或目标。相反，它与这些目标背道而驰。</p></blockquote><p id="8f88" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">对于Istio项目来说，看起来单一的方法更有助于实现这些目标。让我们仔细看看。</p><h1 id="1ff5" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Istio实现为微服务</h1><p id="dedb" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">Istio是一个开源的<a class="ae km" href="https://istio.io/docs/concepts/what-is-istio/#what-is-a-service-mesh" rel="noopener ugc nofollow" target="_blank">服务网格</a>，其架构类似于其他服务网格实现，具有控制平面和数据平面。数据平面由与每个应用程序实例共存的代理组成，位于请求路径中。控制平面位于请求路径之外，用于管理和控制数据平面的行为。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/f505952c876ad6227fd31f5943ad2c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CUzt_5iaNjmVHemw.png"/></div></div></figure><p id="0671" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">从历史上看，Istio的控制面板是作为可单独部署的服务来实现的，它具有以下功能:</p><ul class=""><li id="0c3a" class="mo mp iq jq b jr js jv jw jz mq kd mr kh ms kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Pilot</code> -核心数据平面配置(xDS)服务器</li><li id="c3cd" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Galley</code> -配置查看、验证、转发</li><li id="a550" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Injector</code> -负责自动注入数据平面并设置引导</li><li id="a668" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Citadel</code> -证书签名、秘密生成、与CAs集成等</li><li id="b6ca" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Telemetry</code> -一个“混合器”组件，负责将遥测数据聚合和联合到各个后端</li><li id="a3cc" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><code class="fe mf mg mh mi b">Policy</code> -负责执行策略的请求路径“混合器”组件</li></ul><p id="a8b3" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">这些服务将由一组运营商定义的配置驱动，并协调最终服务和指导数据平面。</p><h1 id="bc44" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">微服务优势</h1><p id="4593" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">微服务可以通过减少摩擦来使组织更快地改变系统。有了微服务架构，每个服务都可能独立运行(每个服务都有自己的团队),并有自己独立于其他服务的发布节奏/生命周期。这将为开发人员和操作人员提供平行的轨道，使他们能够更快地进行工作，而无需锁定/同步/协调所做的更改，这会导致部署和功能更改变慢。</p><p id="a712" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">服务可能被进一步分解的另一个原因是它的使用模式和伸缩属性。举个简单的例子，具有大量读取和写入的服务可能会受益于将读取和写入分开，因为读取可能更占用内存(可能需要更多缓存空间来使读取超快)，而写入可能更占用存储或网络。您可以在允许独立扩展(更多内存)的机器/配额上优化服务的读取部分，然后在具有SSD或优化的EBS/SAN等的其他机器上优化服务的写入部分。</p><p id="26ce" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">您可能会将应用拆分为服务的其他一些原因:</p><ul class=""><li id="aa42" class="mo mp iq jq b jr js jv jw jz mq kd mr kh ms kl mt mu mv mw bi translated">安全问题</li><li id="375f" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">领域分组</li><li id="feba" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">不同的语言优化</li><li id="44c1" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">服务的关键程度</li></ul><p id="d07d" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">采用微服务架构的首要权衡是复杂性。当你从一个东西(整体)变成一堆相互通信的小东西(为了优化某个特定的关注点)时，你会显著增加架构的复杂性以及运行这些东西所必需的基础设施的复杂性。</p><p id="6f11" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">在你意识到好处的范围内，这可能是一个必要的权衡。如果没有，你最好评估一下你的假设，然后修正方向。这就是Istio现在的情况。</p><h1 id="d2fb" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">校正过程</h1><p id="666e" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">首先要了解的是谁在开发和操作您的服务架构。在Istio社区中，从<a class="ae km" href="https://github.com/istio/community/blob/master/WORKING-GROUPS.md" rel="noopener ugc nofollow" target="_blank">不同的社区工作组</a>可以看出，项目中有不同的组成部分。另一方面，下载和操作Istio装置的角色没有被解构。事实上，到目前为止的观察是，单个组(甚至单个人)操作Istio控制平面。在某些方面，如果作为一个更大的SaaS运行，作为一组微服务的Istio控制平面会工作得很好，但在目前的采用中，情况似乎并非如此。</p><p id="a730" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">第二件要理解的事情是发布是如何完成的？服务可以独立发布吗？Istio的答案是“理论上是”,但实际情况似乎并非如此。当发布新版本的Istio时，您需要升级/部署所有控制面板组件。</p><p id="31fd" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">最后，在Istio案例中，您可能会问“对于不同的组件，难道没有其他不同的扩展变量和安全问题吗？”诚实的回答会意识到其实没有。直接取自<code class="fe mf mg mh mi b">istiod</code>的Istio设计文档:</p><blockquote class="kn ko kp"><p id="a2a1" class="jo jp kq jq b jr js jt ju jv jw jx jy kr ka kb kc ks ke kf kg kt ki kj kk kl ij bi translated">然而，对于今天的Istio来说，大多数组件都不是这样——控制面板的成本由一个单一的特性决定(服务于XDS)。相比之下，每隔一个控制平面特征都有边际成本，因此分离没有什么价值。</p></blockquote><p id="a27e" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">出于安全考虑，所有控制平面服务都具有相同级别的权限:</p><blockquote class="kn ko kp"><p id="088b" class="jo jp kq jq b jr js jt ju jv jw jx jy kr ka kb kc ks ke kf kg kt ki kj kk kl ij bi translated">今天的情况不同了，变异的网络钩子、特使引导和飞行员所行使的权力在许多方面与城堡的权力相似，因此对它们的利用具有几乎相等的伤害</p></blockquote><p id="45e2" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">正如Istiod设计文档中的潜台词所述<em class="kq">“复杂性是万恶之源，或者说:我如何学会停止担忧并热爱巨石”</em>。</p><p id="1c9a" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated"><code class="fe mf mg mh mi b">istiod</code>是一个整体的化身，它支持以前版本的所有功能，同时显著降低了复杂性。请注意，组成先前控制平面的服务仍然作为项目中的子模块来实现(包括边界和契约等)，但是操作体验得到了改善。运营商现在需要担心的是运行和升级单个二进制文件，而不是它们的集合。</p><figure class="ly lz ma mb gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/ffe18d7048d5bb21658459a50e1e6e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nycv7iVC7objIctH.png"/></div></div></figure><p id="5bed" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">对于Istio来说，采用单片控制平面可以显著降低复杂性，但这从未完全奏效:</p><ul class=""><li id="3151" class="mo mp iq jq b jr js jv jw jz mq kd mr kh ms kl mt mu mv mw bi translated">只需一个可部署的服务，安装/升级变得更加容易</li><li id="a069" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">降低了配置的复杂性，因为不再需要配置来编排服务</li><li id="cf44" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">更容易调试问题(在一个地方而不是所有地方查看)</li><li id="41bd" class="mo mp iq jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">提高效率/减少传输开销、共享缓存等</li></ul><p id="c32c" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">详见<a class="ae km" href="https://docs.google.com/document/d/1v8BxI07u-mby5f5rCruwF7odSXgb9G8-C9W5hQtSIAg/edit#" rel="noopener ugc nofollow" target="_blank"> Istiod设计文件</a>。</p><p id="8e59" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">另外，顺便提一下:<a class="ae km" href="https://www.youtube.com/watch?v=QD115XiBXwY" rel="noopener ugc nofollow" target="_blank">你可以看看我做的这个</a> <code class="fe mf mg mh mi b">istiod</code>方法的演示，它应该会出现在Istio 1.5中。请注意，它是在Istio的超级alpha版本上演示的，所以不会像它一样完美:)</p><h1 id="fc1b" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="376f" class="pw-post-body-paragraph jo jp iq jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl ij bi translated">我很高兴看到Istio社区继续改善其可用性和可操作性特征。对这个项目来说，采用Istio控制平面的整体部署是非常有意义的。这对你的项目有意义吗？如果是这样的话，你会考虑吗？您是否在衡量微服务架构(及相关基础设施)的价值与复杂性比率，以便能够确定改变方法的时间？</p><p id="68f0" class="pw-post-body-paragraph jo jp iq jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ij bi translated">如果你有什么想分享的想法，请联系我。一个好的跟进帖子应该是决策表或关键指标，一旦你决定走微服务等道路，你应该在什么时候改变路线。艾尔。如果你想对此有所贡献，请打电话给我。</p></div></div>    
</body>
</html>