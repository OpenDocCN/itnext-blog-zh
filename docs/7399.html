<html>
<head>
<title>Design by Contract in Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">铁锈中的合同设计</h1>
<blockquote>原文：<a href="https://itnext.io/design-by-contract-in-rust-4cfe88b349bd?source=collection_archive---------4-----------------------#2022-09-11">https://itnext.io/design-by-contract-in-rust-4cfe88b349bd?source=collection_archive---------4-----------------------#2022-09-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/0b61ae3ee99be254793cf80c0b2e8860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQ0GxfCHHHW7sA8TipEAkg.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae jg" href="https://unsplash.com/@signaturepro?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">签名专家</a>在<a class="ae jg" href="https://unsplash.com/s/photos/signature?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><div class=""><h2 id="5385" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">使用proc宏的人体工程学设计</h2></div><p id="c9f3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">变更日志:【2022年12月31日—使用Medium的新代码块进行语法高亮显示</em></p><p id="78af" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lv translated">今天我遇到了一件漂亮的作品:板条箱。这个板条箱为程序员提供了程序宏，用契约设计规范来注释函数和方法。</p><p id="2c79" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一点背景——契约式设计(Design by Contract)(DBC)，用我自己的话说，是一种编程模式，它通过契约来指定功能的限制和能力。<em class="lu">前置条件</em>、<em class="lu">后置条件</em>和<em class="lu">不变量</em>是常用的规范。</p><p id="9333" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为这些规范是作为断言或if-else语句编写的代码，不幸的是，它可能会掩盖函数中的主角。</p><p id="1332" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">以下是我知道的其他语言中的一些DBC模式:</p><p id="deb5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">科特林</strong></p><p id="20b1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Kotlin中，在提供DBC习语的标准库中有<a class="ae jg" href="https://github.com/JetBrains/kotlin/blob/master/libraries/stdlib/src/kotlin/util/Preconditions.kt" rel="noopener ugc nofollow" target="_blank">preceditions . kt</a>模块。</p><pre class="mi mj mk ml gt mm mh mn bn mo mp bi"><span id="bea4" class="mq mr jj mh b be ms mt l mu mv">fun someFunc(x: Int, y: Int) {<br/>    require(x &lt; 3) { "x must be small" }<br/>    // function body<br/>}</span></pre><p id="0787" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> Python </strong></p><p id="2055" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Python没有内置的DBC习惯用法，但是你有提供装饰函数的库。这里有一个使用了<a class="ae jg" href="https://github.com/Parquery/icontract" rel="noopener ugc nofollow" target="_blank"> icontract </a>库的。</p><pre class="mi mj mk ml gt mm mh mn bn mo mp bi"><span id="b70a" class="mq mr jj mh b be ms mt l mu mv">from icontract import require<br/><br/>@require(lambda x: x &lt; 3, "must be small")<br/>def some_func(x: int, y: int):<br/>    # function body</span></pre><p id="831f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> D </strong></p><p id="faf6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在D编程语言中，<a class="ae jg" href="https://dlang.org/spec/function#contracts" rel="noopener ugc nofollow" target="_blank">函数契约</a>是该语言中的一个特性👍🏼：</p><pre class="mi mj mk ml gt mm mh mn bn mo mp bi"><span id="d530" class="mq mr jj mh b be ms mt l mu mv">int someFunc(int x, int y)<br/>in (x &lt; 3, "x must be small")<br/>{<br/>    // function body<br/>}</span></pre><p id="0272" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk">铁锈😍</strong></p><p id="235b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">铁锈呢？</p><p id="1ae9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在Rust生态系统中，有一个<code class="fe me mf mg mh b">contracts</code>机箱，它使用Rust强大的类似属性的程序宏，为用户提供符合人体工程学的设计:</p><pre class="mi mj mk ml gt mm mh mn bn mo mp bi"><span id="e1c5" class="mq mr jj mh b be ms mt l mu mv">use contracts::requires;<br/><br/>#[requires(x &lt; 3, "x must be small")]<br/>fn some_func(x: i32, y: i32) {<br/>    // function body <br/>}</span></pre><p id="76d6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是它能做的:</p><ul class=""><li id="ac9e" class="mw mx jj la b lb lc le lf lh my ll mz lp na lt nb nc nd ne bi translated">在函数之外定义规范(d ' uh)——你可能认为这是理所当然的，但是因为这些规范是函数的属性，所以我认为从语法上来说，把它们放在函数体之外是合适的。</li><li id="be3b" class="mw mx jj la b lb nf le ng lh nh ll ni lp nj lt nb nc nd ne bi translated">提供必要的编译时参数，如检查参数类型(借助proc宏)。</li></ul><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/2aca9992b762ae6495018d575996f90f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*NHjpN3i10JU1RubPSqMcgQ.png"/></div></figure><ul class=""><li id="4fa8" class="mw mx jj la b lb lc le lf lh my ll mz lp na lt nb nc nd ne bi translated">根据合同更新文件(<code class="fe me mf mg mh b">cargo doc --open</code>)</li></ul><figure class="mi mj mk ml gt iv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/40a12c6a6bce66987f836e5cd97044b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*qNJ9kGsXfdeizTQgGiqrkQ.png"/></div></figure><p id="8c69" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将这个机箱与Rust Analyzer结合起来，您将拥有一个非常棒的开发人员体验。</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="b2b6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">参考资料:</p><p id="2028" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae jg" href="https://www.hillelwayne.com/post/contracts/" rel="noopener ugc nofollow" target="_blank">https://www.hillelwayne.com/post/contracts/</a></p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="2366" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就这些了，伙计们！</p><p id="7f33" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">我发表关于人工智能、机器学习、编程语言、Web框架、生产力和学习的文章。</em></p><p id="7dec" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="lu">如果您喜欢阅读更多关于web框架的内容，您可以通过我的推荐链接</em> <a class="ae jg" href="https://remykarem.medium.com/subscribe" rel="noopener"> <em class="lu">订阅</em> </a> <em class="lu">以接收我发布的更新，或者</em> <a class="ae jg" href="https://remykarem.medium.com/membership" rel="noopener"> <em class="lu">注册</em> </a> <em class="lu">！请注意，您的会员费的一部分将作为介绍费分摊给我。</em></p></div></div>    
</body>
</html>