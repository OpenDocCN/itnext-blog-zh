<html>
<head>
<title>iOS — Record &amp; Play an Audio Clip</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS —录制和播放音频剪辑</h1>
<blockquote>原文：<a href="https://itnext.io/ios-record-play-an-audio-clip-1ba8004543ee?source=collection_archive---------1-----------------------#2021-08-06">https://itnext.io/ios-record-play-an-audio-clip-1ba8004543ee?source=collection_archive---------1-----------------------#2021-08-06</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="0f36" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">AVFoundation框架为开发人员提供了许多处理音频数据的功能。</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/844b497e6ee9a52e229998a7ea8c57d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*acB1jBN3n1gOMHBZ"/></div></div></figure><p id="a7e9" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi lr translated"><span class="l ls lt lu bm lv lw lx ly lz di"> I </span> OS app可以接入用户的麦克风，对音频输入进行编码。例如，WhatsApp记录用户的语音，以向他人发送语音消息。苹果提供了一个很棒的框架——<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/av-foundation/" rel="noopener ugc nofollow" target="_blank">AVFoundation</a></code>框架，帮助应用程序轻松地请求麦克风许可、编码音频输入和播放录制的剪辑等。</p><p id="a852" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在本教程中，我将介绍录制音频剪辑并在系统编码后播放它的步骤。开始吧！</p></div><div class="ab cl mf mg hy mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="in io ip iq ir"><h1 id="d628" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">录制音频剪辑</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/12d82363bdec1f3792275392bee132c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VUyr_zlk83xLdESw"/></div></div></figure><p id="5739" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><strong class="kx iv"> 1。添加使用用户麦克风的理由</strong> <br/>如果一个应用程序可以访问用户的麦克风，甚至知道用户说了什么，这就是一个重要的隐私问题。因此，苹果强制应用程序提供合理的理由来告诉用户为什么应用程序想要访问麦克风。首先，让我们在<code class="fe ma mb mc md b">info.plist</code>处添加<code class="fe ma mb mc md b">NSMicrophoneUsageDescription</code>。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ne"><img src="../Images/af0d147f17d623b1271cb31f395ba131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nHeGYU-k-ANvgGSOq6ntMA.png"/></div></div></figure><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><h2 id="2fbb" class="nh mn iu bd mo ni nj dn ms nk nl dp mw le nm nn my li no np na lm nq nr nc ns bi translated"><strong class="ak"> 2。运行时请求麦克风许可</strong></h2><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="0969" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您可以使用<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession" rel="noopener ugc nofollow" target="_blank">AVAudioSession</a></code>的共享实例来请求使用用户的麦克风。在完成处理程序中将返回一个<code class="fe ma mb mc md b">boolean</code>。</p><p id="1ccf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在实际情况下，如果用户之前拒绝了权限，权限对话框将不会再次显示。因此，你可以参考上面的第10-11行，向用户进一步展示使用他/她的话筒的理由。之后，您可以将用户重定向到应用程序设置页面，让他/她手动授予权限<strong class="kx iv"/>。</p><h2 id="f21c" class="nh mn iu bd mo ni nj dn ms nk nl dp mw le nm nn my li no np na lm nq nr nc ns bi translated">3.设置<code class="fe ma mb mc md b">AVAudioSession</code></h2><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="ec1c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated"><code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession" rel="noopener ugc nofollow" target="_blank">AVAudioSession</a></code>是一个向系统传达您打算如何在应用中使用音频的对象。</p><p id="134e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您必须将<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession" rel="noopener ugc nofollow" target="_blank">AVAudioSession</a></code>类别设置为<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession/category/1616568-playandrecord" rel="noopener ugc nofollow" target="_blank">.playAndRecord</a></code>或<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession/category/1616451-record" rel="noopener ugc nofollow" target="_blank">.record</a></code>，以便记录来自麦克风的音频输入。我选择使用<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession/category/1616568-playandrecord" rel="noopener ugc nofollow" target="_blank">.playAndRecord</a></code>,因为一旦音频剪辑被录制，我将播放它。</p><p id="eff5" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">之后，你必须激活<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession" rel="noopener ugc nofollow" target="_blank">AVAudioSession</a></code>，这样系统就知道你的应用程序正在使用麦克风。这个函数可能会抛出错误。例如，当用户使用正在使用麦克风的系统电话应用程序拨打或接听电话时。错误如下所示:</p><pre class="kk kl km kn gu nt md nu nv aw nw bi"><span id="9661" class="nh mn iu md b gz nx ny l nz oa">The operation couldn’t be completed. (OSStatus error 561017449.)</span></pre><h2 id="c85c" class="nh mn iu bd mo ni nj dn ms nk nl dp mw le nm nn my li no np na lm nq nr nc ns bi translated">4.获取保存录制的音频文件的磁盘位置</h2><p id="d372" class="pw-post-body-paragraph kv kw iu kx b ky ob jv la lb oc jy ld le od lg lh li oe lk ll lm of lo lp lq in bi translated">iOS为每个应用提供了一个目录来存储应用文件，该目录由<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/foundation/filemanager" rel="noopener ugc nofollow" target="_blank">FileManager</a></code>控制。您可以通过下面的函数获得一个:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><h2 id="7110" class="nh mn iu bd mo ni nj dn ms nk nl dp mw le nm nn my li no np na lm nq nr nc ns bi translated">5.设置AVAudioRecorder</h2><p id="139a" class="pw-post-body-paragraph kv kw iu kx b ky ob jv la lb oc jy ld le od lg lh li oe lk ll lm of lo lp lq in bi translated">然后，您可以使用生成的文件URL来初始化负责对录制的音频片段进行编码的<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiorecorder" rel="noopener ugc nofollow" target="_blank">AVAudioRecorder</a></code>。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="4a88" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">你也可以给它分配一个<code class="fe ma mb mc md b">delegate</code>,以便在<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiorecorder" rel="noopener ugc nofollow" target="_blank">AVAudioRecorder</a></code>完成记录和音频输入编码过程中出现任何错误时监听事件。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><h2 id="57c2" class="nh mn iu bd mo ni nj dn ms nk nl dp mw le nm nn my li no np na lm nq nr nc ns bi translated">6.开始和结束录制</h2><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="ad78" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">最后的步骤是“开始”和“停止”记录音频输入。上面的代码不言自明。构建并运行app，可以发现<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiorecorder" rel="noopener ugc nofollow" target="_blank">AVAudioRecorder</a></code>停止后<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiorecorderdelegate/1388688-audiorecorderdidfinishrecording" rel="noopener ugc nofollow" target="_blank">audioRecorderDidFinishRecording</a></code>被触发。</p></div><div class="ab cl mf mg hy mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="in io ip iq ir"><h1 id="8022" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">播放音频剪辑</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/feb06f642f2f1b8d56fecb6c7809d75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jEbSWwzofAZFJdIE"/></div></div></figure><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nf ng l"/></div></figure><p id="8830" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在录制完音频剪辑后，您可能想听听这个剪辑。回放音频剪辑非常简单。</p><p id="b07e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">首先，你必须将<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession" rel="noopener ugc nofollow" target="_blank">AVAudioSession</a></code>的类别设置为除<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession/category/1616451-record" rel="noopener ugc nofollow" target="_blank">.record</a></code>模式之外的任何播放模式。</p><blockquote class="og oh oi"><p id="eeba" class="kv kw oj kx b ky kz jv la lb lc jy ld ok lf lg lh ol lj lk ll om ln lo lp lq in bi translated">如果在上一节中已经将类别设置为<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiosession/category/1616568-playandrecord" rel="noopener ugc nofollow" target="_blank">.playAndRecord</a></code>，则不需要重新设置。</p></blockquote><p id="9a27" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">然后，您可以用音频剪辑的文件<code class="fe ma mb mc md b">url</code>初始化<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudioplayer" rel="noopener ugc nofollow" target="_blank">AVAudioPlayer</a></code>，然后调用<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudioplayer/1387388-play" rel="noopener ugc nofollow" target="_blank">play()</a></code>。</p></div><div class="ab cl mf mg hy mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="in io ip iq ir"><h1 id="784f" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">摘要</h1><p id="468d" class="pw-post-body-paragraph kv kw iu kx b ky ob jv la lb oc jy ld le od lg lh li oe lk ll lm of lo lp lq in bi translated">iOS为应用程序提供了访问用户麦克风的功能。但是，它要求用户首先授予应用程序权限。</p><p id="6bd6" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">苹果为控制iOS中的音频和视频内容提供了<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/av-foundation/" rel="noopener ugc nofollow" target="_blank">AVFoundation</a></code>框架。您可以使用<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudiorecorder" rel="noopener ugc nofollow" target="_blank">AVAudioRecorder</a></code>记录音频输入，并将其保存到本地文件中，该文件的目录由<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/foundation/filemanager" rel="noopener ugc nofollow" target="_blank">FileManager</a></code>提供。</p><p id="d22c" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<code class="fe ma mb mc md b"><a class="ae me" href="https://developer.apple.com/documentation/avfaudio/avaudioplayer" rel="noopener ugc nofollow" target="_blank">AVAudioPlayer</a></code>类的帮助下，回放一个音频片段很容易。</p></div><div class="ab cl mf mg hy mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="in io ip iq ir"><h1 id="13ec" class="mm mn iu bd mo mp mq mr ms mt mu mv mw ka mx kb my kd mz ke na kg nb kh nc nd bi translated">你可能也喜欢</h1><div class="on oo gq gs op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/ios-proximity-sensor-as-simple-as-possible-a473df883dc9"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd iv gz z fq ov fs ft ow fv fx it bi translated">iOS接近传感器尽可能简单</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">接近传感器是一个小部件，可以检测大约10厘米的短距离。我们如何观察信号…</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">itnext.io</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe kt oq"/></div></div></a></div><div class="on oo gq gs op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-ios-cllocationmanager-all-in-one-b786ffd37e4a"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd iv gz z fq ov fs ft ow fv fx it bi translated">Swift iOS CLLocationManager一体化</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">如何在iOS中获取用户位置？CoreLocation为您提供了多少配置？让我们点击阅读更多！</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">itnext.io</p></div></div><div class="oz l"><div class="pf l pb pc pd oz pe kt oq"/></div></div></a></div><div class="on oo gq gs op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/swift-local-notification-all-in-one-ee6027ea6e3"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd iv gz z fq ov fs ft ow fv fx it bi translated">Swift本地通知一体化</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">通知是一个非常优雅的工具，用来通知用户新的信息和警告。想看看关于…的提示和技巧吗</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">itnext.io</p></div></div><div class="oz l"><div class="pg l pb pc pd oz pe kt oq"/></div></div></a></div></div></div>    
</body>
</html>