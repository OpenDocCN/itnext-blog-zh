<html>
<head>
<title>Tutorial: How to work with JSON data in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:如何在Go中使用JSON数据</h1>
<blockquote>原文：<a href="https://itnext.io/welcome-to-just-enough-go-7dbef7e30188?source=collection_archive---------2-----------------------#2019-10-03">https://itnext.io/welcome-to-just-enough-go-7dbef7e30188?source=collection_archive---------2-----------------------#2019-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ffa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欢迎来到<strong class="jp ir">刚够走</strong>！这是关于<a class="ae kl" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go编程语言</a>的系列文章中的第一篇，在这篇文章中，我将介绍一些最常用(也是最常用)的<a class="ae kl" href="https://golang.org/pkg" rel="noopener ugc nofollow" target="_blank"> Go标准库包</a>，例如<code class="fe km kn ko kp b">encoding/json</code>、<code class="fe km kn ko kp b">io</code>、<code class="fe km kn ko kp b">net/http</code>、<code class="fe km kn ko kp b">sync</code>等。我计划保持这些相对简短的例子驱动。</p><p id="e574" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">的代码可在<a class="ae kl" href="https://github.com/abhirockzz/just-enough-go" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>中找到</p><blockquote class="kq"><p id="f51e" class="kr ks iq bd kt ku kv kw kx ky kz kk dk translated">如果您想让我介绍一些具体的围棋话题，我将非常乐意接受您的建议！请随意发表 <a class="ae kl" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank"> <em class="la">推文</em> </a> <em class="la">或发表评论😃</em></p></blockquote><p id="fe09" class="pw-post-body-paragraph jn jo iq jp b jq lb js jt ju lc jw jx jy ld ka kb kc le ke kf kg lf ki kj kk ij bi translated">本文涵盖了处理JSON和Go类型之间转换的<code class="fe km kn ko kp b"><a class="ae kl" href="https://golang.org/pkg/encoding/json/" rel="noopener ugc nofollow" target="_blank">encoding/json</a></code>包(根据<a class="ae kl" href="https://tools.ietf.org/html/rfc7159" rel="noopener ugc nofollow" target="_blank"> RFC 7159 </a>)。让我们直接跳进来吧！</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/59963877ca40a954e47868ca1c8d50c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/0*8p9ai9vmZ8_FPPyL.gif"/></div></figure><h1 id="ae7d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">将Go类型转换成JSON</h1><h2 id="0ca3" class="mm lp iq bd lq mn mo dn lu mp mq dp ly jy mr ms mc kc mt mu mg kg mv mw mk mx bi translated">整理</h2><p id="20a0" class="pw-post-body-paragraph jn jo iq jp b jq my js jt ju mz jw jx jy na ka kb kc nb ke kf kg nc ki kj kk ij bi translated">一个常见的选项是使用<code class="fe km kn ko kp b">Marshal</code>函数，其签名为:</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="4a2e" class="mm lp iq kp b gy nh ni l nj nk">func Marshal(v interface{}) ([]byte, error)</span></pre><p id="f1c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个例子:</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="5840" class="mm lp iq kp b gy nh ni l nj nk">func main() {<br/>    profile := Profile{Email: "abhirockzz@gmail.com", Username: "abhirockzz", Blogs: []Blog{<br/>        Blog{BlogName: "devto", URL: "https://dev.to/abhirockzz/"},<br/>        Blog{BlogName: "medium", URL: "https://medium.com/@abhishek1987/"},<br/>    }}<br/><strong class="kp ir">    jsonData, err := json.Marshal(&amp;myprofile)<br/></strong>    //jsonData, err := json.MarshalIndent(&amp;profile, "", " ")<br/>    if err != nil {<br/>        panic(err)<br/>    }<br/>    fmt.Println(string(jsonData))<br/>}</span></pre><blockquote class="nl nm nn"><p id="fd24" class="jn jo no jp b jq jr js jt ju jv jw jx np jz ka kb nq kd ke kf nr kh ki kj kk ij bi translated"><em class="iq">您可以使用</em> <code class="fe km kn ko kp b"><em class="iq">MarshalIndent</em></code> <em class="iq">(已注释)来缩进JSON输出</em></p></blockquote><h2 id="6ce2" class="mm lp iq bd lq mn mo dn lu mp mq dp ly jy mr ms mc kc mt mu mg kg mv mw mk mx bi translated">编码器</h2><p id="cb3c" class="pw-post-body-paragraph jn jo iq jp b jq my js jt ju mz jw jx jy na ka kb kc nb ke kf kg nc ki kj kk ij bi translated">当<code class="fe km kn ko kp b">Marshal</code>处理字节数组(<code class="fe km kn ko kp b">[]byte</code>)时，<code class="fe km kn ko kp b">Encoder</code>是通用的，允许您使用<code class="fe km kn ko kp b">io.Writer</code>，您可以将它定义为JSON数据的接收器，也就是说，您可以指定实现<code class="fe km kn ko kp b">io.Writer</code>接口的任何类型，例如，这可以是标准输出(<code class="fe km kn ko kp b">os.Stdout</code>)，或者HTTP响应(<code class="fe km kn ko kp b">http.ResponseWriter</code>)，等等。</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="680c" class="mm lp iq kp b gy nh ni l nj nk">func main() {<br/>    profile := Profile{Email: "abhirockzz@gmail.com", Username: "abhirockzz", Blogs: []Blog{<br/>        Blog{BlogName: "devto", URL: "https://dev.to/abhirockzz/"},<br/>        Blog{BlogName: "medium", URL: "https://medium.com/@abhishek1987/"},<br/>    }}</span><span id="1e3c" class="mm lp iq kp b gy ns ni l nj nk">    encoder := json.NewEncoder(os.Stdout)<br/><strong class="kp ir">    err := encoder.Encode(&amp;profile)<br/></strong>    if err != nil {<br/>        panic(err)<br/>    }<br/>}</span></pre><p id="86f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe km kn ko kp b">NewEncoder</code>指定<code class="fe km kn ko kp b">io.Writer</code>。当您调用<code class="fe km kn ko kp b">Encode</code>时，转换发生，JSON被写入到您指定的<code class="fe km kn ko kp b">io.Writer</code>中。</p><p id="0e8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是它如何处理HTTP响应的示例:</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="ac1b" class="mm lp iq kp b gy nh ni l nj nk">func main() {<br/>    profile := Profile{Email: "abhirockzz@gmail.com", Username: "abhirockzz", Blogs: []Blog{<br/>        Blog{BlogName: "devto", URL: "https://dev.to/abhirockzz/"},<br/>        Blog{BlogName: "medium", URL: "https://medium.com/@abhishek1987/"},<br/>    }}</span><span id="ecdd" class="mm lp iq kp b gy ns ni l nj nk">    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {<br/>        encoder := json.NewEncoder(w)<br/><strong class="kp ir">        err := encoder.Encode(&amp;profile)<br/></strong>        if err != nil {<br/>            panic(err)<br/>        }<br/>    })</span><span id="c78b" class="mm lp iq kp b gy ns ni l nj nk">    http.ListenAndServe(":8080", nil)<br/>}</span></pre><h1 id="c434" class="lo lp iq bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">将JSON数据转换为Go类型</h1><h2 id="51cd" class="mm lp iq bd lq mn mo dn lu mp mq dp ly jy mr ms mc kc mt mu mg kg mv mw mk mx bi translated">解组</h2><p id="cfd0" class="pw-post-body-paragraph jn jo iq jp b jq my js jt ju mz jw jx jy na ka kb kc nb ke kf kg nc ki kj kk ij bi translated">给定字节数组形式的JSON，<code class="fe km kn ko kp b">Unmarshal</code>将JSON解析结果存储到您指定的Go数据类型的指针中(通常是一个<code class="fe km kn ko kp b">struct</code></p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="eef2" class="mm lp iq kp b gy nh ni l nj nk">func Unmarshal(data []byte, v interface{}) error</span></pre><p id="d878" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个简单的例子:</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="186f" class="mm lp iq kp b gy nh ni l nj nk">func main() {<br/>    jsonData := `{"email":"abhirockzz@gmail.com","username":"abhirockzz","blogs":[{"name":"devto","url":"https://dev.to/abhirockzz/"},{"name":"medium","url":"https://medium.com/@abhishek1987/"}]}`<br/>    <br/>    var profile Profile<br/><strong class="kp ir">    err := json.Unmarshal([]byte(jsonData), &amp;profile)<br/></strong>    if err != nil {<br/>        panic(err)<br/>    }<br/>    ...<br/>}</span></pre><h2 id="78b1" class="mm lp iq bd lq mn mo dn lu mp mq dp ly jy mr ms mc kc mt mu mg kg mv mw mk mx bi translated">解码器</h2><p id="04e5" class="pw-post-body-paragraph jn jo iq jp b jq my js jt ju mz jw jx jy na ka kb kc nb ke kf kg nc ki kj kk ij bi translated"><code class="fe km kn ko kp b">Decoder</code>提供了一种解组JSON数据的通用方法，允许您以<code class="fe km kn ko kp b">io.Reader</code>的形式指定JSON输入源，而不是字节数组。</p><pre class="lh li lj lk gt nd kp ne nf aw ng bi"><span id="def3" class="mm lp iq kp b gy nh ni l nj nk">func main() {<br/>    jsonData := `{"email":"abhirockzz@gmail.com","username":"abhirockzz","blogs":[{"name":"devto","url":"https://dev.to/abhirockzz/"},{"name":"medium","url":"https://medium.com/@abhishek1987/"}]}`<br/>    <br/>    jsonDataReader := strings.NewReader(jsonData)<br/>    decoder := json.NewDecoder(jsonDataReader)</span><span id="760e" class="mm lp iq kp b gy ns ni l nj nk">    var profile Profile<br/><strong class="kp ir">    err := decoder.Decode(&amp;profile)<br/></strong>    if err != nil {<br/>        panic(err)<br/>    }<br/>    ...<br/>}</span></pre><p id="551f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从使用快捷方式<code class="fe km kn ko kp b">strings.NewReader</code>从JSON <code class="fe km kn ko kp b">string</code>数据创建一个<code class="fe km kn ko kp b">io.Reader</code>开始。然后我们可以使用<code class="fe km kn ko kp b">NewDecoder</code>实例化解码器，并简单地使用<code class="fe km kn ko kp b">decode</code>和一个指向存储结果的<code class="fe km kn ko kp b">Profile</code>结构的指针</p><p id="4abd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个博客到此为止！敬请关注更多内容，不要忘记喜欢和关注😃😃</p></div></div>    
</body>
</html>