<html>
<head>
<title>Calibre Web: home in-browser online-library with Nextcloud storage and Moon+ Reader on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Calibre Web:带有Nextcloud storage和Android上的Moon+ Reader的家庭浏览器在线图书馆</h1>
<blockquote>原文：<a href="https://itnext.io/calibre-web-home-in-browser-online-library-with-nextcloud-storage-and-moon-reader-on-android-bee6a30c15b9?source=collection_archive---------1-----------------------#2020-01-07">https://itnext.io/calibre-web-home-in-browser-online-library-with-nextcloud-storage-and-moon-reader-on-android-bee6a30c15b9?source=collection_archive---------1-----------------------#2020-01-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/041affe2fb5225168c815a7644c54980.png" data-original-src="https://miro.medium.com/v2/resize:fit:260/format:webp/0*3dxebZ9Niv9UX4QS.png"/></div></figure><p id="9aa6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我使用<a class="ae ks" href="https://calibre-ebook.com/" rel="noopener ugc nofollow" target="_blank"> Calibre </a>来管理我的电子书库已经很多年了，但是直到今天我一直使用它的桌面版本。</p><p id="aea2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">几天前，我发现了<a class="ae ks" href="https://github.com/janeczku/calibre-web" rel="noopener ugc nofollow" target="_blank"> Calibre Web </a>项目——同一个库，使用同一个数据库，但是可以通过浏览器访问。</p><p id="49eb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个想法是从在谷歌图书中存储书籍和通过浏览器在移动设备上使用其电子书阅读器，但仍然能够从任何地方访问我的图书馆，并拥有书籍的阅读位置同步功能，就像在谷歌图书移动设备和浏览器阅读器中一样。</p><p id="e644" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，现在我的库本身存储在Nextcloud中(参见<a class="ae ks" href="https://rtfm.co.ua/en/nextcloud-running-in-docker-compose-on-debian-with-lets-encrypt-ssl/" rel="noopener ugc nofollow" target="_blank"> Nextcloud:在Debian上的Docker Compose中运行，让我们加密SSL post </a>)，我将在我的Android设备上使用<a class="ae ks" href="https://play.google.com/store/apps/details?id=com.flyersoft.moonreader&amp;hl=en" rel="noopener ugc nofollow" target="_blank"> Moon+ Reader </a>应用程序，因为它可以通过<a class="ae ks" href="https://en.wikipedia.org/wiki/WebDAV" rel="noopener ugc nofollow" target="_blank"> WebDAV </a>同步读取位置。</p><p id="623f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此外，你可以使用Google Drive作为Calibre Web的存储后端，阅读<a class="ae ks" href="https://github.com/janeczku/calibre-web/wiki/Configuration#using-google-drive-integration" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><p id="231a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本帖中，我们将:</p><ul class=""><li id="d544" class="kt ku iq jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">在Docker中运行一个Calibre Web实例——一个库的Web接口</li><li id="fc38" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">将用Calibre的库从Nextcloud挂载一个目录</li><li id="c178" class="kt ku iq jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">并将使用我们手机上的WebDAV连接到使用Moon+ Reader的Nextcloud</li></ul><h2 id="3e5d" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">NGINX，我们加密吧</h2><p id="f532" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">NGINX + Let's Encrypt set up已经在<a class="ae ks" href="https://rtfm.co.ua/en/bitwarden-an-organizations-password-manager-self-hosted-version-installation-on-an-aws-ec2/#The_hosts_set_up" rel="noopener ugc nofollow" target="_blank"> Bitwarden:一个AWS EC2 </a>帖子上描述了一个组织的密码管理器自托管版本安装。</p><h2 id="b023" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">Calibre Web start</h2><p id="f1d2" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">检查我们的Calibre Web将使用的Nextcloud下的库目录:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="bae7" class="lh li iq mk b gy mo mp l mq mr">$ ll /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/ | head<br/>total 1212<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:53 A. A. Orlov<br/>drwxr-xr-x 7 www-data www-data 4096 Dec 13 07:53 A. Avramienko<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:55 A. Bielash<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:53 A. B_iuli<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:55 Adol_f Gitlier<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:55 A. Fomienko, G. Nosovskii<br/>drwxr-xr-x 4 www-data www-data 4096 Dec 13 07:55 A. Kamienistyi<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:55 A. Karr<br/>drwxr-xr-x 3 www-data www-data 4096 Dec 13 07:55 Al_bier Kamiu<br/>…</span></pre><p id="4fac" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用Calibre运行一个Docker容器，在里面挂载库的目录为<code class="fe ms mt mu mk b">/books</code>:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="2611" class="lh li iq mk b gy mo mp l mq mr">$ docker run -ti — name books -p 8083:8083 -v /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/:/books technosoft2000/calibre-web</span></pre><p id="a54d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查<code class="fe ms mt mu mk b">metadata.db</code>是否存在:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="919b" class="lh li iq mk b gy mo mp l mq mr"> $ docker exec -ti books ls -l /books/metadata.db<br/>-rw-r — r — 1 xfs xfs 752640 Dec 13 07:51 /books/metadata.db</span></pre><p id="dedb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在浏览器中打开您的URL，并设置一个到<code class="fe ms mt mu mk b">/books</code>目录的路径，该目录必须包含Calibre用来存储图书馆中所有书籍信息的<code class="fe ms mt mu mk b">metadata.db</code>文件:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/8b6714821ba0fda81eac7de5b3c1ac08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wjPMta7v5Of3PHZI.png"/></div></div></figure><p id="febe" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用默认的<em class="na"> admin:admin123 </em>登录:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/28cafcb0137c84bf9da451ffa516b788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/0*FVB9bNruGJMBzSKd.png"/></div></figure><p id="24e9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在你会看到你的图书馆:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nc"><img src="../Images/8607f1c8b5771182b1d7790b41ac47d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x1tQfLXpi0PXbSBJ.png"/></div></div></figure><p id="fc5e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这里的<em class="na">类别</em>菜单只是Calibre的标签:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nd"><img src="../Images/83b07339eb644115a49ec6426c6bec6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UXsRgbl_As64GPZn.png"/></div></div></figure><p id="050f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和普通的Calibre一样，你可以在浏览器中查看、添加、编辑和阅读书籍:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ne"><img src="../Images/5a6e612e8574fe5645c6bc40506d3fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gNrZKXS6bpN9BSRP.png"/></div></div></figure><p id="26fd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">浏览器的阅读器:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nf"><img src="../Images/345eab721d6ffc50eca1e1920ee5f603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l-Ky1ksr0eERDQ1W.png"/></div></div></figure><h2 id="b7c7" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated"><em class="ng">“无法创建路径/书籍/(权限被拒绝)”</em>错误</h2><p id="67dd" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">如果您现在尝试上传文件，可能会遇到以下错误:</p><blockquote class="nh ni nj"><p id="bc60" class="ju jv na jw b jx jy jz ka kb kc kd ke nk kg kh ki nl kk kl km nm ko kp kq kr ij bi translated">未能创建路径/books/Mark Menson/Tonkoe iskustvo pofigizma _ Paradoksal ' Nyi sposob zhit ' schastlvo(权限被拒绝)。</p></blockquote><p id="91aa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">对我来说，这是一个预期的错误，因为目录<code class="fe ms mt mu mk b">/data/nextcloud/app/data/setevoy/files/Books/CALIBRE/</code>现在被Nextcloud <strong class="jw ir">和</strong> Calibre Web Docker容器使用。</p><p id="c9cc" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">检查Calibre容器中的用户:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="29a4" class="lh li iq mk b gy mo mp l mq mr">$ docker exec -ti books ps | grep cali<br/>68 calibre 0:08 /usr/bin/python /calibre-web/app/cps.py</span></pre><p id="4cf4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和他的UID:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7728" class="lh li iq mk b gy mo mp l mq mr">$ docker exec -ti books id calibre<br/>uid=15000(calibre) gid=15000(calibre) groups=15000(calibre),15000(calibre)</span></pre><p id="c934" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">而主机上的本地目录属于:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="6399" class="lh li iq mk b gy mo mp l mq mr">$ ls -l /data/nextcloud/app/data/setevoy/files/Books/<br/>total 4<br/>drwxr-xr-x 117 www-data www-data 4096 Dec 16 09:32 CALIBRE</span></pre><p id="4edd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和<code class="fe ms mt mu mk b">www-data</code>用户的UID:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="540a" class="lh li iq mk b gy mo mp l mq mr">$ id www-data<br/>uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></pre><p id="95c1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">即Calibre使用UID <em class="na"> 15000 </em>的<code class="fe ms mt mu mk b">calibre</code>用户，但是主机上的NGINX和Nextcloud容器都在使用UID <em class="na"> 33 </em>的<code class="fe ms mt mu mk b">www-data</code>用户。</p><p id="30a9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要解决这个问题—在主机上创建一个UID为15000的新用户<em class="na"> calibre </em>:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="e416" class="lh li iq mk b gy mo mp l mq mr">$ sudo useradd -u 15000 calibre<br/>id calibre<br/>uid=15000(calibre) gid=15000(calibre) groups=15000(calibre)</span></pre><p id="e94b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">更改目录所有权:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5486" class="lh li iq mk b gy mo mp l mq mr">$ sudo chown -R calibre:calibre /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/</span></pre><p id="40ff" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">重启口径:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="fd0c" class="lh li iq mk b gy mo mp l mq mr">$ docker restart calibre-web</span></pre><p id="3903" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">立即检查上传—必须立即工作:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nn"><img src="../Images/9c1663c3426e4ed6667d44409df07a8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dmDD3vKl9x0AiMNF.png"/></div></div></figure><h2 id="8fdc" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">Nextcloud <code class="fe ms mt mu mk b">PUT</code> 403</h2><p id="f97c" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">但是现在Nexcloud坏了——例如，在一个桌面客户端上，我在同步过程中出现了403个错误:</p><blockquote class="nh ni nj"><p id="e05f" class="ju jv na jw b jx jy jz ka kb kc kd ke nk kg kh ki nl kk kl km nm ko kp kq kr ij bi translated">172 . 29 . 0 . 2—setevoy[16/Dec/2019:13:22:24+0000]" PUT/remote . PHP/dav/files/setevoy/Books/CALIBRE/Pol ' % 20 diubua/MySQL % 20(68)/cover . jpg HTTP/1.1 " 403 759 "-" Mozilla/5.0(Linux)mirall/2 . 6 . 1 git(next cloud)"</p></blockquote><p id="217f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">要解决这个问题—将上面创建的新添加的<em class="na"> calibre </em>用户添加到<em class="na"> www-data </em>组:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="073d" class="lh li iq mk b gy mo mp l mq mr">$ usermod -a -G www-data calibre</span></pre><p id="f65e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在检查他的组:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="318c" class="lh li iq mk b gy mo mp l mq mr">$ id calibre<br/>uid=15000(calibre) gid=15000(calibre) groups=15000(calibre),33(www-data)</span></pre><p id="6d2b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">递归地改变所有权——将全部权限授予<code class="fe ms mt mu mk b">www-data</code>组成员，例如<code class="fe ms mt mu mk b">www-data</code>和<code class="fe ms mt mu mk b">calibre</code>用户:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ca4a" class="lh li iq mk b gy mo mp l mq mr">$ find /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/ -type d -exec chmod g+rwx {} +</span></pre><p id="e6bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并更改所有者:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="3c16" class="lh li iq mk b gy mo mp l mq mr">$ chown -R calibre:www-data /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/</span></pre><p id="5011" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这已经完成，同步现在也可以工作了。</p><h2 id="5ce6" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">Docker撰写</h2><p id="9012" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">要实现数据持久性，首先让我们找到数据存储在容器中的位置，例如应用程序的数据库及其所有设置。</p><p id="6488" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">可以看一下<a class="ae ks" href="https://github.com/janeczku/calibre-web/wiki/Configuration" rel="noopener ugc nofollow" target="_blank">文档</a>(推荐方式！)，或者连接到容器:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="6879" class="lh li iq mk b gy mo mp l mq mr">$ docker exec -ti calibre-web bash</span></pre><p id="ede0" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">找到所有的<em class="na"> *。数据库</em>文件:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5cab" class="lh li iq mk b gy mo mp l mq mr">bash-4.4# find / -name “*.db”<br/>/calibre-web/app/app.db<br/>/calibre-web/app/gdrive.db<br/>…</span></pre><p id="760c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在主机上，为Docker合成文件和应用程序数据创建目录:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ecd7" class="lh li iq mk b gy mo mp l mq mr">$ mkdir /opt/calibre-web/<br/>$ mkdir -p /data/calibre/app<br/>$ chown -R calibre:calibre /data/calibre/</span></pre><p id="c43c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<code class="fe ms mt mu mk b">/opt/calibre-web/</code>目录下创建一个<code class="fe ms mt mu mk b">calibre-compose.yml</code>文件:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="134d" class="lh li iq mk b gy mo mp l mq mr">version: '3'<br/><br/>services:<br/><br/>  calibre-web:<br/>    user: "root:root"<br/>    image: technosoft2000/calibre-web<br/>    container_name: calibre-web<br/>    ports:<br/>      - 8083:8083<br/>    volumes:<br/>      - /data/nextcloud/app/data/setevoy/files/Books/CALIBRE/:/books<br/>      -  /data/calibre/app:/calibre-web/app/ <br/>      - /var/run/docker.sock:/tmp/docker.sock:ro<br/>    restart: unless-stopped</span></pre><p id="470c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">启动服务:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="17c8" class="lh li iq mk b gy mo mp l mq mr">$ docker-compose -f calibre-compose.yml up -d</span></pre><p id="9864" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在<a class="ae ks" href="https://rtfm.co.ua/linux-systemd-servis-dlya-docker-compose/" rel="noopener ugc nofollow" target="_blank">Linux:systemdсервисдляdocker compose</a>中描述了单元文件的创建，在本例中，我添加了一个<code class="fe ms mt mu mk b">/etc/systemd/system/calibre.service</code>文件:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="b7bd" class="lh li iq mk b gy mo mp l mq mr">[Unit]<br/>Description=Calibre library service<br/>Requires=docker.service<br/>After=docker.service<br/><br/>[Service]<br/>Restart=always<br/>WorkingDirectory=/opt/calibre-web<br/>ExecStart=/usr/local/bin/docker-compose -f calibre-compose.yml up<br/>ExecStop=/usr/local/bin/docker-compose -f calibre-compose.yml down<br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><h2 id="4a7f" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">Calibre Web主题</h2><p id="42fa" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">开箱即用的Calibre Web有两个主题——轻量级主题，默认主题:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi no"><img src="../Images/806e9e5f8b6b3ed78b16758e1207bb74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2FuFOmaFYQSddUGb.png"/></div></div></figure><p id="d6c2" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">黑暗的一面:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi no"><img src="../Images/f81e6a2f9b8af8513f0e7238651858a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nwMYcQ8JppH9chXU.png"/></div></div></figure><h2 id="cc8d" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">陷阱——将<code class="fe ms mt mu mk b">metadata.db</code>与Nextcloud合并</h2><p id="5712" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">这个问题与当前使用Nextcloud作为存储的设置有关，因为它在我自己的服务器上运行，有时会离线，这会导致桌面上的数据不同步。</p><p id="f70d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">问题是，当你使用Calibre Web从浏览器编辑一本书时，主Calibre文件—<strong class="jw ir">metadata . db</strong>—将在主机的文件系统上更新，但这一变化不会触发本地Nextcloud实例在它重新在线时将这一变化推送到其客户端，因为它就像服务器一样运行——它不是客户端部分。</p><p id="7970" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">然后，如果你的Calibre Desktop配置为使用相同的Nextcloud，并有一个像<code class="fe ms mt mu mk b"><a class="ae ks" href="https://aur.archlinux.org/packages/nextcloud-desktop-git/" rel="noopener ugc nofollow" target="_blank">nextcloud-desktop</a></code>这样的桌面客户端，如果你运行本地Calibre Desktop并对其库进行任何更改，这将影响你的<code class="fe ms mt mu mk b">metadata.db</code>文件，这将触发你的Nextcloud客户端将这些更改推送到Nextcloud服务器，这将覆盖服务器上的更改。</p><p id="d03d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，为了避免这种情况，需要在使用之前手动将桌面的Caliber目录内容与Nextcloud服务器同步。</p><p id="c45c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为此，只需发出以下命令:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="97ff" class="lh li iq mk b gy mo mp l mq mr">$ nextcloudcmd — user setevoy -p PASSWORD /home/setevoy/Nextcloud/Books/CALIBRE/ <a class="ae ks" href="https://cloud.example.org.ua/Books/CALIBRE" rel="noopener ugc nofollow" target="_blank">https://cloud.example.org.ua/Books/CALIBRE</a></span></pre><p id="34c8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这将从<a class="ae ks" href="https://cloud.example.org.ua/Books/CALIBRE" rel="noopener ugc nofollow" target="_blank"><em class="na">https://cloud.example.org.ua/Books/CALIBRE</em></a>(即Nextcloud主机上的<code class="fe ms mt mu mk b">/data/nextcloud/app/data/setevoy/files/Books/CALIBRE/</code>)中抓取所有更改到本地<code class="fe ms mt mu mk b">/home/setevoy/Nextcloud/Books/CALIBRE/</code>目录(由桌面Calibre应用程序使用)。</p><h2 id="e6b9" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">月亮+阅读器</h2><p id="6fb7" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">月亮+阅读器应用来自我最近的发现。</p><p id="c162" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">可以在使用G DriveDropbox/WebDAV时同步书籍中的阅读位置，同步评论、笔记、书签等。</p><p id="0411" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">将它安装在您的手机上，添加一个WebDAV目录:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/cb8f281a231f5cbed355ceb10deedc8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bSFd2VEn5uZapXwh.png"/></div></div></figure><p id="7521" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在您可以访问您的Calibre库了:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/c14a3b663079fad42716bc51f4369d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ne0pla186jmTx2Ru.png"/></div></div></figure><h2 id="4a85" class="lh li iq bd lj lk ll dn lm ln lo dp lp kf lq lr ls kj lt lu lv kn lw lx ly lz bi translated">同步设置</h2><p id="b21a" class="pw-post-body-paragraph ju jv iq jw b jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn me kp kq kr ij bi translated">为了让同步在月球上工作+ —打开一本书，然后右上角三个点&gt;<em class="na">杂项</em>，向下滚动并启用<em class="na">同步阅读位置</em>:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi np"><img src="../Images/0dd5221d57b4ca1a25abd4faa8ad2649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P1nezXIWdOg695lN.png"/></div></div></figure><p id="a014" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成了。</p></div><div class="ab cl nq nr hu ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ij ik il im in"><p id="75f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="na">最初发布于</em> <a class="ae ks" href="https://rtfm.co.ua/en/calibre-web-home-in-browser-online-library-with-nextcloud-storage-and-moon-reader-on-android/" rel="noopener ugc nofollow" target="_blank"> <em class="na"> RTFM: Linux，devo PSисистемноеадмнииитииовваниование</em></a><em class="na">。</em></p></div></div>    
</body>
</html>