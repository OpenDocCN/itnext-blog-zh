<html>
<head>
<title>Kubediscovery: Aggregated API Server to learn more about Kubernetes Custom Resources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">kube discovery:Aggregated API Server了解更多关于Kubernetes定制资源的信息</h1>
<blockquote>原文：<a href="https://itnext.io/kubediscovery-aggregated-api-server-to-learn-more-about-kubernetes-custom-resources-18202a1c4aef?source=collection_archive---------2-----------------------#2018-11-26">https://itnext.io/kubediscovery-aggregated-api-server-to-learn-more-about-kubernetes-custom-resources-18202a1c4aef?source=collection_archive---------2-----------------------#2018-11-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="df06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubernetes定制资源通常由Kubernetes运营商引入。他们扩展了Kubernetes API，将第三方软件作为本地Kubernetes对象来管理，例如Postgres。标准的Kubernetes接口(Kubernetes YAML和kubectl)与定制资源一起工作，就像任何其他本地Kubernetes资源一样，比如Pod、Deployment等。然而，为了有意义地消费定制资源并使用它们构建应用平台，应用开发者需要更多地了解定制资源，例如它们在底层本地资源方面的组成、规范定义、支持的操作、可配置性等。在这方面，我们开发了一个名为<a class="ae kl" href="https://github.com/cloud-ark/kubediscovery" rel="noopener ugc nofollow" target="_blank"> Kubediscovery </a>的Kubernetes聚合API服务器来提供帮助。</p><p id="d42b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubediscovery是我们<a class="ae kl" href="https://github.com/cloud-ark/kubeplus" rel="noopener ugc nofollow" target="_blank"> KubePlus平台工具包</a>中的一个组件，该工具包通过简化部署、管理和使用Kubernetes运营商的流程来提供平台即代码体验。这是KubePlus的高级架构图，其中Kubediscovery显示为其中的Discovery API服务器组件。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/bf409d227e4fa64be0509ebea8103737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ryLppMIK8vfJ6JFrm7EuQ.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">KubePlus平台工具包</figcaption></figure><p id="9088" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> Kubediscovery实施</strong></p><p id="1cd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubediscovery是一个Kubernetes聚合API服务器，它提供了新的API端点来传递关于定制资源的附加信息。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lc"><img src="../Images/8a15a147d4697dc4e82dbad287c297a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7XRauefeblAddKp7zrf1Q.jpeg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">库贝发现</figcaption></figure><p id="1d65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当前实现支持以下端点。</p><ul class=""><li id="39ae" class="ld le iq jp b jq jr ju jv jy lf kc lg kg lh kk li lj lk ll bi translated"><em class="lm">合成</em> —根据底层资源实例检索定制资源实例的动态合成树(例如，哪些底层资源实例是Postgres定制资源实例的合成树的一部分。)[<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/blob/master/examples/moodle/steps.txt#L71" rel="noopener ugc nofollow" target="_blank"><em class="lm">/APIs/kube plus . cloud ark . io/v1/composition</em></a>]</li><li id="5dec" class="ld le iq jp b jq ln ju lo jy lp kc lq kg lr kk li lj lk ll bi translated"><em class="lm">解释</em> —检索已注册定制资源的OpenAPI规范。[<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/blob/master/examples/mysql/steps.txt#L53" rel="noopener ugc nofollow" target="_blank"><em class="lm">/APIs/kube plus . cloud ark . io/v1/explain</em></a>]</li></ul><p id="e8c4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">作文端点检索作文树</strong></p><p id="dc65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“合成”端点用于根据其底层资源实例获得定制资源实例的动态合成树。</p><p id="8cec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Kubernetes中，某些资源是按层次结构组织的——父资源是使用其底层资源组成的。例如，一个部署由一个复制集组成，而复制集又由一个或多个pod组成。类似地，像Postgres这样的定制资源可以由一个部署和一个服务资源组成。</p><p id="5181" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了构建动态组合树，Kubediscovery需要关于定制资源的资源层次结构的静态信息。为此，操作符开发人员在开发操作符时需要遵循某些准则。我们在这里详细介绍了这些指南<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/blob/master/Guidelines.md" rel="noopener ugc nofollow" target="_blank">。Kubediscovery上下文中的两个关键准则是:a)定义作为自定义资源的资源层次结构的一部分的基础资源，并在CRD注册YAML上添加注释(</a><a class="ae kl" href="https://github.com/cloud-ark/kubeplus/blob/master/Guidelines.md#9-define-underlying-resources-created-by-custom-resource-as-annotation-on-crd-registration-yaml" rel="noopener ugc nofollow" target="_blank">准则#9 </a>)，以及b)为您的自定义资源所拥有的基础资源设置owner references(<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/blob/master/Guidelines.md#5-set-ownerreferences-for-underlying-resources-owned-by-your-custom-resource" rel="noopener ugc nofollow" target="_blank">准则#5 </a>)。</p><p id="3f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kubediscovery使用这些信息来跟踪各个资源实例的所有者引用，并构建动态合成树。这里有一个例子。它显示了“postgres”自定义资源的“postgres1”实例的合成树。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ls"><img src="../Images/c3e5f7640096001103a2745121fc922d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnDumUm9Voo3J2K9VjvWow.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">Postgres自定义资源实例的合成树</figcaption></figure><p id="123b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">解释端点以检索OpenAPI规范</strong></p><p id="bb31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“explain”端点用于获取自定义资源的静态信息，就像从标准的“kubectl explain”调用中获取的信息一样。这些信息本质上是定制资源的OpenAPI规范。在KubePlus中，我们提供了一个基于kube-openapi库的工具，为您的定制资源生成openapi规范。</p><p id="4956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是如何将“解释”端点用于自定义资源。在第一个示例中，我们使用“explain”端点来查找由我们的<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/tree/master/postgres-crd-v2" rel="noopener ugc nofollow" target="_blank">示例Postgres操作符</a>注册的“Postgres”自定义种类的信息。在第二个示例中，我们使用“解释”来查找有关“S3StorageProvider”自定义种类的信息，该自定义种类是Oracle MySQL操作员的备份自定义资源规范定义的一部分。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lt"><img src="../Images/fafd078046dc976220c8084bfa2a4e33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5bDhFVMGkYm9A-ROuwmwQ.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">为Postgres解释</figcaption></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lu"><img src="../Images/7527f338468bea6719def2d26776257c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hfoix8l5s_YXm6-wo0puKg.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated">解释S3StorageProvider</figcaption></figure><p id="1fd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前<a class="ae kl" href="https://github.com/kubernetes/kubernetes/pull/67205" rel="noopener ugc nofollow" target="_blank">上游Kubernetes </a>的工作正在进行中，以扩展“kubectl explain”来处理定制资源。当Kubediscovery的“解释”端点功能通过主API服务器普遍可用时，我们计划弃用该端点。</p><p id="39ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结论</strong></p><p id="844a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用Kubediscovery的目标是帮助应用程序开发人员了解关于他们的集群上可用的定制资源的更多信息，以构建他们的应用程序平台。如上所述，目前它支持两个端点——“组合”和“解释”。未来，我们将考虑包括以下端点:</p><p id="9cb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-“审计”:这将提供定制资源实例如何随时间变化的动态<a class="ae kl" href="https://github.com/cloud-ark/kubeprovenance" rel="noopener ugc nofollow" target="_blank">血统跟踪(出处)</a>。</p><p id="5f97" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-“功能”:这将提供关于定制资源支持哪些操作的静态信息，例如Postgres定制资源允许数据库创建、用户添加和密码更改功能。</p><p id="41e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">-“可配置”:这将提供关于定制资源下受支持的配置参数的附加信息，这些配置参数影响底层平台元素(如Postgres数据库)的行为。</p><p id="93b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们正在征求社区的意见，了解您希望在Kubediscovery中看到哪些额外的端点。此外，也欢迎任何关于上述端点的优先化意见。通过提交一个<a class="ae kl" href="https://github.com/cloud-ark/kubeplus/issues" rel="noopener ugc nofollow" target="_blank"> GitHub问题</a>让我们知道。</p><p id="af67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://cloudark.io/" rel="noopener ugc nofollow" target="_blank"> www.cloudark.io </a></p></div></div>    
</body>
</html>