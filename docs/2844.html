<html>
<head>
<title>Introductory Push Notifications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍性推送通知</h1>
<blockquote>原文：<a href="https://itnext.io/introductory-push-notifications-fa6f68ace251?source=collection_archive---------2-----------------------#2019-08-13">https://itnext.io/introductory-push-notifications-fa6f68ace251?source=collection_archive---------2-----------------------#2019-08-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="65f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">推送通知利用iOS系统来获得用户对我们应用的参与。尽管从用户的角度来看，这似乎很容易，但是对于开发者来说，这里面有很多东西。这里我将实现实践中最常用的特性。</p><p id="5ecc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/ji3g4kami/PushTest" rel="noopener ugc nofollow" target="_blank">演示项目可以在这里找到</a>。</p><h2 id="af18" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">安装</h2><ul class=""><li id="14fa" class="li lj it js b jt lk jx ll kb lm kf ln kj lo kn lp lq lr ls bi translated">若要使用推送通知，您需要有一个付费的Apple开发者帐户。</li><li id="bbe7" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated">下载<a class="ae ko" href="https://github.com/onmyway133/PushNotifications/releases" rel="noopener ugc nofollow" target="_blank">推送通知</a>和<a class="ae ko" href="https://github.com/onmyway133/PushNotifications#ios-provider-certificate" rel="noopener ugc nofollow" target="_blank">生成您的. p8证书</a>供以后使用。</li></ul><div class="ly lz gp gr ma mb"><a href="https://github.com/onmyway133/PushNotifications" rel="noopener  ugc nofollow" target="_blank"><div class="mc ab fo"><div class="md ab me cl cj mf"><h2 class="bd iu gy z fp mg fr fs mh fu fw is bi translated">onmyway 133/推送通知</h2><div class="mi l"><h3 class="bd b gy z fp mg fr fs mh fu fw dk translated">https://gum.co/rsjU·❤️·❤️支持我的工作push notifications是一款用于测试iOS和…</h3></div><div class="mj l"><p class="bd b dl z fp mg fr fs mh fu fw dk translated">github.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp mq mb"/></div></div></a></div><blockquote class="mr ms mt"><p id="3502" class="jq jr mu js b jt ju jv jw jx jy jz ka mv kc kd ke mw kg kh ki mx kk kl km kn im bi translated">注意:<a class="ae ko" href="https://github.com/noodlewerk/NWPusher" rel="noopener ugc nofollow" target="_blank"> Pusher </a>也是一个很棒的工具但是只支持. p12PushNotification同时支持. p8和. p12。</p></blockquote><ul class=""><li id="dad3" class="li lj it js b jt ju jx jy kb my kf mz kj na kn lp lq lr ls bi translated">推送通知在模拟器上不起作用，所以您需要一个真实的设备来执行它。</li><li id="7227" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated">在“功能”选项卡中打开项目的推送通知；它应该会为您生成一个. entitlements。</li></ul><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nb"><img src="../Images/7fdc7ef6606d355b7716deedc20f8803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3EUgQbQz3yuISgxo_OfoyQ.png"/></div></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="1d77" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">请求许可</h2><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/da1f0467dfd55e9b573f02ff32d3600e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Dn_BJPRngRGG85GUS2jExA.png"/></div></figure><figure class="nc nd ne nf gt ng"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="beee" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">获取设备令牌</h2><figure class="nc nd ne nf gt ng"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9207" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在以下情况下，令牌可能会更改:</p><ul class=""><li id="8806" class="li lj it js b jt ju jx jy kb my kf mz kj na kn lp lq lr ls bi translated">该应用程序会在新设备上恢复</li><li id="c493" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated">用户卸载/重新安装应用程序</li><li id="e068" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated">用户清除应用程序数据</li></ul><p id="8ffb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想要向多个设备发送通知，您可以向您的提供商服务器更新令牌。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="4860" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">发送推送通知</h2><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/4bb38559653556318395b14791a2e47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*ABZNMh7VNBCGxImwGaeQng.png"/></div></figure><p id="6e5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开推送通知，并在令牌段下的中填写所需信息:</p><p id="5204" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">密钥id与. p8文件中的10位数字相同，在本例中为8TD74CLH55。</p><p id="b584" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">团队ID可以在你的苹果开发者账号里找到。</p><p id="5180" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">捆绑包id是项目的捆绑包id。</p><p id="988d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">设备令牌是从上一节获得的。</p><p id="7298" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，您可以编辑JSON格式的推送通知消息:</p><pre class="nc nd ne nf gt nx ny nz oa aw ob bi"><span id="8f9e" class="kp kq it ny b gy oc od l oe of">{<br/>  "aps": {<br/>    "alert": {<br/>      "title": "Hello!",<br/>      "body": "This is my first push."<br/>    }<br/>  }<br/>}</span></pre><p id="b40f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，推送通知只在应用程序外有效。将您的应用程序留在后台，按“发送”进行测试！</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi og"><img src="../Images/d7f445ca6d4f5d680079dbdbc747ff41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*DhjscKU3Qdc7djSyeOvU2A.gif"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">按发送</figcaption></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="1ad6" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">前台推送</h2><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ol"><img src="../Images/3c887a306f77e9f44bbb9f4490f82c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FestnrTgXt8LC7phpZ-vbQ.gif"/></div></div></figure><p id="0774" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">前台实现推送通知的关键是符合<code class="fe om on oo ny b">UNUserNotificationCenterDelegate</code>协议。不要忘记为<code class="fe om on oo ny b">UNUserNotificationCenter.current()</code>设置代理人。</p><figure class="nc nd ne nf gt ng"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="c28b" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">转到某个视图控制器</h2><p id="88a6" class="pw-post-body-paragraph jq jr it js b jt lk jv jw jx ll jz ka kb op kd ke kf oq kh ki kj or kl km kn im bi translated">在我们的演示中，我们还有两个页面，<code class="fe om on oo ny b">PresentViewController</code>和<code class="fe om on oo ny b">NavViewController</code>。它们仅仅意味着达到我们想要的视图控制器的两种不同的方法。</p><p id="1617" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过定制有效负载的力量，发送到APNs的JSON，我们可以获得所需的属性并导航到我们想要的视图控制器。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi os"><img src="../Images/34e91bd3d991a8adeda1d6e9cf6b5c8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*9g50-B19P9wg9CZYHU-flA.gif"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">礼物</figcaption></figure><pre class="nc nd ne nf gt nx ny nz oa aw ob bi"><span id="6134" class="kp kq it ny b gy oc od l oe of">{<br/>  "storyboardID": "present",<br/>  "aps": {<br/>    "alert": {<br/>      "body": "present"<br/>    }<br/>  }<br/>}</span></pre><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi os"><img src="../Images/9958e40fdbeee618e4495038c5ee6446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nKjH-0jUnA22zC7tE3EeNA.gif"/></div></div><figcaption class="oh oi gj gh gi oj ok bd b be z dk translated">航行</figcaption></figure><pre class="nc nd ne nf gt nx ny nz oa aw ob bi"><span id="0fd2" class="kp kq it ny b gy oc od l oe of">{<br/>  "storyboardID": "navigation",<br/>  "aps": {<br/>    "alert": {<br/>      "body": "Navigation"<br/>    }<br/>  }<br/>}</span></pre><p id="1499" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">处理定制负载的代码在<code class="fe om on oo ny b">userNotificationCenter(_:didReceive:withCompletionHandler:)</code>中实现</p><figure class="nc nd ne nf gt ng"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="03bc" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">无声推送</h2><p id="0e87" class="pw-post-body-paragraph jq jr it js b jt lk jv jw jx ll jz ka kb op kd ke kf oq kh ki kj or kl km kn im bi translated">静默推送可以在用户不点击的情况下执行操作。在这里，我将在ViewController中静默推送一个自定义图像。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ot"><img src="../Images/c0f41045cddba1caacf8cf23d4f75f72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*T4IJWvR1Sr5bm_MqqV6CYA.gif"/></div></div></figure><p id="8a05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">记得在功能里打开后台模式→远程通知。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ou"><img src="../Images/e0b1d005af5b780007e74795a4beb059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vrp6qiyGw1xTkbsQhHTUw.png"/></div></div></figure><p id="143b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">否则你会得到:</p><pre class="nc nd ne nf gt nx ny nz oa aw ob bi"><span id="bacf" class="kp kq it ny b gy oc od l oe of"><strong class="ny iu">You've implemented -[&lt;UIApplicationDelegate&gt; application:didReceiveRemoteNotification:fetchCompletionHandler:], but you still need to add "remote-notification" to the list of your supported UIBackgroundModes in your Info.plist.</strong></span></pre><p id="b1b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe om on oo ny b">"content-available": 1</code>在净荷中也是静默推送所必需的。</p><pre class="nc nd ne nf gt nx ny nz oa aw ob bi"><span id="47e3" class="kp kq it ny b gy oc od l oe of">{<br/>  "imageUrl": "<a class="ae ko" href="https://i.imgur.com/Jvh1OQm.jpg" rel="noopener ugc nofollow" target="_blank">https://i.imgur.com/Jvh1OQm.jpg</a>",<br/>  "aps": {<br/>    "content-available": 1<br/>  }<br/>}<br/></span></pre><figure class="nc nd ne nf gt ng"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="7a8a" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated"><a class="ae ko" href="https://firebase.google.com/docs/cloud-messaging/ios/first-message" rel="noopener ugc nofollow" target="_blank"> Firebase云消息</a></h2><p id="1f28" class="pw-post-body-paragraph jq jr it js b jt lk jv jw jx ll jz ka kb op kd ke kf oq kh ki kj or kl km kn im bi translated">这里我使用FCM通过firebase发送之前的导航推送通知。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ot"><img src="../Images/3ef7fa70e16de4c1c2e1a695e92060c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YvCrem-7pOPEjsIKAD05kA.gif"/></div></div></figure><p id="7d66" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和通知一样，你需要在Firebase的项目设置中上传. p8文件，或者. p12和证书。</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ov"><img src="../Images/62290672d4a042cb03a77561c6b4b867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HU-cfkZXovPCKprDkk2cJA.png"/></div></div></figure><p id="fb62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经发送了我的自定义有效载荷<code class="fe om on oo ny b">storyboardID</code>，如下所示:</p><figure class="nc nd ne nf gt ng gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ow"><img src="../Images/6dcd362a6cd0c83643ea332dc2e2faa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1JKUf1_HVr9yGF-Vx7FC6Q.png"/></div></div></figure><p id="3c95" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">整个配置有一堆步骤。我建议你阅读我在FCM分支的<a class="ae ko" href="https://github.com/ji3g4kami/PushTest/tree/FCM" rel="noopener ugc nofollow" target="_blank">演示项目中的</a><a class="ae ko" href="https://firebase.google.com/docs/cloud-messaging/ios/receive?authuser=0" rel="noopener ugc nofollow" target="_blank">文档</a>。</p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="f001" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">从这里去哪里</h2><p id="4c1a" class="pw-post-body-paragraph jq jr it js b jt lk jv jw jx ll jz ka kb op kd ke kf oq kh ki kj or kl km kn im bi translated">在本文中，我们学习了如何发送前台、后台、静默推送通知以及Firebase云消息的基础知识。这些是组织间最常用的功能。诚然，如果你真的想深入研究，还有很多东西要学。在这里，我将为您提供一些链接:</p><ul class=""><li id="49fb" class="li lj it js b jt ju jx jy kb my kf mz kj na kn lp lq lr ls bi translated"><a class="ae ko" href="https://medium.com/flawless-app-stories/ios-remote-push-notifications-in-a-nutshell-d05f5ccac252" rel="noopener"> iOS远程推送通知概述</a></li><li id="6832" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated"><a class="ae ko" href="https://medium.com/fantageek/push-notification-in-ios-46d979e5f7ec" rel="noopener">iOS中推送通知的多种场景</a></li><li id="ffb5" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated"><a class="ae ko" href="https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server" rel="noopener ugc nofollow" target="_blank">设置远程通知服务器</a></li><li id="431d" class="li lj it js b jt lt jx lu kb lv kf lw kj lx kn lp lq lr ls bi translated"><a class="ae ko" href="http://swiftdeveloperblog.com/silent-remote-notifications-with-swift-and-firebase/" rel="noopener ugc nofollow" target="_blank">使用Swift和Firebase的静默远程通知</a></li></ul></div></div>    
</body>
</html>