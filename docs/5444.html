<html>
<head>
<title>How to create a VSCode extension using React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React创建VSCode扩展</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-create-a-vscode-extension-using-react-3325a502461e?source=collection_archive---------1-----------------------#2021-03-07">https://itnext.io/how-to-create-a-vscode-extension-using-react-3325a502461e?source=collection_archive---------1-----------------------#2021-03-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/698249a6a3d62838ec29ec37769cf4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8Td4RhEQMbFvV94t"/></div></div></figure><p id="329f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，您将学习如何使用React创建定制的VSCode扩展。</p><p id="6e65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建VSCode扩展是一个有趣的练习。将它提交到市场的门槛低得惊人，提交过程也很顺利。另外，这也是回报开发者社区的一个好方法。</p><p id="ccba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">顺便提一下:最近我用React创建了一个名为<a class="ae kz" href="https://marketplace.visualstudio.com/items?itemName=iskenxan.sheepy" rel="noopener ugc nofollow" target="_blank"> Sheepy </a>的VSCode扩展。这是一个使用Ramda.JS学习函数式编程的交互式指南。如果你像我一样，努力在代码中一致地使用函数式编程，你会发现它很有用。</p><p id="656e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">VSCode允许您构建不同类型的扩展，从主题到代码片段到代码完成。但是当使用React时，你的选择范围缩小到了WebView的扩展。</p><p id="1f7e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">WebView API允许构建超出本机VSCode API所提供的自定义用户界面。使用WebView，您可以将定制的HTML和JavaSript直接加载到VSCode中。</p><p id="e4a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们从建立我们的项目开始。</p><h1 id="0d1e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">设置项目</h1><p id="c5c5" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">幸运的是，我们有一个模板可以用来引导我们的项目。你需要做的第一件事是克隆这个回购。存储库基于create-react-app并使用TypeScript，这对我们来说是一大福音。</p><p id="71f5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">依赖关系</strong></p><p id="37d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">仓库维护人员已经几年没有接触它了，所以我建议更新依赖版本。在我的例子中，我必须更新<code class="fe md me mf mg b">react</code>、<code class="fe md me mf mg b">react-dom</code>和<code class="fe md me mf mg b">vscode</code>依赖项，以使这个项目与我使用的其他库一起工作。</p><p id="1c36" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">启动命令</strong></p><p id="29b7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您将需要设置一个VSCode命令来触发您的扩展。默认情况下，项目的启动命令是<code class="fe md me mf mg b">react-webview.start</code>。你可能想把它替换成<code class="fe md me mf mg b">{YourAppName}.start.</code>下面是用户触发命令时的样子:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/9e48bac171c96c6a082fc91884d9f991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BFoJ6r-XT_NsTq-9"/></div></div></figure><p id="facc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">package.json中的两个属性应该与您的命令相匹配:</p><ul class=""><li id="7940" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated"><code class="fe md me mf mg b">activationEvents</code> -这是VSCode注册将触发您的扩展的事件的地方。</li><li id="d57a" class="mm mn it kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated"><code class="fe md me mf mg b">commands</code> -您的扩展提供的命令列表。</li></ul><p id="b1a8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最重要的是，您需要确保与<code class="fe md me mf mg b">ext-src/extension.ts</code>中的命令名称相匹配。那是你的扩展名的入口文件。这是它的样子:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/67a9f04b27cf22e0d6b0e3980b5c2b9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FJRJyyC_1PHHLlaS"/></div></div></figure><p id="ebe6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">查看一下<code class="fe md me mf mg b">activate</code>函数，确保<code class="fe md me mf mg b">registerCommand</code>方法中第一个参数的值与您在<code class="fe md me mf mg b">package.json</code>中设置的命令相匹配。</p><p id="7c61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Package.json元数据</strong></p><p id="5f70" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您选择发布您的扩展，VSCode将使用来自<code class="fe md me mf mg b">package.json</code>的元数据来填充您的列表。这就是为什么它值得一遍，并确保重要的领域，如描述和名称是抛光和匹配你的品牌。这里有一个<a class="ae kz" href="https://code.visualstudio.com/api/references/extension-manifest" rel="noopener ugc nofollow" target="_blank">链接</a>到来自VSCode docs的官方指南。</p><p id="3263" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们回顾一下开发扩展时的一些常见需求和问题。</p><h1 id="2bc7" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">常见场景</h1><p id="08a5" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated"><strong class="kd iu">加载资产</strong></p><p id="e6e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了适应VSCode API加载本地资产的限制，项目要求您使用相对路径。这意味着您可以加载图像、CSS文件和其他资源，只要您使用相对路径来访问它们。更多限制<a class="ae kz" href="https://code.visualstudio.com/api/extension-guides/webview#controlling-access-to-local-resources" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><p id="0baa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">保存状态</strong></p><p id="4958" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">VSCode中的Webview有它的生命周期。当用户离开你的扩展标签时，你的Webview的当前状态就被破坏了。这意味着任何用户输入都将被清除。</p><p id="bfe7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">幸运的是，VSCode API为您提供了一种将数据存储在与web应用程序中的本地存储相当的存储中的方法。您需要使用的与存储交互的方法是<code class="fe md me mf mg b">acquireVsCodeApi</code>。下面是一个在存储中存储和检索数据的实用方法示例:</p><figure class="mi mj mk ml gt ju"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="0a47" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当用户切换选项卡时，您可以使用这些方法保存数据。但是，如果用户完全关闭您的扩展标签，这些数据将会与您的Webview一起被销毁。</p><p id="e3fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，在应用程序的生命周期中，您只能调用<code class="fe md me mf mg b">acquireVsCodeApi</code>一次。所以我建议将它存储在一个变量中，以便以后访问。</p><p id="7ceb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">用开发者工具调试</strong></p><p id="7c7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很快，您就会想要检查您的元素并调试您的代码。VSCode提供了一个用于本地调试应用程序的内置工具—开发人员Webview工具。</p><p id="7b4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以使用VSCode的命令输入来触发它。确保您的扩展正在本地运行，并键入<code class="fe md me mf mg b">Developer: Open Developer Webview Tools</code>:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/97ee7214a7193a7c6672fb3264299f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QEbG635BOzUHs9j5"/></div></div></figure><p id="40f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">事实上，开发人员Webview工具是常规的浏览器开发工具，因为VSCode使用iframe加载Webview扩展。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/6a3b6665219d3c999e552c004a5d37a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*atL_xPSs9Ei5qHbo"/></div></div></figure><p id="3e50" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，您可以使用浏览器开发工具做所有的事情，比如检查和查看控制台。</p><p id="01ed" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> CSP规则</strong></p><p id="4cbc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="noopener ugc nofollow" target="_blank">MDN Web docs</a>:<strong class="kd iu">内容安全策略</strong> ( <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Glossary/CSP" rel="noopener ugc nofollow" target="_blank"> CSP </a>)是一个附加的安全层，有助于检测和缓解某些类型的攻击。”</p><p id="2f1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在VSCode中，CSP规则控制对本地文件和其他外部资产的访问。在我们的模板项目中，CSP规则是使用<code class="fe md me mf mg b">meta</code>标签在<code class="fe md me mf mg b">extension.ts</code>文件中设置的。如果您在将外部资源加载到您的应用程序时遇到问题，CSP规则应该是第一个需要检查的地方。如果您想了解更多关于VSCode中CSP规则的信息，请查看此<a class="ae kz" href="https://code.visualstudio.com/api/extension-guides/webview#content-security-policy" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><h1 id="ea14" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">限制</h1><p id="c5fd" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在我看来，编写VSCode扩展的最大问题是构建过程。每次你做一个改变，你将需要使用<code class="fe md me mf mg b">yarn run build</code>脚本重新构建你的本地包。然后，您需要使用F5键重新启动扩展。</p><p id="de87" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不幸的是，对于每次重启应用程序的需要，你无能为力。但是至少您可以启动一个<a class="ae kz" href="https://nodemon.io/" rel="noopener ugc nofollow" target="_blank"> nodemon </a>进程来为您运行构建脚本。将下面一行添加到package.json中:</p><pre class="mi mj mk ml gt nf mg ng nh aw ni bi"><span id="de4d" class="nj lb it mg b gy nk nl l nm nn">"watch-build": "nodemon --watch src --ext js,tsx,ts --exec \"yarn run build\""</span></pre><p id="3084" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在你需要做的就是在开始的时候运行<code class="fe md me mf mg b">watch-build</code>一次。</p><p id="585b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">结论</strong></p><p id="0c9e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">构建VSCode扩展很有趣。可以看出，VSCode团队投入了时间和精力来使他们的开发人员API易于使用。它们提供了有用的初学者指南，向您介绍您可以构建的所有不同种类的扩展。</p><p id="e9c0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">他们的Webview API使得为您的扩展构建完全定制的UI成为可能。提醒一下，如果你想看用React构建的完整的VSCode扩展，你可以在这里查看我的repo<a class="ae kz" href="https://github.com/iskenxan/sheepy-fp-guide" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="f368" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">编码快乐！</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="60e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="nv">原载于2021年3月7日https://isamatov.com</em><em class="nv">的</em> <a class="ae kz" href="https://isamatov.com/create-vscode-extension-with-react/" rel="noopener ugc nofollow" target="_blank"> <em class="nv">。</em></a></p></div></div>    
</body>
</html>