<html>
<head>
<title>How to get Stadia running on iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让Stadia在iOS上运行</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-get-stadia-running-on-ios-32495e1df2c1?source=collection_archive---------0-----------------------#2020-09-15">https://itnext.io/how-to-get-stadia-running-on-ios-32495e1df2c1?source=collection_archive---------0-----------------------#2020-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d0565704119f594049494ab34652d6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3lbBgCGhd5oizDXRq1eTA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">克里斯蒂亚诺·平托在<a class="ae kc" href="https://unsplash.com/s/photos/stadia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="bcf4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每个人都对苹果不允许在Appstore上提供Stadia这样的服务感到非常沮丧。这是一个很好的服务，应该允许在任何地方运行。</p><p id="0978" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，我已经找到了一个在你的iOS设备上运行Stadia的方法。今天我将解释它是如何工作的，并为你们提供一个可以修改的示例项目。</p><p id="1210" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还可以创建一个自定义的控制器覆盖，这样您就可以在没有控制器的设备上玩游戏。</p><p id="535c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">注意:这个源码不好看。它可以作为概念的证明，供其他人借鉴。</em></p><p id="cf51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但首先，我们需要克服这些主要挑战；</p><ul class=""><li id="1365" class="lc ld iq kf b kg kh kk kl ko le ks lf kw lg la lh li lj lk bi translated">我们只能从特定的浏览器访问stadia，所以我们需要改变我们的用户代理，这样我们就可以访问stadia服务。</li><li id="cc8a" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">我们需要某种方式登录到我们的谷歌帐户，并重定向到体育场</li><li id="2b06" class="lc ld iq kf b kg ll kk lm ko ln ks lo kw lp la lh li lj lk bi translated">WKWebView有蹩脚的控制器支持，我们需要想出一个“更好的”方法来支持<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API/Using_the_Gamepad_API" rel="noopener ugc nofollow" target="_blank">游戏手柄API </a>。</li></ul><p id="1727" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个问题很容易解决，我们检查允许访问stadia.google.com的设备的用户代理，并在我们的浏览器中复制特定的用户代理。</p><p id="3e29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">控制器是个难题。iOS上的Safari支持Gamepad API，但在我的设备上，它永远无法连接；如果有，它会随机停止工作。</p><p id="7798" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我目前的解决方案是自己给javascript提供数据，劫持<code class="fe lq lr ls lt b">Navigators.getGamepads()</code>函数并模拟一个控制器，这样我们就可以决定它何时连接/断开。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="0ead" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">掌握控制权</h1><p id="b58b" class="pw-post-body-paragraph kd ke iq kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">首先，我们将制作一个模型，这样我们就可以像<code class="fe lq lr ls lt b">Navigator.getGamepads()</code>函数通常所做的那样表示控制器。</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">你可以在这里找到官方规格<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API/Using_the_Gamepad_API" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="c047" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们现在可以构建我们的自定义控制器脚本。我们可以使用苹果公司提供的<code class="fe lq lr ls lt b">GameController</code>框架来读取我们的控制器。然后我们将它解析到我们的模型中。因为按钮需要按一定的顺序排列，我们用下面的方法来构造它。</p><p id="d721" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">*我们假设我们想要控制第一个连接的控制器，我们也只支持一个控制器。</em></p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">这段代码将受益于一些错误处理❤</figcaption></figure><p id="e7f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我的测试中，不需要<code class="fe lq lr ls lt b">timestamp</code>，所以我将其留空。随意创建实现来完全模拟官方API。我们已经准备好了控制器数据，剩下的就是在我们的iOS应用程序和运行Stadia的<code class="fe lq lr ls lt b">WKWebView</code>之间建立一座沟通桥梁。</p><p id="dad0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在iOS14中使用<code class="fe lq lr ls lt b">WKWebView</code>，我们可以添加一个<code class="fe lq lr ls lt b">addScriptMessageHandler</code>，这允许我们与Javascript通信并返回一个<code class="fe lq lr ls lt b">Promise</code>，这将帮助我们劫持<code class="fe lq lr ls lt b">Navigators.getGamepads()</code>函数并返回我们的自定义数据。</p><p id="9a37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用下面的javascript，我们可以模拟一个假的控制器。我们劫持了这个方法。每次它被访问时，我们调用一个<code class="fe lq lr ls lt b">messageHandler</code>，它将通过一个<code class="fe lq lr ls lt b">Promise</code>给我们控制器数据，并覆盖最后一个已知的状态。(这意味着我们有一帧不同步，但我们在游戏中不会注意到这一点)</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">感谢我的朋友斯蒂芬·曼特尔帮我解决了这个问题</figcaption></figure><p id="0e1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将创建一个类，其中包含一个可以加载文件(以字符串形式)的方法和一个可以设置WKWebView以便它可以运行我们的自定义代码的方法</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">这段代码将受益于错误处理❤</figcaption></figure><p id="18af" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通常情况下，每当我们调用<code class="fe lq lr ls lt b">setup(webview: WKWebView)</code>时，就会执行我们之前编写的javascript，覆盖<code class="fe lq lr ls lt b">Navigators.getGamepads()</code>函数。每当这个函数被调用时，我们现在调用我们的应用程序代码并进入<code class="fe lq lr ls lt b">usercontentController</code>回调，在那里我们返回我们当前的控制器状态。</p><p id="0e8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧，我们应该在任何<code class="fe lq lr ls lt b">WKWebView</code>中有一个一致的工作控制器。</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="nm nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">控制器支持费用</figcaption></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="3132" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">回到体育场</h1><p id="277c" class="pw-post-body-paragraph kd ke iq kf b kg mz ki kj kk na km kn ko nb kq kr ks nc ku kv kw nd ky kz la ij bi translated">现在让Stadia工作已经不是很多工作了，我们首先创建一个带有<code class="fe lq lr ls lt b">WKWebView</code>的<code class="fe lq lr ls lt b">UIViewController</code>。在我的测试中，我们需要一个有效的iOS用户代理来登录我们的谷歌账户。使用自定义代理只需要访问Stadia。幸运的是<code class="fe lq lr ls lt b">WKWebView</code>覆盖了我们。</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">你想测试控制器吗？在加载请求之前，取消对该行的注释并调用controller.setup(webview )!</figcaption></figure><p id="4cc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了一个自定义配置，将我们的控制器添加为一个<code class="fe lq lr ls lt b">ScriptMessageHandler</code>确保这个名称与前面javascript脚本中使用的名称相匹配！</p><p id="6acd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe lq lr ls lt b">WKNavigationDelegate</code>我们可以检查我们当前是否已经登录，或者我们当前是否仍然忙于尝试登录。</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">是的，这不太好，我知道它适用于这个概念验证</figcaption></figure><p id="4aed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当我们登录时，我们会自动导航到stadia，如果我们到了目的地，我们会启动javascript magic，瞧，Stadia在iOS上全屏运行，并有控制器支持。</p><figure class="ne nf ng nh gt jr"><div class="bz fp l di"><div class="nm nj l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在移动中玩杀手❤</figcaption></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="d83b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是在iOS设备上玩球场游戏的有效解决方案。有一些事情可以做得更好，但核心功能在那里。</p><p id="e820" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这触及了一个不同于我通常在媒体上所做的主题。这是一个很有趣的问题。</p><p id="a7d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我在这里打开了回购:<a class="ae kc" href="https://github.com/Plnda/Gradia" rel="noopener ugc nofollow" target="_blank">https://github.com/Plnda/Gradia</a>如果你愿意，请提交任何公关，这样我们就可以在这个应用程序上合作</p><p id="2d73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">在这里的</em> <a class="ae kc" href="https://pinch.nl/en/" rel="noopener ugc nofollow" target="_blank"> <em class="lb">捏</em> </a> <em class="lb">，我们尝试让我们的应用变得更好。你有任何问题或评论吗？请在评论中告诉我们。</em></p></div></div>    
</body>
</html>