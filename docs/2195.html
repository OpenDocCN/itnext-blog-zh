<html>
<head>
<title>Node.JS: Composable factory functions over classes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节点。JS:类上的可组合工厂函数</h1>
<blockquote>原文：<a href="https://itnext.io/node-js-composable-factory-functions-over-classes-e07bdd47438f?source=collection_archive---------4-----------------------#2019-04-14">https://itnext.io/node-js-composable-factory-functions-over-classes-e07bdd47438f?source=collection_archive---------4-----------------------#2019-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/25da0eb34bab772af7a10280cbff02aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lUQ18xymkro0OfKyGjZ2gA.jpeg"/></div></div></figure><p id="5780" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着新的ES6语法的引入，更具体地说是<code class="fe kw kx ky kz b">class</code>，面向对象的范例在Javascript中变得更加流行。类是很棒的，它们肯定能帮助你更好地构建代码。然而，当您想要将多个类的功能组合在一起，并且仍然在代码中实施模块化时，麻烦就来了。所以在这篇文章中，我想谈谈可组合工厂函数(CFF ),它可以让你构造组合多个可重用特性的对象，而不需要创建一个紧密耦合的类层次结构。</p><h1 id="5a52" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">工厂</h1><p id="eeb7" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">工厂是编程世界中一种众所周知的模式。使用工厂，您可以用一个特殊的工厂函数来抽象对象的创建，并且只使用该函数来创建对象的新实例。工厂的消费者不知道对象是如何创建的，因此给了我们实现工厂功能的自由。让我们看看例子。</p><h2 id="3f6a" class="md lb iq bd lc me mf dn lg mg mh dp lk kj mi mj lo kn mk ml ls kr mm mn lw mo bi translated">生成安全令牌</h2><p id="5199" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">在此示例中，我们将编写一个简单的工厂函数，用于生成服务器和前端之间通信的安全代码:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d9f2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您可能想直接在客户端代码中使用<code class="fe kw kx ky kz b">jsonwebtoken</code>库，而不为它创建单独的工厂方法。如果您只在一个地方生成令牌，这没问题，但是如果您的代码中有多个地方生成令牌，那么更改实现就会有问题。</p><h2 id="0108" class="md lb iq bd lc me mf dn lg mg mh dp lk kj mi mj lo kn mk ml ls kr mm mn lw mo bi translated">添加管理员访问权限</h2><p id="eaf1" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">现在让我们想象一下，将来您决定基于用户的电子邮件创建一种特殊类型的管理令牌。因为我们在代码的每一部分都使用了工厂方法来生成令牌，所以添加这个新功能很容易:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="489d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的示例中，我们检查用户的电子邮件是否与存储在数组属性中的任何管理员电子邮件相匹配。如果是，我们授予我们的令牌管理员级别的访问权限。同样，如果我们没有实现这个工厂功能，添加这个新功能将会很困难。</p><p id="c6fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但这是旧闻了，对吧？您可能以前遇到过工厂模式，并且(希望)每天在您的代码中使用它。然而，为了解释可组合的工厂函数，我必须先回顾一下工厂函数模式。</p><h1 id="7593" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">可组合的工厂函数</h1><p id="5dd0" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">可组合工厂函数(CFF)是一个更高级的节点。构建在工厂模式之上的JS模式。在这种模式中，可以将工厂功能组合在一起，创建另一个具有组合功能的工厂功能。</p><h2 id="cd57" class="md lb iq bd lc me mf dn lg mg mh dp lk kj mi mj lo kn mk ml ls kr mm mn lw mo bi translated">超级英雄发电机</h2><p id="46ae" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv ij bi translated">这里有一个简单的例子，利用CFF来构造结合多种特性的对象。由于新的“复仇者联盟”电影即将上映，我们假设我们正在建立一个超级英雄创作模拟器。我们希望在我们提供的基本属性和能力的基础上创造一种新型的超级英雄。</p><p id="462a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个例子中，我们将使用<a class="ae mv" href="https://www.npmjs.com/package/stampit" rel="noopener ugc nofollow" target="_blank"> stampit </a>库来构建CFF。这个轻量级模块为我们提供了一个简单的API来构建工厂函数。</p><p id="ef28" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是5个基本的CFF:</p><ul class=""><li id="fdc0" class="mw mx iq ka b kb kc kf kg kj my kn mz kr na kv nb nc nd ne bi translated">角色——有生命点、耐力点和名字的基本角色</li><li id="ab35" class="mw mx iq ka b kb nf kf ng kj nh kn ni kr nj kv nb nc nd ne bi translated">飞行——为角色提供飞行的能力</li><li id="131d" class="mw mx iq ka b kb nf kf ng kj nh kn ni kr nj kv nb nc nd ne bi translated">超级力量——拥有超人力量的角色</li><li id="bc39" class="mw mx iq ka b kb nf kf ng kj nh kn ni kr nj kv nb nc nd ne bi translated">智力——角色拥有天才级别的智力</li><li id="e839" class="mw mx iq ka b kb nf kf ng kj nh kn ni kr nj kv nb nc nd ne bi translated">武术——使角色成为武术专家</li></ul><p id="f200" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从基本的角色功能开始:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="4529" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kw kx ky kz b">props</code>用于定义对象的默认属性</p><ul class=""><li id="556a" class="mw mx iq ka b kb kc kf kg kj my kn mz kr na kv nb nc nd ne bi translated"><code class="fe kw kx ky kz b">init</code>定义我们可以在初始化过程中分配的属性</li></ul><p id="ff89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们添加其余的CFF！</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="24d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你所看到的，我们有4种不同的超能力CFF，每一种都有自己的方法。现在让我们看看如何将它们组合起来创建组合工厂函数:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="c887" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的例子中，我们使用CFFS创建了3种不同的混合超级英雄类型。请注意，组合不同的工厂函数是多么容易，我们的代码是多么松散耦合。现在想象一下，如果我们试图用类层次结构复制这个例子。很容易猜到这个解决方案会更加复杂。另外，如果我们决定以后增加更多的超级英雄能力呢？它不能很好地扩展。</p><p id="074c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，让我们创建一些组合对象的实例:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0464" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简单不是吗？当创建新实例时，我们必须为每个工厂函数提供在<code class="fe kw kx ky kz b">init</code>方法中定义的初始值。</p><p id="bae5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个帖子到此为止！希望对你有所帮助。在很多情况下，可组合的工厂函数是类的一个很好的替代品。它们允许您在构建复杂的对象功能时构建可重用的松散耦合的代码。</p></div><div class="ab cl nk nl hu nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ij ik il im in"><p id="9883" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nr">原载于2019年4月14日</em><a class="ae mv" href="https://isamatov.com/node-js-composable-factory-functions-over-classes/" rel="noopener ugc nofollow" target="_blank"><em class="nr">isamatov.com</em></a><em class="nr">。</em></p></div></div>    
</body>
</html>