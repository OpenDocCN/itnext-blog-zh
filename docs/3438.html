<html>
<head>
<title>How to Wrap Text on Image using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python在图像上换行</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-wrap-text-on-image-using-python-8f569860f89e?source=collection_archive---------0-----------------------#2019-12-17">https://itnext.io/how-to-wrap-text-on-image-using-python-8f569860f89e?source=collection_archive---------0-----------------------#2019-12-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/76ee2da057e1e70f379b9a5d974c1f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGEVK9Sp8AO6Wd5EM6RRYQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://haptik.ai/tech/putting-text-on-images-using-python-part2/" rel="noopener ugc nofollow" target="_blank">https://hap tik . ai/tech/put-text-on-images-using-python-part 2/</a></figcaption></figure><p id="90da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在进行Udacity项目“<a class="ae kc" href="https://github.com/Eyongkevin/PYND/tree/master/02_meme_gen_starter/src" rel="noopener ugc nofollow" target="_blank"> Meme Generator </a>”的时候，该项目接收图片并在随机位置给图片加上引号，我做了额外的工作来实现一个功能，如果引号的长度超过图片的宽度，它会自动换行。该功能在项目标题中不是必需的，因为默认的引号足够短，可以在一行中容纳图像。试图用Python Pillow实现这一点并不可行，因为它不会自动绘制文本并将其推到新的一行。在其他手动操作中，我需要计算文本的宽度和高度，确定随机位置，然后适当调整文本，使其不会溢出</p><blockquote class="lb lc ld"><p id="505a" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">这篇文章中的代码可以在这个<a class="ae kc" href="https://github.com/Eyongkevin/How-to-Wrap-Text-on-Image-using-Python" rel="noopener ugc nofollow" target="_blank"> repo </a>中找到。另外，查看`<a class="ae kc" href="https://github.com/Eyongkevin/PYND/tree/master/02_meme_gen_starter/src" rel="noopener ugc nofollow" target="_blank"> Meme Generator </a>`项目，看看我是如何在这个项目中实现这项技术的。我建议您阅读本文并自己运行代码。这样你会理解，甚至取得更好的效果。</p></blockquote><h2 id="f6f8" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">解释技术</h2><p id="a96f" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">当我们用代码弄脏我们的手时，我将解释我用来完成它的技术。我考虑了以下标准:</p><p id="aca0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">加载图像</strong></p><p id="eca3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用扩展库<code class="fe mg mh mi mj b"><a class="ae kc" href="https://pillow.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">pillow</a></code>在图像上绘制文本。我们将使用pillow中的以下类:</p><ul class=""><li id="8782" class="mk ml iq kf b kg kh kk kl ko mm ks mn kw mo la mp mq mr ms bi translated"><a class="ae kc" href="https://pillow.readthedocs.io/en/stable/reference/Image.html" rel="noopener ugc nofollow" target="_blank">图像</a>:为我们的文本创建一个图像对象</li><li id="c317" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated"><a class="ae kc" href="https://pillow.readthedocs.io/en/stable/reference/ImageDraw.html" rel="noopener ugc nofollow" target="_blank"> ImageDraw </a>:创建绘图上下文</li><li id="b31e" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated"><a class="ae kc" href="https://pillow.readthedocs.io/en/stable/reference/ImageFont.html" rel="noopener ugc nofollow" target="_blank">图像字体</a>:我们将在图像上绘制的文本的字体</li></ul><p id="f556" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我用代码加载了图像</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="3274" class="li lj iq mj b gy ng nh l ni nj">from PIL import Image, ImageDraw, ImageFont</span><span id="b587" class="li lj iq mj b gy nk nh l ni nj">#create image object from the input image path<br/>try:<br/>    image = Image.open('./eyong.jpg')   <br/>except IOError as e:<br/>    print(e)</span></pre><blockquote class="lb lc ld"><p id="a894" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">确保<a class="ae kc" href="https://pypi.org/project/Pillow/" rel="noopener ugc nofollow" target="_blank">枕头</a>已安装。此外，您可以用您自己的图像的路径替换<code class="fe mg mh mi mj b">./eyong.jpg</code>。考虑使用<code class="fe mg mh mi mj b">.jpg</code>作为开始</p></blockquote><p id="fbd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">随机定位</strong></p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/1855a5d52757a85a130ec1614f6d35bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6t_gqk0IwnbZ6AnTgtdmQ.png"/></div></div></figure><p id="7137" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个项目(<a class="ae kc" href="https://github.com/Eyongkevin/PYND/tree/master/02_meme_gen_starter/src" rel="noopener ugc nofollow" target="_blank"> Meme Generator </a>)要求我们在一张图片上随机选择一个引用的位置。这是非常重要的，因为它将决定我将如何分割文本。正如我们从上图中看到的，白色矩形是图像上随机选择位置的区域。我决定让它更靠左，因为文本将是左对齐的，我们不想让我们的文本从图像的最右边开始。</p><p id="f447" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">底部是90% ,因为默认情况下报价将有一个主体和一个作者，所以如果主体只占一行，那么作者将被下推一行。如果我们将它设为100%,并且碰巧随机选择的y轴落在最底部，那么作者将不会在图像上可见。正如我们将在后面看到的，Y轴将根据另外两个标准而变化。</p><p id="f4c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">调整图像大小</strong></p><p id="dcdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">图像的宽度调整为500像素，并自动生成高度，同时保持纵横比(项目要求)</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="35e9" class="li lj iq mj b gy ng nh l ni nj"># Resize the image <br/>width = 500<br/>img_w = image.size[0]<br/>img_h = image.size[1]<br/>wpercent = (width/float(img_w))<br/>hsize = int((float(img_h)*float(wpercent)))<br/>rmg = image.resize((width,hsize), Image.ANTIALIAS)</span></pre><blockquote class="lb lc ld"><p id="4d23" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">您可以在这里使用任何宽度，但重要的是，高度是由宽度生成的，并且纵横比保持不变。</p></blockquote><p id="7c76" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">计算X边界，将文本分割成多行并计算Y边界</strong></p><p id="f853" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">后来，我计算了x轴边界，然后随机生成x点:</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="17b3" class="li lj iq mj b gy ng nh l ni nj"># Set x boundry<br/># Take 10% to the left for min and 50% to the left for max<br/>x_min = (rmg.size[0] * 8) // 100<br/>x_max = (rmg.size[0] * 50) // 100<br/># Randomly select x-axis<br/>ran_x = randint(x_min, x_max)</span></pre><blockquote class="lb lc ld"><p id="98f5" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">我们需要在other中导入randint来使用它</p><p id="6b9f" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated"><code class="fe mg mh mi mj b">from random import randint</code></p></blockquote><p id="1a35" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计算Y轴边界有点棘手。我们需要知道文本的行数和行高。</p><p id="7963" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">文本的行数由文本长度和随机选择的X轴决定。考虑下面的图片:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/ed3e2fa7c815ef5e82166fd6c1aea164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WN96bTh5tnATSGeetSqJWQ.png"/></div></div></figure><p id="82df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">考虑左边的图像，想象我们在那个位置随机选择了x点和y点。假设文本大约40个字符长，从x点到图像右边界的距离是30px。我们注意到文本会溢出。此时，我们可以在最大30个字符的长度内拆分我们的文本。因此，我们得到的分割将有3行长度分别为30、30和10的文本。</p><p id="5dff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，分割后，我们看到文本行溢出到图像的底部(图像在右边)。当从y点到图像底部的高度比拆分生成的行数乘以行高要短时，会发生这种情况</p><p id="57f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">结果将是为Y轴定义一个新的边界，这样任何随机生成的点都不会导致底部溢出。我用下面几行代码做到了这一点:</p><p id="8198" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据随机选择的X点和文本的字体大小分割文本</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="edb1" class="li lj iq mj b gy ng nh l ni nj"># Create font object with the font file and specify desired size<br/># Font style is `arial` and font size is 20<br/>font_path = 'font/arialbd.ttf'<br/>font = ImageFont.truetype(font=font_path, size=20)</span><span id="83f6" class="li lj iq mj b gy nk nh l ni nj">text = "This could be a single line text but its too long to fit in one."</span><span id="bafb" class="li lj iq mj b gy nk nh l ni nj">lines = text_wrap(text, font, rmg.size[0]-ran_x)<br/>line_height = font.getsize('hg')[1]</span></pre><blockquote class="lb lc ld"><p id="2baa" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">在代码行<code class="fe mg mh mi mj b">line_height = font.getsize(‘hg’)[1]</code>中，我们找到了行的权重。这将用于添加适当的行距。我们选择了<code class="fe mg mh mi mj b">h</code>，因为它像<code class="fe mg mh mi mj b">t</code>、<code class="fe mg mh mi mj b">l</code>等一样向上延伸。我们也选择<code class="fe mg mh mi mj b">g</code>，因为它向下延伸，就像<code class="fe mg mh mi mj b">y</code>、<code class="fe mg mh mi mj b">p</code>等。因此<code class="fe mg mh mi mj b">hg</code>覆盖了所有英文字符的高度范围。</p></blockquote><p id="81f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们定义执行拆分的<code class="fe mg mh mi mj b">text_wrap</code></p><figure class="my mz na nb gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="a8ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">逻辑非常简单:</p><ul class=""><li id="dcff" class="mk ml iq kf b kg kh kk kl ko mm ks mn kw mo la mp mq mr ms bi translated">如果文本短于最大宽度，那么它可以放在一行中。不拆分返回</li><li id="cfc9" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated">使用空格分割文本以获得每个单词</li><li id="7de0" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated">当宽度小于最大宽度时，通过添加单词来创建短文本。</li></ul><p id="3251" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们已经有了分割的文本和线宽，我们准备寻找垂直(Y轴)位置边界和随机生成的Y点</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="82fd" class="li lj iq mj b gy ng nh l ni nj">y_min = (rmg.size[1] * 4) // 100   # 4% from the top<br/>y_max = (rmg.size[1] * 90) //100   # 90% to the bottom<br/>y_max -= (len(lines)*line_height)  # Adjust<br/>ran_y = randint(y_min, y_max)      # Generate random point</span></pre><p id="e055" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们有了在图像上绘制文本的所有参数。我使用了一个循环，在每次插入新的一行时，用垂直位置和行高来增加当前的垂直位置。</p><pre class="my mz na nb gt nc mj nd ne aw nf bi"><span id="8365" class="li lj iq mj b gy ng nh l ni nj">#Create draw object<br/>draw = ImageDraw.Draw(rmg)</span><span id="cf21" class="li lj iq mj b gy nk nh l ni nj">#Draw text on image</span><span id="89ec" class="li lj iq mj b gy nk nh l ni nj">color = 'rgb(255,0,0)'  # Red color<br/>x = ran_x<br/>y = ran_y<br/>for line in lines:<br/>    draw.text((x,y), line, fill=color, font=font)<br/>    <br/>    y = y + line_height    # update y-axis for new line</span><span id="27d6" class="li lj iq mj b gy nk nh l ni nj"># Redefine x and y-axis to insert author's name<br/>author = "- Eyong Kevin"<br/>y += 5                       # Add some line space<br/>x += 20                      # Indent it a bit to the right<br/>draw.text((x,y), author, fill=color, font=font)<br/>rmg.show()</span></pre><p id="0b71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出图像将如下所示:</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/84a40de8c30bb4c48e04dfa1d96e6b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*4h3j6MFJfEvdqc0uHtwacA.jpeg"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用Python的标题图像(Eyong Kevin的图像)</figcaption></figure><h2 id="654a" class="li lj iq bd lk ll lm dn ln lo lp dp lq ko lr ls lt ks lu lv lw kw lx ly lz ma bi translated">结论</h2><p id="cc02" class="pw-post-body-paragraph kd ke iq kf b kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw mf ky kz la ij bi translated">我们看到图像中的文本是可读的，并且格式良好。我相信有很多方法，甚至更好的方法来解决这个问题。我愿意接受任何改进这项技术或任何比这项技术更好的其他技术的建议。所以，请在下面的评论中告诉我。</p><p id="e57d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">提前祝圣诞和新年快乐。</p><figure class="my mz na nb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/e4e7583c2c4c8b0fb21d260162aa5802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPr6tEOyu5Ll7ZNWdziXFA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><a class="ae kc" href="https://www.fasttech.com/product/6198406-christmas-tree-styled-bunting-banner-flag" rel="noopener ugc nofollow" target="_blank">https://www . fast tech . com/product/6198406-Christmas-tree-style-bunting-banner-flag</a></figcaption></figure><p id="64c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">参考</p><p id="bbbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://haptik.ai/tech/putting-text-on-images-using-python-part2/" rel="noopener ugc nofollow" target="_blank">使用Python在图像上放置文本—第2部分</a></p></div></div>    
</body>
</html>