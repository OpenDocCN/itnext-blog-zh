<html>
<head>
<title>NLP: Named Entity Recognition (NER) with Spacy and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NLP:使用Spacy和Python的命名实体识别(NER)</h1>
<blockquote>原文：<a href="https://itnext.io/nlp-named-entity-recognition-ner-with-spacy-and-python-dabaf843cab2?source=collection_archive---------0-----------------------#2021-01-03">https://itnext.io/nlp-named-entity-recognition-ner-with-spacy-and-python-dabaf843cab2?source=collection_archive---------0-----------------------#2021-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e235026bae6dbe945b14c5417c7e2c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*brEfimb_Ki1cjRbY"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">亨特·哈里特在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="5b73" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="11c1" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu">更新</strong>:查看我的新<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/introduction-to-natural-language-processing-nlp-tools-for-python-cf39af3cfc64?source=post_stats_page-------------------------------------">NLP介绍文章</a>！</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="2b5d" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">本文的目标是介绍<strong class="ln iu">自然语言处理</strong>中的一个关键任务，即<strong class="ln iu">命名实体识别</strong> ( <a class="ae kf" href="https://en.wikipedia.org/wiki/Named-entity_recognition" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu"> NER </strong> </a>)。目标是能够提取文本语料库中的公共实体。例如，检测人员、地点、药物、日期等。在诸如电子邮件或文档的给定文本中。</p><p id="6306" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu"> NER </strong>是广阔的<a class="ae kf" href="https://towardsdatascience.com/your-guide-to-natural-language-processing-nlp-48ea2511f6e1" rel="noopener" target="_blank"> NLP </a>领域的技术部分，它本身是<strong class="ln iu">机器学习</strong>领域的一部分，而后者又属于<strong class="ln iu"> AI </strong>的父领域。</p><p id="a518" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在这篇<strong class="ln iu">动手</strong>文章中，我们将使用<a class="ae kf" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu"> Spacy </strong> </a>库来训练一个基于神经网络的深度学习模型，从文本数据中检测实体。我们还将展示的一件事，也是很多文章中经常忽略的一件事，就是如何给数据加标签。我们还将比较<strong class="ln iu">深度学习</strong>和使用<strong class="ln iu">模式匹配</strong>的更暴力的方法。</p><p id="dae8" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">例如，我们将创建一个模型，从包含与石油行业相关的电子邮件列表的<a class="ae kf" href="https://www.kaggle.com/mitusha/email-dataset" rel="noopener ugc nofollow" target="_blank">公共数据集</a>中检测与<strong class="ln iu">石油/汽油</strong>相关的实体。这是一个过于简化的例子，因为在现实生活中你会希望有更多的通用实体，但这将为NER提供一个简单的例子，并显示一个模式匹配可能是一个比NER更好的选择的例子。因此，总结一下<strong class="ln iu">，我们将从电子邮件</strong>中提取石油相关实体。</p><p id="1d5c" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">我们将使用<a class="ae kf" href="http://doccano.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu"> Doccano </strong> </a> <strong class="ln iu">来标记数据，这是一个开源项目，提供了一个很好的用户界面来管理数据集，标记数据和团队之间的合作。</strong>可以为情感分析、命名实体识别、文本摘要等创建标注数据。您可以尝试<a class="ae kf" href="http://doccano.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">注释演示</a>了解更多详情。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/eb9f582d9a7b1de20ed09223c7601ab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bFitXkka-1CoLvjC.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Doccano标签工具</figcaption></figure><p id="ac02" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">我们将在之后执行<strong class="ln iu">:</strong></p><ul class=""><li id="552a" class="mo mp it ln b lo lp ls lt lw mq ma mr me ms mi mt mu mv mw bi translated">阅读电子邮件数据集，每行有一封电子邮件。</li><li id="8309" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">我们将使用<a class="ae kf" href="http://doccano.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu"> Doccano </strong> </a>标记工具标记带有石油实体的电子邮件。这是一个手动过程。</li><li id="8481" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">我们将把标签保存在一个文本文件中，命名为<strong class="ln iu"> JSONL。</strong></li><li id="5cee" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">我们将使用<strong class="ln iu"> Spacy </strong>神经网络模型来训练新的统计模型。</li><li id="fb3d" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">我们将保存该模型。</li><li id="0c7e" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">我们将创建一个<strong class="ln iu">空间</strong> NLP管道，并使用新的模型来探测从未见过的石油实体。</li><li id="c3aa" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">最后，我们将使用模式匹配而不是深度学习模型来比较这两种方法。</li></ul><p id="732f" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这将是一个两步的过程。<strong class="ln iu">标注</strong>数据<strong class="ln iu">训练</strong>模型。</p><p id="e0f1" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">所有的<strong class="ln iu">数据</strong>和一个<strong class="ln iu">笔记本</strong>以及所有的<strong class="ln iu">代码</strong>都可以在我的<a class="ae kf" href="https://github.com/javiramos1/ner_spacy_demo" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu">资源库</strong> </a>中找到。</p><h1 id="7f1e" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">步骤1:标记数据</h1><h2 id="5361" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">安装Doccano</h2><p id="3a39" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">第一步是使用<strong class="ln iu"> Doccano标记实体。</strong></p><p id="9936" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">如果您对这一步不感兴趣，您可以使用<a class="ae kf" href="https://github.com/javiramos1/ner_spacy_demo/blob/main/emails_labeled.jsonl" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu">中已经标记的数据，此处</strong> </a>并跳到下一节。</p><p id="a606" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">按照<a class="ae kf" href="https://doccano.github.io/doccano/tutorial/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu"> Doccano </strong> </a>说明安装并打开该工具。</p><p id="74d9" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">如果你使用<strong class="ln iu"> Linux/Mac </strong>，我推荐使用docker镜像:</p><ul class=""><li id="ecb3" class="mo mp it ln b lo lp ls lt lw mq ma mr me ms mi mt mu mv mw bi translated"><code class="fe nt nu nv nw b">docker pull doccano/doccano</code></li><li id="8455" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated"><code class="fe nt nu nv nw b">docker container create --name doccano -e "ADMIN_USERNAME=admin" -e "ADMIN_EMAIL=admin@example.com" -e "ADMIN_PASSWORD=password" -p 8000:8000 doccano/doccano</code></li><li id="f407" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated"><code class="fe nt nu nv nw b">docker container start doccano</code></li></ul><p id="e386" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">对于<strong class="ln iu">窗口</strong>，只需使用<strong class="ln iu"> pip </strong>:</p><ul class=""><li id="f809" class="mo mp it ln b lo lp ls lt lw mq ma mr me ms mi mt mu mv mw bi translated"><code class="fe nt nu nv nw b">pip install doccano</code></li><li id="e52b" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated"><code class="fe nt nu nv nw b">doccano</code></li></ul><p id="65e3" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">前往<a class="ae kf" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">T3 http://127 . 0 . 0 . 1:8000/T5。</a></p><p id="3ffa" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这将显示主页面:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/cff6999cddb5496012b2ae1e3c83ea19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NINCZDqM6DCNlbme0GZedw.png"/></div></div></figure><h2 id="9ed1" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">创建新项目</h2><p id="08b2" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">在右上角点击项目:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/a5613572f8402790d9e01dc97dfdbc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*LNWTY1CiTgHbSwHsZsh7Hw.png"/></div></figure><p id="ffb7" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在下一个屏幕中，单击创建:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/93ac538cb9317b4055c6b1e2dc8b1a27.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*o3bcRcBkHt1H7FOAIv67sg.png"/></div></figure><p id="f273" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">输入名称和描述。对于项目类型，选择<strong class="ln iu">序列标签</strong>，因为我们将把它用于<strong class="ln iu"> NER </strong>而不是文本分类。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/14067a38919fe93b1175f191abd3af2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFRqwF1rI6lp9ncdnmchSQ.png"/></div></div></figure><p id="6c9e" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">单击创建。弹出屏幕关闭后，选择项目名称。这将显示项目欢迎页面。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/b97d45eea8d0017ff365d9ea45da0055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VdznoFpRH3f6mWYVcYINMQ.png"/></div></div></figure><p id="9376" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">点击菜单中的<strong class="ln iu">数据集</strong>。在操作中，单击“导入数据集”。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/92470822cb7cc3a9843e8446c6c2fa5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*YN-sR6ye8z5PaHlvcIfl5A.png"/></div></figure><p id="941b" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">在弹出的屏幕中选择<strong class="ln iu">纯文本</strong>格式，并从存储库中选择<a class="ae kf" href="https://github.com/javiramos1/ner_spacy_demo/blob/main/emails.txt" rel="noopener ugc nofollow" target="_blank"> <em class="od"> emails.txt </em> </a>。您现在应该可以看到只有23封电子邮件的列表:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oe"><img src="../Images/c88bcd5db7d5b78a99f0fb83cf63119b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icu3xrrQk8GoA9YdnOJnGg.png"/></div></div></figure><p id="7f73" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">现在点击菜单中的<strong class="ln iu">标签</strong>。在动作中，选择<strong class="ln iu">创建标签。</strong></p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/eca17ec2155386896842bb50d6ef0120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*ULq-win4dGHh7fJxB74tEw.png"/></div></figure><p id="1780" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">输入<strong class="ln iu">油</strong>作为标签名称，按键0，然后点击<strong class="ln iu">创建</strong>。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/453de683ae9039d7ad0f4cff354c7e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7mrfxnBuILPVBkdG1z8Fg.png"/></div></div></figure><p id="a91b" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">现在，回到数据集，在第一项上单击“<strong class="ln iu"> Annotate </strong>”。你应该看到第一封邮件。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi og"><img src="../Images/cd4ba2c4ebcfc8430d86eabfab0826f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VYtPs4JXRPZndHJO9rBkZQ.png"/></div></div></figure><p id="9e6e" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">现在是做一些手工工作的时候了。您可以使用浏览器搜索功能来查找石油、汽油或石油文本。当你找到一个，双击选择，会弹出一个选择标签的窗口，你也可以点击<strong class="ln iu"> 0 </strong>键。右上角是导航，浏览23封电子邮件并标记所有实体。请注意，有些电子邮件可能不包含任何实体，有些可能包含其中的几个实体。重要的是你不能错过任何一个。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oh"><img src="../Images/1fc792ddcd38169321576378723e6129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F817lYTuHXnO7Jvl2WrfLg.png"/></div></div></figure><p id="f60f" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">完成后，点击菜单中的数据集，选择<strong class="ln iu">动作</strong>-&gt;-<strong class="ln iu">导出</strong> <strong class="ln iu">数据集</strong></p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/f5c5546d727e8c936a4b40af1a01241c.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*94KFnHqnwOtC6Gq7Da7jJQ.png"/></div></figure><p id="2de9" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">选择<strong class="ln iu"><em class="od">【JSONL(文本标签)</em> </strong>格式。输入文件名，例如:<em class="od">emails _ label</em>。点击<strong class="ln iu">导出</strong>。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/2b4e1efe7e09cbb9dc9c24666a5df7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZLJOxXsOgZD-Oaacd2QMaw.png"/></div></div></figure><p id="d2c3" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu">保存</strong>文件。现在，您已经为第2步做好了准备，即训练模型。</p><h1 id="e157" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">第二步:模特训练</h1><p id="a4ea" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">现在我们有了训练集，是时候开始使用内置深度学习功能的<strong class="ln iu"> Spacy </strong>来训练我们的模型了。你可以打开一个<strong class="ln iu"> Jupyter笔记本</strong>或者你喜欢的编辑器；或者跟着<a class="ae kf" href="https://github.com/javiramos1/ner_spacy_demo" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu">库中的</strong> </a>一起走。</p><h2 id="aec0" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">安装空间</h2><p id="a139" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">根据您的平台，详细的<a class="ae kf" href="https://spacy.io/usage" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu">安装说明</strong> </a>请参考文档。使用画中画时，只需:</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="79e6" class="nc kh it nw b gy oo op l oq or">pip install -U pip setuptools wheel<br/>pip install -U spacy<br/>python -m spacy download en_core_web_sm</span></pre><h2 id="72c0" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">数据准备</h2><p id="f189" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">首先，让我们使用以下格式读取JSONL文件:</p><p id="9753" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><code class="fe nt nu nv nw b">{"id": 15, "text": "....", "meta": {}, "annotation_approver": null, "labels": [[226, 234, "OIL"]]}</code></p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="56c5" class="nc kh it nw b gy oo op l oq or">import json<br/>labeled_data = []<br/>with open(r"<strong class="nw iu">emails_labeled.jsonl</strong>", "r") as read_file:<br/>    for line in read_file:<br/>        data = json.loads(line)<br/>        labeled_data.append(data)</span></pre><p id="bc7f" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">接下来，让我们将<strong class="ln iu"> Deccano </strong>格式转换为<strong class="ln iu"> Spacy </strong>格式。我们还将删除额外的列，并将标签重命名为实体。</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="4398" class="nc kh it nw b gy oo op l oq or">TRAINING_DATA = []<br/>for entry in labeled_data:<br/>    entities = []<br/>    for e in entry['labels']:<br/>        entities.append((e[0], e[1],e[2]))<br/>    spacy_entry = (entry['text'], {"entities": entities})<br/>    TRAINING_DATA.append(spacy_entry)</span></pre><h2 id="4368" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">训练模型</h2><p id="e9df" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">我们使用<strong class="ln iu">深度学习</strong> ( <strong class="ln iu"> NN </strong>)，设置0.3的辍学率，防止过拟合。</p><p id="39da" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这个想法是使用一个有许多神经元和几层的<strong class="ln iu">神经网络</strong>。我们向网络显示已经被标记的文本。我们将运行几次迭代，在每次迭代中，我们将使用<em class="od">损失函数</em>计算误差，该函数将触发神经元权重的调整，从而触发它们的激活。随着迭代的进行，网络将调整它们的权重以最小化误差，学习解决问题的模式。</p><p id="f2ab" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">为了避免<strong class="ln iu">过拟合</strong>，也就是说模型“<em class="od">记忆</em>训练数据，对新数据表现不佳，我们在每次迭代中随机丢弃一些神经元，这样模型可以更好地泛化。</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="0da5" class="nc kh it nw b gy oo op l oq or">import spacy<br/>import random<br/>import json</span><span id="09f5" class="nc kh it nw b gy os op l oq or">nlp = spacy.blank("en")<br/>ner = nlp.create_pipe("ner")<br/>nlp.add_pipe(ner)<br/>ner.add_label("OIL")</span><span id="855c" class="nc kh it nw b gy os op l oq or"># Start the training<br/>nlp.begin_training()</span><span id="3ba4" class="nc kh it nw b gy os op l oq or"># Loop for 40 iterations<br/>for itn in range(40):<br/>    # Shuffle the training data<br/>    random.shuffle(TRAINING_DATA)<br/>    losses = {}</span><span id="54b4" class="nc kh it nw b gy os op l oq or"># Batch the examples and iterate over them<br/>    for batch in spacy.util.minibatch(TRAINING_DATA, size=2):<br/>        texts = [text for text, entities in batch]<br/>        annotations = [entities for text, entities in batch]</span><span id="c149" class="nc kh it nw b gy os op l oq or"># Update the model<br/>        nlp.update(texts, annotations, losses=losses, drop=0.3)<br/>    print(losses)</span></pre><p id="1a6b" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">随着迭代的进行，您应该会看到误差在减小，请注意，由于dropout设置，有时误差可能会增大。</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="b0b7" class="nc kh it nw b gy oo op l oq or">{'ner': 3.7440482430942508}<br/>{'ner': 2.012700471865181}<br/>{'ner': 2.051291773717853}<br/>{'ner': 0.0007268571710379556}<br/>{'ner': 1.8225483010250167}<br/>{'ner': 0.0028021886504119237}<br/>{'ner': 0.0030751793809788803}<br/>{'ner': 1.851928768298534e-06}</span></pre><p id="e1b9" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">现在您可以将模型保存到磁盘:</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="42ab" class="nc kh it nw b gy oo op l oq or">nlp.to_disk("oil.model")</span></pre><p id="aa1f" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">如果使用Windows，使用:<em class="od">NLP . to _ disk("/oil . model ")</em></p><h2 id="edba" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">测试模型</h2><p id="6496" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">让我们测试模型。为此，我们使用<strong class="ln iu"> <em class="od"> displacy </em> </strong>显示文本中的实体。</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="afc4" class="nc kh it nw b gy oo op l oq or">from spacy import displacy<br/><strong class="nw iu">example</strong> = "service marathon petroleum reduces service postings marathon petroleum co said it reduced the contract price it will pay for all grades of service oil one dlr a barrel effective today the decrease brings marathon s posted price for both west texas intermediate and west texas sour to dlrs a bbl the south louisiana sweet grade of service was reduced to dlrs a bbl the company last changed its service postings on jan reuter"</span></pre><p id="6e48" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">来测试一下吧！</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="08e4" class="nc kh it nw b gy oo op l oq or">doc = nlp(example)<br/>displacy.render(doc, style='ent')</span></pre><p id="bd9d" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">您应该会看到如下输出:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/fd7fc580b1866e01b79fc2f0f80ea6be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4kldXs0IW-GHirprGX4Ceg.png"/></div></div></figure><p id="aa54" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">如您所见，这些实体被正确检测到，包括石油和石油。</p><p id="a5a3" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">NER很酷的一点是，即使文本中有一个<em class="od">错别字</em>，它仍能检测出正确的实体，例如，如果我拼错了petroleum:</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ou"><img src="../Images/ff7b351434c8182e85916196bbfbffa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*Tx4BVhMf5hmOFHGo53TDJg.png"/></div></div></figure><p id="d5bc" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">还是找到匹配的！</p><h2 id="2693" class="nc kh it bd ki nd ne dn km nf ng dp kq lw nh ni ku ma nj nk ky me nl nm lc nn bi translated">短语匹配</h2><p id="4f3b" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">第二种方法是使用<strong class="ln iu">模式匹配</strong>在文本中寻找某些关键字和模式。</p><p id="b349" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu"> Spacy </strong>提供了匹配器，可以很容易地用来查找特定的子字符串、数字等。我们还可以根据词性标签设置规则。</p><p id="fe3c" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这是代码:</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="dd9b" class="nc kh it nw b gy oo op l oq or">import spacy<br/># Import the Matcher<br/>from spacy.matcher import Matcher</span><span id="acc0" class="nc kh it nw b gy os op l oq or">nlp = spacy.load("en_core_web_sm")<br/>doc = nlp(example)</span><span id="a44c" class="nc kh it nw b gy os op l oq or"># Initialize the Matcher with the shared vocabulary<br/>matcher = Matcher(nlp.vocab)</span><span id="4b7f" class="nc kh it nw b gy os op l oq or"># Add the pattern to the matcher<br/>matcher.add("OIL_PATTERN", None, [{"LOWER": "oil"}], [{"LOWER": "petroleum"}])</span><span id="203e" class="nc kh it nw b gy os op l oq or"># Use the matcher on the doc<br/>matches = matcher(doc)<br/>print("Matches:", [doc[start:end].text for match_id, start, end in matches])</span></pre><p id="f4f5" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">你应该会看到印在笔记本上的火柴。</p><pre class="mk ml mm mn gt ok nw ol om aw on bi"><span id="4d80" class="nc kh it nw b gy oo op l oq or">Matches: ['petroleum', 'oil']</span></pre><p id="daf4" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">我们可以看到，我们也找到了正确的标签，但在这种情况下，没有检测到拼写错误或类似的单词。</p><h1 id="8e0c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="2360" class="pw-post-body-paragraph ll lm it ln b lo no lq lr ls np lu lv lw nq ly lz ma nr mc md me ns mg mh mi im bi translated">我们已经看到了用于<strong class="ln iu">实体识别</strong>的不同方法。</p><p id="6295" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu">模式匹配</strong>可用于以下用例:</p><ul class=""><li id="a937" class="mo mp it ln b lo lp ls lt lw mq ma mr me ms mi mt mu mv mw bi translated">低基数属性</li><li id="4166" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">常见模式，如日期、数量、数字等。(正则表达式)</li><li id="a9de" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">出现在演讲的某些部分的模式</li><li id="b5df" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">当不希望出现错别字时</li><li id="8393" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">结构数据</li></ul><p id="73b9" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><strong class="ln iu">统计模型</strong>非常适合学习数据中的复杂模式，可以“猜测”和分类数据，这是以前从未有过的。使用案例:</p><ul class=""><li id="33e3" class="mo mp it ln b lo lp ls lt lw mq ma mr me ms mi mt mu mv mw bi translated">高基数属性</li><li id="c358" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">你需要处理错别字(模糊匹配)</li><li id="24c4" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">你需要对新的、从未见过的数据进行分类。</li><li id="5fb7" class="mo mp it ln b lo mx ls my lw mz ma na me nb mi mt mu mv mw bi translated">非结构化数据</li></ul><p id="5795" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">这些模型更加强大，因为它们可以对以前从未见过的事情做出决策。它可以检测新的实体，而无需任何代码更改。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="0946" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">如你所见，像任何机器学习任务一样，<strong class="ln iu">大部分工作都是准备和标记数据</strong>，这部分不仅耗时而且<strong class="ln iu">关键</strong>。对于自然语言处理来说，正确标记数据并对其进行适当的预处理是获得好结果的最重要的因素。</p><p id="02c5" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">许多组织花费大量资源雇佣人才和构建复杂的模型来改善结果，而不是专注于数据。良好的<strong class="ln iu">数据准备和特征工程</strong>可以比ML算法更快更好地提高模型性能。没有什么比一个<strong class="ln iu">业务分析师</strong>理解<strong class="ln iu">细节</strong>中的数据并了解一点<strong class="ln iu"> Python </strong>更强大的了！</p><p id="094c" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated">由于标记数据会花费很多时间，我推荐使用一些工具，比如<a class="ae kf" href="https://prodi.gy/" rel="noopener ugc nofollow" target="_blank"><strong class="ln iu">Prodigy</strong></a><strong class="ln iu">通过使用ML来半自动标记过程，减少了手工工作量</strong>。</p><p id="675d" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><em class="od">记得来</em> <strong class="ln iu"> <em class="od">拍拍</em> </strong> <em class="od">如果你喜欢这篇文章</em> <a class="ae kf" href="https://javier-ramos.medium.com/subscribe" rel="noopener"> <em class="od"> </em> <strong class="ln iu"> <em class="od">关注</em></strong><em class="od"/><strong class="ln iu"><em class="od">me</em></strong></a><em class="od">或</em> <a class="ae kf" href="https://javier-ramos.medium.com/membership" rel="noopener"> <strong class="ln iu"> <em class="od">订阅</em> </strong> </a> <em class="od">获取更多更新！</em></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="1b4b" class="pw-post-body-paragraph ll lm it ln b lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi im bi translated"><a class="ae kf" href="https://javier-ramos.medium.com/subscribe" rel="noopener"> <strong class="ln iu">订阅</strong> </a>获得<strong class="ln iu">通知</strong>当我发表一篇文章<a class="ae kf" href="https://javier-ramos.medium.com/membership" rel="noopener"> <strong class="ln iu">加入Medium.com</strong></a>访问数百万或文章！</p></div></div>    
</body>
</html>