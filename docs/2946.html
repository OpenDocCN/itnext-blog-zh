<html>
<head>
<title>Profiling JVM Applications remotely using VisualVM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用VisualVM远程分析JVM应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/profiling-jvm-applications-remotely-using-visualvm-c0df9816aabf?source=collection_archive---------0-----------------------#2019-09-04">https://itnext.io/profiling-jvm-applications-remotely-using-visualvm-c0df9816aabf?source=collection_archive---------0-----------------------#2019-09-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="f4ff" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">通过jstatd或JMX在VisualVM和JVM应用程序之间进行通信</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/96e82a8d638c035bd8f1d7177123b237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wwd_YG__LKSbHuc-WwI3zA.png"/></div></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">VisualVM主窗口</figcaption></figure><p id="dba9" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><a class="ae lv" href="https://www.oracle.com/java/" rel="noopener ugc nofollow" target="_blank"> Java平台</a>是历史最悠久、最著名的桌面和服务器应用开发和部署平台之一。这个平台最重要的组件是<a class="ae lv" href="https://en.wikipedia.org/wiki/Java_virtual_machine" rel="noopener ugc nofollow" target="_blank"> Java虚拟机(JVM) </a>，它负责运行<a class="ae lv" href="https://en.wikipedia.org/wiki/Java_bytecode" rel="noopener ugc nofollow" target="_blank"> Java字节码</a>。有几种著名的<a class="ae lv" href="https://en.wikipedia.org/wiki/List_of_JVM_languages" rel="noopener ugc nofollow" target="_blank">编程语言</a>(例如Scala、Kotlin、Clojure、Jython、JRuby和……)编译成<a class="ae lv" href="https://en.wikipedia.org/wiki/Java_bytecode" rel="noopener ugc nofollow" target="_blank"> Java字节码</a>，运行在JVM之上，并使用这个成熟的运行时环境的功能。Java平台被用于许多行业，包括制造业、汽车、保险和公共部门，因此，世界上许多桌面和服务器应用程序都运行在JVM之上。</p><h1 id="673f" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">为什么分析应用程序很重要</h1><p id="b4e6" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">根据<a class="ae lv" href="https://en.wikipedia.org/wiki/Profiling_(computer_programming)" rel="noopener ugc nofollow" target="_blank">维基百科的定义</a>:</p><blockquote class="mt mu mv"><p id="6458" class="kz la mw lb b lc ld jv le lf lg jy lh mx lj lk ll my ln lo lp mz lr ls lt lu in bi translated">在软件工程中，剖析(“程序剖析”、“软件剖析”)是动态程序分析的一种形式，它测量例如程序的空间(存储器)或时间复杂性、特定指令的使用、或函数调用的频率和持续时间。最常见的是，分析信息有助于程序优化。</p></blockquote><p id="bfe3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">分析器帮助我们在运行时甚至在生产中发现诸如内存泄漏、性能问题等问题。通常，我们在开发机器上的开发过程中不会发现这种问题。</p><h1 id="dbe7" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">JVM分析工具</h1><p id="86db" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">有几个很棒的JVM分析器(免费的和商业的)，像<a class="ae lv" href="https://www.ej-technologies.com/products/jprofiler/overview.html" rel="noopener ugc nofollow" target="_blank"> JProfiler </a>、<a class="ae lv" href="https://www.yourkit.com/java/profiler/" rel="noopener ugc nofollow" target="_blank"> YourKit </a>、<a class="ae lv" href="https://visualvm.github.io/index.html" rel="noopener ugc nofollow" target="_blank"> VisualVM </a>和……但是在这篇文章中，我将写关于<a class="ae lv" href="https://visualvm.github.io/index.html" rel="noopener ugc nofollow" target="_blank"> VisualVM </a>。</p><p id="63f5" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">VisualVM是一个简单、强大、免费和官方的JVM应用程序分析工具。从JDK版本6更新7直到JDK版本8的早期更新都与Java开发工具包(JDK)捆绑在一起，但在那之后，它作为一个独立的程序单独发布。通过VisualVM，您可以连接到本地和远程JVM应用程序并监控它们。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj na"><img src="../Images/ef2024901390f0dfde5b2d2471a02384.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*NggnTQW2baJfPDL5O1d9bQ.png"/></div><figcaption class="kv kw gk gi gj kx ky bd b be z dk translated">VisualVM应用程序窗口</figcaption></figure><p id="cf47" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">当你启动VisualVM时，所有的本地JVM应用程序都被默认识别，但对于远程JVM应用程序，你需要通过<a class="ae lv" href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstatd.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iv"> jstatd </strong> </a>或<a class="ae lv" href="https://docs.oracle.com/javase/8/docs/technotes/guides/visualvm/jmx_connections.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iv"> JMX </strong> </a>连接到它们。</p><h1 id="a44d" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">如何使用VisualVM远程分析JVM应用程序</h1><p id="acc3" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">有两种方法可以将远程JVM应用程序连接到VisualVM:或者使用<strong class="lb iv"> jstatd </strong>或者Java管理扩展(<strong class="lb iv"> JMX </strong>)。</p><p id="c4c8" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">jstatd程序是一个RMI服务器，它与JDK捆绑在一起，监控JVM，并提供一个接口，允许远程监控工具连接到在本地主机上运行的JVM。您应该在目标机器上启动<strong class="lb iv"> jstatd </strong>，VisualVM将连接到它以获取关于远程JVM的分析数据。</p><p id="420a" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated"><strong class="lb iv"> JMX </strong>技术可用于监控和管理任何运行在本地或远程JVM上的JVM应用程序。</p><h1 id="f9f3" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">如何在目标机器上运行jstatd服务器</h1><p id="5ce0" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">如果我的机器上没有运行安全管理器，jstatd 服务器需要本地访问权限，并且需要一个用“java.security.policy”系统属性指定的安全策略文件。您应该为JVM创建一个安全策略文件(我称之为tools.policy ),其中包含:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="82f6" class="ng lx iu nc b gz nh ni l nj nk">grant {<br/>  permission java.security.AllPermission;<br/>};</span></pre><p id="27c1" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在，您将能够启动jstatd 程序:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="6258" class="ng lx iu nc b gz nh ni l nj nk">jstatd -p 1089 -J-Djava.security.policy=tools.policy</span></pre><p id="aa16" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">现在<strong class="lb iv"> jstatd </strong>正在运行，并在端口1089等待VisualVM来自远程机器的RMI协议连接。</p><p id="4c0c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">这种方法在监控方面有一些限制，比如没有CPU使用监控，不能运行采样器和进行线程转储。</p><h1 id="a551" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">如何为JMX通信准备目标JVM应用程序</h1><p id="f940" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">VisualVM将自动检测并连接到在JDK版本6上运行的JVM应用程序，或者在版本5.0上使用正确的系统属性启动的JVM应用程序(但是有<a class="ae lv" href="https://docs.oracle.com/javase/6/docs/technotes/guides/visualvm/jmx_connections.html" rel="noopener ugc nofollow" target="_blank">种情况</a>visual VM无法自动发现并连接到JMX代理程序)，然后您只需要使用一些系统属性启动JVM应用程序:</p><pre class="kk kl km kn gu nb nc nd ne aw nf bi"><span id="f18b" class="ng lx iu nc b gz nh ni l nj nk">java -Dcom.sun.management.jmxremote<br/>     -Dcom.sun.management.jmxremote.port=1089 \<br/>     -Dcom.sun.management.jmxremote.ssl=false \<br/>     -Dcom.sun.management.jmxremote.authenticate=false \<br/>     <em class="mw">YourJavaAppAndOtherParams</em></span></pre><p id="73e3" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">在上面的命令中，<em class="mw"/>JVM应用程序<em class="mw"> </em>被启动，并且通过端口1089配置的开箱即用的监控和管理功能以及SSL加密和密码验证被停用。</p><h1 id="eee9" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">使用SSH或VPN保护连接</h1><p id="0247" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">如果您在公共网络中，您应该保护VisualVM和JVM应用程序之间的通信。</p><p id="f96c" class="pw-post-body-paragraph kz la iu lb b lc ld jv le lf lg jy lh li lj lk ll lm ln lo lp lq lr ls lt lu in bi translated">保护环境的最简单方法是使用VPN或安全连接，通过SOCKS代理设置SSH隧道。你可以点击<a class="ae lv" href="https://dzone.com/articles/visualvm-monitoring-remote-jvm" rel="noopener ugc nofollow" target="_blank">这个链接</a>了解更多。</p><h1 id="e8c7" class="lw lx iu bd ly lz ma mb mc md me mf mg ka mh kb mi kd mj ke mk kg ml kh mm mn bi translated">每种方法的优缺点</h1><p id="40ab" class="pw-post-body-paragraph kz la iu lb b lc mo jv le lf mp jy lh li mq lk ll lm mr lo lp lq ms ls lt lu in bi translated">我更喜欢JMX的方法，因为我们不需要在目标机器上运行任何服务器，而且通过使用JMX，我们将发挥VisualVM的全部能力(在监控能力方面没有限制)。</p></div></div>    
</body>
</html>