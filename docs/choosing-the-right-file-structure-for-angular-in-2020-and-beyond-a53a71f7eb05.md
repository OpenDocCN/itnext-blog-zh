# 为 2020 年及以后的 Angular 选择正确的文件结构📕！

> 原文：<https://itnext.io/choosing-the-right-file-structure-for-angular-in-2020-and-beyond-a53a71f7eb05?source=collection_archive---------0----------------------->

![](img/8b127bfbe36e32d6c421417cca394538.png)

马丁·范·登·霍维尔在 [Unsplash](https://unsplash.com/search/photos/structure?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

*与本文相关的代码可在* [*GitHub*](https://github.com/mathisGarberg/angular-ngxs-and-material-starter) *上获得。仍然需要一些补充，但是它遵循这里描述的相同模式。*

2018 年我写过文章 [**如何为你的 Angular 项目**](/choosing-a-highly-scalable-folder-structure-in-angular-d987de65ec7) 定义一个高可扩展的文件夹结构。从那以后，两年过去了，棱角分明的风景发生了一些变化。我们已经看到了 onPush 变更检测、正在添加的 providedIn 装饰器、可导出的指令以及对 Angular 核心框架的其他几个更新，在撰写本文时，我们仍处于版本 9。

Angular 团队的快速发布周期给我们带来了一些很棒的新特性，但这也意味着我们需要自己做一些结构上的改变。鉴于这些变化和原文章中的常见问题，我决定创建一篇新文章，回答所有这些问题。

欢迎为 2020 年及以后的 Angular 选择正确的文件结构！

# 介绍

当在一个有许多开发人员负责相同代码库的大型团队中工作时，对应用程序应该如何构造有一个共同的理解是至关重要的。为架构决策争论所花费的时间占据了我们日常工作的很大一部分，在解决这些问题的过程中，达成共识还有很长的路要走。

本文的目标是通过为大中型应用程序提出一个可伸缩和可维护的结构来帮助那些开发人员。我们将在 Angular 文档的上下文中探索该结构，通过使用他们的声明来进一步强调这里的优势。

*注意！几乎不可能找到适合每一个用例的结构。根据项目的不同，应用程序的结构会有很大的变化，这里没有蓝图。本文旨在通过* ***提出*** *一个应该能很好地为大中型应用程序工作的结构来改进开发过程。*

> 要有近期的实施观和长远的眼光。从小处着手，但要记住应用程序的发展方向。
> 
> 该应用的所有代码都放在一个名为`src`的文件夹中。
> 
> 一定要构建应用程序，这样你可以快速定位代码，一眼就能识别代码，尽可能保持扁平的结构，尽量简洁，但不要以牺牲可读性为代价。
> 
> 请务必给文件命名，以便您可以立即知道它包含和代表什么。
> 
> 尽可能长时间保持扁平的文件夹结构。

Angular CLI 中的`ng new`命令为我们提供了应用程序根级别的初始框架结构，并且易于运行和构建。这种默认行为适用于新的应用程序，并且是结构的完美入口点。您应该使用角度示意图在适当的区域生成文件。

# 应用程序模块

> 一定要在应用程序的根文件夹中创建一个 NgModule，例如在`/src/app`中。

在 Angular 中，一切都被组织在模块中，每个应用程序都至少有一个模块，即应用程序根模块。app 模块是应用的入口点，是 Angular 用来引导应用的模块。创建一个新应用程序时的设置指令产生一个最小的带有单个组件的`AppModule`。随着应用程序的增长，您将会改进这个模块。

# 核心模块

`CoreModule`承担了应用根模块的角色，但不是 Angular 在运行时引导的模块。这里给出的文件的共同点是我们只需要加载它们一次，而且是在运行时，这使得它们是单例的。该模块包含根范围的服务、静态组件，如导航栏和页脚、拦截器、保护、常量、枚举、实用程序和通用模型。为了防止在其他地方重新导入模块，我们应该在它的构造函数方法中添加一个 module-import-guard。

# 共享模块

> 在`shared`文件夹中创建一个名为`SharedModule`的特征模块；比如`app/shared/shared.module.ts`定义了`SharedModule`。
> 
> 当组件、指令和管道将被其他功能模块中声明的组件重用和引用时，请在共享模块中声明这些项目。
> 
> 务必在`SharedModule`中声明所有组件、指令和管道。
> 
> 务必从`SharedModule`中导出其他功能模块需要使用的所有符号。

当处理大型应用程序时，Angular 团队建议我们考虑模块的延迟加载。这减少了我们的应用程序的包大小，从而减少了初始构建时间，这也是 SharedModule 真正闪光的地方。

SharedModule 允许我们组织和简化代码。共享模块不应该依赖于应用程序的其他部分，因此也不应该依赖于任何其他模块。它应该包含所有可重用的模块，操作所需的惰性加载功能模块。您应该在这里添加常用的指令、管道和组件。许多第三方库可以作为 NgModules 获得，例如 [Material Design](https://material.angular.io/) ，通过 SharedModule 公开它们可能是个好主意。

我们可以轻松地在应用程序之间发布和共享这些组件。

# 功能模块

> 一定要为应用程序中所有不同的特性创建一个 NgModule 例如一个`*Heroes*`特征。所有功能区都在它们自己的文件夹中，有它们自己的 NgModule。
> 
> 务必将功能模块放在与功能区域相同的命名文件夹中；比如在`*app/heroes*`里。
> 
> 命名特征模块文件，以反映特征区域和文件夹的名称；例如，`*app/heroes/heroes.module.ts*`。
> 
> 务必命名反映特征区域、文件夹和文件名称的特征模块符号。比如`*app/heroes/heroes.module.ts*`定义了`*HeroesModule*`。

最初的角度应用程序只有一个模块，非常适合小型应用。但是随着应用程序的增长，您需要考虑将其细分为多个功能模块，其中一些可以延迟加载。这些模块应该只依赖于 SharedModule，并且它们的功能应该局限于该模块。

功能模块提供专门针对特定应用程序功能的用户体验，如应用程序的用户或管理部分。我们将属于一起的组件、服务、模型和其他功能进行分组。它们通常有一个作为特征根的顶层组件和从它派生出来的私有支持子组件。它们可能由缺乏路由或需要显示一些初始内容的小型应用程序的根`AppModule`导入，但也可以通过应用程序路由文件中的引用进行惰性加载。

领域特性模块很少有提供者，但是当它们有提供者时，所提供服务的生命周期应该与模块的生命周期相同。从 Angular 6.0 开始，创建单例的首选方式是在服务的`@Injectable`装饰器上将`providedIn`设置为`root`。这告诉 Angular 在应用程序根中提供服务。但是我们也可以用这个

创建一个单体服务就是在服务的`@[Injectable](https://angular.io/api/core/Injectable)()`装饰器上将`[providedIn](https://angular.io/api/core/Injectable#providedIn)`设置为`root`。这告诉 Angular 在应用程序根中提供服务。我们可以通过使用模块上的`providedIn`属性在特性的上下文中使用它，这会导致在其他地方使用它时出错。

当您还需要其他模块中的服务时，它可能属于 CoreModule 服务的声明。

# 风格

与我们如何避免随着应用程序的增长而膨胀`AppModule`类似，对于`styles.scss`文件也是如此。相反，你应该创建一个 styles 文件夹，其中包含 mixins 或 css 函数，负责它们自己的区域。然后，这些文件以适当的顺序导入到 styles.scss 文件中，将它们的全局样式提供给应用程序的其余部分。为可重用的 css 片段创建 mixins，并将相关的逻辑放在一起。

# 资产

assets 文件夹是 Angular CLI 使用`ng new`命令为我们生成的，是存储我们所有媒体文件的最佳位置。将它与 PathLocationStrategy 结合使用，可以在整个应用程序中轻松地提供可引用的文件。该文件夹在构建时保持不变。

# 超越！

尽管上面描述的结构解决了很多问题，我们仍然忽略了一个大的方面，那就是 Angular 中的状态管理。这是因为有很多不同的方法来解决这个问题，并且一个解决方案可能不适用于另一个。 [Angular Material](https://material.angular.io/) 和其他组件库的上下文是另一个将定义应用程序结构的大区域的区域。带有微前端的 Nrwl 的出现也引起了广泛关注。你想看这类文章的某一点，请让我知道。

# 摘要

选择合适的文件夹结构不是一件容易的事情。您需要与团队就适合应用程序的结构达成一致，什么可能适合一个需求，什么可能不适合另一个需求。有望在未来几年继续有效。为了确保一个好的、可维护的结构，你会做什么不同的事情？

我叫 Mathis Garberg，是挪威奥斯陆 [*Dfind 咨询*](https://www.dfindconsulting.no/) *的顾问。生活在挪威，需要一些角度的专业知识？随意伸手！*

你可以看看我的其他角度的文章和/或订阅我更进一步，和/或如果你喜欢这个故事，一个👏总是受到赞赏。