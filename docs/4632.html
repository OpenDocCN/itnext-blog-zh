<html>
<head>
<title>Writing a Kubernetes CLI in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Go中编写Kubernetes CLI</h1>
<blockquote>原文：<a href="https://itnext.io/writing-a-kubernetes-cli-in-go-a3970ad58299?source=collection_archive---------0-----------------------#2020-08-09">https://itnext.io/writing-a-kubernetes-cli-in-go-a3970ad58299?source=collection_archive---------0-----------------------#2020-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2d077b7d8d067318478edcfff3fc83cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcQcpES-BFJrUpq1-ZTLLA.jpeg"/></div></div></figure><p id="c5db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一名部署到Kubernetes的微服务的全职开发人员，我发现自己在调试软件时经常会执行类似的重复动作。有时候，我想在Kubernetes上快速尝试一个新的Docker映像，而不需要编写新的Helm图表，或者通过NodePorts分配一个服务对象，以便连接调试工具，或者手动向Kubernetes资源添加注释，以触发操作员的操作。对于这些用例中的许多，有一些很棒的开源产品，但不是全部。为了提高我的生活质量，我已经开始编写自定义命令行界面(CLI)工具来自动化这些任务。Go和Kubernetes客户端API的结合使得创建新的Kubernetes CLI变得很容易。</p><h2 id="6665" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">使用client-go访问KUBECONFIG</h2><p id="a515" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">一个<a class="ae lu" href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/" rel="noopener ugc nofollow" target="_blank"> kubeconfig </a>文件用于指定关于K8集群、用户、名称空间和认证机制的信息。<code class="fe lv lw lx ly b">kubectl</code>工具使用kubeconfig文件来查找与K8集群的API服务器通信所需的信息。</p><p id="a39c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的定制CLI还需要访问kubeconfig文件，以便与K8集群通信。<a class="ae lu" href="https://github.com/kubernetes/client-go" rel="noopener ugc nofollow" target="_blank"> client-go </a> API使得读取用户的kubeconfig文件变得非常简单。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk translated">GetLocal()读取用户的KUBECONFIG文件并返回K8客户端和REST对象</figcaption></figure><h2 id="54b7" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">查询K8资源对象</h2><p id="dea1" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">现在，我们已经基于用户的kubeconfig文件创建了一个K8客户机对象，我们可以通过查询一个资源对象来测试与K8集群的通信。</p><p id="e354" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查询名称空间中所有服务的列表，请执行以下操作:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="f3b4" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">更新K8资源对象</h2><p id="dd0d" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">一旦我们确认可以通过查询名称空间中的服务来成功地与K8集群通信，我们就可以编写代码来更新现有的K8资源对象。</p><p id="f4c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在下面的代码片段中，函数Update()将现有服务的类型(ClusterIP、NodePort、LoadBalancer、External)更改为参数<em class="mj"> serviceType </em>。它还将原始服务类型保存为注释。函数Revert()将服务类型改回存储在注释中的值。</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><h2 id="843d" class="kw kx iq bd ky kz la dn lb lc ld dp le kj lf lg lh kn li lj lk kr ll lm ln lo bi translated">仅此而已！</h2><p id="e22b" class="pw-post-body-paragraph jy jz iq ka b kb lp kd ke kf lq kh ki kj lr kl km kn ls kp kq kr lt kt ku kv ij bi translated">在为Kubernetes开发微服务时，我一直在寻找提高效率的新方法。请分享一些您用来提高您在云原生环境中的生活质量的技巧和诀窍。</p></div></div>    
</body>
</html>