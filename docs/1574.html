<html>
<head>
<title>Improve test case execution time by using TestAppDelegate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过使用TestAppDelegate改进测试用例执行时间</h1>
<blockquote>原文：<a href="https://itnext.io/improve-test-case-execution-time-by-using-testappdelegate-ad0bebb7e17?source=collection_archive---------1-----------------------#2018-11-27">https://itnext.io/improve-test-case-execution-time-by-using-testappdelegate-ad0bebb7e17?source=collection_archive---------1-----------------------#2018-11-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1f4a5697f12e41fa7063f2d005303f68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HcIGrlPJH2tsROxtdOrZQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">信用:<a class="ae kc" href="https://www.pexels.com" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com</a></figcaption></figure><p id="32c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试应该尽可能的快，任何减慢测试速度的东西都应该被移除。</p><p id="4c92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的应用程序中有超过1K个测试用例。随着测试用例的增加，运行测试的速度变慢了。我和同事们就此进行了讨论，并从讨论中总结出两个词，即<code class="fe lb lc ld le b">Set none to host application</code>或使用<code class="fe lb lc ld le b">TestAppDelegate</code>。我对<code class="fe lb lc ld le b">host application</code>进行了研究，并了解到它是必须进行应用测试的。我们在其他目标中有一个测试，即cocoa touch框架(库)，它不需要主应用程序作为主机来运行测试，它在那里工作得很好。到现在<code class="fe lb lc ld le b">host application</code>点已经明确。</p><p id="fc6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试顺序是这样的:</p><ol class=""><li id="6241" class="lf lg iq kf b kg kh kk kl ko lh ks li kw lj la lk ll lm ln bi translated">启动模拟器</li><li id="be0c" class="lf lg iq kf b kg lo kk lp ko lq ks lr kw ls la lk ll lm ln bi translated">在模拟器中，启动应用程序</li><li id="f992" class="lf lg iq kf b kg lo kk lp ko lq ks lr kw ls la lk ll lm ln bi translated">将测试包注入正在运行的应用程序</li><li id="0b74" class="lf lg iq kf b kg lo kk lp ko lq ks lr kw ls la lk ll lm ln bi translated">运行测试</li></ol><p id="fea0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当测试用例运行时，它调用main.m，main . m调用appDelegate重代码。测试运行时使用<code class="fe lb lc ld le b">TestAppDelegate</code>很好。它应该在我们开始新项目时设置，以避免任何副作用，因为应用程序代理将随着时间的推移而增长。可惜我们现在要用<code class="fe lb lc ld le b">TestAppDelegate</code>了。</p><h1 id="b5dc" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">为什么要用测试<code class="fe lb lc ld le b">AppDelegate</code>？</h1><p id="d8ba" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">当iOS启动一个应用程序时，它需要以下内容之一:</p><ul class=""><li id="db03" class="lf lg iq kf b kg kh kk kl ko lh ks li kw lj la mw ll lm ln bi translated"><code class="fe lb lc ld le b">@UIApplicationMain</code>符号:它应用于一个类，表明它是应用程序委托。</li><li id="4273" class="lf lg iq kf b kg lo kk lp ko lq ks lr kw ls la mw ll lm ln bi translated"><code class="fe lb lc ld le b">UIApplicationMain()</code>函数:在主入口点(通常是<code class="fe lb lc ld le b">main.swift</code>)调用它来创建应用程序对象、应用程序委托并设置事件周期。</li></ul><p id="d611" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，一个iOS项目有一个符号为<code class="fe lb lc ld le b">@UIApplicationMain</code>的类<code class="fe lb lc ld le b">AppDelegate</code>。意味着这个类是你app的入口。</p><p id="67cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，iOS必须找到UI的入口点。我们可以使用两种不同的方式来加载主UI组件:或者是<code class="fe lb lc ld le b">Using Storyboard</code>或者是<code class="fe lb lc ld le b">Load Programmatically</code>。</p><h2 id="bc7b" class="mx lu iq bd lv my mz dn lz na nb dp md ko nc nd mh ks ne nf ml kw ng nh mp ni bi translated">以编程方式加载:</h2><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="41d4" class="mx lu iq bd lv my mz dn lz na nb dp md ko nc nd mh ks ne nf ml kw ng nh mp ni bi translated">创建新的应用入口点(main.m)</h2><p id="654d" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">首先，我们需要一个新的入口点来加载普通或测试<code class="fe lb lc ld le b">AppDelegate</code>，这取决于应用程序是否由单元测试启动。</p><p id="5306" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应用程序的入口点可以是带有符号<code class="fe lb lc ld le b">@UIApplicationMain</code>的<code class="fe lb lc ld le b">AppDelegate</code>或<code class="fe lb lc ld le b">UIApplicationMain()</code>函数。</p><p id="8b21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一步是从AppDelegate.swift中删除<code class="fe lb lc ld le b">@UIApplicationMain</code>注释，创建一个新文件<code class="fe lb lc ld le b">main.swift</code>。在这个文件中，我们必须检查应用程序是否通过单元测试启动:</p><pre class="nj nk nl nm gt np le nq nr aw ns bi"><span id="166c" class="mx lu iq le b gy nt nu l nv nw"><strong class="le ir">let</strong> isRunningTests = NSClassFromString("XCTestCase") != nil</span></pre><p id="e205" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们必须决定加载哪个应用程序委托类:</p><pre class="nj nk nl nm gt np le nq nr aw ns bi"><span id="3bf8" class="mx lu iq le b gy nt nu l nv nw">return isRunningTests ? NSStringFromClass(TestAppDelegate.self) : NSStringFromClass(AppDelegate.self)</span></pre><p id="c821" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代替<code class="fe lb lc ld le b">TestAppDelegate</code> nil也可以是return。</p><pre class="nj nk nl nm gt np le nq nr aw ns bi"><span id="de16" class="mx lu iq le b gy nt nu l nv nw">return isRunningTests ? nil : NSStringFromClass(AppDelegate.self)</span></pre><p id="081b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最终<code class="fe lb lc ld le b">main.swift</code>看起来是这样的:</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><h2 id="9472" class="mx lu iq bd lv my mz dn lz na nb dp md ko nc nd mh ks ne nf ml kw ng nh mp ni bi translated">TestAppDelegate</h2><p id="4192" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我们知道<code class="fe lb lc ld le b">TestAppDelegate</code>只在单元测试之前被调用一次。这意味着您可以在运行单元测试集之前，在您的<code class="fe lb lc ld le b">TestAppDelegate</code>中运行一次测试逻辑。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="4967" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们不需要将视图控制器分配给窗口。</p><p id="f264" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您正在使用任何ui测试或快照框架，需要由带有关键窗口的应用程序托管测试，那么您需要使用下面的测试应用程序委托。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="62f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这个改变之后，所有的测试都在更短的时间内通过了。</p><p id="994d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你在app delegate中使用了核心数据，并且想要初始化，有一篇好文章可以跟随:<a class="ae kc" href="https://marcosantadev.com/fake-appdelegate-unit-testing-swift/" rel="noopener ugc nofollow" target="_blank">https://marcosantadev . com/fake-app delegate-unit-testing-swift/</a></p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><h1 id="350b" class="lt lu iq bd lv lw oe ly lz ma of mc md me og mg mh mi oh mk ml mm oi mo mp mq bi translated">结论</h1><p id="495f" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我们已经将测试的应用启动步骤减少到最低限度。在设置项目时尽早采取这一步骤是有好处的，因为您真正的iOS应用程序代表最终会增长。</p><p id="522f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读文章。</p><p id="1ed3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在以下地址找到我:</p><p id="bc38" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> Linkedin: </strong> <a class="ae kc" href="https://www.linkedin.com/in/aaina-jain/" rel="noopener ugc nofollow" target="_blank">阿艾娜·贾恩</a></p><p id="6804" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">推特:</strong> <a class="ae kc" href="https://twitter.com/__aainajain" rel="noopener ugc nofollow" target="_blank"> __aainajain </a></p></div></div>    
</body>
</html>