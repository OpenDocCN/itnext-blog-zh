<html>
<head>
<title>Inverno Framework Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Inverno框架安全性</h1>
<blockquote>原文：<a href="https://itnext.io/inverno-framework-security-12452c150a67?source=collection_archive---------1-----------------------#2022-08-16">https://itnext.io/inverno-framework-security-12452c150a67?source=collection_archive---------1-----------------------#2022-08-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ba9f98a635a81ea534654610e4dd9732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhKppA0sTtN-HiVn_5O5oQ.png"/></div></div></figure><p id="2ba5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">继TechEmpower最新发布的<a class="ae kw" href="https://www.techempower.com/benchmarks/#section=data-r21&amp;test=composite" rel="noopener ugc nofollow" target="_blank"> Web框架性能指标评测</a>证实了其良好的性能之后，最新发布的<a class="ae kw" href="https://inverno.io" rel="noopener ugc nofollow" target="_blank"> Inverno框架</a>带有一个可扩展的安全API和一组模块，允许保护从独立应用到微服务应用的任何类型的应用。</p><p id="b921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用程序安全是一个复杂的主题，涉及到许多问题，如认证、识别、授权、加密……以及多种技术来防止越来越复杂的攻击。一年来，许多与安全相关的规范已经发布，以解决这些问题，但在保护应用程序时，很容易迷失方向。</p><p id="1a41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简化这项任务，Inverno Framework安全API已经围绕一个明确的安全模型进行了设计。</p><p id="5e91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文旨在向您概述如何在Inverno应用程序中实现安全性，并介绍一些常见功能，如果您需要更深入了解，请参考<a class="ae kw" href="https://inverno.io/docs/release/reference/html/index.html#security" rel="noopener ugc nofollow" target="_blank"> Inverno框架参考文档</a>。</p><h1 id="0fc7" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安全模型</h1><p id="069d" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">Inverno安全模型基于三个主要概念:</p><ul class=""><li id="0891" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated"><strong class="ka ir">认证</strong>包括对应用程序请求的认证。它基本上包括对请求中提供的任何类型的凭证(例如用户名/密码、令牌……)进行认证(而不是请求背后的实际实体)。</li><li id="5d66" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><strong class="ka ir">标识</strong>涵盖了认证请求背后实体的标识。我们可能并不总是拥有标识，因为应用程序不需要它，或者因为身份验证机制不允许获取身份信息(例如OAuth2)。</li><li id="5fa8" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><strong class="ka ir">访问控制</strong>涵盖了基于角色、权限的认证实体对应用程序中受保护服务或资源的访问控制……至于身份识别，访问控制取决于应用程序和认证机制，可能并不总是可用。</li></ul><p id="889b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这三个概念是安全API的基础，实际上是正确保护对应用程序的访问所需要知道的全部内容。</p><h1 id="09a2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安全经理</h1><p id="1a6a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">安全管理器(或Web应用程序的安全拦截器)是主要的安全组件，负责验证凭证，并使用身份信息和访问控制器创建结果安全上下文，然后可以使用访问控制器来保护通过应用程序对服务和资源的访问。</p><p id="2a92" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面展示了如何创建一个能够认证登录凭证(用户名/密码)、解析被认证实体的实际身份的安全管理器和一个基于<a class="ae kw" href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="noopener ugc nofollow" target="_blank">角色的</a>访问控制器:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="a286" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，用户验证器使用用户存储库来解析可信凭证，并使用登录凭证匹配器将它们与所提供的登录凭证进行匹配。用户存储库是一个安全的存储库，用户凭证存储在内存或外部数据存储(例如Redis)中。由此，当应用程序需要身份信息和/或访问控制器时，可以指定身份解析器和/或访问控制器解析器。</p><p id="a1af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如您所见，这种方法非常灵活，允许根据应用来认证不同种类的凭证、解析不同种类的身份和访问控制器。例如，可以更改或组合身份验证器来验证其他类型的凭证或扩展的登录凭证，以便实现双因素身份验证，而不影响身份和访问控制解析器。</p><h1 id="bdfa" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安全上下文</h1><p id="ffbc" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">安全管理器随后可用于认证凭证并获得相应的安全上下文:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d3e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，要进行身份验证的登录凭据是使用用户名和原始密码创建的，但是也可以指定编码密码。然后调用安全管理器来认证凭证并获得安全上下文，因为安全管理器总是完全被动的。</p><p id="f251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，生成的安全上下文可以在失败的身份验证时被拒绝，在指定空凭据时被匿名，或者在成功的身份验证时被身份验证。这允许让应用程序决定在不同的用例中做什么。例如，以下代码显示了处理安全上下文的正确方式:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="423a" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">身份</h1><p id="0834" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果安全管理器能够解决的话，安全上下文可以暴露被认证实体的身份。身份应该在需要身份信息时使用，例如获取电子邮件地址或任何其他关于被认证实体的有用信息:年龄、办公地点、URLs</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="bdea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">实际的身份类型由安全管理器确定，并且可能取决于应用程序和身份验证机制。例如，LDAP目录、简单的用户存储库或开放的ID令牌提供了关于被认证实体的不同信息。</p><h1 id="842d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">访问控制</h1><p id="7cf1" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">安全上下文还可以展示访问控制器，以基于其角色、许可或任何其他访问控制机制来控制被认证实体对受保护服务或资源的访问。</p><p id="d061" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面的安全管理器已经被配置为从认证用户的组中解析基于<a class="ae kw" href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="noopener ugc nofollow" target="_blank">角色的</a>访问控制器。这是可能的，因为用户存储库中的用户可以放在组中，就像LDAP目录中的用户一样。正如您所看到的，对于身份，访问控制器的种类取决于应用程序和可用于解析它的信息。</p><p id="f6ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基于角色的访问控制器用于确定经过身份验证的用户是否具有特定角色、一组角色中的任何或所有角色:</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="1262" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，我们试图确定被验证的实体是否具有角色<code class="fe mu mv mw mx b">admin</code>，当没有访问控制器可用时，该角色总是<code class="fe mu mv mw mx b">false</code>。</p><p id="73d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安全模块还提供基于权限的访问控制，它支持参数化的权限，并通过考虑功能上下文来允许对访问的精确控制。例如，可以确定是否授予了访问特定类型资源的许可。</p><figure class="mo mp mq mr gt jr"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="54c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的代码中，基于权限的访问控制器用于确定被认证的实体是否对<code class="fe mu mv mw mx b">article</code>文档拥有权限<code class="fe mu mv mw mx b">create</code>。请注意，如果缺少访问控制器，则会引发异常。</p><h1 id="7874" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="9d3e" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">本文中描述的概念是Inverno应用程序安全性的基础，该安全性始终基于安全管理器中包含的身份验证、标识和访问控制，以便对凭据进行身份验证，并生成实际用于保护服务和资源的应用程序安全上下文。</p><p id="d1ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安全模块提供各种实现和更具体的功能来帮助您保护独立应用程序和Web应用程序。可用特性列表相当完整，允许在应用程序中正确实现安全性，包括:</p><ul class=""><li id="c37a" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">根据用户存储库(内存中，Redis)进行身份验证和识别</li><li id="c6c9" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">基于令牌的认证</li><li id="8f47" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">使用消息摘要的安全密码编码，<a class="ae kw" href="https://en.wikipedia.org/wiki/Argon2" rel="noopener ugc nofollow" target="_blank"> Argon2 </a>，<a class="ae kw" href="https://en.wikipedia.org/wiki/PBKDF2" rel="noopener ugc nofollow" target="_blank"> PBKDF2 </a>，<a class="ae kw" href="https://en.wikipedia.org/wiki/Bcrypt" rel="noopener ugc nofollow" target="_blank"> BCrypt </a>，<a class="ae kw" href="https://en.wikipedia.org/wiki/Scrypt" rel="noopener ugc nofollow" target="_blank"> SCrypt </a></li><li id="6c0b" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><a class="ae kw" href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="noopener ugc nofollow" target="_blank">基于角色的访问控制</a></li><li id="bbc3" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">基于权限的访问控制</li><li id="add6" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">JSON对象签名和加密支持(RFC7515、RFC7516、RFC7517、RFC7518、RFC7519、RFC7638、RFC7797、RFC8037、RFC8812)</li><li id="d780" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">针对LDAP和活动目录的身份验证和识别</li><li id="00ec" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">HTTP基本(RFC7617)和摘要(RFC7616)身份验证</li><li id="b4ca" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">基于表单的身份验证</li><li id="e614" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">跨产地资源共享支持(<a class="ae kw" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="noopener ugc nofollow" target="_blank"> CORS </a>)</li><li id="5dea" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">抵御跨站点请求伪造攻击(<a class="ae kw" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="noopener ugc nofollow" target="_blank"> CSRF </a>)</li></ul><p id="039e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一份完整的<a class="ae kw" href="https://inverno.io/docs/release/reference/html/index.html#security" rel="noopener ugc nofollow" target="_blank">文档</a>和几份<a class="ae kw" href="https://inverno.io" rel="noopener ugc nofollow" target="_blank">用户指南</a>也可以在获得Inverno应用的过程中帮助你。</p></div></div>    
</body>
</html>