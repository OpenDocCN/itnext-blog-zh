<html>
<head>
<title>Guide — The Multi CRA Lerna Monorepo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">指南——多CRA勒纳Monorepo</h1>
<blockquote>原文：<a href="https://itnext.io/guide-react-app-monorepo-with-lerna-d932afb2e875?source=collection_archive---------0-----------------------#2018-10-27">https://itnext.io/guide-react-app-monorepo-with-lerna-d932afb2e875?source=collection_archive---------0-----------------------#2018-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="ed56" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">在本指南中，您将通过一本故事书了解如何构建Monorepo来管理多个共享通用组件的Create React应用程序。</p></blockquote><h1 id="fa9b" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">更新时间:2019/07/17</h1><p id="6224" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">请使用<a class="ae lv" href="https://github.com/react-workspaces/react-workspaces-playground" rel="noopener ugc nofollow" target="_blank"> <em class="js"> React Workspaces游乐场</em> </a>，而不是本指南。<strong class="jt ir">React work spaces Playground</strong>是一个受支持的代码库，在这里您可以使用React和Storybook的最新版本来测试本指南中的所有内容。本指南演示了如何通过猴子补丁实现类似的效果——这是一种很难维持的糟糕做法。请查看我的<a class="ae lv" href="https://slides.com/alistairmacdonald-f1lt3r/react-workspaces/#/" rel="noopener ugc nofollow" target="_blank"> <em class="js"> React Workspaces幻灯片</em> </a>了解更多信息。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/a96bc5781ff1af4f4c4c0489d5785376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cAes7cqi18fyEiSPoG2Dg.jpeg"/></div></div></figure><p id="2b32" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">特色:</strong></p><ul class=""><li id="533f" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">🎸<a class="ae lv" href="https://www.npmjs.com/package/babel-loader-lerna-cra" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">Babel-Loader-Lerna-CRA</strong></a>—自动传输，热重装Lerna模块！</li><li id="1bca" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">🐉<a class="ae lv" href="https://lernajs.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir">莱纳</strong></a>——单一回购经理人</li><li id="146e" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">⚛️️ <a class="ae lv" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir">创建-反应-app-2</strong></a>-反应16 App脚手架(未注射)</li><li id="5afe" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">📖<a class="ae lv" href="https://github.com/storybooks/storybook/tree/master/app/react" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir">故事书-4-反应</strong> </a> <strong class="jt ir"> </strong> —组件故事书</li><li id="a608" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">🃏 <a class="ae lv" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt ir"> Jest </strong> </a> —单元/快照测试</li></ul><h1 id="80dc" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">TL；博士-给我密码！</h1><blockquote class="nd"><p id="fabe" class="ne nf iq bd ng nh ni nj nk nl nm ko dk translated">好…<a class="ae lv" href="https://github.com/F1LT3R/monorepo-react" rel="noopener ugc nofollow" target="_blank">f1lt3r/monorepo-react</a>。</p></blockquote><blockquote class="jn jo jp"><p id="42b1" class="jq jr js jt b ju nn jw jx jy no ka kb kc np ke kf kg nq ki kj kk nr km kn ko ij bi translated"><strong class="jt ir"> ⚠️的重要步骤</strong></p><p id="1d1a" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">如果您在不使用本指南的情况下签出代码进行测试，请记住遵循以下重要步骤:</p><p id="e784" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">1.<code class="fe ns nt nu nv b">lerna booststrap</code> <br/> 2。<code class="fe ns nt nu nv b">npx babel-loader-lerna-cra</code></p></blockquote><h1 id="b8e4" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">Monorepos的案例</h1><p id="1b11" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">想象一个场景，您正在构建一套三个React应用程序，它们共享相同的架构、设计模式、组件和风格。现在想象一下，对一个低级组件进行更新，比如一个在所有三个应用程序中使用的按钮，以及一个子组件。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nw"><img src="../Images/d93c9b752cb776ba5ca426a7d765c065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9YpTKzsnkyYaVcl4.png"/></div></div></figure><p id="d101" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">在这种情况下，您将被迫进入这样一个过程:</p><ol class=""><li id="0ac7" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko nx mv mw mx bi translated">更新按钮的git存储库中的按钮代码。<br/> <em class="js">(上图中的组件B)</em></li><li id="c6a0" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在组件B repo中创建第一个拉式请求<em class="js"> (#1) </em>，并在master中检查新代码。</li><li id="c17f" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在公共或私人NPM服务上发布组件B的按钮代码。</li><li id="e934" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">进入使用按钮的React repo并更新package.json依赖项。</li><li id="e459" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在组件C repo中创建第二个Pull请求<em class="js"> (#2) </em>，并将新代码提交给master。</li><li id="e9fd" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">将组件发布到NPM仓库。</li></ol><p id="100f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">进入</strong>进入<code class="fe ns nt nu nv b"><strong class="jt ir">React App #1</strong></code></p><ol class=""><li id="ac32" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko nx mv mw mx bi translated">更新依赖关系。</li><li id="6bae" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在npm服务上重新发布包。</li><li id="8f4d" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">提交新的PR。<em class="js"> (#3) </em></li><li id="a53e" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">部署</li></ol><p id="e1c4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">进入</strong>进入<code class="fe ns nt nu nv b"><strong class="jt ir">React App #2</strong></code></p><ol class=""><li id="8881" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko nx mv mw mx bi translated">更新依赖关系。</li><li id="4a2d" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在npm服务上重新发布包。</li><li id="5ddb" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">提交新的PR。<em class="js"> (#4) </em></li><li id="0e15" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">部署</li></ol><p id="0695" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">走进</strong>T2】</p><ol class=""><li id="94c0" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko nx mv mw mx bi translated">更新依赖关系。</li><li id="6e15" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在npm服务上重新发布包。</li><li id="a0c4" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">提交新的PR。<em class="js"> (#5) </em></li><li id="f80d" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">部署</li></ol><p id="cb35" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">这是对一个按钮组件的变更的五个拉请求！</p><p id="642c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">显然，这并不理想。</p><h2 id="e148" class="ny kq iq bd kr nz oa dn kv ob oc dp kz lp od oe ld lr of og lh lt oh oi ll oj bi translated">更简单的解决方案</h2><p id="d289" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">现在，想象一下使用单个回购进行相同的更新。如果我们使用像<a class="ae lv" href="https://lernajs.io/" rel="noopener ugc nofollow" target="_blank"> Lerna </a>这样的Monorepo工具，更新过程将看起来更像这样:</p><ol class=""><li id="40b6" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko nx mv mw mx bi translated">更新按钮的git目录中的按钮代码。(<code class="fe ns nt nu nv b">Component #B</code>如上图)</li><li id="8db2" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">运行<code class="fe ns nt nu nv b">lerna bootstrap</code>将按钮<code class="fe ns nt nu nv b">Component #B</code>链接到所有的子依赖项中。</li><li id="d22a" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">运行<code class="fe ns nt nu nv b">lerna publish</code>更新你的私人NPM服务中的包。</li><li id="431a" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">在<code class="fe ns nt nu nv b">Monorepo</code> repo中创建一个Pull请求，并将新代码放入<code class="fe ns nt nu nv b">master</code>。</li><li id="d67d" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko nx mv mw mx bi translated">使用更新的<code class="fe ns nt nu nv b">package.json</code>版本号重新部署应用程序。</li></ol><p id="7f0b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在一切都在一个拉请求中完成。</p><p id="3947" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">这就是为什么像脸书和谷歌这样的大型组织会很好地利用Monorepos。此流程可以简化为对所有依赖项和应用程序使用一个共享存储库。Monorepo在不损失工程速度的情况下扩大规模，并减少因切换上下文焦点而造成的人为错误。</p><p id="97e7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">下面的指南将向您展示如何为React项目设置这样的Monorepo。</p><h1 id="da3a" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">先决条件</h1><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="4a9d" class="ny kq iq nv b gy oo op l oq or">$ npm i -g lerna</span><span id="57b6" class="ny kq iq nv b gy os op l oq or">$ npm i -g create-react-app</span></pre><p id="a2e7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">为Monorepo项目创建一个目录。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="add5" class="ny kq iq nv b gy oo op l oq or">$ cd ~/repos<br/>$ mkdir monorepo-react<br/>$ cd monorepo-react</span></pre><h1 id="3d5d" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">设置Lerna</h1><p id="ebe9" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">创建并初始化您的Lerna monorepo:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="f4ea" class="ny kq iq nv b gy oo op l oq or">$ lerna init</span></pre><p id="0def" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的<code class="fe ns nt nu nv b">package.json</code>现在应该是这样的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="4b5f" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "root",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "lerna": "^3.4.3"<br/>  }<br/>}</span></pre><h1 id="c280" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">安装通用依赖项</h1><p id="235f" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">安装这些通用依赖项将允许您:</p><ul class=""><li id="dea5" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">对项目的根目录运行Storybook。</li><li id="196e" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">让Storybook为您的React项目自动安装正确的模块。</li><li id="b3f2" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">有巴别塔transpile正确的代码，测试和故事书。</li></ul><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="602a" class="ny kq iq nv b gy oo op l oq or">$ npm i -D react react-dom @babel/core@^7.0.0-0 @babel/cli babel-plugin-transform-es2015-modules-commonjs babel-jest enzyme enzyme-adapter-react-16 jest react-test-renderer babel-core@7.0.0-bridge.0 @babel/preset-env @babel/preset-react</span></pre><p id="d97a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的<code class="fe ns nt nu nv b">package.json</code>现在应该是这样的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="f702" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "root",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "@babel/cli": "^7.1.2",<br/>    "@babel/core": "^7.1.2",<br/>    "@babel/preset-env": "^7.1.0",<br/>    "@babel/preset-react": "^7.0.0",<br/>    "babel-core": "^7.0.0-bridge.0",<br/>    "babel-jest": "^23.6.0",<br/>    "babel-plugin-transform-es2015-modules-commonjs": "^6.26.2",<br/>    "enzyme": "^3.7.0",<br/>    "enzyme-adapter-react-16": "^1.6.0",<br/>    "jest": "^23.6.0",<br/>    "lerna": "^3.4.3",<br/>    "react": "^16.6.0",<br/>    "react-dom": "^16.6.0",<br/>    "react-test-renderer": "^16.6.0"<br/>  }<br/>}</span></pre><h1 id="b5e5" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">安装故事书React</h1><p id="22ca" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">现在我们将安装和初始化故事书版本4。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="c6f1" class="ny kq iq nv b gy oo op l oq or">$ npx -p @storybook/cli@alpha sb init</span></pre><p id="a831" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">注意:安装<code class="fe ns nt nu nv b">@alpha</code>版本(目前是<code class="fe ns nt nu nv b">@4.0.0-rc.6</code>，将允许我们在<code class="fe ns nt nu nv b">package.json</code>文件中设置我们的巴别塔配置，这将使配置子包更加容易。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ot"><img src="../Images/459ed0556737a2c90e4b4508f4280e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vU4LFFFkkAyxtZwy.png"/></div></div></figure><p id="7c07" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的根<code class="fe ns nt nu nv b">package.json</code>文件现在应该看起来像这样:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="7c64" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "root",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "@babel/cli": "^7.1.2",<br/>    "@babel/core": "^7.1.2",<br/>    "@babel/preset-env": "^7.1.0",<br/>    "@babel/preset-react": "^7.0.0",<br/>    "babel-core": "^7.0.0-bridge.0",<br/>    "babel-jest": "^23.6.0",<br/>    "babel-plugin-transform-es2015-modules-commonjs": "^6.26.2",<br/>    "enzyme": "^3.7.0",<br/>    "enzyme-adapter-react-16": "^1.6.0",<br/>    "jest": "^23.6.0",<br/>    "lerna": "^3.4.3",<br/>    "react": "^16.6.0",<br/>    "react-dom": "^16.6.0",<br/>    "react-test-renderer": "^16.6.0",<br/>    "@storybook/react": "^4.0.0-alpha.25",<br/>    "@storybook/addon-actions": "^4.0.0-alpha.25",<br/>    "@storybook/addon-links": "^4.0.0-alpha.25",<br/>    "@storybook/addons": "^4.0.0-alpha.25",<br/>    "babel-loader": "^8.0.4"<br/>  },<br/>  "dependencies": {},<br/>  "scripts": {<br/>    "storybook": "start-storybook -p 6006",<br/>    "build-storybook": "build-storybook"<br/>  }<br/>}</span></pre><p id="40d0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在你可以测试故事书在你的机器上运行了。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="32a2" class="ny kq iq nv b gy oo op l oq or">$ npm run storybook</span></pre><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ou"><img src="../Images/cf73e5bd94a3b891aedc0af5fad880b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OrtP4EHME7vVC1M-.png"/></div></div></figure><p id="3720" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">故事书现在应该会在你的浏览器中自动启动。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ov"><img src="../Images/52f9b66f6d32e0f1b938d943b942e73f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jGmSlE2Gqtu28-cu.png"/></div></div></figure><p id="af58" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">列出故事书文件:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="763d" class="ny kq iq nv b gy oo op l oq or">$ tree -C .storybook stories</span></pre><ul class=""><li id="fc4f" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">你的<code class="fe ns nt nu nv b">.storybook/</code>目录包含你的故事书配置。</li><li id="f00b" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">你的<code class="fe ns nt nu nv b">stories/</code>目录是你的全球故事书故事生活的地方。</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ow"><img src="../Images/ee0550889c256e7787388ea41394f829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VJLSoFna5Stl2aBh.png"/></div></div></figure><blockquote class="jn jo jp"><p id="7c2e" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">注意:安装树:[ <code class="fe ns nt nu nv b">brew</code> / <code class="fe ns nt nu nv b">apt-get</code> / <code class="fe ns nt nu nv b">yum</code> / <code class="fe ns nt nu nv b">pkg</code> ] <code class="fe ns nt nu nv b">install tree</code></p></blockquote><h1 id="e23f" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">创建您的React应用程序</h1><p id="f471" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">在<code class="fe ns nt nu nv b">packages/my-react-app</code>为你的React应用创建一个家。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="9ec5" class="ny kq iq nv b gy oo op l oq or">$ cd ~/repos/monorepo-react/packages/<br/>$ create-react-app my-react-app</span></pre><p id="bc7d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">运行您的React应用程序来测试工作情况。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="0b15" class="ny kq iq nv b gy oo op l oq or">$ cd my-react-app<br/>$ npm run start</span></pre><p id="87d4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您现在应该会看到一条关于Webpack的错误消息，如下所示:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ou"><img src="../Images/8483dca33af6fc68553fce76eddb9dc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bPIo_OLRMAfFXAgr.png"/></div></div></figure><p id="2e32" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">按照建议，我们将通过在<code class="fe ns nt nu nv b">.env</code>文件中设置<code class="fe ns nt nu nv b">SKIP_PREFLIGHT_CHECK=true</code>来解决这个问题。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="744d" class="ny kq iq nv b gy oo op l oq or">echo "SKIP_PREFLIGHT_CHECK=true" &gt; .env</span></pre><p id="907a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在，您应该能够运行React应用程序，并且您的浏览器应该会自动启动。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="04fa" class="ny kq iq nv b gy oo op l oq or">$ npm run start</span></pre><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ov"><img src="../Images/f46b12c3a0f6fcd62c21fc6e2769b988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W2sYsQZBgK3QFdfl.png"/></div></div></figure><h2 id="c7c9" class="ny kq iq bd kr nz oa dn kv ob oc dp kz lp od oe ld lr of og lh lt oh oi ll oj bi translated">创建外部反应组件</h2><p id="dae3" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">让我们创建第一个外部React组件。我们将在Lerna提供的<code class="fe ns nt nu nv b">./packages</code>目录中完成这项工作。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="ca37" class="ny kq iq nv b gy oo op l oq or">$ cd ~/repos/monorepo-react/packages/<br/>$ mkdir comp-button<br/>$ cd comp-button</span></pre><p id="f4ef" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">像这样创建一个<code class="fe ns nt nu nv b">packages/comp-button/package.json</code>文件:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="95fe" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "@project/comp-button",<br/>  "version": "0.1.0",<br/>  "description": "A simple button component",<br/>  "main": "dist/index.js",<br/>  "module": "src/index.js",<br/>  "scripts": {<br/>    "transpile": "babel src -d dist --ignore '**/*.spec.js,**/*.stories.js'",<br/>    "jest": "jest --coverage --verbose --color"<br/>  },<br/>  "babel": {<br/>    "presets": [<br/>      "@babel/preset-env",<br/>      "@babel/preset-react"<br/>    ],<br/>    "env": {<br/>      "test": {<br/>        "plugins": [<br/>          "transform-es2015-modules-commonjs"<br/>        ]<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="960a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><code class="fe ns nt nu nv b">package.json</code>文件中发生了什么:</p><ul class=""><li id="cf10" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b">name</code>:通过NPM或交叉链接Lerna安装时，组件的组织名称空间。</li><li id="1b9e" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b">main</code>:编译好的代码将会和你的React应用一起发布。</li><li id="7d52" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b">module</code>:开发应用或运行测试时，将作为本地运行时依赖项导入的预编译代码。</li><li id="e11a" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">一个NPM脚本用巴别塔开始你的代码的转换。<strong class="jt ir">注意:</strong>我们没有使用<code class="fe ns nt nu nv b">build</code>，因为我们想保留这个词，以后用<code class="fe ns nt nu nv b">lerna run build</code>来构建我们的React应用。</li><li id="3b34" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b">babel</code>:这个设置将我们的组件配置为用Babel 7 for React。</li></ul><blockquote class="jn jo jp"><p id="506b" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">注意:因为我们在根目录<code class="fe ns nt nu nv b">package.json</code>中安装了<code class="fe ns nt nu nv b">react</code>、<code class="fe ns nt nu nv b">react-dom</code>、<code class="fe ns nt nu nv b">@babel/core@^7.0.0-0</code>这样的组件，所以我们不需要在这个包中再次安装它们。</p></blockquote><p id="55d9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">为React组件创建一个源目录。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="99f7" class="ny kq iq nv b gy oo op l oq or">$ mkdir src<br/>$ cd src</span></pre><p id="1861" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">在<code class="fe ns nt nu nv b">packages/comp-button/index.js</code>中创建React组件:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="548c" class="ny kq iq nv b gy oo op l oq or">import React from 'react'<br/><br/>const Button = ({ type = 'button', children, onClick }) =&gt; (<br/>    &lt;div&gt;<br/>      &lt;button type={type} className="button" onClick={onClick}&gt;<br/>        {children}<br/>      &lt;/button&gt;<br/>  &lt;/div&gt;<br/>)<br/><br/>export default Button</span></pre><h2 id="970e" class="ny kq iq bd kr nz oa dn kv ob oc dp kz lp od oe ld lr of og lh lt oh oi ll oj bi translated">传输您的组件</h2><p id="3fcd" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">现在让我们尝试将您的React代码转换到ECMAScript 2015(支持旧浏览器的JavaScript)。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="6473" class="ny kq iq nv b gy oo op l oq or">$ lerna run transpile</span></pre><p id="e9ec" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您应该会看到以下输出:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ow"><img src="../Images/43c5ba48ff81434cb3ceef67486412da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a8l8Lw0nB0s2oHhc.png"/></div></div></figure><p id="d37c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的<code class="fe ns nt nu nv b">./dist/</code>目录现在应该包含传输的<code class="fe ns nt nu nv b">index.js</code>文件:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="e823" class="ny kq iq nv b gy oo op l oq or">$ tree -C ../dist</span></pre><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ox"><img src="../Images/b733fa5d8010cfe8404baefafe5424fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NB4rnIte-bmibOK4.png"/></div></div></figure><p id="bb54" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><code class="fe ns nt nu nv b">./dist/index.js</code>文件应该包含你的编译代码，就像这样:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="9ac6" class="ny kq iq nv b gy oo op l oq or">"use strict";<br/><br/>Object.defineProperty(exports, "__esModule", {<br/>  value: true<br/>});<br/>exports.default = void 0;<br/><br/>var _react = _interopRequireDefault(require("react"));<br/><br/>function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }<br/><br/>var Button = function Button(_ref) {<br/>  var _ref$type = _ref.type,<br/>      type = _ref$type === void 0 ? 'button' : _ref$type,<br/>      children = _ref.children,<br/>      onClick = _ref.onClick;<br/>  return _react.default.createElement("div", null, _react.default.createElement("button", {<br/>    type: type,<br/>    className: "button",<br/>    onClick: onClick<br/>  }, children));<br/>};<br/><br/>var _default = Button;<br/>exports.default = _default;</span></pre><h2 id="1e6f" class="ny kq iq bd kr nz oa dn kv ob oc dp kz lp od oe ld lr of og lh lt oh oi ll oj bi translated">测试您的组件</h2><p id="cfb0" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">现在，让我们在<code class="fe ns nt nu nv b">packages/comp-button/src/index.spec.js</code>中为您的组件创建一个Jest规范:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="f291" class="ny kq iq nv b gy oo op l oq or">import React from 'react';<br/>import {mount} from 'enzyme';<br/>import Button from '.';<br/><br/>describe('Button Component', function() {<br/>  it('renders without props', function() {<br/>    const wrapper = mount(&lt;Button /&gt;);<br/>    const button = wrapper.find('.button');<br/>    expect(button.length).toBe(1);<br/>  })<br/><br/>  it('renders without props', function() {<br/>    const wrapper = mount(&lt;Button /&gt;);<br/>    const button = wrapper.find('.button');<br/>    expect(button.length).toBe(1);<br/>  })<br/><br/>  it('renders children when passed in', () =&gt; {<br/>    const wrapper = mount(<br/>      &lt;Button&gt;<br/>        &lt;p className="child"&gt;Some Child&lt;/p&gt;<br/>      &lt;/Button&gt;<br/>    );<br/><br/>    const child = wrapper.find('.child')<br/>    expect(child.length).toBe(1)<br/>  })<br/><br/>  it('handles onClick events', () =&gt; {<br/>    const onClick = jest.fn()<br/>    const wrapper = mount(<br/>      &lt;Button onClick={onClick} /&gt;<br/>    )<br/><br/>    wrapper.find('button').simulate('click')<br/><br/>    expect(onClick.mock.calls.length).toBe(1)<br/>  })<br/>})</span></pre><blockquote class="jn jo jp"><p id="e098" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">注:我们之前安装了<code class="fe ns nt nu nv b">babel-core@7.0.0-bridge.0</code>和<code class="fe ns nt nu nv b">babel-jest</code>是为了让Babel 7代码兼容Jest。(请参见上面的“安装通用依赖项”)。)</p></blockquote><p id="e23c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">将下面的“jest”部分添加到您的根目录<code class="fe ns nt nu nv b">package.json</code>:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="84df" class="ny kq iq nv b gy oo op l oq or">"jest": {<br/>    "setupFiles": [<br/>      "../../setupTests"<br/>    ]<br/>  }</span></pre><p id="3f90" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的<code class="fe ns nt nu nv b">packages/comp-button/package.json</code>现在应该是这样的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="a51b" class="ny kq iq nv b gy oo op l oq or">{<br/>    "name": "@my-project/comp-button",<br/>    "version": "0.1.0",<br/>    "description": "A simple button component",<br/>    "main": "dist/index.js",<br/>    "module": "src/index.js",<br/>    "scripts": {<br/>    "transpile": "babel src -d dist --ignore '**/*.spec.js,**/*.stories.js'",<br/>      "jest": "jest --coverage --verbose --color"<br/>    },<br/>    "babel": {<br/>      "presets": [<br/>        "@babel/preset-env",<br/>        "@babel/preset-react"<br/>      ],<br/>      "env": {<br/>        "test": {<br/>          "plugins": [<br/>            "transform-es2015-modules-commonjs"<br/>          ]<br/>        }<br/>      }<br/>    },<br/>    "jest": {<br/>      "setupFiles": [<br/>        "../../setupTests"<br/>      ]<br/>    }<br/>  }</span></pre><p id="80bf" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">当Jest运行时，<code class="fe ns nt nu nv b">../../setupTests</code>文件将引用Monorepo根中的<code class="fe ns nt nu nv b">setupTests.js</code>。</p><p id="dc5c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">让我们用一些酶助手添加这个<code class="fe ns nt nu nv b">setupTests.js</code>文件:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="81d5" class="ny kq iq nv b gy oo op l oq or">const enzyme = require('enzyme');<br/>const Adapter = require('enzyme-adapter-react-16');<br/>enzyme.configure({ adapter: new Adapter() });</span></pre><blockquote class="jn jo jp"><p id="a2ad" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">注意:我们故意在这里使用旧的require语法，这样<code class="fe ns nt nu nv b">setupTests.js</code>就可以加载，而不需要额外的babel配置。</p></blockquote><p id="f90e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在让我们运行Jest来看看这个规范是如何工作的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="0afe" class="ny kq iq nv b gy oo op l oq or">lerna run jest</span></pre><blockquote class="jn jo jp"><p id="1dec" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">注意:我们使用<code class="fe ns nt nu nv b">jest</code>而不是<code class="fe ns nt nu nv b">test</code>来保留“测试”一词用于运行所有测试，包括端到端、林挺等。</p></blockquote><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ow"><img src="../Images/eb003fcbb26aeefedf081ad1ce384179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4dgq--mIK_qSo7vy.png"/></div></div></figure><h1 id="ac06" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">为React组件添加一个故事</h1><p id="32db" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">现在让我们为新的按钮组件创建一个故事书故事:</p><p id="b0f3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">将以下代码添加到<code class="fe ns nt nu nv b">index.stories.js</code>:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="6d66" class="ny kq iq nv b gy oo op l oq or">import React from 'react'<br/>import { storiesOf } from '@storybook/react'<br/>import { action } from '@storybook/addon-actions'<br/><br/>import Button from '.'<br/><br/>storiesOf('Button', module)<br/><br/>  .add('with text', () =&gt; (<br/>      &lt;Button onClick={action('clicked')}&gt;Button&lt;/Button&gt;<br/>  ))<br/><br/>  .add('with some emoji', () =&gt; (<br/>      &lt;Button onClick={action('clicked')}&gt;😀 😎 👍 💯&lt;/Button&gt;<br/>  ))<br/><br/>  .add('with a theme provider', () =&gt; (<br/>    &lt;Button onClick={action('clicked')}&gt;Button&lt;/Button&gt;<br/>  ))</span></pre><p id="7f8a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">重新配置故事书</strong></p><p id="71b5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">我们现在需要配置Storybook从所有的<code class="fe ns nt nu nv b">packages/**</code>目录加载故事，而不是从你的Monorepo根目录加载<code class="fe ns nt nu nv b">stories/</code>目录。</p><p id="5208" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">在<code class="fe ns nt nu nv b">~/repos/monorepo-react/.storybook/config.js</code>中编辑你故事书配置，看起来像这样:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="6bd1" class="ny kq iq nv b gy oo op l oq or">import { configure } from '@storybook/react';<br/><br/>// automatically import all files ending in *.stories.js<br/>const req = require.context('../packages', true, /.stories.js$/);<br/>function loadStories() {<br/>  req.keys().forEach(filename =&gt; req(filename));<br/>}<br/><br/>configure(loadStories, module);</span></pre><p id="e4d0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在可以安全地删除Monorepo根目录下的<code class="fe ns nt nu nv b">stories/</code>目录了。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="06a8" class="ny kq iq nv b gy oo op l oq or">$ cd ~/repos/monorepo-react/<br/>$ sudo rm -r stories</span></pre><p id="39f3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">让我们检查一下故事书是否仍然载入了你的<code class="fe ns nt nu nv b">comp-button</code>故事:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="22bf" class="ny kq iq nv b gy oo op l oq or">$ npm run storybook</span></pre><p id="4836" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在您应该能够看到您的按钮组件故事，它是从您的<code class="fe ns nt nu nv b">packages/comp-button</code>目录构建的:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ov"><img src="../Images/f9e5a7feb079f498d723493640cab3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rv9NRowSpiUg-yoG.png"/></div></div></figure><h1 id="3e7c" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">用Lerna交联你的依赖关系</h1><p id="004e" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">将以下依赖项添加到您的<code class="fe ns nt nu nv b">packages/my-react-app/package.json</code>:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="f7d6" class="ny kq iq nv b gy oo op l oq or">{<br/>  "dependencies": {<br/>    "@my-project/comp-button": "*"<br/>  }<br/>}</span></pre><p id="71b3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">你的<code class="fe ns nt nu nv b">packages/my-react-app/package.json</code>现在应该是这样的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="439f" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "@my-project/my-react-app",<br/>  "version": "0.1.0",<br/>  "private": true,<br/>  "dependencies": {<br/>    "react": "^16.6.0",<br/>    "react-dom": "^16.6.0",<br/>    "react-scripts": "2.0.5",<br/>    "@my-project/comp-button": "*"<br/>  },<br/>  "scripts": {<br/>    "start": "react-scripts start",<br/>    "build": "react-scripts build",<br/>    "test": "react-scripts test",<br/>    "eject": "react-scripts eject"<br/>  },<br/>  "eslintConfig": {<br/>    "extends": "react-app"<br/>  },<br/>  "browserslist": [<br/>    "&gt;0.2%",<br/>    "not dead",<br/>    "not ie &lt;= 11",<br/>    "not op_mini all"<br/>  ]<br/>}</span></pre><p id="eb70" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">我们现在可以使用<code class="fe ns nt nu nv b">lerna bootstrap</code>来交联我们的包。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="d3ea" class="ny kq iq nv b gy oo op l oq or">$ lerna bootstrap</span></pre><p id="1ce3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您应该会看到以下成功消息:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ow"><img src="../Images/2033cea3da675590d93052ca920e7b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uJlx-KsV6S2-JL6G.png"/></div></div></figure><h1 id="8c8a" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">在React应用中使用您的组件</h1><p id="7543" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">在<code class="fe ns nt nu nv b">packages/my-react-app/src/App.js</code>中增加以下几行:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="8a88" class="ny kq iq nv b gy oo op l oq or">import CompButton from '@my-project/comp-button';<br/>&lt;CompButton&gt;Foobar!&lt;/CompButton&gt;</span></pre><p id="0d17" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的文件现在将如下所示:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="c42c" class="ny kq iq nv b gy oo op l oq or">import React, { Component } from 'react';<br/>import logo from './logo.svg';<br/>import './App.css';<br/>import CompButton from '@my-project/comp-button';<br/><br/>class App extends Component {<br/>  render() {<br/>    return (<br/>      &lt;div className="App"&gt;<br/>        &lt;header className="App-header"&gt;<br/>          &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>          &lt;p&gt;<br/>            Edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.<br/>          &lt;/p&gt;<br/>          &lt;a<br/>            className="App-link"<br/>            href="https://reactjs.org"<br/>            target="_blank"<br/>            rel="noopener noreferrer"<br/>          &gt;<br/>            Learn React<br/>          &lt;/a&gt;<br/>          &lt;CompButton&gt;Foobar!&lt;/CompButton&gt;<br/>        &lt;/header&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/><br/>export default App;</span></pre><p id="db61" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在启动你的应用程序:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="9c5c" class="ny kq iq nv b gy oo op l oq or">$ npm run start</span></pre><p id="a5fb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您应该会看到以下错误:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oy"><img src="../Images/b3f34eb69c56e032cdd784fb02bcb59c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BJVIhKL2nV2skoax.png"/></div></div></figure><p id="6329" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">React应用程序无法编译，因为Create-React-App的Webpack配置不知道任何外部模块。这意味着Webpack不能告诉Babel-Loader你的组件目录，所以源代码不能被传输。</p><p id="45f7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">看起来这个问题可能会随着Create-React-App的未来版本而消失，尽管这可能需要Yarn工作空间。因此，在使用以下解决方法之前，请确保检查GitHub问题<a class="ae lv" href="https://github.com/facebook/create-react-app/issues/1333" rel="noopener ugc nofollow" target="_blank">Create-React-App-Lerna-Support</a>以查看该功能是否已登陆。</p><h1 id="cd61" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">为Lerna重新编写React应用程序</h1><p id="8625" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">我创建了一个小的工作区节点模块来覆盖Lerna项目中的Create-React-App Webpack配置，称为<a class="ae lv" href="https://www.npmjs.com/package/babel-loader-lerna-cra" rel="noopener ugc nofollow" target="_blank"> Babel-Loader-Lerna-CRA </a>。这很简单。它只是更新了Babel-Loader的Webpack路径。</p><p id="ee12" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您可以使用NPM安装此软件包:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="d9c1" class="ny kq iq nv b gy oo op l oq or">npm i -D babel-loader-lerna-cra</span></pre><p id="7f4d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在让我们用描述组件和应用程序之间关系的glob模式来更新Lerna根中的<code class="fe ns nt nu nv b">package.json</code>。</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="c79b" class="ny kq iq nv b gy oo op l oq or">"babel-loader-lerna-cra": {<br/>  "imports": "packages/comp-*/src",<br/>  "apps":  "packages/*react-app*"<br/>}</span></pre><p id="4fb5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您的<code class="fe ns nt nu nv b">package.json</code>现在应该是这样的:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="a906" class="ny kq iq nv b gy oo op l oq or">{<br/>  "name": "root",<br/>  "private": true,<br/>  "devDependencies": {<br/>    "@babel/cli": "^7.1.2",<br/>    "@babel/core": "^7.1.2",<br/>    "@babel/preset-env": "^7.1.0",<br/>    "@babel/preset-react": "^7.0.0",<br/>    "@storybook/addon-actions": "^4.0.0-alpha.25",<br/>    "@storybook/addon-links": "^4.0.0-alpha.25",<br/>    "@storybook/addons": "^4.0.0-alpha.25",<br/>    "@storybook/react": "^4.0.0-alpha.25",<br/>    "babel-core": "^7.0.0-bridge.0",<br/>    "babel-jest": "^23.6.0",<br/>    "babel-loader": "^8.0.4",<br/>    "babel-loader-lerna-cra": "^0.1.2",<br/>    "babel-plugin-transform-es2015-modules-commonjs": "^6.26.2",<br/>    "enzyme": "^3.7.0",<br/>    "enzyme-adapter-react-16": "^1.6.0",<br/>    "jest": "^23.6.0",<br/>    "lerna": "^3.4.3",<br/>    "react": "^16.6.0",<br/>    "react-dom": "^16.6.0",<br/>    "react-test-renderer": "^16.6.0"<br/>  },<br/>  "dependencies": {},<br/>  "scripts": {<br/>    "storybook": "start-storybook -p 6006",<br/>    "build-storybook": "build-storybook"<br/>  },<br/>  "babel-loader-lerna-cra": {<br/>    "imports": "packages/comp-*/src",<br/>    "apps":  "packages/*react-app*"<br/>  }<br/>}</span></pre><ul class=""><li id="484b" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b"><strong class="jt ir">imports</strong></code>指的是React应用程序需要传输的组件。</li><li id="6302" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><code class="fe ns nt nu nv b"><strong class="jt ir">apps</strong></code>通知<code class="fe ns nt nu nv b">babel-loader-lerna-cra</code>网络包覆盖需要发生的位置。</li></ul><p id="e9df" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在让我们用<code class="fe ns nt nu nv b">babel-loader-lerna-cra</code>引导React应用程序中的Webpack配置:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="d068" class="ny kq iq nv b gy oo op l oq or">$ npx babel-loader-lerna-cra</span></pre><p id="46c4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">您应该会看到以下输出:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oy"><img src="../Images/40d71980d125d97ac80a48d3f275149a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4GOi7UZ-ESV4Sqf6.png"/></div></div></figure><p id="20f5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在让我们再次尝试运行React应用程序:</p><pre class="me mf mg mh gt ok nv ol om aw on bi"><span id="9320" class="ny kq iq nv b gy oo op l oq or">$ cd ~/repos/monorepo-react/packages/my-react-app<br/>$ npm run start</span></pre><p id="914f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">现在，您应该看到React应用程序在浏览器中启动，您的<code class="fe ns nt nu nv b">CompButton</code>组件呈现为文本“Foorbar！”</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oy"><img src="../Images/91edbe591a181b4bc488563fd0f84118.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6391Q6yeMUGttIsZ.png"/></div></div></figure><h1 id="cacc" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">那么，我们从这个变通办法中得到了什么呢？</h1><p id="39ce" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated"><strong class="jt ir">Lerna兄弟的自动传输</strong></p><ul class=""><li id="b128" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">我们的React应用程序现在可以在需要时导入兄弟Lerna依赖项和transpile。</li></ul><p id="73b5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir"> React App热重装</strong></p><ul class=""><li id="718b" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">当我们更改React组件文件时，将热更新应用程序，而不必向Lerna项目添加任何全局观察器来启动transpile。</li><li id="0abb" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated">这是我们的<code class="fe ns nt nu nv b">CompButton</code>组件在更新时被热重装:</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oz"><img src="../Images/ded992601c0dcb803f30c89cba12e638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kJrEFv-vKWOxdo1p.gif"/></div></div></figure><p id="c754" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated"><strong class="jt ir">故事书热重装</strong></p><ul class=""><li id="9c41" class="mp mq iq jt b ju jv jy jz lp mr lr ms lt mt ko mu mv mw mx bi translated">这里没什么特别的，但是值得注意的是我们的故事书也可以热加载:</li></ul><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi oy"><img src="../Images/56a8d043e31a30e64f6fe6d510c9bee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b2fvLK3RFlj3QBpk.png"/></div></div></figure><h1 id="d9af" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="0f0f" class="pw-post-body-paragraph jq jr iq jt b ju ln jw jx jy lo ka kb lp lq ke kf lr ls ki kj lt lu km kn ko ij bi translated">我想这是我在一篇文章中所能谈到的。我希望其他人会觉得这个设置有用。如果人们感兴趣，我将在第2部分继续讨论如何设置CI，以便从这个Monorepo设置中发布多个React应用程序。</p><p id="2085" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">欢迎评论、反馈、建议。</p><p id="a662" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lp kd ke kf lr kh ki kj lt kl km kn ko ij bi translated">阿利斯泰尔·麦克唐纳</p><h1 id="4446" class="kp kq iq bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">关于这个话题的有趣文章:</h1><ul class=""><li id="3411" class="mp mq iq jt b ju ln jy lo lp pa lr pb lt pc ko mu mv mw mx bi translated"><a class="ae lv" href="https://medium.com/@luisvieira_gmr/building-large-scale-react-applications-in-a-monorepo-91cd4637c131" rel="noopener">https://medium . com/@ luisvieira _ GMR/building-large-scale-react-applications-in-a-monorepo-91cd 4637 c131</a></li><li id="0113" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><a class="ae lv" href="https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext" rel="noopener ugc nofollow" target="_blank">https://cacm . ACM . org/magazines/2016/7/204032-why-Google-stores-billion-of-line-of-code-in-a-single-repository/full text</a></li><li id="2b9d" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><a class="ae lv" href="https://github.com/facebook/create-react-app/issues/1333" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/create-react-app/issues/1333</a></li><li id="051a" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><a class="ae lv" href="https://github.com/facebook/create-react-app/pull/3741" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/create-react-app/pull/3741</a></li><li id="6336" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><a class="ae lv" href="https://github.com/jamiebuilds/react-loadable" rel="noopener ugc nofollow" target="_blank">https://github.com/jamiebuilds/react-loadable</a></li><li id="1558" class="mp mq iq jt b ju my jy mz lp na lr nb lt nc ko mu mv mw mx bi translated"><a class="ae lv" href="https://daveceddia.com/customize-create-react-app-webpack-without-ejecting/" rel="noopener ugc nofollow" target="_blank">https://Dave ceddia . com/customize-create-react-app-web pack-without-ejecting/</a></li></ul></div></div>    
</body>
</html>