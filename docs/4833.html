<html>
<head>
<title>WSL2 Tips: Limit CPU/Memory When using Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WSL2提示:使用Docker时限制CPU/内存</h1>
<blockquote>原文：<a href="https://itnext.io/wsl2-tips-limit-cpu-memory-when-using-docker-c022535faf6f?source=collection_archive---------0-----------------------#2020-10-01">https://itnext.io/wsl2-tips-limit-cpu-memory-when-using-docker-c022535faf6f?source=collection_archive---------0-----------------------#2020-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="2db8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Windows Subsystem for Linux (WSL)是微软的一项终极功能，它使开发人员能够直接在Windows上运行GNU/Linux环境，无需修改，没有传统虚拟机或双引导设置的开销。</p><p id="2f7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在WSL2中，他们在添加新特性的同时<a class="ae ko" href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#comparing-features" rel="noopener ugc nofollow" target="_blank">做了大量的性能改进，比如托管虚拟机、完整的Linux内核和完整的系统调用兼容性。</a></p><p id="59f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在Windows上启用并安装了WSL-2，Docker-desktop可以使用基于WSL-2的引擎来获得更好的性能。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/a3adb4adfd1ead1b5651ea1578929453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFPQomG5G4sUT-UcVVpgyg.png"/></div></div></figure><blockquote class="lb lc ld"><p id="a60e" class="jq jr le js b jt ju jv jw jx jy jz ka lf kc kd ke lg kg kh ki lh kk kl km kn im bi translated">Docker Desktop使用WSL 2中的动态内存分配特性来大大改善资源消耗。这意味着，Docker Desktop只使用所需数量的CPU和内存资源，同时使CPU和内存密集型任务(如构建容器)运行得更快。</p><p id="5230" class="jq jr le js b jt ju jv jw jx jy jz ka lf kc kd ke lg kg kh ki lh kk kl km kn im bi translated">——<a class="ae ko" href="https://docs.docker.com/docker-for-windows/wsl/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/docker-for-windows/wsl/</a></p></blockquote><p id="7907" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">动态内存分配和更多的CPU能力！看起来棒极了！但是看看下面的图片:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi li"><img src="../Images/f4dcba6b1522c128c5e5d16e010cc93c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWlTOqcj4XeW4NO8_-OufA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">疯狂的内存消耗:WSL2上的Docker</figcaption></figure><p id="82ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">WSL-2上的Docker可能会分配所有可用的内存，最终导致操作系统和其他应用程序的内存不足。</p></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h2 id="074e" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">内存/CPU限制设置</h2><p id="3fd3" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">在传统的Hyper-V后端引擎上，内存和CPU分配很容易管理，这在WSL-2中也是可能的，但有点复杂！</p><p id="e255" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的场景中，我更喜欢只分配<strong class="js iu">四个CPU内核</strong>和最大<strong class="js iu">三GB内存</strong>。</p><p id="c458" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">打开Windows终端/CMD/PowerShell并运行以下命令:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="0370" class="lu lv it mt b gy mx my l mz na"># turn off all wsl instances such as docker-desktop<br/>wsl --shutdown</span><span id="1015" class="lu lv it mt b gy nb my l mz na">notepad "$env:USERPROFILE/.wslconfig"</span></pre><p id="fdb9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用记事本编辑<code class="fe nc nd ne mt b">.wslconfig</code>文件，并记下这些设置:</p><pre class="kq kr ks kt gt ms mt mu mv aw mw bi"><span id="898c" class="lu lv it mt b gy mx my l mz na">[wsl2]<br/>memory=3GB   # Limits VM memory in WSL 2 up to 3GB<br/>processors=4 # Makes the WSL 2 VM use two virtual processors</span></pre><p id="9bd4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">保存文件并重新启动docker-desktop服务！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nf"><img src="../Images/d608f4e53468abe61ecaee214d3d26c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vv1RjqzQ5V7M2FzPQxdAkQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">内存分配上限为3GB！🤘</figcaption></figure></div><div class="ab cl ln lo hx lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="im in io ip iq"><h2 id="ee15" class="lu lv it bd lw lx ly dn lz ma mb dp mc kb md me mf kf mg mh mi kj mj mk ml mm bi translated">结论</h2><p id="1aee" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">WSL-2设置不仅限于CPU和内存；您可以应用更多其他设置。点击阅读更多相关信息<a class="ae ko" href="https://docs.microsoft.com/en-us/windows/wsl/wsl-config#wsl-2-settings" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>