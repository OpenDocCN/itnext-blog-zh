<html>
<head>
<title>Manage Environment Variables in your NodeJs Application with dotenv</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用dotenv管理NodeJs应用程序中的环境变量</h1>
<blockquote>原文：<a href="https://itnext.io/manage-environment-variables-in-your-nodejs-application-with-dotenv-520914a9254b?source=collection_archive---------1-----------------------#2020-04-14">https://itnext.io/manage-environment-variables-in-your-nodejs-application-with-dotenv-520914a9254b?source=collection_archive---------1-----------------------#2020-04-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/580ca49e3989bf3047c1cc05509669fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*U2gREF6b34CwavMJTc4AqQ.png"/></div></figure><p id="74a4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在web开发生涯的某个阶段，您可能需要配置您的应用程序，以便它可以在不同的环境中工作。您也可以使用需要API凭证、OAuth令牌或SSH密钥才能访问的第三方资源。然而，在源代码中公开这些凭证或者将它们提交到版本控制中是违反约定的，原因您很清楚！这就是使用环境变量的方便之处。应用程序所需的敏感信息或特定于平台的信息可以存储在本地的环境变量中。</p><h1 id="f87f" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">什么是dotenv？为什么要用dotenv？</h1><p id="f10c" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated"><a class="ae ly" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> Dotenv </strong> </a>是一个模块，我们将使用它来访问应用程序中的环境变量。当一个<strong class="jz iu"> NodeJs </strong>应用程序运行时，它会注入一个名为<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"><strong class="jz iu">process . env</strong></a><strong class="jz iu"/>的全局变量，该变量包含关于应用程序运行的环境状态的信息。<a class="ae ly" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"><strong class="jz iu">Dotenv</strong></a><strong class="jz iu"/>将允许我们加载我们存储在<strong class="jz iu">中的环境变量。env </strong>文件变成<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> process.env </strong> </a>。注意，在运行<strong class="jz iu"> NodeJs </strong>应用程序时，您也可以通过终端传递环境变量；然而，当您在处理一堆变量时，通过终端传递环境变量会变得很糟糕！</p><h1 id="c469" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">概观</h1><p id="a024" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">今天，我们将使用<strong class="jz iu"> Express </strong>实现一个基本的<strong class="jz iu"> NodeJs </strong>服务器，并使用环境变量来配置它。我们将把我们的<strong class="jz iu">端口</strong>和<strong class="jz iu"> APP_SECRET </strong>存储在<strong class="jz iu">中。env </strong>文件，并使用<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> dotenv </strong> </a>模块将其加载到<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"><strong class="jz iu">process . env</strong></a><strong class="jz iu"/>中。然后，我们将在代码中访问这些变量，以成功运行环境指定的应用程序。</p><h1 id="4c7e" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">NodeJs项目设置</h1><p id="e901" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">在一个单独的文件夹中，运行<strong class="jz iu"> npm init </strong>来设置NodeJs项目。</p><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi lz"><img src="../Images/c3d8b899040dd1d21720b4e872e7e4d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dP1DSta7bAgNJi1dcuM3ig.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">使用<strong class="bd kx"> npm初始化</strong>的NodeJS应用设置</figcaption></figure><h2 id="c7ea" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">项目相关性</h2><p id="3557" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">我们将在NodeJs应用程序中使用一组依赖项。从项目的根目录在终端中运行以下命令:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="7c60" class="mm kw it mz b gy nd ne l nf ng">npm i express dotenv</span></pre><p id="18d2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">快递</strong>将帮助我们设置我们的服务器。我们将使用<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> dotenv </strong> </a>模块从<strong class="jz iu">加载环境变量。env </strong>文件变成<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"><strong class="jz iu">process . env</strong></a><strong class="jz iu">。</strong></p><h2 id="7503" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">package.json中的安装启动脚本</h2><p id="3477" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">用下面的脚本替换<strong class="jz iu"> package.json </strong>中的现有脚本，这样我们就可以运行我们的应用程序<strong class="jz iu"> : </strong></p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="5d79" class="mm kw it mz b gy nd ne l nf ng">"start": "node index.js"</span></pre><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">package.json文件</figcaption></figure><h2 id="c43a" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">中设置环境变量。环境文件</h2><p id="e873" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">创建一个<strong class="jz iu">。在终端中运行以下命令，将env </strong>文件放在项目的根目录下:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="580f" class="mm kw it mz b gy nd ne l nf ng">touch .env</span></pre><p id="f63d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们将通过设置<strong class="jz iu">中的<strong class="jz iu">端口</strong>和<strong class="jz iu"> APP_SECRET </strong>变量来指定我们的服务器监听的端口和我们的app secret。env </strong>文件。</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="e307" class="mm kw it mz b gy nd ne l nf ng">PORT=3000<br/>APP_SECRET="THIS_IS_TOP_SECRET"</span></pre><h2 id="2023" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">设置初始服务器入口点:index.js</h2><p id="f316" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">在终端从项目根目录运行以下命令，创建<strong class="jz iu"> index.js </strong>文件:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="f2ea" class="mm kw it mz b gy nd ne l nf ng">touch index.js</span></pre><h2 id="3ce6" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">将环境变量加载到process.env</h2><p id="b620" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">在<strong class="jz iu"> index.js </strong>文件的顶部添加以下行，以从<strong class="jz iu">加载环境变量。env </strong>文件转换成<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank">文件<strong class="jz iu"> process.env </strong>文件</a>:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="0a59" class="mm kw it mz b gy nd ne l nf ng">const dotenv = require("dotenv");<br/>dotenv.config();</span></pre><p id="b671" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">注意，建议在应用程序代码中尽早添加这些行<strong class="jz iu">。</strong></p><h2 id="6654" class="mm kw it bd kx mn mo dn lb mp mq dp lf ki mr ms lj km mt mu ln kq mv mw lr mx bi translated">访问环境变量</h2><p id="df7a" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">我们将从我们的<strong class="jz iu"> index.js </strong>文件中访问我们的<strong class="jz iu">端口</strong>和<strong class="jz iu"> APP_SECRET </strong>加载到<a class="ae ly" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu"> process.env </strong> </a>中，如下所示:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="00a9" class="mm kw it mz b gy nd ne l nf ng">const MY_PORT = process.env.PORT;<br/>const MY_APP_SECRET = process.env.APP_SECRET;</span></pre><h1 id="05e9" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak">设置快捷应用</strong></h1><p id="3f1c" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">如果你以前使用过<strong class="jz iu"> Express </strong>，这应该看起来很简单。您可以查看<strong class="jz iu"> Express </strong> <a class="ae ly" href="https://expressjs.com/en/5x/api.html" rel="noopener ugc nofollow" target="_blank">文档</a>，获取如何设置端点的详细说明。我们将创建一个基本端点，它将返回我们从环境变量中访问的<strong class="jz iu"> APP_SECRET </strong>。此外，服务器将监听由我们的环境变量指定的端口。</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="6cd1" class="mm kw it mz b gy nd ne l nf ng">const express = require("express");<br/>const app = express();</span><span id="605d" class="mm kw it mz b gy nj ne l nf ng">app.get("/", (req, res) =&gt; {</span><span id="ff31" class="mm kw it mz b gy nj ne l nf ng">   return res.send(MY_APP_SECRET);</span><span id="8588" class="mm kw it mz b gy nj ne l nf ng">});<br/></span><span id="907d" class="mm kw it mz b gy nj ne l nf ng">app.listen(MY_PORT, () =&gt; console.log(`Server running on port ${MY_PORT}`))</span></pre><figure class="ma mb mc md gt ju"><div class="bz fp l di"><div class="nh ni l"/></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">最终索引. js</figcaption></figure><h1 id="f7d5" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">运行应用程序</h1><p id="550e" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">您可以在终端中运行以下命令，使用来自<strong class="jz iu"> package.json的启动脚本来运行web服务器:</strong></p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="0867" class="mm kw it mz b gy nd ne l nf ng">npm start</span></pre><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nk"><img src="../Images/7262f85c5172d4f80580334338ecdfcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QIWUpGymvoFAV2HrWDSEQ.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">npm在终端上启动</figcaption></figure><figure class="ma mb mc md gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi nl"><img src="../Images/6a6c6595c7e42e443c35937eeb64139b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5N4II2iUJAIkpUG5Ds3Tg.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk translated">localhost:浏览器上的3000</figcaption></figure><p id="b6b5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">正如预期的那样，我们的服务器运行在环境指定的端口上，并返回配置好的APP_SECRET。</p><h1 id="0f29" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">补充。环境到。gitignore</h1><p id="ff16" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">请注意，不建议将环境变量提交给版本控制，因为它可能包含机密或特定于环境的信息。</p><p id="14bf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">创建一个<strong class="jz iu">。gitignore应用程序根目录中的</strong>文件:</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="0414" class="mm kw it mz b gy nd ne l nf ng">touch .gitignore</span></pre><p id="3014" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">将以下文本添加到<strong class="jz iu">中。gitignore </strong>文件</p><pre class="ma mb mc md gt my mz na nb aw nc bi"><span id="b425" class="mm kw it mz b gy nd ne l nf ng">.env</span></pre><h1 id="a9fa" class="kv kw it bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="8645" class="pw-post-body-paragraph jx jy it jz b ka lt kc kd ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku im bi translated">值得注意的是，我们在本教程中仅仅触及了皮毛，环境变量还有很多用途！这是<a class="ae ly" href="https://github.com/abdamin/dotenv-node-tutorial" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu">链接</strong> </a>到<strong class="jz iu"> Github </strong> <strong class="jz iu">存储库</strong>，包含我们应用程序的完整代码。</p><p id="1841" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您有任何问题，请随时发表评论。此外，如果这帮助了你，请喜欢并与他人分享。我定期发表与web开发相关的文章。考虑<a class="ae ly" href="https://abdullahsumsum.com/subscribe" rel="noopener ugc nofollow" target="_blank"> <strong class="jz iu">在这里输入你的电子邮件</strong> </a>来获得与web开发相关的最新文章和教程。你也可以找到更多关于我在abdullahsumsum.com做什么的信息</p></div></div>    
</body>
</html>