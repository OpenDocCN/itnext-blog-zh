<html>
<head>
<title>ELK stack, filebeat and Performance Analyzer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ELK堆栈、filebeat和性能分析器</h1>
<blockquote>原文：<a href="https://itnext.io/elk-stack-filebeat-and-performance-analyzer-2d6f0119e70d?source=collection_archive---------6-----------------------#2019-02-22">https://itnext.io/elk-stack-filebeat-and-performance-analyzer-2d6f0119e70d?source=collection_archive---------6-----------------------#2019-02-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="1b4a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然我们的产品中没有日志管理解决方案(但请保持关注),但我们帮助客户将他们现有的监控平台集成到Performance Analyzer中。我们遇到的最完整和最受欢迎的解决方案之一是Elasticsearch、Logstash和Kibana，也称为als ELK stack。此外，我们注意到File beat在收集应用程序日志和docker容器日志方面变得越来越流行。</p><p id="163e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们正在设置我们最新的测试实验室，以将ELK stack集成到Performance Analyzer中时，我们决定将我们所做的步骤写在博客上。你可能会得到一些好的见解或者学到一些新的技巧。</p><p id="698f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你还不知道<a class="ae kl" href="https://www.elastic.co/elk-stack" rel="noopener ugc nofollow" target="_blank">麋鹿栈</a>，让我们先来一个快速介绍。</p><p id="9526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">麋鹿栈由<a class="ae kl" href="https://www.elastic.co/products/elasticsearch" rel="noopener ugc nofollow" target="_blank">弹性搜索</a>、<a class="ae kl" href="https://www.elastic.co/products/logstash" rel="noopener ugc nofollow" target="_blank">日志存储</a>和<a class="ae kl" href="https://www.elastic.co/products/kibana" rel="noopener ugc nofollow" target="_blank">基巴纳</a>组成。开源公司<a class="ae kl" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"> Elastic </a>将这三个组件作为独立的项目来构建，这三个组件非常适合一起工作。同时，它是一个完整的日志管理和分析软件套件。</p><p id="c19a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">中央日志管理和索引是运行数据中心、集群、分布式服务器等所需的功能。</p><p id="842d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elasticsearch是后端，其功能是数据存储，Logstash是数据处理引擎(服务器端数据处理管道)，它从各种来源获取数据，将其转换为所需的格式，并将其转发到数据存储(像Elasticsearch一样)，Kibana是仪表板前端引擎，允许使用浏览器查看和分析日志数据(以及更多)。</p><p id="16f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想从头开始安装完整的ELK堆栈，有很多指南可供参考。如果你不想花太多的时间去快速启动，可以考虑docker hub。</p><h1 id="a749" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">麋鹿码头集装箱</h1><p id="c827" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">虽然有大量ELK容器，但我们认为有一个项目维护得非常好，非常受欢迎:</p><p id="434f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://hub.docker.com/r/sebp/elk/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/r/sebp/elk/</a>(500多万次下载，800多颗星)</p><p id="3bee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还有一个关于如何使用容器的很棒的文档:<a class="ae kl" href="https://elk-docker.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> elk-docker </a></p><p id="76c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们想要运行多个容器，docker-compose总是最好的选择。</p><p id="2890" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> docker-compose.yml </strong></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="845c" class="ly kn iq lu b gy lz ma l mb mc">version: ‘3.7’</span><span id="86f9" class="ly kn iq lu b gy md ma l mb mc">services:</span><span id="e547" class="ly kn iq lu b gy md ma l mb mc">elk:</span><span id="1031" class="ly kn iq lu b gy md ma l mb mc">image: sebp/elk</span><span id="b8d6" class="ly kn iq lu b gy md ma l mb mc">ports:</span><span id="40d6" class="ly kn iq lu b gy md ma l mb mc">– “5601:5601”</span><span id="b0da" class="ly kn iq lu b gy md ma l mb mc">– “9200:9200”</span><span id="a481" class="ly kn iq lu b gy md ma l mb mc">– “5044:5044”</span><span id="a925" class="ly kn iq lu b gy md ma l mb mc">restart: “unless-stopped”</span><span id="bf61" class="ly kn iq lu b gy md ma l mb mc">container_name: opvizor-elk</span></pre><p id="ce6a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker-撰写向上-d</p><p id="985f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">docker-撰写ps</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/70a9e45c3f360e7322051deec449837e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I-rF82qazjZ-hrDV.png"/></div></div></figure><p id="79ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有这些完成后，ELK stack以最小化的配置作为守护进程运行。</p><h1 id="c213" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Filebeat</h1><p id="594a" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">接下来我们要做的是从运行ELK堆栈的系统中收集日志数据。Filebeat 是这样做的一个很好的快速选择。</p><p id="c86a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们运行没有配置的filebeat容器来定制现有的ELK堆栈(创建索引、添加仪表板等等)。确保更改Kibana和Elasticsearch主机参数以匹配您的安装。如果容器运行在与ELK堆栈相同的主机上(docker-compose up)，您还可以在docker-compose.yml文件中使用container_name(如果您也使用了正确的网络)。</p><p id="23b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要找到网络名称，只需运行<em class="mm"> docker network ls </em></p><p id="caa3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通常，网络的命名类似于服务，并添加了_default。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/e1cb5d254923ad5ae344045eb49fb8b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/0*N9cmf7er2b9bKe-m.png"/></div></figure><p id="45dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有这么多的方法来连接docker容器，请随意使用您更喜欢的替代品。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="49d7" class="ly kn iq lu b gy lz ma l mb mc"><em class="mm">docker run –network=elk_default \ docker.elastic.co/beats/filebeat:6.6.0 \<br/>setup -E setup.kibana.host=opvizor-elk:5601 \<br/>-E output.elasticsearch.hosts=[“opvizor-elk:9200”]</em></span></pre><p id="548f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您应该会看到以下输出:</p><p id="4b50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">加载指标模板</em></p><p id="534c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">加载仪表板(Kibana必须正在运行且可访问)</em></p><p id="5607" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">加载的仪表板</em></p><p id="561b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">加载的机器学习作业配置</em></p><h1 id="0831" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">运行Filebeat</h1><p id="813a" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先要做的是为filebeat创建一个配置文件——您也可以下载一个模板:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f02a" class="ly kn iq lu b gy lz ma l mb mc">curl -L -O <a class="ae kl" href="https://raw.githubusercontent.com/elastic/beats/6.6/deploy/docker/filebeat.docker.yml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/elastic/beats/6.6/deploy/docker/filebeat.docker.yml</a></span></pre><p id="e786" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此配置具有开箱即用的docker支持，并且只需要弹性搜索目标:</p><p id="7e95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm"> filebeat.config: </em></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="caf0" class="ly kn iq lu b gy lz ma l mb mc"><em class="mm">modules:</em></span><span id="e729" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">path: ${path.config}/modules.d/*.yml</em></span><span id="042a" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">reload.enabled: false</em></span><span id="00ad" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">filebeat.autodiscover:</em></span><span id="544c" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">providers:</em></span><span id="a978" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">– type: docker</em></span><span id="6228" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">hints.enabled: true</em></span><span id="024e" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">processors:</em></span><span id="af5a" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">– add_cloud_metadata: ~</em></span><span id="7b9f" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">output.elasticsearch:</em></span><span id="80c5" class="ly kn iq lu b gy md ma l mb mc"><em class="mm">hosts: ‘${ELASTICSEARCH_HOSTS:opvizor-elk:9200}’</em></span></pre><p id="ec11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，将filebeat添加到docker-compose.yml是有意义的:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7d06" class="ly kn iq lu b gy lz ma l mb mc">filebeat:</span><span id="a2bd" class="ly kn iq lu b gy md ma l mb mc">image: docker.elastic.co/beats/filebeat:${ELASTIC_VERSION:-6.5.0}</span><span id="f2c5" class="ly kn iq lu b gy md ma l mb mc">hostname: “opvizor-elk-filebeat”</span><span id="9d22" class="ly kn iq lu b gy md ma l mb mc">container_name: filebeat</span><span id="f7f1" class="ly kn iq lu b gy md ma l mb mc">restart: unless-stopped</span><span id="59bc" class="ly kn iq lu b gy md ma l mb mc">user: root</span><span id="02f1" class="ly kn iq lu b gy md ma l mb mc">volumes:</span><span id="97dd" class="ly kn iq lu b gy md ma l mb mc">– ./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span><span id="02f9" class="ly kn iq lu b gy md ma l mb mc">– filebeat:/usr/share/filebeat/data</span><span id="3c61" class="ly kn iq lu b gy md ma l mb mc">– /var/run/docker.sock:/var/run/docker.sock</span><span id="274e" class="ly kn iq lu b gy md ma l mb mc">– /var/lib/docker/containers/:/var/lib/docker/containers/:ro</span><span id="9524" class="ly kn iq lu b gy md ma l mb mc">– /var/log/:/var/log/:ro</span><span id="34fd" class="ly kn iq lu b gy md ma l mb mc">environment:</span><span id="aa6b" class="ly kn iq lu b gy md ma l mb mc">– ELASTICSEARCH_HOST=opvizor-elk:9200</span><span id="4c18" class="ly kn iq lu b gy md ma l mb mc"># disable strict permission checks</span><span id="7a1a" class="ly kn iq lu b gy md ma l mb mc">command: [“–strict.perms=false”]</span><span id="73d1" class="ly kn iq lu b gy md ma l mb mc">volumes:</span><span id="b028" class="ly kn iq lu b gy md ma l mb mc">filebeat:</span></pre><p id="04b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">docker-compose down&amp;T23】docker-compose up-d</em></p><p id="7de6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Elasticsearch准备接收数据，Filebeat正在向Logstash发送数据，Logstash正在处理数据并存储在Elasticsearch中。</p><p id="3b3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">少了什么？当然还有Kibana，用于分析和搜索日志数据的UI。</p><p id="af94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Kibana在端口5601上运行，默认情况下没有身份验证。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/a0a0e52736a54eca8447c174cdea9c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PpDU2mBZL0DnoU6y.png"/></div></div></figure><p id="78a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们现在只有filebeat数据传入，所以创建一个索引filebeat——并使用@timestamp</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/5a14ddbdf93335dc4cc6ae41d9dd4e28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c6KSMWUDUNjNYQrc.png"/></div></div></figure><p id="7dd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来要添加的是通过系统日志的VMware ESXi日志。当然，您可以设置logstash来接收syslog消息，但是既然我们已经有了Filebeat，为什么不使用它的syslog输入插件呢？</p><p id="06ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">VMware ESXi系统日志仅支持系统日志的端口514 udp/tcp或端口1514 tcp。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/a2c014b8743cdc832bee458b398e188b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tjvwPsc9nyS4_4na.png"/></div></div></figure><p id="c5fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更改防火墙以允许传出系统日志— 1514 TCP</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/58d9779cba6ce98e15d93d6ce5b693fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TP7vUutVUC1aWUr-.png"/></div></div></figure><p id="2a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新启动系统日志服务</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mo"><img src="../Images/1bc8136b58a6e538db0afde7bd13c9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*laZsSetOUUFr5izb.png"/></div></div></figure><p id="01e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多信息可在此处找到:</p><p id="9c9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.esxi.upgrade.doc/GUID-9F67DB52-F469-451F-B6C8-DAE8D95976E7.html" rel="noopener ugc nofollow" target="_blank">https://docs . VMware . com/en/VMware-VSP here/6.7/com . VMware . esxi . upgrade . doc/GUID-9f 67 db 52-F469-451 f-B6 c8-dae8d 95976 e 7 . html</a></p><p id="6fc8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将<strong class="jp ir"> docker-compose.yml </strong>文件更改为打开端口1514</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9dcd" class="ly kn iq lu b gy lz ma l mb mc">filebeat:</span><span id="da1d" class="ly kn iq lu b gy md ma l mb mc">image: docker.elastic.co/beats/filebeat:${ELASTIC_VERSION:-6.5.0}</span><span id="e2f6" class="ly kn iq lu b gy md ma l mb mc">hostname: “opvizor-elk-filebeat”</span><span id="1c96" class="ly kn iq lu b gy md ma l mb mc">container_name: filebeat</span><span id="43c6" class="ly kn iq lu b gy md ma l mb mc">restart: unless-stopped</span><span id="f9ba" class="ly kn iq lu b gy md ma l mb mc">user: root</span><span id="127e" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">ports:</strong></span><span id="943f" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">– “1514:1514”</strong></span><span id="c027" class="ly kn iq lu b gy md ma l mb mc">volumes:</span><span id="453a" class="ly kn iq lu b gy md ma l mb mc">– ./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span><span id="3e7b" class="ly kn iq lu b gy md ma l mb mc">– filebeat:/usr/share/filebeat/data</span><span id="7ca5" class="ly kn iq lu b gy md ma l mb mc">– /var/run/docker.sock:/var/run/docker.sock</span><span id="39fb" class="ly kn iq lu b gy md ma l mb mc">– /var/lib/docker/containers/:/var/lib/docker/containers/:ro</span><span id="33af" class="ly kn iq lu b gy md ma l mb mc">– /var/log/:/var/log/:ro</span><span id="4c32" class="ly kn iq lu b gy md ma l mb mc">environment:</span><span id="616c" class="ly kn iq lu b gy md ma l mb mc">– ELASTICSEARCH_HOST=opvizor-elk:9200</span><span id="7a59" class="ly kn iq lu b gy md ma l mb mc"># disable strict permission checks</span><span id="9cc8" class="ly kn iq lu b gy md ma l mb mc">command: [“–strict.perms=false”]</span></pre><p id="5aa9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">更改Filebeat.yml </strong></p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="9247" class="ly kn iq lu b gy lz ma l mb mc"><strong class="lu ir">filebeat.inputs:</strong></span><span id="cd2a" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">– type: syslog</strong></span><span id="8237" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">protocol.udp:</strong></span><span id="c470" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">host: “:1514”</strong></span><span id="916e" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">filebeat.inputs:</strong></span><span id="70ab" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">– type: syslog</strong></span><span id="9180" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">protocol.tcp:</strong></span><span id="1d2a" class="ly kn iq lu b gy md ma l mb mc"><strong class="lu ir">host: “:1514”</strong></span></pre><p id="b76e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看是否有数据传入:</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/1c88866f31c88f6a80030701ed4517a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b7LJ_7r1GWlJ9fQG.png"/></div></div></figure><p id="bc77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来不错，现在我们可以开始定制仪表板和输入流处理了。</p><p id="3c6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有数据都很好地流入到我们的设置中，因此我们可以开始向Performance Analyzer仪表板添加最重要的信息。</p><p id="efa5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要将Elasticsearch集成到Performance Analyzer中，我们需要添加一个数据源。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/f06c18d981fe3647b129a71d1a54620d.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/0*dZJ_rtA9qIMrejFt.png"/></div></figure><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mq"><img src="../Images/d58ca9de9078c56ba6498b529210a451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*scBTcKxlRUYJum8M.png"/></div></div></figure><p id="182b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加Elasticsearch数据源时，确保设置正确的索引并使用有效的url</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mr"><img src="../Images/a235d7cab8ec673fef9b7d0c11f78969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V74kgW5JsnwbvI1s.png"/></div></div></figure><h1 id="cea9" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">为Elasticsearch创建新的仪表板</h1><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/57258fe584223a163887d9b5cbf2e9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Bbo1mKSfKht4dJlz.png"/></div></div></figure><p id="e088" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用齿轮图标(1)更改名称，并添加一个新表格来查看弹性搜索条目(2)。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ms"><img src="../Images/2f97957a31e828ba8aad89728a8b1a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1tcm6IdgmJiQB0Nc.png"/></div></div></figure><p id="ad1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择正确的数据源并创建您的Elasticsearch查询。</p><figure class="lp lq lr ls gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/1c93f2bd61fa19b31b53bbf9b6d4866e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XVqmwE4yiBodqneG.png"/></div></div></figure><p id="5b01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您可以将日志错误小部件或计数与ESXi或虚拟机信息混合使用。</p><h1 id="4b3a" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">清理工作管理员</h1><p id="6c79" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">您可能希望不时清理Elasticsearch内容，以避免存储不需要的数据。有一个很好的工具叫做策展人，它可以在docker容器中很好地运行。</p><p id="363e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下示例清理Elasticsearch数据库并删除超过30天的数据:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d694" class="ly kn iq lu b gy lz ma l mb mc"><em class="mm">docker run –rm –network=elk_default -e ES_HOST=opvizor-elk -e DAYS_TO_KEEP=30 omerha/docker-elasticsearch-curator:latest</em></span></pre><p id="ef13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，您可以设置一个每日cron作业，以确保定期进行清理。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="182c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mm">最初发表于</em><a class="ae kl" href="https://www.opvizor.com/integrate-elk-stack-and-filebeat-into-performance-analyzer" rel="noopener ugc nofollow" target="_blank"><em class="mm">【www.opvizor.com】</em></a><em class="mm">。</em></p></div></div>    
</body>
</html>