# 为团队编写 Python 代码

> 原文：<https://itnext.io/coding-python-in-a-team-of-one-or-more-1f4768729ff1?source=collection_archive---------4----------------------->

![](img/db05613bc9c3987ab22253a0909cfd5d.png)

照片由[威尔·波拉达](https://unsplash.com/@will0629?utm_source=medium&utm_medium=referral)在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 拍摄

如果你是一个初学者，或者即使你已经做了很多年，也很容易变得懒惰，只是做你知道的事情。粗制滥造代码或维护一个吱吱作响的代码库有点令人沮丧，但相对容易做到，你可以一段时间内埋头苦干。但是总有一天你会觉得你需要提升自己的水平。你可以感觉到技术债务在增加，你认为应该有一个更好的方法来做到这一点。

是时候做一个负责任的编码公民了。即使你是一个人的团队，在某些时候懒惰的选择会回来咬你。

> 你应该总是像在一个团队中一样编码，即使这个团队只有你一个人。

# 文档:即使一点点也比没有好

我们不喜欢做这件事，感觉它阻碍了我们做更重要、更紧急、更有趣的事情。但是一旦所有有趣的实验和架构设计都被遗忘了，文档就是润滑生产力车轮的东西之一。你总是不得不与不熟悉的人分享你的代码库，即使是你自己在 6 个月内，当你不得不修改某些东西的时候。

## PyDoc 和类型提示

首先要做的是注释您的代码，并使用 Sphinx 等工具的内联文档来获取和生成好看的、可搜索的文档。我对 python 的建议是使用 pydoc 注释的 google 风格。我发现将清晰的文档放在代码中的一个主要原因是为了语言敏感的编辑器。这使得他们能够在输入函数名时弹出参数列表和描述。在那个狭窄的弹出视图中，谷歌风格的 pydoc 看起来最不糟糕。

那么它又是做什么的呢？

该文档对于清楚地了解开发人员应该传递给函数的数据类型非常有用。但是除了开发人员文档之外，类型提示注释为编辑器的智能感知/自动完成功能提供了足够的信息，以便在您键入时提供类方法、参数和属性。所有这些都加速了开发过程，对于你自己和对代码不感冒的人来说。

是不是刚好合适的类型？

通过在变量赋值期间使用内联类型提示，你可以帮助你的代码编辑器使用它的绝地思维技巧来预测类和类型。对于集合和映射，使用类型模块。这里有一个关于使用与 Python 2 和 3 兼容的类型提示的[总结](https://mypy.readthedocs.io/en/latest/cheat_sheet.html)。

## 让它全部启动并运行

对于一个相当复杂的项目，最困难的事情是让另一个开发人员建立并运行一个可工作的开发环境，这样他们就可以从事开发工作了。编写一份好的安装指南并明确先决条件是至关重要的。理想情况下，它应该由一堆帮助他们安装依赖项的安装脚本来补充。在设置 git repo 时，拥有一个默认的 README 文件通常是选项之一，并且有充分的理由使用它！这是你项目的首页，给人留下好印象。

## 一点解释

除了 Sphinx 生成所有 API 文档之外，它还可以用来从重构的格式化文本中创建好看的 HTML。它处理页面和导航菜单之间链接的方式有点迟钝，会让你挠头几次。但是它很有用，而且比你自己写 HTML 要快得多。

你不必成为下一个海明威来开始写文档，只要像你向像你一样的人解释那样写就行了。如果是基于通用原则和库，不要过度解释每一个细节，但是一定要解释你添加的内容和你做出的任何架构决策。不要太担心糟糕的语法和拼写错误，只要你能被理解就好。如果你真的担心你的英语，复制并粘贴到 [Grammerly](https://app.grammarly.com/) 让它帮你检查。

正如他们所说，一张图片胜过千言万语，在很多情况下，图表是救命稻草。我使用 [Lucidchart](https://www.lucidchart.com) 快速、简单、清晰地绘制技术图表。我将图导出为 png，并将它们包含在 repo 中，因此它们是任何生成的文档的一部分。一只装满盒子和一些箭头的手所能传达的东西令人惊叹。

# 测试:如果你不能测试它，你就不能信任它。

我们都知道，或者至少应该知道，编写测试代码是我们都应该做的事情，但是就像从健康饮食到定期锻炼的所有好事情一样，它并不那么有趣。我们都想进入下一个有趣的工作，花更少的时间写测试，但这是必须要做的。

## 测试应该是自动的

自动化测试是唯一真正的方法，你可以确定你所做的任何改变，做了它们应该做的，并且没有破坏任何不应该破坏的东西。它不应该依赖于某人花费几个小时甚至几分钟来检查测试清单，以确保你的代码工作。测试应该经常自动运行。在 CI/CD 领域，应该在每次提交 git repo、每次合并和每个标记时都这样做。

如果你是自动化测试的新手，一开始这看起来绝对是一件痛苦的事情。但是从小处着手。在代码中实例化一些较小的类，加载一些初始数据，断言一些属性。会很好玩的！好吧，不好玩，但是从小做起。

每次签入代码时都运行测试的 Gitlab CI 文件。

## 听起来很棒，但是不适合我…

一些没有参加过测试的人经常抱怨，他们很费时间，而且他们的代码不容易测试。首先，时间无论如何都是要花的，它要么在构建自动化测试的最前面，要么在调试生产系统的部署管道中被推得更远。提前做这件事效率会高几个数量级。第二，如果代码不容易测试，那么它就表明应用程序代码的构造方式存在问题，并且会进一步显示出漏洞。重构应用程序代码使之更容易测试将会使它变得更好。

## 这是如何工作的？

编写大量测试用例的一个被忽视的好处是，它成为你的文档的有益补充。通过更高层次的测试，您可以演示如何使用已创建的应用程序类的整个设置、用法和最佳实践。您给新开发人员的指导之旅的第一站是通过自动化测试，它应该以详细和清晰的方式引导他们完成使用。测试代码不像应用程序代码，不应该被重构，它是为了一步一步来，并且是显式的。它不应该被优化。说真的，疯狂地使用长变量名，假装你是一天的 Java 开发人员。这看起来很难看，但是代码在做什么是很清楚的。

## 你已经搞定了

在你让自己加快速度进行一些测试之后，你会想要做一个覆盖报告。这对于计算出测试覆盖了多少应用程序代码非常有用。你不能测试你的应用程序将会遇到的每一种可能性，但是至少你可以确保每一行都像它应该的那样执行。像 nose2 这样的测试运行程序可以生成 HTML 覆盖率报告，然后作为自动化测试的一部分发布。覆盖率报告可以作为一个测试质量的指示器，你可以用它来在分支被完全测试之前阻止它们进入主测试。

# 自动化:一次是实验，两次是脚本

自动化一切。如果你发现你已经多次运行一个命令来做某件事，那么它应该在一个脚本中。如果您需要设置一个开发环境超过零次，那么您应该编写脚本。如果你在一个企业环境中，仅限于使用 Windows 笔记本电脑进行开发，那么你可以做得比看[流浪者](https://www.vagrantup.com/)更糟糕。它允许您使用 VirtualBox 创建一个作为 VM 运行的开发环境，并使用所有您喜欢的桌面代码编辑器进行实际开发。给你两全其美的东西。

我在让它在公司代理后面可靠地工作时遇到了一些问题，所以我已经转移到运行完整桌面环境的 Ubuntu VM。如果你的笔记本电脑有足够的马力来做这件事，那会很有帮助，但情况并非总是如此。Linux 的 windows 子系统(WSL)有一个乌托邦式的未来，但还没有实现。

## 让我为你安排一下

创建金色图像盒是危险的，不应该这样做，但是每个人仍然这样做。如果您的服务器已经调整了一段时间，并且一切都是手动安装的，那么当需要添加另一个节点或在驱动器出现故障后重新安装时，您将会感到非常痛苦。通过使用[流浪者](https://www.vagrantup.com/)、[停靠者](https://www.docker.com/)或者仅仅是虚拟机，你可以非常快速地迭代设置脚本，而不需要一大群服务器来进行测试。最好的设置脚本应该为您提供一个准备就绪的环境，并且能够运行您已经设置的所有自动化测试。

当您准备好进入容器的世界时，可以在虚拟机上的[流浪者](https://www.vagrantup.com/)设置中使用相同的设置脚本，并在[docker 文件](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)中使用。

我只要改变那个变量名…

# 模块化:让积木而不是大教堂

在处理一个项目时，最常见的事情之一就是不断地向其中添加类和模块。随着时间的推移越来越大。这是导致灾难的原因。

一旦代码库变得足够大，它就会变得太大而无法在头脑中保存。一旦达到这个规模，工作的认知负荷就会变得紧张，这就是错误、捷径和技术债务出现的地方。重构的目标应该是将尽可能多的功能从核心应用程序中移除，放到可重用的模块中。核心应用程序应该处理模块的编排，它本身不应该包含超过几层的代码。理想情况下，模块应该保存在主应用程序的完全独立的 git repos 中。

将软件分解成模块有几个好处。

*   它创建了概念上可管理的代码块，可以在不增加复杂性的情况下进行工作。
*   在模块和核心应用程序之间有一个明确的分离需要清晰的文档和职责划分。
*   模块与主应用程序的隔离使得在一个团队中分配任务变得更加容易。

将代码分解成模块的一个好处是，开发这些模块的努力可以很容易地被其他项目重用，而不会对核心应用程序有很大的依赖性。在只有一个开发人员的小公司中，这是很好的实践。在拥有多个开发团队的大公司中，这是非常有益的。不是所有的项目都能完成，有些项目的生命周期是有限的。因此，能够将工作重新用于其他项目是非常有价值的。

> 想想吧！这个功能需要成为核心的一部分吗？还是它本身就有用？

会议是浪费时间！

# 沟通:会议！我们不需要讨厌的会议！

这是一个相当准确的刻板印象，许多开发人员在更内向的方面犯了错误，并且特别容易有反会议情绪。

普遍的抱怨是，它们太长，太无聊，浪费时间，我真的应该做些更重要的事情。所有这些往往不是真的。试着改变你开会的方式。

从敏捷 Scrum 剧本中吸取经验，有针对性地、有节制地、在有时间限制的情况下使用会议。原则是，你无法避免某种形式的会议，所以以一种集中和有限的方式进行，不要浪费任何人的时间。

你不需要直接对整个团队的沟通进行敏捷风格的改造，从小处着手。总结会议应该持续 15 分钟。更详细的会议可以更长，但需要一个紧凑的议程，并应限制范围。人越多，会议就应该越短，不太可能曲折和偏离主题。人们的时间是宝贵的，下次你在夜店的时候环顾一下房间，看看有多少工时被浪费了。我每天通过 15 分钟的群组视频聊天会议与开发人员开会，会议涉及不同时区的多个地点的开发人员。如果你想在团队中工作得很好，那么你需要交流，了解其他人在做什么并分享。即使他们都在同一栋大楼里，我还是更喜欢为日报进行群组视频聊天，因为这样对他们的工作周期影响较小。但是如果你们都在一层，开一个站立会议，这是一个站起来走动的好借口。

## 敏捷

敏捷已经成为一个时髦的词有一段时间了，它有它的批评者，但是尽管大肆宣传，它在保持团队快乐和参与方面非常有效。很难知道它是否能产生明显更好的项目，但它确实给了开发人员更多的清晰度和控制。使用限时冲刺和清晰的工作量测量减少了开发团队的压力，并帮助他们更好地与管理层沟通。使用像吉拉这样的工具来管理软件项目，你会感觉不像是在问题的海洋中游泳。你实际上可以看到自己在进步。一定会喜欢一个加强版的待办事项列表！

# 最后

在团队中工作，或者只是像在团队中一样工作，就是不要忽略细节，对下一个接触代码的人慷慨大方。十有八九下一个接触代码的人会是你，所以这是让你自己的生活稍微轻松一点的最好方法。