<html>
<head>
<title>How To Cache Http Requests in Angular with Rxjs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Rxjs缓存Angular中的Http请求</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-cache-http-requests-in-angular-with-rxjs-9aa9d59ed044?source=collection_archive---------1-----------------------#2020-02-15">https://itnext.io/how-to-cache-http-requests-in-angular-with-rxjs-9aa9d59ed044?source=collection_archive---------1-----------------------#2020-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a4becac3ad01e7e35e4af7969927745d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T5prJPUu4pbFFDCa.jpg"/></div></div></figure><p id="a173" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我在个人网站上建立portfolio部分时，我想这是一件好事，我应该从Github获得数据，以显示我“自豪”的存储库，我不必担心在前端更新任何信息，因为Github会自动为我做这件事。</p><p id="fa17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一切都进行得非常顺利，直到有一天，我发现了一些有趣的事情，这导致了这篇关于如何用Rxjs缓存HTTP请求的文章。</p><p id="0be8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">问题</strong></p><p id="8c7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每次我浏览页面，它都会发送另一个请求。有时，会出现错误，因为它触及了GitHub API的极限。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kw"><img src="../Images/925c099bfc9cfc97d34e35d534dd192f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTawwZDvT_5gtNIhqNksqg.png"/></div></div></figure><p id="1ef7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最初的方法是使用HttpClient服务来发送请求并从Github获取项目。是因为我每次回到主页，Http请求都会重新触发一次。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="700e" class="lg lh iq lc b gy li lj l lk ll">// Before</span><span id="6995" class="lg lh iq lc b gy lm lj l lk ll">getGitProjects() {<br/>    const filteredProjects = [];    <br/>    try {    <br/>      const projects = await this.http.get(this.gitBaseUrl).toPromise() as GitProject[];    <br/>      for (const project of projects) {    <br/>        if (this.gitProjects.includes(project.name)) {    <br/>          const mappedProject: GitProject = {    <br/>            name: project.name,    <br/>            description: project.description,    <br/>            html_url: project.html_url,    <br/>            language: project.language,    <br/>            stargazers_count: project.stargazers_count,    <br/>            forks: project.forks    <br/>          };    <br/>          filteredProjects.push(mappedProject)    <br/>        }    <br/>      }    <br/>    } catch (error) {    <br/>      captureException(error)    <br/>      console.error(error)    <br/>    }</span><span id="f4f6" class="lg lh iq lc b gy lm lj l lk ll">return filteredProjects<br/>}</span></pre><p id="2c3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于我的读者来说，这是不可接受的，他们会从一个API中多次获取数据。应该有一种方法来缓存结果并使用它。而RXJS恰恰具备了这一点——<strong class="ka ir">分享回放</strong>。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="baa3" class="lg lh iq lc b gy li lj l lk ll">// After</span><span id="3c66" class="lg lh iq lc b gy lm lj l lk ll">getGitProjects(): void {<br/>    this.projects$ = this.http.get&lt;GitProject[]&gt;(this.gitBaseUrl).pipe(<br/>      map(projects =&gt;<br/>        projects.filter(project =&gt; this.gitProjects.includes(project.name))<br/>      ),<br/>      // publishReplay(1),<br/>      // refCount(),<br/>      <strong class="lc ir">shareReplay({ bufferSize: 1, refCount: true }),</strong><br/>      catchError(error =&gt; captureException(error))<br/>    ) as Observable&lt;GitProject[]&gt;<br/>}</span></pre><p id="3b62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">说明</strong>:配合<a class="ae ln" href="https://www.learnrxjs.io/learn-rxjs/operators/multicasting/sharereplay" rel="noopener ugc nofollow" target="_blank">分享回放</a>使用。当我来回导航到主页时，它总是返回数据流中最后发出的值。关于Rxjs 的魔力，还有另外一个有趣的读物，你应该读一读。</p><p id="557b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">优化后，每当我导航到其他页面。它不会发送任何其他请求。</p><p id="70b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果令人满意。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/4f532d6411df00389cb134651790496d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AE5uDhkgD1mp6Ok7fqYa6Q.png"/></div></div></figure><p id="1cf8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">链接到<a class="ae ln" href="https://github.com/dalenguyen/dalenguyen.github.io/blob/dev/apps/portfolio/src/app/shared/services/portfolio.service.ts" rel="noopener ugc nofollow" target="_blank"> portfolio.service.ts </a></p><p id="02a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望这有所帮助；)</p><p id="1cdf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ln" href="https://twitter.com/dale_nguyen" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">在Twitter上关注我</strong> </a>了解Angular、JavaScript &amp; WebDevelopment的最新内容👐</p></div></div>    
</body>
</html>