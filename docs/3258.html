<html>
<head>
<title>Tutorial: Using Azure Event Hubs with the Dapr framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:通过Dapr框架使用Azure事件中心</h1>
<blockquote>原文：<a href="https://itnext.io/tutorial-using-azure-event-hubs-with-the-dapr-framework-81c749b66dcf?source=collection_archive---------3-----------------------#2019-11-06">https://itnext.io/tutorial-using-azure-event-hubs-with-the-dapr-framework-81c749b66dcf?source=collection_archive---------3-----------------------#2019-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3c63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客用一个例子向你展示如何使用<a class="ae kl" href="https://azure.microsoft.com/services/event-hubs/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Azure Event Hubs </strong> </a>与<a class="ae kl" href="https://dapr.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Dapr </strong> </a>集成，这是一组用于微服务开发的分布式系统构建模块。</p><p id="efd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Azure事件中心将被用作<code class="fe km kn ko kp b">Dapr</code>运行时内的“绑定”。这将允许服务与Azure Event Hubs通信，而不需要实际了解它或直接耦合到它(通过SDK、库等)。)，使用由<code class="fe km kn ko kp b">Dapr</code>运行时定义的简单模型。</p><p id="1754" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">听起来好得难以置信？😉请继续阅读…</p><p id="d414" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将:</p><ul class=""><li id="6d58" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated">学习<code class="fe km kn ko kp b">Dapr</code>的基础知识，以及如何为当地发展而设置它</li><li id="a9b4" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">部署您的第一个Dapr应用</li><li id="a94b" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">在Azure上设置事件中心，并尝试一个例子，看看如何使用Dapr集成透明地与它通信</li></ul><blockquote class="le lf lg"><p id="6a0f" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank"><em class="iq">Azure Event Hubs</em></a><em class="iq">是一个完全托管的平台即服务(PaaS)，用于流媒体和事件摄取。它还提供了Apache Kafka支持，使客户端和应用程序能够与事件中心对话，而无需设置、配置和管理您自己的Kafka集群！</em></p></blockquote><h1 id="5315" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Dapr？那是什么？</h1><p id="2b26" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><code class="fe km kn ko kp b">Dapr</code>代表分布式应用运行时。你可以在<a class="ae kl" href="https://cloudblogs.microsoft.com/opensource/2019/10/16/announcing-dapr-open-source-project-build-microservice-applications/" rel="noopener ugc nofollow" target="_blank">这个公告博客</a>中获得所有的独家新闻，但是这里有一个(流行语兼容！)要点让你开始。</p><p id="8d05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它是一个开源的、可移植的运行时，帮助开发人员构建弹性的、微服务的无状态和有状态应用程序。它通过将构建此类应用程序的最佳实践整理成独立的组件来做到这一点。运行时组件公开的功能可以通过HTTP或gRPC访问，这使得它完全不可知，并允许它与任何语言和/或框架一起工作。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mo"><img src="../Images/fce72f312b6cada734b78ce27c40ed97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-_m9-TJ-Zr_Ib-k1"/></div></div></figure><h1 id="3283" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Dapr:工作方式</h1><p id="6c36" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">Dapr采用边车架构，既可以作为单独的容器运行，也可以作为一个进程运行。这意味着应用程序本身不需要包含Dapr运行时作为依赖项。这使得集成变得容易，也提供了关注点的分离。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi na"><img src="../Images/220b7deb41c1f7bfbb3dcf1b8afaaea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1mUTq5hhzLo61uqe"/></div></div></figure><p id="44dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dapr还包括针对<a class="ae kl" href="https://github.com/dapr/go-sdk" rel="noopener ugc nofollow" target="_blank"> Go </a>、<a class="ae kl" href="https://github.com/dapr/java-sdk" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae kl" href="https://github.com/dapr/js-sdk" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>、<a class="ae kl" href="https://github.com/dapr/dotnet-sdk" rel="noopener ugc nofollow" target="_blank">的特定语言SDK。NET </a>和<a class="ae kl" href="https://github.com/dapr/python-sdk" rel="noopener ugc nofollow" target="_blank"> Python </a>。这些SDK通过类型化的语言API而不是调用<code class="fe km kn ko kp b">http/gRPC</code> API来公开Dapr构建块中的功能，如保存状态、发布事件或创建参与者。</p><blockquote class="le lf lg"><p id="b518" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq"> Dapr与平台无关。您可以在任何Kubernetes集群和Dapr集成的其他托管环境上本地运行您的应用程序。</em></p></blockquote><h1 id="9885" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">Dapr组件</h1><p id="fdd5" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在撰写本文时，<code class="fe km kn ko kp b">Dapr</code>处于alpha状态，支持以下分布式系统构建模块，您可以将这些模块插入到您的应用程序中——服务调用、状态管理、发布/订阅消息、资源绑定、分布式跟踪和Actor模式</p><blockquote class="le lf lg"><p id="d9e9" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">如需全面了解，请参考Dapr文档</em> 中的 <a class="ae kl" href="https://github.com/dapr/docs/blob/master/overview.md" rel="noopener ugc nofollow" target="_blank"> <em class="iq"/></a></p></blockquote><p id="5311" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，本文中的示例应用程序利用了Azure事件中心的Dapr绑定。下面是对什么是“绑定”的一点看法。</p><h2 id="5dc7" class="nb lm iq bd ln nc nd dn lr ne nf dp lv jy ng nh lz kc ni nj md kg nk nl mh nm bi translated">Dapr资源绑定</h2><p id="08f1" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">绑定提供了一种通用的方法，通过来自外部系统的事件来触发应用程序，或者通过可选的数据负载来调用外部系统。这些“外部系统”可以是任何东西:队列、消息传递管道、云服务、文件系统等等。</p><blockquote class="le lf lg"><p id="8207" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><a class="ae kl" href="https://github.com/dapr/components-contrib/blob/master/bindings/Readme.md" rel="noopener ugc nofollow" target="_blank"> <em class="iq">目前支持的绑定</em> </a> <em class="iq">包括Kafka、Rabbit MQ、Azure Event Hubs等。</em></p></blockquote><p id="ca25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">简而言之，Dapr绑定允许您专注于业务逻辑，而不是与诸如数据库、发布/订阅系统、blob存储等个别服务集成。</p><ul class=""><li id="d566" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated">您可以利用现成的绑定来集成不同的系统，而无需依赖或包含特定的SDK或库</li><li id="4a07" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">您还可以交换/替换绑定，而无需更改代码</li></ul><p id="fbe9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，理论到此为止！</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ee9f9c3c60b38563b9f358eb9d86043c.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*hUyfN8KiBtSYKHOO.gif"/></div></figure><h1 id="b165" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">先决条件</h1><p id="8f49" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">你可以在任何地方运行<code class="fe km kn ko kp b">Dapr</code>，包括<a class="ae kl" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>，这要感谢它基于第一类<a class="ae kl" href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" rel="noopener ugc nofollow" target="_blank">操作符</a>的支持。因为这是一篇介绍性的博客文章，所以让我们把重点放在端到端的流程上，保持简单，并把<code class="fe km kn ko kp b">Dapr</code>作为一个独立的组件在本地运行。</p><blockquote class="le lf lg"><p id="4624" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated">如果你渴望在Kubernetes上运行 <code class="fe km kn ko kp b"><em class="iq">Dapr</em></code> <em class="iq">，请查看</em> <a class="ae kl" href="https://github.com/dapr/docs/blob/master/getting-started/environment-setup.md#installing-dapr-on-a-kubernetes-cluster" rel="noopener ugc nofollow" target="_blank"> <em class="iq">本入门指南</em> </a> <em class="iq">！</em></p></blockquote><p id="c8eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于示例应用程序，您需要:</p><ul class=""><li id="c4b2" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated"><a class="ae kl" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">码头工人</a></li><li id="c476" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae kl" href="https://golang.org/" rel="noopener ugc nofollow" target="_blank"> Go 1.12以上</a></li><li id="5ba2" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae kl" href="https://azure.microsoft.com/services/event-hubs/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">蔚蓝事件中心</a></li></ul><h1 id="9ac5" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置Dapr</h1><p id="2d60" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">首先安装<a class="ae kl" href="https://github.com/dapr/cli" rel="noopener ugc nofollow" target="_blank"> Dapr CLI </a>，它允许您在本地开发机器或Kubernetes集群上设置Dapr，提供调试支持，启动和管理Dapr实例。</p><p id="3bc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，在你的Mac上，你可以简单地用它来安装<code class="fe km kn ko kp b">Dapr</code>到<code class="fe km kn ko kp b">/usr/local/bin</code></p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="0774" class="nb lm iq kp b gy ns nt l nu nv">curl -fsSL https://raw.githubusercontent.com/dapr/cli/master/install/install.sh | /bin/bash</span></pre><blockquote class="le lf lg"><p id="81a5" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">详见</em> <a class="ae kl" href="https://github.com/dapr/docs/blob/master/getting-started/environment-setup.md#installing-dapr-cli" rel="noopener ugc nofollow" target="_blank"> <em class="iq">单据</em> </a></p></blockquote><p id="ab73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用CLI在独立模式下<a class="ae kl" href="https://github.com/dapr/docs/blob/master/getting-started/environment-setup.md#installing-dapr-in-standalone-mode" rel="noopener ugc nofollow" target="_blank">安装Dapr</a>。你所需要的只是一个简单的命令</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="3df6" class="nb lm iq kp b gy ns nt l nu nv">dapr init</span></pre><p id="44c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">..就是这样！</p><h1 id="cd9d" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">设置Azure事件中心</h1><p id="6608" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">如果你还没有一个<a class="ae kl" href="https://docs.microsoft.com/azure/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">微软Azure账号</a>，那就去<a class="ae kl" href="https://azure.microsoft.com/free/?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">注册一个免费的吧！</a>完成后，您可以使用以下快速入门工具之一快速设置Azure活动中心:</p><ul class=""><li id="62b8" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated">Azure门户网站— <a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/event-hubs-create?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">这里是一个分步指南</a></li><li id="8843" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">Azure CLI或Azure Cloud shell(在您的浏览器中！)— <a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/event-hubs-quickstart-cli?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">这里有一个分步指南</a></li></ul><p id="2fc1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您应该有一个带有名称空间<a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/event-hubs-features?WT.mc_id=medium-blog-abhishgu#namespace" rel="noopener ugc nofollow" target="_blank">和相关事件中心(主题)的事件中心实例。作为最后一步，您需要获取连接字符串，以便</a><a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/authenticate-shared-access-signature?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">向事件中心</a> — <a class="ae kl" href="https://docs.microsoft.com/azure/event-hubs/event-hubs-get-connection-string?WT.mc_id=medium-blog-abhishgu" rel="noopener ugc nofollow" target="_blank">进行身份验证。使用本指南</a>完成此步骤。</p><h1 id="7ba8" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用输入绑定接收事件中心数据</h1><p id="d2b0" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated"><code class="fe km kn ko kp b">Dapr</code>中的一个输入绑定表示一个事件资源，<code class="fe km kn ko kp b">Dapr</code>用它来从您的应用程序中读取事件并将其推送到您的应用程序中。让我们运行一个应用程序，使用它从Azure事件中心接收数据。</p><h1 id="ac90" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用Dapr运行应用程序</h1><p id="388b" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">从克隆repo开始，并切换到正确的目录</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="2a34" class="nb lm iq kp b gy ns nt l nu nv">git clone https://github.com/abhirockzz/dapr-eventhubs-bindings<br/>cd input-binding-app</span></pre><p id="6ce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新<code class="fe km kn ko kp b">components/eventhubs_binding.yaml</code>以在<code class="fe km kn ko kp b">spec.metadata.value</code>部分包含Azure Event Hubs连接字符串。请注意，您必须附加事件中心的名称来结束连接字符串，即<code class="fe km kn ko kp b">;EntityPath=&lt;EVENT_HUBS_NAME&gt;</code>。下面是<code class="fe km kn ko kp b">connectionString</code>属性的值应该是什么样子:</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="d637" class="nb lm iq kp b gy ns nt l nu nv">Endpoint=sb://&lt;EVENT_HUBS_NAMESPACE&gt;.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=&lt;EVENT_HUBS_KEY&gt;;EntityPath=&lt;EVENT_HUBS_NAME&gt;</span></pre><p id="2221" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动使用Azure事件中心输入绑定的Go应用程序</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="9f64" class="nb lm iq kp b gy ns nt l nu nv">export APP_PORT=8080<br/>dapr run --app-port $APP_PORT go run app.go</span></pre><p id="ad4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你应该看看日志</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="340d" class="nb lm iq kp b gy ns nt l nu nv">== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="starting Dapr Runtime -- version 0.1.0 -- commit 4358565-dirty"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="log level set to: info"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="standalone mode configured"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="dapr id: foobar"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="loaded component messagebus (pubsub.redis)"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="loaded component timebound (bindings.azure.eventhubs)"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="loaded component statestore (state.redis)"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="application protocol: http. waiting on port 8080"<br/>== DAPR == time="2019-10-29T06:32:07+05:30" level=info msg="application discovered on port 8080"<br/>.....</span></pre><h1 id="9129" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">运行Azure事件中心生成器应用程序</h1><p id="af80" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">这款应用使用<a class="ae kl" href="https://github.com/Azure/azure-event-hubs-go" rel="noopener ugc nofollow" target="_blank"> Azure Event Hubs native Go客户端</a>发送消息。</p><p id="2a7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置所需的环境变量:</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="3e66" class="nb lm iq kp b gy ns nt l nu nv">export EVENT_HUBS_NAMESPACE="&lt;EVENT_HUBS_NAMESPACE&gt;"<br/>export EVENT_HUBS_KEY="&lt;EVENT_HUBS_KEY&gt;"<br/>export EVENT_HUB_NAME="&lt;EVENT_HUB_NAME&gt;"</span></pre><blockquote class="le lf lg"><p id="0c7c" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">请确保事件中心的名称与您在输入绑定配置中为连接字符串配置的名称相同</em></p></blockquote><p id="d8aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行producer应用程序——它将向事件中心发送五条消息并退出</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="5ea4" class="nb lm iq kp b gy ns nt l nu nv">cd eventhubs-producer<br/>go run producer.go</span></pre><h1 id="76d0" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">确认</h1><p id="6fe7" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">检查Dapr应用程序日志，您应该看到从事件中心收到的消息。</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="a219" class="nb lm iq kp b gy ns nt l nu nv">== APP == time from Event Hubs 'Thu Oct 31 16:57:45 2019'<br/>== APP == time from Event Hubs 'Thu Oct 31 16:57:49 2019'<br/>== APP == time from Event Hubs 'Thu Oct 31 16:57:52 2019'<br/>== APP == time from Event Hubs 'Thu Oct 31 16:57:54 2019'<br/>== APP == time from Event Hubs 'Thu Oct 31 16:57:56 2019'</span></pre><h1 id="af27" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">在幕后</h1><p id="5a25" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">下面是其工作原理的总结:</p><p id="0172" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">输入绑定</strong></p><p id="f408" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">配置文件<code class="fe km kn ko kp b">eventhub_binding.yaml</code>捕获Azure事件中心的连接字符串。</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="8ce6" class="nb lm iq kp b gy ns nt l nu nv">apiVersion: dapr.io/v1alpha1<br/>kind: Component<br/>metadata:<br/>  name: eventhubs-input<br/>spec:<br/>  type: bindings.azure.eventhubs<br/>  metadata:<br/>  - name: connectionString<br/>    value: Endpoint=sb://&lt;EVENT_HUBS_NAMESPACE&gt;.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=&lt;KEY&gt;;EntityPath=&lt;EVENT_HUBS_NAME&gt;</span></pre><p id="ef4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关键属性包括:</p><ul class=""><li id="6007" class="kq kr iq jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated"><code class="fe km kn ko kp b">metadata.name</code> -输入绑定组件的名称</li><li id="96f9" class="kq kr iq jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><code class="fe km kn ko kp b">spec.metadata.name</code> -事件集线器连接字符串</li></ul><blockquote class="le lf lg"><p id="71be" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">请注意，连接字符串包含代理URL ( </em> <code class="fe km kn ko kp b"><em class="iq">&lt;EVENT_HUBS_NAMESPACE&gt;.servicebus.windows.net</em></code> <em class="iq">)、主键(用于身份验证)的信息，还包含主题或事件中心的名称，您的应用程序将绑定到该主题或事件中心并从其接收事件。</em></p></blockquote><p id="f877" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用app中的绑定</strong></p><p id="af78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Go应用程序在<code class="fe km kn ko kp b">/eventhubs-input</code>处公开了一个REST端点——这与输入绑定组件的名称相同(不是巧合！)</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="6a9a" class="nb lm iq kp b gy ns nt l nu nv">func main() {<br/>    http.HandleFunc("/eventhubs-input", func(rw http.ResponseWriter, req *http.Request) {<br/>        var _time TheTime<br/>        err := json.NewDecoder(req.Body).Decode(&amp;_time)<br/>        if err != nil {<br/>            fmt.Println("error reading message from event hub binding", err)<br/>            rw.WriteHeader(500)<br/>            return<br/>        }<br/>        fmt.Printf("time from Event Hubs '%s'\n", _time.Time)<br/>        rw.WriteHeader(200)<br/>    })<br/>    http.ListenAndServe(":"+port, nil)<br/>}</span></pre><p id="89d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dapr运行时负责从事件中心进行消费，并确保它在带有事件有效负载的<code class="fe km kn ko kp b">/eventhubs-input</code>端点使用<code class="fe km kn ko kp b">POST</code>请求调用Go应用程序。然后执行app逻辑，在这种情况下只是记录到标准输出。</p><h1 id="f6ef" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">将数据发送到带有输出绑定的事件中心数据</h1><p id="14d4" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">输出绑定表示一个资源，<code class="fe km kn ko kp b">Dapr</code>将调用该资源并向其发送消息。让我们使用一个输出绑定向事件中心发送数据。</p><h1 id="cf09" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用Dapr运行应用程序</h1><p id="e2e6" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">转到正确的目录</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="88e5" class="nb lm iq kp b gy ns nt l nu nv">cd output-binding-app</span></pre><p id="c569" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新<code class="fe km kn ko kp b">components/eventhubs_binding.yaml</code>以在<code class="fe km kn ko kp b">spec.metadata.value</code>部分包含Azure Event Hubs连接字符串。请注意，您必须附加事件中心的名称来结束连接字符串，即<code class="fe km kn ko kp b">;EntityPath=&lt;EVENT_HUBS_NAME&gt;</code>。下面是<code class="fe km kn ko kp b">connectionString</code>属性的值应该是什么样子:</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="4362" class="nb lm iq kp b gy ns nt l nu nv">Endpoint=sb://&lt;EVENT_HUBS_NAMESPACE&gt;.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=&lt;EVENT_HUBS_KEY&gt;;EntityPath=&lt;EVENT_HUBS_NAME&gt;</span></pre><p id="d47f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动使用Azure事件中心输出绑定的Go应用程序。它将快速连续地向Dapr绑定HTTP端点发送五条消息，然后退出。</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="e366" class="nb lm iq kp b gy ns nt l nu nv">dapr run --port 3500 go run app.go</span></pre><p id="9be5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在应用程序中，您将看到日志:</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="5c8f" class="nb lm iq kp b gy ns nt l nu nv">== APP == sent message {"data": {"time":"2019-10-31 17:18:07.602377 +0530 IST m=+0.000569729"}}<br/>== APP == response 200 OK<br/>== APP == sent message {"data": {"time":"2019-10-31 17:18:12.375237 +0530 IST m=+4.773393815"}}<br/>== APP == response 200 OK<br/>== APP == sent message {"data": {"time":"2019-10-31 17:18:14.504914 +0530 IST m=+6.903055209"}}<br/>== APP == response 200 OK<br/>== APP == sent message {"data": {"time":"2019-10-31 17:18:16.637992 +0530 IST m=+9.036116365"}}<br/>== APP == response 200 OK<br/>== APP == sent message {"data": {"time":"2019-10-31 17:18:18.763691 +0530 IST m=+11.161800122"}}<br/>== APP == response 200 OK<br/>== APP == finished sending messages... use ctrl+c to exit</span></pre><p id="b4cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着消息是通过Dapr输出绑定发送到Azure Event Hub的</p><p id="8a14" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在接收器(输入绑定)应用程序中，您应该看到</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="0ecb" class="nb lm iq kp b gy ns nt l nu nv">== APP == time from Event Hubs '2019-10-31 17:18:07.602377 +0530 IST m=+0.000569729'<br/>== APP == time from Event Hubs '2019-10-31 17:18:12.375237 +0530 IST m=+4.773393815'<br/>== APP == time from Event Hubs '2019-10-31 17:18:14.504914 +0530 IST m=+6.903055209'<br/>== APP == time from Event Hubs '2019-10-31 17:18:16.637992 +0530 IST m=+9.036116365'<br/>== APP == time from Event Hubs '2019-10-31 17:18:18.763691 +0530 IST m=+11.161800122'</span></pre><blockquote class="le lf lg"><p id="a5c3" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">为了简单起见，我们对输入和输出绑定示例使用了相同的事件中心主题。实际上，它们可以独立使用，即需要由事件中心以事件驱动的方式触发的应用程序可以订阅主题(通过Dapr ),而需要将数据推送到事件中心(不同主题)的另一个应用程序可以使用Dapr将HTTP端点绑定到</em> <code class="fe km kn ko kp b"><em class="iq">POST</em></code> <em class="iq">事件数据。</em></p></blockquote><h1 id="2bab" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">在幕后</h1><p id="4cbb" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">输出绑定配置与输入绑定保持相同。</p><p id="368c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Go应用程序通过输出绑定向事件中心发送消息。它通过向Dapr HTTP端点<code class="fe km kn ko kp b">http://localhost:&lt;dapr_port&gt;/v1.0/bindings/&lt;output_binding_name&gt;</code>发送一个<code class="fe km kn ko kp b">POST</code>请求来实现这一点。</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="f796" class="nb lm iq kp b gy ns nt l nu nv">....<br/>const daprURL = "http://localhost:3500/v1.0/bindings/eventhubs-output"<br/>go func() {<br/>    ....<br/>	for i := 1; i &lt;= 5; i++ {<br/>		body := fmt.Sprintf(format, time.Now().String())<br/>		resp, err := http.Post(daprURL, contentType, strings.NewReader(body))<br/>        .....<br/>		fmt.Println("sent message", body)<br/>		fmt.Println("response", resp.Status)<br/>		time.Sleep(2 * time.Second)<br/>	}<br/>	done &lt;- true<br/>}()<br/>....</span></pre><p id="8dc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，输出绑定的名称是<code class="fe km kn ko kp b">eventhubs-output</code>，Dapr HTTP端口是<code class="fe km kn ko kp b">3500</code>，端点URL是:</p><pre class="mp mq mr ms gt no kp np nq aw nr bi"><span id="5998" class="nb lm iq kp b gy ns nt l nu nv"><a class="ae kl" href="http://localhost:3500/v1.0/bindings/eventhubs-output" rel="noopener ugc nofollow" target="_blank">http://localhost:3500/v1.0/bindings/eventhubs-output</a></span></pre><p id="e3ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与输入绑定一样，<code class="fe km kn ko kp b">Dapr</code>运行时负责将事件发送到事件中心。由于我们运行了输入绑定应用程序，它接收有效负载并显示在日志中。</p><h1 id="973f" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">摘要</h1><p id="a667" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在这篇博文中，您看到了如何使用<code class="fe km kn ko kp b">Dapr</code>“绑定”通过Azure Event Hubs连接和集成您的应用程序，而无需了解它！相反，您使用Dapr HTTP API通过Dapr运行时(只是一个sidecar)进行连接。</p><blockquote class="le lf lg"><p id="6c26" class="jn jo lh jp b jq jr js jt ju jv jw jx li jz ka kb lj kd ke kf lk kh ki kj kk ij bi translated"><em class="iq">也可以使用gRPC或特定语言的SDK(如前所述)</em></p></blockquote><p id="af3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在撰写本文时，<code class="fe km kn ko kp b">Dapr</code>正处于alpha状态(<code class="fe km kn ko kp b">v0.1.0</code>)，并乐于接受社区贡献😃参观https://github.com/dapr/dapr<a class="ae kl" href="https://github.com/dapr/dapr" rel="noopener ugc nofollow" target="_blank">潜水吧！</a></p><p id="6a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你觉得这篇文章有帮助，请喜欢并关注🙌很高兴通过<a class="ae kl" href="https://twitter.com/abhi_tweeter" rel="noopener ugc nofollow" target="_blank"> Twitter </a>获得反馈或发表评论。</p></div></div>    
</body>
</html>