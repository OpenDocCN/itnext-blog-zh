<html>
<head>
<title>Things I Wish I Knew Before Enabling Feature Toggle In My Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在我的应用程序中启用功能切换之前我希望知道的事情</h1>
<blockquote>原文：<a href="https://itnext.io/things-to-think-before-enabling-feature-toggle-in-your-application-91880373a0ed?source=collection_archive---------4-----------------------#2020-05-19">https://itnext.io/things-to-think-before-enabling-feature-toggle-in-your-application-91880373a0ed?source=collection_archive---------4-----------------------#2020-05-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/fdb7c6fbee409104bbf60d8cf64f0f57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IAzzUs_1fVZh0Ym6yfLyBw.gif"/></div></div></figure><div class=""/><p id="f446" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://martinfowler.com/articles/feature-toggles.html" rel="noopener ugc nofollow" target="_blank"> Feature toggle(又名Feature Flags) </a>是软件开发中的一种技术，它试图提供一种替代方法来维护多个源代码分支，从而在不改变代码的情况下修改系统行为。</p><p id="6eae" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">激活和取消激活特性可以保证在这个过程中间发生故障时有更好的响应时间，例如:在激活特性一段时间后，您通过日志记录仪表板注意到来自添加的新代码流的大量错误。监控权力是分散的，工程和产品团队也可以使用，确保在许多情况下响应时间比新部署快得多</p><p id="bf83" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">经过多次体验，这篇文章的目的是在你的应用程序中创建特性切换之前，提出一些需要注意的要点。</p><h2 id="3d61" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">切换类型</h2><p id="55a4" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">首先，了解当今存在哪些不同类型的触发器是很重要的</p><ul class=""><li id="7783" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc"> Release Toggle: </strong>通常用于基于主干的开发，这种类型的Toggle提供了一种将未完成和未测试的功能投入生产的方法。代码是<strong class="ka jc">随时可以部署</strong>到生产中而没有副作用。预期寿命是几天。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi me"><img src="../Images/4536df870a7eb59a1ca1d8a18375bd51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*blNYhs8vNKsIFlxTlzF58w.jpeg"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">Gitflow发布分支由<a class="ae kw" href="https://www.atlassian.com/br/git/tutorials/comparing-workflows/gitflow-workflow" rel="noopener ugc nofollow" target="_blank"> Atlassian </a></figcaption></figure><ul class=""><li id="1943" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">实验Toggle: </strong>用于测试一个理论，一般用于受控A/B测试。<strong class="ka jc"> </strong>预期寿命是<strong class="ka jc"> </strong>几天或几周，也就是理论测试结束的时候。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mn"><img src="../Images/29b0d285b13d36c6dc87f27a546933c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YtvxgiRfwJjPoCOv.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">A/B测试</figcaption></figure><ul class=""><li id="60d6" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc"> Ops Toggle: </strong>用于推出一项功能，并在少量用户部分进行测试，然后逐步发布给所有人。<strong class="ka jc">预期寿命是</strong>长寿(月/年)</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mo"><img src="../Images/5eff08556d5e8579b897c1003c449422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JsghafNuE3z4HMaoxGx-Nw.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">软启动由<a class="ae kw" href="https://launchdarkly.com/blog/soft-launches-using-feature-flags/" rel="noopener ugc nofollow" target="_blank">黑暗启动</a></figcaption></figure><ul class=""><li id="df99" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">权限切换:</strong>最常用于控制对某个功能的访问，例如只对特定用户发布的功能。预期寿命是长寿(岁)</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/1b704b40ce7c8324ba437b392de7a07d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPxqNMbv_kS7JLRiFNb1uw.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">网飞流媒体计划</figcaption></figure><p id="6a7a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些不同的类型可以在该图中进行总结，该图表示为:Y轴上是时间，X轴上是如何激活或停用切换。</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/f6a767ffbc7465055d419695ae5c8a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-n99zeSAVvBjn6j2.png"/></div></div></figure><h2 id="cbd2" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated"><strong class="ak">解决方案</strong></h2><p id="e92b" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">最困难决定是决定采用哪种解决方案，换句话说，您将如何调整您的代码以提供一种更简单的方式来启用或禁用功能，而不需要任何部署。</p><p id="e4e4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通常有两条路可以走:</p><ul class=""><li id="cc20" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">自制解决方案:</strong>这种方法的最大优势是创建一个100%符合您的用例的解决方案，下面是这种类型的应用程序通常如何工作的示例:</li><li id="ec88" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">总之，您的应用程序查询一个名为toggle service的服务，该服务负责缓存toggle，如果在缓存中找不到toggle，则搜索它，然后搜索数据库。如果出现问题，你需要提供一个本地或托管文件(S3或类似文件)的回退，所有切换状态通常是<strong class="ka jc">禁用。</strong></li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/3a3085530239e3855ca93eff6cf426b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5LfitVx6h96AER5o2GmuuQ.png"/></div></div></figure><ul class=""><li id="e590" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">或者，您可以包括一个管理这些切换的前端:</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/4dbd7173b8b5c423d9ae10d309040926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tm1XBmfbofbK-hvHrPuQCQ.png"/></div></div></figure><ul class=""><li id="c189" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">现成的解决方案:</strong>经过一段时间的推广toggles，一些现成的工具被创造出来以满足这种需求，下面是一些现成的解决方案:<a class="ae kw" href="https://launchdarkly.com/" rel="noopener ugc nofollow" target="_blank">launch darky</a>、<a class="ae kw" href="https://github.com/FredKSchott/fflip" rel="noopener ugc nofollow" target="_blank"> fflip </a>、<a class="ae kw" href="https://firebase.google.com/docs/remote-config" rel="noopener ugc nofollow" target="_blank"> Firebase Remote Config </a>和<a class="ae kw" href="https://unleash.github.io/" rel="noopener ugc nofollow" target="_blank"> Unleash </a>，其中最完整也是付费的是<strong class="ka jc">launch darky</strong>。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/56bcfc1b10c79abbc2c1a88d5a5e8e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DMbjC1IgI_ZBfoYl.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">启动深色仪表板示例</figcaption></figure><ul class=""><li id="ff7b" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">在分析这些工具时，最重要的事情是，如果这些工具具有您计划要做的所有类型的切换，无论它是否具有针对您项目技术的SDK，或者集成必须通过REST来完成，这个因素都会大大增加实现的复杂性。</li><li id="2921" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">同样重要的是，价格是一个决定性因素，在这种情况下，我推荐<a class="ae kw" href="https://unleash.github.io/" rel="noopener ugc nofollow" target="_blank"> Unleash </a>:是一个非常完整的解决方案，拥有官方SDK，适用于:Java、Node.js、Go、Ruby、Python和。而且它是开源的。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/a4435f7ba9f1c855258c05820236fd1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kFQLMAguglew8ogI.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">释放仪表板</figcaption></figure><h2 id="c221" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">响应时间</h2><p id="9996" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">在此处建议的所有解决方案中，都实施了缓存解决方案，做出这一决定非常重要，因为在出现故障时，如果您的应用程序崩溃，这一点将会“着火”。</p><p id="36b9" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">问问自己:</p><ul class=""><li id="f7a1" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">用户在使用应用时的平均使用时间是多少？</li><li id="9ef9" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">切换的缓存时间是多少？</li><li id="ec2b" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">如果应用程序崩溃，您的哪个监控会这么说？</li></ul><p id="d3a7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据您正在开发的项目的类型，所有这些问题都可能发生巨大的变化，并且还涉及到在出现问题时改善响应时间，并且在出现问题时不会影响用户体验。</p><h2 id="111c" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">用户体验</h2><p id="9e49" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">这个主题根据您正在创建的项目的类型有很大的不同，但是对于任何应用程序，您都可以遵循一个重要的规则</p><blockquote class="mz"><p id="fec4" class="na nb jb bd nc nd ne nf ng nh ni kv dk translated">当使用用户可见的任何现有功能时，激活和去激活切换应该永远不会干扰用户体验</p></blockquote><p id="0ecc" class="pw-post-body-paragraph jy jz jb ka b kb nj kd ke kf nk kh ki kj nl kl km kn nm kp kq kr nn kt ku kv ij bi translated">特别是在前端项目中，你可以有一个长的用户流，有三种方法来获取切换的状态，换句话说，如果他们被激活或没有。</p><ul class=""><li id="7013" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">登录时:</strong>如果您的初始页面没有任何特殊内容，并且UX总是从登录页面开始，通常这是获取切换状态的最佳时间。</li><li id="4c92" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated"><strong class="ka jc">页面加载时:</strong>如果您的页面在初始加载时没有登录，并且有重要功能，此时您将进入切换状态。</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/cc4af56e8d4538f4bba443aaba5d29cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6WkxyNvL-v-ySZAsRjjAfw.gif"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">Amaro.com加载页面示例</figcaption></figure><ul class=""><li id="42de" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated"><strong class="ka jc">每次需要的时候:</strong>这种方法特别适合带有独立端点的REST API。这种方法的主要问题可能是重复。有时，在使用基于组件的架构的前端项目中，可能有父子组件需要查看与切换相同的状态，为了实现这一点而不是每次都“重新提取”切换，必须在应用程序中进行定制实现，这增加了功能的复杂性</li></ul><h2 id="fced" class="kx ky jb bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">我的两分钱</h2><p id="6ced" class="pw-post-body-paragraph jy jz jb ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">以下是我的两点看法，以及我过去创作toggles的经验:</p><ul class=""><li id="f5cc" class="lv lw jb ka b kb kc kf kg kj lx kn ly kr lz kv ma mb mc md bi translated">toggle是一种技术性债务，有时你必须删除它，在现实生活中，随着时间的推移，它会变得更加“昂贵”。</li><li id="a013" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">在开始实施之前，定义肘节的类型和预期寿命。</li><li id="c176" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">移除切换时，建议不要重构流。</li><li id="c971" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">放置切换时，不要触及旧的业务逻辑。</li><li id="e04a" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">测试应该覆盖代码变化，即使它们是暂时的。</li><li id="6808" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">不要忘记什么类型的用户会使用特性切换应用程序，用户也就是开发人员和其他人，比如产品负责人、产品经理、Scrum Master。等等…)，给他们一个简单的方法来理解什么是特征切换，存在什么类型，它们是做什么的，最重要的是它们如何激活或去激活。</li><li id="cfe6" class="lv lw jb ka b kb mq kf mr kj ms kn mt kr mu kv ma mb mc md bi translated">跟随最新的<a class="ae kw" href="https://www.thoughtworks.com/radar/techniques" rel="noopener ugc nofollow" target="_blank">技术雷达关于技术</a>，尽可能保持你的特性切换简单</li></ul><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/bdc7dd4e0f88d3f0b10d91664b125817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ro_W0nXntlvGKSMM6gPfkg.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">技术雷达2020</figcaption></figure></div></div>    
</body>
</html>