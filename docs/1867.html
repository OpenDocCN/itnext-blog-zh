<html>
<head>
<title>How to Debug .NET Core Lambda Functions Locally with the Serverless Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何调试。NET Core Lambda使用无服务器框架在本地运行</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-debug-net-core-lambda-functions-locally-with-the-serverless-framework-dd1670bc22e2?source=collection_archive---------0-----------------------#2019-02-13">https://itnext.io/how-to-debug-net-core-lambda-functions-locally-with-the-serverless-framework-dd1670bc22e2?source=collection_archive---------0-----------------------#2019-02-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d2c9653cddd87c73d89161a91da74876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ENlg3jR5TQ6PBnOE_IFABg.jpeg"/></div></div></figure><p id="939b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大多数开发人员都知道，在试图识别代码中出现的令人难以置信的问题时，调试是可以使生活变得容易得多的任务之一。一段时间以来，无服务器框架已经能够<a class="ae kz" href="https://serverless.com/framework/docs/providers/aws/cli-reference/invoke-local/" rel="noopener ugc nofollow" target="_blank"> <em class="la">本地调用用NodeJS、Python、Java和Ruby编写的</em> </a> Lambda函数，或者使用<a class="ae kz" href="https://github.com/dherault/serverless-offline" rel="noopener ugc nofollow" target="_blank"> <em class="la">无服务器离线</em> </a>插件(以及许多变体，如Python的插件)本地运行它们。迄今为止，这似乎是极其困难的。NET核心开发人员做的。我自己和我所知道的其他开发人员。NET已经求助于仅仅将所有事情记录到控制台，构建和部署AWS来查看哪里出错了。</p><p id="cee2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在事情发生了变化，作为<a class="ae kz" href="https://github.com/aws/aws-lambda-dotnet/tree/master/Tools/LambdaTestTool" rel="noopener ugc nofollow" target="_blank"> AWS的<a class="ae kz" href="https://github.com/aws/aws-lambda-dotnet/pull/364" rel="noopener ugc nofollow" target="_blank"> 0.9.0 </a>版本的一部分。NET Mock Lambda测试工具</a>您现在可以调试您的。NET Core Lambda函数是在无服务器框架中创建的——让我向您展示如何实现！</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h2 id="013a" class="li lj it bd lk ll lm dn ln lo lp dp lq km lr ls lt kq lu lv lw ku lx ly lz ma bi translated">安装工具</h2><p id="335a" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">其中一些步骤基于工具本身提供的设置指南，我还将设置Visual Studio代码，这是我用来开发的工具。NET Lambda函数— Visual Studio和JetBrains Rider支持也是可用的。</p><p id="21e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些工具可以通过运行<em class="la">点网工具安装命令</em>来安装——记住这是一个全局工具，需要包含参数-g:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="7b25" class="li lj it ml b gy mp mq l mr ms">dotnet tool install -g Amazon.Lambda.TestTool-2.1</span></pre><h2 id="c10b" class="li lj it bd lk ll lm dn ln lo lp dp lq km lr ls lt kq lu lv lw ku lx ly lz ma bi translated">设置和配置您的项目</h2><p id="255e" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">我将从我们自己的无服务器框架模板中创建一个示例项目，尽管您可以向任何无服务器框架项目添加调试。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="da01" class="li lj it ml b gy mp mq l mr ms">sls create --template-url <a class="ae kz" href="https://github.com/effectivedigital/serverless-templates/tree/master/combined" rel="noopener ugc nofollow" target="_blank">https://github.com/effectivedigital/serverless-templates/tree/master/combined</a> --path debugger</span></pre><p id="5a52" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在项目的根目录下，创建一个名为<em class="la">“AWS-lambda-tools-defaults . JSON”</em>的文件，并使用下面的对象填充它。如果您在本地使用不同的IAM概要文件和区域来连接到项目的AWS，请确保更新概要文件和区域。我们使用<a class="ae kz" href="https://github.com/Versent/saml2aws" rel="noopener ugc nofollow" target="_blank"> saml2aws </a>对我们所有的aws帐户进行身份验证，并让它将凭证保存到默认配置文件中。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="943f" class="li lj it ml b gy mp mq l mr ms">{  <br/>    "profile":"default",<br/>    "region" : "ap-southeast-2",<br/>    "configuration": "Release",<br/>    "framework": "netcoreapp2.1",<br/>    "template": "serverless.yml"<br/>}</span></pre><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/64583169ff15eebe042686f9f0706ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHr4GNFOfbiEnLUns42o7A.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">aws-lambda-tools-defaults.json的一个例子</figcaption></figure><p id="69b3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，您需要向Visual Studio代码添加调试配置:</p><ol class=""><li id="4eb2" class="my mz it kd b ke kf ki kj km na kq nb ku nc ky nd ne nf ng bi translated">导航到<em class="la">调试</em>界面</li><li id="9d65" class="my mz it kd b ke nh ki ni km nj kq nk ku nl ky nd ne nf ng bi translated">在播放符号旁边的下拉菜单中，选择<em class="la">“添加配置”</em>项，并选择<em class="la">。网核</em>为环境。</li><li id="e389" class="my mz it kd b ke nh ki ni km nj kq nk ku nl ky nd ne nf ng bi translated">一个名为<em class="la">“launch . JSON”</em>的文件将会打开，删除文件中的所有内容，并用下面的内容填充它。</li></ol><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="07f3" class="li lj it ml b gy mp mq l mr ms">{<br/>    // Use IntelliSense to learn about possible attributes.<br/>    // Hover to view descriptions of existing attributes.<br/>    // For more information, visit: <a class="ae kz" href="https://go.microsoft.com/fwlink/?linkid=830387" rel="noopener ugc nofollow" target="_blank">https://go.microsoft.com/fwlink/?linkid=830387</a><br/>    "version": "0.2.0",<br/>    "configurations": [    <br/>        {<br/>            "name": ".NET Core Launch (console)",<br/>            "type": "coreclr",<br/>            "request": "launch",<br/>            "preLaunchTask": "build",<br/>            "program": "C:/Users/${env:USERNAME}/.dotnet/tools/dotnet-lambda-test-tool-2.1.exe",<br/>            "args": [],<br/>            "cwd": "${workspaceFolder}",<br/>            "console": "internalConsole",<br/>            "stopAtEntry": false,<br/>            "internalConsoleOptions": "openOnSessionStart"<br/>        },<br/>        {<br/>            "name": ".NET Core Attach",<br/>            "type": "coreclr",<br/>            "request": "attach",<br/>            "processId": "${command:pickProcess}"<br/>        }<br/>    ]<br/>}</span></pre><p id="cca1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la">注意:对于Mac用户，使用程序路径:/Users/ &lt;用户名&gt; /。dotnet/tools/。store/Amazon . lambda . test tool-2.1/0 . 9 . 0/Amazon . lambda . test tool-2.1/0 . 9 . 0/tools/netcoreapp2.1/any/Amazon。Lambda.TestTool.dll</em></p><p id="de7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击debug <em class="la"> </em>按钮——应该会出现一个错误提示，指出找不到任务“build”。</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f0307e43ecc81f6bc1a26799918e0859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*_tKk596jVLlAuXvHKIUY2g.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk translated">第一次调试时出错。</figcaption></figure><p id="b94b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">点击<em class="la">“配置任务”</em>按钮，选择从模板创建tasks.json，选择。列表中的. NET核心模板。</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/4fff6e4abff99baa07fc4d6aebbdeef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*QqqJGkSeekhx4CMP00CSiw.png"/></div></figure><p id="f441" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">tasks.json文件应该如下所示:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="c6b3" class="li lj it ml b gy mp mq l mr ms">{<br/>    // See <a class="ae kz" href="https://go.microsoft.com/fwlink/?LinkId=733558" rel="noopener ugc nofollow" target="_blank">https://go.microsoft.com/fwlink/?LinkId=733558</a><br/>    // for the documentation about the tasks.json format<br/>    "version": "2.0.0",<br/>    "tasks": [<br/>        {<br/>            "label": "build",<br/>            "command": "dotnet build",<br/>            "type": "shell",<br/>            "group": "build",<br/>            "presentation": {<br/>                "reveal": "always"<br/>            },<br/>            "problemMatcher": "$msCompile"<br/>        }<br/>    ]<br/>}</span></pre><p id="c720" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，再次单击调试按钮，假设一切都成功，那么<em class="la"> AWS。NET Mock Lambda测试工具</em>窗口应该会启动并填充所有字段:</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/526bdd7aae0004b4fd578a1f2a681914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5e7gBnm-os6gcseZZFDWkw.png"/></div></div></figure><p id="d2ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的Lambda函数非常简单，它只返回事件输入，并向控制台记录一条消息:</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/087595ffa47aa37d77ac79be78a0b02d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IdMoFkLBsSwfiyt2Cb3Z7g.png"/></div></div></figure><p id="adcb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我甚至可以在Visual Studio代码中添加断点，并检查断点处发生了什么，根据断点的位置，您可以像使用传统的。网络应用程序:</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/b63befd6c1059a68a589af882e9c08e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3758vF7emgL-1cOWDUA1mQ.png"/></div></div></figure><p id="7c2b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你有它，调试。NET核心Lambda函数在本地工作正常！</p></div><div class="ab cl lb lc hx ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="im in io ip iq"><h1 id="7395" class="nq lj it bd lk nr ns nt ln nu nv nw lq nx ny nz lt oa ob oc lw od oe of lz og bi translated">摘要</h1><p id="4867" class="pw-post-body-paragraph kb kc it kd b ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky im bi translated">在我看来，这改变了一切。NET世界中的无服务器计算，应该会看到采用<a class="ae kz" href="https://read.acloud.guru/comparing-aws-lambda-performance-of-node-js-python-java-c-and-go-29c1163c2581" rel="noopener ugc nofollow" target="_blank"> <em class="la">的最佳运行时</em> </a>显著增加。我发现该工具的主要缺点是，每次重新运行调试过程时，都会启动一个新窗口，这需要您一次又一次地输入事件——这里的优点是您可以保存自定义请求。</p></div></div>    
</body>
</html>