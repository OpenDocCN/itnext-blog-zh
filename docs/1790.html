<html>
<head>
<title>Controlling gadgets with Google Home, IFTTT and Node-RED</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Google Home、IFTTT和Node-RED控制小工具</h1>
<blockquote>原文：<a href="https://itnext.io/controlling-gadgets-with-google-home-ifttt-and-node-red-d165a680bb2c?source=collection_archive---------5-----------------------#2019-01-29">https://itnext.io/controlling-gadgets-with-google-home-ifttt-and-node-red-d165a680bb2c?source=collection_archive---------5-----------------------#2019-01-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8673aacc9d51f0ceea71b514b2274eca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u9uVCMZWpomTfDf-.png"/></div></div></figure><p id="5c22" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将向您展示在您的家庭/办公室或任何其他环境中添加语音控制命令是多么简单快捷。一旦你建立了你的第一个流程，除此之外的任何其他功能都不需要花一分钟来添加。</p><p id="5eff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将使用:</p><ul class=""><li id="49bc" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><a class="ae lf" href="https://nodered.org/" rel="noopener ugc nofollow" target="_blank"> Node-RED </a>我们连接一切的主要工具。</li><li id="0710" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated"><a class="ae lf" href="https://assistant.google.com/" rel="noopener ugc nofollow" target="_blank">Google Home</a>——我正在使用Google Home Mini启动任务。</li><li id="090b" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">IFTTT 将把来自Google Home的命令转换成webhooks。</li><li id="89dd" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">Webhook Relay 将作为一个代理将webhooks交付给我们运行Node-RED的Raspberry PI，而不会将其暴露给互联网。</li></ul><p id="1466" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Webhook中继节点消除了将您的Node-RED安全地暴露给互联网所需的大量工作。当您由于以下原因无法在本地网络中接收webhooks时，此功能尤其有用:</p><ul class=""><li id="5497" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">ISP阻止传入的连接</li><li id="b644" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">由于使用4G，双NAT</li><li id="b58e" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">没有静态IP</li><li id="c29e" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">缺乏知识如何建立HTTPS和反向代理</li></ul><p id="dca3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，它通过单个节点向您的节点提供加密的单向传输。我们确实有免费层。</p><h1 id="4f62" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">1.正在准备从IFTTT接收webhooks</h1><p id="638a" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">Webhook Relay将充当Google Home with IFTTT和Node-RED之间的消息代理。自然先配置一下。转到<a class="ae lf" href="https://my.webhookrelay.com/buckets" rel="noopener ugc nofollow" target="_blank">bucket页面</a>并创建一个名为“gactions”的新bucket:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/ac3b1820935e850c6b3d4f39d9bab684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kC0IrNcJiOEzjJsE.png"/></div></div></figure><p id="35b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在bucket details页面中，您应该会看到以<code class="fe mt mu mv mw b">https://my.webhookrelay.com/v1/webhooks/...</code>开头的“默认公共端点”URL。保持该选项卡打开，您需要将该URL复制到IFTTT中。</p><h1 id="4b6b" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">2.用IFTTT设置Google Home</h1><p id="4915" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">前往<a class="ae lf" href="https://ifttt.com/" rel="noopener ugc nofollow" target="_blank"> IFTTT </a>，然后前往<a class="ae lf" href="https://ifttt.com/my_applets" rel="noopener ugc nofollow" target="_blank">您的小程序</a>并点击“新建小程序”。搜索“谷歌助手”:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/b0eae34c1577b771718b44d190c512fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a4OWIdmXnojWJUDG.png"/></div></div></figure><p id="361f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">如果这样(谷歌助手)</strong></p><p id="be35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在选择触发器时，为我们的场景选择“说一个简单的短语”。您可以稍后尝试其他不同的自动化。现在，在“你想说什么？”键入“打开电视”或类似的内容。基本上你想要什么都行。填写其他字段并选择您的回应短语。单击“创建触发器”。</p><p id="51fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">然后是那个(Webhook) </strong></p><p id="653a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于操作服务，选择webhook:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/74933ccbe63887983806f7b47321cce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iuwSwx_FxXHHTMNn.png"/></div></div></figure><p id="c853" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在URL部分，取步骤1中的“默认公共端点”(以<code class="fe mt mu mv mw b">https://my.webhookrelay.com/v1/webhooks/...</code>开始)。选择“POST”方法，将内容类型设置为“application/json ”,并将正文设置为:</p><pre class="mp mq mr ms gt mz mw na nb aw nc bi"><span id="7008" class="nd lm iq mw b gy ne nf l ng nh">{</span><span id="3c40" class="nd lm iq mw b gy ni nf l ng nh">    "action": "tv_on"</span><span id="db60" class="nd lm iq mw b gy ni nf l ng nh">}</span></pre><p id="e5f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成后，单击“创建操作”。您现在可以对更多命令重复相同的过程，如关闭电视、静音、降低声音等。我总共配置了三个小程序来将webhooks发送到同一个端点:</p><p id="219b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要关闭它:</p><pre class="mp mq mr ms gt mz mw na nb aw nc bi"><span id="1dfd" class="nd lm iq mw b gy ne nf l ng nh">{</span><span id="b326" class="nd lm iq mw b gy ni nf l ng nh">    "action": "tv_off"</span><span id="4c86" class="nd lm iq mw b gy ni nf l ng nh">}</span></pre><p id="4e67" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要静音:</p><pre class="mp mq mr ms gt mz mw na nb aw nc bi"><span id="e2c2" class="nd lm iq mw b gy ne nf l ng nh">{</span><span id="851a" class="nd lm iq mw b gy ni nf l ng nh">    "action": "tv_mute"</span><span id="352a" class="nd lm iq mw b gy ni nf l ng nh">}</span></pre><blockquote class="nj nk nl"><p id="3e1c" class="jy jz nm ka b kb kc kd ke kf kg kh ki nn kk kl km no ko kp kq np ks kt ku kv ij bi translated"><em class="iq">添加新命令非常快，完成第一个命令不到一分钟。</em></p></blockquote><h1 id="d4e7" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">3.配置节点-红色</h1><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/7ad89fccb1b62d3a0dd0d4a638a75ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XFGLooju-_6hscPQ.png"/></div></div></figure><p id="2fa0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的节点红色流包括三个步骤:</p><ol class=""><li id="8647" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv nr lc ld le bi translated">通过<a class="ae lf" href="https://flows.nodered.org/node/node-red-contrib-webhookrelay" rel="noopener ugc nofollow" target="_blank">节点接收web hooks-red-contrib-web hook relay</a>节点。</li><li id="391f" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">从webhook中提取body，并使用简单的函数和JSON节点解析它。</li><li id="4f55" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv nr lc ld le bi translated">基于交换机节点启动操作。</li></ol><p id="3a7e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了控制电视，我使用了<a class="ae lf" href="https://flows.nodered.org/node/node-red-contrib-tv-bravia" rel="noopener ugc nofollow" target="_blank">node-red-contrib-TV-bravia</a>节点。几乎任何联网设备都会监听<a class="ae lf" href="https://flows.nodered.org/node/node-red-node-wol" rel="noopener ugc nofollow" target="_blank"> node-red-node-wol </a>(局域网唤醒)。</p><p id="a2ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">流程可以在<a class="ae lf" href="https://gist.github.com/rusenask/c4686f64616efd2f73bbd1a8b9ecb0b0" rel="noopener ugc nofollow" target="_blank"> GitHub gist这里</a>找到。您可以导入它，也可以逐个添加节点。出于学习的目的，我建议手动添加它们，这样你可以更好地理解它是如何工作的。</p><p id="47de" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们开始吧。首先，获取<a class="ae lf" href="https://my.webhookrelay.com/tokens" rel="noopener ugc nofollow" target="_blank">认证令牌</a>并将它们设置到<code class="fe mt mu mv mw b">node-red-contrib-webhookrelay</code>节点。在“Buckets”字段中，添加我们之前创建的“gactions”存储桶:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/0831abff49457cdd0b5b240e0af39760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WO3tTOV0s1Z4i05M.png"/></div></div></figure><h1 id="c968" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">提取和解析正文</h1><p id="9f9f" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">现在，我们需要提取正文并解析它。创建一个<strong class="ka ir">函数</strong>节点，并在函数体中添加:</p><pre class="mp mq mr ms gt mz mw na nb aw nc bi"><span id="1bfb" class="nd lm iq mw b gy ne nf l ng nh">return {</span><span id="2ae9" class="nd lm iq mw b gy ni nf l ng nh">payload: msg.payload.body</span><span id="899c" class="nd lm iq mw b gy ni nf l ng nh">};</span></pre><p id="42ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将从整个webhook消息中提取webhook主体(它包括输入、bucket元数据以及请求方法和头)。然后，添加一个<strong class="ka ir"> json </strong>节点，并对其进行配置:</p><ul class=""><li id="925a" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">动作:</strong>在JSON字符串&amp;对象之间转换</li><li id="6019" class="kw kx iq ka b kb lg kf lh kj li kn lj kr lk kv lb lc ld le bi translated">属性: msg.payload</li></ul><h1 id="92ab" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">基于有效负载启动操作</h1><p id="af6f" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">最后，添加交换机和主控制节点的时间到了。还记得我们在IFTTT中配置的有效载荷吗？读取动作值时间:</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/92ba62c46d5860d59f09bd4570a16fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RilGJrce0aZPLsv2.png"/></div></div></figure><p id="fc6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于控制，我使用的是<a class="ae lf" href="https://flows.nodered.org/node/node-red-contrib-tv-bravia" rel="noopener ugc nofollow" target="_blank">节点-红色-贡献-电视-bravia </a>节点。按照他们的说明设置电视。简而言之——你需要知道你的电视和MAC的IP地址(用于LAN节点唤醒)。您可以从路由器中找到它，或者转到您的电视网络设置并从那里获取它。每根开关线都有不同的动作，这使它变得简单而坚固。</p><h1 id="5851" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">未来的工作</h1><p id="244c" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">一旦你准备好到达<strong class="ka ir">交换机</strong>节点的流，就可以随意添加更多的小工具。正如您所看到的，IFTTT使得发布命令和基于您的流中的有效负载采取行动变得非常容易。如果你有你的Node-RED暴露在互联网上，你甚至可以跳过Webhook中继节点，直接通过一个<code class="fe mt mu mv mw b">http</code>节点接收webhooks。</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="ce1d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nm">原载于2019年1月29日</em><a class="ae lf" href="https://webhookrelay.com/blog/2019/01/29/google-home-ifttt-node-red/" rel="noopener ugc nofollow" target="_blank"><em class="nm">webhookrelay.com</em></a><em class="nm">。</em></p></div></div>    
</body>
</html>