<html>
<head>
<title>Basic Authentication for iOS using AWS Amplify and Amazon Cognito</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Amplify和Amazon Cognito的iOS基本认证</h1>
<blockquote>原文：<a href="https://itnext.io/basic-authentication-for-ios-using-aws-amplify-and-amazon-cognito-233b943222d4?source=collection_archive---------0-----------------------#2018-10-02">https://itnext.io/basic-authentication-for-ios-using-aws-amplify-and-amazon-cognito-233b943222d4?source=collection_archive---------0-----------------------#2018-10-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq"><div class="bz fp l di"><div class="jr js l"/></div></figure><p id="fa7d" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><em class="kr">更新(2018年12月6日):更新了客户端代码，以反映针对iOS (2.7.0+)和AWS Amplify的AWS SDK的最新auth更改。嵌入的视频以一步一步的方式通过这个博客，但它没有随着AWSMobileClient的变化而更新。</em></p><p id="b9c1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在我之前的<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/unauthenticated-access-to-aws-for-ios-apps-using-aws-amplify-cb87222eb5d">文章</a>中，我谈到了iOS对AWS的未认证访问。在这种情况下，移动用户从不使用用户名/密码进行身份验证。让我们回顾一下上一篇文章中的三个概念。</p><p id="71ed" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir"> 1。大多数AWS服务要求客户端请求用AWS凭证(AWS访问密钥ID &amp;秘密访问密钥)签名，而不是用户名&amp;密码。</strong></p><p id="19e4" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir"> 2。</strong><a class="ae ks" href="https://docs.aws.amazon.com/cognito/latest/developerguide/identity-pools.html" rel="noopener ugc nofollow" target="_blank">Amazon cogn ITO Identity Pools</a>(联合身份)提供唯一的身份Id(针对设备，而不是真正的用户)，并生成所需的临时、有限权限的AWS凭据，供AWS SDK用来签署对AWS服务的请求。</p><p id="b7f2" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir"> 3。</strong>用于iOS的<a class="ae ks" href="https://github.com/aws/aws-sdk-ios" rel="noopener ugc nofollow" target="_blank">AWS Mobile SDK</a>在使用Amazon Cognito Identity Pool处理用于检索、存储和更新AWS凭证的身份认证令牌时，为移动开发人员完成所有工作。</p><p id="7928" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">这可能会让你感到惊讶，但是app store <strong class="jv ir">中的大多数移动应用并不要求</strong>用户在使用他们的应用之前进行身份验证。</p><p id="e9fd" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">为什么首先要强制用户进行身份验证？</strong></p><p id="a357" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">嗯，有很多原因。对每个用户的资源进行精细的访问控制，为拥有多台设备的用户提供独立的云存储/设置，在用户数据被秘密存储和访问时增加安全性，以及共享私人内容。另一方面，开发者可能不关心上述内容，而只是想在用户下载应用并注册为新用户时收集用户的个人信息，如电子邮件地址、电话号码、地址等。应用程序开发人员随后可以使用这些收集的属性，通过各种渠道(如短信和电子邮件)来吸引和留住这些应用程序用户。否则，如果用户不提供任何注册或个人信息，用户就是匿名的，除了应用内消息或推送通知，没有其他方式吸引用户。</p><p id="99b4" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">验证用户身份的方法</strong></p><p id="e616" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">作为移动开发人员，您有许多支持身份验证的选择。最常见的是通过用户目录提供基本的用户名/密码认证，或者通过第三方社交网络(如脸书、谷歌或Twitter)提供认证。对于社交网络，用户直接向这些服务认证。我将在以后的文章中介绍如何使用脸书和谷歌集成auth。</p><p id="70f9" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">什么是基本认证？</strong></p><p id="7cd5" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">基本身份验证是指用户通过提供唯一的用户名(也可以是电子邮件或电话号码)和相关密码来注册应用程序或服务，应用程序在向后端服务发出的每个签名请求中使用这些凭据。</p><p id="8768" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">在你的应用中内置基本认证</strong></p><p id="86b7" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">作为开发人员，在提供基本身份验证时，您必须为这些用户维护一个用户目录服务，并安全地存储密码和个人属性(电子邮件、电话等)。此外，您需要一种方法让用户重置他/她的密码，并允许管理忘记的电子邮件/用户名和/或密码的机制。幸运的是，我们有<a class="ae ks" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" rel="noopener ugc nofollow" target="_blank">亚马逊Cognito用户池</a>来为我们管理这一切，它可以扩展到数百万用户。千万不要自建用户目录，不值得。</p><p id="e9e5" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">介绍Amazon Cognito用户池</strong></p><p id="cb2d" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">用户池是Amazon Cognito中的一个用户目录。使用用户池，您的用户可以注册并使用基本身份验证登录，用户池的所有成员都有一个目录配置文件，作为开发人员，您可以通过AWS SDK访问该文件。</p><p id="0db9" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">Cognito用户池提供:</p><ul class=""><li id="9316" class="kt ku iq jv b jw jx ka kb ke kv ki kw km kx kq ky kz la lb bi translated">注册和登录服务。</li><li id="bcd1" class="kt ku iq jv b jw lc ka ld ke le ki lf km lg kq ky kz la lb bi translated">一个内置的、可定制的UI，用于注册和登录用户(mobile SDK的一部分)</li><li id="25c6" class="kt ku iq jv b jw lc ka ld ke le ki lf km lg kq ky kz la lb bi translated">基本身份验证，使用脸书、谷歌进行社交登录，使用亚马逊进行登录，以及从您的用户池中使用SAML身份提供商进行登录。</li><li id="655b" class="kt ku iq jv b jw lc ka ld ke le ki lf km lg kq ky kz la lb bi translated">用户目录管理和用户配置文件。</li><li id="719b" class="kt ku iq jv b jw lc ka ld ke le ki lf km lg kq ky kz la lb bi translated">多因素身份验证(MFA)、检查受损凭据、帐户接管保护以及电话和电子邮件验证等安全功能。</li></ul><p id="58b9" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">从基本认证到AWS凭证</strong></p><p id="9579" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在通过用户名/密码成功认证用户池用户后，Amazon Cognito用户池发布JSON web令牌(JWT ),这些令牌可用于交换Amazon Cognito身份池(或Cognito联合身份)提供的AWS凭证。下面是从基本身份验证到访问AWS资源的流程。注意:作为一名iOS开发人员，您不需要担心会话令牌和/或JWT，因为面向iOS的AWS SDK会为您完成所有这些工作。因此，当您听到开发人员谈论传递JWT时，他们可能是JavaScript开发人员:)</p><figure class="li lj lk ll gt jq gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/b50d38d24fbe02181cfea3fd6a9e96e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*GGOY-YobG9qvJ8mRusPajg.png"/></div></figure><p id="f231" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">请记住，我们的移动照片共享应用程序正在连接到AWS后端资源，要向AWS发出请求，您必须提供<a class="ae ks" href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html" rel="noopener ugc nofollow" target="_blank"> AWS凭据</a>。用于基本认证的Amazon Cognito用户池和Amazon Cognito身份池允许我们采用传统的认证方法，并为那些通过认证的移动用户生成临时AWS凭据，以访问您的AWS资源。</p><p id="fdff" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">使用Cognito用户池设置电子邮件/密码认证</strong></p><p id="b237" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在本节中，我们将使用Amplify CLI从本地Xcode项目文件夹中初始化和配置AWS后端资源。</p><p id="96b1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">安装Amplify CLI </strong></p><p id="93ec" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在开始之前，我们将使用AWS Amplify CLI，它是<a class="ae ks" href="https://aws-amplify.github.io/media/toolchain?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank"> AWS Amplify工具链</a>的一部分。</p><pre class="li lj lk ll gt lo lp lq lr aw ls bi"><span id="f38d" class="lt lu iq lp b gy lv lw l lx ly">$ npm install -g @aws-amplify/cli</span><span id="54b3" class="lt lu iq lp b gy lz lw l lx ly">$ amplify configure</span></pre><p id="7ce1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">这是一次性安装。查看<a class="ae ks" href="https://aws-amplify.github.io/media/get_started?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=iOS_native" rel="noopener ugc nofollow" target="_blank">入门教程</a>了解更多详情。</p><p id="82d1" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">使用Amplify CLI从本地项目文件夹初始化云后端</strong></p><p id="48c8" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">从您的本地环境中，创建或使用您选择的现有Xcode iOS Swift项目(Xcode 10和Swift 4是不错的选择)，然后在您的iOS项目文件夹的根目录中启动Mac终端。现在，我们将使用下面的Amplify命令初始化我们的AWS后端项目。</p><pre class="li lj lk ll gt lo lp lq lr aw ls bi"><span id="84b4" class="lt lu iq lp b gy lv lw l lx ly">$ amplify init</span></pre><p id="62f3" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">将指导您完成设置项目的过程。<strong class="jv ir">确保在适当的时候选择iOS</strong>。</p><p id="cc8b" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">默认情况下，Amplify CLI会在代表您初始化后创建以下内容:</p><p id="ce41" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">1.未设置权限的空的未经身份验证的IAM角色</p><p id="d5d6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">2.未设置权限的空已验证IAM角色</p><p id="855a" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">接下来，让我们向移动项目添加经过身份验证的访问。我们将遵循AWS文档中的<a class="ae ks" href="https://docs.aws.amazon.com/aws-mobile/latest/developerguide/add-aws-mobile-user-sign-in.html" rel="noopener ugc nofollow" target="_blank">电子邮件&amp;密码</a>选项选项卡中概述的相同流程。</p><pre class="li lj lk ll gt lo lp lq lr aw ls bi"><span id="b45e" class="lt lu iq lp b gy lv lw l lx ly">$ amplify add auth</span></pre><p id="7e14" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">通过<strong class="jv ir">默认</strong>配置返回。</p><p id="f5eb" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">“<strong class="jv ir"> <em class="kr"> amplify add auth </em> </strong>”的默认配置是使用自以为是的“默认”配置设置创建一个Cognito用户池和Cognito身份池。如果你选择设置你自己的身份验证配置，选择<strong class="jv ir">否</strong>并浏览各种选项，如MFA、验证码、短信、密码长度等。非默认选项不在本文讨论范围内，但你可以随意使用许多配置选项。</p><p id="9101" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">将本地配置更改推送到您的AWS帐户</p><pre class="li lj lk ll gt lo lp lq lr aw ls bi"><span id="dfa5" class="lt lu iq lp b gy lv lw l lx ly">$ amplify push</span></pre><p id="ebe5" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">通过将此功能"<strong class="jv ir"><em class="kr">Amplify add auth</em></strong><em class="kr">"</em>集成到我们的Xcode项目中，Amplify CLI暂存了一个本地Amazon CloudFormation模板，并将其作为CloudFormation堆栈部署到您的AWS帐户，该堆栈在您的帐户上提供以下AWS资源:</p><p id="ec0c" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">AWS帐户中的一个新的<strong class="jv ir"> Cognito身份池</strong>，并将该池与现有项目的已验证和未验证IAM角色相关联。</p><p id="26cd" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">您的AWS帐户中的一个新的<strong class="jv ir">认知用户池</strong>，并将该用户池与上述用于临时AWS凭证的身份池相关联。</p><p id="a072" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">一个新的<strong class="jv ir"> awsconfiguration.json文件</strong>，通过“CredentialsProvider”引用您新创建的Cognito身份池，通过“CognitoUserPool”设置引用Cognito用户池。</p><p id="fbfc" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">注意:此时，经过身份验证和未经身份验证的IAM角色仍然没有任何关联的访问策略，因此即使您的应用程序用户通过用户名和密码注册并向Cognito用户池提供基本身份验证，他们也无法在您的AWS帐户中访问AWS资源。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="d617" class="mh lu iq bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated"><strong class="ak">在我们的iOS应用程序中设置授权</strong></h1><p id="3600" class="pw-post-body-paragraph jt ju iq jv b jw ne jy jz ka nf kc kd ke ng kg kh ki nh kk kl km ni ko kp kq ij bi translated">我们现在将通过添加AWS Mobile SDK依赖项、集成AWSMobileClient for auth来支持我们的移动应用程序，然后实现由移动SDK提供的auth UI。</p><p id="870e" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">设置AWS Mobile SDK依赖项(Cocoapods) </strong></p><p id="8a5d" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在这个例子中，我将使用Cocoapods进行依赖管理，因为这是目前推荐的将AWS SDK集成到iOS项目中的方法。更多关于<a class="ae ks" href="https://cocoapods.org/" rel="noopener ugc nofollow" target="_blank">椰子的信息。如果你的应用程序中还没有pod，你可以简单地运行一个<em class="kr"> $ pod init </em>，它会为你创建一个新的Podfile。有了Podfile之后，向该文件添加以下依赖项。</a></p><figure class="li lj lk ll gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nj"><img src="../Images/548e35e0f70c7988ea5aea94aa741885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7R8UW5BLFa_mMffNJFTAMw.png"/></div></div></figure><p id="966f" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">将SDK库引入您的项目:</p><pre class="li lj lk ll gt lo lp lq lr aw ls bi"><span id="4914" class="lt lu iq lp b gy lv lw l lx ly">$ pod install --repo-update</span></pre><p id="b0e5" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">将<em class="kr"> awsconfiguration.json </em>文件集成到您的iOS项目</strong></p><p id="0b35" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">当使用AWS Amplify CLI供应后端资源时，它会在iOS Xcode项目的根目录中生成一个名为<em class="kr"> awsconfiguration.json </em>的文件。该文件包含可通过应用程序访问的资源的描述，并在Amplify工具链添加、更新或删除资源时与项目同步。这种配置文件的自动更新是使用Amplify CLI从您的本地移动开发环境中提供AWS资源的巨大好处之一。</p><blockquote class="no np nq"><p id="0475" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">您只需要将awsconfiguration.json文件添加到Xcode项目中一次。您可以通过将它拖到Xcode项目管理器中的Finder来完成此操作。</p></blockquote><p id="727f" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">如果要复制文件，系统会提示您。<strong class="jv ir">取消勾选复制项目框</strong>。当情况发生变化时，AWS Amplify CLI会更新该文件。如果您选中目标框，那么您的项目在被复制时可能不会收到更新。如果取消选中该框，则每当您通过Amplify CLI修改项目资源时，该文件都会更新。</p><p id="c0a6" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">初始化视图控制器中的AWSMobileClient</strong></p><p id="4088" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在您希望用户注册或登录的根UIViewController或相关屏幕中，添加下图中引用的以下代码:</p><blockquote class="no np nq"><p id="dc78" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">1.添加第2行的导入</p><p id="526d" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">2.将<strong class="jv ir">initializeAWSMobileClient()</strong>调用添加到viewDidLoad()的底部，如<strong class="jv ir">第9行</strong>所示</p><p id="9acb" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">3.将第12–45行的新函数<strong class="jv ir">initializeAWSMobileClient()</strong>添加到视图控制器中。</p></blockquote><p id="03ae" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">注意:showSignIn()函数尚不存在。我们将在下一步中添加它。</p><figure class="li lj lk ll gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nu"><img src="../Images/02ec5c83894fd3919d55857d6effb0f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oDZc-I2iOW5PsV-5rrFmjg.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated"><a class="ae ks" href="https://gist.github.com/dennisAWS/8fba1d9dc738141452ceeb9f98992f40" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/dennisAWS/8 FBA 1d 9 DC 738141452 ceeb 9 f 98992 f 40</a></figcaption></figure><p id="3690" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">实现您的注册/登录界面</strong></p><p id="9922" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在您希望用户注册或登录的根UIViewController或相关屏幕中，添加下图中引用的以下代码:</p><blockquote class="no np nq"><p id="6c7a" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">将第12–23行的新函数<strong class="jv ir"> showSignIn() </strong>添加到视图控制器中。</p></blockquote><figure class="li lj lk ll gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="nk nl di nm bf nn"><div class="gh gi nz"><img src="../Images/10be938d85bf1d128f361598c411d511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cpyY2GsqodUyOlFjh1H_rw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated"><a class="ae ks" href="https://gist.github.com/dennisAWS/30e43e3ba8ab7df79a5fe85973d7543e" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/dennisAWS/30 e 43 e 3 ba 8 ab 7 df 79 a5 Fe 85973d 7543 e</a></figcaption></figure><p id="dd38" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">警告。需要UINavigationController:auth UI是AWS Mobile SDK的一部分，它要求您的应用程序具有UINavigationController。</p><p id="eee3" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">若要将UINavigationController添加到您的应用程序(如果不存在):</p><blockquote class="no np nq"><p id="414d" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated">将UINavigationController添加到您的iOS应用程序:从您的Xcode项目中，选择Storyboard中的ViewController，然后选择菜单选项:</p><p id="ec88" class="jt ju kr jv b jw jx jy jz ka kb kc kd nr kf kg kh ns kj kk kl nt kn ko kp kq ij bi translated"><em class="iq">编辑</em>-&gt;-<em class="iq">嵌入</em>-&gt;-<em class="iq">导航控制器。</em></p></blockquote><p id="70fa" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">构建并运行你的应用</strong></p><p id="a2c7" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">您应该看到AWS SDK为您的应用程序预建的登录UI，因为用户最初没有经过身份验证。iOS SDK提供了一个标准的默认UI，允许用户<strong class="jv ir">注册(注册)</strong>，触发“<strong class="jv ir">忘记密码</strong>功能，当然还有内置的<strong class="jv ir">登录</strong>功能以及默认用户名/电子邮件和密码字段。对于测试，注册一个新用户，然后使用注册的用户名(或电子邮件)和密码验证该用户。一旦用户通过了身份验证，UI对话框将会消失，您现在应该会看到视图控制器屏幕。</p><p id="5952" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">此时，应用程序用户已经通过身份验证。恭喜你！</p><p id="c936" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">等等，还记得与我们的Cognito身份池相关联的未经身份验证和经过身份验证的IAM角色吗？好了，现在用户已经过身份验证，用户<strong class="jv ir">承担了经过身份验证的IAM角色</strong>，并被授予了与该角色相关的权限，但是，该角色仍然有一个空的访问策略。应用程序中的<em class="kr"> showSignIn() </em>函数有一个print语句，其中包含确认成功或失败登录的详细信息，因此即使您没有调用除Cognito之外的AWS服务，您仍然可以验证所有设置是否正确。了解更多关于<a class="ae ks" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-edit.html" rel="noopener ugc nofollow" target="_blank">编辑IAM策略</a>的信息。</p><p id="f871" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">最终想法</strong></p><p id="f163" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">如果您选择强制移动用户进行身份验证或不进行身份验证，Amazon Cognito是连接到AWS资源的所有移动应用程序的已验证和未验证流的默认选择。如果您不需要登录，请使用Cognito联合身份(<strong class="jv ir"> Cognito身份池</strong>)，如果您通过用户名(或电子邮件)和密码进行身份验证，即基本身份验证，请使用<strong class="jv ir"> Amazon Cognito用户池</strong>。对于经过身份验证的用户，用户池会将经过身份验证的用户令牌传递到您的Cognito身份池，以换取该用户调用您的AWS资源的临时AWS凭据。然后，用户访问由<strong class="jv ir"> IAM认证角色</strong>定义。如果用户不进行身份验证，Cognito身份池仍然授予AWS凭证，并且用户的访问由<strong class="jv ir"> IAM未验证角色</strong>定义。</p><p id="1908" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated">在接下来的文章中，我们将通过脸书和谷歌讨论社交认证。我们仍将使用Cognito身份池，但将Cognito用户池替换为社交身份提供者。无论是哪种情况，AWS Mobile SDK都会处理将auth令牌传递给我们的身份池。</p><p id="93fd" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><strong class="jv ir">资源</strong></p><p id="023c" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><a class="ae ks" href="https://aws-amplify.github.io/media/toolchain?utm_source=da&amp;utm_medium=blog&amp;utm_campaign=denhills&amp;utm_term=ios_native" rel="noopener ugc nofollow" target="_blank"> AWS放大器</a></p><p id="ce32" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><a class="ae ks" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html" rel="noopener ugc nofollow" target="_blank">亚马逊认知用户群</a></p><p id="cf62" class="pw-post-body-paragraph jt ju iq jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ij bi translated"><a class="ae ks" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-identity.html" rel="noopener ugc nofollow" target="_blank">亚马逊认知身份池</a>(又名认知联合身份)</p></div></div>    
</body>
</html>