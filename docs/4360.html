<html>
<head>
<title>Kubernetes Journey — Up and running out of the cloud — How to setup the Masters using kubeadm bootstrap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes之旅——启动并运行云计算——如何使用kubeadm bootstrap设置主机</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-how-to-setup-the-masters-using-kubeadm-9a496a14fbc1?source=collection_archive---------2-----------------------#2020-06-15">https://itnext.io/kubernetes-journey-up-and-running-out-of-the-cloud-how-to-setup-the-masters-using-kubeadm-9a496a14fbc1?source=collection_archive---------2-----------------------#2020-06-15</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><figure class="gl gn jp jq jr js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi jo"><img src="../Images/41b9404fd2bd377213fa3e494fd5c17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fv4WeLlXdpGQNRofdRETnA.jpeg"/></div></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">在<a class="ae kd" href="https://unsplash.com/s/photos/conductor-music?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae kd" href="https://unsplash.com/@gwundrig?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Manuel n Geli</a>拍摄的照片</figcaption></figure></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><p id="4e8a" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">你好。我们回到了我们的Kubernetes之旅——启动并运行云。在前两篇文章中，我们已经经历了配置我们的<strong class="kn is">网关和Busybox </strong>组件(<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-starting-the-actual-setup-737c0f3e0fb1">链接</a>)以及<strong class="kn is"> HA代理集群</strong> ( <a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-how-to-setup-the-haproxy-cluster-with-high-ee5eb9a7f2e1">链接</a>)的过程。</p><p id="e051" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">在本文中，我们将深入探讨配置具有高可用性的<strong class="kn is"> Kubernetes主</strong>实例的过程。为此，我们将看到如何利用<strong class="kn is"> kubeadm </strong> bootstrap来设置和加入<strong class="kn is"> 3个主实例</strong>作为我们集群的成员。</p><p id="8ecf" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">在本文的最后，我们还将看到如何检查集群的状态。</p><p id="0768" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">让我们找点乐子！</p></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><p id="7154" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">如果你不想等到所有的文章都发表了，又想马上动手，可以随意克隆项目的Github repo。它完全实用，文档也在不断改进。</p><div class="lj lk gp gr ll lm"><a href="https://github.com/mvallim/kubernetes-under-the-hood" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab fo"><div class="lo ab lp cl cj lq"><h2 class="bd is gy z fp lr fr fs ls fu fw iq bi translated">罩下的姆瓦利姆/库伯内特斯</h2><div class="lt l"><h3 class="bd b gy z fp lr fr fs ls fu fw dk translated">它甚至还包括一张幻灯片，解释了它吸引目标受众的原因…</h3></div><div class="lu l"><p class="bd b dl z fp lr fr fs ls fu fw dk translated">github.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma jx lm"/></div></div></a></div></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><h1 id="05bd" class="mb mc ir bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">Kubernestes主组件</h1><figure class="na nb nc nd gt js gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7aeb6da3e0912615e5d9f337dc162310.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*BQ0qzM8bPKBIO4_4fw3Ebg.png"/></div><figcaption class="jz ka gj gh gi kb kc bd b be z dk translated">堆叠控制平面和etcd节点</figcaption></figure><ul class=""><li id="0a37" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Kubelet</strong></code> — Kubelet从API服务器获取pod的配置，并确保所描述的容器已启动并正在运行。</li><li id="354e" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Docker</strong></code> —负责下载图像和启动容器。</li><li id="2082" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">etcd</strong></code> —可靠地存储Kubernetes集群的配置数据，表示任意给定时间点的集群状态(集群中存在哪些节点，应该运行哪些pod，它们运行在哪些节点上，等等)。<br/>要了解更多信息，请查看我们之前关于<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c"> etcd </a>的文章。</li><li id="27c7" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">API Server</strong></code> —验证和配置API对象的数据，包括pod、服务、复制控制器等。API服务器服务REST操作，并提供集群共享状态的前端，所有其他组件通过它进行交互。</li><li id="2d08" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Controller Manager</strong></code> <strong class="kn is"> </strong> —通过API服务器监视功能监视集群的状态，并在收到通知时对集群进行必要的更改，尝试将当前状态移向所需状态。</li><li id="29a3" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Scheduler</strong></code> <strong class="kn is"> </strong> —监视未调度的pod，并根据所请求资源的可用性、服务质量要求、相似性和反相似性规范以及其他约束，通过绑定pod子资源API将它们绑定到节点。一旦为pod分配了一个节点，就会触发Kubelet的常规行为，并创建pod及其容器。</li><li id="8106" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Kube Proxy</strong></code> —在单个工作节点上充当服务的网络代理和负载平衡器。它负责TCP和UDP数据包的网络路由。</li><li id="6215" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">Flannel</strong></code> —为Kubernetes设计的第3层网络结构。查看我们之前关于法兰绒的<a class="ae kd" href="https://github.com/mvallim/kubernetes-under-the-hood/blob/improve-docs/documentation/kube-flannel.md" rel="noopener ugc nofollow" target="_blank">话题</a>了解更多信息。</li><li id="448d" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">CoreDNS</strong></code><strong class="kn is"/>—Kubernetes集群的DNS服务器。有关更多信息，请查看<a class="ae kd" href="https://github.com/coredns/coredns" rel="noopener ugc nofollow" target="_blank"> CoreDNS官方知识库</a>。</li></ul></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><p id="1aab" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">在这里，像以前一样，我们利用<a class="ae kd" href="https://github.com/mvallim/kubernetes-under-the-hood/blob/master/create-image.sh" rel="noopener ugc nofollow" target="_blank"> create-image.sh </a>脚本来创建将托管我们的主实例的虚拟箱虚拟机。</p></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><h1 id="9664" class="mb mc ir bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">说够了。给我看看代码！</h1><h2 id="7abc" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">创建虚拟机</h2><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="a68d" class="nw mc ir nq b gy om on l oo op">~/kubernetes-under-the-hood$ for instance in kube-mast01 kube-mast02 kube-mast03; do \<br/>./create-image.sh \<br/>   -k ~/.ssh/id_rsa.pub \<br/>   -u kube/user-data \<br/>   -n kube-mast/network-config \<br/>   -i kube-mast/post-config-interfaces \<br/>   -r kube-mast/post-config-resources \<br/>   -o ${instance} \<br/>   -l debian \<br/>   -b debian-base-image done</span></pre><p id="33ca" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><strong class="kn is">预期产出:</strong></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="2497" class="nw mc ir nq b gy om on l oo op">Total translation table size: 0<br/>Total rockridge attributes bytes: 417<br/>Total directory bytes: 0<br/>Path table size(bytes): 10<br/>Max brk space used 0<br/>186 extents written (0 MB)<br/>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%<br/>Machine has been successfully cloned as "kube-mast01"<br/>Waiting for VM "kube-mast01" to power on...<br/>VM "kube-mast01" has been successfully started.<br/>Total translation table size: 0<br/>Total rockridge attributes bytes: 417<br/>Total directory bytes: 0<br/>Path table size(bytes): 10<br/>Max brk space used 0<br/>186 extents written (0 MB)<br/>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%<br/>Machine has been successfully cloned as "kube-mast02"<br/>Waiting for VM "kube-mast02" to power on...<br/>VM "kube-mast02" has been successfully started.<br/>Total translation table size: 0<br/>Total rockridge attributes bytes: 417<br/>Total directory bytes: 0<br/>Path table size(bytes): 10<br/>Max brk space used 0<br/>186 extents written (0 MB)<br/>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%<br/>Machine has been successfully cloned as "kube-mast03"<br/>Waiting for VM "kube-mast03" to power on...<br/>VM "kube-mast03" has been successfully started.</span></pre><h1 id="a348" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">因素</h1><ul class=""><li id="70da" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-k</strong></code>用于将<strong class="kn is">公钥</strong>从您的主机复制到新创建的虚拟机。</li><li id="7c5c" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-u</strong></code>用于指定<strong class="kn is">用户数据</strong>文件，该文件将作为参数传递给创建我们之前提到的cloud-init ISO文件的命令(查看脚本的源代码以更好地理解如何使用它)。默认为'<strong class="kn is">/数据/用户数据</strong>'。</li><li id="2a75" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-m</strong></code>用于指定<strong class="kn is">元数据</strong>文件，该文件将作为参数传递给创建我们之前提到的cloud-init ISO文件的命令(查看脚本的源代码以更好地理解它的用法)。默认为'<strong class="kn is">/数据/元数据</strong>'。</li><li id="2f4c" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-n</strong></code>用于传递一个配置文件，cloud-init将使用该文件为实例配置<strong class="kn is">网络</strong>。</li><li id="a794" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-i</strong></code>用于传递一个配置文件，我们的脚本将使用该文件修改由<strong class="kn is"> VirtualBox </strong>管理的<strong class="kn is">网络接口</strong>，该接口附加到将从该映像创建的实例。</li><li id="0c7a" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-r</strong></code>用于传递一个配置文件，我们的脚本将使用该文件来配置<strong class="kn is">数量的处理器和</strong>数量的内存，这些内存由<strong class="kn is"> VirtualBox </strong>分配给我们的实例。</li><li id="c7ae" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-o</strong></code>用于传递将分配给我们实例的<strong class="kn is">主机名</strong>。这也将是<strong class="kn is"> VirtualBox </strong>用来引用我们的实例的名称。</li><li id="3d33" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-l</strong></code>用于通知我们要使用哪个Linux发行版(<strong class="kn is"> debian </strong>或<strong class="kn is"> ubuntu </strong>)配置文件(注意这是用来指定<a class="ae kd" href="https://github.com/mvallim/kubernetes-under-the-hood/blob/master/data" rel="noopener ugc nofollow" target="_blank">数据</a>下的哪个文件夹被引用)。默认为'<strong class="kn is"> debian </strong>'。</li><li id="5911" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-b</strong></code>用于指定应该使用哪个<strong class="kn is">基础图像</strong>。这是我们执行<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-linux-image-c51953e50d0e">上一篇文章</a>中的安装步骤时，在<strong class="kn is"> VirtualBox </strong>上创建的镜像名称。</li><li id="5d28" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-s</strong></code>用于传递一个配置文件，我们的脚本将使用该文件在<strong class="kn is"> VirtualBox </strong>上配置<strong class="kn is">虚拟磁盘</strong>。您会注意到这仅用于<strong class="kn is"> Gluster </strong>配置步骤。</li><li id="b226" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">-a</strong></code>我们的实例<strong class="kn is">在创建后是否应该初始化</strong>。默认为<strong class="kn is">真</strong>。</li></ul><h1 id="91ad" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">理解用户数据文件</h1><p id="8950" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">cloud-init kube-master配置文件可以在这里找到<a class="ae kd" href="https://github.com/mvallim/kubernetes-under-the-hood/blob/improve-docs/data/debian/kube/user-data" rel="noopener ugc nofollow" target="_blank">。这将配置和安装Docker和Kubernetes二进制文件(kubeadm、kubectl、kublet)。</a></p><p id="59db" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">为了更好地理解，您可以在下面找到相同的文件注释:</p><figure class="na nb nc nd gt js"><div class="bz fp l di"><div class="pd pe l"/></div></figure><h2 id="23f4" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">配置您的本地路由</h2><p id="7408" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">您需要在本地计算机上添加一个路由来访问Virtualbox内部网络。</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="bce6" class="nw mc ir nq b gy om on l oo op">sudo ip route add 192.168.4.0/27 via 192.168.4.30 dev vboxnet0</span><span id="8ae2" class="nw mc ir nq b gy pf on l oo op">sudo ip route add 192.168.4.32/27 via 192.168.4.62 dev vboxnet0</span></pre><h2 id="821e" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">访问BusyBox</h2><p id="ce28" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">我们需要获得BusyBox(如果您还没有设置它，请查看我们的<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-starting-the-actual-setup-737c0f3e0fb1">上一篇文章以获得如何通过ssh访问它的方法</a> ) IP:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="21e2" class="nw mc ir nq b gy om on l oo op">vboxmanage guestproperty get busybox "/VirtualBox/GuestInfo/Net/0/V4/IP"</span></pre><p id="f483" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><strong class="kn is">预期产出:</strong></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="cd04" class="nw mc ir nq b gy om on l oo op">Value: 192.168.4.57</span></pre><p id="8534" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">使用返回值通过ssh访问虚拟机:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="b49c" class="nw mc ir nq b gy om on l oo op">~$ ssh debian@192.168.4.57</span></pre><p id="93b0" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><strong class="kn is">预期产出:</strong></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="b354" class="nw mc ir nq b gy om on l oo op">Linux busybox 4.9.0-11-amd64 #1 SMP Debian 4.9.189-3+deb9u2 (2019-11-11) x86_64</span><span id="2fa5" class="nw mc ir nq b gy pf on l oo op">The programs included with the Debian GNU/Linux system are free software;<br/>the exact distribution terms for each program are described in the<br/>individual files in /usr/share/doc/*/copyright.</span><span id="119d" class="nw mc ir nq b gy pf on l oo op">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br/>permitted by applicable law.</span></pre></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><h1 id="f730" class="mb mc ir bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated">配置集群</h1><h2 id="a533" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated"><code class="fe nn no np nq b">kubeadm-config</code></h2><p id="ae7a" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">此时，我们需要用它的初始配置来设置我们的K8S集群。</p><p id="80db" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">需要<strong class="kn is"> SAN </strong>、<strong class="kn is">平面控制端点</strong>和<strong class="kn is"> POD子网</strong>信息。</p><ul class=""><li id="63a7" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li nj nk nl nm bi translated"><strong class="kn is">控制平面端点</strong>地址是在<strong class="kn is"> HAProxy集群</strong> (192.168.4.20)中定义的(查看我们之前的文章<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-how-to-setup-the-haproxy-cluster-with-high-ee5eb9a7f2e1">此处</a>)。</li><li id="dcde" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><strong class="kn is"> SAN地址</strong>将与控制平面端点相同。</li><li id="e41d" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated">吊舱的CIDR将是法兰绒配置推荐的范围(此处搜索<code class="fe nn no np nq b">net-conf.json</code><a class="ae kd" href="https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank"/>)。</li></ul><p id="fe2f" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">基于以上信息，我们将有一个看起来像这样的<code class="fe nn no np nq b"><a class="ae kd" href="https://github.com/mvallim/kubernetes-under-the-hood/blob/master/master/kubeadm-config.yaml" rel="noopener ugc nofollow" target="_blank">kubeadm-config.yml</a></code>:</p><figure class="na nb nc nd gt js"><div class="bz fp l di"><div class="pd pe l"/></div></figure></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><h2 id="0f54" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated"><code class="fe nn no np nq b">kubeadm init</code></h2><p id="3f07" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">如果您需要，kubeadm工具是不错的选择:</p><ul class=""><li id="8f13" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li nj nk nl nm bi translated">一个简单的方法让你尝试Kubernetes，可能是第一次。</li><li id="9949" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated">现有用户自动设置集群并测试其应用程序的一种方式。</li><li id="7cc0" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated">范围更大的其他生态系统和/或安装工具中的构建块。</li></ul><blockquote class="pg ph pi"><p id="2fd3" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated"><em class="ir">参考:</em><a class="ae kd" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/" rel="noopener ugc nofollow" target="_blank"><em class="ir">https://kubernetes . io/docs/setup/production-environment/tools/kube ADM/create-cluster-kube ADM/</em></a></p></blockquote><p id="0744" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">这种方法需要较少的基础设施。<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c"> etcd </a>成员和控制平面节点位于同一位置。</p><p id="1c15" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><em class="pj"> 1 —运行以下命令初始化主节点:</em></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="2556" class="nw mc ir nq b gy om on l oo op">debian@busybox:~$ ssh kube-mast01</span><span id="cdc5" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ curl --progress-bar <a class="ae kd" href="https://raw.githubusercontent.com/mvallim/kubernetes-under-the-hood/master/master/kubeadm-config.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/mvallim/kubernetes-under-the-hood/master/master/kubeadm-config.yaml</a> -o kubeadm-config.yaml</span><span id="a991" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ sudo kubeadm init --config=kubeadm-config.yaml --upload-certs</span></pre><p id="da3d" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><strong class="kn is">预期产出:</strong></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="d95f" class="nw mc ir nq b gy om on l oo op">[init] Using Kubernetes version: v1.15.9<br/>[preflight] Running pre-flight checks<br/>[preflight] Pulling images required for setting up a Kubernetes cluster<br/>[preflight] This might take a minute or two, depending on the speed of your internet connection<br/>[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'<br/>[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"<br/>[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"<br/>[kubelet-start] Activating the kubelet service<br/>[certs] Using certificateDir folder "/etc/kubernetes/pki"<br/>[certs] Generating "ca" certificate and key<br/>[certs] Generating "apiserver-kubelet-client" certificate and key<br/>[certs] Generating "apiserver" certificate and key<br/>[certs] apiserver serving cert is signed for DNS names [kube-mast01 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.1.82 192.168.4.20 192.168.4.20]<br/>[certs] Generating "front-proxy-ca" certificate and key<br/>[certs] Generating "front-proxy-client" certificate and key<br/>[certs] Generating "etcd/ca" certificate and key<br/>[certs] Generating "etcd/server" certificate and key<br/>[certs] etcd/server serving cert is signed for DNS names [kube-mast01 localhost] and IPs [192.168.1.82 127.0.0.1 ::1]<br/>[certs] Generating "apiserver-etcd-client" certificate and key<br/>[certs] Generating "etcd/peer" certificate and key<br/>[certs] etcd/peer serving cert is signed for DNS names [kube-mast01 localhost] and IPs [192.168.1.82 127.0.0.1 ::1]<br/>[certs] Generating "etcd/healthcheck-client" certificate and key<br/>[certs] Generating "sa" key and public key<br/>[kubeconfig] Using kubeconfig folder "/etc/kubernetes"<br/>[kubeconfig] Writing "admin.conf" kubeconfig file<br/>[kubeconfig] Writing "kubelet.conf" kubeconfig file<br/>[kubeconfig] Writing "controller-manager.conf" kubeconfig file<br/>[kubeconfig] Writing "scheduler.conf" kubeconfig file<br/>[control-plane] Using manifest folder "/etc/kubernetes/manifests"<br/>[control-plane] Creating static Pod manifest for "kube-apiserver"<br/>[control-plane] Creating static Pod manifest for "kube-controller-manager"<br/>[control-plane] Creating static Pod manifest for "kube-scheduler"<br/>[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"<br/>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s<br/>[apiclient] All control plane components are healthy after 25.521661 seconds<br/>[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace<br/>[kubelet] Creating a ConfigMap "kubelet-config-1.15" in namespace kube-system with the configuration for the kubelets in the cluster<br/>[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace<br/>[upload-certs] Using certificate key:<br/>039bae4efd18d7692139f1101fedc877f68c1b4f3a7aa247d4703a764cc98131<br/>[mark-control-plane] Marking the node kube-mast01 as control-plane by adding the label "node-role.kubernetes.io/master=''"<br/>[mark-control-plane] Marking the node kube-mast01 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]<br/>[bootstrap-token] Using token: 5e7aaq.ejvnu55qqxst7czz<br/>[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles<br/>[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials<br/>[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token<br/>[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster<br/>[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace<br/>[addons] Applied essential addon: CoreDNS<br/>[addons] Applied essential addon: kube-proxy</span><span id="9941" class="nw mc ir nq b gy pf on l oo op">Your Kubernetes control-plane has initialized successfully!</span><span id="8b62" class="nw mc ir nq b gy pf on l oo op">To start using your cluster, you need to run the following as a regular user:</span><span id="f809" class="nw mc ir nq b gy pf on l oo op">  mkdir -p $HOME/.kube<br/>  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br/>  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><span id="8a2b" class="nw mc ir nq b gy pf on l oo op">You should now deploy a pod network to the cluster.<br/>Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:<br/>  <a class="ae kd" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></span><span id="99aa" class="nw mc ir nq b gy pf on l oo op">You can now join any number of the control-plane node running the following command on each as root:</span><span id="8b3f" class="nw mc ir nq b gy pf on l oo op">  kubeadm join 192.168.4.20:6443 --token 5e7aaq.ejvnu55qqxst7czz \<br/>    --discovery-token-ca-cert-hash sha256:457f6e849077f9c0a6ed8ad6517c91bfa4f48080c141dda34c3650fc3b1a99fd \<br/>    --control-plane --certificate-key 039bae4efd18d7692139f1101fedc877f68c1b4f3a7aa247d4703a764cc98131</span><span id="13f1" class="nw mc ir nq b gy pf on l oo op">Please note that the certificate-key gives access to cluster sensitive data, keep it secret!<br/>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use<br/> "kubeadm init phase upload-certs --upload-certs" to reload certs afterward.</span><span id="b62c" class="nw mc ir nq b gy pf on l oo op">Then you can join any number of worker nodes by running the following on each as root:</span><span id="6b06" class="nw mc ir nq b gy pf on l oo op">kubeadm join 192.168.4.20:6443 --token 5e7aaq.ejvnu55qqxst7czz \<br/>    --discovery-token-ca-cert-hash sha256:457f6e849077f9c0a6ed8ad6517c91bfa4f48080c141dda34c3650fc3b1a99fd</span></pre><p id="885e" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><em class="pj"> 2 —完成集群配置，查询节点和pod状态</em></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="ca83" class="nw mc ir nq b gy om on l oo op">debian@kube-mast01:~$ mkdir -p $HOME/.kube</span><span id="1fc8" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><span id="e34e" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><span id="c0f4" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ kubectl get nodes -o wide</span><span id="d999" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ kubectl get pods -o wide --all-namespaces</span></pre><p id="79f2" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated"><strong class="kn is">预期产出:</strong></p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="7b06" class="nw mc ir nq b gy om on l oo op">NAME          STATUS     ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                       KERNEL-VERSION   CONTAINER-RUNTIME<br/>kube-mast01   NotReady   master   53s   v1.15.6   192.168.1.72   &lt;none&gt;        Debian GNU/Linux 9 (stretch)</span><span id="e323" class="nw mc ir nq b gy pf on l oo op">NAMESPACE     NAME                                  READY   STATUS    RESTARTS   AGE   IP             NODE          NOMINATED NODE   READINESS GATES<br/>kube-system   coredns-86c58d9df4-6gzrk              0/1     Pending   0          89s   &lt;none&gt;         &lt;none&gt;        &lt;none&gt;           &lt;none&gt;<br/>kube-system   coredns-86c58d9df4-fxj5r              0/1     Pending   0          89s   &lt;none&gt;         &lt;none&gt;        &lt;none&gt;           &lt;none&gt;<br/>kube-system   etcd-kube-mast01                      1/1     Running   0          46s   192.168.1.72   kube-mast01   &lt;none&gt;           &lt;none&gt;<br/>kube-system   kube-apiserver-kube-mast01            1/1     Running   0          43s   192.168.1.72   kube-mast01   &lt;none&gt;           &lt;none&gt;<br/>kube-system   kube-controller-manager-kube-mast01   1/1     Running   0          44s   192.168.1.72   kube-mast01   &lt;none&gt;           &lt;none&gt;<br/>kube-system   kube-proxy-8kb86                      1/1     Running   0          89s   192.168.1.72   kube-mast01   &lt;none&gt;           &lt;none&gt;<br/>kube-system   kube-scheduler-kube-mast01            1/1     Running   0          27s   192.168.1.72   kube-mast01   &lt;none&gt;           &lt;none&gt;</span></pre><blockquote class="pg ph pi"><p id="81c9" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated"><em class="ir">如果您查看</em> <code class="fe nn no np nq b"><em class="ir">kube-mast01</em></code> <em class="ir">节点上的状态，它表示尚未就绪，而</em> <code class="fe nn no np nq b"><em class="ir">coredns</em></code> <em class="ir">窗格处于待定状态。这是因为，到目前为止，我们还没有在K8S集群中配置网络组件。记住，之前解释过，</em> <a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-flannel-c01283308f0e"> <em class="ir">法兰绒</em> </a> <em class="ir">将用于此事。</em></p></blockquote><h1 id="4a24" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">加入主副本</h1><p id="1ea2" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">现在，我们需要将其他节点加入K8S集群。为此，我们需要在前面的步骤中生成的证书。</p><h2 id="2afc" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">打印证书密钥</h2><ol class=""><li id="adb9" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">运行以下命令将证书复制到主副本:</li></ol><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="2b78" class="nw mc ir nq b gy om on l oo op">debian@kube-mast01:~$ sudo kubeadm init phase upload-certs --upload-certs</span></pre><p id="695d" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">预期产出:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="41f3" class="nw mc ir nq b gy om on l oo op">I0126 20:48:17.259139 5983 version.go:248] remote version is much newer: v1.17.2; falling back to: stable-1.15 [upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace [upload-certs] Using certificate key: f385dc122fcaefb52a2c9c748b399b502026ac1c8134cb9b9aa79144d004d95c</span></pre><p id="fc8e" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">现在我们将使用证书密钥<code class="fe nn no np nq b">f385dc122fcaefb52a2c9c748b399b502026ac1c8134cb9b9aa79144d004d95c</code></p><h2 id="6c84" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">打印<code class="fe nn no np nq b">Join</code>命令</h2><ol class=""><li id="5eaa" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">运行以下命令来打印<code class="fe nn no np nq b">join</code>命令。这将用于将其他主副本加入群集:</li></ol><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="8041" class="nw mc ir nq b gy om on l oo op">debian@kube-mast01:~$ sudo kubeadm token create --print-join-command</span></pre><p id="572d" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">预期产出:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="41e8" class="nw mc ir nq b gy om on l oo op">kubeadm join 192.168.4.20:6443 --token uziz9q.5n9r0rbempgyupvg --discovery-token-ca-cert-hash sha256:457f6e849077f9c0a6ed8ad6517c91bfa4f48080c141dda34c3650fc3b1a99fd</span></pre><blockquote class="pg ph pi"><p id="830d" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated">output命令将命令打印到您加入集群上的节点。您将使用此命令加入集群中的其他主服务器</p></blockquote><h2 id="e45b" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">加入第二个Kube大师</h2><ol class=""><li id="210a" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">运行以下命令，使用上一节中打印的join命令加入集群中的第二个主副本:</li></ol><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="65bc" class="nw mc ir nq b gy om on l oo op">debian@busybox:~$ ssh kube-mast02</span><span id="38b5" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast02:~$ sudo kubeadm join 192.168.4.20:6443 \<br/>  --token uziz9q.5n9r0rbempgyupvg \<br/>  --discovery-token-ca-cert-hash sha256:457f6e849077f9c0a6ed8ad6517c91bfa4f48080c141dda34c3650fc3b1a99fd \<br/>  --certificate-key f385dc122fcaefb52a2c9c748b399b502026ac1c8134cb9b9aa79144d004d95c \<br/>  --control-plane</span></pre><h2 id="0a53" class="nw mc ir bd md nx ny dn mh nz oa dp ml kw ob oc mp la od oe mt le of og mx oh bi translated">加入第三库贝大师</h2><ol class=""><li id="edbb" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">运行以下命令，使用上一节中打印的join命令将第三个主副本加入集群:</li></ol><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="ff9a" class="nw mc ir nq b gy om on l oo op">debian@busybox:~$ ssh kube-mast03</span><span id="80a4" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast02:~$ sudo kubeadm join 192.168.4.20:6443 \<br/>  --token uziz9q.5n9r0rbempgyupvg \<br/>  --discovery-token-ca-cert-hash sha256:457f6e849077f9c0a6ed8ad6517c91bfa4f48080c141dda34c3650fc3b1a99fd \<br/>  --certificate-key f385dc122fcaefb52a2c9c748b399b502026ac1c8134cb9b9aa79144d004d95c \<br/>  --control-plane</span></pre><h1 id="f691" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">检查etcd状态</h1><ol class=""><li id="6105" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">查询etcd状态</li></ol><p id="3322" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">此时，当我们初始化<code class="fe nn no np nq b">master-node</code>时，我们将通过<code class="fe nn no np nq b">etcdctl</code> cli使用<code class="fe nn no np nq b">etcd</code>映像(如果您还没有创建它们，请查看我们的<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-etcd-b332d1be474c">上一篇文章</a>)。</p><p id="acc7" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">命令</p><ul class=""><li id="334e" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">cluster-health</strong></code>检查etcd集群的健康状况</li><li id="51d2" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b"><strong class="kn is">member</strong></code>成员<code class="fe nn no np nq b"><strong class="kn is">add</strong></code>、<code class="fe nn no np nq b"><strong class="kn is">remove</strong></code>和<code class="fe nn no np nq b"><strong class="kn is">list</strong></code>子命令</li></ul><ol class=""><li id="9ee0" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li pn nk nl nm bi translated">本地选项<br/> <code class="fe nn no np nq b"><strong class="kn is">--endpoints</strong></code>群集中以逗号分隔的机器地址列表(默认:“127.0.0.1:4001，127 . 0 . 0 . 1:2379”)<br/><code class="fe nn no np nq b"><strong class="kn is">--cert-file</strong></code>使用SSL证书文件识别HTTPS客户端<br/> <code class="fe nn no np nq b"><strong class="kn is">--key-file</strong></code>使用SSL密钥文件识别HTTPS客户端<br/> <code class="fe nn no np nq b"><strong class="kn is">--ca-file</strong></code>使用CA捆绑包验证支持HTTPS的服务器的证书</li></ol><blockquote class="pg ph pi"><p id="b640" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated">有关<code class="fe nn no np nq b">etcdctl</code>参数的更多详情，请参见:http://manpages.org/etcdctl</p></blockquote><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="85a1" class="nw mc ir nq b gy om on l oo op">debian@busybox:~$ ssh kube-mast01</span><span id="41b5" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ sudo docker run - rm -it \<br/>  --net host \<br/>  -v /etc/kubernetes:/etc/kubernetes quay.io/coreos/etcd:v3.2.24 etcdctl \<br/>  --cert-file /etc/kubernetes/pki/etcd/peer.crt \<br/>  --key-file /etc/kubernetes/pki/etcd/peer.key \<br/>  --ca-file /etc/kubernetes/pki/etcd/ca.crt \<br/>  --endpoints <a class="ae kd" href="https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:2379</a> cluster-health</span><span id="e1ba" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ sudo docker run - rm -it \<br/>  --net host \<br/>  -v /etc/kubernetes:/etc/kubernetes quay.io/coreos/etcd:v3.2.24 etcdctl \<br/>  --cert-file /etc/kubernetes/pki/etcd/peer.crt \<br/>  --key-file /etc/kubernetes/pki/etcd/peer.key \<br/>  --ca-file /etc/kubernetes/pki/etcd/ca.crt \<br/>  --endpoints <a class="ae kd" href="https://127.0.0.1:2379" rel="noopener ugc nofollow" target="_blank">https://127.0.0.1:2379</a> member list</span></pre><p id="2297" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">预期产出:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="2abe" class="nw mc ir nq b gy om on l oo op">member 5c81b5ea448e2eb is healthy: got healthy result from <a class="ae kd" href="https://192.168.1.72:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.72:2379</a><br/>member 1d7ec3729980eebe is healthy: got healthy result from <a class="ae kd" href="https://192.168.1.68:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.68:2379</a><br/>member ea93a1a33cffaceb is healthy: got healthy result from <a class="ae kd" href="https://192.168.1.81:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.81:2379</a></span></pre></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><pre class="oi nq oj ok aw ol bi"><span id="ab87" class="nw mc ir nq b gy po pp pq pr ps on l oo op">5c81b5ea448e2eb: name=kube-mast01 peerURLs=<a class="ae kd" href="https://192.168.1.72:2380" rel="noopener ugc nofollow" target="_blank">https://192.168.1.72:2380</a> clientURLs=<a class="ae kd" href="https://192.168.1.72:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.72:2379</a> isLeader=false<br/>1d7ec3729980eebe: name=kube-mast02 peerURLs=<a class="ae kd" href="https://192.168.1.68:2380" rel="noopener ugc nofollow" target="_blank">https://192.168.1.68:2380</a> clientURLs=<a class="ae kd" href="https://192.168.1.68:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.68:2379</a> isLeader=true<br/>ea93a1a33cffaceb: name=kube-mast03 peerURLs=<a class="ae kd" href="https://192.168.1.81:2380" rel="noopener ugc nofollow" target="_blank">https://192.168.1.81:2380</a> clientURLs=<a class="ae kd" href="https://192.168.1.81:2379" rel="noopener ugc nofollow" target="_blank">https://192.168.1.81:2379</a></span></pre><h1 id="d2cb" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">检查K8S集群统计信息</h1><ol class=""><li id="c2d7" class="ne nf ir kn b ko ov ks ow kw ox la oy le oz li pn nk nl nm bi translated">查询节点和窗格的状态</li></ol><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="ea55" class="nw mc ir nq b gy om on l oo op">debian@busybox:~$ ssh kube-mast01</span><span id="3389" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ kubectl get nodes -o wide</span><span id="d67b" class="nw mc ir nq b gy pf on l oo op">debian@kube-mast01:~$ kubectl get pods -o wide --all-namespaces</span></pre><p id="9b75" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">预期产出:</p><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="5423" class="nw mc ir nq b gy om on l oo op">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME<br/>kube-mast01 Ready master 34m v1.15.6 192.168.1.72 &lt;none&gt; Debian GNU/Linux 9 (stretch) 4.9.0–11-amd64 docker://18.6.0<br/>kube-mast02 Ready master 4m34s v1.15.6 192.168.1.68 &lt;none&gt; Debian GNU/Linux 9 (stretch) 4.9.0–11-amd64 docker://18.6.0<br/>kube-mast03 Ready master 2m54s v1.15.6 192.168.1.81 &lt;none&gt; Debian GNU/Linux 9 (stretch) 4.9.0–11-amd64 docker://18.6.0</span></pre><blockquote class="pg ph pi"><p id="140b" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated">所有主节点现在都应该处于就绪状态:</p></blockquote><pre class="na nb nc nd gt oi nq oj ok aw ol bi"><span id="9fb8" class="nw mc ir nq b gy om on l oo op">NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES<br/>kube-system coredns-86c58d9df4–6gzrk 1/1 Running 0 34m 10.244.0.4 kube-mast01 &lt;none&gt; &lt;none&gt; <br/>kube-system coredns-86c58d9df4-fxj5r 1/1 Running 0 34m 10.244.0.5 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system etcd-kube-mast01 1/1 Running 0 34m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system etcd-kube-mast02 1/1 Running 0 5m20s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system etcd-kube-mast03 1/1 Running 0 3m40s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-apiserver-kube-mast01 1/1 Running 0 34m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-apiserver-kube-mast02 1/1 Running 1 5m22s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-apiserver-kube-mast03 1/1 Running 0 2m57s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-controller-manager-kube-mast01 1/1 Running 1 34m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-controller-manager-kube-mast02 1/1 Running 0 5m22s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-controller-manager-kube-mast03 1/1 Running 0 3m42s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-flannel-ds-amd64–545vl 1/1 Running 0 29m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-flannel-ds-amd64-gnngz 1/1 Running 0 3m42s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-flannel-ds-amd64-trxc2 1/1 Running 0 5m22s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-proxy-8kb86 1/1 Running 0 34m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-proxy-cpspc 1/1 Running 0 3m42s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-proxy-j6sch 1/1 Running 0 5m22s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-scheduler-kube-mast01 1/1 Running 1 33m 192.168.1.72 kube-mast01 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-scheduler-kube-mast02 1/1 Running 0 5m22s 192.168.1.68 kube-mast02 &lt;none&gt; &lt;none&gt;<br/>kube-system kube-scheduler-kube-mast03 1/1 Running 0 3m42s 192.168.1.81 kube-mast03 &lt;none&gt; &lt;none&gt;</span></pre><blockquote class="pg ph pi"><p id="d5ce" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated">所有主舱都在运行</p></blockquote><h1 id="7248" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">检查HAProxy集群统计数据</h1><p id="0256" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">在<a class="ae kd" href="http://192.168.4.20:32700/" rel="noopener ugc nofollow" target="_blank">http://192 . 168 . 4 . 20:32700</a>打开您的浏览器</p><blockquote class="pg ph pi"><p id="3425" class="kl km pj kn b ko kp kq kr ks kt ku kv pk kx ky kz pl lb lc ld pm lf lg lh li ik bi translated"><a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-network-5341831ed712">我们谈谈浮动IP配置。</a></p></blockquote><p id="00a3" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">用户:<code class="fe nn no np nq b">admin</code> <br/>密码:<code class="fe nn no np nq b">admin</code></p><p id="0a2f" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">它将显示:</p><figure class="na nb nc nd gt js gh gi paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="gh gi pt"><img src="../Images/5855dae67363c04bfd1d959974bfb05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8rn3zFPoZPV604NQ.png"/></div></div></figure><p id="489e" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">请注意，所有控制平面端点现在都是<em class="pj">向上</em></p><ul class=""><li id="46ed" class="ne nf ir kn b ko kp ks kt kw ng la nh le ni li nj nk nl nm bi translated"><code class="fe nn no np nq b">kube-mast01:6443</code></li><li id="7c00" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b">kube-mast02:6443</code></li><li id="8e21" class="ne nf ir kn b ko nr ks ns kw nt la nu le nv li nj nk nl nm bi translated"><code class="fe nn no np nq b">kube-mast03:6443</code></li></ul><h1 id="59d9" class="mb mc ir bd md me oq mg mh mi or mk ml mm os mo mp mq ot ms mt mu ou mw mx my bi translated">结论</h1><p id="2f7e" class="pw-post-body-paragraph kl km ir kn b ko ov kq kr ks ow ku kv kw pa ky kz la pb lc ld le pc lg lh li ik bi translated">在本文中，我们回顾了Kubernetes主组件(关于主组件和工作组件的完整解释，请查阅<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-master-and-worker-6328775b347f">上一篇文章</a>)。</p><p id="7e8f" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">我们还完成了配置具有高可用性的<strong class="kn is"> Kubernetes Master </strong>实例的过程，并使用<strong class="kn is"> kubeadm </strong> bootstrap设置了3个主实例，展示了如何将这些实例加入集群。</p></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><p id="fe21" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">在下一篇文章中，我们将看到如何配置具有高可用性的<strong class="kn is"> Kubernetes Workers </strong>实例。敬请期待！</p><p id="406c" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">如果你认为这是有帮助的，请留下你的👏以及下面的反馈。不断完善这个系列的内容非常重要。</p><p id="0969" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">我再次强烈推荐您关注我的Medium，这样您就不会错过本系列中发表的任何新文章。如果你错过了这个系列的第一篇文章，你可以在这里查看<a class="ae kd" rel="noopener ugc nofollow" target="_blank" href="/kubernetes-journey-up-and-running-out-of-the-cloud-introduction-f04a811c92a5"/>。</p></div><div class="ab cl ke kf hu kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ik il im in io"><p id="07ac" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">回头见！！</p><p id="1437" class="pw-post-body-paragraph kl km ir kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ik bi translated">再见。</p></div></div>    
</body>
</html>