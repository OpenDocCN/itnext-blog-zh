<html>
<head>
<title>Dart: Working With Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dart:使用Google工作表</h1>
<blockquote>原文：<a href="https://itnext.io/dart-working-with-google-sheets-793ed322daa0?source=collection_archive---------0-----------------------#2020-04-07">https://itnext.io/dart-working-with-google-sheets-793ed322daa0?source=collection_archive---------0-----------------------#2020-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ec71910728e425b8ac5f0a120b53b51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S8fllz2yTR8ywkCuuV5QUg.jpeg"/></div></div></figure><p id="8728" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时出于某些原因，我们选择不使用Google Sheets作为我们的数据源。因此，我们需要能够以编程方式读写数据，这可以通过Google Sheets API轻松实现。</p><p id="ec24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本教程中，我将通过使用<a class="ae kw" href="https://pub.dev/packages/gsheets/versions" rel="noopener ugc nofollow" target="_blank"> gsheets </a>库向您展示如何在Dart中使用Google Sheets。</p><p id="ee61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们开始之前，如果你不知道如何获得证书和设置你的谷歌电子表格，看看我的<a class="ae kw" href="https://medium.com/@a.marenkov/how-to-get-credentials-for-google-sheets-456b7e88c430" rel="noopener">文章</a>吧。</p><p id="5bf8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">假设我们有一个名为“products”的工作表，其产品表如下所示。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/2ce9368897e20b1b8f6c5f24b2343e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*2E_xlGsdIIDuKaePWj0rfw.png"/></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="1cc5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated"><strong class="ak">基本用法</strong></h1><p id="52dc" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">在对工作表做任何事情之前，我们需要获取它。这是怎么做的。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="6434" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以使用<strong class="ka ir">工作表</strong>来读写数据。基本操作的示例如下:</p><ul class=""><li id="ff6f" class="mo mp iq ka b kb kc kf kg kj mq kn mr kr ms kv mt mu mv mw bi translated">读取特定行/列值或特定单元值；</li><li id="8d2b" class="mo mp iq ka b kb mx kf my kj mz kn na kr nb kv mt mu mv mw bi translated">在特定行/列/单元中写入数据；</li><li id="14b8" class="mo mp iq ka b kb mx kf my kj mz kn na kr nb kv mt mu mv mw bi translated">删除特定行/列。</li></ul><p id="44f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是这些操作的一个片段。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="525c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">非常简单明了:)</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="a809" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">高级用法</h1><p id="a4e4" class="pw-post-body-paragraph jy jz iq ka b kb mh kd ke kf mi kh ki kj mj kl km kn mk kp kq kr ml kt ku kv ij bi translated">好了，现在让我们试着做一些更高级更有趣的事情，让我们变一些魔术:)</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="nc mn l"/></div></figure><p id="1afe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们从创建类<strong class="ka ir"> Product </strong>和<strong class="ka ir"> ProductManager </strong>开始。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="4107" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还没有变魔术——需要注意的一件事是<strong class="ka ir"> ProductManager </strong>有<strong class="ka ir"> init </strong>方法获取电子表格和产品工作表。</p><p id="277e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在对工作表进行任何操作之前，<strong class="ka ir"> init </strong>方法必须至少完成一次。我将把这个方法的调用添加到所有的<strong class="ka ir"> ProductManager </strong>方法中。</p><p id="b0a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们添加返回工作表中所有产品的<strong class="ka ir"> getAll </strong>方法。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="0989" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在是时候了——我们得到了所有产品的列表，但这还不神奇吗？</p><p id="d99a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我会说不…它很难阅读，也不容易扩展。它使用固定的数据索引，如果我们要在表中添加一个新列，那么纠正我们在<strong class="ka ir"> ProductManager </strong>中编写的所有方法将是一场噩梦。</p><p id="1000" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以，这次我们试着做点神奇的事情吧:)</p><p id="28d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们将表中的方法<strong class="ka ir">添加到表</strong>中，将工厂<strong class="ka ir">添加到我们的类<strong class="ka ir">产品</strong>中。</strong></p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="92ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了它们，我们可以使用内置在<a class="ae kw" href="https://pub.dev/packages/gsheets/versions" rel="noopener ugc nofollow" target="_blank"> gsheets </a>中的映射来使事情变得更好。让我们重构<strong class="ka ir"> getAll </strong>方法。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="59c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在很神奇，不是吗？</p><p id="855c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里发生了什么- <strong class="ka ir"> allRows </strong>方法获取所有行(默认情况下从第2行开始，但如果需要可以更改)并将它们映射到第1行(默认情况下，但如果需要可以更改)。结果，我们得到代表产品的Map &lt;字符串、String &gt;字符串的列表，然后我们使用fromGsheets  factory的<strong class="ka ir">将它们映射到产品。</strong></p><p id="f1eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们要改变我们的表，我们只需要更新我们的类<strong class="ka ir">产品</strong>。</p><p id="a6c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，让我们添加<strong class="ka ir"> getById </strong>方法。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">看起来很酷，是吧？</figcaption></figure><p id="1de3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里发生了什么——我们通过行的键(该行的键是列A中的值)获取行，然后将其映射到行#1，结果我们获得了产品的映射表示，然后我们从该映射创建产品。</p><p id="5a23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果products表中没有这样的id，我们得到null。厉害！</p><p id="12bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们添加获取/更新产品价格的方法。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="0a4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想不需要解释吧？很清楚，但这里可能有一件事会令人困惑——什么是<strong class="ka ir"> <em class="nh">热切</em> </strong>论点，为什么在这种情况下为假。<strong class="ka ir"> <em class="nh"> eager </em> </strong>告诉是否应该将键自动添加到表中，如果它们中的任何一个不存在(默认情况下<strong class="ka ir"> <em class="nh"> eager </em> </strong>为真)。在这种情况下，如果缺少id，我们不想插入id，或者换句话说，为不存在的产品设定价格。</p><p id="e332" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是什么？现在我们需要可以用来插入新产品或更新现有产品的方法。事实上，我们可以添加一个方法来涵盖这两种情况。以下是片段。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="2c7b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里发生了什么。在<strong class="ka ir">插入</strong>方法中，我们将产品转换成映射，并将该映射的值插入到键等于产品id的行中。如果没有具有该键的行，它将被添加(这是默认行为，可以通过传递<strong class="ka ir"> <em class="nh"> eager:false </em> </strong>来覆盖)。插入映射中值的顺序无关紧要，因为<a class="ae kw" href="https://pub.dev/packages/gsheets/versions" rel="noopener ugc nofollow" target="_blank"> gsheets </a> library将根据第一行中键的顺序对它们进行排序。</p><p id="006c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能已经注意到我传递了<strong class="ka ir"><em class="nh">appendMissing:true</em></strong>，在这种特殊情况下它并没有真正改变什么，但是如果inserting map包含的条目的键在第一行中不存在，它会自动将它们添加到工作表中(缺省情况下append missing为false)。</p><p id="804a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们的<strong class="ka ir">产品管理器</strong>中还应该有一个特性，那就是删除产品。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="88cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简单又好看！</p><p id="f87a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是本教程的全部内容，尽管还有许多其他的方法和特性，例如，如果您试图插入超出当前工作表边界的值，它不会抛出异常，只会在插入之前扩展工作表的边界。您可以在文档中了解它和其他特性。</p><p id="03fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢！通话完毕:)</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/29c3353c17eefba8246ece3c504815d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BmBXzPm6UKkCF28M"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">照片由<a class="ae kw" href="https://unsplash.com/@rexcuando?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃里克·诺帕宁</a>在<a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div></div>    
</body>
</html>