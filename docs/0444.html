<html>
<head>
<title>Building A Node CMS With KeystoneJS, Mongo DB, React and Redux — Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第二部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-ii-842a85ebd9f7?source=collection_archive---------1-----------------------#2018-03-11">https://itnext.io/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-ii-842a85ebd9f7?source=collection_archive---------1-----------------------#2018-03-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6b6f181c62e0144af1f02137e83bbad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x08-zbL0BMdH_p0_IIK_Ng.png"/></div></div></figure><p id="67ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">添加React</p><p id="d57b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想看这个项目的最终版本，你可以从 <a class="ae kx" href="https://github.com/Colour-Full/medium-keystone-react-cms" rel="noopener ugc nofollow" target="_blank"> <em class="kw"> github </em> </a>得到回购</p><p id="9b86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本系列的第一部分<a class="ae kx" href="https://medium.com/@velizarmihaylov/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-i-ae5958496df2" rel="noopener">中，我们成功地安装了Keystone JS并创建了我们的第一个数据模型。</a></p><p id="149a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止一切顺利，但如果一个非管理员来到我们的网站，他们看到的只是一条错误消息。让我们来解决这个问题。</p><p id="15a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你检查一下Keystone文档，你会看到他们使用Jade作为模板，但是我们会做一些不同的事情。如标题所示，我们将使用React。</p><p id="5522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是在我们跳到有趣的部分之前，我们需要为我们的应用程序设置一条路线。Keystone运行在Express Js之上，如果您不知道Express work中的路由如何跳转到以下链接</p><div class="ky kz gp gr la lb"><a href="https://expressjs.com/en/guide/routing.html" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">快速路由</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">您可以使用与HTTP方法对应的Express app对象的方法来定义路由；比如app.get()到…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">expressjs.com</p></div></div></div></a></div><p id="6d06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">即使你从来没有处理过快递也没有必要担心，设置路线是非常简单的。首先，让我们在Keystone中注册我们的路线。在根文件夹中的Keystone配置中，我们将添加以下内容:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="2cfc" class="lt lu iq lp b gy lv lw l lx ly">keystone.set('routes', require('./server/routes'));</span></pre><p id="0d36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这指向一个我们还没有创建的文件，所以让我们这样做。在我们的服务器文件夹中，我们将转到routes子文件夹，创建一个新的index.js文件，并添加以下内容:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="8d30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们从终端启动Keystone应用程序，当我们转到<a class="ae kx" href="http://localhost:3000/index.html" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/index . html</a>时，我们应该会看到页面上写着Hello World。</p><p id="cbb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我知道你在想什么。这些都很好，但是React如何适应这一切呢？</p><p id="6ef6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，让我们在混合中加入一些反应魔法。对于这一部分，我们将切换到ES6。由于ES6在Node和大多数浏览器中仍不完全支持，我们将使用Babel和Webpack将其编译为ES5。</p><p id="89c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，继续工作，让我们安装Babel和Webpack。在您的终端中，确保您位于项目根文件夹中，然后运行:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="2d00" class="lt lu iq lp b gy lv lw l lx ly">npm install babel-core babel-loader babel-preset-env babel-preset-react webpack webpack-cli -D</span></pre><p id="2477" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们需要在我们的根目录下有一个webpack.config.js文件，没错，它将存储我们的webpack配置</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="a4d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了在我们的package.json中利用这一点，我们将添加一个编译脚本，该脚本将从客户端文件夹中获取我们的所有代码，并将其捆绑到一个文件中，该文件将存储在“server/public/js/”文件夹中。转到package.json文件，在脚本部分添加以下内容:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="7f49" class="lt lu iq lp b gy lv lw l lx ly">"scripts": {</span><span id="fe1b" class="lt lu iq lp b gy mb lw l lx ly">"start": "node index.js",</span><span id="d42d" class="lt lu iq lp b gy mb lw l lx ly">"compile": "webpack --config webpack.config.js",</span><span id="9aad" class="lt lu iq lp b gy mb lw l lx ly">"test": "test"</span><span id="7054" class="lt lu iq lp b gy mb lw l lx ly">},</span></pre><p id="6b84" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们需要将服务器指向bundle.js文件，这样我们就可以在浏览器中加载它。为此，我们需要转到我们的Keystone配置，并对其进行如下更新:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="2b4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们在这里时，我们还添加了一个img文件夹的路径，我们的食谱图像将存储在这里。</p><p id="5d5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们有了开始写React所需的一切。</p><p id="0f55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是在此之前，我们需要实际安装React到我们的项目中</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="a517" class="lt lu iq lp b gy lv lw l lx ly">npm install react react-dom </span></pre><p id="131d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好，我们已经添加了React to我们的依赖项，所以让我们快速构建一个简单的功能组件，它将让您了解来自Keystone后端的信息将如何呈现。我假设你有一些工作反应的知识，所以我不会深入到代码做什么，因为这不是本教程的目标。</p><p id="d879" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在客户端文件夹中创建index.jsx文件，并添加:</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="0a25" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们通过打开您的终端，导航到项目根文件夹并运行来编译它</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="aefd" class="lt lu iq lp b gy lv lw l lx ly">npm run compile</span></pre><p id="28db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在如果你往里看。/server/public/js/`文件夹中应该有一个bundle.js文件。</p><p id="5182" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们把文件导入到我们之前写的静态HTML中，同时去掉“Hello World”语句。</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="f7c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们在终端中运行启动脚本</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0f1b" class="lt lu iq lp b gy lv lw l lx ly">npm start</span></pre><p id="48fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们在浏览器中去index.html，应该会有这样的内容</p><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/c43264a465382f1c9530cd33db29882d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3OspOHXdRZy7oH14HR7Hw.png"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk translated">好吃，那些拉面看起来很好吃</figcaption></figure><p id="6f42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">干得好，但不幸的是这都是静态标记。我们的后端和前端没有真正的联系。我们可以在管理面板中添加尽可能多的食谱，但是一旦我们进入我们的索引页面，什么都不会改变。</p><p id="9032" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要惊慌，这一切都将在本教程的最后部分得到解决，我们将添加Redux来粘合一切。</p><h1 id="6a3f" class="mh lu iq bd mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd bi translated"><a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/building-a-node-cms-with-keystonejs-mongo-db-react-and-redux-part-iii-4c8b991cc3f">用KeystoneJS、Mongo DB、React和Redux构建节点CMS第三部分</a></h1></div></div>    
</body>
</html>