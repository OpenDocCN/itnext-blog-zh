<html>
<head>
<title>Using NSwag to Generate React Client for an ASP.NET Core 3 API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NSwag为ASP.NET核心3 API生成React客户端</h1>
<blockquote>原文：<a href="https://itnext.io/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api-9383c1b1776b?source=collection_archive---------2-----------------------#2019-12-23">https://itnext.io/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api-9383c1b1776b?source=collection_archive---------2-----------------------#2019-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f26b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本周我们将添加一个React项目，该项目将利用我们几周前创建的contacts API。这篇文章是ASP.NET核心基础回购的改造的一部分。网芯3.0发布。有关相关示例如何到达应用程序当前位置的详细信息，请查看以下帖子。</p><p id="8a85" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank"> Swagger/OpenAPI与NSwag和ASP.NET核心3</a><br/><a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET核心3:将实体框架核心添加到现有项目</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/new-razor-pages-application-backed-with-an-api/" rel="noopener ugc nofollow" target="_blank">新的Razor Pages项目由API支持</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET核心3 API生成Angular客户端</a></p><p id="a54b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我意识到使用ASP.NET核心支持的React项目对于这个示例来说是大材小用，一个原始的React应用程序就足够了。为了保持一致性，我选择使用ASP.NET核心模板作为这个系列中所有项目的基础。在最初的应用程序创建之后，除了应用程序的主API之外，如果有帮助或者React端生成的客户端可以用于包装模板生成的API，您可以将这个示例视为设置对辅助API的访问。</p><p id="e009" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中的任何变化之前的示例代码可以在这里找到<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/36b8b22e058a998a856bef8b7c95108b7555aaa2" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="2967" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建React项目</h2><p id="59d7" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">为React项目添加一个新目录，然后打开该目录的终端集。以下命令可用于创建新的React项目。目标框架不是必需的，但是我有一个预览。NET Core 3.1安装，我想确保这个项目是针对。网芯3.0。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="9b86" class="km kn iq lp b gy lt lu l lv lw">dotnet new react -f netcoreapp3.0</span></pre><p id="2f26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，使用下面的命令将新项目添加到repo根目录下的解决方案文件中。当然，如果不使用示例代码，文件名和路径会有所不同。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="e447" class="km kn iq lp b gy lt lu l lv lw">dotnet sln ..\..\BasicsRefresh.sln add ContactsReact.csproj</span></pre><h2 id="5933" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">使用NSwagStudio生成React客户端</h2><p id="b4d4" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">NSwag为客户端生成提供了多种选项，包括CLI、代码和Windows应用程序。这篇文章将使用名为NSwagStudio的Windows应用程序。从<a class="ae kl" href="http://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装NSwagStudio。</p><p id="7641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，确保您的API正在运行，并获取其OpenAPI/Swagger规范URL的URL。例如，我正在使用我的API的本地实例，我需要的URL是<a class="ae kl" href="https://localhost:5001/swagger/v1/swagger.json." rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://localhost:5001/swagger/v1/swagger . JSON</strong>。</a>如果您使用的是Swagger UI，您可以在API标题下找到指向swagger.json的链接。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/aeb7248d471b4baf78c6c73518d16447.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*MuC4v-uEurq_zte0.png"/></div></figure><p id="d6be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了API的OpenAPI/Swager规范URL，切换到NSwagStudio。应用程序将打开，并带有一个准备就绪的新文档。我们需要设置几个选项。首先，选择<strong class="jp ir"> OpenAPI/Swagger规范</strong>选项卡，并在<strong class="jp ir">规范URL </strong>框中输入您的API的规范URL。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/081c9f3a30abe63f3db13522e78d0c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-9jZYXb97ke24mHB.png"/></div></div></figure><p id="5dba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">输出</strong>部分，勾选<strong class="jp ir">打字脚本客户端</strong>复选框，然后选择<strong class="jp ir">打字脚本客户端</strong>选项卡。有很多选项可以使用，但是我强调了对这个示例很重要的选项。首先，确保<strong class="jp ir">模块名</strong>和<strong class="jp ir">命名空间</strong>都为空。我确信有办法让客户端使用模块或名称空间，但是我没有任何运气。对于<strong class="jp ir">模板</strong>，我们只需要一个基于<strong class="jp ir">获取</strong>的客户端。需要设置的最后一个选项是<strong class="jp ir">输出文件</strong>路径，这是您希望生成的文件所在的位置。我输出了client app \ src \ app \ components \ contact API . ts下的Angular项目目录，设置好所有选项后点击<strong class="jp ir">生成文件</strong>。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/8232778cf28726ca5a5c7f3dfa1ebf22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/0*RmQ_YGZ6tf5s6k8y.png"/></div></figure><h2 id="5ba1" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建UI并使用生成的客户端</h2><p id="f663" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">一旦完成上述操作，一旦切换回Visual Studio，您应该会看到下面的提示来添加<strong class="jp ir"> Microsoft。TypeScript . MSBuild</strong>n获取包。React模板不使用TypeScript，NSwag也没有生成普通JavaScript客户端的选项，所以添加这个包将允许构建过程使用我们的TypeScript客户端并将其转换为JavaScript。有一个<a class="ae kl" href="https://github.com/RicoSuter/NSwag/issues/1121" rel="noopener ugc nofollow" target="_blank">请求JavaScript生成器</a>的未决问题。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mh"><img src="../Images/70fbbbafbcd7305638bc8375e445d1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5jN_Rw3-nysW0T3z.png"/></div></div></figure><p id="e108" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">示例API是用于联系人管理的，所以我们将要构建的UI将显示一个联系人列表。在ClientApp/src/component目录下添加一个名为<strong class="jp ir"> ContactList.js </strong>的新文件，内容如下。特定于使用NSwag生成的客户端的行被突出显示。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="71a8" class="km kn iq lp b gy lt lu l lv lw">import React, { Component } from 'react';<br/>import { ContactsClient } from './contactsApi';  <br/><br/>export class ContactList extends Component {<br/>    static displayName = ContactList.name;<br/><br/>    constructor(props) {<br/>        super(props);<br/>        this.state = { contacts: [], loading: true };<br/>    }<br/><br/>    componentDidMount() {<br/>        this.populateContactData();<br/>    }<br/><br/>    static renderContactsTable(contacts) {<br/>        return (<br/>            &lt;table className='table table-striped' aria-labelledby="tabelLabel"&gt;<br/>                &lt;thead&gt;<br/>                    &lt;tr&gt;<br/>                        &lt;th&gt;Name&lt;/th&gt;<br/>                        &lt;th&gt;Address&lt;/th&gt;<br/>                        &lt;th&gt;City&lt;/th&gt;<br/>                        &lt;th&gt;State&lt;/th&gt;<br/>                        &lt;th&gt;Postal Code&lt;/th&gt;<br/>                        &lt;th&gt;Phone&lt;/th&gt;<br/>                        &lt;th&gt;Email&lt;/th&gt;<br/>                    &lt;/tr&gt;<br/>                &lt;/thead&gt;<br/>                &lt;tbody&gt;<br/>                    {contacts.map(contact =&gt;<br/>                        &lt;tr key={contact.id}&gt;<br/>                            &lt;td&gt;{contact.name}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.address}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.city}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.state}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.postalCode}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.phone}&lt;/td&gt;<br/>                            &lt;td&gt;{contact.email}&lt;/td&gt;<br/>                        &lt;/tr&gt;<br/>                    )}<br/>                &lt;/tbody&gt;<br/>            &lt;/table&gt;<br/>        );<br/>    }<br/><br/>    render() {<br/>        let contents = this.state.loading<br/>            ? &lt;p&gt;&lt;em&gt;Loading...&lt;/em&gt;&lt;/p&gt;<br/>            : ContactList.renderContactsTable(this.state.contacts);<br/><br/>        return (<br/>            &lt;div&gt;<br/>                &lt;h1 id="tabelLabel" &gt;Contacts&lt;/h1&gt;<br/>                {contents}<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/><br/>    async populateContactData() {<br/>        let client = new ContactsClient();<br/>        client.getContacts()<br/>              .then(data =&gt; this.setState({ contacts: data, loading: false }));<br/>    }<br/>}</span></pre><p id="8e7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的<strong class="jp ir"> populateContactData </strong>代码中可以看到，我们正在创建一个<strong class="jp ir"> ContactsClient </strong>的新实例，并调用它的<strong class="jp ir"> getContacts </strong>函数，使用我们从API返回的数据来设置组件的状态。</p><p id="f6a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在联系人列表已经准备好了，它需要一个导航栏中的链接。首先，在<strong class="jp ir"> App.js </strong>文件中，我们需要给路由器添加联系人列表。以下是完整的文件，其中突出显示了添加的行。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="3e8d" class="km kn iq lp b gy lt lu l lv lw">import React, { Component } from 'react';<br/>import { Route } from 'react-router';<br/>import { Layout } from './components/Layout';<br/>import { Home } from './components/Home';<br/>import { FetchData } from './components/FetchData';<br/>import { Counter } from './components/Counter';<br/>import { ContactList } from './components/ContactList';<br/><br/>import './custom.css'<br/><br/>export default class App extends Component {<br/>  static displayName = App.name;<br/><br/>  render () {<br/>    return (<br/>      &lt;Layout&gt;<br/>        &lt;Route exact path='/' component={Home} /&gt;<br/>        &lt;Route path='/contacts' component={ContactList} /&gt;<br/>        &lt;Route path='/counter' component={Counter} /&gt;<br/>        &lt;Route path='/fetch-data' component={FetchData} /&gt;<br/>      &lt;/Layout&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="9f7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在要添加一个联系人链接到导航栏，打开<strong class="jp ir"> NavMenu.js </strong>文件，添加以下内容和其他导航项目。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="10b5" class="km kn iq lp b gy lt lu l lv lw">&lt;NavItem&gt;<br/>    &lt;NavLink tag={Link} className="text-dark" to="/contacts"&gt;Contacts&lt;/NavLink&gt;<br/>&lt;/NavItem&gt;</span></pre><h2 id="f32b" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="24d2" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">这一轮让NSwag客户机工作起来我遇到了更多的麻烦，但这更多是由于我对React的肤浅了解，而不是NSwag的问题。</p><p id="8b23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本帖所有修改后的样本项目可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/506c43ccf76e65ef6b5e215fdd75744d41b4a332" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="2454" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">最初发表于</em> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank"> <em class="mp">埃里克·安德森</em> </a> <em class="mp">。</em></p></div></div>    
</body>
</html>