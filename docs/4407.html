<html>
<head>
<title>Monitoring Multiple Kubernetes Clusters using a single Kibana Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用单个Kibana仪表板监控多个Kubernetes集群</h1>
<blockquote>原文：<a href="https://itnext.io/monitoring-multiple-kubernetes-clusters-using-a-single-kibana-dashboard-17c6f7b9df67?source=collection_archive---------6-----------------------#2020-06-24">https://itnext.io/monitoring-multiple-kubernetes-clusters-using-a-single-kibana-dashboard-17c6f7b9df67?source=collection_archive---------6-----------------------#2020-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="89c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated">当我们必须管理多个Kubernetes环境时，我们可以很容易地使用一个Kibana仪表板监控所有集群指标。假设我们有2K8s个环境，比如测试和生产，我们将两个环境的所有指标都发送到一个Kibana仪表板。会发生什么？</p><p id="d61c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">默认情况下，Kibana不支持通过Kubernetes集群名称过滤指标。因此，它将在单个控制面板中显示两种环境数据，而不允许我们按环境进行筛选。这意味着，如果我们在每个Kubernetes环境中有2个节点，Kibana显示的节点数是4，如下所示。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/f41eb1dbe1c6256bd219ff9b92c5dfdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NH7BjUpuoEkIFU-DPvWYA.png"/></div></div></figure><p id="edeb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，我们如何过滤每个环境的上述信息呢？您可以使用公制节拍标签来达到您的要求。</p><p id="ec30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如您在这里看到的<a class="ae lj" href="https://github.com/madeesha/metricbeat/blob/cc243c4051df62fba31645cfe644c76c0b5efd9d/values.yaml#L42" rel="noopener ugc nofollow" target="_blank"/>，我们可以为每个环境使用一个标签，然后使用该标签过滤指标。当我们将一个标签添加到我们的metric-beat时，它会在导出到elastic之前将该标签添加到每个metric。</p><p id="9a71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以克隆<a class="ae lj" href="https://github.com/elastic/helm-charts" rel="noopener ugc nofollow" target="_blank">弹性helm repo </a>然后打开helm-charts/metric beat/values . YAML文件。在daemonSet和部署块下添加以下内容。你可以参考我提交给自己的Github repo的sample values.yaml 来获得更多信息。</p><pre class="ky kz la lb gt lk ll lm ln aw lo bi"><span id="733c" class="lp lq it ll b gy lr ls l lt lu">processors:<br/>  - add_tags:<br/>      tags: [test]</span></pre><p id="ec14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后将metric-beat helm repo安装到您的Kubernetes集群。</p><p id="f923" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:如果您已经在您的环境中配置了metricbeat，请删除它并使用新的更改重新安装metricbeat helm chart。</p><pre class="ky kz la lb gt lk ll lm ln aw lo bi"><span id="9364" class="lp lq it ll b gy lr ls l lt lu"><strong class="ll iu">helm repo add elastic </strong><a class="ae lj" href="https://Helm.elastic.co" rel="noopener ugc nofollow" target="_blank"><strong class="ll iu">https://Helm.elastic.co</strong></a><strong class="ll iu"><br/>helm install  metricbeat elastic/metricbeat -f values.yaml</strong></span></pre><p id="189a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在您可以使用新引入的标记来过滤Kibana dashboard，以过滤集群信息，如下所示。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lv"><img src="../Images/24bcc7225f626e9c4462b51db5e8ba03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aDYJKhspzEqVdBUvpVRFcg.gif"/></div></div></figure><p id="4321" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您转到Kibana → Discover选项卡并单击某个指标，您将能够看到，metricbeat已将该标签添加到它导出的每个指标中。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi lv"><img src="../Images/6618610bc0c76e238397b0a78e61fdc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wnOIs6S_5mIC_oqVjR-Yzw.gif"/></div></div></figure><p id="f575" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你需要更多关于如何配置Kibana dashboard的信息，你可以看看我之前的博客文章。</p><p id="a5ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">希望现在你有了在Kibana dashboard中过滤公制节拍数据的想法。干杯！！！</p></div></div>    
</body>
</html>