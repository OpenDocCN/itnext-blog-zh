<html>
<head>
<title>Customizing WKWebView in iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS中自定义WKWebView</h1>
<blockquote>原文：<a href="https://itnext.io/customizing-wkwebview-in-ios-523d85c115f?source=collection_archive---------3-----------------------#2019-08-19">https://itnext.io/customizing-wkwebview-in-ios-523d85c115f?source=collection_archive---------3-----------------------#2019-08-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="35b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运营团队不时希望实时更改他们的内容，而不是等待iOS应用程序的新版本更新。满足他们要求的两种最常见的方式是<a class="ae ko" href="https://firebase.google.com/docs/remote-config/?gclid=Cj0KCQjwhdTqBRDNARIsABsOl9-1GRbNWuh8PB0moV6SevTd8D3dt2jj06x7rhj_FpK2gGvVazjZHr0aAl3eEALw_wcB" rel="noopener ugc nofollow" target="_blank">远程配置</a>和<a class="ae ko" href="https://developer.apple.com/documentation/webkit/wkwebview" rel="noopener ugc nofollow" target="_blank"> WKWebView </a>。与标题一致，我将只关注WKWebView并演示我们如何实现它。</p><h2 id="dc22" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">显示网页内容</h2><p id="f9b3" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">让我们从最基本的开始:展示一个网页内容。不多解释了。😗</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/728de53ba7fab4a224545daea0edf6af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZjChipDRSvzzO3i_05JTQ.png"/></div></div></figure><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="64a3" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">使用WKWebView调试</h2><p id="a9de" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">我们可以借助Safari调试我们的iOS项目。打开Safari并按下⌘+，若要打开偏好设置，请在“高级”标签下，选中“在菜单栏中显示开发菜单”。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mb"><img src="../Images/7865ec3b4b30ea7e0b05c94ebbe684e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9947dt6XD17M6SEygMy9mA.png"/></div></div></figure><p id="1db2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直到我们有了项目构建，我们才能使用Safari调试器。调试器正在开发→您的模拟器或设备。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mc"><img src="../Images/244357c04fb066150500b8429f90d0ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LIJAiJsXn97zS0VNygceIg.png"/></div></div></figure><h2 id="3795" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">使用Javascript修改WebView</h2><p id="b5a3" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">在这里，我将用javascript创建一个按钮和一个标签，并对其应用一些CSS。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi md"><img src="../Images/7ed494002ea470d01947ff0291448703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*2fKIS2uL19jnJV9j6Gf4hw.png"/></div></figure><p id="6457" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用Safari调试，找到了想要的<code class="fe me mf mg mh b">&lt;div id="main"&gt;</code>。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi mi"><img src="../Images/536508e080af45513c4194e442253b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Vwdim-wLxni0MEBbtr0xg.png"/></div></div></figure><p id="b0c8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以使用简单的字符串或者从一个单独的js文件(在我的演示中是<em class="mj"> script.js </em>)中包含它来注入javascript代码。一旦我们有了javascript代码，我们就把它传递给<code class="fe me mf mg mh b">WKUserScript</code>，然后包装成<code class="fe me mf mg mh b">WKUserContentController</code>，最后用<code class="fe me mf mg mh b">WKWebViewConfiguration</code>来初始化<code class="fe me mf mg mh b">WKWebView</code>。</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="lz ma l"/></div></figure><h2 id="ce8b" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">监听javascript事件并作出回应</h2><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/6dba2ed2cea320cf1885252c24e33351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/1*0gsJloqreXcIHTl_SFEVoA.gif"/></div></figure><p id="6985" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过向<code class="fe me mf mg mh b">WKUserContentController</code>添加脚本消息处理程序来监听javascript事件。并符合<code class="fe me mf mg mh b">WKScriptMessageHandler</code>协议。</p><figure class="lo lp lq lr gt ls"><div class="bz fp l di"><div class="lz ma l"/></div></figure><p id="9e9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们使用<code class="fe me mf mg mh b">evaluateJavaScript(_ :, completionHandler:)</code>发送回我们的javascript响应。加油🎉</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="c381" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">使用本地html</h2><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/ddbda75e2f9868f4bedd6ed18dc2787d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/1*FK_JOqGE9-jZz_qGFt65Nw.gif"/></div></figure><p id="521b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">事实上，我们也可以使用本地html来呈现WebView，如下所示:</p><pre class="lo lp lq lr gt ms mh mt mu aw mv bi"><span id="a5c3" class="kp kq it mh b gy mw mx l my mz"><strong class="mh iu">if</strong> <strong class="mh iu">let</strong> url = Bundle.main.url(forResource: "index", withExtension: "html") {<br/>    webView.load(URLRequest(url: url))<br/>}</span></pre><p id="6516" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">或者</p><pre class="lo lp lq lr gt ms mh mt mu aw mv bi"><span id="8851" class="kp kq it mh b gy mw mx l my mz">let html = "&lt;h1&gt;WebView&lt;/h1&gt;"<br/>webView.loadHTMLString(html, baseURL: nil)</span></pre><p id="c873" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本质上，使用本地html是没有意义的，因为使用本地swift代码来生成您的UI会更加直接和高效。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="ad56" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">源代码</h2><p id="e494" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">你可以在这里找到完整的项目。另外，使用本地HTML的在<a class="ae ko" href="https://github.com/ji3g4kami/WKWebViewDemo/tree/localHTML" rel="noopener ugc nofollow" target="_blank">本地html分支</a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h2 id="ac47" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">参考</h2><ul class=""><li id="7bd1" class="na nb it js b jt li jx lj kb nc kf nd kj ne kn nf ng nh ni bi translated"><a class="ae ko" href="https://www.hackingwithswift.com/articles/112/the-ultimate-guide-to-wkwebview" rel="noopener ugc nofollow" target="_blank">wk webview终极指南</a></li><li id="cb8d" class="na nb it js b jt nj jx nk kb nl kf nm kj nn kn nf ng nh ni bi translated"><a class="ae ko" href="https://medium.com/john-lewis-software-engineering/ios-wkwebview-communication-using-javascript-and-swift-ee077e0127eb" rel="noopener">使用Javascript和Swift的iOS WKWebView通信</a></li><li id="f20b" class="na nb it js b jt nj jx nk kb nl kf nm kj nn kn nf ng nh ni bi translated"><a class="ae ko" href="https://medium.com/capital-one-tech/javascript-manipulation-on-ios-using-webkit-2b1115e7e405" rel="noopener">使用WebKit在iOS上操纵JavaScript】</a></li></ul></div></div>    
</body>
</html>