<html>
<head>
<title>Microk8s Docker Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Microk8s Docker注册表</h1>
<blockquote>原文：<a href="https://itnext.io/microk8s-docker-registry-c3f401faa760?source=collection_archive---------2-----------------------#2018-08-22">https://itnext.io/microk8s-docker-registry-c3f401faa760?source=collection_archive---------2-----------------------#2018-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="79a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个朋友曾经问，为什么人们更喜欢microk8s而不是minikube？…从那以后我们再也没说过话。真实故事！</p><p id="fc4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一个很难回答的问题，尤其是对一个工程师来说。答案并不明显，主要是因为这与个人偏好有关。让我告诉你为什么。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/60a7940a2a3b32017092b6e625d51d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*A3x2g4Mgh7F9Z5fkA6d2wQ.png"/></div></figure><p id="45e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从Microk8s的角度来看，这是拥有一个带有注册表的本地Kubernetes集群所必须做的事情:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="f827" class="ky kz iq ku b gy la lb l lc ld">sudo snap install microk8s --edge --classic<br/>microk8s.enable registry</span></pre><h2 id="bfb7" class="ky kz iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">这有什么了不起的？</h2><ul class=""><li id="8016" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">它超级快！一对夫妇数百MB的互联网管道，你都设置好了。</li><li id="9cc1" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">您可以省去浏览文档来设置和配置带有持久存储和注册表的Kubernetes的痛苦。</li></ul><h2 id="8dfc" class="ky kz iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">那么这为什么不好呢？</h2><ul class=""><li id="57ac" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">作为一名Kubernetes工程师，你可能想知道引擎盖下发生了什么。部署了什么？什么图像？在哪里？</li><li id="b3bf" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">作为Kubernetes用户，您可能需要配置注册表。图像存储在哪里？您能更改任何访问凭据吗？</li></ul><p id="5139" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你明白为什么这是偏好的问题了吗？Minikube是在VM中设置Kubernetes的成熟解决方案。它可以在任何地方运行(甚至在windows上),它只做一件事，建立一个Kubernetes集群。</p><p id="88f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，microk8s提供Kubernetes作为应用。它坚持己见，并且向自动化通用开发工作流迈出了一步。说到开发工作流...</p><h1 id="a09d" class="ml kz iq bd le mm mn mo lh mp mq mr lk ms mt mu ln mv mw mx lq my mz na lt nb bi translated">注册表的完整故事</h1><p id="36b1" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy nc ka kb kc nd ke kf kg ne ki kj kk ij bi translated">microk8s附带的注册表可在<code class="fe nf ng nh ku b">localhost</code>的端口<code class="fe nf ng nh ku b">32000</code>上获得。它是一个不安全的注册表，因为，说实话，在做本地开发时，谁会关心安全性:)。</p><p id="ffbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且越来越好了，看看这个！microk8s使用的docker守护进程被<a class="ae ni" href="https://github.com/ubuntu/microk8s/blob/master/microk8s-resources/default-args/docker-daemon.json" rel="noopener ugc nofollow" target="_blank">配置为信任</a>这个不安全的注册表。当我们想要上传图像时，我们就与这个守护进程对话。最简单的方法是使用microk8s附带的<code class="fe nf ng nh ku b">microk8s.docker</code>命令:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="10f7" class="ky kz iq ku b gy la lb l lc ld"># Lets get a Docker file first<br/>wget <a class="ae ni" href="https://raw.githubusercontent.com/nginxinc/docker-nginx/ddbbbdf9c410d105f82aa1b4dbf05c0021c84fd6/mainline/stretch/Dockerfile" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/nginxinc/docker-nginx/ddbbbdf9c410d105f82aa1b4dbf05c0021c84fd6/mainline/stretch/Dockerfile</a></span><span id="f472" class="ky kz iq ku b gy nj lb l lc ld"># And build it<br/>microk8s.docker build -t <!-- -->localhost:32000<!-- -->/nginx:testlocal . <!-- -->microk8s.docker push localhost:32000/<!-- -->nginx:testlocal</span></pre><blockquote class="nk nl nm"><p id="df9d" class="jn jo nn jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated">如果您喜欢使用外部docker客户端，您应该将它指向docker正在监听的套接字:</p><p id="a1f0" class="jn jo nn jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated"><code class="fe nf ng nh ku b">docker -H unix:///var/snap/microk8s/docker.sock ps</code></p></blockquote><p id="d797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用本地注册表中的图像，只需在清单中引用它:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="0478" class="ky kz iq ku b gy la lb l lc ld">apiVersion: v1<br/>kind: Pod<br/>metadata:<br/>  name: my-nginx<br/>  namespace: default<br/>spec:<br/>  containers:<br/>  - name: nginx<br/>    image: localhost:32000/<!-- -->nginx:testlocal<br/>  restartPolicy: Always</span></pre><p id="5a5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并部署有:</p><pre class="km kn ko kp gt kt ku kv kw aw kx bi"><span id="f54d" class="ky kz iq ku b gy la lb l lc ld">microk8s.kubectl create -f the-above-awesome-manifest.yaml</span></pre><div class="nr ns gp gr nt nu"><a href="https://asciinema.org/a/f28BuWcP6KNZZuCOSAA7JnQ9J" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">Microk8s和注册表</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">由kjackal录制</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">asciinema.org</p></div></div><div class="od l"><div class="oe l of og oh od oi kr nu"/></div></div></a></div><h1 id="aec2" class="ml kz iq bd le mm mn mo lh mp mq mr lk ms mt mu ln mv mw mx lq my mz na lt nb bi translated">这个帖子要保留什么？</h1><p id="383c" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy nc ka kb kc nd ke kf kg ne ki kj kk ij bi translated">你想要Kubernetes？我们将其作为(sn)应用程序交付！</p><p id="139e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你想在microk8s中看到你的工具链吗？给我们写封短信。<a class="ae ni" href="https://github.com/ubuntu/microk8s/pulls" rel="noopener ugc nofollow" target="_blank">给我们发个PR！</a></p><p id="5fd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们很高兴看到快乐的Kubernauts！</p><p id="ecf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那些来这里八卦的人。他不是一个好朋友(很明显！).我们只是在一次meetup上认识的:)！</p><h1 id="34fc" class="ml kz iq bd le mm mn mo lh mp mq mr lk ms mt mu ln mv mw mx lq my mz na lt nb bi translated">参考</h1><ul class=""><li id="69e9" class="lv lw iq jp b jq lx ju ly jy lz kc ma kg mb kk mc md me mf bi translated">Microk8s主站点:<a class="ae ni" href="http://www.microk8s.io" rel="noopener ugc nofollow" target="_blank"> http://microk8s.io </a></li><li id="17b8" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">Microk8s回购:【https://github.com/ubuntu/microk8s T2】</li><li id="4c1c" class="lv lw iq jp b jq mg ju mh jy mi kc mj kg mk kk mc md me mf bi translated">Microk8s注册表:<a class="ae ni" href="https://github.com/ubuntu/microk8s/blob/master/docs/registry.md" rel="noopener ugc nofollow" target="_blank">https://github . com/Ubuntu/micro k8s/blob/master/docs/registry . MD</a></li></ul></div></div>    
</body>
</html>