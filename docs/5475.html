<html>
<head>
<title>GYRO-WEB: ACCESSING THE DEVICE ORIENTATION IN JAVASCRIPT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GYRO-WEB:在JAVASCRIPT中访问设备方向</h1>
<blockquote>原文：<a href="https://itnext.io/gyro-web-accessing-the-device-orientation-in-javascript-387da43eeb84?source=collection_archive---------1-----------------------#2021-03-15">https://itnext.io/gyro-web-accessing-the-device-orientation-in-javascript-387da43eeb84?source=collection_archive---------1-----------------------#2021-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/24a35986f13232f29e939e3451f487e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkiruUauYUO6mnGeoGEgMQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图片来源:【https://newnow.co/me-myself-and-i/ T4】</figcaption></figure><blockquote class="kd ke kf"><p id="7ad0" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><em class="iq">本文有</em> <a class="ae kc" href="https://trekhleb.dev/blog/2021/gyro-web/" rel="noopener ugc nofollow" target="_blank"> <em class="iq">互动版</em> </a> <em class="iq">。您可以打开它，从您的移动设备上调整设备方向。</em></p></blockquote><h1 id="f5d7" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">在纯JavaScript中访问设备定向</h1><p id="e878" class="pw-post-body-paragraph kg kh iq kj b kk md km kn ko me kq kr mf mg ku kv mh mi ky kz mj mk lc ld le ij bi translated">在Javascript中，您可以通过监听<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/Detecting_device_orientation" rel="noopener ugc nofollow" target="_blank"> deviceorientation </a>事件来访问您的设备方位数据。就像下面这样简单:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="bd9b" class="mu lg iq mq b gy mv mw l mx my">window.addEventListener('deviceorientation', handleOrientation);<br/><br/>function handleOrientation(event) {<br/>  const alpha = event.alpha;<br/>  const beta = event.beta;<br/>  const gamma = event.gamma;<br/>  // Do stuff...<br/>}</span></pre><p id="9433" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">下面是<code class="fe mz na nb mq b">alpha</code>、<code class="fe mz na nb mq b">beta</code>和<code class="fe mz na nb mq b">gama</code>角度的含义:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7d49d7b8a25fe8a56ab7be4b907b794f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mb47G9t-t-WcH4v8.jpg"/></div></div></figure><p id="da8d" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated"><em class="ki">图片来源:</em><a class="ae kc" href="https://newnow.co/me-myself-and-i/" rel="noopener ugc nofollow" target="_blank"><em class="ki">newnow.co</em></a></p><p id="356b" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated"><strong class="kj ir">但是！</strong>不是每个浏览器都允许你在没有用户许可的情况下访问方位数据。例如，在iOS 13中，苹果引入了<a class="ae kc" href="https://www.w3.org/TR/orientation-event/#dom-deviceorientationevent-requestpermission" rel="noopener ugc nofollow" target="_blank"> requestPermission </a>方法。它必须在用户操作(点击、轻敲或等效操作)时触发。</p><p id="1d3b" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">访问设备方向的示例变得有点复杂:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="4094" class="mu lg iq mq b gy mv mw l mx my">function onClick() {<br/>  if (typeof DeviceMotionEvent.requestPermission === 'function') {<br/>    // Handle iOS 13+ devices.<br/>    DeviceMotionEvent.requestPermission()<br/>      .then((state) =&gt; {<br/>        if (state === 'granted') {<br/>          window.addEventListener('devicemotion', handleOrientation);<br/>        } else {<br/>          console.error('Request to access the orientation was rejected');<br/>        }<br/>      })<br/>      .catch(console.error);<br/>  } else {<br/>    // Handle regular non iOS 13+ devices.<br/>    window.addEventListener('devicemotion', handleOrientation);<br/>  }<br/>}</span></pre><p id="135c" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">如果你在本帖的<a class="ae kc" href="https://trekhleb.dev/blog/2021/gyro-web/" rel="noopener ugc nofollow" target="_blank">互动版中打开设备方向开关，你应该会看到你的设备报告的角度。</a></p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/4702732631b82268fb7e485a72caefc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*8eCWwsbYwYCky2wc.gif"/></div></figure><h1 id="9fd3" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">调试浏览器中的方向访问</h1><p id="5e7d" class="pw-post-body-paragraph kg kh iq kj b kk md km kn ko me kq kr mf mg ku kv mh mi ky kz mj mk lc ld le ij bi translated">如果您使用的是桌面设备，您可以在开发工具的“传感器”选项卡中模仿设备旋转:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/6d3405ece701058abf694cb34470c3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qYReUd_Rqai03mWL.jpg"/></div></div></figure><p id="2c0e" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">酷！现在，我们可以访问设备方向，甚至可以在浏览器中测试它！</p><h1 id="43d8" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">用于访问设备方向的反应挂钩</h1><p id="16f5" class="pw-post-body-paragraph kg kh iq kj b kk md km kn ko me kq kr mf mg ku kv mh mi ky kz mj mk lc ld le ij bi translated">我想采取的最后一步是拿出<a class="ae kc" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React钩子</a>，它将为我封装方向抓取，并使它更容易在React组件中使用(就像上面向您显示角度的那个)。</p><p id="e22f" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">下面是一个用TypeScript编写的<code class="fe mz na nb mq b">useDeviceOrientation.ts</code>钩子的例子:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="914a" class="mu lg iq mq b gy mv mw l mx my">import { useCallback, useEffect, useState } from 'react';<br/><br/>type DeviceOrientation = {<br/>  alpha: number | null,<br/>  beta: number | null,<br/>  gamma: number | null,<br/>}<br/><br/>type UseDeviceOrientationData = {<br/>  orientation: DeviceOrientation | null,<br/>  error: Error | null,<br/>  requestAccess: () =&gt; Promise&lt;boolean&gt;,<br/>  revokeAccess: () =&gt; Promise&lt;void&gt;,<br/>};<br/><br/>export const useDeviceOrientation = (): UseDeviceOrientationData =&gt; {<br/>  const [error, setError] = useState&lt;Error | null&gt;(null);<br/>  const [orientation, setOrientation] = useState&lt;DeviceOrientation | null&gt;(null);<br/><br/>  const onDeviceOrientation = (event: DeviceOrientationEvent): void =&gt; {<br/>    setOrientation({<br/>      alpha: event.alpha,<br/>      beta: event.beta,<br/>      gamma: event.gamma,<br/>    });<br/>  };<br/><br/>  const revokeAccessAsync = async (): Promise&lt;void&gt; =&gt; {<br/>    window.removeEventListener('deviceorientation', onDeviceOrientation);<br/>    setOrientation(null);<br/>  };<br/><br/>  const requestAccessAsync = async (): Promise&lt;boolean&gt; =&gt; {<br/>    if (!DeviceOrientationEvent) {<br/>      setError(new Error('Device orientation event is not supported by your browser'));<br/>      return false;<br/>    }<br/><br/>    if (<br/>      DeviceOrientationEvent.requestPermission<br/>      &amp;&amp; typeof DeviceMotionEvent.requestPermission === 'function'<br/>    ) {<br/>      let permission: PermissionState;<br/>      try {<br/>        permission = await DeviceOrientationEvent.requestPermission();<br/>      } catch (err) {<br/>        setError(err);<br/>        return false;<br/>      }<br/>      if (permission !== 'granted') {<br/>        setError(new Error('Request to access the device orientation was rejected'));<br/>        return false;<br/>      }<br/>    }<br/><br/>    window.addEventListener('deviceorientation', onDeviceOrientation);<br/><br/>    return true;<br/>  };<br/><br/>  const requestAccess = useCallback(requestAccessAsync, []);<br/>  const revokeAccess = useCallback(revokeAccessAsync, []);<br/><br/>  useEffect(() =&gt; {<br/>    return (): void =&gt; {<br/>      revokeAccess();<br/>    };<br/>  }, [revokeAccess]);<br/><br/>  return {<br/>    orientation,<br/>    error,<br/>    requestAccess,<br/>    revokeAccess,<br/>  };<br/>};</span></pre><p id="3ba5" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">挂钩的使用方法如下:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="68ba" class="mu lg iq mq b gy mv mw l mx my">import React from 'react';<br/>import Toggle  from './Toggle';<br/>import { useDeviceOrientation } from './useDeviceOrientation';<br/><br/>const OrientationInfo = (): React.ReactElement =&gt; {<br/>  const { orientation, requestAccess, revokeAccess, error } = useDeviceOrientation();<br/><br/>  const onToggle = (toggleState: boolean): void =&gt; {<br/>    const result = toggleState ? requestAccess() : revokeAccess();<br/>  };<br/><br/>  const orientationInfo = orientation &amp;&amp; (<br/>    &lt;ul&gt;<br/>      &lt;li&gt;ɑ: &lt;code&gt;{orientation.alpha}&lt;/code&gt;&lt;/li&gt;<br/>      &lt;li&gt;β: &lt;code&gt;{orientation.beta}&lt;/code&gt;&lt;/li&gt;<br/>      &lt;li&gt;γ: &lt;code&gt;{orientation.gamma}&lt;/code&gt;&lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  );<br/><br/>  const errorElement = error ? (<br/>    &lt;div className="error"&gt;{error.message}&lt;/div&gt;<br/>  ) : null;<br/><br/>  return (<br/>    &lt;&gt;<br/>      &lt;Toggle onToggle={onToggle} /&gt;<br/>      {orientationInfo}<br/>      {errorElement}<br/>    &lt;/&gt;<br/>  );<br/>};<br/><br/>export default OrientationInfo;</span></pre><h1 id="320e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">演示</h1><p id="f00f" class="pw-post-body-paragraph kg kh iq kj b kk md km kn ko me kq kr mf mg ku kv mh mi ky kz mj mk lc ld le ij bi translated">最后，有了对设备方向的访问，让我们模拟一个3D空间，并有可能通过旋转您的移动设备从3D视角观看对象。想象一下，你有一个虚拟的购物物品，你想从不同的角度和侧面看到它，然后再把它放进你的篮子里。</p><p id="39b9" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">我们将使用一个简单的3D立方体，它是由纯CSS通过使用<a class="ae kc" href="https://css-tricks.com/almanac/properties/p/perspective/" rel="noopener ugc nofollow" target="_blank">透视</a>、<a class="ae kc" href="https://css-tricks.com/almanac/properties/p/perspective-origin/" rel="noopener ugc nofollow" target="_blank">透视-原点</a>和<a class="ae kc" href="https://css-tricks.com/almanac/properties/t/transform/" rel="noopener ugc nofollow" target="_blank">变换</a>属性制作的(你可以在css-tricks.com上找到样式<a class="ae kc" href="https://css-tricks.com/how-css-perspective-works/" rel="noopener ugc nofollow" target="_blank">的完整示例)。</a></p><p id="e576" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">我们开始吧，这是我们的陀螺立方体，根据你的设备方向，你应该能够从不同的角度看到它！</p><p id="afba" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">如果你在笔记本电脑上阅读这篇文章，如果你启动这篇文章的<a class="ae kc" href="https://trekhleb.dev/blog/2021/gyro-web/" rel="noopener ugc nofollow" target="_blank">互动版本</a>，下面是演示如何在移动设备上运行:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/16809a1d8baab98e2047510b95f7b90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*fOsHrHgwWkFH0VQZ.gif"/></div></figure><p id="8a73" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">你可以在<a class="ae kc" href="https://github.com/trekhleb/trekhleb.github.io/tree/master/src/posts/2021/gyro-web/components/" rel="noopener ugc nofollow" target="_blank">trek Hleb . github . io</a>repo中找到本文中的所有代码示例(包括陀螺立方体样式)。</p><p id="661f" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr mf kt ku kv mh kx ky kz mj lb lc ld le ij bi translated">我希望这个例子对你有用！我还希望你能想出一个比上面的陀螺立方体更有趣、更现实的设备定向用例😄编码快乐！</p></div></div>    
</body>
</html>