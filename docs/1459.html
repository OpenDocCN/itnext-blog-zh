<html>
<head>
<title>MatError &amp; Cross-Field Validators In Angular Material 7</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度材料7中的MatError和交叉场验证器</h1>
<blockquote>原文：<a href="https://itnext.io/materror-cross-field-validators-in-angular-material-7-97053b2ed0cf?source=collection_archive---------0-----------------------#2018-10-23">https://itnext.io/materror-cross-field-validators-in-angular-material-7-97053b2ed0cf?source=collection_archive---------0-----------------------#2018-10-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/234576d8fe22021035899dc2a07c7019.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/1*dEBofE61opOVuVsbI35MdA.gif"/></div></figure></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><p id="f152" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><strong class="kd ir"> <em class="kz">注</em> </strong> <em class="kz">:内容与</em> <strong class="kd ir"> <em class="kz">角材2+相关。<br/> </em> </strong> <em class="kz">标题说的是</em> <strong class="kd ir"> <em class="kz">棱角分明的素材7 </em> </strong> <em class="kz">，既然是最新版本出来的，也是为了吸引眼球(我们总想读到最新的信息)。</em></p></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><p id="2b59" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">能够通过表单中当前的数据来验证表单似乎是一种基本的需要。<br/>举一个最基本、最常见的例子:注册表单中的<em class="kz">验证密码</em>字段。</p><p id="e5a3" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">假设你正在使用<a class="ae la" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank">有角的材料</a>来创建一个类似上面的形状，你可能会遇到以下情况:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/58c29fd386605b0bd1eda62682bc8b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/1*laC-xQwZKd8142TfKRlBDw.gif"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">为什么我看不到错误？！</figcaption></figure><p id="bf99" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">你别担心，这不是bug，这只是有角材料的工作方式。让我们了解一下，然后看看我们如何找到一个可行的解决方案。</p><p id="a10c" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">注意:这篇文章假设你熟悉角度的一些概念。我不会在这里教你。不过，我会给你一个链接供你学习。</p></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><h2 id="3f6c" class="lj lk iq bd ll lm ln dn lo lp lq dp lr km ls lt lu kq lv lw lx ku ly lz ma mb bi translated">匹配密码验证器</h2><p id="e100" class="pw-post-body-paragraph kb kc iq kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky ij bi translated">我们首先要创建一个带有所谓的<a class="ae la" href="https://angular.io/guide/form-validation#cross-field-validation" rel="noopener ugc nofollow" target="_blank">“跨字段”验证</a>的表单。<br/>这意味着我们希望根据同一表单中的其他数据来验证表单中的数据。</p><p id="57d6" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">为此，我将使用<a class="ae la" href="https://angular.io/guide/reactive-forms" rel="noopener ugc nofollow" target="_blank">反应式表单</a>(是的，我喜欢它)，使用开箱即用的实用程序<a class="ae la" href="https://angular.io/guide/reactive-forms#generating-form-controls-with-formbuilder" rel="noopener ugc nofollow" target="_blank">表单生成器</a>。然后我将创建密码验证器。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/d5c75b5549ec25e3f57dcab3529e5ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y12DHljFmj8pb9YRMYFaAg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">initForm()将从构造函数中调用</figcaption></figure><p id="c2b4" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">看最后一行。看到我们把验证器放在<strong class="kd ir">表单层次</strong>中，而不是<strong class="kd ir">控件层次</strong>中了吗？</p><p id="299a" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">这就是我们如何进行跨字段验证。它们适用于<strong class="kd ir">表单</strong>，而不适用于<strong class="kd ir">控件</strong>。</p><p id="415f" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">这意味着..</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi jn"><img src="../Images/3dd129cb82a8fbd78fc94c6e1ceb75e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/1*9kFJs-MGiQgMs_KY9jKXGQ.gif"/></div></div></figure><p id="f0af" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我们的控制总是有效的！</p><h2 id="b662" class="lj lk iq bd ll lm ln dn lo lp lq dp lr km ls lt lu kq lv lw lx ku ly lz ma mb bi translated">mat-错误未显示</h2><p id="7aa4" class="pw-post-body-paragraph kb kc iq kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky ij bi translated">让我们来看看我们用于输入的html</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mm"><img src="../Images/07da162939ac3b12b29144571145be1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haHowl7emqHok2bQr7QlYQ.png"/></div></div></figure><p id="8a5b" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">现在，我在想，一旦密码不匹配，我们<strong class="kd ir">应该</strong>会看到mat-error。正确吗？<br/>如果我们使用跨字段验证，那就不是这种状态——我们确实是这样做的。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/58c29fd386605b0bd1eda62682bc8b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/1*laC-xQwZKd8142TfKRlBDw.gif"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">为什么我看不到错误？！(重新运行)</figcaption></figure><p id="24ea" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><strong class="kd ir">为什么会这样？</strong></p><p id="ab6c" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">让我们来看一段来自<code class="fe mn mo mp mq b">mat-form-field.</code>的<a class="ae la" href="https://github.com/angular/material2/blob/master/src/lib/form-field/form-field.html#L75" rel="noopener ugc nofollow" target="_blank">官方代码</a>的片段</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mr"><img src="../Images/8cffac74cd33ede90ec368d3bc31f488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UruUd_gTS9c9S7Momdtprg.png"/></div></div></figure><p id="e9fd" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我们从中可以了解到，只有当表单域(控件)说它有错误时，它才使用一个<a class="ae la" href="https://scotch.io/tutorials/angular-2-transclusion-using-ng-content" rel="noopener ugc nofollow" target="_blank"> transclusion </a>来显示<code class="fe mn mo mp mq b">mat-error</code>。</p><p id="0423" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">因此，即使我们试图将<code class="fe mn mo mp mq b">mat-error</code>无任何条件，它也不会显示，直到控件声明它有问题(有效性或精神上😅)</p><h2 id="0877" class="lj lk iq bd ll lm ln dn lo lp lq dp lr km ls lt lu kq lv lw lx ku ly lz ma mb bi translated">ErrorStateMatcher来救援了！</h2><p id="a6c4" class="pw-post-body-paragraph kb kc iq kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky ij bi translated">根据<a class="ae la" href="https://material.angular.io/components/input/overview#changing-when-error-messages-are-shown" rel="noopener ugc nofollow" target="_blank">官方文档</a>并查看<a class="ae la" href="https://github.com/angular/material2/blob/master/src/lib/core/error/error-options.ts#L24" rel="noopener ugc nofollow" target="_blank">源代码</a>确认，如果<strong class="kd ir">控件</strong>为<strong class="kd ir">无效</strong>且<strong class="kd ir">触摸</strong>或<strong class="kd ir">表单提交</strong>则显示控件错误。</p><p id="54f5" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">为了实现这一点，如果表单本身无效，我们需要显示错误(因为我们讨论的是表单级别的验证)。</p><p id="0d67" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">在这种情况下，我们需要为控件定义自己的<code class="fe mn mo mp mq b">ErrorStateMatcher</code>。</p><p id="4b61" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">一个<code class="fe mn mo mp mq b">ErrorStateMatcher</code>是为表单域定义何时显示错误消息的类。</p><p id="589e" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">创建一个很简单。它将迫使我们创建一个<code class="fe mn mo mp mq b">isErrorState</code>方法，该方法接收一个<code class="fe mn mo mp mq b">FormControl</code>和<code class="fe mn mo mp mq b">FormGroupDirective</code>(反应式)/ <code class="fe mn mo mp mq b">NgForm</code>(模板驱动)参数。这些都是由表单域本身提供的，所以我们需要做的就是使用它们。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ms"><img src="../Images/b0a97d7b84e8c3dcf39281a3d3fc5030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzzA0rykUHY1fPpKP6qh4g.png"/></div></div></figure><p id="1d76" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我们现在说——如果我们开始在输入中键入一些东西，而表单本身是无效的，则声明控件有错误。</p><p id="1c21" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">让我们将这个<code class="fe mn mo mp mq b">ErrorStateMatcher</code>添加到输入中:</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mt"><img src="../Images/da9083bef44dd3c4b799f1ac77daa833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBSUl2m5JiwtX04TfLip4w.png"/></div></div></figure><p id="353f" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">现在，如果我们键入不匹配的密码，我们应该会立即看到错误！</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/234576d8fe22021035899dc2a07c7019.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/1*dEBofE61opOVuVsbI35MdA.gif"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk translated">最终结果(重新运行)</figcaption></figure><h1 id="2465" class="mu lk iq bd ll mv mw mx lo my mz na lr nb nc nd lu ne nf ng lx nh ni nj ma nk bi translated">演示</h1><p id="787a" class="pw-post-body-paragraph kb kc iq kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky ij bi translated">这是这个的演示。</p><p id="f7e1" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">去玩吧。</p></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><p id="b817" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我希望我教了你们一些新东西:)</p><p id="7fdb" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">Angular是一个大框架，我认为你对它及其子框架的了解是没有止境的。</p><p id="27cc" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><em class="kz">如果你喜欢这个帖子，欢迎你在</em> <a class="ae la" href="https://medium.com/@amir.tugi" rel="noopener"> <em class="kz">中</em> </a> <em class="kz">和</em> <a class="ae la" href="https://twitter.com/@amirtugi" rel="noopener ugc nofollow" target="_blank"> <em class="kz">推特</em> </a>中关注我</p></div></div>    
</body>
</html>