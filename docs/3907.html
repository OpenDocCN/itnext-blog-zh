<html>
<head>
<title>I wrote a Chrome Extension (Gitpod Window). Here is what I learned.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一个Chrome扩展(Gitpod Window)。以下是我学到的东西。</h1>
<blockquote>原文：<a href="https://itnext.io/i-wrote-a-chrome-extension-gitpod-window-here-is-what-i-learned-8583a3a179dd?source=collection_archive---------4-----------------------#2020-03-23">https://itnext.io/i-wrote-a-chrome-extension-gitpod-window-here-is-what-i-learned-8583a3a179dd?source=collection_archive---------4-----------------------#2020-03-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/fa58cd9357cfe2cc9531306bc8d0cb42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*ZyWsamEDx-GhizTTjhiN_Q.png"/></div></figure><p id="2d65" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Gitpod是一个用于GitHub和GitLab的在线IDE，它很棒，当我的笔记本电脑没有足够的资源时，它让我的生活变得更容易。但是作为一个VIM用户，当我点击Ctrl+w(这通常用于在不同的VIM窗口之间导航)时，整个Gitpod标签页就关闭了，我不得不再次重新打开它，这很烦人。</p><p id="b159" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这就是为什么我开始开发Chrome扩展(Gitpod Window ),让使用Gitpod的整体体验更好。我列出的要求是:</p><ol class=""><li id="9250" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">当用户点击GitHub或GitLab页面上的扩展图标时，在弹出的Chrome窗口中打开Gitpod工作区</li><li id="f80a" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">禁用Chrome快捷键</li></ol><p id="7503" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">由于我几乎没有构建Chrome扩展的经验，所以我写了这个故事来记录这个过程，并希望它能帮助像我这样的新手。😃</p><h1 id="d90e" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">开始使用Chrome扩展</h1><p id="fc67" class="pw-post-body-paragraph jx jy it jz b ka mh kc kd ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku im bi translated">谷歌在这里提供了很好的官方教程:<a class="ae mm" href="https://developer.chrome.com/extensions/getstarted" rel="noopener ugc nofollow" target="_blank">https://developer.chrome.com/extensions/getstarted</a></p><p id="03a9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">关键组件的快速总结:</p><ul class=""><li id="d433" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku mn lb lc ld bi translated">提供了重要的信息</li><li id="c53b" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku mn lb lc ld bi translated">后台脚本:扩展在其后台脚本中监控事件，然后根据指定的指令做出反应</li></ul><p id="1326" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这里，我们了解到后台脚本是我们可以监控事件的地方，它是实现我们目标的良好起点。</p><blockquote class="mo mp mq"><p id="5f6e" class="jx jy mr jz b ka kb kc kd ke kf kg kh ms kj kk kl mt kn ko kp mu kr ks kt ku im bi translated">我建议那些想进行下一步的人先完成上面链接中的教程。</p></blockquote><h1 id="0974" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">当用户点击GitHub或GitLab页面上的扩展图标时，在弹出的Chrome窗口中打开Gitpod工作区</h1><p id="623f" class="pw-post-body-paragraph jx jy it jz b ka mh kc kd ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku im bi translated">可以想象，点击扩展图标是一个事件，所以我们可以在后台脚本中完成。</p><p id="4324" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了处理事件，有两种类型的动作可以选择:<a class="ae mm" href="https://developer.chrome.com/extensions/pageAction" rel="noopener ugc nofollow" target="_blank"> pageAction </a>和<a class="ae mm" href="https://developer.chrome.com/extensions/browserAction" rel="noopener ugc nofollow" target="_blank"> browserAction </a>，因为我们的扩展只在特定的网站上工作，所以我们在这里使用<code class="fe mv mw mx my b">pageAction</code>。下面一个初级<code class="fe mv mw mx my b">manifest.json</code>:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="11aa" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在<code class="fe mv mw mx my b">permissions</code>中，我们添加了GitHub和GitLab URLs来限制这个扩展只能在存储库页面上工作。(例如。<a class="ae mm" href="https://github.com/jeromewu/gitpod-window)" rel="noopener ugc nofollow" target="_blank">https://github.com/jeromewu/gitpod-window)</a>我们还添加了一个关键字<code class="fe mv mw mx my b">page_action</code>来标识我们将在这个扩展中使用<code class="fe mv mw mx my b">pageAction</code>API。</p><p id="ccf3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">解决了<code class="fe mv mw mx my b">manifest.json</code>之后，接下来我们需要更新<code class="fe mv mw mx my b">background.js</code>来弹出带有<a class="ae mm" href="https://developer.chrome.com/extensions/windows" rel="noopener ugc nofollow" target="_blank">窗口</a> API的窗口:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="d8a2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">理想情况下，当我们点击扩展图标时，我们应该能够看到一个新的弹出窗口，但是如果你尝试编写上面的代码，你将会看到一个上下文菜单。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/4d11033c4d986d696886d49e28c7f2d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*NNOQFAbdABPaH5H39eL2Zw.png"/></div></figure><p id="67ee" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该行为与我们预期的不同，如果您仔细查看chrome . page action . onclicked . addlistener()，您会看到一个有趣的语句:</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/41bbb0681802818b7b5b6cd04e7c71a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xq1kIAec5CZi7Dhsm4VI_w.png"/></div></div><figcaption class="nl nm gj gh gi nn no bd b be z dk translated"><a class="ae mm" href="https://developer.chrome.com/extensions/pageAction#event-onClicked" rel="noopener ugc nofollow" target="_blank">https://developer . chrome . com/extensions/page action # event-on clicked</a></figcaption></figure><blockquote class="np"><p id="6604" class="nq nr it bd ns nt nu nv nw nx ny ku dk translated">如果页面操作有弹出窗口，则不会触发此事件。</p></blockquote><p id="dd36" class="pw-post-body-paragraph jx jy it jz b ka nz kc kd ke oa kg kh ki ob kk kl km oc ko kp kq od ks kt ku im bi translated">由于我们没有对弹出菜单做任何事情，这意味着弹出菜单不存在，对吗？答案是肯定的，但是onClicked有一个奇怪的行为，通常应该是这样的:</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/96d833d8c39c40749df420cab591b138.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*K-D6b8xqiUFyhiXavwsm9Q.png"/></div></figure><p id="0fb7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">但实际上，决定是在chrome.pageAction.show()之后做出的</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi of"><img src="../Images/a98f07848e7e9d83668b2ebc2454d567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*bqOGq17xGehLyCm4E8DOpw.png"/></div></figure><p id="1534" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以如果不先触发chrome.pageAction.show()就不会触发onClicked，我是在这里<a class="ae mm" href="https://developer.chrome.com/extensions/examples/api/pageAction/set_icon.zip" rel="noopener ugc nofollow" target="_blank">查样本的时候发现这个答案的</a>使用onClicked的时候真的是陷阱。</p><p id="6fea" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了解决这个问题，我们需要在我们手动单击扩展图标的选项卡上触发chrome.pageAction.show()。我们需要在<a class="ae mm" href="https://developer.chrome.com/extensions/tabs" rel="noopener ugc nofollow" target="_blank">选项卡</a> API中使用onUpdated和onActivated。在我们开始使用标签之前，不要忘记先更新<code class="fe mv mw mx my b">manifest.json</code>中的<code class="fe mv mw mx my b">permissions</code>:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="dedb" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后让我们更新<code class="fe mv mw mx my b">background.js</code>:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="de32" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这里的想法是在GitHub和GitLab页面上调用chrome.pageAction.show()来触发onClicked。</p><p id="a916" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们已经完成了我们的第一个要求！这是一个好看的弹出窗口，使Gitpod更接近于一个IDE，但没有IDE可以用Ctrl+W关闭，让我们继续下一部分禁用快捷键。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi og"><img src="../Images/c7499983ec301c84b957c7974df6f164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ui8mSEvpjMg2Ju9sxLM9bA.png"/></div></div></figure><h1 id="4b5e" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">禁用键盘快捷键</h1><p id="f83e" class="pw-post-body-paragraph jx jy it jz b ka mh kc kd ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku im bi translated">为了禁用快捷方式，我计划使用<a class="ae mm" href="https://developer.chrome.com/extensions/commands" rel="noopener ugc nofollow" target="_blank">命令</a> API，但最后我发现你不需要做任何事情，因为让我们讨厌的快捷方式是默认禁用的。(包括Ctrl+W，Ctrl+N，Ctrl+T)所以我们在这里使用弹出窗口来完成这个问题！</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="7ce8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">希望你喜欢这个故事，如果你想了解更多关于这个Chrome扩展，你可以访问:</p><ul class=""><li id="10e9" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku mn lb lc ld bi translated">GitHub库:<a class="ae mm" href="https://github.com/jeromewu/gitpod-window/tree/v1.0.1" rel="noopener ugc nofollow" target="_blank">https://github.com/jeromewu/gitpod-window/tree/v1.0.1</a></li><li id="2f17" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku mn lb lc ld bi translated">Chrome网络商店:<a class="ae mm" href="https://chrome.google.com/webstore/detail/gitpod-window/jhpkbhdoenpnfnnkelgpikndadikogdl" rel="noopener ugc nofollow" target="_blank">https://chrome . Google . com/Web Store/detail/git pod-window/jhpkpbhdoenpnfnnkelgpikndadikogdl</a></li></ul></div></div>    
</body>
</html>