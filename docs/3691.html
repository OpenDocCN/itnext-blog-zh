<html>
<head>
<title>Using NSwag to Generate an Aurelia Client for an ASP.NET Core 3.1 API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NSwag为ASP.NET核心3.1 API生成Aurelia客户端</h1>
<blockquote>原文：<a href="https://itnext.io/using-nswag-to-generate-an-aurelia-client-for-an-asp-net-core-3-1-api-1b430005473e?source=collection_archive---------4-----------------------#2020-02-03">https://itnext.io/using-nswag-to-generate-an-aurelia-client-for-an-asp-net-core-3-1-api-1b430005473e?source=collection_archive---------4-----------------------#2020-02-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f5eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本周我们将添加一个<a class="ae kl" href="https://aurelia.io/" rel="noopener ugc nofollow" target="_blank"> Aurelia </a>项目，该项目将利用我们几周前使用NSwag生成的客户端创建的contacts API。这篇文章是ASP.NET核心基础回购的改造的一部分。NET Core 3.0现已发布，目标是。网芯3.1。有关相关样本如何达到当前状态的详细信息，请查看以下帖子。</p><p id="c714" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank">使用NSwag和ASP.NET Core 3的Swagger/open API</a><br/><a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET Core 3:向现有项目添加实体框架核心</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/new-razor-pages-application-backed-with-an-api/" rel="noopener ugc nofollow" target="_blank">新的Razor Pages项目支持API </a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成Angular客户端</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成React客户端</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/01/using-nswag-to-generate-blazor-server-client-for-an-asp-net-core-3-1-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3.1 API生成Blazor服务器客户端</a></p><p id="bd8e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文修改前的示例代码可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/a7e807f6fb4195caafb357c4b037d01cf41a33aa" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/81b4aec31736025598e693db0b6f46f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*-SzlkxE5TtSkKpP_.png"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/8b152a2b180859c98f0db67f984850d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*MQTbKGwdm-qdMoD0.png"/></div></figure><h2 id="e1d2" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">创建Aurelia项目</h2><p id="3347" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">和Vue一样，没有。微软的. NET CLI模板支持Aurelia，所以为了创建Aurelia项目，我们将使用<a class="ae kl" href="https://aurelia.io/docs/cli" rel="noopener ugc nofollow" target="_blank"> Aurelia CLI </a>。在开始之前，确保您已经安装了<a class="ae kl" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">NPM</a>。</p><p id="6f5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在命令提示符下使用以下命令安装Aurelia CLI。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="9b48" class="ku kv iq lt b gy lx ly l lz ma">npm install -g aurelia-cli</span></pre><p id="f01a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，使用以下命令通过Aurelia CLI启动项目创建过程。请记住，CLI会使用项目名称创建一个目录。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="7a0b" class="ku kv iq lt b gy lx ly l lz ma">au new</span></pre><p id="7e02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以上将导致项目创建过程的演练。首先是项目的名称，在本例中是contacts-aurelia。接下来是项目的设置，这里我们将使用<strong class="jp ir">默认类型脚本应用</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/ea7c49e347b4b411d19111ace21b0358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/0*O9XQoqKr46vja22j.png"/></div></figure><p id="6be2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，选择您希望如何管理依赖关系。示例项目使用npm，但是Yarn也是一个选项。如果您使用Yarn，下面的一些步骤需要将npm命令翻译成Yarn命令。</p><p id="5e77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目创建过程完成后，使用以下命令切换到为项目创建的新目录。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="4df7" class="ku kv iq lt b gy lx ly l lz ma">cd contacts-aurelia</span></pre><p id="7417" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在项目需要安装更多的依赖项。我们将安装几个UI相关的项目，Bootstrap和Font Awesome，以及Aurelia Fetch客户端，我们将需要它来访问我们的API。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="b37e" class="ku kv iq lt b gy lx ly l lz ma">npm install bootstrap<br/>npm install font-awesome<br/>npm install aurelia-fetch-client</span></pre><p id="ce96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Aurelia CLI输出的应用程序非常基础，因此用于<a class="ae kl" href="https://aurelia.io/docs/tutorials/creating-a-todo-app" rel="noopener ugc nofollow" target="_blank">创建待办应用程序</a>和<a class="ae kl" href="https://aurelia.io/docs/tutorials/creating-a-contact-manager" rel="noopener ugc nofollow" target="_blank">创建联系人管理器</a>的Aurelia文档用于构建示例应用程序的基础。我将覆盖UI中与联系人相关的部分，但是应用程序在这一点上没有实现保存功能。</p><h2 id="adcb" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">使用NSwagStudio生成API客户端</h2><p id="4910" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">NSwag为客户端生成提供了多种选项，包括CLI、代码或Windows应用程序。这篇文章将使用名为NSwagStudio的Windows应用程序。NSwagStudio可以从<a class="ae kl" href="http://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载安装。</p><p id="8173" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，确保您的API正在运行，并获取其OpenAPI/Swagger规范URL的URL。例如，使用示例解决方案的Contacts API的本地实例，URL是<a class="ae kl" href="https://localhost:5001/swagger/v1/swagger.json." rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://localhost:5001/swagger/v1/swagger . JSON</strong>。</a>如果您使用的是Swagger UI，您可以在API标题下找到指向swagger.json的链接。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/4dd0fb32538fc74208cfc7ce5a7ed9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*atZYxmTAgN5lwZOa.png"/></div></figure><p id="a946" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了API的OpenAPI/Swager规范URL，切换到NSwagStudio。应用程序将打开，并带有一个准备就绪的新文档。我们需要设置几个选项。首先，选择<strong class="jp ir"> OpenAPI/Swagger规范</strong>选项卡，并在<strong class="jp ir">规范URL </strong>框中输入您的API规范URL。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/55c9cfbbf7712cd57830f1736dc579ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zTxWssxOIgLZPNeM.png"/></div></div></figure><p id="cbaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">输出</strong>部分勾选<strong class="jp ir">打字稿客户端</strong>复选框，然后选择<strong class="jp ir">打字稿客户端</strong>选项卡。有许多选项可供选择，突出显示的选项对于本示例非常重要。对于<strong class="jp ir">模板</strong>，我们只需要一个基于<strong class="jp ir"> Aurelia </strong>的客户端。需要设置的最后一个选项是<strong class="jp ir">输出文件</strong>路径，这是您希望生成的文件所在的位置。我输出到/src/contactApi.ts下的Aurelia项目目录，设置好所有选项后点击<strong class="jp ir">生成文件</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/a3e7c35b5d60abf5214c776abacf48c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/0*42Rib-bMg5iztK6r.png"/></div></figure><h2 id="ad2a" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">创建UI并使用生成的客户端</h2><p id="1920" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">同样，UI部分主要来自文档，但我将在这里显示联系人列表的部分，UI的其余部分您可以查看示例代码。以下所有内容都将在Aurelia项目的src目录中进行。</p><p id="f2fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，添加一个名为<strong class="jp ir">contact-list.html</strong>的文件，它将保存联系人列表UI的模板，内容如下。这是HTML和Aurelia语法的混合。我们并没有真正深入到奥瑞利亚的具体部分，但即使你是奥瑞利亚的新手，这也应该是可读的。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="b720" class="ku kv iq lt b gy lx ly l lz ma">&lt;template&gt;<br/>  &lt;div class="contact-list"&gt;<br/>    &lt;ul class="list-group"&gt;<br/>      &lt;li repeat.for="contact of contacts" class="list-group-item ${contact.id === $parent.selectedId ? 'active' : ''}"&gt;<br/>        &lt;a route-href="route: contacts; params.bind: {id:contact.id}" click.delegate="$parent.select(contact)"&gt;<br/>          &lt;h4&gt;${contact.firstName} ${contact.lastName}&lt;/h4&gt;<br/>          &lt;p&gt;${contact.email}&lt;/p&gt;<br/>        &lt;/a&gt;<br/>      &lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="0e48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，添加一个<strong class="jp ir"> contact-list.ts </strong>文件，上面的模板将绑定到这个文件。特定于使用NSwag生成的客户端的行被突出显示。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="a659" class="ku kv iq lt b gy lx ly l lz ma">import {ContactsClient, Contact} from './contactsApi';<br/>import {inject} from 'aurelia-framework';<br/><br/>@inject(ContactsClient)<br/>export class ContactList {<br/>  contacts: Contact[];<br/>  api: ContactsClient;<br/>  selectedId: any;<br/>  <br/>  constructor(api: ContactsClient) {<br/>    this.api = api;<br/>    this.contacts = [];<br/>  }<br/><br/>  created() {<br/>    this.api.getContacts().then(contacts =&gt; this.contacts = contacts);<br/>  }<br/><br/>  select(contact) {<br/>    this.selectedId = contact.id;<br/>    return true;<br/>  }<br/>}</span></pre><p id="7526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面可以看到，Aurelia通过类的构造注入了一个<strong class="jp ir"> ContactsClient </strong>的实例，然后在<strong class="jp ir">创建的</strong>函数中使用该客户端来调用API客户端的<strong class="jp ir"> getContacts </strong>函数，并使用从API得到的数据用API调用的结果替换<strong class="jp ir"> contacts </strong>字段。</p><p id="edd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序通过<strong class="jp ir">联系人列表</strong>元素在<strong class="jp ir">app.html</strong>中显示联系人列表。联系人列表组件的导入和使用在下面的代码块中突出显示。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="1481" class="ku kv iq lt b gy lx ly l lz ma">&lt;template&gt;<br/>  &lt;require from="./styles.css"&gt;&lt;/require&gt;<br/>  &lt;require from="./contact-list"&gt;&lt;/require&gt;<br/><br/>  &lt;nav class="navbar navbar-light bg-light fixed-top" role="navigation"&gt;<br/>    &lt;a class="navbar-brand" href="#"&gt;<br/>      &lt;i class="fa fa-user"&gt;&lt;/i&gt;<br/>      &lt;span&gt;Contacts&lt;/span&gt;<br/>    &lt;/a&gt;<br/>  &lt;/nav&gt;<br/><br/>  &lt;div class="container"&gt;<br/>    &lt;div class="row"&gt;<br/>      &lt;contact-list class="col-md-4"&gt;&lt;/contact-list&gt;<br/>      &lt;router-view class="col-md-8"&gt;&lt;/router-view&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="9250" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，我测试了应用程序，它没有拉回任何数据。在我的浏览器开发工具的网络选项卡中做了一些挖掘后，我注意到API调用缺少URL的基本部分。这在我以前使用NSwag生成的客户端时没有出现过，如果您查看客户端的构造函数，它会将基本URL默认为用于生成客户端的端点，请参见下面的代码。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="8bd9" class="ku kv iq lt b gy lx ly l lz ma">constructor(baseUrl?: string, http?: { fetch(url: RequestInfo, init?: RequestInit): Promise&lt;Response&gt; }) {<br/>    this.http = http ? http : &lt;any&gt;window;<br/>    this.baseUrl = baseUrl ? baseUrl : "https://localhost:5001";<br/>}</span></pre><p id="8fda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原来Aurelia依赖注入系统调用构造函数用的是空字符串而不是null。一种选择是修改上面的构造函数来处理空字符串，但这意味着每当客户端重新生成时，我都必须记得修改构造函数，这太容易出错了。经过一番挖掘，我发现Aurelia提供了一种方法来控制一个类的实例是如何创建的。打开<strong class="jp ir"> main.ts </strong>并进行以下突出显示的更改。我正在注入URL，但是使用null也可以，并且将使用来自ContactClient的基本URL。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="4685" class="ku kv iq lt b gy lx ly l lz ma">import { HttpClient } from 'aurelia-fetch-client';<br/>import {Aurelia} from 'aurelia-framework'<br/>import * as environment from '../config/environment.json';<br/>import {PLATFORM} from 'aurelia-pal';<br/>import 'bootstrap/dist/css/bootstrap.css';<br/>import 'font-awesome/css/font-awesome.css';<br/>import { ContactsClient } from 'contactsApi';<br/><br/>export function configure(aurelia: Aurelia) {<br/>  aurelia.use<br/>    .standardConfiguration()<br/>    .feature(PLATFORM.moduleName('resources/index'))<br/>    .instance(ContactsClient, <br/>              new ContactsClient("https://localhost:5001",<br/>                                 aurelia.container.get(HttpClient)));<br/><br/>  aurelia.use.developmentLogging(environment.debug ? 'debug' : 'warn');<br/><br/>  if (environment.testing) {<br/>    aurelia.use.plugin(PLATFORM.moduleName('aurelia-testing'));<br/>  }<br/><br/>  aurelia.start().then(() =&gt; aurelia.setRoot(PLATFORM.moduleName('app')));<br/>}</span></pre><p id="a53b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在所有从命令提示符设置到Aurelia项目的根之后，您可以使用下面的命令来运行应用程序。如果你放弃打开，它将运行应用程序而不打开浏览器。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="0448" class="ku kv iq lt b gy lx ly l lz ma">au run --open</span></pre><h2 id="4af2" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="fb13" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">一如既往，NSwag使得创建一个与API交互的客户端变得非常容易。希望这是有用的，即使我的Aurelia代码可能不是惯用的。</p><p id="fd11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本帖修改后的样本项目可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/ce90da48353633653f4c2c194fdc597abe18a150" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><p id="a5da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mq">原载于</em><a class="ae kl" href="https://elanderson.net/2020/02/using-nswag-to-generate-an-aurelia-client-for-an-asp-net-core-3-1-api/" rel="noopener ugc nofollow" target="_blank"><em class="mq"/></a><em class="mq">。</em></p></div></div>    
</body>
</html>