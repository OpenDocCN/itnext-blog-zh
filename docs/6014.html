<html>
<head>
<title>Integrating Clear ORM With Crystal’s Amber Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Clear ORM与Crystal的Amber框架相集成</h1>
<blockquote>原文：<a href="https://itnext.io/integrating-clear-orm-with-crystals-amber-framework-c0a55a67f4ca?source=collection_archive---------2-----------------------#2021-07-24">https://itnext.io/integrating-clear-orm-with-crystals-amber-framework-c0a55a67f4ca?source=collection_archive---------2-----------------------#2021-07-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ea21" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://amberframework.org/" rel="noopener ugc nofollow" target="_blank"> Amber </a>是Crystal编程语言的web开发框架。它使用<a class="ae ko" href="https://github.com/amberframework/granite" rel="noopener ugc nofollow" target="_blank">花岗岩</a>作为它的默认ORM。虽然Granite可以工作，但我认为如果你的数据库选择是PostgreSQL，那么<a class="ae ko" href="https://clear.gitbook.io/project/" rel="noopener ugc nofollow" target="_blank"> Clear </a>会更加丰富。我想把Clear ORM和Amber整合起来，试一试。本文的主要焦点是解释我将Clear与Amber集成所经历的过程，以及我如何解决在这个过程中所面临的一些问题。</p><p id="803c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本文中，我将使用Clear ORM重写<a class="ae ko" href="https://docs.amberframework.org/amber/getting-started" rel="noopener ugc nofollow" target="_blank"> Amber的快速入门指南</a>的宠物跟踪器示例。最终应用的源代码可以在这里找到—<a class="ae ko" href="https://github.com/imeraj/amber_playground/tree/main/pet-trackeer-clear" rel="noopener ugc nofollow" target="_blank">https://github . com/imeraj/amber _ playground/tree/main/pet-track eer-clear</a>。<em class="kp">注意项目名称中的错别字，我在完成app后注意到了:)</em></p><h1 id="1df4" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">版本信息</h1><p id="1cf6" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">我用的是下面的版本—</p><ul class=""><li id="aef5" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">晶体— 1.0.0</li><li id="4c96" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">琥珀色— 1.0.0rc2</li><li id="a5aa" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">清除-最新的主文件</li><li id="fa8d" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">PostgreSQL — 12.1</li></ul><h1 id="2ef7" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">创建新项目</h1><p id="3e86" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">首先，使用下面的命令创建一个新项目—</p><blockquote class="mh mi mj"><p id="0005" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">琥珀色新宠物跟踪器-透明</p></blockquote><p id="9a0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">和cd到项目目录。</p><h1 id="5aa6" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">从项目中移除花岗岩</h1><p id="c01c" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">从项目中删除对花岗岩的任何引用。这意味着从<strong class="js iu"> shards.yml </strong>中删除以下内容</p><blockquote class="mh mi mj"><p id="7236" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">花岗岩:<br/>git:<a class="ae ko" href="https://github.com/amberframework/granite.git" rel="noopener ugc nofollow" target="_blank">https://github.com/amberframework/granite.git</a><br/>版本:0.23.0</p></blockquote><p id="f14c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从<strong class="js iu"> config/database.cr </strong>中删除以下内容</p><blockquote class="mh mi mj"><p id="1296" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">需要“花岗岩/适配器/pg”</p><p id="9a4f" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">granite::Connections&lt;&lt; Granite::Adapter::Pg.new(name: “pg”, url: ENV[“DATABASE_URL”]? || Amber.settings.database_url)</p></blockquote><h1 id="caab" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">Add Clear to project and configure</h1><p id="9917" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">Add Clear in <strong class="js iu">shards . yml</strong></p><blockquote class="mh mi mj"><p id="9e2e" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">clear:<br/>github:any keyh/clear<br/>分支:主</p></blockquote><p id="4a02" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">更新<strong class="js iu"> config/database.cr </strong>以包含以下内容—</p><blockquote class="mh mi mj"><p id="cd21" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">要求“清楚”</p><p id="e9b4" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">要求"../db/migrations/* "</p><p id="10e7" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">#初始化数据库连接池:</p><p id="a7d4" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">clear::SQL . init(" postgres://meraj @ localhost/pet _ tracker _ development ")</p></blockquote><p id="f664" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，在<strong class="js iu">config/environments/development . yml</strong>中，更新数据库url以包含用户名和密码(如果您有一套)以及正确的数据库名称——</p><blockquote class="mh mi mj"><p id="ac2d" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">database _ URL:postgres://meraj:@ localhost:5432/pet _ tracker _ development</p></blockquote><p id="6122" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">随着这些添加，我试图做<strong class="js iu">碎片安装</strong>，但我得到了以下错误—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/522c625c8aed8f34efa58e450803768d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EgWnzAncT5VIPJzX6AgWw.png"/></div></div></figure><p id="61b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这显示了<strong class="js iu">变形器</strong>碎片的两个不同来源之间的冲突。所以我通过在项目根目录下创建<strong class="js iu"> shard.override.yml </strong>应用了一个覆盖，内容如下</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mz"><img src="../Images/e4a35a1abe1044cbcd3160447625b52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7GJOwIaN8cFwCXI1FGbxoA.png"/></div></div></figure><p id="96ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在做了<strong class="js iu">碎片后，再次安装</strong>，这成功地整合了清晰与琥珀色。</p><h1 id="601e" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">生成并应用迁移</strong></h1><p id="3823" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在<strong class="js iu">db/migrations(</strong><em class="kp">clear)下生成一个迁移文件，似乎有一个CLI来执行此操作，但我手动生成了它— </em></p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi na"><img src="../Images/63133dafe7a1e41ee16c2f396fae14de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iO6kzZBwrvIMSjOQ7at9Aw.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">20210722001906661 _ create _ pet . Cr</figcaption></figure><p id="c974" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用amber CLI创建数据库并应用此迁移—</p><blockquote class="mh mi mj"><p id="27bd" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">琥珀色数据库创建</p><p id="8a46" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">amber exec Clear::Migration::manager . instance . apply _ all</p></blockquote><p id="662a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将创建包含上述列的数据库和<strong class="js iu"> pets </strong>表。</p><h1 id="f12b" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">创建模型</h1><p id="6592" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">更新<strong class="js iu"> config/application.cr </strong>文件以添加模型的位置—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nf"><img src="../Images/4a0085e3176c5df098389a69552bd4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12QZl9g71xdT02r-Q8EstA.png"/></div></div></figure><p id="4f05" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里新增加的是—</p><blockquote class="mh mi mj"><p id="4c69" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">要求"../src/models/** "</p></blockquote><p id="6f40" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<strong class="js iu"> src/model </strong>内创建<strong class="js iu"> pet.cr </strong>，内容如下—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ng"><img src="../Images/eda86a66be959365ad9ba06f08c91c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvtbgHSsVU_C_qxpre9k6g.png"/></div></div></figure><p id="466e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意:<em class="kp">别忘了包括</em> <strong class="js iu"> <em class="kp">时间戳</em> </strong> <em class="kp">。如果这样做，</em> <strong class="js iu"> <em class="kp">创建_at </em> </strong> <em class="kp">和</em> <strong class="js iu"> <em class="kp">更新_at </em> </strong> <em class="kp">列中的</em> <strong class="js iu"> <em class="kp">宠物</em> </strong> <em class="kp">表格不会自动更新。</em></p><h1 id="a1df" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">更新路线</h1><p id="b234" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">更新<strong class="js iu"> config/routes.cr </strong>以包含新的宠物路线—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nh"><img src="../Images/04723c314a734181eb0695c82554c08b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ziDYbGQxc8k5C5cBpvRmmA.png"/></div></div></figure><h1 id="b9ff" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">创建控制器和视图</h1><p id="2573" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在这个阶段，项目应该很好地建立必要控制器和视图。在<strong class="js iu"> src/controllers </strong>下添加<strong class="js iu"> pet_controller.cr </strong>，在<strong class="js iu"> src/views/pet下添加必要的视图。</strong></p><p id="8ac3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">视图和控制器中的大多数内容都是从amber生成的视图和控制器中重用的，如果您遵循它们的快速入门指南，应该很容易理解。我只需要修改<strong class="js iu"> pet_controller </strong>中的查询来使用Clear的语法。</p><p id="edce" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于索引操作，更新后的代码如下所示—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ni"><img src="../Images/c5b353134a1b47dc4fb9cd6871d7d3d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaRM70Ifgt8EXIHGQc6ZYw.png"/></div></div></figure><p id="14fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于创建操作，更新后的代码如下所示—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nj"><img src="../Images/e5756a4dd2bd9353ee74224b2d3aff32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1uH29nGweRRXEpQ_mU1fog.png"/></div></div></figure><p id="d381" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于更新操作，更新后的代码如下所示—</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nk"><img src="../Images/bc11f7611e5bad1d3112ae7f6a0c8aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*961wFH02FbGZRVTZnbMV_w.png"/></div></div></figure><p id="0ad3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">观点有所调整，但应该很容易理解。所以我不会解释这些。</p><h1 id="e55f" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">试验</h1><p id="2a3b" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在这个阶段，应用程序应该准备好使用下面的命令运行—</p><blockquote class="mh mi mj"><p id="34dd" class="jq jr kp js b jt ju jv jw jx jy jz ka mk kc kd ke ml kg kh ki mm kk kl km kn im bi translated">琥珀手表</p></blockquote><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nl"><img src="../Images/a4ae824fe6cf5024aa36991f665956ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FhYUjtIfFBmI4YM9dMQoBg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">app首页截图(添加情侣宠物后)</figcaption></figure><h1 id="9421" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated"><strong class="ak">结论</strong></h1><p id="d13e" class="pw-post-body-paragraph jq jr it js b jt lo jv jw jx lp jz ka kb lq kd ke kf lr kh ki kj ls kl km kn im bi translated">在本文中，我使用Amber的快速入门演示应用程序演示了如何将Clear ORM与Amber框架集成。在这个过程中，我也解释了我是如何解决我在做这件事时所面临的一些问题的。希望这些信息对一些读者有用。</p><p id="1720" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kp">更多详细和深入的未来技术帖子请关注我这里或点击</em> <a class="ae ko" href="https://twitter.com/meraj_enigma" rel="noopener ugc nofollow" target="_blank"> <em class="kp"> twitter </em> </a> <em class="kp">。</em></p><h1 id="0efe" class="kq kr it bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">参考</h1><ol class=""><li id="b4e6" class="lt lu it js b jt lo jx lp kb nm kf nn kj no kn np lz ma mb bi translated">清晰的ORM—<a class="ae ko" href="https://clear.gitbook.io/project/" rel="noopener ugc nofollow" target="_blank">https://clear.gitbook.io/project/</a></li><li id="d080" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn np lz ma mb bi translated">琥珀色框架—<a class="ae ko" href="https://amberframework.org/" rel="noopener ugc nofollow" target="_blank">https://amberframework.org/</a></li><li id="85dd" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn np lz ma mb bi translated">花岗岩ORM—<a class="ae ko" href="https://github.com/amberframework/granite" rel="noopener ugc nofollow" target="_blank">https://github.com/amberframework/granite</a></li><li id="c3b9" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn np lz ma mb bi translated">本文最终App的源代码—<a class="ae ko" href="https://github.com/imeraj/amber_playground/tree/main/pet-trackeer-clear" rel="noopener ugc nofollow" target="_blank">https://github . com/imeraj/amber _ playground/tree/main/pet-track eer-clear</a></li><li id="c765" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn np lz ma mb bi translated">琥珀色快速入门指南—<a class="ae ko" href="https://docs.amberframework.org/amber/getting-started" rel="noopener ugc nofollow" target="_blank">https://docs.amberframework.org/amber/getting-started</a></li></ol></div></div>    
</body>
</html>