<html>
<head>
<title>Client-Supplied Custom Sorting Using GraphQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GraphQL的客户端提供的自定义排序</h1>
<blockquote>原文：<a href="https://itnext.io/client-supplied-custom-sorting-using-graphql-54e4b87f6011?source=collection_archive---------5-----------------------#2018-09-30">https://itnext.io/client-supplied-custom-sorting-using-graphql-54e4b87f6011?source=collection_archive---------5-----------------------#2018-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/7ca7da9cd3f554ba1c504fdea69f1b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TGql9PW4HktzZY__UC9oUg.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="b57d" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">本故事被移至:<a class="ae la" href="https://jonathancardoso.com/en/blog/client-supplied-custom-sorting-using-graphql/" rel="noopener ugc nofollow" target="_blank">https://jonathancardoso . com/en/blog/client-supplied-custom-sorting-using-graph QL/</a></p></blockquote><p id="4c78" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">根据客户端发送的参数，对从API返回的数据进行排序的需求并不少见。在REST中，我们可以只使用查询字符串，但是在GraphQL中如何做呢？</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><p id="d73b" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">大多数数据库允许同时对多个字段进行排序，并且排序顺序可以各不相同，一种将此转换为GraphQL的方法，也是我一直在使用的方法，是使用枚举和对象输入参数。</p><h2 id="0f6d" class="ll lm jb bd ln lo lp dn lq lr ls dp lt lb lu lv lw lc lx ly lz ld ma mb mc md bi translated">例子</h2><p id="c848" class="pw-post-body-paragraph kb kc jb ke b kf me kh ki kj mf kl km lb mg kp kq lc mh kt ku ld mi kx ky kz ij bi translated">假设我们有一个解析器<code class="fe mj mk ml mm b">getUsers: [User!]!</code>，它从MongoDB返回用户，我们按照<code class="fe mj mk ml mm b">name</code>和<code class="fe mj mk ml mm b">createdAt</code>对结果进行排序:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="927b" class="ll lm jb mm b gy mv mw l mx my">const users = await ctx.db.users.find().sort({<br/>  name: 1, // ascending<br/>  createdAt: -1 // descending<br/>});</span></pre><p id="0cd5" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">但是我们希望允许客户端指定将要排序的字段，以及它们各自的顺序。</p><p id="db84" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">首先，我们可以有一个<code class="fe mj mk ml mm b">Direction</code>枚举，它将有值<code class="fe mj mk ml mm b">ASC</code>和<code class="fe mj mk ml mm b">DESC</code>:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="a84e" class="ll lm jb mm b gy mv mw l mx my">enum DirectionEnum {<br/>  ASC<br/>  DESC<br/>}</span></pre><p id="7de4" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">使用<code class="fe mj mk ml mm b">graphql-js</code>,这可以定义如下:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="b13d" class="ll lm jb mm b gy mv mw l mx my">import { GraphQLEnumType } from 'graphql';</span><span id="4aa1" class="ll lm jb mm b gy mz mw l mx my">export const DirectionEnumType = new GraphQLEnumType({<br/>  name: 'DirectionEnum',<br/>  values: {<br/>    ASC: {<br/>      value: 1,<br/>    },<br/>    DESC: {<br/>      value: -1,<br/>    },<br/>  },<br/>});</span></pre><p id="e77c" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在让我们创建一个enum来表示允许在我们的<code class="fe mj mk ml mm b">User</code>上排序的字段:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="a5e3" class="ll lm jb mm b gy mv mw l mx my">enum UserSortFieldEnum {<br/>  NAME<br/>  CREATED_AT<br/>}</span></pre><p id="8e04" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在<code class="fe mj mk ml mm b">graphql-js</code>中:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="59e3" class="ll lm jb mm b gy mv mw l mx my">import { GraphQLEnumType } from 'graphql';</span><span id="d8f5" class="ll lm jb mm b gy mz mw l mx my">export const UserSortFieldEnumType = new GraphQLEnumType({<br/>  name: 'UserSortFieldEnum',<br/>  values: {<br/>    NAME: {<br/>      value: 'name',<br/>    },<br/>    CREATED_AT: {<br/>      value: 'createdAt',<br/>    },<br/>  },<br/>});</span></pre><p id="9c18" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，为了将这两者连接在一起，我们将制作一个名为<code class="fe mj mk ml mm b">UserSort</code>的<a class="ae la" href="https://graphql.org/graphql-js/mutations-and-input-types/" rel="noopener ugc nofollow" target="_blank">输入类型</a>:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="bdc5" class="ll lm jb mm b gy mv mw l mx my">input UserSort {<br/>  field: UserSortFieldEnum!<br/>  direction: DirectionEnum!<br/>}</span></pre><p id="36e8" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><code class="fe mj mk ml mm b">graphql-js</code>:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="71c6" class="ll lm jb mm b gy mv mw l mx my">import { GraphQLInputObjectType, GraphQLNonNull } from 'graphql';<br/><br/>import { DirectionEnumType } from './DirectionEnum';<br/>import { UserSortFieldEnumType } from './UserSortFieldEnum';</span><span id="d2b2" class="ll lm jb mm b gy mz mw l mx my">const UserSortInputType = new GraphQLInputObjectType({<br/>  name: 'UserSort',<br/>  fields: () =&gt; ({<br/>    field: {<br/>      type: GraphQLNonNull(UserSortFieldEnumType),<br/>    },<br/>    direction: {<br/>      type: GraphQLNonNull(DirectionEnumType),<br/>    },<br/>  }),<br/>});</span></pre><p id="2d15" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">那么我们的<code class="fe mj mk ml mm b">getUsers</code>解析器将变成:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="6a0b" class="ll lm jb mm b gy mv mw l mx my">getUsers(sort: [UserSort!]): [User!]!</span></pre><p id="5987" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，客户端可以查询它并指定他们需要的任何排序顺序:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="91df" class="ll lm jb mm b gy mv mw l mx my">query GetUsers {<br/>  getUsers(sort: [<br/>    {<br/>      field: NAME,<br/>      direction: DESC,<br/>    },<br/>    {<br/>      field: CREATED_AT,<br/>      direction: ASC,<br/>    }<br/>  ]) {<br/>    # ...<br/>  }<br/>}</span></pre><p id="0efe" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果您正在使用MongoDB，并且打算开始使用它，<code class="fe mj mk ml mm b">@entria/graphql-mongo-helpers</code>有一个非常简单的助手可以将客户端提供的<code class="fe mj mk ml mm b">sort</code>参数转换成可以在MongoDB <code class="fe mj mk ml mm b">sort()</code>方法上使用的参数。</p><div class="ip iq gp gr ir na"><a href="https://github.com/entria/graphql-mongo-helpers" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd jc gy z fp nf fr fs ng fu fw ja bi translated">entria/graphql-mongo-helpers</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">graphql-mongo-helpers。在GitHub上创建一个帐户，为entria/graphql-mongo-helpers的开发做出贡献。</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">github.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ix na"/></div></div></a></div><p id="39ae" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">它被称为<code class="fe mj mk ml mm b">buildSortArg</code>，在我们的<code class="fe mj mk ml mm b">getUser</code>解析器上使用它会是这样的:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="40f3" class="ll lm jb mm b gy mv mw l mx my">// ...<br/>import { buildSortFromArg } from '@entria/graphql-mongo-helpers';</span><span id="13ad" class="ll lm jb mm b gy mz mw l mx my"><br/>// ... inside getUser resolver:<br/>const users = await ctx.db.users.find().sort(buildSortFromArg(args.sort));</span></pre><p id="541a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">该库还分别为方向枚举、<code class="fe mj mk ml mm b">DirectionEnum</code>和<code class="fe mj mk ml mm b">DirectionEnumType</code>导出了SDL定义和GraphQLObject。</p></div><div class="ab cl le lf hu lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ij ik il im in"><p id="84e1" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">让我知道你对这个想法的想法！我的推特:<a class="ae la" href="https://twitter.com/_jonathancardos" rel="noopener ugc nofollow" target="_blank"> @_jonathancardos </a></p></div></div>    
</body>
</html>