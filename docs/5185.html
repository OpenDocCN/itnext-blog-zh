<html>
<head>
<title>[Bug fix, n/a] Fix year in Copyright snapshot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[错误修复，不适用]修复版权快照中的年份</h1>
<blockquote>原文：<a href="https://itnext.io/bug-fix-n-a-fix-year-in-copyright-snapshot-571b7d75dd95?source=collection_archive---------6-----------------------#2021-01-04">https://itnext.io/bug-fix-n-a-fix-year-in-copyright-snapshot-571b7d75dd95?source=collection_archive---------6-----------------------#2021-01-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><figure class="it iu gq gs iv iw gi gj paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="gi gj is"><img src="../Images/3c8281f65de1da115835adfe7d873519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxzikKJ97ti-L0K4tcrTSA.jpeg"/></div></div><figcaption class="jd je gk gi gj jf jg bd b be z dk translated">这种编程错误可以在任何地方出现，所以你最好小心点——照片摄于南澳大利亚的Memory Cove。</figcaption></figure><div class=""/><div class=""><h2 id="4d9a" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">这是我今年的第一次公关，也是我们所有人的一个教训。</h2></div><p id="dcde" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">我运行了<code class="fe lu lv lw lx b">git pull upstream develop</code>，看到没有人对<code class="fe lu lv lw lx b">xMas</code>做任何改动，我悄悄松了一口气。我跑<code class="fe lu lv lw lx b">git push</code>只是为了确保我的叉子是同步的。在运行<code class="fe lu lv lw lx b">git push</code>时，<code class="fe lu lv lw lx b">package.json</code>文件有一个预处理器步骤，在推送之前链接和测试所有东西。</p><p id="aa79" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">该死的测试失败了。</p><p id="9726" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated"><em class="ly">为什么</em>测试失败了？</p><p id="e254" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">因为现在是2021年，而<code class="fe lu lv lw lx b">Copyright</code>组件的快照仍然显示2020年，诅咒它的名字。</p><p id="d7d6" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">组件:</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="d9d8" class="mh mi jj lx b gz mj mk l ml mm">const Copyright = ({ holder }) =&gt; (<br/>  &lt;Typography&gt;<br/>    {'Copyright © ' + holder}<br/>    {new Date().getFullYear()}.<br/>  &lt;/Typography&gt;<br/>)</span><span id="8003" class="mh mi jj lx b gz mn mk l ml mm">Copyright.propTypes = {<br/>  holder: string.isRequired<br/>}</span></pre><p id="6484" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">用<code class="fe lu lv lw lx b">Jest</code>测试。</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="1474" class="mh mi jj lx b gz mj mk l ml mm">describe('components &gt; Copyright', () =&gt; {<br/>  const holder = 'test'<br/>  let component</span><span id="cd55" class="mh mi jj lx b gz mn mk l ml mm">  beforeAll(() =&gt; {<br/>    component = render(&lt;Copyright holder={holder} /&gt;)<br/>  })</span><span id="3790" class="mh mi jj lx b gz mn mk l ml mm">  it('rendered without crashing', () =&gt; {<br/>    expect(component.asFragment()).toMatchSnapshot()<br/>  })<br/>})</span></pre><p id="8acf" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">这很容易确定。</p><p id="a293" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">第一个，也是最懒惰的，也是最正确的解决方案就是运行:</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="33be" class="mh mi jj lx b gz mj mk l ml mm">npm test -- -u</span></pre><p id="4da3" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">并重新生成快照，但这样做的后果是在一年后将问题变成别人的问题。</p><p id="49ae" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">我们不是那样的人，对吧？</p><p id="653f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">让我们重写<code class="fe lu lv lw lx b">Copyright</code>组件，使其接受一个可选的日期字符串属性<code class="fe lu lv lw lx b">today</code>。</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="355a" class="mh mi jj lx b gz mj mk l ml mm">const Copyright = ({ holder, today }) =&gt; (<br/>  &lt;Typography&gt;<br/>    {'Copyright © ' + holder}<br/>    {new Date(today).getFullYear()}.<br/>  &lt;/Typography&gt;<br/>)</span><span id="8602" class="mh mi jj lx b gz mn mk l ml mm">Copyright.propTypes = {<br/>  holder: string.isRequired,<br/>  today: string // zulu-time string only used in testing.<br/>}</span><span id="069e" class="mh mi jj lx b gz mn mk l ml mm">Copyright.defaultProps = {<br/>  today: undefined<br/>}</span></pre><p id="854c" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">并更新测试</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="c7e7" class="mh mi jj lx b gz mj mk l ml mm">describe('components &gt; Copyright', () =&gt; {<br/>  const holder = 'test'<br/>  const today = '2021-01-03T22:12:18.217Z'<br/>  let component</span><span id="f6ae" class="mh mi jj lx b gz mn mk l ml mm">  beforeAll(() =&gt; {<br/>    component = render(&lt;Copyright <em class="ly">holder</em>={holder} <em class="ly">today</em>={today} /&gt;)<br/>  })</span><span id="ce1d" class="mh mi jj lx b gz mn mk l ml mm">  it('rendered without crashing', () =&gt; {<br/>    expect(component.asFragment()).toMatchSnapshot()<br/>  })<br/>})</span></pre><p id="4e08" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">如今，现在</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="be08" class="mh mi jj lx b gz mj mk l ml mm">npm test -- -u</span></pre><p id="a585" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">强制更新快照。</p><p id="82b5" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">如果没有可选的<code class="fe lu lv lw lx b">today</code>字段，组件的行为将完全相同，因为如果<code class="fe lu lv lw lx b">new Date</code>将<code class="fe lu lv lw lx b">undefined</code>作为参数接收，它的行为将是正确的。</p><p id="f6ee" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">在<code class="fe lu lv lw lx b">Copyright</code>组件中的日期每年只改变一次，所以直到我今天开始工作之前没有人注意到。</p><pre class="lz ma mb mc gu md lx me mf aw mg bi"><span id="6da7" class="mh mi jj lx b gz mj mk l ml mm">git commit -am "n/a added optional today to Copyright"<br/>git flow feature publish fix-copyright-date</span></pre><p id="cb41" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">今年的第一次公关，这是一个美丽的晴天。</p><p id="1f1d" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">每当有处理日期的组件时就使用这种技术，否则，您可能会在时钟的每一秒都生成新的快照。</p><p id="b589" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">大家新年快乐。</p><p id="bb4f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi">—</p><p id="f5f2" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt in bi translated">像这样但不是订户？你可以通过<a class="ae mo" href="https://davesag.medium.com/membership" rel="noopener">davesag.medium.com</a>加入来支持作者。</p></div></div>    
</body>
</html>