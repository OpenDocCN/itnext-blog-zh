<html>
<head>
<title>Prometheus For Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初学者的普罗米修斯</h1>
<blockquote>原文：<a href="https://itnext.io/prometheus-for-beginners-5f20c2e89b6c?source=collection_archive---------0-----------------------#2019-12-31">https://itnext.io/prometheus-for-beginners-5f20c2e89b6c?source=collection_archive---------0-----------------------#2019-12-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/84474240efd2c9d1d612eaba1069535d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*WSlnvCJelr8hsJi4u3tJKA.jpeg"/></div></figure><div class=""/><p id="fc63" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">几个月前，我和Kubernetes开始了我的发现之旅；非常强大的DevOps平台/技术。当我开始深入研究Kubernetes如何工作以及如何最好地利用它时，我开始看到“普罗米修斯”这个词在博客上频繁出现。这个“普罗米修斯”是什么？为什么对它大肆宣传？</p><p id="7d47" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这篇博文中，我想给你一个完整的初学者指南，告诉你什么是普罗米修斯，它能做什么，以及如何使用它。在这篇博文中，我不会深究“如何安装普罗米修斯”。相反，我将解释这个平台是如何工作的，你如何使用它，以及它能给你和你的团队带来的好处。</p><p id="af52" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你很匆忙(让我们面对现实吧，这些天谁不是这样)，那么请滚动到这个博客的底部，阅读我的“TL；DR；总结”。它以一种简单易懂的格式包含了我在这里介绍的所有内容，只需要花一分钟的时间来阅读。</p></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="ed9b" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">普罗米修斯是什么？</h1><p id="d0e1" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">好的，所以在希腊神话中，普罗米修斯是一个不死的泰坦，他违抗诸神的意志，窃取火种并赐予人类；从而创造了文明。</p><blockquote class="mf mg mh"><p id="a6e0" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated"><strong class="jz jb"> <em class="ja">“好吧，酷故事老弟，这跟软件有什么关系？”</em>T3】</strong></p></blockquote><p id="40fc" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">嗯…很像希腊神话中的普罗米修斯(这篇博文的主题)是一个开源的监控系统；旨在让我们了解我们的应用程序和系统是如何运行的。</p><p id="1a7b" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">普罗米修斯最初是由<a class="ae mm" href="https://en.wikipedia.org/wiki/SoundCloud" rel="noopener ugc nofollow" target="_blank"> SoundCloud </a>在2012年创建的，当时他们认为当前的监控平台不足以满足他们的用例。然而，直到2016年，普罗米修斯v1的第一版才面向全球发布。</p><p id="cabf" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如今，普罗米修斯被认为是云本地计算基金会的成员项目。</p><blockquote class="mf mg mh"><p id="8d8b" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated"><strong class="jz jb"> <em class="ja">“太好了，我现在知道希腊神话和普罗米修斯是怎么开始的；但这是什么？”</em>T11】</strong></p></blockquote><p id="c8f9" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz jb"> Prometheus本质上只是另一个指标收集和分析工具，</strong>其核心由3个组件组成:</p><ul class=""><li id="cca4" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated">一个<a class="ae mm" href="https://en.wikipedia.org/wiki/Time_series" rel="noopener ugc nofollow" target="_blank"> <strong class="jz jb">时间序列数据库</strong> </a>，它将存储我们所有的度量数据</li><li id="0c0d" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">一个<strong class="jz jb">数据检索工作器</strong>，负责<strong class="jz jb">从外部来源提取/抓取</strong>指标并<strong class="jz jb">将它们</strong>推入数据库</li><li id="7ef2" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">一个网络服务器，提供一个简单的网络接口<strong class="jz jb">用于配置和查询存储的数据。</strong></li></ul><p id="029d" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你和我一样喜欢可视化系统架构，这里有一个图表来帮助解释普罗米修斯架构:</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nb"><img src="../Images/8b12d487a0c76deb2633f6e25e55126a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tDBv1AtwcZZAHzAp.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">普罗米修斯的建筑及其组成部分(<a class="ae mm" href="https://prometheus.io/docs/introduction/overview/" rel="noopener ugc nofollow" target="_blank">https://prometheus.io/docs/introduction/overview/</a>)</figcaption></figure><h2 id="0fb6" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated">上图中的几点注意事项</h2><ul class=""><li id="47d2" class="mn mo ja jz b ka ma ke mb ki oa km ob kq oc ku ms mt mu mv bi translated"><strong class="jz jb"> PromQL </strong> —用于从Prometheus检索指标的查询语言。我计划将来写一篇详细的博客，向您展示如何使用Grafana的度量数据来构建一些强大的仪表板。</li><li id="8f2b" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><strong class="jz jb">警报管理器</strong>—允许我们根据Prometheus采样的指标定义警报(例如内存/cpu使用率过高或请求持续时间出现峰值)</li><li id="fd1d" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><strong class="jz jb"> Pushgateway </strong> —为应用和服务提供一种将指标推入Prometheus的机制，而不是标准的拉取机制。</li><li id="0b63" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><strong class="jz jb">服务发现</strong> —Prometheus在首次设置时只需要很少的配置，并且从头开始设计为在Kubernetes等动态环境中运行。因此，它会自动发现正在运行的服务，并尝试对它应该监视的内容做出“最佳猜测”。</li></ul></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="e768" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">是什么让普罗米修斯如此与众不同？</h1><p id="c585" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">在我们继续之前，我想在这里暂停一下，并指出我认为Prometheus与您可能已经熟悉的其他监控解决方案之间的一个关键区别:</p><ul class=""><li id="c27a" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated">大多数监控系统(Amazon CloudWatch、ApplicationInsights、NewRelic等。)使用“推动”机制—应用程序/服务器等。(<em class="mi">客户端</em>)负责将其指标数据推送到集中收集平台(<em class="mi">服务器</em>)。</li><li id="87ac" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">普罗米修斯颠倒了这个模型；取而代之的是依赖于提供简单HTTP端点的应用程序/服务器(目标),其数据检索人员可以从中提取/抓取数据。</li></ul><h1 id="5a6f" class="lc ld ja bd le lf od lh li lj oe ll lm ln of lp lq lr og lt lu lv oh lx ly lz bi translated">但我为什么要在乎呢？</h1><p id="a847" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">简而言之，这种新模式为我们提供了众多优势:</p><ol class=""><li id="e50e" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku oi mt mu mv bi translated">Prometheus不要求我们在物理服务器上安装任何定制软件或配置，甚至不要求我们在容器映像中安装任何定制软件或配置来收集指标。</li><li id="bc69" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku oi mt mu mv bi translated">Prometheus不要求我们的应用程序使用CPU周期将指标推送到某个集中的收集器。</li><li id="9549" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku oi mt mu mv bi translated">Prometheus为我们提供了集中的配置和管理控制台，使我们能够看到数据是何时从每个单独的目标上收集的。</li><li id="58d6" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku oi mt mu mv bi translated">Prometheus优雅地处理服务故障/不可用。如果目标应用程序宕机，Prometheus可以记录它无法检索数据。与“推”机制系统相反，我们经常不确定为什么我们没有接收到数据。数据在传输过程中丢失了吗？我们的服务死了吗？谁知道呢。</li><li id="2526" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku oi mt mu mv bi translated">普罗米修斯利用了一个时间序列数据库，这意味着我们不必有成千上万的个人指标记录；取而代之的是<strong class="jz jb">我们定期拍摄指标的快照，然后测量这些快照之间有多少变化</strong>。这减少了我们度量平台上的网络流量和开销。</li><li id="64d8" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku oi mt mu mv bi translated">对于“拉取”指标不可行的情况(例如:寿命短的作业不会长到被废弃)，Prometheus提供了一个Pushgateway，允许应用程序在需要时仍可以推送指标数据。本质上给了我们两个世界最好的东西😃</li></ol><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/85da3070a876afccd654f135c5d8067b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*hUpWYlxHYvf__WLpQAn3xQ.gif"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">哦，是的…真的有那么好</figcaption></figure></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="ad12" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">普罗米修斯度量标准是什么样的？</h1><p id="132f" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">Prometheus为其指标定义了一个非常好的基于文本的格式:</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi ok"><img src="../Images/ebfd2fbcc25cf0ad1774fd2018deeaab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rav_GN4gotUn_CCECJszqw.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">普罗米修斯公制格式示例</figcaption></figure><p id="2caa" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从上面的例子中可以看出，数据相对来说是人类可读的，我们甚至有<code class="fe ol om on oo b">TYPE</code>和<code class="fe ol om on oo b">HELP</code>装饰器来增加可读性。</p><p id="c8e5" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该示例显示了3个不同的度量标准(<code class="fe ol om on oo b">http_server_requests_total</code>、<code class="fe ol om on oo b">http_server_request_duration_seconds</code>和<code class="fe ol om on oo b">http_server_exceptions_total</code>)，每个都有自己的类型，负责监控应用程序的特定方面。</p><h2 id="54d9" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated">关于该示例，需要注意一些事项:</h2><ul class=""><li id="c60e" class="mn mo ja jz b ka ma ke mb ki oa km ob kq oc ku ms mt mu mv bi translated">为了简单起见，普罗米修斯的度量类型非常有限。事实上，目前只提供了3种类型；这些是<code class="fe ol om on oo b"><strong class="jz jb">counter</strong></code>、<code class="fe ol om on oo b"><strong class="jz jb">gauge</strong></code>和<code class="fe ol om on oo b"><strong class="jz jb">histogram</strong></code>、<strong class="jz jb">、</strong>(稍后将详细介绍这些类型)</li><li id="39dd" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><code class="fe ol om on oo b">TYPE</code>和<code class="fe ol om on oo b">HELP</code>属性帮助我们为输出中的每个指标提供用户友好的提示。</li><li id="aa23" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">Prometheus在度量类型中有“<strong class="jz jb">标签</strong>”的概念(将这些视为可以应用于度量以帮助我们的额外维度)。</li><li id="863f" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">标签使用<code class="fe ol om on oo b">{}</code>语法显示，可以在<code class="fe ol om on oo b"><strong class="jz jb">http_server_requests_total</strong></code>指标上看到。</li><li id="8f91" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">普罗米修斯<a class="ae mm" href="https://prometheus.io/docs/practices/naming/#metric-names" rel="noopener ugc nofollow" target="_blank">规定了度量</a>和<a class="ae mm" href="https://prometheus.io/docs/practices/naming/#base-units" rel="noopener ugc nofollow" target="_blank">的命名约定，以及每种类型使用的具体测量单位</a>。</li></ul><h1 id="a2ed" class="lc ld ja bd le lf od lh li lj oe ll lm ln of lp lq lr og lt lu lv oh lx ly lz bi translated"><strong class="ak">普罗米修斯公制类型</strong></h1><p id="2c96" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">在撰写本文时，Prometheus目前只支持三种类型的度量。这些是:</p><ul class=""><li id="7ad2" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated"><strong class="jz jb">计数器</strong> —简单的<a class="ae mm" href="https://en.wikipedia.org/wiki/Monotonic_function" rel="noopener ugc nofollow" target="_blank">单调递增</a>型；基本上在你想知道“x发生了多少次”的情况下使用这个。</li><li id="2c6a" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><strong class="jz jb">标尺</strong> —一种既可以上升也可以下降的度量表示。想想汽车里的速度计，这种类型提供了“x现在的当前值是多少”的快照。</li><li id="0f89" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><strong class="jz jb">直方图</strong> —好的，这是一个复杂的直方图，它代表了划分到不同桶中的观察到的指标。可以把这看作是一种跟踪“事情花了多长时间”或“事情有多大”的机制。</li></ul><h2 id="5b53" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated">关于直方图的一个非常重要的注释</h2><p id="d8d2" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">好吧，这确实花了我一段时间才弄明白，基本上直方图度量桶是累积的。为了更好地解释这一点，我将分解上例中显示的直方图指标:</p><ul class=""><li id="9220" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated">直方图类型不仅提供分片<code class="fe ol om on oo b">_bucket</code>度量，还提供<code class="fe ol om on oo b">_sum</code>和<code class="fe ol om on oo b">_count</code>度量。</li><li id="a988" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">在我们的例子中，我们的应用程序只有1个请求(因为<code class="fe ol om on oo b">_count</code>显示1)</li><li id="ef1f" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">在我们的例子中，1请求花了0.251396秒完成(因为<code class="fe ol om on oo b">_sum</code>值告诉我们所有请求的总时间)</li><li id="cf2f" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">请求已经分成6个时间段(因为记得我说过时间段是累积的)。类型上的每个桶代表一个“小于或等于”的时间片，用标签<code class="fe ol om on oo b">{le="&lt;time in seconds&gt;"}</code>表示。</li></ul><blockquote class="mf mg mh"><p id="9438" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">该请求花费了0.251396秒，因此被计入值大于0.251396的所有存储桶中。但是如果在我们的请求中花费了0.004秒= &gt;小于0.005秒(可用的最小存储桶)，那么每个时间存储桶将显示计数1。</p></blockquote><ul class=""><li id="f066" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated">有一个特殊的桶<code class="fe ol om on oo b">{le="+Inf"}</code>,它是一个<em class="mi"> catch all </em>,用于比定义的最大桶花费更多时间的请求(在我们的例子中是10秒)</li></ul></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="0cf7" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">用公制标签简化事物</h1><p id="e9e1" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">如前所述，Prometheus metrics支持标签概念，为您的数据提供额外的维度。通过有效地使用标签，我们可以从本质上提供对数据的更多洞察，同时管理更少的实际指标。</p><h2 id="d585" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated"><strong class="ak">示例场景:</strong></h2><blockquote class="mf mg mh"><p id="f426" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们希望跟踪应用程序中发生的异常数量。</p></blockquote><h2 id="41be" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated">我们该如何解决这个问题？</h2><blockquote class="mf mg mh"><p id="115a" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们可以在代码的每个区域设置一个计数器度量值(<code class="fe ol om on oo b">area_x_error_count</code>)，并在错误发生时递增。这很好，但是有以下缺点:</p><p id="62bd" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">每当我们向代码中添加一个新的区域时，我们必须记住创建一个新的度量标准。</p><p id="65b5" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们的指标端点因不同的指标名称而变得非常臃肿。</p><p id="4fab" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">当我们开始查询数据时，编写多个查询来将所有这些错误关联在一起会变得非常笨拙。</p></blockquote><h2 id="4086" class="no ld ja bd le np nq dn li nr ns dp lm ki nt nu lq km nv nw lu kq nx ny ly nz bi translated"><strong class="ak">使用标签的替代解决方案</strong></h2><blockquote class="mf mg mh"><p id="3733" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们为整个应用程序定义了一个度量标准，并应用标签来表示代码的面积<code class="fe ol om on oo b">application_error_count{area="x"}</code></p><p id="5576" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">现在我们不需要在每次添加代码时都记得创建一个新的度量标准</p><p id="2246" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们的指标端点将显示更少的不同指标，数据将仅在应用标签时作为一个分片。</p><p id="11ff" class="jx jy mi jz b ka kb kc kd ke kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ku im bi translated">我们的衡量标准被合并为一个关键值；这允许我们使用强大的PromQL语言创建复杂的图形来表示我们的应用程序是如何运行的。</p></blockquote></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="52be" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">好了，我的数据被删除了…现在怎么办？</h1><p id="7ca6" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">一旦你的度量数据进入普罗米修斯，世界就是你的了。Prometheus提供了自己的用户界面，允许您查询、查看和绘制数据:</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi op"><img src="../Images/720c0eb3820b9e1b8b8912bbb9a1ad16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNEdWSkZU0zsNHh2-AGr4A.png"/></div></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">普罗米修斯网络界面——在其所有的荣耀中</figcaption></figure><p id="d56b" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Prometheus使用自己的查询语言PromQL。一种非常强大的语言，它利用直方图等度量类型的力量，为我们提供了一些非常有趣的报告功能。</p><p id="fbb3" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我不打算在这里深入讨论如何编写查询(因为这是一个初学者的博客)，但如果你有兴趣了解更多，那么<a class="ae mm" href="https://prometheus.io/docs/prometheus/latest/querying/basics/" rel="noopener ugc nofollow" target="_blank">Prometheus网站确实有一些非常有用的笔记，关于如何开始使用PromQL的基础</a>。</p><p id="f9bf" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然而，Prometheus的真正强大之处在于能够将其连接到Grafana等强大的仪表板工具和PagerDuty等警报系统，为您提供完整的DevOps监控解决方案。</p><p id="9569" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我将来还会写一篇博文，关于将Prometheus连接到Grafana以构建公制仪表板，在那里我会深入了解PromQL的更多细节以及如何充分利用您的数据。</p><h1 id="c07a" class="lc ld ja bd le lf od lh li lj oe ll lm ln of lp lq lr og lt lu lv oh lx ly lz bi translated">TL；DR；摘要</h1><p id="06d5" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">所以，是的，如果你很忙，不想花时间阅读我的整篇文章，那么这里有一些非常简单的建议:</p><ul class=""><li id="3d0e" class="mn mo ja jz b ka kb ke kf ki mp km mq kq mr ku ms mt mu mv bi translated">Prometheus是收集和查询度量数据的一个非常强大的工具。</li><li id="75fb" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">Prometheus通过应用程序/服务上的http端点定期从我们的应用程序中提取/抓取指标。</li><li id="b856" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">每次Prometheus抓取指标时，它都会在Prometheus数据库中记录指标数据的快照。</li><li id="4162" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">使用PromQL查询和Prometheus web UI或Grafana等其他工具，我们可以查询/分析指标数据快照之间的差异，以模拟/表示数据如何随时间变化。</li><li id="7533" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">使用较少的不同指标名称，但是通过使用标签来确定指标的维度(相信我，您会感谢我的这个技巧)。</li><li id="e6bd" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">您只能使用3种度量类型(计数器、仪表和直方图)；因此，请为工作使用正确的度量类型。</li><li id="131a" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">计数器只是递增，并计算某件事发生了多少次。</li><li id="58af" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">仪表用于跟踪可能上下波动的值，就像汽车上的速度计一样。</li><li id="2a50" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">直方图用于将指标数据分成观察到的桶。</li><li id="6cde" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">直方图是累积的，是最难阅读的度量类型。</li><li id="c76d" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">在命名您的指标时，确保您<a class="ae mm" href="https://prometheus.io/docs/practices/naming/" rel="noopener ugc nofollow" target="_blank">遵循普罗米修斯指南。</a></li><li id="7cb2" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">确保你<a class="ae mm" href="https://prometheus.io/docs/practices/naming/#base-units" rel="noopener ugc nofollow" target="_blank">遵循普罗米修斯指导方针，使用正确的度量单位</a>(例如测量时间时总是使用秒)</li></ul></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="ecf4" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结束语</h1><p id="2bd7" class="pw-post-body-paragraph jx jy ja jz b ka ma kc kd ke mb kg kh ki mc kk kl km md ko kp kq me ks kt ku im bi translated">普罗米修斯是一个令人惊讶的强大的监控系统，从头开始设计，以支持和工作的动态环境；就像库伯内特公司制造的那样。但是，尽管Prometheus“核心平台”本质上运行在Kubernetes上，但非常重要的是要认识到，任何应用程序/基础设施都可以通过暴露一个web端点来监控，该端点以Prometheus兼容的文本格式提供指标数据。</p><p id="8749" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如今，太多的团队认为监控和性能是事后的想法。老实说，我已经数不清自己加入了多少个团队，并问自己“这东西表现如何？”或者“我们应用的平均响应时间是多少？”结果却是一脸茫然，耸耸肩，表示“我们完全不知道”。</p><p id="bde1" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在再也没有任何借口了。说“哦，我们无法访问日志”或“我们没有时间设置监控”的日子已经一去不复返了，因为如果您的团队正在使用Kubernetes(老实说，如果您没有，您可能正在拼命尝试迁移到它)，那么Prometheus会为您做很多繁重的工作。</p><figure class="nc nd ne nf gt iv gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/ad21f9fbe35e6c69f146a18c3570aeeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*ri0YGi09CV9Ig2wCDfPvaQ.gif"/></div><figcaption class="nk nl gj gh gi nm nn bd b be z dk translated">一个完整的度量世界正等着你去探索</figcaption></figure></div><div class="ab cl kv kw hx kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="im in io ip iq"><h1 id="7ee0" class="lc ld ja bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">进一步阅读</h1><ul class=""><li id="aaab" class="mn mo ja jz b ka ma ke mb ki oa km ob kq oc ku ms mt mu mv bi translated"><a class="ae mm" href="https://prometheus.io/docs/introduction/first_steps/" rel="noopener ugc nofollow" target="_blank">普罗米修斯第一步</a>——从搭建平台的人开始；没有比这更好的开始了</li><li id="e4bb" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated">健壮感知博客——学习普罗米修斯和PromQL技巧和窍门的好地方</li><li id="e83c" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><a class="ae mm" href="https://github.com/roaldnefs/awesome-prometheus" rel="noopener ugc nofollow" target="_blank">Roald Nefs Awesome-Prometheus Github Repo</a>——Prometheus的圣杯资源链接(帮你自己一个忙，将此页设为书签)</li><li id="1997" class="mn mo ja jz b ka mw ke mx ki my km mz kq na ku ms mt mu mv bi translated"><a class="ae mm" href="https://www.youtube.com/watch?v=QgJbxCWRZ1s&amp;feature=youtu.be" rel="noopener ugc nofollow" target="_blank">普罗米修斯:设计和哲学</a>——为什么它是这样的——一个非常有见地的视频，它为什么由建造它的人建造。</li></ul></div></div>    
</body>
</html>