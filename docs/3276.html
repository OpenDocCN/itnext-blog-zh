<html>
<head>
<title>Entity Framework Core: No database provider has been configured for this DbContext</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实体框架核心:没有为此DbContext配置数据库提供程序</h1>
<blockquote>原文：<a href="https://itnext.io/entity-framework-core-no-database-provider-has-been-configured-for-this-dbcontext-a02d9b192877?source=collection_archive---------2-----------------------#2019-11-11">https://itnext.io/entity-framework-core-no-database-provider-has-been-configured-for-this-dbcontext-a02d9b192877?source=collection_archive---------2-----------------------#2019-11-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="77f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在编写<a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET核心3:向现有项目添加实体框架核心</a>时，我正准备添加我的初始实体框架核心迁移，这时我收到了一个巨大的错误消息，最后一位是红色的。</p><blockquote class="km kn ko"><p id="39ed" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">没有为此DbContext配置数据库提供程序。可以通过重写DbContext来配置提供程序。OnConfiguring方法或通过在应用程序服务提供者上使用AddDbContext。如果使用了AddDbContext，那么还要确保DbContext类型在其构造函数中接受一个DbContextOptions <tcontext>对象，并将其传递给DbContext的基本构造函数。</tcontext></p></blockquote><h2 id="fc1c" class="kt ku iq bd kv kw kx dn ky kz la dp lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">项目状态</h2><p id="ed8e" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk ij bi translated">我从事的项目是一个API，它有一个如下定义的单一模型。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="f3fc" class="kt ku iq lw b gy ma mb l mc md">public class Contact<br/>{<br/>    public int Id { get; set; }<br/>    public string Name { get; set; }<br/>    public string Address { get; set; }<br/>    public string City { get; set; }<br/>    public string State { get; set; }<br/>    public string PostalCode { get; set; }<br/>    public string Phone { get; set; }<br/>    public string Email { get; set; }<br/>}</span></pre><p id="78d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">DbContext看起来像这样。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="7151" class="kt ku iq lw b gy ma mb l mc md">public class ContactsDbContext : DbContext<br/>{<br/>    public DbSet&lt;Contact&gt; Contacts { get; set; }<br/>}</span></pre><p id="9a06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后<strong class="jp ir">配置服务</strong>功能<strong class="jp ir">启动</strong>。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="828e" class="kt ku iq lw b gy ma mb l mc md">public void ConfigureServices(IServiceCollection services)<br/>{<br/>    services.AddDbContext&lt;ContactsDbContext&gt;(options =&gt;<br/>        options.UseSqlite(Configuration.GetConnectionString("DefaultConnection")));<br/>    services.AddControllers();<br/>}</span></pre><h2 id="3a06" class="kt ku iq bd kv kw kx dn ky kz la dp lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">错误</h2><p id="91b8" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk ij bi translated">此时，我在命令提示符下运行以下命令来添加迁移。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="373f" class="kt ku iq lw b gy ma mb l mc md">dotnet ef migrations add Initial</span></pre><p id="89f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将导致以下错误。</p><figure class="lr ls lt lu gt mf gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi me"><img src="../Images/adfcc835aa76dcdf44a9f53fd049892f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V007rtCdO0yjTkqD.png"/></div></div></figure><h2 id="038d" class="kt ku iq bd kv kw kx dn ky kz la dp lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">保持冷静，阅读和修复</h2><p id="5ddc" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk ij bi translated">不要和我犯同样的错误，反复检查你申请中的所有内容。异常消息的黄色和红色部分告诉您应该如何修复。</p><p id="31b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于这个应用程序，我想在<strong class="jp ir">启动时使用连接字符串设置。配置服务</strong>。要做到这一点，如错误所述，如果您费心去读它，DbContext需要添加一个构造函数，它接受一个<strong class="jp ir"> DbContextOptions </strong>并将该值传递给基类的构造函数，如下所示。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="e85e" class="kt ku iq lw b gy ma mb l mc md">public ContactsDbContext(DbContextOptions&lt;ContactsDbContext&gt; options) : base(options)<br/>{ }</span></pre><p id="a94e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者，如果您在您的应用程序中不希望从配置中获取数据库信息，您可以在您的DbContext中覆盖<strong class="jp ir">on configuration</strong>，并在那里设置您的连接字符串，如下所示。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="8ed5" class="kt ku iq lw b gy ma mb l mc md">protected override void OnConfiguring(DbContextOptionsBuilder options)<br/>    =&gt; options.UseSqlite("DataSource=app.db");</span></pre><p id="b655" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不推荐第二种选择，但既然它是有效的，我觉得它需要被包括在内。</p><h2 id="0690" class="kt ku iq bd kv kw kx dn ky kz la dp lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">包扎</h2><p id="f8c4" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk ij bi translated">对我来说，这是一个很好的提醒，让我放慢速度，真正地去阅读错误，即使它们是一堵文字墙。希望我写这篇文章能帮助我记住这一课。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="5baa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp">最初发表于</em> <a class="ae kl" href="https://elanderson.net/2019/11/entity-framework-core-no-database-provider-has-been-configured-for-this-dbcontext/" rel="noopener ugc nofollow" target="_blank"> <em class="kp">埃里克·安德森</em> </a> <em class="kp">。</em></p></div></div>    
</body>
</html>