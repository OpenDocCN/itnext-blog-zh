<html>
<head>
<title>Angular. How to Introduce Progress Bars in Your Application Using NgRx.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">棱角分明。如何使用NgRx在应用程序中引入进度条？</h1>
<blockquote>原文：<a href="https://itnext.io/angular-how-to-introduce-progress-bars-in-your-application-using-ngrx-abc9bf080c70?source=collection_archive---------0-----------------------#2019-06-08">https://itnext.io/angular-how-to-introduce-progress-bars-in-your-application-using-ngrx-abc9bf080c70?source=collection_archive---------0-----------------------#2019-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/5d5afe6f217cdc67d463c61302675dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*8qWPluCj4yZ46iLNNwJ01A.png"/></div><figcaption class="iy iz gj gh gi ja jb bd b be z dk translated">使用NgRx的进度条</figcaption></figure><figure class="jd je jf jg gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="jh ji di jj bf jk"><div class="gh gi jc"><img src="../Images/79396ad9c6c69722b4a196e304637d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iF0_P6sKHurVr18Vq6tjuA.png"/></div></div></figure><div class=""/><p id="3adc" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">用进度条或旋转器演示等待过程</p><p id="edb4" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">几天前，我需要在我的应用程序中添加进度条支持。这个解决方案最重要的是保证可用性和灵活性。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="3378" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">关于</h1><p id="feb5" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">现代应用程序定期处理异步操作，无论是API请求还是计时器事件。在大多数情况下，我们希望看到有一个我们正在等待的进程，进度条或<em class="ms">微调器</em>是展示这一点的好方法。</p><p id="60aa" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">当我查看现有的解决方案时，我发现——无论该解决方案是否使用NgRx它在应用程序中只支持一个进度条，但我希望支持多个进度条。</p><p id="6d6a" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们以开篇文章为例来考虑这个。当加载图像时，我们希望看到微调器，而不是没有加载的图像。我们需要将每个异步进程与其自己的进度条相关联。例如，如果我们开始为user1 <em class="ms"> </em>和admin加载两个图标，并尝试同时登录，我们应该会看到三个进度条:</p><ol class=""><li id="7443" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh my mz na nb bi translated">User1进度条。</li><li id="dc1c" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh my mz na nb bi translated">管理进度条。</li><li id="16e6" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh my mz na nb bi translated">登录进度条。</li></ol><p id="34cd" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们开始实现吧。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="d940" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">先决条件:</h1><ol class=""><li id="7a43" class="mt mu jn km b kn mn kr mo kv nh kz ni ld nj lh my mz na nb bi translated"><a class="ae nk" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">节点</a> v10+</li><li id="5e52" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh my mz na nb bi translated"><a class="ae nk" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank">国家预防机制</a></li><li id="1980" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh my mz na nb bi translated"><a class="ae nk" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank">棱角分明</a> 6+，但我会用7.2</li></ol></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="fd30" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">准备一个项目</h1><ol class=""><li id="7426" class="mt mu jn km b kn mn kr mo kv nh kz ni ld nj lh my mz na nb bi translated">使用<code class="fe nl nm nn no b">ng-cli</code>生成新项目:</li></ol><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="f05c" class="nt lq jn no b gy nu nv l nw nx">ng new progresses-sandbox — style=scss</span></pre><p id="9606" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">没必要，但我更喜欢用<a class="ae nk" href="https://sass-lang.com/" rel="noopener ugc nofollow" target="_blank"> Sass </a>。</p><p id="59b6" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">2.添加NgRx支持。</p><p id="5093" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们需要一个存储模块和一个效果模块，因为我们将处理副作用。多亏了<code class="fe nl nm nn no b">angular-cli</code>,我们可以方便地添加新功能。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="5565" class="nt lq jn no b gy nu nv l nw nx">ng add @ngrx/store</span><span id="459c" class="nt lq jn no b gy ny nv l nw nx">ng add @ngrx/effects</span><span id="3d20" class="nt lq jn no b gy ny nv l nw nx">ng add @ngrx/store-devtools // Optional</span></pre><p id="e142" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">看起来我们准备好出发了。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="c215" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">开始实施:</h1><ol class=""><li id="5596" class="mt mu jn km b kn mn kr mo kv nh kz ni ld nj lh my mz na nb bi translated">清理现有的NgRx代码:</li></ol><ul class=""><li id="4762" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh nz mz na nb bi translated">在<code class="fe nl nm nn no b">app.module</code>更改模块导入</li></ul><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="782a" class="nt lq jn no b gy nu nv l nw nx">to StoreModule.<em class="ms">forRoot</em>({})</span><span id="c2e9" class="nt lq jn no b gy ny nv l nw nx">to EffectsModule.<em class="ms">forRoot</em>([])</span></pre><ul class=""><li id="c461" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh nz mz na nb bi translated">移除<code class="fe nl nm nn no b">app.effects</code>和<code class="fe nl nm nn no b">reducers</code>文件夹</li></ul><p id="4903" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">2.添加一个进度条模块，我们在其中实现我们的进度条基础设施。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="e826" class="nt lq jn no b gy nu nv l nw nx">ng g m progress</span></pre><p id="1edd" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">3.NgRx准备。</p><ul class=""><li id="4634" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh nz mz na nb bi translated">在<code class="fe nl nm nn no b">app/progress</code>中创建一个名为<code class="fe nl nm nn no b">store</code>的文件夹</li><li id="1d1f" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh nz mz na nb bi translated">创建5个文件:</li></ul><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="5916" class="nt lq jn no b gy nu nv l nw nx">progress.actions.ts<br/>progress.effects.ts<br/>progress.reducer.ts<br/>progress.selectors.ts<br/>progress.state.ts</span></pre><h2 id="80ca" class="nt lq jn bd lr oa ob dn lv oc od dp lz kv oe of md kz og oh mh ld oi oj ml ok bi translated">实现进度条存储模型</h2><p id="2c62" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">我们需要跟踪应用程序中的每个进度条，这就是为什么我们应该记住每个进度条的状态(无论我们是否应该显示它)。</p><p id="b3ee" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">最适合这个目的的结构是一个简单的对象，其中一个键是<code class="fe nl nm nn no b">id</code>，而<code class="fe nl nm nn no b">value</code>是一个表示当前状态的<code class="fe nl nm nn no b">boolean</code>值。</p><p id="97cd" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">向<code class="fe nl nm nn no b">progress.state.ts</code>添加新接口:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="4154" class="nt lq jn no b gy nu nv l nw nx">export interface ProgressState {<br/>  progresses: { [id: string]: boolean };</span><span id="b10e" class="nt lq jn no b gy ny nv l nw nx">}</span></pre><h2 id="2581" class="nt lq jn bd lr oa ob dn lv oc od dp lz kv oe of md kz og oh mh ld oi oj ml ok bi translated">实现进度条操作</h2><p id="3095" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">为了允许进度条“显示”或“隐藏”，我们需要添加两个动作:<code class="fe nl nm nn no b">Show</code>和<code class="fe nl nm nn no b">Hide</code>。</p><p id="b48d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我将省略所有导入，但您可以在<a class="ae nk" href="https://github.com/Stioneq/progresses-sandbox" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>上找到整个应用程序。</p><p id="bd6f" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们从类型开始:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="e0fd" class="nt lq jn no b gy nu nv l nw nx">export enum ProgressActionTypes {<br/>  <em class="ms">SHOW </em>= '[Progress] Show',<br/>  <em class="ms">HIDE </em>= '[Progress] Hide'<br/>}</span></pre><p id="19d2" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">添加新动作:</p><p id="20c5" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">值得注意的是，我们有<code class="fe nl nm nn no b">id</code>作为构造函数参数。这是因为我们需要指出哪个进度条需要更新。</p><h2 id="a595" class="nt lq jn bd lr oa ob dn lv oc od dp lz kv oe of md kz og oh mh ld oi oj ml ok bi translated">实施进度条缩减器</h2><p id="b21e" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">这很简单，但是别忘了我们的默认状态只是一个空对象。我们之后会填写它。</p><h2 id="3c31" class="nt lq jn bd lr oa ob dn lv oc od dp lz kv oe of md kz og oh mh ld oi oj ml ok bi translated">选择器</h2><p id="b387" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">首先，创建一个从应用程序状态中提取<code class="fe nl nm nn no b">progressState</code>的函数。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="feb4" class="nt lq jn no b gy nu nv l nw nx">const selectProgressState = (state: AppState) =&gt; state.progressState;</span></pre><p id="d8d1" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们创建一个选择器。我们使用<code class="fe nl nm nn no b">props</code>来检索给定<code class="fe nl nm nn no b">progressId</code>的<code class="fe nl nm nn no b">state</code>。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="4666" class="nt lq jn no b gy nu nv l nw nx">export const showProgress = () =&gt; {<br/>  return createSelector(selectProgressState, (state, props) =&gt; state.progresses[props.progressId]);<br/>};</span></pre><h2 id="e864" class="nt lq jn bd lr oa ob dn lv oc od dp lz kv oe of md kz og oh mh ld oi oj ml ok bi translated">效果</h2><p id="2d77" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">效果在这里是最重要的，因为它们是我们如何调度行动的方法。假设我们有不同的动作，但是只有其中的一部分是显示和隐藏进度条的原因。</p><p id="22ee" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们创建一些模拟动作。</p><p id="e7e2" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">创建<strong class="km jo">app . actions . ts</strong></p><p id="5c12" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我不会列出所有的构造函数参数，因为我只会将这些动作用于测试目的。</p><p id="8314" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">回到效果。</p><p id="8129" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们引入一个<code class="fe nl nm nn no b">object</code>来存储所有的进度条触发器。</p><p id="184e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这个对象中的键将是<code class="fe nl nm nn no b">progressId</code>，值将是<code class="fe nl nm nn no b">object</code>。它包括什么可以触发显示，什么可以触发进度条的隐藏。</p><p id="7df3" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">结果是这样的:</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="ef31" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">您可以看到，我们有一个进度条<code class="fe nl nm nn no b">login_progress</code> <strong class="km jo"> </strong>，它只能在登录时显示，并且只能在登录成功或失败后隐藏。</p><p id="0bef" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这种结构可以方便用户存储和跟踪每一个进度条，但是使用起来效果并不好。</p><p id="0f13" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们需要通过转换两个集合来准备在效果中使用它。<code class="fe nl nm nn no b">SHOW_ACTIONS</code>和<code class="fe nl nm nn no b">HIDE_ACTIONS</code>键是一个动作，值是一个进度条id。</p><p id="4e01" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">它将更适合用于动作链的类型的<strong class="km jo">可允许操作符。</strong></p><p id="4f40" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们将<code class="fe nl nm nn no b">PROGRESS_ACTIONS</code>转换成这两个对象:</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8420" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们就要完成我们的特效了。但是，我们已经忘记了最重要的事情——效果本身。</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="1d05" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">最后，对于NgRx基础设施，我们需要添加<code class="fe nl nm nn no b">progressStore</code>作为商店特性。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="bdcd" class="nt lq jn no b gy nu nv l nw nx">StoreModule.<em class="ms">forFeature</em>('progressState', progressReducer),<br/>EffectsModule.<em class="ms">forFeature</em>([ProgressEffects])</span></pre><p id="d25d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">并在<code class="fe nl nm nn no b">app.module</code>导入中添加<code class="fe nl nm nn no b">progressModule</code>。</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="708f" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">首次使用</h1><p id="aaf2" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated"><strong class="km jo">待办事项:</strong></p><p id="2df4" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">创建一个示例按钮，当点击它时，应该有加载文本。五秒钟后，按钮应该返回。</p><p id="0058" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><strong class="km jo">如何:</strong></p><p id="5242" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">修改<code class="fe nl nm nn no b">app.component.html</code></p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="125c" class="nt lq jn no b gy nu nv l nw nx">&lt;input type='button' <em class="ms">*ngIf</em>="!(loading$ | async); else loading" value="Start"/&gt;</span><span id="4422" class="nt lq jn no b gy ny nv l nw nx">&lt;ng-template #loading&gt;Loading...&lt;/ng-template&gt;</span></pre><p id="a52c" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这里有一个按钮，显示是否正在加载。否则，将显示加载文本。</p><p id="3e8e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这里我们有一个<code class="fe nl nm nn no b">loading$</code>参数，它不存在于组件本身中。</p><p id="8213" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让<code class="fe nl nm nn no b">init</code>把它放在那里:</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="6a0d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们添加了<code class="fe nl nm nn no b">login_progress</code> <strong class="km jo"> </strong>作为<code class="fe nl nm nn no b">progressActions</code>的关键。当我们分派登录动作时，我们应该看到带有<code class="fe nl nm nn no b">login_progress</code> id的进度条。让我们检查一下。</p><p id="71d2" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">修改模板以添加点击处理程序:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="9091" class="nt lq jn no b gy nu nv l nw nx">&lt;input type='button' (click)="onClick()" <em class="ms">*ngIf</em>="!(loading$ | async); else loading" value="Start"/&gt;</span></pre><p id="f551" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">实现onClick方法:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="60e6" class="nt lq jn no b gy nu nv l nw nx">onClick() {<br/>  this.store.dispatch(new LoginAction());<br/>}</span></pre><p id="0e04" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">现在，当我们点击按钮时，我们看到加载文本，但按钮不返回。原因是我们没有调度隐藏进度条的动作。上面，我们定义了两个应该隐藏进度条的动作:[ <code class="fe nl nm nn no b">LoginSuccessAction</code>和<code class="fe nl nm nn no b">LoginFailedAction</code></p><p id="2c5a" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们在五秒钟后添加这个动作的调度。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="ff95" class="nt lq jn no b gy nu nv l nw nx">onClick() {<br/>  this.store.dispatch(new LoginAction());<br/>  setTimeout(() =&gt; this.store.dispatch(new LoginSuccessAction()), 5000);<br/>}</span></pre><p id="06ab" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">看起来一切正常。</p><p id="1625" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">但是我仍然怀疑这种方法在处理进度条时的便利性。每次我需要创建一个模板，并在<code class="fe nl nm nn no b">state</code>中选择进度条状态。这对用户来说不太方便。我们需要改进我们的解决方案。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="d4c3" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">引入结构指令</h1><p id="a530" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">为了封装与进度条存储的所有交互，我们将添加一个结构化指令。</p><p id="67b6" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">为什么应该是结构性的？因为我们不仅想隐藏元素，还想用进度条/微调器替换元素。</p><p id="7c6a" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在进度条模块中创建一个指令。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="2af7" class="nt lq jn no b gy nu nv l nw nx">ng g d directives/progress</span></pre><p id="bccf" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们将使用不带前缀的自定义选择器(这违反了谷歌风格指南)。</p><figure class="jd je jf jg gt iv"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="0583" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这里我们为给定的<code class="fe nl nm nn no b">progressId</code>订阅<code class="fe nl nm nn no b">showProgress</code>，然后用来自<code class="fe nl nm nn no b">config.replaceWith.</code>的模板替换我们的模板</p><p id="feff" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们将<code class="fe nl nm nn no b">config</code>定义为名为<code class="fe nl nm nn no b">progressAware</code>的输入。这是将值直接传递给结构指令的方法。</p><p id="3e6b" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们添加一个配置接口:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="86e9" class="nt lq jn no b gy nu nv l nw nx">import {TemplateRef} from '@angular/core';</span><span id="a32e" class="nt lq jn no b gy ny nv l nw nx">export interface ProgressConfig {<br/>  progressId: string;<br/>  replaceWith: TemplateRef&lt;any&gt;;<br/>}</span></pre><p id="9663" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">为<code class="fe nl nm nn no b">config</code>添加类型:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="d482" class="nt lq jn no b gy nu nv l nw nx">@Input('progressAware') config: ProgressConfig;</span></pre><p id="490a" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">请不要忘记取消订阅组件/指令销毁上的所有观察项目。</p><p id="d94e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">为此我通常使用<a class="ae nk" href="https://www.learnrxjs.io/operators/filtering/takeuntil.html" rel="noopener ugc nofollow" target="_blank"> takeUntil </a>(感谢Ben Lesh)。</p><p id="fc91" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">添加退订<code class="fe nl nm nn no b">subject</code>:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="ee1d" class="nt lq jn no b gy nu nv l nw nx">unsubscribe$ = new Subject();</span></pre><p id="8ef5" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">执行<code class="fe nl nm nn no b">onDestroy</code>:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="121a" class="nt lq jn no b gy nu nv l nw nx">ngOnDestroy(): void {<br/>  this.unsubscribe$.next();<br/>  this.unsubscribe$.complete();<br/>}</span></pre><p id="305d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">修改订阅:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="6409" class="nt lq jn no b gy nu nv l nw nx">this.store.pipe(select(showProgress() as any, {progressId: this.config.progressId}), takeUntil(this.unsubscribe$))</span></pre><p id="1c9a" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">不要忘记在进度模块中添加对<code class="fe nl nm nn no b">exports</code>的指令:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="a321" class="nt lq jn no b gy nu nv l nw nx">...<br/>  exports: [ProgressDirective]<br/>})</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="06cb" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">第二次使用</h1><p id="d68f" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated"><strong class="km jo">待办事项</strong>:</p><p id="cfe9" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在我们的第一个例子中引入结构化指令，并去掉存储在app组件中的使用进度</p><p id="91b0" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><strong class="km jo">如何:</strong></p><ol class=""><li id="2777" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh my mz na nb bi translated">清理<code class="fe nl nm nn no b">app.component</code>里的<code class="fe nl nm nn no b">onInit</code>。</li><li id="f3c9" class="mt mu jn km b kn nc kr nd kv ne kz nf ld ng lh my mz na nb bi translated">修改<code class="fe nl nm nn no b">app.component</code>模板:</li></ol><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="9cc0" class="nt lq jn no b gy nu nv l nw nx">&lt;input type='button' (click)="onClick()" <em class="ms">*progressAware</em>="{progressId: 'login_progress', replaceWith: loading}"<br/>       value="Start"/&gt;</span><span id="91f9" class="nt lq jn no b gy ny nv l nw nx">&lt;ng-template #loading&gt;Loading...&lt;/ng-template&gt;</span></pre><p id="c945" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这里我们用<code class="fe nl nm nn no b">progressAware</code>结构指令代替<code class="fe nl nm nn no b">ngIf</code>。我们通过进度条的<code class="fe nl nm nn no b">id</code>，等待加载的时候应该用哪个模板替换它。</p><p id="270c" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">结果是一样的，但是代码看起来稍微好一点，我们全新的指令很容易使用。</p><p id="741e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然而，当我开始使用这种方法时，我面临另一个用例。我需要添加一个微调到现有的按钮；我不想替换它。例如，我有一个登录按钮，当我按下它时，我希望在这个按钮的顶部有一个旋转器<em class="ms">，而不是这个按钮的<em class="ms">而不是</em>。</em></p><figure class="jd je jf jg gt iv gh gi paragraph-image"><div class="gh gi on"><img src="../Images/e7fb09136aba5f129fdbda58770a4723.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*mAjDlSffV4jh5OtxBeLqkw.png"/></div><figcaption class="iy iz gj gh gi ja jb bd b be z dk translated">按钮顶部的微调按钮</figcaption></figure><p id="c470" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们不仅要支持替换，还要支持隐藏进度条。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="3c34" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">添加隐藏行为</h1><p id="0c75" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">我们将修改我们的结构指令。</p><ol class=""><li id="9350" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh my mz na nb bi translated">让我们修改<code class="fe nl nm nn no b">ProgressConfig</code>中的配置并添加<code class="fe nl nm nn no b">replace</code> <em class="ms"> </em>参数。</li></ol><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="eaf4" class="nt lq jn no b gy nu nv l nw nx">export interface ProgressConfig {<br/>  progressId: string;<br/>  replaceWith?: TemplateRef&lt;any&gt;;<br/>  replace?: boolean;<br/>}</span></pre><p id="79b0" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">此参数指示我们是仅显示/隐藏进度，还是用进度条替换现有组件。</p><p id="7105" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">2.重写订阅处理。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="bfe1" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">第三次使用</h1><p id="7b3d" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated"><strong class="km jo">要做的事情</strong>:</p><p id="396f" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">添加第二个“加载”，点击按钮后会出现，五秒后消失。</p><p id="0d69" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><strong class="km jo">如何:</strong></p><p id="ef1c" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们修改我们的<code class="fe nl nm nn no b">app.component</code>模板。</p><p id="fbb1" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们添加<code class="fe nl nm nn no b">replace</code> <em class="ms">、</em> <code class="fe nl nm nn no b">true</code>用于输入，因为只有当<code class="fe nl nm nn no b">value</code>为<code class="fe nl nm nn no b">true</code>时，我们才会用进度条替换它。</p><p id="02e1" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们还添加了新的装载文本，除了<code class="fe nl nm nn no b">progressId</code>之外没有任何参数，因为它是强制性的。</p><p id="906e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">现在，当你点击按钮，你会看到两个加载信息。五秒钟后，您将只看到按钮。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="0be3" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">奖金:</h1><p id="7f29" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated"><strong class="km jo">要做的事情</strong>:</p><p id="cee5" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">使用进度微调器创建一个登录按钮。只有当我们按下这个按钮时，这个进度微调器才会出现，而这个按钮将被禁用。</p><p id="82f0" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">如图:</p><figure class="jd je jf jg gt iv gh gi paragraph-image"><div class="gh gi on"><img src="../Images/e7fb09136aba5f129fdbda58770a4723.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*mAjDlSffV4jh5OtxBeLqkw.png"/></div><figcaption class="iy iz gj gh gi ja jb bd b be z dk translated">按钮顶部的微调按钮</figcaption></figure><p id="7405" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><strong class="km jo">如何</strong>:</p><ol class=""><li id="b2e9" class="mt mu jn km b kn ko kr ks kv mv kz mw ld mx lh my mz na nb bi translated">生成一个新组件。</li></ol><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="9922" class="nt lq jn no b gy nu nv l nw nx">ng g c login-btn</span></pre><p id="1e26" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">2.修改<code class="fe nl nm nn no b">app.component</code>样式。</p><p id="ed1d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">3.为登录按钮添加样式。</p><p id="4449" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">4.将按钮添加到我们的组件中。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="6cae" class="nt lq jn no b gy nu nv l nw nx">&lt;input (click)="onClick()" type='button' class="login" value="Login"/&gt;</span></pre><p id="7b70" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">5.在按钮上添加进度条。</p><p id="8aec" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">为了快速起见，我将使用SVG实现，并将它添加到<code class="fe nl nm nn no b">login-btn</code>模板中。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="32e4" class="nt lq jn no b gy nu nv l nw nx">&lt;svg<br/>  <br/>  viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="progress img lds-eclipse" style="background: none;"&gt;<br/>  &lt;path stroke="none" d="M10 50A40 40 0 0 0 90 50A40 45 0 0 1 10 50" fill="#5eccb2"<br/>        transform="rotate(354 49.9999 52.4999)"&gt;<br/>    &lt;animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 52.5;360 50 52.5"<br/>                      keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"&gt;&lt;/animateTransform&gt;<br/>  &lt;/path&gt;<br/>&lt;/svg&gt;</span></pre><p id="1345" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">6.下一步是引入我们的<code class="fe nl nm nn no b">progressAware</code>指令。</p><p id="bb2d" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">此时此刻，你应该对此感到满意。</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="fae8" class="nt lq jn no b gy nu nv l nw nx"><em class="ms">*progressAware</em>="{progressId: 'login_progress'}"</span></pre><p id="e923" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">7.为按钮添加click处理程序</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="0562" class="nt lq jn no b gy nu nv l nw nx">onClick() {<br/>  this.store.dispatch(new LoginAction());<br/>  setTimeout(() =&gt; this.store.dispatch(new LoginSuccessAction()), 5000);<br/>}</span></pre><p id="d9e0" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">现在，除了禁用按钮和隐藏文本之外，一切正常。</p><p id="409c" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">当然，我们可以在<code class="fe nl nm nn no b">onClick</code>事件中手动添加一些类，但是很难跟踪过程结束的时刻。</p><p id="1568" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们将通过引入生命周期挂钩来稍微修改我们的结构指令:<code class="fe nl nm nn no b">onShow</code>和<code class="fe nl nm nn no b">onHide</code></p><p id="eb7e" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">8.修改结构指令。</p><p id="194f" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">向ProgressConfig接口添加新字段</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="6b13" class="nt lq jn no b gy nu nv l nw nx">onShow?: () =&gt; void;<br/>  onHide?: () =&gt; void;</span></pre><p id="b1e8" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">更新订阅处理</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="b1bb" class="nt lq jn no b gy nu nv l nw nx">this.store.pipe(select(showProgress() as any, {progressId:   this.config.progressId}), takeUntil(this.unsubscribe$)).subscribe(show =&gt; {</span><span id="2948" class="nt lq jn no b gy ny nv l nw nx">if (show) {<br/>    this.config.onShow &amp;&amp; this.config.onShow();<br/>  } else {<br/>    this.config.onHide &amp;&amp; this.config.onHide();<br/>  }<br/>.</span></pre><p id="ab31" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">9.通过添加onShow和onHide事件的处理来更新login-btn组件:</p><p id="c990" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">添加一个新属性来绑定输入类，并添加两个方法来处理挂钩</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="76b5" class="nt lq jn no b gy nu nv l nw nx">submitting = false;</span><span id="38fe" class="nt lq jn no b gy ny nv l nw nx">...</span><span id="57ba" class="nt lq jn no b gy ny nv l nw nx">onProgressShow() {</span><span id="8f94" class="nt lq jn no b gy ny nv l nw nx">this.submitting = true;<br/>}</span><span id="ca71" class="nt lq jn no b gy ny nv l nw nx">onProgressHide() {<br/>  this.submitting = false;<br/>}</span></pre><p id="92cd" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">更新模板:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="2eae" class="nt lq jn no b gy nu nv l nw nx">&lt;input (click)="onClick()" [class.submitting]="submitting" type='button' class="login" value="Login"/&gt;</span><span id="1536" class="nt lq jn no b gy ny nv l nw nx">&lt;svg <em class="ms">*progressAware</em>="{onShow: onProgressShow.bind(this),onHide: onProgressHide.bind(this), progressId: 'login_progress'}"<br/>...</span></pre><p id="c063" class="pw-post-body-paragraph kk kl jn km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">更新样式以支持新的提交类:</p><pre class="jd je jf jg gt np no nq nr aw ns bi"><span id="ce1a" class="nt lq jn no b gy nu nv l nw nx">&amp;.submitting {<br/>  color: #00000000;<br/>  opacity: 0.1;<br/>  pointer-events: none;<br/>}</span></pre><figure class="jd je jf jg gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/14f30c4c90fd02818f3748eada0305d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/format:webp/1*gwnO5IXmUlV5A-jUmuDj3A.png"/></div><figcaption class="iy iz gj gh gi ja jb bd b be z dk translated">结果</figcaption></figure></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><h1 id="da20" class="lp lq jn bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">最后</h1><p id="040b" class="pw-post-body-paragraph kk kl jn km b kn mn kp kq kr mo kt ku kv mp kx ky kz mq lb lc ld mr lf lg lh im bi translated">感谢您阅读这篇文章。我希望它是有用的。不要犹豫，提出问题，留下评论。</p></div></div>    
</body>
</html>