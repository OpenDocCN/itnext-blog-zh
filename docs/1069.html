<html>
<head>
<title>Modular Game Worlds in Phaser 3 (Tilemaps #2) — Dynamic Platformer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Phaser 3中的模块化游戏世界(tile maps # 2)——动态平台玩家</h1>
<blockquote>原文：<a href="https://itnext.io/modular-game-worlds-in-phaser-3-tilemaps-2-dynamic-platformer-3d68e73d494a?source=collection_archive---------2-----------------------#2018-07-16">https://itnext.io/modular-game-worlds-in-phaser-3-tilemaps-2-dynamic-platformer-3d68e73d494a?source=collection_archive---------2-----------------------#2018-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cab3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一系列关于在<a class="ae kl" href="http://phaser.io/" rel="noopener ugc nofollow" target="_blank"> Phaser 3 </a>游戏引擎中使用tilemaps创建模块化世界的博文。如果你还没有，看看第一个<a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-1-958fc7e6bbd6" rel="noopener">帖子</a>，在那里我们了解了tilemaps并使用它们创建了一个自上而下的、神奇宝贝风格的游戏世界。在本帖中，我们将深入动态操作tilemaps，并创建一个puzzle-y platformer，您可以在其中绘制平台来帮助绕过障碍:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/67d0f6cc16f8d78be1fa0d0d0d59789a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gDH7ngacTtHrHwvP0aZz7w.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">我们将创建的最后一个示例</em></figcaption></figure><p id="7e2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一篇<a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-3-procedural-dungeon-3bc19b841cd" rel="noopener">帖子</a>涵盖了创建一个程序化的地牢世界，下一篇将涵盖整合<a class="ae kl" href="http://brm.io/matter-js/" rel="noopener ugc nofollow" target="_blank"> Matter.js </a>来创建一个跳墙平台。</p><p id="52ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，这篇文章附带的所有代码都在<a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/tree/master/examples/post-1" rel="noopener ugc nofollow" target="_blank">这个库</a>中。这些教程使用截至21年8月13日的Phaser最新版本(v3.55.2)。</p><h1 id="1393" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">目标受众</h1><p id="8364" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">如果你对JavaScript(类、箭头函数和模块)、Phaser和<a class="ae kl" href="https://www.mapeditor.org/" rel="noopener ugc nofollow" target="_blank">平铺</a>地图编辑器有一些经验，这篇文章将会很有意义。如果你没有，你可能想从<a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-1-958fc7e6bbd6" rel="noopener">系列</a>的开头开始，或者继续阅读并把Google、Phaser <a class="ae kl" href="https://phaser.io/tutorials/making-your-first-phaser-3-game" rel="noopener ugc nofollow" target="_blank">教程</a>和Phaser <a class="ae kl" href="https://labs.phaser.io/" rel="noopener ugc nofollow" target="_blank">示例</a> &amp; <a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/index.html" rel="noopener ugc nofollow" target="_blank">文档</a>放在手边。</p><p id="1c66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，让我们开始吧！</p><h1 id="0384" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">Tilemap API</h1><p id="c738" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">在我们构建平台之前，让我们先来鸟瞰一下tilemap API。上次我们谈到了以下几个方面:</p><ul class=""><li id="0cac" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tilemap.html" rel="noopener ugc nofollow" target="_blank">Tilemap</a></code></li><li id="7d91" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk ml mm mn mo bi translated"><code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tileset.html" rel="noopener ugc nofollow" target="_blank">Tileset</a></code></li><li id="682e" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk ml mm mn mo bi translated"><code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html" rel="noopener ugc nofollow" target="_blank">TilemapLayer</a></code></li></ul><p id="c15b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将深入探讨API的两个部分:</p><ul class=""><li id="a8ee" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk ml mm mn mo bi translated"><code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html" rel="noopener ugc nofollow" target="_blank">TilemapLayer</a></code></li><li id="1d01" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk ml mm mn mo bi translated"><code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tile.html" rel="noopener ugc nofollow" target="_blank">Tile</a></code></li></ul><p id="a9a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mp mq mr ms b">Tilemap</code>不是显示对象。它保存了关于地图的数据，并且可以包含一个或多个层(<code class="fe mp mq mr ms b">TilemapLayer</code>实例)，这些层是实际呈现<code class="fe mp mq mr ms b">Tile</code>对象的显示对象。</p><h1 id="a995" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">粉刷瓷砖</h1><p id="bcf7" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">对于第一个例子，我们将加载一个由瓷砖构成的关卡，然后动态绘制和擦除瓷砖。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/48464d01362d9c357744483994ad646d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*B8V3wwnoCR584DhYKFAj4A.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">Tileset by 0x 72 CC-0，</em><a class="ae kl" href="https://0x72.itch.io/16x16-industrial-tileset" rel="noopener ugc nofollow" target="_blank"><em class="lc">https://0x72.itch.io/16x16-industrial-tileset</em></a></figcaption></figure><p id="325b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该设置将类似于我们在上一篇文章中所做的:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="148f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦你加载了一个动态层，你就可以开始使用<a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html" rel="noopener ugc nofollow" target="_blank"> Tilemap Layer API </a>操作图块了:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8342" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获取或操作切片的tilemap层(和tilemap)方法通常成对出现。一种方法——如<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html#putTileAt__anchor" rel="noopener ugc nofollow" target="_blank">putTileAt</a></code>——将在平铺网格单元上操作，例如,( 0，2)将对应于层的第一列和第三行。另一种方法——如<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html#putTileAtWorldXY__anchor" rel="noopener ugc nofollow" target="_blank">putTileAtWorldXY</a></code>——将在世界像素单位中操作，这使得查找鼠标下的图块变得更容易。也有从平铺网格单位转换到世界像素坐标的方法，反之亦然:<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html#worldToTileXY__anchor" rel="noopener ugc nofollow" target="_blank">worldToTileXY</a></code>，<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html#tileToWorldXY__anchor" rel="noopener ugc nofollow" target="_blank">tileToWorldXY</a></code>。</p><p id="6f6d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将这些方法与Phaser输入放在一起，我们可以用鼠标在一个层中绘制图块:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="cbd3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下示例将所有这些放在一起，并允许您通过单击来绘制拼贴，并通过按住shift单击来擦除拼贴。<code class="fe mp mq mr ms b">worldToTileXY</code> &amp; <code class="fe mp mq mr ms b">tileToWorldXY</code>用于创建一个简单的图形叠加，直观显示鼠标当前在哪个图块上。</p><p id="43c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:你需要点击“在CodeSandbox上编辑”按钮，全屏查看代码，在这里你可以很容易地看到所有的文件。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="na mz l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/31xpvv85om?hidenavigation=1&amp;module=%2Fjs%2Findex.js&amp;moduleview=1" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc"/><a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-2/01-drawing-tiles" rel="noopener ugc nofollow" target="_blank"><em class="lc">live示例</em> </a> <em class="lc">或源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-2/01-drawing-tiles" rel="noopener ugc nofollow" target="_blank"> <em class="lc">此处</em> </a> <em class="lc">。</em></figcaption></figure><h1 id="469a" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">模块化我们的代码</h1><p id="ac29" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">添加或删除单个磁贴非常简单，所以让我们来增加复杂性，构建平台的基础:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/8a74a21ca14909128669f464a973e586.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tc54eGD6Rh4-koyHhxMoGQ.gif"/></div></div></figure><p id="8a47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，我们已经使用一个包含<code class="fe mp mq mr ms b">preload</code>、<code class="fe mp mq mr ms b">setup</code>和<code class="fe mp mq mr ms b">update</code>函数的文件，快速启动并运行了Phaser。对于简单的例子来说，这很好，但是一旦涉及到任何适度复杂的例子，这就变成了一场噩梦。</p><p id="db1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了构建我们的平台化基础，我们希望将这个单一的文件结构分解成更容易理解的、被称为“模块”的独立文件有很多理由让你的代码模块化。如果使用得当，它们有助于创建可移植的、可重用的、更容易思考的代码块。如果你不熟悉模块，请查看<em class="nb">雄辩JavaScript </em>或<a class="ae kl" href="https://blog.cloud66.com/an-overview-of-es6-modules-in-javascript/" rel="noopener ugc nofollow" target="_blank">本概述</a>中的<a class="ae kl" href="https://eloquentjavascript.net/10_modules.html" rel="noopener ugc nofollow" target="_blank">模块章节</a>。</p><p id="6f65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你使用的是现代浏览器(大概是2017年末以后)，你可以在你的项目中使用模块(不需要webpack，package等)。)通过在HTML中添加<code class="fe mp mq mr ms b">type="module"</code>属性，如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="76a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(注意:您不会在CodeSandbox演示中看到这一点，因为它们使用<a class="ae kl" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank">包捆绑器</a>来启用模块支持，但是您会在本系列的<a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/tree/master/examples/post-2" rel="noopener ugc nofollow" target="_blank">源代码</a>中看到它。)</p><p id="89b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在index.js中，您现在可以从至少有一个<code class="fe mp mq mr ms b"><a class="ae kl" href="https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export" rel="noopener ugc nofollow" target="_blank">export</a></code>的其他文件中选择<code class="fe mp mq mr ms b"><a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" rel="noopener ugc nofollow" target="_blank">import</a></code>函数、对象或原始值。<code class="fe mp mq mr ms b">import</code>和<code class="fe mp mq mr ms b">export</code>为我们提供了将单个文件代码分割成单独文件的方法。考虑到这一点，我们的新项目结构如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d564a6c8ad2ac52bc942a2b9733fa458.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*7jHWzPxXCLaxs2gJijrJCQ.png"/></div></figure><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5fd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看下面的代码，从index.js开始。在那里，当您看到一个<code class="fe mp mq mr ms b">import</code>时，查看被引用的文件以跟随线程。这将是我们构建下一部分的基础。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="na mz l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/p5pqqjk6q0?hidenavigation=1&amp;module=%2Fjs%2Findex.js&amp;moduleview=1" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc">，</em> <a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-2/02-modules-demo" rel="noopener ugc nofollow" target="_blank"> <em class="lc"> live示例</em> </a> <em class="lc">或者源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-2/02-modules-demo" rel="noopener ugc nofollow" target="_blank"> <em class="lc">这里</em> </a> <em class="lc">。</em></figcaption></figure><p id="cdd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分解这里的每一行代码有点超出了本文的范围，但在继续之前，让我们来看看一个精简版的player.js:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="da8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这通过让我们从platformer-scene.js中分离出大部分玩家逻辑，建立了一个重要的模式。场景只需要担心玩家如何与世界其他部分进行交互。只要我们在正确的时间调用<code class="fe mp mq mr ms b">update</code>和<code class="fe mp mq mr ms b">destroy</code>，我们甚至可以把这个播放器文件放到一个完全独立的项目中，它会工作得很好。</p><p id="aeb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样值得注意的是，这个类建立了一个模式，我们将在未来再次使用它。player.js导出一个不扩展<code class="fe mp mq mr ms b">Phaser.GameObjects.Sprite</code>的类。相反，它包含了一个更加灵活的<a class="ae kl" href="http://gameprogrammingpatterns.com/component.html" rel="noopener ugc nofollow" target="_blank">组件模式</a>，其中<code class="fe mp mq mr ms b">Player</code>有一个sprite属性，而<code class="fe mp mq mr ms b">Player</code>本身不是一个sprite。</p><p id="059b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以做更多的事情来使代码更加模块化(例如，利用Phaser的事件系统，参见<a class="ae kl" href="https://github.com/samme/phaser-plugin-update" rel="noopener ugc nofollow" target="_blank">samme/Phaser-plugin-update</a>，或者将运动逻辑从动画中分离出来)，但这已经足够模块化，而无需引入太多新概念。</p><h1 id="e661" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">平台玩家</h1><p id="ff4d" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">咻，我们现在有了一个可以构建的模板。让我们回到平台游戏的概念上来，你可以画出方块来绕过障碍:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/67d0f6cc16f8d78be1fa0d0d0d59789a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gDH7ngacTtHrHwvP0aZz7w.gif"/></div></div></figure><p id="20cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于上一节中的代码，有两个重要的特定于tilemap的扩展，我们应该分解一下:</p><ol class=""><li id="d93f" class="mg mh iq jp b jq jr ju jv jy mi kc mj kg mk kk nd mm mn mo bi translated">绘制碰撞的瓷砖</li><li id="147c" class="mg mh iq jp b jq mt ju mu jy mv kc mw kg mx kk nd mm mn mo bi translated">用正确的点击框和逻辑添加尖峰</li></ol><p id="0bc0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，画瓷砖。这类似于前面的代码，但是我们希望我们添加的瓷砖相互碰撞，这样玩家就可以落在上面。<code class="fe mp mq mr ms b">putTileAtWorldXY</code>将返回被操作的<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tile" rel="noopener ugc nofollow" target="_blank">Tile</a></code>对象。<code class="fe mp mq mr ms b">Tile</code>对象非常简单。它们保存它们渲染的图块的索引和位置，以及一些物理信息。我们可以使用<code class="fe mp mq mr ms b">tile.setCollision</code>来启用碰撞:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="0daf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瓷砖还有其他有用的属性和方法。<code class="fe mp mq mr ms b">tile.x</code>和<code class="fe mp mq mr ms b">tile.y</code>是网格单位中的位置。<code class="fe mp mq mr ms b">tile.getLeft()</code>、<code class="fe mp mq mr ms b">tile.getBottom()</code>、<code class="fe mp mq mr ms b">tile.getCenterX()</code>等。会给你世界像素单位的位置。查看<a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tile" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="b681" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，我们现在可以刷瓷砖了。但是我们有一个尖峰问题:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/e001fc1fa90925f7e86c0ad79e2f2b59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KzPiGzqnBorKdXy_4Xd5eA.gif"/></div></div></figure><p id="95b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Phaser中的街机物理(AP)限制之一是碰撞瓷砖的物理主体被强制为匹配瓷砖宽度和高度的矩形。我们的道钉只有6px高，但是它有一个32px x 32px的生命值。如果我们加载地图并使用<code class="fe mp mq mr ms b">this.groundLayer.renderDebug</code>渲染碰撞的图块，问题就更明显了:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ne"><img src="../Images/9a502509bc889a02fe7ea8c779074238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*em4wU0VMhrwblsOiciO_7g.gif"/></div></div></figure><p id="7e54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有几种方法可以解决这个问题。我们可以转而使用Matter.js来研究物理，但这有点过头了。相反，让我们将尖刺从瓷砖转换成精灵，我们可以给自定义大小的物理实体。(…这也给了我们一个方便的借口来深入研究tilemap API！)</p><p id="6321" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Tilemaps有把平铺对象和平铺变成精灵的方法:分别是<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tilemap.html#createFromObjects__anchor" rel="noopener ugc nofollow" target="_blank">createFromObjects</a></code> &amp; <code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.Tilemap.html#createFromTiles__anchor" rel="noopener ugc nofollow" target="_blank">createFromTiles</a></code>。你可以用这些来直观地展示你的游戏实体应该在哪里——例如，把平铺的物体放在敌人应该在你这一关的地方，然后在你的游戏启动时把它们变成合适的精灵。下面是一个图表化的<a class="ae kl" href="https://labs.phaser.io/edit.html?src=src%5Cgame%20objects%5Ctilemap%5Cstatic%5Ccreate%20from%20objects.js&amp;v=3.9.0" rel="noopener ugc nofollow" target="_blank"> Phaser示例</a>，它使用这种策略将平铺对象替换为动画硬币精灵:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/eea54824cea38a87a42d0a90063430ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*as6XVjmqc7YogHXJtFUPcg.gif"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">左侧是在浏览器中运行的Phaser示例，右侧是平铺的。注意宽度/高度/翻转等。被复制到动画硬币精灵中。</em></figcaption></figure><p id="ccb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们代码的上下文中，将尖刺变成精灵稍微复杂一点，所以我们可以通过使用<code class="fe mp mq mr ms b"><a class="ae kl" href="https://photonstorm.github.io/phaser3-docs/Phaser.Tilemaps.TilemapLayer.html#forEachTile__anchor" rel="noopener ugc nofollow" target="_blank">forEachTile</a></code>循环一个层中的所有<code class="fe mp mq mr ms b">Tile</code>对象来滚动我们自己定制版本的平铺→精灵逻辑:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="c361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们最终会推出一些不错的热门产品，比如:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ne"><img src="../Images/3e89cd78983d19bdb22de8c888bb5ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Nm2nXVw5MJtCgnnSG8ERrg.gif"/></div></div></figure><p id="4ce3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，对于上下文中的所有内容，当玩家触摸钉子时，我们重置游戏:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="na mz l"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk translated"><em class="lc">查看</em><a class="ae kl" href="https://codesandbox.io/s/mo2j4nvkxy?hidenavigation=1&amp;module=%2Fjs%2Findex.js&amp;moduleview=1" rel="noopener ugc nofollow" target="_blank"><em class="lc">code sandbox</em></a><em class="lc"/><a class="ae kl" href="https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-2/03-drawing-platformer" rel="noopener ugc nofollow" target="_blank"><em class="lc">live示例</em> </a> <em class="lc">或源代码</em> <a class="ae kl" href="https://github.com/mikewesthad/phaser-3-tilemap-blog-posts/blob/master/examples/post-2/03-drawing-platformer" rel="noopener ugc nofollow" target="_blank"> <em class="lc">此处</em> </a> <em class="lc">。</em></figcaption></figure><h1 id="a7d6" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">下一个</h1><p id="8e03" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">看看下一个<a class="ae kl" href="https://medium.com/@michaelwesthadley/modular-game-worlds-in-phaser-3-tilemaps-3-procedural-dungeon-3bc19b841cd" rel="noopener">帖子</a>，我们将创建一个带有动态磁贴的程序地牢:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi ng"><img src="../Images/69785bc193598aa60b4665c581d85f7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1nS56OTyac1FG-RpDD0rNw.gif"/></div></div></figure><p id="dc9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读，如果您想在以后的帖子中看到什么，请告诉我！</p><h1 id="49a0" class="ld le iq bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">关于我</h1><p id="bed7" class="pw-post-body-paragraph jn jo iq jp b jq mb js jt ju mc jw jx jy md ka kb kc me ke kf kg mf ki kj kk ij bi translated">我是一名创意开发人员和教育家。我为Phaser 3编写了Tilemap API，并创建了大量有指导的示例，但我希望将所有这些信息收集成一种更有指导、更易理解的格式，以便人们可以更容易地进入Phaser 3。你可以看到更多我的作品，在这里联系我。</p></div></div>    
</body>
</html>