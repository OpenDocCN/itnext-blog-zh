<html>
<head>
<title>Terraform 0.14 -to sensitive or to not sensitive, that is the question</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地形0.14-敏感还是不敏感，这是个问题</h1>
<blockquote>原文：<a href="https://itnext.io/terraform-0-14-to-sensitive-or-to-not-sensitive-that-is-the-question-66d3fffaf697?source=collection_archive---------4-----------------------#2021-01-08">https://itnext.io/terraform-0-14-to-sensitive-or-to-not-sensitive-that-is-the-question-66d3fffaf697?source=collection_archive---------4-----------------------#2021-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/62e47741f9ab4c3d39116a9cad3bf2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RVciGEH-yAnE1l4R.jpg"/></div></div></figure><p id="a4b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我最新的博客<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/upgrading-to-terraform-0-14-experience-warning-18ea3f4bc396">条目</a>中，我提到了TF 0.14中新特性的细节，在这个特性中，你可以将输入和输出标记为敏感。此功能也是0.14.3中出现的死机问题的原因。我很高兴地宣布这个问题已经在昨天发布的0.14.4中解决了。</p><p id="43b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我继续对Terraform 0.14进行模块验证时，我遇到了一个新问题，这个问题源于敏感属性的使用。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="4fa0" class="lg lh iq lc b gy li lj l lk ll">Sensitive variable, or values derived from sensitive variables, cannot be used as for_each arguments. If used, the sensitive value could be exposed as a resource instance key.</span></pre><p id="c849" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我开始排除故障时，我有点困惑，因为这个模块没有任何标记为敏感的输入或输出。然后我开始跟踪哪个模块在调用它，并跟踪它的属性。请看，predecessor的所有输出都被标记为敏感。</p><p id="5304" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">错误中引用的代码如下:</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="3720" class="lg lh iq lc b gy li lj l lk ll">module "azuread_group" {<br/>  source = "./access_policy"<br/>  for_each = {<br/>    for key, access_policy in var.access_policies : key =&gt; access_policy<br/>    if try(access_policy.azuread_group_key, null) != null &amp;&amp; var.azuread_groups != {}<br/>  }</span><span id="50df" class="lg lh iq lc b gy lm lj l lk ll">  keyvault_id   = var.keyvault_id<br/>  access_policy = each.value<br/>  tenant_id     = var.tenant_id<br/>  object_id     = var.azuread_groups[each.value.azuread_group_key].id<br/>}</span></pre><p id="e371" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<em class="ln"> for_each </em>中有问题的引用是使用了从另一个上游模块传入的对象中的<em class="ln"> var.azuread_groups </em>。然后我查看了上游模块的输出:</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lo"><img src="../Images/bbab63b6db1e90d6d159aa5e0b7f72b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OrqLKSKCBb_GjIsxRLHmQ.png"/></div></div></figure><p id="5132" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">修复起来有些简单，因为我已经有了一个分叉版本的模块，并直接在其中进行了修改。然而，如果您碰巧没有控制代码，那么您将陷入困境，要么向上游提交一个修复，要么将其分叉。</p><p id="ce93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Terraform正在努力追踪敏感属性，并确保它们在整个图表中保持敏感。即使将敏感值传递给函数，输出也会被标记为敏感。正如你在上面看到的，这可能是痛苦的。</p><p id="6917" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个故事告诉我们，不要将属性标记为敏感，除非它确实是敏感的。如果您遵循从模块中输出完整对象的惯例，这一点尤其重要。</p><p id="1175" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，故障排除花费的时间比我希望的要长。我认为您可以通过运行Terraform并启用跟踪来排除故障。这个重要模块的输出数量将是巨大的。考虑到它的严格性和破坏性，我希望有新的机制出现来帮助解决这个新功能的问题。</p></div></div>    
</body>
</html>