<html>
<head>
<title>Create custom fetch hook for multiple Axios instances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为多个Axios实例创建自定义提取挂钩</h1>
<blockquote>原文：<a href="https://itnext.io/create-custom-fetch-hook-for-multiple-axios-instances-661a73701f73?source=collection_archive---------0-----------------------#2020-06-15">https://itnext.io/create-custom-fetch-hook-for-multiple-axios-instances-661a73701f73?source=collection_archive---------0-----------------------#2020-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f367" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当您第一次开始将现有的代码库转换成钩子或者开始使用React钩子从头开始编写组件时，这可能会很有趣。</p><p id="89c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">经过几个重复的组件后，您将摆脱重复的代码块，尤其是在发出一些网络请求时。每个请求代码块里都有那么多类似的东西。设置加载指示器、处理错误、设置响应数据等。</p><p id="860b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">听起来没必要，直到你感受到那种痛苦。我在项目一开始就有这种感觉，需要找出一个可扩展和可维护的解决方案。</p><h1 id="7b56" class="kl km iq bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">定制挂钩！</h1><p id="433a" class="pw-post-body-paragraph jn jo iq jp b jq lj js jt ju lk jw jx jy ll ka kb kc lm ke kf kg ln ki kj kk ij bi translated">自定义钩子允许我们使用React的钩子构建新的钩子。正如我之前提到的，如果你有一些重复的块和过程，你可以创建类似中间件的钩子来每次处理这些工作。事实上，这是一种效用函数。因此，让我们为Axios实例构建自己的定制钩子:</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/d57c83e09c8783faafb2be14bb3bf577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vgeBQ7npDZR01_Y1"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated"><a class="ae me" href="https://unsplash.com/photos/Wiu3w-99tNg" rel="noopener ugc nofollow" target="_blank">贷项:Unsplash </a></figcaption></figure><p id="82b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，让我们定义我们的实例:</p><pre class="lp lq lr ls gt mf mg mh mi aw mj bi"><span id="2978" class="mk km iq mg b gy ml mm l mn mo">export const <strong class="mg ir"><em class="mp">contentApi </em></strong>= <strong class="mg ir"><em class="mp">axios</em></strong>.create({<br/>   baseURL: contentApiUrl,<br/>});<br/><br/>export const <strong class="mg ir"><em class="mp">programApi </em></strong>= <strong class="mg ir"><em class="mp">axios</em></strong>.create({<br/>   baseURL: programApiUrl,<br/>});</span></pre><p id="89c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我需要创建这种实例，因为我需要对我的请求进行分组，每个请求需要不同的选项、拦截器、基本URL等。因为我有超过8个不同的API。</p><p id="5ade" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mp">更新:非常感谢</em><a class="ae me" href="https://medium.com/@gouaks" rel="noopener"><em class="mp">https://medium.com/@gouaks</em></a><em class="mp">我解决了一个恼人的问题，当我为数据或配置传递一个对象时，它会导致一个无限循环。下面是更新后的版本。</em></p><p id="edca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更新2:我从Francis Rodrigues那里得到了一个很好的评论，他用我的文件创建了一个codesandbox示例。这是演示:</p><figure class="lp lq lr ls gt lt"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="deda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其次，创建一个名为<strong class="jp ir"> <em class="mp">的文件useFetch.js: </em> </strong></p><pre class="lp lq lr ls gt mf mg mh mi aw mj bi"><span id="90fa" class="mk km iq mg b gy ml mm l mn mo">import { useState, useEffect } from "react";<br/><br/>export default function useFetch({ api, method, url, data = <strong class="mg ir">null</strong>, config = <strong class="mg ir">null</strong> }) {<br/>   const [response, setResponse] = useState(null);<br/>   const [error, setError] = useState("");<br/>   const [isLoading, setIsLoading] = useState(true);<br/><br/>   useEffect(() =&gt; {<br/>      const fetchData = async () =&gt; {<br/>         try {<br/>            api[method](url, <strong class="mg ir"><em class="mp">JSON</em></strong>.parse(config), <strong class="mg ir"><em class="mp">JSON</em></strong>.parse(data))<br/>               .then((res) =&gt; {<br/>                  setResponse(res.data);<br/>               })<br/>               .finally(() =&gt; {<br/>                  setIsLoading(false);<br/>               });<br/>         } catch (err) {<br/>            setError(err);<br/>         }<br/>      };<br/><br/>      fetchData();<br/>   }, [api, method, url, data, config]);<br/><br/>   return { response, error, isLoading };<br/>}</span></pre><p id="c3ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是在每个网络请求中避免使用setLoading的最简单方法:</p><pre class="lp lq lr ls gt mf mg mh mi aw mj bi"><span id="b483" class="mk km iq mg b gy ml mm l mn mo">import useFetch from "../hooks/useFetch";</span><span id="4fc8" class="mk km iq mg b gy mu mm l mn mo">const {response, isLoading} = useFetch({<br/>   api: <strong class="mg ir"><em class="mp">programApi</em></strong>,<br/>   method: "get",<br/>   url: "/SportsProgram/active_sport_type",<br/>   config: <strong class="mg ir"><em class="mp">JSON</em></strong>.stringify({ requireAuthentication: true }),<br/>});</span></pre><p id="009f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以在useEffect中聆听自己的回答，并随心所欲:</p><pre class="lp lq lr ls gt mf mg mh mi aw mj bi"><span id="27b1" class="mk km iq mg b gy ml mm l mn mo">useEffect(() =&gt; {<br/>   if (response !== null) {<br/>      // do more stuff if you wish<br/>   }<br/>}, [response]);</span></pre><p id="5827" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">保持它易于阅读和理解总是更好的。如果你有任何意见，以改善这个钩，请让我知道，因为这是我第一次自定义钩杆！</p><p id="d74e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是gist网址:<a class="ae me" href="https://gist.github.com/muratdogan17/f5861e82e6db5545f651617823214172" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Murat dogan 17/f 5861 e 82 e 6 db 5545 f 651617823214172</a></p><p id="ebc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">享受</p></div></div>    
</body>
</html>