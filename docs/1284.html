<html>
<head>
<title>“Currencies in Practice” — or the story of implementing a currency converter in OutSystems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“实践中的货币”——或者在外部系统中实现货币转换器的故事</h1>
<blockquote>原文：<a href="https://itnext.io/currencies-in-practice-or-the-story-of-implementing-a-currency-converter-in-outsystems-367c90723aa3?source=collection_archive---------7-----------------------#2018-08-28">https://itnext.io/currencies-in-practice-or-the-story-of-implementing-a-currency-converter-in-outsystems-367c90723aa3?source=collection_archive---------7-----------------------#2018-08-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d225c98fcbb5d5ac611dbdf81002f73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WAlLYRqr-IGiPHQZberxOg.jpeg"/></div></div></figure><p id="f2e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi kw translated"><span class="l kx ky kz bm la lb lc ld le di"> H </span> <strong class="ka ir"> ello </strong>各位！我又回来了，带来了与OutSystems平台的另一个令人惊叹的集成。这一次，我们将集成Fixer，这是一个简单的轻量级API，用于当前和历史外汇(forex)汇率。</p><p id="23c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在继续之前，我想公开感谢Andreas和所有Fixer团队，感谢他们为构建这个集成所给予的支持。谢谢您们。</strong></p><p id="7a4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，在深入研究货币、Fixer API以及如何使用它的技术细节之前，我想提出两点意见:</p><ul class=""><li id="803e" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">第一个是我被任命为<strong class="ka ir"> OutSystems MVP </strong>！我为这一成就感到骄傲，我要感谢所有人——当然还有OutSystems！—我曾经遇到过的人。没有你，这一切都不可能。</li></ul><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/abac49ccf0197bbac710d4bb4093a1bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/0*SkSCvK_TtsIzWI6f"/></div></figure><ul class=""><li id="a62e" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">第二个是保证我会尽我所能，以确保我值得被认可。我为成为这个社区的一员而自豪，你知道，分享就是关爱！</li></ul><p id="8687" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lt" href="https://armandogom.es" rel="noopener ugc nofollow" target="_blank">欢迎访问我的网站</a>——它一直在不断发展——看看我都做了些什么，更重要的是，看看我能为你做些什么。此外，感谢所有的反馈！如果你找不到你要找的东西，请随时联系我，我会尽可能地帮助你。</p><p id="6eb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我们不要再说我了，开始说你吧。或者，在这种情况下，你可以得到的东西，完全免费！</p><h1 id="c475" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">免费时间</h1><p id="f0c0" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">到目前为止，你可能已经意识到OutSystems已经被认为是一只独角兽，因为他们是一群好人，他们正在回馈开发者——就像，谁需要3.6亿美元呢？你真诚的。好吧，但这不关我的事。这是关于尼奥的。因此，你有独特的机会获得一个非常有限的手工制作的新形象。听起来很棒，对吧？你唯一需要做的就是点击下面的链接，用你的邮箱注册。博客上有更详细的说明，但你会很快掌握它的窍门。</p><div class="mx my gp gr mz na"><a href="https://www.outsystems.com/blog/posts/thanking-our-developers-first/?r=r2bL4" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">对于我们新的3.6亿美元投资，我们首先要做的事情是什么？感谢我们的…</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">没有你们，我们忠诚而专注的开发人员，我们不可能取得今天的成就。以下是我们打算如何感谢…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">www.outsystems.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jw na"/></div></div></a></div><p id="e623" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">免责声明</strong>:是的，如果你通过了这个链接，我就会晋升，我会先得到一个Neo。不过，我会贴一些它的照片。</p><p id="29ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在不太可能的情况下，你和我一样，你想知道类似这样的事情:“当他们可以把所有的钱都花在披萨和蛋糕上时，为什么还要制作活动人偶？”对此，我也有一个答案:<a class="ae lt" href="https://www.meetup.com/pt-BR/Lisbon-Outsystems-Community-Meetup/" rel="noopener ugc nofollow" target="_blank"> Meetups。加入下一个。</a></p><h1 id="90da" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">情节正精彩，当然要继续。</h1><p id="579a" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">既然我已经谈到了我自己——<strong class="ka ir">该死的自恋狂</strong>——<strong class="ka ir"/>以及你可以赢得的东西，是时候回到我们的主题了——fixer . io API的外部系统包装器。</p><p id="f735" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，货币在实践中，是吧？如果你想知道，答案是肯定的:这篇文章的标题灵感来自于我个人喜欢的一本名为<strong class="ka ir">软件</strong> <strong class="ka ir">实践中的架构</strong>的书。这是一本好书，你应该看看。这不是一篇常规的“从头到尾阅读”，而是关于质量属性和实现这些属性的策略的非常有趣的主题。如果你对软件架构感兴趣，我认为它值得一看。</p><p id="f0e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们回到主题。现在您可能已经知道，OutSystems支持多语言和多租户。但是……多币种呢？是的，OutSystems不支持多币种，至少不直接支持。<strong class="ka ir">而且，需要明确的是，我们不会为您的多种货币需求创建一个通用的解决方案</strong>。我将提出一个使用Fixer的API的可能性列表，以便支持一组场景。</p><p id="d877" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而现在，万能的问题:<strong class="ka ir">哪些场景？</strong></p><p id="ce89" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在进入场景列表之前，我想快速介绍一下这个主题，并澄清一组从现在开始将非常非常常见的术语。</p><h2 id="4102" class="np lv iq bd lw nq nr dn ma ns nt dp me kj nu nv mi kn nw nx mm kr ny nz mq oa bi translated">那么，什么是货币呢？</h2><blockquote class="ob oc od"><p id="7c04" class="jy jz oe ka b kb kc kd ke kf kg kh ki of kk kl km og ko kp kq oh ks kt ku kv ij bi translated">A <strong class="ka ir">货币</strong>(来源于中古英语:<em class="iq">curra num</em>，“流通中”，来源于拉丁语:<em class="iq"> currens，-entis </em>)，在这个词最具体的用法中，是指作为交换媒介实际使用或流通时的任何形式的货币，尤其是流通的纸币和硬币。更一般的定义是，货币是一种通用的货币体系(货币单位)，尤其是在一个国家。在这个定义下，美元、英镑、澳元、欧洲欧元和俄罗斯卢布都是货币的例子。这些不同的货币是公认的价值储存手段，并在外汇市场上进行交易，外汇市场决定了不同货币的相对价值。这种意义上的货币是由政府定义的，每种货币的接受范围都是有限的。</p></blockquote><p id="c511" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">以上摘录摘自免费百科全书<a class="ae lt" href="https://en.wikipedia.org/wiki/Currency" rel="noopener ugc nofollow" target="_blank"> Wikipedia </a>。但是，我们大多数人都很清楚货币是什么——因为我们几乎每天都在使用它——对吗？因此，相关的问题——也是绝大多数人可能不知道的问题——是:为什么一种货币的价值会变化？</p><p id="62cb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">据Investopedia称，有六个主要因素会影响一种货币的价值。同样，货币的价值不是一个绝对值，而是<strong class="ka ir">总是</strong>相对于不同货币的相对值。截至2018年8月21日，一(1)欧元相当于一美元十五美分(1.15)。<strong class="ka ir">的绝对值</strong>将永远是1——一欧元将永远是一欧元。</p><p id="d929" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些主要因素是:</p><ul class=""><li id="40a4" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">通货膨胀的差异</li><li id="6d20" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">利率差异</li><li id="a686" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">经常账户赤字</li><li id="8ece" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">国债</li><li id="d4e2" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">进出口交换比率</li><li id="d780" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">政治稳定和经济绩效</li></ul><p id="6c9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对这些因素的全面描述以及更多信息可以在下面的文章中看到:<a class="ae lt" href="https://www.investopedia.com/articles/basics/04/050704.asp" rel="noopener ugc nofollow" target="_blank">影响汇率的6个因素</a>，来自Investopedia。</p><p id="f9d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经看到了影响货币价值的因素的冰山一角，让我们在本文的剩余部分讨论一些将被广泛使用的术语。</p><ul class=""><li id="e3e2" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated"><strong class="ka ir">符号</strong>:符号是给定货币的代码。EUR是欧元的符号，而USD是美元的符号。</li><li id="8a7a" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated"><strong class="ka ir">基础</strong>:计算值所依据的基础货币/符号。如果以欧元为基础的美元价值是1.20，这意味着€1将得到1.2美元。</li><li id="a659" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated"><strong class="ka ir"> EOD </strong>:日终。在本文的上下文中，EOD值将是某一天的参考值。</li></ul><p id="4392" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还记得关于场景的终极问题吗？所以:我们将每小时检索一组符号相对于一个基数的当前值。默认情况下，我们的基础将是欧元。如果您需要另一个基地，比如说您的业务以美元为基础，我们可以:</p><p id="1a56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">a)从API中检索新值</p><p id="c831" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">b)使用公共基数计算该值。</p><p id="ecb4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就可能的选择而言，一个有潜在的成本(API限制)，另一个…没有那么多。不仅如此，我们还将通过提供一组函数来支持这两者，以在给定的时间点检索一个值(如果您在金融交易中处理多种货币，这是一件好事)，并使用基本货币C从货币A转换为货币B(通常称为交叉货币汇率)。</p><p id="a5eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不打算讨论如何获得一个API密钥，因为，嗯… <a class="ae lt" href="https://fixer.io/product" rel="noopener ugc nofollow" target="_blank">在Fixer的网站上这是非常简单的。</a>一旦有了API密匙，就可以开始集成可用的端点了。</p><p id="5171" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">现在，技术细节。</strong></p><p id="e9a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，Fixer提供了六个不同的端点:一个用于支持的符号，五个用于货币值本身。在这五个与货币相关的端点上，我们有一个用于最新值，一个用于历史值，一个用于货币转换，一个用于两个日期之间的货币波动，一个用于时间序列值。</p><p id="35e4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然前三个似乎很清楚它们的目的，但让我简单解释一下最后两个端点。仅仅为了这个例子，考虑两个日期:1月1日和1月5日。当您调用波动端点时，您将检索1月5日和1月1日的<strong class="ka ir"> EOD </strong>值之间的差异——因此，只有一个结果。如果您调用这两个日期的时间序列值，您将收到这五天之间给定符号的每日<strong class="ka ir"> EOD </strong>值——因此，有五个结果。一旦我们到达实现和响应本身，这将更容易理解。</p><p id="76a3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于可用的端点，我想在这里做一个非常重要的声明:<strong class="ka ir">并非所有端点都包括在免费层中。</strong>只有<strong class="ka ir">符号</strong>、<strong class="ka ir">最新</strong>和<strong class="ka ir">历史</strong>数据包含在自由层中，这并没有什么问题，因为我们可以使用自由端点来获取与付费端点相关的数据，只要我们在自由层本身的限制范围内这样做。这就是为什么当您查看REST集成时，您会看到两个“不同”的条目:一个名为<strong class="ka ir"> FixerFree </strong>而另一个名为<strong class="ka ir"> FixerPaid </strong>。它们每个都包含各自的端点，而BaseURL属性是相同的。</p><h1 id="3496" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">整合</h1><p id="5a67" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">如前所述，我们将实现所有六个可用的端点。所有端点的实现逻辑都非常相似:我们获得完整的请求和响应，粘贴到Service Studio中，然后它就创建了与所有结构的集成。我们将通过数据模型存储所有信息来支持这种集成。简单吧？</p><p id="eccc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯…没那么多。让我解释一下为什么，用端点这个符号。让我们对端点做一个GET请求:<a class="ae lt" href="http://data.fixer.io/api/symbols?access_key=" rel="noopener ugc nofollow" target="_blank">【http://data.fixer.io/api/symbols?access_key=】T21&lt;API KEY&gt;</a>。这是您将看到的结果:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="ak">图1 —符号端点输出</strong></figcaption></figure><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/6e60b61493a2782fbe46d7f57d27575c.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*yfQDndIigQOXXYGO2u4DMA.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图2 —生成的结构。</strong></figcaption></figure><p id="99bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看起来像是一个简单的输出，对吗？不对！当您使用OutSystems的默认功能来导入REST方法/端点时，您将得到如图2所示的结果。比如，一个结构上有168个属性。正如杰西·文图拉所说，<em class="oe">我没有时间检查一个结构的168个属性，我必须手动迭代** </em>。此外，在任何人对我说“也许<a class="ae lt" href="https://www.outsystems.com/forge/component/413/ardojson/" rel="noopener ugc nofollow" target="_blank"> ardoJSON </a>可以做到这一点”之类的话之前，我要说一次，而且只能说一次:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="ou oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="ak">图3——但这是一种不同的爱，伙计！</strong></figcaption></figure><p id="6b7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">** <a class="ae lt" href="https://www.youtube.com/watch?v=aqDwqdSF6Ec" rel="noopener ugc nofollow" target="_blank">是的，我100%确定杰西·文图拉说过这话</a>。</p><p id="c491" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，我做了什么？除了Convert之外，每个端点的输出都是纯文本。然后，我将使用一个很酷的自定义C#扩展来解析输出，并为外部系统提供一个“可伸缩”的响应版本。尽管看到了低代码平台的所有好处，但我仍然喜欢“敲打一些代码行”——灵感来自<a class="ae lt" href="https://www.youtube.com/watch?v=H29HYFu_UmA" rel="noopener ugc nofollow" target="_blank">卡洛斯·卡瓦哈尔的“把所有的肉放在烤肉上”</a>。可能这就是为什么我为接下来的日子准备了一些新的和旧的阅读材料——尽管这些书没有一本书是外部系统人员“推荐”阅读的。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ov"><img src="../Images/b43576c0babcb7b9b7c902f3c576370b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dRRV1lQvCPQiWSOmKPTqIw.jpeg"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图4 —阅读材料。是的，那些是球罐。关于最后一个，我敢肯定，我的数据结构和算法老师会感到自豪。</strong></figcaption></figure><p id="595d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为我不想让这篇文章变得太长，所以让我快速总结一下开发过程:</p><ul class=""><li id="72c0" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">我们将从Fixer中检索完整的JSON输出</li><li id="12de" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">我们将使用一个工具从JSON输出中生成一个C#类。(有趣的部分，相信我)</li><li id="c868" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">我们将使用Integration Studio来实现这些方法，这样我们就可以在外部系统中接收数据。</li></ul><p id="9fa9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不打算深究“如何将REST端点导入OutSystems”。互联网上有很多资源，事实上，这些资源太简单了，你应该自己先尝试一下。</p><p id="bb80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们已经在Service Studio中集成了端点。因此，让我们转到有趣的部分:在OutSystems扩展上处理响应。如上所述，<strong class="ka ir">我已经使用一个工具从JSON输出</strong>生成了一个C#类。如果你在c#类中搜索<em class="oe"> json，</em>你会看到的第一个结果很可能是【http://json2csharp.com】的<a class="ae lt" href="http://json2csharp.com" rel="noopener ugc nofollow" target="_blank">。虽然这完全没问题，但在底部有一个名为Quicktype的选项。我<strong class="ka ir">强烈推荐使用Quicktype </strong>。为什么？</a></p><p id="6b39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将指导您完成我的旅程，我将使用json2csharp从JSON对象生成一个C#类。对于符号端点，我们得到:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="ak">图5 — json2csharp输出。</strong></figcaption></figure><p id="8744" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看到结果了吗？我根本不是C#专家，但我想知道:如果知道键是字段本身的名称，我如何将这组元素转换成键对列表？</p><p id="1760" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lt" href="https://www.youtube.com/watch?v=FSKIoPylEkM" rel="noopener ugc nofollow" target="_blank">你好，haaaaave你见过倒影吗？对于那些不知道的人来说，反思对于程序员就像恶魔对于孩子一样。这里我可能有点夸张——除非你尝试用CLOS做元编程:在这种情况下，恶灵就像饼干怪兽一样邪恶。</a></p><p id="498e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">反思很牛逼，但也有问题。使用反射的性能成本是不可忽略的。</strong>幸运的是，使用Quicktype，我得到了这个简洁的版本:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="ak">图6 — Quicktype输出</strong></figcaption></figure><p id="4a4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">相关说明:</strong>使用Quicktype从JSON对象生成C#类供外系统使用时，请确保您选择的C#版本是V5。默认情况下，V6被选中，不会被编译。注意:在与其他MVP的聊天中，它可能与MSBuild有关。我会进一步看看，并相应地更新帖子。</p><p id="f9bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">稍微相关的注意事项</strong>:如果您使用由Quicktype生成的多个类，这些类具有共同的元素——比如一个错误结构——那么只需将这些类移动到单独的文件中。然后，您可以从生成的代码中删除它们，只要您引用了所有内容，就不会出现错误。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/bda006806d73e3162ee6ade1590d004c.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*DZRtuXI3VUe5snk8viPX4Q.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图7—延伸结构。</strong></figcaption></figure><p id="748b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根据前面的说明，我已经将<em class="oe">内部静态类转换器、公共静态类序列化</em>和<em class="oe">错误</em>类——图6中没有显示——移动到单独的文件中，最终结果类似于图7。这样做，我们将有四个类用于五个端点(这种方法不考虑Convert endpoint)，转换器、序列化和错误类(泛型)。如果你擅长数学，你会想:等等，什么？五个端点四个类？</p><p id="717c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">是的，这是因为历史汇率和最新汇率具有相同的产出结构。那么，我们能做什么呢？没错，我们可以用同样的代码。已经在保存工作了。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/5cf286c234b2c9aca2040420941fb9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OdDFVOHFL9-TgGp7.jpg"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated">图8——我们都擅长数学。来源:亚马逊网站</figcaption></figure><p id="a912" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们进入行动本身。在Integration Studio上，我们将使用图9所示的配置创建一个扩展。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oy"><img src="../Images/668ec2b529770ca0b3db696e1cd87413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTIrMTp_FIREKwvrZZsSKA.png"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图9 —扩展配置。</strong></figcaption></figure><p id="b87b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>在任何人问之前，Java版本目前还不可用。这可能会在未来发生，尽管可能性很小。</p><p id="4d44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们将定义一个动作和以下参数——如图10所示:</p><ul class=""><li id="5857" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">JSONString(输入)</li><li id="aa3e" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">成功(产出)</li><li id="5014" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">符号—密钥对列表(输出)</li><li id="5b15" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">错误-一般错误结构(输出)</li></ul><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/10b0b56930ba1a84ce4485683b1e304f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9N45y2oxFo3Kw99OyTY1w.png"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图10——打开Parse_GetSymbols的Integration Studio。</strong></figcaption></figure><p id="8a11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经定义了我们的动作并更新了我们的扩展代码，那么是时候使用我们生成的类了:</p><figure class="lp lq lr ls gt jr"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="ak">图11 — Parse_GetSymbols方法体。</strong></figcaption></figure><p id="19f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面你可以看到我们在做什么。<strong class="ka ir">这是所有动作</strong>的通用程序。彼此的不同之处在于字段的复杂性和/或数量。如果你愿意，可以随意看看这个扩展的源代码，如果你有任何问题、顾虑或建议，请告诉我。还是那句话，分享就是关爱。</p><p id="f701" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，除了变量的常规初始化，我们将JSON字符串反序列化为一个<em class="oe"> GetSymbols </em>对象(第16行),并验证请求是否成功。如果是这样，我们迭代我们的字典并创建一个<em class="oe">key pair structure Record</em>——我想知道为什么全名是<strong class="ka ir"><em class="oe">RC</em></strong><em class="oe">key pair structure</em><strong class="ka ir"><em class="oe">Record</em></strong>——既然最佳实践告诉我们以RC开始一个记录名称，我们将把它附加到列表中。</p><p id="233d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果请求不成功，我们填充我们的错误结构。简单。</p><p id="ac57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在这里补充一个个人评论:当我开始为这个组件工作时，我渴望用C#写一篇关于反射的文章，所以你会认为我是一个超级DUPERüBER c#程序员。但是这就是软件开发的酷之处:你所想的事情，它们变化得如此之快和容易(#敏捷)。朋友们，这就是我们工作的美妙之处——如果我改行做电视新闻主播，那将是我的结束语。</p><h1 id="7b2d" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">但是…我们如何使用它呢？</h1><p id="e227" class="pw-post-body-paragraph jy jz iq ka b kb ms kd ke kf mt kh ki kj mu kl km kn mv kp kq kr mw kt ku kv ij bi translated">创建一个组件并写一篇关于它的文章是没有价值的，如果你没有展示它的工作。因此，如果您还记得以前的文章，我们已经有了一个控制面板，这将是这个组件的一个很好的候选。</p><div class="mx my gp gr mz na"><a rel="noopener  ugc nofollow" target="_blank" href="/dont-worry-ma-am-you-don-t-need-to-share-your-credit-card-details-over-the-phone-or-the-story-6e785175d1a5"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">“别担心，女士，你不需要在电话里分享你的信用卡信息”——或者…</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">又见面了！今天，我们的主要课程是在用开发的web应用程序中接受信用卡支付</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">itnext.io</p></div></div><div class="nj l"><div class="pa l nl nm nn nj no jw na"/></div></div></a></div><p id="1830" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，总结一下——并创建一个场景——我们已经有了一个控制面板，显示通过我们的网关进行的最新支付。这些最新的付款可以有不同的货币，但我们的业务只使用欧元。</p><p id="3662" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在参考文章的图17(图12)中，您可以看到下面的图像:</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="ab gu cl pb"><img src="../Images/0165123c0a9b6f6405ff2fbd46d4a4fd.png" data-original-src="https://miro.medium.com/v2/format:webp/1*805oNDkCcGuwNntp57rCNA.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图12 — Adyen控制面板</strong></figcaption></figure><p id="31b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在右上角，我们有一个CardSimple，上面有过去30天的<strong class="ka ir">最高付款额。很难看出，但是我们有欧元、日元和其他货币的支付。现在让我们更改这个CardSimple，并确保显示交易发生当天的兑换值。原始值将转换成欧元。这有一个“许可”的原因，我将在后面解释。</strong></p><p id="4857" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了简单起见，我将使用一个可用的函数— CalculateConversion。对于ListRecords小部件上的每一项，我将调用函数并计算结果。功能行为如图13所示。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/7d94eb509a9f58b2f536d2d27e7de605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*PJPTW_z0eqU9qdIZkh6t_g.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图13 —计算转换函数。</strong></figcaption></figure><p id="a307" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">该函数接收以下输入参数</strong> : BaseCurrency(文本)、DestinationCurrency(文本)、Amount(货币)、Date(日期)<strong class="ka ir">和一个输出参数</strong> : Value(货币)。现在，一步一步来:</p><ul class=""><li id="0a7b" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">我们检查给定日期的货币值是否已经可用(GetConversion aggregate)。如果它存在，我们就返回值。</li><li id="59f5" class="lf lg iq ka b kb oi kf oj kj ok kn ol kr om kv lk ll lm ln bi translated">如果不存在，我们尝试进行交叉货币转换。如果这两个值对于提到的日期都可用，我们返回计算出的值。计算按以下方式进行-有意缩短元素。</li></ul><p id="145c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">金额/ (GetSourceCurrency。Value / GetDestinationCurrency。值)</strong></p><ul class=""><li id="92bc" class="lf lg iq ka b kb kc kf kg kj lh kn li kr lj kv lk ll lm ln bi translated">如果这些值不可用，我们向API执行一个请求，如果成功，将返回费率。因为我们只请求一个值，所以我们可以立即映射到输出。</li></ul><p id="6f8d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，在<strong class="ka ir"> Card </strong>小部件上的<strong class="ka ir"> ListRecords </strong>上，我们将把它添加到我们的表达式中——如图14所示。由于对转换后的金额使用了<strong class="ka ir"> FormatCurrency </strong>函数，所以有点“臃肿”。此外，由于我们使用欧元作为基数，我们不需要做任何小数位的计算。为了理解这个概念，请参考上一篇文章。</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pd"><img src="../Images/3d204e9e3db8d2949634f60b98c213aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j4RX0G-yk5CIUHGVdjuXWA.png"/></div></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图14 — ListRecords表达式。</strong></figcaption></figure><p id="0413" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们有了第一个<strong class="ka ir">格式货币</strong>，现在我们添加了文本部分<em class="oe">(EUR:XXX)，</em>，其中XXX将使用CalculateConversion函数来计算。<strong class="ka ir">只有一个重要的注意事项</strong>:看到我在调用<strong class="ka ir"> CalculateConversion </strong>函数时没有使用<strong class="ka ir"> DestinationCurrency </strong>参数了吗？这是因为我们将<strong class="ka ir"> DestinationCurrency </strong>参数映射到服务调用的基本参数。因为我们使用免费层，所以我们不能在API调用中使用base参数，默认情况下，它将是EUR。如果你至少有基本的会员资格，你可以使用它。</p><p id="35f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是最终结果——与谷歌在相应日期的价值完全吻合:</p><figure class="lp lq lr ls gt jr gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/4abcffdc69cd89813812f519d107e58a.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*NQFSaCFfabZWEojZmbx2sA.png"/></div><figcaption class="op oq gj gh gi or os bd b be z dk translated"><strong class="bd lw">图15 —用户界面上的最终结果。</strong></figcaption></figure><p id="04a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这些了，伙计们！<strong class="ka ir">该组件已经在OutSystems Forge </strong>的<a class="ae lt" href="https://www.outsystems.com/forge/component/4122/fixer-io-api/" rel="noopener ugc nofollow" target="_blank">https://www . out systems . com/Forge/component/4122/fixer-io-API/</a>上提供。</p><p id="2709" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">在结束之前，我要尝试一些新的东西</strong>。我正在研究发表赞助文章的可能性。如果您(或您的公司)有一些闲钱，并且愿意赞助任何文章或某个特定主题，请通过<a class="ae lt" href="mailto:hello@armandogom.es" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir">给我留言。而且，要明确这一点:</strong>我真的很喜欢写作和创造新的内容，所以<strong class="ka ir">我不会把钱留给自己。</strong></a></p><p id="cca1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，所有赞助文章的利润都将捐赠给慈善机构。</p><p id="7bd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">关于这方面的更多细节，请通过上面的电子邮件、<a class="ae lt" href="https://www.twitter.com/portuguesecoder" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae lt" href="https://www.linkedin.com/in/armandogomes" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我。</p><p id="252a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保重。</p><p id="bf6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">_________________________________________</p><p id="f547" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">quick type</strong>:<a class="ae lt" href="https://quicktype.io" rel="noopener ugc nofollow" target="_blank">https://quick type . io</a></p><p id="b00e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">固定器</strong>:<a class="ae lt" href="https://fixer.io/" rel="noopener ugc nofollow" target="_blank">https://fixer.io/</a></p><p id="ccf2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">fixer . io API</strong>:<a class="ae lt" href="https://www.outsystems.com/forge/component/4122/fixer-io-api/" rel="noopener ugc nofollow" target="_blank">https://www . out systems . com/forge/component/4122/fixer-io-API/</a></p></div></div>    
</body>
</html>