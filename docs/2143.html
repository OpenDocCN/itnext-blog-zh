<html>
<head>
<title>Controlled and uncontrolled component design pattern in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的受控和非受控组件设计模式</h1>
<blockquote>原文：<a href="https://itnext.io/controlled-and-uncontrolled-component-design-pattern-in-react-21e8d40e46e?source=collection_archive---------3-----------------------#2019-04-06">https://itnext.io/controlled-and-uncontrolled-component-design-pattern-in-react-21e8d40e46e?source=collection_archive---------3-----------------------#2019-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/417b79541fc0a025f7382aafb6245290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmZyPxd-Ry08TV3kNRwiWg.png"/></div></div></figure><div class=""/><h1 id="6315" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">不受控制的</h1><blockquote class="kw kx ky"><p id="2f01" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="jb"/><code class="fe ly lz ma mb b"><em class="jb">Uncontrolled</em></code><em class="jb">组件是在内部存储和维护其自身状态的组件。</em></p></blockquote><ul class=""><li id="48f6" class="mc md jb lc b ld le lh li me mf mg mh mi mj lx mk ml mm mn bi translated">一个<code class="fe ly lz ma mb b"><a class="ae mo" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank">ref</a></code>用来在你需要的时候找到它的当前值。</li><li id="70f4" class="mc md jb lc b ld mp lh mq me mr mg ms mi mt lx mk ml mm mn bi translated"><a class="ae mo" href="https://reactjs.org/docs/uncontrolled-components.html" rel="noopener ugc nofollow" target="_blank"> React </a>不推荐这种模式，但是当开发人员只关心组件的最终状态而不是中间状态时，这种模式很有用。以下是以不受控方式实施的<code class="fe ly lz ma mb b">Switch</code>的<a class="ae mo" href="https://codepen.io/n0rush/pen/RORrRa" rel="noopener ugc nofollow" target="_blank">示例</a>。</li></ul><pre class="mu mv mw mx gt my mb mz na aw nb bi"><span id="b5a3" class="nc jz jb mb b gy nd ne l nf ng">class Switch extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    // maintain its own state<br/>    this.state = {<br/>      checked: false<br/>    };<br/>  }</span><span id="d4ca" class="nc jz jb mb b gy nh ne l nf ng">  // expose state data for parent component to access<br/>  get value() {<br/>    return this.state.checked;<br/>  }</span><span id="c515" class="nc jz jb mb b gy nh ne l nf ng">  toggle = () =&gt; {<br/>    this.setState((prevState) =&gt; {<br/>       return {<br/>         checked: !prevState.checked<br/>       }<br/>    })<br/>  }</span><span id="5ca4" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    // check status is maintained in own state<br/>    const { checked } = this.state;<br/>    let classNames = ['switch'];</span><span id="c7e0" class="nc jz jb mb b gy nh ne l nf ng">    if (checked) {<br/>      classNames = [...classNames, 'checked']<br/>    }<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;button<br/>          className={classNames.join(' ')}<br/>          onClick={this.toggle}/&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="a609" class="nc jz jb mb b gy nh ne l nf ng">class Wrapper extends React.Component {</span><span id="3e1d" class="nc jz jb mb b gy nh ne l nf ng">  ref = React.createRef();</span><span id="aa80" class="nc jz jb mb b gy nh ne l nf ng">  getValue = () =&gt; {<br/>    alert(this.ref.current.value);<br/>  }</span><span id="b5b9" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    return &lt;React.Fragment&gt;<br/>      &lt;Switch ref={this.ref}/&gt;<br/>      &lt;button<br/>        onClick={this.getValue}<br/>        style={{ marginTop: 20 }}<br/>      &gt;<br/>        Switch Status<br/>      &lt;/button&gt;<br/>    &lt;/React.Fragment&gt;<br/>  }<br/>}</span><span id="59ea" class="nc jz jb mb b gy nh ne l nf ng">ReactDOM.render(<br/>  &lt;Wrapper /&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><h1 id="2e58" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">受控的</h1><blockquote class="kw kx ky"><p id="81d1" class="kz la lb lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><em class="jb">受控组件通过props获取其当前值，并通过回调通知变化。父组件通过处理回调和管理自己的状态以及将新值作为道具传递给受控组件来“控制”它。</em></p></blockquote><p id="f276" class="pw-post-body-paragraph kz la jb lc b ld le lf lg lh li lj lk me lm ln lo mg lq lr ls mi lu lv lw lx ij bi translated">以下是以受控方式实现的<code class="fe ly lz ma mb b">Switch</code>的<a class="ae mo" href="https://codepen.io/n0rush/pen/jRreVJ" rel="noopener ugc nofollow" target="_blank">示例</a>。</p><pre class="mu mv mw mx gt my mb mz na aw nb bi"><span id="4b35" class="nc jz jb mb b gy nd ne l nf ng">class Switch extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>  }</span><span id="b32c" class="nc jz jb mb b gy nh ne l nf ng">  toggle = () =&gt; {<br/>    // callback passed in from parent<br/>    const { checked, onChange } = this.props;<br/>    onChange(!checked)<br/>  }</span><span id="f438" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    // check status is maintained by props from parent component<br/>    const { checked } = this.props;<br/>    let classNames = ['switch'];</span><span id="3362" class="nc jz jb mb b gy nh ne l nf ng">    if (checked) {<br/>      classNames = [...classNames, 'checked']<br/>    }<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;button<br/>          className={classNames.join(' ')}<br/>          onClick={this.toggle}<br/>        /&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="c479" class="nc jz jb mb b gy nh ne l nf ng">class Wrapper extends React.Component {</span><span id="689d" class="nc jz jb mb b gy nh ne l nf ng">  state = {<br/>    checked: false<br/>  }</span><span id="1cbb" class="nc jz jb mb b gy nh ne l nf ng">  getValue = () =&gt; {<br/>    alert(this.state.checked);<br/>  }</span><span id="9e02" class="nc jz jb mb b gy nh ne l nf ng">  // when check status changes, maintain it in parent state<br/>  onChange = (checked) =&gt; {<br/>    this.setState({<br/>      checked<br/>    })<br/>  }</span><span id="3f33" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    return &lt;React.Fragment&gt;<br/>      &lt;Switch<br/>        checked={this.state.checked}<br/>        onChange={this.onChange}<br/>      /&gt;<br/>      &lt;button<br/>        onClick={this.getValue}<br/>        style={{ marginTop: 20 }}<br/>      &gt;<br/>        Switch Status<br/>      &lt;/button&gt;<br/>    &lt;/React.Fragment&gt;<br/>  }<br/>}</span><span id="d245" class="nc jz jb mb b gy nh ne l nf ng">ReactDOM.render(<br/>  &lt;Wrapper /&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><h1 id="cee9" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">混合的</h1><p id="0794" class="pw-post-body-paragraph kz la jb lc b ld ni lf lg lh nj lj lk me nk ln lo mg nl lr ls mi nm lv lw lx ij bi translated">一个<code class="fe ly lz ma mb b">Mixed</code>组件允许以<code class="fe ly lz ma mb b">Uncontrolled</code>或<code class="fe ly lz ma mb b">Controlled</code>方式使用。它接受其初始值作为一个道具，并将其置于状态。然后，它通过<a class="ae mo" href="https://reactjs.org/docs/react-component.html" rel="noopener ugc nofollow" target="_blank">组件生命周期</a>对props更改做出反应，以将状态更新与props同步。</p><p id="3d56" class="pw-post-body-paragraph kz la jb lc b ld le lf lg lh li lj lk me lm ln lo mg lq lr ls mi lu lv lw lx ij bi translated"><a class="ae mo" href="https://codepen.io/n0rush/pen/NmrOao" rel="noopener ugc nofollow" target="_blank">混合模式下的切换示例</a></p><pre class="mu mv mw mx gt my mb mz na aw nb bi"><span id="32ae" class="nc jz jb mb b gy nd ne l nf ng">class Switch extends React.Component {<br/>  constructor(props) {<br/>    super(props);<br/>    // maintain check status in own state<br/>    this.state = {<br/>      checked: props.checked || false<br/>    };<br/>  }</span><span id="6cb3" class="nc jz jb mb b gy nh ne l nf ng">  get value() {<br/>    return this.state.checked;<br/>  }</span><span id="50e7" class="nc jz jb mb b gy nh ne l nf ng">  static getDerivedStateFromProps(nextProps, currentState) {<br/>    // react to props change and sync state accordingly<br/>    // only in controlled mode<br/>    if(nextProps.hasOwnProperty('checked') &amp;&amp;<br/>      (nextProps.checked != currentState.checked)) {<br/>      return {<br/>        checked: nextProps.checked<br/>      }<br/>    }<br/>    return null;<br/>  }</span><span id="7b70" class="nc jz jb mb b gy nh ne l nf ng">  toggle = () =&gt; {<br/>    const { onChange, checked } = this.props;<br/>    const { checked: checkedInState } = this.state<br/>    if (!this.props.hasOwnProperty('checked')) {<br/>      // no checked prop, uncontrolled<br/>      this.setState({<br/>        checked: !checkedInState<br/>      })<br/>    }<br/>    onChange &amp;&amp; onChange(!checkedInState)<br/>  }</span><span id="e02b" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    const { checked } = this.state;<br/>    let classNames = ['switch'];</span><span id="97ce" class="nc jz jb mb b gy nh ne l nf ng">    if (checked) {<br/>      classNames = [...classNames, 'checked']<br/>    }<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;button<br/>          className={classNames.join(' ')}<br/>          onClick={this.toggle}/&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="59d9" class="nc jz jb mb b gy nh ne l nf ng">class Wrapper extends React.Component {</span><span id="5d9d" class="nc jz jb mb b gy nh ne l nf ng">  ref = React.createRef();</span><span id="9cea" class="nc jz jb mb b gy nh ne l nf ng">  state = {<br/>    controlledChecked: false,<br/>  }</span><span id="6908" class="nc jz jb mb b gy nh ne l nf ng">  controlledOnChange = (checked) =&gt; {<br/>    this.setState({<br/>      controlledChecked: checked;<br/>    })<br/>  }</span><span id="3dc4" class="nc jz jb mb b gy nh ne l nf ng">  getUncontrolledValue = () =&gt; {<br/>    alert(this.ref.current.value);<br/>  }</span><span id="e396" class="nc jz jb mb b gy nh ne l nf ng">  getControlledValue = () =&gt; {<br/>    alert(this.state.controlledCheck);<br/>  }</span><span id="55ce" class="nc jz jb mb b gy nh ne l nf ng">  render() {<br/>    return &lt;React.Fragment&gt;<br/>      &lt;div&gt;<br/>        Uncontrolled: &lt;Switch ref={this.ref}/&gt;<br/>        &lt;button<br/>          onClick={this.getUncontrolledValue}<br/>          style={{marginTop: 20}}<br/>        &gt;<br/>          Uncontrolled Switch Status <br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>      &lt;hr/&gt;<br/>      &lt;div&gt;<br/>        Controlled:<br/>        &lt;Switch<br/>          checked={this.state.controlledChecked}<br/>          onChange={this.controlledOnChange}<br/>        /&gt;<br/>        &lt;button<br/>          onClick={this.getControlledValue}<br/>          style={{marginTop: 20}}<br/>        &gt;<br/>          Controlled Switch Status<br/>        &lt;/button&gt;<br/>      &lt;/div&gt;<br/>      &lt;hr/&gt;<br/>    &lt;/React.Fragment&gt;<br/>  }<br/>}</span><span id="ced3" class="nc jz jb mb b gy nh ne l nf ng">ReactDOM.render(<br/>  &lt;Wrapper /&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><h1 id="2014" class="jy jz jb bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">通知；注意</h1><ul class=""><li id="c4ec" class="mc md jb lc b ld ni lh nj me nn mg no mi np lx mk ml mm mn bi translated">如果您想关注我的博客系列的最新消息/文章，请<a class="ae mo" href="https://github.com/n0ruSh/blogs/" rel="noopener ugc nofollow" target="_blank">【观看】</a>订阅。</li></ul></div></div>    
</body>
</html>