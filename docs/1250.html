<html>
<head>
<title>An OAuth 2.0 introduction for beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初学者的OAuth 2.0简介</h1>
<blockquote>原文：<a href="https://itnext.io/an-oauth-2-0-introduction-for-beginners-6e386b19f7a9?source=collection_archive---------0-----------------------#2018-08-22">https://itnext.io/an-oauth-2-0-introduction-for-beginners-6e386b19f7a9?source=collection_archive---------0-----------------------#2018-08-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="210d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">OAuth 2.0如何工作以及如何选择正确的流程</h2></div><h2 id="b14d" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">TL；DR；</h2><p id="5a36" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">你真差劲！你只想要密码。</p><p id="a728" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">但是，在文章的最后，你会发现一份问卷，可以帮助你选择你需要的流量。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="970f" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">本文并不想成为OAuth 2的最终指南，而是对组成这个框架的流程的介绍。您将看到四个基本流程和一些实际场景，以理解所涉及的参与者和详细的行为。目标是能够选择最适合您需求的流程。</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/1dd838a3bb1ccbea83e4556f7606a723.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*5Y7z7SnRdu0V2NLXgv-sUA.gif"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">应该选择哪个Oauth 2流？</figcaption></figure><p id="c454" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">为了尽可能简单，请专家们原谅，我们可以说有四个不同的版本。或者更准确地说，四种不同的流动。OAuth 2是这些流量的总和。不一定要全部实现，而是只实现你需要的那些。</p><p id="09aa" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">目标始终保持不变:<strong class="ld ir">获得一个access_token </strong>并使用它来访问受保护的资源。这四种模式是:</p><ul class=""><li id="a4d8" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">授权码授予:</em> </strong>发出一个<em class="nb">码</em>，用于获取<em class="nb"> access_token </em>。这个<em class="nb">代码</em>在用户登录后被释放给一个前端应用程序(在浏览器上)。取而代之的是，access_token由服务器端发布，使用其密码和获得的<em class="nb">代码</em>对客户端进行认证。</li><li id="a6b1" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">隐式授予:</em> </strong>用户登录后，立即发出access_token。</li><li id="a914" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">客户端凭证授予:</em></strong>‘<em class="nb">access _ token</em>是在服务器上颁发的，只对客户端进行认证，不对用户进行认证。</li><li id="8c55" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">密码授权:</em></strong>access _ token会立即发出一个包含所有登录信息的请求:用户名、用户密码、客户端id和客户端密码。它可能看起来更容易实现，但它有一些复杂性。</li></ul><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/5cf5957a4bdc8c81182030d7c79cfcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wWs1vAAUFMPhFtp0iFGpEg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">OAuth 2流程的要求</figcaption></figure><h1 id="f819" class="nm kg iq bd kh nn no np kk nq nr ns kn jw nt jx kr jz nu ka kv kc nv kd kz nw bi translated">授权码授予</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nx"><img src="../Images/f5ab1f3c4b95d31bf5219b600799f485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*anmFPvD_EVMiZOo-W76qyA.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">授权代码流程，如下所述</figcaption></figure><p id="fb0e" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这是最完整最复杂的流程。登录过程分为两个阶段，这确保了更高的安全性。</p><h1 id="09d4" class="nm kg iq bd kh nn no np kk nq nr ns kn jw nt jx kr jz nu ka kv kc nv kd kz nw bi translated">参与的演员</h1><ul class=""><li id="1549" class="ms mt iq ld b le lf lh li ko ny ks nz kw oa lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">用户</em> </strong>:希望被认证的人，访问受保护的信息。</li><li id="cc78" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">客户端App </em> </strong>:在这个流程中，客户端通常是web应用。应用程序必须同时具有前端和后端，稍后我们将看到为什么。这意味着一个纯粹的前端应用程序(Javascript，React，Angular)不能实现这个流，但是可以使用<em class="nb">隐式授权</em>的那个。</li><li id="7095" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">授权服务器</em> </strong>:是执行认证和授权的组件，它处理登录请求、用户认证、令牌生成和安全验证。</li><li id="3a4b" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">资源服务器</em> </strong>:它公开资源，因为它们可能是REST API。<em class="nb">客户端App </em>获得<em class="nb"> access_token </em>后，将使用它调用<em class="nb">资源服务器</em>。授权服务器和资源服务器的区别之一是，第一个服务器“只”处理认证和授权，第二个服务器“只”提供内容(资源)。这种划分可能会产生一些混乱:重要的是要记住这是一个逻辑差异，而不是一个实现规则。</li></ul><h1 id="ae51" class="nm kg iq bd kh nn no np kk nq nr ns kn jw nt jx kr jz nu ka kv kc nv kd kz nw bi translated">流动</h1><p id="4f27" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我们来详细看看<em class="nb">授权码授予</em>流程。</p><h2 id="949f" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">1.用户想要登录</h2><p id="96ea" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">这个流的经典场景在用户浏览器中播放。用户将点击“使用OAuth登录”按钮，客户端将生成并向<em class="nb">授权服务器</em>发送登录请求。</p><h2 id="060d" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">2.用户被重定向到授权服务器</h2><p id="0ad3" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">客户端为<em class="nb">授权服务器</em>生成一个登录请求。请求将以<code class="fe ob oc od oe b">HTTP Redirect</code>的形式发送，信息将作为<code class="fe ob oc od oe b">GET</code>参数发送。</p><pre class="mh mi mj mk gt of oe og oh aw oi bi"><span id="50fb" class="kf kg iq oe b gy oj ok l ol om">GET /token</span><span id="6564" class="kf kg iq oe b gy on ok l ol om"><em class="nb">Location: </em><a class="ae oo" href="https://the-authorization-server/token?client_id=[the_client_id]&amp;redirect_uri=[a" rel="noopener ugc nofollow" target="_blank"><em class="nb">https://the-authorization-server/token?client_id=[the_client_id]&amp;redirect_uri=[a</em></a><em class="nb"> redirect uri]&amp;response_type=code&amp;scope=[list of scopes]&amp;state=[some client parameter]</em></span></pre><p id="d632" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这些参数如下:</p><ul class=""><li id="cfc9" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> client_id </em> </strong>:标识调用应用</li><li id="0d09" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> redirect_uri </em> </strong>:用户登录后，<em class="nb">授权服务器</em>将<em class="nb">授权码</em>发送(通过重定向)到的URL。</li><li id="224a" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"><em class="nb">response _ type</em></strong>:标识<em class="nb">授权服务器将返回</em>的响应类型。值<code class="fe ob oc od oe b">code</code>通常在<em class="nb">授权码</em>流程中。</li><li id="56d2" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">范围</em> </strong>:应用程序询问用户的许可列表。比如:<em class="nb"> read_email </em>，<em class="nb"> write_post </em>。将要求用户授予这些许可。当客户端将访问<em class="nb">资源服务器</em>时，这将非常有用。这将决定是否允许或拒绝访问。例如，一个客户端，用脸书登录，询问<code class="fe ob oc od oe b">email</code>范围。如果客户端(一旦获得令牌)调用需要<code class="fe ob oc od oe b">friend_list</code>作用域的<code class="fe ob oc od oe b">/{user-id}/friendlists</code> API，将会获得拒绝访问错误。</li><li id="e303" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">状态</em> </strong>:该可选参数在登录过程结束后，将原样返回给客户端。它可用于检索客户端应用程序上的信息，例如关于用户会话的信息。</li></ul><h2 id="e5ae" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">3.请求验证</h2><p id="4ff7" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">L' <em class="nb">授权服务器</em>必须验证所有请求参数:</p><ul class=""><li id="0ba0" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> client_id </em> </strong>:是否存在具有该id的客户端？是否允许客户端执行此请求？</li><li id="3524" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> redirect_uri </em> </strong>:客户端可以使用这个重定向uri吗？这个重定向URI与这个客户有关吗？</li><li id="3eb7" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> response_type </em> </strong>:是否允许客户端使用该响应类型？</li><li id="ca85" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">范围</em> </strong>:是否允许客户使用这些授权？</li></ul><p id="afe4" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">为了执行这些验证，<em class="nb">授权服务器</em>必须预先注册所有将要访问的客户端。客户机的加入和维护超出了OAuth的范围。</p><h2 id="5f05" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">4.登录表单</h2><p id="8e64" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><em class="nb">授权服务器</em>显示登录表单，用户必须输入用户名和密码才能登录(图中的<em class="nb">步骤5)。</em></p><p id="c3d3" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">在验证数据后(图中的<em class="nb">步骤6</em>)<em class="nb">授权服务器</em>向用户询问<em class="nb">范围中指定的同意。</em>用户将决定授予或不授予一个或多个范围。相反的情况下，客户会采取不同的行动。例如，它可以限制或禁止应用程序的使用。</p><h2 id="851c" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">7.使用authorization_code重定向到客户端</h2><p id="ce89" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated"><em class="nb">授权服务器</em>生成一个授权码(<em class="nb"> authorization_code </em>)并发送给客户端，发送给请求中指定的URI。</p><p id="2d32" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">所有这些操作都发生在客户端，在浏览器(或移动应用程序)上，接下来的步骤客户端必须使用后端。</p><blockquote class="op oq or"><p id="7a1b" class="lb lc nb ld b le lu jr lg lh lv ju lj os lw ll lm ot lx lo lp ou ly lr ls lt ij bi translated">在我看来，这是在选择哪个OAuth 2流最适合您的需求时要考虑的一个方面。</p></blockquote><h2 id="a436" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">8和9。授权码验证</h2><p id="6623" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">现在，客户端必须调用<em class="nb">授权服务器</em>来验证接收到的代码。要执行此操作，它将通过:</p><ul class=""><li id="85fd" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">待验证的<strong class="ld ir"> <em class="nb">授权_代码</em> </strong>。</li><li id="99bd" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb"> client_id </em> </strong>:这是必需的，与<em class="nb"> client_secret、</em>一起使用，以确保请求来自该客户端，并且令牌不会在您处于前端时被“窃取”。</li><li id="55ae" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"><em class="nb">client _ secret</em></strong>是客户端密码，必须保存在安全的地方，这就是为什么你需要一个后端。</li></ul><p id="810d" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><em class="nb">授权服务器</em>执行所有上述验证，检查<em class="nb">授权_代码</em>是否完整、未被更改、未过期并针对该特定客户端发布。</p><h2 id="f607" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">10.客户端接收访问令牌</h2><p id="a412" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">A <em class="nb">授权服务器</em>创建一个<strong class="ld ir"> <em class="nb">访问令牌</em> </strong>并返回给客户端。有许多类型的令牌，它们有到期日期，并且可以刷新。通常，与令牌一起返回的还有更多信息:</p><ul class=""><li id="169b" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated"><em class="nb">令牌_类型:</em>其中最著名的是<em class="nb">持有者</em>，意思是:授予此令牌持有者访问权限。<a class="ae oo" href="https://tools.ietf.org/id/draft-ietf-oauth-v2-http-mac-05.html" rel="noopener ugc nofollow" target="_blank"> mac </a>是另一种类型。</li><li id="ddc9" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><em class="nb"> expires_in </em>:令牌的持续时间</li><li id="37c7" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><em class="nb"> refresh_token </em>:另一个令牌，用于在<em class="nb"> access_token </em>到期时更新。</li></ul><h2 id="deb2" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">11.客户端使用access_token。</h2><p id="3f56" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">既然客户端已经获得了<em class="nb"> access_token </em>，它就可以使用它向<em class="nb">资源服务器</em>认证自己。</p><p id="fc9f" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><em class="nb">资源服务器</em>是一个通用组件，可以服务于许多不同类型的资源:<em class="nb"> REST API、SOAP服务、网页</em>等……根据资源类型，发送<em class="nb"> access_token </em>的方法可以改变。针对REST API最常见的发送方式是使用HTTP头:<strong class="ld ir"> <em class="nb">授权</em> </strong>，将<em class="nb"> token_type </em>与<em class="nb"> access_token </em>串联起来。示例:</p><pre class="mh mi mj mk gt of oe og oh aw oi bi"><span id="33ab" class="kf kg iq oe b gy oj ok l ol om">Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ</span></pre><h2 id="4347" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">12和13。令牌验证</h2><p id="51be" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">当资源服务器收到请求时，必须检查令牌的存在和完整性。</p><p id="ee57" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">令牌验证，尤其是基于其类型的验证，可以通过多种方式完成。在某些情况下<em class="nb">资源服务器</em>可以验证它，在另一些情况下必须调用<em class="nb">授权服务器</em>。</p><p id="abd3" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">在某些情况下，这两个组件可能是同一个应用程序，这是透明的，对客户端来说并不重要。如果您需要实现OAuth服务器，那么如何验证令牌的选择将根据您的架构和您决定使用的令牌类型而有所不同。</p><h2 id="c268" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">14和15。访问和显示受保护的资源。</h2><p id="8a16" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">一旦资源服务器成功验证了令牌，它就会将资源返回给客户端，这样就可以向用户显示资源。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="0185" class="nm kg iq bd kh nn ov np kk nq ow ns kn jw ox jx kr jz oy ka kv kc oz kd kz nw bi translated">隐式授权流</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pa"><img src="../Images/46000bc5a65f9c8a17537f74876d80ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHqzb0tGtxGw68MIP3oBaw.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">此图显示了OAuth 2.0隐式授权流</figcaption></figure><p id="955a" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这个流程与<em class="nb">认证码</em>非常相似，但是<em class="nb"> access_token </em> <strong class="ld ir">是在用户登录</strong>后立即以<em class="nb">隐式</em>的方式返回给客户端。您在单页面应用程序和纯Javascript应用程序中使用这个流程，在这些应用程序中，不可能对<em class="nb"> client_secret </em>保密。涉及的演员和上一个流程一样。</p><p id="49c8" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">第一个区别是在初始重定向到<em class="nb">授权服务器时，</em>参数<em class="nb"> response_type </em>的值是<code class="fe ob oc od oe b">token</code>而不是<code class="fe ob oc od oe b">code</code>。这意味着来自服务器的响应类型将(立即)是<em class="nb">访问_令牌</em>，而不是<em class="nb">授权_代码</em>。</p><p id="c5af" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这样，您将为客户端少执行一个步骤，但也不太安全，因为整个流程是在浏览器上执行的(一般来说是在<em class="nb">用户代理</em>上执行的)，包括令牌。在<em class="nb">授权代码</em>流中，令牌来自服务器到服务器的调用，因此拦截或操纵它更加困难。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="c3c3" class="nm kg iq bd kh nn ov np kk nq ow ns kn jw ox jx kr jz oy ka kv kc oz kd kz nw bi translated">客户端凭据</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pb"><img src="../Images/df0c8a866f44340641a1c31c7200bb6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-ubkjTKTSVRxIBTxK4MgQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">客户端凭据授予流程</figcaption></figure><p id="a716" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">上面提到的流程之间的主要区别是，在这个流程中没有用户交互。应用程序直接执行身份验证请求。</p><p id="b401" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这意味着应用程序不能代表用户做任何动作，而只能代表它自己。</p><p id="4411" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这个流程不是发生在浏览器上，而是发生在服务器上。没有重定向，但是执行了一个<code class="fe ob oc od oe b">HTTP POST</code>调用，请求的参数是:</p><ul class=""><li id="c1fb" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">客户端id</li><li id="46ae" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">客户端_机密</li><li id="1379" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">授予_类型:<code class="fe ob oc od oe b">client_credentials</code></li></ul><pre class="mh mi mj mk gt of oe og oh aw oi bi"><span id="c44e" class="kf kg iq oe b gy oj ok l ol om">POST /token</span><span id="5256" class="kf kg iq oe b gy on ok l ol om">&amp;client_id=my-fancy-client-application<br/>&amp;client_secret=xxxxxxx<br/>&amp;grant_type=client_credentials</span></pre><p id="f64e" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这个请求的响应是<em class="nb"> access_token </em>，它可以在<em class="nb">资源服务器</em>上使用。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="af81" class="nm kg iq bd kh nn ov np kk nq ow ns kn jw ox jx kr jz oy ka kv kc oz kd kz nw bi translated">密码授权流程</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pc"><img src="../Images/104c8d27eb7def62e55fcbdedc3e2f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wkgiXdBnGof02eMYyqzWiQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">密码授权流程</figcaption></figure><p id="20d6" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">在我看来，这个流程的主要概念是<strong class="ld ir">用户在客户端应用程序</strong>中输入他们的用户名和密码，而不是在<em class="nb">授权服务器</em>中。值得注意的是，凭证<em class="nb"/>属于<em class="nb">授权服务器，</em>不属于客户端，</p><p id="9989" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这个事实意味着用户必须完全信任客户端应用程序，才能插入他们的<em class="nb">授权服务器</em>凭证。为了更好地理解这一点，假设您创建了一个应用程序，用户使用脸书登录，但是用户在该应用程序上插入他们的(脸书)用户名和密码。作为用户，你会这样做吗？</p><p id="d8aa" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">您必须确保该应用程序是绝对可信的，例如，不会保存或修改您的脸书密码。</p><p id="6196" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">如果我没记错的话，Spotify有这个功能，大概用的就是这个OAuth 2流。我记得我在Spotify上直接用脸书的凭证登录过。</p><p id="19dd" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">一旦用户名和用户密码在前端被收集，它们就被发送到应用程序后端，应用程序后端对<em class="nb">授权服务器</em>执行一个<code class="fe ob oc od oe b">HTTP POST</code>。这一请求的参数是:</p><ul class=""><li id="1094" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated"><strong class="ld ir"><em class="nb">grant _ type</em></strong>:<code class="fe ob oc od oe b">password</code></li><li id="c326" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">用户的用户名</em> </strong></li><li id="cafe" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">用户的密码</em> </strong></li><li id="0d66" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">客户端_id </em> </strong></li><li id="f956" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated"><strong class="ld ir"> <em class="nb">客户端_秘密</em> </strong></li></ul><pre class="mh mi mj mk gt of oe og oh aw oi bi"><span id="66a0" class="kf kg iq oe b gy oj ok l ol om">POST /token</span><span id="b4f2" class="kf kg iq oe b gy on ok l ol om">grant_type=<strong class="oe ir">password</strong><br/>&amp;username=username@authorization-server.com<br/>&amp;password=TheUserPassword<br/>&amp;client_id=my-fancy-client-app<br/>&amp;client_secret=xxxxxxx</span></pre><p id="4590" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><em class="nb">授权服务器</em>在验证所有凭证后，返回l’<em class="nb">访问令牌</em>。</p><p id="0d03" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">对于这个流，你既需要前端，也需要后端。</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="5fcd" class="nm kg iq bd kh nn ov np kk nq ow ns kn jw ox jx kr jz oy ka kv kc oz kd kz nw bi translated">OAuth 2的实施</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pd"><img src="../Images/4cdfb64714dae32967dde08a057c9352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0-FRkCQ1qTrMe8eo"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">照片由<a class="ae oo" href="https://unsplash.com/@fancycrave?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fancycrave </a>在<a class="ae oo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="428b" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">要实现OAuth 2，您必须开发:</p><ul class=""><li id="7423" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">客户端:如果你想使用一个<em class="nb">授权服务器</em>服务</li><li id="f258" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">服务器:如果您想要公开身份验证机制</li></ul><h2 id="b59d" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">客户端</h2><p id="d953" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">您必须再次记住，要实现一些OAuth流，您需要使用客户端密码，并且必须将密码保存在一个安全的地方。所以你可能需要一个服务器。</p><p id="9ac7" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">这意味着如果没有服务器，就无法实现某些流。不需要服务器的应用程序是单页应用程序和在用户设备上运行的应用程序:移动和桌面应用程序。您可以通过创建一个专用的服务器或后端来执行OAuth服务器调用，或者通过使用一些crypt机制来绕过这个问题。</p><h2 id="5370" class="kf kg iq bd kh ki kj dn kk kl km dp kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">服务器端</h2><p id="290b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">许多语言中有许多实现OAuth的框架。对于暴露所需端点的部分，这使得生活变得稍微容易一些；尤其是所有需要的验证。但我很少找到“交钥匙”解决方案。</p><p id="6c11" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">一件困难的事情是为客户提供入门和管理平台。只要想想许多现有的<code class="fe ob oc od oe b">developers.[preferred-social-network].com</code>就知道它们是复杂的应用程序。</p><p id="35d7" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">您还必须注意<em class="nb">作用域</em>和权限，它们的管理一点也不平庸，尤其是在资源保护阶段。</p><p id="032a" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">另一个有趣的地方是令牌管理。需要使用数据库来保证完整的生命周期:</p><ul class=""><li id="0d67" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">释放；排放；发布</li><li id="7f68" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">更新</li><li id="a521" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">呼气</li><li id="1421" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">取消</li></ul><h1 id="06c4" class="nm kg iq bd kh nn no np kk nq nr ns kn jw nt jx kr jz nu ka kv kc nv kd kz nw bi translated">我该选择哪个流量？</h1><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pe"><img src="../Images/c550a7444e73f6aa78fc0a08dbcc3140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqpjQ8n1SSGKXwQzY1CnmQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">回答这些问题，你就会发现哪个最适合你。</figcaption></figure><p id="1c9e" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">正确流程的选择取决于许多因素，请回答这些问题，了解哪种流程最适合您。</p><blockquote class="op oq or"><p id="7b04" class="lb lc nb ld b le lu jr lg lh lv ju lj os lw ll lm ot lx lo lp ou ly lr ls lt ij bi translated">你能在一个安全和秘密的地方维护客户秘密吗？</p></blockquote><ul class=""><li id="f4e7" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">是:下一个问题</li><li id="78a9" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">否:<strong class="ld ir"> <em class="nb">隐式授予</em> </strong></li></ul><blockquote class="op oq or"><p id="aae1" class="lb lc nb ld b le lu jr lg lh lv ju lj os lw ll lm ot lx lo lp ou ly lr ls lt ij bi translated">您的应用程序是Web应用程序吗？</p></blockquote><ul class=""><li id="2e4c" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">是:回答下一个问题</li><li id="0128" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">否:<strong class="ld ir"> <em class="nb">客户凭证授予</em> </strong></li></ul><blockquote class="op oq or"><p id="6372" class="lb lc nb ld b le lu jr lg lh lv ju lj os lw ll lm ot lx lo lp ou ly lr ls lt ij bi translated">你的用户足够信任你在你的网站上插入他们的凭证(用户名和密码)吗？例如:用户会在你的网站上输入他们的脸书密码吗？</p></blockquote><ul class=""><li id="ab11" class="ms mt iq ld b le lu lh lv ko mu ks mv kw mw lt mx my mz na bi translated">是:<strong class="ld ir"> <em class="nb">密码授予</em> </strong></li><li id="4227" class="ms mt iq ld b le nc lh nd ko ne ks nf kw ng lt mx my mz na bi translated">否:<strong class="ld ir"> <em class="nb">授权码授予</em> </strong></li></ul><h1 id="25a3" class="nm kg iq bd kh nn no np kk nq nr ns kn jw nt jx kr jz nu ka kv kc nv kd kz nw bi translated">结论</h1><p id="085b" class="pw-post-body-paragraph lb lc iq ld b le lf jr lg lh li ju lj ko lk ll lm ks ln lo lp kw lq lr ls lt ij bi translated">我希望OAuth的世界更加清晰，现在您已经阅读了这篇文章，我的目标是探索这个协议的基础。如果你有任何意见或建议，欢迎在这里留下。</p><p id="cd89" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated">恭喜你！！😎你坚持到了最后。如果你喜欢👌这篇文章，点击下面按钮👏。这对我意义重大，也有助于其他人了解这个故事。</p><p id="9f74" class="pw-post-body-paragraph lb lc iq ld b le lu jr lg lh lv ju lj ko lw ll lm ks lx lo lp kw ly lr ls lt ij bi translated"><em class="nb">更帖由</em> <a class="ae oo" href="https://medium.com/@spyna" rel="noopener"> <em class="nb"> spyna </em> </a> <em class="nb">。</em></p><div class="pf pg gp gr ph pi"><a href="https://medium.com/swlh/react-global-state-with-hooks-f163e49f90f9" rel="noopener follow" target="_blank"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd ir gy z fp pn fr fs po fu fw ip bi translated">*用钩子反应全局状态</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">使用钩子管理React应用程序全局状态的解决方案。</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">medium.com</p></div></div><div class="pr l"><div class="ps l pt pu pv pr pw mm pi"/></div></div></a></div><div class="pf pg gp gr ph pi"><a href="https://medium.com/@spyna/the-truth-about-amazon-job-interview-b940a2190585" rel="noopener follow" target="_blank"><div class="pj ab fo"><div class="pk ab pl cl cj pm"><h2 class="bd ir gy z fp pn fr fs po fu fw ip bi translated">*如何在亚马逊找到工作</h2><div class="pp l"><h3 class="bd b gy z fp pn fr fs po fu fw dk translated">我们听说了很多关于亚马逊招聘流程的故事，有些是真的，有些不是。我想分享我的…</h3></div><div class="pq l"><p class="bd b dl z fp pn fr fs po fu fw dk translated">medium.com</p></div></div><div class="pr l"><div class="px l pt pu pv pr pw mm pi"/></div></div></a></div></div></div>    
</body>
</html>