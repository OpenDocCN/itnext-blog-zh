<html>
<head>
<title>PowerShell File Trust without digital certificates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">没有数字证书的PowerShell文件信任</h1>
<blockquote>原文：<a href="https://itnext.io/powershell-file-trust-without-digital-certificates-7f435a558824?source=collection_archive---------5-----------------------#2019-10-28">https://itnext.io/powershell-file-trust-without-digital-certificates-7f435a558824?source=collection_archive---------5-----------------------#2019-10-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d8ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">code公证人允许信任，不信任或不支持任何文件，脚本或文件在您的系统上。数字证书只对脚本有帮助，需要和文件一起传输。在真实的场景中，您的工作流不仅仅由脚本组成，您通常还需要配置文件或其他文档来使用。</p><p id="f6fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客文章介绍了code公证人PowerShell存储库，它是一些体面且易于使用的PowerShell集成的家园:</p><ul class=""><li id="6813" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">根据您存储文件的目录，用您的身份和特定信任级别公证文件</li><li id="b178" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">在运行或使用文件或脚本之前，请对它们进行鉴定</li></ul><h1 id="c2e6" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">PowerShell文件信任看门狗</h1><p id="b2cd" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">让我们从code公证人PowerShell看门狗开始，它监听给定目录中的文件创建事件，并使用您的身份公证这些文件。code公证人可以用来代替数字证书。要获得您的身份，只需在此处获得您的免费帐户:</p><p id="99b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用案例:</p><ul class=""><li id="9cd0" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">不变地公证给定目录中的所有文件，即生产、配置文件或文档的PowerShell脚本</li><li id="de40" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">通过更改脚本以监视每个文件夹并在公证时添加自定义属性，创建测试、登台和生产文件夹工作流</li><li id="b376" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">创建信任、不信任、不支持工作流，方法是更改脚本以监视每个文件夹，并在文件移动到定义的文件夹时公证、不信任或不支持文件</li></ul><h1 id="594b" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">准备</h1><p id="b3ba" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">请确保安装code公证人vcn命令，该命令可在以下位置找到:</p><p id="6ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae mc" href="https://github.com/vchain-us/vcn/releases/latest" rel="noopener ugc nofollow" target="_blank">https://github.com/vchain-us/vcn/releases/latest</a></p><p id="74d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以简单地使用适用于Microsoft Windows的vcn安装程序，或者下载vcn可执行文件并将其存储在本地。需要在脚本中配置vcn.exe的位置。</p><p id="4b2a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想完全自动化看门狗，您需要设置一些环境变量。为此，只需使用Win+R快捷方式运行sysdm.cpl:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/863778b3b08f835f7aa44821461b4a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nLiMJZ5e4zxvOkM2.png"/></div></div></figure><ul class=""><li id="b5a9" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">VCN _用户</li><li id="295c" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">VCN _密码</li><li id="4606" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">VCN _公证_密码</li></ul><p id="fbdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于支持的环境变量的更多信息可以在这里找到:【https://docs.codenotary.io/vcn/user-guide/environments.html T2】</p><h1 id="cc05" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">观察单个目录</h1><p id="fbc5" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">监视单个目录非常简单，只需更改$vcnpath，$watcher.path，如果您还想检查子目录的话。</p><pre class="me mf mg mh gt mp mq mr ms aw mt bi"><span id="651d" class="mu la iq mq b gy mv mw l mx my">### Set vcn binary path - please download vcn here: https://github.com/vchain-us/vcn/releases/latest<br/>   $vcnpath = """$env:programfiles\codenotary\vcn.exe"""<br/><br/>### Set target directory and file types to watch for changes and if you want to include subdirectories<br/>   $watcher = New-Object System.IO.FileSystemWatcher<br/>	 $watcher.Path = "C:\Users\user\Documents\Notarize"<br/>   $watcher.IncludeSubdirectories = $true<br/>   $watcher.EnableRaisingEvents = $true  <br/><br/>### Define notarization when files are detected<br/>   $action = { $path = $Event.SourceEventArgs.FullPath<br/>             $changeType = $Event.SourceEventArgs.ChangeType<br/>	 $param = " n " + """$Path""" + " --attr PSEvent=True"<br/>	 $command = $vcnpath + "$param"<br/>			iex "&amp; $command"<br/>           $logline = "Notarized $(Get-Date), $changeType, $path"<br/>           write-host $logline<br/>		  Add-content ($watcher.Path + "\codenotary.log") -value $logline<br/>              }    <br/>### DECIDE WHICH EVENTS SHOULD BE WATCHED <br/>   Register-ObjectEvent $watcher "Created" -Action $action<br/>	<br/>   while ($true) {sleep 5}</span></pre><p id="ba7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每次将文件存储在该目录中时，都会处理该文件的公证，您可以查看more公证人仪表板以了解更多详细信息:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/1df1e471ad4f6ed7ba32d1ca91edb295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_L8L5U5ZXyWU5SdJ.png"/></div></div></figure><h1 id="c201" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">基于文件夹结构的工作流环境</h1><p id="731a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">让我们简单地创建以下文件夹结构:</p><ul class=""><li id="9d28" class="kl km iq jp b jq jr ju jv jy kn kc ko kg kp kk kq kr ks kt bi translated">生产(可信)</li><li id="4e1d" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">旧(不支持)</li><li id="ed24" class="kl km iq jp b jq ku ju kv jy kw kc kx kg ky kk kq kr ks kt bi translated">不受欢迎(不受信任)</li></ul><p id="c520" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据下面的脚本，在相应文件夹中创建或移动的文件将通过选定的信任级别进行公证。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/39b5d2254b2c7f0fd2fe87d03ce082cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W9k_W1CByARX-qG2.png"/></div></div></figure><p id="da0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这样，您只需根据文件的生命周期移动文件，就可以创建包含不可变信任级别的完整工作流。</p><pre class="me mf mg mh gt mp mq mr ms aw mt bi"><span id="2eec" class="mu la iq mq b gy mv mw l mx my"># Set vcn binary path - please download vcn here: https://github.com/vchain-us/vcn/releases/latest<br/>   $vcnpath = """$env:programfiles\codenotary\vcn.exe"""<br/>   $logpath = "C:\CodeNotary\codenotary.log"<br/>## Define all environments<br/><br/>### Set Production environment<br/>   $watchertrusted = New-Object System.IO.FileSystemWatcher<br/>   $watchertrusted.Path = "C:\CodeNotary\Production"<br/>   $watchertrusted.IncludeSubdirectories = $true<br/>   $watchertrusted.EnableRaisingEvents = $true  <br/><br/>### Set Old environment<br/>   $watcherunsupported = New-Object System.IO.FileSystemWatcher<br/>   $watcherunsupported.Path = "C:\CodeNotary\Old"<br/>   $watcherunsupported.IncludeSubdirectories = $true<br/>   $watcherunsupported.EnableRaisingEvents = $true  <br/><br/>### Set Unwanted environment<br/>   $watcheruntrusted = New-Object System.IO.FileSystemWatcher<br/>   $watcheruntrusted.Path = "C:\CodeNotary\Unwanted"<br/>   $watcheruntrusted.IncludeSubdirectories = $true<br/>   $watcheruntrusted.EnableRaisingEvents = $true  <br/><br/><br/><br/>## Define notarization when files are detected<br/>   $actiontrusted = { $path = $Event.SourceEventArgs.FullPath<br/>             $changeType = $Event.SourceEventArgs.ChangeType<br/>			 $param = " notarize " + """$Path""" + " --attr PSEvent=True"<br/>			 $command = $vcnpath + "$param"<br/>			 iex "&amp; $command"<br/>             $logline = "Trust $(Get-Date), $changeType, $path"<br/>             write-host $logline<br/>		     Add-content ($logpath) -value $logline<br/>             }    <br/><br/>   $actionunsupported = { $path = $Event.SourceEventArgs.FullPath<br/>             $changeType = $Event.SourceEventArgs.ChangeType<br/>			 $param = " unsupport " + """$Path""" + " --attr PSEvent=True"<br/>			 $command = $vcnpath + "$param"<br/>			 iex "&amp; $command"<br/>             $logline = "Unsupport $(Get-Date), $changeType, $path"<br/>             write-host $logline<br/>		     Add-content ($logpath) -value $logline<br/>             }    <br/>   <br/>   $actionuntrusted = { $path = $Event.SourceEventArgs.FullPath<br/>             $changeType = $Event.SourceEventArgs.ChangeType<br/>			 $param = " untrust " + """$Path""" + " --attr PSEvent=True"<br/>			 $command = $vcnpath + "$param"<br/>			 iex "&amp; $command"<br/>             $logline = "Untrust $(Get-Date), $changeType, $path"<br/>             write-host $logline<br/>		     Add-content ($logpath) -value $logline<br/>             }    <br/><br/># Register all Watcher<br/>   Register-ObjectEvent $watchertrusted "Created" -Action $actiontrusted<br/>   Register-ObjectEvent $watcherunsupported "Created" -Action $actionunsupported<br/>   Register-ObjectEvent $watcheruntrusted "Created" -Action $actionuntrusted<br/><br/>	<br/>   while ($true) {sleep 5}</span></pre></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><p id="f116" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ng">原载于2019年10月28日</em><a class="ae mc" href="https://www.codenotary.io/powershell-file-trust/" rel="noopener ugc nofollow" target="_blank"><em class="ng">https://www . code公证人. io </em> </a> <em class="ng">。</em></p></div></div>    
</body>
</html>