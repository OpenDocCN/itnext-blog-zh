<html>
<head>
<title>Kubernetes: Deployment Strategies types, and Argo Rollouts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes:部署策略类型和Argo展开</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-deployment-strategies-types-and-argo-rollouts-9d5f98e8b24e?source=collection_archive---------3-----------------------#2021-07-12">https://itnext.io/kubernetes-deployment-strategies-types-and-argo-rollouts-9d5f98e8b24e?source=collection_archive---------3-----------------------#2021-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e353a1ac45176867ca1e5fcbe49cf619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d0ve0naNUr99zQtfXPzDRA.png"/></div></div></figure><p id="9a8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的项目中，<a class="ae kw" href="https://rtfm.co.ua/en/category/ci-cd-en/argocd-en/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a>实现的目标之一是为我们的应用程序使用新的部署策略。</p><p id="5eb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本帖中，我们将观察Kubernetes中的部署类型，部署在Kubernetes中是如何工作的，以及Argo部署的一个快速示例。</p><ul class=""><li id="43d9" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Deployment_Strategies_and_Kubernetes" rel="noopener ugc nofollow" target="_blank">部署策略和Kubernetes </a></li><li id="a88a" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Recreate" rel="noopener ugc nofollow" target="_blank">再造</a></li><li id="172b" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Rolling_Update" rel="noopener ugc nofollow" target="_blank">滚动更新</a></li><li id="6aca" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Kubernetes_Canary_Deployment" rel="noopener ugc nofollow" target="_blank"> Kubernetes金丝雀部署</a></li><li id="8d1c" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Kubernetes_BlueGreen_Deployment" rel="noopener ugc nofollow" target="_blank"> Kubernetes蓝/绿展开</a></li><li id="4629" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Deployment_and_ReplicaSet" rel="noopener ugc nofollow" target="_blank">部署和复制集</a></li><li id="7e38" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Argo_Rollouts" rel="noopener ugc nofollow" target="_blank">阿尔戈发布</a></li><li id="10f9" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#Install_Argo_Rollouts" rel="noopener ugc nofollow" target="_blank">安装Argo卷展栏</a></li><li id="b6fc" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#kubectl_plugin" rel="noopener ugc nofollow" target="_blank"> kubectl插件</a></li><li id="b134" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/#An_applications_deploy" rel="noopener ugc nofollow" target="_blank">一个应用的部署</a></li></ul><h1 id="edce" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">部署策略和Kubernetes</h1><p id="3a7d" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">让我们简要概述一下Kubernetes中使用的部署策略。</p><p id="7b30" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开箱即用，Kubernetes有两种主要类型的<code class="fe mo mp mq mr b">.spec.strategy.type</code>—<em class="ms">Recreate</em>和<em class="ms"> RollingUpdate </em>，这是默认类型。</p><p id="862e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此外，您可以实现一种金丝雀和蓝绿色的部署，尽管有一些限制。</p><p id="aa45" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文档在这里是<a class="ae kw" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy" rel="noopener ugc nofollow" target="_blank">&gt;&gt;&gt;</a>。</p><h2 id="03d6" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">再创造</h2><p id="4c33" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">最简单明了的类型:在这样的部署过程中，Kubernetes将停止所有现有的pod，然后启动新的一组。</p><p id="93e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">显然，在此期间您会有一些停机时间，因为首先需要停止旧的Pod(详情请参见<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-nginx-php-fpm-graceful-shutdown-and-502-errors/#Pod_Lifecycle_-_Termination_of_Pods" rel="noopener ugc nofollow" target="_blank"> Pod生命周期-Pod post</a>的终止)，然后才会创建新的，然后它们需要通过<a class="ae kw" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" rel="noopener ugc nofollow" target="_blank">就绪</a>检查，在此过程中，您的应用程序将对用户不可用。</p><p id="afb2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您的应用程序不能同时使用不同的版本，例如由于数据库的限制，那么使用b是有意义的。</p><p id="81ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种部署的一个例子是:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="9225" class="mt lm iq mr b gy nn no l np nq">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: hello-deploy<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: hello-pod<br/>      version: "1.0"<br/>  strategy:<br/>    type: Recreate<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello-pod<br/>    spec:<br/>      containers:<br/>      - name: hello-pod<br/>        image: nginxdemos/hello<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="3e40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">展开它的<code class="fe mo mp mq mr b">version: "1.0"</code>:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="8b7f" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -f deployment.yaml<br/>deployment.apps/hello-deploy created</span></pre><p id="c38f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查舱:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="9314" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-77bcf495b7-b2s2x 1/1 Running 0 9s<br/>hello-deploy-77bcf495b7-rb8cb 1/1 Running 0 9s</span></pre><p id="b26d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将其<code class="fe mo mp mq mr b">label</code>更新为<code class="fe mo mp mq mr b">version: "2.0"</code>，重新部署并再次检查:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="0164" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-dd584d88d-vv5bb 0/1 Terminating 0 51s<br/>hello-deploy-dd584d88d-ws2xp 0/1 Terminating 0 51s</span></pre><p id="00df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">两个豆荚都被杀死了，只有在这之后，新豆荚才会被创造出来:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="49e3" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-d6c989569-c67vt 1/1 Running 0 27s<br/>hello-deploy-d6c989569-n7ktz 1/1 Running 0 27s</span></pre><h2 id="5231" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">滚动更新</h2><p id="a295" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">RollingUpdate更有趣一点:在这里，Kubernetes将运行新的pod与旧的并行，然后将杀死旧的版本并将留下新的。因此，在部署期间，旧版本和新版本的应用程序都需要一些时间。是默认的部署类型。</p><p id="7d7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用这种方法，我们的停机时间为零，因为在更新过程中，我们同时运行两个版本。</p><p id="29aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管如此，仍然存在这种方法不能应用的情况，例如，如果在start期间，pods将运行<a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-running-sql-migrations-with-kubernetes-job-and-helm-hook/" rel="noopener ugc nofollow" target="_blank"> MySQL迁移</a>，这将以旧应用程序版本不能使用的方式更新数据库模式。</p><p id="0dda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种部署的一个例子是:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="c5e9" class="mt lm iq mr b gy nn no l np nq">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: hello-deploy<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: hello-pod<br/>  strategy:<br/>    type: RollingUpdate<br/>    rollingUpdate:<br/>      maxUnavailable: 0<br/>      maxSurge: 1<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello-pod<br/>        version: "1.0"<br/>    spec:<br/>      containers:<br/>      - name: hello-pod<br/>        image: nginxdemos/hello<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="1a01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，我们将<code class="fe mo mp mq mr b">strategy.type: Recreate</code>更改为<code class="fe mo mp mq mr b">type: RollingUpdate</code>，并添加了两个可选字段，它们将定义更新期间的部署行为:</p><ul class=""><li id="fb98" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">maxUnavailable</code>:从<code class="fe mo mp mq mr b">replicas</code>中可以杀死多少个豆荚来运行新的。可以设置为数字或百分比。</li><li id="96a2" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated"><code class="fe mo mp mq mr b">maxSurge</code>:根据<code class="fe mo mp mq mr b">replicas</code>的值可以创建多少个pod。可以设置为数字或百分比。</li></ul><p id="2688" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的示例中，我们在<code class="fe mo mp mq mr b">maxUnavailable</code>中设置了0，也就是说，在新的pod启动之前，我们不想停止任何现有的pod，并且<code class="fe mo mp mq mr b">maxSurge</code>设置为1，因此在更新期间，Kubernetes将创建一个额外的pod，当它处于运行状态时，Kubernetes将丢弃一个旧的pod。</p><p id="0066" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用1.0版本进行部署:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="bcb1" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -f deployment.yaml<br/>deployment.apps/hello-deploy created</span></pre><p id="a039" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行两个吊舱:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="c140" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-dd584d88d-84qk4 0/1 ContainerCreating 0 3s<br/>hello-deploy-dd584d88d-cgc5v 1/1 Running 0 3s</span></pre><p id="6fcf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将版本更新到2.0，再次部署，并检查pod:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="d0cd" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-d6c989569-dkz7d 0/1 ContainerCreating 0 3s<br/>hello-deploy-dd584d88d-84qk4 1/1 Running 0 55s<br/>hello-deploy-dd584d88d-cgc5v 1/1 Running 0 55s</span></pre><p id="8cb7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们得到了一个超出<code class="fe mo mp mq mr b">replicas</code>价值的额外吊舱。</p><h2 id="0650" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">Kubernetes金丝雀部署</h2><p id="7d3e" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">金丝雀类型意味着创建新的pod与旧的并行，与滚动更新的方式相同，但对更新过程有更多的控制。</p><p id="c944" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在运行应用程序的新版本后，新请求的一部分将被路由到它，而另一部分将使用旧版本继续。</p><p id="f1fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果新版本运行良好，那么其余的用户将被切换到新版本，旧的pod将被删除。</p><p id="d90d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">金丝雀类型不包括在<code class="fe mo mp mq mr b">.spec.strategy.type</code>中，但Kubernetes本身可以在没有新控制器的情况下实现。</p><p id="cc8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这样做，解决方案将是初步的，而且在管理上很复杂。</p><p id="6354" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">尽管如此，我们可以通过在一个应用程序上创建两个不同版本的部署来实现，但是两个部署都将使用一个在其<code class="fe mo mp mq mr b">selector</code>中具有相同<code class="fe mo mp mq mr b">labels</code>集的服务。</p><p id="0d3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们用<code class="fe mo mp mq mr b">LoadBalancer</code>类型创建这样的部署和服务。</p><p id="547f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在部署-1设置<code class="fe mo mp mq mr b">replicas=2</code>中，对于部署-2 - <code class="fe mo mp mq mr b">0</code>:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="eed2" class="mt lm iq mr b gy nn no l np nq">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: hello-deploy-1<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      app: hello-pod<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello-pod<br/>        version: "1.0"<br/>    spec:<br/>      containers:<br/>      - name: hello-pod<br/>        image: nginxdemos/hello<br/>        ports:<br/>        - containerPort: 80<br/>        lifecycle:<br/>          postStart:<br/>            exec:<br/>              command: ["/bin/sh", "-c", "echo 1 &gt; /usr/share/nginx/html/index.html"]<br/>---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: hello-deploy-2<br/>spec:<br/>  replicas: 0<br/>  selector:<br/>    matchLabels:<br/>      app: hello-pod<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello-pod<br/>        version: "2.0"<br/>    spec:<br/>      containers:<br/>      - name: hello-pod<br/>        image: nginxdemos/hello<br/>        ports:<br/>        - containerPort: 80<br/>        lifecycle:<br/>          postStart:<br/>            exec:<br/>              command: ["/bin/sh", "-c", "echo 2 &gt; /usr/share/nginx/html/index.html"]<br/>---<br/>apiVersion: v1<br/>kind: Service <br/>metadata:<br/>  name: hello-svc<br/>spec:<br/>  type: LoadBalancer<br/>  ports:<br/>  - port: 80<br/>    targetPort: 80<br/>    protocol: TCP<br/>  selector:<br/>    app: hello-pod</span></pre><p id="2346" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<code class="fe mo mp mq mr b">postStart</code>让我们重写一个NGINX的索引文件，这样我们可以看到哪个pod接受了一个请求。</p><p id="bfe2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署它:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="c8c3" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -f deployment.yaml<br/>deployment.apps/hello-deploy-1 created<br/>deployment.apps/hello-deploy-2 created<br/>service/hello-svc created</span></pre><p id="2657" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查舱:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="4b80" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-1-dd584d88d-25rbx 1/1 Running 0 71s<br/>hello-deploy-1-dd584d88d-9xsng 1/1 Running 0 71s</span></pre><p id="0100" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">目前，该服务会将所有流量从部署-1:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="b6f2" class="mt lm iq mr b gy nn no l np nq">$ curl adb469658008c41cd92a93a7adddd235–1170089858.us-east-2.elb.amazonaws.com<br/>1</span><span id="3b33" class="mt lm iq mr b gy nr no l np nq">$ curl adb469658008c41cd92a93a7adddd235–1170089858.us-east-2.elb.amazonaws.com<br/>1</span></pre><p id="9c60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以更新Deployment-2并设置<code class="fe mo mp mq mr b">replicas: 1</code>:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="cfc9" class="mt lm iq mr b gy nn no l np nq">$ kubectl patch deployment.v1.apps/hello-deploy-2 -p ‘{“spec”:{“replicas”: 1}}’<br/>deployment.apps/hello-deploy-2 patched</span></pre><p id="2bd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们让pod运行相同的<code class="fe mo mp mq mr b">label app=hello-pod</code>:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="cab6" class="mt lm iq mr b gy nn no l np nq">$ kubectl get pod -l app=hello-pod<br/>NAME READY STATUS RESTARTS AGE<br/>hello-deploy-1-dd584d88d-25rbx 1/1 Running 0 3m2s<br/>hello-deploy-1-dd584d88d-9xsng 1/1 Running 0 3m2s<br/>hello-deploy-2-d6c989569-x2lsb 1/1 Running 0 6s</span></pre><p id="95dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的服务会将70%的流量从部署1路由到pod，其余的流量从部署2路由到pod:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="1cf9" class="mt lm iq mr b gy nn no l np nq">$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>2<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>2</span></pre><p id="2c5c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们检查2.0版本工作正常并且没有错误之后，我们可以删除旧版本，将新版本扩展到2个pod。</p><h2 id="7c64" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">Kubernetes蓝/绿部署</h2><p id="5b18" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">同样，当我们有一个旧版本(<em class="ms">绿色</em>)和一个新版本(<em class="ms">蓝色</em>)时，我们可以创建一种蓝绿色部署，但所有流量都将被发送到新版本。如果我们在新版本中遇到错误，我们可以很容易地将它切换回以前的版本。</p><p id="a627" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，我们使用<code class="fe mo mp mq mr b">label</code> <em class="ms">版本</em>将服务的<code class="fe mo mp mq mr b">.spec.selector</code>字段更新为仅从第一个“绿色”部署中选择pod:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="04f5" class="mt lm iq mr b gy nn no l np nq">...<br/>  selector:<br/>    app: hello-pod<br/>    version: "1.0"</span></pre><p id="dc07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">重新部署并检查:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="5d6f" class="mt lm iq mr b gy nn no l np nq">$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>1</span></pre><p id="c5a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，将<code class="fe mo mp mq mr b">selector</code>改为<code class="fe mo mp mq mr b">version: 2</code>，将流量切换到“蓝色”版本:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="f480" class="mt lm iq mr b gy nn no l np nq">$ kubectl patch services/hello-svc -p ‘{“spec”:{“selector”:{“version”: “2.0”}}}’<br/>service/hello-svc patched</span></pre><p id="9367" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一下:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="f57c" class="mt lm iq mr b gy nn no l np nq">$ curl adb***858.us-east-2.elb.amazonaws.com<br/>2<br/>$ curl adb***858.us-east-2.elb.amazonaws.com<br/>2</span></pre><p id="df77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一切正常后，我们可以删除旧版本,“蓝色”将变成“绿色”。</p><p id="9571" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当将Canary和Blue-Green部署与上述解决方案一起使用时，我们会遇到一系列问题:需要管理各种部署，检查它们的版本和法规，检查错误，等等。</p><p id="762e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相反，我们可以用Istio或ArgoCD做同样的事情。</p><p id="604e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Istio将在后面讨论，此时让我们看看如何使用ArgoCD实现这一点。</p><h1 id="eb55" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">部署和复制集</h1><p id="77ed" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">在继续之前，让我们看看部署和更新在Kubernetes中是如何工作的。</p><p id="a57d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，<a class="ae kw" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank"> Deployment </a>是一个Kubernetes类型，我们可以在其中描述一个模板来创建新的pod。</p><p id="226d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在创建这样一个部署之后，它将创建一个<a class="ae kw" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank"> ReplicaSet </a>对象来管理这个部署中的pod。</p><p id="3a78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在部署更新期间，它将创建另一个具有新配置的副本集，该副本集又将创建新的pod:</p><p id="fc10" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参见<a class="ae kw" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment" rel="noopener ugc nofollow" target="_blank">更新部署</a>。</p><p id="a07f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">部署创建的每个pod都有一个副本集链接，并且这个副本集有一个到相应部署的链接。</p><p id="0355" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查吊舱:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="55d1" class="mt lm iq mr b gy nn no l np nq">$ kubectl describe pod hello-deploy-d6c989569–96gqc<br/>Name: hello-deploy-d6c989569–96gqc<br/>…<br/>Labels: app=hello-pod<br/>…<br/>Controlled By: ReplicaSet/hello-deploy-d6c989569</span></pre><p id="f217" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi">…</p><p id="2f14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">此pod由:ReplicaSet/hello-deploy-d6c 989569控制，检查此replica set:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="d919" class="mt lm iq mr b gy nn no l np nq">$ kubectl describe replicaset hello-deploy-d6c989569<br/>…<br/>Controlled By: Deployment/hello-deploy<br/>…</span></pre><p id="019e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我们的部署— <em class="ms">由:Deployment/hello—deploy</em>控制。</p><p id="1e73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而pods的ReplicaSet模板正是其部署的<code class="fe mo mp mq mr b">spec.template</code>的内容:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="7f91" class="mt lm iq mr b gy nn no l np nq">$ kubectl describe replicaset hello-deploy-2–8878b4b<br/>…<br/>Pod Template:<br/>Labels: app=hello-pod<br/>pod-template-hash=8878b4b<br/>version=2.0<br/>Containers:<br/>hello-pod:<br/>Image: nginxdemos/hello<br/>Port: 80/TCP<br/>Host Port: 0/TCP<br/>Environment: &lt;none&gt;<br/>Mounts: &lt;none&gt;<br/>Volumes: &lt;none&gt;<br/>Events: &lt;none&gt;</span></pre><p id="5167" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，让我们去阿尔戈推出。</p><h1 id="e586" class="ll lm iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">阿尔戈推出</h1><p id="0e85" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">文档—<a class="ae kw" href="https://argoproj.github.io/argo-rollouts" rel="noopener ugc nofollow" target="_blank">https://argoproj.github.io/argo-rollouts</a>。</p><p id="4611" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Argo Rollouts是另一个Kubernetes控制器和一组Kubernetes自定义资源定义，它们一起允许创建更复杂的Kubernetes部署。</p><p id="97eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它可以单独使用，也可以与NGINX和AWS ALB控制器等入口控制器集成，或者与Istio等各种服务网格解决方案集成。</p><p id="dccf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在部署过程中，Argo Rollouts可以检查新应用程序的版本，并在出现问题时运行回滚。</p><p id="0b2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了使用Argo卷展栏而不是部署，我们将创建一个新的类型-卷展栏，其中在<code class="fe mo mp mq mr b">spec.strategy</code>中将定义部署类型和参数，例如:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="a823" class="mt lm iq mr b gy nn no l np nq">...<br/>spec:<br/>  replicas: 5<br/>  strategy:<br/>    canary:<br/>      steps:<br/>      - setWeight: 20<br/>...</span></pre><p id="d68c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它的其余字段与常见的Kubernetes部署相同。</p><p id="ca06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与部署一样，Rollout使用ReplicaSet来构建新的单元。</p><p id="9b08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在此期间，安装Argo部署后，您仍然可以使用标准部署及其<code class="fe mo mp mq mr b">spec.strategy</code>和新的部署。此外，您可以轻松地将现有部署迁移到部署，请参见<a class="ae kw" href="https://argoproj.github.io/argo-rollouts/migrating/" rel="noopener ugc nofollow" target="_blank">将部署转换为部署</a>。</p><p id="0146" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另请参见<a class="ae kw" href="https://argoproj.github.io/argo-rollouts/architecture/#architecture" rel="noopener ugc nofollow" target="_blank">架构</a>、<a class="ae kw" href="https://argoproj.github.io/argo-rollouts/features/specification/" rel="noopener ugc nofollow" target="_blank">展示规范</a> и <a class="ae kw" href="https://github.com/argoproj/argo-rollouts/blob/master/docs/getting-started.md#2-updating-a-rollout" rel="noopener ugc nofollow" target="_blank">更新展示</a>。</p><h2 id="51f8" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">安装Argo展开</h2><p id="c5c2" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">创建专用命名空间:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="d505" class="mt lm iq mr b gy nn no l np nq">$ kubectl create namespace argo-rollouts<br/>namespace/argo-rollouts created</span></pre><p id="3013" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从清单文件部署必要的Kubernetes CRD、ServiceAccount、ClusterRoles和部署:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="97df" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -n argo-rollouts -f <a class="ae kw" href="https://raw.githubusercontent.com/argoproj/argo-rollouts/stable/manifests/install.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/argoproj/argo-rollouts/stable/manifests/install.yaml</a></span></pre><p id="fafa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">稍后，当我们将它安装在生产中时，可以使用<a class="ae kw" href="https://github.com/argoproj/argo-helm/tree/master/charts/argo-rollouts" rel="noopener ugc nofollow" target="_blank"> Argo展开舵</a>图。</p><p id="e674" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一个pod —它是Argo展开控制器:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="6392" class="mt lm iq mr b gy nn no l np nq">$ kubectl -n argo-rollouts get pod<br/>NAME READY STATUS RESTARTS AGE<br/>argo-rollouts-6ffd56b9d6–7h65n 1/1 Running 0 30s</span></pre><h2 id="0813" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated"><code class="fe mo mp mq mr b">kubectl</code>插件</h2><p id="9637" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">为<code class="fe mo mp mq mr b">kubectl</code>安装一个插件:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="bb90" class="mt lm iq mr b gy nn no l np nq">$ curl -LO <a class="ae kw" href="https://github.com/argoproj/argo-rollouts/releases/latest/download/kubectl-argo-rollouts-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://github.com/argoproj/argo-rollouts/releases/latest/download/kubectl-argo-rollouts-linux-amd64</a><br/>chmod +x ./kubectl-argo-rollouts-linux-amd64<br/>$ sudo mv ./kubectl-argo-rollouts-linux-amd64 /usr/local/bin/kubectl-argo-rollouts</span></pre><p id="aceb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一下:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="4772" class="mt lm iq mr b gy nn no l np nq">$ kubectl argo rollouts version<br/>kubectl-argo-rollouts: v1.0.0+912d3ac<br/>BuildDate: 2021–05–19T23:56:53Z<br/>GitCommit: 912d3ac0097a5fc24932ceee532aa18bcc79944d<br/>GitTreeState: clean<br/>GoVersion: go1.16.3<br/>Compiler: gc<br/>Platform: linux/amd64</span></pre><h2 id="0654" class="mt lm iq bd ln mu mv dn lr mw mx dp lv kj my mz lz kn na nb md kr nc nd mh ne bi translated">应用程序部署</h2><p id="6957" class="pw-post-body-paragraph jy jz iq ka b kb mj kd ke kf mk kh ki kj ml kl km kn mm kp kq kr mn kt ku kv ij bi translated">部署测试应用程序:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="dc89" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -f <a class="ae kw" href="https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/rollout.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/rollout.yaml</a><br/>rollout.argoproj.io/rollouts-demo created</span></pre><p id="9213" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查一下:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="23d3" class="mt lm iq mr b gy nn no l np nq">$ kubectl get rollouts rollouts-demo -o yaml<br/>apiVersion: argoproj.io/v1alpha1<br/>kind: Rollout<br/>…<br/>spec:<br/>replicas: 5<br/>revisionHistoryLimit: 2<br/>selector:<br/>matchLabels:<br/>app: rollouts-demo<br/>strategy:<br/>canary:<br/>steps:<br/>- setWeight: 20<br/>- pause: {}<br/>- setWeight: 40<br/>- pause:<br/>duration: 10<br/>- setWeight: 60<br/>- pause:<br/>duration: 10<br/>- setWeight: 80<br/>- pause:<br/>duration: 10<br/>template:<br/>metadata:<br/>creationTimestamp: null<br/>labels:<br/>app: rollouts-demo<br/>spec:<br/>containers:<br/>- image: argoproj/rollouts-demo:blue<br/>name: rollouts-demo<br/>ports:<br/>- containerPort: 8080<br/>name: http<br/>protocol: TCP<br/>…</span></pre><p id="3bc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里，在<code class="fe mo mp mq mr b">spec.strategy</code>中使用Canary部署类型，在一组步骤中将执行pod的升级:首先，20%的现有pod将被新版本替换，然后暂停以检查它们是否工作，然后更新40%，再次暂停，等等，直到所有的pod都将被升级。</p><p id="8085" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过使用上面安装的插件，我们可以添加<code class="fe mo mp mq mr b">--watch</code>参数来实时查看升级过程:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="2dbc" class="mt lm iq mr b gy nn no l np nq">$ kubectl argo rollouts get rollout rollouts-demo — watch</span></pre><p id="ecbc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装测试服务:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="6178" class="mt lm iq mr b gy nn no l np nq">$ kubectl apply -f <a class="ae kw" href="https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/service.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/service.yaml</a><br/>service/rollouts-demo created</span></pre><p id="8f5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并通过设置新的映像版本进行更新:</p><pre class="nf ng nh ni gt nj mr nk nl aw nm bi"><span id="e933" class="mt lm iq mr b gy nn no l np nq">$ kubectl argo rollouts set image rollouts-demo rollouts-demo=argoproj/rollouts-demo:yellow</span></pre><p id="29af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查进度:</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/c6952513415683c0c87dde3375f419df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sY6Eco3bWIKWzlMDu5WYLQ.gif"/></div></div></figure><p id="d667" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成了。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="fd73" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ms">最初发布于</em> <a class="ae kw" href="https://rtfm.co.ua/en/kubernetes-deployment-strategies-types-and-argo-rollouts/" rel="noopener ugc nofollow" target="_blank"> <em class="ms"> RTFM: Linux，DevOps，和系统管理</em> </a> <em class="ms">。</em></p></div></div>    
</body>
</html>