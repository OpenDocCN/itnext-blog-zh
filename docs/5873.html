<html>
<head>
<title>Exploring Serverless Computing with Kubeless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Kubeless探索无服务器计算</h1>
<blockquote>原文：<a href="https://itnext.io/exploring-serverless-computing-with-kubeless-63c30bd96b2f?source=collection_archive---------1-----------------------#2021-06-17">https://itnext.io/exploring-serverless-computing-with-kubeless-63c30bd96b2f?source=collection_archive---------1-----------------------#2021-06-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="df9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">k3s上使用Kubeless的第一步</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abd6496db0c12c1d1962fd200572318b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4kyWniHuws9QxFkR"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@grakozy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">格雷格·拉科齐</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="93c7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">至少对我来说，是时候不用服务器了。作为一名开发人员，我想尽可能快地编写应用程序代码并让它在“某个地方”运行。</p><p id="f616" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我不想在开发期间换帽子，只是通过创建新的Docker映像和更改一些Kubernetes配置来将我的代码放入一些云中。</p><p id="dd08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">是的，当然，我可以设置一些CI系统，但有时这在本地开发环境中有点太多了。</p><p id="8b2b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我看来，无服务器模式进入了正确的方向。是时候感受一下了。</p><p id="86f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我选择了Kubeless作为框架，因为我想在我的本地k3s集群上使用它。</p><div class="lv lw gp gr lx ly"><a href="https://levelup.gitconnected.com/setup-your-own-kubernetes-cluster-with-k3s-take-2-k3sup-a5d9453f709f" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd iu gy z fp md fr fs me fu fw is bi translated">使用K3s — k3sup设置您自己的Kubernetes集群</h2><div class="mf l"><h3 class="bd b gy z fp md fr fs me fu fw dk translated">编辑描述</h3></div><div class="mg l"><p class="bd b dl z fp md fr fs me fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm ks ly"/></div></div></a></div><p id="f8d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在他们的网站上，他们是这样描述的</p><blockquote class="mn mo mp"><p id="e501" class="kz la mq lb b lc ld ju le lf lg jx lh mr lj lk ll ms ln lo lp mt lr ls lt lu im bi translated">Kubeless是一个Kubernetes-native无服务器框架，允许您部署少量代码(功能),而不必担心底层基础设施。它旨在部署在Kubernetes集群之上，并利用所有优秀的Kubernetes原语。如果你正在寻找一个开源的无服务器解决方案，克隆你能在AWS Lambda、Azure Functions和Google Cloud Functions上找到的东西，Kubeless正适合你！</p></blockquote><p id="05be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，这篇文章是一个关于Kubeless框架的教程，开始探索部署无服务器功能意味着什么。</p><p id="c6c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">说够了，让我们开始吧。</p><p id="514a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">等一下，在我们开始之前，我必须提到我的设置是</p><ul class=""><li id="32f7" class="mu mv it lb b lc ld lf lg li mw lm mx lq my lu mz na nb nc bi translated">MacBook Pro作为本地工作站</li><li id="a3c5" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">运行在Ubuntu上的双节点k3s集群</li></ul><p id="0e76" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你的设置非常不同，请查看Kubeless网站，见本文末尾的链接。</p><h2 id="4d1f" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">装置</h2><p id="36ee" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">首先，我们用以下命令安装所有东西:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="9ba7" class="ni nj it oh b gy ol om l on oo">$ export RELEASE=$(curl -s https://api.github.com/repos/kubeless/kubeless/releases/latest | grep tag_name | cut -d '"' -f 4)<br/>$ kubectl create ns kubeless<br/>$ kubectl create -f <a class="ae ky" href="https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless-$RELEASE.yaml" rel="noopener ugc nofollow" target="_blank">https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless-$RELEASE.yaml</a></span></pre><p id="53d4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和其他好的工具一样，Kubeless也有自己的命令行界面来使事情变得简单一些。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="d74c" class="ni nj it oh b gy ol om l on oo">$ export OS=$(uname -s| tr '[:upper:]' '[:lower:]')<br/>$ curl -OL https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless_$OS-amd64.zip &amp;&amp; unzip kubeless_$OS-amd64.zip &amp;&amp; sudo mv bundles/kubeless_$OS-amd64/kubeless /usr/local/bin/</span></pre><p id="e763" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查它是否已正确安装:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="e9d5" class="ni nj it oh b gy ol om l on oo">$ kubeless version</span></pre><p id="ac97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们继续部署一些功能。</p><h2 id="0bc9" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">部署功能</h2><p id="40fa" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">现在，我们将部署我在开始时提到的那些“小代码”，即所谓的“功能”。</p><p id="53f2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们通过将以下内容写入名为<code class="fe op oq or oh b">echo.py</code>的文件来创建代码。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="54cd" class="ni nj it oh b gy ol om l on oo">def echo(event, context):<br/>  print(event)<br/>  return event['data']</span></pre><p id="b7e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后所有东西都进入集群:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="f45a" class="ni nj it oh b gy ol om l on oo">$ kubeless function deploy echo --runtime python3.8 --from-file echo.py --handler echo.echo</span></pre><p id="aa33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已！</p><p id="2d69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速测试一下函数是否创建正确:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="7418" class="ni nj it oh b gy ol om l on oo">$ kubeless function ls echo<br/>NAME NAMESPACE  HANDLER     RUNTIME     DEPENDENCIES    STATUS<br/>echo     default      echo.echo python3.8                     1/1 READY</span></pre><p id="8d0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">特别是检查最后一栏，那个<code class="fe op oq or oh b">STATUS</code>实际上是<code class="fe op oq or oh b">READY</code>。</p><p id="4036" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果不工作，请查看“故障排除”一节。</p><h2 id="83c2" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">试验</h2><p id="444f" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">最后，是时候通过调用<code class="fe op oq or oh b">kubeless</code>来测试这个函数了:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="908a" class="ni nj it oh b gy ol om l on oo">$ kubeless function call echo --data 'Hello World!'<br/>Hello World!</span></pre><p id="36b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">成功！</p><h2 id="d2a8" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">清除</h2><p id="e854" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">如果您想再次删除所有内容，这里有三个命令来清理刚刚安装的内容。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="560e" class="ni nj it oh b gy ol om l on oo">$ kubeless function delete echo<br/>$ kubectl delete -f https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless-$RELEASE.yaml<br/>$ kubectl delete ns kubeless</span></pre><h2 id="e5f7" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">不使用<code class="fe op oq or oh b">kubeless</code>的情况下使用Kubeless</h2><p id="3e81" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">好诡异的标题，不过看完这一节还是有道理的。</p><p id="be07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们仍然在Kubernetes上，一切工作都不需要任何额外的CLI，如<code class="fe op oq or oh b">kubeless</code>。</p><p id="c06a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在Kubernetes中，无库功能只不过是一个“自定义资源定义”(CRD)。因此，无库函数变成了Kubernetes对象，我们可以像以前一样使用<code class="fe op oq or oh b">kubectl</code>。</p><p id="c533" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们试一试。</p><p id="95b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们删除前面的函数。如果尚未这样做，请参见“清理”一节。</p><p id="cf6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将以下内容放入一个名为<code class="fe op oq or oh b">echo.yaml</code>的文件中。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="3e6f" class="ni nj it oh b gy ol om l on oo">---<br/>apiVersion: kubeless.io/v1beta1<br/>kind: Function<br/>metadata:<br/>  name: echo<br/>spec:<br/>  deployment:<br/>    metadata:<br/>      annotations:<br/>        "annotation-to-deploy": "value"<br/>    spec:<br/>      replicas: 2<br/>      template:<br/>        metadata:<br/>          annotations:<br/>            "annotation-to-pod": "value"<br/>  deps: ""<br/>  function: |<br/>    def echo(event, context):<br/>      print(event)<br/>      return event['data']<br/>  function-content-type: text<br/>  handler: echo.echo<br/>  runtime: python3.8<br/>  service:<br/>    selector:<br/>      function: echo<br/>    ports:<br/>    - name: http-function-port<br/>      port: 8080<br/>      protocol: TCP<br/>      targetPort: 8080<br/>      nodePort: 30333<br/>    type: NodePort</span></pre><p id="31e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，像往常一样将其安装到集群上:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="51e0" class="ni nj it oh b gy ol om l on oo">$ kubectl apply -f echo.yml</span></pre><p id="45f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查它是否已经部署:</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="b5b7" class="ni nj it oh b gy ol om l on oo">$ kubectl get svc echo<br/>NAME   TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE<br/>echo   ClusterIP   WW.XX.YYY.Z   &lt;none&gt;        8080/TCP   16m</span></pre><p id="33bc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一切都好！</p><p id="45b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，为了测试服务，我们需要将集群节点的端口转发到我们的本地机器。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="6736" class="ni nj it oh b gy ol om l on oo">$ kubectl port-forward service/echo 8080:8080</span></pre><p id="65c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，在另一个终端，我们进入集群<code class="fe op oq or oh b">curl</code>来调用我们的函数。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="e1f1" class="ni nj it oh b gy ol om l on oo">$ curl -L --data '{"echo":"Hello World!"}' --header "Content-Type:application/json" localhost:8080/api/v1/namespaces/default/services/echo:http-function-part/proxy/</span></pre><p id="b356" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧，这就是我们的输出。希望…如果没有，继续下一节。</p><h2 id="d16a" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">解决纷争</h2><p id="7915" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">第一次浏览本教程时，很可能有些地方没有按预期运行。在部署我的第一个函数后，我遇到了一个问题。该服务不可达，我无法调用该功能。我不知道为什么它不起作用。</p><p id="23a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查您的功能时，该状态可能是“未准备好”而没有变为“准备好”，并且相关pod的状态可能无限期地处于“CrashLoopBackOff”状态。</p><p id="043d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常的“策略”是检查Kubernetes pod的日志。</p><p id="4ce8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">调用这个来获取pod的名称。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="ef3f" class="ni nj it oh b gy ol om l on oo">$ kubectl get pods<br/>NAME      READY   STATUS        RESTARTS   AGE<br/>echo-xzy  1/1     Running       0          4m35s</span></pre><p id="102f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，获取日志。</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="5229" class="ni nj it oh b gy ol om l on oo">$ kubectl logs echo-xzy</span></pre><p id="6afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直到那时，我才发现，我想使用一个不再可用的Python版本，我必须切换到一个更高的版本(&gt; = 3.x)才能让它工作。我还必须改变我的代码的语法，以使它再次工作，因为在Python 2中这是有效的代码</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="0546" class="ni nj it oh b gy ol om l on oo">print "Hello World!"</span></pre><p id="d47e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是在Python 3.x中，语法需要</p><pre class="kj kk kl km gt og oh oi oj aw ok bi"><span id="f143" class="ni nj it oh b gy ol om l on oo">print("Hello World!")</span></pre><p id="0d81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">只是为了开心。</p><h2 id="f400" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">结论</h2><p id="c7c2" class="pw-post-body-paragraph kz la it lb b lc ob ju le lf oc jx lh li od lk ll lm oe lo lp lq of ls lt lu im bi translated">希望你的第一次无服务器之旅是成功的。我真的很喜欢它，并且我看到未来有许多改变的可能性，特别是简化我的开发工作流程。</p><p id="fea1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候探索更多已经存在的函数并自己编写一些了。我在下面放了一些链接，让你继续下去。</p><p id="ddca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，请给我买杯咖啡。。</p><h2 id="b504" class="ni nj it bd nk nl nm dn nn no np dp nq li nr ns nt lm nu nv nw lq nx ny nz oa bi translated">资源</h2><ul class=""><li id="95fc" class="mu mv it lb b lc ob lf oc li os lm ot lq ou lu mz na nb nc bi translated"><a class="ae ky" href="https://kubeless.io" rel="noopener ugc nofollow" target="_blank">无所不能</a></li><li id="19a9" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated"><a class="ae ky" href="https://kubeless.io/docs/quick-start/" rel="noopener ugc nofollow" target="_blank">安装</a></li><li id="d194" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated"><a class="ae ky" href="https://github.com/kubeless/functions" rel="noopener ugc nofollow" target="_blank">功能</a></li><li id="dedb" class="mu mv it lb b lc nd lf ne li nf lm ng lq nh lu mz na nb nc bi translated">什么是 Serverless or Kubernetes?Serverless ON Kubernetes!(T1 )</li></ul></div></div>    
</body>
</html>