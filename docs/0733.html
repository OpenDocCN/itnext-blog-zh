<html>
<head>
<title>HowTo: Produce Avro Messages to Kafka using Schema Registry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HowTo:使用Schema Registry为Kafka生成Avro消息</h1>
<blockquote>原文：<a href="https://itnext.io/howto-produce-avro-messages-to-kafka-ec0b770e1f54?source=collection_archive---------0-----------------------#2018-05-17">https://itnext.io/howto-produce-avro-messages-to-kafka-ec0b770e1f54?source=collection_archive---------0-----------------------#2018-05-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/074555adb32cf81d6e3f6705e7dd7cba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sk3_sIdqZw8Zk59h"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">哈雷戴维森在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="27a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在Kafka中，Avro是标准的消息格式。</p><p id="25ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近我用了<a class="ae kc" href="https://www.confluent.io/product/confluent-open-source/" rel="noopener ugc nofollow" target="_blank">汇流</a> 3.3.1。我在使用<a class="ae kc" href="https://docs.confluent.io/current/schema-registry/docs/index.html" rel="noopener ugc nofollow" target="_blank"> Kafka Schema Registry </a>发送avro消息时遇到了一些问题。</p><p id="1bff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我将向您展示如何使用Kafka Schema Registry从客户端应用程序和Kafka流发送avro消息。</p><h2 id="c26d" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">向Kafka模式注册表注册Avro模式</h2><p id="eed9" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">在向主题发送avro消息之前，必须向模式注册表注册主题的avro模式。</p><p id="dfb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们像这样创建Avro模式文件page-view-event.avsc:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a3d7" class="lb lc iq me b gy mi mj l mk ml">{<br/>   "type":"record",<br/>   "name":"PageViewEvent",<br/>   "namespace":"com.mykidong.domain.event.schema",<br/>   "fields":[<br/>      {<br/>         "name":"baseProperties",<br/>         "type":[<br/>            "null",<br/>            {<br/>               "type":"record",<br/>               "name":"BaseProperties",<br/>               "namespace":"com.mykidong.domain.event.schema",<br/>               "fields":[<br/>                  {<br/>                     "name":"pcid",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"sessionId",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"referer",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"browser",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"eventType",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"version",<br/>                     "type":[<br/>                        "null",<br/>                        "string"<br/>                     ]<br/>                  },<br/>                  {<br/>                     "name":"timestamp",<br/>                     "type":[<br/>                        "null",<br/>                        "long"<br/>                     ]<br/>                  }<br/>               ]<br/>            }<br/>         ]<br/>      },<br/>      {<br/>         "name":"itemId",<br/>         "type":[<br/>            "null",<br/>            "string"<br/>         ]<br/>      },<br/>      {<br/>         "name":"itemTitle",<br/>         "type":[<br/>            "null",<br/>            "string"<br/>         ]<br/>      },<br/>      {<br/>         "name":"scrollRange",<br/>         "type":[<br/>            "null",<br/>            "int"<br/>         ]<br/>      },<br/>      {<br/>         "name":"stayTerm",<br/>         "type":[<br/>            "null",<br/>            "long"<br/>         ]<br/>      },<br/>      {<br/>         "name":"scrollUpDownCount",<br/>         "type":[<br/>            "null",<br/>            "int"<br/>         ]<br/>      }<br/>   ]<br/>}</span></pre><p id="3bf8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我将使用Java库在<a class="ae kc" href="https://docs.confluent.io/current/schema-registry/docs/api.html" rel="noopener ugc nofollow" target="_blank"> schema registry REST API </a>中注册avro schema。</p><p id="3c69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应添加以下汇合Maven Repo和依赖项:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9000" class="lb lc iq me b gy mi mj l mk ml">&lt;repository&gt;<br/>   &lt;id&gt;confluent&lt;/id&gt;<br/>   &lt;url&gt;<a class="ae kc" href="http://packages.confluent.io/maven/" rel="noopener ugc nofollow" target="_blank">http://packages.confluent.io/maven/</a>&lt;/url&gt;<br/>&lt;/repository&gt;</span><span id="b6bd" class="lb lc iq me b gy mm mj l mk ml">&lt;<strong class="me ir">dependency</strong>&gt;<br/>   &lt;<strong class="me ir">groupId</strong>&gt;io.confluent&lt;/<strong class="me ir">groupId</strong>&gt;<br/>   &lt;<strong class="me ir">artifactId</strong>&gt;kafka-schema-registry&lt;/<strong class="me ir">artifactId</strong>&gt;<br/>   &lt;<strong class="me ir">version</strong>&gt;3.3.1&lt;/<strong class="me ir">version</strong>&gt;<br/>&lt;/<strong class="me ir">dependency</strong>&gt;<br/>&lt;<strong class="me ir">dependency</strong>&gt;<br/>   &lt;<strong class="me ir">groupId</strong>&gt;io.confluent&lt;/<strong class="me ir">groupId</strong>&gt;<br/>   &lt;<strong class="me ir">artifactId</strong>&gt;kafka-avro-serializer&lt;/<strong class="me ir">artifactId</strong>&gt;<br/>   &lt;<strong class="me ir">version</strong>&gt;3.3.1&lt;/<strong class="me ir">version</strong>&gt;<br/>&lt;/<strong class="me ir">dependency</strong>&gt;<br/>&lt;<strong class="me ir">dependency</strong>&gt;<br/>   &lt;<strong class="me ir">groupId</strong>&gt;io.confluent&lt;/<strong class="me ir">groupId</strong>&gt;<br/>   &lt;<strong class="me ir">artifactId</strong>&gt;kafka-streams-avro-serde&lt;/<strong class="me ir">artifactId</strong>&gt;<br/>   &lt;<strong class="me ir">version</strong>&gt;3.3.1&lt;/<strong class="me ir">version</strong>&gt;<br/>&lt;/<strong class="me ir">dependency</strong>&gt;</span></pre><p id="2c1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在java代码中，添加以下内容:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a616" class="lb lc iq me b gy mi mj l mk ml">// schema registry url.<br/>String url = <strong class="me ir">"http://broker1:8081"</strong>;</span><span id="001d" class="lb lc iq me b gy mm mj l mk ml">// associated topic name.<br/>String topic = "page-view-event";</span><span id="15c9" class="lb lc iq me b gy mm mj l mk ml">// avro schema avsc file path.<br/>String schemaPath = "/avro-schemas/page-view-event.avsc";</span><span id="379a" class="lb lc iq me b gy mm mj l mk ml">// subject convention is "&lt;topic-name&gt;-value"<br/>String subject = topic + <strong class="me ir">"-value"</strong>;</span><span id="0821" class="lb lc iq me b gy mm mj l mk ml">// avsc json string.<br/>String schema = <strong class="me ir">null</strong>;<br/><br/>FileInputStream inputStream = <strong class="me ir">new </strong>FileInputStream(schemaPath);<br/><strong class="me ir">try </strong>{<br/>    schema = IOUtils.<em class="mn">toString</em>(inputStream);<br/>} <strong class="me ir">finally </strong>{<br/>    inputStream.close();<br/>}<br/><br/>Schema avroSchema = <strong class="me ir">new </strong>Schema.Parser().parse(schema);<br/><br/>CachedSchemaRegistryClient client = <strong class="me ir">new </strong>CachedSchemaRegistryClient(url, 20);<br/><br/>client.register(subject, avroSchema);</span></pre><p id="1060" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您必须看一下主题约定，它是“<topic-name> -value”，因为我们要注册值模式，而不是键模式。</topic-name></p><p id="a623" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，我们准备发送avro消息到主题，页面-视图-事件。</p><p id="8211" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果不想让kafka自动创建主题，可以像这样手动创建:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f496" class="lb lc iq me b gy mi mj l mk ml">cd $KAFKA_HOME;</span><span id="0361" class="lb lc iq me b gy mm mj l mk ml">bin/kafka-topics --create --zookeeper zk1:2181,zk2:2181,zk3:2181<!-- --> <!-- -->--topic page-view-event --replication-factor 2<!-- --> <!-- -->--partitions 5<!-- --> <!-- -->--config cleanup.policy=compact;</span></pre><h2 id="33c4" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">从客户端应用程序生成Avro消息</h2><p id="7905" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">要从客户端应用程序发送avro消息，我们必须使用KafkaProducer API。</p><p id="ab73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们为KafkaProducer定义Kafka配置属性:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="aa68" class="lb lc iq me b gy mi mj l mk ml">// kafka broker list.<br/>String brokers = "<!-- -->broker1:9092,broker2:9092<!-- -->";</span><span id="cc70" class="lb lc iq me b gy mm mj l mk ml">// schema registry url.<br/>String registry = "<!-- -->http://broker1:8081<!-- -->";</span><span id="b89b" class="lb lc iq me b gy mm mj l mk ml">Properties <strong class="me ir">producerProps </strong>= <strong class="me ir">new </strong>Properties();</span><span id="f414" class="lb lc iq me b gy mm mj l mk ml"><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">BOOTSTRAP_SERVERS_CONFIG</em></strong>, brokers);<br/><strong class="me ir">producerProps</strong>.put(AbstractKafkaAvroSerDeConfig.<strong class="me ir"><em class="mn">SCHEMA_REGISTRY_URL_CONFIG</em></strong>, registry);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">KEY_SERIALIZER_CLASS_CONFIG</em></strong>, <strong class="me ir">"org.apache.kafka.common.serialization.IntegerSerializer"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">VALUE_SERIALIZER_CLASS_CONFIG</em></strong>, <strong class="me ir">"io.confluent.kafka.serializers.KafkaAvroSerializer"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">ACKS_CONFIG</em></strong>, <strong class="me ir">"0"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">RETRIES_CONFIG</em></strong>, <strong class="me ir">"0"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">BATCH_SIZE_CONFIG</em></strong>, <strong class="me ir">"16384"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">LINGER_MS_CONFIG</em></strong>, <strong class="me ir">"1"</strong>);<br/><strong class="me ir">producerProps</strong>.put(ProducerConfig.<strong class="me ir"><em class="mn">BUFFER_MEMORY_CONFIG</em></strong>, <strong class="me ir">"33554432"</strong>);</span></pre><p id="522f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您必须查看用于序列化Avro GenericRecords的值序列化程序，并且必须设置模式注册表url。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a630" class="lb lc iq me b gy mi mj l mk ml">// construct kafka producer.<br/>Producer&lt;Integer, GenericRecord&gt; <strong class="me ir">producer </strong>= <strong class="me ir">new </strong>KafkaProducer&lt;Integer, GenericRecord&gt;(producerProps);</span><span id="d230" class="lb lc iq me b gy mm mj l mk ml">// message key.<br/>int userIdInt = 1;</span><span id="daa4" class="lb lc iq me b gy mm mj l mk ml">// message value, avro generic record.<br/>GenericRecord record = <em class="mn">buildRecord</em>();</span><span id="12be" class="lb lc iq me b gy mm mj l mk ml"><em class="mn">// send avro message to the topic page-view-event.<br/></em><strong class="me ir">producer</strong>.send(<strong class="me ir">new </strong>ProducerRecord&lt;Integer, GenericRecord&gt;("<strong class="me ir">page-view-event"</strong>, userIdInt, record));</span></pre><p id="9b11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要构建Avro GenericRecord，将使用以下内容:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="5d51" class="lb lc iq me b gy mi mj l mk ml"><strong class="me ir">public </strong>GenericRecord buildRecord() {</span><span id="dff6" class="lb lc iq me b gy mm mj l mk ml">    // avro schema avsc file path.<br/>    String schemaPath = "/avro-schemas/page-view-event.avsc";</span><span id="a2ab" class="lb lc iq me b gy mm mj l mk ml">    // avsc json string.<br/>    String schemaString = <strong class="me ir">null</strong>;<br/><br/>    FileInputStream inputStream = <strong class="me ir">new </strong>FileInputStream(schemaPath);<br/>    <strong class="me ir">try </strong>{<br/>        schemaString = IOUtils.<em class="mn">toString</em>(inputStream);<br/>    } <strong class="me ir">finally </strong>{<br/>        inputStream.close();<br/>    }</span><span id="156c" class="lb lc iq me b gy mm mj l mk ml">    // avro schema.<br/>    Schema schema = <strong class="me ir">new </strong>Schema.Parser().parse(schemaString);   </span><span id="15b1" class="lb lc iq me b gy mm mj l mk ml">    // generic record for page-view-event.<br/>    GenericData.Record record = <strong class="me ir">new </strong>GenericData.Record(schema);</span><span id="6af0" class="lb lc iq me b gy mm mj l mk ml">    // put the elements according to the avro schema.<br/>    record.put("itemId", "any-item-id");</span><span id="6081" class="lb lc iq me b gy mm mj l mk ml">    ...<br/>  <br/>    <strong class="me ir">return </strong>record;<br/>}</span></pre><p id="50fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是您不应该创建如上的avro模式实例。因为创建avro架构实例需要时间，所以您必须在构建和发送GenericRecord之前创建avro架构实例。具体见avro模式加载器实现:<a class="ae kc" href="https://medium.com/@mykidong/howto-implement-avro-schema-inheritance-757d2897c1ad" rel="noopener">https://medium . com/@ myki dong/how to-implement-avro-schema-inheritance-757d 2897 C1 ad</a></p><h2 id="fb93" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">从Kafka流生成Avro消息</h2><p id="0bf2" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">从Kafka Streams发送avro，类似于从客户端应用程序发送。区别只是配置属性。</p><p id="1cf3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建Kafka Streams配置属性:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a9df" class="lb lc iq me b gy mi mj l mk ml">String appId = "my-app-id";</span><span id="0b27" class="lb lc iq me b gy mm mj l mk ml">// kafka broker list.<br/>String brokers = "<!-- -->broker1:9092,broker2:9092<!-- -->";</span><span id="1b63" class="lb lc iq me b gy mm mj l mk ml">// schema registry url.<br/>String registry = "<!-- -->http://broker1:8081<!-- -->";</span><span id="5b71" class="lb lc iq me b gy mm mj l mk ml"><em class="mn">// serde.<br/></em><strong class="me ir">final </strong>Serde&lt;Integer&gt; integerSerde = Serdes.<em class="mn">Integer</em>();<br/><strong class="me ir">final </strong>Serde&lt;GenericRecord&gt; genericAvroSerde = <strong class="me ir">new </strong>GenericAvroSerde();<br/><br/>String clientId = appId + <strong class="me ir">"-client"</strong>;</span><span id="9e20" class="lb lc iq me b gy mm mj l mk ml"><em class="mn">// stream properties.<br/></em>Properties <strong class="me ir">props </strong>= <strong class="me ir">new </strong>Properties();<br/><strong class="me ir">props</strong>.put(StreamsConfig.<strong class="me ir"><em class="mn">APPLICATION_ID_CONFIG</em></strong>, appId);<br/><strong class="me ir">props</strong>.put(StreamsConfig.<strong class="me ir"><em class="mn">CLIENT_ID_CONFIG</em></strong>, clientId);<br/><strong class="me ir">props</strong>.put(StreamsConfig.<strong class="me ir"><em class="mn">BOOTSTRAP_SERVERS_CONFIG</em></strong>, brokers);<br/><strong class="me ir">props</strong>.put(AbstractKafkaAvroSerDeConfig.<strong class="me ir"><em class="mn">SCHEMA_REGISTRY_URL_CONFIG</em></strong>, registry);<br/><strong class="me ir">props</strong>.put(StreamsConfig.<strong class="me ir"><em class="mn">DEFAULT_KEY_SERDE_CLASS_CONFIG</em></strong>, Serdes.<em class="mn">Integer</em>().getClass().getName());<br/><strong class="me ir">props</strong>.put(StreamsConfig.<strong class="me ir"><em class="mn">DEFAULT_VALUE_SERDE_CLASS_CONFIG</em></strong>, genericAvroSerde.getClass().getName());<br/><strong class="me ir">props</strong>.put(StreamsConfig.<em class="mn">consumerPrefix</em>(ConsumerConfig.<strong class="me ir"><em class="mn">GROUP_ID_CONFIG</em></strong>), appId + <strong class="me ir">"-group"</strong>);<br/><strong class="me ir">props</strong>.put(StreamsConfig.<em class="mn">consumerPrefix</em>(ConsumerConfig.<strong class="me ir"><em class="mn">AUTO_OFFSET_RESET_CONFIG</em></strong>), <strong class="me ir">"latest"</strong>);</span></pre><p id="b543" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您必须查看默认值serde类，它用于序列化来自Kafka流的Avro GenericRecords，这不同于从客户端应用程序发送，并且必须设置schema registry url。</p><p id="1838" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们来看看卡夫卡流代码:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="17d7" class="lb lc iq me b gy mi mj l mk ml"><strong class="me ir">final </strong>Serde&lt;String&gt; stringSerde = Serdes.<em class="mn">String</em>();</span><span id="aab3" class="lb lc iq me b gy mm mj l mk ml">KStreamBuilder builder = <strong class="me ir">new </strong>KStreamBuilder();</span><span id="eeb3" class="lb lc iq me b gy mm mj l mk ml">// read json string from the topic "events".<br/>KStream&lt;Integer, String&gt; jsonStream = builder.stream(integerSerde, stringSerde, "events");</span><span id="4778" class="lb lc iq me b gy mm mj l mk ml">KStream&lt;Integer, GenericRecord&gt; pageViewEventStream = jsonStream.map((k, json) -&gt; {</span><span id="f6e5" class="lb lc iq me b gy mm mj l mk ml">    // do something, for instance, filter page view event from json and so on.<br/>    ...</span><span id="696a" class="lb lc iq me b gy mm mj l mk ml">    <em class="mn">// message key.<br/>    </em><strong class="me ir">int </strong>userIdInt = 1;<br/><br/>    <em class="mn">// message value, avro generic record.<br/>    </em>GenericRecord pageViewEventRecord = <strong class="me ir">buildRecord()</strong>;<br/><br/>    <strong class="me ir">return new </strong>KeyValue&lt;&gt;(userIdInt, pageViewEventRecord);<br/>});</span><span id="cfb2" class="lb lc iq me b gy mm mj l mk ml">// send page view event avro generic record to the topic "page-view-event".<br/>pageViewEventStream.to(<strong class="me ir">"page-view-event"</strong>);</span><span id="558e" class="lb lc iq me b gy mm mj l mk ml">// start kafka streams.<br/>KafkaStreams <strong class="me ir">streams </strong>= <strong class="me ir">new </strong>KafkaStreams(builder, <strong class="me ir">props</strong>);<br/><strong class="me ir">streams</strong>.start();<br/><br/><em class="mn">// Add shutdown hook to respond to SIGTERM and gracefully close Kafka Streams<br/></em>Runtime.<em class="mn">getRuntime</em>().addShutdownHook(<strong class="me ir">new </strong>Thread(() -&gt; {<br/>    <strong class="me ir">streams</strong>.close();<br/>}));</span></pre><p id="5f8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个kafka streams应用程序首先从主题“events”中读取字符串消息，其中使用了字符串序列化程序。在从Json字符串消息中过滤页面视图事件之后，Avro通用记录被创建并被发送到主题“页面视图事件”。</p><h2 id="7b4e" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">结论</h2><p id="d5c1" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我已经展示了如何使用kafka Schema Registry将avro通用记录发送到Kafka，但是您也可以通过修改配置属性中的序列化程序来发送avro特定记录。</p></div></div>    
</body>
</html>