<html>
<head>
<title>Deploying Lambda Functions with Lambda layers using CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CDK部署带有Lambda层的Lambda函数</h1>
<blockquote>原文：<a href="https://itnext.io/deploying-lambda-functions-with-layer-using-cdk-7634f806f92b?source=collection_archive---------1-----------------------#2020-12-03">https://itnext.io/deploying-lambda-functions-with-layer-using-cdk-7634f806f92b?source=collection_archive---------1-----------------------#2020-12-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/9fa2f4d5f3cbf2b7976f7b964b249abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*viKPhNlPi7iE5PmmEbGQOQ.png"/></div></div></figure><p id="f484" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">无服务器部署需要将库和依赖项导入Lambda函数。因此，将这些第三方依赖项导入函数的最简单方法是使用Lamda层。今天我将向你展示如何在你的CDK代码中使用这个lambda层。</p><p id="0c61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面的示例代码显示了python CDK，但是您可以使用CDK支持的任何语言来实现相同的功能。</p><p id="8595" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，您需要将所需的包安装到本地机器上。这里我将导入pymysql库作为Lambda层。因此，我使用下面的命令安装了库包，</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="cb9a" class="li lj it le b gy lk ll l lm ln">pip3 install pymysql</span></pre><p id="3d03" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后最重要的事情是定位软件包，到正确的目录结构。要做到这一点，我们应该对如何将层ZIP存档加载到AWS Lambda中有一个基本的了解。它被解压缩到/opt目录。所以要Lambda函数导入这个库，它应该放在/opt/python目录中。</p><p id="f83a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于python3层解压缩如下:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2c87" class="li lj it le b gy lk ll l lm ln"><strong class="le iu">/opt/python/lib/python3.X/site-packages/&lt;LIBRARY&gt;</strong></span></pre><p id="2365" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我们应该将我们的库放置在类似于如下的相同文件夹结构中。</p><figure class="kz la lb lc gt ju gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/e2a57d1156dbde095f3ff26a62bdd111.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*K1r3OaKNVJ6CPEFJrvg37w.png"/></div></figure><p id="ea72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建上面的文件夹结构，并将“pymysql”库包复制到site-packages中。然后我们可以在lambda层和Lambda函数内部引用这个库，如下所示。</p><p id="7622" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">λ层:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="a833" class="li lj it le b gy lk ll l lm ln">mysql_lib = lb.LayerVersion(self, 'mysql',<br/>                  code = lb.AssetCode(<strong class="le iu">'lambda/layers/'</strong>),<br/>                  compatible_runtimes = [lb.Runtime.PYTHON_3_6],<br/> )</span></pre><p id="3e8b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">λ函数:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="2b77" class="li lj it le b gy lk ll l lm ln">process_lambda = lb.Function( self, 'core-lambda-function',<br/>                    runtime=lb.Runtime.PYTHON_3_6,<br/>                    code = lb.Code.from_asset('lambda'),<br/>                    handler = 'setup_db_lambda.handler',<br/>                    function_name = "anonymize_db_lambda",<br/>                    <strong class="le iu">layers = [mysql_lib]</strong>,<br/>                    timeout=core.Duration.seconds(120),<br/>                 )</span></pre><p id="eaf8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以上代码将把位于“lambda/layers”文件夹中的所有库导入lambda函数。</p></div></div>    
</body>
</html>