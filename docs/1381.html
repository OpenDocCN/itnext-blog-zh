<html>
<head>
<title>Introduction to GraphQL Mongo Helpers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GraphQL Mongo助手简介</h1>
<blockquote>原文：<a href="https://itnext.io/introduction-to-graphql-mongo-helpers-a457944d4c8a?source=collection_archive---------4-----------------------#2018-09-30">https://itnext.io/introduction-to-graphql-mongo-helpers-a457944d4c8a?source=collection_archive---------4-----------------------#2018-09-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/9638c2ec84e30acd452c6e7c1e29e729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JyUzvsJNMCVyM7eGTpDDww.png"/></div></div></figure><div class=""/><blockquote class="jy jz ka"><p id="fda3" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">本故事移至:<a class="ae la" href="https://jonathancardoso.com/en/blog/introduction-graphql-mongo-helpers/" rel="noopener ugc nofollow" target="_blank">https://jonathancardoso . com/en/blog/introduction-graph QL-mongo-helpers/</a></p></blockquote><p id="fe83" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果您正在使用MongoDB和GraphQL，那么您可能在解析器上有一些参数来过滤从MongoDB返回的数据。使用这些助手，您可以减少代码重复的数量！</p><div class="ip iq gp gr ir le"><a href="https://github.com/entria/graphql-mongo-helpers" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jc gy z fp lj fr fs lk fu fw ja bi translated">entria/graphql-mongo-helpers</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">graphql-mongo-helpers。在GitHub上创建一个帐户，为entria/graphql-mongo-helpers的开发做出贡献。</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">github.com</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls ix le"/></div></div></a></div><h2 id="4b0b" class="lt lu jb bd lv lw lx dn ly lz ma dp mb lb mc md me lc mf mg mh ld mi mj mk ml bi translated">安装</h2><p id="9f8f" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated"><code class="fe mr ms mt mu b">yarn install @entria/graphql-mongo-helpers</code></p><p id="a99a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">现在，这个包有两个助手，<code class="fe mr ms mt mu b">createMongoConditionsFromFilters</code>和<code class="fe mr ms mt mu b">buildSortFromArg</code>。在这篇文章中，我们将研究第一个问题。</p><h2 id="dfca" class="lt lu jb bd lv lw lx dn ly lz ma dp mb lb mc md me lc mf mg mh ld mi mj mk ml bi translated">createMongoConditionsFromFilters(filter arg，映射，上下文)</h2><p id="f001" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">这个助手的基本思想是，如果你有一个如下所示的解析器:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6799" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">您可以为<code class="fe mr ms mt mu b">filter</code>参数定义一个映射:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="442c" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">在解析器里做这样的事情:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ef20" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如果客户端提供了以下查询:</p><pre class="mv mw mx my gt nb mu nc nd aw ne bi"><span id="efe7" class="lt lu jb mu b gy nf ng l nh ni">query ExampleQuery {<br/>  users(filter: {<br/>    username: "Blah"<br/>    age: 19<br/>  })<br/>}</span></pre><p id="3917" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated"><code class="fe mr ms mt mu b">filterResult</code>将具有以下价值:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="5bfb" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">如您所见，username变成了一个正则表达式，而age作为in传递，因为我们还没有映射它。</p><p id="0281" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">默认情况下，未映射的字段被视为具有<code class="fe mr ms mt mu b">MATCH_1_TO_1</code>的<code class="fe mr ms mt mu b">type</code>和与传递的字段相同的<code class="fe mr ms mt mu b">key</code>。</p><h2 id="bf9b" class="lt lu jb bd lv lw lx dn ly lz ma dp mb lb mc md me lc mf mg mh ld mi mj mk ml bi translated">经营者</h2><p id="342b" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">您也可以使用<a class="ae la" href="https://docs.mongodb.com/manual/reference/operator/query/#comparison" rel="noopener ugc nofollow" target="_blank"> MongoDB比较运算符</a>，您只需要在GraphQL输入类型中用它作为字段名的后缀。请记住，在映射中，您不需要指定后缀，只需指定字段名即可，例如，如果我们没有使用<code class="fe mr ms mt mu b">age: Int</code>，而是使用了<code class="fe mr ms mt mu b">age_gte: Int</code>，那么上面的<code class="fe mr ms mt mu b">filterResult</code>将如下所示:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="0b76" class="lt lu jb bd lv lw lx dn ly lz ma dp mb lb mc md me lc mf mg mh ld mi mj mk ml bi translated">高级过滤器类型</h2><p id="baf4" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">除了<code class="fe mr ms mt mu b">MATCH_1_TO_1</code>之外，还有<code class="fe mr ms mt mu b">AGGREGATE_PIPELINE</code>和<code class="fe mr ms mt mu b">CUSTOM_CONDITION</code>，<code class="fe mr ms mt mu b">CUSTOM_CONDITION</code>基本上是一个<code class="fe mr ms mt mu b">MATCH_1_TO_1</code>，但是需要使用<code class="fe mr ms mt mu b">format</code>函数来返回一些条件，这些条件将被合并到结果对象中。</p><p id="028d" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">例如，以下内容:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="213a" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">会将<code class="fe mr ms mt mu b">$or</code>添加到最终的<code class="fe mr ms mt mu b">conditions</code>对象中。</p><blockquote class="jy jz ka"><p id="8aab" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意:如果你想让客户像上面那样指定<code class="fe mr ms mt mu b">OR</code>条件，也有支持:</p></blockquote><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><h2 id="5164" class="lt lu jb bd lv lw lx dn ly lz ma dp mb lb mc md me lc mf mg mh ld mi mj mk ml bi translated">聚合_管道</h2><p id="9d48" class="pw-post-body-paragraph kb kc jb ke b kf mm kh ki kj mn kl km lb mo kp kq lc mp kt ku ld mq kx ky kz ij bi translated">如果您的过滤器依赖于某些只能通过<a class="ae la" href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" rel="noopener ugc nofollow" target="_blank"> MongoDB聚合管道</a>获得的数据，那么这就是您想要使用的类型:</p><figure class="mv mw mx my gt is"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6b76" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">从上面的例子可以看出，我们可以将两种类型结合在一起。</p><blockquote class="jy jz ka"><p id="a9ed" class="kb kc kd ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意:如果你有一个<code class="fe mr ms mt mu b">AGGREGATE_PIPELINE</code>类型的过滤器，你不能使用<code class="fe mr ms mt mu b">AND</code>或<code class="fe mr ms mt mu b">OR</code>，就像前面的例子一样</p></blockquote></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="e889" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">就这样，另一个叫做<code class="fe mr ms mt mu b"><a class="ae la" href="https://github.com/entria/graphql-mongo-helpers/commit/a9f59ecbf01d4613c14702316b93ef5ea871b932" rel="noopener ugc nofollow" target="_blank">buildSortAr</a>g</code>的助手是另一个职位的材料，而且简单得多:</p><div class="ip iq gp gr ir le"><a href="https://medium.com/@jonathancardoso/client-supplied-custom-sorting-using-graphql-54e4b87f6011" rel="noopener follow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd jc gy z fp lj fr fs lk fu fw ja bi translated">使用GraphQL的客户端提供的自定义排序</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">根据客户端发送的参数，对从API返回的数据进行排序的需求并不少见。休息一下，我们可以…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">medium.com</p></div></div><div class="ln l"><div class="nq l lp lq lr ln ls ix le"/></div></div></a></div><p id="b867" class="pw-post-body-paragraph kb kc jb ke b kf kg kh ki kj kk kl km lb ko kp kq lc ks kt ku ld kw kx ky kz ij bi translated">你也可以在推特上找到我:<a class="ae la" href="https://twitter.com/_jonathancardos" rel="noopener ugc nofollow" target="_blank"> @_jonathancardos </a></p></div></div>    
</body>
</html>