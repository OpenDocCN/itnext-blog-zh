<html>
<head>
<title>Using NSwag to Generate C# Client Classes for ASP.NET Core 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NSwag为ASP.NET核心3生成C#客户端类</h1>
<blockquote>原文：<a href="https://itnext.io/using-nswag-to-generate-c-client-classes-for-asp-net-core-3-173fb18dd508?source=collection_archive---------3-----------------------#2019-11-18">https://itnext.io/using-nswag-to-generate-c-client-classes-for-asp-net-core-3-173fb18dd508?source=collection_archive---------3-----------------------#2019-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="e61e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将使用NSwag提供的工具之一来生成C#客户端类，以提供对API的访问。虽然NSwag工具提供了多种发现API定义的方法，但我们将使用该工具从OpenAPI/Swagger规范中生成C#类。</p><p id="1a86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关如何使用NSwag为您的API提供OpenAPI/Swagger的详细信息，请查看我的<a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank">Swagger/open API with NSwag and ASP.NET Core 3</a>帖子。如果你需要一个API来玩，你可以从这个<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/14d130df7102c0603d532a2aef4d459292359b9d" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>获得我在文章中使用的API。如果您从GitHub获取示例API，并不是说它使用了实体框架核心和SQLite，这意味着您需要创建相关的数据库。如何做到这一点的细节可以在我的<a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET核心3:将实体框架核心添加到现有项目</a>帖子的创建和应用初始迁移部分找到。</p><h2 id="1682" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">示例客户端应用程序</h2><p id="5bd5" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">对于这个例子，我们将使用。NET CLI，在您希望创建应用程序的目录下，从您最喜欢的终端应用程序中使用以下命令。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="b0b9" class="km kn iq lp b gy lt lu l lv lw">dotnet new webapp</span></pre><h2 id="8778" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">NSwag客户端生成</h2><p id="4713" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">NSwag为客户端生成提供了多种选项，包括CLI选项、代码和Windows应用程序。这篇文章将使用名为NSwagStudio的Windows应用程序。从<a class="ae kl" href="http://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装NSwagStudio。</p><p id="1556" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，确保您的API正在运行，并获取其OpenAPI/Swagger规范URL的URL。例如，我正在使用我的API的本地实例，我需要的URL是<a class="ae kl" href="https://localhost:5001/swagger/v1/swagger.json." rel="noopener ugc nofollow" target="_blank">https://localhost:5001/Swagger/v1/swagger.json。</a>如果您正在使用Swagger UI，您可以在API标题下找到指向您的Swagger . JSON的链接。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/577ecda4dec292331fc1a108e333daa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*vl2uYGMsWccMrMZz.png"/></div></figure><p id="5ca8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了API的OpenAPI/Swager规范URL，我们正在处理open NSwagStudio。应用程序将打开，并带有一个准备就绪的新文档。我们需要设置几个选项。首先，我们想使用NetCore30 <strong class="jp ir">运行时</strong>。接下来，选择<strong class="jp ir"> OpenAPI/Swagger规范</strong>选项卡，并在<strong class="jp ir">规范URL </strong>框中输入您的API规范URL。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/cb449a0ee391e99ed54ef536f401622e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yE6_X9V8L0c8uZ4R.png"/></div></div></figure><p id="84a8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">输出</strong>部分勾选<strong class="jp ir"> CSharp客户端</strong>复选框，然后选择<strong class="jp ir"> CSharp客户端</strong>选项卡。正如你从下面的截图中看到的，有很多选项可以调整。对于这个例子，除了<strong class="jp ir">名称空间</strong>和<strong class="jp ir">输出文件路径</strong>之外，我们对它们都采用默认设置，前者我设置为ContactsApi，后者只有在使用<strong class="jp ir">生成文件</strong>选项时才需要。单击<strong class="jp ir">生成文件</strong>按钮，NSwagStudio将创建一个文件，其中包含访问在输入部分选择的OpenAPI/Swager规范中描述的API所需的所有代码。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/8a95704a0f0623118e18bdc711c6645d.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*KulqPWWPekDlC0CH.png"/></div></figure><p id="117d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，如果您想在与设置相同级别的<strong class="jp ir">输出</strong>选项卡中查看生成的代码，可以使用<strong class="jp ir">生成输出</strong>按钮。</p><h2 id="fae0" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">使用从示例项目中生成的客户端</h2><p id="75cd" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在示例项目中，我创建了一个Api目录，并将使用NSwagStudio创建的<strong class="jp ir"> ContactsApi.cs </strong>放在那里。用NSwagStudio生成的文件预计JSON.NET会出现，所以示例项目将需要对<a class="ae kl" href="https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson" rel="noopener ugc nofollow" target="_blank">微软的引用。AspNetCore . MVC . newtonsoftjson</a>nu get包。</p><p id="cf9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在该项目在<strong class="jp ir"> Startup </strong>类的<strong class="jp ir"> ConfigureServices </strong>函数中引用了JSON.NET，我们需要告诉应用程序通过依赖注入使JSON.NET可用，并做如下更改。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="7c6b" class="km kn iq lp b gy lt lu l lv lw">services.AddRazorPages()<br/>        .AddNewtonsoftJson();</span></pre><p id="6967" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在为了测试客户端，我在<strong class="jp ir"> Index.cshtml.cs </strong>文件中使用了下面的<strong class="jp ir"> OnGet </strong>函数。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="6abb" class="km kn iq lp b gy lt lu l lv lw">public async Task OnGet()<br/>{<br/>    using (var httpClient = new HttpClient())<br/>    {<br/>        var contactsClient = new ContactsClient(httpClient);<br/>        var contacts = await contactsClient.GetContactsAsync();<br/>    }<br/>}</span></pre><p id="e9a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，以上内容只是为了展示生成的客户端可以工作，并不意味着是生产级的示例。对于更多的生产级场景，请确保并遵循微软关于<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/http-requests?view=aspnetcore-3.0" rel="noopener ugc nofollow" target="_blank"> HTTP客户端使用</a>的指导。</p><h2 id="d7ab" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="406d" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">NSwag的客户端生成似乎是一种开始使用API的简单方法。我不确定CLI是否会提供更多关于如何生成客户端代码的选项，是否支持HTTPClientFactory和强类型HTTP客户端。这将是我在以后的文章中可能会探索更多的东西。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="8797" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">原载于</em> <a class="ae kl" href="https://elanderson.net/2019/11/using-nswag-to-generate-c-client-classes-for-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank"> <em class="mo">埃里克·安德森</em> </a> <em class="mo">。</em></p></div></div>    
</body>
</html>