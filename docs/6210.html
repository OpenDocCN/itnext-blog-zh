<html>
<head>
<title>Resolving CORS policy error</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决CORS政策错误</h1>
<blockquote>原文：<a href="https://itnext.io/resolving-cors-policy-error-c4cd11b012b?source=collection_archive---------2-----------------------#2021-09-20">https://itnext.io/resolving-cors-policy-error-c4cd11b012b?source=collection_archive---------2-----------------------#2021-09-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="73b8" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">什么是同源策略？以及如何绕过？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d18e889f754124673b0b32c22ddf725e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOP6GMMbb0NGGFLyi7M6NA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">CORS错误-同源策略</figcaption></figure><p id="4f89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">认得这个吗？？？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/7e1ae596da17dfd525b8f17663878295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S2JCl85LHFXPhKA5pYVwUQ.png"/></div></div></figure><p id="2f7d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">是啊！！！CORS错误。它不时抬起愤怒的头。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2bc3" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">这是什么？</h1><p id="f09f" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">首先要理解的是，这不是传统意义上的错误，而是一种保护用户免受互联网上可能发生的潜在不良事件影响的安全措施。这种安全措施被称为同源策略。</p><p id="ccc8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我试图定义它:</p><blockquote class="mz na nb"><p id="8c6b" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">同源策略限制网页请求具有不同来源的另一网页上的数据。</p></blockquote><p id="90d0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">想象一个浏览器没有实现同源策略的情况。</p><p id="d2ca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">任何网页都可以请求来自任何来源的数据，这意味着任何恶意网站都可以使用存储的cookie或会话数据来访问您已经打开的任何社交媒体帐户、银行，甚至更糟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/35cdd9d243f4eeda3c46324bc8aad399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvHwEI5EOjvAjQuSZxgvUw.png"/></div></div></figure><p id="748b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果没有同源政策，世界可能会变成这样:</p><blockquote class="mz na nb"><p id="9d00" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">1.用户登录电子邮件帐户，创建会话cookie并存储在浏览器上。</p><p id="3a5b" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">2.用户登录到sketchysite.com。sketchysite.com使用cookies向电子邮件帐户发送请求。返回的数据被捕获并出售。</p><p id="b0a1" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated">3.下次你使用信用卡时，你会发现它已经透支了</p></blockquote><p id="b0db" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">同源例子</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/b8938c43f098e05b4db572784c1c4595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qrwgssujbAQVzKLISljTQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">同源的例子</figcaption></figure><p id="a8d1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">不同起源的例子</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a76dd014b9a2e15088ed047da79c48d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zd-DMDo825je0ie3n8qI9g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><strong class="bd me">不同产地的例子</strong></figcaption></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="030e" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">如何绕过它</h1><p id="8ebf" class="pw-post-body-paragraph ky kz it la b lb mu ju ld le mv jx lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">很自然，会出现这样的情况，我们需要安全地绕过这一政策，而CORS就是这样做的一种方式。</p><p id="8851" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Mozilla将CORS定义为</p><blockquote class="mz na nb"><p id="2d2f" class="ky kz nc la b lb lc ju ld le lf jx lg nd li lj lk ne lm ln lo nf lq lr ls lt im bi translated"><strong class="la iu">跨来源资源共享</strong> ( <a class="ae nj" href="https://developer.mozilla.org/en-US/docs/Glossary/CORS" rel="noopener ugc nofollow" target="_blank"> CORS </a>)是一种基于<a class="ae nj" href="https://developer.mozilla.org/en-US/docs/Glossary/HTTP" rel="noopener ugc nofollow" target="_blank"> HTTP </a>报头的机制，允许服务器指示除其自身以外的任何<a class="ae nj" href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" rel="noopener ugc nofollow" target="_blank">来源</a> s(域、方案或端口),浏览器应该允许从这些来源加载资源。</p></blockquote><p id="1555" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">选项1 </strong>🙅‍♂️</p><p id="9e21" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">嗯，我们实际上可以在客户端做一个改变，通过传递模式:HTTP请求中的“no-cors”来绕过CORS。尽管这不是推荐的解决方案。</p><p id="efc6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nc">注意,“无cors”只允许有限的一组方法，并防止标头成为除了</em> <a class="ae nj" href="https://fetch.spec.whatwg.org/#simple-header" rel="noopener ugc nofollow" target="_blank"> <em class="nc">简单标头</em> </a>之外的任何标头</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="527d" class="np md it nl b gy nq nr l ns nt">fetch(url, {<br/> method: ‘POST’,<br/> mode: ‘cors’, // no-cors, *cors, same-origin,<br/> headers: {‘Content-Type’: ‘application/json’}<br/>})</span></pre><p id="4f91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">选项2 </strong>🙅‍♂️</p><p id="8cae" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">另一个我不推荐的解决方案是在你的浏览器上添加一个插件来绕过跨源策略。这些通常表现得像一个代理，但是会让你容易受到攻击。</p><p id="9424" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">流行的插件包括:</p><div class="nu nv gp gr nw nx"><a href="https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf?hl" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">允许CORS:访问控制允许来源</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">轻松地将(Access-Control-Allow-Origin: *)规则添加到响应头中。</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">chrome.google.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol ks nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a href="https://chrome.google.com/webstore/detail/cors-unblock/lfhmikememgdcahcdlaciloancbhjino?hl=en" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd iu gy z fp oc fr fs od fu fw is bi translated">CORS解锁</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">启用时，通过将“Access-Control-Allow-Origin: *”标头附加到本地和远程web请求，不再出现CORS错误</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">chrome.google.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol ks nx"/></div></div></a></div><p id="8bcc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">选项三</strong>💁‍♂️</p><p id="61a8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">解决方案应该在服务器端。对于Node和Express我们可以下载cors包【https://www.npmjs.com/package/cors T4】</p><p id="7eda" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe on oo op nl b">$ npm install cors</code></p><p id="7d46" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个包将允许我们添加一个响应头<code class="fe on oo op nl b">access-control-allow-origins</code>并指定允许哪些源。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="6b32" class="np md it nl b gy nq nr l ns nt">// Default = CORS-enabled for all origins <br/>app.use(cors())</span><span id="84d7" class="np md it nl b gy oq nr l ns nt">// restrict to certain origin<br/>app.use(cors({origin: “http://localhost:3001"})) </span></pre><p id="2547" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Viola在不影响安全性的情况下完全控制公认的来源</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="9b2e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望你已经发现这是有用的，感谢您的阅读。如果你喜欢这个，你可能也会喜欢我们在<a class="ae nj" href="https://www.notnotnerdy.com/" rel="noopener ugc nofollow" target="_blank">创造的其他一些博客帖子和创意！！书呆子</a>。每个月都会推出新的设计。</p></div></div>    
</body>
</html>