<html>
<head>
<title>Migration from ASP.NET Core 2.0 to 2.1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从ASP.NET核心2.0迁移到2.1</h1>
<blockquote>原文：<a href="https://itnext.io/migration-from-asp-net-core-2-0-to-2-1-c225d1fe385f?source=collection_archive---------11-----------------------#2018-06-10">https://itnext.io/migration-from-asp-net-core-2-0-to-2-1-c225d1fe385f?source=collection_archive---------11-----------------------#2018-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3841" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5月30日<a class="ae kl" href="https://blogs.msdn.microsoft.com/dotnet/2018/05/30/announcing-net-core-2-1/" rel="noopener ugc nofollow" target="_blank">。NET Core 2.1 </a>发布包括【ASP.NET】Core 2.1和<a class="ae kl" href="https://blogs.msdn.microsoft.com/dotnet/2018/05/30/announcing-entity-framework-core-2-1" rel="noopener ugc nofollow" target="_blank">实体框架Core 2.1 </a>的相应版本。在这篇文章中，我将采用我的ASP.NET基础系列中使用的一个项目，并将其从当前的2.0.x版本转换为新发布的2.1版本。代码的起点可以在这里找到<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics/tree/5758873e8edb3cb7d6637745528f62909b013ebc" rel="noopener ugc nofollow" target="_blank"/>。这都是基于<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/migration/20_21?view=aspnetcore-2.1" rel="noopener ugc nofollow" target="_blank">官方移民指南</a>的。</p><p id="3b8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在查看示例解决方案，那么这篇文章将要处理的就是Contacts项目。</p><h2 id="f612" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">装置</h2><p id="1b06" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">谢天谢地，下载页面比上次发布时有了很大的改进。头<a class="ae kl" href="https://www.microsoft.com/net/download/dotnet-core/" rel="noopener ugc nofollow" target="_blank">此处</a>并下载安装。网芯2.1 SDK。它适用于Windows、Linux和Mac。该链接会将您带到适用于您的操作系统的相应页面。</p><p id="d92c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装后，打开命令提示符并运行以下命令。如果一切正常，您应该会看到列出的版本<strong class="jp ir"> 2.1.300 </strong>。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="48b9" class="km kn iq lp b gy lt lu l lv lw">dotnet --list-sdks</span></pre><p id="eee0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用的是Windows，请确保至少安装了<a class="ae kl" href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-relnotes" rel="noopener ugc nofollow" target="_blank"> Visual Studio 2017 15.7 </a>。</p><h2 id="97bf" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">项目文件更改</h2><p id="38eb" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">右键单击项目并选择<strong class="jp ir">编辑{项目名称}。菜单中的csproj </strong>。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/736751ad82fc0ed585b0334426d7cfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/0*cl09zEyoIHT_DJ_q.png"/></div></figure><p id="0e0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，将<strong class="jp ir"> TargetFramework </strong>改为<strong class="jp ir"> netcoreappp2.1 </strong>。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="ff3b" class="km kn iq lp b gy lt lu l lv lw">Before:<br/>&lt;TargetFramework&gt;netcoreapp2.0&lt;/TargetFramework&gt;<br/><br/>After:<br/>&lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;</span></pre><p id="5ee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个需要改变的是远离微软。AspNetCore.All 包给无版本<strong class="jp ir">的微软。AspNetCore.App </strong>包。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="a12e" class="km kn iq lp b gy lt lu l lv lw">Before:<br/>&lt;PackageReference Include="Microsoft.AspNetCore.All" Version="2.0.0" /&gt;<br/><br/>After:<br/>&lt;PackageReference Include="Microsoft.AspNetCore.App" /&gt;</span></pre><p id="92f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我做了更多的挖掘，结果是项目文件可以从我为这个应用程序准备的版本中大大简化。以下是完整的项目文件，将所有不需要的位删除，上述两个变化已经作出。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="511d" class="km kn iq lp b gy lt lu l lv lw">&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;<br/><br/>  &lt;PropertyGroup&gt;<br/>    &lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;<br/>    &lt;UserSecretsId&gt;Your-Secrests-ID&lt;/UserSecretsId&gt;<br/>  &lt;/PropertyGroup&gt;<br/><br/>  &lt;ItemGroup&gt;<br/>    &lt;PackageReference Include="Microsoft.AspNetCore.App" /&gt;<br/>    &lt;PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.1.0" PrivateAssets="All" /&gt;<br/>    &lt;PackageReference Include="Swashbuckle.AspNetCore" Version="1.0.0" /&gt;<br/>  &lt;/ItemGroup&gt;<br/><br/>&lt;/Project&gt;</span></pre><h2 id="67cc" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">主要变化</h2><p id="c960" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">为了更好地支持<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/test/integration-tests?view=aspnetcore-2.1" rel="noopener ugc nofollow" target="_blank">集成测试</a>，对主函数的外观进行了修改。这是<strong class="jp ir"> Program.cs </strong>文件中的原始代码。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="5e0d" class="km kn iq lp b gy lt lu l lv lw">public class Program<br/>{<br/>    public static void Main(string[] args)<br/>    {<br/>        BuildWebHost(args).Run();<br/>    }<br/><br/>    public static IWebHost BuildWebHost(string[] args) =&gt;<br/>        WebHost.CreateDefaultBuilder(args)<br/>            .UseStartup&lt;Startup&gt;()<br/>            .Build();<br/>}</span></pre><p id="1ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是新的版本。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="378c" class="km kn iq lp b gy lt lu l lv lw">public class Program<br/>{<br/>    public static void Main(string[] args)<br/>    {<br/>        CreateWebHostBuilder(args).Build().Run();<br/>    }<br/><br/>    public static IWebHostBuilder CreateWebHostBuilder(string[] args) =&gt;<br/>        WebHost.CreateDefaultBuilder(args)<br/>            .UseStartup&lt;Startup&gt;();<br/>}</span></pre><h2 id="c7d5" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">启动更改</h2><p id="8d4d" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated"><strong class="jp ir"> Startup.cs </strong>有一个需要修改的地方，那就是从Configure函数中删除下面一行。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="cf05" class="km kn iq lp b gy lt lu l lv lw">app.UseBrowserLink();</span></pre><p id="e013" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在ConfigureServices功能中，如果您想要使用2.1中的新功能，请更改服务。AddMvc()设置<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup?view=aspnetcore-2.1#setcompatibilityversion" rel="noopener ugc nofollow" target="_blank">兼容版本</a>。这允许您升级SDK的版本，而不必更改整个应用程序，因为您必须选择您想要的版本。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="d938" class="km kn iq lp b gy lt lu l lv lw">Before:<br/>services.AddMvc();<br/><br/>After:<br/>services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Version_2_1);</span></pre><p id="6e7a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你查看官方迁移指南，他们还会指出如何启用更多的功能，如HTTPS和一些有助于GDPR的功能。这两者在这个应用程序中都不需要，所以我在本指南中跳过它们。</p><h2 id="1bc7" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">身份变化</h2><p id="c4e9" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我不得不在<strong class="jp ir"> ManageLogins.cshtml </strong>中做一个更改，以构建我的项目，因为要将<strong class="jp ir"> AuthenticationScheme </strong>重命名/移除为<strong class="jp ir"> DisplayName </strong>。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="12f8" class="km kn iq lp b gy lt lu l lv lw">Before:<br/>&lt;button type="submit" class="btn btn-default" name="provider" value="@provider.AuthenticationScheme" title="Log in using your @provider.DisplayName account"&gt;@provider.AuthenticationScheme&lt;/button&gt;<br/><br/>After:<br/>&lt;button type="submit" class="btn btn-default" name="provider" value="@provider.DisplayName" title="Log in using your @provider.DisplayName account"&gt;@provider.DisplayName&lt;/button&gt;</span></pre><p id="474c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您没有对项目中的身份代码做很多更改，那么您可以考虑使用新的identity razor类库。详情<a class="ae kl" href="https://docs.microsoft.com/en-us/aspnet/core/migration/20_21?view=aspnetcore-2.1#changes-to-authentication-code" rel="noopener ugc nofollow" target="_blank">你可以在这里</a>找到。</p><h2 id="7e01" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="d100" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">随着时间的推移，ASP.NET核心的版本之间的迁移变得越来越容易，这可以从这些帖子的较短长度中看出。需要注意的一点是，虽然这将使您以2.1为目标，获得所有的性能优势和许多新功能，但如果您想以新的2.1风格做所有的事情，仍然需要做一些工作。我强烈建议创建一个新的2.1应用程序，感受一下您可能希望对现有应用程序进行的其他更改。</p><p id="5181" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有修改的代码可以在这里<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics/commit/0d5b219025e37a50c0df42d41098dccf5ef039fb" rel="noopener ugc nofollow" target="_blank">找到。请记住，唯一升级的项目是<strong class="jp ir">联系人</strong>项目。</a></p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="a6d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mi">原载于</em><a class="ae kl" href="https://elanderson.net/2018/06/migration-from-asp-net-core-2-0-to-2-1/" rel="noopener ugc nofollow" target="_blank"><em class="mi"/></a><em class="mi">。</em></p></div></div>    
</body>
</html>