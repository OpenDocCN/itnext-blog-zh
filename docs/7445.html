<html>
<head>
<title>Why our company replaced Golang+GraphQL with TypeScript+Prisma+tRPC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我们公司用TypeScript+Prisma+tRPC代替Golang+GraphQL</h1>
<blockquote>原文：<a href="https://itnext.io/why-our-company-replaced-golang-graphql-with-typescript-prisma-trpc-ef56aaaa1c8c?source=collection_archive---------0-----------------------#2022-09-26">https://itnext.io/why-our-company-replaced-golang-graphql-with-typescript-prisma-trpc-ef56aaaa1c8c?source=collection_archive---------0-----------------------#2022-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a5e4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我们对获得的好处非常满意</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/49a2619dfd24456fd861ea4c1a192631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HqeALH_PvzYGmBOQ"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">照片由<a class="ae ky" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="79ee" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="8f44" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我想和你们分享我们公司走向tRPC和GraphQL的历程。</p><p id="8edc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在一家意大利咨询公司工作，主要为客户制作ERP ( <em class="ms">企业资源规划</em>)软件。</p><p id="926c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这些类型的软件通常用于50%到70%的CRUD操作。</p><p id="236a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">因此，这些年来，我们一直试图将所有我们能做的事情自动化，因为它们很无聊而且重复，并且利用了在业务逻辑上节省的<strong class="lt iu">时间。</strong></p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="49fc" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">我们的堆栈</h1><p id="d3d7" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们过去3年的堆栈是这样的(我已经简化了一点)</p><p id="524c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">后端(在GCP上大多是无服务器的，带有CloudRun/CloudFunctions ) </strong></p><ul class=""><li id="ae1e" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nk nl nm nn bi translated"><a class="ae ky" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank">GraphQL</a>(<a class="ae ky" href="https://github.com/99designs/gqlgen" rel="noopener ugc nofollow" target="_blank">gqlgen</a>go库，用于使用模式优先方法构建graph QL服务器)</li><li id="580a" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><a class="ae ky" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank"> gRPC </a>(用于微服务之间的内部通信)</li><li id="38ce" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">发布/订阅(用于微服务之间的内部异步通信)</li></ul><p id="25d7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">前端</strong></p><ul class=""><li id="115f" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nk nl nm nn bi translated">React ( <a class="ae ky" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> NextJS </a>)</li><li id="98c7" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><a class="ae ky" href="https://mui.com/material-ui/getting-started/overview/" rel="noopener ugc nofollow" target="_blank">素材UI </a>(或其他UI工具包)</li><li id="ba43" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">GraphQL(带<a class="ae ky" href="https://www.the-guild.dev/graphql/codegen" rel="noopener ugc nofollow" target="_blank">编码</a></li></ul><p id="3ba5" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">注意:我已经写了一篇文章，展示了<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/build-grpc-server-with-golang-go-step-by-step-b3f5abcf9e0e">如何一步一步地用Golang建立gRPC服务器</a>。看看这个。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="7218" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">冗长:我们在公司面临的问题(也发生在个人开发或小公司)</h1><p id="e629" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在后端，我们使用了GoLang的ORM(称为<a class="ae ky" href="https://bun.uptrace.dev/" rel="noopener ugc nofollow" target="_blank"> Bun </a>)和GqlGen库来生成schema first GraphQL服务器。</p><p id="4a5c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们的流程是这样的(简化):</p><ol class=""><li id="8a34" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nt nl nm nn bi translated">用ORM定义结构和查询(这里有很多重复的代码)</li><li id="6388" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nt nl nm nn bi translated">GraphQL模式的定义。</li><li id="13fb" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nt nl nm nn bi translated">GraphQL解析器的实现。</li><li id="e593" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nt nl nm nn bi translated">GraphQL查询的代码生成和React前端的变异(带typescript)</li><li id="d52a" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nt nl nm nn bi translated">在前端使用生成的查询/变异</li></ol><p id="9c96" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这个过程中，第一步和第三步对于CRUD操作来说极其冗长和乏味。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="67fa" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">什么是tRPC</h1><p id="a39b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">tRPC是一个轻量级的库，让你无需模式或代码生成工具就能构建完全类型安全的APIs)。</p><p id="270a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它允许客户端和服务器之间的类型共享。</p><p id="ceca" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">目前，GraphQL是在TypeScript中实现类型安全API的主要方式(这太神奇了！).由于GraphQL是作为实现API的语言无关规范而设计的，所以它没有充分利用像TypeScript这样的语言的强大功能。</p><p id="c6a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果你的<strong class="lt iu">项目是用全栈类型脚本</strong>构建的，你可以在你的客户机和服务器之间直接共享类型<strong class="lt iu">而不依赖于代码生成。</strong></p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="6ec7" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">什么是Prisma</h1><p id="70c8" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Prisma是一种帮助应用程序开发人员更快构建和更少出错的ORM。</p><p id="82a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">它由以下部分组成:</p><ul class=""><li id="007e" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nk nl nm nn bi translated"><strong class="lt iu">Prisma Client</strong>:node . js&amp;TypeScript的自动生成和类型安全查询生成器</li><li id="b224" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><strong class="lt iu"> Prisma Migrate </strong>:迁移系统</li><li id="3f11" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated"><strong class="lt iu"> Prisma Studio </strong>:查看和编辑数据库数据的GUI</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="f115" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">我们的选择:放弃Golang和GraphQL，使用Typescript ( node)和tRPC + Prisma</h1><p id="cb77" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">通过tRPC使用Prisma和typescript，我们可以重新定义我们的流程:</p><ol class=""><li id="2891" class="nf ng it lt b lu mn lx mo ma nh me ni mi nj mm nt nl nm nn bi translated">创建Prisma模式:<strong class="lt iu">我们定义我们的应用程序模型</strong></li></ol><p id="7b88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="ms"> Prisma将用</em><a class="ae ky" href="https://github.com/omar-dulaimi/prisma-trpc-generator" rel="noopener ugc nofollow" target="_blank"><em class="ms">Prisma-tRPC-generator</em></a>为我们创建一切:查询、结构和tRPC APIs</p><p id="d741" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.在前端使用tRPC APIs(因为有typescript，所以完全是类型安全的)</p><p id="5410" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">就是这样。😃</p><h1 id="d3df" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我们从这个选择中获得了什么</h1><ul class=""><li id="2ada" class="nf ng it lt b lu lv lx ly ma nw me nx mi ny mm nk nl nm nn bi translated">提高代码质量</li><li id="0b9e" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">交货速度</li><li id="4e0d" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">我们开发者的幸福</li><li id="fa60" class="nf ng it lt b lu no lx np ma nq me nr mi ns mm nk nl nm nn bi translated">减少重复和枯燥的编码</li></ul></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="dbe0" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">结论</h1><p id="6d4e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我们要离开Golang了(除了一些微服务，因为我们还爱Golang)。</p><p id="520e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们将离开GraphQL(注意，Prisma也可以用所有的crud操作生成一个GraphQL服务器)。</p><p id="9840" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">GraphQL仍然是一个很好的工具，但有时有些矫枉过正，在小规模项目中没有必要使用它。</p><p id="d71b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们对自己做出的选择非常满意。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h1 id="8bc8" class="kz la it bd lb lc na le lf lg nb li lj jz nc ka ll kc nd kd ln kf ne kg lp lq bi translated">这里有一些我写的其他文章，我想你会觉得有用</h1><div class="nz oa gp gr ob oc"><a href="https://www.klitonbare.com/blog/animate-svg-with-framer" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">用React和帧运动制作SVG动画</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">你好👋在这篇文章中，我将向你展示我是如何为我的博客标识创建一个绘制效果的。在这里你将得到什么(你可以…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">www.klitonbare.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://betterprogramming.pub/how-i-improved-my-react-code-readability-and-maintainability-with-conditional-rendering-94b32448bc70" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">不使用条件呈现操作符编写更好的React代码</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">避免使用使代码不可读的三元运算</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">better编程. pub</p></div></div><div class="ol l"><div class="or l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a href="https://javascript.plainenglish.io/tips-for-writing-better-react-code-ceb49e929001" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">编写更好的React代码的技巧</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">你知道那些窍门吗？</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ol l"><div class="os l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/best-books-that-every-software-developer-must-know-8b96faff180d"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">每个软件开发人员都必须知道的最佳书籍！</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">你的书架上有这些书吗？</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">itnext.io</p></div></div><div class="ol l"><div class="ot l on oo op ol oq ks oc"/></div></div></a></div><div class="nz oa gp gr ob oc"><a rel="noopener  ugc nofollow" target="_blank" href="/best-vscode-extensions-by-a-full-stack-developer-in-2022-f730037b6e0b"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">2022年全栈开发者评选的最佳VsCode扩展</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">作为一名完整的堆栈开发人员，以下是我挑选的最好的VS代码扩展！</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">itnext.io</p></div></div><div class="ol l"><div class="ou l on oo op ol oq ks oc"/></div></div></a></div></div></div>    
</body>
</html>