<html>
<head>
<title>Using NSwag to Generate Blazor Server Client for an ASP.NET Core 3.1 API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NSwag为ASP.NET核心3.1 API生成Blazor服务器客户端</h1>
<blockquote>原文：<a href="https://itnext.io/using-nswag-to-generate-blazor-server-client-for-an-asp-net-core-3-1-api-e8236f6658f9?source=collection_archive---------4-----------------------#2020-01-20">https://itnext.io/using-nswag-to-generate-blazor-server-client-for-an-asp-net-core-3-1-api-e8236f6658f9?source=collection_archive---------4-----------------------#2020-01-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b625" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本周我们将添加一个Blazor服务器项目，该项目将利用我们几周前创建的contacts API。这篇文章是ASP.NET核心基础回购的改造的一部分。网芯3.0发布。有关相关示例如何到达应用程序当前位置的详细信息，请查看以下帖子。</p><p id="00c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank">使用NSwag和ASP.NET Core 3的Swagger/open API</a><br/><a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET Core 3:向现有项目添加实体框架核心</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/new-razor-pages-application-backed-with-an-api/" rel="noopener ugc nofollow" target="_blank">新的Razor Pages项目支持API </a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成Angular客户端</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成React客户端</a></p><p id="7ef9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中的任何改变之前的示例代码可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/3d754e9a249118bd1b5697a0b88de5aba169451a" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="7612" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建Blazor服务器项目</h2><p id="faa6" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">为Blazor服务器项目添加一个新目录，然后打开该目录的终端集。以下命令可用于创建新的Blazor服务器项目。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0e1c" class="km kn iq lp b gy lt lu l lv lw">dotnet new blazorserver</span></pre><p id="b56c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，使用下面的命令将新项目添加到repo根目录下的解决方案文件中。你的文件名和路径当然会有所不同。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="c5ad" class="km kn iq lp b gy lt lu l lv lw">dotnet sln ..\..\BasicsRefresh.sln add ContactsBlazorServerApp.csproj</span></pre><h2 id="78af" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">使用NSwageStudio生成API客户端</h2><p id="a5a2" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">NSwag为客户端生成提供了多种选项，包括CLI选项、代码和Windows应用程序。这篇文章将使用名为NSwagStudio的Windows应用程序。从<a class="ae kl" href="http://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载并安装NSwagStudio。</p><p id="5fda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，确保您的API正在运行，并获取其OpenAPI/Swagger规范URL的URL。例如，我正在使用我的API的本地实例，我需要的URL是<a class="ae kl" href="https://localhost:5001/swagger/v1/swagger.json." rel="noopener ugc nofollow" target="_blank">https://localhost:5001/Swagger/v1/swagger.json。</a>如果您正在使用Swagger UI，您可以在API标题下找到指向您的Swagger . JSON的链接。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/47ce7e633eb8c526a830dc62258e9dca.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*6NtVfgIYgHGE3Q9n.png"/></div></figure><p id="5db3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了API的OpenAPI/Swager规范URL，切换到NSwagStudio。应用程序将打开，并带有一个准备就绪的新文档。我们需要设置几个选项。首先，我们想使用NetCore30 <strong class="jp ir">运行时</strong>。接下来，选择<strong class="jp ir"> OpenAPI/Swagger规范</strong>选项卡，并在<strong class="jp ir">规范URL </strong>框中输入您的API规范URL。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/792782c8ac866f580d444022d28efa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2uvWCyLK8IaRtE2R.png"/></div></div></figure><p id="1803" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">输出</strong>部分，勾选<strong class="jp ir"> CSharp客户端</strong>复选框，然后选择<strong class="jp ir"> CSharp客户端</strong>选项卡。对于这个例子，我们将所有选项都采用默认值，除了<strong class="jp ir">名称空间</strong>，它被设置为ContactsApi，<strong class="jp ir">为客户端类生成接口</strong>，它应该是check，以及<strong class="jp ir">输出文件路径</strong>，它只有在您使用<strong class="jp ir">生成文件</strong>选项时才需要。单击<strong class="jp ir">生成文件</strong>按钮，NSwagStudio将创建一个文件，其中包含访问在输入部分选择的OpenAPI/Swager规范中描述的API所需的所有代码。</p><figure class="lk ll lm ln gt ly gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/3baca564f9356805279bf9489d0fe72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*JcKYR5nrY3JUb2QF.png"/></div></figure><p id="7236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果使用与<strong class="jp ir">生成文件</strong>过程创建的代码相同的代码填充<strong class="jp ir">输出</strong>选项卡，则可以使用<strong class="jp ir">生成输出</strong>按钮，这提供了一种无需打开另一个文件即可进行设置和查看输出的好方法。</p><h2 id="87b7" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">在Blazor服务器项目中设置生成的客户端</h2><p id="2273" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在示例项目中，创建一个<strong class="jp ir">API</strong>目录，并将使用NSwagStudio创建的<strong class="jp ir"> ContactsApi.cs </strong>放在那里。用NSwagStudio生成的文件预计JSON.NET会出现，因此示例项目将需要对<a class="ae kl" href="https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson" rel="noopener ugc nofollow" target="_blank">微软的引用。AspNetCore . MVC . newtonsoftjson</a>nu get包。</p><p id="cb67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了客户端生成的和Razor Pages项目中的本地API目录，我们现在可以配置和注册它，以便在我们的新项目中使用。首先，打开<strong class="jp ir"> apppsetting.json </strong>文件，为我们的API的URL添加一个设置，这个设置就是下面示例中的<strong class="jp ir"> ContactsApi </strong>值。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0911" class="km kn iq lp b gy lt lu l lv lw">{<br/>  "Logging": {<br/>    "LogLevel": {<br/>      "Default": "Information",<br/>      "Microsoft": "Warning",<br/>      "Microsoft.Hosting.Lifetime": "Information"<br/>    }<br/>  },<br/>  "AllowedHosts": "*",<br/>  "ContactsApi": "https://localhost:5001"<br/>}</span></pre><p id="8e73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然项目已经更改了配置，并在<strong class="jp ir"> Startup </strong>类的<strong class="jp ir"> ConfigureServices </strong>函数中引用了JSON.NET，我们需要告诉应用程序通过使用<strong class="jp ir"> AddNewtonsoftJson </strong>通过依赖注入使JSON.NET可用，如下例所示。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="5075" class="km kn iq lp b gy lt lu l lv lw">services.AddRazorPages()<br/>        .AddNewtonsoftJson();</span></pre><p id="e4eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同样在<strong class="jp ir"> ConfigureServices </strong>函数中，我们需要注册我们的API客户端。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="288a" class="km kn iq lp b gy lt lu l lv lw">services.AddHttpClient&lt;IContactsClient, <br/>                       ContactsClient&gt;(client =&gt; <br/>         client.BaseAddress = new Uri(Configuration.GetSection("ContactsApi").Value));</span></pre><h2 id="dafd" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">创建UI并使用生成的客户端</h2><p id="6f9a" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">现在所有的设置工作都完成了，我们可以添加联系人列表UI，它将显示API客户端的用法。以下是示例的完整代码，它位于<strong class="jp ir">页面</strong>目录下的一个新的<strong class="jp ir"> ContactList.razor </strong>文件中。突出显示了与API客户端相关的特定行。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0db2" class="km kn iq lp b gy lt lu l lv lw">@page "/contactlist"<br/><br/>@using Apis<br/>@inject IContactsClient ContactClient<br/><br/>&lt;h1&gt;Contact List&lt;/h1&gt;<br/><br/>@if (_contacts == null)<br/>{<br/>    &lt;p&gt;&lt;em&gt;Loading...&lt;/em&gt;&lt;/p&gt;<br/>}<br/>else<br/>{<br/>    &lt;table className='table table-striped' aria-labelledby="tabelLabel"&gt;<br/>        &lt;thead&gt;<br/>            &lt;tr&gt;<br/>                &lt;th&gt;Name&lt;/th&gt;<br/>                &lt;th&gt;Address&lt;/th&gt;<br/>                &lt;th&gt;City&lt;/th&gt;<br/>                &lt;th&gt;State&lt;/th&gt;<br/>                &lt;th&gt;Postal Code&lt;/th&gt;<br/>                &lt;th&gt;Phone&lt;/th&gt;<br/>                &lt;th&gt;Email&lt;/th&gt;<br/>            &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>        &lt;tbody&gt;<br/>            @foreach (var contact in _contacts)<br/>            {<br/>                &lt;tr&gt;<br/>                    &lt;td&gt;@contact.Name&lt;/td&gt;<br/>                    &lt;td&gt;@contact.Address&lt;/td&gt;<br/>                    &lt;td&gt;@contact.City&lt;/td&gt;<br/>                    &lt;td&gt;@contact.State&lt;/td&gt;<br/>                    &lt;td&gt;@contact.PostalCode&lt;/td&gt;<br/>                    &lt;td&gt;@contact.Phone&lt;/td&gt;<br/>                    &lt;td&gt;@contact.Email&lt;/td&gt;<br/>                &lt;/tr&gt;<br/>            }<br/>        &lt;/tbody&gt;<br/>    &lt;/table&gt;<br/>}<br/><br/>@code {<br/>    private ICollection&lt;Contact&gt; _contacts;<br/><br/>    protected override async Task OnInitializedAsync()<br/>    {<br/>        _contacts = await ContactClient.GetContactsAsync();<br/>    }<br/>}</span></pre><p id="f3c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，为了将我们的新页面添加到导航栏中，打开位于<strong class="jp ir">共享</strong>目录中的<strong class="jp ir"> NavMenu.razor </strong>文件。将以下列表项添加到无序列表中。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="1d2d" class="km kn iq lp b gy lt lu l lv lw">&lt;li class="nav-item px-3"&gt;<br/>    &lt;NavLink class="nav-link" href="contactlist"&gt;<br/>        &lt;span class="oi oi-list" aria-hidden="true"&gt;&lt;/span&gt; Contacts<br/>    &lt;/NavLink&gt;<br/>&lt;/li&gt;</span></pre><h2 id="cd0f" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="c21b" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">和我利用NSwag进行客户端生成的其他帖子一样，这个过程非常简单，并且简化了API的使用。</p><p id="b0f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最终状态的样本代码可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/0ac0e84ca999545e5cac7764a019b14ce76353c8" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mh mi hu mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ij ik il im in"><p id="0fe3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mo">最初发表于</em> <a class="ae kl" href="https://elanderson.net/2020/01/using-nswag-to-generate-blazor-server-client-for-an-asp-net-core-3-1-api/" rel="noopener ugc nofollow" target="_blank"> <em class="mo">埃里克·安德森</em> </a> <em class="mo">。</em></p></div></div>    
</body>
</html>