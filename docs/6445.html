<html>
<head>
<title>Full-Stack with TS / Nest / Postgres</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带TS / Nest / Postgres的全栈</h1>
<blockquote>原文：<a href="https://itnext.io/full-stack-with-ts-nest-postgres-e684b464dbc5?source=collection_archive---------2-----------------------#2021-11-18">https://itnext.io/full-stack-with-ts-nest-postgres-e684b464dbc5?source=collection_archive---------2-----------------------#2021-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="63a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用TS、Nest和PostgreSQL实现一个简单的web应用程序</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4b2408550403800add1385282739493a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uASBICbJ4xMroHuwvGOk2w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">TypeScript、NestJS和PostgreSQL徽标</figcaption></figure><h2 id="99e6" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">介绍</h2><p id="5867" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">在本文中，我们将研究使用<a class="ae mn" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>、<a class="ae mn" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank"> NestJS </a>和<a class="ae mn" href="https://www.postgresql.org/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>构建一个非常简单的web应用程序的过程。这个干净有效的堆栈既轻便又强大，允许快速和持久的web应用程序的快速原型化。</p><p id="9dc0" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">有关该项目的源代码副本，请参见<a class="ae mn" href="https://github.com/kenreilly/ts-nest-postgres-example" rel="noopener ugc nofollow" target="_blank">本报告</a>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="3362" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">概观</h2><p id="83d4" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这个示例包含一个Nest应用程序，它提供一个简单的前端，该前端由HTML和TypeScript以及一个由PostgreSQL DB支持的API构建。可以使用任何前端框架，但是出于示例目的，为了简单起见，选择了vanilla TS。</p><p id="694b" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">NestJS提供了一组广泛的特性，对于构建强大的web应用程序、微服务等非常有用。这个应用程序使用<code class="fe na nb nc nd b">serve-static</code>、<code class="fe na nb nc nd b">pg</code>和<code class="fe na nb nc nd b">config</code>库来服务静态资产、连接到数据库和配置环境变量。</p><p id="2e27" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">要构建和运行这样一个应用，一定要为你的操作系统和环境安装<a class="ae mn" href="https://docs.nestjs.com/#installation" rel="noopener ugc nofollow" target="_blank"> NestJS </a>和<a class="ae mn" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank"> PostgreSQL </a>。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="5a07" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据库模式</h2><p id="58df" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">数据库模式在<strong class="lw iu"> db/schema.sql: </strong>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4f2f" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">一个简单的<code class="fe na nb nc nd b">items</code>表格由<code class="fe na nb nc nd b">id</code>、<code class="fe na nb nc nd b">name</code>、<code class="fe na nb nc nd b">description</code>和<code class="fe na nb nc nd b">create_timestamp</code>字段定义。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="8f6e" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用入口点</h2><p id="4849" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">主应用文件是<strong class="lw iu"> src/main.ts: </strong></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a81d" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">NestFactory创建了AppModule的一个实例，并设置了全局前缀<code class="fe na nb nc nd b">service</code>，它将作为API的基本URL。然后，应用程序监听端口3000(在生产中应该使用环境变量)。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="f050" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用模块</h2><p id="8294" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">应用模块包含在<strong class="lw iu"> src/app.module.ts </strong>中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="0369" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">模块定义了分别导入其他模块、控制器和服务的<code class="fe na nb nc nd b">imports</code>、<code class="fe na nb nc nd b">controllers</code>和<code class="fe na nb nc nd b">providers</code>。ServeStaticModule用于为除<code class="fe na nb nc nd b">/services.</code>以外的任何路径提供静态资产，ConfigModule加载将在应用程序的其余部分中使用的环境变量。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="7983" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用控制器</h2><p id="c71d" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">app控制器文件是<code class="fe na nb nc nd b">src/app.controller.ts:</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="771d" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">控制器向应用程序的其余部分公开功能，并为API定义端点。为这个简单应用程序定义的两个端点是<code class="fe na nb nc nd b">add-item</code>和<code class="fe na nb nc nd b">get-items</code>。</p><p id="4e3a" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated"><code class="fe na nb nc nd b">add-item</code>路由使用NewItemDto作为<a class="ae mn" href="https://gist.github.com/kenreilly/19d600bde0b7ad57bb07a866b4bf88f2" rel="noopener ugc nofollow" target="_blank">数据传输对象</a>定义，它将强制验证传入请求对象上预期的参数。该类在<strong class="lw iu">src/dto/new-item . dto . ts:</strong>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="7ddc" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用服务</h2><p id="10ff" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">应用支持服务在<strong class="lw iu"> src/app.service.ts: </strong>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="3358" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">这个类处理应用程序的底层操作，特别是控制器向API公开的两个方法。对底层DB服务的数据库查询(我们将很快对此进行研究)被包装在Promise对象中，以允许处理异步查询操作。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="c2bc" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">数据库ˌ资料库</h2><p id="8f1b" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">数据库模块和服务在<code class="fe na nb nc nd b">src/db/db.module.ts</code>和<code class="fe na nb nc nd b">src/db/db.service.ts:</code>中定义</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6299" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">数据库服务使用数据库连接字符串创建到PostgreSQL数据库的客户端连接。<code class="fe na nb nc nd b">query</code>方法接受一个SQL字符串和一个值数组，并返回一个包装数据库响应的<code class="fe na nb nc nd b">Promise</code>对象。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="81d4" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">应用程序前端</h2><p id="2b26" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">UI是用HTML、CSS和普通类型脚本构建的。为了清楚起见，省略了HTML和CSS(它们在项目repo中可用)。app前端的核心是<strong class="lw iu"> web/ts/app.ts </strong>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="885b" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">当加载UI时，输入被初始化，并且调用load_items从数据库中检索当前的项目列表，并在屏幕上呈现它们。</p><p id="217b" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">当创建一个新条目时，从输入字段中检索数据并提交给API以插入到DB中。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="6403" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">摘要</h2><p id="8395" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">这个简单的应用程序展示了设置一个基本的全栈web应用程序有多简单，包括静态UI、REST API和后台数据库。所使用的技术都是高质量的，并且将简单性与性能和耐用性结合起来，以允许相对容易地开发非常健壮的应用程序。</p><p id="15a8" class="pw-post-body-paragraph lu lv it lw b lx mo ju lz ma mp jx mc lh mq me mf ll mr mh mi lp ms mk ml mm im bi translated">感谢您的阅读，祝您的下一个项目好运！</p></div></div>    
</body>
</html>