<html>
<head>
<title>Easy port of a stateless microservices application to Cloud Foundry Application Runtime and Pivotal Application Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将无状态微服务应用轻松移植到Cloud Foundry应用运行时和Pivotal应用服务</h1>
<blockquote>原文：<a href="https://itnext.io/stateless-microservices-on-application-platform-ce6dea9c9821?source=collection_archive---------8-----------------------#2018-05-10">https://itnext.io/stateless-microservices-on-application-platform-ce6dea9c9821?source=collection_archive---------8-----------------------#2018-05-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6fe608bd86d2b34574d71187de7fbb64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D86LxZDve4x7j9aFvZixAw.png"/></div></div></figure><p id="b150" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最近，我读了一篇<a class="ae kw" href="https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882" rel="noopener ugc nofollow" target="_blank">Rinor Maloku</a>【2】撰写的关于Kubernetes的文章【1】，这篇文章温和而全面地介绍了这个无状态的微服务应用程序如何在一个更高抽象的平台上工作，例如应用程序运行时。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="f205" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="a4c6" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们采用了一个简单的微服务应用程序(使用ReactJS、Spring Boot和Python Flask编写的3个无状态微服务),并使用<code class="fe mc md me mf b">cf push</code>以最小的代码更改部署到生产环境(Pivotal应用程序服务)。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="c976" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">微服务应用简介</h2><p id="5fcd" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">在他的文章中，Rinor描述了一个简单的微服务架构应用，包括三个组件:</p><ul class=""><li id="b917" class="mg mh iq ka b kb kc kf kg kj mi kn mj kr mk kv ml mm mn mo bi translated">由Nginx webserver提供的ReactJS编写的情感分析<strong class="ka ir">前端</strong> ( <code class="fe mc md me mf b">sa-frontend</code>)</li><li id="2078" class="mg mh iq ka b kb mp kf mq kj mr kn ms kr mt kv ml mm mn mo bi translated">在Spring Boot编写的情感分析<strong class="ka ir"> WebApp </strong> ( <code class="fe mc md me mf b">sa-webapp</code>)，以及</li><li id="b4ba" class="mg mh iq ka b kb mp kf mq kj mr kn ms kr mt kv ml mm mn mo bi translated">用Python Flask写的情感分析<strong class="ka ir">逻辑</strong> ( <code class="fe mc md me mf b">sa-logic</code>)。</li></ul><p id="22d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">参见Rinor的动画图像，了解应用程序工作流程:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/1262a99fb02e26d5a107c9e886e554a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*wiBZFmuncGHlVxbOwts2kA.gif"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">微服务应用程序的动画流程。</figcaption></figure><p id="0be0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将在以后转化为在应用运行时(PCF PAS)中运行的三个微服务:</p><ul class=""><li id="0265" class="mg mh iq ka b kb kc kf kg kj mi kn mj kr mk kv ml mm mn mo bi translated"><code class="fe mc md me mf b">sentiment-analysis-frontend</code></li><li id="e74c" class="mg mh iq ka b kb mp kf mq kj mr kn ms kr mt kv ml mm mn mo bi translated"><code class="fe mc md me mf b">sentiment-analysis-webapp</code></li><li id="3f5c" class="mg mh iq ka b kb mp kf mq kj mr kn ms kr mt kv ml mm mn mo bi translated"><code class="fe mc md me mf b">sentiment-analysis-logic</code></li></ul><p id="f2c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦部署完毕，应用程序将显示一个输入句子的表单。在将一个句子提交到表单中时，应用程序会进行情感分析，并为给定的句子提供一个带有情感色彩的极性(参见Rinor的动画gif以了解一个工作应用程序的图示)。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/1d8790635874783970f0ed7765c5d95a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/1*f-BD5CUxm6a_XPKRGH54gw.gif"/></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">情感分析微服务应用实例。</figcaption></figure><p id="7b95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有关完整的源代码，请参考<a class="ae kw" href="https://github.com/rinormaloku/k8s-mastery" rel="noopener ugc nofollow" target="_blank"> Rinor的Github repo</a>【3】或<a class="ae kw" href="https://github.com/nevenc-pivotal/k8s-mastery" rel="noopener ugc nofollow" target="_blank">my forged Github repo</a>【4】并更改代码以使该应用程序在PCF PAS中运行。</p><h2 id="f186" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">创建应用程序运行时帐户</h2><p id="c7e0" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">首先，我们需要一个应用程序运行时的帐户。一个人可以做出许多选择。我选择了<a class="ae kw" href="https://run.pivotal.io" rel="noopener ugc nofollow" target="_blank">Pivotal Web Services</a>(PWS)【6】，因为我最熟悉这种应用平台风格(而且我确实为Pivotal工作——见下面的免责声明)。PWS提供免费试用，任何人都可以轻松试用，不需要信用卡。所有Cloud Foundry应用程序运行时风格的开发人员体验都非常相似。</p><p id="2bb8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在向Pivotal Web Services (PWS)确认您的帐户后，您需要登录<a class="ae kw" href="https://console.run.pivotal.io" rel="noopener ugc nofollow" target="_blank"> PWS网站</a>【7】并下载<a class="ae kw" href="https://console.run.pivotal.io/tools" rel="noopener ugc nofollow" target="_blank"> CF CLI工具</a>【8】。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/df32993723046db87a5e77ca75bf174d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7SpA82EDO2TnU1Ih8TGVw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::应用程序管理器::登录页面</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/64e9cb0e6a30cbe400ed8d00172c7e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DMhSCzjHiBx73U3wVRR8yQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::应用程序管理器::工具页面</figcaption></figure><h2 id="9d08" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">登录应用程序运行时</h2><p id="ea84" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">使用CF CLI工具登录应用运行时环境，例如Pivotal Web Services (PWS):</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="7ebb" class="le lf iq mf b gy nk nl l nm nn">cf login -a <a class="ae kw" href="https://api.run.pivotal.io" rel="noopener ugc nofollow" target="_blank">https://api.run.pivotal.io</a><br/>cf target<br/>cf apps<br/>cf services<br/>cf buildpacks</span></pre><p id="c336" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:如果您的PCF安装使用自签名证书，您需要跳过使用CF CLI工具的SSL验证，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="5aed" class="le lf iq mf b gy nk nl l nm nn">cf login -a https://api.system.my.pcf.intranet <strong class="mf ir">--skip-ssl-validation</strong></span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/bf5cfd1567440662e980e2c1fc52e2cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-J2Db5W7F8oIyKoNPxT5FQ.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用CF CLI登录Pivotal Web服务(PWS)</figcaption></figure><p id="4def" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从Github repo获取原始源代码，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="dc29" class="le lf iq mf b gy nk nl l nm nn">git clone https://github.com/rinormaloku/k8s-mastery<br/>cd k8s-mastery</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/b8cc6be4159a5c5e5537f6fdb1dfab08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Gf0P8hffeCmdBAqZdqioBA.gif"/></div></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="931e" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">构建和部署ReactJS应用程序</h2><p id="4c0e" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">首先我们看一下ReactJS应用程序<code class="fe mc md me mf b">sa-frontend</code>。我们需要用<code class="fe mc md me mf b">yarn</code>安装ReactJS模块。接下来，我们需要使用<code class="fe mc md me mf b">yarn build</code>构建应用程序。为了在生产平台上工作，我们需要做一些改动。首先，更新<code class="fe mc md me mf b">src/App.js</code>以参数化<code class="fe mc md me mf b">sa-webapp</code> (Spring Boot WebApp)位置，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="63b4" class="le lf iq mf b gy nk nl l nm nn">...</span><span id="e3ae" class="le lf iq mf b gy np nl l nm nn">const WEB_APP_URL = '<a class="ae kw" href="http://localhost:8080'" rel="noopener ugc nofollow" target="_blank">http://localhost:8080'</a>;</span><span id="32f1" class="le lf iq mf b gy np nl l nm nn">...</span><span id="b261" class="le lf iq mf b gy np nl l nm nn">analyzeSentence() {<br/>        fetch(WEB_APP_URL + '/sentiment', {<br/>            method: 'POST',<br/>            headers: {<br/>                'Content-Type': 'application/json'<br/>            },<br/>...</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/95c5c1cff26ec6aada2ac7ad385a5b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VLevybavwntkKDjjzORAMg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">构建sa前端应用程序</figcaption></figure><p id="2b62" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，使用Spring Boot WebApp的实际部署位置再次更新应用程序，例如<code class="fe mc md me mf b">http://sentiment-analysis-webapp.cfapps.io</code></p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="3042" class="le lf iq mf b gy nk nl l nm nn">// const WEB_APP_URL = '<a class="ae kw" href="http://localhost:8080'" rel="noopener ugc nofollow" target="_blank">http://localhost:8080'</a>;</span><span id="2b74" class="le lf iq mf b gy np nl l nm nn">const WEB_APP_URL = '<a class="ae kw" href="http://localhost:8080'" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-webapp.cfapps.io'</a>;</span></pre><blockquote class="nr ns nt"><p id="0050" class="jy jz nu ka b kb kc kd ke kf kg kh ki nv kk kl km nw ko kp kq nx ks kt ku kv ij bi translated"><strong class="ka ir">注意</strong>:通过读取环境变量而不是在代码中硬编码值(<code class="fe mc md me mf b">src/App.js</code>)，我们或许可以更好地利用ReactJS应用程序中的<code class="fe mc md me mf b">WEB_APP_URL</code>。ReactJS开发者请插话(可能是类似于<code class="fe mc md me mf b">process.env.WEB_APP_URL</code>的东西)。</p></blockquote><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/fa9abb6acedbc5751e470e545522f708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yYgrA7x_zBTlmMfV9Gy24g.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">重新构建sa前端应用程序</figcaption></figure><p id="8ea2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次构建应用程序，例如<code class="fe mc md me mf b">yarn build</code>。</p><p id="b499" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从命令行推送应用程序，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="234e" class="le lf iq mf b gy nk nl l nm nn">cf push sentiment-analysis-frontend -b staticbuildpack -p build -m 256M -i 1 </span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/61c721d6909c9965e68e7b3a55c8e255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jGH2VIjm-7GcYC1NhMNyvQ.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用cf推送部署应用程序</figcaption></figure><p id="20d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">阅读<a class="ae kw" href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#push" rel="noopener ugc nofollow" target="_blank"> CF CLI文档</a>【9】了解更多命令行参数。</p><p id="1310" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您还可以创建一个<a class="ae kw" href="https://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html" rel="noopener ugc nofollow" target="_blank">部署清单文件</a> [10],以便于部署，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="1d73" class="le lf iq mf b gy nk nl l nm nn">---<br/>applications:<br/>- name: sentiment-analysis-frontend<br/>  buildpack: staticfile_buildpack<br/>  path: build<br/>  memory: 256M<br/>  env:<br/>    WEB_APP_URL: <a class="ae kw" href="http://sentiment-analysis-webapp.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-webapp.cfapps.io</a></span></pre><p id="e8ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并且只需用<code class="fe mc md me mf b">cf push</code>就能推送应用。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/093b0c857f68e9401c34dc3a15dea61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CyTlwHhwp-wDYil2Cuxoug.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用manifest.yml部署应用程序</figcaption></figure><p id="298b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您的应用程序已准备好接受测试，例如<a class="ae kw" href="http://sentiment-analysis-frontend.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://opinion-analysis-frontend . cf apps . io</a></p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/dfbcd34ca7633376ea21e1c6ac6cfed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UrvMRSVT33ga9_ykRZ3qwQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">部署的sa前端应用程序</figcaption></figure><p id="d1d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意到<code class="fe mc md me mf b">sa-webapp</code>尚未部署，从<code class="fe mc md me mf b">sa-frontend</code>到<code class="fe mc md me mf b">sa-webapp</code>的JavaScript请求导致404错误。接下来我们将部署<code class="fe mc md me mf b">sa-webapp</code>。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="0780" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">构建和部署Spring Boot应用程序</h2><p id="f2b8" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">情绪分析Webapp ( <code class="fe mc md me mf b">sa-webapp</code>)是一个Spring Boot应用程序，自然地<strong class="ka ir"> <em class="nu">在Cloud Foundry应用程序运行时运行得非常好</em> </strong>，开箱即用。</p><p id="a1fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要建立一个应用程序。Rinor的app使用Maven <code class="fe mc md me mf b">pom.xml</code>来定义依赖关系，所以我们可以使用<code class="fe mc md me mf b">mvn clean install</code>或者<code class="fe mc md me mf b">./mvnw clean install</code>来构建app。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/fabf6e2a1dd47e1900534fa3d77e16c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wJD6fYCrVAvQSksGsYgQ9A.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用Maven mvn构建sa-webapp</figcaption></figure><p id="0cce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要推送app，我们一般用<code class="fe mc md me mf b">cf push</code>就可以了。因为这个应用程序需要设置环境变量，所以我们需要使用不启动选项来推送应用程序，设置环境变量，然后启动应用程序，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="ab84" class="le lf iq mf b gy nk nl l nm nn">cf push sentiment-analysis-webapp -p target/sentiment-analysis-web-0.0.1-SNAPSHOT.jar --no-start<br/>cf set-env sentiment-analysis-webapp sa.logic.api.url <a class="ae kw" href="http://sentiment-analysis-logic.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-logic.cfapps.io</a><br/>cf start sentiment-analysis-webapp</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/be2f1d49055bd0f97f6d54093767e3a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4SfRkjjttVGZp9ce87ODLw.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用cf push从命令行部署sa-webapp</figcaption></figure><p id="1ff7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，我们可以使用部署清单来更好地描述<code class="fe mc md me mf b">manifest.yml</code>中的部署属性，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="063a" class="le lf iq mf b gy nk nl l nm nn">---<br/>applications:<br/>- name: sentiment-analysis-webapp<br/>  path: target/sentiment-analysis-web-0.0.1-SNAPSHOT.jar<br/>  env:<br/>    sa.logic.api.url: <a class="ae kw" href="http://sentiment-analysis-logic.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-logic.cfapps.io</a></span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/6a38a84664188dbb98825524abf9f7a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MDqPS2XlQ4SupSLL4uqG8Q.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用清单部署sa-webapp</figcaption></figure><p id="38ce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我们在部署清单中将<code class="fe mc md me mf b">sa-logic</code>应用程序URL作为环境变量传入，以便Spring Boot应用程序可以获取它并配置webapp服务RestTemplate来调用后端逻辑。</p><p id="18a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，请注意，我们不需要指定要使用的buildpack，因为Java buildpack会被自动识别(如果我们正在推送一个JAR / WAR文件)。</p><p id="9c20" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们需要构建第三个组件，为Python Flask中构建的情感分析逻辑服务。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="d378" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">构建和部署Python Flask应用程序</h2><p id="8b90" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">与前两个微服务类似，我们可以使用<code class="fe mc md me mf b">python_buildpack</code>轻松部署一个Python应用<code class="fe mc md me mf b">sa-logic</code>。我们需要做一些改动，以使应用程序更加“云原生”并易于部署到Cloud Foundry应用程序运行时。</p><p id="d2a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要添加引用<code class="fe mc md me mf b">punkt</code>包(一行程序)的<code class="fe mc md me mf b">sa/nltk.txt</code>，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="5e08" class="le lf iq mf b gy nk nl l nm nn">punkt</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/5120a5bbf66601f0658d28d916ad4a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*v3Z7Dqs7BWR0klES6JHRFg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">通过添加nltk.txt构建sa逻辑</figcaption></figure><p id="06d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还需要修改Python代码，将网络绑定添加到<code class="fe mc md me mf b">PORT</code>环境变量中，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="8ebd" class="le lf iq mf b gy nk nl l nm nn">from textblob import TextBlob<br/>from flask import Flask, request, jsonify</span><span id="910a" class="le lf iq mf b gy np nl l nm nn"><strong class="mf ir">import os</strong></span><span id="cb61" class="le lf iq mf b gy np nl l nm nn">app = Flask(__name__)</span><span id="b40a" class="le lf iq mf b gy np nl l nm nn"><strong class="mf ir">port = int(os.getenv("PORT"))</strong></span><span id="4ca4" class="le lf iq mf b gy np nl l nm nn"><a class="ae kw" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route("/analyse/sentiment", methods=['POST'])<br/>def analyse_sentiment():<br/>    sentence = request.get_json()['sentence']<br/>    polarity = TextBlob(sentence).sentences[0].polarity<br/>    return jsonify(<br/>        sentence=sentence,<br/>        polarity=polarity<br/>    )</span><span id="d99c" class="le lf iq mf b gy np nl l nm nn">if __name__ == '__main__':<br/>    app.run(host='0.0.0.0', port=<strong class="mf ir">port</strong>)</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/25ca06d157507bea2c3189d4607601a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*j26XJCwzFgkBN9TQawyKfg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">通过修改sa/sensation _ analysis . py构建sa逻辑</figcaption></figure><p id="372c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们准备使用<code class="fe mc md me mf b">cf push</code>将Python应用程序推送到Cloud Foundry应用程序运行时</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="db9d" class="le lf iq mf b gy nk nl l nm nn">cf push sentiment-analysis-logic -b python_buildpack -p sa -m 256M -c python sentiment_analysis.py</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/f25469fb1e7ab2f5e05ba9901a8a42c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*asDZ-m_Crfe7cUHnU7WPDg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用cf push从命令行部署sa逻辑</figcaption></figure><p id="93b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，我们可以在一个<code class="fe mc md me mf b">manifest.yml</code>文件中定义部署属性，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="35a9" class="le lf iq mf b gy nk nl l nm nn">---<br/>applications:<br/>- name: sentiment-analysis-logic<br/>  buildpack: python_buildpack<br/>  path: sa<br/>  command: python sentiment_analysis.py<br/>  memory: 256M</span></pre><p id="ad04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，部署变得非常简单，例如<code class="fe mc md me mf b">cf push</code></p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/8eb8d76f9f00a3f143449619e83e82d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fiapLpg1VLgBI-13amEwPQ.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用manifest.yml部署sa逻辑</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="f15b" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">把所有的放在一起</h2><p id="83eb" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们已经在生产平台上部署了三个微服务组件(应用程序)。很容易独立操作和管理所有应用程序，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="3a49" class="le lf iq mf b gy nk nl l nm nn">cf apps</span><span id="516f" class="le lf iq mf b gy np nl l nm nn">cf app sentiment-analysis-frontend<br/>cf app sentiment-analysis-webapp<br/>cf app sentiment-analysis-logic</span><span id="ee3a" class="le lf iq mf b gy np nl l nm nn">cf stop sentiment-analysis-frontend<br/>cf start sentiment-analysis-frontend<br/>cf restart sentiment-analysis-frontend<br/>cf restage sentiment-analysis-frontend</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/f0cfdad823a03e1f3b1a60081400b7ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y9ccAOIBUbgz_CvswIrCLA.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">使用cf CLI操作和管理微服务</figcaption></figure><p id="eba1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">平台为所有应用程序提供集成日志记录，包括最近的条目(类似于<code class="fe mc md me mf b">tail LOGFILE</code>)和对日志的持续观察(类似于<code class="fe mc md me mf b">tail -f LOGFILE</code>)，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="3ea0" class="le lf iq mf b gy nk nl l nm nn">cf logs sentiment-analysis-webapp<br/>cf logs sentiment-analysis-webapp --recent</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/adc6830281be7f80bb7a03b356158db7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*AvLhvLxlTqWfATbQB9s46Q.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">从应用程序获取流式日志</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/bb1084dbc4443060f986c13952f5d146.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Enplpsc1JPr-L6iXiuNpVg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">从应用程序获取最近的日志</figcaption></figure><p id="cc99" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Platform还提供了一种简单的方法来独立地扩展应用程序，包括许多实例、调整容器内存大小、磁盘大小等。</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="0aad" class="le lf iq mf b gy nk nl l nm nn">cf scale sentiment-analysis-logic -i 2<br/>cf scale sentiment-analysis-frontend -m 128M<br/>cf scale sentiment-analysis-frontend -i 4</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/ed988c5ea97c27f654fcf7c6d01500a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EYS8NoGPgp3EturXXWRw1Q.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">扩展sa逻辑应用程序(实例数量为2)</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/7d316a2f294e2f4c8b7b9d0d16131440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*sw3L7VKtyRcl9B1etKEB-Q.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">扩展sa前端应用程序(内存大小为128M，实例数量为4个)</figcaption></figure><p id="5cdd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该平台还提供了许多其他现成的东西，例如自动伸缩、自助服务市场、弹性、健康检查、负载平衡以及我们期望从生产级平台获得的许多其他有用功能。</p><p id="5215" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要探索的最后一件事是把所有的放在一起，并且可能用一个清单文件和一个<code class="fe mc md me mf b">cf push</code>命令推动所有三个应用程序。</p><p id="6dea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们在项目的根目录下构建一个单独的<code class="fe mc md me mf b">manifest.yml</code>文件，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="8924" class="le lf iq mf b gy nk nl l nm nn"><strong class="mf ir">manifest.yml</strong><br/>sa-frontend/manifest.yml<br/>sa-logic/manifest.yml<br/>sa-webapp/manifest.yml</span></pre><p id="ea0e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要为每个应用程序更新<code class="fe mc md me mf b">path</code>属性。同样，让我们调整内存的大小和实例的数量，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="d8c0" class="le lf iq mf b gy nk nl l nm nn">---<br/>applications:<br/>- name: sentiment-analysis-frontend<br/>  buildpack: staticfile_buildpack<br/>  path: <strong class="mf ir">sa-frontend</strong>/build<br/>  <strong class="mf ir">memory: 128M</strong><br/>  <strong class="mf ir">instances: 4</strong><br/>  env:<br/>    WEB_APP_URL: <a class="ae kw" href="http://sentiment-analysis-webapp.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-webapp.cfapps.io</a><br/>- name: sentiment-analysis-webapp<br/>  path: <strong class="mf ir">sa-webapp</strong>/target/sentiment-analysis-web-0.0.1-SNAPSHOT.jar<br/>  <strong class="mf ir">instances: 1</strong><br/>  <strong class="mf ir">memory: 1GB</strong><br/>  env:<br/>    sa.logic.api.url: <a class="ae kw" href="http://sentiment-analysis-logic.cfapps.io" rel="noopener ugc nofollow" target="_blank">http://sentiment-analysis-logic.cfapps.io</a><br/>- name: sentiment-analysis-logic<br/>  buildpack: python_buildpack<br/>  path: <strong class="mf ir">sa-logic</strong>/sa<br/>  command: python sentiment_analysis.py<br/>  <strong class="mf ir">memory: 256M</strong><br/>  <strong class="mf ir">instances: 2</strong></span></pre><p id="280c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们可以用一个清单文件和一个命令部署所有三个应用程序，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="76d2" class="le lf iq mf b gy nk nl l nm nn">cf push</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/9e2ee4c28d09672e59f64364363b8d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*adqf3cOS9jaB9mRB6goirg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">一键部署所有三款应用</figcaption></figure><p id="bd95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以检查部署的应用程序，并测试它们是否部署成功，例如</p><pre class="mv mw mx my gt ng mf nh ni aw nj bi"><span id="4fff" class="le lf iq mf b gy nk nl l nm nn">cf apps</span><span id="efab" class="le lf iq mf b gy np nl l nm nn">cf app sentiment-analysis-frontend<br/>cf app sentiment-analysis-webapp<br/>cf app sentiment-analysis-logic</span></pre><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/bda6da06e49edbeca4bd420c39d545d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*o8XeDIjvULYqMyykOg__mg.gif"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">验证三个微服务部署是否正确</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="409f" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">开发者门户(AppsManager)</h2><p id="49e9" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们已经看到了CF命令行界面(CLI)和开发人员API。Pivotal Web Services (PWS)和Pivotal Application Service (PAS)还提供PCF Apps Manager，这是一个GUI开发人员门户，提供与CF CLI类似的功能。您可以管理和操作应用程序，缩放它们，观察日志，并利用每个开发人员都渴望的许多其他有用的功能！</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/0203b74d0093163126abe28a67e00ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-G151Y4K5neEC8YgwDH5Jw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::应用程序管理器::空间视图</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/637e9dbaf4cf7b3843e3fb526c7d1ddb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0zIvmOlbpI9Tws_TBUiPgg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::应用程序管理器::应用程序视图</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/d4c9364ae8ed1e3f5b3cdea47b02e75c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHvmPr4SAohnp1jWT7b-TA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::应用程序管理器::日志视图</figcaption></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/09b3139a8a382d95c7a005529ea93342.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mRPh8C37n5HPveVb39h5sA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal应用程序服务::应用程序管理器::组织视图</figcaption></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="902c" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">PCF指标</h2><p id="461c" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">Pivotal Web服务(PWS)和Pivotal应用服务(PAS)包括用于观察和关联指标和日志的<a class="ae kw" href="http://docs.pivotal.io/pcf-metrics/1-4/using.html" rel="noopener ugc nofollow" target="_blank"> PCF指标</a> [12]组件，包括监控和警报功能。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/c4f9070144c92ca2e6bc9b38936670cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oj9KuPsXTZsVDbFefqNQHQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">Pivotal Web服务::PCF指标</figcaption></figure><p id="74ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在PWS/PAS平台中有很多其他的开发者糖果，但是那是另一次讨论的主题…</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="b8d7" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">摘要</h2><p id="193d" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们已经使用了三个简单的(无状态)微服务(都是用不同的编程语言编写的)，并展示了如何将它们推送到应用运行时(例如Pivotal应用服务)。</p><p id="6109" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将无状态应用程序部署到生产平台上非常容易，只需对应用程序代码做最少的更改。使用定义良好的属性，部署清单使得推送应用程序代码变得更加容易:<code class="fe mc md me mf b">cf push</code></p><p id="a700" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用程序运行时对应用程序的无状态本质做出假设，并优化运行时以提高开发人员的生产力和运营效率。使用应用程序运行时的开发人员不需要构建和维护Docker映像、K8s服务描述符、K8s部署描述符、配置日志记录、配置DNS、配置SSL证书、配置负载平衡以及平台提供的其他许多现成的东西。</p><p id="d3b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">容器运行时(Kubernetes)提供了许多类似的功能，具有更大的开发人员灵活性和进一步定制部署的能力，但代价是平台标准化、开发人员生产力和操作效率。权力越大，责任越大。开发人员不想担心管理和操作容器映像、运行时二进制文件和其他基础设施管道，除非有令人信服的理由，他们必须这样做。</p><p id="b5e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">应用运行时为无状态应用打造了一个<a class="ae kw" href="https://medium.com/@doctor_julz/cf-vs-kube-is-the-difference-who-creates-the-container-f2189960f98c" rel="noopener">伟大的多租户平台，并允许</a><a class="ae kw" href="https://twitter.com/onsijoe/status/598235841635360768?lang=en" rel="noopener ugc nofollow" target="_blank">开发者梦想俳句</a>【13】:</p><blockquote class="od"><p id="db3d" class="oe of iq bd og oh oi oj ok ol om kv dk translated"><strong class="ak">这里是我的源代码</strong></p><p id="223f" class="oe of iq bd og oh oi oj ok ol om kv dk translated"><strong class="ak">帮我在云上运行一下</strong></p><p id="ff2b" class="oe of iq bd og oh oi oj ok ol om kv dk translated"><strong class="ak">我不在乎如何</strong></p></blockquote></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="cf3a" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated"><strong class="ak">免责声明</strong></h2><p id="d683" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我在<a class="ae kw" href="https://pivotal.io" rel="noopener ugc nofollow" target="_blank">Pivotal Software Inc .</a>【14】工作，该公司负责<a class="ae kw" href="https://pivotal.io/platform" rel="noopener ugc nofollow" target="_blank">Pivotal Cloud Foundry</a>【15】平台，包括<a class="ae kw" href="https://pivotal.io/platform/pivotal-application-service" rel="noopener ugc nofollow" target="_blank">应用运行时(Pivotal应用服务)</a>【16】和<a class="ae kw" href="https://pivotal.io/platform/pivotal-container-service" rel="noopener ugc nofollow" target="_blank">容器运行时(Pivotal容器服务)</a>【17】。</p><p id="f931" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">意见是我的，不是我雇主的。</p><h2 id="74fe" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">参考</h2><p id="542d" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">[1]<a class="ae kw" href="https://medium.freecodecamp.org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestrating-containers-114ff420e882" rel="noopener ugc nofollow" target="_blank">https://medium . freecodecamp . org/learn-kubernetes-in-under-3-hours-a-detailed-guide-to-orchestration-containers-114 ff 420 e882</a></p><p id="de5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://rinormaloku.com/" rel="noopener ugc nofollow" target="_blank">https://rinormaloku.com/</a></p><p id="deff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[3]<a class="ae kw" href="https://github.com/rinormaloku/k8s-mastery" rel="noopener ugc nofollow" target="_blank">https://github.com/rinormaloku/k8s-mastery</a></p><p id="6e78" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://github.com/nevenc-pivotal/k8s-mastery" rel="noopener ugc nofollow" target="_blank">https://github.com/nevenc-pivotal/k8s-mastery</a></p><p id="ade1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[5]<a class="ae kw" href="https://www.cloudfoundry.org/blog/how-to-try-cloud-foundry-2018/" rel="noopener ugc nofollow" target="_blank">https://www . cloud foundry . org/blog/how-to-try-cloud-foundry-2018/</a></p><p id="2ccf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[6]<a class="ae kw" href="https://run.pivotal.io" rel="noopener ugc nofollow" target="_blank">https://run . pivotal . io</a></p><p id="eb95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[7]<a class="ae kw" href="https://console.run.pivotal.io" rel="noopener ugc nofollow" target="_blank">https://console . run . pivotal . io</a></p><p id="ebfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://console.run.pivotal.io/tools" rel="noopener ugc nofollow" target="_blank">https://console.run.pivotal.io/tools</a></p><p id="ffe8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[9]<a class="ae kw" href="https://docs.cloudfoundry.org/cf-cli/getting-started.html#push" rel="noopener ugc nofollow" target="_blank">https://docs . cloud foundry . org/cf-CLI/getting-started . html # push</a></p><p id="80c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[10]<a class="ae kw" href="https://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html" rel="noopener ugc nofollow" target="_blank">https://docs . cloud foundry . org/dev guide/deploy-apps/manifest . html</a></p><p id="cfc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[11]<a class="ae kw" href="https://medium.com/@doctor_julz/cf-vs-kube-is-the-difference-who-creates-the-container-f2189960f98c" rel="noopener">https://medium . com/@ doctor _ julz/cf-vs-kube-is-the-difference-who-created-the-container-f 2189960 f98c</a></p><p id="42d5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[12]<a class="ae kw" href="http://docs.pivotal.io/pcf-metrics/1-4/using.html" rel="noopener ugc nofollow" target="_blank">http://docs.pivotal.io/pcf-metrics/1-4/using.html</a></p><p id="255c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[13]https://twitter.com/onsijoe/status/598235841635360768?<a class="ae kw" href="https://twitter.com/onsijoe/status/598235841635360768?lang=en" rel="noopener ugc nofollow" target="_blank">lang=en </a></p><p id="0a5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[14] <a class="ae kw" href="https://pivotal.io" rel="noopener ugc nofollow" target="_blank"> https://pivotal.io </a></p><p id="ba33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">[15]<a class="ae kw" href="https://pivotal.io/platform" rel="noopener ugc nofollow" target="_blank">https://pivotal.io/platform</a></p><p id="f842" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://pivotal.io/platform/pivotal-application-service" rel="noopener ugc nofollow" target="_blank">https://pivotal.io/platform/pivotal-application-service</a></p><p id="d9f0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://pivotal.io/platform/pivotal-container-service" rel="noopener ugc nofollow" target="_blank">https://pivotal.io/platform/pivotal-container-service</a></p></div></div>    
</body>
</html>