<html>
<head>
<title>How to mine Monero in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在GCP开采Monero</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-mine-monero-in-gcp-d2b1f40497f7?source=collection_archive---------0-----------------------#2021-09-25">https://itnext.io/how-to-mine-monero-in-gcp-d2b1f40497f7?source=collection_archive---------0-----------------------#2021-09-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b078" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在GCP开采monero矿的实用指南，以及如何逃脱。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/144bd1dde429c0314c4b8212dab546d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QTKYnUQ5twCmDfs-"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae lb" href="https://unsplash.com/@dominik_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">张秀坤·万尼</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="b2e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，声明:根据GCP的“可接受使用”政策，开采加密货币是不允许的。如果你被抓住，你的项目<strong class="jp ir">将</strong>暂停。</p><p id="ca6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将介绍如何在GKE集群中挖掘Monero，同时避免这种情况，并研究Google用来检测挖掘操作的检测机制。</p><p id="d375" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我是在GKE做的，所以图形可能有多条线，显示每个节点的总CPU消耗，但是挖掘本身并不依赖于Kubernetes。该方法基于在野外发现的加密劫持活动，其中我们劫持了在Kubernetes pod中运行的应用程序，并运行shell脚本，该脚本从官方repo和配置文件中提取最新的XMrig二进制文件，使该二进制文件可执行，并运行:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="c43e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切都好了几个小时，直到你被其中一个击中:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi le"><img src="../Images/a877811644dbbfc825f108aa8891cb44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YndfxOwYa-dwJQ16LtgPwg.png"/></div></div></figure><p id="18aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧，所以让XMrig吞噬95%的CPU并不是世界上最好的主意。那么，把它限制在30%怎么样？这么说吧，那个项目也被暂停了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lf"><img src="../Images/7446b5959c6017c281766e8154fdaf8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHyS4v58YOojcnnRl5fmTQ.png"/></div></div></figure><p id="b3c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还浏览了GCP安全中心的<a class="ae lb" href="https://cloud.google.com/blog/products/identity-security/detect-and-respond-to-high-risk-threats-in-your-logs-with-google-cloud" rel="noopener ugc nofollow" target="_blank">产品页面，解释说:</a></p><blockquote class="lg lh li"><p id="c757" class="jn jo lj jp b jq jr js jt ju jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj kk ij bi translated">事件威胁检测通过检查VPC日志中与已知不良域的连接来检测硬币挖掘恶意软件，以获取挖掘池和其他日志数据。</p></blockquote><p id="a9c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">记住XMrig应用程序的信息量有多大，我决定通过将stdout发送到/dev/null并将stderr重定向到stdout来将这些日志发送到void:<br/>`&gt;/dev/null 2&gt;&amp;1 '</p><p id="6fdd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并通过TLS将流量发送到挖掘池。这个池被改成了支持TLS的池，一个<a class="ae lb" href="https://www.inet.no/dante/" rel="noopener ugc nofollow" target="_blank"> dante socks代理</a>被设置在一个数字海洋水滴中。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="f709" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但丁被设定为允许一切:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="ad7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但这也遭到了友好的“请求上诉”——这种信息我现在已经太习惯了..</p><p id="db50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的。因此通信被加密，日志被删除，CPU消耗被调节。因此，这意味着连续操作是不可行的。让我们用一个超时函数来打破消费模式，该函数挖掘10到60分钟，然后休眠10到80分钟:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ln"><img src="../Images/814d1bc76ea9f78284f6703784175f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hY9KRS8hEBmLeXSb0ayeuw.png"/></div></div></figure><p id="2b0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，pod不再持续采矿，CPU消耗图看起来好了很多，并被允许在暂停前运行约17个小时。直到我发现了法比奥·戈麦斯和米格尔·科雷拉写的一篇文章，名为<a class="ae lb" href="https://www.gsd.inesc-id.pt/~mpc/pubs/cryptojacking-nca20-final.pdf" rel="noopener ugc nofollow" target="_blank"> <em class="lj">带CPU使用指标的密码劫持检测</em> </a>，我才明白CPU消耗图仍然是太方形了。</p><p id="d83f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了打破图表并挑战Gomes和Correia的发现，我们现在通过为时间间隔和CPU使用设置最小和最大阈值来进一步打破挖掘间隔和CPU消耗，然后根据时间选择CPU限制。较长的时间间隔意味着较低的CPU消耗，而较短的时间间隔允许更密集的挖掘:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lo"><img src="../Images/dba2c626d778871a7684a01295b80e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6LK4YBOtVarmuaxQ9XvT9A.png"/></div></div></figure><p id="a1f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然牺牲了很多散列率，但这种方法变得<strong class="jp ir">更好，现在已经变得不可检测。值得注意的是，这个脚本需要‘jq’来重写config.json文件。如果有人找到了用“sed”或“awk”来做这件事的方法，请联系我！</strong></p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lp"><img src="../Images/88e06378a7503c09d1fa90b390cff97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90mcThNl2N_sV9TO7As0nA.png"/></div></div></figure><h2 id="4312" class="lq lr iq bd ls lt lu dn lv lw lx dp ly jy lz ma mb kc mc md me kg mf mg mh mi bi translated">结论</h2><p id="7a44" class="pw-post-body-paragraph jn jo iq jp b jq mj js jt ju mk jw jx jy ml ka kb kc mm ke kf kg mn ki kj kk ij bi translated">在撰写本文时，在用完信用之前，挖掘操作在由两个e2-standard-4节点(每个节点4个vCPUs和16GB RAM)组成的GKE集群中运行了4天。平均哈希速率约为200小时/秒，相当于0.0004 xmr/天。所以你不会变得富有，但它表明，绕过谷歌的可接受使用强制执行程序，在GCP开采加密货币并使用免费信用来这样做是完全可能的。谷歌意识到了这些发现。</p></div></div>    
</body>
</html>