<html>
<head>
<title>How to Improve your Angular application’s performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何提高Angular应用程序的性能</h1>
<blockquote>原文：<a href="https://itnext.io/improve-your-angular-apps-performance-66032f63dc09?source=collection_archive---------1-----------------------#2019-02-28">https://itnext.io/improve-your-angular-apps-performance-66032f63dc09?source=collection_archive---------1-----------------------#2019-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="71be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">充分利用Angular的性能。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4c1d4615b95d5e23e5c86f565711fac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WZqDu2qAZGLMqBg1h5sIg.png"/></div></div></figure><h1 id="9cca" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">减少您的包裹大小</h1><p id="a17c" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果不需要支持老浏览器，就掉ES5支持。所有现代浏览器都支持ES6。</p><ol class=""><li id="9f0d" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated">转到您的<code class="fe mj mk ml mm b">tsconfig.json</code>，将“目标”从es5更改为es6</li><li id="49ff" class="ma mb iq jp b jq mn ju mo jy mp kc mq kg mr kk mf mg mh mi bi translated">当构建你的应用程序时，使用<code class="fe mj mk ml mm b">--es5-browser-support=false</code>和<code class="fe mj mk ml mm b">ng build</code>从你的包中排除es5浏览器聚合填充，或者从<code class="fe mj mk ml mm b">angular.json</code>中将其永久设置为false。</li><li id="e029" class="ma mb iq jp b jq mn ju mo jy mp kc mq kg mr kk mf mg mh mi bi translated">从应用中移除未使用的依赖项。</li><li id="401f" class="ma mb iq jp b jq mn ju mo jy mp kc mq kg mr kk mf mg mh mi bi translated">让你的角服务树摇动。不要将它们导入并添加到你的ngModule中的<code class="fe mj mk ml mm b">providers</code>数组中。相反，在用<code class="fe mj mk ml mm b">@Injectable()</code>装饰您的服务时，使用<code class="fe mj mk ml mm b">providedIn</code>属性，只有当它被注入或用于任何其他组件/服务时，才让它包含在包中，如下所示</li></ol><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="3aea" class="mw ky iq mm b gy mx my l mz na">@Injectable({<br/>  providedIn: 'root'<br/>})<br/>export class MyService {}</span></pre><p id="19f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.使用差动加载。如果您使用的是Angular version 8+版本，您应该能够使用差异加载来避免向现代浏览器提供不必要的聚合填充。只需将包含以下内容的browserslist文件添加到您的项目中，并注释掉除zone.js之外的所有从<code class="fe mj mk ml mm b">src/pollyfills.ts</code>导入的内容，并确保您的tsconfig.json中有“<code class="fe mj mk ml mm b">target": “es2015"</code>。</p><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="5f2d" class="mw ky iq mm b gy mx my l mz na">&gt; 0.5%<br/>last 2 versions<br/>Firefox ESR<br/>Chrome 41 # Support for Googlebot<br/>not dead<br/>not IE 9-11 # For IE 9-11 support, remove 'not'.</span></pre><p id="84f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.启用常春藤<a class="ae nb" href="https://next.angular.io/guide/ivy" rel="noopener ugc nofollow" target="_blank">https://next.angular.io/guide/ivy</a></p><h1 id="90d1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">延迟加载和代码分割</h1><p id="8346" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">有了Angular，就可以非常容易地基于路由对模块进行延迟加载</p><p id="bd49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">代替</p><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="0612" class="mw ky iq mm b gy mx my l mz na">// app-routing.module.ts<br/>const routes: Routes = [{</span><span id="912d" class="mw ky iq mm b gy nc my l mz na">  path: home',</span><span id="c84d" class="mw ky iq mm b gy nc my l mz na">  component: HomeComponent</span><span id="51f7" class="mw ky iq mm b gy nc my l mz na">  }, {</span><span id="5a38" class="mw ky iq mm b gy nc my l mz na">  path: 'about',</span><span id="73b9" class="mw ky iq mm b gy nc my l mz na">  component: AboutComponent<br/> }, {</span><span id="09b5" class="mw ky iq mm b gy nc my l mz na">  path: '',</span><span id="0288" class="mw ky iq mm b gy nc my l mz na">  redirectTo: 'home',</span><span id="ed22" class="mw ky iq mm b gy nc my l mz na">  pathMatch: 'full'<br/>}]</span></pre><p id="bf19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用</p><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="946b" class="mw ky iq mm b gy mx my l mz na">// app-routing.module.ts<br/>const routes: Routes = [{</span><span id="4b40" class="mw ky iq mm b gy nc my l mz na">  path: home',</span><span id="c974" class="mw ky iq mm b gy nc my l mz na">  component: HomeComponent</span><span id="2eb3" class="mw ky iq mm b gy nc my l mz na">}, {</span><span id="0c48" class="mw ky iq mm b gy nc my l mz na">  path: 'about',</span><span id="d30b" class="mw ky iq mm b gy nc my l mz na">  loadChildren: './about/about.module#AboutModule'<br/>}, {</span><span id="95c9" class="mw ky iq mm b gy nc my l mz na">  path: '',</span><span id="5e66" class="mw ky iq mm b gy nc my l mz na">  redirectTo: 'home',</span><span id="8df5" class="mw ky iq mm b gy nc my l mz na">  pathMatch: 'full'<br/>}]</span></pre><p id="7512" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，我们没有延迟加载home组件，因为它是默认路径，这是初始加载所需要的。延迟加载将导致Angular触发另一个http请求，这实际上会损害我们应用程序的性能。</p><h1 id="17fa" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak">使用服务人员缓存资产</strong></h1><p id="73e8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">服务工作者是一项令人敬畏的技术，它允许您开发渐进式Web应用程序(PWA ),即使您不想构建PWA，也可以使用它们来缓存资产和HTTP请求，几乎可以实现即时加载。Angular使其非常容易通过angular-cli选择加入。</p><p id="948b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你要做的就是</p><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="4810" class="mw ky iq mm b gy mx my l mz na">ng add @angular/pwa</span></pre><p id="42e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:只有当你的网站支持HTTPS的时候，你才可以安装服务人员。</p><h1 id="5fd0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">避免内存泄漏</h1><p id="21b9" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">取消订阅您的事件监听器、observables和<code class="fe mj mk ml mm b">ngOnDestroy</code>中的<code class="fe mj mk ml mm b">setIntervals</code>，否则它们会留在内存中，即使您的组件被破坏，它们也会继续运行。</p><h1 id="816c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">去抖&amp;节流你的事件监听器</h1><p id="abc8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">如果您有一个频繁触发的事件，如输入更改事件或滚动事件，最好根据用例去抖或抑制事件监听器，以避免每帧多次运行逻辑，影响应用的FPS和性能。</p><h1 id="f95b" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">记忆和缓存昂贵的功能</h1><p id="2ae4" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这实际上不是角度特定的，但是如果你有被多次调用的昂贵的函数。您总是可以缓存结果并从缓存中返回结果，而不是再次计算结果。</p><h1 id="1f85" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最小化DOM元素</h1><p id="0837" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">不用创建你不需要的包装div，或者避免不能在同一个div上应用两个指令的问题，比如<code class="fe mj mk ml mm b">*ngIf</code>和<code class="fe mj mk ml mm b">*ngFor</code>，你可以使用<code class="fe mj mk ml mm b">&lt;ng-container&gt;</code>，它不会给你的树增加额外的DOM元素。</p><h1 id="4e85" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">优化变化检测</h1><p id="be83" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">这些变化需要对Angular以及变化检测的工作原理有更深入的了解。</p><ol class=""><li id="1768" class="ma mb iq jp b jq jr ju jv jy mc kc md kg me kk mf mg mh mi bi translated">使用<em class="nd"> OnPush </em> changeDetection。在组件中设置<code class="fe mj mk ml mm b">changeDetection:ChangeDetectionStrategy.OnPush</code>实际上是告诉Angular避免深入检查输入数组/对象，并且只在输入引用不相等的情况下运行组件子树的变化检测。这可以节省框架进行深度相等检查的时间，以及该组件和该组件的所有其他子组件的变更检测时间，这些子组件将因此被标记为脏的。</li><li id="555a" class="ma mb iq jp b jq mn ju mo jy mp kc mq kg mr kk mf mg mh mi bi translated">通过使用<em class="nd">轨迹。如果您使用可能随时间变化的<code class="fe mj mk ml mm b">*ngFor</code>来呈现一个项目数组，您可以告诉Angular将每个DOM元素与该数组中某个项目的值绑定在一起，比如项目的id。下次数组改变时，Angular将只呈现/更新改变的项目，而不是重新呈现整个DOM元素数组。</em></li><li id="2032" class="ma mb iq jp b jq mn ju mo jy mp kc mq kg mr kk mf mg mh mi bi translated">使用<em class="nd">ng zone . runoutsidangeral .</em>如果您在组件中使用类似<code class="fe mj mk ml mm b">setTimeout</code>、<code class="fe mj mk ml mm b">setInterval</code>和<code class="fe mj mk ml mm b">Promise</code>的异步API，这些API不会在回调中改变组件的状态，也不需要触发更改检测，您可以告诉Angular在执行回调时不要触发更改检测。</li></ol><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="0660" class="mw ky iq mm b gy mx my l mz na">ngZone.runOutsideAngular(() =&gt; {<br/>  setTimeout(() =&gt; {<br/>    doSomethingThatDoesntUpdateState()</span><span id="81c0" class="mw ky iq mm b gy nc my l mz na">  }, 5000)</span><span id="8941" class="mw ky iq mm b gy nc my l mz na">})</span></pre><p id="24fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者从您的应用程序中完全禁用ngZone，并使用<code class="fe mj mk ml mm b">applicationRef.tick() </code>手动触发异步javascript APIs的变更检测，以获得更高级的用例</p><pre class="km kn ko kp gt ms mm mt mu aw mv bi"><span id="5358" class="mw ky iq mm b gy mx my l mz na">platformBrowserDynamic().bootstrapModule(AppModule, {<br/>      ngZone: 'noop';<br/>})</span></pre><h1 id="06b8" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="efb5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">您还可以做其他事情来优化您的应用程序的性能，其中大多数已经默认启用，如Pure Pipes、enableProdMode、AOT和带有<code class="fe mj mk ml mm b">ng build --prod</code>的构建优化器。</p><p id="a92a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章的灵感来自<a class="ne nf ep" href="https://medium.com/u/a7db01a91fcb?source=post_page-----66032f63dc09--------------------------------" rel="noopener" target="_blank"> Minko Gechev </a>写的<a class="ae nb" href="https://github.com/mgechev/angular-performance-checklist" rel="noopener ugc nofollow" target="_blank">角度性能清单</a>，如果你对你可以做的其他性能优化和更详细的解释感兴趣，你应该看看。</p></div><div class="ab cl ng nh hu ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="ij ik il im in"><p id="dc90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢我的内容，愿意支持我，你可以<a class="ae nb" href="https://www.buymeacoffee.com/khaledosman" rel="noopener ugc nofollow" target="_blank">请我喝啤酒</a></p></div></div>    
</body>
</html>