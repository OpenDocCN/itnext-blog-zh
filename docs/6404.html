<html>
<head>
<title>How to create Web Server in Browser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在浏览器中创建Web服务器</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-create-web-server-in-browser-ffaa371d2b53?source=collection_archive---------2-----------------------#2021-11-08">https://itnext.io/how-to-create-web-server-in-browser-ffaa371d2b53?source=collection_archive---------2-----------------------#2021-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9780" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你有没有想过能否在浏览器中构建一个web服务器？或者更准确地说，创建文件并使用URL将它们作为静态资产提供服务。在本文中，我将解释如何做到这一点。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/aa2561c665baa3befbb78d3f4e848399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a9k46tkTk9yN8TkORo8f2g.jpeg"/></div></div></figure><h1 id="17a1" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">我关于这个问题的故事</h1><p id="25a7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">当我使用名为<a class="ae ma" href="https://jcubic.github.io/git" rel="noopener ugc nofollow" target="_blank"> GIT Web终端</a>的<a class="ae ma" href="https://isomorphic-git.org/" rel="noopener ugc nofollow" target="_blank">同构git </a>创建我的辅助项目时，它也使用了我的另一个开源库<a class="ae ma" href="https://terminal.jcubic.pl/" rel="noopener ugc nofollow" target="_blank"> jQuery终端</a>，我想在应用程序内部创建一个Web浏览器(使用iframe ),并允许它在一个新标签页中打开文件。我在想这样的事情是否可能。</p><h1 id="b715" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">服务行业人员</h1><p id="e8e0" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">然后我意识到，通常用于在<a class="ae ma" href="https://en.wikipedia.org/wiki/Progressive_web_application" rel="noopener ugc nofollow" target="_blank"> PWA </a>中缓存文件的<a class="ae ma" href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" rel="noopener ugc nofollow" target="_blank">服务器工作器</a>，可以用来动态生成新文件，并使用fetch事件将它们发送到浏览器。</p><h1 id="c1df" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">浏览器</h1><p id="9567" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了使用同构git，你需要一个库来给你类似文件系统对象的节点。对于我的GIT Web终端，我使用了BrowserFS，这是用于同构GIT的主要库，在<a class="ae ma" href="https://github.com/isomorphic-git/lightning-fs" rel="noopener ugc nofollow" target="_blank"> lightning-fs </a>之前，创建了专用的同构git fs实现。有了浏览器，你可以使用不同的后端，我正在寻找的东西，也将在服务工作者的工作。我找到了最合适的，索引为DB。</p><h1 id="af05" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">解决方案的代码</h1><p id="bf3e" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">代码非常简单，我决定使用前缀<strong class="jp ir"> __browserfs__ </strong>，其后的所有内容都是指向我的本地browserfs文件的路径，这样真实的文件和idexedDB中的文件就不会混淆。</p><p id="e0c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是完整的代码:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mb mc l"/></div></figure><p id="9c72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务人员允许使用自定义头和自定义HTTP响应，这里我使用了301重定向和404错误，以及一些带有适当内容类型头的基本HTML。</p><p id="e26f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要初始化服务人员，您可以使用以下代码:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="0644" class="mi ky iq me b gy mj mk l ml mm"><strong class="me ir">if</strong> ('serviceWorker' <strong class="me ir">in</strong> navigator) {<br/>  <strong class="me ir">var</strong> scope <strong class="me ir">=</strong> location.pathname.replace(/\/[^\/]+$/, '/');<br/>  <strong class="me ir">if</strong> (<strong class="me ir">!</strong>scope.match(/__browserfs__/)) {<br/>    navigator.serviceWorker.register('sw.js', {scope})<br/>      .then(<strong class="me ir">function</strong>(reg) {<br/>         reg.addEventListener('updatefound', function() {<br/>           <strong class="me ir">var</strong> installingWorker <strong class="me ir">=</strong> reg.installing;<br/>           console.log('A new service worker is being installed:',<br/>                       installingWorker);<br/>         });<br/>         <em class="mn">// registration worked</em><br/>         console.log('Registration succeeded. Scope is ' <strong class="me ir">+<br/>                    </strong>reg.scope);<br/>      }).<strong class="me ir">catch</strong>(function(error) {<br/>        <em class="mn">// registration failed</em><br/>        console.log('Registration failed with ' <strong class="me ir">+</strong> error);<br/>      });<br/>  }<br/>}</span></pre><p id="238e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以在您的项目中使用这些代码，并且您将在浏览器中拥有自己的web服务器。您还可以修改代码并添加新功能。如果你做了一些有趣的东西，请分享结果，并且请不要忘记在文件的顶部包括许可和我的版权(你可以在我的上面或下面包括你自己的版权)。这可能是创建一个好的库的起点，这个库可以做很多很酷的东西。</p><h1 id="d454" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">工作演示</h1><p id="72a5" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要查看工作演示，请访问我的项目<a class="ae ma" href="https://tinyurl.com/git-gaiman" rel="noopener ugc nofollow" target="_blank"> GIT Web终端</a>。当你打开那个链接时，它会打开web终端，克隆我的另一个项目repo(我的正在进行的编程语言叫做Gaiman)并在一个内置的浏览器中查看HTML文件。请注意，克隆需要一些时间，所以请耐心等待。</p><p id="9a22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您检查DOM，您将看到有一个iframe保存该文件，如果查看源文件，您将:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="9e99" class="mi ky iq me b gy mj mk l ml mm">/git/__browserfs__/gaiman/docs/demo/index.html</span></pre><p id="2e52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您也可以通过打开编辑器(如vi或emacs)直接在终端中创建文件:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="49c5" class="mi ky iq me b gy mj mk l ml mm">vi test.txt<br/>i Hello World :wq<br/>view test.txt</span></pre><p id="114a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您键入vi，编写一些文本并保存文件，您将能够在浏览器中查看它。</p><p id="9d1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">编辑:</strong>这个拥有纯浏览器内HTTP请求的技巧被抽象到了<a class="ae ma" href="https://github.com/jcubic/wayne" rel="noopener ugc nofollow" target="_blank">开源库Wayne </a>。</p><p id="40db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这个，你可以在Twitter上关注我:<a class="ae ma" href="https://twitter.com/jcubic" rel="noopener ugc nofollow" target="_blank"> @jcubic </a>。</p></div></div>    
</body>
</html>