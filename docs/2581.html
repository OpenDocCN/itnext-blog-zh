<html>
<head>
<title>Web Audio for Electric Guitar: Cabinet Emulation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电吉他网络音频:音箱仿真</h1>
<blockquote>原文：<a href="https://itnext.io/web-audio-for-electric-guitar-cabinet-emulation-b2a553b55f2b?source=collection_archive---------9-----------------------#2019-06-17">https://itnext.io/web-audio-for-electric-guitar-cabinet-emulation-b2a553b55f2b?source=collection_archive---------9-----------------------#2019-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/499910ae2eb1fa109f0d780c16499918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AgAgsfIb22EER9Xm.jpg"/></div></div></figure><p id="3446" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很难想象一个吉他手没有任何放大器或吉他音箱。更不用说没有任何扬声器，电吉他即使在家里也很难听到。今天我想展示如何使用网络音频API来模拟吉他音箱。使用卷积，无需数千美元的投资，就可以重现顶级品牌amp制造的声音。</p><p id="16aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/web-audio-for-electric-guitar-how-to-connect-instrument-24352df108ae">之前的帖子</a>中，我描述了使用网络音频在浏览器中获取电吉他声音的过程。今天，我将继续吉他音箱仿真系列。</p><p id="fcb5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">这个帖子是“电吉他网络音频”系列的一部分，也可以看看其他帖子！</em></p><h1 id="4e72" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">电吉他系列的网络音频:</h1><ol class=""><li id="fefd" class="lw lx iq ka b kb ly kf lz kj ma kn mb kr mc kv md me mf mg bi translated"><a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/web-audio-for-electric-guitar-how-to-connect-instrument-24352df108ae">如何连接仪器</a></li><li id="0cb1" class="lw lx iq ka b kb mh kf mi kj mj kn mk kr ml kv md me mf mg bi translated">机柜仿真—当前</li></ol><p id="637b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在家里玩电吉他时，它通常连接到一个单独的设备——放大器或带音箱的头。有很多著名的放大器生产商，他们每个人都有自己的“坚定”的声音。然而，使用数字声音处理，有可能使用一种称为<em class="kx">卷积</em>的过程以编程方式模拟它们。为简单起见，你可以把卷积想象成两个函数的乘法。当我们谈论声音卷积时，意味着将一些样本应用于现场输入。为了模拟吉他音箱，我们需要将这样一个从真实设备中录制的短样本应用到吉他声音中。那个样本称为<em class="kx">脉冲响应</em> (IR)。</p><h1 id="429f" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">脉冲响应</h1><p id="a2ae" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">脉冲响应是放大器脉冲特性的记录，如振幅或频率。例如，照片是相机在某个时候在胶片或数字矩阵上获得的光线的快照。你可以用同样的方式考虑脉冲响应。这是一个现场演讲者的快照。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a5d25e8170831aa2216d70061f04cd6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*n-uRfKeLbCrHgZNq.jpg"/></div></div></figure><p id="1d63" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，该快照仅限于记录一个特定的设置。我的意思是，在真正的放大器上，你有一堆控制，如音量或均衡器，根据放大器的配置，你会得到不同的脉冲响应。因此，您只能模拟具有特定配置的设备。然而，我们也可以使用网络音频实现均衡器。均衡给了我们一些灵活性来获得我们想要的声音形状。</p><h1 id="9003" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">卷积节点</h1><p id="cf1d" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">现在我们已经知道我们想要执行什么，是时候学习如何使用Web Audio API来实现它了。API在它提供的节点后面隐藏了大量的数学运算。卷积也不例外，我们有一个卷积器节点将脉冲响应应用于音频流:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="f440" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">卷积器节点有一个<code class="fe mv mw mx my b">buffer</code>选项，用于传递脉冲响应音频缓冲。您必须以浏览器能够理解的格式加载带有IR的音频文件。现代浏览器支持不同的格式，因为这些格式的许可。现代浏览器对WAV(除了不支持网络音频的IE之外)、AAC (Firefox只在MP4容器中支持它)、MP3、FLAC和OGG(除了IE和Safari之外)都有很好的支持。我考虑继续使用WAV，因为它得到了很好的支持，并且是一种无损的音频格式。质量在这里是至关重要的，因为我们使用的是非常短的记录，只有几个字节，压缩可能会在输出中产生伪像。</p><p id="3b3b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您想根据当前浏览器提供各种文件格式，您可以查看支持:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="51ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">包括IE 9+在内的所有浏览器都支持' canPlayType '方法。它返回一个具有3个可能值的字符串:<code class="fe mv mw mx my b">'maybe'</code>、<code class="fe mv mw mx my b">'probably'</code>和<code class="fe mv mw mx my b">''</code>。是的，它不能给你一个确切的答案🤣，只是概率上的一个。空字符串表示不支持该格式。<code class="fe mv mw mx my b">'maybe'</code> -不开始回放无法回答，还有<code class="fe mv mw mx my b">'probably'</code> -貌似可以。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/30bbb4da93bcc9f548e0967b4b76c69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Eu_g_BuSPNtDY7QD.jpg"/></div></div></figure><p id="b9d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可能会有一个合理的问题，你可以在哪里得到这些机柜的脉冲响应？你可以“做你的self"™️——但这种变体需要你有一个机柜本身和一堆附加设备，如电容麦克风、专业声卡等等。幸运的是，有许多专业工作室和爱好者制作的免费高质量脉冲响应。只需谷歌搜索“<a class="ae kw" href="https://www.google.com/search?q=free+cabinet+impulse+response&amp;rlz=1C5CHFA_enUA690UA690&amp;oq=free+cabinet+impulse+response" rel="noopener ugc nofollow" target="_blank">免费机柜脉冲响应</a>”即可找到并下载一个。如果你太懒了，你可以检查一下我用在一个应用程序上的<a class="ae kw" href="https://github.com/vitaliy-bobrov/js-rocks/tree/master/src/assets/impulses/cabinet" rel="noopener ugc nofollow" target="_blank">脉冲</a>。</p><p id="c1c1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了要处理的IR后，我们可以使用音频上下文和Fetch API将它加载并应用到卷积器节点:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="a8f5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">注意:如果您想多次重复使用同一个节点，在新的缓冲区设置后断开/连接卷积器节点是非常重要的。如果您在连接的节点上设置新的缓冲区，将使用旧的缓冲区，并且可能会出现音频故障。</em></p><p id="01b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们获取脉冲响应文件，然后将响应转换到数组缓冲区。我们不能在卷积器上直接应用缓冲区，在此之前，我们需要使用上下文对其进行解码。配置卷积器后，您可以将其链接到音频处理图中:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8b41" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有些IR可能振幅较低，因此在您应用它后，它们可能会降低整体音量。在这种情况下，您可以使用增益节点来增强它:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="59eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于特定的脉冲响应，需要手动调整增益值。在用户界面中使用一些控件(如范围输入)来公开配置也是很好。</p><h1 id="3a54" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">三波段均衡器</h1><p id="bcc2" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">我想添加到机柜仿真的最后一个功能是三波段均衡器。它让我们可以控制输出的音调。我们想为低音、中频和高音频率创建一个可配置的滤波器。所有低于500 Hz的将与低音有关，500 Hz和3 KHz之间的为中音，3000 Hz以上的为高音。</p><figure class="mp mq mr ms gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/06da62bbb80868d715e24821a3d3403c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7ZU4p5y8xQDiWeok.jpg"/></div></div></figure><p id="1dbf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何使用网络音频增加特定频率的输出？我们有一个很好的节点——双二阶滤波器节点。它是一组过滤器的实现，可以由提供的类型值指定。对于低音控制，我们选择一个<code class="fe mv mw mx my b">'lowshelf'</code>滤波器。它将提高低于已通过频率的所有频率的水平。对于高音，我们用相反的类型——<code class="fe mv mw mx my b">'highshelf'</code>。它提升所有高于传递值的值。而且，对于中间，我们选择<code class="fe mv mw mx my b">'peaking'</code>型。它提升通过值附近的频率-由<code class="fe mv mw mx my b">Q</code>(滤波器质量)参数控制的频段范围。增益参数改变的每个波段的衰减或增强。它是应用于频率的电平变化量(以dB为单位),使用负值时，我们使用正增强来衰减它。</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="6c04" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了防止点击增益值更新，可以使用<code class="fe mv mw mx my b">setTargetAtTime</code>更新方法:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="172a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以连接所有节点，实现灵活的吉他音箱仿真:</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="9c97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我录制了一个示例视频，展示卷积如何影响输出声音。它可能不会对干净的信号产生显著影响，但如果应用了某种失真效果，它会明显得多。</p><figure class="mp mq mr ms gt jr"><div class="bz fp l di"><div class="na mu l"/></div></figure><h1 id="42a2" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">概述</h1><p id="5ea5" class="pw-post-body-paragraph jy jz iq ka b kb ly kd ke kf lz kh ki kj mm kl km kn mn kp kq kr mo kt ku kv ij bi translated">如果您已经阅读了这篇文章，那么您已经学会了如何使用卷积来模拟吉他放大器，并创建一个三波段均衡器来配置音调。如果你是弹吉他的，可以看看我搭建的<a class="ae kw" href="http://js-rocks.web.app" rel="noopener ugc nofollow" target="_blank">“JS Rocks”</a>Angular app。它有现成的橱柜9‼️和7个用网络音频创建的电吉他效果。而且，听起来还不错😎。请继续关注下一篇文章，我将深入探讨失真效果。用网络音频摇滚吧🤘！</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="dea9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">原载于</em><a class="ae kw" href="https://bobrov.dev/blog/web-audio-for-electric-guitar-cabinet-emulation/" rel="noopener ugc nofollow" target="_blank"><em class="kx">https://bobrov . dev</em></a><em class="kx">。</em></p></div></div>    
</body>
</html>