<html>
<head>
<title>10GB Ephemeral Storage for AWS Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于AWS Lambda的10GB临时存储</h1>
<blockquote>原文：<a href="https://itnext.io/10gb-ephemeral-storage-for-aws-lambda-788fad51c99b?source=collection_archive---------1-----------------------#2022-03-26">https://itnext.io/10gb-ephemeral-storage-for-aws-lambda-788fad51c99b?source=collection_archive---------1-----------------------#2022-03-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="40c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2022年3月24日对于AWS Lambda消费者来说是一个突破性的日子，他们需要高于之前限制(512MB)的短暂/临时磁盘存储。在此更新之前，为lambdas (&gt; 512mb)配置大存储需要痛苦地设置VPC + EFS或烘焙大功能容器。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/52d3f95b68c4e97030b6a21b846a482b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfbrQLpQnw4441TMZmcaoQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">AWS发布了一个更新，使其客户能够为Lambda利用10GB的短暂存储</figcaption></figure><h1 id="c185" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">问题陈述</strong></h1><p id="c855" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在2022年3月24日之前，AWS Lambda在<code class="fe me mf mg mh b">/tmp</code>目录中提供了额外的512MB临时存储空间。虽然这个数量对于小规模磁盘缓存使用情形来说是足够且合理的，例如:</p><ul class=""><li id="a4c4" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">图像生成(QR和条形码、头像生成)</li><li id="405a" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">将压缩文件(ZIP、GZIP、TAR)解压到磁盘。</li><li id="ee78" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">缓存大于256 MB但小于512MB的AI模型</li><li id="39a2" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">大于256 MB但小于512MB的Python包的着陆区</li></ul><p id="66b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在解决需要使用大量临时磁盘空间的问题语句方面，它仍未达到预期，例如:</p><ul class=""><li id="6bd8" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">超过512 MB的依赖项(用于ML推理的Python ML库和NodeJS依赖项)</li><li id="089d" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">大于512 MB的AI推理模型(PyTorch、Tensorflow、MTCNN)</li><li id="1229" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">大型媒体文件的着陆区(1080P、2048P和4K电影)</li><li id="f825" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">高性能计算(HPC)用例需要大量临时数据，如金融计算、用于低延迟计算的大量查找数据、高分辨率时间序列数据生成。</li></ul><h1 id="f7a7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">他们如何在2022年3月24日之前解决这个问题？</strong></h1><p id="9256" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在发布可配置的临时存储之前，解决后面的用例需要一个设置，该设置将提供对弹性文件系统(EFS)的lambdas访问。下图解释了EFS如何需要更多的跑腿工作才能让VPC内的兰姆达斯接近它:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/4d6667cd668a8e4779870d87071d3210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LV0Ma7QkAGsOR3dhpT3r_Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">2022年3月24日之前访问大于512MB的存储需要设置。</figcaption></figure><p id="0271" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更准确地说，该设置需要以下各项才能发挥作用:</p><ul class=""><li id="87c4" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">1个虚拟私有云(VPC)</li><li id="1aad" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">至少2个可用区域</li><li id="3db7" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">至少1个NAT网关</li><li id="9d57" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">至少1个路由表</li><li id="4756" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">互联网网关</li><li id="2ba3" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">至少2个公共子网</li><li id="7ad3" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">至少2个私有子网</li><li id="265b" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">AWS Lambda实例的1个安全组</li><li id="ca98" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">1个EFS安全小组</li><li id="11bf" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">如果用例需要到其他网络的私有连接，例如同一帐户中的其他VPC、其他帐户中的VPC和内部集成，这可能会变得更加疯狂。</li></ul><h1 id="0f09" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">EFS的缺点</h1><p id="bf54" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">将EFS与Lambdas集成只是提供大磁盘空间访问所需挑战的冰山一角。我们现在能想到的其他缺点是:</p><ul class=""><li id="5096" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">在VPC内运行Lambda函数间接导致冷启动。</li><li id="40df" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">人们可以使用供应的并发性来缓解前面的问题，但这只是通过持续运行lambdas 24/7来产生成本。</li><li id="6e1a" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">NAT网关要求我们每月为每个实例支付32.85美元，感觉不值得几百次调用。</li><li id="f5e4" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">如果你需要把东西放在EFS上，我们还需要在网络内部安装ec2，但对于T4G.micro及以下产品，价格可以忽略不计。</li><li id="c458" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">哦，顺便说一句，当开发人员第一次遇到这种情况时，他们还会有人力成本，ML工程师真的很讨厌这种情况。</li><li id="7f74" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">EFS提供了一个多az持久NFS存储，并不符合短暂的要求，这可能会导致被遗弃的临时数据随着时间的推移而增长。</li></ul><h1 id="1bd0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">配置短暂存储</strong></h1><p id="cff2" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在撰写本文时，有四种方法可以将临时存储集成到Lambda函数中。</p><h1 id="d349" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">通过AWS控制台</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mw"><img src="../Images/38b0b4d0905fa73139eb75180c60c4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ynSMhRrfpCzgrKXKgY3eGg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">在AWS控制台调整临时存储。</figcaption></figure><h1 id="9e64" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">通过AWS CLI </strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/ece1c5b554b629a969fed4cd44e3c143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKx39H5tfAx0H49saBGkHQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">基于AWS CLI的lambda临时存储调整方法。</figcaption></figure><h1 id="2ac0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过AWS SDKs</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi my"><img src="../Images/85dbfb7aac338d23d07de46f22e82826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1sZbEpelt4ZQe--UZ8t5zQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae mz" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Lambda.html" rel="noopener ugc nofollow" target="_blank"> AWS-SDK设置临时存储的方式</a>。选择您喜欢的语言(Python、NodeJS、Java、C#、Go)</figcaption></figure><h1 id="871c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">通过云的形成</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mx"><img src="../Images/38cba8f61b64b5b8b0c455ef7a220ba4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EAXwRqD6RW5ag5Vn2dWk-Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae mz" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html" rel="noopener ugc nofollow" target="_blank">基于云形成的</a>短暂存储的配置。</figcaption></figure><h1 id="1aa6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak"> EFS vs短暂存储</strong></h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e845b0f5eac37bf2907249451df6eba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2tfueGg6OMz0dMWjtxfVUw.png"/></div></div></figure><p id="01ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可配置的暂时储存不会让EFS过时，两者都有各自的优缺点。可能造成差异的主要因素有:</p><ul class=""><li id="8480" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">数据共享— EFS提供跨多个可用性区域和lambda函数实例的可共享文件，而/tmp存储仅限于单个lambda实例。</li><li id="3524" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">持久性——存储在EFS中的文件将在lambda函数空闲超时触发的刷新后<strong class="jp ir">继续存在(编写时为15分钟),而/tmp文件夹中的文件将会消失。</strong></li><li id="817d" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">成本— EFS通常更贵，因为它需要NAT网关和EFS，而/tmp文件夹不太便宜，因为它的价格约为每年每1.166832美元。</li><li id="6f67" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">易于配置——EFS更难执行，因为它需要底层网络，这对ML工程师来说是一个挑战。</li></ul><h1 id="a4f9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="bd45" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">最近发布的可配置临时存储被视为改变游戏规则的更新，有助于:</p><ul class=""><li id="c651" class="mi mj iq jp b jq jr ju jv jy mk kc ml kg mm kk mn mo mp mq bi translated">简化了在Lambda函数中提供临时数据存储访问所需的工作。</li><li id="2014" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">降低了与EFS孤立数据相关的成本和风险。</li><li id="5e31" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">增加Lambda函数中客户可以存储数据的地方(Lambda层、EFS、/tmp和容器)</li><li id="668e" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">可配置的临时存储器的大小(10GB)现在与去年引入的可配置RAM的大小(10GB)和容器映像大小(10GB)同步</li></ul><h1 id="428a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">进一步阅读</h1><ul class=""><li id="75fa" class="mi mj iq jp b jq lz ju ma jy na kc nb kg nc kk mn mo mp mq bi translated">崔琰公司写了一篇很棒的文章，提供了关于使用非默认临时存储的其他影响的有趣见解(例如，更高的临时存储对冷启动的影响)，我强烈推荐阅读这篇文章。</li><li id="cbcc" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">Channy Yun写了一篇<a class="ae mz" href="https://aws.amazon.com/blogs/aws/aws-lambda-now-supports-up-to-10-gb-ephemeral-storage/" rel="noopener ugc nofollow" target="_blank">文章</a>，其中包含了一个关于lambda函数可访问的每种存储类型的不同特征&amp;用途的综合矩阵。</li><li id="981c" class="mi mj iq jp b jq mr ju ms jy mt kc mu kg mv kk mn mo mp mq bi translated">和往常一样，阅读AWS <a class="ae mz" href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-function-common.html#configuration-ephemeral-storage" rel="noopener ugc nofollow" target="_blank">文档</a>来配置临时存储是一个很好的开始。</li></ul></div></div>    
</body>
</html>