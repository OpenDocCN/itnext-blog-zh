<html>
<head>
<title>TiDB on KubeSphere: A Strong Combination of Cloud-Native Database with the App-Centric Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">KubeSphere上的TiDB:云原生数据库与以应用为中心的平台的强强联合</h1>
<blockquote>原文：<a href="https://itnext.io/tidb-on-kubesphere-a-strong-combination-of-cloud-native-database-with-the-app-centric-platform-ac0d1939d2b4?source=collection_archive---------1-----------------------#2020-12-01">https://itnext.io/tidb-on-kubesphere-a-strong-combination-of-cloud-native-database-with-the-app-centric-platform-ac0d1939d2b4?source=collection_archive---------1-----------------------#2020-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/239474906f7f38e4394950133d8f8c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbAhbuvfpOffQ2SsmoxIJA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">KubeSphere上的TiDB</figcaption></figure><p id="b99b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在Kubernetes已经成为构建跨越多个容器的应用程序服务的事实标准的世界里，运行云原生分布式数据库代表了使用Kubernetes体验的一个重要部分。在这方面，<a class="ae la" href="https://docs.pingcap.com/tidb/dev/overview" rel="noopener ugc nofollow" target="_blank"> TiDB </a>，一个支持混合事务和分析处理(HTAP)工作负载的云原生开源NewSQL数据库，很好地满足了这些需求。它的架构适合Kubernetes，并且兼容MySQL。TiDB还具有水平可伸缩性、强一致性和高可用性。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/2c9747334b09154cdbf2446191443cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QAB_IlYwTrhnIM6m.png"/></div></div></figure><p id="8724" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除了TiDB，我还在使用KubeSphere，这是一个开源的分布式操作系统，以Kubernetes为内核管理云原生应用。它为无缝集成第三方应用程序提供了一个即插即用的架构，以促进其生态系统。KubeSphere可以在任何地方运行，因为它是高度可插拔的，无需侵入Kubernetes。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/1f82ed5396e87ac8145c6c0332a8bcc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LwgK77yJTYR-jlLa.png"/></div></div></figure><p id="d31e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">通过将TiDB与KubeSphere相结合，我们可以拥有Kubernetes支持的TiDB集群，并使用开发人员友好的向导web UI来管理集群。在这篇文章中，我将演示如何在KubeSphere上从头开始部署TiDB。</p><h1 id="1ea6" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">准备环境</h1><ol class=""><li id="a446" class="mf mg iq ke b kf mh kj mi kn mj kr mk kv ml kz mm mn mo mp bi translated">对于那些不熟悉Kubernetes和KubeSphere，并且正在寻找快速发现该平台的人来说，一体化模式是您入门的最佳选择。它的特点是快速部署和无麻烦的配置安装，KubeSphere和Kubernetes都在您的机器上提供。我为quickstart安装了一个单节点KubeSphere集群，你可以按照这个指南<a class="ae la" href="https://kubesphere.io/docs/quick-start/all-in-one-on-linux/" rel="noopener ugc nofollow" target="_blank">在Linux </a>上进行一体化安装以了解更多细节。确保您在安装KubeSphere时在配置文件中启用了应用商店。</li></ol><blockquote class="mq mr ms"><p id="6936" class="kc kd mt ke b kf kg kh ki kj kk kl km mu ko kp kq mv ks kt ku mw kw kx ky kz ij bi translated">除了在Linux机器上安装KubeSphere之外，还可以直接在现有的Kubernetes集群上部署它。参见Kubernetes 上的<a class="ae la" href="https://kubesphere.io/docs/quick-start/minimal-kubesphere-on-k8s/" rel="noopener ugc nofollow" target="_blank"> Minimal KubeSphere以供参考。</a></p></blockquote><p id="08b5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.群集将在大约15分钟内启动并运行。在本例中，当集群准备就绪时，使用默认帐户和密码(<code class="fe mx my mz na b">admin/P@88w0rd</code>)登录KubeSphere的web控制台。以下是集群<strong class="ke ir">概述</strong>页面:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/a8a1104f104360f2ececfcf186339e8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bOgJyuhkA8SM3mIt.png"/></div></div></figure><p id="e7e2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.使用右下角工具箱中的内置<strong class="ke ir"> Web Kubectl </strong>执行以下命令来安装TiDB操作员CRD:</p><p id="9bb1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><code class="fe mx my mz na b">kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/v1.1.6/manifests/crd.yaml</code></p><p id="0d80" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.您可以看到预期的输出如下:</p><pre class="lc ld le lf gt nc na nd ne aw nf bi"><span id="758e" class="ng li iq na b gy nh ni l nj nk">customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created customresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created customresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created customresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbmonitors.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbinitializers.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbclusterautoscalers.pingcap.com created<!-- -->customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created customresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created customresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created customresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbmonitors.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbinitializers.pingcap.com created customresourcedefinition.apiextensions.k8s.io/tidbclusterautoscalers.pingcap.com created</span></pre><p id="85a3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.现在，让我们回到列出了所有工作区的<strong class="ke ir">访问控制</strong>页面。在我继续之前，首先我需要创建一个新的工作区(例如<code class="fe mx my mz na b">dev-workspace</code>)。</p><p id="5662" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在工作区中，不同的用户拥有不同的权限来执行项目中的各种任务。通常，一个部门范围的项目需要一个多租户系统，这样每个人都负责自己的部分。出于演示的目的，我在这个例子中使用账户<code class="fe mx my mz na b">admin</code>。你可以<a class="ae la" href="https://kubesphere.io/docs/quick-start/create-workspace-and-project/" rel="noopener ugc nofollow" target="_blank">查看KubeSphere的官方文档</a>了解更多关于多租户系统如何工作的信息。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/49d7eff74092be213b828f838db04676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dRkeP38ZdTG9879S.png"/></div></div></figure><p id="c613" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">6.转到一个工作区，你可以看到KubeSphere提供了两种方法来添加舵图。本文只谈第一个，就是在KubeSphere中添加一个app repository。或者，你也可以上传你自己的应用模板，提交到KubeSphere应用商店，这将在我的下一篇博客中谈到。在这里，按照下图在<strong class="ke ir"> App Repos </strong>中添加ping cap(<a class="ae la" href="https://charts.pingcap.org/" rel="noopener ugc nofollow" target="_blank">https://charts.pingcap.org</a>)的舵库。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/70dddb7da53c3018f3940d1a6cfc74ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1lPCWbc-3VEI1Lvs.png"/></div></div></figure><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/60f2394b67ffdebdfdf8b407dad0867c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XZQEHBHsAkRz7uCT.png"/></div></div></figure><h1 id="c70d" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">部署TiDB操作员</h1><p id="a645" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated"><a class="ae la" href="https://github.com/pingcap/tidb-operator" rel="noopener ugc nofollow" target="_blank"> TiDB Operator </a>是Kubernetes中TiDB集群的自动操作系统。它为TiDB提供了完整的管理生命周期，包括部署、升级、扩展、备份、故障转移和配置更改。借助TiDB Operator，TiDB可以在部署在公共或私有云上的Kubernetes集群中无缝运行。您需要首先在KubeSphere上部署TiDB Operator。</p><ol class=""><li id="201d" class="mf mg iq ke b kf kg kj kk kn nr kr ns kv nt kz mm mn mo mp bi translated">就像我上面提到的，我们需要首先创建一个项目(即名称空间)来运行TiDB操作符。</li></ol><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/d8e6445b8a4aa6344bdf1914423f8397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Oo8nsuZTiH2Olstj.png"/></div></div></figure><p id="d226" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.创建项目后，导航到<strong class="ke ir">应用</strong>并点击<strong class="ke ir">部署新应用</strong>。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/133d2fed2f7302e4375ccb4d7ab3d01d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bWDz4UX4ovYDnyMZ.png"/></div></div></figure><p id="0204" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.从应用模板中选择<strong class="ke ir">。</strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/faf93692b1b8701da3159f1d097fa5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kibKkMpPXrZNHISB.png"/></div></div></figure><p id="5867" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.切换到存储多个舵图的PingCAP存储库。本文只演示了如何部署TiDB操作符和TiDB集群。您还可以根据需要部署其他工具。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/8cf9b2af976ed3b0ea09314b65d99e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*70XfJGDB04RqlBlO.png"/></div></div></figure><p id="9ec1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.点击tidb-operator，选择<strong class="ke ir">图表文件</strong>。您可以直接从控制台查看配置或下载默认的<code class="fe mx my mz na b">values.yaml</code>文件。从右边的下拉菜单中，您还可以选择要安装的版本。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/50002bbab946b6fa46c55379d22c55be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jkd4ZdSLfEniCCK6.png"/></div></div></figure><p id="276f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">6.确认你的应用名称、版本和部署位置。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/33964f604e610e74a1a74d6debb464ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VRoEUYKcNbCkqu5M.png"/></div></div></figure><p id="4c3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">7.您可以在这一步编辑<code class="fe mx my mz na b">values.yaml</code>文件，或者直接点击<strong class="ke ir">使用默认配置部署</strong>。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/bf6bf5640434d36c7783e31d16c3e436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IcHgl0eZHzw19-wf.png"/></div></div></figure><p id="3c20" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">8.在<strong class="ke ir">应用程序</strong>中，等待TiDB操作员启动并运行。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/cbc9e3d1dd9b918dacbda6865b8035da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QPgeri8M_FF-Yjsc.png"/></div></div></figure><p id="390c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">9.在<strong class="ke ir">工作负载</strong>中，您可以看到为TiDB操作员创建的两个<strong class="ke ir">部署</strong>。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/bcb24473f0e0476e7578b7ff95cd5a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1jqQ3qxNe6VSbCN6.png"/></div></div></figure><h1 id="fd16" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">部署TiDB集群</h1><p id="dbbb" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">部署TiDB集群的过程类似于部署TiDB Operator。</p><ol class=""><li id="b2f3" class="mf mg iq ke b kf kg kj kk kn nr kr ns kv nt kz mm mn mo mp bi translated">同样从PingCAP存储库中，选择tidb-cluster。</li></ol><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/52cb0f9fad2c8fcadea854fa22c206c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*etNXnrbqMHNRUtF0.png"/></div></div></figure><p id="4a3c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.切换到<strong class="ke ir">图表文件</strong>并下载<strong class="ke ir"> values.yaml </strong>文件。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/61a50069bbd5e36e2fb9c8c0dfdcce51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i5MZxXAYN7ZvsesC.png"/></div></div></figure><p id="1a00" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.一些TiDB组件需要持久卷。对此，QingCloud平台为用户提供了以下存储类。</p><div class="lc ld le lf gt ab cb"><figure class="od jr oe of og oh oi paragraph-image"><img src="../Images/5cc0cce7d5c426c410bf4e3ed54be31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*c3Ex0EBlLvnNRMiA0AM7yg.png"/></figure><figure class="od jr oj of og oh oi paragraph-image"><img src="../Images/e7ca92c4d37dc64db8050f05109e7fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*HsSYGpTvf5o2fZYIoBqrqQ.png"/></figure></div><p id="6e10" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.当我通过QingCloud Kubernetes Engine (QKE)安装KubeSphere时，所有这些存储组件都是默认自动部署的。QingCloud CSI插件实现了支持<a class="ae la" href="https://github.com/container-storage-interface/" rel="noopener ugc nofollow" target="_blank"> CSI </a>的容器编制器(CO)和QingCloud的存储之间的接口。如果对QingCloud CSI感兴趣，可以看看他们的<a class="ae la" href="https://github.com/yunify/qingcloud-csi" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>。通过用<code class="fe mx my mz na b">values.yaml</code>中的<code class="fe mx my mz na b">csi-standard</code>替换<code class="fe mx my mz na b">storageClassName</code>字段的默认值<code class="fe mx my mz na b">local-storage</code>，在此选择csi-standard。在下载的文件中，可以直接全部替换，复制粘贴到<code class="fe mx my mz na b">values.yaml</code>文件中。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ok"><img src="../Images/badf10778d8c2d75a15e10c8e748edf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1c4H1VWh3qaq77US.png"/></div></div></figure><p id="b51c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">注意:</strong>只有字段<code class="fe mx my mz na b">storageClassName</code>被改变以提供外部永久存储。如果您想要将每个TiDB组件(如<a class="ae la" href="https://docs.pingcap.com/tidb/dev/tidb-architecture#tikv-server" rel="noopener ugc nofollow" target="_blank"> TiKV </a>和<a class="ae la" href="https://docs.pingcap.com/tidb/dev/tidb-architecture#placement-driver-pd-server" rel="noopener ugc nofollow" target="_blank">布局驱动程序</a>)部署到各个节点，请指定字段<code class="fe mx my mz na b">nodeAffinity</code>。</p><p id="b3e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.点击<strong class="ke ir">部署</strong>，可以在列表中看到两个应用，如下图所示:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/38a5e77fc2640d79ffa2227bae2f6ef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DwGi8BWdLy6aFB7u.png"/></div></div></figure><h1 id="1838" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">查看TiDB集群状态</h1><p id="8a03" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">现在我们已经准备好了我们的应用程序，我们可能需要更多地关注可观察性。KubeSphere通过仪表盘上可用的不同指标，让用户直观地了解应用在整个生命周期中的表现。</p><ol class=""><li id="7407" class="mf mg iq ke b kf kg kj kk kn nr kr ns kv nt kz mm mn mo mp bi translated">验证所有TiDB集群部署都已启动并在<strong class="ke ir">工作负载</strong>中运行。</li></ol><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/64220bdeb8375ceb94c2518905fa6e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AlaWW2nrcPCK4KPO.png"/></div></div></figure><p id="288f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.TiDB、TiKV和PD都是有状态的应用，可以在<strong class="ke ir"> StatefulSets </strong>中找到。请注意，TiKV和TiDB将自动创建，可能需要一段时间才会显示在列表中。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/b49a85e6a9142a99def0eb164d5a3609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1kDOR_mRM--RqtCI.png"/></div></div></figure><p id="60ca" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.单击单个状态集以显示其详细信息页面。此页面以折线图显示一段时间内的指标。以下是TiDB指标的一个示例:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/60c878939f00162122c5d8f9688f84e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qNlqguAfJj2UmLih.png"/></div></div></figure><p id="bb3a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.查看TiKV负载:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/4437cd53f3bc0b08cfc6394c6dd105a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CFMh5YqoxpTMUCry.png"/></div></div></figure><p id="1421" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">5.还列出了相关的pod。如您所见，您的TiDB集群包含三个PD Pods、两个TiDB Pods和三个TiKV Pods。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oo"><img src="../Images/557c871c6e21acc841096cefcb63fc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nko9IUCNsjleHaCI.png"/></div></div></figure><p id="ac20" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">6.转到<strong class="ke ir">存储</strong>部分，您可以看到TiKV和PD正在使用持久存储。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi om"><img src="../Images/1c7444fe693b001a7e7290541a8a25e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UMRJ4EjxWwEeRQQ1.png"/></div></div></figure><p id="c99c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">7.还会监控卷的使用情况。下面是TiKV的一个例子:</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/2c862a08bf02aec53297036c07e0cdd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fBEqr00jZHW5cDx9.png"/></div></div></figure><p id="b683" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">8.在<strong class="ke ir">概述</strong>页面上，您可以看到当前项目中的资源使用列表。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/b1e36d559c81c9ea237f5724b71dfd9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kjRF21ilgNYLg91J.png"/></div></div></figure><h1 id="4406" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">正在访问TiDB群集</h1><p id="836a" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">这些刚刚创建的服务可以很容易地访问，因为KubeSphere会告诉您服务是如何在哪个端口上公开的。</p><ol class=""><li id="c917" class="mf mg iq ke b kf kg kj kk kn nr kr ns kv nt kz mm mn mo mp bi translated">在<strong class="ke ir">服务</strong>中，可以看到所有服务的详细信息。</li></ol><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi os"><img src="../Images/20ba51cfcfe1433cb5ae3ef6fe368507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L5ZCixcsFxqIS6sc.png"/></div></div></figure><p id="b12e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.由于服务类型设置为<code class="fe mx my mz na b">NodePort</code>，您可以通过集群外的节点IP地址访问它。</p><p id="0e4a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">3.下面是一个通过MySQL客户端连接到数据库的测试。</p><blockquote class="mq mr ms"><p id="21b1" class="kc kd mt ke b kf kg kh ki kj kk kl km mu ko kp kq mv ks kt ku mw kw kx ky kz ij bi translated">[root @ k8s-master 1 ~]# docker run-it—RM MySQL bash<br/><br/>【root @ 0 D7 cf 9d 2173 e:/# MySQL-h 192 . 168 . 1 . 102-P 32682-u root<br/>欢迎来到MySQL monitor。命令以结尾；或者\g. <br/>您的MySQL连接id为201 <br/>服务器版本:5 . 7 . 25-tid b-v 4 . 0 . 6 TiDB Server(Apache License 2.0)社区版、MySQL 5.7兼容<br/> <br/>版权所有2000、2020、Oracle和/或其附属公司。保留所有权利。<br/> <br/>甲骨文是甲骨文公司和/或其附属公司的注册商标。其他名称可能是其各自所有者的商标。<br/> <br/>键入‘help；’或“\h”寻求帮助。键入' \c '清除当前的输入语句。<br/>T22】MySQL&gt;显示数据库；<br/>+————+<br/>|数据库|<br/>+—————+<br/>|信息_模式| <br/> |度量_模式| <br/> |性能_模式| <br/> | mysql | <br/> |测试|<br/>+————+<br/>集合中的5行(0.01秒)<br/> <br/> mysql 【T36</p></blockquote><p id="27f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">4.此外，TiDB集成了Prometheus和Grafana来监控数据库集群的性能。从上面我们可以看到，Grafana是通过<code class="fe mx my mz na b">NodePort</code>曝光的。在QingCloud平台的安全组中配置必要的端口转发规则并打开其端口后，您可以访问Grafana UI查看指标。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ot"><img src="../Images/2ee7ede25daaf281421c150b4df99796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vvREyoJ3OcXQ4-wD.png"/></div></div></figure><h1 id="feb5" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">摘要</h1><p id="dfb0" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">我希望你们都成功地部署了TiDB。TiDB和KubeSphere都是针对云原生应用程序的强大工具，所以实际上，我无法在本文中展示它们的所有方面。例如，应用程序部署功能可以为像我这样的云原生爱好者提供很多东西。我将发布另一篇文章，介绍如何通过将舵图上传到KubeSphere应用商店来部署TiDB。</p><p id="3f25" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您有任何问题，请随时通过<a class="ae la" href="https://join.slack.com/t/kubesphere/shared_invite/enQtNTE3MDIxNzUxNzQ0LTZkNTdkYWNiYTVkMTM5ZThhODY1MjAyZmVlYWEwZmQ3ODQ1NmM1MGVkNWEzZTRhNzk0MzM5MmY4NDc3ZWVhMjE" rel="noopener ugc nofollow" target="_blank"> Slack </a>或<a class="ae la" href="https://github.com/kubesphere" rel="noopener ugc nofollow" target="_blank"> GitHub </a>联系我们。</p><h1 id="00ee" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">参考</h1><p id="a788" class="pw-post-body-paragraph kc kd iq ke b kf mh kh ki kj mi kl km kn no kp kq kr np kt ku kv nq kx ky kz ij bi translated">https://github.com/kubesphere/kubesphere<strong class="ke ir">KubeSphere GitHub</strong>:<a class="ae la" href="https://github.com/kubesphere/kubesphere" rel="noopener ugc nofollow" target="_blank">T7】</a></p><p id="8cf8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">TiDB GitHub</strong>:<a class="ae la" href="https://github.com/pingcap/TiDB" rel="noopener ugc nofollow" target="_blank">https://github.com/pingcap/TiDB</a></p><p id="40fe" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> TiDB操作员文档</strong>:<a class="ae la" href="https://docs.pingcap.com/tidb-in-kubernetes/stable/tidb-operator-overview" rel="noopener ugc nofollow" target="_blank">https://docs . ping cap . com/tid b-in-kubernetes/stable/tid b-Operator-overview</a></p><p id="d27f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> KubeSphere简介</strong>:<a class="ae la" href="https://kubesphere.io/docs/introduction/what-is-kubesphere/" rel="noopener ugc nofollow" target="_blank">https://kubesphere.io/docs/introduction/what-is-kubesphere/</a></p><p id="5339" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> KubeSphere文档</strong>:<a class="ae la" href="https://kubesphere.io/docs/" rel="noopener ugc nofollow" target="_blank">https://kubesphere.io/docs/</a></p></div></div>    
</body>
</html>