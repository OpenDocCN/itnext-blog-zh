<html>
<head>
<title>WhatsApp Status Saver/Downloader Using Flutter II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter II的WhatsApp状态保护程序/下载器</h1>
<blockquote>原文：<a href="https://itnext.io/whatsapp-status-saver-downloader-using-flutter-ii-aa99b1206c48?source=collection_archive---------0-----------------------#2020-01-11">https://itnext.io/whatsapp-status-saver-downloader-using-flutter-ii-aa99b1206c48?source=collection_archive---------0-----------------------#2020-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="73d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是早期文章WhatsApp状态保护程序/下载器使用Flutter的延续。如果你错过了，点击<a class="ae kl" href="https://medium.com/@sammytech/whatsapp-status-saver-downloader-using-flutter-ff5ff897e56" rel="noopener">这里</a>。GitHub repo的链接在本文的底部。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/fc05b14891aeb33deab113258a2dec24.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*LRmYpvJyn2bqZVwP0TLYpA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">颤振标志</figcaption></figure><p id="5875" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上次，我们停在了仪表板上，它是UI/dashboard.dart文件。实现非常简单，因为它在选项卡式视图中调用图像屏幕和视频屏幕。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/6998e0a6bac060b0ae53ed937bf3952e.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*CQTz8tKNNup9BfHbxhOEgg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">应用外观</figcaption></figure><p id="2871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以我们想在选项卡视图中设计屏幕的图像部分。下一步非常重要，那就是从用户的设备上获取WhatsApp的状态。我们需要访问存储状态的目录。这个目录是/storage/emulated/0/WhatsApp/Media/。状态</p><p id="e217" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们如何获取和显示图像呢？这里使用的逻辑是:创建一个列表，查找全部。jpg文件，并将这些文件附加到该列表中，然后我们在StaggeredGridView中使用该列表来显示所有图像。😎 😎 😎</p><p id="f6fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以说到代码。UI/imageScreen.dart</p><pre class="kn ko kp kq gt kz la lb lc aw ld bi"><span id="c085" class="le lf iq la b gy lg lh l li lj">import 'package:flutter/material.dart';<br/>import 'dart:io';<br/>import 'package:flutter_staggered_grid_view/flutter_staggered_grid_view.dart';<br/>import 'package:wa_status_saver/ui/viewphotos.dart';</span><span id="483e" class="le lf iq la b gy lk lh l li lj">final Directory _photoDir =<br/>    new Directory('/storage/emulated/0/WhatsApp/Media/.Statuses');</span><span id="56a7" class="le lf iq la b gy lk lh l li lj">class ImageScreen extends StatefulWidget {<br/>  @override<br/>  ImageScreenState createState() =&gt; new ImageScreenState();<br/>}</span><span id="8306" class="le lf iq la b gy lk lh l li lj">class ImageScreenState extends State&lt;ImageScreen&gt; {<br/>  @override<br/>  void initState() {<br/>    super.initState();<br/>  }</span><span id="47c4" class="le lf iq la b gy lk lh l li lj">  @override<br/>  Widget build(BuildContext context) {<br/>    if (!Directory("${_photoDir.path}").existsSync()) {<br/>      return Container(<br/>        padding: EdgeInsets.only(bottom: 60.0),<br/>        child: Center(<br/>          child: Text(<br/>            "Install WhatsApp\nYour Friend's Status Will Show Here",<br/>            style: TextStyle(fontSize: 18.0),<br/>          ),<br/>        ),<br/>      );<br/>    } else {<br/>      var imageList = _photoDir<br/>          .listSync()<br/>          .map((item) =&gt; item.path)<br/>          .where((item) =&gt; item.endsWith(".jpg"))<br/>          .toList(growable: false);<br/>      if (imageList.length &gt; 0) {<br/>        return Container(<br/>          padding: EdgeInsets.only(bottom: 60.0),<br/>          child: StaggeredGridView.countBuilder(<br/>            padding: EdgeInsets.all(8.0),<br/>            itemCount: imageList.length,<br/>            crossAxisCount: 4,<br/>            itemBuilder: (context, index) {<br/>              String imgPath = imageList[index];<br/>              return Material(<br/>                elevation: 8.0,<br/>                borderRadius: BorderRadius.all(Radius.circular(8)),<br/>                child: InkWell(<br/>                  onTap: () {<br/>                    Navigator.push(<br/>                        context,<br/>                        new MaterialPageRoute(<br/>                            builder: (context) =&gt; new ViewPhotos(imgPath)));<br/>                  },<br/>                  child: Hero(<br/>                      tag: imgPath,<br/>                      child: Image.file(<br/>                        File(imgPath),<br/>                        fit: BoxFit.cover,<br/>                      )),<br/>                ),<br/>              );<br/>            },<br/>            staggeredTileBuilder: (i) =&gt;<br/>                StaggeredTile.count(2, i.isEven ? 2 : 3),<br/>            mainAxisSpacing: 8.0,<br/>            crossAxisSpacing: 8.0,<br/>          ),<br/>        );<br/>      } else {<br/>        return Scaffold(<br/>          body: Center(<br/>            child: new Container(<br/>                padding: EdgeInsets.only(bottom: 60.0),<br/>                child: Text('No Image Found!', style: TextStyle(fontSize: 18.0),)),<br/>          ),<br/>        );<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="2f26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是的，我们现在可以在屏幕上以一种网格的形式看到WhatsApp的状态(图片)😃 😃 😃。但是等等，如果我们想查看一张图片或者下载它呢？我们该怎么做呢？😏 😏 😏</p><p id="78e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">文件:UI/viewphotos.dart</p><pre class="kn ko kp kq gt kz la lb lc aw ld bi"><span id="66b9" class="le lf iq la b gy lg lh l li lj">import 'dart:io';<br/>import 'dart:typed_data';<br/>import 'package:flutter/material.dart';<br/>import 'package:image_gallery_saver/image_gallery_saver.dart';<br/>import 'package:flutter_fab_dialer/flutter_fab_dialer.dart';<br/></span><span id="9eda" class="le lf iq la b gy lk lh l li lj">class ViewPhotos extends StatefulWidget {<br/>  final String imgPath;<br/>  ViewPhotos(this.imgPath);</span><span id="ea69" class="le lf iq la b gy lk lh l li lj">  @override<br/>  _ViewPhotosState createState() =&gt; _ViewPhotosState();<br/>}</span><span id="4d7d" class="le lf iq la b gy lk lh l li lj">class _ViewPhotosState extends State&lt;ViewPhotos&gt; {<br/>  var filePath;<br/>  final String imgShare = "Image.file(File(widget.imgPath),)";</span><span id="3ee6" class="le lf iq la b gy lk lh l li lj">  final LinearGradient backgroundGradient = new LinearGradient(<br/>    colors: [<br/>      Color(0x00000000),<br/>      Color(0x00333333),<br/>    ],<br/>    begin: Alignment.<em class="ll">topLeft</em>,<br/>    end: Alignment.<em class="ll">bottomRight</em>,<br/>  );</span><span id="e655" class="le lf iq la b gy lk lh l li lj">  void _onLoading(bool t, String str) {<br/>    if (t) {<br/>      showDialog(<br/>          context: context,<br/>          barrierDismissible: false,<br/>          builder: (BuildContext context) {<br/>            return SimpleDialog(<br/>              children: &lt;Widget&gt;[<br/>                Center(<br/>                  child: Container(<br/>                      padding: EdgeInsets.all(10.0),<br/>                      child: CircularProgressIndicator()),<br/>                ),<br/>              ],<br/>            );<br/>          });<br/>    } else {<br/>      Navigator.<em class="ll">pop</em>(context);<br/>      showDialog(<br/>          context: context,<br/>          barrierDismissible: false,<br/>          builder: (BuildContext context) {<br/>            return Padding(<br/>              padding: const EdgeInsets.all(8.0),<br/>              child: SimpleDialog(<br/>                children: &lt;Widget&gt;[<br/>                  Center(<br/>                    child: Container(<br/>                      padding: EdgeInsets.all(15.0),<br/>                      child: Column(<br/>                        children: &lt;Widget&gt;[<br/>                          Text(<br/>                            "Great, Saved in Gallary",<br/>                            style: TextStyle(<br/>                                fontSize: 20, fontWeight: FontWeight.<em class="ll">bold</em>),<br/>                          ),<br/>                          Padding(<br/>                            padding: EdgeInsets.all(10.0),<br/>                          ),<br/>                          Text(str,<br/>                              style: TextStyle(<br/>                                fontSize: 16.0,<br/>                              )),<br/>                          Padding(<br/>                            padding: EdgeInsets.all(10.0),<br/>                          ),<br/>                          Text("FileManager &gt; Downloaded Status",<br/>                              style: TextStyle(<br/>                                  fontSize: 16.0, color: Colors.<em class="ll">teal</em>)),<br/>                          Padding(<br/>                            padding: EdgeInsets.all(10.0),<br/>                          ),<br/>                          MaterialButton(<br/>                            child: Text("Close"),<br/>                            color: Colors.<em class="ll">teal</em>,<br/>                            textColor: Colors.<em class="ll">white</em>,<br/>                            onPressed: () =&gt; Navigator.<em class="ll">pop</em>(context),<br/>                          )<br/>                        ],<br/>                      ),<br/>                    ),<br/>                  ),<br/>                ],<br/>              ),<br/>            );<br/>          });<br/>    }<br/>  }</span><span id="9eee" class="le lf iq la b gy lk lh l li lj">  @override<br/>  Widget build(BuildContext context) {<br/>    //The list of FabMiniMenuItems that we are going to use<br/>    var _fabMiniMenuItemList = [<br/>      new FabMiniMenuItem.withText(<br/>          new Icon(Icons.<em class="ll">sd_storage</em>), Colors.<em class="ll">teal</em>, 4.0, "Button menu",<br/>          () async {<br/>        _onLoading(true, "");</span><span id="bc33" class="le lf iq la b gy lk lh l li lj">        Uri myUri = Uri.<em class="ll">parse</em>(widget.imgPath);<br/>        File originalImageFile = new File.fromUri(myUri);<br/>        Uint8List bytes;<br/>        await originalImageFile.readAsBytes().then((value) {<br/>          bytes = Uint8List.fromList(value);<br/>          print('reading of bytes is completed');<br/>        }).catchError((onError) {<br/>          print('Exception Error while reading audio from path:' +<br/>              onError.toString());<br/>        });<br/>        final result =<br/>            await ImageGallerySaver.<em class="ll">saveImage</em>(Uint8List.fromList(bytes));<br/>        print(result);<br/>        _onLoading(false,<br/>            "If Image not available in gallary\n\nYou can find all images at");<br/>      }, "Save", Colors.<em class="ll">black</em>, Colors.<em class="ll">white</em>, true),<br/>      new FabMiniMenuItem.withText(new Icon(Icons.<em class="ll">share</em>), Colors.<em class="ll">teal</em>, 4.0,<br/>          "Button menu", () {}, "Share", Colors.<em class="ll">black</em>, Colors.<em class="ll">white</em>, true),<br/>      new FabMiniMenuItem.withText(new Icon(Icons.<em class="ll">reply</em>), Colors.<em class="ll">teal</em>, 4.0,<br/>          "Button menu", () {}, "Repost", Colors.<em class="ll">black</em>, Colors.<em class="ll">white</em>, true),<br/>      new FabMiniMenuItem.withText(new Icon(Icons.<em class="ll">wallpaper</em>), Colors.<em class="ll">teal</em>, 4.0,<br/>          "Button menu", () {}, "Set As", Colors.<em class="ll">black</em>, Colors.<em class="ll">white</em>, true),<br/>      new FabMiniMenuItem.withText(<br/>          new Icon(Icons.<em class="ll">delete_outline</em>),<br/>          Colors.<em class="ll">teal</em>,<br/>          4.0,<br/>          "Button menu",<br/>          () {},<br/>          "Delete",<br/>          Colors.<em class="ll">black</em>,<br/>          Colors.<em class="ll">white</em>,<br/>          true),<br/>    ];</span><span id="1209" class="le lf iq la b gy lk lh l li lj">    return Scaffold(<br/>      backgroundColor: Colors.<em class="ll">black12</em>,<br/>      appBar: AppBar(<br/>        elevation: 0.0,<br/>        backgroundColor: Colors.<em class="ll">transparent</em>,<br/>        leading: IconButton(<br/>          color: Colors.<em class="ll">indigo</em>,<br/>          icon: Icon(<br/>            Icons.<em class="ll">close</em>,<br/>            color: Colors.<em class="ll">white</em>,<br/>          ),<br/>          onPressed: () =&gt; Navigator.<em class="ll">of</em>(context).pop(),<br/>        ),<br/>      ),<br/>      body: SizedBox.expand(<br/>        child: Stack(<br/>          children: &lt;Widget&gt;[<br/>            Align(<br/>              alignment: Alignment.<em class="ll">center</em>,<br/>              child: Hero(<br/>                tag: widget.imgPath,<br/>                child: Image.file(<br/>                  File(widget.imgPath),<br/>                  fit: BoxFit.cover,<br/>                ),<br/>              ),<br/>            ),<br/>            new FabDialer(<br/>                _fabMiniMenuItemList, Colors.<em class="ll">teal</em>, new Icon(Icons.<em class="ll">add</em>)),<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="2fba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OnTap，图像调用UI/viewphotos.dart文件中的ViewPhotos类。因此，我们在一个支架中显示图像，appBar有一个前导图标(x)来关闭这个特定的图像。我还添加了一个浮动的动作按钮拨号器到这个页面，以防万一你想在图像上执行多个动作。这是一个为默认菜单提供替代选项的小部件。你可以在<a class="ae kl" href="https://pub.dev/packages/flutter_fab_dialer" rel="noopener ugc nofollow" target="_blank">酒吧</a>查看flutter_fab_dialer。目前，只有save按钮被赋予了onPressed方法。其他的都是空的。你可以在它们周围玩耍。😉 😉 😉</p><p id="3c76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是关于图像屏幕的全部内容。我将继续在另一篇文章中，我们将处理视频状态的应用程序。这是https://github.com/mastersam07/wa_status_saver Github回购<a class="ae kl" href="https://github.com/mastersam07/wa_status_saver" rel="noopener ugc nofollow" target="_blank">的链接。如果你遇到问题，你可以联系GitHub或者在GitHub上打开一个问题😀 😀 😀。</a></p><p id="6887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">敬请关注。</p></div></div>    
</body>
</html>