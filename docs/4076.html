<html>
<head>
<title>Virtual Machine Performance Trends</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">虚拟机性能趋势</h1>
<blockquote>原文：<a href="https://itnext.io/virtual-machine-performance-trends-7575af0ba2b?source=collection_archive---------2-----------------------#2020-04-22">https://itnext.io/virtual-machine-performance-trends-7575af0ba2b?source=collection_archive---------2-----------------------#2020-04-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="56f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个非常时期，我们收到的客户咨询比以往任何时候都多。由于越来越多的人在家工作，世界各地的客户不得不应对性能问题和服务器响应时间下降的问题。利用现有资源部署了大量新的虚拟桌面。</p><h2 id="8160" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated"><a class="ae le" href="http://Try Performance Analyzer" rel="noopener ugc nofollow" target="_blank">免费试用Opvizor】</a></h2><p id="35fa" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">当然，您可以用更多的可用资源来应对这些新的资源请求。但是缺乏预算和交付时间通常是找到快速解决方案的障碍。幸运的是，很多时候我们可以通过更好地利用现有资源来提供帮助——找到并消除严重降低性能的讨厌的配置问题。</p><p id="3835" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最重要的是… NUMA (NUMA远程节点使用、NUMA迁移)。您的系统很容易遭受超过50%的性能下降——如果每个人都在使用您的数据库，那就太严重了。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/30aefd94b5b7be33de8b81a4a46893a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HWLIJ0U4psVqgJ8erPDuIA.png"/></div></div></figure><p id="15b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于有许多不同的方法来优化NUMA内存的使用，我们认为一些真正有用的东西。我们希望展示一种趋势，而不是只检测糟糕的NUMA配置和跟踪NUMA性能指标。通过这种方式，您可以进行更改，并跟踪单个虚拟机、ESXi主机或整个群集在一段时间内的影响。</p><h1 id="2f7b" class="lw km iq bd kn lx ly lz kq ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">要检查的主要NUMA指标</h1><p id="044b" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在我们研究趋势之前，让我们从导致更好或更差NUMA排列的最重要的配置开始。</p><p id="0b8a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每位VMware vSphere管理员都应该关注哪些主要的NUMA指标:</p><ul class=""><li id="5881" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated">NUMA主节点使用</li><li id="b318" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">NUMA远程节点使用情况</li><li id="24c1" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">NUMA本地节点迁移</li></ul><p id="0930" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所有这些指标都受到以下因素的影响:</p><p id="176a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">主机配置</strong></p><ul class=""><li id="58d6" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated">VMware ESXi版本(选项越高越好)</li><li id="99b5" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">CPU插座</li><li id="076f" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">每个插槽的NUMA节点数</li><li id="b778" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">NUMA节点内存大小</li><li id="1077" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">BIOS NUMA节点交错(一些糟糕的配置启用了NUMA节点交错=非常糟糕的想法)</li><li id="856d" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">BIOS电源管理(如果您希望获得最高性能，请不要选择平衡)——【https://kb.vmware.com/s/article/1018206 T4】</li></ul><p id="6532" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">虚拟机配置</strong></p><ul class=""><li id="3fec" class="mn mo iq jp b jq jr ju jv jy mp kc mq kg mr kk ms mt mu mv bi translated">虚拟机硬件版本</li><li id="ea5c" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">CPU插座(过度消费会造成伤害)</li><li id="0552" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">每个插槽的CPU内核数(应与底层硬件一致)</li><li id="3059" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">内存大小(不要配置超过NUMA节点的容量)或确保vNUMA处于活动状态</li><li id="9f29" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">CPU/内存热添加已激活(对NUMA来说没有好结果—甚至扼杀了VMkernel正确NUMA对齐的最佳意图)；小心点</li><li id="e669" class="mn mo iq jp b jq mw ju mx jy my kc mz kg na kk ms mt mu mv bi translated">vNUMA (9个vcpu和更高版本激活vNUMA，或一个高级选项numa.vcpu.min)</li></ul><p id="97e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我肯定还有更多值得关注的，但这些是我们在过去几年中发现的最常见的事情。</p><h1 id="8527" class="lw km iq bd kn lx ly lz kq ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">基准</h1><p id="5df1" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">当您开始优化您的环境以更好地利用资源和减少资源浪费时，设置一个基准是很重要的。我建议使用PowerCLI脚本来记录最重要的配置，这样您就可以开始与它们进行比较。</p><p id="6c96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">一些好的脚本是库存和NUMA检查</strong></p><p id="22cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">vSphere的清单报告:</p><p id="9cfb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://github.com/AsBuiltReport/AsBuiltReport. T2】VMware.vSphere </p><p id="a4be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虚拟机计算优化器报告:</p><p id="7098" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">【https://flings.vmware.com/virtual-machine-compute-optimizer T4】</p><p id="bfe1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在你开始优化之前，一定要创建一个，这样有助于你保持跟踪。</p><p id="4db7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用Opvizor Performance Analyzer的众多好处之一是，它可以存储几个月甚至几年的常见配置和性能数据，因此通过选择过去的时间范围来内置基准。<strong class="jp ir">顺便说一句。我们正在努力开发一项新功能，以比较特定更改前后的虚拟机性能。</strong></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nb"><img src="../Images/3577b20d9c3b0f7c346e329bd1e0132d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AYn7grU3ohH_VItP.png"/></div></div></figure><h1 id="669f" class="lw km iq bd kn lx ly lz kq ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">性能趋势</h1><p id="8567" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">开箱即用，您可以获得许多不同的与性能相关的控制面板，这些控制面板有助于您发现NUMA失调以及由此导致的性能下降。根据经验，NUMA迁移越高越糟糕，NUMA远程节点使用率越高越糟糕。</p><p id="df0a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，当虚拟机被迁移时，这些计数器会暂时上升，但不会永久上升或一天上升数百(或数GB)。</p><p id="4bcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">控制面板可让您快速了解受影响最大的虚拟机:</p><p id="9844" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">入门:VMware虚拟机</strong></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nc"><img src="../Images/95db77fd8a4165d498f968314859e505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzwSSd2qjoRl1JLDDohB7w.png"/></div></div></figure><p id="96f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ESXi详细信息:VMware性能:ESXi主机</strong></p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi nd"><img src="../Images/f2f8c52bd1978a1d1c6b2ffc78ad35b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExioOXENc21djs-S5RPEWw.png"/></div></div></figure><h1 id="1e69" class="lw km iq bd kn lx ly lz kq ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">检查趋势</h1><p id="b84b" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">现有客户可以在客户入口网站中访问这些控制面板。如果您想在试用期间测试它们，请联系我们的销售团队。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi ne"><img src="../Images/fba1aa38324f9dc3f18140613ef1b778.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pxhZxyD4FMH__57K_SDK8g.png"/></div></div></figure><p id="e07f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以针对单个虚拟机、ESXi主机、群集，甚至跨多个vCenter进行性能比较。比较的时间范围也很灵活，您可以选择2天、7天或30天(或任何其他时间)。</p><p id="5b81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要从NUMA远程节点使用或NUMA迁移的角度比较整个环境以及每天的变化，请查看我们的NUMA专用控制面板。</p><figure class="ll lm ln lo gt lp gh gi paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="gh gi lk"><img src="../Images/30aefd94b5b7be33de8b81a4a46893a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HWLIJ0U4psVqgJ8erPDuIA.png"/></div></div></figure><h1 id="df5b" class="lw km iq bd kn lx ly lz kq ma mb mc kt md me mf kw mg mh mi kz mj mk ml lc mm bi translated">结果</h1><p id="1cf6" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">我们的客户找到了很多方法来从他们现有的环境中获得更高的性能，并通过消除性能障碍节省了一千万、几百甚至有时一百万美元的新硬件成本。</p><p id="6cd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查您的NUMA指标——您可能会惊讶有多少性能问题都源于此。</p><h2 id="d73e" class="kl km iq bd kn ko kp dn kq kr ks dp kt jy ku kv kw kc kx ky kz kg la lb lc ld bi translated"><a class="ae le" href="http://Try Performance Analyzer" rel="noopener ugc nofollow" target="_blank">免费试用Opvizor</a></h2></div></div>    
</body>
</html>