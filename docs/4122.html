<html>
<head>
<title>Log uncaught exceptions and network traffic with Chucker for Android (ps. Your QA team will love it 😍)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">记录未捕获的异常和网络流量。你的QA团队会喜欢的😍)</h1>
<blockquote>原文：<a href="https://itnext.io/log-uncaught-exceptions-and-network-traffic-with-chucker-for-android-ps-967fe3e0488c?source=collection_archive---------2-----------------------#2020-05-01">https://itnext.io/log-uncaught-exceptions-and-network-traffic-with-chucker-for-android-ps-967fe3e0488c?source=collection_archive---------2-----------------------#2020-05-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7be1fb6f8bb2476cc75f0d4354f3bbcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFq8WM-HN7Jng7GWENlVPg.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">马文·迈耶在<a class="ae kc" href="https://unsplash.com/s/photos/network?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="234b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在一个普通的开发人员工作日，您很可能必须调试一些东西，而监控网络流量可以对此有所帮助。有多种工具可以提供帮助，如<a class="ae kc" href="https://www.charlesproxy.com/" rel="noopener ugc nofollow" target="_blank"> Charles proxy </a>或<a class="ae kc" href="http://facebook.github.io/stetho/" rel="noopener ugc nofollow" target="_blank"> Stetho </a>(我个人更喜欢Stetho，因为它有一些额外的功能，如对共享偏好和数据库的读/写访问)，甚至可以直接记录流量，并在Android Studio中监控流量(如果你不喜欢任何漂亮的格式，可以使用它)。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/95bf2bea267d0e6e4342a44c6b6b401b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*fG98wQnUOtwqpd5Qd-gINQ.jpeg"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:<a class="ae kc" href="https://imgflip.com/i/3zmj31" rel="noopener ugc nofollow" target="_blank"> imgflip </a></figcaption></figure><p id="ffe2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当然，如果你正在调试，那么这意味着有东西坏了，大多数时候你可以直接在Android Studio logcat中看到，有许多不祥的红线，其中只有一条以某种方式指向导致这种情况的原因(但你仍然很幸运！你可以看到错误！)</p><p id="ae2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不过有时候，如果你可以在设备上直接完成这两项任务，可能会更容易，因为你厌倦了启动这些工具，或者你没有访问Android Studio的权限，或者当你在设备上检查不同的东西时随机发生了崩溃。</p><p id="a4a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者你有多少次听到QA测试人员说“这个设备发生了崩溃，但我现在无法重现”/“这个功能不起作用，是客户端还是后端的问题？”然后你们都试图找出发生了什么，试图重现崩溃，检查crashlytics希望找到有用的东西，检查网络响应看起来可能不正常，等等。最终，你们两个都失去了宝贵的时间和精力。</p><p id="d830" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您可以在测试设备上直接看到崩溃的确切原因，以及对于不起作用的功能，网络发送和接收的确切内容，会怎么样？更快更容易。这就是Chucker库发挥作用的地方<a class="ae kc" href="https://github.com/ChuckerTeam/chucker" rel="noopener ugc nofollow" target="_blank">https://github.com/ChuckerTeam/chucker</a></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/bf4f07fdf8cc35f71c6cdaf6f802266a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*xxX2qdpxNnSJ2ucxI11Kng.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:Chucker github页面</figcaption></figure><p id="01ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">存储库中有一个非常好的示例应用程序，基本上，为了开始记录网络流量，您必须将依赖项添加到您的应用程序build.gradle文件中:</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="eece" class="lm ln iq li b gy lo lp l lq lr">repositories {<br/>    maven { url "https://jitpack.io" }<br/>}</span><span id="35a0" class="lm ln iq li b gy ls lp l lq lr">dependencies {<br/>  debugImplementation "com.github.ChuckerTeam.Chucker:library:3.2.0"<br/>  releaseImplementation "com.github.ChuckerTeam.Chucker:library-no-op:3.2.0"<br/>}</span></pre><p id="2fb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后无论你在哪里初始化任何okhttp客户端(你用的是okthttp吧？你不是那种人……)只需添加一个拦截器:</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="8f8c" class="lm ln iq li b gy lo lp l lq lr">val client = OkHttpClient.Builder()<br/> .addInterceptor(ChuckerInterceptor(context))<br/> .build()</span></pre><p id="1832" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！您现在可以访问设备上的所有网络流量，展开通知以访问它，检查标题、请求、响应、状态代码等。</p><p id="3c9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你看到上面的截图，在chucker UI中有两个标签，一个显示网络，另一个显示错误。起初，我以为他们在谈论网络错误，但后来我检查了一点点，看到应该有被捕获的可抛出对象。在chucker的readme中，他们描述了这样一个用例:每当你有一个try-catch并且你捕捉到一个异常，你可以在Chucker中记录它并且在设备上看到它。就我个人而言，我不认为这真的有用，因为我很可能会在Android Studio中记录这些，或者在那里有一个断点来检查它们，并且对于QA来说，它们也没有太大的意义。</p><p id="9e14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，如果我们不记录被捕获的异常，而是记录未被捕获的异常呢？这将非常有用，尤其是对于上面的QA场景！所以让我们试着去做。我在这里为它创建了一个小的演示应用:<a class="ae kc" href="https://github.com/tpakis/Testing-Chucker" rel="noopener ugc nofollow" target="_blank">https://github.com/tpakis/Testing-Chucker</a></p><p id="344c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本质上，您需要做的是在应用程序类中添加一个未捕获的异常处理程序，它将在应用程序必须终止之前记录错误。首先，创建这个异常处理程序:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="d5f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，在应用程序类中注册这个崩溃处理程序:</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="c888" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我只添加了一个对默认异常处理程序的引用来使应用程序崩溃，但是如果你想在其他地方记录这个崩溃，(比如crashlytics？)你可以看看这篇非常有趣的文章<a class="ae kc" href="https://proandroiddev.com/hide-your-crashes-gracefully-and-still-report-them-9b1c85b25875" rel="noopener ugc nofollow" target="_blank">https://proandroiddev . com/hide-your-crashes-graceful-and-still-report-them-9b1c 85 b 25875</a>。</p><p id="a777" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样！现在，您可以在设备上记录未捕获的崩溃，每个人都更开心、更有效率，再也不会有虚幻的随机崩溃了！！</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lv lu l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来源:giphy.com<a class="ae kc" href="https://giphy.com/gifs/siliconvalleyhbo-2fQ1Gq3KOpvNs4NTmu" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure></div></div>    
</body>
</html>