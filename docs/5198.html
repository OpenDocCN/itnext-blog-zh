<html>
<head>
<title>Accessing the Webcam with JavaScript and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript和React访问网络摄像头</h1>
<blockquote>原文：<a href="https://itnext.io/accessing-the-webcam-with-javascript-and-react-33cbe92f49cb?source=collection_archive---------0-----------------------#2021-01-10">https://itnext.io/accessing-the-webcam-with-javascript-and-react-33cbe92f49cb?source=collection_archive---------0-----------------------#2021-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ee99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">又名我不喜欢你丑陋的(恶意软件)网络摄像头软件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/c38940d50999b0399ce44e59a86fa889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hajW2ctiRkBWqQ3u.jpg"/></div></div></figure><p id="ff25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我在2020年秋天买了一个新的微软LifeCam时，我必须下载他们的官方软件才能使用它。立刻就讨厌了。我也试过其他软件，但问题是，它们都太丑了，我心想，“用JavaScript连接到我的网络摄像头有多难？”</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="86ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其实真的很简单。您可以创建自己的浏览器应用程序来拍照、录音，甚至创建滤镜。这完全取决于你的想象力和创造力。</p><p id="888b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将讨论这一点。</p><h1 id="71d2" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第一步</h1><p id="c67a" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们需要做的第一件事是创建我们的HTML部件。我想拍照，所以我还加了一个按钮。我们将在一分钟内设计和修改所有这些。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">分解上面的代码；<code class="fe mj mk ml mm b">button</code>是用来给自己拍照的。<code class="fe mj mk ml mm b">video</code>是我们的网络摄像头流，画布是我们从视频中拍摄快照并显示它们的地方。</p><p id="9c28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一步是访问我们的网络摄像头。为此，我们需要使用钩子的useRef特性。如何做到这一点可以在下面看到，我们需要补充:</p><pre class="km kn ko kp gt mn mm mo mp aw mq bi"><span id="7bb4" class="mr lf iq mm b gy ms mt l mu mv">ref={videoRef}</span></pre><p id="e071" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">添加到所需的HTML元素，并使用</p><pre class="km kn ko kp gt mn mm mo mp aw mq bi"><span id="c191" class="mr lf iq mm b gy ms mt l mu mv">const videoRef = useRef(null);</span></pre><p id="041d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">useRef是访问DOM元素的反应方式。它所做的是，创建一个普通的JavaScript对象来保存一些属性，比如current，它对保存任何可变的值都很有用。与纯对象的不同之处在于，它在每次渲染时都给你相同的ref对象。</p><p id="8361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来要做的是，创建一个方法来获取视频并进行流式传输，</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="15ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">兴趣点是关键词:<code class="fe mj mk ml mm b">navigator</code> <strong class="jp ir">。</strong></p><p id="7336" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直接从MDN读取:</p><blockquote class="mw mx my"><p id="ce36" class="jn jo mz jp b jq jr js jt ju jv jw jx na jz ka kb nb kd ke kf nc kh ki kj kk ij bi translated"><code class="fe mj mk ml mm b"><strong class="jp ir">Navigator</strong></code>接口代表用户代理的状态和身份。它允许脚本查询它，并注册自己进行一些活动。</p><p id="cc46" class="jn jo mz jp b jq jr js jt ju jv jw jx na jz ka kb nb kd ke kf nc kh ki kj kk ij bi translated">可以使用只读的<code class="fe mj mk ml mm b"><a class="ae nd" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/navigator" rel="noopener ugc nofollow" target="_blank">window.navigator</a></code>属性来检索一个<code class="fe mj mk ml mm b">Navigator</code>对象。</p></blockquote><p id="7b73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是不言自明的。但是我觉得还是自己去看比较好，我们只需要打开dev tools，在控制台上输入navigator就可以了。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ne"><img src="../Images/286e7427609a9e94096e33c0d3b58ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RqedNxrVBaVbZELD6c93GQ.png"/></div></div></figure><p id="8948" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仔细一看，里面有<code class="fe mj mk ml mm b">mediaDevices</code>属性。如果我们展开它，我们可以看到已定义的原型，<strong class="jp ir"> getUserMedia，</strong>它返回一个承诺。我们将使用它来访问我们的网络摄像头。再次直接从MDN复制，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nf"><img src="../Images/3ba6ebd4f518955add403f3e13d77b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUNY3uZjwMhGanNSCJszxQ.png"/></div></div></figure><h2 id="16b1" class="mr lf iq bd lg ng nh dn lk ni nj dp lo jy nk nl ls kc nm nn lw kg no np ma nq bi translated">navigator.mediaDevices():</h2><p id="5178" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">返回对一个<code class="fe mj mk ml mm b"><a class="ae nd" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices" rel="noopener ugc nofollow" target="_blank">MediaDevices</a></code>对象的引用，该对象可用于获取可用媒体设备(<code class="fe mj mk ml mm b"><a class="ae nd" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices" rel="noopener ugc nofollow" target="_blank">MediaDevices.enumerateDevices()</a></code>)的信息，并使用<code class="fe mj mk ml mm b"><a class="ae nd" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" rel="noopener ugc nofollow" target="_blank">MediaDevices.getUserMedia()</a></code>请求访问媒体。</p><p id="c64c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个承诺的实现部分，我们可以将来自网络摄像头的视频分配给我们用useRef访问的视频标签。</p><pre class="km kn ko kp gt mn mm mo mp aw mq bi"><span id="d815" class="mr lf iq mm b gy ms mt l mu mv">let video = videoRef.current;        <br/>video.srcObject = stream;        <br/>video.play();</span></pre><p id="2342" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们访问网络摄像头所需的全部内容。你能得到多少乐趣完全取决于你自己！创建滤镜，效果，拍照，处理图像数据…可能性是无穷无尽的！</p><p id="8f25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您的代码应该如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="7ce2" class="le lf iq bd lg lh nr lj lk ll ns ln lo lp nt lr ls lt nu lv lw lx nv lz ma mb bi translated">第二步</h1><p id="7a05" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">从我们刚刚访问的网络摄像头拍摄快照也很容易。我们需要做的就是创建一个画布，并将数据写入画布。这里最重要的事情是从网络摄像头获取快照，并将其渲染为2D背景。</p><p id="da3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，每隔200毫秒，我们将把2D的背景写入画布。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="7256" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了停止绘制，我们需要将视频源设置为空，并在视频流的轨道上使用stop()。类似这样的事情就足够了:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="97b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一点上，你应该有你的网络摄像头在一边播放，一个画布随着时间间隔更新。</p><div class="nw nx gp gr ny nz"><a href="https://stackblitz.com/edit/react-webcam-step2?file=src/App.js" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">反应-网络摄像头-步骤2 -堆栈式</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">导出到create-react-app CLI的React应用程序的启动项目。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">stackblitz.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on kv nz"/></div></div></a></div><h1 id="8fa2" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><code class="fe mj mk ml mm b">.toDataURL()</code></h1><p id="8084" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">要从我们的网络摄像头快照到画布上拍照，我们需要使用<code class="fe mj mk ml mm b">toDataURL</code></p><p id="e947" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该方法返回一个数据URI，包含由参数<code class="fe mj mk ml mm b">type</code>指定的格式的图像表示。默认是PNG。Chrome也支持<code class="fe mj mk ml mm b">image/webp</code>类型。</p><pre class="km kn ko kp gt mn mm mo mp aw mq bi"><span id="6a5b" class="mr lf iq mm b gy ms mt l mu mv">canvas.toDataURL('image/jpeg', 1.0);</span></pre><p id="c127" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">逗号后面的部分从0到1指定照片的质量。</p><p id="ea9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我们唯一需要做的就是创建一个图像元素，并添加我们拍摄的图片作为来源。我还加了一个属性让我们下载。</p><pre class="km kn ko kp gt mn mm mo mp aw mq bi"><span id="bed3" class="mr lf iq mm b gy ms mt l mu mv">link.setAttribute(“event-name”, “name-for-the-image”);</span></pre><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="29b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在进入下一步之前，下面是您的代码应该是什么样子:</p><div class="nw nx gp gr ny nz"><a href="https://stackblitz.com/edit/react-webcam-step3?file=src/App.js" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ir gy z fp oe fr fs of fu fw ip bi translated">反应-网络摄像头-步骤3 -堆栈式</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">导出到create-react-app CLI的React应用程序的启动项目。</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">stackblitz.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on kv nz"/></div></div></a></div></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h1 id="5c42" class="le lf iq bd lg lh nr lj lk ll ns ln lo lp nt lr ls lt nu lv lw lx nv lz ma mb bi translated">有趣的部分</h1><p id="69b1" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为了这篇文章，我将添加一个功能来拍照，并使用网络摄像头的1个像素来给我创建的小场景添加效果。这个场景的灵感来自凯西·埃文斯的这支笔</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="op mi l"/></div></figure><p id="749e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将从快照中获取一个像素，并操纵我创建的场景。天空会随着像素而改变。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oq"><img src="../Images/adcd96a3150a4e60dc84db47efec5a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3TLFynsFFEpYISPuN4136w.gif"/></div></div></figure><h1 id="765c" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">现场</h1><p id="b990" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为了创建这个场景，我检查了freepik，找到了一张有山的图片。这里可以找到<a class="ae nd" href="https://www.freepik.com/free-vector/colorful-mountains-landscape-background_5476956.htm#page=1&amp;query=mountain&amp;position=16" rel="noopener ugc nofollow" target="_blank"><em class="mz"/></a><em class="mz">。</em></p><p id="aa8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，在<code class="fe mj mk ml mm b">paintToCanvas</code>函数中，我们将添加更多的行。但在此之前，我们将把这个场景添加到我们的HTML部分。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="3083" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你看到<code class="fe mj mk ml mm b">ref</code>的用法了吗？同样，在<code class="fe mj mk ml mm b">useRef</code>的帮助下，我们将在一会儿给那个元素添加一些风格。</p><p id="b4f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了添加这些样式，我将从快照中获取第一个像素及其颜色值。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="ecf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是最终版本:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="or mi l"/></div></figure></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><p id="9641" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读！特别感谢<a class="ae nd" href="https://medium.com/@Semyonic" rel="noopener"> Semih Onay </a>的点评和<a class="ae nd" href="https://twitter.com/cassiecodes" rel="noopener ugc nofollow" target="_blank"> CassieEvans </a>让我用她的笔。去看看她！</p></div></div>    
</body>
</html>