<html>
<head>
<title>RxJS &amp; Angular: Declarative If / Else</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RxJS &amp; Angular:声明性If / Else</h1>
<blockquote>原文：<a href="https://itnext.io/rxjs-angular-declarative-if-else-1d16352a3766?source=collection_archive---------0-----------------------#2021-05-14">https://itnext.io/rxjs-angular-declarative-if-else-1d16352a3766?source=collection_archive---------0-----------------------#2021-05-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a167" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于RxJS过滤算子的注记</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ec9aa028a807bde2b1adfe6594272dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zZfn8N-ueDcf3a2XTP409Q.png"/></div></div></figure><p id="f371" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">源代码:<a class="ae lq" href="https://github.com/Everduin94/erxk-article-playground/tree/main/src/app/state/workorders" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> Github🚀</strong> </a> <strong class="kw iu"> | </strong> <a class="ae lq" href="https://erxk-article-playground.web.app/articles/rxjsfilter" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">活生生的例子&amp;片段🚀</strong>T9】</a></p><h2 id="1290" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">文章目标<strong class="ak">🎯</strong></h2><p id="749d" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">利用<strong class="kw iu"> RxJS过滤器操作符。</strong>使用一致的<strong class="kw iu">声明式编程范例</strong>、<strong class="kw iu">、</strong>来潜在地提高<strong class="kw iu">代码清晰度</strong>和<strong class="kw iu">可读性</strong>。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="1eec" class="mw ls it bd lt mx my mz lw na nb nc lz jz nd ka mc kc ne kd mf kf nf kg mi ng bi translated">关键概念📝</h1><ul class=""><li id="81bd" class="nh ni it kw b kx mk la ml ld nj lh nk ll nl lp nm nn no np bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Control_flow" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">控制流</strong> </a>:是单个<a class="ae lq" href="https://en.wikipedia.org/wiki/Statement_(computer_science)" rel="noopener ugc nofollow" target="_blank">语句</a>、<a class="ae lq" href="https://en.wikipedia.org/wiki/Instruction_(computer_science)" rel="noopener ugc nofollow" target="_blank">指令</a>或<a class="ae lq" href="https://en.wikipedia.org/wiki/Function_call" rel="noopener ugc nofollow" target="_blank">功能调用</a>的顺序，一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Imperative_programming" rel="noopener ugc nofollow" target="_blank"> <em class="nq">命令式</em> </a> <em class="nq"> </em> <a class="ae lq" href="https://en.wikipedia.org/wiki/Computer_program" rel="noopener ugc nofollow" target="_blank"> <em class="nq">程序</em> </a>被<a class="ae lq" href="https://en.wikipedia.org/wiki/Execution_(computing)" rel="noopener ugc nofollow" target="_blank">执行</a>或求值</li><li id="0221" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Control_flow#Choice" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">选择</strong> </a>:根据程序员指定的<a class="ae lq" href="https://en.wikipedia.org/wiki/Boolean_datatype" rel="noopener ugc nofollow" target="_blank">布尔</a> <em class="nq">条件</em>评估为真还是假，执行不同的计算或动作。</li><li id="a5c8" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Declarative_programming" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">声明式编程</strong> </a>:是一种<a class="ae lq" href="https://en.wikipedia.org/wiki/Programming_paradigm" rel="noopener ugc nofollow" target="_blank">编程范式</a>——一种构建计算机程序的结构和元素的风格——它表达了<a class="ae lq" href="https://en.wikipedia.org/wiki/Computation" rel="noopener ugc nofollow" target="_blank">计算</a>的逻辑，而没有描述其<a class="ae lq" href="https://en.wikipedia.org/wiki/Control_flow" rel="noopener ugc nofollow" target="_blank">控制流</a></li><li id="0bcb" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><a class="ae lq" href="https://en.wikipedia.org/wiki/Reactive_programming" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">反应式编程</strong> </a> <strong class="kw iu"> : </strong>是一个<a class="ae lq" href="https://en.wikipedia.org/wiki/Declarative_programming" rel="noopener ugc nofollow" target="_blank">声明式</a> <a class="ae lq" href="https://en.wikipedia.org/wiki/Programming_paradigm" rel="noopener ugc nofollow" target="_blank">编程范例</a>涉及<a class="ae lq" href="https://en.wikipedia.org/wiki/Stream_(computing)" rel="noopener ugc nofollow" target="_blank">数据流</a>和变化的传播——RxJS是一个反应式编程的库(因此RxJS是一个声明式范例)</li><li id="80fd" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><a class="ae lq" href="https://rxjs.dev/api/operators/filter" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> RxJS过滤运算符</strong> </a>:通过只发射满足指定谓词的项目来过滤源可观测发射的项目。</li></ul><h1 id="2227" class="mw ls it bd lt mx nw mz lw na nx nc lz jz ny ka mc kc nz kd mf kf oa kg mi ng bi translated">解释和总结🧪</h1><p id="2c5b" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">强调显式控制流是命令式编程与声明式编程的区别。</p><p id="5552" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以(包括我在内的大多数人可能会)将RxJS与命令式编程混合使用。像这样写条件语句(if / else ):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">必要的</figcaption></figure><p id="5051" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用流(可观察的)、合成(合并)和过滤运算符。我们可以不写<code class="fe oh oi oj ok b">if / else</code>也能得到同样的结果。</p><blockquote class="ol om on"><p id="aaf2" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated">💡注意:命令式编程不是坏事，也不是反模式。—这只是达到相同结果的另一种方式。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="od oe gj gh gi of og bd b be z dk translated">宣言的</figcaption></figure><p id="d607" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">主要的优势(<em class="nq"> imo </em>)是维护一个编程范例(声明性的)。我相信这提高了我们后面一些例子的清晰度和可读性。</p><h2 id="0cd6" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">过滤器如何工作</h2><p id="7d67" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Filter防止带有falsey谓词的可观察对象发出。我们可以使用<a class="ae lq" href="https://rxjs-dev.firebaseapp.com/api/index/function/merge" rel="noopener ugc nofollow" target="_blank">合并</a>将两个可观测量组合在一起。然后，我们通过传递谓词/条件从可观察对象中获得排放。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/4019098884691a28e8550e0d26cf4c5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/1*DWxn30R2TiTTUemzcSzr5A.gif"/></div></figure><p id="74f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我们的例子中，如果用户没有登录到中，那么<code class="fe oh oi oj ok b">isNotAuthenticated$</code>将发出。将用户重定向到登录屏幕。<code class="fe oh oi oj ok b">isAuthenticated$</code>会不会<strong class="kw iu">不会</strong>发射，所以它的重定向不会发射。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/a3fe14f78d72defe12ea87de43e936e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/1*IfyZNnNynH9c3ntDbhcgVA.gif"/></div></figure><h1 id="3057" class="mw ls it bd lt mx nw mz lw na nx nc lz jz ny ka mc kc nz kd mf kf oa kg mi ng bi translated">例子🎨</h1><blockquote class="ol om on"><p id="fb3c" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated">使用Angular、Akita和Angular内存API</p></blockquote><h2 id="6633" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">基本示例</h2><blockquote class="ol om on"><p id="8dda" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated"><a class="ae lq" href="https://erxk-article-playground.web.app/articles/rxjsfilter" rel="noopener ugc nofollow" target="_blank">根据状态枚举切换副作用</a></p></blockquote><p id="7db9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用一个更实际的例子。我们有一个“工作订单”表。当一个特定的工作指令激活时，我们将根据它的状态触发逻辑。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="od oe gj gh gi of og bd b be z dk translated"><a class="ae lq" href="https://github.com/Everduin94/erxk-article-playground/blob/main/src/app/state/workorders/work-orders.service.ts" rel="noopener ugc nofollow" target="_blank">完整源代码</a> |注意:为了简洁起见，我只把副作用放在“ON_HOLD”中。</figcaption></figure><p id="3c61" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">订阅<code class="fe oh oi oj ok b">statusSideEffectsListener$</code>后。然后，我们通过一个传递谓词接收来自内部可观察对象的发射。</p><p id="fb4b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，如果工单状态为<code class="fe oh oi oj ok b">ON_HOLD</code>，则只有<code class="fe oh oi oj ok b">isOnHold$</code>中的逻辑会执行。</p><p id="5837" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以创建方便的方法来删除一些重复的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="a815" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">嵌套示例</h2><blockquote class="ol om on"><p id="2bbe" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated"><a class="ae lq" href="https://erxk-article-playground.web.app/articles/rxjsfilter" rel="noopener ugc nofollow" target="_blank">选择现有的或创建新的工单</a></p></blockquote><p id="b91d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们可以通过使用<code class="fe oh oi oj ok b">switchMap</code>来创建嵌套条件的等价物。</p><p id="98e8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将我们最初的例子向前推进一步。让我们使用相同的模式添加激活逻辑/副作用。然而，如果我们有一个活动的工单，我们只希望运行<code class="fe oh oi oj ok b">statusSideEffectsListener$</code>逻辑。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="od oe gj gh gi of og bd b be z dk translated"><a class="ae lq" href="https://github.com/Everduin94/erxk-article-playground/blob/main/src/app/state/workorders/work-orders.service.ts" rel="noopener ugc nofollow" target="_blank">完整来源</a> | <a class="ae lq" href="https://github.com/Everduin94/erxk-article-playground/blob/main/src/app/snippet/examples/rxjs-nested-filter.component.ts" rel="noopener ugc nofollow" target="_blank">用法</a></figcaption></figure><blockquote class="ol om on"><p id="8e02" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated">💡提示:返回<code class="fe oh oi oj ok b"><em class="it">Observable&lt;void&gt;</em></code>，我们可以向其他读者表明<code class="fe oh oi oj ok b"><em class="it">Observable</em></code>的结果没有用；因为它的目的是消除副作用。</p></blockquote><p id="2dd4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用与<code class="fe oh oi oj ok b">statusSideEffectsListener$</code>相同的模式</p><ul class=""><li id="d224" class="nh ni it kw b kx ky la lb ld ot lh ou ll ov lp nm nn no np bi translated"><code class="fe oh oi oj ok b">createNewWoListener$</code>正在创建新的工单</li><li id="e169" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><code class="fe oh oi oj ok b">loadExistingWoListener$</code>正在选择一个现有的工作指令</li><li id="1417" class="nh ni it kw b kx nr la ns ld nt lh nu ll nv lp nm nn no np bi translated"><code class="fe oh oi oj ok b">deactivateWoListener$</code>正在取消选择一个已有的工单。请注意，在这个上下文中我们不会订阅<code class="fe oh oi oj ok b">statusSideEffectsListener$</code>，因为我们不会<code class="fe oh oi oj ok b">switchMap</code>它。</li></ul><p id="17d8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">重要:</strong> <code class="fe oh oi oj ok b">statusSideEffectsListener$</code>内部使用<code class="fe oh oi oj ok b">take(1)</code>完成一次发射。防止它在每个活动的工作订单变更时发出。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h2 id="11e9" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">作者注释</h2><p id="64d4" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我在试着写一些简短的文章，避免长篇大论。关注核心思想，并提供源代码/示例作为参考。</p><p id="4af5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我说说你喜欢/不喜欢这种方法的地方。感谢阅读！</p><blockquote class="ol om on"><p id="2e61" class="ku kv nq kw b kx ky ju kz la lb jx lc oo le lf lg op li lj lk oq lm ln lo lp im bi translated">☁️<a class="ae lq" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank">flotes</a>——尝试演示，不需要登录。或者免费报名。Flotes是我记笔记和高效学习的方式，即使在我很忙的时候。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/8e468f6e74135bbbc2ecbfce7e2db2bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wGqAj2R16w33dIiKDnHEUA.png"/></div></div><figcaption class="od oe gj gh gi of og bd b be z dk translated"><a class="ae lq" href="https://flotes.app" rel="noopener ugc nofollow" target="_blank"> Flotes </a></figcaption></figure></div></div>    
</body>
</html>