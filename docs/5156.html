<html>
<head>
<title>Three ways to Capture Screenshots with Selenium WebDriver.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Selenium WebDriver抓取截图的三种方法。</h1>
<blockquote>原文：<a href="https://itnext.io/three-ways-to-how-to-capture-screenshots-with-selenium-webdriver-47358a5cd2fb?source=collection_archive---------1-----------------------#2020-12-27">https://itnext.io/three-ways-to-how-to-capture-screenshots-with-selenium-webdriver-47358a5cd2fb?source=collection_archive---------1-----------------------#2020-12-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a999fabcad98a6919f2cdf6404e59116.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJ2eEowgzv3e3uFd7bVd9w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">克里斯汀·桑杜拍摄的照片</figcaption></figure><p id="3708" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当使用Selenium进行自动化测试时，我们经常需要截取一个网页或者网页的一部分。这可能是有用的，特别是在调试测试失败或者验证我们的应用程序行为在不同浏览器之间是一致的时候。我们可以使用测试脚本在运行时截屏，通过查看应用程序在失败时的状态来帮助我们进行错误分析。<br/>在本文中，我们将看看使用Selenium WebDriver捕获屏幕截图的三种方法。</p><p id="3b89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如我们所知，自动化测试的主要目的之一是减少手工劳动。因此，使用在自动化测试运行期间捕获的屏幕截图变得非常有用。您不希望每次执行测试时都监控您的应用程序。该脚本可以获取一个屏幕截图，这有助于在测试执行完成时检查应用程序的功能/状态。当您的测试用例失败时，屏幕截图也可以帮助您，以便您可以确定您的脚本或应用程序中哪里出错了。</p><p id="068f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">截图是有益的，特别是在headless测试执行中，您看不到应用程序的GUI。尽管如此，Selenium将通过截屏捕获它，并将其存储在一个文件中，以便您稍后可以验证该应用程序。</p><p id="3e30" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了在Selenium中截屏，我们使用一个名为TakesScreenshot的接口，它使Selenium WebDriver能够捕获截屏并以不同的方式存储它。它有一个get方法“getScreenshotAs()”，该方法捕获屏幕截图并将其存储在指定的位置。</p><p id="7150" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di"> 1。</span>下面是使用Selenium WebDriver捕获网页当前可见部分的截图的基本语法:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="0f31" class="lt lu iq lp b gy lv lw l lx ly">File scrFile = ((TakesScreenshot)driver).getScreenshotAs(OutputType.FILE);<br/>FileUtils.copyFile(scrFile, new File("c:\\tmp\\screenshot.png"));</span></pre><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/8fbcf60db3f883b1f89736dcac22f012.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*GyI1VvGjTRMfV8m_f1sjZA.png"/></div></figure><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="285d" class="lt lu iq lp b gy lv lw l lx ly">public String captureScreen() {<br/>    String path;<br/>    WebDriver driver = new ChromeDriver();<br/>    try {<br/>        WebDriver webDriver = new Augmenter().augment(driver);<br/>        File source = ((TakesScreenshot)webDriver).getScreenshotAs(OutputType.<em class="ma">FILE</em>);<br/>        path = "./target/screenshots/" + source.getName();<br/>        FileUtils.<em class="ma">copyFile</em>(source, new File(path));<br/>    }<br/>    catch(IOException e) {<br/>        path = "Failed to capture screenshot: " + e.getMessage();<br/>    }<br/>    return path;<br/>}</span></pre><p id="8275" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di"> 2。</span>失败截图。</p><p id="23ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在为了在测试失败的情况下截图，我们会使用TestNG的<a class="ae kc" href="http://twitter.com/AfterMethod" rel="noopener ugc nofollow" target="_blank"> @AfterMethod </a>注释。在<a class="ae kc" href="http://twitter.com/AfterMethod" rel="noopener ugc nofollow" target="_blank"> @AfterMethod </a>注释中，我们将使用ITestResult接口的getStatus()方法返回测试结果，如果失败，我们可以使用上面的命令截图。<br/>这里还要提到的一点是，为了唯一地标识截图文件，我们将其命名为附加了测试参数的测试方法的名称(通过数据提供者传递)。为了获得测试名称和参数，我们使用ITestResult接口的getName()和getParameters()方法。如果您没有使用任何数据提供者(就像本演示中的情况)，那么您可以使用getName()方法来打印测试方法名称。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="e82d" class="lt lu iq lp b gy lv lw l lx ly">@AfterMethod <br/>public void takeScreenShotOnFailure(ITestResult testResult) throws IOException { <br/>	if (testResult.getStatus() == ITestResult.FAILURE) { <br/>		File scrFile = ((TakesScreenshot)driver).getScreenshotAs(OutputType.FILE); <br/>		FileUtils.copyFile(scrFile, new File("errorScreenshots\\" + testResult.getName() + "-" <br/>				+ Arrays.toString(testResult.getParameters()) +  ".jpg"));<br/>	} <br/>}</span></pre><p id="b8eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在为了在测试失败的情况下截图，我们会使用JUnit的<a class="ae kc" href="http://twitter.com/Rule" rel="noopener ugc nofollow" target="_blank"> @Rule </a>注释。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="4b56" class="lt lu iq lp b gy lv lw l lx ly">@Rule<br/>public ScreenShotOnFailure onFailure = new ScreenShotOnFailure();</span></pre><p id="3c4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="http://twitter.com/Rule" rel="noopener ugc nofollow" target="_blank"> @Rule </a>注释中，我们将使用MethodRule接口的ScreenShotOnFailure()方法返回测试结果，如果失败，我们可以使用上面的命令截图。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="feec" class="lt lu iq lp b gy lv lw l lx ly">public class ScreenShotOnFailure implements MethodRule {<br/><br/>    @Override<br/>    public Statement apply(final Statement statement, final FrameworkMethod frameworkMethod, final Object object) {<br/>        return new Statement() {<br/>            @Override<br/>            public void evaluate() throws Throwable {<br/>                try {<br/>                    statement.evaluate();<br/>                } catch (RuntimeException throwable) {<br/>                    makeScreenshotOnFailure();<br/>                    throw throwable;<br/>                }<br/>            }<br/><br/>            @Attachment("Screenshot on failure")<br/>            public byte[] makeScreenshotOnFailure() {<br/>                return ((TakesScreenshot) DriverHolder.<em class="ma">getDriverThread</em>()).getScreenshotAs(OutputType.<em class="ma">BYTES</em>);<br/>            }<br/>        };<br/>    }<br/>}</span></pre><p id="c85f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi lb translated"><span class="l lc ld le bm lf lg lh li lj di"> 3。</span>听众。</p><p id="e27f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候在测试自动化工程师的工作中，您需要使用额外的库来创建报告。在本文中，我将考虑Allure框架的例子。</p><p id="6fb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Allure Framework是一个灵活的轻量级多语言测试报告工具，它不仅以简洁的web报告格式非常简洁地展示了已测试的内容，还允许参与开发过程的每个人从测试的日常执行中提取最大限度的有用信息。你可以在<a class="ae kc" href="https://docs.qameta.io/allure/" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多信息。</p><p id="f5e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，您需要创建一个诱人的屏幕截图:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="f346" class="lt lu iq lp b gy lv lw l lx ly"><em class="ma">/**<br/> * The class Allure screen shooter.<br/> */<br/></em>public class AllureScreenShooter extends ExitCodeListener {<br/><br/>    <em class="ma">/**<br/>     * The class Allure screen shooter.<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">result this is ITestResult.<br/>     */<br/>    </em>public void onTestFailure(final ITestResult result) {<br/>        super.onTestFailure(result);<br/>        AllureHelpers.<em class="ma">takeScreenshot</em>();<br/><br/>    }<br/>}</span></pre><p id="5bb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，您需要创建Allure Helpers，在其中您可以使用<a class="ae kc" href="http://twitter.com/Attachment" rel="noopener ugc nofollow" target="_blank"> @Attachment </a>注释来注册所有必要的动作。</p><p id="e052" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Java代码中的附件只是一个用<a class="ae kc" href="http://twitter.com/Attachment" rel="noopener ugc nofollow" target="_blank"> @Attachment </a>注释的方法，它返回一个字符串或byte[]，应该添加到报告中。</p><p id="8243" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用<a class="ae kc" href="http://twitter.com/Attachment" rel="noopener ugc nofollow" target="_blank"> @Attachment </a>注释的方法中的返回类型不同于String或byte[]，我们在返回值上调用toString()来获取附件内容。您可以使用如上所示的<a class="ae kc" href="http://twitter.com/Attachment" rel="noopener ugc nofollow" target="_blank"> @Attachment </a>注释的类型参数为每个附件指定确切的MIME类型。但是，没有必要为所有附加文件明确指定附件类型，因为Allure默认情况下会分析附件内容，并且可以自动确定附件类型。处理纯文本文件时，通常需要指定附件类型。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="9b87" class="lt lu iq lp b gy lv lw l lx ly"><em class="ma">/**<br/> * The class Allure helpers.<br/> */<br/></em>public final class AllureHelpers {<br/>    <em class="ma">/**<br/>     * Attach text string.<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">text the text<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the string<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "AllureTextReport", type = "text/plain", fileExtension = ".txt")<br/>    public static String attachText(final String text) {<br/>        return text;<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Attach csv string.<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">csv the csv<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the string<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "AllureCSVReport", type = "text/csv", fileExtension = ".csv")<br/>    public static String attachCSV(final String csv) {<br/>        return csv;<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Get page source byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "Html source", type = "text/html", fileExtension = ".html")<br/>    public static byte[] getPageSource() {<br/>        return <em class="ma">getPageSourceBytes</em>();<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Take screenshot byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "Screenshot", type = "image/png", fileExtension = ".png")<br/>    public static byte[] takeScreenshot() {<br/>        return <em class="ma">getScreenshotBytes</em>();<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Take screenshot byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">name the name<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "{name}", type = "image/png", fileExtension = ".png")<br/>    public static byte[] takeScreenshot(final String name) {<br/>        return <em class="ma">getScreenshotBytes</em>();<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Take screenshot byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">elem the elem<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>@SuppressWarnings("UnusedReturnValue")<br/>    @Attachment(value = "Element screenshot", type = "image/png", fileExtension = ".png")<br/>    public static byte[] takeScreenshot(final SelenideElement elem) {<br/>        return <em class="ma">getScreenshotBytes</em>(elem);<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Get page source bytes byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>public static byte[] getPageSourceBytes() {<br/>        return WebDriverRunner.<em class="ma">getWebDriver</em>().getPageSource().getBytes(StandardCharsets.<em class="ma">UTF_8</em>);<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Get screenshot bytes byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>public static byte[] getScreenshotBytes() {<br/>        return ((TakesScreenshot) WebDriverRunner.<em class="ma">getWebDriver</em>()).getScreenshotAs(OutputType.<em class="ma">BYTES</em>);<br/>    }<br/><br/>    <em class="ma">/**<br/>     * Get screenshot bytes byte [ ].<br/>     *<br/>     * </em><strong class="lp ir"><em class="ma">@param </em></strong><em class="ma">elem the elem<br/>     * </em><strong class="lp ir"><em class="ma">@return </em></strong><em class="ma">the byte [ ]<br/>     */<br/>    </em>public static byte[] getScreenshotBytes(final SelenideElement elem) {<br/>        return elem.getScreenshotAs(OutputType.<em class="ma">BYTES</em>);<br/>    }<br/>}</span></pre><p id="b2ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们项目的基类中，您需要调用AllureScreenShooter:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="5e6a" class="lt lu iq lp b gy lv lw l lx ly"><em class="ma">/**<br/> * The class Base web class.<br/> */<br/></em>@Listeners(AllureScreenShooter.class)<br/>public class BaseWeb {}</span></pre><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/8fbcf60db3f883b1f89736dcac22f012.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*GyI1VvGjTRMfV8m_f1sjZA.png"/></div></figure><figure class="lk ll lm ln gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mb"><img src="../Images/3bc24fdd7c72892c8f40114d7f668772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCeC-_j91U5Sw4o7bY6Y9w.png"/></div></div></figure><p id="dcb0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们看到了使用Selenium WebDriver捕获屏幕截图的三种方法。</p><p id="ab9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在第一种方法中，我们看到了如何直接使用Selenium捕获整个屏幕。然后，我们学习了如何使用TestNG和JUnit捕获页面，在第三种方法中，我们考虑使用侦听器。</p><p id="753c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Allure的一个主要好处是不同的WebDrivers在截图时会有不同的表现。使用Allure将我们从这种复杂性中抽象出来，并给出透明的结果，而与我们使用的驱动程序无关。请务必查看完整的文档，以了解所有可用的支持特性。</p></div></div>    
</body>
</html>