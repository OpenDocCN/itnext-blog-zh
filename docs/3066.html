<html>
<head>
<title>Create, build and ship a Python3 pip module in 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在5分钟内创建、构建并发布Python3 pip模块</h1>
<blockquote>原文：<a href="https://itnext.io/create-build-and-ship-a-python3-pip-module-in-5-minutes-31dd6d9d5c8f?source=collection_archive---------3-----------------------#2019-09-27">https://itnext.io/create-build-and-ship-a-python3-pip-module-in-5-minutes-31dd6d9d5c8f?source=collection_archive---------3-----------------------#2019-09-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/1d97404a81b0f8b4db2c012a9fc5d9fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jXbr1V27rFkFMlN4"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">兰迪·法特在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="06f8" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你使用Python，你可能会在路上遇到<strong class="ki jk"> pip </strong>。Pip是Python模块最常用的包管理器。</p><blockquote class="le lf lg"><p id="e2c9" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki jk"> Pip </strong>是“Pip安装包”<a class="ae jg" href="https://en.wikipedia.org/wiki/Pip_(package_manager)" rel="noopener ugc nofollow" target="_blank">维基百科</a>的<a class="ae jg" href="https://en.wikipedia.org/wiki/Recursive_acronym" rel="noopener ugc nofollow" target="_blank">递归首字母缩略词</a></p></blockquote><p id="cac2" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">去年是pip的10岁生日，这使得它成为一款优秀的软件——这在当今是罕见的。我记得皮普被认为是一个累赘的时候。皮普被贴上了船上第二个叛逆船长的标签，众所周知，他与发行的主要包装系统相冲突，带来了各种各样与安全和稳定性相关的问题。</p><p id="75fc" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天，有了容器——比如Docker——这些担忧就不复存在了。应用程序代码及其依赖关系运行在一个受控的、隔离的环境中。漏洞测试变得更加容易，也不再需要与系统管理员斗争。</p><p id="86f3" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python的使用和受欢迎程度也在飙升——这要归功于机器学习。这使得世界渴望更多的Python模块。</p><p id="d1e4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运送一些模块。</p><h1 id="f02d" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">运送pip包裹—自动化方式</h1><h2 id="1f41" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">先决条件</h2><ul class=""><li id="05fd" class="mv mw jj ki b kj mx kn my kr mz kv na kz nb ld nc nd ne nf bi translated">PyPi账户。在此注册<a class="ae jg" href="https://pypi.org/account/register/" rel="noopener ugc nofollow" target="_blank">并在安全的地方保存您的凭证。</a></li><li id="1e32" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld nc nd ne nf bi translated">码头工人。安装说明:<a class="ae jg" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-docker-ce" rel="noopener ugc nofollow" target="_blank"> Ubuntu </a>或<a class="ae jg" href="https://docs.docker.com/docker-for-mac/install/" rel="noopener ugc nofollow" target="_blank"> Mac </a>。</li></ul><p id="dfb6" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你还需要运行make的能力，有一个POSIX兼容的shell和一个代码编辑器——几乎所有的Linux、Unix或Mac系统都可以工作。</p><h2 id="5bfb" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">PyShipper</h2><p id="f7cb" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">PyShipper 是一个自动化的部分，完成建立一个模块结构的繁重工作，添加一些样板代码，并提供一个管道来构建、测试和发布一个模块——当你更新或创建一个模块时节省时间。</p><p id="43ac" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相关代码大部分在Makefile中，补充了一些Docker配置和一个稍加修改的setup.py。对于好奇的读者来说，之前的这篇文章解释了基础。<a class="ae jg" href="https://github.com/LINKIT-Group/pyshipper" rel="noopener ugc nofollow" target="_blank"> PyShipper </a>是一个完成Python模块交付工作的版本。</p><h2 id="9d66" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">步伐</h2><ol class=""><li id="f124" class="mv mw jj ki b kj mx kn my kr mz kv na kz nb ld no nd ne nf bi translated">想个名字</li><li id="ac24" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld no nd ne nf bi translated">创建新的模块目录</li><li id="e2f1" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld no nd ne nf bi translated">配置变量</li><li id="644e" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld no nd ne nf bi translated">运行和编辑代码</li><li id="f809" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld no nd ne nf bi translated">制作模块</li><li id="1e62" class="mv mw jj ki b kj ng kn nh kr ni kv nj kz nk ld no nd ne nf bi translated">出版</li></ol><p id="f811" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将介绍每一步，并解释PyShipper在哪里以及如何自动完成一些事情。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h2 id="5646" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">1.想个名字</h2><p id="3bfd" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">如果你发现很难想出一个好名字，你并不孤单:</p><blockquote class="le lf lg"><p id="4ec8" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated">计算机科学只有两个硬东西:缓存失效和事物命名。—菲尔·卡尔顿</p></blockquote><p id="fcf9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我总是纠结于给事物命名。在缓慢思考模式下数小时后，我通常会以一个描述解决了什么问题的名称结束——因此命名为PyShipper。如果取了一个名字，通常可以在名字前或后加上“Py”、“Script”、“Tool”或类似的东西。</p><p id="21f0" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">命名是我还没有弄清楚如何自动化的事情之一。如果有什么机器学习相关的想法，请分享！</p><h2 id="9bab" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">2.创建新的模块结构</h2><p id="2be7" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">这个关于Python包的<a class="ae jg" href="https://python-packaging.readthedocs.io/en/latest/minimal.html" rel="noopener ugc nofollow" target="_blank">文档</a>描述了所需的包结构。即使我们自动化了这一步，不言而喻，文档仍然是必不可少的阅读材料——对调试很有用。</p><p id="36c9" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看俏皮话。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="900c" class="mj lm jj ob b gy of og l oh oi"># get a copy of PyShipper and change into it<br/>git clone <a class="ae jg" href="https://github.com/LINKIT-Group/pyshipper.git" rel="noopener ugc nofollow" target="_blank">https://github.com/LINKIT-Group/pyshipper.git</a><br/>cd pyshipper</span><span id="2fc4" class="mj lm jj ob b gy oj og l oh oi"># fork (copy/ paste) the contents to a new directory<br/>make fork dest=~/${YOUR_NEW_MODULE_NAME}</span></pre><p id="05bf" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这会将PyShipper的剥离版本分支到一个名为~/${YOUR_NEW_MODULE_NAME}的新目录中。LICENSE和README.md等文件不会被复制。毕竟，您拥有新模块，因此需要向它添加许可证和文档——没有附加的许可证条件。</p><p id="2763" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于回顾的目的，这是Makefile fork目标:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">通过Makefile派生(复制)一个目录</figcaption></figure><p id="5f88" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安全说明:只有在没有目录或目录为空的情况下，才会复制文件。</p><h2 id="323d" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">3.配置变量</h2><p id="5d0e" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我们的下一步是切换到新目录并编辑/variables文件:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">/变量文件的内容</figcaption></figure><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="4a97" class="mj lm jj ob b gy of og l oh oi"># switch to the new module<br/>cd ~/${YOUR_NEW_MODULE_NAME}</span><span id="d323" class="mj lm jj ob b gy oj og l oh oi"># edit the /variables file<br/>{replace_with_your_editor} variables</span></pre><p id="41b7" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">/variables中的NAME变量由Makefile拾取，所有变量都导出到Docker容器的环境中，在容器执行过程中由setup.py使用。</p><p id="2146" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Makefile行花了我几个小时来工作，正确地去除强引号几乎总是很痛苦。当我偶然发现这份文档时，问题变得简单了——至少对GNU AWK来说是第47号。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">将文件中的变量检索到Makefile中</figcaption></figure><p id="0026" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然一行Makefile代码很难，但是将变量传递给setup.py要容易得多。我只需要一种将所有变量传递给容器的方法。一个短~/。容器空间中的profile文件完成这项工作——注意，要完成这项工作,/variables文件也必须通过链接或挂载存在。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">环境变量通过。轮廓</figcaption></figure><p id="27a0" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，这是/setup.py文件，它在容器环境中加载变量。小lambda确保在变量不存在时插入空字符串。</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">带有环境变量的Setuptools setup.py</figcaption></figure><h2 id="9a26" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">4.运行和编辑代码</h2><p id="9010" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">PyShipper附带了一个/module目录，其中包含模块的样板代码。还有一种编码模式，带有一个最小的类似“hello-world”的函数，可以以CLI和import两种方式调用。</p><p id="ee49" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当然，所有的python 3——正如Python2于2020年1月1日停产一样！</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="e227" class="mj lm jj ob b gy of og l oh oi"># enter the container runtime<br/>make shell</span><span id="3a91" class="mj lm jj ob b gy oj og l oh oi"># test run the module in CLI<br/>python3 -m module --name "PyShipper"</span><span id="482b" class="mj lm jj ob b gy oj og l oh oi"># start Python3, import the module and test<br/>python3</span><span id="b6d5" class="mj lm jj ob b gy oj og l oh oi">&gt;&gt;&gt; import module<br/>&gt;&gt;&gt; module.main(name="PyShipper")</span></pre><p id="0dff" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这会运行/module下的代码。不使用“模块”这个名称，也可以用自己模块的名称来代替。创建一个符号链接来使两者都工作——在发布的版本中，只有您自己的名字可以用来引用该模块。</p><p id="2a53" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你是一个Python开发者，我确信你需要知道下一步做什么。所有要编辑的模块代码都在/模块中——祝您玩得开心！</p><h2 id="3b8f" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">5.制作模块</h2><p id="3d20" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">当你有一个最小的工作版本时，就是时候构建这个包了。你可能想首先做的一件事是检查/variables中的版本，并确保它是更新的——我刚刚提醒自己在下一个版本中自动执行这个操作，谁喜欢跟踪版本呢？—右；).</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="eb1f" class="mj lm jj ob b gy of og l oh oi"># build the module -- this runs setup.py in the container<br/>make module</span><span id="1111" class="mj lm jj ob b gy oj og l oh oi"># better practice version of the former<br/># includes pylint code quality testing<br/>make pylint module</span></pre><p id="e90c" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是连接到上面一行程序的Makefile配置:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="3db4" class="mj lm jj bd ln mk ml dn lr mm mn dp lv kr mo mp lz kv mq mr md kz ms mt mh mu bi translated">6.出版</h2><p id="3db0" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">构建过程的输出是一个gzipped tar归档文件，位于/dist目录中。通过将这个文件上传到<a class="ae jg" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank">PyPi</a>——Python包索引——模块就发布了，每个人都可以通过Python pip进行安装。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="9b7d" class="mj lm jj ob b gy of og l oh oi"># upload the module<br/>make upload</span></pre><p id="e26f" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面的命令提示输入用户名和密码。您需要插入您的<a class="ae jg" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>凭证——参见本章开头的先决条件。</p><p id="caa4" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上传目标的Makefile片段是:</p><figure class="nw nx ny nz gt iv"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">使用twine上传到PyPi</figcaption></figure><p id="1ec5" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在您创建了模块，并将其发布在<a class="ae jg" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>上之后，您可以将它安装在任何有能力的系统上，并像使用任何其他Python3 pip模块一样使用它。</p><pre class="nw nx ny nz gt oa ob oc od aw oe bi"><span id="3d17" class="mj lm jj ob b gy of og l oh oi"># install the module on system<br/>sudo python3 -m pip install ${YOUR_NEW_MODULE_NAME}</span></pre><h1 id="21f9" class="ll lm jj bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">最后的想法</h1><p id="680a" class="pw-post-body-paragraph kg kh jj ki b kj mx kl km kn my kp kq kr nl kt ku kv nm kx ky kz nn lb lc ld im bi translated">我自己已经在使用这种自动化，我对它很满意。我定期为特定任务创建小的Python模块；之后在容器或无服务器环境中导入它们非常容易。</p><p id="b5d2" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，有了这种自动化，更多的重复性工作被削减，这意味着有更多的时间花在其他创新上。</p><p id="c455" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你会发现这同样有用。如果这有助于(至少对你们中的一些人来说)为Python生态系统做出贡献，我会很高兴。</p><p id="3d1d" class="pw-post-body-paragraph kg kh jj ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python模块写的开心！</p></div></div>    
</body>
</html>