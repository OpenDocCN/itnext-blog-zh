<html>
<head>
<title>Flutter State Management Confusion and Solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振状态管理的困惑与解决方案</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-state-management-signal-slot-a6191e93c9d6?source=collection_archive---------2-----------------------#2022-07-03">https://itnext.io/flutter-state-management-signal-slot-a6191e93c9d6?source=collection_archive---------2-----------------------#2022-07-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="ac0c" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">我写这篇文章不是为了向社区介绍一种新的状态管理方法，而是为了解释社区和代码中存在的混乱，以及我自己如何简化它。本文还包括我自己的状态管理包。<a class="ae kp" href="https://pub.dev/packages/sign" rel="noopener ugc nofollow" target="_blank">签|镖包(pub.dev) </a></p></blockquote><p id="bf0d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如您所知，状态管理是Flutter中的热门话题之一。</p><p id="c5fc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">许多方法、许多库和数以千计的文章、社区中不断被问及的问题……我已经做了三年的Flutter开发者，这些问题、文章、讨论从来没有减少，它们只是增加了。</p><h2 id="b5e5" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">这么多事情</h2><p id="8e8c" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">我浏览示例、教程和源代码。我问的问题是:为什么有这么多东西？我想做的是通知小部件一个信息已经改变。为什么一个状态管理库要由上万行代码组成？ref，watch，read，context，observable，of，todoProvider，allTodoProvider，someTodoProvider，dependency injection…有几十种不同的概念、用途和例子在继续。</p><p id="a2ac" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">由于许多状态管理库的文档太长，无法在一页中解释清楚，所以它将它们引向外部资源。一个有40多个话题。在其中一个版本中，README.md被用作一个changelog，它只讲述从旧版本的迁移。</p><p id="50af" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我知道，例如GetX提供了许多不同的便利/概念。所以它有很长的文档和数万行代码。我当然不是在批评现有的方法。</p><p id="e216" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们想要做的只是报告对小部件的更改。真的没必要搞这么大的东西。</p><p id="5f09" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们不得不承认，对于大三或者mid来说肯定是有困惑的(或者说概念/东西太多了)。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="d176" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">现在，从一开始，我将以最简单的形式解释什么是状态管理，以及如何做，使用我自己的(最近重命名并发布的)方法(包)。该软件包由550行代码组成，包括列表和映射类迭代，+250行，带有flutter小部件，即只有800行和3个类。而且非常快。</p><h2 id="067f" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">什么是国家管理？</h2><p id="469b" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">非常简单:状态管理就是在期望的时间管理期望的小部件的重建。</p><p id="b288" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">你如何进行这种管理会极大地影响你的表现。它还会增加/减少编码时间。当与团队合作或随着项目的增长，它也改变了可管理性。</p><h2 id="2dba" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">如何管理状态？</h2><p id="0442" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">改个东西，报给<code class="fe ly lz ma mb b">State</code>。仅此而已。</p><p id="6ad8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们是怎么做到的:<code class="fe ly lz ma mb b">setState</code>。</p><p id="3cf9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">注意，<code class="fe ly lz ma mb b">setState((){})</code>将一个函数作为参数。这个意思是:<code class="fe ly lz ma mb b">&lt;notifyWidget&gt;(&lt;before_change_something&gt;)</code>。</p><p id="aa17" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">setState重新构建您所在的小部件和树下的其他小部件。</p><p id="2b84" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">小部件2中的setState，重建红色区域。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/b980a69c8474decfe7b753d7d436e835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*E7BVRgOxfJxSTGDOZZXIEg.png"/></div></figure><h2 id="cd5f" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">如何优化？</h2><p id="eb23" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">每个setState都会导致小部件被重新构建、重新呈现，或者导致决定应该重新构建/呈现的函数调用。</p><p id="3813" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">虽然Flutter已经过优化，但是阻止进行这种优化的函数调用会增加您的帧速率。(在一个简单的页面上可能有高达50%的差异。)</p><p id="01b9" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">剩下要做的唯一一件事就是:让您称为setState的小部件尽可能小。</p><p id="7aed" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">向树中添加新的更小的小部件并在其中执行setState比更具包容性的setState更有效。</p><p id="063d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们的基本原则就是这样。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/7843e9ff078263556d68e8a6060c8c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*boRpBmGrRGgW1gdywbtg4A.png"/></div></div></figure><h2 id="6b50" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">管理数据</h2><p id="810a" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">现在可以问一些问题:我如何将值传递给这些子部件。如何读取子部件中的变化并通知另一个子部件？</p><p id="b298" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><strong class="jt ir">这些问题真的与状态管理无关！</strong></p><p id="f4a5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">您可以用参数将这个变量数据发送给子部件，可以将这个数据保存在另一个类实例中，可以将其定义为一个全局实例，并且可以从任何地方读取它。还有许多其他方法。</p><p id="c93b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">要将子部件中的更改发送到其他子部件，您必须触发一个函数。这个被触发的函数必须以某种方式在其他子部件的状态中运行setState。</p><h2 id="3f73" class="kt ku iq bd kv kw kx dn ky kz la dp lb kq lc ld le kr lf lg lh ks li lj lk ll bi translated">状态变化如何触发一个函数，我如何报告它？</h2><p id="d013" class="pw-post-body-paragraph jq jr iq jt b ju lm jw jx jy ln ka kb kq lo ke kf kr lp ki kj ks lq km kn ko ij bi translated">现在我想用我自己的包来解释这个问题。我的包只是ValueNotifier或GetX的简化版。</p><p id="1679" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我只是阐述一个观点。从这个角度来看，你可以使用任何你喜欢的方法。</p><p id="a1e0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我的灵感来自QT框架中的信号槽结构，并这样命名。</p><p id="3968" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我的包是独立的。您可能还需要监听、报告和处理Dart包/程序中的一些变化。</p><p id="0bde" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">Dart包:<a class="ae kp" href="https://pub.dev/packages/sign" rel="noopener ugc nofollow" target="_blank"> sign | Dart包(pub.dev) </a></p><p id="9dba" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">颤振包:<a class="ae kp" href="https://pub.dev/packages/sign_flutter" rel="noopener ugc nofollow" target="_blank"> sign_flutter |颤振包(pub.dev) </a></p><p id="4086" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">首先，让我解释一下如何在dart中监听、通知和处理更改。</p><p id="5053" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">现在，我们需要一个在发生变化时发出信号的类，以及一个接收这些信号的类。所以<code class="fe ly lz ma mb b">Signal</code>和<code class="fe ly lz ma mb b">Slot</code>。</p><p id="6323" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们创建一个<code class="fe ly lz ma mb b">Signal</code>，我们给这个信号添加一个<code class="fe ly lz ma mb b">Slot</code>，每当这个信号的<code class="fe ly lz ma mb b">value</code>改变时，插槽的<code class="fe ly lz ma mb b">onValue</code>功能运行。</p><ol class=""><li id="c993" class="mp mq iq jt b ju jv jy jz kq mr kr ms ks mt ko mu mv mw mx bi translated">创建信号</li></ol><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="2be8" class="kt ku iq mb b gy nc nd l ne nf"><em class="js">/// Create a Signal from a variable</em><br/><strong class="mb ir">final</strong> Signal&lt;int&gt; signal = 0.signal;</span></pre><p id="60e8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">2.定义一个槽</p><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="f517" class="kt ku iq mb b gy nc nd l ne nf"><strong class="mb ir">class</strong> <strong class="mb ir">MySlot</strong> <strong class="mb ir">extends</strong> <strong class="mb ir">Slot</strong>&lt;<strong class="mb ir">int</strong>&gt; {<br/>  MySlot();<br/><br/>  <strong class="mb ir">@override</strong><br/>  <strong class="mb ir">void</strong> onValue(int value) {<br/>    <em class="js">// Do something</em><br/>  }<br/>}</span></pre><p id="6d0a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">3.添加插槽</p><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="52a2" class="kt ku iq mb b gy nc nd l ne nf">signal.addSlot(MySlot());</span></pre><p id="49f5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">4.改变数值或发送信号</p><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="7138" class="kt ku iq mb b gy nc nd l ne nf"><strong class="mb ir">void</strong> f() {<br/>  signal.value++;<br/>  <em class="js">// OR</em><br/>  signal.sign();<br/>}</span></pre><p id="f9df" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在某些情况下，您可能需要从多个信号读取值的插槽。你可以用<code class="fe ly lz ma mb b">MultiSignal</code>来做这个。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ng"><img src="../Images/52566887ed1ce81504069d478406a811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLBomJa2Ag7PqvbeasbuCg.jpeg"/></div></div></figure><p id="9f31" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated"><strong class="jt ir">现在，回到子部件问题。</strong></p><p id="22a6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">有了这个信号，我们可以更改数据，我们还可以创建一个新的小部件，为这个信号添加一个插槽。</p><p id="9b92" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">该语句向该信号添加了一个槽，并创建了一个新的子部件:</p><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="06c1" class="kt ku iq mb b gy nc nd l ne nf">signal.builder((value) =&gt; Text('$value'))</span></pre><p id="a15e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这条语句允许上面的小部件被重新构建:</p><pre class="md me mf mg gt my mb mz na aw nb bi"><span id="6e56" class="kt ku iq mb b gy nc nd l ne nf">signal.value++;</span></pre><p id="b50a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果您想要创建一个读取信号值自定义子部件，那么您应该将“signal”变量发送给这个子部件，并创建一个读取其值的新的子部件。</p><p id="6152" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">坏:<code class="fe ly lz ma mb b">MyCustomWidget(value: signal.value)</code></p><p id="d334" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">好:<code class="fe ly lz ma mb b">MyCustomWidget(signal : signal)</code>并使用<code class="fe ly lz ma mb b">signal.builder</code>。</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="1953" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">性能测试报告:<a class="ae kp" href="https://github.com/Mehmetyaz/state_management_performance" rel="noopener ugc nofollow" target="_blank">Mehmetyaz/state _ management _ performance(github.com)</a></p><p id="d363" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">签署一揽子回购协议:<a class="ae kp" href="https://github.com/Mehmetyaz/sign" rel="noopener ugc nofollow" target="_blank">穆罕默德亚兹/签署(github.com)</a></p><p id="a09b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">sign _ flutter package repo:<a class="ae kp" href="https://github.com/Mehmetyaz/sign_flutter" rel="noopener ugc nofollow" target="_blank">Mehmetyaz/sign _ flutter(github.com)</a></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="a771" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">对我来说，国家管理就是这样。我再继续写下去，就脱离题目的语境了。因此:</p><p id="3bf6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">谢谢你听我说！</p><p id="c0a1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">穆罕默德·亚兹</p><p id="ff7d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">mehmedyaz@gmail.com</p></div></div>    
</body>
</html>