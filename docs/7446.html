<html>
<head>
<title>Deploy an application to Azure App Service Private Endpoint from the Azure DevOps pipeline.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Azure DevOps管道将应用程序部署到Azure App Service私有端点。</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-an-application-to-azure-app-service-private-endpoint-from-the-azure-devops-pipeline-f71c7d128dae?source=collection_archive---------1-----------------------#2022-09-26">https://itnext.io/deploy-an-application-to-azure-app-service-private-endpoint-from-the-azure-devops-pipeline-f71c7d128dae?source=collection_archive---------1-----------------------#2022-09-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0bcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi kl translated">最近，我不得不使用Azure DevOps管道来部署Azure App服务。<br/>听起来容易吗？我也是这么想的。</p><p id="7235" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有一个陷阱！</p><p id="73f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序服务已经设置为切断所有公共访问，这意味着应用程序只能从虚拟网络内部通过私有IP地址访问。</p><h1 id="3d2b" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么？</h1><p id="d06a" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">一些公司仍然在内部存储大量数据/组件。并非所有这些本地资源都可以迁移到云中。有多种原因，从成本、安全性、时间等等开始。这就是为什么有时我们需要在本地和混合云环境中工作。在这种情况下，公司网络通常不对公共互联网开放，内部和azure之间的通信基于VPN连接和虚拟网络。这就是为什么一些资源将被限制部署到私有端点，它们不能被公开使用。</p><p id="a176" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">知道了为什么我们需要关心这样的事情，我们来看看解决方案。</p><p id="65c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这种情况下？部署到此类应用服务的最简单同时又是最好的解决方案是什么？</p><h2 id="1ae8" class="lx kv iq bd kw ly lz dn la ma mb dp le jy mc md li kc me mf lm kg mg mh lq mi bi translated">简短回答:</h2><ul class=""><li id="f376" class="mj mk iq jp b jq ls ju lt jy ml kc mm kg mn kk mo mp mq mr bi translated">Azure虚拟网络</li><li id="ca9c" class="mj mk iq jp b jq ms ju mt jy mu kc mv kg mw kk mo mp mq mr bi translated">Azure虚拟机规模集</li><li id="0ecb" class="mj mk iq jp b jq ms ju mt jy mu kc mv kg mw kk mo mp mq mr bi translated">Azure DevOps</li></ul><p id="d4ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用上面的三个组件，我们将建立一个部署管道来部署我们的。Net应用程序到私有的Azure应用程序服务。</p><h1 id="78bc" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">理论:</h1><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi mx"><img src="../Images/b4c0bab4cc7df114a6cf3b8bf8c00003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzGQRT6DFIpjLC1YBiaUXw.png"/></div></div></figure><p id="ea28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，VMSS将是一个自托管Azure DevOps代理的容器。从Azure DevOps触发的管道将在VMSS执行。VMSS位于专用虚拟网络中，因此它可以解析专用虚拟网络的专用IP地址。</p><h1 id="5990" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">假设:</h1><ul class=""><li id="1c27" class="mj mk iq jp b jq ls ju lt jy ml kc mm kg mn kk mo mp mq mr bi translated">您已经创建了一个虚拟网络</li><li id="e1e0" class="mj mk iq jp b jq ms ju mt jy mu kc mv kg mw kk mo mp mq mr bi translated">您已经创建了应用服务和应用服务计划</li></ul><h1 id="c285" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">实用部分:</h1><figure class="my mz na nb gt nc"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="09e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Azure门户上，让我们创建一个Azure虚拟网络规模集。<br/>这里有很多设置，但出于演示目的，我们将大部分设置保留为默认设置。</p><p id="3536" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们应该关注“网络选项卡”，在这里，我们需要从虚拟网络列表中选择我们的应用服务所使用的虚拟网络。</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nl"><img src="../Images/996cb9fd5934f06ceed4e4ec34413a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRwiL1ri8BmMNv3zbcF2Rw.png"/></div></div></figure><p id="9f66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">搞定</strong>——真快:)</p><h2 id="3827" class="lx kv iq bd kw ly lz dn la ma mb dp le jy mc md li kc me mf lm kg mg mh lq mi bi translated">Azure DevOps:</h2><p id="b3e9" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">在这里，我们需要导航到组织设置-&gt;代理池:</p><p id="4675" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在右上角，单击“添加池”，您应该会看到类似这样的内容:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nm"><img src="../Images/39b1debaa512a3768c885294a2f20a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a78sThgiONZg_zmoG01VJA.png"/></div></div></figure><p id="378b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的选项非常自我描述。</p><p id="548b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一些额外选项(取决于您需要使用管道的频率和您的预算):</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/00d1c38ecd2391719b47958b8e02deeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*0avwChchtVVy0xa4J1iW5w.png"/></div></figure><p id="8032" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“创建”按钮后，您应该会在列表中看到您的新池:</p><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi no"><img src="../Images/222e4bf6ae4e4f19e13716ae631c4370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6LC56Npq_wDyrPAydHk2Q.png"/></div></div></figure><p id="cc9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在—将用于部署应用服务的池更改为管道中新创建的池。</p><h2 id="8348" class="lx kv iq bd kw ly lz dn la ma mb dp le jy mc md li kc me mf lm kg mg mh lq mi bi translated">释放管道:</h2><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi np"><img src="../Images/9e341d0eae82944882774790485ca834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yk09NPKb7LKYpxfYTWycsA.png"/></div></div></figure><h2 id="caac" class="lx kv iq bd kw ly lz dn la ma mb dp le jy mc md li kc me mf lm kg mg mh lq mi bi translated">构建管道(Yaml管道)</h2><figure class="my mz na nb gt nc gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nq"><img src="../Images/671ac4c17f82f5656d4ca3965f1255dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGjtA6eU7-_9rUriZOTskg.png"/></div></div></figure><h2 id="2c63" class="lx kv iq bd kw ly lz dn la ma mb dp le jy mc md li kc me mf lm kg mg mh lq mi bi translated">仅此而已！</h2><p id="4f2f" class="pw-post-body-paragraph jn jo iq jp b jq ls js jt ju lt jw jx jy lu ka kb kc lv ke kf kg lw ki kj kk ij bi translated">当您运行管道时，Azure虚拟机规模集上托管的代理会执行它。由于虚拟机可以访问虚拟网络，它将能够对应用服务进行适当的推送。</p><h1 id="d77d" class="ku kv iq bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">参考资料:</h1><div class="nr ns gp gr nt nu"><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/scale-set-agents?view=azure-devops" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">Azure虚拟机规模集代理- Azure管道</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">Azure虚拟机比例集代理，以下简称比例集代理，是一种自托管代理的形式…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">learn.microsoft.com</p></div></div><div class="od l"><div class="oe l of og oh od oi nh nu"/></div></div></a></div></div></div>    
</body>
</html>