<html>
<head>
<title>TDD in Flutter Part 3: Testing your widgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Flutter中的TDD第3部分:测试小部件</h1>
<blockquote>原文：<a href="https://itnext.io/tdd-in-flutter-part-3-testing-your-widgets-c5e87d76a864?source=collection_archive---------1-----------------------#2021-12-20">https://itnext.io/tdd-in-flutter-part-3-testing-your-widgets-c5e87d76a864?source=collection_archive---------1-----------------------#2021-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0f01" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大家好，距离上一集已经有一段时间了，但现在终于来了，我准备向你们解释如何测试你们的小部件。在第三部分，我将向你解释如何使用<code class="fe kl km kn ko b">testWidgets</code>以及如何使用快照比较来渲染带有<a class="ae kp" href="https://pub.dev/packages/golden_toolkit" rel="noopener ugc nofollow" target="_blank"> golden_toolkit </a>包的小部件。</p><p id="9843" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你现在可以在一个专门的<a class="ae kp" href="https://rouxguillaume.medium.com/list/tdd-in-flutter-64d0d5f07854" rel="noopener">列表中找到所有以前的文章:TDD in Flutter </a>。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/8d86239268090316ddb2997da442d57f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cnOxe4bps8i07G-atX2c0w.jpeg"/></div></div></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="436f" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">testWidgets()</h1><p id="089b" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">这个方法的工作方式与<code class="fe kl km kn ko b">test()</code>方法相同，基本上是在测试环境中执行你的颤振代码。主要区别在于，这个测试环境是为构建小部件并与之交互而设计的。为此，这里有一些方法可以用来通过<code class="fe kl km kn ko b">WidgetTester</code>模拟小部件上的动作:</p><ul class=""><li id="ac9a" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">pumpWidget</code>:用给定的小工具模拟对<code class="fe kl km kn ko b">runApp()</code>的调用。</li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">pumpWidget示例</figcaption></figure><ul class=""><li id="a8e0" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">drag</code>和<code class="fe kl km kn ko b">dragFrom</code>:模拟给定控件上给定偏移量的拖动动作。</li><li id="ead3" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">ensureVisible</code>:给定一个在<code class="fe kl km kn ko b">Finder</code>中指定的小部件W和一个在其祖先树中可滚动的小部件S，它将滚动S以使W可见。</li><li id="f931" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">enterText</code>:将焦点放在<code class="fe kl km kn ko b">Finder</code>中指定的文本输入窗口小部件上，并用给定的文本替换其内容，就好像它是由屏幕键盘提供的一样。</li><li id="4320" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">fling</code>和<code class="fe kl km kn ko b">flingFrom</code>:尝试从给定小工具的中心开始，移动给定的距离，达到给定的速度，做出一个甩动手势。</li><li id="90ab" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">idle</code>:如同应用程序进入空闲状态。</li><li id="d420" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">press</code>、<code class="fe kl km kn ko b">longPress</code>、<code class="fe kl km kn ko b">longPressAt</code>、<code class="fe kl km kn ko b">tap</code>和<code class="fe kl km kn ko b">tapAt</code>:在给定的小工具(假设是暴露的)或位置的中心向下/向上调度指针。</li><li id="6ac6" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">showKeyboard</code>:将焦点放在<code class="fe kl km kn ko b">Finder</code>中指定的文本输入小工具上，就像屏幕键盘已经出现一样。</li><li id="cef0" class="mm mn iq jp b jq nb ju nc jy nd kc ne kg nf kk mr ms mt mu bi translated"><code class="fe kl km kn ko b">startGesture</code>:在特定点创建一个初始向下的手势。</li></ul><p id="ad84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经理解了这些方法，您可能需要使用一个<code class="fe kl km kn ko b">Finder</code>类来搜索一个小部件。您可以使用它来查找想要对其应用特定操作的小部件，或者确保小部件正确显示。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">finder示例</figcaption></figure></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="9980" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">睾丸酮</h1><p id="2d1e" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">这个测试方法是由包<a class="ae kp" href="https://pub.dev/packages/golden_toolkit" rel="noopener ugc nofollow" target="_blank"> golden_toolkit </a>提供的，它允许你测试你的UI以确保它保持不变。这种测试的工作方式是拍摄上一个UI的快照，并与新的UI进行比较。如果新的UI看起来与以前不同，黄金测试将被视为失败。</p><p id="6e69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们举个例子，这是一个显示一些文本的简单小部件:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">简单_文本.镖</figcaption></figure><p id="8627" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在一个具有预定义样式的<code class="fe kl km kn ko b">Text</code>小部件中显示<code class="fe kl km kn ko b">content</code>。</p><p id="0bf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们黄金测试的测试文件:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">简单_文本_测试.镖</figcaption></figure><p id="a454" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在运行黄金测试之前要做的第一件事是生成初始快照，它将是您的匹配样本。为此，只需使用命令<code class="fe kl km kn ko b">flutter test --update-goldens</code>即可，它将运行您所有的单元测试，但只会为您的黄金测试生成或更新快照。这是我们的小测试的输出:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ng"><img src="../Images/f96d94d04d73d6baede746bff4f672f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQqynE5238i0pZobzkOiww.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">test/goldens/simple _ red _ text . png</figcaption></figure><p id="f5d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们假设我想让我的<code class="fe kl km kn ko b">SimpleText</code>小部件在我的应用程序中更加灵活，例如通过设置颜色变量。代码可以这样发展:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="c52b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过遵循TDD原则，因为我们的代码仍在编译中，所以我们不需要更新我们的测试。所以让我们运行它，但是这次不用<code class="fe kl km kn ko b">— update-goldens</code>参数。</p><pre class="kr ks kt ku gt nh ko ni nj aw nk bi"><span id="cb63" class="nl lk iq ko b gy nm nn l no np">$&gt; flutter test<br/>00:01 +0: loading D:\Documents\Projects\so_tests\test\golden_test.dart</span><span id="b4ca" class="nl lk iq ko b gy nq nn l no np">00:02 +0: golden: simple red text<br/>══╡ EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ╞════════════════════════════════════════════════════<br/>The following assertion was thrown while running async test code:<br/>Golden "goldens/simple_red_text.png": Pixel test failed, 0.16% diff detected.<br/>Failure feedback can be found at /D:/Documents/Projects/so_tests/test/failures</span><span id="ac75" class="nl lk iq ko b gy nq nn l no np">When the exception was thrown, this was the stack:<br/>#0      LocalFileComparator.compare (package:flutter_test/src/_goldens_io.dart:100:7)<br/>&lt;asynchronous suspension&gt;<br/>&lt;asynchronous suspension&gt;<br/>(elided one frame from package:stack_trace)<br/>════════════════════════════════════════════════════════════════════════════════════════════════════<br/>00:02 +0 -1: golden: simple red text [E]<br/>  Test failed. See exception logs above.<br/>  The test description was: golden: simple red text</span><span id="0764" class="nl lk iq ko b gy nq nn l no np">00:02 +0 -1: Some tests failed.</span></pre><p id="32bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，我们的测试失败了，我们可以检查<code class="fe kl km kn ko b">test/failures</code>文件夹中的输出:</p><ul class=""><li id="889f" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">这是预期的图像:</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ng"><img src="../Images/f96d94d04d73d6baede746bff4f672f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQqynE5238i0pZobzkOiww.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">simple _ red _ text _ master image . png</figcaption></figure><ul class=""><li id="65a2" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">测试期间生成的输出:</li></ul><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ng"><img src="../Images/799e8d3b097f6cd04f1e6b80f24d5ae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SW-FeC8BcI98oxWDKfsLyA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">simple_red_text_testImage.png</figcaption></figure><p id="1cdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您甚至可以获得显示两者差异的快照:</p><div class="kr ks kt ku gt ab cb"><figure class="nr kv ns nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/a8023b6c40705824d63b6d9a73200946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*kNjO9xDKD7ECbm_MiwhaCQ.png"/></div></figure><figure class="nr kv ns nt nu nv nw paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/1bec14b4576978aa1ef23654ca706b6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*WGrBwf1rTjektug7_WEp0A.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk nx di ny nz translated">simple _ red _ text _ isolated diff . png(左)—simple _ red _ test _ maskeddiff . png(右)</figcaption></figure></div><p id="186f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有一个未通过的测试，我们可以更新代码，这样它将再次通过:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="1036" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们再次运行我们的测试:</p><pre class="kr ks kt ku gt nh ko ni nj aw nk bi"><span id="436d" class="nl lk iq ko b gy nm nn l no np">$&gt; flutter test<br/>00:03 +0: loading D:\Documents\Projects\so_tests\test\golden_test.dart</span><span id="e09e" class="nl lk iq ko b gy nq nn l no np">00:04 +1: All tests passed!</span></pre><p id="8365" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶！它再次通过，但我们还没有测试我们的新颜色参数是否可以用于除红色以外的其他颜色，所以让我们添加另一个测试。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="2404" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重新生成我们的黄金文件后，这里是新的输出:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ng"><img src="../Images/3400f3bbf0cf8afee63b0a3ba4112570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WghEDul5e4D8WiUKsHJjg.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk translated">简单_蓝色_文本. png</figcaption></figure><p id="c301" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过进行这些测试，我确保了向我的<code class="fe kl km kn ko b">SimpleText</code>小部件添加新功能不会导致我的UI出现任何倒退，这与对代码进行单元测试一样重要。</p><p id="53ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个重要的信息是，目前生成的黄金文件在OS和Flutter版本之间不一致。这意味着，如果快照是在Windows和MacOS上生成的，或者是在不同的Flutter版本上生成的，它们可能会有所不同。目前唯一的解决方案似乎是在某个容器中运行您的黄金测试，该容器将保持一个恒定的环境。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="9e87" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="0c47" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">乡亲们来了！一如既往，我希望你喜欢我的这篇小文章。再次，我对前一次发布之间的延迟深感抱歉。我还有其他项目要处理。尽管如此，如果你仍然想表达你对这个系列的支持，你可以鼓掌或者发表评论，阅读你的留言总是一件愉快的事。下一篇文章将讨论如何使用软件包<a class="ae kp" href="https://pub.dev/packages/mockito" rel="noopener ugc nofollow" target="_blank"> mockito </a>来模仿你的类，所以如果你不想错过的话，请不要犹豫，继续关注我的文章。而如果你想查阅之前的文章，可以在他们的专用阅读列表中找到全部:<a class="ae kp" href="https://rouxguillaume.medium.com/list/tdd-in-flutter-64d0d5f07854" rel="noopener">https://rouxguillaume . medium . com/list/TDD-in-flutter-64d 0 D5 f 07854</a></p></div></div>    
</body>
</html>