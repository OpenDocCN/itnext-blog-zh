<html>
<head>
<title>How to Locate and Select Units in PySC2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在PySC2中定位和选择单元</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-locate-and-select-units-in-pysc2-2bb1c81f2ad3?source=collection_archive---------0-----------------------#2018-01-31">https://itnext.io/how-to-locate-and-select-units-in-pysc2-2bb1c81f2ad3?source=collection_archive---------0-----------------------#2018-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="003c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的<a class="ae kl" href="https://medium.com/@skjb/building-a-basic-pysc2-agent-b109cde1477c" rel="noopener">之前的教程</a>中，我简要介绍了选择任何特定类型单位的过程，例如SCV，但是我收到了一些关于如何选择特定单位的问题，我也收到了一些关于我用来确定屏幕上有多少特定单位的“神奇”公式的问题。因为这些是相关的，我想我可以在这里更详细地解释它们。</p><p id="5801" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本教程中的所有代码都应该放在代理的<code class="fe km kn ko kp b">step()</code>方法中。如果你不确定这是什么意思，请先看看我的<a class="ae kl" href="https://medium.com/@skjb/building-a-basic-pysc2-agent-b109cde1477c" rel="noopener">构建一个基本的PySC2代理</a>教程。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/ce8000035841b300ec5c01e103e73649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1GGjlavrueITonHomq2nA.png"/></div></div></figure><h1 id="6ea3" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">1.简单的单个单元选择</h1><p id="bef7" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我在以前的教程中使用的过程相当简单，首先你检索一个特定单元类型的<em class="mf"> x </em>和<em class="mf"> y </em>坐标列表。例如，我们可以通过以下方式获得指挥中心的<em class="mf"> x </em>和<em class="mf"> y </em>坐标:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="ce72" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那实际上给了你什么？</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="af41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">太好了，很多数字。它们实际上代表了什么？</p><p id="4db5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，屏幕特征层的分辨率为84x84像素，可以将<code class="fe km kn ko kp b">cc_x</code>和<code class="fe km kn ko kp b">cc_y</code>的每一项组合起来，给出该单元消耗的每个像素的坐标。例如<code class="fe km kn ko kp b">cc_x[0]</code>是45，<code class="fe km kn ko kp b">cc_y[0]</code>是31，那么第一个像素位于(45，31)，<code class="fe km kn ko kp b">cc_x[1]</code>是46，<code class="fe km kn ko kp b">cc_y[1]</code>是31，那么第二个像素位于(46，31)，以此类推。在下图中，您可以根据这些坐标看到指挥中心的位置:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/b3909de3559aafd0da1fe171bbf490d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*7nV0uHL3CpMXjhvAZiiXZg.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">指挥中心的屏幕特征坐标</figcaption></figure><p id="63ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于像指挥中心这样的单个单元，很容易确定单元的中心，只需取<em class="mf"> x </em>坐标的平均值和<em class="mf"> y </em>坐标的平均值:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="0126" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果将是<code class="fe km kn ko kp b">x</code>是48，<code class="fe km kn ko kp b">y</code>是40。这是我们指挥中心的中间。</p><h1 id="0dd1" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">2.从多个中随机选择单元</h1><p id="4e0d" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">当屏幕上只有一个特定类型的单位时，这很容易，但是当一个类型有多个单位时呢？让我们用维斯彭间歇泉试试上面的技术:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="1fae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这会产生以下值:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="d9cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些坐标产生以下内容:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/5a2115bbb5b5101b936de41ddb58a224.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*SzqZw5sP1XFaoCrBw-PJHg.png"/></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk translated">维斯彭间歇泉的屏幕特征坐标</figcaption></figure><p id="fb23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">酷，现在让我们平均一下，看看会发生什么:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="09cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe km kn ko kp b">x</code>值将是43(向上取42.5)，而<code class="fe km kn ko kp b">y</code>值将是39(向上取38.5)。给定84×84的屏幕尺寸，这将把位置放在屏幕的大约中间。不幸的是，这意味着这项技术不会选择任何东西。真扫兴。</p><p id="641d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要担心，有一个解决方案！如果我们不在乎选择哪一个维斯彭间歇泉，我们可以简单地随机选择一个点。首先，我们需要在文件顶部导入随机模块:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="32d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后把这个加入到你的<code class="fe km kn ko kp b">step()</code>方法中:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="4ff7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们选择一个随机索引<code class="fe km kn ko kp b">i</code>，然后使用该索引收集该索引处的<code class="fe km kn ko kp b">vespene_x</code>和<code class="fe km kn ko kp b">vespene_y</code>值。然后我们可以使用<code class="fe km kn ko kp b">x</code>和<code class="fe km kn ko kp b">y</code>坐标来选择单位。</p><p id="9524" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种技术的唯一问题是有时单位会互相重叠，例如，如果一个SCV站在维斯彭间歇泉旁边，你可能会意外地选择它而不是间歇泉(反之亦然)。因此，您应该检查以确保您选择的单位是您想要选择的单位。</p><p id="eaf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要确保您选择了一个维斯彭间歇泉，您可以这样做:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="9b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这段代码获取<code class="fe km kn ko kp b">single_select</code>观察中的第一个单元(索引0)，然后获取该单元中的第一个条目(索引0)，这恰好是单元类型。如果是维斯彭间歇泉，我们知道我们做得很好，否则我们可能不得不选择另一个随机点。</p><h1 id="47e9" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">3.计数单位</h1><p id="d5a8" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们快速跳到计数单位，因为这将使我们能够找到特定单位的中心。</p><p id="14a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很多人问我在我以前的教程中使用的“神奇”的计算来确定屏幕上有多少个仓库和兵营。</p><p id="0548" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你知道你将只拥有一个特定的单位，例如指挥中心，那么计算就很容易:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="2c0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这只是检查是否有任何y坐标返回。如果是，你有一个指挥中心，如果不是，那么你的基地就没了，你很快就会死。撕开。</p><p id="734f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于一个以上的单位，事情变得有点棘手，但只是一点点。让我们从上一步中的vespene间歇泉中获取<em class="mf"> x </em>和<em class="mf"> y </em>坐标:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7ef3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们(人类)知道屏幕上有两个维斯佩内间歇泉。由于<code class="fe km kn ko kp b">vespene_y</code>中有194个值，我们可以假设每个vespene间歇泉覆盖97个像素。</p><p id="46d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">请注意:如果您使用的屏幕分辨率不是默认的84x84，那么每个单元覆盖的像素数量将会不同。</strong></p><p id="9b29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以现在我们可以通过将<code class="fe km kn ko kp b">vespene_y</code>中的数值除以97来计算屏幕上的维斯佩内间歇泉的数量。首先，让我们确保导入文件顶部的数学模块:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="3255" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将它添加到<code class="fe km kn ko kp b">step()</code>方法中:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f17b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将数值向上取整，因为有时单位会稍微重叠，从总数中减去一些数值。舍入通常会给我们正确的值，但是像scv这样明显重叠的单元很有可能计数不准确，幸运的是我们有工人计数。</p><h1 id="4c3d" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">4.选择特定单位</h1><p id="516e" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">现在我们知道了屏幕上有多少个维斯佩内间歇泉，实际上我们可以使用K-means聚类法相当精确地找到每个间歇泉的中心。</p><p id="bd1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，安装<a class="ae kl" href="http://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank"> scikit-learn </a>模块，并在我们的文件顶部包含K-means聚类组件:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="222d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们根据前面的例子得到<em class="mf"> x </em>和<em class="mf"> y </em>值:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="06ae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们来数一下间歇泉的数量:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="b86f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们可以将<em class="mf"> x </em>和<em class="mf"> y </em>值组合成对:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="e736" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以应用K-means聚类方法来确定每个单元的中心:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="acf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从那里你可以得到每个单位的中心如下:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="c3b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请记住，每个间歇泉的中心指数可能会改变，因为K-means算法是随机初始化的。例如，连续两次调用会产生以下结果:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="94c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要认为使用<code class="fe km kn ko kp b">kmeans.cluster_centers_[0]</code>总是指(60，21)处的间歇泉。</p><p id="658e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你喜欢这个教程，请在上支持我。也请加入我的<a class="ae kl" href="https://discord.gg/qTZ65sh" rel="noopener ugc nofollow" target="_blank">不和谐</a>，或者关注我的<a class="ae kl" href="https://www.twitch.tv/skjb" rel="noopener ugc nofollow" target="_blank"> Twitch </a>、<a class="ae kl" href="https://medium.com/@skjb" rel="noopener"> Medium </a>、<a class="ae kl" href="https://github.com/skjb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae kl" href="https://twitter.com/theskjb" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae kl" href="https://www.youtube.com/channel/UCZcEvhpV4_6llcrWrWQ2wsg" rel="noopener ugc nofollow" target="_blank"> YouTube </a>。</p></div></div>    
</body>
</html>