<html>
<head>
<title>How to have a clean dev environment like WSL 2 using Multipass on Linux, Mac or Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Linux、Mac或Windows上使用Multipass拥有一个像WSL 2一样干净的开发环境</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-have-a-clean-dev-environment-like-wsl-2-using-multipass-on-linux-mac-or-windows-6828a78b87d7?source=collection_archive---------0-----------------------#2020-05-09">https://itnext.io/how-to-have-a-clean-dev-environment-like-wsl-2-using-multipass-on-linux-mac-or-windows-6828a78b87d7?source=collection_archive---------0-----------------------#2020-05-09</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="3c2b" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">保持您的开发人员笔记本电脑整洁的指南</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj kj"><img src="../Images/b9b3cbb74d48a03dd2ea49ace14e51eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ouL5FJtiL2hQ3Vua0M32w.png"/></div></div></figure><p id="d205" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">我相信你已经听说过<a class="ae lr" href="https://docs.microsoft.com/en-us/windows/wsl/about" rel="noopener ugc nofollow" target="_blank"> Windows 10的<strong class="kx iv"> WSL </strong>功能</a>，我相信这个功能将会改变微软吸引开发者的游戏规则。最近，通过在<a class="ae lr" href="https://docs.microsoft.com/en-us/windows/wsl/wsl2-about" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> WSL 2 </strong> </a>中引入一种新的架构，微软决定改进这一特性，使其更快，对开发者更友好。在WSL 2中，微软在VM内部使用真正的Linux内核，而不是在其上的兼容层。</p><p id="7183" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">对我来说，作为一名开发人员，WSL 2非常棒，因为我可以在一个真正的Linux内核上开发，同时拥有一台windows笔记本电脑并利用两者的优势。除此之外，我有一个独立的虚拟机，因此可以在Windows 10和该虚拟机之间轻松共享项目文件。另一个好处是，我不需要为我想参与的每个项目安装一堆SDK，我可以保持我的计算机干净，并为每个项目创建几个使用WSL 2的虚拟机，例如，我不需要在我的机器上安装rust SDK和编译器，只需运行一个测试应用程序或基准测试，或者安装一个本地Kubernetes，而不会损坏我的机器。另一方面，有几个项目只能在Linux上运行，如果你想运行它们，你需要一台Linux机器。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj ls"><img src="../Images/80cd796caf6af32bf615458b33f35447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VkhOyxf3cnG_jpgSDvhgRA.png"/></div></div></figure><p id="88fd" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">问题是WSL 2对windows用户来说是一个特殊的特性，在本文中，我将向您展示我们如何在Linux、Mac甚至Windows上建立一个看起来像WSL 2的开发环境(但不是完全像WSL 2 )!</p><p id="1fec" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">为此，我们将使用这些程序:</p><ul class=""><li id="e393" class="lt lu iu kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated"><a class="ae lr" href="https://multipass.run/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> Multipass </strong> </a>(一个跨平台的轻量级VM管理器)</li><li id="6e69" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated"><a class="ae lr" href="https://ubuntu.com/download/server" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> Ubuntu服务器</strong> </a></li><li id="bdc3" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated"><a class="ae lr" href="https://cloud-init.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> Cloud-init </strong> </a>(可选)</li><li id="6a83" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated"><a class="ae lr" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kx iv">VS</strong></a>同<a class="ae lr" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv">远程开发扩展</strong> </a>(可选)</li></ul><p id="f939" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">想象一下你讨厌Java，不想在你的机器上安装一堆SDK和库(像Maven和JDK)来测试一个基于Java的项目，或者你没有Linux机器来安装一个只在Linux操作系统上安装的程序(<a class="ae lr" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>、<a class="ae lr" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>或者<a class="ae lr" href="https://www.kurento.org/" rel="noopener ugc nofollow" target="_blank"> Kurento </a>)。在这些情况下，使用虚拟机是有帮助的，你只需在虚拟机中克隆那个项目，测试一些东西并完成，你不需要在你的Mac(或任何其他操作系统)上安装JDK或Maven。</p><h2 id="4dcd" class="mh mi iu bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">可用的解决方案</h2><p id="fbe9" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">除了在windows上使用WSL之外，对于这种类型的场景还有其他几种解决方案，例如，您可以使用<a class="ae lr" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx iv"> VirtualBox </strong> </a>来创建和管理虚拟机，或者在更高级别上使用<a class="ae lr" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kx iv"/></a>来创建、配置和供应虚拟机。对我来说，VirtualBox很重，它有几个特性是我作为后端开发者不需要的。我喜欢流浪，并使用它，但我发现它沉重和缓慢，我发现它对我个人的使用太多。因为这些原因，我尝试用一个手工制作(但不完整)的方案来完成我的个人旅程。</p><h1 id="33b4" class="nf mi iu bd mj ng nh ni mm nj nk nl mp ka nm kb ms kd nn ke mv kg no kh my np bi translated">我们开始吧</h1><p id="3c05" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">第一步，我们需要在一个轻量级虚拟机中安装一个全功能的Linux，这样我们就可以使用ssh轻松地连接到它。<strong class="kx iv"> Multipass </strong>是一个跨平台的虚拟机管理器，它允许我们通过针对每个操作系统的快速虚拟机管理程序技术轻松创建和管理<strong class="kx iv"> Ubuntu服务器</strong>。默认情况下，Multipass在Linux上使用<strong class="kx iv"> KVM </strong>，在Windows上使用<strong class="kx iv"> Hyper-V </strong>，在macOS上使用<strong class="kx iv"> HyperKit </strong>作为驱动程序。Multipass增加了对<a class="ae lr" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> VirtualBox </a>和<a class="ae lr" href="https://libvirt.org/" rel="noopener ugc nofollow" target="_blank"> libvirt </a>的支持，您可以通过使用<code class="fe nq nr ns nt b">set</code>命令将它们用作驱动程序:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="b065" class="mh mi iu nt b gz ny nz l oa ob">multipass set local.driver=virtualbox</span></pre><p id="2245" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您可以使用<code class="fe nq nr ns nt b">get</code>命令检查您当前的驱动程序:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="3e28" class="mh mi iu nt b gz ny nz l oa ob">multipass get local.driver</span></pre><h2 id="ff0d" class="mh mi iu bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">快速创建您的第一个虚拟机</h2><p id="07fd" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">您可以通过<code class="fe nq nr ns nt b">launch</code>命令创建一个Ubuntu虚拟机，但是在创建VM之前，您应该使用<code class="fe nq nr ns nt b">find</code>命令查看可用映像的列表:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="183f" class="mh mi iu nt b gz ny nz l oa ob">multipass find</span></pre><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oc"><img src="../Images/021391fbec6520f032dc5f94ce7c47b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJ6I1qSJ8XlKEMflnOpBow.png"/></div></div><figcaption class="od oe gk gi gj of og bd b be z dk translated">多通道查找输出</figcaption></figure><p id="b7ba" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">现在，您可以通过选择其中一个映像并指定RAM、CPU和磁盘的数量来创建您的第一个虚拟机:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="1167" class="mh mi iu nt b gz ny nz l oa ob">multipass launch bionic -n dev -c 4 -m 1G -d 20G --cloud-init  projects/cloud-init.yaml</span></pre><p id="f95f" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">在<code class="fe nq nr ns nt b">multipass launch</code>之后的所有选项都是可选的，你可以在没有任何参数的情况下运行<code class="fe nq nr ns nt b">multipass launch</code>，然后multipass将为你创建一个带有默认值的VM(甚至是默认名称！)，但如果想对资源有更好的控制，还是用那些选项比较好。</p><p id="99c3" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您不使用<code class="fe nq nr ns nt b">cloud-init</code>选项，multipass将为您创建一个ssh密钥，并将其公钥作为授权密钥添加到创建的VM中，但是我更喜欢使用一个<code class="fe nq nr ns nt b">cloud-init.yaml</code>文件，并在其中添加我自己的公钥:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="3e65" class="mh mi iu nt b gz ny nz l oa ob">ssh_authorized_keys:<br/>  - ssh-rsa **key_content***</span></pre><p id="4f8e" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">当然，你可以使用<a class="ae lr" href="https://cloud-init.io/" rel="noopener ugc nofollow" target="_blank"> cloud-init标准</a>做更多的事情(供应、预装软件，以及……)，你可以在这里了解更多关于cloud-init标准<a class="ae lr" href="https://cloudinit.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="72cf" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">几秒钟后，你将在一个虚拟机中拥有一个全功能的Ubuntu服务器。您可以通过运行<code class="fe nq nr ns nt b">multipass list</code>或<code class="fe nq nr ns nt b">multipass ls</code>命令获得您的虚拟机列表:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oh"><img src="../Images/dcf2038ea061db77f2237ad152ebe2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vHBLB0SAYDW-B8RskfV0A.png"/></div></div></figure><p id="757a" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">您还可以通过运行<code class="fe nq nr ns nt b">multipass info dev</code>命令获得关于虚拟机的更多信息:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gi gj oi"><img src="../Images/55dfd2178b3074fa81bdf4c160f50e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YKqO-NTVhHBhTLXLKkO92A.png"/></div></div></figure><h2 id="899a" class="mh mi iu bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">使用SSH连接到虚拟机</h2><p id="f9ef" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">使用multipass创建了Ubuntu server VM之后，就可以使用multipass <code class="fe nq nr ns nt b">shell</code>命令连接到该VM了:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="769e" class="mh mi iu nt b gz ny nz l oa ob">multipass shell dev</span><span id="0b26" class="mh mi iu nt b gz oj nz l oa ob">or</span><span id="c883" class="mh mi iu nt b gz oj nz l oa ob">multipass sh dev</span></pre><p id="26ec" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">multipass <code class="fe nq nr ns nt b">shell</code>命令是对<code class="fe nq nr ns nt b">ssh</code>命令的包装，无论您是否使用了<code class="fe nq nr ns nt b">clould-init</code>文件，<code class="fe nq nr ns nt b">shell</code>命令都将使用<code class="fe nq nr ns nt b">ssh</code>命令在您创建的虚拟机内部打开一个shell，但是如果您使用了<code class="fe nq nr ns nt b">clould-init</code>文件，您可以通过<code class="fe nq nr ns nt b">ssh</code>命令直接轻松连接到您的虚拟机:</p><pre class="kk kl km kn gu nu nt nv nw aw nx bi"><span id="0d8b" class="mh mi iu nt b gz ny nz l oa ob">ssh -i ~/.ssh/multipass ubuntu@192.168.244.100</span></pre><p id="4982" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您想了解更多关于Multipass及其特性的信息，如如何删除虚拟机或如何将数据共享或复制到虚拟机，我建议您阅读<a class="ae lr" href="https://multipass.run/docs" rel="noopener ugc nofollow" target="_blank"> multipass文档</a>。</p><h2 id="9233" class="mh mi iu bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">下一步是什么？</h2><p id="65df" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">现在只需运行一个命令，你就拥有了一个全功能的<strong class="kx iv"> Ubuntu服务器</strong>，你可以轻松地在上面安装任何你想要的东西(Docker、Kubernetes、Kurento、SDK等等)。您还可以创建另一个VM来创建一个真正的<strong class="kx iv">集群</strong>或类似的东西。</p><p id="7435" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果您对<a class="ae lr" href="https://cloud-init.io/" rel="noopener ugc nofollow" target="_blank"> cloud-init </a>有足够的了解，您可以使服务器的配置过程自动化并可重复。通过cloud-init和multipass，您可以快速创建一个带有预安装程序和配置的虚拟机。</p><h2 id="90e9" class="mh mi iu bd mj mk ml dn mm mn mo dp mp le mq mr ms li mt mu mv lm mw mx my mz bi translated">开始在虚拟机内部编码</h2><p id="e66b" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">让我们回到我们的例子。你讨厌Java，不想在你的机器上安装相关的库和SDK，但是你需要运行(或编写)一个Java程序。不要担心，您可以通过multipass在您创建的VM中开始开发，并使用ssh连接到它。</p><p id="3231" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">首先，我们使用<code class="fe nq nr ns nt b">shell</code>命令(<code class="fe nq nr ns nt b">multipass sh dev</code>)连接到我们的开发服务器，并安装JDK和Maven。(我更喜欢用<a class="ae lr" href="https://sdkman.io/" rel="noopener ugc nofollow" target="_blank"> SDKMAN安装这种SDK！</a>)。也许你需要安装<code class="fe nq nr ns nt b">git</code>来获得java源代码，或者通过<code class="fe nq nr ns nt b">multipass mount</code>命令从你的主机上共享已经存在的项目文件夹。</p><p id="1f09" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">如果你熟悉<code class="fe nq nr ns nt b">vim</code>，你可以使用<code class="fe nq nr ns nt b">shell</code>命令连接到VM，并在VM内部使用<code class="fe nq nr ns nt b">vim</code>开始编码，但是如果你不熟悉<code class="fe nq nr ns nt b">vim</code>(像我一样)你可以使用<a class="ae lr" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack" rel="noopener ugc nofollow" target="_blank"> VS代码远程开发扩展</a>，它有一个很棒的特性叫做Visual Studio代码远程SSH。通过使用带有远程开发扩展的VS代码，您不需要在您的主机操作系统上安装JDK、Maven或任何其他SDK和库，您只需要在VS代码中创建一个新的远程ssh连接(<code class="fe nq nr ns nt b">ssh -i ~/.ssh/multipass ubuntu@192.168.244.100</code>)到您的多通道虚拟机并开始开发:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ok"><img src="../Images/83d5afe797a483a8accd6e117f901a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/1*_IN9TWFVXDCFb2vBTlo-wA.gif"/></div></figure><p id="a3d7" class="pw-post-body-paragraph kv kw iu kx b ky kz jv la lb lc jy ld le lf lg lh li lj lk ll lm ln lo lp lq in bi translated">visual Studio Code Remote SSH extension有几个很棒的特性，比如<strong class="kx iv">端口转发</strong>，这对VM内部的web开发非常有用。你可以从本教程中了解更多关于Visual Studio代码远程SSH的知识。</p><h1 id="a7aa" class="nf mi iu bd mj ng nh ni mm nj nk nl mp ka nm kb ms kd nn ke mv kg no kh my np bi translated">结论</h1><p id="f23c" class="pw-post-body-paragraph kv kw iu kx b ky na jv la lb nb jy ld le nc lg lh li nd lk ll lm ne lo lp lq in bi translated">通过从WSL 2中获得灵感，并将<strong class="kx iv"> Multipass </strong>、<strong class="kx iv"> Cloud-init </strong>和<strong class="kx iv"> Visual Studio代码</strong>与远程SSH扩展相结合，我们试图在一个轻量级VM中创建一个开发环境，但是这种手工制作的方法有一些缺点:</p><ul class=""><li id="b67b" class="lt lu iu kx b ky kz lb lc le lv li lw lm lx lq ly lz ma mb bi translated">有时，多通道会更改创建的虚拟机的IP。我不确定多通道是否会更改IP或底层虚拟机管理程序。</li><li id="c70d" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">现在multipass没有备份和恢复命令！</li><li id="0b3f" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">没有直接的方法来增加或减少虚拟机的内存、磁盘或CPU(但通过一些欺骗和接受风险是可能的)</li><li id="52e2" class="lt lu iu kx b ky mc lb md le me li mf lm mg lq ly lz ma mb bi translated">如果将项目文件夹从主机操作系统共享到虚拟机，磁盘相关操作的性能将会降低。</li></ul></div></div>    
</body>
</html>