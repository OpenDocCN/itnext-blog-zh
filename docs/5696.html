<html>
<head>
<title>How to stop users taking screenshots or recordings of your iOS app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何阻止用户对你的iOS应用进行截图或录音</h1>
<blockquote>原文：<a href="https://itnext.io/a-way-to-protect-your-app-content-from-screenshots-in-ios-ea23153a3bc7?source=collection_archive---------0-----------------------#2021-05-05">https://itnext.io/a-way-to-protect-your-app-content-from-screenshots-in-ios-ea23153a3bc7?source=collection_archive---------0-----------------------#2021-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7de9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">到目前为止，在iOS中保护你的应用程序内容不被截图和记录并不是一件容易的事情，在我们从苹果获得官方API之前，这种变通方法暂时会帮助我们。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c0fb85fb3a1741813b1e2c20ed406c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y38AOsG_Yo2lissi"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">弗洛里安·克劳尔在<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="c60c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们假设你是一名iOS开发者，正在开发一个应用程序，其中有一些安全/敏感的内容，比如手机号码/银行信息等。其中一个安全问题是，当有人按下<em class="ls">(旧款iPhones中的home+lock键，新款iOS设备中的音量增加+lock键)</em>时，视图/视图控制器会被捕获。对于iOS开发者来说，保护应用程序内容不受截图影响是一个挑战。在本文中，让我们来看看如何克服这个问题。</p><h2 id="25cc" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">使用通知来防止屏幕截图:</h2><p id="9d7f" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">苹果公司提供了“<strong class="ky ir">userDidTakeScreenshotNotification</strong>”通知，但这只是在截屏后通知我们。所以这不是我们想要的。</p><h2 id="5c6d" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">屏蔽套件:</h2><p id="89cd" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">“ScreenshieldKit”按照我们想要的方式工作，但它是有许可证的，我们必须付费。所以不是所有的开发者/企业都能做到这一点。我们必须使用他们简单的UI组件。相信我，我谷歌了很多来了解ScreenshieldKit是如何工作的，但这仍然只是一个胡乱的猜测，有些人说ScreenshieldKit使用DRM视频覆盖模式，但我不相信。但是我对实现它的渴望仍然存在。因此，我尝试了各种方法来保护我们的iOS应用程序内容不被截图。</p><h2 id="43a8" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">那么，我试图保护应用程序视图不被截屏和录制的替代方法是什么？</h2><p id="971d" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">我在堆栈溢出和各种论坛上做了很多冲浪，尝试了一些事情来使它像ScreenshieldKit一样工作..</p><ol class=""><li id="232d" class="mr ms iq ky b kz la lc ld lf mt lj mu ln mv lr mw mx my mz bi translated">截图后从库中删除照片，啊哈，这不好，需要用户许可，而不是好的，所以这根本不是一个选项:</li><li id="a972" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">当用户要截屏时，监听出现的覆盖图。这似乎是一个选项，但窗口的变化也发生在截图之后。而且在截图之前我是无法察觉的。</li><li id="93d2" class="mr ms iq ky b kz na lc nb lf nc lj nd ln ne lr mw mx my mz bi translated">观察是一种被捕获的属性，嗯，它对镜像/记录起作用。</li></ol><h2 id="14ff" class="lt lu iq bd lv lw lx dn ly lz ma dp mb lf mc md me lj mf mg mh ln mi mj mk ml bi translated">从iOS屏幕截图和镜像中保护应用程序屏幕的工作解决方案？</h2><p id="156e" class="pw-post-body-paragraph kw kx iq ky b kz mm jr lb lc mn ju le lf mo lh li lj mp ll lm ln mq lp lq lr ij bi translated">你有没有注意到截图时的安全文本输入..如果没有，请看看这个视频。</p><p id="15fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://www.youtube.com/watch?v=YJKqtv8aj_w" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=YJKqtv8aj_w</a></p><p id="9791" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，这个想法是从那里来的，并感谢stackoverflow帖子触发了这一点。</p><p id="e548" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在这里所做的是，将我们的窗口或UIView添加到UITextField的层中(这支持安全进入)，然后就这样了，剩下的事情将由操作系统本身来处理。下面是作为UIView扩展的一小段代码。通过这种方式，我们可以保护内容不被截图、录音和镜像。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="4dd7" class="lt lu iq ng b gy nk nl l nm nn"><strong class="ng ir">private</strong> <strong class="ng ir">extension</strong> UIView {</span><span id="6741" class="lt lu iq ng b gy no nl l nm nn"><strong class="ng ir">func</strong> setScreenCaptureProtection() {</span><span id="2aae" class="lt lu iq ng b gy no nl l nm nn"><strong class="ng ir">guard</strong> superview != <strong class="ng ir">nil</strong> <strong class="ng ir">else</strong> {</span><span id="6d3c" class="lt lu iq ng b gy no nl l nm nn"><strong class="ng ir">for</strong> subview <strong class="ng ir">in</strong> subviews { //to avoid layer cyclic crash, when it is a topmost view, adding all its subviews in textfield's layer, TODO: Find a better logic.</span><span id="578a" class="lt lu iq ng b gy no nl l nm nn">subview.setScreenCaptureProtection()</span><span id="4e85" class="lt lu iq ng b gy no nl l nm nn">}</span><span id="2af5" class="lt lu iq ng b gy no nl l nm nn"><strong class="ng ir">return</strong></span><span id="7931" class="lt lu iq ng b gy no nl l nm nn">}</span><span id="728e" class="lt lu iq ng b gy no nl l nm nn"><strong class="ng ir">let</strong> guardTextField = UITextField()</span><span id="a420" class="lt lu iq ng b gy no nl l nm nn">guardTextField.backgroundColor = .red</span><span id="c2de" class="lt lu iq ng b gy no nl l nm nn">guardTextField.translatesAutoresizingMaskIntoConstraints = <strong class="ng ir">false</strong></span><span id="8847" class="lt lu iq ng b gy no nl l nm nn">guardTextField.isSecureTextEntry = <strong class="ng ir">true</strong></span><span id="59a3" class="lt lu iq ng b gy no nl l nm nn">addSubview(guardTextField)</span><span id="44f9" class="lt lu iq ng b gy no nl l nm nn">guardTextField.isUserInteractionEnabled = <strong class="ng ir">false</strong></span><span id="d8a7" class="lt lu iq ng b gy no nl l nm nn">sendSubviewToBack(guardTextField)</span><span id="ae54" class="lt lu iq ng b gy no nl l nm nn">layer.superlayer?.addSublayer(guardTextField.layer)</span><span id="465a" class="lt lu iq ng b gy no nl l nm nn">guardTextField.layer.sublayers?.first?.addSublayer(layer)</span><span id="ba8c" class="lt lu iq ng b gy no nl l nm nn">guardTextField.topAnchor.constraint(equalTo: <strong class="ng ir">self</strong>.topAnchor, constant: 0).isActive = <strong class="ng ir">true</strong></span><span id="112e" class="lt lu iq ng b gy no nl l nm nn">guardTextField.bottomAnchor.constraint(equalTo: <strong class="ng ir">self</strong>.bottomAnchor, constant: 0).isActive = <strong class="ng ir">true</strong></span><span id="fab4" class="lt lu iq ng b gy no nl l nm nn">guardTextField.leadingAnchor.constraint(equalTo: <strong class="ng ir">self</strong>.leadingAnchor, constant: 0).isActive = <strong class="ng ir">true</strong></span><span id="affe" class="lt lu iq ng b gy no nl l nm nn">guardTextField.trailingAnchor.constraint(equalTo: <strong class="ng ir">self</strong>.trailingAnchor, constant: 0).isActive = <strong class="ng ir">true</strong></span><span id="1c63" class="lt lu iq ng b gy no nl l nm nn">}</span><span id="d20a" class="lt lu iq ng b gy no nl l nm nn">}</span></pre><blockquote class="np nq nr"><p id="1932" class="kw kx ls ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated">对于镜像和录制，Apple通过观察UIScreen的isCaptured属性，提供了一个适当、优雅的解决方案。</p></blockquote><p id="db58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感兴趣的全部源代码，有能力保护从屏幕截图或一个完整的窗口的特定视图？。完整的源代码是<a class="ae kv" href="https://github.com/devCracker/ScreenGuard-iOS" rel="noopener ugc nofollow" target="_blank">这里</a>并且这个也是作为cocoapod发布的，你可以简单地在你的项目中插入。</p><blockquote class="np nq nr"><p id="43c5" class="kw kx ls ky b kz la jr lb lc ld ju le ns lg lh li nt lk ll lm nu lo lp lq lr ij bi translated"><strong class="ky ir">一句话:</strong>视图层次可能有一些问题，我有一些工作要做。我会根据我对那个库的反应来花时间。谢谢！！！。编码快乐！！！。</p></blockquote><p id="b769" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">希望在我们从苹果公司得到一个简单的API之前，这个小小的解决方法可以暂时帮助你。我必须回到workspace去思考SwiftUI应用程序的相同逻辑。<br/>你可能会对我的其他文章感兴趣，比如<a class="ae kv" href="https://devcracker.medium.com/swift-actors-e80ff0dc1832" rel="noopener">迅捷演员</a>、<a class="ae kv" href="https://devcracker.medium.com/mainactor-in-swift-detailed-walkthrough-94044c83118b" rel="noopener">主要演员</a>、<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/thread-sanitizer-in-ios-8438ee3c8c76">螺纹消毒剂</a>等。</p><p id="fbfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从<a class="ae kv" href="https://devcracker.medium.com/membership" rel="noopener">这里</a>升级您的中级会员资格，阅读大量文章并提升您的技能。</p></div></div>    
</body>
</html>