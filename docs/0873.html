<html>
<head>
<title>Write Simple Tasks for Development — The Power of NPM Scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写简单的开发任务——NPM脚本的力量</h1>
<blockquote>原文：<a href="https://itnext.io/the-power-of-npm-scripts-57aaad9f038d?source=collection_archive---------6-----------------------#2018-06-11">https://itnext.io/the-power-of-npm-scripts-57aaad9f038d?source=collection_archive---------6-----------------------#2018-06-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0884865d2d7da1c44cb0f27ec8f70d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eUKoILObAfoL0mAS9xYCiQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">来自国家预防机制网站的官方图片…</figcaption></figure><blockquote class="kc"><p id="38db" class="kd ke iq bd kf kg kh ki kj kk kl km dk translated">如果你所需要的只是一些可以使用“npm脚本”完成的简单任务，那么忘掉诸如“咕噜咕噜/大口大口”之类的任务运行程序或诸如“网络包裹/包裹”之类的打包程序吧。</p></blockquote><p id="811f" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj km ij bi translated">让我们想象一下，你正在做一个项目，在它准备投入生产之前，需要完成几个简单的任务。</p><p id="9ae3" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">任务列表:</p><ul class=""><li id="8764" class="lp lq iq kp b kq lk ku ll ky lr lc ls lg lt km lu lv lw lx bi translated">将Sass编译为CSS</li><li id="8a3e" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km lu lv lw lx bi translated">生成源映射文件</li><li id="244f" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km lu lv lw lx bi translated">处理浏览器的供应商前缀</li><li id="a8e2" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km lu lv lw lx bi translated">缩小CSS</li></ul><p id="0790" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">这些任务可以用n <a class="ae md" href="https://docs.npmjs.com/files/package.json#scripts" rel="noopener ugc nofollow" target="_blank"> pm脚本</a>的力量来创建，而不是用任务运行器或捆绑器。它更干净，更简单，依赖更少，没有第三方插件/包装…而是直接使用<strong class="kp ir">包的CLI </strong>。</p><p id="6374" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">我们的任务列表甚至不需要一个单独的<code class="fe me mf mg mh b">js</code>任务，所以在这种情况下使用Bundler将是一个糟糕的选择。</p><h1 id="21a2" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">让我告诉你，这有多简单！</h1><p id="5cc7" class="pw-post-body-paragraph kn ko iq kp b kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf lg nk li lj km ij bi translated">是时候创建一个项目了，我们称之为“虚拟项目”,然后使用上面提到的<code class="fe me mf mg mh b">npm scripts</code>编写所有这些任务。</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="122b" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">使用<em class="ns">终端</em>创建我们的第一个<strong class="kp ir">“虚拟项目”</strong>，并将目录更改为…</p><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="c84b" class="ob mj iq mh b gy oc od l oe of">cd ~/Sites &amp;&amp; mkdir dummy-project &amp;&amp; cd dummy-project</span></pre><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/64535aa7c9cc7f09d1f683c05b2c13d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjRG_Vgi7J3EfAINBi8AQA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">创建目录并将我们放入其中…</figcaption></figure><p id="13ba" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">现在让我们快速创建一个<code class="fe me mf mg mh b">package.json</code>文件…</p><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="d324" class="ob mj iq mh b gy oc od l oe of">npm init -y</span></pre><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/e85c17e16a742414e44f82e4641cadde.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*t1rhRiezVmEnG8-VKqtloQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">生成没有任何问题的文件…</figcaption></figure><p id="1c60" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">这个文件现在已经生成，我们可以继续了。现在是时候安装我们提到的任务所需的任何<code class="fe me mf mg mh b">devDependencies</code>了。</p><p id="96a0" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">在这种情况下，这些将是:</p><ol class=""><li id="b532" class="lp lq iq kp b kq lk ku ll ky lr lc ls lg lt km oi lv lw lx bi translated"><a class="ae md" href="https://github.com/postcss/autoprefixer" rel="noopener ugc nofollow" target="_blank">自动修复程序</a></li><li id="10ed" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km oi lv lw lx bi translated"><a class="ae md" href="https://github.com/jakubpawlowicz/clean-css-cli" rel="noopener ugc nofollow" target="_blank"> CleanCSS CLI </a></li><li id="884a" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km oi lv lw lx bi translated"><a class="ae md" href="https://github.com/sass/node-sass" rel="noopener ugc nofollow" target="_blank">诺迪斯</a></li><li id="ed07" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km oi lv lw lx bi translated"><a class="ae md" href="https://github.com/postcss/postcss-cli" rel="noopener ugc nofollow" target="_blank"> PostCSS CLI </a></li></ol><p id="02e9" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">要安装所有这些程序，我们需要运行以下命令:</p><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="fc7b" class="ob mj iq mh b gy oc od l oe of">npm i -D autoprefixer clean-css-cli node-sass postcss-cli</span></pre><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oj"><img src="../Images/079125f2c16cacc2fb267154e4e12058.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46xKi3jyVq1WplLAItZSDA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用npm安装依赖于开发人员的设备—软件包管理器…</figcaption></figure><p id="6bd3" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">显然，既然我们也想为生产编译，我们也必须有一个任务来清理我们的生产目录…我们可以使用<code class="fe me mf mg mh b">rimraf</code>来完成这个任务。</p><p id="ff89" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">现在让我们建立一个项目结构…</p><ul class=""><li id="c807" class="lp lq iq kp b kq lk ku ll ky lr lc ls lg lt km lu lv lw lx bi translated">我们将有一个<code class="fe me mf mg mh b">src</code>发展目录</li><li id="0197" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km lu lv lw lx bi translated">在我们的<code class="fe me mf mg mh b">src</code>目录中，我们将创建一个名为<code class="fe me mf mg mh b">dummy.scss</code>的文件，其中将包含带有Scss语法的Sass代码</li><li id="471e" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km lu lv lw lx bi translated">我们将有一个<code class="fe me mf mg mh b">dist</code>目录用于生产，它将自动生成</li></ul><p id="f789" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">是时候写那些脚本任务了…在你最喜欢的代码编辑器中打开<code class="fe me mf mg mh b">package.json</code>文件，找到<code class="fe me mf mg mh b">"scripts"</code>对象并从其中删除<code class="fe me mf mg mh b">"test"</code>属性…</p><blockquote class="ok ol om"><p id="a200" class="kn ko ns kp b kq lk ks kt ku ll kw kx on lm la lb oo ln le lf op lo li lj km ij bi translated">*注意，您可以随意命名脚本命令。这只是我更喜欢的惯例…</p></blockquote><p id="f7d5" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">当我们在<code class="fe me mf mg mh b">package.json</code>文件的<code class="fe me mf mg mh b">"scripts"</code>对象中时，我们现在可以开始编写命令了。</p><h2 id="b642" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">清理“dist”目录</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="2b63" class="ob mj iq mh b gy oc od l oe of">"clean": "rimraf dist",</span></pre><h2 id="8baf" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">从“src”到“dist”编译Sass到CSS</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="5127" class="ob mj iq mh b gy oc od l oe of">"compile": "node-sass --output-style=expanded --source-map=true src/dummy.scss dist/dummy.css",</span></pre><h2 id="b78a" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">使用Autoprefixer处理浏览器的供应商前缀</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="4671" class="ob mj iq mh b gy oc od l oe of">"prefix": "postcss dist/dummy.css --use=autoprefixer --map=false --output=dist/dummy.css",</span></pre><blockquote class="ok ol om"><p id="c7b7" class="kn ko ns kp b kq lk ks kt ku ll kw kx on lm la lb oo ln le lf op lo li lj km ij bi translated">在我们的“package.json”文件中，我们需要为<strong class="kp ir"> Autoprefixer </strong>添加一个内容，那就是定义我们关心的浏览器。如本帖所言，我们将支持每个浏览器的“最后两个版本”。我们可以将以下内容放在<code class="fe me mf mg mh b">"scripts"</code>的括号之后。</p></blockquote><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="3738" class="ob mj iq mh b gy oc od l oe of">"browserslist": ["last 2 versions"],</span></pre><h2 id="fd41" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">使用CleanCSS处理缩小</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="195c" class="ob mj iq mh b gy oc od l oe of">"minify": "cleancss --level=1 --source-map --source-map-inline-sources --output dist/dummy.min.css dist/dummy.css",</span></pre><p id="70c6" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">正如您所看到的，我在最后一个脚本命令中留下了悬挂的逗号。如果我们完成了，在运行任何<code class="fe me mf mg mh b">npm</code>命令时，都会导致一个错误。</p><p id="73a5" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">然而，我们还没有完成，因为我们想让我们的生活更容易，为此，我们必须再写两个命令。一个我们可以用于<strong class="kp ir">开发</strong>，另一个用于<strong class="kp ir">生产</strong>，这样我们甚至不需要记住我们任务的所有名字，而只需要记住这两个。</p><p id="afcb" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">通常的做法是将这两个命名为<code class="fe me mf mg mh b">dev</code>和<code class="fe me mf mg mh b">build</code>……当然，你可以随意命名。</p><h2 id="80da" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">发展指挥部</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="a1df" class="ob mj iq mh b gy oc od l oe of">"dev": "npm run compile -- --watch",</span></pre><blockquote class="ok ol om"><p id="808c" class="kn ko ns kp b kq lk ks kt ku ll kw kx on lm la lb oo ln le lf op lo li lj km ij bi translated">您可能会觉得在这个命令中看到额外的<code class="fe me mf mg mh b">--</code>很奇怪。如果我们使用<code class="fe me mf mg mh b">yarn</code>就不会这样了，但是在<code class="fe me mf mg mh b">npm</code>中，我们确实需要写那些，如果我们把一些参数传递给我们写的<code class="fe me mf mg mh b">npm script</code>…</p></blockquote><h2 id="8805" class="ob mj iq bd mk oq or dn mo os ot dp ms ky ou ov mw lc ow ox na lg oy oz ne pa bi translated">生产指挥</h2><pre class="nt nu nv nw gt nx mh ny nz aw oa bi"><span id="b91a" class="ob mj iq mh b gy oc od l oe of">"build": "npm run clean &amp;&amp; npm run compile &amp;&amp; npm run prefix &amp;&amp; npm run minify"</span></pre><h1 id="6252" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">我们正式结束了！</h1><p id="62f7" class="pw-post-body-paragraph kn ko iq kp b kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf lg nk li lj km ij bi translated">我们的<code class="fe me mf mg mh b">package.json</code>文件现在应该包含下面的上下文，不包括我们用初始的<code class="fe me mf mg mh b">npm</code>命令生成的样板文件…</p><p id="7421" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated"><em class="ns">另外，不要拿走那份样板文件……</em></p><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pb"><img src="../Images/d880347670dfb6dc39090115ed488178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwemjeZv5a9wsj5zFQnPIA.png"/></div></div></figure><p id="b872" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">现在我们可以使用我们刚刚为<code class="fe me mf mg mh b">dummy-project</code>编写的那些<code class="fe me mf mg mh b">npm</code>脚本中的任何一个，并实现我们最初需要的。在我们的空文件中写一些Sass来测试它…</p><ol class=""><li id="69b9" class="lp lq iq kp b kq lk ku ll ky lr lc ls lg lt km oi lv lw lx bi translated"><code class="fe me mf mg mh b">npm run dev</code> —从开发开始，它会观察变化并相应地重新编译</li><li id="f726" class="lp lq iq kp b kq ly ku lz ky ma lc mb lg mc km oi lv lw lx bi translated"><code class="fe me mf mg mh b">npm run build</code> —为生产做好准备。它将<code class="fe me mf mg mh b">clean</code>到<code class="fe me mf mg mh b">dist</code>目录，<code class="fe me mf mg mh b">compile</code>到CSS的Sass，通过<code class="fe me mf mg mh b">autoprefixer</code>运行它来添加任何需要的厂商前缀，最后通过<code class="fe me mf mg mh b">minify</code>运行它来创建一个附加的缩小文件。</li></ol><h1 id="2d13" class="mi mj iq bd mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf bi translated">直到下次</h1><p id="7cb0" class="pw-post-body-paragraph kn ko iq kp b kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf lg nk li lj km ij bi translated">如果你喜欢这个并且学到了新的东西，请分享一些爱。<br/>为此，点击拍手图标👏或者拿着它等待更多的掌声！👏👏👏</p><p id="dc35" class="pw-post-body-paragraph kn ko iq kp b kq lk ks kt ku ll kw kx ky lm la lb lc ln le lf lg lo li lj km ij bi translated">非常感谢。你是最棒的！</p></div></div>    
</body>
</html>