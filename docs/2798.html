<html>
<head>
<title>Azure Functions Proxy versus API Management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure功能代理与API管理</h1>
<blockquote>原文：<a href="https://itnext.io/azure-functions-proxy-vs-api-management-or-what-to-choose-for-your-serverless-api-c563b9fd3a0b?source=collection_archive---------3-----------------------#2019-08-05">https://itnext.io/azure-functions-proxy-vs-api-management-or-what-to-choose-for-your-serverless-api-c563b9fd3a0b?source=collection_archive---------3-----------------------#2019-08-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="60c9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何用用例在它们之间进行选择的权威指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/005e3507853c183f8e8eb0be4909e475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HI4dlrRwX2vDrFBcHFJ4g.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://www.pexels.com/@gratisography" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/@gratisography</a></figcaption></figure><p id="0b5d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我看来，几乎任何项目都可以撕裂Azure函数使用的好处。我将深入探讨两个可用选项的细节，这两个选项可用于构建基于Azure函数的API。</p><blockquote class="ls lt lu"><p id="2885" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">TL；DR；对于高负载的企业解决方案，我会选择API管理和高级方案，因为无服务器消费方案只提供基本功能。对于低/中等负载的解决方案，最好的选择是带有两个可用使用计划的Azure Functions代理。虽然对于公共API应用程序消费计划非常好，但对于受限的企业API，使用VNet的高级计划是更好的选择。</p></blockquote><h2 id="a453" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">关键术语</h2><p id="a598" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated"><strong class="ky ir"> Azure Functions Proxy </strong>是一个统一的API层(facade ),位于应用服务容器内部托管的Azure Functions之上。代理作为一组附加的HTTP端点存在于基于功能的应用程序之前。重要的一点是，代理调用的计费方式和Azure函数一样。因为代理本质上是另一个功能，它被预热并总是准备好接收请求。</p><p id="6c40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Azure API管理</strong>是一个网关，负责API管理、安全、请求转换和路由、API版本控制和策略执行。本质上，它是一个优秀的企业级API管理和保护工具，具有出色的分析能力。</p><blockquote class="ls lt lu"><p id="c8b0" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated"><strong class="ky ir">无服务器</strong>也可以指服务器端逻辑仍然由应用程序开发人员编写的应用程序，但与传统架构不同，它运行在无状态计算容器中，这些容器是事件触发的、短暂的(可能只持续一次调用)，并且完全由第三方管理。一种思考方式是“功能即服务”或<strong class="ky ir">“FaaS”，</strong>参考- <strong class="ky ir"> </strong> <a class="ae kv" href="https://martinfowler.com/articles/serverless.html" rel="noopener ugc nofollow" target="_blank">无服务器架构文章</a>。</p></blockquote></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h2 id="6bcc" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">Azure功能代理</h2><p id="4019" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">它提供了非常基本的功能，包括基本的管理功能、反向代理功能，但没有集中的管理面板、Azure AD集成等等。</p><p id="56b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于无服务器计划，代理功能是相同的。</p><ul class=""><li id="c744" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">基本路由功能。</li><li id="3301" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">后端请求和响应的调整。</li><li id="f9b8" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">通过应用程序设置或请求/响应中的变量进行动态代理配置。</li><li id="a151" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">本地函数可以在同一个App Service app内部引用。</li><li id="59d1" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">附加跟踪和调试信息。</li><li id="4998" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">代理的使用将引入额外的执行成本。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/94fef8552b59e5930ad37d6b1528e183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7CsGIlYG5bGyxVwL6lEIBA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">消费与高级层(仍在预览中)</figcaption></figure><h2 id="0a2f" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">保费计划功能</h2><p id="0ff2" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">Hurray、VNet以及Azure firewall终于可以用于Azure无服务器应用了:)。以及不同的虚拟机大小(P1、P2、P3)和最少数量的预热实例以及限制横向扩展的可配置选项。该计划使用最低配置为3.5 GB、210 ACU的D系列计算虚拟机。顺便说一句，我完全错过了定价从1 VCore变为100 ACU的时刻:)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4cbb025148d00db168b441ca35f66cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*1qNqiCdpi3UbBPlWOPnJdA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">无服务器计划网络功能比较</figcaption></figure></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h2 id="a4af" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">使用消费计划的Azure API管理。</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/ae506944206609a23d2fc5e9af716a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*pDSKPVfRUXCTS7ZWfTbkaw.png"/></div></figure><p id="a838" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尽管很多人都在期待这个无服务器的计划，但事实证明，目前它的功能还很基本。它非常适合具有Azure功能和特定时期峰值负载的场景，但是缺乏来自其他层的VNet支持是一个严格的限制。</p><p id="11fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">重要的是，它提供了一种按需付费的定价模式，适合任何无服务器架构。本质上，定价模式与消费应用服务计划相同，100万次请求免费，下100万次请求收费3.5美元。此外，它还具有动态分配的资源、99.9的SLA和自动扩展功能。</p><p id="117d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">API管理的利弊清单。</p><ul class=""><li id="7242" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">它提供了API管理的入门级模型。</li><li id="9d0b" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">无限(接近)规模。</li><li id="865e" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">自定义域。</li><li id="d33d" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">传入流量的客户端证书身份验证。</li><li id="7bf7" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">没有集成的Azure广告支持，通过代码中的OIDC验证。</li><li id="f837" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">没有管理门户。</li><li id="1222" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">不支持虚拟网络。</li><li id="8f06" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">没有多区域部署。</li><li id="6a86" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">没有静态IP。</li><li id="4556" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">不包括REDIS缓存，你应该自己创建和集成它(BYOC)。</li><li id="8f68" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">每个订阅限制5个实例，每个实例50个API。</li></ul><p id="2107" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是API管理正在发展，并且有希望从高级计划中带来许多特性。</p><blockquote class="ls lt lu"><p id="5823" class="kw kx lv ky b kz la jr lb lc ld ju le lw lg lh li lx lk ll lm ly lo lp lq lr ij bi translated">但是等等，什么叫高负荷？你可以从Azure API管理<a class="ae kv" href="https://azure.microsoft.com/en-us/pricing/details/api-management/" rel="noopener ugc nofollow" target="_blank">定价页面</a>获取数字，根据它，Premium层每单位每秒可以处理大约4000个请求。但是更好的方法是对应用程序进行负载测试，在我看来，每秒1000个post/put请求可以被认为是一个很重的负载。</p></blockquote></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h2 id="4e98" class="lz ma iq bd mb mc md dn me mf mg dp mh lf mi mj mk lj ml mm mn ln mo mp mq mr bi translated">总结。</h2><p id="7068" class="pw-post-body-paragraph kw kx iq ky b kz ms jr lb lc mt ju le lf mu lh li lj mv ll lm ln mw lp lq lr ij bi translated">对于繁重的工作负荷。</p><ul class=""><li id="97f1" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">私有(企业)API——使用高级计划的API管理。</li><li id="f8f5" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">公共API -保费计划的函数代理。</li></ul><p id="6266" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">适用于轻度/中度工作负载。</p><ul class=""><li id="46b7" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated">private API-Premium计划的函数代理。</li><li id="daac" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated">带有消费计划和<a class="ae kv" href="https://medium.com/@staslebedenko/how-to-tackle-the-cold-start-problem-of-azure-function-serverless-app-e90030cdb0c7?source=friends_link&amp;sk=da5d79f26e03c12c322669619a937207" rel="noopener">定制预热解决方案</a>的公共API-函数代理。</li></ul><p id="f2d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就是这样。当优惠计划上市时，我会更新文章。干杯:)。</p><p id="5d04" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">附:有用的链接。</p><ul class=""><li id="b8a9" class="ne nf iq ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated"><a class="ae kv" href="https://stackoverflow.com/questions/1319965/how-many-requests-per-minute-are-considered-heavy-load-approximation" rel="noopener ugc nofollow" target="_blank"> StackOverflow讨论</a></li><li id="b547" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.core.kestrelserverlimits" rel="noopener ugc nofollow" target="_blank">。净核心茶隼限制</a></li><li id="51e9" class="ne nf iq ky b kz nn lc no lf np lj nq ln nr lr nj nk nl nm bi translated"><a class="ae kv" href="https://www.ageofascent.com/2019/02/04/asp-net-core-saturating-10gbe-at-7-million-requests-per-second/\" rel="noopener ugc nofollow" target="_blank">。净核心请求饱和</a></li></ul></div></div>    
</body>
</html>