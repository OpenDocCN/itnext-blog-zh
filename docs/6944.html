<html>
<head>
<title>Widget testing: Dealing with Renderflex Overflow Errors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">小部件测试:处理Renderflex溢出错误</h1>
<blockquote>原文：<a href="https://itnext.io/widget-testing-dealing-with-renderflex-overflow-errors-9488f9cf9a29?source=collection_archive---------3-----------------------#2022-04-19">https://itnext.io/widget-testing-dealing-with-renderflex-overflow-errors-9488f9cf9a29?source=collection_archive---------3-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/2c78e240060d6a6f75f1fca5a6f53268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wFFv9R3iClfI_5CT.png"/></div></div></figure><p id="978f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们以前肯定都在我们的UI中看到过，“一个RenderFlex溢出了…”，我们都知道这个错误意味着我们的UI超出了可用空间的界限。</p><p id="822c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当这出现在屏幕上时，很容易修复，但是当你对你的部件进行单元测试时遇到这种情况怎么办？</p><p id="70fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是我遇到过几次的事情，在大多数情况下，我只是在测试中忽略了它，我condor widget测试的优先级有点低，在大多数情况下，我相信他们的测试最好作为旅程或集成测试的一部分来完成。</p><p id="0325" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也就是说，有时业务逻辑位于小部件中，此时，花时间编写一个适当的单元测试是有价值的。</p><p id="1251" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在过去，尝试修改虚拟用户界面已经产生了一些有用的结果，但是当这个错误最近出现时，我开始寻找一个更可靠的解决方案。</p><p id="bdfa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完全公开，这主要是<a class="ae kw" href="https://twitter.com/remi_rousselet" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> Remi Rousselet </strong> </a>的创意，我只是帮助分享它，让其他开发者的生活稍微轻松一点。</p><h1 id="686c" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">解决方案</h1><p id="9531" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">我总是为我的单元测试保存一个<code class="fe ma mb mc md b">test_helpers.dart</code>文件，这是我的助手列表中的最新成员:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="7cec" class="mm ky iq md b gy mn mo l mp mq">void ignoreOverflowErrors(<br/>  FlutterErrorDetails details, {<br/>  bool forceReport = false,<br/>}) {<br/>  bool ifIsOverflowError = false;<br/>  bool isUnableToLoadAsset = false;</span><span id="5fd8" class="mm ky iq md b gy mr mo l mp mq">// Detect overflow error.<br/>  var exception = details.exception;<br/>  if (exception is FlutterError) {<br/>    ifIsOverflowError = !exception.diagnostics.any(<br/>      (e) =&gt; e.value.toString().startsWith("A RenderFlex overflowed by"),<br/>    );<br/>    isUnableToLoadAsset = !exception.diagnostics.any(<br/>      (e) =&gt; e.value.toString().startsWith("Unable to load asset"),<br/>    );<br/>  }</span><span id="4ee6" class="mm ky iq md b gy mr mo l mp mq">// Ignore if is overflow error.<br/>  if (ifIsOverflowError || isUnableToLoadAsset) {<br/>    debugPrint('Ignored Error');<br/>  } else {<br/>    FlutterError.dumpErrorToConsole(details, forceReport: forceReport);<br/>  }<br/>}</span></pre><p id="6980" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我对原来的解决方案进行了一些更新，它被写为空安全，并且我还添加了加载本地资产时的错误检查。</p><p id="d7c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个助手所做的是当测试运行到这些错误之一时，防止测试运行者退出。我觉得很愚蠢的是，至少RenderFlex问题在测试中不是一个例外，单元测试是为了测试逻辑而存在的，一个小部件在一个无头环境中表现得有多好与测试本身没有关系。</p><p id="bd5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使用这个助手，您只需将它作为测试的一部分，使用<code class="fe ma mb mc md b">FlutterError.onError = ignoreOverflowErrors;,</code>参见下面的例子:</p><pre class="me mf mg mh gt mi md mj mk aw ml bi"><span id="ff88" class="mm ky iq md b gy mn mo l mp mq">void main() {<br/>  TestWidgetsFlutterBinding.ensureInitialized();</span><span id="0d24" class="mm ky iq md b gy mr mo l mp mq">testWidgets('Widget Renders Correctly', (tester) async {<br/>    FlutterError.onError = ignoreOverflowErrors;</span><span id="b2ff" class="mm ky iq md b gy mr mo l mp mq">await tester.pumpApp(const PrimaryHeader(child: Text('Test')));</span><span id="72e5" class="mm ky iq md b gy mr mo l mp mq">final titleFinder = find.text('Test');</span><span id="0a9d" class="mm ky iq md b gy mr mo l mp mq">expect(titleFinder, findsOneWidget);<br/>  });<br/>}</span></pre><p id="3067" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使其工作，需要在特定测试中分配，不能在<code class="fe ma mb mc md b">setUp</code>或<code class="fe ma mb mc md b">setUpAll</code>中分配。</p><p id="5524" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望您对此感兴趣，如果您有任何问题、评论或改进，请随时发表评论。享受你的颤振发展之旅:D</p><p id="d313" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你喜欢，一个赞会很棒，如果你真的喜欢，一杯<a class="ae kw" href="https://www.buymeacoffee.com/remelehane" rel="noopener ugc nofollow" target="_blank">咖啡</a>会很棒。</p><p id="258d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读。</p><p id="34df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">希望继续单元测试的话题，请看:</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="1952" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mz">原载于2022年4月19日</em><a class="ae kw" href="https://remelehane.dev/posts/widget-testing-rendeflex-overflow/" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://remelehane . dev</em></a><em class="mz">。</em></p></div></div>    
</body>
</html>