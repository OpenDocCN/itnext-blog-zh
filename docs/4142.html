<html>
<head>
<title>The Ultimate Guide to Elasticsearch in Laravel Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Laravel应用中弹性研究的最终指南</h1>
<blockquote>原文：<a href="https://itnext.io/the-ultimate-guide-to-elasticsearch-in-laravel-application-ee636b79419c?source=collection_archive---------0-----------------------#2020-05-05">https://itnext.io/the-ultimate-guide-to-elasticsearch-in-laravel-application-ee636b79419c?source=collection_archive---------0-----------------------#2020-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ffdd5b7cdf354236fe3b927a4bd3deb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*r4uerl6T0EYP9qAsulLvUA.gif"/></div></div></figure><p id="3407" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">从一项新技术开始会让人不知所措。尤其是像Elasticsearch这么复杂的时候。在这种情况下，最好的知识来源是<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>，但是它经常不能回答对你来说很重要的问题:从哪里开始？如何在我的本地机器上运行软件？我该如何将它与我心爱的框架整合在一起？</p><p id="1760" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且，有时候我们就是不能投入那么多时间去研究一项新技术。我们有紧迫的截止日期，另一个主题的重点，我们想要的是一个快速的开始。在这种情况下，专注于你感兴趣的主题的指南可能是你最好的选择。这就是本文的全部内容:它指导您在Laravel项目中构建基于Elasticsearch的定制搜索引擎所需的步骤。</p><p id="ad57" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在本文中找到以下问题的答案:</p><ul class=""><li id="5982" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated"><em class="lg">我怎样才能立刻建立一个开发环境，包括:PHP、数据库、HTTP服务器和Elasticsearch？</em></li><li id="8bba" class="kx ky iq ka b kb lh kf li kj lj kn lk kr ll kv lc ld le lf bi translated"><em class="lg">我怎样才能创建一个Elasticsearch索引并与我的队友分享这个模式？</em></li><li id="b221" class="kx ky iq ka b kb lh kf li kj lj kn lk kr ll kv lc ld le lf bi translated"><em class="lg">如何定制Elasticsearch索引的数据？</em></li><li id="8b96" class="kx ky iq ka b kb lh kf li kj lj kn lk kr ll kv lc ld le lf bi translated"><em class="lg">如何使用迷你语言语法提出搜索请求？</em></li><li id="6f4e" class="kx ky iq ka b kb lh kf li kj lj kn lk kr ll kv lc ld le lf bi translated"><em class="lg">如何进行bool查询？</em></li><li id="63b7" class="kx ky iq ka b kb lh kf li kj lj kn lk kr ll kv lc ld le lf bi translated"><em class="lg">如何构建自定义搜索请求构建器？</em></li></ul><p id="5921" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所有答案都以“如何”的方式给出，并附有示例。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="dcf1" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">拉拉多克</h1><p id="6f29" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">在开发一个新项目之前，通常会安装和配置所有必要的软件，这允许您在本地机器上运行代码。我以后会把它称为开发环境。</p><p id="7353" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">开发环境的主要目的是在我们将代码发布到生产或其他环境之前，测试我们的代码，看看它实际上是如何工作的。通常用于运行Laravel应用程序的软件栈有:PHP、PHP-FPM、Nginx、MySql，在我们的例子中还有Elasticsearch。</p><p id="141b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有很多方法可以在本地运行这个软件:你可以使用虚拟机，Docker容器或者直接在你的电脑上安装堆栈。在本文中，我们将坚持使用Docker，因为它是目前开发人员最受欢迎的选择。</p><p id="ad12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，我们不需要从头开始创建Docker映像，因为已经有了一个解决方案，完全符合我们的需求— <a class="ae kw" href="https://laradock.io/" rel="noopener ugc nofollow" target="_blank"> Laradock </a>。要开始使用Laradock，您需要将存储库克隆到您选择的目录中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7a47" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果文件夹结构应该如下所示:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">其中<strong class="ak"><em class="ng">elastic-laravel-demo</em></strong>是一个目录，这是我为演示Laravel应用程序准备的</figcaption></figure><p id="eefc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要配置Laradock，切换到<strong class="ka ir"> <em class="lg"> laradock </em> </strong>文件夹，并将<strong class="ka ir"> <em class="lg"> env-example </em> </strong>复制到<strong class="ka ir"> <em class="lg">。env</em>T11:</strong></p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8059" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<strong class="ka ir"> <em class="lg">。env </em> </strong>文件，并将代码路径变量设置为您的应用程序目录，如下所示:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="d802" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你想更深入地了解Laradock的可用配置选项和可能性，请查看官方文档<a class="ae kw" href="https://laradock.io/documentation/" rel="noopener ugc nofollow" target="_blank">。对于我们的用例，我们可以保持配置的其余部分不变，并且已经在后台启动了必要的容器:</a></p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="3b56" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">Laravel应用</h1><p id="4064" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">让我们创建一个小的演示应用程序，看看如何在Laradock环境中配置Laravel，并为接下来的部分准备一些场地:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="1944" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当新的Laravel安装就绪后，我们需要在<strong class="ka ir"> <em class="lg">中更改MySql设置。env </em> </strong>文件与Laradock默认配置兼容:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4c55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">每个Laravel安装都带有预定义的<strong class="ka ir"> <em class="lg">用户</em> </strong>型号、<strong class="ka ir"> <em class="lg">用户工厂</em> </strong>以及相关的迁移。我们可以利用它来用一些数据填充我们的演示应用程序。唯一缺少的是<strong class="ka ir"><em class="lg">UsersTableSeeder</em></strong>，它可以使用Artisan命令创建:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="daeb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="lg">用户种子</em> </strong>可以在Laravel的<strong class="ka ir"> <em class="lg">数据库/种子</em> </strong>文件夹中找到。要使用播种机，我们需要定义<strong class="ka ir"> <em class="lg">运行</em> </strong>的方法:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="628a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不要忘记通过取消注释相关行来启用<strong class="ka ir"><em class="lg">database/seeds/database seeder . PHP</em></strong>中的播种机:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4b56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，在<strong class="ka ir"> <em class="lg">工作区</em> </strong>容器中使用<em class="lg">种子</em> 选项运行迁移:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="49f6" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">弹性迁移</h1><p id="c305" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">我们已经创建了一个数据库和<strong class="ka ir"> <em class="lg">用户</em> </strong>表，现在是时候创建一个Elasticsearch索引来存储搜索引擎数据了。索引就像关系数据库中的表。它有一个映射，定义了字段类型。</p><p id="53e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们如何创造一个？要回答这个问题，让我们考虑一下在Laravel应用程序中创建数据库表的方式。常见的做法是什么？当然，数据库迁移！</p><p id="953f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">幸运的是，我们有<a class="ae kw" href="https://github.com/babenkoivan/elastic-migrations" rel="noopener ugc nofollow" target="_blank"> Elastic Migrations </a>库，它提供了一个类似于Laravel迁移的接口，但是允许您操作Elasticsearch索引，而不是关系数据库表。</p><p id="4c49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们使用Composer安装库:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="a231" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">弹性迁移使用<a class="ae kw" href="https://github.com/babenkoivan/elastic-client" rel="noopener ugc nofollow" target="_blank">弹性客户端</a>作为依赖项。这意味着，我们需要在<strong class="ka ir">T3中配置客户端。env  </strong>文件之前我们可以执行一次迁移:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="41dd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，不要忘记运行Laravel迁移，因为弹性迁移使用一个数据库表来存储元信息:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ad68" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要创建迁移文件，我们可以使用Artisan命令:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="37bd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令将在<strong class="ka ir"><em class="lg">elastic/migrations</em></strong>文件夹中创建一个存根文件。我们打开带有<strong class="ka ir"><em class="lg">create _ users _ index</em></strong>后缀<strong class="ka ir"> <em class="lg"> </em> </strong>的文件，修改如下:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="1cad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如您在上面看到的，我们在用户索引中只添加了两个字段:姓名和电子邮件。<strong class="ka ir"> <em class="lg">名称</em> </strong>字段为<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/text.html" rel="noopener ugc nofollow" target="_blank">文本类型</a>，由Elasticsearch分析，可用于全文查询。<strong class="ka ir"> <em class="lg">邮件</em> </strong>是<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html" rel="noopener ugc nofollow" target="_blank">关键字</a>，不做分析，主要用于过滤。</p><p id="eb1f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在编写Elasticsearch迁移时，您可以使用许多助手:<strong class="ka ir"> <em class="lg"> create </em> </strong>，<strong class="ka ir"> <em class="lg"> putMapping </em> </strong>，<strong class="ka ir"> <em class="lg"> putSettings </em> </strong>，<strong class="ka ir"> <em class="lg"> drop </em> </strong>等等。我们无法在本指南中涵盖所有内容，因此请参考<a class="ae kw" href="https://github.com/babenkoivan/elastic-migrations" rel="noopener ugc nofollow" target="_blank">项目页面</a>了解更多详情。</p><p id="356a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">迁移准备就绪后，我们可以借助<strong class="ka ir"><em class="lg">elastic:migrate</em></strong>命令来执行它；</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f1a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是对用户数据进行索引，但在此之前，让我们在下一节中简要介绍一下Laravel Scout。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="1497" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">弹性侦察驱动器</h1><p id="ebc0" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">谈到应用程序中的全文搜索，Laravel提供了一些东西。我说的是<a class="ae kw" href="https://laravel.com/docs/master/scout" rel="noopener ugc nofollow" target="_blank"> Laravel Scout </a>，它可以让你的雄辩模型变得可搜索。Scout自动保持搜索索引与数据库记录同步。</p><p id="48f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Scout是灵活的:你可以在引擎盖下使用任何你选择的引擎(Algolia，Elasticsearch，database等。).不幸的是，它只配备了一个开箱即用的驱动程序——Algolia。但是这不是一个问题，因为编写自己的驱动程序或者更好地选择一个已经由社区创建的驱动程序是非常容易的。</p><p id="f852" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Scout不包含在默认的Laravel安装中，所以使用Composer将其添加到您的应用程序中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="c626" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装库后，您需要发布其配置:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="df97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Elasticsearch Scout drivers有很多，但我们将详细讨论<strong class="ka ir"><em class="lg">babenkovian/elastic-Scout-driver</em></strong>:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="7544" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以通过在<strong class="ka ir"> <em class="lg">中设置<strong class="ka ir"> <em class="lg"> SCOUT_DRIVER </em> </strong>变量来启用驱动。env </em> </strong>文件:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="1f69" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，Elastic Scout驱动程序使用与弹性迁移相同的客户端依赖，因此我们这次不需要配置Elasticsearch连接。</p><p id="4387" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是时候配置我们的<strong class="ka ir"> <em class="lg">用户</em> </strong>模型了。首先，我们需要通过添加<strong class="ka ir"> <em class="lg">可搜索</em> </strong>特征来启用搜索功能:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="cc3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其次，让我们限制由Elasticsearch索引的字段，因为我们不希望密码和无用信息存储在我们的搜索引擎中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="433a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，随着所有准备工作的完成，我们准备将演示数据导入到Elasticsearch中:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="20ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意，你只需要第一次导入一个已有的数据。所有新的数据库记录将自动与Elasticsearch同步。</p><p id="0c37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当记录被导入时，我们可以打开Tinker并从数据库中获取一些用户，以了解我们可以搜索什么:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/8474ff45f6c8bc702c7f224544304c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j2nVkqxf742frm2uTpQc5A.png"/></div></div></figure><p id="e3a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们试着找到一个存储在Elasticsearch中的用户。基拉·卢瑟福怎么样？</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/78852a2963468877c44395a28012b21c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dm2qFQ1tMlwypSWE4Bs0g.png"/></div></div></figure><p id="1811" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">弹性侦察兵驱动支持<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" rel="noopener ugc nofollow" target="_blank">迷你语言语法</a>，这意味着你可以做更复杂的查询。例如，如果我们不记得确切的名字:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/572da43d8047cbe0e167247b1d12606e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ff7n6irk4L9WNYTNdLbI0w.png"/></div></div></figure><p id="d074" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者我们根本不知道名字，但我们有一个电子邮件地址:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/5ee048a5bb7659115d7027bafb5014d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEhTvXiMLPjhmeh5XhtfkQ.png"/></div></div></figure><p id="e777" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如你所看到的，Elastic Scout Driver开箱后非常强大，但是如果你想要更多的灵活性或者缺少一些Elasticsearch特定的功能，请查看下一部分，我们将在其中讨论Elastic Scout Driver Plus。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="6c99" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">弹力侦察兵驾驶员增强版</h1><p id="a31f" class="pw-post-body-paragraph jy jz iq ka b kb mr kd ke kf ms kh ki kj mt kl km kn mu kp kq kr mv kt ku kv ij bi translated">弹性侦察兵驱动程序是伟大的，但由于它在侦察兵的边界工作，它是非常有限的。它没有公开Elasticsearch的具体特性，因为这会破坏与其他驱动程序的兼容性。</p><p id="8e17" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个问题由<a class="ae kw" href="https://github.com/babenkoivan/elastic-scout-driver-plus" rel="noopener ugc nofollow" target="_blank"> Elastic Scout Driver Plus </a>解决，它带来了很酷的新功能，如bool查询、高亮显示等等。如果你不打算在你的项目中切换不同的Scout驱动，而宁愿坚持使用Elasticsearch，我推荐你安装它:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="b28a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要启用Elastic Scout Driver Plus特性，请在您的模型中添加<strong class="ka ir"> <em class="lg">自定义搜索</em> </strong>特征:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9f95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要使它工作，您不需要配置其他任何东西。让我们切换到Tinker并尝试一下:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/6e19745c4649d462486137c68b9bf034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRqsnw4Q1byA1tZGPtmNug.png"/></div></div></figure><p id="f196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在上面的例子中，我们做了一个<a class="ae kw" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html" rel="noopener ugc nofollow" target="_blank"> bool查询</a>，它搜索一个名为<strong class="ka ir"> <em class="lg"> Leixe </em> </strong>的用户，并突出显示结果。不幸的是，我们在名字上有一个拼写错误，但是当模糊性被启用时，这不是问题。</p><p id="ccd9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与Elastic Scout Driver不同，Plus版本返回一个<strong class="ka ir"> <em class="lg"> SearchResult </em> </strong>对象，而不是模型集合。它给你更多的灵活性。例如，如果您不需要模型，并且希望避免额外的数据库查询，您可以只检索文档:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/b696a08160c30e4b104f9c8c06f67eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YIbp2gmZmMgvEkWB6rr6A.png"/></div></div></figure><p id="2f4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还可以通过匹配获得相关文档、模型和突出显示:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/325d27aceb6deea08fa6be6f15bc086b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4YjXojVxLBl6qEuWZanCA.png"/></div></div></figure><p id="6b23" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Highlight是一个对象，用于访问Elasticsearch记录的片段:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/07d1302ce08641bf1791ef35b84843cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GOI__CKMbOi1NlSwg08jSw.png"/></div></div></figure><p id="9bc3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">文档是存储可搜索数据的对象:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/ce73692d26259cac4d31b6f7cad0bcdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgGPpjdD0KqoKx9n44d-4Q.png"/></div></div></figure><p id="1ecf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且不需要解释model是什么意思，只要记住，<strong class="ka ir"> <em class="lg"> SearchResult </em> </strong>只在你要求的时候才加载模型，所以不需要担心数据库过载。</p><p id="45b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Scout Driver Plus提供了如此多的弹性，不可能在一篇文章中涵盖所有内容。如果您想要更多的用法示例，请查看<a class="ae kw" href="https://github.com/babenkoivan/elastic-scout-driver-plus" rel="noopener ugc nofollow" target="_blank">库文档</a>。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="b982" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想通过向您介绍一个非常重要的Elastic Scout Driver Plus特性来结束这篇文章——自定义查询构建器。</p><p id="f67c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一下，你的网站上有一个表格，可以让你搜索用户。除了在后端使用通用的查询构建器，您还可以创建一个具有更直观界面的自定义查询构建器:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="c320" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查询构建器构建一个有效负载，作为搜索请求的一部分发送给Elasticsearch(与分页、高亮规则等一起发送)。).为了使用<strong class="ka ir"><em class="lg">SearchFormQueryBuilder</em></strong>，我们需要在我们的模型中添加一个新方法:</p><figure class="mw mx my mz gt jr"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9c9c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以进行更加透明和清晰的查询。看看这个:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/0a684a44274ea867cf41e953904b078d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lq6r8qbWGtDTjSmyBzyoFQ.png"/></div></div></figure><p id="75f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当然，您仍然可以使用分页、突出显示和排序:</p><figure class="mw mx my mz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/f244eadf16a0643f8d4d8b8670d329dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOCU0UPZv_kmbXdx2d6peA.png"/></div></div></figure></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="d17c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这个指南能帮助你们中的一些人开始使用Elasticsearch和Laravel。感谢您的阅读，如果您有任何问题，请不要犹豫，在下面留下您的评论🙂</p></div></div>    
</body>
</html>