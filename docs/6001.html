<html>
<head>
<title>Azure explained deep enough: Azure PaaS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure解释得够深刻:Azure PaaS</h1>
<blockquote>原文：<a href="https://itnext.io/azure-explained-deep-enough-azure-paas-321a0f16bd57?source=collection_archive---------4-----------------------#2021-07-22">https://itnext.io/azure-explained-deep-enough-azure-paas-321a0f16bd57?source=collection_archive---------4-----------------------#2021-07-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/af7f5bf6921ce673a7277ff61df16f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mzvUEqwpYPQ1taXGbQAObQ.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图片由<a class="ae jd" href="https://pixabay.com/users/piro4d-2707530/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1713170" rel="noopener ugc nofollow" target="_blank"> PIRO4D </a>来自<a class="ae jd" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1713170" rel="noopener ugc nofollow" target="_blank"> Pixabay </a></figcaption></figure><div class=""/><div class=""><h2 id="3ab2" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">容器上的应用服务</h2></div><h2 id="8acb" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">介绍</h2><p id="3d3a" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">这是Azure迷你系列的第三部<strong class="lt jh"> Azure解释的够深刻了</strong></p><p id="bab3" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><a class="ae jd" href="https://medium.com/codex/azure-explained-deep-enough-learn-and-get-certified-95c928b0e16c" rel="noopener"> Part1: Azure解释得够深刻:学习并获得认证</a></p><p id="e9dd" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><a class="ae jd" href="https://piotrzan.medium.com/azure-explained-deep-enough-containers-a516af1caab1" rel="noopener"> Part2: Azure解释得够深刻:容器</a></p><p id="29eb" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">第三部分:Azure解释得足够深刻:Azure PaaS </p><p id="61eb" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated"><a class="ae jd" href="https://piotrzan.medium.com/azure-explained-deep-enough-azure-devops-210629b5480e" rel="noopener">第四部分:Azure解释得足够深刻:Azure DevOps </a></p><p id="f23e" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">Azure App Service是一个完全托管的服务，用于构建、部署和扩展您的web应用、web APIs和其他服务器端工作负载。App Service是Azure PaaS产品，PaaS代表平台即服务。</p><h2 id="6bc9" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">PaaS提供商</h2><p id="530f" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">除了Azure，还有其他PaaS提供商，每个主要的云提供商都有自己的产品:</p><ul class=""><li id="86aa" class="mp mq jg lt b lu mk lx ml le mr li ms lm mt mj mu mv mw mx bi translated"><a class="ae jd" href="https://cloud.google.com/appengine/" rel="noopener ugc nofollow" target="_blank"> GCP:谷歌应用引擎</a></li><li id="9bf3" class="mp mq jg lt b lu my lx mz le na li nb lm nc mj mu mv mw mx bi translated"><a class="ae jd" href="https://aws.amazon.com/elasticbeanstalk/" rel="noopener ugc nofollow" target="_blank"> AWS:弹性豆茎</a></li><li id="f6c5" class="mp mq jg lt b lu my lx mz le na li nb lm nc mj mu mv mw mx bi translated">虽然不是“大”云提供商，但我喜欢数字海洋的应用平台</li></ul><p id="de07" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">还有一些有趣的小型PaaS提供商</p><ul class=""><li id="a2c2" class="mp mq jg lt b lu mk lx ml le mr li ms lm mt mj mu mv mw mx bi translated">Heroku是第一家推出类似PaaS产品的公司</li><li id="7eef" class="mp mq jg lt b lu my lx mz le na li nb lm nc mj mu mv mw mx bi translated">牧场主埃皮尼奥仍处于试验阶段，但非常有前景的PaaS产品</li></ul><h2 id="5f1f" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">PaaS有什么好处？</h2><p id="bcc6" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">从虚拟机到容器，现代软件基础设施相当复杂。从单一应用程序到无服务器，从本地模式到混合模式。一切都变得更加紧密，物联网和边缘需求每天都在推动着可能性的边界！像<a class="ae jd" href="https://webassembly.org/" rel="noopener ugc nofollow" target="_blank"> WASM </a>、<a class="ae jd" href="https://riscv.org/" rel="noopener ugc nofollow" target="_blank"> RISC-V </a>、Kubernetes、机器学习&amp; AI、量子计算等等技术将彻底改变软件的创建、交付和个性化方式。</p><p id="5be7" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">这一切都很棒，但是开发人员应该如何跟上所有的构建和部署选项呢？如何轻松监控和运营所有这些不同的工作负载？这就是PaaS的用武之地。</p><p id="5868" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">PaaS通过在固执己见的默认值和配置选项之间提供<strong class="lt jh">的良好平衡，弥合了底层托管平台和运行工作负载之间的差距</strong>。</p><blockquote class="nd ne nf"><p id="2318" class="lr ls ng lt b lu mk kh lw lx ml kk lz nh mm mb mc ni mn me mf nj mo mh mi mj ij bi translated"><em class="jg">换句话说，一个好的PaaS产品将足够灵活以适应不同的需求和工作负载，并且足够智能以通过提供智能抽象层来隐藏基础架构的复杂性。</em></p></blockquote><h2 id="2d88" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">选择托管您的微(服务)的位置</h2><p id="1846" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">Azure和其他主要的云提供商一样，提供了很多服务可供选择。大多数情况下，选项和服务的数量之多令人困惑。下图指导您完成决策过程，并帮助您了解PaaS产品在哪些方面是一个好的选择。</p><p id="9a1c" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">一般来说，如果你有一个通过HTTP(s)面向消费者的工作负载，比如网页、web API等，Azure App Service是一个不错的选择。</p><figure class="nl nm nn no gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/aeb1d862725266b89d8f3885f1ce7559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ne0nKO1dcmApap3d.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><em class="np">来源:</em><a class="ae jd" href="https://docs.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-decision-tree" rel="noopener ugc nofollow" target="_blank"><em class="np">Azure docs</em></a></figcaption></figure><p id="5bd6" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">除了标准的托管选项，现在可以在任何地方运行支持Azure Arc的Kubernetes上的应用服务。这是一个非常有趣的功能，因为它扩展了Azure应用服务控制平面，并在Kubernetes上运行，这意味着如果你已经在Azure上运行了应用服务，你可以在Kubernetes集群上本地运行它们，并像在Azure本身一样使用Azure应用服务抽象。</p><figure class="nl nm nn no gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/855bfa2c0f69509f2f559a45edf62a4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0SchhyvTZcSklup8nK2DzQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated"><em class="np">更多详情请参考本博客</em><a class="ae jd" href="https://azure.microsoft.com/en-us/blog/build-cloudnative-applications-that-run-anywhere/#azure-application-services:-run-your-apps-anywhere" rel="noopener ugc nofollow" target="_blank"><em class="np"/></a><em class="np"/></figcaption></figure><h2 id="45c9" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">选择应用服务SKU计划</h2><p id="b896" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">最后，为了运行我们的应用服务，我们需要选择一个SKU(库存单位)计划，它将定义底层基础设施的功能。</p><p id="0ec5" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">在这里，我们可以决定我们的基础设施应该有多少CPU和RAM，有什么自动扩展规则和其他功能，如支持自定义证书或自定义域名等。</p><blockquote class="nd ne nf"><p id="030d" class="lr ls ng lt b lu mk kh lw lx ml kk lz nh mm mb mc ni mn me mf nj mo mh mi mj ij bi translated"><em class="jg">有关可用配置选项的完整列表，请参考</em> <a class="ae jd" href="https://docs.microsoft.com/en-us/azure/app-service/overview-hosting-plans" rel="noopener ugc nofollow" target="_blank"> <em class="jg"> Azure文档</em> </a></p></blockquote><p id="15e8" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">由于没有好的图形表示来帮助我们选择SKU(类似于帮助我们选择我们服务的主机选项)，我创建了一个:</p><figure class="nl nm nn no gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/162abc7202b73ee4052a35edbd91471b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULUBkAJUeQkXD6m_aLU3Mw.png"/></div></div></figure></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><h1 id="772a" class="nz kw jg bd kx oa ob oc la od oe of ld km og kn lh kp oh kq ll ks oi kt lp oj bi translated">演示</h1><p id="1e2c" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">我们将部署Azure基础设施，并使用带有Azure Container Registry的应用服务来部署在docker容器中运行的示例web应用。</p><h2 id="c2e8" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">基础设施</h2><p id="7d3a" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">为了设置我们的测试基础设施，我们将利用Azure Cloud Shell附带预安装的terraform这一事实。</p><p id="1217" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">你不需要熟悉terraform，所有的命令都会提供，但是记住<strong class="lt jh">在执行</strong>之前一定要从网上查脚本。所有脚本都是学习资源库<a class="ae jd" href="https://github.com/ilearnazuretoday/create-app-service/tree/main/terraform" rel="noopener ugc nofollow" target="_blank">的一部分，这里是</a>。</p><p id="634d" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">请随意派生存储库并做出自己的更改。需要注意的一点是，一旦您开始输入terraform命令，就会生成terraform状态文件。Terraform状态文件包含您不想提交到存储库的敏感信息。<em class="ng"> terraform </em>文件夹中的<code class="fe ok ol om on b">.gitignore</code>将排除状态文件添加到存储库中，因此请不要删除该文件。</p><p id="3de8" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">登录Azure门户，选择云壳。如果你是第一次使用新账号登录，请按照本教程<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/cloud-shell/overview" rel="noopener ugc nofollow" target="_blank">激活云壳。</a></p><p id="2e97" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">一旦进入云shell，请确保选择<em class="ng"> bash </em>环境并遵循以下步骤。</p><pre class="nl nm nn no gt oo on op oq aw or bi"><span id="c4c8" class="kv kw jg on b gy os ot l ou ov"><em class="ng"># Clone the exercise repository</em><br/>git clone https://github.com/ilearnazuretoday/create-app-service</span><span id="d674" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Switch to right directory</em><br/>cd create-app-service/terraform</span><span id="8d9c" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Initialize terraform with Azure Provider</em><br/>terraform init</span><span id="a8c1" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Validate terraform scripts</em><br/>terraform plan</span><span id="8a3c" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Create infrastructure, confirm with "yes"</em><br/>terraform apply</span></pre><p id="1dc0" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">上面的命令应该创建我们的Azure基础设施和。继续从terraform输出中复制URL，您应该会从我的Docker Hub注册表中看到一个<a class="ae jd" href="https://hub.docker.com/repository/docker/piotrzan/blazorindocker" rel="noopener ugc nofollow" target="_blank">示例PWA网页</a>。</p><figure class="nl nm nn no gt is gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/9080851453e10cd25d426ac1b692f13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*jGtZWshx5ulA-Xczl26I-w.png"/></div></figure><h2 id="de93" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">部署应用程序</h2><p id="ce72" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">在这里，我们有各种选项可以选择，从nginx-demo文件夹部署一个样本HTML页面，用另一个容器替换app service容器，设置CI/CD管道，等等。如果您感兴趣，请按照说明进行操作。</p><p id="6f4f" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">将登录详细信息检索到我们的Azure容器注册表中，这样我们就可以使用示例web应用程序推送图像</p><pre class="nl nm nn no gt oo on op oq aw or bi"><span id="ef4a" class="kv kw jg on b gy os ot l ou ov"><em class="ng"># Capture resource group name output from terraform into a variable</em><br/>export RG_NAME=$(terraform output --raw resource_group)</span><span id="cc06" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Capture ACR name output from terraform into a variable</em><br/>export ACR_NAME=$(terraform output --raw acr_name)</span><span id="5b39" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Capture app service name into a variable</em><br/>export APP_NAME=$(terraform output --raw app_service_name)</span><span id="2b52" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Obtain user name for the ACR</em><br/>export ACR_USERNAME=$(az acr credential show --resource-group $RG_NAME_ --name $ACR_NAME --query username)</span><span id="5274" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Obtain password for the ACR</em><br/>export ACR_PASSWORD=$(az acr credential show --resource-group $RG_NAME_ --name $ACR_NAME --query passwords[0].value)</span></pre><h2 id="6ff3" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">从Azure Cloud shell本地构建映像</h2><p id="c0be" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">由于docker守护进程没有在云shell VM中运行，我们必须使用<em class="ng"> az acr build </em>命令来构建映像并将其部署到acr。</p><pre class="nl nm nn no gt oo on op oq aw or bi"><span id="6d7c" class="kv kw jg on b gy os ot l ou ov"><em class="ng"># Navigate to folder with demo app</em><br/>cd ../nginx-demo</span><span id="51df" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Use az cli to build and upload container to ACR</em><br/>az acr build --image nginx-demo:1.0 \<br/>    --registry $ACR_NAME \<br/>    --file Dockerfile .</span></pre><h2 id="055c" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">为我们的应用服务设置新推送的图片</h2><p id="77ff" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">现在，我们可以为我们的应用程序服务设置图像。请注意，出于教育目的，所有这些行为都是以“强制”方式进行的。在真实的场景中，将建立CI/CD管道来处理变更和更新的流程</p><pre class="nl nm nn no gt oo on op oq aw or bi"><span id="2768" class="kv kw jg on b gy os ot l ou ov">az webapp config container set --name $APP_NAME \<br/>    --resource-group $RG_NAME \<br/>    --docker-custom-image-name nginx-demo:1.0 \<br/>    --docker-registry-server-url "https://$ACR_NAME.azurecr.io" \<br/>    --docker-registry-server-user $ACR_USERNAME \<br/>    --docker-registry-server-password $ACR_PASSWORD</span></pre><p id="ac9b" class="pw-post-body-paragraph lr ls jg lt b lu mk kh lw lx ml kk lz le mm mb mc li mn me mf lm mo mh mi mj ij bi translated">稍等片刻，以便Azure可以刷新图像并导航到相同的地址，您应该会看到一个nginx演示页面。</p><h2 id="2046" class="kv kw jg bd kx ky kz dn la lb lc dp ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">摧毁基础设施</h2><p id="9260" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">这一步很重要，这样你就可以避免不必要的费用。让我们移除资源，使用terraform很容易做到这一点。</p><pre class="nl nm nn no gt oo on op oq aw or bi"><span id="702d" class="kv kw jg on b gy os ot l ou ov"><em class="ng"># Navigate to folder with demo app</em><br/>cd ../terraform</span><span id="a4aa" class="kv kw jg on b gy ow ot l ou ov"><em class="ng"># Destroy all resources, confirm with yes</em><br/>terraform destroy</span></pre><h1 id="62bd" class="nz kw jg bd kx oa oy oc la od oz of ld km pa kn lh kp pb kq ll ks pc kt lp oj bi translated">结论</h1><p id="806f" class="pw-post-body-paragraph lr ls jg lt b lu lv kh lw lx ly kk lz le ma mb mc li md me mf lm mg mh mi mj ij bi translated">Azure PaaS，App Service是一个非常通用和强大的服务。我们已经学会了何时使用它，如何选择正确的SKU，最后如何按照代码实践中的<strong class="lt jh">基础设施部署一个样本工作负载。</strong></p></div></div>    
</body>
</html>