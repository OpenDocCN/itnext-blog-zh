<html>
<head>
<title>DIY React Popups with Popper.js 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Popper.js 2反应弹出窗口</h1>
<blockquote>原文：<a href="https://itnext.io/diy-react-popups-with-popper-js-2-c76ff6b7fc5d?source=collection_archive---------1-----------------------#2020-01-24">https://itnext.io/diy-react-popups-with-popper-js-2-c76ff6b7fc5d?source=collection_archive---------1-----------------------#2020-01-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/c92679360269a03a0e6ef0215fc5a662.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*FQBCUbXap2Dm_4Sl3wLX0A.png"/></div></figure><p id="b61e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我需要在React中构建一个自定义的选择输入。像往常一样，它归结为呈现一个带有可用选项的popup元素，并计算出它相对于input元素的位置，确保组件能够响应窗口大小调整并做出正确反应，同时保持键盘的可访问性。当谈到DOM定位库时，没有竞争者——<a class="ae ks" href="https://popper.js.org/" rel="noopener ugc nofollow" target="_blank">popper . js</a>是行业标准——然而Popper.js 2相对较新，最近仅作为候选版本提供。我想我应该试一试——从我收集到的信息来看，除了性能上的改进，主要的区别是“修饰符”实现和触发方式的一致性。</p><p id="1221" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">构件骨架</strong></p><p id="5ba4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们设置我们的基本组件。我将使用基于类的React组件，因为它们更容易推理，但是像所有其他组件一样，可以使用React钩子将它们重构为功能组件。</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="c987" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在我们的基础架构中，有两个元素:一个触发器和一个弹出窗口。让我们将它们呈现到DOM中，并给它们分配相应的引用。因为我们将操作DOM元素，所以我们希望能够通过它们的引用方便地访问这两个元素。</p><p id="356d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir"> Popper.js库</strong></p><p id="47bb" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们拉进Popper.js:</p><pre class="kt ku kv kw gt kz la lb lc aw ld bi"><span id="e63e" class="le lf iq la b gy lg lh l li lj">npm install @popperjs/core</span></pre><p id="bb5d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们现在可以使用Popper.js构造函数来连接我们的触发器/弹出窗口关系:</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="c0fa" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们已经建立了两个生命周期挂钩:在<code class="fe lk ll lm la b">componentDidMount</code>上，我们通过给Popper.js提供触发和弹出引用(以及我们可能需要的任何修饰符，例如通过props)来连接它。在<code class="fe lk ll lm la b">componentWitllUnmount</code>中，我们希望确保通过销毁popper实例来清理所有绑定。此外，我们希望确保我们的popup引用始终存在于DOM中，即使实际的popup内容没有显示出来——然后我们可以通过在popup内容可见时强制更新来控制popper的定位。</p><p id="eb50" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">门户弹出</strong></p><p id="e720" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了避免处理<code class="fe lk ll lm la b">z-index</code>的疯狂，我们可以将我们的弹出窗口附加到DOM文档的主体，从而确保它不会与我们的触发器元素相邻的任何元素冲突。这不是100%必要的，您可以通过CSS解决这些问题，但是如果您的项目中已经安装了<code class="fe lk ll lm la b">react-dom</code>，您不妨利用它。</p><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure><p id="0e23" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">捕捉焦点</strong></p><p id="eb9e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">焦点补漏白是一个重要的辅助工具。如果您的弹出窗口包含输入或其他可聚焦的元素(您可能希望允许您的用户使用键盘浏览可用的选择或菜单选项)。<code class="fe lk ll lm la b">focus-trap-react</code>是一个非常棒的库，您可以将它引入到您的项目中，以避免处理大量的可访问性问题:</p><ul class=""><li id="5695" class="ln lo iq jw b jx jy kb kc kf lp kj lq kn lr kr ls lt lu lv bi translated">当用户点击外部时退出/关闭弹出窗口</li><li id="3944" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">当用户按下<code class="fe lk ll lm la b">ESC</code>时退出/关闭弹出窗口</li><li id="94e8" class="ln lo iq jw b jx lw kb lx kf ly kj lz kn ma kr ls lt lu lv bi translated">将焦点捕获在弹出元素中，以确保流畅的键盘体验</li></ul><figure class="kt ku kv kw gt jr"><div class="bz fp l di"><div class="kx ky l"/></div></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><p id="0f41" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">就是这样。您现在有了一个可以完全控制的弹出元素。你可以创建下拉菜单、选择输入、工具提示以及任何你喜欢的需要相对于触发元素定位的东西。</p><p id="e1ad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">好处:</strong>在div元素上使用引用可以让你访问所有的DOM元素属性，包括<code class="fe lk ll lm la b">clientWidth</code>，因此你可以使用<code class="fe lk ll lm la b">style</code>道具来设置你的popup元素的宽度，以匹配你的引用元素的宽度:</p><pre class="kt ku kv kw gt kz la lb lc aw ld bi"><span id="8ee5" class="le lf iq la b gy lg lh l li lj">&lt;div style={{ width: this.toggleRef.current.clientWidth }} /&gt;</span></pre></div></div>    
</body>
</html>