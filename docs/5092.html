<html>
<head>
<title>Create Lambdas in an existing VPC using CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CDK在现有的VPC中创建Lambdas</h1>
<blockquote>原文：<a href="https://itnext.io/create-lambdas-in-an-existing-vpc-using-cdk-8136f5c2d841?source=collection_archive---------1-----------------------#2020-12-08">https://itnext.io/create-lambdas-in-an-existing-vpc-using-cdk-8136f5c2d841?source=collection_archive---------1-----------------------#2020-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bf8d9993f6531303825b0443080b5fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AR8ywEG9XzMCohEYWf6how.png"/></div></div></figure><p id="4383" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">默认情况下，lambda不绑定到VPC，它可以与公共子元素中的所有资源通信。然而，在很多用例中，您需要将lambda与VPC中私有子网内的数据库、ec2或内部服务相连接。要使用lambda访问VPC境内的资源，它应该位于VPC内部。</p><p id="1865" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">今天我将向你们展示，如何使用CDK，在VPC中发射lambda。最棘手的是，当您将一个函数连接到VPC时，Lambda会为函数的VPC配置中的安全组和子网的每个组合创建一个弹性网络接口。因此，当您配置VPC连接时，Lambda需要权限来创建和验证网络资源。我们开始吧，</p><ol class=""><li id="ebb0" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">得到现存的VPC</li></ol><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="a552" class="lr ls it ln b gy lt lu l lv lw">from aws_cdk import (<br/>    aws_lambda as lb,<br/>    aws_ec2 as ec2,<br/>    aws_iam as iam,<br/>    core<br/>)</span><span id="6daa" class="lr ls it ln b gy lx lu l lv lw">dev_vpc = ec2.Vpc.from_vpc_attributes( self, 'dev_vpc',<br/>          vpc_id = "<strong class="ln iu">VPC_ID</strong>",<br/>          availability_zones = core.Fn.get_azs(),<br/>          private_subnet_ids = [<strong class="ln iu">"SUBNET_ID1", "SUBNET_ID2"</strong>]<br/>       )</span></pre><p id="e232" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据您的情况，用适当的值替换VPC ID和子网ID。</p><p id="5a75" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.授予Lambda角色权限</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="cd80" class="lr ls it ln b gy lt lu l lv lw"><strong class="ln iu">lambda_role</strong> = iam.Role( self,'lambda_role',                       assumed_by=iam.ServicePrincipal('lambda.amazonaws.com'),<br/>role_name = "prod_lambda_role"<br/>)</span><span id="55a7" class="lr ls it ln b gy lx lu l lv lw">iam.ManagedPolicy(self, "managed_policy",<br/>statements = [<br/>              iam.PolicyStatement(<br/>                  effect = iam.Effect.ALLOW,<br/>                  actions = ["ec2:CreateNetworkInterface",<br/>                             "ec2:DescribeNetworkInterfaces",<br/>                             "ec2:DeleteNetworkInterface",<br/>                             "ec2:AssignPrivateIpAddresses",<br/>                             "ec2:UnassignPrivateIpAddresses"],<br/>                  resources = ["*"]<br/>               )<br/>             ],<br/>roles = [<strong class="ln iu">lambda_role</strong>]<br/>)</span></pre><p id="af29" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.创建Lambda</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="4e31" class="lr ls it ln b gy lt lu l lv lw">encrypt_db_lambda = lb.Function(self, 'encrypt_db_lambda',<br/>              code = lb.Code.from_asset('lambda'),<br/>              handler = 'encrypt_db_lambda.handler',<br/>              runtime=lb.Runtime.PYTHON_3_6,<br/>              <strong class="ln iu">vpc = dev_vpc,</strong><br/>              function_name = "base_lambda",<br/>              <strong class="ln iu">role = lambda_role,</strong><br/>)</span></pre><p id="a06d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如上所述，你可以简单地使用CDK在VPC中创建你的lambdas。</p></div></div>    
</body>
</html>