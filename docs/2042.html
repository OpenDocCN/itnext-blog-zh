<html>
<head>
<title>Local Drupal 8 Development with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker进行本地Drupal 8开发</h1>
<blockquote>原文：<a href="https://itnext.io/local-drupal-8-development-with-docker-ed25910cfce2?source=collection_archive---------1-----------------------#2019-03-21">https://itnext.io/local-drupal-8-development-with-docker-ed25910cfce2?source=collection_archive---------1-----------------------#2019-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/58b8923490e77e1af873665f115bf800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*IKPNn8NB18EVAqaBPJ3Y4A.jpeg"/></div></figure><p id="9e7e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你知道如何谷歌，你会发现大量关于如何为Drupal 建立一个<a class="ae ks" href="https://www.drupal.org/docs/develop/local-server-setup/docker-development-environments" rel="noopener ugc nofollow" target="_blank"> Docker开发环境的信息。大部分都很好，有据可查。</a></p><p id="243b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">感觉他们挺复杂的。我需要更简单的东西，这也是一个学习如何自己制作东西的过程。我必须创建一个适合我工作的流程。如果你对学习感兴趣，这是我的学习方法。</p><blockquote class="kt ku kv"><p id="1d4b" class="ju jv kw jw b jx jy jz ka kb kc kd ke kx kg kh ki ky kk kl km kz ko kp kq kr ij bi translated">在开始之前，我想做的是为Drupal 8创建一个简单的本地docker开发，这样我就可以从主机上编辑我的Drupal文件和数据库，而无需设置其他组件，如web服务器、MySQL服务器…</p></blockquote><p id="9f49" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">从docker-compose开始</strong></p><p id="dfd1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Dockerfile不错，docker-compose在管理不同容器方面要好得多。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="5cb1" class="lj lk iq lf b gy ll lm l ln lo"><em class="kw"># docker-compose.yml</em></span><span id="56ca" class="lj lk iq lf b gy lp lm l ln lo">version: "3"</span><span id="4fdb" class="lj lk iq lf b gy lp lm l ln lo">services:<br/>  web:<br/>    image: nginx:$NGINX_TAG<br/>    container_name: "${PROJECT_NAME}_nginx"<br/>    ports:<br/>      - $NGINX_PORT<br/>    volumes:<br/>      - "./drupal/web:/var/www/html"<br/>      - "./drupal/nginx.conf:/etc/nginx/conf.d/default.conf"    <br/>    depends_on:<br/>      - php    <br/>  php:<br/>    image: drupal:$DRUPAL_TAG<br/>    container_name: "${PROJECT_NAME}_drupal"<br/>    volumes:<br/>      - "./drupal/web:/var/www/html"<br/>    restart: always<br/>    depends_on:<br/>      - mysql    <br/>  mysql:<br/>      image: mysql:$MYSQL_TAG<br/>      container_name: "${PROJECT_NAME}_mysql"<br/>      entrypoint: ['/entrypoint.sh', '--default-authentication-plugin=mysql_native_password']<br/>      environment:<br/>        MYSQL_ROOT_PASSWORD: $DB_ROOT_PASSWORD<br/>        MYSQL_USER: $DB_USER<br/>        MYSQL_PASSWORD: $DB_PASSWORD<br/>        MYSQL_DATABASE: $DB_NAME<br/>      volumes:<br/>        - "./drupal/mysql:/var/lib/mysql"<br/>      restart: always</span></pre><p id="ce8a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如您所见，我使用一个环境文件来管理所有版本的容器。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="452f" class="lj lk iq lf b gy ll lm l ln lo"><em class="kw"># .env</em></span><span id="38a7" class="lj lk iq lf b gy lp lm l ln lo">PROJECT_NAME=drupal8</span><span id="177b" class="lj lk iq lf b gy lp lm l ln lo">DRUPAL_VERSION=8.6.12</span><span id="b166" class="lj lk iq lf b gy lp lm l ln lo">NGINX_TAG=alpine<br/>NGINX_PORT=8080:80</span><span id="606a" class="lj lk iq lf b gy lp lm l ln lo">DRUPAL_TAG=8.6-fpm-alpine</span><span id="871a" class="lj lk iq lf b gy lp lm l ln lo">MYSQL_TAG=8</span><span id="3bda" class="lj lk iq lf b gy lp lm l ln lo">DB_NAME=drupal<br/>DB_USER=drupal<br/>DB_PASSWORD=drupal<br/>DB_ROOT_PASSWORD=password</span></pre><p id="25d1" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">获取Drupal 8文件</strong></p><p id="3399" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Drupal容器假定下载Drupal文件并把它们放在<strong class="jw ir"> <em class="kw"> /var/www/html </em> </strong>文件夹下。<strong class="jw ir">不知道为什么没有，需要手动更新。如果你知道如何</strong> <a class="ae ks" href="https://stackoverflow.com/questions/55268228/drupal-8-folder-is-empty-after-running-docker-compose?noredirect=1#comment97271216_55268228" rel="noopener ugc nofollow" target="_blank"> <strong class="jw ir">解决这个问题</strong> </a> <strong class="jw ir">。请帮忙改进；)</strong></p><p id="be57" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">不然我得写个剧本来做。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="348c" class="lj lk iq lf b gy ll lm l ln lo"><em class="kw"># drupal-install.sh</em></span><span id="0387" class="lj lk iq lf b gy lp lm l ln lo">#! /bin/bash</span><span id="b40e" class="lj lk iq lf b gy lp lm l ln lo">[[ -f .env ]] &amp;&amp; source .env</span><span id="9a04" class="lj lk iq lf b gy lp lm l ln lo">if [ $DRUPAL_VERSION ]<br/>then <br/>    echo "Start with Drupal version ${DRUPAL_VERSION}"<br/>else<br/>    echo "Drupal version is not defined. Set the default version to 8.6.12"<br/>    DRUPAL_VERSION='8.6.12'<br/>fi</span><span id="e130" class="lj lk iq lf b gy lp lm l ln lo">mkdir drupal/web<br/>curl -fSL "<a class="ae ks" href="https://ftp.drupal.org/files/projects/drupal-${DRUPAL_VERSION}.tar.gz" rel="noopener ugc nofollow" target="_blank">https://ftp.drupal.org/files/projects/drupal-${DRUPAL_VERSION}.tar.gz</a>" -o drupal.tar.gz<br/>mv drupal.tar.gz drupal/web<br/>cd drupal/web<br/>tar -zx --strip-components=1 -f drupal.tar.gz<br/>rm drupal.tar.gz</span></pre><p id="0299" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">因此，我将在启动机器之前运行脚本。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="e8ad" class="lj lk iq lf b gy ll lm l ln lo">sh drupal-install.sh</span></pre><p id="7d0e" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">管理容器</strong></p><p id="f3b9" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一切准备就绪后，我们可以打开容器(Nginx、Drupal和MySQL)</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="c2d9" class="lj lk iq lf b gy ll lm l ln lo">docker-compose up -d</span></pre><figure class="la lb lc ld gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="gh gi lq"><img src="../Images/3bcdd9e1c36b02b87d037333d25db01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p74a0gF412TZGe6yuYZT3A.png"/></div></div></figure><p id="001b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">你可以访问<a class="ae ks" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>，开始安装一个新的Drupal 8项目。</p><p id="e403" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">完成后，您可以关闭容器</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="12e5" class="lj lk iq lf b gy ll lm l ln lo">docker-compose down</span></pre><p id="4915" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">导出和导入数据库</strong></p><p id="580d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你已经有了一个现有的项目，你可以把这个项目放在<strong class="jw ir"> drupal/web </strong>文件夹下，而不用运行安装脚本。</p><p id="72cd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">之后，您可以使用这些命令导出和导入数据库</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="7e35" class="lj lk iq lf b gy ll lm l ln lo"># For export database<br/>docker exec drupal8_mysql /usr/bin/mysqldump -u root --password=password drupal &gt; drupal/backup.sql</span><span id="45c5" class="lj lk iq lf b gy lp lm l ln lo"># For import database<br/>cat drupal/backup.sql  | docker exec -i drupal8_mysql /usr/bin/mysql -u root --password=password drupal</span></pre><p id="3811" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">如果你想查看这个项目，请访问<a class="ae ks" href="https://github.com/dalenguyen/drupal8-docker" rel="noopener ugc nofollow" target="_blank"> Drupal 8 Docker Github库</a>。</p><p id="f100" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个项目是基于WordPress开发的Docker。</p></div></div>    
</body>
</html>