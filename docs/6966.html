<html>
<head>
<title>Using AWS Lambda Function URL to build a Serverless backend for Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda函数URL构建Slack的无服务器后端</h1>
<blockquote>原文：<a href="https://itnext.io/using-aws-lambda-function-url-to-build-a-serverless-backend-for-slack-a292ef355a5d?source=collection_archive---------0-----------------------#2022-04-28">https://itnext.io/using-aws-lambda-function-url-to-build-a-serverless-backend-for-slack-a292ef355a5d?source=collection_archive---------0-----------------------#2022-04-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4c17" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与Giphy API集成的Slack应用程序</h2></div><p id="f9c8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">AWS Lambda和Amazon API Gateway的组合是一种广泛用于无服务器微服务和基于API的解决方案的架构。它们使开发人员能够专注于他们的应用程序，而不是花费时间配置和管理服务器。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/4c61740344e852f926c6d0d9c3acf56b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/0*21NNPrf6tDrksuhl.png"/></div></figure><p id="a17d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">API Gateway是一个功能丰富的产品，包括支持不同的API类型(HTTP、REST、WebSocket)、多种身份验证方案、API版本控制、canary部署等等！但是，如果您的需求比较简单，并且您所需要的只是Lambda函数的HTTP(S)端点(例如，作为一个webhook)，那么您可以使用<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-urls.html" rel="noopener ugc nofollow" target="_blank"> Lambda函数URL</a>！当您创建一个函数URL时，Lambda会自动生成一个惟一的HTTP(S)端点，专门用于您的Lambda函数。</p><p id="d282" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇博文用一个实际例子演示了如何使用Lambda函数URL。您将构建一个<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-golang.html" rel="noopener ugc nofollow" target="_blank"> Go Lambda函数</a>作为<a class="ae lj" href="https://slack.com/" rel="noopener ugc nofollow" target="_blank"> Slack </a>的无服务器webhook后端。</p><p id="2223" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是一个分步指南，包括:</p><ul class=""><li id="8135" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">应用程序概述</li><li id="6ae8" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">配置和部署该功能(以及一些需要注意的问题！)</li><li id="c9d2" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">如何配置Slack来实现端到端集成</li><li id="bb9d" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">测试应用程序，玩得开心！</li></ul><p id="2be1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到本博客结束时，您应该已经配置、集成和部署了一个有用的(希望有趣？)使用Lambda函数URL的app。在这个过程中，您将对这个特性有一个大致的了解，您可以在构建自己的解决方案时利用它！</p><blockquote class="ly lz ma"><p id="95d6" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">代码为</em> <a class="ae lj" href="https://github.com/abhirockzz/awsome-slack-backend" rel="noopener ugc nofollow" target="_blank"> <em class="iq">可在GitHub </em> </a>上获得</p></blockquote></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="f56f" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">它是如何工作的</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi ne"><img src="../Images/f110930b04b984f5cfa0fd6d587ef2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gCdPbVzuyVFq65nz.png"/></div></div></figure><p id="a3c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本博客中展示的示例应用程序是针对Slack 的<a class="ae lj" href="https://get.slack.help/hc/en-us/articles/204714258-Giphy-for-Slack" rel="noopener ugc nofollow" target="_blank"> Giphy的精简版本。(最初的)Giphy Slack应用为一个搜索词返回一堆gif，用户可以从中选择一个。为了简单起见，我做了一些调整，使得无服务器后端使用</a><a class="ae lj" href="https://developers.giphy.com/docs/#operation--gifs-random-get" rel="noopener ugc nofollow" target="_blank"> Giphy Random API </a>简单地为搜索关键字返回一个(单个)随机图像。</p><p id="54e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于该解决方案将被集成为Slack中的一个<a class="ae lj" href="https://api.slack.com/interactivity/slash-commands" rel="noopener ugc nofollow" target="_blank">斜杠命令</a>，最终用户(您！)将使用<code class="fe nj nk nl nm b">/awsome &lt;your search term&gt;</code>从Slack工作区调用它(这里<code class="fe nj nk nl nm b">awsome</code>只是slash命令的名称)。这反过来调用Lambda函数URL(配置将在后面的博客中介绍)，它会处理剩下的事情。</p><p id="2c77" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，使用<code class="fe nj nk nl nm b">/awsome serverless</code>从您的Slack工作区调用它将会返回一个随机的GIF(您稍后将会尝试这个！)</p><p id="79d7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是Lambda函数的功能概述:</p><ul class=""><li id="79df" class="lk ll iq kh b ki kj kl km ko lm ks ln kw lo la lp lq lr ls bi translated">Slack slash命令调用导致一个<code class="fe nj nk nl nm b">base64</code>编码的字符串有效载荷被发送到Lambda函数URL——所以第一步是解码它。</li><li id="9f8e" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">这个函数只应该被Slack调用，我们需要确保我们确认了这一点。Slack允许应用程序使用签名秘密来验证请求，从而使这成为可能——该功能只是实现了签名匹配方案的Go版本，此处<a class="ae lj" href="https://api.slack.com/authentication/verifying-requests-from-slack" rel="noopener ugc nofollow" target="_blank">为</a></li><li id="b276" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">如果签名匹配成功(如果失败，我们向客户机返回一个错误)，Slack请求被解析以提取用户发送的搜索<code class="fe nj nk nl nm b">text</code>。</li><li id="0a16" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">然后，使用搜索词调用<a class="ae lj" href="https://developers.giphy.com/docs/api/endpoint#random" rel="noopener ugc nofollow" target="_blank"> Giphy随机API </a>。如果我们得到一个成功的响应，我们解析它并以它想要的格式发送回Slack</li></ul><p id="e59a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，用户可以在他们的空闲工作区看到GIF！</p><p id="c11b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了专注于解决方案的其他方面，我将跳过代码演练，但函数签名值得一提，它类似于您在基于API网关的解决方案中使用的函数签名:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="b325" class="nr mn iq nm b gy ns nt l nu nv">func Funcy(r events.LambdaFunctionURLRequest) (events.LambdaFunctionURLResponse, error) {<br/>    ...<br/>}</span></pre><p id="1780" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们正在使用<a class="ae lj" href="https://pkg.go.dev/github.com/aws/aws-lambda-go/events#LambdaFunctionURLRequest" rel="noopener ugc nofollow" target="_blank">事件。LambdaFunctionURLRequest </a>作为输入并返回<a class="ae lj" href="https://pkg.go.dev/github.com/aws/aws-lambda-go/events#LambdaFunctionURLResponse" rel="noopener ugc nofollow" target="_blank">事件。LambdaFunctionURLResponse </a>。在幕后，Lambda将请求映射到事件对象，然后将其传递给函数。最后，函数响应被映射到一个HTTP响应，Lambda通过函数URL将这个响应发送回客户机。</p><blockquote class="ly lz ma"><p id="8671" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">您可以在</em> <a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-invocation.html#urls-payloads" rel="noopener ugc nofollow" target="_blank"> <em class="iq">文档</em> </a>中详细阅读</p></blockquote><p id="4d36" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那很方便，对吗？您可以使用API网关约定，而无需实际设置和配置！</p><p id="cfe9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了这些背景信息，让我们转到部署功能的部分，并用Slack进行测试。但是，在此之前，请确保您已经做好以下准备:</p><h1 id="ee6a" class="mm mn iq bd mo mp nw mr ms mt nx mv mw jw ny jx my jz nz ka na kc oa kd nc nd bi translated">先决条件</h1><ul class=""><li id="94d4" class="lk ll iq kh b ki ob kl oc ko od ks oe kw of la lp lq lr ls bi translated"><a class="ae lj" href="https://portal.aws.amazon.com/gp/aws/developer/registration/index.html" rel="noopener ugc nofollow" target="_blank">创建一个AWS帐户</a>(如果您还没有)并登录。您使用的IAM用户必须有足够的权限进行必要的AWS服务调用和管理AWS资源。</li><li id="ad65" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">安装和配置<a class="ae lj" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></li><li id="64be" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated"><a class="ae lj" href="https://go.dev/dl/" rel="noopener ugc nofollow" target="_blank">安装Go </a></li><li id="0527" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated"><a class="ae lj" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">安装Git </a></li><li id="5c6a" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated"><a class="ae lj" href="https://slack.com/create" rel="noopener ugc nofollow" target="_blank">如果没有，创建一个宽松的工作空间</a>。</li><li id="38c0" class="lk ll iq kh b ki lt kl lu ko lv ks lw kw lx la lp lq lr ls bi translated">创建一个GIHPY帐户(这是免费的！)和<a class="ae lj" href="https://developers.giphy.com/dashboard/?create=true" rel="noopener ugc nofollow" target="_blank">创建一个app </a>。您创建的每个应用程序都有自己的API密钥。</li></ul><blockquote class="ly lz ma"><p id="0955" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">请记下您的GIPHY API密钥，因为您稍后会用到它</em></p></blockquote><p id="96a7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">克隆Github repo并移动到正确的目录:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="06ec" class="nr mn iq nm b gy ns nt l nu nv">git clone https://github.com/abhirockzz/awsome-slack-backend<br/>cd awsome-slack-backend/function</span></pre><blockquote class="ly lz ma"><p id="eb61" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">后续步骤使用AWS CLI —我特意使用了AWS CLI，以便突出显示流程的特定方面。请查看</em> <a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-tutorial.html" rel="noopener ugc nofollow" target="_blank"> <em class="iq">本教程</em> </a> <em class="iq">获取CloudFormation和SAM </em></p></blockquote></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="23cf" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">构建、压缩和部署函数！</h1><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="ffad" class="nr mn iq nm b gy ns nt l nu nv">export FUNC_NAME=awsome-slack-backend<br/>export FUNC_GO_BINARY_NAME=awsome<br/>export ZIP_NAME=function.zip</span><span id="168e" class="nr mn iq nm b gy og nt l nu nv">GOOS=linux go build -o $FUNC_GO_BINARY_NAME main.go</span><span id="44ac" class="nr mn iq nm b gy og nt l nu nv">zip function.zip $FUNC_GO_BINARY_NAME</span></pre><p id="9131" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，为Lambda创建一个IAM角色，并附加<code class="fe nj nk nl nm b">AWSLambdaBasicExecutionRole</code>策略:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="d706" class="nr mn iq nm b gy ns nt l nu nv">export ROLE_NAME=demo-lambda-role</span><span id="3050" class="nr mn iq nm b gy og nt l nu nv">ROLE_ARN=$(aws iam create-role \<br/>        --role-name $ROLE_NAME \<br/>        --assume-role-policy-document '{"Version": "2012-10-17","Statement": [{ "Effect": "Allow", "Principal": {"Service": "lambda.amazonaws.com"}, "Action": "sts:AssumeRole"}]}' \<br/>        --query 'Role.[Arn]' --output text)</span><span id="acbc" class="nr mn iq nm b gy og nt l nu nv">aws iam attach-role-policy --role-name $ROLE_NAME --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole</span></pre><p id="e801" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建函数:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="1db3" class="nr mn iq nm b gy ns nt l nu nv">aws lambda create-function \<br/>    --function-name $FUNC_NAME \<br/>    --runtime go1.x \<br/>    --zip-file fileb://$ZIP_NAME \<br/>    --handler $FUNC_GO_BINARY_NAME \<br/>    --role $ROLE_ARN</span></pre><p id="6629" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建函数后，继续添加函数URL:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="c971" class="nr mn iq nm b gy ns nt l nu nv">aws lambda create-function-url-config \<br/>    --function-name $FUNC_NAME \<br/>    --auth-type NONE</span></pre><blockquote class="ly lz ma"><p id="b4a5" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">在这个示例应用程序中，我们使用</em> <code class="fe nj nk nl nm b"><em class="iq">NONE</em></code> <em class="iq">作为认证类型。这意味着Lambda函数的URL将可以公开访问——稍后会有更多介绍</em></p></blockquote><p id="57cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您导航到AWS控制台并打开刚刚创建的函数，您应该会看到与其相关联的函数URL:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oh"><img src="../Images/e3a0fb5ba02ee1fd7d898ee80f72ea08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S5aqdlnLIDBK3Zku.png"/></div></div></figure></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="4200" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们调用函数——复制函数URL并将其粘贴到浏览器中，或者使用任何其他工具(例如<code class="fe nj nk nl nm b">curl</code>)</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="3286" class="nr mn iq nm b gy ns nt l nu nv">curl -i &lt;FUNCTION_URL&gt;</span></pre><p id="124b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您应该得到一个带有<code class="fe nj nk nl nm b">HTTP 403 Forbidden</code>状态代码的<code class="fe nj nk nl nm b">{"Message":"Forbidden"}</code>响应</p><blockquote class="ly lz ma"><p id="e02a" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">不要担心，这是意料之中的事，我想确保您遇到这个问题并了解根本原因。</em></p></blockquote><p id="0721" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使我们使用<code class="fe nj nk nl nm b">NONE</code>作为身份验证方案，用户仍然必须拥有<code class="fe nj nk nl nm b">lambda:InvokeFunctionUrl</code>权限才能成功调用函数URL。(稍微)棘手的一点是，当你通过控制台或AWS无服务器应用程序模型(AWS SAM)创建一个函数URL(使用auth type <code class="fe nj nk nl nm b">NONE</code>)时，Lambda <em class="mb">会自动</em>为你创建基于资源的策略声明(细节见<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-auth.html#urls-auth-none" rel="noopener ugc nofollow" target="_blank">文档</a>)。如果你直接使用AWS CLI(就像这篇博客中一样)、AWS CloudFormation或Lambda API，情况就不一样了——你必须自己添加权限。</p><p id="47cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们这样做:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="7283" class="nr mn iq nm b gy ns nt l nu nv">aws lambda add-permission \<br/>    --function-name $FUNC_NAME \<br/>    --action lambda:InvokeFunctionUrl \<br/>    --statement-id FunctionURLAllowPublicAccess \<br/>    --principal "*" \<br/>    --function-url-auth-type NONE</span></pre><blockquote class="ly lz ma"><p id="981b" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">要查看策略，请在AWS控制台中导航到您的功能:配置&gt;权限</em></p></blockquote><p id="c50a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次调用该函数:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="7f84" class="nr mn iq nm b gy ns nt l nu nv">curl -i &lt;FUNCTION_URL&gt;</span></pre><p id="476e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这一次，您将得到一个不同的错误，带有一个<code class="fe nj nk nl nm b">HTTP 401 Unauthorized</code>状态代码。这也是意料之中的！</p><p id="fc43" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们完成剩下的配置，让事情正常运行。</p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="81af" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">配置时差</h1><blockquote class="ly lz ma"><p id="1b0d" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">请注意，本节中的大部分说明改编自</em> <a class="ae lj" href="https://api.slack.com/slash-commands#creating_commands" rel="noopener ugc nofollow" target="_blank"> <em class="iq">时差文档</em> </a></p></blockquote><p id="d8df" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先登录你的<a class="ae lj" href="https://slack.com/signin" rel="noopener ugc nofollow" target="_blank"> Slack Workspace </a>和<a class="ae lj" href="https://api.slack.com/apps/new" rel="noopener ugc nofollow" target="_blank">创建一个新的Slack App </a>。</p><p id="da9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦完成，创建一个斜线命令——转到你的应用程序的设置页面，然后点击导航菜单中的<em class="mb">斜线命令</em>功能。你会看到一个标有<em class="mb">创建新命令</em>的按钮，当你点击它时，你会看到一个屏幕，要求你用需要的信息定义你的新<em class="mb">斜线命令</em>。</p><p id="ded6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输入所需的信息—为命令输入<code class="fe nj nk nl nm b">/awsome</code>,并在请求URL中输入Lambda函数URL</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oi"><img src="../Images/6a8fd0921d39545c7a85a428e39c53bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hKqqzamS2DtnM53O.png"/></div></div></figure><p id="2de8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，将应用程序安装到您的工作区—单击导航菜单中的<em class="mb">基本信息</em>功能，选择<em class="mb">将应用程序安装到您的工作区</em>，然后单击<em class="mb">将应用程序安装到工作区</em>。这将把应用程序安装到您的Slack工作区，以测试您的应用程序并生成您需要与Slack API交互的令牌。</p><p id="3899" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你安装完应用程序，<em class="mb">应用程序凭证</em>就会出现在同一页面上。你需要从那里获取你的<em class="mb">松弛签名秘密</em></p><blockquote class="ly lz ma"><p id="7548" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated"><em class="iq">记下你的应用签名密码，因为你以后会用到它</em></p></blockquote><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nf ng di nh bf ni"><div class="gh gi oj"><img src="../Images/c9973f37ba6fae551cc0af9cb505485a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5ug97XhdPG4FB6Kn.png"/></div></div></figure><h1 id="dc9d" class="mm mn iq bd mo mp nw mr ms mt nx mv mw jw ny jx my jz nz ka na kc oa kd nc nd bi translated">更新功能</h1><p id="1fae" class="pw-post-body-paragraph kf kg iq kh b ki ob jr kk kl oc ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">现在您已经有了松弛签名密钥，您还需要确保在函数中配置它。另外，不要忘记GIPHY API键，因为该函数需要它来调用GIPHY REST端点。</p><p id="857c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们更新函数，将这些作为环境变量包括进来:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="05c0" class="nr mn iq nm b gy ns nt l nu nv">aws lambda update-function-configuration \<br/>    --function-name $FUNC_NAME \<br/>    --environment "Variables={SLACK_SIGNING_SECRET=&lt;enter Slack signing secret&gt;,GIPHY_API_KEY=&lt;enter Giphy API key&gt;}"</span></pre><blockquote class="ly lz ma"><p id="30f1" class="kf kg mb kh b ki kj jr kk kl km ju kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated">示例应用程序使用Lambda环境变量来存储Slack和GIPHY的键——这只是为了演示。您应该使用诸如<a class="ae lj" href="https://aws.amazon.com/secrets-manager" rel="noopener ugc nofollow" target="_blank"><em class="iq">AWS Secrets Manager</em></a><em class="iq">之类的解决方案来安全地存储和管理凭证。</em></p></blockquote></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="0faf" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">你都准备好了！</h1><p id="c19f" class="pw-post-body-paragraph kf kg iq kh b ki ob jr kk kl oc ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">前往您的Slack工作区并调用该命令。例如，要获得一个随机的猫GIF，只需键入:</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="f883" class="nr mn iq nm b gy ns nt l nu nv">/awsome cat</span></pre><p id="5c5a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我得到了这样的回应。你呢？:-)</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi on"><img src="../Images/cffe1d125f13049a7b97b29684b13fdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*vNLrC8ArfAyr_QP_.gif"/></div></figure><p id="6fda" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请随意使用该应用程序！</p><h1 id="bd2d" class="mm mn iq bd mo mp nw mr ms mt nx mv mw jw ny jx my jz nz ka na kc oa kd nc nd bi translated">打扫</h1><p id="e101" class="pw-post-body-paragraph kf kg iq kh b ki ob jr kk kl oc ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">完成后，删除该函数以及IAM策略和角色。</p><pre class="lc ld le lf gt nn nm no np aw nq bi"><span id="8a12" class="nr mn iq nm b gy ns nt l nu nv">aws lambda delete-function --function-name $FUNC_NAME</span><span id="aff8" class="nr mn iq nm b gy og nt l nu nv">aws iam detach-role-policy  --role-name $ROLE_NAME --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole</span><span id="af96" class="nr mn iq nm b gy og nt l nu nv">aws iam delete-role --role-name $ROLE_NAME</span></pre></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><h1 id="48bb" class="mm mn iq bd mo mp mq mr ms mt mu mv mw jw mx jx my jz mz ka na kc nb kd nc nd bi translated">结论</h1><p id="f425" class="pw-post-body-paragraph kf kg iq kh b ki ob jr kk kl oc ju kn ko ok kq kr ks ol ku kv kw om ky kz la ij bi translated">您为Slack配置并部署了一个无服务器的后端，在这个过程中，您通过这个示例应用程序了解了Lambda函数URL的一些方面。我鼓励您探索其他功能，如<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-auth.html#urls-auth-iam" rel="noopener ugc nofollow" target="_blank"> AWS_IAM认证</a>、<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-configuration.html#urls-cors" rel="noopener ugc nofollow" target="_blank"> CORS配置</a>、<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-configuration.html#urls-throttling" rel="noopener ugc nofollow" target="_blank">节流限制</a>、<a class="ae lj" href="https://docs.aws.amazon.com/lambda/latest/dg/urls-monitoring.html" rel="noopener ugc nofollow" target="_blank">监控</a>等。</p><p id="55a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">编码快乐！</p></div></div>    
</body>
</html>