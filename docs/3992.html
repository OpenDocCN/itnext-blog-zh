<html>
<head>
<title>E2E Testing of excel file downloads with cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用cypress进行excel文件下载的E2E测试</h1>
<blockquote>原文：<a href="https://itnext.io/e2e-testing-of-excel-downloads-with-cypress-d6e46ccdc232?source=collection_archive---------1-----------------------#2020-04-07">https://itnext.io/e2e-testing-of-excel-downloads-with-cypress-d6e46ccdc232?source=collection_archive---------1-----------------------#2020-04-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f32c5faffa5a769b2ae2f69d86534c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ztz9_YUVKN41aT0qU6X7kA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Maggie Appleton为egghead.io所作的插图</figcaption></figure><p id="93cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近在做一个项目时，我不得不创建一个功能，让用户可以下载包含一些数据的excel文件。</p><p id="16d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这个过程中，由于我非常喜欢用<a class="le lf ep" href="https://medium.com/u/47c842e55929?source=post_page-----d6e46ccdc232--------------------------------" rel="noopener" target="_blank"> Cypress.io </a>进行E2E测试，所以我决定编写一个测试套件，确保excel被正确下载，并且包含用户期望的正确数据。</p><p id="b14e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文假设对cypress有一个基本的了解。</p><p id="33d5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">免责声明</strong></p><p id="4d8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你以前没有尝试过用cypress进行e2e测试，我强烈推荐你跳到“参考”部分，按照一些入门指南去做。</p></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="9763" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">📦装置</h1><ol class=""><li id="9f82" class="ml mm it ki b kj mn kn mo kr mp kv mq kz mr ld ms mt mu mv bi translated">假设您有一个名为<code class="fe mw mx my mz b">dashboard-ui</code>的repo，在其中创建一个名为<code class="fe mw mx my mz b">e2e</code>的新文件夹。</li><li id="7df3" class="ml mm it ki b kj na kn nb kr nc kv nd kz ne ld ms mt mu mv bi translated"><code class="fe mw mx my mz b">cd</code>到那个文件夹，在里面执行下面的命令。</li></ol><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8dc7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3)通过打开<code class="fe mw mx my mz b">package.json</code>更新项目脚本，并将您的脚本更新为:</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="eff3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4)安装cypress后，您还应该会看到cypress为您创建的一些默认文件夹和文件。</p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/1c02e00ce7f73087704886107de9dd8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Um5vmbibp38U_efkkhfwQ.png"/></div></div></figure><p id="ec27" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5)我们将要编写的测试将放在<code class="fe mw mx my mz b">integration</code>文件夹中。</p></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="ee91" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">⚙️功能</h1><p id="ad34" class="pw-post-body-paragraph kg kh it ki b kj mn kl km kn mo kp kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">为了简单起见，假设我们的应用程序只有一个特性，用户可以点击一个<code class="fe mw mx my mz b">download template</code>按钮，它可以下载一个包含一些数据的excel文件。</p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/031867e411e40b5433dc10f1499c3704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sy52hYOpj_h3Ood2Md-BGg.png"/></div></div></figure><p id="c82e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">单击下载模板按钮，下载一个文件，如下所示:</p><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/618365743fc241bc82d08dfa6b38b0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jCfD0V_5FCCGAa9UazIwZw.png"/></div></div></figure><h2 id="a3cf" class="nr lo it bd lp ns nt dn lt nu nv dp lx kr nw nx mb kv ny nz mf kz oa ob mj oc bi translated">演示</h2><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div class="gh gi od"><img src="../Images/15bbed0852168e080e9b9e406a0e23be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ozcvTReSXwEwqINA255r3A.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">gif到演示excel文件下载</figcaption></figure></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="3bf1" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">🧪 E2E测试</h1><ol class=""><li id="d308" class="ml mm it ki b kj mn kn mo kr mp kv mq kz mr ld ms mt mu mv bi translated">在<code class="fe mw mx my mz b">integration</code>文件夹中创建一个名为<code class="fe mw mx my mz b">ExcelDownload.spec.js</code>的新文件。</li><li id="efc1" class="ml mm it ki b kj na kn nb kr nc kv nd kz ne ld ms mt mu mv bi translated">在这个文件中，我们的测试将首先检查按钮是否存在，然后我们将单击它。</li></ol><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="8852" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3)点击文件后，理想情况下文件应该已经下载，现在我们需要以某种方式读取该文件，检查它是否存在，并检查它是否包含正确的数据。</p><p id="2ca9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4)为此，我们首先需要安装另一个npm包，它可以解析excel并将其转换为json。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="e571" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5)之后，在您的<code class="fe mw mx my mz b">plugins/index.js</code>文件中，我们将创建一个新任务来解析excel。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="59ec" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个函数将解析我们的excel文件，并将其转换为json。</p><p id="948b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6)最后，让我们完成excel文件下载的测试</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="0f47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7)这样，我们就可以确保我们的excel下载功能正常工作。</p><h2 id="7eba" class="nr lo it bd lp ns nt dn lt nu nv dp lx kr nw nx mb kv ny nz mf kz oa ob mj oc bi translated">测试执行</h2><figure class="nf ng nh ni gt ju gh gi paragraph-image"><div class="gh gi od"><img src="../Images/02f51243f778b14e4006002ee5300cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*rN_-YxJJGD1Q9dA9on9lfw.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">在cypress中运行e2e测试的演示</figcaption></figure><p id="f5ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8)这里唯一需要注意的是，如何知道CI/CD管道的下载路径，或者如何将该路径更改为其他路径。</p><p id="dcd7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解决办法是在柏树上建造。在<code class="fe mw mx my mz b">plugins/index.js</code>文件中，我们将再次创建另一个任务。</p><figure class="nf ng nh ni gt ju"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="eebd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这里，我们将下载的默认目录更改为cypress文件夹中的一个名为<code class="fe mw mx my mz b">excelDownloads</code>的目录。</p><p id="cbc9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://docs.cypress.io/api/plugins/browser-launch-api.html#Change-download-directory" rel="noopener ugc nofollow" target="_blank">https://docs . cypress . io/API/plugins/browser-launch-API . html # Change-download-directory</a></p></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="3442" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">💡结论</h1><p id="174d" class="pw-post-body-paragraph kg kh it ki b kj mn kl km kn mo kp kq kr nm kt ku kv nn kx ky kz no lb lc ld im bi translated">总之，E2E测试对每个应用程序都非常重要，你也应该写一个，因为这是你能得到的最接近测试实际用户如何使用你的应用程序的方法。</p><p id="238d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如托马斯·拉科米所说:</p><blockquote class="oe of og"><p id="1870" class="kg kh oh ki b kj kk kl km kn ko kp kq oi ks kt ku oj kw kx ky ok la lb lc ld im bi translated">有了e2e测试和cypress.io，晚上睡得更香</p></blockquote><p id="9ce3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">👯如果你觉得这篇文章有帮助，请分享！</p><p id="30a6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更多更新可以在twitter <a class="ae kf" href="https://twitter.com/VivekNayyar09" rel="noopener ugc nofollow" target="_blank"> @VivekNayyar09 </a>关注我。</p><p id="da02" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，请不要忘记保持社交距离，以防止病毒传播，并定期洗手。注意安全，呆在家里。</p></div><div class="ab cl lg lh hx li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="im in io ip iq"><h1 id="8f41" class="ln lo it bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">🚀<strong class="ak">参考文献</strong></h1><ul class=""><li id="ba6f" class="ml mm it ki b kj mn kn mo kr mp kv mq kz mr ld ol mt mu mv bi translated"><a class="ae kf" href="https://softchris.github.io/pages/cypress.html" rel="noopener ugc nofollow" target="_blank">https://softchris.github.io/pages/cypress.html</a></li><li id="8020" class="ml mm it ki b kj na kn nb kr nc kv nd kz ne ld ol mt mu mv bi translated"><a class="ae kf" href="https://docs.cypress.io/guides/getting-started/installing-cypress.html#System-requirements" rel="noopener ugc nofollow" target="_blank">https://docs . cypress . io/guides/getting-started/installing-cypress . html #系统要求</a></li><li id="2cc7" class="ml mm it ki b kj na kn nb kr nc kv nd kz ne ld ol mt mu mv bi translated"><a class="ae kf" href="https://dev.to/tlakomy/sleeping-better-at-night-with-cypress-io-59m2" rel="noopener ugc nofollow" target="_blank">https://dev . to/tlakomy/sleeping-better-night-with-cypress-io-59 m2</a></li><li id="d242" class="ml mm it ki b kj na kn nb kr nc kv nd kz ne ld ol mt mu mv bi translated"><a class="ae kf" href="https://blog.logrocket.com/how-to-write-useful-end-to-end-tests-with-cypress/" rel="noopener ugc nofollow" target="_blank">https://blog . log rocket . com/how-to-write-useful-end-to-end-tests-with-cypress/</a></li></ul></div></div>    
</body>
</html>