<html>
<head>
<title>Stopping Form SPAM in Laravel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阻止Laravel中的垃圾邮件</h1>
<blockquote>原文：<a href="https://itnext.io/stopping-form-spam-in-laravel-76760bf84bd?source=collection_archive---------0-----------------------#2019-08-13">https://itnext.io/stopping-form-spam-in-laravel-76760bf84bd?source=collection_archive---------0-----------------------#2019-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7904" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用原生的拉勒维尔能力替换瑞普察</p><p id="5eaf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">几乎每个Laravel应用程序都有某种公开的联系方式。让这些表单易于提交是用户的一项要求。问题是，你一天会被垃圾邮件轰炸多次。</p><p id="0220" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">像ReCAPTCHA这样的解决方案可以完全避免这种情况，但是它们有自己的权衡，可能会让用户感到厌烦。我想向您展示一种本地的Laravel方法来阻止大多数垃圾邮件机器人通过您的表单提交。</p><h1 id="68e8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">蜜罐</h1><p id="6708" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们将使用一个“<a class="ae kl" href="https://en.wikipedia.org/wiki/Honeypot_(computing)" rel="noopener ugc nofollow" target="_blank">蜜罐</a>”来使用捕捉技术。这只是意味着我们将在我们的应用程序中加入一些专门用于监视垃圾邮件机器人的代码。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/04eeb8450d949e38d9b40f65a6eafbe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*N6SpHIm8Psx4JvsV.gif"/></div></figure><p id="0cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">大多数垃圾邮件机器人会进入一个表单，填写所有可用的字段。如果有一系列复选框，机器人被设计为检查所有字段。我们将通过创建一个隐藏的表单字段来利用这一点，我们将在提交时监视该字段。</p><p id="7e61" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个简单的联系人表单。我将对HTML类使用Bootstrap，但是标记并不重要。</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="6d09" class="mc kn iq ly b gy md me l mf mg">&lt;form action="/contact" method="POST"&gt;<a class="ae kl" href="http://twitter.com/csrf" rel="noopener ugc nofollow" target="_blank">@csrf</a><br/> &lt;div class="form-group"&gt;<br/>  &lt;label for="name"&gt;Full Name&lt;/label&gt;<br/>  &lt;input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" /&gt;<br/> &lt;/div&gt;<br/> &lt;div class="form-group"&gt;<br/>  &lt;label for="email"&gt;Email address&lt;/label&gt;<br/>  &lt;input type="email" class="form-control" id="email" name="email" placeholder="Enter email" /&gt;<br/> &lt;/div&gt;<br/> &lt;div class="form-group"&gt;<br/>  &lt;label for="comments"&gt;Comments&lt;/label&gt;<br/>  &lt;textarea class="form-control" id="comments" rows="3" name="comments"&gt;&lt;/textarea&gt;<br/> &lt;/div&gt;<br/> &lt;button type="submit" class="btn btn-primary"&gt;Submit&lt;/button&gt;<br/>&lt;/form&gt;</span></pre><p id="3377" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以将它提交给一个带有类似于<code class="fe mh mi mj ly b">store</code>的某种方法的<code class="fe mh mi mj ly b">ContactController</code>。</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="3bcd" class="mc kn iq ly b gy md me l mf mg">Route::post('contact', '<a class="ae kl" href="https://yabhq.com/cdn-cgi/l/email-protection" rel="noopener ugc nofollow" target="_blank">[email protected]</a>');</span></pre><p id="fc2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">创建一个<code class="fe mh mi mj ly b">ContactController</code>，并在其上添加<code class="fe mh mi mj ly b">store</code>方法。您想要激发一个向您自己发送电子邮件或将其添加到您公司的票证系统的事件。无论您的用例是什么，您的代码可能看起来像这样:</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="66b3" class="mc kn iq ly b gy md me l mf mg">/**  <br/> * Get the contact data and email it to ourselves  <br/> *  <br/> * @param  \Illuminate\Http\Request  $request  <br/> * @return \Illuminate\Http\Response  <br/> */ <br/>public function store(Request $request) <br/>{<br/>    $formData = $request-&gt;validate([<br/>        'fullname' =&gt; 'required',<br/>        'email'    =&gt; 'required|email',<br/>        'comments' =&gt; 'required'<br/>    ]);<br/>    event(new ContactFormSubmitted($formData);<br/>    return redirect()-&gt;back()<br/>        -&gt;withSuccess('Your form has been submitted'); <br/>}</span></pre><p id="3472" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这段代码对人类和你的T-1000系列终结者来说会很好用，但是会让所有的垃圾邮件泛滥成灾。</p><h1 id="93f0" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">仅接受传真</h1><p id="8a43" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们想做的技巧是在我们的网站上添加一个永远不应该被检查的表单域。我喜欢将字段命名为<em class="mk">“仅通过传真联系我”</em>。没有人会检查这一点。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/042a5a60072b5c98404c41a4d7c9627e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*D7bn9ZTXnyIln62E.gif"/></div></figure><p id="ac2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将此代码添加到表单中:</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="cd23" class="mc kn iq ly b gy md me l mf mg">&lt;div class="form-group" style="display: none;"&gt;<br/> &lt;label for="faxonly"&gt;Fax Only<br/>  &lt;input type="checkbox" name="faxonly" id="faxonly" /&gt;<br/> &lt;/label&gt;<br/>&lt;/div&gt;</span></pre><p id="71a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保不要省略<code class="fe mh mi mj ly b">style="display: none;"</code>属性。我们不希望这个字段向用户显示。</p><p id="8cbc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您的下一个直觉可能是将这个字段添加到您的验证中，以确保它是空白的。虽然这样做可行，但是您会通知机器人他们的提交没有通过。这可能会导致他们调整机器人来处理你的表单。</p><p id="034a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当试图击败垃圾邮件发送者和机器人时，有一个重要的规则。<strong class="jp ir">让他们以为自己赢了</strong>。您希望表单提交能够顺利通过并返回成功的响应。</p><p id="e323" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在控制器中添加一个条件，检查<code class="fe mh mi mj ly b">faxonly</code>字段是否存在。</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="b3a3" class="mc kn iq ly b gy md me l mf mg">if ($request-&gt;faxonly) {<br/>    return redirect()-&gt;back()<br/>        -&gt;withSuccess('Your form has been submitted'); <br/>}</span></pre><p id="4085" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果输入字段被选中，表单将只返回一个响应而不做任何事情。<strong class="jp ir">好人— 1。垃圾邮件发送者-0。</strong></p><p id="beae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后要清理的是我们添加的重复内容。我们将向视图返回相同的成功响应。我们将通过在您的控制器上添加一个<code class="fe mh mi mj ly b">protected</code>函数来清空我们的代码，该函数包含您将总是发回的响应。</p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="daee" class="mc kn iq ly b gy md me l mf mg">/** <br/> * The response to always send back to the frontend <br/> * <br/> * @return \Illuminate\Http\Response <br/> */ <br/>protected function formResponse() <br/>{ <br/>    return redirect()-&gt;back()<br/>        -&gt;withSuccess('Your form has been submitted'); <br/>}</span></pre><p id="0a78" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在更新你的存储方法，使用新的<code class="fe mh mi mj ly b">formResponse()</code></p><pre class="lq lr ls lt gt lx ly lz ma aw mb bi"><span id="ddda" class="mc kn iq ly b gy md me l mf mg">public function store(Request $request) <br/>{ <br/>    if ($request-&gt;faxonly) { <br/>        return $this-&gt;formResponse(); <br/>    } <br/>    event(new ContactFormSubmitted($request-&gt;all()));<br/>    return $this-&gt;formResponse(); <br/>}</span></pre><p id="1343" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此时，您应该会停止大多数垃圾邮件的提交。您可以通过在HTML表单中添加大量JavaScript来解决这个问题。我个人最喜欢的是让输入<strong class="jp ir">成为必需的，默认选中</strong>，在页面加载后用JavsScript取消选中。</p><p id="35bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我坚持使用上面的解决方案，因为这是一个很好的免费的JavaScript方法来阻止机器人。如果你有任何关于如何改进的想法或主意，请<a class="ae kl" href="https://twitter.com/chrisblackwell" rel="noopener ugc nofollow" target="_blank">告诉我</a>。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="95fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mk">最初发表于</em><a class="ae kl" href="https://yabhq.com/stopping-form-spam-laravel" rel="noopener ugc nofollow" target="_blank"><em class="mk">https://yabhq.com</em></a><em class="mk">。</em></p></div></div>    
</body>
</html>