<html>
<head>
<title>How to: Updating state on prop changes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:在属性更改时更新状态</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-updating-state-on-prop-changes-2296a03ef08c?source=collection_archive---------0-----------------------#2019-08-15">https://itnext.io/how-to-updating-state-on-prop-changes-2296a03ef08c?source=collection_archive---------0-----------------------#2019-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cca7a368949996be95dd8048a22a02a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w52loHyO9KYeEq2x"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Pierre Bamin 在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="69fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有时，复合意味着我们希望将关注点分离到可以隔离状态变化的程度。但是如果我们有一个改变的道具，并且我们想在它改变的时候更新状态，那该怎么办呢？这是一个很难回答的问题。有几种方法可以做到这一点，这取决于你想做什么。在react的未来版本中，旧的方法将被淘汰。这篇文章将向你展示给状态分配道具的正确方法，并在变化时更新它们。</p><h1 id="18a1" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">旧方法(已弃用)</h1><p id="e987" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">所以我们想给状态分配道具，但是我们希望它发生在挂载和每次更新的时候。函数componentWillRecieveProps为我们做了这些，但是它正在被淘汰。这样做的原因是它不安全，你可能会遇到问题。当您在这里设置状态时，它可以在准备设置状态之前运行。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="ee6f" class="mq lf it mm b gy mr ms l mt mu">state = {<br/>  Show: false<br/>}</span><span id="ea8c" class="mq lf it mm b gy mv ms l mt mu">componentWillReceiveProps(nextProps) {<br/>const { show } = this.props<br/> if (nextProps.show !== show) {<br/>   this.setState({ show })<br/> }<br/>}</span></pre><p id="dd21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，react开发人员提出了一些替代方案。每种方法都有特定的情况。</p><h1 id="4f08" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">getDerivedStateFromProps</h1><p id="e77d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">这是componentWillReceiveProps的第一个替换。</p><p id="29b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是如何使用该功能的示例:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="effc" class="mq lf it mm b gy mr ms l mt mu">state = {<br/> Show: false<br/>}</span><span id="3bb9" class="mq lf it mm b gy mv ms l mt mu">static getDerivedStateFromProps(nextProps, prevState) {<br/> return {<br/>  show: nextProps.show,<br/> };<br/>}</span></pre><p id="6b40" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里首先要注意的是它是一个静态方法。这意味着你不能直接访问类中的任何东西。第二件要注意的事情是它返回了一个新的状态对象。更新状态的方法是返回新的状态。</p><p id="f05e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，react团队非常明确地表示，这不是你需要用于所有道具和状态变化的方法。他们说，如果你属于另一个类别，你应该使用这些其他方法之一。这些笔记直接取自<a class="ae kf" href="https://reactjs.org/docs/react-component.html#static-getderivedstatefromprops" rel="noopener ugc nofollow" target="_blank"> react文档网站</a>。</p><ul class=""><li id="6242" class="mw mx it ki b kj kk kn ko kr my kv mz kz na ld nb nc nd ne bi translated">如果您需要<strong class="ki iu">执行副作用</strong>(例如，数据获取或动画)来响应道具的更改，请使用<a class="ae kf" href="https://reactjs.org/docs/react-component.html#componentdidupdate" rel="noopener ugc nofollow" target="_blank"> componentDidUpdate </a>生命周期。</li><li id="e9b2" class="mw mx it ki b kj nf kn ng kr nh kv ni kz nj ld nb nc nd ne bi translated">如果您希望<strong class="ki iu">仅在属性改变</strong>时重新计算一些数据，那么<a class="ae kf" href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization" rel="noopener ugc nofollow" target="_blank">使用记忆助手代替</a>。</li><li id="1806" class="mw mx it ki b kj nf kn ng kr nh kv ni kz nj ld nb nc nd ne bi translated">如果你想在道具改变时“重置”某个状态，可以考虑用一个键完全控制一个组件(T2或T4)。</li></ul><p id="09bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我写这篇文章时，我希望重新获取数据作为prop变化的副作用。这是我最后做的。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="3c5a" class="mq lf it mm b gy mr ms l mt mu">componentDidUpdate(nextProps) {<br/> const { show } = this.props<br/> if (nextProps.show !== show) {<br/>  if (show) {<br/>   getMoreData().then(resp =&gt; this.setState({ data: resp.data }))<br/>  }<br/> }<br/>}</span></pre><p id="7b1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里重要的事情是检查以确保你是在你想更新的时候更新，而不是每次更新的时候。</p><h1 id="3e2e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="be9b" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">设置属性更改的状态可能很棘手。但是如果你遵循react团队设定的模式，它将为你节省大量的时间和技巧。祝你好运！</p><p id="2be7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">编码快乐！！</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="914b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="nr"> Avery Duffin </em> </strong> <em class="nr">是</em> <a class="ae kf" href="https://www.developerswholunch.com" rel="noopener ugc nofollow" target="_blank"> <em class="nr">【开发者午餐】</em> </a> <em class="nr">的所有者和创始人，这是一个播客和博客，旨在帮助那些学习编程并寻求在软件开发领域建立职业生涯的人。他目前在万事达卡公司</em>  <em class="nr">担任软件工程师，住在美国犹他州。你可以在</em><a class="ae kf" href="https://twitter.com/DuffinAvery" rel="noopener ugc nofollow" target="_blank"><em class="nr">Twitter</em></a><em class="nr">和</em><a class="ae kf" href="https://www.linkedin.com/in/avery-duffin-69317228/" rel="noopener ugc nofollow" target="_blank"><em class="nr">linkedIn</em></a><em class="nr">上和他联系。</em></p></div></div>    
</body>
</html>