<html>
<head>
<title>Setup a Static Website on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS上建立一个静态网站</h1>
<blockquote>原文：<a href="https://itnext.io/setup-a-static-website-on-aws-5a87fdf92347?source=collection_archive---------3-----------------------#2021-08-29">https://itnext.io/setup-a-static-website-on-aws-5a87fdf92347?source=collection_archive---------3-----------------------#2021-08-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="25ec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在AWS上建立静态网站的分步指南</h2></div><p id="fe5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果设置正确，AWS上的静态网站可以快得令人难以置信。让我们来看一下每个步骤，并解释在AWS上建立一个静态站点需要哪些服务。</p><p id="0321" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这可能是一个Gatsby网站或任何其他你想托管的静态HTML/CSS网站。虽然是可选的，但我们将假设您在Git中有可用的应用程序，以及用于构建/部署的工具。在我们的例子中，我们将展示如何使用GitLab进行设置。</p><h1 id="ac9b" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">所需服务</h1><p id="bf01" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">AWS提供了大量的服务，让我们解释一下您需要哪些服务，以及为什么需要。</p><h2 id="1f51" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">AWS简单存储服务/ S3</h2><p id="2ab6" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">亚马逊的S3是一个存储所有网站文件的地方。可以把它想象成一个高性能的驱动器或FTP。每当用户访问您的网站，网站文件可以从S3检索。</p><h2 id="d29a" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">AWS云锋</h2><p id="15e0" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">CloudFront是一个CDN，内容交付网络，它由遍布世界各地的服务器或边缘位置组成。所有这些边缘位置都会在本地缓存您的网站。每当世界另一端的用户访问您的网站时，它仍然会很快，因为网站文件可以从边缘位置缓存中获取，而不是S3。</p><p id="7fa6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这确保了从世界任何地方快速连接到您的静态网站。您可以在下面的地图上看到AWS的可用边缘位置。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mn"><img src="../Images/3aef3b5c0df2a5447381459e404d1bf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MGUf-c8s4bN0LNf_.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">AWS边缘位置(2021年)，来自<a class="ae nd" href="https://aws.amazon.com/blogs/aws/98-99-100-cloudfront-points-of-presence/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/blogs/AWS/98-99-100-cloudfront-points-of-presence/</a></figcaption></figure><p id="31ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，让用户从CloudFront检索网页比从S3检索要便宜，所以这绝对是一个双赢的局面。每次更新网站时，你都必须支付一定的费用，但除非你的网站每小时都在变化，否则这笔费用不会很多。</p><p id="fae3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，对于网站的每一次更改，您都需要使CloudFront中的缓存失效，这需要很小的代价。</p><h2 id="6e91" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">AWS路线53</h2><p id="6768" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">Route 53是亚马逊的域名和DNS服务。尽管是可选的，你可以通过Route 53购买你想要的域名。如果您已经在首选注册商处拥有域名，您不必将其转移到AWS，您可以继续使用您首选的域名注册商。</p><p id="3663" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">路由53的另一项服务是DNS管理，因此称为53，因为DNS在端口53上运行。通过将您域的DNS指向AWS，您将能够通过AWS管理DNS记录。虽然这是要收费的，但在撰写本文时，每个托管区域每月收费0.5美元，我强烈推荐它。Route 53提供了与其他可用AWS服务的高度集成。</p><p id="e2c2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将能够通过AWS非常容易地设置您的DNS记录来指向CloudFront。</p><h1 id="cba5" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">在AWS上建立静态网站</h1><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ne"><img src="../Images/22781faad012230c4341dab1bd2a3a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTHCvnrNEzJacDYQ4JnlhQ.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">AWS上静态网站的设置</figcaption></figure><h2 id="dd00" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第一步。创建S3存储桶</h2><p id="b873" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在AWS中创建一个S3桶，将所有设置保留为默认设置。</p><p id="f2bf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">转到您的桶的属性，并启用静态网站托管。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nf"><img src="../Images/d12182824941d84e20009fd9783e6d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxLv0UKAfiM6js9mWR_vTw.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">在您的S3桶上启用静态网站托管</figcaption></figure><h2 id="2eaf" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第二步。在53路设置一个域名</h2><p id="1ceb" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在AWS中为您的域名创建一个新的托管区域。如果您已经在Route53中设置了一个，此时不需要任何操作。</p><h2 id="7835" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第三步。在S3桶前面添加CloudFront</h2><p id="a566" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在AWS管理控制台中创建一个CloudFront发行版。作为原点，选择S3网站的网址。应该和yourbucket.s3-website-eu-west-1.amazonaws.com差不多。作为域别名，输入您的域名。您需要使用ACM创建一个Amazon证书，按照屏幕上显示的步骤进行操作。其余部分可以保留为默认值。</p><h2 id="3f2b" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第四步。设置从Route53到CloudFront的DNS链接</h2><p id="531d" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">我们需要将您的域名指向我们刚刚制作的CloudFront发行版。为此，请进入53号公路上您的托管区域。使用CloudFront发行版的别名创建一个A记录，如下面的示例屏幕截图所示。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ng"><img src="../Images/98d81efa873f8691fd5f965adb45233d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58jcoNQK9O-ftRqAI67dJg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk translated">创建到CloudFront的DNS记录</figcaption></figure><h2 id="c675" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第五步。设置WWW重定向</h2><p id="884d" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">要让WWW重定向到非WWW网站，我们需要创建另一个S3桶。创建一个名为<a class="ae nd" href="http://www.yourwebsite.com." rel="noopener ugc nofollow" target="_blank">www.yourwebsite.com的S3桶。</a>同样，将其配置为静态网站，但带有重定向，参见下面的配置示例。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nh"><img src="../Images/ad0b42e46b75b27d298b3048c435e18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-0IE1fcxiw7MKX4OVlNAQ.png"/></div></div></figure><p id="0bb6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">之后，您必须在Route 53中为您的托管区域www域创建一个新的DNS A记录。您将把www域指向这个新创建的www S3存储桶。例如，参见下面的截图。</p><figure class="mo mp mq mr gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi ni"><img src="../Images/d09076d29d086ab88abd5e68a9e90384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAB-eev-3U3Zdzeed3yRkg.png"/></div></div></figure></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><h1 id="9c4d" class="le lf it bd lg lh nq lj lk ll nr ln lo jz ns ka lq kc nt kd ls kf nu kg lu lv bi translated">为您的静态网站设置CI/CD</h1><p id="fa61" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">如果您正在使用静态框架(如Gatsby)开发您的网站，您可以为它设置自动CI/CD！这样，每次您提交更改时，它都可以自动部署到您的域中！我们需要为此采取多种行动。</p><ol class=""><li id="4402" class="nv nw it kk b kl km ko kp kr nx kv ny kz nz ld oa ob oc od bi translated">现有的构建策略</li><li id="f8aa" class="nv nw it kk b kl oe ko of kr og kv oh kz oi ld oa ob oc od bi translated">将网站文件上传到S3</li><li id="12f9" class="nv nw it kk b kl oe ko of kr og kv oh kz oi ld oa ob oc od bi translated">CloudFront中缓存的失效</li></ol><p id="7e17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要做到这一点，您需要有一个Amazon用户，该用户拥有链接到您的部署工具(可以是Github、BitBucket、Gitlab或其他工具)的正确访问权限。</p><h2 id="7d0e" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第一步。创建IAM策略</h2><p id="6480" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">首先，创建一个如下所示的策略，具有在CloudFront上创建缓存失效的正确权限，以便能够在部署后显示网站的新版本。称之为my website-cloudfront-invalidate</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="oj ok l"/></div></figure><p id="60b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">其次，创建另一个策略，以便能够从CI/CD工具向S3存储桶上传和同步文件。称之为我的网站-S3-完全权利。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h2 id="be84" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第二步。创建IAM用户组和用户</h2><p id="4d58" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">接下来，创建一个用户组，例如mywebsite-cicd。授予用户组访问我们刚刚创建的上述两个策略的权限。</p><p id="7f38" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后创建一个新的IAM编程用户，只有编程访问权限，这意味着您将获得一个AWS访问密钥和密钥来访问AWS。这些可用于授予对您的CI/CD工具的访问权限。请确保在创建后妥善保管密钥，因为您将无法再看到它们。在我们刚刚创建的用户组中创建该用户。</p><h2 id="dd71" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第三步。在CI/CD工具上设置AWS密钥</h2><p id="78c6" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在您选择的CI/CD工具中，添加AWS_ACCESS_KEY_ID和AWS_SECRET_KEY环境变量，以及先前生成的值。</p><h2 id="7c69" class="mb lf it bd lg mc md dn lk me mf dp lo kr mg mh lq kv mi mj ls kz mk ml lu mm bi translated">第四步。创建部署脚本</h2><p id="b5a7" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">我们将展示一个Gitlab的示例部署脚本，但是不同的CI/CD工具制作脚本的方式是不同的。</p><p id="34cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于GitLab，我们需要创建一个<code class="fe ol om on oo b">gitlab-ci.yaml</code>文件。您可以在下面找到我们使用的这样一个示例脚本，并根据您的需要进行调整。请注意，这个脚本在S3上传中使用了<code class="fe ol om on oo b">--delete</code>标志，这意味着构建中不存在的任何文件都将被删除，以避免保留我们不再需要的旧文件。</p><p id="7c89" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的脚本还构建了一个典型的Gatsby安装，如果您正在使用任何其他技术，请将构建过程替换为您所需的技术堆栈。</p><figure class="mo mp mq mr gt ms"><div class="bz fp l di"><div class="oj ok l"/></div></figure><h1 id="dc7e" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">摘要</h1><p id="4b35" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在用CI/CD工具以及S3和CloudFront建立了你的静态网站之后，不管用户在哪里，你都将得到一个非常可靠的高性能的设置。这种设置所需的维护量也很少。CI/CD工具设置非常好，因为您不需要在AWS中手动更新任何东西，CI/CD工具会自动执行所有手动操作，并且随着您使用它的次数增加，会节省您的时间。</p><p id="4eeb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关注我，获取更多关于AWS的文章和分步指南。</p></div><div class="ab cl nj nk hx nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="im in io ip iq"><p id="4900" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae nd" href="https://kevinvr.medium.com/membership" rel="noopener">订阅我的媒介</a>到<strong class="kk iu">解锁</strong> <strong class="kk iu">所有</strong> <strong class="kk iu">文章</strong>。通过使用我的链接订阅，你是支持我的工作，没有额外的费用。你会得到我永远的感激。</p></div></div>    
</body>
</html>