<html>
<head>
<title>Puppeteer or: How I Learned to Stop Worrying and Love the Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">木偶师或:我如何学会不再担心并爱上自动化</h1>
<blockquote>原文：<a href="https://itnext.io/puppeteer-or-how-i-learned-to-stop-worrying-and-love-the-automation-92e96f4901e7?source=collection_archive---------2-----------------------#2020-03-27">https://itnext.io/puppeteer-or-how-i-learned-to-stop-worrying-and-love-the-automation-92e96f4901e7?source=collection_archive---------2-----------------------#2020-03-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5aa2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">木偶戏初学者入门指南</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/ea9bce466bac2cb577a993ab196eabc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*Dji8U2Um4_1bRbveuRDPfQ.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">如果你一直手动操作，木偶师就失去了意义！</figcaption></figure><h2 id="89dc" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">什么是木偶师？</h2><blockquote class="lt lu lv"><p id="f2ff" class="jq jr lw js b jt ju jv jw jx jy jz ka lx kc kd ke ly kg kh ki lz kk kl km kn im bi translated">Puppeteer是一个节点库，它提供了一个高级API来通过<a class="ae ma" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank"> DevTools协议</a>控制Chrome或Chrome。默认情况下，木偶师运行无头的<a class="ae ma" href="https://developers.google.com/web/updates/2017/04/headless-chrome" rel="noopener ugc nofollow" target="_blank">，但可以配置为运行全(无头)铬或铬。https://github.com/puppeteer/puppeteer<br/>——</a><a class="ae ma" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="e3f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用Puppeteer，自动执行您偶尔在web浏览器中执行的日常工作。在Puppeteer中，你可以控制浏览器中的一切，从简单的导航到使用<a class="ae ma" href="https://developers.google.com/web/tools/lighthouse" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>来审核你的网站。</p><p id="052b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在开始之前，先看看下面的木偶脚本示例:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/741b750fe6e9da5f8dac6130997a0acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0SiCeJouEbu5rZ6Dv35GfA.gif"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated"><a class="ae ma" href="https://github.com/0x414c49/memrise-upload" rel="noopener ugc nofollow" target="_blank">使用木偶师</a>导入带音频的闪存卡</figcaption></figure><p id="e014" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我正在上一门有很多单词和对话的荷兰语课程。制作一张抽认卡并手动输入大量的单词和声音并不是一件容易的事情。现在，再一次看看自动化脚本完成工作的速度，比零失败几率的人类更快。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="3a6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">编写木偶剧本很简单，你只需要知道一些基本规则。</p><h2 id="0429" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则一</h2><p id="1937" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">木偶戏中的所有方法都是<a class="ae ma" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank">异步的</a>，不要忘记等待它们。</p><h2 id="1b1d" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则二</h2><p id="205a" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">在脚本中，在大多数情况下，你应该让木偶师等待一些东西，比如请求、响应、元素或片刻。</p><h2 id="64aa" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则三</h2><p id="53be" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">理性写剧本。假设你想写一个脚本来搜索某个东西。你是怎么做到的？</p><ol class=""><li id="0ee0" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn mx my mz na bi translated">你打开一个新标签</li><li id="7d37" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">你导航到Google.com</li><li id="7936" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">你关注搜索框</li><li id="1243" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">你输入一些东西</li><li id="b066" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn mx my mz na bi translated">你点击搜索按钮</li></ol><p id="649a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">木偶师有多个API用于页面，键盘，鼠标。以上步骤很容易在木偶戏中模仿。</p><h2 id="f7c5" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则四</h2><p id="99f2" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">您不能单击不可见的元素！想象一个有一些项目的菜单。首先，你需要打开列表；然后，您可以点击子项目。</p><h2 id="6fa9" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则五</h2><p id="0556" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">有些网页有自己的代码或事件(如jQuery事件)。你需要评估一些JS来使它们工作。</p><h2 id="c46c" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则六</h2><p id="3aef" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">如果你不熟悉<a class="ae ma" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors" rel="noopener ugc nofollow" target="_blank"> CSS选择器，</a>请去学习一下。</p><h2 id="98ac" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">规则7</h2><p id="895b" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">当你导航到像<a class="ae ma" href="https://example.com/users" rel="noopener ugc nofollow" target="_blank">https://example.com/users</a>/这样的页面时，不要忘了尾部<code class="fe ng nh ni nj b">/</code>。</p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="af12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们讨论了初学者的规则，现在让我们做点真正的事情。</p><h2 id="6362" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">预热</h2><ul class=""><li id="5f0c" class="ms mt it js b jt mn jx mo kb nk kf nl kj nm kn nn my mz na bi translated">安装<a class="ae ma" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a> 10.x或更高版本</li><li id="d849" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn nn my mz na bi translated">安装<a class="ae ma" href="https://classic.yarnpkg.com/en/docs/install" rel="noopener ugc nofollow" target="_blank">纱线卷装管理器</a></li></ul><p id="054d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在终端中，执行以下命令:</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="c724" class="la lb it nj b gy ns nt l nu nv">mkdir hello_puppeteer<br/>cd hello_puppeteer<br/>yarn init</span><span id="725c" class="la lb it nj b gy nw nt l nu nv">yarn add puppeteer</span></pre><p id="0270" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一个命令需要一段时间；它会在所有依赖项旁边安装木偶师(比如<a class="ae ma" href="https://www.chromium.org/" rel="noopener ugc nofollow" target="_blank"> Chromium </a>)。</p><p id="b77b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个新的<code class="fe ng nh ni nj b">js</code>文件，并将其命名为<code class="fe ng nh ni nj b">google.js</code>，然后用以下代码填充它:</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="32af" class="la lb it nj b gy ns nt l nu nv">const puppeteer = require("puppeteer");</span><span id="d8c3" class="la lb it nj b gy nw nt l nu nv">(async () =&gt; {<br/>  // lanuch the browser<br/>  const browser = await puppeteer.launch({<br/>    headless: false,<br/>    // devtools: false,<br/>    // args: ["--start-maximized"]<br/>  });</span><span id="84e1" class="la lb it nj b gy nw nt l nu nv">// create a new tab<br/>  const page = await browser.newPage();<br/>})();</span></pre><ul class=""><li id="fcb0" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated"><code class="fe ng nh ni nj b">The puppeteer.laucnh</code>启动<a class="ae ma" href="https://www.chromium.org/" rel="noopener ugc nofollow" target="_blank"> Chromium </a>浏览器的一个新实例。如果你看代码，你会发现我写了<code class="fe ng nh ni nj b">headless: false</code>。我想看看引擎盖下发生了什么。</li><li id="9871" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn nn my mz na bi translated"><code class="fe ng nh ni nj b">The browser.newPage</code>在浏览器中创建一个新标签。</li><li id="3c2c" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn nn my mz na bi translated">我将整个代码包装在一个异步函数中，因为所有的木偶师方法都是<code class="fe ng nh ni nj b">async</code>。</li></ul><p id="e62f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以在终端内通过<code class="fe ng nh ni nj b">node google.js</code>运行该脚本，您应该会看到:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nx"><img src="../Images/83704f147c5dd777192b4aa479f80009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPxGG6KTjk9P4tREtml_YA.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">脚本的结果</figcaption></figure><p id="3389" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们想导航到Google.com。为此，在<code class="fe ng nh ni nj b">const page = ...</code>行旁边添加以下代码。</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="72de" class="la lb it nj b gy ns nt l nu nv">// navigates to google.com</span><span id="ec62" class="la lb it nj b gy nw nt l nu nv">await page.goto('https://google.com');</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ny"><img src="../Images/e46d18eee02d9455b43a992293587ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFyuyaquiB--OTXRsYXaUQ.png"/></div></div></figure><p id="a3ba" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们想搜索一些关于Google.com的东西。首先，用Web Developer工具检查搜索输入(右键单击搜索输入，然后单击inspect element)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nz"><img src="../Images/26f4f7ab135c6412d65fd4fe55036166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nOj8fU_YEHw76RLNH8Ey6g.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">检查Web开发人员工具中的元素</figcaption></figure><p id="8b51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您需要为元素找到一个静态CSS选择器，以便在Puppeteer中使用它们。这个输入元素有几个属性，但是我选择了两个:</p><ul class=""><li id="3809" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated">同学们:不幸的是，它是动态的，我们不能依赖它</li><li id="95a8" class="ms mt it js b jt nb jx nc kb nd kf ne kj nf kn nn my mz na bi translated">name:<code class="fe ng nh ni nj b">name</code>属性的值在整个页面上是唯一的。是合适的人选！</li></ul><p id="f51d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">尝试使用web developer tools-console选项卡中的CSS选择器。使用<strong class="js iu"> document.querySelector </strong>或<strong class="js iu">document . query selector all</strong>可以测试它们。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/5d1d9895ae6a1f262ef6d93d66d14ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*mBCMn1Kfy1EScLH9QWYbpg.png"/></div></figure><p id="2ca0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我的CSS选择器是<code class="fe ng nh ni nj b">input[name=q]</code>，它工作得很好。现在该打东西了。</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="fb61" class="la lb it nj b gy ns nt l nu nv">await page.focus('input[name=q]');</span><span id="4842" class="la lb it nj b gy nw nt l nu nv">/* or you can: first find the element, then focus it<br/>  <br/>  const searchInput = await page.$('input[name=q]');<br/>  await searchInput.focus();<br/>*/</span></pre><p id="941f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">💡<em class="lw">在页面API中，</em> <code class="fe ng nh ni nj b"><em class="lw">$</em></code> <em class="lw">等于</em><code class="fe ng nh ni nj b"><em class="lw">documnet.querySelector</em></code><em class="lw"/><code class="fe ng nh ni nj b"><em class="lw">$$</em></code><em class="lw">等于</em> <code class="fe ng nh ni nj b"><em class="lw">document.querySelectorAll</em></code> <em class="lw">。</em></p><p id="b484" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了让Puppeeter在输入中输入，我们需要关注它。有两个API可以做到这一点。它们的结果是一样的，但是这取决于你使用什么API。</p><p id="15ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe ng nh ni nj b">keyboard</code> API在网页内输入很容易。</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="b4b2" class="la lb it nj b gy ns nt l nu nv">await page.keyboard.type('Puppeteer');</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ob"><img src="../Images/5c395fb2b5877f25f81f83577a6d488b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BgunokYV4e7OOuq9uJ4dgA.gif"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk translated">行动中的类型</figcaption></figure><p id="2813" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如何获得搜索结果？</p><p id="078b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">人们通常按回车或点击谷歌搜索按钮。要模仿它们，您可以:</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="b319" class="la lb it nj b gy ns nt l nu nv">// press the keyboard Enter button<br/>  await page.keyboard.press("Enter");</span><span id="97bf" class="la lb it nj b gy nw nt l nu nv">// or you can first, focus on search button, then click it<br/>// const searchButton = await page.$('input[name=btnK]');<br/>// await searchButton.click();</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi oc"><img src="../Images/0e9ec173b731e6b04f0cc880e9310e9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sdVdoclwXpW3-Sn5dC5_2g.png"/></div></div></figure><p id="6b39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们学了基础知识，但是你还需要知道更多的东西。</p><h2 id="36ba" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">让木偶师等些东西</h2><p id="7744" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">考虑这些场景:</p><ul class=""><li id="063c" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated">点击按钮后的Ajax请求</li></ul><p id="db1c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ma" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" rel="noopener ugc nofollow" target="_blank">文件输入</a>上传文件示例:</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="9c85" class="la lb it nj b gy ns nt l nu nv">const fileInput= await page.$('input[type=file]');<br/>const uploadButton = await page.$('#upload-btn');</span><span id="1bba" class="la lb it nj b gy nw nt l nu nv">await fileInput.uploadFile("d:/image.jpg");<br/>await uploadButton.click();</span><span id="65d5" class="la lb it nj b gy nw nt l nu nv">// now wait for upload response<br/>await page.waitForResponse('https://example.com/services/upload/');</span><span id="1dd5" class="la lb it nj b gy nw nt l nu nv">// find dynamic generated link after ajax upload<br/>const fileUrlElement = await page.$('a.file-url');</span></pre><ul class=""><li id="3c62" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated">等待几秒钟</li></ul><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="4971" class="la lb it nj b gy ns nt l nu nv">await page.waitFor(1000); // in mili seconds</span></pre><ul class=""><li id="b69a" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated">等待页面导航</li></ul><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="e6ea" class="la lb it nj b gy ns nt l nu nv">await page.waitForNavigation();</span></pre><ul class=""><li id="a196" class="ms mt it js b jt ju jx jy kb mu kf mv kj mw kn nn my mz na bi translated">等待呈现特定的CSS选择器</li></ul><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="5ebc" class="la lb it nj b gy ns nt l nu nv">await page.waitForSelector('css selector');</span></pre><h2 id="5155" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">在浏览器中评估脚本</h2><p id="c5ed" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">我遇到过这样一种情况，用<strong class="js iu"> uploadFile </strong>方法上传文件后，页面不会执行Ajax上传过程。对于这个场景，我需要生成一个jQuery代码来完成这项工作。</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="6034" class="la lb it nj b gy ns nt l nu nv">const input = await page.$('input[type=file]');<br/>await input.uploadFile(fileToUpload);</span><span id="b3bb" class="la lb it nj b gy nw nt l nu nv">await page.evaluate(<br/> element =&gt; $(element).trigger("custom_event"),<br/> input<br/>);</span></pre><p id="1d7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这个例子中，<code class="fe ng nh ni nj b">$(element).trigger("...")</code>是JS代码，它将在浏览器内部执行(而不是在木偶脚本内部)。</p><h2 id="a706" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">你还能做什么？</h2><p id="1800" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">在第一个例子中，我使用了<code class="fe ng nh ni nj b">headless: false</code>来看看在引擎盖下发生了什么。通常情况下，在无头模式下使用会更好，因为它在后台运行脚本和浏览器，不会用任何打开的窗口打断你。</p><p id="7673" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是如果你用headless模式运行它，你怎么能看到结果呢？截图怎么样！</p><pre class="kp kq kr ks gt no nj np nq aw nr bi"><span id="1648" class="la lb it nj b gy ns nt l nu nv">await page.screenshot({path: 'my-result.png', fullPage: true})</span></pre></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="6851" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一开始，我演示了一个运行我最近制作的“导入脚本”的gif。请在https://github.com/0x414c49/memrise-upload<a class="ae ma" href="https://github.com/0x414c49/memrise-upload" rel="noopener ugc nofollow" target="_blank">找到代码</a></p></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><h2 id="4887" class="la lb it bd lc ld le dn lf lg lh dp li kb lj lk ll kf lm ln lo kj lp lq lr ls bi translated">更多演示</h2><p id="9ca7" class="pw-post-body-paragraph jq jr it js b jt mn jv jw jx mo jz ka kb mp kd ke kf mq kh ki kj mr kl km kn im bi translated">如果你想了解更多关于木偶师的能力，我推荐你去看看我的同事<a class="od oe ep" href="https://medium.com/u/9093637f275f?source=post_page-----92e96f4901e7--------------------------------" rel="noopener" target="_blank">恩德·塞伊兰</a>的<a class="ae ma" href="https://github.com/onderceylan/puppeteer-demos" rel="noopener ugc nofollow" target="_blank">木偶师演示库</a>。甚至他很酷的<a class="ae ma" href="https://github.com/onderceylan/pwa-asset-generator" rel="noopener ugc nofollow" target="_blank"> pwa资产生成器</a>也是用木偶师创造的。</p></div></div>    
</body>
</html>