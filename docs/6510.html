<html>
<head>
<title>Keep it simple K8s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保持简单K8s</h1>
<blockquote>原文：<a href="https://itnext.io/keep-it-simple-k8s-c0c68c46eabb?source=collection_archive---------1-----------------------#2021-12-06">https://itnext.io/keep-it-simple-k8s-c0c68c46eabb?source=collection_archive---------1-----------------------#2021-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/0e035dd5db7f4e6de2127ae72e202efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjI3anrbRK1ZsSfTYjcfaw.png"/></div></div></figure><div class=""/><p id="ed6f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Jabos的Kubernetes GitOps</p><h1 id="c5f6" class="kw kx jb bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="c00d" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">您是否只需要在提交时将K8s代码自动部署到集群中，而不想读取所有代码？</p><p id="d61d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae lz" href="https://www.youtube.com/watch?v=616aMiKHtks&amp;list=PLyUsGHNHHAYx728GNeU3wFvfRJBjn3XVt&amp;index=1" rel="noopener ugc nofollow" target="_blank">参见演示</a></p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="b62f" class="kw kx jb bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">但是为什么呢？</h1><p id="c0d3" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Kubernetes和GitOps似乎是这些天的流行语，理论上它们听起来很棒——这就是为什么我认为“这对我们团队来说很棒！”</p><p id="e4c3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，当我开始研究它时，我发现实现它需要大量的努力和对超出团队范围的概念的理解，更糟糕的是，它需要基金会团队的批准和工作，而基金会团队总是捉襟见肘。像<a class="ae lz" href="https://spinnaker.io/" rel="noopener ugc nofollow" target="_blank"> Spinnaker </a>和<a class="ae lz" href="https://argo-cd.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> ArgoCD </a>这样的系统可能非常好，但是它们也需要很大的努力才能开始使用，并且可能会迫使你使用特定的工具/框架。</p><p id="7d4c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们最终利用现有的公司资源构建了自己的CI/CD管道，在一定程度上模仿了GitOps。这种方法效果很好，但不够稳健。</p><p id="9611" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是为什么我决定理解为什么从Git repo自动构建和部署代码到K8s集群会如此复杂，Jabos就是这样开始的。</p><p id="3185" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我真正需要的是一个工具，它可以安装在我的K8s集群中，访问我的Git存储库来获取代码，从代码中构建映像，最后将使用这些映像的新清单部署到我的K8s集群中。</p><p id="1675" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，我只想确保我的集群状态总是尽可能接近特定分支中的最新git提交，而无需用户的任何干预。</p><p id="cd97" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不需要验证和授权用户，因为我希望整个过程是自动化的(没有用户干预)，这也意味着我不需要任何GUI界面，事实上根本不需要界面。</p><p id="9e11" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不需要任何关于入口的安全措施，因为唯一的交互是向外连接到我的Git库。</p><p id="16af" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我不需要任何结构来控制部署，因为除了可以安装的任何其他扩展之外，我很乐意使用K8s允许的任何东西。</p><p id="0ebc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是为什么Jabos只会为你处理三件简单的事情:</p><ol class=""><li id="9aeb" class="mm mn jb ka b kb kc kf kg kj mo kn mp kr mq kv mr ms mt mu bi translated">任何新的提交都会自动从Git中获得</li><li id="601a" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Docker图像将从新提交中构建并自动推送</li><li id="f4d3" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">新的清单版本将自动部署</li></ol></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="c731" class="kw kx jb bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">但是怎么做呢？</h1><p id="0f6e" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">要使用Jabos，你只需要三样东西，如果你使用K8s，你可能已经有了:</p><ol class=""><li id="492b" class="mm mn jb ka b kb kc kf kg kj mo kn mp kr mq kv mr ms mt mu bi translated">对K8s集群的访问</li><li id="7a8b" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Jabos和任何其他存储库部署的名称空间</li><li id="71f4" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">Dockerfiles存储任何Git存储库</li><li id="8490" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated">清单文件存储在任何Git存储库中</li></ol><p id="363d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">无需配置网络、证书或访问控制列表，无需任何特权运行者、外部可见的端点或任何集群入口。</p><p id="4fc6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过部署一个可以从GitHub下载的yaml文件，Jabos将被安装到您的集群中。</p><p id="44c7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装之后，您需要告诉Jabos哪些映像和哪些清单需要部署到集群中，当然还要告诉他们应该从哪个Git存储库中取出。</p><p id="5deb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，Jabos将开始轮询最新的提交、拉取更改、构建和部署—所有这一切都无需任何人工干预。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="db5e" class="kw kx jb bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">关于内部的一些情况…</h1><p id="e278" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Jabos使用K8s名称空间来隔离不同的环境，并提供多租户。</p><p id="f4e5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jabos不会暴露任何外部端点来降低安全风险。</p><p id="b843" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jabos不提供任何部署策略——它只是使用“kubectl apply”来部署您的清单。因此，可以使用任何可用的策略或扩展的K8s APIs。</p><p id="7032" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jabos支持从公共存储库克隆Git，也支持对私有存储库使用SSH。这允许从GitHub、GitLab和任何托管的私有安全Git库进行克隆。</p><p id="2f0d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jabos支持多种格式的清单:Yaml/Json(纯文本)，<a class="ae lz" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm </a>模板，<a class="ae lz" href="https://kustomize.io/" rel="noopener ugc nofollow" target="_blank"> Kustomize </a>模板和<a class="ae lz" href="https://jsonnet.org/" rel="noopener ugc nofollow" target="_blank"> Jsonnet </a>模板。</p><p id="3cb3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Jabos使用<a class="ae lz" href="https://github.com/GoogleContainerTools/kaniko" rel="noopener ugc nofollow" target="_blank"> Kaniko项目</a>来构建和推送映像，并允许将映像推送至不安全注册中心以及安全注册中心、任何托管注册中心以及Docker Hub(公共和私有)、AWS (ECR)和GCP (GCR和工件注册中心)。</p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="f4b7" class="kw kx jb bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">更多信息</h1><p id="99e3" class="pw-post-body-paragraph jy jz jb ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">你可以在这里找到关于如何设置和使用<a class="ae lz" href="https://github.com/srfrnk/jabos" rel="noopener ugc nofollow" target="_blank">的文档。</a></p><p id="680b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">API文档可以在<a class="ae lz" href="https://srfrnk.github.io/jabos/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="4933" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">演示视频可以在这里找到:</p><ol class=""><li id="25ef" class="mm mn jb ka b kb kc kf kg kj mo kn mp kr mq kv mr ms mt mu bi translated"><a class="ae lz" href="https://youtu.be/616aMiKHtks" rel="noopener ugc nofollow" target="_blank"> Minikube设置</a></li><li id="7f00" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated"><a class="ae lz" href="https://youtu.be/Ex5hi3GOkjg" rel="noopener ugc nofollow" target="_blank">jabo和先决条件</a></li><li id="cd9d" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated"><a class="ae lz" href="https://youtu.be/PqMUliEHx60" rel="noopener ugc nofollow" target="_blank">配置CRDs </a></li><li id="5f21" class="mm mn jb ka b kb mv kf mw kj mx kn my kr mz kv mr ms mt mu bi translated"><a class="ae lz" href="https://youtu.be/OlB6qybsqng" rel="noopener ugc nofollow" target="_blank">推送变更并触发构建</a></li></ol></div></div>    
</body>
</html>