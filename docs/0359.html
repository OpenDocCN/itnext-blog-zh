<html>
<head>
<title>Google Kubernetes Engine + Google Cloud Builder + GitHub for easy and quick CD pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Google Kubernetes引擎+ Google Cloud Builder + GitHub，轻松快捷地实现CD管道</h1>
<blockquote>原文：<a href="https://itnext.io/google-kubernetes-engine-google-cloud-builder-github-for-easy-and-quick-cd-pipeline-8aca663f1118?source=collection_archive---------3-----------------------#2018-02-26">https://itnext.io/google-kubernetes-engine-google-cloud-builder-github-for-easy-and-quick-cd-pipeline-8aca663f1118?source=collection_archive---------3-----------------------#2018-02-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="5daf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我爱谷歌云平台。我爱谷歌Kubernetes引擎。我也喜欢GitHub。但我需要一个快速的CD管道，以方便自动化的应用程序部署。设置整个Jenkins CI或使用一些付费管道作为服务需要太多的时间、精力和金钱。Google Cloud Builder来了(目前是测试版)。</p><p id="bf33" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有一个简单的无状态php应用程序，运行在nginx和Docker容器中的php-fpm上，在GitHub上用git版本化。我需要的是把它快速廉价地部署到GKE。</p><p id="b6dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开构建触发器。它应该在Google控制台——工具——容器注册表——构建触发器中(但是，你知道，他们每周都会改变用户界面，所以它可能在其他地方)</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1fb4d4298ccbf19d5ef9d977216336b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bo-1i0KFZ29Eq9xLIPAqxg.png"/></div></div></figure><p id="d2fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将您的GitHub帐户与GCP联系起来</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kx"><img src="../Images/af26d56085453eaa065d7f8fa55cf0d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmnZwtU86_M2gZs5snNrwA.png"/></div></div></figure><p id="4598" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">导入您的回购</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ky"><img src="../Images/2b282408299930de9b0a98024c520f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MFb9U4JPPzUnIXbUBuVl3A.png"/></div></div></figure><p id="7dc7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置触发器</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kz"><img src="../Images/8c748a98079f8efde50f72508ee8292a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfDncVeeqnjOJJccZEhsUA.png"/></div></div></figure><p id="f860" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择cloudbuild.yaml，您可以在其中将您的<a class="ae la" href="https://cloud.google.com/container-builder/docs/create-custom-build-steps" rel="noopener ugc nofollow" target="_blank"> CI/CD管道定义为代码。</a></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lb lc l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">我知道这很难看。我需要一个快速的解决方案，而不是一个漂亮的。</figcaption></figure><p id="3ec2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我需要从不同的Docker文件构建两个Docker映像，将它们推送到Google Container Registry，模板化kubernetes部署清单，在GKE上部署它们(kubectl apply)并为外部http流量创建一个入口资源。</p><p id="cb3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我推送到repo之后，构建会自动开始</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lh"><img src="../Images/41a52482dba0783ef4616fb7718811d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9VfTOdG8TOn6YOisF9A5Ww.png"/></div></div></figure><p id="b4c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到了git提交和导致触发的动作，管道步骤，花费的时间，构建的总时间，链接到GCR的图像。并记录:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi li"><img src="../Images/d95142760f6122f9402bf535c7b2a43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3x8xjXUdtRG5TYPQIZrQg.png"/></div></div></figure><p id="27d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一切都是不可变的，我可以很容易地将部署回滚到带有git提交id的标记图像。我可以在构建历史中重新构建构建。<a class="ae la" href="https://medium.com/@marekbartik/google-kubernetes-engine-with-external-dns-on-cloudflare-provider-24beb2a6b8fc" rel="noopener">入口DNS记录自动推送到CloudFlare。</a></p><p id="da40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我必须创建自己的部署/服务/入口/任何kubernetes清单，并且必须用sed(这非常难看，语法也不总是有效)将它们模板化。Google Cloud Builder还处于测试阶段，肯定还有很多需要改进的地方。模板和GKE集成会很好(手动库应用，srsly？)来拥有。以及部署策略选择和更简单的配置？如果你正在寻找一个类似的，更成熟的服务，看看https://www.shippable.com/<a class="ae la" href="https://www.shippable.com/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="de13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查看回购来源:<a class="ae la" href="https://github.com/bartimar/gke-test" rel="noopener ugc nofollow" target="_blank">https://github.com/bartimar/gke-test</a></p><p id="0444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑:查看这个神奇的github报告，独一无二的凯尔西·海塔尔在谷歌云构建器上有很棒的教程<a class="ae la" href="https://github.com/kelseyhightower/pipeline" rel="noopener ugc nofollow" target="_blank">https://github.com/kelseyhightower/pipeline</a></p></div></div>    
</body>
</html>