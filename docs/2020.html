<html>
<head>
<title>Data Geo-Transparency with EdgeFS on Mac for Developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向开发人员的Mac版EdgeFS数据地理透明</h1>
<blockquote>原文：<a href="https://itnext.io/data-geo-transparency-with-edgefs-on-mac-for-developers-4e55d599a53f?source=collection_archive---------6-----------------------#2019-03-17">https://itnext.io/data-geo-transparency-with-edgefs-on-mac-for-developers-4e55d599a53f?source=collection_archive---------6-----------------------#2019-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e415" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在许多情况下，开发人员的工作效率实际上取决于应用程序访问生产前数据集的速度和效率。如果一个数据集在TBs里，在几百万条记录里呢？如果数据不断变化会怎样？如果网络断开，你在飞机上或者只是需要离线工作呢？</p><p id="50b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">发现EdgeFS数据图层地理透明度！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/2d5f25eb3eb0797e38a9dd1b7a41862f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQ8gK8iu56j7BGOdIrquDA.png"/></div></div></figure><p id="7ee6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">什么是EdgeFS？这是CNCF鲁克项目的一个新的存储提供商，你可以在https://rook.io/docs/rook/master/edgefs-storage.html了解更多信息。虽然它是一个横向扩展存储集群，但它仍然可以在所谓的“solo”模式下运行，这是一个单节点Docker容器，能够随着部署的增长而横向扩展，只需连接更多节点和/或地理上分散的集群段即可。</p><p id="b78f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">EdgeFS的优势在于它能够将底层基础架构虚拟化为可扩展、高度可用的地理分布式存储系统。它的工作方式类似于“git ”,其中所有的修改都是全局不可变的、完全版本化的、自我验证的、分布式的，因此是容错的。因此，它支持对对象、文件、数据块和NoSQL数据库常用存储协议的跨云和地理上透明的高性能分布式访问。</p><p id="d4f9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在Mac上配置时，它可以利用本地目录，并将其作为更大数据集的远程访问点。有了浮动快照，通过E-LRU本地缓存按需获取数据，您应该能够在您的笔记本电脑上本地设置非常棒的迷你实验室，从而极大地减少网络I/O。在我的一些实验中，我经历了高达50倍的数据读取节省。这得益于全局重复数据删除、传输中压缩和跨多个使用情形的不变性:文件、数据块、对象(S3、S3X或SWIFT)和NoSQL。</p><h1 id="dcb3" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">我们开始吧！</h1><p id="39ee" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">用例将设置对数据集的远程访问，该数据集可通过离线模式下的EdgeFS提供的接口进行访问。为简单起见，我将重点介绍使用双向ISGW(网段间网关)链接和本地透明NFS服务创建本地S3服务。</p><p id="f30a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我将使用Mac版Docker桌面，但请注意这个错误:</p><div class="me mf gp gr mg mh"><a href="https://github.com/docker/for-win/issues/426" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">负载过重后，暴露的端口变得无响应</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">Michael Friis指示我在此提交一个问题(请参阅问题30400了解更多信息),我遇到了一个间歇性问题…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ky mh"/></div></div></a></div><p id="7e89" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">看来《edge》版本已经修复了这一点。确保切换到“边缘”版本！</p><p id="742e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">但是，仍然要注意的是，在重负载的情况下，vpnkit-forwarder进程仍然可能在内存压力下死亡，因此我建议您将VM的内存增加到4GB。</p><p id="8899" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建/edgefs目录并下载docker-compose YAML文件从此要诀:<a class="ae la" href="https://gist.github.com/dyusupov/c57f6f39e964a849801e4eef6aa6be26#file-docker-compose-embedded-yml" rel="noopener ugc nofollow" target="_blank">docker-compose-embedded . yml</a>，重命名为docker-compose.yml .创建如下所示的目录结构和通过Docker桌面首选项共享的目录:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/0e80e91b01cf6bb5000d295919507877.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*ewcNZXN-nlVxg_PYb02WRg.png"/></div></figure><p id="7fed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个保存EdgeFS本地数据的目录:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="fb17" class="nc lc it my b gy nd ne l nf ng">mkdir /edgefs/data/store1</span></pre><p id="e800" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并运行配置工具:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="675f" class="nc lc it my b gy nd ne l nf ng">cd /edgefs<br/>docker-compose run --rm -e CCOW_LOG_STDOUT=1 target \<br/>    config node -n localhost -i eth0 -D /data/store1 -r 1<br/>    -o '{"MaxSizeGB":10,"RtPlevelOverride":1,"DisableVerifyChid":true,"Sync":2}'</span></pre><p id="c4b9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上面的命令将执行以下操作:</p><ul class=""><li id="133f" class="nh ni it js b jt ju jx jy kb nj kf nk kj nl kn nm nn no np bi translated">将local /data/store1目录映射到EdgeFS目标容器(-D)；</li><li id="1d15" class="nh ni it js b jt nq jx nr kb ns kf nt kj nu kn nm nn no np bi translated">支持使用高达10GB的磁盘空间(MaxSizeGB)</li><li id="bc8a" class="nh ni it js b jt nq jx nr kb ns kf nt kj nu kn nm nn no np bi translated">将目录分区限制为1(每个额外的分区分配额外的内存，所以保持在最小很重要)(RtPlevelOverride)；</li><li id="f19f" class="nh ni it js b jt nq jx nr kb ns kf nt kj nu kn nm nn no np bi translated">在将数据块写入稳定存储之前，禁用数据块的额外网络验证，以节省一些CPU周期(DisableVerifyChid)；</li><li id="86e2" class="nh ni it js b jt nq jx nr kb ns kf nt kj nu kn nm nn no np bi translated">因为我们只配置了1个分区，所以我们将默认本地站点复制设置为1(-r)；</li><li id="7e26" class="nh ni it js b jt nq jx nr kb ns kf nt kj nu kn nm nn no np bi translated">启用日志同步以在linuxkit崩溃时提供一致性(同步)。</li></ul><p id="dc35" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您想要调整建议的配置，请传递“— help”标志。</p><p id="1104" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在您对配置满意了，启动它:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="6aa3" class="nc lc it my b gy nd ne l nf ng"># docker-compose up -d<br/>Creating edgefs_target_1<br/>Creating edgefs_mgmt_1<br/>Creating edgefs_s301_1<br/>Creating edgefs_ui_1<br/>Creating edgefs_nfs01_1<br/>Creating edgefs_isgw01_1</span><span id="c30b" class="nc lc it my b gy nv ne l nf ng"># docker-compose logs -f</span></pre><h2 id="5890" class="nc lc it bd ld nw nx dn lh ny nz dp ll kb oa ob lp kf oc od lt kj oe of lx og bi translated">初始化集群段“myspace”</h2><p id="1dd3" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">状态为在线后，初始化集群并创建系统对象:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="899f" class="nc lc it my b gy nd ne l nf ng">### initialize local cluster segment<br/>efscli system init</span><span id="4667" class="nc lc it my b gy nv ne l nf ng">### initialize myspace/work/shared1<br/>efscli cluster create myspace<br/>efscli tenant create myspace/work<br/>efscli bucket create myspace/work/shared1 -s 4M -t 1</span></pre><p id="cba8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">EdgeFS使用全局唯一的系统路径，格式为名称空间/租户/存储桶/对象。在上面，我们创建了一个“myspace/work/shared”桶，默认块大小设置为4MB，启用了NFS/S3对象透明性。</p><p id="1e47" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还可以连接到GUI，并通过漂亮的UI创建/监控/管理服务，方法是将web浏览器指向<a class="ae la" href="http://10.16.100.101:3000/login" rel="noopener ugc nofollow" target="_blank"> http://IPADDR:3000 </a>，默认用户admin，默认密码是edgefs。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/3276043adfbb4548a02a1bebc6ae1be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E03AAQ7SCT0K8ym5nF8k_w.png"/></div></div></figure><p id="60df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">既然已经创建了集群名称空间段、租户和存储桶，我们就可以设置S3和ISGW服务定义了:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="fcc4" class="nc lc it my b gy nd ne l nf ng">### NFS service with myspace/work/shared1 export<br/>efscli service create nfs nfs01<br/>efscli service config nfs01 X-MH-ImmDir 1<br/>efscli service serve nfs01 myspace/work/shared1</span><span id="907b" class="nc lc it my b gy nv ne l nf ng">### S3 service servicing myspace/work tenant<br/>efscli service create s3 s301<br/>efscli service serve s301 myspace/work</span><span id="3a32" class="nc lc it my b gy nv ne l nf ng">### ISGW endpont link<br/>efscli service create isgw isgw01<br/>efscli service serve isgw01 myspace/work/shared1<br/>efscli service config isgw01 X-ISGW-Remote ccow://REMOTE_IP:14000<br/>efscli service config isgw01 X-Status enabled</span></pre><p id="1a33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要配置双向ISGW链路，您需要了解REMOTE_IP。可以配置的链路数量没有限制，这是一个完整的网状网络，因此您的本地设置可以同步地理分布的EdgeFS安装。</p><p id="f395" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，docker-compose脚本将在下一次策略重启时获取更改，服务应该可用。如果由于某种原因它没有启动，使用以下命令加速服务重启:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="e72d" class="nc lc it my b gy nd ne l nf ng">docker-compose logs -f nfs01         # monitor nfs service logs<br/>docker-compose logs -f s301          # monitor s3 service logs<br/>docker-compose logs -f isgw01        # monitor isgw01 service logs</span><span id="520a" class="nc lc it my b gy nv ne l nf ng">docker-compose restart nfs01<br/>docker-compose restart s301<br/>docker-compose restart isgw01</span></pre><h1 id="ec70" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">确认</h1><p id="f6fc" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">让我们从验证S3端点开始。最简单的当然是卷曲:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="b381" class="nc lc it my b gy nd ne l nf ng"># curl -k <a class="ae la" href="https://localhost:9443/shared1" rel="noopener ugc nofollow" target="_blank">https://localhost:9443/shared1</a><br/>&lt;?xml version="1.0"?&gt;<br/>&lt;ListBucketResult ae la" href="http://s3.amazonaws.com/doc/2006-03-01/" rel="noopener ugc nofollow" target="_blank"&gt;http://s3.amazonaws.com/doc/2006-03-01/"&gt;&lt;Name&gt;shared1&lt;/Name&gt;&lt;Prefix&gt;&lt;/Prefix&gt;&lt;Marker&gt;&lt;/Marker&gt;&lt;MaxKeys&gt;1000&lt;/MaxKeys&gt;&lt;IsTruncated&gt;false&lt;/IsTruncated&gt;&lt;/ListBucketResult&gt;</span></pre><p id="d872" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您可以将它指向您的应用程序，并开始在本地使用它。ISGW Link将以透明的方式为您处理数据集的同步。如果您的数据集只需要同步全局名称空间元数据，请在<code class="fe oi oj ok my b">isgw01</code>服务配置中设置MDOnly=true。这将实现高效的按需数据块提取，并在默认情况下将缓存的块保留24小时(可基于每个存储桶进行配置)。</p><p id="27bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们来验证NFS函数。在Mac上，没有简单的方法直接从通过Docker容器暴露的NFS服务器挂载NFS导出。有一种方法可以设置SOCKS代理，但实际上，您可能需要的是在Docker本身中向您的应用程序公开它，它会工作得非常好:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="083b" class="nc lc it my b gy nd ne l nf ng"># docker run -it --rm -d --privileged=true --link nfs01 \<br/>    --net=edgefs_default -e MOUNTPOINT=/mnt -e SERVER=nfs01 \<br/>    -e SHARE=/work/shared1 outstand/nfs-client<br/>b6b97c464e4b98899bfb575472a6aed61cb3f71cee80c3c6119be9a6f91a8043<br/># docker docker exec -it b6b ls /mnt</span></pre><h1 id="f319" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">高级用法</h1><p id="f3a0" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">地理透明，支持跨所有常用存储协议(文件、数据块、对象和NoSQL)的全局重复数据消除。它实际上是一个数据存储层，旨在跨一组分布式站点、云、内部数据中心和边缘物联网设备进行扩展。</p><p id="5f12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">继续...继续读！</p><h2 id="c2f1" class="nc lc it bd ld nw nx dn lh ny nz dp ll kb oa ob lp kf oc od lt kj oe of lx og bi translated">以有保证的一致性连接您的所有站点</h2><p id="4932" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">通过ISGW链接，您可以启用复杂的数据I/O流同步模式。一个全局名称空间可以由数百个小型和大型EdgeFS安装组成，它们连接在一起。在我的例子中，/work/shared1是我想在REMOTE_IP和这个设置之间同步的一个bucket。但是我也可以很容易地添加另一个isgw02服务，并将其连接到REMOTE_IP2等等，这样我的更改将在两个方向上进行。</p><p id="3bd9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在不需要保留复制内容的情况下，我可以选择启用仅元数据同步，即在启用E-LRU缓存语义的情况下按需获取数据块:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="042e" class="nc lc it my b gy nd ne l nf ng">efscli service config isgw01 X-ISGW-MDOnly true</span></pre><p id="aa3f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我需要跨数据集提供某种一致性，我可以使用快照一致性组:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="941a" class="nc lc it my b gy nd ne l nf ng"># docker-compose exec mgmt toolbox</span><span id="777b" class="nc lc it my b gy nv ne l nf ng">Welcome to EdgeFS Mgmt Toolbox.<br/>Hint: type neadm or efscli to begin</span><span id="3e42" class="nc lc it my b gy nv ne l nf ng">root@55fce9350b63:/opt/nedge# <strong class="my iu">efscli object</strong><br/>Objects operations, e.g. create, delete, list</span><span id="4b3c" class="nc lc it my b gy nv ne l nf ng">Usage:<br/>  efscli object [command]</span><span id="ce22" class="nc lc it my b gy nv ne l nf ng">Aliases:<br/>  object, o</span><span id="2b2b" class="nc lc it my b gy nv ne l nf ng">Available Commands:<br/>  create          create a new object<br/>  delete          delete an existing object<br/>  get             get a new object<br/>  list            list objects<br/>  put             put a new object<br/>  show            show object<br/><strong class="my iu">  snapshot-add    add a new object's snapshot to snapview<br/>  snapshot-clone  clone snapshot to object<br/>  snapshot-list   list snapshots of specified snapview object<br/>  snapshot-rm     remove snapshot from snapview<br/>  snapview-create create a new snapview section<br/>  snapview-delete delete a snapview object</strong></span></pre><p id="6f24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">快照组(如snapview)将在所有同步位置“浮动”,我无需担心我的工作状态。</p><h2 id="47e7" class="nc lc it bd ld nw nx dn lh ny nz dp ll kb oa ob lp kf oc od lt kj oe of lx og bi translated">使用EdgeFS iSCSI目标构建您的SAN设置</h2><p id="d688" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">块设备是另一个值得探索的选项。如果我需要一个iSCSI设备，很容易创建一个服务，并订阅一个iSCSI设备桶。ISGW Link将开始同步块设备的内容。</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="9554" class="nc lc it my b gy nd ne l nf ng">efscli service create iscsi isc01<br/>efscli object create myspace/work/shared1/lun1 -s 128K \<br/>    -o volsize=10g,blocksize=4096<br/>efscli service serve isc01 myspace/work/shared1/lun1</span></pre><p id="58c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，使用<code class="fe oi oj ok my b">docker-compose restart isc01</code>重新启动服务，并尝试找到您的LUN(请注意，我将isc01服务端口更改为3261，以避免与globalSAN冲突，因为它分配的是3260):</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ol"><img src="../Images/6a34ac2d611a4792156682d505d7807f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wIGAlNsiyyVcQGx5xbm_Ig.png"/></div></div></figure><p id="43e4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">EdgeFS iSCSI LUN实际上只是对象，可通过NFS、S3、S3X或SWIFT接口访问:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="d86f" class="nc lc it my b gy nd ne l nf ng">curl -i http://localhost:9982/shared1/lun1<br/>HTTP/1.1 200 OK<br/>X-Powered-By: Express<br/>x-amz-id-2: 90fc4c79c9b21ba4<br/>x-amz-request-id: e9e301fcdfebb694<br/>Content-Length: 0<br/>Last-Modified: Sat, 16 Mar 2019 16:41:44 GMT<br/>Accept-Ranges: bytes<br/><strong class="my iu">X-volsize: 10737418240</strong><br/><strong class="my iu">X-blocksize: 4096</strong><br/>ETag: "BED78C44556C9B268C85B3DC1C2E12979CF264F81C06517A705E5137C531FBD70000000000000000000000000000000000000000000000000000000000000000"<br/>Date: Sun, 17 Mar 2019 21:02:52 GMT<br/>Connection: keep-alive</span></pre><h2 id="52e2" class="nc lc it bd ld nw nx dn lh ny nz dp ll kb oa ob lp kf oc od lt kj oe of lx og bi translated">NoSQL数据库森林</h2><p id="bfb3" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">最后，最有趣的选择是探索NoSQL风格的数据库。有一个S3X扩展API可以直接用于应用程序:</p><div class="me mf gp gr mg mh"><a href="https://edgex.docs.apiary.io/#" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">Edge-X S3兼容API蜂房</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">存放原料药的地方。</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">edgex . docs . apary . io</p></div></div><div class="mq l"><div class="om l ms mt mu mq mv ky mh"/></div></div></a></div><p id="6df1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">API提供对高级EdgeFS对象接口的访问，例如对键值存储、S3对象追加模式、S3对象读写模式和S3对象流会话(POSIX兼容)模式的访问。</p><p id="2ec7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">流会话包括由一个源对一个对象进行的一系列编辑，这些编辑在特定的有限时间内保存为一个或多个版本。流会话在打开时必须被隔离。也就是说，通过此会话工作的用户将看不到其他会话对此对象的更新。会话结束后，创建对象的新版本，并最终通过定向ISGW链接进行复制。</p><p id="e620" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">流会话允许对对象进行高性能的POSIX风格的访问，因此对于客户端应用程序来说，使用HTTP/1.1或HTTP/2持久连接扩展来最小化更新或读取之间的延迟是有益的。</p><p id="035a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">若要启用，请在撰写脚本中取消对s3x01服务的注释，并在工具箱中执行以下命令:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="6c9c" class="nc lc it my b gy nd ne l nf ng">efscli service create s3x s3x01<br/>efscli service serve s3x01 myspace/work</span></pre><p id="36f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以上将创建服务定义s3x01服务租户myspace/work。这里有几个如何使用它的例子:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="36d9" class="nc lc it my b gy nd ne l nf ng"># create JSON Key-Value database mydb.json in bucket bk1<br/>curl -X POST -H "Content-Type: application/json" \<br/>    --data '{"key1":"value1"}' \<br/>    "<a class="ae la" href="http://localhost:4000/bk1/mydb?comp=kv&amp;finalize" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/bk1/mydb.json?comp=kv&amp;finalize</a>"</span><span id="e7a9" class="nc lc it my b gy nv ne l nf ng"># create CSV Key-Value database mydb.csv<br/>curl -X POST --data "value1" \<br/>    "<a class="ae la" href="http://localhost:4000/shared1/mydb.csv?comp=kv&amp;finalize&amp;key=key1" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/shared1/mydb.csv?comp=kv&amp;finalize</a>"</span><span id="72fa" class="nc lc it my b gy nv ne l nf ng"># list keys and values<br/>curl "<a class="ae la" href="http://localhost:4000/shared1/mydb.json?comp=kv&amp;values=1" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/shared1/mydb.json?comp=kv&amp;values=1</a>"</span></pre><p id="6cf2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">数据库按字母顺序索引，可以使用<code class="fe oi oj ok my b">key</code>、<code class="fe oi oj ok my b">maxresults</code>和<code class="fe oi oj ok my b">values</code>查询参数选择一个或多个匹配的关键字和值:</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="3232" class="nc lc it my b gy nd ne l nf ng"># curl "<a class="ae la" href="http://localhost:4000/shared1/mydb.json?comp=kv&amp;values=1" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/shared1/mydb.json?comp=kv&amp;key=key1&amp;maxresults=3&amp;values=1</a>"</span><span id="eae8" class="nc lc it my b gy nv ne l nf ng">key1;value1<br/>key11;value11<br/>key12;value12</span></pre><p id="7fd7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">输出可以是CSV或JSON格式。也可以插入二进制格式的值(二进制值的大小不能超过1MB):</p><pre class="kp kq kr ks gt mx my mz na aw nb bi"><span id="706f" class="nc lc it my b gy nd ne l nf ng"># insert binary data<br/>curl -X POST  -F "file=<a class="ae la" href="http://twitter.com/docker" rel="noopener ugc nofollow" target="_blank">@</a>file.txt" \<br/>    "<a class="ae la" href="http://localhost:4000/shared1/mydb?comp=kv&amp;finalize&amp;key=key2" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/shared1/mydb.blob?comp=kv&amp;finalize&amp;key=</a>file.txt"</span><span id="38b0" class="nc lc it my b gy nv ne l nf ng"># read it back<br/>curl "<a class="ae la" href="http://localhost:4000/shared1/mydb?comp=kv&amp;values=1&amp;key=key2" rel="noopener ugc nofollow" target="_blank">http://localhost:4000/shared1/mydb.blob?comp=kv&amp;values=1&amp;maxresults=1&amp;key=</a>file.txt"</span></pre><p id="dc5e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也可以创建事务风格的键值流行为:打开、修改、修改、修改、提交。这种方法可以用于高效的日志或记录收集机制:<strong class="js iu"> <em class="on">使用S3X将数据直接流式传输到EdgeFS！阅读更多关于如何做到这一点的API文档。</em></strong></p><h1 id="91a3" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="bdfd" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">EdgeFS可以是一个非常强大的工具，用于改进CI/CD或日常开发人员的工作流程。凭借真正的数据地理透明性、文件、数据块、对象和NoSQL协议的有保证的一致性，EdgeFS数据层可以实现一些以前你甚至认为不可能的使用情形。现在，任何类型和种类的数据都可以在分布的位置之间浮动，而不需要任何集中的元数据编排！</p><p id="b5b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">探索！如果您想启用额外的功能，请查看docker-compose注释掉的部分！或者更好的是，加入我们正在成长的社区，给我们反馈，帮助我们改善开发者体验！</p></div></div>    
</body>
</html>