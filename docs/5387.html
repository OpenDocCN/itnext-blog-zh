<html>
<head>
<title>Scaling Jenkins Build Agents with Kubernetes Pods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Kubernetes Pods扩展Jenkins构建代理</h1>
<blockquote>原文：<a href="https://itnext.io/scaling-jenkins-build-agents-with-kubernetes-pods-8c89f87ba0d3?source=collection_archive---------2-----------------------#2021-02-22">https://itnext.io/scaling-jenkins-build-agents-with-kubernetes-pods-8c89f87ba0d3?source=collection_archive---------2-----------------------#2021-02-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2faa" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于跨Kubernetes集群扩展Jenkins构建作业的教程。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4bc34505fe8029e148cc421fbd881f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAd0DvTq7vHAtC4jqFRiOg.png"/></div></div></figure><p id="5da0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">根据上一篇关于如何在Kubernetes集群中运行Jenkins的教程<a class="ae lq" href="https://twissmueller.medium.com/running-jenkins-inside-a-kubernetes-cluster-bd86822d487" rel="noopener"/>,现在是时候利用Kubernetes基础设施在集群中扩展构建工作了。</p><h2 id="0717" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">示例构建作业</h2><p id="2495" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">首先，需要两个项目来测试设置。这些作业不会做任何有用的事情，它们只会等待10秒钟，然后继续。</p><p id="3b03" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些工作是通过点击仪表板中的“新项目”，然后选择“自由式项目”来创建的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/612987361874ebecb9981466f25fbc36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y19wHxB-CNQS_s7s-L5mag.png"/></div></div></figure><p id="8356" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在“构建”部分，需要添加“执行shell”构建步骤。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ae4b166475ebb210ce2b50817f57005b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H5HI1vfFRy81pMqaL-LbpQ.png"/></div></div></figure><p id="01f3" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">构建作业应该执行的命令是</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="34f6" class="lr ls it mq b gy mu mv l mw mx">sleep 10</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/834ed6a5dee2ba60556479edaf288c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZGUCsa0u4IPJR_F0ST1Z7A.png"/></div></div></figure><p id="ef5f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">保存后，新作业将显示在仪表板中。需要创建另一个工作，直到有两个。</p><p id="9d1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当两个作业同时触发时，它们将显示在“构建执行者状态”下。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fb78d5bbb125f0ef35b5e4878c4590b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bxwb-G_pBMZHwZLdK-G9VA.png"/></div></div></figure><p id="39f9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，这两个任务都在pod中执行。从长远来看，这是无法扩展的。</p><p id="e11f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际目标是在新创建的pod中运行正在运行的构建作业的每个实例。pods生命周期与构建工作的生命周期紧密相关。</p><p id="2595" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这意味着，当新作业被触发时，将创建一个新的pod，该作业在该pod内运行，当该作业完成时，该pod将被删除。</p><p id="6fe9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为此，必须进行一些额外的配置。</p><h2 id="f559" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">安装Kubernetes插件</h2><p id="a76f" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Kubernetes插件是通过</p><ul class=""><li id="2943" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">"管理詹金斯"</li><li id="2f2f" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">"管理插件"</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/08fd91bb5929b0e9de2641d85f49b43a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pm5Ce1alT5CSOpkyWeRLPg.png"/></div></div></figure><p id="beaa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后</p><ul class=""><li id="c812" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">"可用"</li><li id="6623" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">“Kubernetes”精选</li><li id="0ca5" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">按下“安装但不重启”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c00f87167c08930fd88df3fe78309eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7j5rHK4nYSAsECXo9lVbzA.png"/></div></div></figure><p id="8396" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后所有东西都将被安装:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d0154f048241a09416406c00ab70bb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qitw6qMm77GgumjADcq7og.png"/></div></div></figure><h2 id="36b7" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">添加Kubernetes的秘密</h2><p id="46f4" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">两个Kubernetes-需要秘密。</p><p id="15bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个是<code class="fe nm nn no mq b">jenkins-robot.yaml</code></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="558c" class="lr ls it mq b gy mu mv l mw mx">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: jenkins-robot<br/>  namespace: jenkins<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: Role<br/>metadata:<br/>  name: jenkins-robot<br/>  namespace: jenkins<br/>  labels:<br/>    "app.kubernetes.io/name": 'jenkins'<br/>rules:<br/>- apiGroups: [""]<br/>  resources: ["pods", "pods/exec", "pods/log", "persistentvolumeclaims", "events"]<br/>  verbs: ["get", "list", "watch"]<br/>- apiGroups: [""]<br/>  resources: ["pods", "pods/exec", "persistentvolumeclaims", "events"]<br/>  verbs: ["create", "apply", "delete", "deletecollection", "patch", "update"]<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: RoleBinding<br/>metadata:<br/>  name: jenkins-robot-binding<br/>  namespace: jenkins<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: Role<br/>  name: jenkins-robot<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: jenkins-robot<br/>  namespace: jenkins</span></pre><p id="fd32" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第二个秘密是<code class="fe nm nn no mq b">jenkins-robot-global.yaml</code></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="feb2" class="lr ls it mq b gy mu mv l mw mx">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: jenkins-robot-global<br/>  namespace: jenkins<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRole<br/>metadata:<br/>  name: jenkins-robot-global<br/>  namespace: jenkins<br/>  labels:<br/>    "app.kubernetes.io/name": 'jenkins'<br/>rules:<br/>- apiGroups: [""]<br/>  resources: ["pods", "pods/exec", "pods/log", "persistentvolumeclaims"]<br/>  verbs: ["get", "list", "watch"]<br/>- apiGroups: [""]<br/>  resources: ["pods", "pods/exec", "persistentvolumeclaims"]<br/>  verbs: ["create", "apply", "delete", "deletecollection", "patch", "update"]<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: jenkins-robot-global-binding<br/>  namespace: jenkins<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: jenkins-robot-global<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: jenkins-robot-global<br/>  namespace: jenkins</span></pre><p id="0796" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这两个秘密都适用于:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="15fa" class="lr ls it mq b gy mu mv l mw mx">kubectl apply -n jenkins -f jenkins-robot.yaml<br/>kubectl apply -n jenkins -f jenkins-robot-global.yaml</span></pre><p id="3b2e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这些秘密需要添加到詹金斯。</p><p id="9430" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一个秘密通过以下方式获取:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="ae6c" class="lr ls it mq b gy mu mv l mw mx">kubectl -n jenkins get serviceaccount jenkins-robot --template='{{range .secrets}}{{.name}}{{"\n"}}{{end}}' | xargs -n 1 kubectl -n jenkins get secret --template='{{ if .data.token }}{{ .data.token }}{{end}}' | head -n 1 | base64 -d -</span></pre><p id="75b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这需要复制到剪贴板，以便在下一步中粘贴。</p><p id="224e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在Jenkins中，凭据是通过以下方式创建的</p><ul class=""><li id="2de4" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">管理詹金斯</li><li id="1280" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">管理凭据</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/abdc8e11b217718a2c6fce7a03185b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkYXndtChK3orA7qVO5IWQ.png"/></div></div></figure><p id="8a87" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，按下</p><ul class=""><li id="5bf7" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">新项目</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/de0bef1bda237419d1b254e134ea3212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*smMHLiYdmMQcIoYB4U4cBw.png"/></div></div></figure><p id="69f2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另外两个链接:</p><ul class=""><li id="6ad0" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">全局凭据(无限制)</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/04cb543257478ea3dfd265321504b7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MB1Vo1WX5nAUke5zwLfAMQ.png"/></div></div></figure><p id="9d83" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后</p><ul class=""><li id="77b4" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">添加凭据</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ea6f977f32def7af0768839a4059d368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wlf44iVzHYOtSXXizdAl-A.png"/></div></div></figure><p id="bb48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">必须添加以下值:</p><ul class=""><li id="451f" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">种类:秘密文本</li><li id="4f27" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">范围:全球</li><li id="2ef7" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">秘密:</li><li id="0a1d" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">ID:詹金斯-机器人</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2659e79d9b0dfaec79486c7d425eab7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XHD4WkihOz7IuyciQffKvg.png"/></div></div></figure><p id="abd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">秘密<code class="fe nm nn no mq b">Jenkins-Robot-Global</code>也需要这样做，可以通过以下方式检索:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="adda" class="lr ls it mq b gy mu mv l mw mx">kubectl -n jenkins get serviceaccount jenkins-robot-global --template='{{range .secrets}}{{.name}}{{"\n"}}{{end}}' | xargs -n 1 kubectl -n jenkins get secret --template='{{ if .data.token }}{{ .data.token }}{{end}}' | head -n 1 | base64 -d -</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/af2099404b4aa3310f1f6fdaae17631d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcK5QRX7HeY-zIG0L40E4w.png"/></div></div></figure><p id="6887" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，两个证书都出现在詹金斯:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8b87f4a010275f98167bf4c67a6b9129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cVf6W6eHTrxarUPktMN8_w.png"/></div></div></figure><h2 id="1d6c" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">将Kubernetes云添加到Jenkins</h2><p id="cb3b" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Jenkins需要知道有一个可以使用的Kubernetes集群。下面解释了如何进行配置。</p><p id="42cd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过以下方式添加Kubernetes集群:</p><ul class=""><li id="e943" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">管理詹金斯</li><li id="f646" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">管理节点和云</li><li id="e22a" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">配置云</li><li id="3314" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">添加一个新的云:Kubernetes</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a859abb3e2abbe4f1d385663303b6487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGJwpn9-eu-ATvqgyG96OA.png"/></div></div></figure><p id="7187" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在“Kubernetes Cloud Details”下，需要添加以下值:</p><ul class=""><li id="67a2" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">名称:Kubernetes</li><li id="13c0" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">Kubernetes网址<a class="ae lq" href="https://:6443" rel="noopener ugc nofollow" target="_blank"> https://:6443 </a></li><li id="e1eb" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">Kubernetes名称空间:jenkins</li><li id="d522" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">证书:詹金斯-机器人</li><li id="8738" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">詹金斯隧道::50000</li></ul><p id="5f7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">具有角色主机的群集节点的IP地址可以使用以下命令检索:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="9547" class="lr ls it mq b gy mu mv l mw mx">kubectl get nodes -o wide | grep master</span></pre><p id="54df" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Jenkins隧道的IP是名为<code class="fe nm nn no mq b">jenkins-jnlp</code>的服务的IP，可以通过以下方式检索:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="2fb8" class="lr ls it mq b gy mu mv l mw mx">kubectl get service jenkins-jnlp -n jenkins</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f435f76693d4b80c7b64b648a13cf241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QE4LVKYgCscay5h2QLkI-g.png"/></div></div></figure><p id="5deb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其余的值保留默认值:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1e95600c8e15c5dfdd6d286b61ded1a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_uOeSS6JRzGCikTl5R5HQ.png"/></div></div></figure><p id="d25b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">可以通过按下“测试连接”按钮来测试连接。</p><h2 id="ea2d" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">添加窗格和容器模板</h2><p id="936d" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Pod模板需要填写如下:</p><p id="30b7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Pod模板:</p><ul class=""><li id="bb39" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">名称:jnlp</li><li id="94c9" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">用法:尽可能多地使用该节点</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/94373ea63d575bf6444050cd69017253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2XuhtrsWYiBl5BkpwvtNQ.png"/></div></div></figure><p id="ee60" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于本教程，这些代理的容器基于<code class="fe nm nn no mq b">jenkins/jnlp-agent-alpine</code></p><ul class=""><li id="55b1" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">名称:jnlp</li><li id="2d39" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">Docker图片:詹金斯/jnlp-代理-阿尔卑斯</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9194ccd9588bf16c257c394a78be1de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7PxwwzbKnc8jGoc_QqrPg.png"/></div></div></figure><p id="1fc0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">需要添加“主机路径”卷:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/05654021e7f29e56d54aef553468ac56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShQAyjShuSfjjflrNxLjsQ.png"/></div></div></figure><ul class=""><li id="6d74" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">主机路径:/var/run/docker.sock</li><li id="d483" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">挂载路径:/var/run/docker.sock</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0d80af6c1506de4ab0cfa85b5e87b494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QEL1HudHAmF6fw7y_4_sgA.png"/></div></div></figure><p id="9a95" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">还需要一个“空目录”卷</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4ee6164021f8bf721eb14ad8d54342a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQzw3QScUHU8Ie2sECKWdQ.png"/></div></div></figure><ul class=""><li id="c374" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">挂载路径:/home/jenkins/agent</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d1d8641c6f31dbacbd559a455a10c87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_A98eUuhNFa4R3dyJfEWAA.png"/></div></div></figure><p id="2a6c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">按下“保存”按钮即可完成配置。</p><p id="1dac" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，Jenkins需要配置为只有代理节点应该运行构建作业。这是通过以下方式实现的:</p><ul class=""><li id="aa5d" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">管理詹金斯</li><li id="b68e" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">管理节点和云</li><li id="5366" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">掌握</li><li id="e216" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">安装ˌ使成形</li></ul><p id="6eca" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">需要提供以下值:</p><ul class=""><li id="58b0" class="my mz it kw b kx ky la lb ld na lh nb ll nc lp nd ne nf ng bi translated">执行人数量:0</li><li id="7d09" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated">用法:仅构建标签表达式与此节点匹配的作业</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/431b992f7ada7e704ed56223a283ff85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XpMIb4cYTetk1wJ8ihqlbQ.png"/></div></div></figure><p id="558d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，完成后，需要按下“保存”按钮。</p><h2 id="5d04" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">测试Pod构建代理</h2><p id="e52f" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">当两个构建作业同时被触发时，可以观察到在“构建执行者状态”下启动了两个pod:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/244f34df5d419bb303c2ac9b002d6b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sCMNzRL_yvGE0IiFIAKWKQ.png"/></div></div></figure><p id="6d41" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，当pod运行时，作业就在其中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4bc34505fe8029e148cc421fbd881f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAd0DvTq7vHAtC4jqFRiOg.png"/></div></div></figure><p id="306f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">感谢阅读！喜欢吗？<a class="ae lq" href="https://www.buymeacoffee.com/twissmueller" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">给我买杯咖啡！</strong> </a></p><h2 id="b2ef" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">资源</h2><ul class=""><li id="ebb0" class="my mz it kw b kx mk la ml ld np lh nq ll nr lp nd ne nf ng bi translated"><a class="ae lq" href="https://otterwerks.medium.com/scalable-jenkins-ci-cd-on-bare-metal-arm-kubernetes-c71dfe5645f8" rel="noopener">裸机ARM上的可扩展Jenkins CI/CD Kubernetes</a></li><li id="7a99" class="my mz it kw b kx nh la ni ld nj lh nk ll nl lp nd ne nf ng bi translated"><a class="ae lq" href="https://stackoverflow.com/a/42124959/1065468" rel="noopener ugc nofollow" target="_blank">Kubernetes上Jenkins slave的连接中断</a></li></ul></div></div>    
</body>
</html>