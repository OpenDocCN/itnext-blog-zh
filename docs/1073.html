<html>
<head>
<title>“Don’t worry ma’am, you don’t need to share your credit card details over the phone” — or the story of accepting payments on the web.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">“别担心，女士，你不需要在电话里分享你的信用卡信息”——或者在网上接受支付的故事。</h1>
<blockquote>原文：<a href="https://itnext.io/dont-worry-ma-am-you-don-t-need-to-share-your-credit-card-details-over-the-phone-or-the-story-6e785175d1a5?source=collection_archive---------6-----------------------#2018-07-16">https://itnext.io/dont-worry-ma-am-you-don-t-need-to-share-your-credit-card-details-over-the-phone-or-the-story-6e785175d1a5?source=collection_archive---------6-----------------------#2018-07-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8d6be988f46a95f7808c0ccc486231ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4riJbHFlnl6mh2So20UbA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">"是的，我还是不在电话里告诉你我的信用卡号码比较好."</figcaption></figure><p id="5063" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi la translated">又是你好！今天，我们的主要课程是在用<strong class="ke ir"> OutSystems平台</strong>开发的web应用程序中接受信用卡支付。知道这可能是一个<em class="lj">成功或失败的段落</em>，我们的主要目标是展示如何使用<strong class="ke ir">客户端加密</strong> (CSE)创建一个支付表单。然后，我们将用一个很酷但不太复杂的控制面板和一些简洁的附加功能来补充我们的系统。</p><p id="5a6e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">这不是该主题的第一篇文章。</strong>如果你还没有这样做，我推荐你阅读上一篇文章(链接如下，或<a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/credit-or-debit-or-the-story-of-accepting-payments-in-the-outsystems-platform-b1b4bf15f736">此处</a>)，这样你就可以熟悉一些术语。知道这是一个估计17分钟的阅读，我将给出一个简短的总结:<strong class="ke ir">我们定义了我们的业务案例</strong>(接受付款)<strong class="ke ir">我们的约束</strong>(不符合PCI)和<strong class="ke ir">我们深入研究了核心服务模块</strong> — API集成— <strong class="ke ir">和移动插件</strong>的实现。所有这些<strong class="ke ir">都使用Adyen的</strong>，一个著名的支付网关提供商。如果你不知道Adyen，我建议你下次在里斯本机场出发时，看看自助服务机上的显示屏，那里出售从枕头到国际充电器的几乎所有东西。</p><div class="ll lm gp gr ln lo"><a rel="noopener  ugc nofollow" target="_blank" href="/credit-or-debit-or-the-story-of-accepting-payments-in-the-outsystems-platform-b1b4bf15f736"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd ir gy z fp lt fr fs lu fu fw ip bi translated">“信用卡还是借记卡？”—或者在OutSystems平台中接受支付的故事</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">移动设备、高速数据通信和在线商务创造了方便、安全的期望…</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">itnext.io</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc jw lo"/></div></div></a></div><p id="7ab9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">继续阅读本文，我将向您展示如何实现web表单——使用web块——以及如何构建控制面板。但是，事不宜迟，让我们回顾并更新我们的业务案例。</p><h1 id="ab4d" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">商业案例</h1><blockquote class="nb nc nd"><p id="fdfb" class="kc kd lj ke b kf kg kh ki kj kk kl km ne ko kp kq nf ks kt ku ng kw kx ky kz ij bi translated">因此，商业案例相当简单:我们希望在我们的应用程序中接受支付，在我们的两个渠道中——网络和移动。(……)我们也想在网络上支持<strong class="ke ir">(支付)</strong>，因为由于技术困难或通过不同的销售渠道，可以发布一次性网络支付表单。</p></blockquote><p id="6530" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上面的摘录摘自上一篇文章，总体来说，没有改动。不过，我们将在控制面板上添加一些细节。</p><p id="eeaa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们的<strong class="ke ir">控制面板</strong>应该<strong class="ke ir">允许我们发出一个新的支付请求</strong>，有了同样的请求，<strong class="ke ir">要么生成一个支付表格</strong>并转发给我们的客户，要么请求信用卡详细信息并<strong class="ke ir">自己键入支付详细信息</strong>——你可以通过电话获得详细信息，这在某些文化中似乎很常见。尽管我不是这个选项的“超级粉丝”，但我会让它可用，然后根据具体情况，您可以评估是否应该允许这样做。由你决定。</p><p id="fc3e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除此之外，我们的控制面板还将<strong class="ke ir">允许我们收集一些关于过去30天付款次数的信息</strong>，成功/不成功付款比率，以及最后，过去几天的最高付款额——30天将是我们的基线。尽管这不是一个非常全面的功能集，但应该足以启动您的支付处理，正如您现在可能已经猜到的那样，它可以作为一个“框架”工作，因此您可以根据自己的需要扩展这些功能。</p><p id="8647" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在继续之前，让我在这里做一个与上一段完全相关的附加评论:如果您发现缺少某个给定的特性，或者如果您希望将一组更改“合并”到这些文章中描述的任何组件，请随时给我留言，我相信我们可以解决这个问题。毕竟分享就是关爱。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/478c22d3390ea2aa5820b4ace394144a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*IC3-Ic7PZF5k70nXzh7ZkA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图1 —接近最终结果的东西。</strong></figcaption></figure><p id="90c2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们已经结束了我们的业务案例——瞥了一眼最终的表单——让我们继续讨论用于处理支付的web块的实现。</p><h1 id="0675" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">付款表格</h1><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/32bea1f0bf763d374cca891be8076217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ndZt8_rHFtsC8A0XlmODWg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图2 —网络表单骨架</strong></figcaption></figure><p id="c6f5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果你还记得，我们的移动插件有一个很棒的用户界面。这一次，与移动版本相反，我们使用<strong class="ke ir"> London </strong>作为基本主题——这就是为什么我们的web块上没有“无色”按钮，如图2所示。我们这样做有几个原因，最相关的是正确绘制布局的能力。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/902d8c728f644b96eace3ffd3be8af7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*FkddfgWLZ7Hy7T6YQURi1A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图3 —网络块签名。</strong></figcaption></figure><p id="0c05" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用与之前相同的方法，我们使用平台提供的最简单/基本的元素来构建表单。通过使用这个，我们允许您通过应用一个样式表来定制表单上的任何内容。显而易见，您总是有机会打开该模块，并根据您的喜好或需要对其进行修改。与web块本身相关，我们有两个输入参数—客户端加密<strong class="ke ir">密钥</strong>和支付的标识符:<strong class="ke ir"> PaymentId </strong>。另外，我们有一个局部变量来存储表单输入数据。它拥有web块用户界面上的所有字段。</p><p id="7881" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所以，如果可以的话，让我快速浏览一下所有的界面元素:我们有基本的字段，如姓名、卡号、有效期和CVC/CVV输入。我们还有两个“自解释”按钮和第三个按钮，名为<strong class="ke ir">过程</strong>。</p><p id="656d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在进入“什么，如何和为什么？”让我快速解释一下:看到图2中突出显示的容器了吗？在这个容器下面——如果您的屏幕允许您看到它，因为我的是一个真正的用户——您可以看到两个额外的输入字段。第一个用于生成支付尝试的当前时间戳，而第二个用于存储加密算法的输出。生成时间戳是一个至关重要的字段，因为加密算法需要它来成功工作，并且作为一种安全措施，确保您不能在用户输入详细信息后超过24小时处理支付。就我个人而言，我看不出有哪种商业案例会让你想要延迟付款的处理，但我们永远也不会知道。亲爱的读者，如果你想到这样的场景，请在评论中留下，这样我们也可以讨论它。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi no"><img src="../Images/1ccfb69fdfbba6bd6b3f7368797fd3a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*IqAHNr2UzpT7Je0FojaS1A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图4 —流程按钮容器。</strong></figcaption></figure><p id="3eef" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在让我们进入<strong class="ke ir">过程</strong>按钮。正如您在图2中所看到的，Process按钮在一个容器中，默认情况下，它通过被标记为false的Display属性隐藏起来——请看图4。记住将Display属性设置为false只会增加“Display:none；”小部件的样式—它仍然在屏幕上呈现/可用。如果您想避免这种情况，请使用If小部件。</p><p id="49ff" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">除了注释之外，我们这样做(隐藏的进程按钮)是因为我们想要“自动”触发与该按钮相关的屏幕动作的执行。我们将通过使用JavaScript来实现这个(触发器),但是现在，让我们仔细看看分配给这个按钮的屏幕动作。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/85f0effbf9f0b26186e516f9177e6a51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*buewv9D1_dlPqff4AP31aQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图5 —过程屏幕动作的初始流程。</strong></figcaption></figure><p id="dad4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在图5中，您可以快速浏览一下我们在屏幕动作“开始”时正在做什么。与我们在移动端所做的类似，我们检索付款，然后检查两件不同的事情:</p><ul class=""><li id="55a8" class="nq nr iq ke b kf kg kj kk kn ns kr nt kv nu kz nv nw nx ny bi translated">如果支付处于有效状态，即:已分期、已拒绝或服务不可用，以及</li><li id="cdab" class="nq nr iq ke b kf nz kj oa kn ob kr oc kv od kz nv nw nx ny bi translated">如果加密数据有效。</li></ul><p id="ef11" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了确认加密的数据是否有效，我们检查其中一个隐藏输入的内容——第二个，它与表单上的<em class="lj"> EncryptedData </em>变量相关联。我们使用两个因素进行验证:它不为空——因为对于不成功的情况，<em class="lj"> encryptData </em>函数返回<em class="lj">false</em>——前十七(17)个字符匹配给定的字符串，即<strong class="ke ir"><em class="lj">adyenjs _ 0 _ 1 _ 20 _ 1 $</em></strong>。在图6中，您可以看到我们应用的完整IF条件。</p><p id="c66d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">快速提示:</strong>这个库有一个较新的版本(0.1.21 ),但是，正如前一篇文章中所述，我们现在仍然使用0.1.20。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/31b51a6cdc894e4e92437e628357e547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KwGcx6B_Mj2dBtHC3zhEcA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图6-全中频条件。</strong></figcaption></figure><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/b9c8dfdb45c74a871dfb3beeff38ee57.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*BwPkENU7ZIxYcKrFyeFCGQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图7 —服务呼叫准备和调用。</strong></figcaption></figure><p id="3b1e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，在这个验证检查之后——假设一切都经过了正确的验证——我们获得用户的IP地址，将这些值赋给我们的Adyen_CapturePayment请求结构，然后……执行请求。而不是使用自定义(和原生！)插件来获取用户的IP地址，这次我们使用在<strong class="ke ir"> HTTPRequestHandler </strong>扩展中可用的<strong class="ke ir"> GetIP </strong>动作。这不是我们将在这个扩展中使用的唯一函数，因为正如您在图5和图8中看到的，所有这些<em class="lj">enable buttons&lt;*&gt;</em>动作都是<strong class="ke ir"> RunJavaScript </strong>。我们这样做是为了在执行结束后再次启用按钮。但不仅如此，所以我们不要太超前了…</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi og"><img src="../Images/e5ab80ce7fd964c35339e88b3d7d9420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tW2NxabIg4KAnvLLJPb3g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图8 —处理响应。</strong></figcaption></figure><p id="3415" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在调用<strong class="ke ir"> Adyen_CapturePayment </strong>动作时，我们处理给定的响应。这与移动插件的风格非常相似:我们检查<strong class="ke ir">成功</strong>或<strong class="ke ir">技术错误</strong>。在这些情况下，<strong class="ke ir">我们通知父</strong>块(或屏幕),这样我们可以获取所需的流。<strong class="ke ir">如果付款被拒绝，我们只需提醒用户</strong>，这样就可以修复/更改付款细节。</p><p id="065a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您回想一下图2，您会看到除了Process按钮之外，我们还有两个不同的按钮。与每个OutSystems按钮一样，我们需要一个与之相关联的屏幕/导航动作。不幸的是，这并不符合我们的需求，因为<strong class="ke ir">我们希望——也需要——在服务器级做任何事情之前加密客户端上的数据</strong>。因此，问题仍然是:我们如何使用默认的OutSystems按钮，并仍然实现这一点？</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/cd9cf66aa37f790417a69f3e5999a7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*QcL-Gv55USnYHR2tl21H1w.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图8——你见过的最复杂的屏幕动作。就像，永远！</strong></figcaption></figure><p id="9af5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">第一步</strong>:定义空屏动作。Pay和Clear屏幕操作看起来与图8完全一样。这可能是你一生中见过的最复杂的屏幕动作。玩笑归玩笑，我们定义这个<a class="ae lk" href="https://www.explainxkcd.com/wiki/index.php/303:_Compiling" rel="noopener ugc nofollow" target="_blank">是为了发布我们的代码</a>和<a class="ae lk" href="https://www.youtube.com/watch?v=x-yGSIYkeOs" rel="noopener ugc nofollow" target="_blank">去摆弄椅子和灭火器</a>。</p><p id="477c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">第二步</strong>:定义JavaScript函数。我们将在web块中定义两个JavaScript函数，这样我们就可以在按钮中使用它们。关于这些函数，请参见下面的要点。</p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="1281" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我不是JavaScript专家，所以，如果你发现一些可以优化的地方，请告诉我，以便我可以应用新版本。</p><p id="8697" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第一个函数(ClearData)是我们将在Clear按钮上使用的函数。它只是获取表单中的所有输入，并清除它们的值。简单。</p><p id="3a33" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第二个函数(EncryptData)稍微复杂一点。总的来说，我们做的事情和我们的手机版完全一样——不同的是，在这里，我们必须用一个“简单的”JavaScript函数做所有的事情。</p><p id="d60c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们从禁用按钮开始，这样我们就*防止*用户篡改数据或进行重复请求——这样他就知道后端有东西在运行。然后，我们生成我们的生成时间——打算冗余——并创建我们的加密实例。我们填充<em class="lj"> creditData </em>结构，并将其传递给验证器。如果有效，我们调用encrypt函数，并通过将函数的输出指定为输入值来使用它。如果没有，我们遍历所有属性，将适用的属性标记为无效。最后，我们再次启用按钮。简单吧？</p><p id="239d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一个可能的后续问题是:您在哪里加载带有<strong class="ke ir"> adyen.encrypt </strong>函数定义的JavaScript文件？</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/5696b0d52ad568885a7c83c1599ccdc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*h5q04p-7pu8wh2PUPSQVEQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图10 —导入的JavaScript资源。</strong></figcaption></figure><p id="0fe5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们做的第一件事是导入资源文件，然后将部署操作标记为Deploy to Target Directory。然后，您需要复制运行时路径变量的内容。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/06f68901a23151ed4a0f26c59995eded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*ntOGlhOLuASlYQTH_28tLA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图11-网块准备。</strong></figcaption></figure><p id="6758" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦有了这个运行时路径，我们就开始准备包含我们的表单的web块，并且我们使用一个不同的动作呈现在<strong class="ke ir"> HTTPRequestHandler </strong>扩展上:<strong class="ke ir"> AddJavaScriptTag </strong>。出于这个目的，普通的<strong class="ke ir"> HTTPRequestHandler </strong>扩展可以完成任务——不需要使用缓冲版本。我们将在另一篇文章中讨论这个Buffed版本。</p><p id="f23c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，我们只需将之前复制的运行时路径粘贴到JavaScriptURL输入参数中，然后<em class="lj"> et voilà </em>，就这样。这听起来可能比实际情况更可怕。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/00fe4f317535ab089a8d28330345b457.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*kPEhqe2mvVodRT-tiI90kg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图12 —清除按钮onclick。</strong></figcaption></figure><p id="0a51" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好了，现在是我们进入最后一章付款方式的时候了。我们如何调用JavaScript函数？另一个简单的解释。在每个按钮上，<strong class="ke ir">我们为onclick </strong>定义了一个扩展属性。对于Clear按钮，我们使用<strong class="ke ir"> ClearData </strong>函数，而对于Pay按钮，我们将使用<strong class="ke ir"> EncryptData </strong>函数——如图13所示。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi on"><img src="../Images/f2de266b6fe91fc775ff8dd3bbb31bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Xi3n1bpVKEYOuanhdQ6Ug.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图13 —支付按钮onclick。</strong></figcaption></figure><p id="7b02" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在继续讨论这个问题之前，我想强调两点:</p><p id="ba47" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">看到函数调用末尾的分号了吗？那个。是。危急关头。为什么？因为OutSystems将一组JavaScript函数绑定到了<strong class="ke ir"> onclick </strong>属性，因此，我们在扩展属性中定义的是首先执行的内容。因此，呈现的代码将类似于图14。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/d82e52dac8c7434a0c5fe64e2dd6c8e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*tXBowvcngT8yPQDTHRiWWQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图14——支付按钮的生成代码。如果想知道，这是崇高的文本。</strong></figcaption></figure><p id="1c4b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您没有显式地声明分号，它将抛出一个JavaScript错误——我们根本不希望这样。因此，如果您正在为您的OutSystems onclick扩展属性添加像JavaScript函数这样酷的东西，不要忘记分号！</p><p id="94ef" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">第二个评论是，我在使用手动生成的按钮时遇到了很多麻烦。当我说“手动生成的按钮”时，大概是这样的:</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi op"><img src="../Images/7bc0b88a0f99ee1752feffb47349ecf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSvCgUeM5qWAirAFk96WhQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">图15 —手动生成的按钮。</figcaption></figure><p id="a31d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">每当我试图使用这样的东西时，我都会得到如图16所示的结果。95%的情况下都会这样。在另外的5%中，我通常打开JavaScript调试器，很少情况下，一切都按预期运行。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oq"><img src="../Images/a15f6f5d16cb63ddd1d3ea3729248084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yg5vhyKvDxqRL9iOG7w6jg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图16——使用手动生成按钮时的之前和之后。</strong></figcaption></figure><p id="bc34" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所以，这个故事的寓意:<strong class="ke ir">不要使用手动生成的按钮。你可以以后再感谢我。如果，出于任何原因，你知道为什么会发生这种情况…也请告诉我！</strong></p><p id="9404" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这就是web表单部分。现在，我们有一个完全可用的web表单，带有客户端加密功能，可供您与现有项目集成。</p><h1 id="a6cc" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">控制面板</h1><p id="10ed" class="pw-post-body-paragraph kc kd iq ke b kf or kh ki kj os kl km kn ot kp kq kr ou kt ku kv ov kx ky kz ij bi translated">对于控制面板部分，我将更多地关注功能部分，而不是技术方面。当然，当更多的技术细节被建议时，我会做一些评论。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/804bd890d761e6f3d1ca330685e24ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*805oNDkCcGuwNntp57rCNA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图17 —仪表板</strong></figcaption></figure><p id="a710" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在图17中，您可以看到控制面板的仪表板。从上到下，从左到右:</p><ul class=""><li id="00e7" class="nq nr iq ke b kf kg kj kk kn ns kr nt kv nu kz nv nw nx ny bi translated">第一张图显示了过去30天的付款次数。考虑所有付款状态，包括分期付款。</li><li id="8cda" class="nq nr iq ke b kf nz kj oa kn ob kr oc kv od kz nv nw nx ny bi translated">第二张图显示了过去30天内成功付款(绿色)和不成功付款(红色)的数量。这只考虑前者的成功/退款和后者的拒绝。</li><li id="ea97" class="nq nr iq ke b kf nz kj oa kn ob kr oc kv od kz nv nw nx ny bi translated">然后，第一行的最后一张卡有最近30天的最高支付额。这不考虑汇率。也许在下一篇文章中？*眨眨眼*</li><li id="cdf6" class="nq nr iq ke b kf nz kj oa kn ob kr oc kv od kz nv nw nx ny bi translated">最后但同样重要的是，我们有一个包含十(10)笔最新付款的表格，这也包括分期付款。这里需要注意:在您的开发/UAT环境中拥有高质量的种子数据是至关重要的。因此，拥有像“酷故事”或“库里奥”这样的东西是一个巨大的禁忌。你知道那句谚语:做我说的，不要做我做的。</li></ul><p id="a90a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，只是好奇。如果您阅读了与此主题相关的第一篇文章，并且还记得货币实体中的Multiplier属性，您可能会注意到并非所有的货币都有相同的小数位数，即使我们使用了相同的内置函数:FormatCurrency。</p><p id="ed2e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如何才能实现这一点？通过数学的神奇力量！</p><p id="3773" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">引用前一篇文章:</p><blockquote class="nb nc nd"><p id="d0e5" class="kc kd lj ke b kf kg kh ki kj kk kl km ne ko kp kq nf ks kt ku ng kw kx ky kz ij bi translated">在货币实体上，有一个属性叫做<strong class="ke ir">乘数</strong>。该属性存储的值是10的幂。</p></blockquote><p id="b917" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，十(10)的幂的倒数是多少呢？没错，以10为底的对数——或者普通对数。</p><p id="ab53" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我很惊讶对数函数不是默认内置函数的一部分。我有这个想法，但由于我从未使用过它，我希望它能存在。也许这就是它不作为已建物存在的原因？大概吧。</p><p id="a472" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但这就是Integration Studio的用途。于是我很快从<a class="ae lk" href="https://msdn.microsoft.com/en-us/library/system.math.log(v=vs.110).aspx" rel="noopener ugc nofollow" target="_blank">系统中获取了几组功能。数学库(C#。NET) </a>和<a class="ae lk" href="https://www.outsystems.com/forge/component/4035/logarithm" rel="noopener ugc nofollow" target="_blank">将它们实现为扩展</a>。完成这项工作大约需要15分钟。最新版本(1.0.1)支持这两种堆栈。</p><p id="d688" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，使用内置的<strong class="ke ir"> FormatCurrency </strong>和我们全新的对数函数，我们获得了想要的结果。图18显示了完整的功能。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ox"><img src="../Images/f94c0e1f2e6cd655169c166f950277f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BK2EvjhcMVqGqfns47rGjw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图18 —格式货币功能的使用。</strong></figcaption></figure><p id="dd64" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，查看左侧菜单上的选项，我们看到了付款屏幕(图19)和创建付款屏幕(图20)。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/8d357b79af1421e3134a86ae16292767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFD9w2likV1U8EbrWKrU2A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图19-支付列表屏幕。</strong></figcaption></figure><p id="02f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">支付屏幕是一个非常基本的屏幕，与常规的脚手架几乎没有什么区别。只是一个或另一个附加字段，仅此而已。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/c27fc590e5073a53d89d256075c156c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6K9g7f9RsFRWqYOSyPvBxA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图20 —新支付屏幕</strong></figcaption></figure><p id="82e8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在创建付款屏幕上，我们要求用户指定谁是负责付款的用户，或者换句话说，该付款应该绑定到哪个用户，金额，货币，最后是将显示在对帐单上的参考。在这个屏幕上，更准确地说是在“继续”按钮上，我们没有任何特殊的验证—只是在基本的搭建上生成了什么。如果你需要更健壮的东西，就去做吧。</p><p id="7141" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="lj">(是的，石墨烯XT Prestige MP是我的网球拍……有人想玩游戏吗？)</em></p><p id="59d8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接着，我们看到了图21中的屏幕。在这个屏幕中，我们有要支付的金额、客户、证明人和历史记录。作为新创建的付款，我们没有任何历史可展示。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/c804c9c07becbb32f8b2c93f093b5a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMPTVPluY_cH-HxlzHcdIw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图21 —付款详情屏幕。</strong></figcaption></figure><p id="a42e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在创建支付时，我们有一个当前状态的可视指示器——在右上角，Staged——和两个可能的操作:支付和生成表单。事实上，我们有三种行为，但是，正如你可能已经猜到的，有些行为只适用于给定的状态。</p><p id="6355" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">单击Pay按钮，我们会看到一个弹出窗口，其中有一个输入信用卡凭证的表单——如图22所示。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ow"><img src="../Images/ca702518af16f1e6e1541a9f5ba6467e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AkyeJoet8YtdhBghEXvaUA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图22——支付选项。</strong></figcaption></figure><p id="7635" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果您不想对与客户信用卡相关的任何数据负责，您可以随时选择生成表单选项。单击“生成表格”按钮后，将会发出一份一次性表格，并通过电子邮件向您的客户发送一个链接。亲爱的读者们，这就是技术问题回来了。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/bbccf3ce33f785b71b24f0254d53552e.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*Ds9e2xMjwzmqrK3EoQElVw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图23 —生成表单屏幕动作。</strong></figcaption></figure><p id="2dba" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当您单击“生成表单”按钮时，我们将调用图23所示的屏幕操作。我们调用Issue Manual Payment服务器操作——存在于<strong class="ke ir"> Adyen核心服务</strong>模块中——如果一切按计划进行，我们将有一个<strong class="ke ir"> Out </strong> put <strong class="ke ir"> URL </strong>,可以在我们新创建的电子邮件模板中使用。</p><p id="c1ed" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，我们检索用户详细信息——特别是用户的电子邮件地址——并使用模板调用发送电子邮件操作。这个调用的属性可以在图24中看到。</p><p id="da8b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在图25中，我们可以看到我们为此使用的电子邮件模板。这是一个非常简单的电子邮件模板。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi om"><img src="../Images/c32f57d8aa4a283f3b1321cd1a70778f.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*JkDvpCf-VCTa95gNqnGQwA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图24 —发送电子邮件参数。</strong></figcaption></figure><p id="5bfd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我只想强调一下“抄送”字段。如果仔细观察，您会发现我们正在使用一个站点属性来填充这个值。这是我们必须*确保*用户收到预期电子邮件的一种方式。退款和付款也是如此。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oz"><img src="../Images/a2190aee1832484ab73eeccecea0e741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPFAnGJzCO0Yp8bJn2Fa5g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图25 —电子邮件模板。</strong></figcaption></figure><p id="e3d3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上面我们看到的是在<strong class="ke ir"> IssueManualPayment </strong>服务器动作“外部”发生的事情——或者换句话说，在我们的控制面板中发生的事情。但是在<strong class="ke ir"> IssueManualPayment </strong>动作里面发生了什么呢？</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/be381392b3516dd88a3f60a679d7ec13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*ys1VsG6gvgPUoc8VUJFZuQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图26 —创建手动支付。</strong></figcaption></figure><p id="c3a1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在图26中，您可以看到我们的<strong class="ke ir"> IssueManualPayment </strong>操作。我们创建了一个有效期为两天的支付记录，此外，我们还生成了一个令牌。我们通过使用一个名为<strong class="ke ir">generatesaltedmd5 hash</strong>(<strong class="ke ir">PlatformPasswordUtils</strong>扩展)的函数来实现这个功能，并使用一个组合字符串作为输入。<a class="ae lk" href="https://en.wikipedia.org/wiki/MD5#Overview_of_security_issues" rel="noopener ugc nofollow" target="_blank"> <strong class="ke ir">尽管我们知道MD5不再是一种安全的散列算法</strong> </a>，但它适合我们正在做的事情，并且很明显，如果需要增加安全性，您可以随时改进它。</p><p id="9f8d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后，在生成令牌时，我们生成带有站点属性(应该是类似https://www.example.com/的东西)和两个输入参数的OutURL参数，即:</p><ul class=""><li id="1b11" class="nq nr iq ke b kf kg kj kk kn ns kr nt kv nu kz nv nw nx ny bi translated"><strong class="ke ir"> tk </strong>用于支付令牌，以及</li><li id="6210" class="nq nr iq ke b kf nz kj oa kn ob kr oc kv od kz nv nw nx ny bi translated">付款标识符的<strong class="ke ir"> pid </strong></li></ul><p id="e71f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">了解了这一点，我们就可以安全地重新生成令牌字符串，以确保请求的完整性。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pb"><img src="../Images/3364982a87215492c2f4efc2b3158104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDIZ4It6xFs5QQAb56RKfg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图27 —用于手动生成付款的示例电子邮件。</strong></figcaption></figure><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pc"><img src="../Images/0629e98e53da25ffdaf206e6b3982b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzojTtveXaxBrP1LXu3wig.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图28 —一次性付款表格样本。注意:这不在模块中捆绑。</strong></figcaption></figure><p id="d7b7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">支付成功后，您将在我们的控制面板上看到以下内容:</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pd"><img src="../Images/55af0245b7d600fd537b034d2780003f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivHwfJSeJfgtqTa74QgwfA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图29 —成功支付</strong></figcaption></figure><p id="0d36" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在上面的图29中，我们可以看到一次成功的支付。我们有历史条目，有PSP参考，授权码和结果码。结果代码的特殊说明:在上一篇文章中，我没有将这个值存储在我们的<strong class="ke ir"> PaymentAttempt </strong>实体中。我现在正在存储它，如果您想使用本文中描述的模块，您必须更新您的Adyen核心模块。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pe"><img src="../Images/343cd10855bd2e2f4f8140b7588e46b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hmilRkxeyRBoPUAqnJac5w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图30 —成功退款。</strong></figcaption></figure><p id="f194" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在图30中，我们有同一笔付款的历史记录，但这次是退款。如你所见，退款既没有授权也没有结果代码。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi pf"><img src="../Images/d0fae8bf8b0b302ab3122171e3aeef99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ua9iZXWKY_tnlsYmS8ctg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated"><strong class="bd mf">图31 —拒绝付款</strong></figcaption></figure><p id="1367" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后但同样重要的是，在图31中，我们可以看到拒绝付款的场景。如前所述，我们仍然有PSP参考和结果代码。</p><p id="e24d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这就是本文的全部内容。亲爱的读者，我要感谢你，感谢你为此付出的努力。我还要感谢所有分享和评论这篇文章的人。接收真的很好！</p><p id="6d23" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在下一篇文章中，我们将讨论与<strong class="ke ir"> Fixer.io </strong>的集成，这是一个用于当前和历史外汇(forex)汇率的简单轻量级API。不过，这有一个警告:它只是部分“免费”。幸运的是，我们想要实现的内容包含在免费层中，所以…我们很好。</p><p id="632e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">和往常一样，请在下面留言或通过<a class="ae lk" href="mailto:hello@armandogom.es" rel="noopener ugc nofollow" target="_blank"> hello@armandogom.es </a>留言。你也可以在<a class="ae lk" href="https://www.twitter.com/portuguesecoder" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lk" href="https://www.linkedin.com/in/armandogomes" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae lk" href="https://www.outsystems.com/profile/56884/" rel="noopener ugc nofollow" target="_blank"> OutSystems Community </a>或者我的网站<a class="ae lk" href="https://armandogom.es" rel="noopener ugc nofollow" target="_blank"> https://armandogom.es </a>上找到我，尽管在撰写本文时还没有准备好。</p><p id="4374" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">保重，下次见！</p><h2 id="1906" class="pg me iq bd mf ph pi dn mj pj pk dp mn kn pl pm mr kr pn po mv kv pp pq mz pr bi translated">相关链接</h2><p id="4ac4" class="pw-post-body-paragraph kc kd iq ke b kf or kh ki kj os kl km kn ot kp kq kr ou kt ku kv ov kx ky kz ij bi translated"><strong class="ke ir"> AdyenCore组件(更新):</strong><a class="ae lk" href="https://www.outsystems.com/forge/Component_Overview.aspx?ProjectId=4015" rel="noopener ugc nofollow" target="_blank">https://www.outsystems.com/forge/Component_Overview.aspx?ProjectId=4015 </a></p><p id="5756" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir"> Adyen网络客户端:</strong><a class="ae lk" href="https://www.outsystems.com/forge/Component_Overview.aspx?ProjectId=4050" rel="noopener ugc nofollow" target="_blank">https://www.outsystems.com/forge/Component_Overview.aspx?ProjectId=4050 </a></p><p id="f416" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke ir">艾德安控制面板:【https://www.outsystems.com/forge/Component_Overview.aspx?】T22</strong>ProjectId=4051 </p></div></div>    
</body>
</html>