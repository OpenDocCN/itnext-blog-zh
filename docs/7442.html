<html>
<head>
<title>Note on Using Latest Firebase v9 in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用最新Firebase v9的注意事项</h1>
<blockquote>原文：<a href="https://itnext.io/note-on-using-latest-firebase-v9-in-angular-f6591d48b851?source=collection_archive---------1-----------------------#2022-09-25">https://itnext.io/note-on-using-latest-firebase-v9-in-angular-f6591d48b851?source=collection_archive---------1-----------------------#2022-09-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dbeb1615b1213a4eb74dd64d6442b683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gf2fv9T_KFvuHbIWRMKMXA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Angular + Firebase v9</figcaption></figure><p id="4f42" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="https://firebase.blog/posts/2021/08/the-new-firebase-js-sdk-now-ga" rel="noopener ugc nofollow" target="_blank"> Firebase v9发布了一段时间</a>,其优点是树摇动(删除未使用的代码),使您的web应用程序尽可能小而快。</p><p id="726a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">感谢<a class="ae ld" href="https://github.com/angular/angularfire" rel="noopener ugc nofollow" target="_blank"> @angular/fire </a>的贡献者们，我们有机会迁移我们的angular应用程序来利用模块化方法。</p><p id="3816" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是我从compat迁移到真正的Firebase v9后的笔记。</p><h1 id="f6f2" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">初始化+仿真器</h1><p id="189f" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">兼容v9</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="54ff" class="mq lf it mm b gy mr ms l mt mu">// app.module.ts</span><span id="19b4" class="mq lf it mm b gy mv ms l mt mu">import { AngularFireModule } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/compat'<br/>import { AngularFireAuthModule, USE_EMULATOR as USE_AUTH_EMULATOR } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/compat/auth'<br/>import { AngularFirestoreModule, USE_EMULATOR as USE_FIRESTORE_EMULATOR } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/compat/firestore'<br/>import { AngularFireFunctionsModule, USE_EMULATOR as USE_FUNCTIONS_EMULATOR } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/compat/functions'<br/>import { AngularFireStorageModule, BUCKET } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/compat/storage'</span><span id="9c9d" class="mq lf it mm b gy mv ms l mt mu"><a class="ae ld" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  ...<br/>  imports: [<br/>    AngularFireAuthModule,<br/>    AngularFirestoreModule,<br/>    AngularFireStorageModule,<br/>    AngularFireFunctionsModule,<br/>    AngularFireModule.initializeApp(environment.firebase),<br/> ],<br/>  providers: [<br/>    {<br/>      provide: BUCKET,<br/>      useValue: environment.firebase.storageBucket,<br/>    },<br/>    { <br/> provide: USE_AUTH_EMULATOR, <br/> useValue: environment.useEmulators ? ['<a class="ae ld" href="http://localhost:9099'" rel="noopener ugc nofollow" target="_blank">http://localhost:9099'</a>] : undefined <br/>    },<br/>    { <br/> provide: USE_FIRESTORE_EMULATOR, <br/> useValue: environment.useEmulators ? ['localhost', 8080] : undefined <br/>    },<br/>    { <br/> provide: USE_FUNCTIONS_EMULATOR, <br/> useValue: environment.useEmulators ? ['localhost', 5001] : undefined <br/>    },<br/>  ],<br/>})</span></pre><p id="f98f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">v9</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="4c65" class="mq lf it mm b gy mr ms l mt mu">// app.module.ts</span><span id="6ab5" class="mq lf it mm b gy mv ms l mt mu">import { getApp, initializeApp, provideFirebaseApp } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/app'<br/>import { connectAuthEmulator, getAuth, provideAuth } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/auth'<br/>import { BUCKET } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/storage'<br/>import {<br/>  connectFirestoreEmulator,<br/>  Firestore,<br/>  getFirestore,<br/>  initializeFirestore,<br/>  provideFirestore,<br/>} from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/firestore'<br/>import { connectFunctionsEmulator, Functions, getFunctions, provideFunctions } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/functions'<br/>import { connectStorageEmulator, getStorage, provideStorage } from '<a class="ae ld" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a>/storage'<br/>import { environment } from 'src/environments/environment'</span><span id="2ce2" class="mq lf it mm b gy mv ms l mt mu"><a class="ae ld" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  ...<br/>  imports: [<br/>    provideFirebaseApp(() =&gt; initializeApp(environment.firebase)),<br/>    provideAuth(() =&gt; {<br/>      let auth = getAuth()<br/>      if (environment.useEmulators) {<br/>        connectAuthEmulator(auth, '<a class="ae ld" href="http://localhost:9099'" rel="noopener ugc nofollow" target="_blank">http://localhost:9099'</a>, { disableWarnings: false })<br/>      }<br/>      return auth<br/>    }),<br/>    provideFirestore(() =&gt; {<br/>      let firestore: Firestore<br/>      if (environment.useEmulators) {<br/>        // long polling for Cypress<br/>        firestore = initializeFirestore(getApp(), {<br/>          experimentalForceLongPolling: true,<br/>        })<br/>        connectFirestoreEmulator(firestore, 'localhost', 8080)<br/>      } else {<br/>        firestore = getFirestore()<br/>      }<br/>      return firestore<br/>    }),<br/>    provideStorage(() =&gt; {<br/>      const storage = getStorage()<br/>      if (environment.useEmulators) {<br/>        connectStorageEmulator(storage, 'localhost', 9199)<br/>      }<br/>      return storage<br/>    }),<br/>    provideFunctions(() =&gt; {<br/>      let functions: Functions<br/>      functions = getFunctions()<br/>      if (environment.useEmulators) {<br/>        connectFunctionsEmulator(functions, 'localhost', 5001)<br/>      }<br/>      return functions<br/>    }),<br/>  ],<br/>  providers: [<br/>    {<br/>      provide: BUCKET,<br/>      useValue: environment.firebase.storageBucket,<br/>    },<br/>  ],<br/>})</span></pre><h1 id="4907" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">证明</h1><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8119" class="mq lf it mm b gy mr ms l mt mu">import { Auth} from '@angular/fire/auth'</span><span id="2464" class="mq lf it mm b gy mv ms l mt mu">constructor(private auth: Auth) {...}</span></pre><p id="d500" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">获取用户</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="c670" class="mq lf it mm b gy mr ms l mt mu">import { Auth, authState } from '@angular/fire/auth'</span><span id="edfb" class="mq lf it mm b gy mv ms l mt mu">this.user$ = authState(this.auth)</span></pre><p id="7c60" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh iu">谷歌登录</strong></p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="772e" class="mq lf it mm b gy mr ms l mt mu">login() {<br/>  const provider = new GoogleAuthProvider()<br/>  return this.oAuthLogin(provider)<br/>}</span><span id="7595" class="mq lf it mm b gy mv ms l mt mu">private oAuthLogin(provider) {<br/>  return from(signInWithPopup(this.auth, provider))<br/>  .pipe(<br/>    tap((credential) =&gt; this.updateUserData(credential.user))<br/>  )<br/>}</span></pre><h1 id="1446" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">数据库(Firestore)</h1><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="e7f2" class="mq lf it mm b gy mr ms l mt mu">import {Firestore} from '@angular/fire/firestore'</span><span id="fa90" class="mq lf it mm b gy mv ms l mt mu">...<br/>firestore = inject(Firestore)<br/>private votesCollectionRef = collectionGroup(this.firestore, Collection.Votes) as CollectionReference&lt;Vote&gt;</span></pre><p id="0b5f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一些动作</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="942a" class="mq lf it mm b gy mr ms l mt mu">// Retrieve data<br/>getUserVotes(userId: string) {<br/>  const colQuery = query(this.votesCollectionRef, <br/>     where('userId', '==', userId), where('isVoted', '==', true)<br/>  return collectionData(colQuery)<br/>}</span><span id="bf22" class="mq lf it mm b gy mv ms l mt mu">// Update data<br/>saveFeedback(feedback: Feedback) {<br/>  const docRef = doc(this.firestore, Collection.Feedbacks, feedback.feedbackId)<br/>  setDoc(docRef, feedback, { merge: true })<br/>}</span><span id="5b48" class="mq lf it mm b gy mv ms l mt mu">// Delete data<br/>deleteFeedback(feedbackId: string) {<br/>  const docRef = doc(this.firestore, Collection.Feedbacks, feedbackId)<br/>  deleteDoc(docRef)<br/>}</span></pre><p id="7f37" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">目前就这些。希望有帮助。</p></div></div>    
</body>
</html>