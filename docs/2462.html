<html>
<head>
<title>Case study: create a parallax effect directly on <img/> tags with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">案例研究:用JavaScript直接在<img/>标签上创建视差效果</h1>
<blockquote>原文：<a href="https://itnext.io/case-study-create-a-parallax-effect-directly-on-img-tags-with-javascript-35b8daf81471?source=collection_archive---------0-----------------------#2019-05-28">https://itnext.io/case-study-create-a-parallax-effect-directly-on-img-tags-with-javascript-35b8daf81471?source=collection_archive---------0-----------------------#2019-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="f8f3" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">web中的视差效果只与CSS背景图像属性一起工作，为什么？<strong class="jt ir">这个不太实用。</strong></p></blockquote><p id="7a41" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这是我的一个起点。我想有一个很好的视差效果直接应用于图像标签，有几个原因:</p><ul class=""><li id="7956" class="ks kt iq jt b ju jv jy jz kp ku kq kv kr kw ko kx ky kz la bi translated">在网络上使用图片是最自然的方式</li><li id="b041" class="ks kt iq jt b ju lb jy lc kp ld kq le kr lf ko kx ky kz la bi translated"><em class="js">背景图片</em>属性不支持图片标签、<em class="js"> srcset </em>和<em class="js">size</em>属性的等效</li><li id="3b51" class="ks kt iq jt b ju lb jy lc kp ld kq le kr lf ko kx ky kz la bi translated"><em class="js">使用CMS的背景图像</em>不理想</li></ul><p id="cd51" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">令人惊讶的是，我在任何地方都找不到这种库/插件，所以<strong class="jt ir">我决定创建一个新的</strong>。</p><h1 id="15bb" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">主要目标</h1><p id="4ac0" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb kp mg ke kf kq mh ki kj kr mi km kn ko ij bi translated">我希望能够在不改变HTML或CSS的情况下添加视差效果。原因是我已经有了一个几乎完成的网站，我没有看到自己把我所有的<em class="js"> &lt; img &gt; </em>标签改成<em class="js"> &lt; div &gt; </em>带<em class="js">背景图片</em>。</p><p id="bef4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这是本库的主线，我想有一个非常简单的方法来应用视差在任何网站上已经生产，没有任何返工。另外，<strong class="jt ir">一种非常流畅自然的动画感觉</strong>——这种效果应该只会加分，不会增加任何其他成本。</p><h1 id="744a" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">第1期:如何不破布局？</h1><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/9d9f13f28bf2d52a66fd04c9965ae088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PXglK8jOiLoUiANuEzKLIg.gif"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">如何不打破布局？</figcaption></figure><p id="7abd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">首先要考虑的是在不破坏布局的情况下管理图像的过渡。通常的视差效果位于一个非常特殊的区域，仅仅是为了这个目的而创建的，这种情况的主线是相反的。</p><p id="baa8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">视差应该很容易添加到任何有图像的地方，即使它位于两个文本块之间。你不希望图片在网站上的任何地方被转换，并可能与内容重叠。</p><h2 id="f30c" class="mz lh iq bd li na nb dn lm nc nd dp lq kp ne nf lu kq ng nh ly kr ni nj mc nk bi translated">解决办法</h2><p id="6b95" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb kp mg ke kf kq mh ki kj kr mi km kn ko ij bi translated">因此，我得出的结论是动态添加一个容器作为图像的父对象。该容器将具有与图像相同的尺寸和一个隐藏的溢出。现在，图像可以在不破坏布局的情况下从无限多的像素进行转换。</p><pre class="mk ml mm mn gt nl nm nn no aw np bi"><span id="bd45" class="mz lh iq nm b gy nq nr l ns nt">&lt;img src="image.jpg" alt="image" /&gt;</span></pre><p id="a0d3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">会变成:</p><pre class="mk ml mm mn gt nl nm nn no aw np bi"><span id="ee4b" class="mz lh iq nm b gy nq nr l ns nt">&lt;div style="overflow: hidden"&gt;<br/>    &lt;img src="image.jpg" alt="image" /&gt;<br/>&lt;/div&gt;</span></pre><h1 id="f2b5" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">第2期:如何避免空格？</h1><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/cb60ee242375fb6db275d3b5cf22440c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1pDH_Yhw2p7ZBm5ObmMrRA.gif"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">如何避免空格？</figcaption></figure><p id="8496" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">一个新的问题出现了，当图像达到其物理极限时出现空白。</p><p id="a437" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">考虑到整个要点是让<strong class="jt ir">页面的初始布局保持不变，这是很成问题的。更不用说最初规划的流畅自然的动画了。</strong></p><h2 id="de26" class="mz lh iq bd li na nb dn lm nc nd dp lq kp ne nf lu kq ng nh ly kr ni nj mc nk bi translated">解决办法</h2><p id="a3fb" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb kp mg ke kf kq mh ki kj kr mi km kn ko ij bi translated">我选择了这个解决方案:在图像上添加缩放变换。这意味着图像将有更多的物质需要转换。该范围可以通过下式轻松计算:</p><pre class="mk ml mm mn gt nl nm nn no aw np bi"><span id="0141" class="mz lh iq nm b gy nq nr l ns nt"><em class="js">(imageHeight * scale - imageHeight) = range</em></span></pre><p id="c17a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">例如，如果图像的高度为500像素，我们应用1.5的缩放比例，这意味着图像将有250像素的范围进行转换。</p><p id="a436" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">现在，我们需要使用一种更费力的计算方法来获得图像位置相对于视口的百分比:</p><pre class="mk ml mm mn gt nl nm nn no aw np bi"><span id="e7b3" class="mz lh iq nm b gy nq nr l ns nt"><em class="js">((viewportBottom - imageTop) / ((viewportHeight + imageHeight) / 100)) = percentage</em></span></pre><p id="4e7f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">最后将这个百分比转录到范围内:</p><pre class="mk ml mm mn gt nl nm nn no aw np bi"><span id="1b24" class="mz lh iq nm b gy nq nr l ns nt"><em class="js">((percentage / 100) * </em>range - range <em class="js">/ 2) = translation</em></span></pre><p id="772c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">因此<strong class="jt ir">可以使用<em class="js">变换:translate(平移)在图像上逐渐应用</em></strong>；属性。</p><h2 id="1599" class="mz lh iq bd li na nb dn lm nc nd dp lq kp ne nf lu kq ng nh ly kr ni nj mc nk bi translated">缺点:图像质量</h2><p id="9d88" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb kp mg ke kf kq mh ki kj kr mi km kn ko ij bi translated">从理论上讲，我们可以理解这样一个事实，如果将比例应用于图像，我们将会失去质量。</p><p id="7b55" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">实际上，<strong class="jt ir">如果缩放比例设置为1.3(这是库的默认值)，这几乎不会被注意到。如果你通过添加更大尺寸的图像来满足这一需求，甚至会更少——这意味着如果你的图像是500像素，你想应用1.5的比例，使用750像素宽度的图像来补偿。</strong></p><h1 id="6ad2" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">最终渲染</h1><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mj"><img src="../Images/283e3c17e87415059a5e475540f1589e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WevFRozRzlaD3KdtNPQHww.gif"/></div></div><figcaption class="mv mw gj gh gi mx my bd b be z dk translated">最终渲染</figcaption></figure><h1 id="35de" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">演出</h1><p id="e3b2" class="pw-post-body-paragraph jq jr iq jt b ju me jw jx jy mf ka kb kp mg ke kf kq mh ki kj kr mi km kn ko ij bi translated">随着视差动画，出现了<strong class="jt ir">性能警告</strong>。感谢<a class="ae nu" href="https://www.paulirish.com/" rel="noopener ugc nofollow" target="_blank"> Paul Irish </a>和<a class="ae nu" href="https://www.html5rocks.com/" rel="noopener ugc nofollow" target="_blank"> html5rocks </a>，已经提供并解释了很多答案。尽管如此，这里仍有许多工作要做，例如:</p><ul class=""><li id="c7db" class="ks kt iq jt b ju jv jy jz kp ku kq kv kr kw ko kx ky kz la bi translated">滚动事件是性能贪婪的，因此强烈建议使用<em class="js">请求动画帧</em>。我不再详述，因为其他人已经在<a class="ae nu" href="https://css-tricks.com/using-requestanimationframe/" rel="noopener ugc nofollow" target="_blank">中提到过这个问题。</a></li><li id="3d98" class="ks kt iq jt b ju lb jy lc kp ld kq le kr lf ko kx ky kz la bi translated"><em class="js">交叉点观察器API </em>非常强大，可以检查哪些元素在视口中可见。不需要考虑不在当前视口中的图像。</li><li id="58cc" class="ks kt iq jt b ju lb jy lc kp ld kq le kr lf ko kx ky kz la bi translated">一个关键点是减少<a class="ae nu" href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a" rel="noopener ugc nofollow" target="_blank">浏览器的回流</a>。其中一个解决方案是尽可能减少获取视口和元素偏移量。</li><li id="63d5" class="ks kt iq jt b ju lb jy lc kp ld kq le kr lf ko kx ky kz la bi translated">CSS硬件加速不是很出名，但是很强大。更改<em class="js">转换:translate x()；</em>到<em class="js">转换:translate 3d()；</em>将利用GPU的能力，为<a class="ae nu" href="https://blog.teamtreehouse.com/increase-your-sites-performance-with-hardware-accelerated-css" rel="noopener ugc nofollow" target="_blank">提供更好的性能</a>。</li></ul><p id="c495" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">表演是对已有成就的不断挑战。有一个永久的需求来改进那些可以改进的地方，特别是通过新技术或错误的初始实现。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="396b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">这个案例研究和这个库<strong class="jt ir">只反映我的观点</strong>。非常欢迎你对我上面说的任何事情提出质疑、辩论或争辩。</p><p id="e895" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kp kd ke kf kq kh ki kj kr kl km kn ko ij bi translated">最后，你可以在<a class="ae nu" href="https://simpleparallax.com/" rel="noopener ugc nofollow" target="_blank">simpleparallax.com</a>和<a class="ae nu" href="https://github.com/geosigno/simpleParallax" rel="noopener ugc nofollow" target="_blank"> github </a>上查看简单视差库。</p></div></div>    
</body>
</html>