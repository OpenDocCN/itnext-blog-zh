<html>
<head>
<title>Caching Python Dependencies for Production Stability on OpenShift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在OpenShift上缓存Python依赖项以实现生产稳定性</h1>
<blockquote>原文：<a href="https://itnext.io/caching-python-dependencies-for-production-stability-on-openshift-f49f4db1cead?source=collection_archive---------2-----------------------#2019-01-25">https://itnext.io/caching-python-dependencies-for-production-stability-on-openshift-f49f4db1cead?source=collection_archive---------2-----------------------#2019-01-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/63fee388d21625ed1dc24d507564648f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EiFzzNwugHvj7Wfc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">照片由<a class="ae kc" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> rawpixel </a>在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="a950" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你准备好了吗？您已经为部署到生产环境的Python应用程序做了一个关键的修复，但是<a class="ae kc" href="https://pypi.org/" rel="noopener ugc nofollow" target="_blank"> PyPi </a>出现了故障。当涉及到最大化生产中的稳定性和可用性时，隔离与您的依赖项相关的风险是至关重要的。如果您可以采取一个简单的步骤来最小化依赖中断的风险，并且它带来了对您的构建的性能提升的额外好处，您会接受吗？</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/1314df090dc660609fb3c31f585f8dc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HdtXy8ZY_d0tpTGH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">埃文·丹尼斯在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="6141" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<a class="ae kc" href="https://status.python.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lg"> PyPi </em>断电</a>，看起来不太可能真的发生。你可能会说，“那种情况下没有镜子吗”？而答案是<strong class="kf ir">是的</strong>有<a class="ae kc" href="https://jacobian.org/2010/jul/20/when-pypi-goes-down/" rel="noopener ugc nofollow" target="_blank">镜子给<em class="lg">PyPi</em>T19】。您的运营团队了解他们吗？运营团队知道如何为您的应用程序指定工作镜像吗？如果他们不需要担心这一点，不是更好吗？因为您已经用您的应用程序利用的依赖项创建了一个本地镜像。依赖缓存正是</a><a class="ae kc" href="https://github.com/devpi/devpi" rel="noopener ugc nofollow" target="_blank"> devpi </a>所提供的(具体来说就是<em class="lg"> devpi-server </em>)。</p><h1 id="3e86" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">在OpenShift上运行devpi</h1><p id="fa65" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">让<em class="lg"> devpi-server </em>在<a class="ae kc" href="https://www.openshift.com/" rel="noopener ugc nofollow" target="_blank"> OpenShift </a>上运行是一个简单的五步过程。这个简单的设置要归功于开源社区。通过定义<a class="ae kc" href="https://github.com/saily/openshift-devpi/blob/master/openshift/deployment.yaml" rel="noopener ugc nofollow" target="_blank">部署</a>和<a class="ae kc" href="https://github.com/saily/openshift-devpi/blob/master/openshift/service.yaml" rel="noopener ugc nofollow" target="_blank">服务</a>定义以及<a class="ae kc" href="https://hub.docker.com/r/widerin/openshift-devpi/" rel="noopener ugc nofollow" target="_blank">容器映像</a>，项目<a class="ae kc" href="https://github.com/saily/openshift-devpi" rel="noopener ugc nofollow" target="_blank"> openshift-devpi </a>已经完成了所有的前期工作。</p><blockquote class="mk ml mm"><p id="71d4" class="kd ke lg kf b kg kh ki kj kk kl km kn mn kp kq kr mo kt ku kv mp kx ky kz la ij bi translated"><code class="fe mq mr ms mt b">git clone https://github.com/saily/openshift-devpi.git<br/>oc login https://&lt;your-master-node&gt;:8443<br/>oc new-project devpi<br/>oc create -f openshift/deployment.yaml<br/>oc create -f openshift/service.yaml</code></p></blockquote><h1 id="7445" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">在OpenShift上使用devpi</h1><p id="0c1c" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">现在你有了<em class="lg"> devpi-server </em>并在<em class="lg"> OpenShift </em>上运行，你如何利用它呢？利用<em class="lg"> devpi </em>发挥作用的好处是，您可以在OpenShift上构建图像，尤其是在您使用<a class="ae kc" href="https://github.com/openshift/source-to-image" rel="noopener ugc nofollow" target="_blank"> Source to Image </a> (s2i)来创建图像流的情况下。</p><div class="mu mv gp gr mw mx"><a href="https://blog.openshift.com/create-s2i-builder-image/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd ir gy z fp nc fr fs nd fu fw ip bi translated">如何创建一个S2I建设者形象-红帽OpenShift博客</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">源到图像(S2I)是一个独立的工具，在创建生成器图像时非常有用。S2I也碰巧…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">blog.openshift.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jw mx"/></div></div></a></div><p id="f17c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将假设，既然你是用<a class="ae kc" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>开发并部署在<em class="lg"> OpenShift </em>上，你就跟上了开发趋势并使用<a class="ae kc" href="https://pipenv.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> Pipenv </a>进行依赖管理。如果你还没有使用<em class="lg"> Pipenv </em>，请看看它是不是一个真正伟大的工具。<em class="lg"> Pipenv </em>具有<a class="ae kc" href="https://pipenv.readthedocs.io/en/latest/advanced/#using-a-pypi-mirror" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">Pipenv _ PYPI _ MIRROR</strong></a>环境变量，用于指定备用镜像。为了利用集群上现在设置的<em class="lg"> devpi </em>，您需要将服务端点传递到<strong class="kf ir"> PIPENV_PYPI_MIRROR </strong>变量中。如果您将<em class="lg"> devpi-server </em>部署到示例项目devpi，那么您将提供<em class="lg">http://devpi . devpi . SVC . cluster . local:3141</em>作为本地集群访问的输入值。或者，您可以定义一个允许您进行外部访问的路由，并提供该路由的URL。为了传入环境变量，您必须将其定义为您的<em class="lg"> BuildConfig </em>的一部分，参见链接的<a class="ae kc" href="https://github.com/project-koku/masu/blob/master/openshift/masu.yaml#L84" rel="noopener ugc nofollow" target="_blank">示例</a>。现在，当您创建应用程序时，您可以将它作为参数提供。如果未提供该参数，那么<em class="lg"> PyPi </em>将是默认值。有了所有这些，您还应该看到构建时间的显著性能改进。您还可以将<em class="lg"> devpi-server </em>上的<strong class="kf ir">DEVPI _ MIRROR _ CACHE _ EXPIRY</strong>值切换为高于(或低于)一天的默认值，这取决于您的依赖关系更改的频率。</p><h1 id="9fe9" class="lh li iq bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">摘要</h1><p id="e085" class="pw-post-body-paragraph kd ke iq kf b kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw mj ky kz la ij bi translated">希望这个故事已经告诉了您一个有用的新工具，<em class="lg"> devpi </em>，并为您提供了一组简短的步骤来强化您的生产环境，使其免受依赖性中断的影响。我们讨论了如何通过五个简单的步骤让<em class="lg"> devpi-server </em>在OpenShift上运行。接下来，我们看看图像创建如何利用<em class="lg"> devpi </em>并获得显著的速度提升。虽然这是一个对生产集群很有帮助的设置，但是它也可以用于开发集群或本地集群。如果你是一个在本地系统上运行<em class="lg"> OpenShift </em>的开发者，你甚至可以利用在<em class="lg"> OpenShift </em>之外进行本地开发时的性能提升，如果你在运行设置时添加一个外部路径并提供镜像。</p></div></div>    
</body>
</html>