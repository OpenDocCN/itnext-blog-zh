<html>
<head>
<title>Kubernetes — I: multi-node deployment using terraform and terragrunt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes — I:使用terraform和terragrunt的多节点部署</h1>
<blockquote>原文：<a href="https://itnext.io/kubernetes-i-multi-node-deployment-using-terraform-and-terragrunt-30c40a1238e8?source=collection_archive---------1-----------------------#2022-10-25">https://itnext.io/kubernetes-i-multi-node-deployment-using-terraform-and-terragrunt-30c40a1238e8?source=collection_archive---------1-----------------------#2022-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/fa997cadbd371abdfcc6c381bc78944b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-a7LLjP06CgISFfzIoF3Sg.png"/></div></div></figure><div class=""/><p id="8782" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在为这篇文章收集想法和信息时，我意识到Kubernetes的世界有太多不为人知的东西。我决定不再只写一个帖子，而是写一个关于Kubernetes的多部分系列，以一种结构化的方式教育你们所有人关于我所知道的和将要知道的关于Kubernetes的一切。我花了一段时间整理我所有的知识和经验，同时写这个帖子，从一个普通的角度来解释Kubernetes。一些博客系列，比如我虔诚关注的伊凡·维利奇科的博客系列，有助于建立对Kubernetes及其复杂性的基本理解。然而，除了<a class="ae kw" href="https://kubernetes.io/docs/concepts/overview/components/" rel="noopener ugc nofollow" target="_blank">架构组件</a>之外，对于组件如何在逻辑上相互叠加，比如Kubernetes-API的组件、定制资源定义、操作符、CNI等等，普遍缺乏理解。我将在接下来的文章中写下这些概念。</p><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi kx"><img src="../Images/3a71407ab834f7622be86d336c9b498f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uk1p4lh9SiXOlv3QvVHrBg.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Kubetnetes的建筑构件。来源:kubernetes.io</figcaption></figure><div class="ip iq gp gr ir lg"><a href="https://kubernetes.io/docs/concepts/overview/components/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">Kubernetes组件</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">Kubernetes集群由作为控制平面一部分的组件和一组称为…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">kubernetes.io</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu ix lg"/></div></div></a></div></div><div class="ab cl lv lw hu lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ij ik il im in"><p id="5ff7" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我之前的角色中，我有机会从零开始以各种规模部署Kubernetes。这些角色和经历使我将Kubernetes集群发行版本质上分为两种基本类型:</p><ul class=""><li id="682f" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">用户管理的开源Kubernetes集群，如<a class="ae kw" href="https://www.rancher.com/" rel="noopener ugc nofollow" target="_blank"> Rancher </a>、<a class="ae kw" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> kind </a>或<a class="ae kw" href="https://www.redhat.com/en/technologies/cloud-computing/openshift" rel="noopener ugc nofollow" target="_blank"> OpenShift </a>:这些Kubernetes集群通常作为开源和维护解决方案从其提供商处获得。用户可以在其底层基础设施上部署适合其用例的各种架构，或者依赖维护者提供的<a class="ae kw" href="https://www.suse.com/products/suse-rancher-hosted/" rel="noopener ugc nofollow" target="_blank">托管服务</a>。</li><li id="08e9" class="mc md jb ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">云管理的Kubernetes集群，如GKE、EKS和AKS:这些是由云提供商维护的Kubernetes的公开可用、易于设置的一键式部署变体。控制平面、其可扩展性和安全性的管理完全由云提供商负责，而数据平面的管理则由用户负责。</li></ul><div class="ip iq gp gr ir lg"><a href="https://cloud.google.com/kubernetes-engine" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">Kubernetes -谷歌Kubernetes引擎(GKE) |谷歌云</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">发送反馈最自动化和可扩展的托管Kubernetes平台。新客户可获得300美元的免费积分，用于…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">cloud.google.com</p></div></div><div class="lp l"><div class="mq l lr ls lt lp lu ix lg"/></div></div></a></div><div class="ip iq gp gr ir lg"><a href="https://aws.amazon.com/eks/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">托管Kubernetes服务-亚马逊EKS -亚马逊网络服务</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">亚马逊弹性Kubernetes服务(EKS)利用与AWS服务的内置集成，如EC2、VPC、IAM、EBS和…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">aws.amazon.com</p></div></div><div class="lp l"><div class="mr l lr ls lt lp lu ix lg"/></div></div></a></div><div class="ip iq gp gr ir lg"><a href="https://azure.microsoft.com/en-us/products/kubernetes-service/#overview" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">托管Kubernetes服务(AKS) | Microsoft Azure</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">Azure Kubernetes服务(AKS)是一种托管的Kubernetes服务，具有强化的安全性和快速交付。部署和…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">azure.microsoft.com</p></div></div><div class="lp l"><div class="ms l lr ls lt lp lu ix lg"/></div></div></a></div><p id="dcec" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这两种类型的集群发行版之间的主要区别在于，在用户管理的集群中，用户管理控制平面的安全性、冗余性和可扩展性，以及数据平面和两者之间的所有组件的安全性、冗余性和可扩展性。这与云管理的集群形成对比，在云管理的集群中，控制平面的可扩展性、冗余和安全性由云服务提供商管理，而用户管理数据平面的事务。有效地设置用户管理的集群是一项艰巨的任务，根据经验，需要花费大量的时间和精力来管理所有松散的部分。这些可以是以<a class="ae kw" href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/" rel="noopener ugc nofollow" target="_blank">的形式管理Kubernetes版本升级</a>、<a class="ae kw" href="https://docs.ranchermanager.rancher.io/how-to-guides/new-user-guides/kubernetes-clusters-in-rancher-setup/launch-kubernetes-with-rancher/use-new-nodes-in-an-infra-provider/vsphere/create-a-vm-template" rel="noopener ugc nofollow" target="_blank">正确配置底层虚拟机</a>、<a class="ae kw" href="https://docs.ranchermanager.rancher.io/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/back-up-rancher-launched-kubernetes-clusters" rel="noopener ugc nofollow" target="_blank">安全地对正在运行的集群进行快照</a>、<a class="ae kw" href="https://etcd.io/docs/v3.3/op-guide/recovery/" rel="noopener ugc nofollow" target="_blank">恢复etcd数据库</a>、<a class="ae kw" href="https://docs.ranchermanager.rancher.io/how-to-guides/new-user-guides/kubernetes-resources-setup/encrypt-http-communication" rel="noopener ugc nofollow" target="_blank">加密节点之间的通信</a>等等。然而，从零开始建立一个用户管理的Kubernetes集群是一个巨大的学习经历，这个过程教会了很多“耐心”和对所有管理的Kubernetes提供商的尊重。设置一个云管理的Kubernetes集群相当简单，只需要点击几下按钮就可以完成配置。然而，根据不同的用例，如何有效地设置您的托管集群来满足您的增长的可伸缩性和安全性可能有点棘手。</p><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mt"><img src="../Images/c93717a47265c148e47de262d18751cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qPWiTB3aKaRuMlvnnLrIQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Kubernetes和它的抽象的所有不同的角落！演职员表:<a class="ae kw" href="https://www.pionative.com/" rel="noopener ugc nofollow" target="_blank">https://www.pionative.com/</a></figcaption></figure><p id="dc2c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Kubernetes有不同的部署模式来满足用户的可伸缩性和冗余需求。这些是:</p><ul class=""><li id="ad1f" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">单实例部署:如<a class="ae kw" href="https://docs.ranchermanager.rancher.io/pages-for-subheaders/rancher-on-a-single-node-with-docker" rel="noopener ugc nofollow" target="_blank">牧场主码头工人部署</a>或<a class="ae kw" href="https://kind.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank">类</a>集群。在此部署中，Kubernetes安装在docker之上，docker安装在裸机或类似的计算实例上。它通常适用于学习、本地开发和调试场景，但由于可伸缩性和冗余性的限制，不建议用于生产用例。</li></ul><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/e8c8ef676909915cab5d6a948fa28edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3tWHZpBcrNlxEp_rYK2rkg.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">演职员表:kind.sigs.k8s.io</figcaption></figure><ul class=""><li id="f782" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">多工作节点部署:在这个部署中，有多个工作节点或节点组与单个实例控制平面通信。工作节点从控制平面承担任务和其他责任，并可以根据需要进行缩放设置。但是，如果工作节点的数量快速增长，则可能会出现瓶颈和/或延迟问题，因为单个控制平面可能会受到限制或可能不可用。</li></ul><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/43bf7133be5640c3bfd5790069e27bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kx801wGAQ5IpRzPecP6zSw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Kubernetes上的多节点部署。根据您的需求，工作节点的范围可以从1到n。</figcaption></figure><ul class=""><li id="825e" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">多工作节点HA部署:HA通常被称为高可用性部署。在这种部署中，多个冗余控制平面以仲裁方式运行，并且可能有也可能没有以HA集群格式并行运行的多个<a class="ae kw" href="https://kubernetes.io/docs/concepts/overview/components/#etcd" rel="noopener ugc nofollow" target="_blank"> etcd数据库</a>实例。每个控制平面通常部署到不同的可用性区域，这种设置可确保在一个或多个可用性区域停机的情况下，一个实例保证可用性。这种设置对于运行相似或相关应用程序或工作负载的多节点组来说很常见。当您希望在Kubernetes上调度或捆绑特定的应用程序组及其资源时，这种配置非常有用，并且所有类型的Kubernetes集群都支持这种配置。我们将在这篇文章的后面对此进行更多的讨论。</li></ul><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/b767199330965c9d512cf8164a57bd2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pPyfzz0P_7PG9Mqx7Du6Q.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">采用多节点策略的高可用性集群。请注意各个etcd集群，<a class="ae kw" href="https://learnk8s.io/etcd-kubernetes" rel="noopener ugc nofollow" target="_blank">在彼此之间共享状态</a> credits: kubernetes.io</figcaption></figure><ul class=""><li id="1368" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">具有外部etcd节点和多工作节点部署的HA冗余控制平面部署:在这种模式下，您的Kubernetes集群将如虎添翼！这可能是Kubernetes集群中最冗余和高可用性的形式，它的所有重要工作组件都完全分布在自然界中。这也是在生产环境中运行Kubernetes的推荐方式。</li></ul><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/ba53c6d9ebc2dda9069c46835c0bddb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TlJYo4NUwtGPxmMhxzQW4Q.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">鸣谢:kubernetes.io</figcaption></figure><div class="ip iq gp gr ir lg"><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">高可用性拓扑的选项</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">本页解释了配置高可用性(HA) Kubernetes集群拓扑的两个选项。你…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">kubernetes.io</p></div></div><div class="lp l"><div class="mx l lr ls lt lp lu ix lg"/></div></div></a></div><p id="e694" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我以前有机会部署Kubernetes的单实例docker部署，我们主要用于我们的开发环境，以及Rancher的高可用性Kubernetes集群和EKS和AKS集群的多节点部署。我发现，如果使用IaC以声明的方式定义资源，管理集群和向集群添加组件会容易得多。我曾经一起使用过terraform和terragrunt，也曾经写过如何用它们来最好地构建你的项目。通过terraform和terragrunt部署多节点集群使得这个过程变得简单易懂。</p><div class="ip iq gp gr ir lg"><a rel="noopener  ugc nofollow" target="_blank" href="/structuring-terraform-project-using-terragrunt-part-i-4c6e936c4858"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">使用terragrunt构建terraform项目—第一部分</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">这篇文章旨在提供一个关于如何构建你的terraform项目的观点，并用terragrunt对它进行配置…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">itnext.io</p></div></div><div class="lp l"><div class="my l lr ls lt lp lu ix lg"/></div></div></a></div><p id="62b5" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">讨论所有这些不同类型的部署模式的原因是为了理解我为什么选择写多节点部署。单节点部署非常适合实验或学习目的，但是没有什么实际价值，并且很少用于生产。随着越来越多的人从内部和自托管环境转向托管云服务，他们将受益于控制平面的开箱即用高可用性和冗余特性，您创建的任何新Kubernetes集群都可以随时使用这些特性。但是，数据平面仍然是用户的责任，了解扩展、隔离和分配工作负载的不同方式非常重要。</p><div class="ip iq gp gr ir lg"><a href="https://www.forbes.com/sites/forbestechcouncil/2021/03/12/why-migrate-to-the-cloud-the-basics-benefits-and-real-life-examples/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">Council Post:为什么迁移到云:基础知识、好处和现实生活中的例子</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">的首席执行官。Evgeniy是软件开发、技术创业和新兴技术方面的专家…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">www.forbes.com</p></div></div><div class="lp l"><div class="mz l lr ls lt lp lu ix lg"/></div></div></a></div><p id="edca" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在Kubernetes的世界里，理解<a class="ae kw" href="https://cloud.google.com/blog/products/gcp/exploring-container-security-isolation-at-different-layers-of-the-kubernetes-stack" rel="noopener ugc nofollow" target="_blank">隔离</a>的概念是很重要的。容器化应用程序是为您的应用程序和工作负载提供隔离环境的第一步。Kubernetes通过在pods中运行这些容器来提供初始隔离层，pods为在其中运行的应用程序容器提供隔离；包括<a class="ae kw" href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" rel="noopener ugc nofollow" target="_blank">网络策略</a>资源(我以前写过关于此类<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/network-policies-in-kubernetes-c983c1b5eee9">网络策略</a>的文章，鼓励你看看并尝试一下)。然后，相关的/相关的pod被弱隔离并封装在Kubernetes的名称空间中，这些名称空间限定了所有需要的资源(秘密、配置映射、角色、绑定、策略等)。)内部，这是pod成功运行所需要的。Kubernetes 中的<a class="ae kw" href="https://kubernetes.io/docs/concepts/architecture/nodes/" rel="noopener ugc nofollow" target="_blank">节点可以是运行pods的物理机或虚拟机，通常多个节点运行在一个Kubernetes集群中，由一个控制平面管理，该控制平面具有调度相关工作负载的特定策略。这可以通过在Kubernetes worker节点(或仅指托管集群中的worker节点)上调度这些应用程序来进一步补充，这些节点是为了托管类似的应用程序而特意创建的。节点通常构成Kubernetes集群的数据层，负责提供资源(CPU、内存、卷等。)和运行时(容器执行引擎，如</a><a class="ae kw" href="https://containerd.io/" rel="noopener ugc nofollow" target="_blank"> containerd </a>)到容器化的应用程序。该策略确保相关工作负载共享相同的计算资源，并驻留在相同的底层节点实例上。</p><figure class="ky kz la lb gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi na"><img src="../Images/e700aa6ab1367b475f6ff8ab46d10434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcfYydxFALYhfU3IRw7ozw.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">Kubernetes的隔离层。学分:cloud.google.com</figcaption></figure><p id="9f6b" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您通常需要Kubernetes运行某些基础级别的应用程序包，这些应用程序包构成了应用程序有效运行的重要组成部分。这些应用程序通常是在Kubernetes软件包管理器的帮助下安装和配置的，比如到目前为止Kubernetes最著名和最常用的软件包管理器<a class="ae kw" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm </a>。通过舵图安装的这些应用程序的一些例子有<a class="ae kw" href="https://cert-manager.io/" rel="noopener ugc nofollow" target="_blank">证书管理器</a>、<a class="ae kw" href="https://github.com/kubernetes/ingress-nginx" rel="noopener ugc nofollow" target="_blank">入口-nginx </a>、<a class="ae kw" href="https://linkerd.io/" rel="noopener ugc nofollow" target="_blank">链接器</a>等。这为您的Kubernetes集群添加了大量特性，并帮助您的应用程序实现其用例。然而，在Kubernetes看来，这些只是安排在它上面执行特定工作的吊舱。我们可以将这些应用程序简称为操作关键型应用程序或OpsApps。它们需要与其他面向客户端的应用程序隔离开来，以便它们拥有自己的专用资源，并且不会被任何消耗大量资源的客户端应用程序所阻碍。该策略将工作节点组分为两个基本类别:</p><ul class=""><li id="d781" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">OpsApps(关键业务应用程序)节点</li><li id="ba42" class="mc md jb ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">应用程序节点</li></ul><p id="0ead" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将创建一个高度可用的Kubernetes集群，它将运行多个worker节点，每个节点都有自己的用途和要调度的应用程序组。这将提供资源隔离，并更好地管理基础设施上的应用程序。为了实现这一点，我通过Anton Babenkov 的著名<a class="ae kw" href="https://registry.terraform.io/modules/terraform-aws-modules/vpc/aws/latest" rel="noopener ugc nofollow" target="_blank">模块创建了一个全新的VPC，它允许我几乎立即配置VPC、创建多AZ子网、配置网关和设置路由表。这节省了时间，并有助于建立一个可分解的环境。</a></p><figure class="ky kz la lb gt is"><div class="bz fp l di"><div class="nb nc l"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">我希望我能感谢Anton提供的这段完美的代码，它为您节省了设置生产级VPC和子网的时间。</figcaption></figure><p id="ec63" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一步是为Kubernetes设置<a class="ae kw" href="https://docs.aws.amazon.com/eks/latest/userguide/service_IAM_role.html" rel="noopener ugc nofollow" target="_blank"> IAM角色</a>、<a class="ae kw" href="https://docs.aws.amazon.com/eks/latest/userguide/security-iam-awsmanpol.html" rel="noopener ugc nofollow" target="_blank"> IAM策略</a>和<a class="ae kw" href="https://aws.github.io/aws-eks-best-practices/security/docs/" rel="noopener ugc nofollow" target="_blank">安全组</a>，以加强集群的安全性。我们需要创建这些不同的角色，因为它们负责管理集群的可伸缩性和安全性，并为它们分配相应的策略。</p><figure class="ky kz la lb gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><figure class="ky kz la lb gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="fdbf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们创建安全组和安全组规则，以限制对集群的访问。</p><figure class="ky kz la lb gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="e127" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后也是最后一步；创建Kubernetes集群，创建节点，并将所有组件连接在一起。</p><figure class="ky kz la lb gt is"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ff72" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建集群后，我们使用Kubernetes提供的不同技术使OpsApps pods附加到特定节点，并排斥该节点组中的其他应用程序。这些是节点亲合性、污染和容忍以及节点选择器机制。我们使用这些应用程序的舵图来配置与不同节点相关联的标签和选择器，以将它们调度到适当的节点上。</p><ul class=""><li id="6551" class="mc md jb ka b kb kc kf kg kj me kn mf kr mg kv mh mi mj mk bi translated">NodeSelector: Node Selector的工作方式非常类似于Node Affinity，不同之处在于它直接匹配节点标签。</li><li id="b841" class="mc md jb ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">节点亲和性和反亲和性:节点亲和性和反亲和性允许您高度定制pod调度的规则和逻辑。它比NodeSelector更具表达性，允许在符合特定规则或约束的节点上调度pod。</li><li id="88d5" class="mc md jb ka b kb ml kf mm kj mn kn mo kr mp kv mh mi mj mk bi translated">污染和容忍:<em class="nd">节点亲和性</em>是Pods的一个属性，它将Pods吸引到一组节点上(作为一种偏好或硬性要求)。<em class="nd">污点</em>则相反；它们允许一个节点排斥一组豆荚。容忍适用于pod，并允许(但不要求)pod调度到具有匹配污点的节点上。</li></ul><div class="ip iq gp gr ir lg"><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">将窗格分配给节点</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">您可以约束一个Pod，使它被限制在特定的节点上运行，或者更喜欢在特定的节点上运行…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">kubernetes.io</p></div></div><div class="lp l"><div class="ne l lr ls lt lp lu ix lg"/></div></div></a></div><p id="c2f4" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将很快贴出一个如何做到这一点的例子！</p><p id="4827" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nd"> PS。如果你觉得这有用，我真的很感激github repo上的一颗星，因为它允许我在未来创建更多相关的内容。</em></p><div class="ip iq gp gr ir lg"><a href="https://github.com/aliabbasjaffri/multinode-terraform-terragrunt" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab fo"><div class="li ab lj cl cj lk"><h2 class="bd jc gy z fp ll fr fs lm fu fw ja bi translated">GitHub-aliabbasjaffri/multi node-terraform-terra grunt:多节点terra form代码库…</h2><div class="ln l"><h3 class="bd b gy z fp ll fr fs lm fu fw dk translated">在AWS云上使用terragrunt的多节点terraform代码存储库我使用terraform和terragrunt是为了…</h3></div><div class="lo l"><p class="bd b dl z fp ll fr fs lm fu fw dk translated">github.com</p></div></div><div class="lp l"><div class="nf l lr ls lt lp lu ix lg"/></div></div></a></div></div></div>    
</body>
</html>