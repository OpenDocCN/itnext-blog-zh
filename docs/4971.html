<html>
<head>
<title>Remote Developing with VsCode on AWS Cloud9 EC2 Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS Cloud9 EC2实例上使用VsCode进行远程开发</h1>
<blockquote>原文：<a href="https://itnext.io/remote-developing-with-vscode-on-aws-cloud9-ec2-instance-e18134af353f?source=collection_archive---------0-----------------------#2020-11-06">https://itnext.io/remote-developing-with-vscode-on-aws-cloud9-ec2-instance-e18134af353f?source=collection_archive---------0-----------------------#2020-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="3f7d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">动机</h1><p id="a4f1" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我通常使用IntelliJ IDE在我的本地Macbook 13”上开发，但是当开始使用大量docker容器图像时，我很快就填满了我的小型本地硬盘，并且我的CPU在并行处理几个IDE项目时遇到了困难。我通常需要在一周内多次重启我的机器，这非常耗费时间。由于我无法增加我的笔记本电脑的功能，我决定看看如何在对我的工作方式影响最小的情况下利用云资源。</p><p id="c937" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我从事的最后一个项目是使用<a class="ae lo" href="https://aws.amazon.com/cdk/" rel="noopener ugc nofollow" target="_blank"> AWS云开发工具包(CDK) </a>的基础设施代码。CDK是一个开源软件开发框架，用代码定义云基础设施，并通过AWS CloudFormation提供它。它提供了一个高级的面向对象的抽象来使用现代编程语言的能力强制性地定义AWS资源。使用CDK的基础设施构造库，您可以轻松地将AWS最佳实践封装在您的基础设施定义中并共享它，而不用担心样板逻辑。</p><p id="5879" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我想找到一个能够在远程云实例上工作的解决方案，同时保持我在本地笔记本电脑上习惯的开发人员体验。</p><h1 id="dc53" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">利益</h1><ul class=""><li id="15fe" class="lp lq iq kn b ko kp ks kt kw lr la ls le lt li lu lv lw lx bi translated">大幅降低我在本地笔记本电脑上处理项目时的功耗</li><li id="6894" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">简化开发流程，消除将本地代码同步到云实例的需要。</li><li id="eaa4" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">不需要保留代码的两个副本，一个在本地磁盘上，另一个在云实例上。</li><li id="5846" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">云实例比笔记本电脑具有更强的计算能力，有些事情在笔记本电脑上无法完成</li><li id="abae" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">你只能在需要的时候激活云实例，所以闲置时不会付费。</li></ul><h1 id="f1c4" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">云9</h1><p id="8bdc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae lo" href="https://console.aws.amazon.com/cloud9/home/product" rel="noopener ugc nofollow" target="_blank"> AWS Cloud9 </a>是一个基于云的集成开发环境(IDE)，让你只需一个浏览器就能编写、运行和调试你的代码。它包括代码编辑器、调试器和终端。Cloud9预装了流行编程语言的基本工具，包括Javascript、Python、PHP等，因此您不需要安装文件或配置您的开发机器来启动新项目。<br/>由于Cloud9 IDE是基于云的，你可以在任何地方使用联网的机器来完成你的项目。借助Cloud9，您还可以快速地与团队共享您的开发环境，使您能够配对程序并实时跟踪彼此的输入。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/7993d63892ca350b04263e73fceecee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BsE9PWbZX6G35Z5m.png"/></div></div></figure><blockquote class="mp mq mr"><p id="6ec5" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated"><em class="iq">我们可以看到Cloud9是什么样子，编辑器在我的CDK项目上，终端有访问我的AWS环境的凭证。</em></p></blockquote><p id="91c9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">AWS Cloud9附带了一个终端，它包括托管Amazon EC2实例的sudo特权，该实例托管您的开发环境和一个预认证的AWS命令行界面。这使得您可以轻松地快速运行命令并直接访问AWS服务。</p><p id="c7c6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">AWS Cloud9为通过Cloud9创建的Amazon EC2实例提供了30分钟的默认<strong class="kn ir">自动休眠</strong>设置。使用此设置，EC2实例会在您停止使用IDE 30分钟后自动停止，并且只有在您重新打开IDE时才会重新启动。</p><p id="4fff" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">因此，通常只有在您积极工作时才会产生EC2实例费用。当您的实例需要重启时，您会丢失IDE中任何活动的终端会话(但是您可以使用像<a class="ae lo" href="https://fr.wikipedia.org/wiki/Tmux" rel="noopener ugc nofollow" target="_blank"> tmux </a>这样的工具来保存它们),并且在打开IDE时会经历一些等待时间。根据您的使用情况，您可以配置自动休眠设置，甚至选择“always on”来保持EC2实例活动。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/c89706f4b845e8f15be59259e0e08b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/0*0dB3nYMjd34lj2Hj.png"/></div></figure><p id="9754" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Cloud9是一个实实在在的进步，但是有时候，你需要一个更强大的ide，Visual Studio代码可以是其中之一。</p><blockquote class="mp mq mr"><p id="a62d" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated"><em class="iq">但是嘿！如果您能从您的Cloud9环境中受益来运行您的Visual Studio代码集成开发环境，那会怎么样？</em></p></blockquote><h1 id="6146" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">远程Visual Studio代码</h1><p id="1308" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">Visual Studio Code 是一个轻量级但功能强大的源代码编辑器，可以在你的桌面上运行。它内置了对JavaScript、Typescript和Node.js的支持，并为其他语言和运行时提供了丰富的扩展生态系统。</p><p id="4ce9" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">但是这里让我们感兴趣的是VsCode提出了一个<a class="ae lo" href="https://code.visualstudio.com/docs/remote/ssh" rel="noopener ugc nofollow" target="_blank">远程开发模式</a>，允许我们使用远程机器作为全功能开发环境:不需要在本地机器上有源代码。来自marketplace的<a class="ae lo" href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack" rel="noopener ugc nofollow" target="_blank">远程开发扩展包</a>中的每个扩展都可以直接在远程机器中运行命令和其他扩展，这样一切就像在本地运行一样。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mx"><img src="../Images/776ade67f0d44ba71f9bd226f26abbfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3rWEdQA51BUmYlrG.png"/></div></div></figure><p id="5b53" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">这里的事情是，我们可以简单地重用与我们的Cloud9 IDE一起部署的相同的托管EC2实例，这样我们就可以选择使用Cloud9或VsCode或两者来管理相同的源代码，并将受益于Cloud9的自动休眠功能，从而让我们节省资金。</p><p id="e2fa" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">安装远程开发模式后:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div class="gh gi my"><img src="../Images/d5814da1528f4b05d26b1c7def9ad678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/0*RqQ8tWrgRnnn0-kk.png"/></div></figure><blockquote class="mp mq mr"><p id="aa72" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated"><em class="iq"> VsCode可以访问您的本地ssh配置，然后可以连接到您想要的任何EC2实例。</em></p><p id="6971" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated"><strong class="kn ir">编辑2022 </strong>:我已经更新了我的设置，强制连接使用<a class="ae lo" href="https://aws.amazon.com/fr/systems-manager/" rel="noopener ugc nofollow" target="_blank"> AWS系统管理器</a>，如这个<a class="ae lo" href="https://aws.amazon.com/blogs/architecture/field-notes-use-aws-cloud9-to-power-your-visual-studio-code-ide/" rel="noopener ugc nofollow" target="_blank">博客</a>中所描述的，使用SSM而不是SSH从我的笔记本电脑连接到Cloud9实例。这样，我的实例就不能再通过SSH访问了，这提高了我的安全性。为此，我用proxy命令和代理脚本<a class="ae lo" href="https://github.com/aws-samples/cloud9-to-power-vscode-blog/blob/main/scripts/ssm-proxy.sh" rel="noopener ugc nofollow" target="_blank"> ssm-proxy.sh </a>更新了我的ssh配置文件:</p></blockquote><pre class="me mf mg mh gt mz na nb bn nc nd bi"><span id="97dd" class="ne jo iq na b be nf ng l nh ni">Host sebCloud9<br/> User ubuntu<br/> HostName i-xxxxxxxxxxxx<br/> ForwardAgent yes<br/> ProxyCommand sh -c "~/.ssh/ssm-proxy.sh %h %p"</span></pre><p id="9a69" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">左侧有一个新菜单，指向您的<code class="fe nj nk nl na b">~/.ssh/config</code>文件，您可以在其中配置对Cloud9 EC2实例的访问。</p><p id="77d6" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">然后，您可以选择一个目标，让VsCode连接并安装必要的代码，以便远程使用VSCode。</p><blockquote class="mp mq mr"><p id="f515" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated"><strong class="kn ir"> <em class="iq">注1: </em> </strong> <em class="iq">显然，您首先需要允许对EC2实例的外部访问，通过启用您的安全组来允许从您的开发机器进行SSH访问。<br/> </em> <strong class="kn ir"> <em class="iq">注2: </em> </strong> <em class="iq">将弹性IP地址映射到您的Cloud9实例更容易，因此当它重新启动时，您将始终拥有相同的公共IP。</em></p></blockquote><p id="37d3" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">现在，您可以远程工作，就像您的所有文件都在本地笔记本电脑上一样，这非常强大:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nm"><img src="../Images/2b9d548a4c3bc39d1fb4b57ccd65737c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LEeM0s25ekvCJkEt.png"/></div></div></figure><blockquote class="mp mq mr"><p id="9f70" class="kl km ms kn b ko lj kq kr ks lk ku kv mt ll ky kz mu lm lc ld mv ln lg lh li ij bi translated">你可以在左下角看到一条消息，告诉我我正在远程使用我的cloud9实例。</p></blockquote><p id="4b90" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">以下是开始使用VsCode的一些提示:</p><ul class=""><li id="560a" class="lp lq iq kn b ko lj ks lk kw nn la no le np li lu lv lw lx bi translated"><a class="ae lo" href="https://code.visualstudio.com/shortcuts/keyboard-shortcuts-macos.pdf" rel="noopener ugc nofollow" target="_blank">键盘快捷键</a></li></ul><p id="230d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">如果你想保持你的终端状态，你可以使用<a class="ae lo" href="https://github.com/tmux/tmux/wiki" rel="noopener ugc nofollow" target="_blank"> <strong class="kn ir"> Tmux </strong> </a>和<strong class="kn ir"> resurect </strong>插件，见我的<code class="fe nj nk nl na b">.tmux.conf</code>的摘录</p><pre class="me mf mg mh gt mz na nq nr aw ns bi"><span id="f7a5" class="nt jo iq na b gy nu nv l nw ni">set -g @plugin 'tmux-plugins/tpm'<br/>set -g @plugin 'tmux-plugins/tmux-resurrect'<br/>set -g @plugin 'tmux-plugins/tmux-continuum'</span></pre><p id="af30" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">当您想在实例自动休眠后启动它时，有几种选择:</p><ul class=""><li id="996b" class="lp lq iq kn b ko lj ks lk kw nn la no le np li lu lv lw lx bi translated">连接到Cloud9，这将启动您的实例。</li><li id="4137" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">从web控制台启动您的实例。</li><li id="1c76" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">从cli启动您的实例</li></ul><p id="8493" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">为了从cli启动我的cloud9实例，我使用了这个别名:</p><pre class="me mf mg mh gt mz na nq nr aw ns bi"><span id="eb5e" class="nt jo iq na b gy nu nv l nw ni">cloud9Up='aws --region us-east-2 ec2 start-instances --instance-id=$(aws --region us-east-2 ec2 describe-instances | jq -r '\''.Reservations[].Instances[] | select((.Tags[]|select(.Key=="Name")|.Value) | match("cloud9") ) | .InstanceId'\'')'</span></pre><h1 id="bd0d" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">使用VsCode调试基于Jest的单元测试</h1><p id="5bbf" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我想用这个新设置实现的是能够快速构建和调试CDK应用程序。我将了解如何在VsCode中为这个应用程序设置调试。</p><p id="9b84" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">Jest已经成为构建单元测试的事实标准。只需设置启动配置文件，就可以将Visual Studio代码调试功能集成到基于Jest的测试套件中。</p><p id="467d" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在调试中选择配置并选择<code class="fe nj nk nl na b">Add Configuration...</code>并选择<code class="fe nj nk nl na b">Jest: Default jest configuration</code>。</p><p id="c782" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">在我的例子中，我还添加了一些我的cdk测试所需的env var，最终文件看起来像这样:</p><pre class="me mf mg mh gt mz na nq nr aw ns bi"><span id="d03e" class="nt jo iq na b gy nu nv l nw ni">{<br/>    // Use IntelliSense to learn about possible attributes.<br/>    // Hover to view descriptions of existing attributes.<br/>    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387<br/>    "version": "0.2.0",<br/>    "configurations": [</span><span id="9b9c" class="nt jo iq na b gy nx nv l nw ni">        {<br/>            "type": "node",<br/>            "name": "vscode-jest-tests",<br/>            "request": "launch",<br/>            "program": "${workspaceFolder}/typescript/node_modules/jest/bin/jest",<br/>            "args": [<br/>                "--runInBand",<br/>                "-c",<br/>                "./jest.config.js"<br/>            ],<br/>            "env": {<br/>                "CDK_DEFAULT_ACCOUNT": "xxxxxxxxxxxx",<br/>                "CDK_DEFAULT_REGION": "eu-west-1"<br/>            },<br/>            "cwd": "${workspaceFolder}/typescript",<br/>            "console": "integratedTerminal",<br/>            "internalConsoleOptions": "neverOpen",<br/>            "disableOptimisticBPs": true,<br/>            <br/>        },<br/>    ]<br/>}</span></pre><p id="80a1" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">我们现在可以使用断点调试代码，就像在本地一样:</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ny"><img src="../Images/a41adde45e60c0fb550201b3f2998fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*06mU0p-c1FJWqzlX.png"/></div></div></figure><p id="1166" class="pw-post-body-paragraph kl km iq kn b ko lj kq kr ks lk ku kv kw ll ky kz la lm lc ld le ln lg lh li ij bi translated">通过这种设置，所有用于运行/调试的CPU、所有docker映像都在云中运行，不再耗尽我的笔记本电脑资源。我真的很喜欢这个新设置:)</p></div></div>    
</body>
</html>