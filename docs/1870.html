<html>
<head>
<title>Pimp My Kubernetes Shell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">拉皮条我的Kubernetes外壳</h1>
<blockquote>原文：<a href="https://itnext.io/pimp-my-kubernetes-shell-f144710232a0?source=collection_archive---------1-----------------------#2019-02-14">https://itnext.io/pimp-my-kubernetes-shell-f144710232a0?source=collection_archive---------1-----------------------#2019-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3d05008413172e471ed4a6d04846dcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*09Ocgtr0fvas-p4Mt-gFZw.png"/></div></div></figure><p id="4e4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从几个问题开始:</p><p id="b730" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">你是否曾经盯着终端窗口却不记得它是为哪个Kubernetes集群设置的？</em></p><p id="43c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">多个Kubernetes集群的多个终端窗口怎么样？</em></p><p id="71df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">你是否厌倦了一遍又一遍的输入</em> <code class="fe kx ky kz la b"><em class="kw">export KUBECONFIG</em></code> <em class="kw">或者</em> <code class="fe kx ky kz la b"><em class="kw">kubectl get pod -n demo</em></code> <em class="kw">命令？</em></p><p id="7fad" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果答案是肯定的，请继续阅读，因为我们可以解决这些问题，并使它变得更加有趣！</p><p id="36b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们的环境中，我们总是同时有几个不同的Kuberenetes集群，当然有不同的风格:</p><ul class=""><li id="8823" class="lb lc iq ka b kb kc kf kg kj ld kn le kr lf kv lg lh li lj bi translated">多个Kubernetes版本:1.11、1.12和1.13</li><li id="7752" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">不同的网络解决方案:法兰绒、印花布、AWS-VPC-CNI</li><li id="b49f" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">带iptables模式的KubeProxy与IPVS模式</li><li id="8966" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">KubeProxy IPVS模式与不同的负载平衡算法:循环，最少连接，最短的预期延迟，等等。</li><li id="024c" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">常见环境:生产、试运行、QA、开发和POC</li></ul><p id="301b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这些集群之间切换并高效工作可能是一个真正的挑战。很容易忘记哪个终端是为哪个集群建立的。我不得不一直输入<code class="fe kx ky kz la b"><strong class="ka ir">kubectl cluster-info</strong></code>来显示当前的集群名称。</p><p id="e89b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">过了一段时间，我真的厌倦了。此外，我懒得一遍又一遍地输入相同的命令。那是我开始推销我的k8s外壳的时候。</p><h1 id="223f" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">使用kubectl别名</h1><pre class="mn mo mp mq gt mr la ms mt aw mu bi"><span id="5c39" class="mv lq iq la b gy mw mx l my mz"># Step 1: kubectl has 7 characters, make it 1<br/>alias k=kubectl</span><span id="5724" class="mv lq iq la b gy na mx l my mz"># Step 2: follow your own preferred way<br/>alias kg='kubectl get'<br/>alias kl='kubectl logs '<br/>alias kx='kubectl exec -i -t'<br/>...</span></pre><p id="a1ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以开始发挥真正的创造力，让它完全按照你自己的风格定制。这是Ahmet Alp Balkan的文章中的一个很好的例子，他的别名命名约定如下。我以此为模板，并根据自己的系统和习惯进行了调整。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/7496235f56b3e65deb76ba3efb1716d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5qbPTZD-6Ib0HpFkNK8Mg.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">来自Ahmet的kubectl-alias约定</figcaption></figure><h1 id="aed6" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">导出KUBECONFIG又慢又无聊</h1><pre class="mn mo mp mq gt mr la ms mt aw mu bi"><span id="209c" class="mv lq iq la b gy mw mx l my mz"># Save this in bash.rc or zsh.rc, update the file path if needed. <br/>#<strong class="la ir"> Usage: kube clusterA</strong></span><span id="f67a" class="mv lq iq la b gy na mx l my mz">kube() {</span><span id="c144" class="mv lq iq la b gy na mx l my mz">  export KUBECONFIG=~/k8sconfig/${1}/kubeconfig</span><span id="1af9" class="mv lq iq la b gy na mx l my mz">}</span></pre><h1 id="c4e0" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">安装这款K8S荧光笔，看看不同之处</h1><p id="0351" class="pw-post-body-paragraph jy jz iq ka b kb nh kd ke kf ni kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">之前:<strong class="ka ir"> <em class="kw">我在哪里集群？</em> </strong></p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/acbda3ac4f5147303f31307c7f68de3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E4-XbEXV00f0FS4FMStDjw.png"/></div></div></figure><p id="af0f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后:<strong class="ka ir"> <em class="kw">我在</em> </strong> <code class="fe kx ky kz la b"><strong class="ka ir"><em class="kw">goku</em></strong></code> <strong class="ka ir"> <em class="kw">集群中以</em> </strong> <code class="fe kx ky kz la b"><strong class="ka ir"><em class="kw">kube-system</em></strong></code> <strong class="ka ir"> <em class="kw">为</em> </strong> <code class="fe kx ky kz la b"><strong class="ka ir"><em class="kw">admin</em></strong></code></p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/cab6e27953f362a5d72334c95986306b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-roojfW-3xwhVuV84GJSQ.png"/></div></div></figure><p id="bc1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如上所示，集群名称和名称空间都显示并突出显示，非常直观。这个插件叫做<em class="kw"> kube-ps1 </em>，可以在<a class="ae nb" href="https://github.com/jonmosco/kube-ps1" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="4459" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">停止在每个命令中键入名称空间</h1><p id="e54a" class="pw-post-body-paragraph jy jz iq ka b kb nh kd ke kf ni kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated">通过让我们的终端<em class="kw">记住</em>当前的名称空间，我们可以节省更多的输入。这里有两个方便的辅助工具:<em class="kw"> kubens </em>和<em class="kw"> kubectl change-ns plugin </em>。挑你最喜欢的。</p><p id="2af4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">kubens可以和kubectx一起安装，这个<a class="ae nb" href="https://github.com/ahmetb/kubectx" rel="noopener ugc nofollow" target="_blank">包</a>捆绑了两个二进制文件。如果你想让它更有趣，更有互动性，可以试试安装<a class="ae nb" href="https://github.com/junegunn/fzf" rel="noopener ugc nofollow" target="_blank"> fzf </a>。从下面的演示中，您可以看到它可以与kubectx和kubens无缝协作。</p><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/87a8b2236e014296b1fd3fa0cb982da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*77UxSjHcUP2lIDjSx20kCA.gif"/></div></div></figure><p id="e7f3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果在同一个k8s <code class="fe kx ky kz la b">kubeconfig</code>文件中有多个上下文，kubectx会很方便。<br/>在我的例子中，每个集群只有一个上下文，即<code class="fe kx ky kz la b">admin@${<em class="kw">cluster}.</em></code>来不断地在不同的集群之间切换，<code class="fe kx ky kz la b">kube ${cluster}</code>非常有用。</p><p id="0159" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有另外一个叫做<em class="kw"> change-ns </em>的<em class="kw"> kubectl插件</em>也可以达到同样的目的。如果你已经在使用<a class="ae nb" href="https://github.com/GoogleContainerTools/krew" rel="noopener ugc nofollow" target="_blank"> krew </a>来管理你的kubectl插件，它可以很容易地安装。</p><pre class="mn mo mp mq gt mr la ms mt aw mu bi"><span id="c133" class="mv lq iq la b gy mw mx l my mz">kubectl krew install change-ns</span></pre><h1 id="5929" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">概述</h1><figure class="mn mo mp mq gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/4783886abeea9e71df99bc2818f4e4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcV4Xei1lIBhHulOMI9Y5Q.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk translated">我的常见用法</figcaption></figure><p id="1133" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面这张图片展示了我的一些常见用法:</p><ul class=""><li id="04ef" class="lb lc iq ka b kb kc kf kg kj ld kn le kr lf kv lg lh li lj bi translated">首先，使用<code class="fe kx ky kz la b">kube</code>选择一个集群或切换到不同的集群</li><li id="5f3f" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">第二，使用<code class="fe kx ky kz la b">kubens</code>或<code class="fe kx ky kz la b">change-ns</code>来选择一个命名空间；如果愿意，使用交互模式。</li><li id="dec1" class="lb lc iq ka b kb lk kf ll kj lm kn ln kr lo kv lg lh li lj bi translated">使用kubectl alias <code class="fe kx ky kz la b">kg </code>来获取服务、pod和端点</li></ul><p id="2d3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就这些，希望这有助于节省您的一些打字时间，并使它更愉快地在终端中与Kubernetes交互。</p><p id="a1b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">PS:以防你想知道，我使用的集群名称来自于<a class="ae nb" href="https://en.wikipedia.org/wiki/List_of_Dragon_Ball_characters" rel="noopener ugc nofollow" target="_blank">龙珠</a>字符。</p><h1 id="58cf" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">参考</h1><p id="eea3" class="pw-post-body-paragraph jy jz iq ka b kb nh kd ke kf ni kh ki kj nj kl km kn nk kp kq kr nl kt ku kv ij bi translated"><a class="ae nb" href="https://github.com/ahmetb/kubectx" rel="noopener ugc nofollow" target="_blank">https://github.com/ahmetb/kubectx</a><br/><a class="ae nb" href="https://github.com/jonmosco/kube-ps1" rel="noopener ugc nofollow" target="_blank">https://github.com/jonmosco/kube-ps1</a><br/><a class="ae nb" href="https://github.com/GoogleContainerTools/krew" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleContainerTools/krew</a><br/>T35】https://ahmet.im/blog/kubectl-aliases/</p></div></div>    
</body>
</html>