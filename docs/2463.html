<html>
<head>
<title>Explore Gitea-Drone CI/CD on K3s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在K3s上探索Gitea-Drone CI/CD</h1>
<blockquote>原文：<a href="https://itnext.io/explore-gitea-drone-ci-cd-on-k3s-4a9e99f8b938?source=collection_archive---------1-----------------------#2019-05-28">https://itnext.io/explore-gitea-drone-ci-cd-on-k3s-4a9e99f8b938?source=collection_archive---------1-----------------------#2019-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5ec64b5089724d8bddf6a6be2189b71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JdxLg6uzZNpRuNs0.jpg"/></div></div></figure><p id="6630" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在周末，我探索了在K3s上运行的<a class="ae kz" href="https://github.com/go-gitea/gitea" rel="noopener ugc nofollow" target="_blank"> Gitea </a>和<a class="ae kz" href="https://drone.io/" rel="noopener ugc nofollow" target="_blank"> Drone.io </a>的CI/CD实现。目标是建立一个轻量级CI/CD实现，它可以在一台笔记本电脑上运行，以模拟本地环境。本文记录了该设置，以供将来参考。</p><p id="8390" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设K3s已在您的笔记本电脑上启动并运行。<em class="la">关于如何在Macbook上运行K3s，请参考我的论文“</em> <a class="ae kz" href="https://medium.com/@zhimin.wen/running-k3s-with-multipass-on-mac-fbd559966f7c" rel="noopener"> <em class="la">在Macbook上使用Multipass运行K3s</em></a><em class="la">”。</em></p><h2 id="57b0" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">Gitea设置</h2><p id="3bb5" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">Gitea将成为源代码库。尽管库伯内特家的头盔库中没有图表，但多亏了jfelten，这里有一张关于https://github.com/jfelten/gitea-helm-chart的图表。</p><p id="1817" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Git克隆存储库，通过运行</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="b278" class="lb lc it me b gy mi mj l mk ml">helm package gitea</span></pre><p id="65a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将创建的软件包<code class="fe mm mn mo me b">gitea-1.6.1.tgz</code>上传到托管K3s的多通道虚拟机。将文件放到<code class="fe mm mn mo me b">/var/lib/rancher/k3s/server/static/charts</code>目录下</p><p id="2cd4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在创建Helmchart部署CRD，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="e83f" class="lb lc it me b gy mi mj l mk ml">apiVersion: k3s.cattle.io/v1<br/>kind: HelmChart<br/>metadata:<br/>  name: gitea<br/>  namespace: kube-system<br/>spec:<br/>  chart: https://%{KUBERNETES_API}%/static/charts/gitea-1.6.1.tgz<br/>  targetNamespace: gitea<br/>  valuesContent: |-<br/>    service:<br/>      http:<br/>        serviceType: NodePort<br/>        externalPort: <br/>        externalHost: <br/>    persistence:<br/>      enabled: true<br/>      accessMode: ReadWriteOnce<br/>    config:<br/>      secretKey: password<br/>      disableInstaller: true</span></pre><p id="9f21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">选择服务类型作为节点端口。将externalPort和externalHost设置为空以使用群集IP；通过将accessMode设置为ReadWriteOnce来启用持久性，因为hostPath不支持ReadWriteMany模式；设置secretKey，以便禁用初始安装程序弹出窗口。</p><p id="9e62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦pod开始运行，找到服务的节点端口，转到URL，然后注册用户，</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/2fe31fd60887b2388f9ed09e964c67c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IN1CH2ce_Pa-2PhegTdCSw.png"/></div></div></figure><h2 id="db41" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">无人机设置</h2><p id="6da1" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">有稳定的无人机舵图。下载舵图，以避免图表不同步的问题。使用以下内容部署它，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="5127" class="lb lc it me b gy mi mj l mk ml">apiVersion: k3s.cattle.io/v1<br/>kind: HelmChart<br/>metadata:<br/>  name: drone<br/>  namespace: kube-system<br/>spec:<br/>  chart: https://%{KUBERNETES_API}%/static/charts/drone-2.0.0-rc.12.tgz<br/>  targetNamespace: drone<br/>  valuesContent: |-<br/>    service:<br/>      type: NodePort<br/>    sourceControl:<br/>      provider: "gitea"<br/>      gitea:<br/>        server: "<a class="ae kz" href="http://gitea-gitea-http.gitea:3000" rel="noopener ugc nofollow" target="_blank">http://gitea-gitea-http.gitea:3000</a>"<br/>    server:<br/>      adminUser: "wenzm"</span></pre><p id="f695" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">将提供者设置为“gitea ”,并将服务器指向集群中gitea的服务名。分配给在Gitea中注册的adminUser。</p><p id="e6a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">找到无人机的节点端口，进入网络控制台。使用Gitea中的用户名和密码登录。目前无人机中还没有显示任何存储库。</p><h2 id="d1fb" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">Gitea webhook设置</h2><p id="7d0d" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">在Gitea中创建一个存储库。现在回到无人机控制台，点击“同步”按钮来同步存储库。Gitea资源库出现在Drone中。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mq"><img src="../Images/21dc70fc6af40c036423c51b1dc3282a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIFzSmKaG6JLrnxSiBZWfw.png"/></div></div></figure><p id="a29c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击激活。然后，在Gitea中检查资源库的settings/webhook，</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/14bd0e3a5873fc1c75f412ab420324f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tM0lUxpQkFczp74T3uFjPA.png"/></div></div></figure><p id="23ec" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">webhook已创建。然而，由于drone与Gitea不在同一个名称空间中，我们需要更新URL以包含名称空间。如下更新webhook。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="352c" class="lb lc it me b gy mi mj l mk ml">http://drone-drone.drone/hook?secret=xxxxxxxxxxxxxxxxxxxxxxxx</span></pre><p id="218d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们有了集成的Gitea和无人机。如果Gitea中有一个push事件，那么Drone就会拉开流水线执行的序幕。</p><h2 id="8113" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">CI/CD管道</h2><p id="65d8" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">像其他的一样，CI/CD管道是在源代码中定义的。默认情况下，它被命名为<code class="fe mm mn mo me b">.drone.yml</code>，其中它定义了一个由不同步骤组成的管道。每个步骤都将运行一个容器，并相应地执行设计的任务/命令。</p><p id="23d3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面列出了这次勘探的管道。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="ae37" class="lb lc it me b gy mi mj l mk ml">kind: pipeline<br/>name: mypipeline</span><span id="49dd" class="lb lc it me b gy ms mj l mk ml">steps:<br/>- name: build<br/>  image: golang<br/>  environment:<br/>    CGO_ENABLED: 0<br/>  commands:<br/>  - go build -o hello src/*.go</span><span id="2460" class="lb lc it me b gy ms mj l mk ml">- name: build-push-dockerhub<br/>  image: plugins/docker<br/>  settings:<br/>    username:<br/>      from_secret: dockerUser<br/>    password:<br/>      from_secret: dockerPass<br/>    repo: zhiminwen/hello-by-drone<br/>    tags:<br/>       - "${DRONE_COMMIT_SHA:0:8}"</span><span id="254d" class="lb lc it me b gy ms mj l mk ml">- name: deploy-to-k3s<br/>  image: zhiminwen/kubectl:v1.14<br/>  environment:<br/>    K3SSERVER:<br/>      from_secret: k3sServer<br/>    K3SCERT:<br/>      from_secret: k3sCert<br/>    K3SPASS:<br/>      from_secret: k3sPass<br/>    IMAGETAG: "${DRONE_COMMIT_SHA:0:8}"<br/>    <br/>  commands:<br/>  - envsubst &lt; k3s.env.yaml &gt; k3s.yaml<br/>  - envsubst &lt; deploy/kustomization.env.yaml &gt; deploy/kustomization.yaml<br/>  - export KUBECONFIG=$${DRONE_WORKSPACE_BASE}/k3s.yaml <br/>  - cd deploy; kubectl apply -k .</span></pre><h2 id="e833" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">1.步骤:构建</h2><p id="8492" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">该应用程序只是一个简单的golang hello world HTTP处理程序。我们使用golang图像来构建应用程序。将环境变量<code class="fe mm mn mo me b">CGO_ENABLED</code>设置为0，因为我们将使用alpine base构建docker映像。</p><h2 id="4689" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">2.步骤:构建-推送-dockerhub</h2><p id="3be2" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">当构建docker图像时，我们使用Drone插件来创建docker图像并将其推送到Dockerhub中。</p><p id="ec6a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在源存储库中创建Dockerfile，如下所示，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="dfc5" class="lb lc it me b gy mi mj l mk ml">FROM alpine</span><span id="1d50" class="lb lc it me b gy ms mj l mk ml">RUN mkdir -p /app<br/>ADD hello /app<br/>RUN chmod a+rx /app/hello</span><span id="d563" class="lb lc it me b gy ms mj l mk ml">CMD ["/app/hello"]</span></pre><p id="5bfa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在该步骤中，<code class="fe mm mn mo me b">repo</code>设置将图像名称默认设置为dockerhub repo。如果需要不同的回购协议，请设置其全名，如<code class="fe mm mn mo me b"><em class="la">mycluster.icp:8500/zhiminwen/hello-by-drone</em></code></p><p id="a1fb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于这个构建，我们使用commit SHA值的前8个字符来设置image标记。</p><p id="64f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要推送至dockerhub，需要登录凭据。使用无人机命令行工具创建无人机存储库机密，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0f89" class="lb lc it me b gy mi mj l mk ml">export DRONE_SERVER=<a class="ae kz" href="http://192.168.64.5:30093" rel="noopener ugc nofollow" target="_blank">http://192.168.64.5:30093</a><br/>export DRONE_TOKEN=zlz8c26jRy0Vc14wXkSlv8ripVHkmdHT</span><span id="9c1b" class="lb lc it me b gy ms mj l mk ml">drone secret add --name dockerUser --data xxxxxx --repository wenzm/cicd<br/>drone secret add --name dockerPass --data yyyyyy --repository wenzm/cicd</span></pre><h2 id="4885" class="lb lc it bd ld le lf dn lg lh li dp lj km lk ll lm kq ln lo lp ku lq lr ls lt bi translated">3.步骤:部署到k3s</h2><p id="ee94" class="pw-post-body-paragraph kb kc it kd b ke lu kg kh ki lv kk kl km lw ko kp kq lx ks kt ku ly kw kx ky im bi translated">我们将应用程序部署到K3s的映像构建中。</p><p id="07ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">构建kubectl映像</strong></p><p id="339b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用下面的docker文件创建一个docker映像来运行kubectl命令。请注意，我使用的是1.14版本，因此可以使用Kustomize功能。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="4a07" class="lb lc it me b gy mi mj l mk ml">FROM alpine</span><span id="6acc" class="lb lc it me b gy ms mj l mk ml">RUN apk update &amp;&amp; \<br/>   apk add curl gettext &amp;&amp; \<br/>   curl -LO <a class="ae kz" href="https://storage.googleapis.com/kubernetes-release/release/$(curl" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/$(curl</a> -s <a class="ae kz" href="https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl</a> &amp;&amp; \<br/>   mv kubectl /usr/local/bin &amp;&amp; \<br/>   chmod a+rx /usr/local/bin/kubectl</span></pre><p id="c8c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同时，添加了gettext包，因为我需要运行<code class="fe mm mn mo me b">envsubst</code>命令来替换环境变量。</p><p id="1675" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">准备KUBECONFIG文件</strong></p><p id="a251" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">工具准备好了，我需要与K3s服务器对话。将以下k3s.env.yaml文件添加到存储库中，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a0c6" class="lb lc it me b gy mi mj l mk ml">apiVersion: v1<br/>clusters:<br/>- cluster:<br/>    certificate-authority-data: $K3SCERT<br/>    server: $K3SSERVER<br/>  name: default<br/>contexts:<br/>- context:<br/>    cluster: default<br/>    user: default<br/>  name: default<br/>current-context: default<br/>kind: Config<br/>preferences: {}<br/>users:<br/>- name: default<br/>  user:<br/>    password: $K3SPASS<br/>    username: admin</span></pre><p id="86cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为证书CA、K3s服务器、K3s密码创建无人机机密。在管道步骤中，用这些秘密创建环境变量。</p><p id="2443" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在pipeline命令中，我们首先通过替换环境变量来创建k3s.yaml文件，然后将KUBECONFIG导出到新创建的文件中，我们准备好对k3s服务器运行kubectl命令。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6d8d" class="lb lc it me b gy mi mj l mk ml">- envsubst &lt; k3s.env.yaml &gt; k3s.yaml<br/>- export KUBECONFIG=$${DRONE_WORKSPACE_BASE}/k3s.yaml</span></pre><p id="e5a0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la">我用$$来转义Drone试图执行命令时变量展开。</em></p><p id="ab8a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">使用Kustomize部署</strong></p><p id="e90a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了避免过度的模板化，我使用了嵌入在kubectl 1.14版本中的最新Kustomize特性。</p><p id="9800" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在源存储库中，创建一个部署文件夹，保存下面的deploy.yaml和service.yaml文件，该文件不应被更改。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="5d0a" class="lb lc it me b gy mi mj l mk ml">---<br/>apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  labels:<br/>    app: hello<br/>  name: hello<br/>  namespace: demo<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: hello<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello<br/>    spec:<br/>      containers:<br/>      - name: hello<br/>        image: zhiminwen/hello-by-drone</span></pre><p id="233a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">服务yaml文件，</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3c0a" class="lb lc it me b gy mi mj l mk ml">---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  labels:<br/>    app: hello<br/>  name: hello<br/>  namespace: demo<br/>spec:<br/>  ports:<br/>  - name: http<br/>    port: 80<br/>    protocol: TCP<br/>    targetPort: 8080<br/>  selector:<br/>    app: hello<br/>  type: NodePort</span></pre><p id="a4b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建以下Kustomization.env.yaml文件，该文件将自定义部署的映像设置。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2ff6" class="lb lc it me b gy mi mj l mk ml">apiVersion: kustomize.config.k8s.io/v1beta1<br/>kind: Kustomization</span><span id="bba0" class="lb lc it me b gy ms mj l mk ml">images:<br/>- name: zhiminwen/hello-by-drone<br/>  newName: zhiminwen/hello-by-drone<br/>  newTag: $IMAGETAG</span><span id="e0c7" class="lb lc it me b gy ms mj l mk ml">resources:<br/>- resources/deploy.yaml<br/>- resources/service.yaml</span></pre><p id="a0f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在pipeline命令中，我将首先使用<code class="fe mm mn mo me b">envsubst</code>命令创建Kustomization.yaml文件，以替换设置为“<code class="fe mm mn mo me b">${DRONE_COMMIT_SHA:0:8}</code>”的<code class="fe mm mn mo me b">$IMAGETAG</code>环境变量。这将使部署在当前构建中使用image标记。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="af27" class="lb lc it me b gy mi mj l mk ml">- envsubst &lt; deploy/kustomization.env.yaml &gt; deploy/kustomization.yaml</span><span id="9891" class="lb lc it me b gy ms mj l mk ml">- cd deploy; kubectl apply -k .</span></pre><p id="2457" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，使用-k选项应用Kustomization。</p><p id="aa7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">测试</strong></p><p id="426c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更新代码，提交更改，推送到回购。管道启动并成功运行。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/a3afc8986dd5bbf5d3af7b21f8b3d75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3a_nzEqqgBIfe93MfPIPzQ.png"/></div></div></figure><p id="9594" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以毫无问题地访问应用程序。</p></div></div>    
</body>
</html>