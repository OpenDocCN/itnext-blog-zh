<html>
<head>
<title>Benchmark results of Kubernetes network plugins (CNI) over 10Gbit/s network (Updated: August 2020)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10Gbit/s网络上Kubernetes网络插件(CNI)的基准测试结果(更新时间:2020年8月)</h1>
<blockquote>原文：<a href="https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-august-2020-6e1b757b9e49?source=collection_archive---------0-----------------------#2020-09-08">https://itnext.io/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-august-2020-6e1b757b9e49?source=collection_archive---------0-----------------------#2020-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="39aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文是我之前的基准测试(<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-36475925a560"> 2018 </a>和<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/benchmark-results-of-kubernetes-network-plugins-cni-over-10gbit-s-network-updated-april-2019-4a9886efe9c4"> 2019 </a>)的更新，现在运行的是2020年8月CNI版本最新的Kubernetes 1.19和Ubuntu 18.04。</p><p id="35e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">内容:</strong></p><ol class=""><li id="a389" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">在我们深入研究指标之前</li><li id="ca86" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">CNI MTU调谐</li><li id="678e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">CNI基准:原始数据</li><li id="6ab2" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">CNI加密</li><li id="0743" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">摘要</li><li id="cb22" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">结论-我的评论</li></ol><p id="5956" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">TL；对于那些赶时间的人，请查看第3节和第4节中的图表，或者第5节和第6节中我对基准测试结果及其解释的看法。</strong></p><h1 id="5511" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">1)在我们深入研究指标之前…</h1><h2 id="98e9" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">1.1)2019年4月以来有什么新消息？</h2><ul class=""><li id="3c54" class="km kn iq jp b jq mk ju ml jy mm kc mn kg mo kk mp ks kt ku bi translated"><strong class="jp ir">测试您自己的集群:</strong>现在，您可以使用我们发布的“Kubernetes网络基准测试”工具knb(<a class="ae kl" href="https://github.com/InfraBuilder/k8s-bench-suite" rel="noopener ugc nofollow" target="_blank">https://github.com/InfraBuilder/k8s-bench-suite</a>)在您自己的集群上运行基准测试。</li><li id="e565" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">欢迎来到CNI战役中的新挑战者</strong>:来自VMware Tanzu<br/>-<a class="ae kl" href="https://github.com/alauda/kube-ovn" rel="noopener ugc nofollow" target="_blank">Kube-OVN</a>的<br/>-<a class="ae kl" href="https://antrea.io/docs/master/getting-started/" rel="noopener ugc nofollow" target="_blank">Antrea</a></li><li id="2da1" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">新场景:</strong>该基准测试涵盖了“Pod到Pod”的网络性能，同时也涵盖了一个新的“Pod到服务”场景，这是一个真实的测试案例。实际上，您的API pod将通过服务使用数据库，而不是来自pod IP(当然，我们对这两种场景都测试了TCP和UDP)</li><li id="290e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">资源消耗:</strong>现在每个测试都有自己的资源对比。</li><li id="9db2" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">应用测试被删除:</strong>我们不再运行HTTP、FTP和SCP测试。我们与社区和CNI维护人员卓有成效的合作强调了iperf TCP结果和curl结果之间的差距，这是由于CNI启动的延迟(pod启动的最初几秒钟，与真实世界的用例无关)。</li><li id="98e4" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">开源:</strong>所有的基准源(脚本、cni yml和原始结果)都可以在github上获得:<a class="ae kl" href="https://github.com/InfraBuilder/benchmark-k8s-cni-2020-08" rel="noopener ugc nofollow" target="_blank">https://github.com/InfraBuilder/benchmark-k8s-cni-2020-08</a></li></ul><h2 id="a9e1" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">1.2)基准协议</h2><p id="4513" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">整个协议详见<a class="ae kl" href="https://github.com/InfraBuilder/benchmark-k8s-cni-2020-08/blob/master/PROTOCOL.md" rel="noopener ugc nofollow" target="_blank">https://github . com/infra builder/benchmark-k8s-CNI-2020-08/blob/master/protocol . MD</a></p><p id="d2bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，目前的文章只关注Ubuntu 18.04，默认内核。</p><h2 id="e544" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">1.3)基准的CNI选择</h2><p id="a04f" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">该基准旨在比较可以用单个yaml文件设置的CNI(因此排除了所有基于脚本的安装，如基于VPP的CNI等)。)</p><p id="c163" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将比较的CNI如下所列:</p><ul class=""><li id="6d7b" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk mp ks kt ku bi translated">Antrea v.0.9.1</li><li id="2d69" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">Calico v3.16</li><li id="9e1f" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">Canal v3.16(法兰绒网络+印花布网络政策)</li><li id="5262" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">纤毛</li><li id="8f3a" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">法兰绒</li><li id="be19" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">kube-路由器最新(2020年8月25日)</li><li id="6496" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">编织网2.7.0</li></ul><h1 id="0630" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">2) CNI MTU调谐</h1><p id="ba14" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">首先，我们将检查MTU检测对TCP性能的影响:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/f9f4690634a092eb4d33ad3c1c6ea937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A9R6x65jffRQ7vKYWk4VfQ.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">MTU对TCP性能的影响</figcaption></figure><p id="a44c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">UDP暴露了一个更明显的差距:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/980599a57d704286824f4e99ae675dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6i4qA4RkfQptcp-MYfCUQ.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">MTU对UDP性能的影响</figcaption></figure><p id="662e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑到这里揭示的对性能的巨大影响，我们想向所有CNI维护者发出一个希望的信息:请在CNIs中实现MTU自动检测。你将拯救小猫，独角兽，甚至是最可爱的一只:小devops家伙！</p><p id="39f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，如果您真的必须选择一个没有实现auto-MTU的CNI，您将需要自己调整它以保持性能。请注意，适用于印花布，运河和编织网。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nj"><img src="../Images/22d4dcfec308f786469075e44d9045ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4v_34j3NIvAg_eZlb9eJ3A.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">我给CNI维护者的一点信息…</figcaption></figure><h1 id="5693" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">3) CNI基准:原始数据</h1><p id="2cfa" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在本节中，我们将比较CNI和正确的MTU(自动检测或手动调整)。这里的主要目标是以图表的形式呈现原始数据。</p><p id="b4d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">颜色代码:</strong></p><ul class=""><li id="98dc" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk mp ks kt ku bi translated">灰色:参考(又名裸机)</li><li id="8270" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">绿色:带宽&gt; 9 500兆比特/秒</li><li id="1c3e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">黄色:带宽&gt; 9 000兆比特/秒</li><li id="3bb8" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">橙色:带宽&gt; 8 000兆比特/秒</li><li id="51ad" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">红色:带宽&lt; 8 000 Mbit/s</li><li id="5d0e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">Blue : neutral (not-bandwidth related)</li></ul><h2 id="5837" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">3.1) Idle</h2><p id="5ff6" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">First thing is to establish the CNI consumption when the whole cluster… is taking a little nap ?</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/c45f9a1fb877d7db2de7072af2181f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2bi2eIaW1VpTEmOYW6D-Q.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">Idle resource consumption</figcaption></figure><h2 id="e227" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">3.2) Pod-to-Pod</h2><p id="b74b" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">In this scenario, the client Pod connects directly to the server pod on its IP address.</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nk"><img src="../Images/57c36ca9c642e29759cb79d28ac99f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1ToEbZkJo9gK2HdZRL6-w.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">Pod-to-Pod scenario</figcaption></figure></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="96bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.2.1) TCP </strong></p><p id="a97e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<strong class="jp ir"> Pod到Pod</strong>”<strong class="jp ir">TCP</strong>和相关资源消耗的结果如下:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/1f42574fa28d168b741df40cb53efa84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ywvP9jWu_hg8sY0QN-D5zw.png"/></div></div></figure><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/05f79bbd6c85d9e9b97716aaafcfddbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHqGtytfMBfVhPYFdKuHKQ.png"/></div></div></figure><p id="247a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.2.2) UDP </strong></p><p id="2242" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<strong class="jp ir"> Pod到Pod</strong>”<strong class="jp ir">UDP</strong>和相关资源消耗的结果如下:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/59630ecc9b0d83b7fa6dc8422a3343d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmkF5V6WCryc2TrAzkUYNg.png"/></div></div></figure><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/cee6feb9a18f8c78a1121b6714970f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pu67V0Aja5iZA52zSS9zbQ.png"/></div></div></figure><h2 id="50ab" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">3.3) Pod到服务</h2><p id="148d" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在本节中，客户机单元通过ClusterIP服务连接到服务器单元。这与真实世界的用例更相关。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ns"><img src="../Images/98b41346fecee35c2c31a3a2283c94f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzJ8mxa4-A_E3l3iX5lngA.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">Pod到服务场景</figcaption></figure><p id="efd6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.3.1) TCP </strong></p><p id="bd53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<strong class="jp ir">Pod-to-Service</strong>”<strong class="jp ir">TCP</strong>和相关资源消耗的结果如下:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/a3d31e48bdf7a100ee5966d7ba31a503.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_x19FDcrERmP_Sqx0E2WTQ.png"/></div></div></figure><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/d69b9d8fa3ed47207fc21970eac7482f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHZe08mVog2c4EFj0NoMzA.png"/></div></div></figure><p id="baf0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.3.2) UDP </strong></p><p id="e75d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“<strong class="jp ir">Pod-to-Service</strong>”<strong class="jp ir">UDP</strong>和相关资源消耗的结果如下:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/2b28ef766fe63554c7ac6f37649ca37c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stHfo7rhYjuSNeqi3frpFw.png"/></div></div></figure><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/9339d3f370b9291c0b43b8decd66222a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4e9TB1Em9uPkyxxLqxZyMQ.png"/></div></div></figure><p id="4acb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3.4)网络政策</strong></p><p id="5ce7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在该基准中列出的所有CNI中，唯一不完全支持网络策略的是法兰绒。所有其他设备都在正确实施网络策略，包括入口和出口。干得好！</p><h1 id="bbc4" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">4) CNI加密</h1><p id="8e24" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在我们测试的所有CNI中，下列CNI能够加密pod间的通信:</p><ul class=""><li id="41f7" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk mp ks kt ku bi translated">带有IPsec的Antrea</li><li id="a75a" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">带铁丝网的印花棉布</li><li id="3a36" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">带有IPsec的纤毛</li><li id="1ea1" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">带IPsec的WeaveNet</li></ul><h2 id="712d" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">4.1)带宽</h2><p id="201c" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">由于这场战斗中的CNI较少，让我们在一张图中概括所有场景:</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/955428677581d41ef9e41f3e041e9261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eul4ltPeOmG9pwK7VR_8Gw.png"/></div></div></figure><h2 id="2bbc" class="ly lb iq bd lc lz ma dn lg mb mc dp lk jy md me lo kc mf mg ls kg mh mi lw mj bi translated">4.2)资源消耗</h2><p id="af1e" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">在本节中，我们将研究TCP和UDP点对点通信所使用的资源。在这里显示Pod-to-Service图是没有意义的，因为它没有提供进一步的信息。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/2b274a35e3b9642ebc225542006a31d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppULY4upKrrKcvOclDzCEA.png"/></div></div></figure><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mt"><img src="../Images/9ca8974b71f61f656c278ed19d7530da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgCV7LJw1yUpcClUH69oww.png"/></div></div></figure><h1 id="e72f" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">5)总结</h1><p id="fd81" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">让我们试着回顾一下这些图表。我们在这里引入了一点主观性，用“非常快”、“低”等限定词代替实际值。</p><figure class="mu mv mw mx gt my gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nt"><img src="../Images/6a27d21cce89a200f240eed869fe65fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zDiFQZVXuL923x0LbmXMaA.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk translated">基准测试结果汇总(2020年8月)</figcaption></figure><h1 id="aba2" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">6)结论-我的评论</h1><p id="2246" class="pw-post-body-paragraph jn jo iq jp b jq mk js jt ju ml jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">最后一部分是主观的，传达了我自己对结果的理解。</p><p id="e48d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">很高兴看到CNI新人的加入。Antrea通过提供许多功能玩得很好，甚至在早期版本中也是如此:auto-mtu、加密选项和直接安装。</p><p id="c5ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">考虑到性能，除了Kube-OVN和Kube-Router之外，所有CNI都做得很好。关于Kube-Router，它无法检测MTU，我在文档中找不到调整它的方法(这里有一个关于MTU配置<a class="ae kl" href="https://github.com/cloudnativelabs/kube-router/issues/165" rel="noopener ugc nofollow" target="_blank">的公开问题</a>)。</p><p id="9b3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于资源消耗，Cilium仍然比其竞争对手使用更多的RAM，但该公司公开瞄准大规模集群，这与3节点基准测试不完全相同。Kube-OVN也是RAM和CPU密集型的，它仍然是一个相当年轻的CNI，依赖于Open v switch(Antrea也是，但Antrea更轻，性能更好)。</p><p id="0ee5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了法兰绒之外，所有被测试的CNI都执行网络策略。很可能法兰绒永远也不会实现它，因为他们的目的非常明确:越轻越好。</p><p id="828e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另外，加密性能才是这里真正的“wow效应”。Calico是最古老的CNI之一，但他们直到几周前才提供加密。他们更喜欢wireguard而不是IPsec，至少可以说，它在这个领域中表现得非常出色，完全是其他CNI所没有的。当然，由于加密负载，它消耗了大量的CPU，但它们实现的带宽完全值得(记住，Calico encrypted perf比排名第二的Cilium大约好6倍)。此外，您还可以在群集上部署Calico后随时激活wireguard加密，您也可以在短时间内或永远禁用它。这是非常用户友好的。但是！我们提醒您，Calico目前无法自动检测MTU(该功能计划在不久的将来发布)，因此如果您的网络支持巨型帧(MTU 9000)，请不要忘记调整MTU。</p><p id="d20e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，请注意，Cilium能够加密整个节点到节点的流量(不仅仅是pod流量)，这对于面向公众的集群节点来说可能是一个非常有吸引力的功能。</p><p id="3887" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，以下是我对以下用例的建议:</p><ul class=""><li id="e992" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk mp ks kt ku bi translated"><strong class="jp ir">我需要一个CNI用于额外的小节点集群或者我不关心安全<br/> </strong>那么就用<strong class="jp ir">法兰绒</strong>，这几乎是最轻的稳定CNI。<br/> ( <em class="nu">也是最古老的。根据传说，它是由Homo-Kubernautus或Homo-Containorus </em>发明的。不妨对辉煌<a class="ae kl" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> k3s </a>项目感兴趣！看看吧！</li><li id="078c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated"><strong class="jp ir">我需要一个CNI，用于我的标准集群<br/> </strong>好的，<strong class="jp ir"> Calico </strong>是你的选择，<strong class="jp ir">如果有必要的话，不要忘记调整MTU </strong>。您可以玩网络策略，轻松启用/禁用加密等。</li><li id="b79e" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk mp ks kt ku bi translated">我的(非常)大规模集群需要一个CNI。我很乐意为之努力，但我们没有数百台10Gbit/s连接的服务器。所以最好的选择是在至少有<strong class="jp ir">印花布</strong>和<strong class="jp ir">纤毛</strong>的节点上运行定制的基准。</li></ul><p id="207c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读！</p></div></div>    
</body>
</html>