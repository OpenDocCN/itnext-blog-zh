<html>
<head>
<title>Build a Tic Tac Toe Game With React/Redux, Babel, Webpack and Material-UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React/Redux、Babel、Webpack和Material-UI构建一个井字游戏</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-tic-tac-toe-game-with-react-redux-babel-webpack-and-material-ui-part-2-of-5-1608f247690d?source=collection_archive---------0-----------------------#2018-04-25">https://itnext.io/build-a-tic-tac-toe-game-with-react-redux-babel-webpack-and-material-ui-part-2-of-5-1608f247690d?source=collection_archive---------0-----------------------#2018-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c87f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第2部分，共5部分</h2></div><p id="71c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一部分中，我们将开始编写游戏的逻辑，并添加测试来验证我们的游戏是否可以运行。</p><ul class=""><li id="12c6" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated"><a class="ae lk" href="https://medium.com/@vanister/learn-react-redux-by-making-a-tic-tac-toe-game-part-1-of-5-dc9111ca09ad" rel="noopener">第1部分—项目设置、依赖关系和Hello Tic Tac Toe！app。</a></li><li id="8520" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">第二部分——游戏结构、状态和测试。</li><li id="c098" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">第三部分——游戏性和基本风格。</li><li id="f6f3" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/build-a-tic-tac-toe-game-with-react-redux-babel-webpack-and-material-ui-part-4-of-5-f7cb4a611481">第4部分——提示、新游戏和更多风格</a>。</li><li id="e7fa" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><a class="ae lk" rel="noopener ugc nofollow" target="_blank" href="/build-a-tic-tac-toe-game-with-react-redux-babel-webpack-and-material-ui-part-5-of-5-fe2ece35b839">第5部分——清理和事后反思</a>。</li></ul></div><div class="ab cl lq lr hu ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ij ik il im in"><p id="8e49" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">更新2019年7月22日:</strong>项目依赖关系更新。</p><ul class=""><li id="dabf" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">巴别塔7.x</li><li id="86e0" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">React 16.x</li><li id="9eae" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">Redux 4.x</li><li id="90a3" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated">Webpack 4.x</li></ul><p id="1510" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看<a class="ae lk" href="https://github.com/vanister/medium.com/blob/part-2/tic-tac-toe/package.json" rel="noopener ugc nofollow" target="_blank"> package.json </a>获取更新的完整列表。</p><h2 id="4d5a" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">新依赖项</h2><p id="06e6" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">为了针对我们的动作、缩减器和操作编写测试，我们需要将<a class="ae lk" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> jest </a>作为开发依赖项添加到我们的项目中。Jest很好，因为它包含了我们编写、运行和收集代码覆盖率所需的一切。</p><p id="99f4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也将使用<a class="ae lk" href="https://github.com/gaearon/redux-thunk" rel="noopener ugc nofollow" target="_blank"> redux-thunk </a>来允许我们有条件地为我们的游戏分派动作。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="3935" class="lx ly iq na b gy ne nf l ng nh">yarn add --dev jest redux-thunk</span></pre><p id="98c4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用jest cli命令更新<code class="fe ni nj nk na b">package.json</code>文件的测试脚本，以执行我们项目中的所有测试。Jest将默认查找以“test，*”开头的文件。测试或*.spec。"</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="5e95" class="lx ly iq na b gy ne nf l ng nh">// package.json</span><span id="4356" class="lx ly iq na b gy nl nf l ng nh">scripts: {<br/>  ...,<br/>  ...,<br/>  "test": "jest"<br/>}</span><span id="4041" class="lx ly iq na b gy nl nf l ng nh">// rest of package.json</span></pre><h2 id="40c7" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">游戏结构</h2><p id="17eb" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">井字游戏是一个非常简单的游戏。有一个由3×3个方块组成的网格，每个玩家轮流在每个方块中标记一个“X”或“O”。第一个在一排、一列或对角线上得到三个的玩家获胜。既然游戏这么简单，我们只需要四个状态。</p><ul class=""><li id="5458" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe ni nj nk na b">board</code> — 3x3数数组；游戏板的当前状态。</li><li id="bbb8" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">gameover</code> —布尔；有一个赢家或者是平局。</li><li id="2b33" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">player</code> —数字；当前玩家，或无(0)。</li><li id="cad4" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">winner</code> —数字；赢得游戏或平局(0)的玩家。</li></ul><h2 id="7cb7" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">管理状态</h2><p id="8ed6" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">我们将使用<a class="ae lk" href="https://github.com/alexnm/re-ducks" rel="noopener ugc nofollow" target="_blank"> re-ducks </a>模式将我们的redux reducers、类型和动作组织成“ducks”。管理和组织redux文件有很多方法，但我喜欢re-ducks模式，因为它将状态分解到易于管理的文件夹中，使我们编写测试更加容易。</p><p id="9b1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">典型的“duck”将包含以下文件:</p><ul class=""><li id="a0cf" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated"><code class="fe ni nj nk na b">index.js</code> —为我们的鸭子出口。</li><li id="215d" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">reducers.js</code> — redux减速器。</li><li id="d573" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">actions.js</code> —可用于我们运营的行动。</li><li id="b0b2" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">operations.js</code> —可以对我们的鸭子进行的操作。一个操作可以分派一个或多个操作。</li><li id="7098" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">selectors.js</code> —映射复杂状态或导出分配给属性的值(可选)。</li><li id="55a4" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">types.js</code> —动作类型常数。</li><li id="bc9c" class="lb lc iq kh b ki ll kl lm ko ln ks lo kw lp la lg lh li lj bi translated"><code class="fe ni nj nk na b">test.js</code> —测试我们的鸭子。</li></ul><p id="9f3a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">鸭子存放在<code class="fe ni nj nk na b">src/state/ducks/.</code>文件夹下</p><h2 id="b828" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">野味鸭——减速器、动作和类型</h2><p id="6dae" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">我们游戏中唯一的鸭子是“游戏”鸭。它将包含“游戏结构”一节中列出的四种状态。</p><p id="e27b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ni nj nk na b">src/state/ducks/</code>下创建一个<code class="fe ni nj nk na b">game</code>文件夹，并将“管理状态”一节中列出的文件添加到其中。</p><p id="f2f2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将从为我们的减速器、类型和动作编写测试开始。打开<code class="fe ni nj nk na b">test.js</code>文件，并将以下代码添加到其中:</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="617d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您现在运行<code class="fe ni nj nk na b">yarn test</code>，您将会得到失败的测试消息，比如“TypeError: reducers不是一个函数”或者“TypeError: action”。*不是函数”，因为我们还没有实现它们。</p><figure class="mv mw mx my gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/9f49e8c0bf5ff646e1e8c6d550315993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X7SuNS3GD1GK0r1-zX-FXw.png"/></div></div></figure><p id="28cf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开<code class="fe ni nj nk na b">reducers.js</code>、<code class="fe ni nj nk na b">actions.js</code>和<code class="fe ni nj nk na b">types.js</code>文件，添加如下实现:</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">game/reducers.js</figcaption></figure><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">游戏/动作. js</figcaption></figure><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">game/types.js</figcaption></figure><p id="c4b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">再次运行<code class="fe ni nj nk na b">yarn test</code>，你应该会看到它们现在都通过了。</p><figure class="mv mw mx my gt nm gh gi paragraph-image"><div role="button" tabindex="0" class="nq nr di ns bf nt"><div class="gh gi np"><img src="../Images/b335e85d18ff04081cc8f00074c13115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QWsarLWD_zXt66ajs6LYag.png"/></div></div></figure><h2 id="aaf9" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">游戏鸭—操作和选择器</h2><p id="ad9a" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">re-ducks模式将操作描述为我们的duck的接口。通过我们的duck公开的操作可以用来更新我们的duck的状态。</p><p id="4545" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的一些duck操作很简单，可以用它们的动作一一公开，但是还有一些稍微复杂一点，需要一些逻辑才能调度动作来改变状态。</p><p id="b20a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ni nj nk na b">operations.js </code>和<code class="fe ni nj nk na b">utils/game.js</code>文件中实现操作之前，我们将首先用新的操作部分更新我们的<code class="fe ni nj nk na b">test.js</code>文件。</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">游戏/测试. js</figcaption></figure><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">游戏/运营. js</figcaption></figure><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">src/state/utils/game.js —请注意,“utils”文件夹是ducks文件夹的同级文件夹。</figcaption></figure><p id="0881" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:我们没有使用选择器，但是它们可以用来获取我们的duck状态并从中派生出一个新的状态。它们应该是纯函数，像减速器一样，不会改变我们鸭子的状态。</p><p id="8358" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在<code class="fe ni nj nk na b">selectors.js</code>文件中有一个空的导出作为占位符。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="ecf6" class="lx ly iq na b gy ne nf l ng nh">// ducks/game/selector.js</span><span id="da99" class="lx ly iq na b gy nl nf l ng nh">export {};</span></pre><h2 id="17cf" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">野味鸭——暴露鸭子</h2><p id="f9ea" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">现在我们已经实现了duck，我们需要公开它，以便组件可以使用它来呈现它们的状态。</p><p id="3d2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ni nj nk na b">index.js</code>文件中，导出减速器、操作、选择器和类型:</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">鸭子/游戏/索引. js</figcaption></figure><p id="c920" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ni nj nk na b">src/state/ducks/</code>创建另一个<code class="fe ni nj nk na b">index.js</code>文件，将所有的单个鸭子分组(目前仅针对<code class="fe ni nj nk na b">game</code>)。这些是redux存储的根缩减器中将要组合的缩减器。</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="6692" class="lx ly iq na b gy ne nf l ng nh">// src/state/ducks/index.js</span><span id="ae5f" class="lx ly iq na b gy nl nf l ng nh">export { default as gameState } from './game';<br/>// ...<br/>// more exports from other ducks</span></pre><h2 id="ebe0" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">Redux商店</h2><p id="1dee" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">要将游戏duck与redux一起使用，我们需要将它的reducers添加到redux存储中。在<code class="fe ni nj nk na b">src/state/</code>创建一个<code class="fe ni nj nk na b">store.js</code>文件来配置商店。</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">状态/商店. js</figcaption></figure><p id="932f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们导出了<code class="fe ni nj nk na b">configureStore</code>函数，该函数通过将我们所有的鸭子组合到一个根reducer中来配置存储，添加了thunk中间件来允许我们推迟或有条件地调度动作，并在创建和返回存储之前应用任何初始状态。</p><h2 id="e1ac" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">用鸭子</h2><p id="720a" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">打开<code class="fe ni nj nk na b">src/index.js</code>文件，更新它以使用我们创建的redux存储。</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">src/index.js</figcaption></figure><p id="3cb3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用react-redux <code class="fe ni nj nk na b">Provider</code>向所有组件提供我们的<code class="fe ni nj nk na b">store</code>。</p><p id="3aaf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">稍后，如果我们想要将我们的状态保存到本地存储，我们可以使用<code class="fe ni nj nk na b">initialState</code>变量在导航离开后刷新或返回游戏时再次加载它。</p><p id="ea1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ni nj nk na b">src/views/App.jsx</code>文件中，更新它以使用我们的游戏鸭。</p><figure class="mv mw mx my gt nm"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk translated">src/views/App.jsx</figcaption></figure><p id="9e3e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过运行<code class="fe ni nj nk na b">yarn start</code>测试我们的应用程序是否仍在工作。</p><figure class="mv mw mx my gt nm gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/7c401111d252f728b83cc808aae29214.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/1*lth6AtFmxjOApAoI6D-img.gif"/></div></figure><h2 id="943e" class="lx ly iq bd lz ma mb dn mc md me dp mf ko mg mh mi ks mj mk ml kw mm mn mo mp bi translated">未完待续…</h2><p id="4214" class="pw-post-body-paragraph kf kg iq kh b ki mq jr kk kl mr ju kn ko ms kq kr ks mt ku kv kw mu ky kz la ij bi translated">这部分的所有源代码都可以在这里找到:</p><div class="ob oc gp gr od oe"><a href="https://github.com/vanister/medium.com/tree/part-2" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">一字棋</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">第二部分来源</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os nu oe"/></div></div></a></div></div></div>    
</body>
</html>