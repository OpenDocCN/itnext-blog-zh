<html>
<head>
<title>Building React-Native Hackernews App — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建React-Native Hackernews应用程序—第1部分</h1>
<blockquote>原文：<a href="https://itnext.io/building-react-native-hackernews-app-part-1-ac25bc44b903?source=collection_archive---------1-----------------------#2018-10-21">https://itnext.io/building-react-native-hackernews-app-part-1-ac25bc44b903?source=collection_archive---------1-----------------------#2018-10-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="cf82" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Redux、Redux-Saga、Immer和自定义导航解决方案</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/6016fac61537ab0887376c24b19dad50.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/1*13UzbQmsEbDQbn6gjE1QwQ.gif"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">模拟GPRS网络，在开发模式下的android模拟器上(大量的console.log)</figcaption></figure><p id="1e11" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最近我玩了React for web &amp; NodeJS，但没怎么玩React Native。为了刷新我的记忆，我开始了一个新项目，用React Native创建一个<strong class="kt ir"> performant </strong> HackerNews移动客户端。对于这个项目，我想使用一些我以前没有使用过的库，如Immer和Redux-Saga。我的重点之一是创建一个高性能的UI体验，因此我选择实现我自己的导航解决方案，这将在本系列的另一部分中讨论。</p><h2 id="b174" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">在这一部分中，我们将重点关注redux、redux-saga的设置，以及应用程序的开始屏幕，该屏幕显示了来自hackernews的置顶、显示、询问、新故事。这篇文章概述了我所做的选择和最佳实践。</h2><p id="2632" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">正在进行的工作和源代码可以在这里找到:【https://github.com/Rusfighter/HackerNewsRN<a class="ae ml" href="https://github.com/Rusfighter/HackerNewsRN" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="f90f" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated">堆栈</h1><ul class=""><li id="64b4" class="mx my iq kt b ku mg kx mh la mz le na li nb lm nc nd ne nf bi translated">反应本地(无Expo，进一步阅读我的选择)</li><li id="a2a6" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ml" href="https://redux.js.org/" rel="noopener ugc nofollow" target="_blank"> Redux </a>进行状态管理&amp;缓存</li><li id="7954" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ml" href="https://github.com/redux-saga/redux-saga" rel="noopener ugc nofollow" target="_blank">减少副作用</a></li><li id="d3a2" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ml" href="https://github.com/mweststrate/immer" rel="noopener ugc nofollow" target="_blank">浸入</a>以获得不变性</li><li id="dfd6" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">为导航渲染道具</li><li id="79bd" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">分形项目结构</li></ul><h1 id="6a40" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated">React-native-cli与Expo-cli</h1><p id="d704" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我选择不使用expo starter kit有一个简单的原因:我永远也不会用到的依赖项会使部署的二进制文件非常大(20mb+)。另一个原因是对我将来可以使用的依赖项有更多的控制。).</p><h1 id="529a" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated">黑客新闻</h1><p id="7d37" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我选择创建一个hackernews克隆应用程序的原因非常简单。我不想编写任何后端代码，只想专注于客户端部分，因此我查看了可用的公共API以及人们迄今为止用它们创建的东西。其中一个项目:<a class="ae ml" href="https://github.com/hidroh/materialistic" rel="noopener ugc nofollow" target="_blank">https://github.com/hidroh/materialistic</a>这是一个用Java为Android开发的黑客新闻应用，看起来非常好。我想看看我能在多大程度上推动react-native，使其成为一个本地应用程序，甚至更好。hackernews的公共API可从这里获得:<a class="ae ml" href="https://github.com/HackerNews/API" rel="noopener ugc nofollow" target="_blank">https://github.com/HackerNews/API</a></p><h1 id="c804" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated">我们开始吧</h1><p id="2cc9" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">首先你需要为react native设置你的环境，文档可以在这里找到:<a class="ae ml" href="https://facebook.github.io/react-native/docs/getting-started.html" rel="noopener ugc nofollow" target="_blank">https://Facebook . github . io/react-Native/docs/getting-started . html</a>选项卡上:<strong class="kt ir">用本地代码构建项目</strong></p><p id="657f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后你可以在https://github.com/Rusfighter/HackerNewsRN<a class="ae ml" href="https://github.com/Rusfighter/HackerNewsRN" rel="noopener ugc nofollow" target="_blank">克隆我的回购</a></p><p id="c2b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行:<strong class="kt ir"> <em class="nl"> npm安装&amp;反应-本机链接反应-本机向量-图标</em> </strong></p><p id="6e31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有app相关代码都可以在/src目录下找到。我选择对我的文件和目录使用分形结构模式(如果你感兴趣的话，请阅读这篇文章),我发现它工作得很好。app的入口点是/src/App.js</p><h1 id="3128" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated"><strong class="ak"> Redux + Redux Saga + Immer </strong></h1><p id="efd5" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">对于状态管理，我选择了著名的redux与redux-saga的组合。众所周知，副作用(API请求等)令人头疼，这也是人们开发Redux Saga的原因。redux saga的好处之一是，我可以让我的reducers非常简单，并将硬逻辑放在中间件中(redux saga)。为了保持我的reducers不可变，我使用了一个名为<a class="ae ml" href="https://github.com/mweststrate/immer" rel="noopener ugc nofollow" target="_blank"> immer </a>的包。这个包与我的助手功能配合得非常好，它让你避免了切换的情况。有了这种组合，你可以很容易地创建纯减速器！</p><p id="012e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">帮助器函数的最终结果，您可以使用它来创建减速器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="032d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">减速器现在看起来像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="799b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如你所见，我们可以直接推送到数组(第19行)并分配给一个对象(第21行)，这都归功于immer。此外，我们不再需要使用任何开关盒。</p><h2 id="9025" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated"><strong class="ak">保持redux状态正常化</strong></h2><p id="3697" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">保持状态正常化总是最好的做法，<strong class="kt ir">即使你认为你现在不需要它，你也会</strong>。说真的，照做就是了！！！<br/> 在这里阅读更多关于如何创建规范化状态以及为什么应该创建的内容:<a class="ae ml" href="https://redux.js.org/recipes/structuringreducers/normalizingstateshape" rel="noopener ugc nofollow" target="_blank">https://redux . js . org/recipes/structuringreducers/normalizingstateshape</a></p><h2 id="d316" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">还原传奇</h2><p id="4535" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">由于这是一个很难的话题，你应该深入研究(或者只是复制)，我将告诉你到目前为止我使用的东西和技巧，使这成为一个简短的部分:</p><p id="1be0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目前我只对API请求使用redux-saga(src/utils/API . js)。我使用的一种模式是确保一个唯一的请求不会出现两次，从而减少网络流量。为了向您展示我的意思，请看下面的代码(很抱歉使用了错误的名称约定，fetchItem = watchGetItem):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="ba15" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">fetchItem函数正在等待GET_ITEM类型的事件。当这个事件发生时，它通过id(第43行)缓存getItem函数的执行，并在后台执行getItem(第8行)函数<strong class="kt ir">，继续等待下一个GET_ITEM事件。但是，如果使用相同的id调度GET_ITEM事件，而getItem函数仍然忙于该id，则getItem函数将不会被执行。结果是我们<strong class="kt ir">不需要</strong>手动取消http请求或浪费请求，这提供了更好的网络控制。这就是使用redux-saga的威力之一！这个功能是<a class="ae ml" href="https://redux-saga.js.org/docs/advanced/Concurrency.html" rel="noopener ugc nofollow" target="_blank">所熟悉的，在redux-saga中实现了最新的</a>效果。为了熟悉redux-saga，我建议阅读他们的文档并观看一些youtube视频。</strong></p><p id="8ed7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在/src/store.js中查看redux及其中间件的配置。这些文件是ducks，这意味着每个类型的reducer、常量和动作创建者都在一个文件中声明(例如src/redux/comments.js包含reducer +动作创建者和常量)。</p><h1 id="a9f3" class="mm lo iq bd lp mn mo mp ls mq mr ms lv jw mt jx ly jz mu ka mb kc mv kd me mw bi translated">主屏幕</h1><p id="1105" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我的选择之一是保持导航简单快捷。因此，我为主页选择了一个底部的tabbar布局，用户可以在故事列表之间快速导航。为此，我使用了一个名为<em class="nl"> react-native-tab-view </em>的包，在我的实践中，如果你正确使用它，它会有最好的性能。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="11e1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">诀窍是延迟加载标签(据我所知在<em class="nl"> react-native-tab-view </em>中没有这个选项)。查看<em class="nl"> _renderScene </em>函数，如果有不清楚的地方可以在评论中询问！该部分的完整源代码位于/src/screens/Home.js中</p><h2 id="54ae" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">置顶，新，询问，显示</h2><p id="bdff" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这些选项卡在外观和功能上非常相似，唯一的区别是从存储中选择的数据和获取数据的调度事件。</p><p id="0b5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Ask选项卡的来源(src/screens/home/Ask.js):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="b7c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">两个要点:</p><ul class=""><li id="ad69" class="mx my iq kt b ku kv kx ky la no le np li nq lm nc nd ne nf bi translated">如果render方法不依赖于props，除非它是一个函数并且没有状态，则实现一个返回false的shouldComponentUpdate方法。考虑这种方法并知道何时真正应该重新渲染组件总是好的(大多数时候这是很昂贵的)</li><li id="5947" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">如果您使用动作创建器，您不需要将它们包装在调度函数中，react-redux会自动为您完成(第26行)</li></ul><h2 id="7297" class="ln lo iq bd lp lq lr dn ls lt lu dp lv la lw lx ly le lz ma mb li mc md me mf bi translated">故事列表</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="be34" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一份外卖:</p><ul class=""><li id="03c3" class="mx my iq kt b ku kv kx ky la no le np li nq lm nc nd ne nf bi translated">因为只有一个API请求来获取Asks stories的整个列表，所以我们手动实现了一个分页(第11行)，当用户滚动到列表底部时，来自商店的更多元素被添加到平面列表中(第22行)</li></ul><p id="ff40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">StoryListItem.js</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="c7f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">三个要点:</p><ul class=""><li id="8c1b" class="mx my iq kt b ku kv kx ky la no le np li nq lm nc nd ne nf bi translated">如果项目没有在redux存储中定义，我们只获取story，因此已经为story应用了应用程序运行时缓存(第6行)</li><li id="52fa" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">我们只重新渲染项目，如果项目已经改变(性能)</li><li id="51a4" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">我们有两个表示，一个虚拟物品只是一些像媒介一样的花哨的装载效果，另一个是真实的表示</li></ul><p id="bd0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在src/screens/home/story listitem . js中查看该文件的完整源代码</p><p id="1ac5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">结果是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/993651827971a0067205007536c6611e.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/1*BIJyGQNWCvhMWHJwiUySsQ.gif"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">模拟GPRS网络，在开发模式下的android模拟器上(大量的console.log)</figcaption></figure><p id="860a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望我给出了一些我认为几种情况下最佳选择的见解。如果你认为你有更好的解决方案或想为这个项目做贡献，请随时PM我或创建一个PR！</p><p id="fcd6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是第一部分的结尾。我希望你喜欢这篇文章，并学到了一些东西。在接下来的部分中，我们将讨论导航、渲染评论、处理网络错误、缓存、渲染html等等…</p></div><div class="ab cl nr ns hu nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ij ik il im in"><p id="2e44" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">项目的当前状态有自定义导航，html渲染和评论页面。所以，继续玩吧，告诉我在下一部分中我应该如何解释这些组件。</p><blockquote class="ny"><p id="54c6" class="nz oa iq bd ob oc od oe of og oh lm dk translated">还有一件事，我不打算在任何商店发布这个应用程序，所以你可以自由地这样做，只是把一些参考github repo:)</p></blockquote><p id="4c09" class="pw-post-body-paragraph kr ks iq kt b ku oi jr kw kx oj ju kz la ok lc ld le ol lg lh li om lk ll lm ij bi translated">直到下一次！</p></div></div>    
</body>
</html>