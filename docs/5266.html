<html>
<head>
<title>Build Serverless API with GraphQL and Azure — Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用GraphQL和Azure构建无服务器API第二部分</h1>
<blockquote>原文：<a href="https://itnext.io/build-serverless-api-with-graphql-and-azure-part-ii-3ae427763ccc?source=collection_archive---------3-----------------------#2021-01-27">https://itnext.io/build-serverless-api-with-graphql-and-azure-part-ii-3ae427763ccc?source=collection_archive---------3-----------------------#2021-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="46ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的上一篇文章中，我讨论了如何在Azure中构建基于GraphQL的无服务器API。如果你还没有读过，你可以从这里开始读:</p><div class="kl km gp gr kn ko"><a href="https://shamique.medium.com/build-serverless-api-with-graphql-and-azure-part-i-e9e7f4be0200" rel="noopener follow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">用GraphQL和Azure构建无服务器API第一部分</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">将GraphQL与Azure函数集成</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">shamique.medium.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc ld ko"/></div></div></a></div><p id="c093" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本章中，我将讨论如何将我们构建的功能部署到Azure cloud，并为API实现OAuth2安全性。</p><p id="7ca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们将在本文中涉及的内容的概要图，</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/4bedb8d58003b370bde59c7487e9345f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86NmpprOcGCs9lIAfc9KpA.jpeg"/></div></div></figure><p id="7f31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先创建我们的函数App。</p><h1 id="55f4" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">创建Azure功能应用程序</h1><p id="1e0d" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">为了部署我们的功能，我将使用Azure CLI命令。首先，让我们登录Azure订阅。</p><p id="3230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开您的控制台并运行</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="1b48" class="mx lq iq mt b gy my mz l na nb">az login</span></pre><p id="00cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将提示您登录Azure订阅。提供您的用户名和密码。认证后，您可以关闭浏览器。</p><p id="78e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要部署我们的功能，我们需要事先创建以下资源:</p><ul class=""><li id="1910" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">Azure资源组</li><li id="7226" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">Azure存储帐户</li><li id="3f16" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">Azure功能app</li></ul><p id="23c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以让我们一个接一个地创建这些资源。首先让我们在bash控制台中定义以下变量。</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="0545" class="mx lq iq mt b gy my mz l na nb">RESOURCE_GROUP="graphql-rg"<br/>LOCATION="eastus"<br/>STORAGE_ACCOUNT="graphqlstorage23"<br/>FUNCTION_APP="graphql-function"</span></pre><blockquote class="nq nr ns"><p id="0612" class="jn jo nt jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">您可以随意更新这些值。请注意:存储帐户只能由字母和数字组成。</p></blockquote><p id="ecc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，让我们创建资源</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="c663" class="mx lq iq mt b gy my mz l na nb"><strong class="mt ir">#Resource group </strong></span><span id="27dd" class="mx lq iq mt b gy nx mz l na nb">az group create --name $RESOURCE_GROUP --location $LOCATION</span><span id="1b5e" class="mx lq iq mt b gy nx mz l na nb"><strong class="mt ir">#Storage Account</strong></span><span id="edfd" class="mx lq iq mt b gy nx mz l na nb">az storage account create --name $STORAGE_ACCOUNT \<br/>--location $LOCATION \<br/>--resource-group $RESOURCE_GROUP \<br/>--sku Standard_LRS</span><span id="fe51" class="mx lq iq mt b gy nx mz l na nb"><strong class="mt ir">#Function APP</strong></span><span id="6c51" class="mx lq iq mt b gy nx mz l na nb">az functionapp create \<br/>--resource-group $RESOURCE_GROUP \<br/>--name $FUNCTION_APP \<br/>--consumption-plan-location $LOCATION \<br/>--runtime node \<br/>--storage-account $STORAGE_ACCOUNT \<br/>--functions-version 3</span></pre><p id="695c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经创建了部署我们的职能所需的资源。现在让我们部署代码。</p><blockquote class="nq nr ns"><p id="ea21" class="jn jo nt jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">第一部分的源代码在这里上传。如果需要，你可以克隆:<a class="ae ny" href="https://github.com/shamique/GraphQL-AzureFunction" rel="noopener ugc nofollow" target="_blank">https://github.com/shamique/GraphQL-AzureFunction</a></p></blockquote><h1 id="df02" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">部署功能</h1><p id="e465" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">在我们将该功能部署到云之前，让我们禁用GraphQL playground。因为我们在生产模式下不需要GraphQL playground。</p><p id="2131" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">编辑index.js函数，在Apollo服务器初始化中添加<code class="fe nz oa ob mt b"><strong class="jp ir">playground: false</strong></code>。</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="70ae" class="mx lq iq mt b gy my mz l na nb">...</span><span id="38bf" class="mx lq iq mt b gy nx mz l na nb">const server = new ApolloServer({ typeDefs, resolvers, <strong class="mt ir">playground: false</strong> });</span><span id="24e2" class="mx lq iq mt b gy nx mz l na nb">exports.graphqlHandler = server.createHandler();</span></pre><p id="bead" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧！让我们部署代码。导航到应用程序路径(如果尚未导航)。</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="1ab7" class="mx lq iq mt b gy my mz l na nb">func azure functionapp publish $FUNCTION_APP</span></pre><p id="637a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功部署后，您将获得该函数的URL。收到，我们将在下一步中使用它。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oc"><img src="../Images/cb329764f68799a570c51efb7974fd91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJrY7I1PGIFqmNnuOtcUXg.png"/></div></div></figure><h1 id="debf" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">测试API</h1><p id="a011" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">因为我们禁用了GraphQL playground，所以我们不能在浏览器中测试API。所以让我们用Postman来做我们的测试。</p><p id="d6b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开post man并粘贴API URL。然后，选择Body部分下的GraphQL，并粘贴您的查询参数。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi od"><img src="../Images/e0f52a08ce95f6477bb8008b44572008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xnnwxjpVgtmNVCSrlXNIA.png"/></div></div></figure><p id="1ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将请求作为POST请求发送，并检查结果。如果您已经正确地设置了一切，您应该会看到结果。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi oe"><img src="../Images/da1495afbf8e01adb865858253d02ad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZxZ8TWtoL3DRXoHtnu-MQ.png"/></div></div></figure><p id="244c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">万岁！！！我们做到了。</p><p id="fd3d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前我们部署的API是公开的。也就是说，任何有链接的人都可以访问数据。所以让我们用oAuth2来保护这个API。</p></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><h1 id="cb42" class="lp lq iq bd lr ls om lu lv lw on ly lz ma oo mc md me op mg mh mi oq mk ml mm bi translated">使用身份验证令牌保护API</h1><p id="cd9d" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">为了保护我们的API，我将对Azure AD使用oAuth2隐式授权流。要了解更多关于oAuth2隐式授权流的信息，您可以在此处阅读:</p><div class="kl km gp gr kn ko"><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">微软身份平台和OAuth 2.0授权代码流-微软身份平台</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">OAuth 2.0授权码授权可用于安装在设备上的应用程序，以获得对受保护的…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">docs.microsoft.com</p></div></div><div class="kx l"><div class="or l kz la lb kx lc ld ko"/></div></div></a></div><p id="cc3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，现在让我们用Azure AD为我们的应用程序启用身份验证。</p><ul class=""><li id="15f1" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">登录Azure门户→选中你的Azure功能。然后导航至<strong class="jp ir">认证/授权</strong>并启用“应用服务认证”。然后从下拉列表中选择“使用Azure Active Directory登录”选项。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi os"><img src="../Images/f95baa7e26667e7d939d563f83a8245d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5nIiT7GCafZwTbYAPJgK4Q.png"/></div></div></figure><ul class=""><li id="81f5" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">点击“Azure Active Directory”选项并选择“快速”模式。保留其余设置，单击“确定”，然后单击“保存”。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ot"><img src="../Images/8a7576f192c7ee7094f77bb60da6fa4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xfUhA7Y1YSgfi02ZicYJVg.png"/></div></div></figure><p id="2738" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经为我们的功能应用启用了广告认证。现在，让我们配置我们的广告应用程序来获取访问令牌。</p><ul class=""><li id="d92d" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">在azure portal中，导航到“Azure Active Directory”，然后从菜单中单击“应用注册”。你应该看到新创建的应用程序下的应用程序列表。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ou"><img src="../Images/3c8982c3ff6f8b80124d7f9a9035c72c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHr6MK3A1H8x7SsBw16PBQ.jpeg"/></div></div></figure><ul class=""><li id="a668" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">打开你的应用程序，导航至“认证”。在重定向URI下，添加一个新的重定向URL“localhost”。</li></ul><blockquote class="nq nr ns"><p id="8dec" class="jn jo nt jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated">通过身份验证后，您将获得访问重定向URL中提供的URL的访问令牌。</p></blockquote><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ov"><img src="../Images/5d5675ab473af2f765111c9b4137c3b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZI9st5s3tQObtGHud2cdrA.png"/></div></div></figure><ul class=""><li id="67a0" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">然后，选择“隐式授权和混合流”部分下的“ID令牌”</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ow"><img src="../Images/5b06d0bc753eaaf2a5fb2876fae3b62d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzuQy0iVcbuFYFpAnmO45g.png"/></div></div></figure><p id="f41d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，我们已经用AD配置了函数应用程序，并启用了隐式授权流。在我们进入测试之前，我们需要向我们的应用程序添加一个<strong class="jp ir">密钥</strong>。我们需要这个密钥从客户端应用程序获取访问令牌。</p><ul class=""><li id="d062" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">导航至应用程序中的“客户和秘密”部分。单击“新客户端密码”。添加一个首选名称，然后单击添加。复制客户端机密值，这是我们下一步需要的。</li></ul><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ox"><img src="../Images/40cb0abdf41e3a7be0f22c69901e51f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nHOF9v3Ik0tgW5yAMuER6g.png"/></div></div></figure><p id="068e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好吧。因此，我们已经为API配置了隐式授权流。现在让我们测试我们的API。</p><h1 id="6793" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">使用访问令牌测试API</h1><p id="ae83" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">因为我们为API启用了身份验证，所以没有访问令牌就不能调用API。如果在postman中重新测试API，应该会得到401未授权异常。</p><p id="44bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，要调用我们的API，我们应该按顺序遵循以下步骤:</p><ul class=""><li id="61f3" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">获取授权码</li><li id="22ff" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">用访问令牌交换授权码</li><li id="a7b2" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">使用访问令牌调用API</li></ul><h2 id="587d" class="mx lq iq bd lr oy oz dn lv pa pb dp lz jy pc pd md kc pe pf mh kg pg ph ml pi bi translated">获取授权码</h2><p id="caf0" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">要获得授权码，我们需要使用以下URL，</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="8413" class="mx lq iq mt b gy my mz l na nb">https://login.microsoftonline.com/<strong class="mt ir">{Tenant ID}</strong>/oauth2/authorize?client_id=<strong class="mt ir">{Client_ID}</strong>&amp;response_type=code&amp;response_mode=query&amp;resource_id=<strong class="mt ir">{Client_ID}</strong>&amp;redirect_uri=https://localhost</span></pre><p id="f103" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">租户ID和客户ID可以从广告应用程序概览页面的概览页面中获取</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pj"><img src="../Images/ca2c0f200ec4417cdd8eacfc324317e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qz9iOw_HZ7fvBrkW2a_5kQ.png"/></div></div></figure><p id="8667" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用正确的值替换突出显示的查询参数，并在浏览器中浏览。您将被要求登录您的Azure订阅。提供凭据，成功登录后，您将被重定向到带有授权代码的本地主机回调url。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pk"><img src="../Images/64976698ccb196c847b8b0d38e6a6288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xf0jqcK4wqdm8qGloqOQfw.png"/></div></div></figure><blockquote class="nq nr ns"><p id="2f7b" class="jn jo nt jp b jq jr js jt ju jv jw jx nu jz ka kb nv kd ke kf nw kh ki kj kk ij bi translated"><strong class="jp ir">注意:</strong>在回调URL中，您将有两个查询参数。代码&amp;会话状态。确保只复制代码值</p></blockquote><p id="9789" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">复制授权码。我们将在下一步中使用此代码来获取访问令牌。</p><h2 id="5d3a" class="mx lq iq bd lr oy oz dn lv pa pb dp lz jy pc pd md kc pe pf mh kg pg ph ml pi bi translated">用访问令牌交换授权码</h2><p id="a1b4" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">要获得oAuth2访问令牌，我们需要向oAuth2 url下面发出post请求，并在请求体中传递一些属性。</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="c739" class="mx lq iq mt b gy my mz l na nb">https://login.microsoftonline.com/common/oauth2/token</span></pre><p id="3fa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开PostMan工具，按如下方式构造查询请求:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pl"><img src="../Images/3ceeadd6bbfcc074129b300c358ff3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVPU6Ks9w3wWS0CEPAPGoQ.png"/></div></div></figure><ul class=""><li id="9e2e" class="nc nd iq jp b jq jr ju jv jy ne kc nf kg ng kk nh ni nj nk bi translated">代码—提供我们在上一步中复制的授权代码</li><li id="c2e9" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">client_id &amp; resource —提供您的应用程序的客户端id</li><li id="4f9b" class="nc nd iq jp b jq nl ju nm jy nn kc no kg np kk nh ni nj nk bi translated">client_secret —提供您在上一步中复制的客户端机密</li></ul><p id="772c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请求成功后，您应该得到类似的响应，如下所示，带有访问令牌和刷新令牌:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pm"><img src="../Images/9e8738287ea4fb0bf2cda93e94c749e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VEDmWHqROESIMraTlk39Og.png"/></div></div></figure><p id="5b3a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">复制access_token。在下一步中，我们可以使用这个访问令牌来调用我们的API。</p><h2 id="02da" class="mx lq iq bd lr oy oz dn lv pa pb dp lz jy pc pd md kc pe pf mh kg pg ph ml pi bi translated">使用访问令牌调用API</h2><p id="ddd1" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">现在回到我们的API服务器调用，在postman中添加授权头作为<strong class="jp ir">载体&lt; your_access_token &gt; </strong>。</p><p id="eb2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，调用API，您现在应该得到没有任何问题的响应。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi pn"><img src="../Images/40f88f3342d7e82e5bc9d13aca2fb56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i5UQt-atQ0RWS5FREJROVA.png"/></div></div></figure><p id="6146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">厉害！！！现在，我们的API是可扩展的、高效的，也是安全的。</p><h1 id="5dc7" class="lp lq iq bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">包裹</h1><p id="3d1e" class="pw-post-body-paragraph jn jo iq jp b jq mn js jt ju mo jw jx jy mp ka kb kc mq ke kf kg mr ki kj kk ij bi translated">这标志着这个系列的结束。完成练习后，您可以删除Azure订阅中的资源以避免计费。如果所有资源都在一个资源组下，您可以直接删除资源组本身。否则，您将不得不逐个删除每个资源。</p><pre class="lf lg lh li gt ms mt mu mv aw mw bi"><span id="0c66" class="mx lq iq mt b gy my mz l na nb">az group delete --name &lt;Resource Group Name&gt; --yes</span></pre></div><div class="ab cl of og hu oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="ij ik il im in"><h1 id="02c7" class="lp lq iq bd lr ls om lu lv lw on ly lz ma oo mc md me op mg mh mi oq mk ml mm bi translated">参考链接</h1><div class="kl km gp gr kn ko"><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">微软身份平台和OAuth 2.0授权代码流-微软身份平台</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">OAuth 2.0授权码授权可用于安装在设备上的应用程序，以获得对受保护的…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">docs.microsoft.com</p></div></div><div class="kx l"><div class="po l kz la lb kx lc ld ko"/></div></div></a></div><div class="kl km gp gr kn ko"><a href="https://docs.microsoft.com/en-us/cli/azure/" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">Azure CLI概述</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">Azure命令行界面(Azure CLI)是一组用于创建和管理Azure资源的命令。蔚蓝的天空…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">docs.microsoft.com</p></div></div><div class="kx l"><div class="pp l kz la lb kx lc ld ko"/></div></div></a></div><div class="kl km gp gr kn ko"><a href="https://www.apollographql.com/docs/apollo-server/deployment/azure-functions/" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab fo"><div class="kq ab kr cl cj ks"><h2 class="bd ir gy z fp kt fr fs ku fu fw ip bi translated">使用Azure功能部署</h2><div class="kv l"><h3 class="bd b gy z fp kt fr fs ku fu fw dk translated">这是Apollo社区GraphQL服务器的Azure功能集成。阅读文档下面的所有示例是…</h3></div><div class="kw l"><p class="bd b dl z fp kt fr fs ku fu fw dk translated">www.apollographql.com</p></div></div><div class="kx l"><div class="pq l kz la lb kx lc ld ko"/></div></div></a></div></div></div>    
</body>
</html>