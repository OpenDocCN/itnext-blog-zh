<html>
<head>
<title>Build a simple Ethereum + InterPlanetary File System (IPFS)+ React.js DApp.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个简单的以太坊+星际文件系统(IPFS)+ React.js DApp。</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-simple-ethereum-interplanetary-file-system-ipfs-react-js-dapp-23ff4914ce4e?source=collection_archive---------0-----------------------#2018-03-09">https://itnext.io/build-a-simple-ethereum-interplanetary-file-system-ipfs-react-js-dapp-23ff4914ce4e?source=collection_archive---------0-----------------------#2018-03-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a61d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们为什么要建造这个？</p><p id="45e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在以太坊区块链</strong>上存储大量数据的成本高得惊人。根据以太坊的黄皮书，256位/8字节(1个字)大约需要20，000 gas。基于2018年2月28日天然气价格4 gwei/gas。查看:<a class="ae kl" href="https://ethgasstation.info" rel="noopener ugc nofollow" target="_blank">https://eth gastation . info</a>当前价格。</p><p id="feb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8字节的每笔交易20，000 gas x4 gwei/gas = 8字节的80，000 gwei。</p><p id="ffb3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8个字节80,000 gwei。x 1000字节/8 = 10，000，000 gwei/kB = 0.01以太</p><p id="a1fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">. 01以太/kB x 1000kB = 10以太以860美元/以太= 8600.00美元存储1Mb！在以太坊区块链上存储一个1 GB的文件需要花费860万美元！</p><p id="0919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">存储以太坊的38页PDF黄皮书(520Kb) = $4472美元。参见:<a class="ae kl" href="http://eth-converter.com/" rel="noopener ugc nofollow" target="_blank">http://eth-converter.com/</a>进行转换。</p><p id="6f55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们只能负担得起在区块链上存储几Kb的数据，那么我们仍将不得不依靠集中式服务器来存储数据。令人欣慰的是，一种称为星际文件系统(“IPFS”)的在分散网络上存储数据的解决方案是可用的。参见:<a class="ae kl" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank">https://ipfs.io/</a>阅读更多。在IPFS查找文件时，您是在要求网络寻找存储唯一散列背后内容的节点。来自IPFS自己的网站:</p><blockquote class="km kn ko"><p id="7995" class="jn jo kp jp b jq jr js jt ju jv jw jx kq jz ka kb kr kd ke kf ks kh ki kj kk ij bi translated">“IPFS和区块链是绝配！您可以使用IPFS处理大量数据，并将不可变的永久IPFS链接放入区块链事务中。这将为您的内容添加时间戳并保护其安全，而无需将数据放在链上。”</p></blockquote><p id="db49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">我们在建造什么？</strong></p><p id="9547" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个简单的DApp上传文件到IPFS，然后存储在以太坊区块链IPFS散列。一旦IPFS散列值被发送到以太坊区块链，用户将收到一张交易收据。我们将使用Create-React-App框架来制作前端。此Dapp适用于任何在其浏览器中安装了元掩码的用户。</p><p id="80d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们完工后DApp的样子:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/611dda3d44c11ab36775753216a90ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHlV4WFT04gxVQicSOgwCg.png"/></div></div></figure><p id="f896" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">如何构建:</strong></p><p id="8e40" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注:如果你只是想要代码，请到https://github.com/mcchan1/eth-ipfs<a class="ae kl" href="https://github.com/mcchan1/eth-ipfs" rel="noopener ugc nofollow" target="_blank">看我的github。</a></p><p id="9091" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们开始之前，这些是我做的假设:</p><p id="e219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关于用户的假设:</strong>用户安装了元掩码以与DApp交互。</p><p id="30a2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">关于你/开发者的假设:</strong>你对JavaScript和/或React.js以及Node.js/NPM.有些熟悉重要说明:请确保你运行的是Node和NPM的最新版本。对于本教程，我正在运行:<strong class="jp ir">节点v8.9.4 </strong>和<strong class="jp ir"> NPM 5.6.0 </strong>。</p><p id="0bee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装元掩码。</strong>如果还没有安装MetaMask，请转到<a class="ae kl" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">https://metamask.io/</a>并按照说明操作。该DApp将假设用户安装了元掩码。</p><p id="cf82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建一个目录来存储我们的DApp。对于本教程，我称之为“eth-ipfs”</strong></p><p id="9b58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用NPM安装Create-React-App和其他依赖项。</strong>使用NPM并安装以下部件:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="7890" class="lk ll iq lg b gy lm ln l lo lp">npm i create-react-app<br/>npm install react-bootstrap<br/>npm install fs-extra<br/>npm install ipfs-api<br/>npm install web3@^1.0.0-beta.26</span></pre><p id="339e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">进入“eth-ipfs”目录，键入“NPM start”</strong>，Create-React-App应该会自动呈现在<a class="ae kl" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>上。</p><p id="7678" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp">注意:如果您到目前为止还没有使用create-react-app，您可能需要先全局安装它</em></p><p id="4b96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp"> 1。sudo NPM install-g create-react-app<br/>或NPM install-g create-react-app</em></p><p id="62f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp"> 2。创建-反应-应用eth-ipfs </em></p><p id="4d0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kp"> 3。cd进入eth-ipfs和“npm启动”</em></p><p id="6e68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在Rinkeby testnet上使用Remix部署以下Solidity代码。</strong>参见，<a class="ae kl" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org</a>。你将需要一些Rinkeby测试乙醚，如果你还没有一些去Rinkeby水龙头免费测试乙醚。<a class="ae kl" href="https://www.rinkeby.io/#faucet" rel="noopener ugc nofollow" target="_blank">https://www.rinkeby.io/#faucet</a>。</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="1fba" class="lk ll iq lg b gy lm ln l lo lp">pragma solidity ^0.4.17;</span><span id="7098" class="lk ll iq lg b gy lq ln l lo lp">contract Contract {<br/> string ipfsHash;<br/> <br/> function sendHash(string x) public {<br/>   ipfsHash = x;<br/> }<br/><br/> function getHash() public view returns (string x) {<br/>   return ipfsHash;<br/> }</span><span id="095f" class="lk ll iq lg b gy lq ln l lo lp">}</span></pre><p id="10b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">保存部署的合同地址和应用二进制接口(ABI)。</strong>要获得合同的ABI，请在Remix中转至您的合同地址:</p><p id="77d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单击“编译”选项卡，然后单击灰色的“详细信息”按钮。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/d035bea20839bed7dff56fe1c0e0353c.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*QDTRyuLk6zK6ZMFWgc47Yw.png"/></div></figure><p id="9e70" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将打开详细信息窗口。复制“ABI”，这是一个JSON文件。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/d53fc82afd51455344f807953609ed99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*RpCmf2eLsgS7ppkE-Gy3sQ.png"/></div></figure><p id="4e5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就我个人而言，我更喜欢将ABI JSON放入格式化程序，比如https://jsonformatter.org<a class="ae kl" href="https://jsonformatter.org" rel="noopener ugc nofollow" target="_blank">和T36】，并在我的javascript代码中使用它之前检查它是否有效。把合同地址和ABI留着以后用。</a></p><p id="5d53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的“eth-ipfs/src”目录下，创建以下文件:<strong class="jp ir"> web3.js </strong>、<strong class="jp ir"> ipfs.js </strong>和<strong class="jp ir"> storehash.js </strong>。我们的大部分代码将在<strong class="jp ir"> App.js </strong>中。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/b0288be3c33d14320e765c70a55527bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*ofqwUkZCSWHPhy0hJlv2-g.png"/></div></figure><p id="5e05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> web3.js </strong></p><p id="f87d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们希望使用web3.js的1.0版本，因为与0.20版本不同，1.0允许我们在javascript中使用async和await来代替promises。目前，MetaMask的默认web3.js提供程序是0.20版本。因此，让我们确保覆盖Metamask的web3版本0.20的默认版本，并使用我们的1.0。代码如下:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="3da8" class="lk ll iq lg b gy lm ln l lo lp">//overrides metamask v0.2 for our 1.0 version. <br/>//1.0 lets us use async and await instead of promises</span><span id="e292" class="lk ll iq lg b gy lq ln l lo lp">import Web3 from ‘web3’;<br/><br/>const web3 = new Web3(window.web3.currentProvider);</span><span id="dc22" class="lk ll iq lg b gy lq ln l lo lp">export default web3;</span></pre><p id="2110" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> storehash.js </strong></p><p id="6c42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了让web3.js访问我们之前部署到以太坊的Rinkeby testnet的合同，您需要以下内容:1)合同地址和2)合同中的ABI。一定要从/src目录中导入web3.js文件。代码如下:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="1593" class="lk ll iq lg b gy lm ln l lo lp">import web3 from './web3';</span><span id="6dcc" class="lk ll iq lg b gy lq ln l lo lp">//access our local copy to contract deployed on rinkeby testnet<br/>//use your own contract address</span><span id="a4a9" class="lk ll iq lg b gy lq ln l lo lp">const address = '0xb84b12e953f5bcf01b05f926728e855f2d4a67a9';</span><span id="663a" class="lk ll iq lg b gy lq ln l lo lp">//use the ABI from your contract</span><span id="dddf" class="lk ll iq lg b gy lq ln l lo lp">const abi = [<br/>  {<br/>    "constant": true,<br/>    "inputs": [],<br/>    "name": "getHash",<br/>    "outputs": [<br/>      {<br/>        "name": "x",<br/>        "type": "string"<br/>      }<br/>    ],<br/>    "payable": false,<br/>    "stateMutability": "view",<br/>    "type": "function"<br/>  },<br/>  {<br/>    "constant": false,<br/>    "inputs": [<br/>      {<br/>        "name": "x",<br/>        "type": "string"<br/>      }<br/>    ],<br/>    "name": "sendHash",<br/>    "outputs": [],<br/>    "payable": false,<br/>    "stateMutability": "nonpayable",<br/>    "type": "function"<br/>  }<br/>]</span><span id="fc84" class="lk ll iq lg b gy lq ln l lo lp">export default new web3.eth.Contract(abi, address);</span></pre><p id="78ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ipfs.js </strong></p><p id="37f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本教程中，我们将运行<a class="ae kl" href="http://ipfs.infura.io" rel="noopener ugc nofollow" target="_blank"> ipfs.infura.io </a>节点来连接ipfs，而不是在我们自己的计算机上运行IPFS守护进程。在代码注释中，如果您将IPFS作为一个全局依赖项安装，您还可以选择运行自己的IPFS守护进程。参见，<a class="ae kl" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">https://infura.io/</a>关于使用他们的节点的更多信息。代码如下:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="1001" class="lk ll iq lg b gy lm ln l lo lp">//using the infura.io node, otherwise ipfs requires you to run a //daemon on your own computer/server.</span><span id="88a4" class="lk ll iq lg b gy lq ln l lo lp">const IPFS = require(‘ipfs-api’);<br/>const ipfs = new IPFS({ host: ‘ipfs.infura.io’, port: 5001, protocol: ‘https’ });</span><span id="2712" class="lk ll iq lg b gy lq ln l lo lp">//run with local daemon<br/>// const ipfsApi = require(‘ipfs-api’);<br/>// const ipfs = new ipfsApi(‘localhost’, ‘5001’, {protocol:‘http’});</span><span id="805f" class="lk ll iq lg b gy lq ln l lo lp">export default ipfs;</span></pre><p id="0d7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> App.js </strong></p><p id="8e35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是App.js中的操作顺序</p><ol class=""><li id="9e7b" class="lu lv iq jp b jq jr ju jv jy lw kc lx kg ly kk lz ma mb mc bi translated">设置状态变量。</li><li id="5c8a" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">捕获用户的文件。</li><li id="ec2e" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">将文件转换为缓冲区。</li><li id="2921" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">将缓冲文件发送到IPFS</li><li id="8e33" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">IPFS返回一个散列值。</li><li id="3a29" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">获取用户的元掩码以太坊地址</li><li id="e568" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">将IPFS发送到以太坊进行存储。</li><li id="69d9" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">使用元掩码，用户将向以太坊确认交易。</li><li id="6c3b" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">以太坊契约将返回一个交易散列数。</li><li id="3fb2" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">交易散列号可用于生成交易收据，该收据具有诸如使用的气体量和区块号的信息。</li><li id="9a4b" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk lz ma mb mc bi translated">当IPFS和以太坊信息在一个表格中可用时，它将使用CSS的Bootstrap来呈现。注意:我没有创建isLoading类型变量来自动重新呈现blockNumber和gasUsed变量的状态。所以现在，你必须再次点击或者实现你自己的加载图标。下面是描述变量和函数的表格，以及代码本身:</li></ol><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/b3caac582a02e332aa4bccc3022811e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*_wCKVcaT_MHmVWk1MLFxZQ.png"/></div></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/d2cbdbb8da2870f6413a00c82806575b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*M37jYzn2vHxSKU2Be20LVA.png"/></div></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/5a69c5813333d8d747af6301069482f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*BwOHqXWx6kx7wspCyPBcPA.png"/></div></figure><p id="714d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，这里是<strong class="jp ir"> App.js </strong>代码:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="ad5c" class="lk ll iq lg b gy lm ln l lo lp">import React, { Component } from ‘react’;<br/>//import logo from ‘./logo.svg’;<br/>import ‘./App.css’;<br/>import web3 from ‘./web3’;<br/>import ipfs from ‘./ipfs’;<br/>import storehash from ‘./storehash’;</span><span id="5a04" class="lk ll iq lg b gy lq ln l lo lp">class App extends Component {<br/> <br/>    state = {<br/>      ipfsHash:null,<br/>      buffer:'',<br/>      ethAddress:'',<br/>      blockNumber:'',<br/>      transactionHash:'',<br/>      gasUsed:'',<br/>      txReceipt: ''   <br/>    };</span><span id="2534" class="lk ll iq lg b gy lq ln l lo lp">captureFile =(event) =&gt; {<br/>        event.stopPropagation()<br/>        event.preventDefault()<br/>        const file = event.target.files[0]<br/>        let reader = new window.FileReader()<br/>        reader.readAsArrayBuffer(file)<br/>        reader.onloadend = () =&gt; this.convertToBuffer(reader)    <br/>      };<br/> convertToBuffer = async(reader) =&gt; {<br/>      //file is converted to a buffer for upload to IPFS<br/>        const buffer = await Buffer.from(reader.result);<br/>      //set this buffer -using es6 syntax<br/>        this.setState({buffer});<br/>    };</span><span id="8dfb" class="lk ll iq lg b gy lq ln l lo lp">onClick = async () =&gt; {</span><span id="c316" class="lk ll iq lg b gy lq ln l lo lp">try{<br/>        this.setState({blockNumber:"waiting.."});<br/>        this.setState({gasUsed:"waiting..."});</span><span id="4060" class="lk ll iq lg b gy lq ln l lo lp">//get Transaction Receipt in console on click<br/>//See: <a class="ae kl" href="https://web3js.readthedocs.io/en/1.0/web3-eth.html#gettransactionreceipt" rel="noopener ugc nofollow" target="_blank">https://web3js.readthedocs.io/en/1.0/web3-eth.html#gettransactionreceipt</a></span><span id="009a" class="lk ll iq lg b gy lq ln l lo lp">await web3.eth.getTransactionReceipt(this.state.transactionHash, (err, txReceipt)=&gt;{<br/>          console.log(err,txReceipt);<br/>          this.setState({txReceipt});<br/>        }); //await for getTransactionReceipt</span><span id="3f99" class="lk ll iq lg b gy lq ln l lo lp">await this.setState({blockNumber: this.state.txReceipt.blockNumber});<br/>        await this.setState({gasUsed: this.state.txReceipt.gasUsed});    <br/>      } //try<br/>    catch(error){<br/>        console.log(error);<br/>      } //catch<br/>  } //onClick</span><span id="471c" class="lk ll iq lg b gy lq ln l lo lp">onSubmit = async (event) =&gt; {<br/>      event.preventDefault();</span><span id="03de" class="lk ll iq lg b gy lq ln l lo lp">     //bring in user's metamask account address<br/>      const accounts = await web3.eth.getAccounts();<br/>     <br/>      console.log('Sending from Metamask account: ' + accounts[0]);</span><span id="08cd" class="lk ll iq lg b gy lq ln l lo lp">    //obtain contract address from storehash.js<br/>      const ethAddress= await storehash.options.address;<br/>      this.setState({ethAddress});</span><span id="6c04" class="lk ll iq lg b gy lq ln l lo lp">    //save document to IPFS,return its hash#, and set hash# to state<br/>    //<a class="ae kl" href="https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/FILES.md#add" rel="noopener ugc nofollow" target="_blank">https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/FILES.md#add</a> </span><span id="79ab" class="lk ll iq lg b gy lq ln l lo lp">      await ipfs.add(this.state.buffer, (err, ipfsHash) =&gt; {<br/>        console.log(err,ipfsHash);<br/>        //setState by setting ipfsHash to ipfsHash[0].hash <br/>        this.setState({ ipfsHash:ipfsHash[0].hash });</span><span id="1646" class="lk ll iq lg b gy lq ln l lo lp">   // call Ethereum contract method "sendHash" and .send IPFS hash to etheruem contract <br/>  //return the transaction hash from the ethereum contract<br/> //see, this <a class="ae kl" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#methods-mymethod-send" rel="noopener ugc nofollow" target="_blank">https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#methods-mymethod-send</a><br/>        <br/>        storehash.methods.sendHash(this.state.ipfsHash).send({<br/>          from: accounts[0] <br/>        }, (error, transactionHash) =&gt; {<br/>          console.log(transactionHash);<br/>          this.setState({transactionHash});<br/>        }); //storehash <br/>      }) //await ipfs.add <br/>    }; //onSubmit</span><span id="628c" class="lk ll iq lg b gy lq ln l lo lp">render() {<br/>      <br/>      return (<br/>        &lt;div className="App"&gt;<br/>          &lt;header className="App-header"&gt;<br/>            &lt;h1&gt; Ethereum and IPFS with Create React App&lt;/h1&gt;<br/>          &lt;/header&gt;<br/>          <br/>          &lt;hr /&gt;</span><span id="df97" class="lk ll iq lg b gy lq ln l lo lp">&lt;Grid&gt;<br/>          &lt;h3&gt; Choose file to send to IPFS &lt;/h3&gt;<br/>          &lt;Form onSubmit={this.onSubmit}&gt;<br/>            &lt;input <br/>              type = "file"<br/>              onChange = {this.captureFile}<br/>            /&gt;<br/>             &lt;Button <br/>             bsStyle="primary" <br/>             type="submit"&gt; <br/>             Send it <br/>             &lt;/Button&gt;<br/>          &lt;/Form&gt;</span><span id="e800" class="lk ll iq lg b gy lq ln l lo lp">&lt;hr/&gt;<br/> &lt;Button onClick = {this.onClick}&gt; Get Transaction Receipt &lt;/Button&gt;</span><span id="5378" class="lk ll iq lg b gy lq ln l lo lp">  &lt;Table bordered responsive&gt;<br/>                &lt;thead&gt;<br/>                  &lt;tr&gt;<br/>                    &lt;th&gt;Tx Receipt Category&lt;/th&gt;<br/>                    &lt;th&gt;Values&lt;/th&gt;<br/>                  &lt;/tr&gt;<br/>                &lt;/thead&gt;<br/>               <br/>                &lt;tbody&gt;<br/>                  &lt;tr&gt;<br/>                    &lt;td&gt;IPFS Hash # stored on Eth Contract&lt;/td&gt;<br/>                    &lt;td&gt;{this.state.ipfsHash}&lt;/td&gt;<br/>                  &lt;/tr&gt;<br/>                  &lt;tr&gt;<br/>                    &lt;td&gt;Ethereum Contract Address&lt;/td&gt;<br/>                    &lt;td&gt;{this.state.ethAddress}&lt;/td&gt;<br/>                  &lt;/tr&gt;</span><span id="12fa" class="lk ll iq lg b gy lq ln l lo lp">                  &lt;tr&gt;<br/>                    &lt;td&gt;Tx Hash # &lt;/td&gt;<br/>                    &lt;td&gt;{this.state.transactionHash}&lt;/td&gt;<br/>                  &lt;/tr&gt;</span><span id="3d41" class="lk ll iq lg b gy lq ln l lo lp">                  &lt;tr&gt;<br/>                    &lt;td&gt;Block Number # &lt;/td&gt;<br/>                    &lt;td&gt;{this.state.blockNumber}&lt;/td&gt;<br/>                  &lt;/tr&gt;</span><span id="b92b" class="lk ll iq lg b gy lq ln l lo lp">                  &lt;tr&gt;<br/>                    &lt;td&gt;Gas Used&lt;/td&gt;<br/>                    &lt;td&gt;{this.state.gasUsed}&lt;/td&gt;<br/>                  &lt;/tr&gt;<br/>                <br/>                &lt;/tbody&gt;<br/>            &lt;/Table&gt;<br/>        &lt;/Grid&gt;<br/>     &lt;/div&gt;<br/>      );<br/>    } //render<br/>} //App</span><span id="cc00" class="lk ll iq lg b gy lq ln l lo lp">export default App;</span></pre><p id="bf65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在src/ <strong class="jp ir"> App.css </strong>中添加了一点CSS，让它看起来更舒服一些:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="abf8" class="lk ll iq lg b gy lm ln l lo lp">/*some css I added*/<br/>input[type=”file”] {<br/> display: inline-block;<br/>}</span><span id="c92e" class="lk ll iq lg b gy lq ln l lo lp">.table {<br/> max-width: 90%;<br/> margin: 10px;<br/>}<br/>.table th {<br/> text-align: center;<br/>}<br/>/*end of my css*/</span></pre><p id="c5cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">并添加一些导入到<strong class="jp ir"> src/index.js </strong>:</p><pre class="ku kv kw kx gt lf lg lh li aw lj bi"><span id="d60d" class="lk ll iq lg b gy lm ln l lo lp">/*<a class="ae kl" href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#adding-a-stylesheet" rel="noopener ugc nofollow" target="_blank">https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#adding-a-stylesheet</a>*/<br/>import ‘bootstrap/dist/css/bootstrap.css’;<br/>import ‘bootstrap/dist/css/bootstrap-theme.css’;</span></pre><p id="0011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就是这样！你的DApp应该完成了。所以你所需要做的就是选择一个文件，发送它，然后得到一个交易收据。如果您通过localhost:3000连接到一个IPFS节点，那么您应该能够在一个IPFS网关上看到您的文件。<a class="ae kl" href="https://gateway.ipfs.io/ipfs/QmYjh5NsDc6LwU3394NbB42WpQbGVsueVSBmod5WACvpte" rel="noopener ugc nofollow" target="_blank">https://gateway.ipfs.io/ipfs/</a>+你的IPFS哈希#。</p><p id="a099" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如:<a class="ae kl" href="https://gateway.ipfs.io/ipfs/QmYjh5NsDc6LwU3394NbB42WpQbGVsueVSBmod5WACvpte" rel="noopener ugc nofollow" target="_blank">https://gateway . ipfs . io/ipfs/qmyjh 5 nsdc 6 lwu 3394 nbb 42 wpqbgvsuevsbmod 5 WAC vpte</a></p><p id="f2fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于IPFS的一个注意事项是，除非你的文件被另一个节点拾取或者你将其固定，否则IPFS最终将对你的文件进行垃圾收集。他们的网站上有更多关于这方面的内容。</p><p id="f6f3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">参考链接:</strong></p><ul class=""><li id="8152" class="lu lv iq jp b jq jr ju jv jy lw kc lx kg ly kk ml ma mb mc bi translated">【https://ipfs.io/docs/getting-started/ T4】</li><li id="a103" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://web3js.readthedocs.io/en/1.0/index.html" rel="noopener ugc nofollow" target="_blank">https://web3js.readthedocs.io/en/1.0/index.html</a></li><li id="c5ca" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">https://infura.io/</a></li><li id="0cc6" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://react-bootstrap.github.io/getting-started/introduction" rel="noopener ugc nofollow" target="_blank">https://react-bootstrap . github . io/入门/简介</a></li><li id="fc07" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">https://metamask.io/</a></li><li id="7a2e" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://github.com/ipfs/js-ipfs-api" rel="noopener ugc nofollow" target="_blank">https://github.com/ipfs/js-ipfs-api</a></li><li id="b20a" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org/</a></li><li id="92d4" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://ethereum.github.io/yellowpaper/paper.pdf" rel="noopener ugc nofollow" target="_blank">https://ethereum.github.io/yellowpaper/paper.pdf</a></li><li id="7d95" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://ethgasstation.info" rel="noopener ugc nofollow" target="_blank">https://eth gastation . info</a></li><li id="e48a" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="http://eth-converter.com/" rel="noopener ugc nofollow" target="_blank">http://eth-converter.com/</a></li><li id="5ebc" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://www.rinkeby.io/#faucet" rel="noopener ugc nofollow" target="_blank">https://www.rinkeby.io/#faucet</a></li><li id="55b7" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/FileReader</a></li><li id="a8c7" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://github.com/ipfs/interface-ipfs-core/blob/master/SPEC/FILES.md#add" rel="noopener ugc nofollow" target="_blank">https://github . com/ipfs/interface-ipfs-core/blob/master/SPEC/files . MD # add</a></li><li id="0a53" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#methods-mymethod-send" rel="noopener ugc nofollow" target="_blank">https://web 3js . readthedocs . io/en/1.0/web 3-eth-contract . html # methods-my method-send</a></li><li id="3221" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://web3js.readthedocs.io/en/1.0/web3-eth.html#gettransactionreceipt" rel="noopener ugc nofollow" target="_blank">https://web 3js . readthedocs . io/en/1.0/web 3-eth . html # gettransactionreceipt</a></li><li id="9b0f" class="lu lv iq jp b jq md ju me jy mf kc mg kg mh kk ml ma mb mc bi translated"><a class="ae kl" href="https://github.com/mcchan1/eth-ipfs" rel="noopener ugc nofollow" target="_blank">https://github.com/mcchan1/eth-ipfs </a></li></ul></div></div>    
</body>
</html>