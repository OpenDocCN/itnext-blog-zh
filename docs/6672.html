<html>
<head>
<title>How I turned my old MacBook Pro into a Home Server to run network-wide Ad Blocker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何把我的旧MacBook Pro变成一个家庭服务器来运行网络广告拦截器</h1>
<blockquote>原文：<a href="https://itnext.io/how-i-turned-my-old-macbook-pro-into-a-home-server-to-run-network-wide-ad-blocker-475120852402?source=collection_archive---------1-----------------------#2022-01-24">https://itnext.io/how-i-turned-my-old-macbook-pro-into-a-home-server-to-run-network-wide-ad-blocker-475120852402?source=collection_archive---------1-----------------------#2022-01-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/42899d9a2dfb04f2e0eac257fb7d9104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yOrT0zXsX3-vwX9KHc2row.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来自Pixabay</figcaption></figure><p id="a968" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你好，新年到了(我还能这么说吗？)有了新瘾，自主持。我关注Reddit上的自托管社区已经有一段时间了，我一直想拥有自己的服务器来玩，运行一些程序，破坏一些东西，也许还有一些自动化来让生活变得更好。</p><p id="7f86" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">今年年初，不知从哪里，我有了尝试的想法，毕竟，我是一名开发人员，对这类东西很感兴趣。</p><p id="1c8d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">好吧，我查了利息，硬件呢？来杯<a class="ae ld" href="https://www.raspberrypi.org/" rel="noopener ugc nofollow" target="_blank">树莓酱</a>怎么样？</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi le"><img src="../Images/4d2ee88ecc43fa105d989b27c22dc5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9g2ZIHNAObPUEE9AyQ9LmA.jpeg"/></div></div></figure><p id="5e2e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">是的，这个信用卡形状的东西实际上是一台能够运行多个应用程序的计算机，它是DIY项目/学习/小型服务器的强烈推荐硬件之一。</p><p id="962b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我很想买一个，最新的Raspberry Pi 4型号，四核1.5GHz CPU和2/4/8gb SDRAM。这对初学者或家庭服务器来说应该是很多的。</p><p id="3d1f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我差点就要买一台了，但后来我想起来我有一台非常旧的Macbook Pro(2011年初)，放在某个地方除了收集灰尘什么也不做，真有趣！💡。我们能把它变成家庭服务器吗？就这样，探索开始了…</p></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="b300" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">我有什么？</h1><p id="00f9" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">让我们看看这台mac有什么，</p><h2 id="9f02" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">五金器具</h2><p id="ea93" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">我的旧mac有一个</p><ul class=""><li id="30cb" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated">2.0GHz四核英特尔酷睿i7处理器，对于我的用例来说应该绰绰有余。</li><li id="31bb" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">它已经升级到16GB DDR3内存</li><li id="42de" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">我已经用250GB固态硬盘替换了默认硬盘作为启动卷</li></ul><p id="c86d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">此外，这台mac有一个光驱(记得吗？)现在已经没有用了。所以我已经移除了光驱，并在HDD Caddy(很便宜)的帮助下，用1TB的HDD (2.5英寸)取而代之。<br/>为了获得更多存储空间，我可以随时使用通过USB连接的外置硬盘。</p><p id="0edd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">总的来说，这台机器配备了一些硬件来处理一些负载。</p><h2 id="1b6d" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">软件</h2><p id="0fa2" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">对于操作系统来说，最好的做法是用一些Linux发行版来代替macOS，这对服务器来说是完美的(你不需要任何GUI)。但我保留了现有的macOS，因为这仍然是一个实验，我不确定我是否会长期使用这种设置(如果是这样，我会切换操作系统)，加上我使用另一台Mac来工作，所以连接和屏幕共享的兼容性是内置的。</p><p id="98cf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">目前它运行的是macOS High Sierra(这是该mac最后支持的操作系统)</p></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="6344" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">成为服务器</h1><p id="e29f" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">服务器应该一直运行，没有睡眠或中断，因为其他设备将依赖于它，很明显，Macbook pro不是为服务器而设计的(为什么会是！).当盖子合上时，Mac会让系统进入睡眠状态，或者根据配置在一段时间后进入睡眠状态，这显然对使用笔记本电脑很有好处，有助于节省能源。但是对于一个服务器，我们不希望任何优化，所以我们需要做一些调整⚙️.</p><h2 id="acfb" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">不要睡觉😴</h2><p id="463a" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">首先，我在节能设置中禁用了系统睡眠。<br/>在<code class="fe nt nu nv nw b">System Preferences &gt; Energy Saver</code>里，在两个<em class="nx">电池</em>电源适配器标签下</p><ul class=""><li id="9308" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated">将<code class="fe nt nu nv nw b">Computer Sleep</code>设置为从不</li><li id="ab7e" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">启用<code class="fe nt nu nv nw b">Wake for network access</code></li><li id="ccfc" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">启用<code class="fe nt nu nv nw b">Put hard disks to sleep when possible</code></li></ul><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/70fdb7622e1d7634d8e27db7afb70a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*h8x99JPAmNBI67jOymAfFg.png"/></div></figure><p id="ae81" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这还不够，当盖子合上时，mac仍然会自动进入睡眠状态。我已经尝试了几种建议的解决方案来防止它，其中一种是免费的，对我很有效的是安非他命。这个应用程序可以防止mac进入睡眠状态，并提供一些定制。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/9474ba435ccb799047993b55ea98e814.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*ySodKq5C5tdtXfjzLFpJGA.png"/></div></figure><p id="1f84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以创建一个无限期的会话，这意味着系统不会无限期地休眠，这正是我想要的。此外，我还让这个应用程序在系统启动时启动。因此，即使在意外重启后，系统也会继续运行。</p><p id="9d84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">另外，我已经关闭了蓝牙和其他不必要的服务和通知。有了这个和插上电源，这台mac应该可以永远运行。</p><h2 id="16be" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">网络</h2><p id="85db" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">mac还没有成为服务器，我需要从其他设备远程连接到这台机器(仅在同一个网络中)，目前我不打算向外界公开这台服务器。因此该服务器应该只能从同一个网络中访问。</p><p id="5076" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了更好的连接速度，我禁用了WiFi，并通过LAN电缆将这台mac连接到我的网络(是的，它有LAN端口，不需要适配器，多酷啊)。</p><p id="6bf3" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><em class="nx">我如何在网络中识别这台机器？</em> <br/>通过IP地址，每台机器一旦连接到网络，就会有一个由路由器(DHCP服务器)分配的内部IP地址。一个问题是，默认情况下，分配的IP地址不是静态的，这意味着它可以在发生一些事情后改变。</p><p id="5005" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我希望我的服务器的IP地址是静态的，这样所有设备都可以可靠地与服务器通信。我可以在<code class="fe nt nu nv nw b">TCP/IP</code>设置下的<code class="fe nt nu nv nw b">System Preferences &gt; Network &gt; Advanced</code>中这样做，</p><ul class=""><li id="775f" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated">将<code class="fe nt nu nv nw b">Configure IPv4</code>选项更改为<code class="fe nt nu nv nw b">Using DHCP with manual address</code></li><li id="8793" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">在<code class="fe nt nu nv nw b">IPv4 Address</code>下，我们可以为服务器设置所需的IP地址，或者继续使用已经分配的地址。</li></ul><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/d95ddeb53147606bc6d188756c0280ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*-9UxVSLiFjptCSzmVzQQyg.png"/></div></figure><p id="cf7a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">所以我的服务器现在有了一个静态IP地址<code class="fe nt nu nv nw b">192.168.1.10</code>(仅限内部)</p><h2 id="e312" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">共享</h2><p id="1393" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">另外，我需要启用一些选项来远程访问这台机器，它在<code class="fe nt nu nv nw b">System Preferences &gt; Sharing</code>下面，</p><ul class=""><li id="f23a" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated">我已经把我的电脑名字改成了<code class="fe nt nu nv nw b">Home Server</code>(为了容易识别)</li><li id="fc56" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">使能<code class="fe nt nu nv nw b">Screen Sharing</code>、<code class="fe nt nu nv nw b">File Sharing</code>和<code class="fe nt nu nv nw b">Remote Login</code></li></ul><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/92e39bbe218e0bd8babb575b21c832b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*gHEFBgAArmYQnjbagXF80w.png"/></div></figure><p id="289a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有了它，我可以通过SSH远程访问这台mac，通过屏幕共享应用程序(从另一台Mac)远程访问UI，并通过SMB连接访问文件。</p><p id="fdd4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们来测试一下，在我的另一台mac上，我已经可以在“网络”选项卡下看到我的服务器名✔️️，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/e8348f049804ace3de83286e61907fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*-Zf3sxuzP6HmaVNz1v5kFQ.png"/></div></figure><p id="a3c1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">当我单击HomeServer时，会出现一个登录屏幕提示，我可以在其中键入该计算机的用户名和密码(与我通常登录该计算机时使用的用户名和密码相同)</p><p id="70c9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">或者，您可以通过SSH登录，</p><pre class="lf lg lh li gt oc nw od oe aw of bi"><span id="fb75" class="mt lr it nw b gy og oh l oi oj">ssh {username}@{server-ip-address}</span><span id="a6a6" class="mt lr it nw b gy ok oh l oi oj">eg: <br/>ssh admin@192.168.1.10</span></pre><p id="2467" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，我的mac已经成为一台服务器，我可以远程使用和玩🎉🎉🎉</p><h2 id="1b22" class="mt lr it bd ls mu mv dn lw mw mx dp ma kq my mz me ku na nb mi ky nc nd mm ne bi translated">警告⚠️</h2><p id="d103" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">有一个问题我在这篇文章中没有提到，那就是一些人提出了关于使用笔记本电脑作为服务器的担忧，因为它的电池。原因是让笔记本电脑全天候连接充电器对电池有害。很少有人报告说他们的电池在几天后会膨胀(这可能是一个严重的危险)。</p><p id="74ce" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">如果你正在尝试这样做，小心这种担心。一个建议是从笔记本电脑上取下电池，通过电源适配器使用。但是我喜欢把电池作为备用电源，这样万一停电或者我不小心关掉了电源插座，服务器仍然可以运行一段时间。<br/> <strong class="kh iu">所以我已经实现了一个自动化解决方案来解决这个问题，我将创建一个单独的帖子(这是一个冗长的帖子)来详细说明。</strong></p></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="0d89" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">沙盒</h1><p id="0d63" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">还是，读书？你真棒！🔥</p><p id="5b7c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我有了自己的服务器，我可以开始在里面安装服务和程序，但在此之前，我想确保我不会弄乱系统文件或做一些导致系统损坏/故障的事情，我还想要一些东西，如果我不想要某个程序了，我可以很容易地清理它。</p><p id="28fe" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">对此我们有什么？向<a class="ae ld" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">码头工人</a>问好</p><blockquote class="ol om on"><p id="d3d8" class="kf kg nx kh b ki kj kk kl km kn ko kp oo kr ks kt op kv kw kx oq kz la lb lc im bi translated">Docker是一组平台即服务产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。容器是相互隔离的，捆绑了它们自己的软件、库和配置文件；他们可以通过明确定义的渠道相互交流</p></blockquote><p id="d6f1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用docker，我们可以安全地部署一个应用程序，并轻松地销毁它，而不会在我们的服务器中留下任何痕迹。</p><p id="7647" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在Mac上安装Docker最简单的方法是使用Docker桌面应用程序。我已经在mac服务器上安装了Docker Desktop。同样在设置中，启用了系统启动时启动docker。</p><p id="8764" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在<code class="fe nt nu nv nw b">Resources</code>下，我们可以为虚拟机配置CPU、内存和存储。此外，在<code class="fe nt nu nv nw b">File Sharing</code>部分，我们可以指定向虚拟机公开哪些文件夹，这样我们可以默认控制docker中运行的应用程序可以访问哪些文件。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi or"><img src="../Images/335bf13fff00a5bbdb6bbf44ca772b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvQ3QPyITkdyBGwAk7isSw.png"/></div></div></figure><p id="1b07" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦我应用了更改，docker将重启并开始运行。通过远程机器上的SSH，我可以通过执行任何docker命令来检查docker是否正在运行，例如:<code class="fe nt nu nv nw b">docker ps</code>(它列出了所有正在运行的容器)。</p><p id="2cdd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">让我们运行一个简单的Nginx服务器来测试是否一切正常。</p><pre class="lf lg lh li gt oc nw od oe aw of bi"><span id="1790" class="mt lr it nw b gy og oh l oi oj">docker run --rm --name my-nginx -p 80:80 -d nginx </span></pre><p id="298f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这个命令将使用最新的<em class="nx"> nginx </em> docker映像部署一个名为<em class="nx"> my-nginx </em>的docker容器，并在主机上的端口<code class="fe nt nu nv nw b">80</code>和其他几个端口上公开服务。</p><p id="d42b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在在另一台机器上，当我打开浏览器并输入</p><pre class="lf lg lh li gt oc nw od oe aw of bi"><span id="d3c0" class="mt lr it nw b gy og oh l oi oj"><a class="ae ld" rel="noopener ugc nofollow" target="_blank" href="/{server-ip}:80">http://{server-ip}:8</a>0</span></pre><p id="e280" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我可以看到Nginx的欢迎页面。</p></div><div class="ab cl lj lk hx ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="im in io ip iq"><h1 id="4659" class="lq lr it bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">网络广告拦截器</h1><p id="172b" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">现在我已经准备好了服务器和沙盒环境，等待一些工作。我应该先安装什么？🤔。自托管社区有一个令人敬畏的开源软件列表，我们可以自托管，并且被这个列表的规模所淹没。</p><p id="741b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你自己看看吧，</p><div class="os ot gp gr ou ov"><a href="https://github.com/awesome-selfhosted/awesome-selfhosted" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd iu gy z fp pa fr fs pb fu fw is bi translated">GitHub-awesome-self hosted/awesome-self hosted:自由软件网络服务和web…</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">可以在你自己的服务器上托管的自由软件网络服务和网络应用的列表</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">github.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj jz ov"/></div></div></a></div><p id="98c2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我想尝试的第一件事是一个网络范围的广告拦截器，以阻止恼人的广告，并保护我在网络中的设备免受恶意/恶意软件/钓鱼网站的攻击。</p><p id="f73b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">以下是两个最值得推荐的广告拦截开源软件，</p><ul class=""><li id="ea23" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated"><a class="ae ld" href="https://pi-hole.net/" rel="noopener ugc nofollow" target="_blank"> PiHole </a></li><li id="9ece" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated"><a class="ae ld" href="https://adguard.com/en/adguard-home/overview.html" rel="noopener ugc nofollow" target="_blank"> AdGuard主页</a></li></ul><p id="7766" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这两个我都试过，虽然我真的很喜欢PiHole，但我还是决定使用AdGuard Home，因为我喜欢干净的UI和易于配置。</p><p id="27e6" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我可以使用docker-compose轻松安装这个应用程序，YAML定义如下所示，</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="2e88" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">然后使用以下命令进行部署，</p><pre class="lf lg lh li gt oc nw od oe aw of bi"><span id="26f6" class="mt lr it nw b gy og oh l oi oj">docker-compose up -d</span></pre><p id="f874" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe nt nu nv nw b">-d</code>标志将在后台启动容器并让它们运行。我们可以使用<code class="fe nt nu nv nw b">docker ps</code>命令检查容器状态，这里是输出，</p><pre class="lf lg lh li gt oc nw od oe aw of bi"><span id="1dc7" class="mt lr it nw b gy og oh l oi oj">CONTAINER ID   IMAGE                        COMMAND                  CREATED         STATUS         PORTS                                                                                                                                                                                                                           NAMES<br/>5e80d27a243d   adguard/adguardhome:latest   "/opt/adguardhome/Ad…"   8 seconds ago   Up 7 seconds   67-68/udp.....0.0.0.0:82-&gt;80/tcp   adguardhome</span></pre><p id="d6de" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Adguard Home服务正在端口<code class="fe nt nu nv nw b">80</code>上运行，但是我们第一次需要通过端口<code class="fe nt nu nv nw b">3000</code>访问它来进行一些初始设置。</p><p id="900d" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在浏览器中，我导航到<code class="fe nt nu nv nw b">http://{server-ip}:3000</code>，可以看到Adguard主页欢迎屏幕。</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pm"><img src="../Images/bfcbdc210613f0ed397dd22e12e3b6e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-7HmB5ql78RUUAV1jYuLw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Adguard欢迎屏幕</figcaption></figure><p id="e0c1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在接下来的几个设置中，我需要配置Adguard主目录应该运行的端口，设置用户名和密码等。设置完成后，我可以通过<code class="fe nt nu nv nw b">http://{server-ip}:80</code>访问Adguard主页。</p><p id="b126" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，我将我的网络的DNS服务器改为使用Cloudflare DNS服务器<code class="fe nt nu nv nw b">1.1.1.2</code> &amp; <code class="fe nt nu nv nw b">1.0.0.2</code>(这些是流行的<code class="fe nt nu nv nw b"><a class="ae ld" href="https://one.one.one.one" rel="noopener ugc nofollow" target="_blank">1.1.1.1</a> </code> DNS的其他变体)，这也将阻止恶意软件网站。</p><p id="c871" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以在<code class="fe nt nu nv nw b">Settings -&gt; DNS Settings</code>下这样做，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/b1a2a20aa77b775416900d0dc350f6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zVACaQadsXmKcUZeKTddrg.png"/></div></div></figure><p id="8b2e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">第二，我们可以自定义阻止列表，默认情况下Adguard Home会有一个默认列表，但我们可以在<code class="fe nt nu nv nw b">Filters -&gt; DNS Blocklists</code>下更改或扩展它，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi po"><img src="../Images/6051002e856c186930f781ec8017032d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k0pUO-Kf2WchjfRH_UKtDQ.png"/></div></div></figure><p id="5531" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以在这个网站上找到几个这样的黑名单，https://firebog.net。至此，Adguard Home已经准备就绪。</p><p id="205f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，我需要再做一个设置，即指示我的网络中的各个设备将我的mac服务器用作DNS服务器。我可以用两种方式做到，</p><ul class=""><li id="3d76" class="nf ng it kh b ki kj km kn kq nh ku ni ky nj lc nk nl nm nn bi translated">通过更新我的路由器中的DNS服务器配置，以便所有设备将自动使用路由器中提到的IP地址</li><li id="5a7b" class="nf ng it kh b ki no km np kq nq ku nr ky ns lc nk nl nm nn bi translated">通过手动更新所有设备中的DNS配置。</li></ul><p id="3e7f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我做了第一个，这是强制我的网络中的所有设备使用我的Mac服务器IP作为DNS服务器的更简单的方法。</p><p id="bb45" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">确切的过程因路由器的类型而异，对于我的路由器，它是直接的，我的DNS配置如下所示，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pp"><img src="../Images/a9fc5762ca9baf61ceda2c6a90fc1d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*357rQyhA3F-u_zOVP8OaSg.png"/></div></div></figure><p id="a932" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><code class="fe nt nu nv nw b">192.168.1.10</code>是我的mac服务器IP地址，注意在<em class="nx"> DNS服务器2 </em>中我有提到过<code class="fe nt nu nv nw b">1.1.1.2</code>？这是因为如果我的mac服务器由于某种原因停止工作，那么整个互联网将无法为我的网络中的任何设备工作(是的，这是很多)，所以我已经配置了一个辅助DNS来防止这个问题。(还有其他解决方案，如运行辅助Adguard服务器)。这意味着一些流量将跳过Adguard服务器，但目前来看这没什么问题。</p><p id="4530" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">或者，您可以随时更新单个设备的DNS配置，例如对于Mac，我们可以这样做<code class="fe nt nu nv nw b">System Preferences -&gt; Network -&gt; Advanced -&gt; DNS</code></p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pq"><img src="../Images/c19662315a71a0196d194fd26b8e55a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fsuI8Tqc0E7SSW2ycV0Lw.png"/></div></div></figure><p id="c0f2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">就是这样。现在，Adguard Home将自动阻止我网络中的广告和恶意软件网站。我可以在Adguard主页的仪表板上看到一些很酷的统计数据，这是我的，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pr"><img src="../Images/2fc7f06c6e54dde537350d0855f0a8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0SWtJw9Q90eBKacADfU0A.png"/></div></div></figure><p id="2fad" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我现在20%的网络流量都被屏蔽了，那就很多了！🍾。以下是我最常阻止的域名，</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ps"><img src="../Images/cbb21ad2f59e2aa660ed5610e5e9c8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMjM5JSlWKlCudRd6zP5bA.png"/></div></div></figure><h1 id="448c" class="lq lr it bd ls lt pt lv lw lx pu lz ma mb pv md me mf pw mh mi mj px ml mm mn bi translated">结论</h1><p id="1d1c" class="pw-post-body-paragraph kf kg it kh b ki mo kk kl km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc im bi translated">运行我自己的服务器是一个有趣的实验，需要学习很多东西，当然也有很多责任和工作，但我喜欢目前为止的结果。这只是一个开始，我将探索更多的自我托管的可能性。未完待续…</p><figure class="lf lg lh li gt ju"><div class="bz fp l di"><div class="py pl l"/></div></figure></div></div>    
</body>
</html>