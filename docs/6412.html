<html>
<head>
<title>Getting started with Otomi just got a whole lot easier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用Otomi变得简单多了</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-otomi-just-got-a-whole-lot-easier-c36129109a3d?source=collection_archive---------4-----------------------#2021-11-09">https://itnext.io/getting-started-with-otomi-just-got-a-whole-lot-easier-c36129109a3d?source=collection_archive---------4-----------------------#2021-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="594f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/getting-started-with-otomi-a82d361330a2">上一篇文章</a>中，我演示了如何在AKS上安装Otomi。然而，仍然有一个依赖。你需要有一个DNS区域。DNS不仅用于名称解析，还用于使用LetsEncrypt生成证书。但是有了最新的版本，Otomi现在可以没有任何依赖地安装了。Otomi现在默认使用<a class="ae kl" href="http://nip.io/" rel="noopener ugc nofollow" target="_blank"> nip.io </a>结合自动生成的CA。</p><p id="7bcb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这完全兑现了Otomi的承诺:</p><p id="24cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="km">一个</em> <em class="km">开源的、与云无关的、基于Kubernetes的平台，具有类似桌面的用户界面。Otomi易于安装，并带有现成的预配置内置应用程序，以提供开箱即用的体验。就像你对你最喜欢的Linux发行版的期望一样。</em></p><p id="904b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个帖子里。我将解释如何在没有任何外部依赖的情况下安装Otomi。不依赖地运行Otomi只是为了实验/评估的目的，而不是为了运行面向客户的应用程序。对于所有其他用例，建议使用:</p><ul class=""><li id="0e2f" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">KMS用于加密Otomi值存储库中的敏感值</li><li id="3da7" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">使用公共DNS区域</li><li id="9023" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">自带CA或使用LetsEncrypt</li></ul><h1 id="d316" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">部署Kubernetes集群</h1><p id="4b75" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">同样，我们首先需要访问一个正在运行的Kubernetes集群。对于这个例子，我将(再次)在Azure中创建一个AKS集群，使用</p><ul class=""><li id="6927" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated">最新可用的Kubernetes版本(1.20.9)</li><li id="3a4c" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">3个Standard_D3_v2实例的节点池</li><li id="0f28" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">自动缩放(最小3，最大5)</li><li id="7363" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">蔚蓝CNI</li><li id="675b" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">RBAC已启用(必需)</li><li id="6160" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">Azure策略和Azure监视器已禁用</li></ul><p id="a5df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当群集启动并运行时，首先获取凭据:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="320b" class="mn lc iq mj b gy mo mp l mq mr">az login</span><span id="cced" class="mn lc iq mj b gy ms mp l mq mr">az aks get-credentials --resource-group &lt;resource-group&gt; --name &lt;cluster-name&gt; --admin</span></pre><h1 id="84d7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装Otomi</h1><p id="c8a9" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">现在使用舵图安装Otomi。首先，创建一个仅包含<strong class="jp ir">和</strong>以下值的<code class="fe mt mu mv mj b">values.yaml</code>文件:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3bab" class="mn lc iq mj b gy mo mp l mq mr">cluster:</span><span id="ab85" class="mn lc iq mj b gy ms mp l mq mr">owner: myself</span><span id="4c5d" class="mn lc iq mj b gy ms mp l mq mr">k8sVersion: '1.20'</span><span id="69c5" class="mn lc iq mj b gy ms mp l mq mr">name: my-cluster</span><span id="79cd" class="mn lc iq mj b gy ms mp l mq mr">provider: azure</span></pre><p id="fd11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，没有任何依赖性。只需填写所有者和集群名称。</p><p id="313a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">部署图表:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="33fb" class="mn lc iq mj b gy mo mp l mq mr">helm repo add otomi<a class="ae kl" href="https://otomi.io/otomi-core" rel="noopener ugc nofollow" target="_blank"> https://otomi.io/otomi-core</a></span><span id="0f1a" class="mn lc iq mj b gy ms mp l mq mr">helm repo update</span><span id="a8c6" class="mn lc iq mj b gy ms mp l mq mr">helm install -f values.yaml otomi otomi/otomi</span></pre><p id="2b88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装程序作业现在将在您的集群上安装Otomi。您可以通过查看安装程序作业的日志来跟踪安装程序的进度:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d03f" class="mn lc iq mj b gy mo mp l mq mr">kubectl logs jobs/otomi -n default -f</span></pre><p id="9041" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者使用<a class="ae kl" href="https://github.com/derailed/k9s" rel="noopener ugc nofollow" target="_blank"> K9s </a>:</p><figure class="me mf mg mh gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi mw"><img src="../Images/13b80b02a9a17f9c58121782621b4399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ziW2j6kC81PIFtfStyTcRA.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">Otomi安装程序的日志输出</figcaption></figure><p id="f346" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装程序完成后(可能需要20到30分钟)，从日志底部复制URL和生成的密码。</p><h1 id="9279" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装后步骤</h1><p id="f295" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">现在，您需要做的第一件事是在Keycloak中创建一个新用户，并将该用户添加到<code class="fe mt mu mv mj b">otomi-admin</code>组中。</p><p id="8cc5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到:https://keycloak。<your-ip> .nip.io，使用日志中提供的用户<code class="fe mt mu mv mj b">admin </code>和生成的密码登录。还建议更改自动生成的密码。查看<a class="ae kl" href="https://otomi.io/docs/installation/post-install/#create-a-user-in-keycloak" rel="noopener ugc nofollow" target="_blank">此处</a>了解如何在Keycloak中创建用户的完整说明。</your-ip></p><p id="af53" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您可以登录到Otomi控制台。去https://otomi。<your-ip> .nip.io，用新创建的用户登录。</your-ip></p><p id="30d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能已经注意到了，浏览器显示这个网站的连接不安全。因为我们没有在LetsEncrypt中使用DNS，也没有提供我们自己的CA，所以Otomi自动为您生成了一个CA。但是不用担心，您可以将生成的CA添加到您的钥匙串中。</p><p id="6052" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在控制台的左窗格中，点击<code class="fe mt mu mv mj b">Download CA</code></p><figure class="me mf mg mh gt mx gh gi paragraph-image"><div role="button" tabindex="0" class="my mz di na bf nb"><div class="gh gi ni"><img src="../Images/d6809e0be52c631271c3e560e8b97318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twFgiISzxENTtgPdWPGBLA.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk translated">下载CA</figcaption></figure><p id="5857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后将CA添加到您的钥匙串:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1a3a" class="mn lc iq mj b gy mo mp l mq mr">sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/Downloads/ca.crt</span></pre><p id="3ef8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要开始使用Otomi部署容器工作负载，首先需要激活Drone。</p><p id="9b1e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要启用Drone，请打开Drone应用程序(使用Otomi控制台中的快捷方式)，并使用新创建的用户通过OpenID Connect登录。</p><p id="4e71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Drone中，你会看到Otomi创建的<code class="fe mt mu mv mj b">otomi/values</code>库。现在点击<code class="fe mt mu mv mj b">Activate</code>，然后点击<code class="fe mt mu mv mj b">Activate Repository</code>，再点击<code class="fe mt mu mv mj b">Save</code>。现在你可以使用Otomi了。</p><p id="48cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<a class="ae kl" href="https://otomi.io/" rel="noopener ugc nofollow" target="_blank"> otomi.io </a>上可以找到完整的<a class="ae kl" href="https://otomi.io/docs/installation/post-install/" rel="noopener ugc nofollow" target="_blank">安装后步骤</a>。</p><h1 id="4069" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">教程</h1><p id="605b" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">要开始探索Otomi，请查看<a class="ae kl" href="https://otomi.io/" rel="noopener ugc nofollow" target="_blank"> https://otomi.i </a> o上的教程，并使用它们来学习如何:</p><ul class=""><li id="d066" class="kn ko iq jp b jq jr ju jv jy kp kc kq kg kr kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/create-keycloak-users" rel="noopener ugc nofollow" target="_blank">使用Keycloak作为IdP时创建和管理用户</a></li><li id="e1c9" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/build-tag-push" rel="noopener ugc nofollow" target="_blank">构建、标记和推送一个图像到港口</a></li><li id="f925" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated">创建一个Kubernetes服务</li><li id="9fb6" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/expose-service" rel="noopener ugc nofollow" target="_blank">使用Otomi控制台公开现有的Kubernetes服务</a></li><li id="97af" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/create-knative-svc" rel="noopener ugc nofollow" target="_blank">创建一个有价值的服务</a></li><li id="35f7" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/expose-ksvc" rel="noopener ugc nofollow" target="_blank">使用Otomi控制台</a>公开现有的Knative服务</li><li id="dba2" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/create-secret-vault" rel="noopener ugc nofollow" target="_blank">在Hashicorp金库中创建一个秘密</a></li><li id="c0e6" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/add-secret" rel="noopener ugc nofollow" target="_blank">给Kubernetes添加一个在金库中创建的秘密</a></li><li id="aaf5" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/use-secret" rel="noopener ugc nofollow" target="_blank">在Kubernetes </a>中使用秘密</li><li id="052e" class="kn ko iq jp b jq kw ju kx jy ky kc kz kg la kk ks kt ku kv bi translated"><a class="ae kl" href="https://otomi.io/docs/tutorials/create-ksvc-otomi" rel="noopener ugc nofollow" target="_blank">使用Otomi控制台创建Knative服务</a></li></ul><p id="72bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多教程将很快推出。</p><h1 id="d8c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Otomi快速入门</h1><p id="d0a4" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">为了更容易开始使用Otomi，<a class="ae kl" href="https://github.com/redkubes/quickstart" rel="noopener ugc nofollow" target="_blank"> quickstart repository </a>现在提供了一种使用Terraform在您选择的云中创建Kubernetes集群的简单方法。目前，Azure和Google云平台有一个快速入门。AWS快速入门将很快推出。</p><h1 id="f82b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结束语</h1><p id="698d" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">Otomi提供了Kubernetes顶级的全平台体验。它集成并预配置了一整套开源项目，如Harbor、Knative、Istio、Prometheus、Keycloak、Gatekeeper等等。通过在Kubernetes上安装Otomi，您可以使用所有这些开箱即用的默认项目。因此，你不需要自己安装、配置和集成所有这些项目，你只需要安装Otomi。</p><p id="d9a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Otomi非常适合用作内部(基于Kubernetes)开发人员平台。默认情况下，Otomi以许可模式运行，这意味着所有违反安全策略的行为都将被记录。团队可以直接访问所有安全日志并改善安全状况。这提供了一种边学边做的体验。</p><p id="c488" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在没有依赖的情况下运行Otomi，现在开始使用Otomi并探索它的所有特性变得非常容易。</p><p id="d148" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要再等了，试试吧！如果您遇到任何问题，请在这里报告它们<a class="ae kl" href="https://github.com/redkubes/otomi-core/issues" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>