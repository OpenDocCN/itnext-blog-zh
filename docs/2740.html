<html>
<head>
<title>AWS Cognito example using React UI and Node.js REST APIs — part 1 (Cognito setup)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React UI和Node.js REST APIs的AWS Cognito示例—第1部分(Cognito设置)</h1>
<blockquote>原文：<a href="https://itnext.io/aws-cognito-example-using-react-ui-and-node-js-rest-apis-part-1-cognito-setup-5597acb02db4?source=collection_archive---------1-----------------------#2019-07-25">https://itnext.io/aws-cognito-example-using-react-ui-and-node-js-rest-apis-part-1-cognito-setup-5597acb02db4?source=collection_archive---------1-----------------------#2019-07-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="9853" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi ko translated"><span class="l kp kq kr bm ks kt ku kv kw di">在</span>这组帖子中，我将讲述如何使用<a class="ae kx" href="https://aws.amazon.com/cognito/" rel="noopener ugc nofollow" target="_blank"> AWS Cognito </a>服务为一个简单的应用程序堆栈提供用户管理，该堆栈由一个由Node.js实例提供的React UI和一个后端REST API组成，也是使用Node.js实现的，但在单独的实例中。</p><p id="4b92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们的示例应用程序中，AWS Cognito服务将用于提供以下功能:</p><ul class=""><li id="a88d" class="ky kz it js b jt ju jx jy kb la kf lb kj lc kn ld le lf lg bi translated">用户登录和注册的UI内容(我们将自定义)</li><li id="a6dd" class="ky kz it js b jt lh jx li kb lj kf lk kj ll kn ld le lf lg bi translated">用于用户认证和令牌生成的后端OAuth实现</li><li id="ca7f" class="ky kz it js b jt lh jx li kb lj kf lk kj ll kn ld le lf lg bi translated">维护用户注册表，包括安全存储个人资料信息，如姓名和电子邮件地址</li></ul><h1 id="62de" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建用户池</h1><p id="0c83" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">首先，我们创建了一个<em class="mp">用户池</em>。用户池是AWS Cognito用来保存和管理应用程序使用的所有用户身份的容器。找到AWS Cognito服务，创建一个新的用户池并为其命名。我们还需要为用户池创建一个<em class="mp">应用程序客户端</em>，这样我们的UI应用程序就可以与用户池进行交互。由于UI应用程序的前端将使用基于JavaScript的UI (React ),我们还需要取消选中生成客户端密码选项，因为JavaScript客户端不支持该选项。</p><p id="cd94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">查看用户池设置，应类似于以下内容:</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mq"><img src="../Images/06866a3426f2100e3278401bf4cd72f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWk_YKkvggYqAFGDhaNwhw.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">查看用户池配置</figcaption></figure><p id="5f59" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AWS Cognito提供内置的UI页面来处理用户登录、注册等。这些可以定制，或者你可以推出自己的。</p><h1 id="d503" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">配置应用程序集成</h1><p id="cdbc" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在我们已经创建了一个用户池，我们需要为它配置应用程序集成。这将允许我们使用该用户池控制应用程序的各个方面，例如用于身份验证的域名、身份验证发生后使用的URL回调，以及对初始登录/注册UI的定制。</p><p id="11cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个示例应用程序，我将使用域<em class="mp">cognito-demo.arronharden.com</em>作为示例UI应用程序，使用域<em class="mp">auth-cognito-demo.arronharden.com</em>作为AWS Cognito端点。</p><h2 id="1b86" class="ng ln it bd lo nh ni dn ls nj nk dp lw kb nl nm ma kf nn no me kj np nq mi nr bi translated">域名</h2><p id="4554" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">默认情况下，AWS Cognito将使用在<em class="mp">amazoncognito.com</em>根目录下生成的子域。为了避免向您的最终用户公开这个域，您需要将其更改为使用您自己的应用程序的域名。为此，您需要能够做到以下几点:</p><ul class=""><li id="1cb5" class="ky kz it js b jt ju jx jy kb la kf lb kj lc kn ld le lf lg bi translated">在AWS证书管理器中为域创建或导入SSL证书。参见我的另一篇文章<a class="ae kx" href="https://medium.com/@arron.harden/using-letsencrypt-ssl-certificates-in-aws-certificate-manager-c2bc3c6ae10" rel="noopener"> <em class="mp">在AWS证书管理器</em> </a> <em class="mp"> </em>中使用LetsEncrypt SSL证书，了解我如何为我的域创建和导入LetsEncrypt通配符证书。</li><li id="fddb" class="ky kz it js b jt lh jx li kb lj kf lk kj ll kn ld le lf lg bi translated">能够为您的域创建一个DNS CNAME记录，以指向与您的用户池相关联的AWS Cognito目标。</li></ul><p id="1a37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我已经将这个用户池配置为使用域名<em class="mp">auth-cognito-demo.arronharden.com</em>，并为它创建了一个指向<em class="mp">d47h50fumb0wo.cloudfront.net的DNS CNAME记录。</em></p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ns"><img src="../Images/a9473984fafae7570728ca8bfae26482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dk765MMlTf-04oaYkCa-9Q.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">指定用户池应用程序集成的域</figcaption></figure><h2 id="bc83" class="ng ln it bd lo nh ni dn ls nj nk dp lw kb nl nm ma kf nn no me kj np nq mi nr bi translated">资源服务器</h2><p id="0508" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">因为我们要创建一个简单的后端REST API服务，所以我们需要为应用程序集成创建一个资源服务器。我们设置标识符来匹配后端REST API域的URL，<a class="ae kx" href="https://cognito-demo-api.arronharden.com" rel="noopener ugc nofollow" target="_blank"><em class="mp"/></a><em class="mp">，</em>，并定义一个名为<em class="mp"> hello-world.all </em>的自定义范围，UI认证流可以将该范围授予用户。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nt"><img src="../Images/dbccc11d71cae63283b34d92e2cb0b27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_BVblvWEP4aVutBh_s2sA.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">指定后端REST API资源服务器</figcaption></figure><h2 id="3846" class="ng ln it bd lo nh ni dn ls nj nk dp lw kb nl nm ma kf nn no me kj np nq mi nr bi translated">应用程序客户端设置</h2><p id="9fd1" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">现在我们已经配置了域和资源服务，我们可以继续并配置在首次创建用户池时定义的应用程序客户端。我们设置回调和注销URL来匹配我们的UI应用程序URL，<a class="ae kx" href="https://cognito-demo.arronharden.com" rel="noopener ugc nofollow" target="_blank">https://cognito-demo.arronharden.com</a>，注意对于回调，我们有额外的路径<em class="mp"> /callback </em>，这样UI应用程序可以处理成功的登录。对于OAuth流，我们选择<em class="mp">授权码授予</em>和<em class="mp">隐式授予</em>。作为我们的资源服务器的一部分创建的自定义作用域<em class="mp"> hello-world.all </em>也是可用的，我们也想选择它。</p><p id="b63b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于本地开发，添加一个localhost回调URL是很有用的，例如，<a class="ae kx" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>，这样您仍然可以使用通常的auth流，但是它将启动到您本地运行的UI应用程序，而不是真正的UI应用程序。但是，请记住不要在生产中使用本地主机回调。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nu"><img src="../Images/edbb31cb65f89d7b115c61af04313ec5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Q5B9qNYlfq7vVPZdiJVfQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">指定应用程序客户端设置</figcaption></figure><h1 id="1ac0" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">测试注册/登录用户界面</h1><p id="f258" class="pw-post-body-paragraph jq jr it js b jt mk jv jw jx ml jz ka kb mm kd ke kf mn kh ki kj mo kl km kn im bi translated">既然已经配置了应用程序集成，我们就可以继续测试身份验证UI流了。该示例的登录URL使用我们配置的域，对于查询参数，具有应用客户端ID(显示在应用客户端设置中)以及我们定义的回调URL。这个例子的完整网址是<a class="ae kx" href="https://auth-cognito-demo.arronharden.com/login?response_type=code&amp;client_id=4tnp4k64d5v4ah9dud3pj1kbs0&amp;redirect_uri=https://cognito-demo.arronharden.com/callback" rel="noopener ugc nofollow" target="_blank">https://auth-cognito-demo.arronharden.com/login?response _ type = code&amp;client _ id = 4 TNP 4k 64 D5 v4 ah 9 dud 3 pj 1 kbs 0&amp;redirect _ uri = https://cogn ITO-demo . arron harden . com/callback</a>。</p><p id="d635" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">继续尝试这个URL会显示默认的AWS Cognito身份验证UI。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nv"><img src="../Images/80fde7ad710ac671470499d305c744cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmbNE8DHwdPtB81pBSdnzw.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">默认AWS认知身份验证用户界面</figcaption></figure><p id="043c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于这是一个新用户池，我可以继续进行注册流程，这将创建一个新用户，并在允许用户进入系统之前发送一封带有验证码的电子邮件。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nw"><img src="../Images/afbf6641a8cf3136a54a5c35eab9e3eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kojvIPkXn-YyOJGri8LAAQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">创建新用户</figcaption></figure><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nx"><img src="../Images/dd1c18f51ef9117cd5814664c44cbe2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shWzxonHdhKGeZUkGSSGbQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">输入电子邮件中的验证码</figcaption></figure><p id="1bff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于还没有创建UI应用程序，最终重定向到我的应用程序集成回调URL https://cognito-demo.arronharden.com/callback<a class="ae kx" href="https://cognito-demo.arronharden.com/callback" rel="noopener ugc nofollow" target="_blank"/>进入了死胡同，但这在现阶段是意料之中的。</p><p id="66c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为最后的验证，我现在还可以看到用户<em class="mp"> arron </em>已经在用户池中创建了。</p><figure class="mr ms mt mu gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi ny"><img src="../Images/fa1bdf2a6395d2279c06afb7bb5f3514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Ch82XkCqV2tWyxP6Xm8Yw.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">用户已在用户池中创建</figcaption></figure><p id="29b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">到目前为止，我们还没有编写任何代码，但我们已经有了一个强大而安全的用户管理服务和用户界面，可供我们的用户界面和后端API服务使用。在下一部分中，我将探索与UI应用程序的集成，展示如何通过认证流程以及如何定制登录/注册流程。</p></div></div>    
</body>
</html>