<html>
<head>
<title>Using Rendertron in Kubernetes for SPA SEO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes中使用Rendertron进行SPA SEO</h1>
<blockquote>原文：<a href="https://itnext.io/using-rendertron-in-kubernetes-for-spa-seo-39055567c745?source=collection_archive---------4-----------------------#2018-08-24">https://itnext.io/using-rendertron-in-kubernetes-for-spa-seo-39055567c745?source=collection_archive---------4-----------------------#2018-08-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a792" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在Kubernetes演示中使用的一个应用程序是<a class="ae kl" href="http://inkl.in" rel="noopener ugc nofollow" target="_blank"> http://inkl.in </a> —这是一个以太坊区块链可视化工具，它使用前端(React)，与API(节点)对话，与位于Azure私有VNET内的虚拟机上的MongoDB对话。你可以在https://github.com/justindavies/inklin的GitHub <a class="ae kl" href="https://github.com/justindavies/inklin" rel="noopener ugc nofollow" target="_blank">上找到代码，但是今天我想使用Rendertron来解决基于组件的Javascript应用的搜索引擎优化的固有问题。</a></p><p id="d053" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">SPA(单页应用程序)的问题是网络爬虫不太擅长Javascript，尤其不擅长插入Javascript以获得合适的内容用于索引。</p><p id="d7d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有许多“修复”，最突出的是服务器端渲染(SSR)。我在那里找到了大量的文档，但我只是一个懒惰的人，想要简单一点的东西(加上我在webpack上的技能水平是不存在的)。</p><p id="5df2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">随着像Puppeteer(无头Chrome)这样的东西的出现，我开始用它来代理对我的应用程序的请求，然后将其转换成搜索引擎的HTML，以及像脸书和Twitter分享Inkl.in这样的东西</p><p id="041c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这方面工作了一段时间后，我发现了Rendertron，这是这类事情的惯常做法。看看Sam Li是怎么说的吧，这是解决问题的好方法。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="kr ks l"/></div></figure><p id="a5a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Rendertron本质上是一个请求代理，你不希望客户端执行Javascript在这种情况下，机器人和社交分享刮刀。为此，我们需要查看用户代理，看看是否需要将我们的请求路由到Rendertron进行预渲染，或者只是将请求直接传递给React应用程序。</p></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="4497" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我大部分时间都在Kubernetes，而且我为微软工作，所以在Google上托管这个对我来说有点麻烦，我想让这个在Kube上工作。</p><p id="468a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Rendertron不再附带docker文件，所以让我们继续创建一个</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="la ks l"/></div></figure><p id="9bd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们还需要把它放到Kubernetes上，所以让我们得到一个部署定义</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="la ks l"/></div></figure><p id="f05b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">和服务定义(我喜欢将它们分开)</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="la ks l"/></div></figure></div><div class="ab cl kt ku hu kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ij ik il im in"><p id="5530" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们的集群上已经有了Rendertron，我们需要编辑React应用程序的NGINX配置。只是为了说明我是如何做的，这是构建我的React应用程序的docker文件</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="la ks l"/></div></figure><p id="d66b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要用Rendertron goodness替换默认配置。我们需要做的是感知UA，然后仅当它是Rendertron的Bot或Scraper时才进行代理</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="la ks l"/></div></figure><p id="f5e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基于非Kube部署的Gists，有几件事让我抓狂。我必须将解析器设置为kube-dns实例，因为我对proxy_pass指令使用了一个变量(thankyou StackOverflow！)，并确保我在服务中使用了FQDN，而不是简称。</p><p id="eb23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在此之后，我可以看到，通过将我在Chrome中的UA更改为GoogleBot，来自GoogleBot的请求被正确路由！</p></div></div>    
</body>
</html>