<html>
<head>
<title>PHP microservice framework — Swoft</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PHP微服务框架— Swoft</h1>
<blockquote>原文：<a href="https://itnext.io/what-is-swoft-a428334dd35b?source=collection_archive---------4-----------------------#2019-08-15">https://itnext.io/what-is-swoft-a428334dd35b?source=collection_archive---------4-----------------------#2019-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/53dff9c78f5c202931505f8bf059e8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uvrfdv-qpJ1iTRROa8hEAg.jpeg"/></div></div></figure><p id="4c5d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Swoft是一个PHP高性能微服务协程框架。已经出版多年，已经成为php的不二之选。它可以像Go一样，内置协同web服务器和通用协同客户端，驻留在内存中，独立于传统的PHP-FPM。还有类似的Go语言操作，类似于Spring Cloud框架的灵活注解。</p><h1 id="b8c7" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">开源代码库</h1><p id="223f" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated"><a class="ae lz" href="https://github.com/swoft-cloud/swoft" rel="noopener ugc nofollow" target="_blank">T3【https://github.com/swoft-cloud/swoft】T5</a></p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="07c6" class="kw kx iq bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">特征</h1><h1 id="c3f7" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">完整协程框架</h1><p id="7e64" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft是第一个驻留在内存注释框架中的PHP，具有比配置设计概念更大的Spring Boot约定，以及一组开发规范。</p><h1 id="ae8d" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">面向切面编程</h1><p id="d445" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">AOP是一种面向对象的编程，它使得分离业务代码、提高代码质量和增加代码可重用性变得更加容易。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="7111" class="mv kx iq mr b gy mw mx l my mz">/**<br/> * @Aspect(order=1)<br/> * @PointBean(include={"App\Http\Controller\TestExecTimeController"})<br/> */<br/>class CalcExecTimeAspect<br/>{<br/>    protected $start;</span><span id="8e29" class="mv kx iq mr b gy na mx l my mz">    /**<br/>     * @Before()<br/>     */<br/>    public function before()<br/>    {<br/>        $this-&gt;start = microtime(true);<br/>    }</span><span id="736f" class="mv kx iq mr b gy na mx l my mz">    /**<br/>     * @After()<br/>     */<br/>    public function after(JoinPoint $joinPoint)<br/>    {<br/>        $method = $joinPoint-&gt;getMethod();<br/>        $after = microtime(true);<br/>        $runtime = ($after - $this-&gt;start) * 1000;</span><span id="c21e" class="mv kx iq mr b gy na mx l my mz">        echo "{$method} cost: {$runtime}ms\n";<br/>    }<br/>}</span></pre><h1 id="9c76" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Http服务</h1><p id="25c7" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Http服务简单灵活，只需使用<code class="fe nb nc nd mr b">@Controller()</code>和<code class="fe nb nc nd mr b">@RequestMapping(route="index")</code>注释来定义服务。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="0c52" class="mv kx iq mr b gy mw mx l my mz">/**<br/> * @Controller()<br/> */<br/>class IndexController<br/>{<br/>    /**<br/>     * @RequestMapping(route="index")<br/>     */<br/>    public function index(): string<br/>    {<br/>        return "test";<br/>    }<br/>}</span></pre><h1 id="5ec5" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">Websocket服务</h1><p id="ebb3" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft为开发者提供了一个完整的Websocket来快速构建服务</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="cef8" class="mv kx iq mr b gy mw mx l my mz">/**<br/> * @WsModule(<br/> *     "/chat",<br/> *     messageParser=TokenTextParser::class,<br/> *     controllers={HomeController::class}<br/> * )<br/> */<br/>class ChatModule<br/>{<br/>    /**<br/>     * @OnOpen()<br/>     * @param Request $request<br/>     * @param int     $fd<br/>     */<br/>    public function onOpen(Request $request, int $fd): void<br/>    {<br/>        server()-&gt;push($request-&gt;getFd(), "Opened, welcome!(FD: $fd)");<br/>    }<br/>}</span></pre><h1 id="29e1" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">RPC服务</h1><p id="de94" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft RPC可以像Dubbo一样调用原生函数。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="fea0" class="mv kx iq mr b gy mw mx l my mz">/**<br/> * @Controller()<br/> */<br/>class RpcController<br/>{<br/>    /**<br/>     * @Reference(pool="user.pool", version="1.0")<br/>     *<br/>     * @var UserInterface<br/>     */<br/>    private $userService;</span><span id="04cd" class="mv kx iq mr b gy na mx l my mz">    /**<br/>     * @RequestMapping("getList")<br/>     *<br/>     * @return array<br/>     */<br/>    public function getList(): array<br/>    {<br/>        $result  = $this-&gt;userService-&gt;getList(12, 'type');<br/>        return [$result];<br/>    }<br/>}</span></pre><h1 id="96e6" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">TCP服务</h1><p id="fc1d" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft还提供功能丰富的TCP服务支持。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="7413" class="mv kx iq mr b gy mw mx l my mz">&lt;?php declare(strict_types=1);</span><span id="4907" class="mv kx iq mr b gy na mx l my mz">namespace App\Tcp\Controller;</span><span id="01e8" class="mv kx iq mr b gy na mx l my mz">use Swoft\Tcp\Server\Annotation\Mapping\TcpController;<br/>use Swoft\Tcp\Server\Annotation\Mapping\TcpMapping;<br/>use Swoft\Tcp\Server\Request;<br/>use Swoft\Tcp\Server\Response;</span><span id="a51f" class="mv kx iq mr b gy na mx l my mz">/**<br/> * Class DemoController<br/> *<br/> * @TcpController()<br/> */<br/>class DemoController<br/>{<br/>    /**<br/>     * @TcpMapping("echo", root=true)<br/>     * @param Request  $request<br/>     * @param Response $response<br/>     */<br/>    public function echo(Request $request, Response $response): void<br/>    {<br/>        // $str = $request-&gt;getRawData();<br/>        $str = $request-&gt;getPackage()-&gt;getDataString();</span><span id="018a" class="mv kx iq mr b gy na mx l my mz">        $response-&gt;setData('[echo]hi, we received your message: ' . $str);<br/>    }<br/>}</span></pre><h1 id="b43a" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">连接池</h1><p id="64a3" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft定义高性能连接池很简单，如下所示:</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="5542" class="mv kx iq mr b gy mw mx l my mz">return [<br/>    'xxx.pool' =&gt; [<br/>        'class'       =&gt; \Swoft\xxx\Pool::class,<br/>        'minActive'   =&gt; 10,<br/>        'maxActive'   =&gt; 20,<br/>        'maxWait'     =&gt; 0,<br/>        'maxWaitTime' =&gt; 0,<br/>        'maxIdleTime' =&gt; 60,<br/>    ]<br/>];</span></pre><h1 id="7103" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">与Laravel ORM兼容</h1><p id="8b33" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft数据库与Laravel ORM高度兼容，PHP开发人员可以很容易地在Swoft中使用。</p><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="1e81" class="mv kx iq mr b gy mw mx l my mz">// Model<br/>$user = User::new();<br/>$user-&gt;setName('name');<br/>$user-&gt;setSex(1);<br/>$user-&gt;setDesc('this my desc');<br/>$user-&gt;setAge(mt_rand(1, 100));<br/>$user-&gt;save();<br/>$id = $user-&gt;getId();</span><span id="5e22" class="mv kx iq mr b gy na mx l my mz">// Query<br/>$users = DB::table('user')-&gt;get();<br/>foreach ($users as $user) {<br/>    echo $user-&gt;name;<br/>}</span><span id="3077" class="mv kx iq mr b gy na mx l my mz">// Transaction<br/>DB::beginTransaction();<br/>$user = User::find($id);<br/>$user-&gt;update(['name' =&gt; $id]);</span><span id="2937" class="mv kx iq mr b gy na mx l my mz">DB::beginTransaction();<br/>User::find($id)-&gt;update(['name'=&gt;'sakuraovq']);<br/>DB::rollBack();</span><span id="6e2b" class="mv kx iq mr b gy na mx l my mz">DB::commit();</span></pre><h1 id="32ce" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">微服务</h1><p id="cb4e" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">Swoft提供了一套快速构建的微服务治理组件，便于开发者使用。</p><ul class=""><li id="ef8c" class="ne nf iq ka b kb kc kf kg kj ng kn nh kr ni kv nj nk nl nm bi translated">服务注册和发现</li><li id="4377" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated">服务经纪人</li><li id="ca1a" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated">集中式配置</li><li id="ab35" class="ne nf iq ka b kb nn kf no kj np kn nq kr nr kv nj nk nl nm bi translated">服务节流能力</li></ul><pre class="mm mn mo mp gt mq mr ms mt aw mu bi"><span id="2ffc" class="mv kx iq mr b gy mw mx l my mz">/**<br/> * @Bean()<br/> */<br/>class Test<br/>{<br/>    /**<br/>     * @Breaker(fallback="funcFallback")<br/>     *<br/>     * @return string<br/>     * @throws Exception<br/>     */<br/>    public function func(): string<br/>    {<br/>        // Do something</span><span id="3744" class="mv kx iq mr b gy na mx l my mz">        throw new Exception('Breaker exception');<br/>    }</span><span id="7b79" class="mv kx iq mr b gy na mx l my mz">    /**<br/>     * @RequestMapping()<br/>     * @RateLimiter(key="request.getUriPath()")<br/>     *<br/>     * @param Request $request<br/>     *<br/>     * @return array<br/>     */<br/>    public function requestLimiter(Request $request): array<br/>    {<br/>        $uri = $request-&gt;getUriPath();<br/>        return ['requestLimiter', $uri];<br/>    }<br/>}</span></pre><h1 id="0008" class="kw kx iq bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">开源代码库</h1><p id="18ba" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated"><a class="ae lz" href="https://github.com/swoft-cloud/swoft" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">https://github.com/swoft-cloud/swoft</strong></a></p></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><h1 id="bd0f" class="kw kx iq bd ky kz mh lb lc ld mi lf lg lh mj lj lk ll mk ln lo lp ml lr ls lt bi translated">基准</h1><figure class="mm mn mo mp gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/54011bedda4d88ac1290383871de9ff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMjQmvqyjnuKS-gZkMPOCw.png"/></div></div></figure></div><div class="ab cl ma mb hu mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ij ik il im in"><div class="mm mn mo mp gt nt"><a href="https://github.com/swoft-cloud/swoft" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">软件云/软件</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">PHP微服务协程框架Swoft是一个基于Swoole扩展的PHP微服务协程框架…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh jw nt"/></div></div></a></div></div></div>    
</body>
</html>