<html>
<head>
<title>Istio Service Mesh Observability with Kiali</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Kiali的Istio服务网格可观测性</h1>
<blockquote>原文：<a href="https://itnext.io/istio-service-mesh-observability-with-kiali-c2ded8a413c4?source=collection_archive---------5-----------------------#2019-07-29">https://itnext.io/istio-service-mesh-observability-with-kiali-c2ded8a413c4?source=collection_archive---------5-----------------------#2019-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/40d370b0cdc5cf78fa4d963e456822f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csv4G4Qcz1Ree0MmN69yhw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用Kiali可视化Istio服务网格模式</figcaption></figure><p id="d5b2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kiali 是一个开源项目，它与<a class="ae la" href="https://istio.io/" rel="noopener ugc nofollow" target="_blank"> Istio </a>合作来可视化服务网状拓扑。Kiali包括在粒度级别映射流量、虚拟服务、断路器、延迟和请求率的功能。它提供了对Istio服务网格中微服务的行为/模式/动作的洞察。Kiali还包括Jaeger Tracing以提供分布式跟踪，从而提供一个统一的界面来监控和管理服务通信。</p><p id="5035" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Istio在部署的一些棘手方面提供了一定程度的间接性。Istio as a service mesh提供了保护服务间通信的模式，如使用电路制动、重试、超时等的容错。，其中路由决策是在网格级完成的，这消除了在平台级执行所有这些操作的用户。</p><p id="55bb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在一个非常高的层面上，Istio为用户提供了一个服务级网络依赖注入的机会，而Kiali提供了一个强大的web框架来可视化复杂的服务网状架构，通过功能指标来轻松收集有关策略、延迟、响应时间、服务和接收的请求的信息，从而更容易制定具体的规则集。</p><h1 id="02a2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">布局</h1><p id="773f" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">Kiali可以很容易地<a class="ae la" href="https://www.kiali.io/gettingstarted/" rel="noopener ugc nofollow" target="_blank">部署到Kubernetes上</a>,所有组件都应该部署在istio-system名称空间中，其中安装了istio控制平面组件。Kiali会自动发现集群上按照名称空间隔离的所有工作负载、服务和Istio规则。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/c93ceeb4d6471124c882dfd9127ff7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bQOX6fkL6Vy16X4T"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kubernetes上的Kiali部署</figcaption></figure><h1 id="36c6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Hello-World示例</h1><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/eb9bf453537559c9c8dbaaa9f53d6090.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/0*eyB3YYiyucbdtKwD"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带有Istio边车的Helloworld应用程序示例</figcaption></figure><p id="40ea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在新的Istio和Kubernetes中，istio-proxy容器被自动注入到pods中，其中名称空间被标记为“istio-injection=enabled ”,消除了显式kubectl inject的使用。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/231e1fdbc33384d2c04b174eecfcbfbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6O9iQgy3IZbuSogN"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Helloworld应用程序示例</figcaption></figure><p id="10bc" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上述示例有两个helloworld部署V1和V2，分别带有一个服务、一个istio-gateway(在接收传入或传出的网格边缘运行的负载平衡器)和一个虚拟服务(当主机被寻址时应用的一组流量路由规则)。Kiali发现了上面创建的对象和Istio对象:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/7be6fe394b108cd2ac0d3d252268a44e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H1Twc3JyMPXc6fX1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali — Helloworld应用程序有两个版本:v1和v2</figcaption></figure><p id="21f9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用户可以选择图形布局，如下所示。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/bc01fecfd6b9c0292d283990901f838d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8wblFmhGaAaTRYwa"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —选择图表布局</figcaption></figure><p id="264e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">工作负载和服务选项卡显示相应的服务-&gt;工作负载。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/b4a0c437219dc5d36bd0332429b81277.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_Q2i-Ik0uB9FQbk1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —服务和工作负载视图</figcaption></figure><p id="b93d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Istio配置选项卡显示相应服务的规则/策略配置。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/053b3bffb332414b782e1571b7ca3b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y2SK9pesm2U2EcM9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化规则配置</figcaption></figure><p id="2cc7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">“分布式跟踪”选项卡打开Jaeger UI。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/a9d798431a2e89429a01841574e14606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kxmId7mwnIcSiHgD"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —内置Jaeger追踪功能</figcaption></figure><p id="cdaf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">用户可以选择用动画来可视化实时交通，并可以使用徽章(断路器、虚拟服务、边车)来过滤特定信息。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/18faeb1c5cb7a27dd543e132a5568d46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pC_qLCjR9rIYPYZZ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —实时交通可视化</figcaption></figure><p id="7f3a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上图所示，地图显示了从网关到服务(v1和v2)的流量。左侧的选项卡提供了有关每秒请求数、服务的请求数的信息，以及上述信息的微型图表表示。用户可以选择特定的端点来过滤特定于服务的信息，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/2ccc4e53b4b6e25565893ce913fa5042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ga5ktX94t4dDsPTC"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —基于端点的可视化</figcaption></figure><p id="d3cb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">分布式跟踪提供了流和交互的跟踪视图，以及依赖图(DAG)。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/b6f5d0b1b11851fe71bb352d23fbec00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gqlzSIYtfnT_DWni"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">用Jaeger进行分布式跟踪</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/5e05dff5a7c47fd322edf4641c2b0022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MU3xb8cO4VEFb2lr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用Jaeger进行分布式跟踪—图形视图</figcaption></figure><h1 id="b766" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Kiali可视化流量控制和金丝雀流量</h1><p id="e380" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">金丝雀部署和受控流是服务网格可以实现的重要功能。这些主要用于企业用例中的日常场景。下面的示例显示了一个简单的场景，其中有两个服务canary和ga，规则规定在它们之间分配60%-40%的流量。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/0b063fe1a3bb91d5fbbd8fb1cda15bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HjUvjLrVdkXovjR8"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">金丝雀配置示例</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/2507a0b53b7dd47c44ab14637d3113b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s6d72DO5GlUxoYbE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">基于权重的虚拟服务配置</figcaption></figure><p id="a4e0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kiali提供了一个清晰的地图视图，显示服务之间的实时流量，并带有图例信息，显示到达特定服务的流量百分比。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mu"><img src="../Images/644ffcd7ff1086239823bd4922d02794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QXWEkuYib5I6Fy8A"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —规则关联可视化</figcaption></figure><p id="fb42" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上图所示，显示了一个图例，说明特定的部署有一个与之关联的规则。</p><h1 id="85d8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Kiali可视化断路器</h1><p id="218a" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">断路器是一种规则，它可以基于许多条件(如连接和请求限制)允许与服务中不同端点集的不同连接。下面的示例是Istio提供的一个经典的httpbin示例，其中创建了一个traffic_policy来阻止连接和一个排出百分比。创建一个示例客户机(fortio)来与httpbin交互。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/fb38f03310d56122e767609d878386a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/0*snKTu0z6Nig2OcdA"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">面向Http的应用程序示例</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/bcf42d99093a20dc0d1c5e6c6820a5bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HtOiB0OtHeVf1cif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带断路器的示例目的地规则</figcaption></figure><p id="a1a7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据上述规则,‘max connections:1’和‘http 1 maxpendingrequests:1’规定，如果一个以上的连接和请求同时命中httpbin，则istio-proxy为进一步的请求打开电路，这导致失败。</p><p id="c8eb" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有2个并发连接和20个请求队列:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/08e71a2c756b50e1ccef57e76a9e823e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fb-MYAH_tR_MEod-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">测试断路配置</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/06069efe8c3c6c721058dc20d87aad39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7u-u6cHFYmIR3pSO"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化断路器</figcaption></figure><p id="83c1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，大多数请求都成功了。Kiali map在httpbin上显示一个符号，表示已经配置了一个规则。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/29fbd8e286e49a4af597e2a6ed640ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/0*SaJ5WM1eYut2CW-W"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化服务的特定流量</figcaption></figure><p id="9782" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">有12个并发连接和20个请求队列:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/351836bcd4565d634f20637488aaec9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dVIEZOT3HHZePjbP"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">测试断路配置</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/fbe277263f05cd81af305f2383e4d6cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SX54ep1ZMWY-zAB0"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化断路器</figcaption></figure><p id="03ae" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，近50%的请求成功了，其他的则失败了。Kiali显示上述故障范围超过50%。“服务”选项卡还会发出有关连接降级的警报，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/77a9df0e0db3ebc28469e281152f329d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kpk--sd7PFuuW24r"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化每项服务的错误率</figcaption></figure><p id="c987" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">分布式跟踪提供了请求跟踪的深入视图，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/b14f39ec42f350630b802e407f5eaee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xPftzxaAPB371qz6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —使用Jaeger进行应用追踪</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/1934f13738bc3966bf88c3ad6c6e8604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wyz6j5VyQrjXHFPG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —使用Jaeger进行应用程序跟踪—图形表示</figcaption></figure><h1 id="ff7c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">可视化多层Bookinfo应用程序</h1><p id="a72c" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">上面的例子展示了基于单一服务的模式。Kiali在监控复杂的应用程序模式中扮演着重要的角色。以下Bookinfo示例由多层服务架构(产品、评论、评级和详细信息)组成。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3c4396db2866e1cc03fd1105389bc39d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/0*AGKYmVKQrzOZkzvT"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">使用Bookinfo应用程序的示例插图</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/b61e75c06994edbac259a1821371500a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YTktglkTapiLWzR0"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Bookinfo在Kubernetes上的应用</figcaption></figure><p id="94f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Kiali发现了上面创建的所有对象。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/e9c937dfb15f64629c479e74b23a396e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_vPxTu4bniAhu2M5"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —自动发现对象</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mt"><img src="../Images/3c174c612381e01d61a7ebc9429d3aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6axp5HNh01tBt7P1"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —自动发现对象</figcaption></figure><p id="0359" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在没有任何Istio政策和规则的情况下，流程模式如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/1d86afaae0bc247a0245f3fad61409d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m7HdhnUvC9bwOU9Y"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化，无需执行任何Istio规则</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/6579b013d7d2ac6f7a2e1681a8568d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WYII0Z7mHV9xu1Oo"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —可视化，无需执行任何Istio规则</figcaption></figure><p id="2501" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Jaeger的分布式跟踪提供了应用程序中所有流的全面跟踪图，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/f4aa345c81cf74f33bbe4c9df2841349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YdNyVb05rvhY8I3I"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在Kiali UI中嵌入Jaeger进行应用级跟踪</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/463598bda6c29ab4875feefd43d4898f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ojRKSCdZdu_VHVK_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">在Kiali UI中嵌入Jaeger进行应用级跟踪</figcaption></figure><p id="fd46" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Istio Grafana仪表板视图:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/df45e818b66d1a8f040eeda7e945902c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*87ozhq6FY15OAlNQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Istio Metrics — Grafana仪表板</figcaption></figure><h1 id="10b6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Kiali可视化延迟</h1><p id="e5a3" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">监控基于微服务的应用的一个主要方面是弹性测试。Istio使用户能够注入延迟故障来测试弹性、达到服务所需的时间和响应时间。Kiali的交通动画可以清楚地呈现流量和延误统计。使用与评级服务相关联的istio-config(目的地规则)引入7秒的延迟来测试弹性。Bookinfo应用程序是一个多层应用程序</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/cba3161ed6b1361c76c882d84dd54a41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lFcaIHGC6pK1wzdK"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">延迟的Istio虚拟服务</figcaption></figure><p id="ee9d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所述，7秒的固定延迟与相应子集(服务中子集的名称)的评级相关联。目标规则是使用istio-config创建的，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/411af405cba4de52bdab4fb90fd47f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ySOrJpNS3WV6rKkH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">示例目标规则配置</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/c6665fea6e542b885ed5d51b4c2f3e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vYlGfcXW1J47kTyT"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">有延迟的虚拟服务配置示例</figcaption></figure><p id="6a5a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将目的地规则应用于服务后，用户可以从Kiali UI直观地看到流程，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/0b12b3648acf91bb2b68517d2859a20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kUOxPcw6mUhLRrbd"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —目的地规则可视化</figcaption></figure><p id="61b7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，评级服务有一个图例，显示虚拟服务是相关联的。开始使用网关访问服务会显示如下所示的动画:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/1785c9a655ae305fb236beccce65bc8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O-6Bs0N05pnEUkZX"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —延迟可视化</figcaption></figure><p id="90f1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上面的图清楚地捕捉到了到达评级服务的诱导延迟。可以使用门户中提供的分布式跟踪清楚地跟踪流，如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/d42361f39001fa54c11b1e0f3586926a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UCIhbTG2aVb_U9_a"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">显示延迟的应用程序跟踪</figcaption></figure><h1 id="b8f7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用Kiali可视化故障</h1><p id="0f3f" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">应用程序中的错误服务会对应用程序的可用性和性能产生重大影响。使用上面的bookinfo示例，引入了一个http-fault来限制对reviews服务的50%的成功可达性，配置如下所示:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/e6e5e003c31cda02385d8563b283eda7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Eo8Z6ZdDBa5gg6LP"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带有故障注入的Istio Virtualservice</figcaption></figure><p id="44bf" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">所有三个版本的评论都有特定的权重。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/68c722d78f1e7872c8be3c988b32585d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cYnByQRV4mZXrIbo"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">基于Istio目标规则的权重分配</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/588d43a444e90021340c31f101a0b095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vAII2NCpLSE1TXez"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">权重分配—三个版本</figcaption></figure><p id="ef6e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">查看Kiali上的图表:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/e44fa89715a1c9ccdb9bfd6bcb0f3746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y-Ox7gUziZmM7QAG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —传出请求可视化</figcaption></figure><p id="cce8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所述，reviews和reviews-v2附有规则。根据配置，只有50%的成功传出请求来自reviews服务。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/e56dbe48bd1a30ae5b90f447e889a9b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*i2LGB8sqHBZ7Hl6Z"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali —传出请求可视化</figcaption></figure><h1 id="be10" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Kiali可视化中止</h1><p id="75b5" class="pw-post-body-paragraph kc kd iq ke b kf lz kh ki kj ma kl km kn mb kp kq kr mc kt ku kv md kx ky kz ij bi translated">服务中完全无功能的端点会影响应用程序的高可用性。在上面的例子中，只有50%的响应使用http-fault配置被阻塞。下面的配置注入了100%的故障，使得细节端点完全不可用，以复制服务的不可用性。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/01f79e55d3a9d227bb8914ffa2969746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SMfr_KecWfxGCNsY"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">带有中止配置的Istio Virtualservice</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/53f6069d0c0719da6370e68379cea476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hws66JF6gWnrc-Rm"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Istio虚拟服务配置</figcaption></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/aa6a15bf69a82e65681db86d9502ae16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uu8xnEdbeiDkqxon"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali — Http故障可视化(图例)</figcaption></figure><p id="2c90" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如上所示，详细信息有一个关联的http-fault规则，这使得详细信息端点完全不可用。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/beee11c8f9b0e56bb9b297248494c4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_TERIgCPx0DyCvoc"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Kiali — Http故障可视化</figcaption></figure><p id="eea8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上面的图显示了到达细节服务的100%失败，这是通信中的中止。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/177090f9331f0696a1844f86e07940ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zl5mXCRlDXFUod1h"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">示例应用程序—中止</figcaption></figure><p id="8dc0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">下面的Istio Grafana仪表板视图显示，详细信息服务完全不可访问:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/e982e20a4ba00757e53a5439b4c2e3db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O0f5tWPAxxvmsFjL"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">Istio Metrics — Grafana仪表板</figcaption></figure><p id="8a89" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">随着用户开始将其应用从整体架构过渡到微服务，可见性对于部署的微服务来说变得至关重要，不仅仅是简单的指标。Istio with Mixer可以提供具体的功能，如流量管理、可观察性、策略实施、服务身份和安全性，Kiali等工具有助于在实时动态拓扑视图中理解复杂的服务网格交互，并在管理复杂的多层现实世界应用程序中发挥重要作用，使制定适合应用程序环境的特定策略变得更加容易。</p></div></div>    
</body>
</html>