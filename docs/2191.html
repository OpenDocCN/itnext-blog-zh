<html>
<head>
<title>Back-End pagination with NodeJS, ExpressJS, MongoDB, Mongoose, EJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NodeJS，ExpressJS，MongoDB，Mongoose，eJS进行后端分页</h1>
<blockquote>原文：<a href="https://itnext.io/back-end-pagination-with-nodejs-expressjs-mongodb-mongoose-ejs-3566994356e0?source=collection_archive---------0-----------------------#2019-04-14">https://itnext.io/back-end-pagination-with-nodejs-expressjs-mongodb-mongoose-ejs-3566994356e0?source=collection_archive---------0-----------------------#2019-04-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a9b7a704201eecfe27ba244d9aa53e17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gIStV8pSapACchqdoWJFJw.jpeg"/></div></div></figure><p id="b137" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">做电商web app？自己做项目来提高自己的技能？需要实现分页？并且可能正在努力寻找实现分页的最佳方式。</p><p id="6521" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将向您展示如何在后端实现分页。我们将使用下一个堆栈:</p><ul class=""><li id="c374" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir"> NodeJS </strong> - JavaScript运行时环境</li><li id="cf42" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir"> ExpressJS </strong> - NodeJS框架</li><li id="1ca4" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir"> MongoDB </strong> - NoSQL数据库</li><li id="b940" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">mongose</strong>-MongoDB对象建模</li><li id="da5b" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">嵌入式JavaScript模板(EJS) </strong> -查看引擎</li></ul><p id="8c15" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">除了这些要素，我使用express router来提高代码可读性和组织性，使用body-parser来解析传入的请求体。</p><p id="eed1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>我将跳过基本环境启动设置。没有NPM软件包安装，没有目录树创建等。</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="a4c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将通过在一个单独的文件中构建一个<strong class="ka ir">助手函数</strong>来开始创建分页，我们将在后面使用它。这个功能将用于我们的搜索系统。函数使用正则表达式(RegEx ),并且它对许多字符进行转义。我不会在本文中讨论正则表达式。但是，如果你想了解更多关于RegEx的信息，这是一个非常好的“工具”,请查看<a class="ae lr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" rel="noopener ugc nofollow" target="_blank">这个</a>链接。</p><h2 id="890d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma kj mb mc md kn me mf mg kr mh mi mj mk bi translated"><strong class="ak">辅助函数(regex-escape.js) </strong></h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="22e7" class="ls lt iq mq b gy mu mv l mw mx">// Regex function for search functionality<br/>const escapeRegex = (string) =&gt; {<br/>  return string.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&amp;");<br/>};</span><span id="f17b" class="ls lt iq mq b gy my mv l mw mx">// Exporting Function<br/>module.exports = escapeRegex;</span></pre><h1 id="3966" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated"><strong class="ak">步骤1 -设置MongoDB产品模式(Products.js) </strong></h1><p id="50fe" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">首先，我们需要为产品设置MongoDB模式/模型。<br/>产品将有数据，如:名称，描述，价格，图像。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="8cf0" class="ls lt iq mq b gy mu mv l mw mx">// - Importing Mongoose - \\<br/>const mongoose = require('mongoose');</span><span id="3d2d" class="ls lt iq mq b gy my mv l mw mx">// * ------------- * \\<br/>// - MongoDB Schema - \<br/>// * ------------- * \\</span><span id="52a7" class="ls lt iq mq b gy my mv l mw mx">// - Creating Schema for database - \\<br/>const prodSchema = new mongoose.Schema({<br/> name: String,<br/> description: String,<br/> price: Number,<br/> image: String<br/>});</span><span id="048e" class="ls lt iq mq b gy my mv l mw mx">// - Compiling mongoose Schema to a Model - \\<br/>const Product = mongoose.model('Product', prodSchema);</span><span id="4118" class="ls lt iq mq b gy my mv l mw mx">// Exporting Products Model<br/>module.exports = Product;</span></pre><p id="c5b2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好的，在我们完成这项工作后，我们将确保该模型确实被导出，这样我们就可以在其他文件中使用它。</p><p id="f075" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>我使用<strong class="ka ir">字符串</strong>作为图片属性的原因是因为我要存储图片的链接。如果你愿意，你可以设置blobs二进制文件或类似的文件。</p><h1 id="7a5b" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated"><strong class="ak">步骤2 -设置店铺路线(shop.js) </strong></h1><p id="e1c2" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">接下来，我们将设置一个车间路线文件(shop.js)。商店路线将包括获取显示索引商店页面和产品页面的请求。同样，我们将编码我们的小型搜索系统。</p><p id="a03c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">1.<strong class="ka ir">需要依赖:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6fef" class="ls lt iq mq b gy mu mv l mw mx">// - Setting Up Dependencies - \\<br/>const express = require('express'),<br/>                router = express.Router();<br/>// - Importing MVC files (Model-View-Controller design pattern) - \\<br/>const Product = require('../models/Products');<br/>// - Importing Other JS Files - \\<br/>const escapeRegex = require('../../js/utilities/regex-escape');</span></pre><p id="48d4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.<strong class="ka ir">设置商店索引页面的获取请求:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="a2fa" class="ls lt iq mq b gy mu mv l mw mx">// GET - Shop Index Page | - Displaying shop index page - \\<br/>router.get('/shop', async (req, res) =&gt; {<br/>try {<br/>  // Rendering EJS Shop Index File<br/>  res.render('shop-index.ejs');<br/>} catch (err) {<br/>  throw new Error(err);<br/> } <br/>});</span></pre><p id="e9af" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> → </strong>基本获取请求路线设置，呈现EJS店铺索引页面。它使用异步/等待。虽然，我们可以使用普通的回调，但这不会有什么不同，因为我们所做的只是渲染EJS文件。</p><p id="d284" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.<strong class="ka ir">设置获取产品请求页面:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="0c18" class="ls lt iq mq b gy mu mv l mw mx">// GET - Shop Product Page | - Displaying demanded product page with page numbers</span><span id="bffa" class="ls lt iq mq b gy my mv l mw mx">router.get('/shop/:page', async (req, res, next) =&gt; {<br/>// Declaring variable<br/>const resPerPage = 9; // results per page<br/>const page = req.params.page || 1; // Page </span><span id="3f96" class="ls lt iq mq b gy my mv l mw mx">try {<br/> if (req.query.search) {<br/>// Declaring query based/search variables<br/>   const searchQuery = req.query.search,<br/>   regex = new RegExp(escapeRegex(req.query.search), 'gi');</span><span id="ce18" class="ls lt iq mq b gy my mv l mw mx">// Find Demanded Products - Skipping page values, limit results       per page<br/>const foundProducts = await Product.find({name:regex})<br/>      .skip((resPerPage * page) - resPerPage)<br/>      .limit(resPerPage);<br/>// Count how many products were found<br/>const numOfProducts = await Product.count({name: regex});<br/>// Renders The Page<br/>res.render('shop-products.ejs'), {<br/>   products: foundProducts, <br/>   currentPage: page, <br/>   pages: Math.ceil(numOfProducts / resPerPage), <br/>   searchVal: searchQuery, <br/>   numOfResults: numOfProducts<br/>  });<br/> }<br/>} catch (err) {<br/>  throw new Error(err);<br/>}<br/>});</span></pre><p id="4a77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> → </strong>这个有点麻烦，但是如果你仔细看看，它并不复杂。<br/>——首先，我们为产品页面设置一个GET请求路径。它以<strong class="ka ir">:页面</strong>为参数，指出我们所在的页面。<br/> -接下来，我们声明一些变量。第一个变量(<strong class="ka ir"> resPerPage </strong>)决定了我们希望每页显示多少产品。在这种情况下，它是9。第二个变量(<strong class="ka ir"> page </strong>)决定用户所在的页面。默认情况下是第一页。<br/> -接下来我们打开了新的try块，它以if语句开始。它说:只有在有搜索查询的情况下，才执行下面的代码。<br/> -我们将搜索查询(req.query.search)保存在一个名为<strong class="ka ir"> searchQuery </strong>的变量中。除此之外，我们将助手正则表达式转义函数应用于保存的查询变量<strong class="ka ir"> searchQuery。因此我们的助手函数提取了searchQuery变量的内容，我们可以将它应用于下一个方法！<strong class="ka ir"> req.query.search </strong>来自我们将在shop-index.ejs文件中构建的表单提交。<br/> -在下一个方法<strong class="ka ir"> Product.find({name: regex})中，</strong>我们搜索产品。那个<strong class="ka ir"> regex </strong>变量包含使用regex-escape函数提取的req.search.query数据。除此之外，我们跳过这一页，所以使用<strong class="ka ir">，第一页实际上计算为第1页。</strong>跳过()”的方法。最后，我们将每页的结果限制为9个。<br/> -之后，我们使用<strong class="ka ir">统计找到了多少产品。</strong>计数()方法。<br/> -最后我们渲染<strong class="ka ir">填充了变量的shop-products.ejs </strong>页面！</strong></p><p id="5d86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.<strong class="ka ir">导出店铺路由器:</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d65b" class="ls lt iq mq b gy mu mv l mw mx">// Exporting Shop Router<br/>module.exports = router;</span></pre><p id="39fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">→简单导出shop.js路由器。</p><h2 id="f762" class="ls lt iq bd lu lv lw dn lx ly lz dp ma kj mb mc md kn me mf mg kr mh mi mj mk bi translated"><strong class="ak"> shop.js文件结尾应该是这样的:</strong></h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ac86" class="ls lt iq mq b gy mu mv l mw mx">// - Setting Up Dependencies - \\<br/>const express = require('express'),<br/>                router = express.Router();<br/>// - Importing MVC files (Model-View-Controller design pattern) - \\<br/>const Product = require('../models/Products');<br/>// - Importing Other JS Files - \\<br/>const escapeRegex = require('../../js/utilities/regex-escape');</span><span id="20c0" class="ls lt iq mq b gy my mv l mw mx">// GET - Shop Index Page | - Displaying shop index page - \\<br/>router.get('/shop', async (req, res) =&gt; {<br/>try {<br/>  // Rendering EJS Shop Index File<br/>  res.render('shop-index.ejs');<br/>} catch (err) {<br/>  throw new Error(err);<br/> } <br/>});<br/></span><span id="57b5" class="ls lt iq mq b gy my mv l mw mx">// GET - Shop Product Page | - Displaying demanded product page with page numbers</span><span id="230a" class="ls lt iq mq b gy my mv l mw mx">router.get('/shop/:page', async (req, res, next) =&gt; {<br/>// Declaring variable<br/>const resPerPage = 9; // results per page<br/>const page = req.params.page || 1; // Page</span><span id="bf51" class="ls lt iq mq b gy my mv l mw mx">try {<br/> if (req.query.search) {<br/>// Declaring query based/search variables<br/>   const searchQuery = req.query.search,<br/>   regex = new RegExp(escapeRegex(req.query.search), 'gi');</span><span id="c608" class="ls lt iq mq b gy my mv l mw mx">// Find Demanded Products - Skipping page values, limit results       per page<br/>const foundProducts = await Product.find({name:regex})<br/>      .skip((resPerPage * page) - resPerPage)<br/>      .limit(resPerPage);<br/>// Count how many products were found<br/>const numOfProducts = await Product.count({name: regex});<br/>// Renders The Page<br/>res.render('shop-products.ejs'), {<br/>   products: foundProducts, <br/>   currentPage: page, <br/>   pages: Math.ceil(numOfProducts / resPerPage), <br/>   searchVal: searchQuery, <br/>   numOfResults: numOfProducts<br/>  });<br/> }<br/>} catch (err) {<br/>  throw new Error(err);<br/>}<br/>});</span><span id="d2ee" class="ls lt iq mq b gy my mv l mw mx">// Exporting Shop Router<br/>module.exports = router;</span></pre><h1 id="de00" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated"><strong class="ak">第3步-构建EJS索引商店页面(shop-index.ejs) </strong></h1><p id="e435" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">在我们完成后端的所有工作后，我们可以创建我们的第一个EJS文件。我们将它命名为shop-index.ejs. <br/>跳过填充了元数据和所有链接、标题等的头部分。我们将直接进入它的主要内容。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="9fbe" class="ls lt iq mq b gy mu mv l mw mx">&lt;div class="standard-wrapper"&gt;<br/>  &lt;header&gt;<br/>   &lt;div&gt;<br/>     &lt;h1&gt;PLACEHOLDER TEXT&lt;/h1&gt;<br/>     &lt;h2&gt;Search For Products&lt;/h2&gt;<br/>   &lt;/div&gt;<br/>  &lt;div class="header-form"&gt;<br/>    &lt;form action="/shop/1/"&gt;<br/>      &lt;input type="text" name="search" placeholder="Search"&gt;<br/>      &lt;button type="submit"&gt;&lt;/button&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/> &lt;/header&gt;<br/>&lt;/div&gt;</span></pre><p id="9a6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">注意:</strong>确保表单中的action参数等于您在shop.js中的GET请求。在这种情况下，由于我们使用了<strong class="ka ir">router . GET('/shop/:page ')</strong>我们必须将数字1添加到表单中的action param (action='/shop/1 ')，因此它从第1页开始。</p><h1 id="0a51" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated"><strong class="ak">第4步-构建EJS店铺产品页面(shop-products.ejs) </strong></h1><p id="5bfd" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">真正的部分来了。我们将建立我们的实际产品页面。我们将这个文件命名为shop-products.ejs. <br/>我们将再次跳过头部分，直接进入它的主要部分。</p><p id="b21a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 1。构建结果容器/部分页面|显示产品数据(产品数量、页面数量、搜索查询)</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="9c17" class="ls lt iq mq b gy mu mv l mw mx">&lt;!-- SEARCH RESULTS | START --&gt;<br/>&lt;div class="results"&gt;<br/> &lt;h3&gt;Search results: &lt;span&gt;&lt;%= searchVal %&gt;&lt;/span&gt;&lt;/h3&gt;<br/> &lt;h4&gt;Displaying Total &lt;span&gt;&lt;%= numOfResults %&gt;&lt;/span&gt; Results&lt;/h4&gt;<br/> &lt;h4&gt;<br/>   Page <br/>   &lt;span&gt;&lt;%= currentPage %&gt;&lt;/span&gt; // 1<br/>   of <br/>   &lt;span&gt;&lt;%= pages %&gt;&lt;/span&gt; // 2<br/> &lt;/h4&gt; // Displays: Page 1 of 2, depends on how many pages there are<br/>&lt;/div&gt;<br/>&lt;!-- SEARCH RESULTS | END --&gt;</span></pre><p id="1780" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">→这是我们构建的一个简单的容器/页面的一部分，显示用户搜索了什么，向用户显示了多少结果，搜索到的产品有多少页面。</p><p id="54e6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 2。渲染产品</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="48d9" class="ls lt iq mq b gy mu mv l mw mx">&lt;!-- SHOP | START --&gt;<br/> &lt;section class="shop"&gt;<br/>  &lt;div class="shop-container"&gt;</span><span id="00e2" class="ls lt iq mq b gy my mv l mw mx">&lt;!-- Rendering Products using EJS --&gt;<br/>&lt;% products.forEach(product =&gt; { %&gt;<br/> &lt;div class="item"&gt;<br/>  &lt;div class="shop-row shop-row--1"&gt;<br/>   &lt;img data-lazy="&lt;%= product.image %&gt;" class="cover-img"&gt;<br/>  &lt;/div&gt;<br/> &lt;div class="item-desc"&gt;<br/>  &lt;h2 class="item-desc__name"&gt;&lt;%= product.name %&gt;&lt;/h2&gt;<br/>  &lt;p class="item-desc__text"&gt;&lt;%= product.description %&gt;&lt;/p&gt;<br/>  &lt;h3 class="item-desc__price"&gt;&amp;dollar; &lt;%= product.price %&gt;<br/> &lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;% }); %&gt;<br/>&lt;/div&gt;</span></pre><p id="9223" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">→我们使用EJS和forEach循环来呈现产品。对于我们数据库中的每个产品，我们呈现填充有其他div的新div，这些div填充有特定数据，如名称、描述、价格、图像。</p><p id="cbba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> 3。建筑分页</strong></p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c8f4" class="ls lt iq mq b gy mu mv l mw mx">&lt;!-- PAGINATION --&gt;<br/>&lt;div class="shop-pagination"&gt;<br/> &lt;div class="pagination"&gt;<br/>&lt;% if (currentPage == 1 &amp;&amp; pages &gt; 1) { %&gt; <br/>&lt;a <br/>href="/shop/&lt;%= parseInt(currentPage) + 1 %&gt;/?search=&lt;%=searchVal%&gt;" &lt;span&gt;<br/>  Page &lt;%=  parseInt(currentPage) + 1 %&gt;<br/>  &lt;i class="icon ion-ios-arrow-forward"&gt;&lt;/i&gt;<br/>&lt;/span&gt;<br/>&lt;/a&gt;</span><span id="7bca" class="ls lt iq mq b gy my mv l mw mx">&lt;% } else if (currentPage &lt; pages) { %&gt;<br/>&lt;a <br/>href="/shop/&lt;%= parseInt(currentPage) - 1 %&gt;/?search&lt;%=searchVal%&gt;"&gt;&lt;span&gt;<br/>  &lt;i class="icon ion-ios-arrow-back"&gt;&lt;/i&gt;<br/>  Page &lt;%= parseInt(currentPage) - 1 %&gt;<br/>&lt;/span&gt;<br/>&lt;/a&gt;</span><span id="7efb" class="ls lt iq mq b gy my mv l mw mx">&lt;a <br/>href="/shop/&lt;%= parseInt(currentPage) + 1 %&gt;/?search&lt;%=searchVal%&gt;"&gt;&lt;span&gt;<br/> Page &lt;%= parseInt(currentPage) + 1 %&gt;<br/> &lt;i class="icon ion-ios-arrow-forward"&gt;&lt;/i&gt;<br/>&lt;/span&gt;<br/>&lt;/a&gt;</span><span id="fef3" class="ls lt iq mq b gy my mv l mw mx">&lt;% } else if (currentPage == pages &amp;&amp; pages &gt; 1) { %&gt;<br/>&lt;a <br/>href="/shop/&lt;%= parseInt(currentPage) - 1 %&gt;/?search&lt;%=searchVal%&gt;"&gt;&lt;span&gt;<br/>  &lt;i class="icon ion-ios-arrow-back"&gt;&lt;/i&gt;Page <br/>  &lt;%=parseInt(currentPage) - 1 %&gt;<br/>&lt;/span&gt;<br/>&lt;/a&gt;</span><span id="2b16" class="ls lt iq mq b gy my mv l mw mx">&lt;% } %&gt;<br/>&lt;/div&gt;</span></pre><p id="9e14" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> → </strong>这里我们构建实际的分页。首先，如果currentPage为1，只有渲染按钮才能前进。否则，如果当前页面少于实际页面数量(这意味着我们在中间的某个地方，例如:第5页，共9页)，渲染两个按钮，向前和向后。最后，在最后，如果currentPage等于总页数，并且有超过1页(我们是在最后一页)，只呈现按钮返回。<br/>如果结果小于9或9，分页将不会呈现。</p><h2 id="8cc3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma kj mb mc md kn me mf mg kr mh mi mj mk bi translated"><strong class="ak">最终的shop-products.ejs文件应该是这样的:</strong></h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="f745" class="ls lt iq mq b gy mu mv l mw mx">&lt;!-- SEARCH RESULTS | START --&gt;<br/>&lt;div class="results"&gt;<br/> &lt;h3&gt;Search results: &lt;span&gt;&lt;%= searchVal %&gt;&lt;/span&gt;&lt;/h3&gt;<br/> &lt;h4&gt;Displaying Total &lt;span&gt;&lt;%= numOfResults %&gt;&lt;/span&gt; Results&lt;/h4&gt;<br/> &lt;h4&gt;<br/>   Page <br/>   &lt;span&gt;&lt;%= currentPage %&gt;&lt;/span&gt; // 1<br/>   of <br/>   &lt;span&gt;&lt;%= pages %&gt;&lt;/span&gt; // 2<br/> &lt;/h4&gt; // Displays: Page 1 of 2, depends on how many pages there are<br/>&lt;/div&gt;<br/>&lt;!-- SEARCH RESULTS | END --&gt;</span><span id="e282" class="ls lt iq mq b gy my mv l mw mx">&lt;!-- SHOP | START --&gt;<br/>&lt;section class="shop"&gt;<br/> &lt;div class="shop-container"&gt;</span><span id="8781" class="ls lt iq mq b gy my mv l mw mx"> &lt;!-- Rendering Products using EJS --&gt;<br/> &lt;% products.forEach(product =&gt; { %&gt;<br/>  &lt;div class="item"&gt;<br/>   &lt;div class="shop-row shop-row--1"&gt;<br/>    &lt;img data-lazy="&lt;%= product.image %&gt;" class="cover-img"&gt;<br/>   &lt;/div&gt;<br/>  &lt;div class="item-desc"&gt;<br/>   &lt;h2 class="item-desc__name"&gt;&lt;%= product.name %&gt;&lt;/h2&gt;<br/>   &lt;p class="item-desc__text"&gt;&lt;%= product.description %&gt;&lt;/p&gt;<br/>   &lt;h3 class="item-desc__price"&gt;&amp;dollar; &lt;%= product.price %&gt;<br/>  &lt;/div&gt;<br/> &lt;/div&gt;<br/>&lt;% }); %&gt;<br/>&lt;/div&gt;</span><span id="ef44" class="ls lt iq mq b gy my mv l mw mx">&lt;!-- PAGINATION --&gt;<br/> &lt;div class="shop-pagination"&gt;<br/>  &lt;div class="pagination"&gt;<br/>   &lt;% if (currentPage == 1 &amp;&amp; pages &gt; 1) { %&gt; <br/>    &lt;a <br/>      href="/shop/&lt;%= parseInt(currentPage) + 1 %&gt;<br/>           /?search=&lt;%=searchVal%&gt;" <br/>      &lt;span&gt;<br/>       Page &lt;%=  parseInt(currentPage) + 1 %&gt;<br/>       &lt;i class="icon ion-ios-arrow-forward"&gt;&lt;/i&gt;<br/>      &lt;/span&gt;<br/>    &lt;/a&gt;</span><span id="2351" class="ls lt iq mq b gy my mv l mw mx">  &lt;% } else if (currentPage &lt; pages) { %&gt;<br/>   &lt;a <br/>     href="/shop/&lt;%= parseInt(currentPage) - 1 %&gt;<br/>          /?search&lt;%=searchVal%&gt;"&gt;<br/>     &lt;span&gt;<br/>       &lt;i class="icon ion-ios-arrow-back"&gt;&lt;/i&gt;<br/>       Page &lt;%= parseInt(currentPage) - 1 %&gt;<br/>     &lt;/span&gt;<br/>   &lt;/a&gt;</span><span id="38b8" class="ls lt iq mq b gy my mv l mw mx">   &lt;a <br/>     href="/shop/&lt;%= parseInt(currentPage) + 1 %&gt;<br/>          /?search&lt;%=searchVal%&gt;"&gt;<br/>     &lt;span&gt;<br/>      Page &lt;%= parseInt(currentPage) + 1 %&gt;<br/>      &lt;i class="icon ion-ios-arrow-forward"&gt;&lt;/i&gt;<br/>     &lt;/span&gt;<br/>   &lt;/a&gt;</span><span id="3109" class="ls lt iq mq b gy my mv l mw mx"> &lt;% } else if (currentPage == pages &amp;&amp; pages &gt; 1) { %&gt;<br/>  &lt;a <br/>    href="/shop/&lt;%= parseInt(currentPage) - 1 %&gt;<br/>         /?search&lt;%=searchVal%&gt;"&gt;<br/>    &lt;span&gt;<br/>     &lt;i class="icon ion-ios-arrow-back"&gt;&lt;/i&gt;Page <br/>     &lt;%=parseInt(currentPage) - 1 %&gt;<br/>    &lt;/span&gt;<br/>  &lt;/a&gt;</span><span id="317b" class="ls lt iq mq b gy my mv l mw mx">   &lt;% } %&gt;<br/>  &lt;/div&gt;<br/> &lt;/div&gt;<br/>&lt;% } %&gt;<br/>&lt;/section&gt;</span></pre></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="2aee" class="mz lt iq bd lu na nv nc lx nd nw nf ma ng nx ni md nj ny nl mg nm nz no mj np bi translated"><strong class="ak">我用同样的代码创建了什么</strong></h1><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/76f431a3f2ae5005d6a1898b8fe8073f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tuhq2ApM1PUgItPvp-mwJA.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">我的个人项目。与漫画相关的Web app(基于电子商务)！</figcaption></figure><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi of"><img src="../Images/8e9e12669938275528099ad164579853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jHgMx9M12KPUNiaChgGmhw.png"/></div></div><figcaption class="ob oc gj gh gi od oe bd b be z dk translated">它的另一个例子显示每页3个结果</figcaption></figure><h1 id="3646" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated">一切都搞定了！</h1><p id="cc37" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">官方说法，就是这样。分页已经完成并正常工作。这确实需要几行后端代码，但另一方面，EJS占用了更大一部分。</p><p id="788a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我从EJS文件的特定元素中删除了类，因为我想保持代码整洁，并在实际编写代码时获得更多空间。我在一些元素上留下了一些类，这样您就可以看到我是如何结合SASS实现BEM方法的，即使我在本文中没有涉及SASS，也值得一提。</p><h1 id="7037" class="mz lt iq bd lu na nb nc lx nd ne nf ma ng nh ni md nj nk nl mg nm nn no mj np bi translated"><strong class="ak">结论</strong></h1><p id="19a9" class="pw-post-body-paragraph jy jz iq ka b kb nq kd ke kf nr kh ki kj ns kl km kn nt kp kq kr nu kt ku kv ij bi translated">我花了超过24个小时来为我的个人项目建立这个，我想我可以通过写这篇文章来节省别人的时间，如果有人正在寻求实现这样的东西。<br/>当然，这并不是你能找到的唯一一篇关于后端分页的文章，我敢打赌还有更多不同的文章，值得一读。你知道的解决特定问题或类似问题的方法越多越好。就我而言，我找不到我真正想要的，所以我做了研究，写下几个例子，然后这样做。</p><p id="3d58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我确实从这篇关于后端分页的文章中得到了一些代码！</p><p id="1579" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">祝你创造惊人的东西！</p><p id="5ce5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另外，你现在可以在twitter上关注我！</p></div></div>    
</body>
</html>