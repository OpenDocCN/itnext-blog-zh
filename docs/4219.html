<html>
<head>
<title>Terraform — Validating inputs (experimental feature)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Terraform验证输入(实验功能)</h1>
<blockquote>原文：<a href="https://itnext.io/terraform-validating-inputs-experimental-feature-6cc502b94357?source=collection_archive---------3-----------------------#2020-05-18">https://itnext.io/terraform-validating-inputs-experimental-feature-6cc502b94357?source=collection_archive---------3-----------------------#2020-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6382cac8050ec6b59c9b58b9c1a6f14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vQNMxW5NrLmw4hOGyTCbig.png"/></div></div></figure><p id="030f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我是Azure ARM模板的长期用户。我确保始终使用的一个特性是验证ARM输入参数。然而，我总是发现验证选项是有限的；尤其是ARM模板语言不可扩展。随着我使用Terraform的进展，我想继续验证输入，看看TF是否提供了额外的价值。</p><p id="276b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我在0.12流中开始了我的TF之旅，这意味着我不必处理以前版本中的限制。我惊讶地发现输入验证是一个预览/实验特性。幸运的是，它满足了我的期望，并解决了ARM的可扩展性问题。</p><p id="9528" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一个实验性的特性，您必须在您的模块代码中订阅它的用法。在您的<em class="kw"> variables.tf </em>(或any。tf文件)。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="532d" class="lg lh iq lc b gy li lj l lk ll">terraform {</span><span id="b14f" class="lg lh iq lc b gy lm lj l lk ll">  experiments = [variable_validation]</span><span id="5ee2" class="lg lh iq lc b gy lm lj l lk ll">}</span></pre><p id="c093" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看几个例子</p><p id="50bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我有一个模块，在其中我为AKS集群创建了一个虚拟网络、子网和路由。我希望该模块是固执己见的执行/21 CIDR范围。如您所见，验证条件可以利用所有可用的函数。此外，它还允许您提供有意义的错误消息。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6fd0" class="lg lh iq lc b gy li lj l lk ll">variable "base_cidr_block" {</span><span id="2177" class="lg lh iq lc b gy lm lj l lk ll">  type        = string</span><span id="9509" class="lg lh iq lc b gy lm lj l lk ll">  description = "Address range for the virtual network in CIDR notation. CIDR must be a /21."</span><span id="3e44" class="lg lh iq lc b gy lm lj l lk ll">  validation {</span><span id="5e04" class="lg lh iq lc b gy lm lj l lk ll">    condition     = tonumber(regex("/(\\d+)", var.base_cidr_block)[0]) == 21</span><span id="92c0" class="lg lh iq lc b gy lm lj l lk ll">    error_message = "A CIDR range of /21 is required to support enough Pod IPs."</span><span id="fbdf" class="lg lh iq lc b gy lm lj l lk ll">  }</span><span id="7365" class="lg lh iq lc b gy lm lj l lk ll">}</span></pre><p id="43df" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我实现的第二个验证类似于ARM中的contains()函数</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a69d" class="lg lh iq lc b gy li lj l lk ll">variable "tier_name" {</span><span id="b11c" class="lg lh iq lc b gy lm lj l lk ll">  type        = string</span><span id="784f" class="lg lh iq lc b gy lm lj l lk ll">  description = "Service tier the application will run."</span><span id="17e3" class="lg lh iq lc b gy lm lj l lk ll">  validation {</span><span id="55d9" class="lg lh iq lc b gy lm lj l lk ll">    condition     = contains(["prod", "nonp", "sbox"], var.tier_name)</span><span id="67f1" class="lg lh iq lc b gy lm lj l lk ll">    error_message = "Argument \"tier_name\" must be either \"sbox\", \"nonp\", or \"prod\"."</span><span id="5624" class="lg lh iq lc b gy lm lj l lk ll"> }</span><span id="e5af" class="lg lh iq lc b gy lm lj l lk ll">}</span></pre><p id="e658" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于这是一个实验性的功能，YMMV。我愿意在这个时候冒这个险，因为增加的价值超过了可能的弊端。我也愿意以后做小重构。我相信这个特性最终会成为GA。</p></div></div>    
</body>
</html>