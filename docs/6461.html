<html>
<head>
<title>When String.GetHashCode() in .NET C# Drives You Crazy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当字符串。中的GetHashCode()。NET C#让你抓狂</h1>
<blockquote>原文：<a href="https://itnext.io/when-string-gethashcode-in-net-c-drives-you-crazy-c97ac7507d7b?source=collection_archive---------2-----------------------#2021-11-22">https://itnext.io/when-string-gethashcode-in-net-c-drives-you-crazy-c97ac7507d7b?source=collection_archive---------2-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="3284" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">提示和技巧</h2><div class=""/><div class=""><h2 id="0093" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">知道什么时候依赖字符串。中的GetHashCode()。NET C#，而当不是。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/728c2c7a315c3b1e073645db56263a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zj3mCz4RduzSDPi5DazEOw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae lh" href="https://unsplash.com/@bkaraivanov?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Bozhin karivanov</a>拍摄的照片</figcaption></figure><h1 id="976e" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">故事</h1><p id="9312" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我正在做一个辅助项目，是一个帮助我日常工作的工具。在一个模块中，我需要跟踪一些可以在工具运行之间执行的事务。换句话说，当我关闭和打开工具时，这些事务应该在那里。</p><p id="375d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">对于存储，我使用了SQLite数据库，其中保存了表示我的事务类的实体的哈希代码。我依赖于这个哈希代码，因为在某个时候，该工具会生成一个新的哈希代码，并将其与数据库中已经保存的哈希代码进行比较。</p><p id="b700" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">所以，在设置好一切之后，我启动了这个工具，试了一下，是的…它工作了。我关闭了工具，做了一些事情，然后尝试测试另一个东西，现在它不能正常工作了！！</p><p id="d545" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我一直试图理解这是怎么回事，最终我明白了。哈希代码比较不太好。在工具的同一个运行会话中，比较工作正常。然而，当我关闭和打开该工具时，新生成的哈希代码——对于相同的事务——与保存在数据库中的代码不同。</p><p id="c260" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">我上网搜了一下，发现确实如此。据<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/api/system.string.gethashcode?view=net-6.0" rel="noopener ugc nofollow" target="_blank">微软</a>:</p><blockquote class="nb nc nd"><p id="3de8" class="ma mb ne mc b md mw kd mf mg mx kg mi nf my ml mm ng mz mp mq nh na mt mu mv im bi translated">哈希代码本身不能保证是稳定的。相同字符串的哈希代码可以不同。NET实现，跨。NET版本，以及跨。NET平台(如32位和64位)的单一版本。在某些情况下，它们甚至可以因应用程序域而异。这意味着同一程序的两次后续运行可能会返回不同的哈希代码。</p><p id="455d" class="ma mb ne mc b md mw kd mf mg mx kg mi nf my ml mm ng mz mp mq nh na mt mu mv im bi translated">因此，哈希代码决不能在创建它们的应用程序域之外使用，决不能用作集合中的键字段，也决不能持久化。</p><p id="1f32" class="ma mb ne mc b md mw kd mf mg mx kg mi nf my ml mm ng mz mp mq nh na mt mu mv im bi translated">最后，如果您需要一个加密的强哈希，不要使用哈希代码来代替加密哈希函数返回的值。对于加密散列，使用从<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.hashalgorithm?view=net-6.0" rel="noopener ugc nofollow" target="_blank">系统派生的类。security . cryptography . hash algorithm</a>或<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.keyedhashalgorithm?view=net-6.0" rel="noopener ugc nofollow" target="_blank">系统。security . cryptography . keyedhashalgorithm</a>类。</p><p id="5fc7" class="ma mb ne mc b md mw kd mf mg mx kg mi nf my ml mm ng mz mp mq nh na mt mu mv im bi translated">有关散列码的更多信息，参见<a class="ae lh" href="https://docs.microsoft.com/en-us/dotnet/api/system.object.gethashcode?view=net-6.0" rel="noopener ugc nofollow" target="_blank">对象。GetHashCode </a>。</p></blockquote><p id="1909" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">因此，我现在与你分享这个，我将告诉你如何以一种好的方式克服它。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt np"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd jd gy z fp nu fr fs nv fu fw jc bi translated">订阅艾哈迈德的时事通讯？</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od lb np"/></div></div></a></div></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/b5776995406efeaf8e011a34569acad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KtZXc1rR-zF9aqx6Q-63Nw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@brett_jordan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">布雷特·乔丹</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="bc8c" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">让我们试一试</h1><p id="ae4a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">用下面的代码创建一个控制台应用程序。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="ed9b" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">一个简单的类<code class="fe oh oi oj ok b">Employee</code>和一个简单的接口实现<code class="fe oh oi oj ok b">IEquatable&lt;Employee&gt;</code>。</p><p id="e1a1" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">请注意<code class="fe oh oi oj ok b">GetHashCode</code>方法是如何实现的。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="0dd7" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">运行应用程序时，我们会得到以下结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/0d1194c80cb31006118d841c4f6acfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_tkEX6QO7tRcWL7thX9upw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="ca8d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在，停止应用程序，并再次运行它。这是我们得到的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/bab09fe69f7f0e003e102f7cd11a6a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8wUFO7QRh8kS6upKm3_6A.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="248a" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">看，两个结果不一样。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/f3d79bf02868e5233324a3fa5b753638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDwbQ9zGjbFJS2t-wMf5Jg.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@volkanolmez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">沃尔坎·奥尔梅斯</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="3347" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">解决这个问题的正确方法</h1><h2 id="0f03" class="on lj it bd lk oo op dn lo oq or dp ls mj os ot lu mn ou ov lw mr ow ox ly iz bi translated">数组质量比较器<t/></h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="8f8a" class="on lj it bd lk oo op dn lo oq or dp ls mj os ot lu mn ou ov lw mr ow ox ly iz bi translated">严格的延伸</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h2 id="2608" class="on lj it bd lk oo op dn lo oq or dp ls mj os ot lu mn ou ov lw mr ow ox ly iz bi translated">固定雇员</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="of og l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><p id="cb5d" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">运行应用程序时，我们会得到以下结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/ef7c98feff34cb9e3314105abb8804cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZvBFWkJg4yIJl0RWhqQWg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="2682" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">现在，停止应用程序，并再次运行它。这是我们得到的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/ef7c98feff34cb9e3314105abb8804cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZvBFWkJg4yIJl0RWhqQWg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek" rel="noopener">艾哈迈德·塔里克</a>拍摄</figcaption></figure><p id="5478" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">看，两个结果是一样的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/6f0e20c9d5f07bf125c15d5ddf2efcd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AyautMn-liOhuCiz8T9CRw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@mioitophotography?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">MIO·伊藤</a>在<a class="ae lh" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="1752" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">摘要</h1><p id="700a" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如果您需要<code class="fe oh oi oj ok b">String.GetHashCode()</code>的结果在您的应用程序运行会话之间保持不变，您将需要遵循这种方式或另一种类似的方式。否则，每次停止并运行应用程序时，您都会得到一个新的结果。</p><p id="4742" class="pw-post-body-paragraph ma mb it mc b md mw kd mf mg mx kg mi mj my ml mm mn mz mp mq mr na mt mu mv im bi translated">就这样，希望你觉得读这个故事和我写它一样有趣。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="ead6" class="li lj it bd lk ll oz ln lo lp pa lr ls ki pb kj lu kl pc km lw ko pd kp ly lz bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="51b8" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">如果您还不是<strong class="mc jd">媒介</strong>会员，您可以使用<a class="ae lh" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="mc jd">我的推荐链接</strong> </a>，这样我就可以从<strong class="mc jd">媒介</strong>中获得您的一部分费用，您无需支付任何额外费用。<br/>▎订阅<a class="ae lh" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="mc jd">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="6693" class="li lj it bd lk ll oz ln lo lp pa lr ls ki pb kj lu kl pc km lw ko pd kp ly lz bi translated">其他资源</h1><p id="0f38" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">这些是你可能会发现有用的其他资源。</p><div class="pe pf gp gr pg np"><a href="https://levelup.gitconnected.com/better-enhanced-repository-pattern-implementation-in-net-c-4e6f4bbe48a9" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd jd gy z fp nu fr fs nv fu fw jc bi translated">中更好地增强了存储库模式的实现。NET C#</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">了解如何通过增强的设计来实现存储库模式以满足扩展的需求。</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="ny l"><div class="ph l oa ob oc ny od lb np"/></div></div></a></div><div class="pe pf gp gr pg np"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-fully-cover-net-c-console-application-with-unit-tests-446927a4a793"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd jd gy z fp nu fr fs nv fu fw jc bi translated">如何全面覆盖。带有单元测试的. NET C#控制台应用程序</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">知道什么吗？又是怎么做到的？使用TDD、DI和IoC完全覆盖您的控制台应用程序。</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">itnext.io</p></div></div><div class="ny l"><div class="pi l oa ob oc ny od lb np"/></div></div></a></div></div></div>    
</body>
</html>