<html>
<head>
<title>Git Force vs Force with Lease</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Git Force与Force with Lease</h1>
<blockquote>原文：<a href="https://itnext.io/git-force-vs-force-with-lease-9d0e753e8c41?source=collection_archive---------0-----------------------#2021-08-12">https://itnext.io/git-force-vs-force-with-lease-9d0e753e8c41?source=collection_archive---------0-----------------------#2021-08-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="d77a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">以及何时使用它们</h2></div><p id="b94d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">更新于2022年4月6日</em></p><p id="c8b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当有一个<code class="fe lf lg lh li b">git push</code>你想执行，而远程回购拒绝了它，有一个危险的方法让它工作:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="31bf" class="lr ls it li b gy lt lu l lv lw">git push --<strong class="li iu">force</strong></span></pre><p id="c98c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种危险的方法非常流行，大多数ide都有一个特殊的复选框。但是<code class="fe lf lg lh li b">force</code>有一个兄弟姐妹没有得到足够的关注:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="b034" class="lr ls it li b gy lt lu l lv lw">git push --<strong class="li iu">force-with-lease</strong></span></pre><p id="7ac4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ide通常没有<code class="fe lf lg lh li b">force-with-lease</code>的复选框，它通常不会在文档中提到，它也没有自己的科幻电影。</p><figure class="lj lk ll lm gt ly gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/249b15cbce432d31d7c9cdcac34c2ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*Yh_CAAspFEjT76F1wj6Yag.jpeg"/></div></figure><p id="6b06" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="le">更新:在IntelliJ IDE(2021.3版以后)上做强制推送的时候，</em> <a class="ae mb" href="https://www.jetbrains.com/help/idea/commit-and-push-changes.html#use-git-staging-area-to-commit-changes" rel="noopener ugc nofollow" target="_blank"> <em class="le">实际上做了一个带租约的强制</em> </a> <em class="le">。</em></p><h1 id="3fec" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">快进规则</h1><p id="000d" class="pw-post-body-paragraph ki kj it kk b kl mt ju kn ko mu jx kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">当推送到远程存储库时，如果远程存储库不是本地存储库的祖先，git将拒绝推送。这就是所谓的“快进规则”。Git这样做是因为它怀疑有人将一些新的提交推送到您试图推入的远程分支。但事实并非总是如此。以下所有情况都违反了快进规则，因此会被普通推送拒绝:</p><ul class=""><li id="4204" class="my mz it kk b kl km ko kp kr na kv nb kz nc ld nd ne nf ng bi translated">你把你的树枝换成了主人的，</li><li id="193e" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated">你重新排序了提交，</li><li id="b3fc" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated">您更改了提交消息，</li><li id="7161" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated">你把所有的承诺都压缩成了一个。</li></ul><p id="24b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们通常可以将所有这些情况称为“rebase”，因为所有这些都是通过普通的或交互式的rebase实现的。</p><p id="327e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当在rebase之后推动时，可以通过<code class="fe lf lg lh li b">--force</code>标志来绕过限制。通过这样做，git将完全忽略远程历史，并用分支的本地版本覆盖它。在这种情况下，很可能有人真的把什么东西推到了你的树枝上，而你只是把它扔掉了。</p><h1 id="1e8d" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">以租赁方式引入强制力</h1><p id="b568" class="pw-post-body-paragraph ki kj it kk b kl mt ju kn ko mu jx kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">为了避免这种情况，人们可以转而传递<code class="fe lf lg lh li b">--force-with-lease</code>旗。使用这个标志，git检查分支的远程版本是否与您重定基础的版本相同，也就是说，当我们重定基础时，是否有人提交了新的提交。如果远程分支被更改，推送将被拒绝。</p><p id="b904" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这就像是租用了您开始更改的分支版本。然后在推送时，它会检查您启动时的版本，只有当它记忆的版本与遥控器上当前的版本匹配时，才会应用更改。因此，您不会意外地覆盖您没有意识到的提交。</p><h1 id="88ce" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">何时对租赁使用武力</h1><p id="9181" class="pw-post-body-paragraph ki kj it kk b kl mt ju kn ko mu jx kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">建议始终使用<code class="fe lf lg lh li b">--force-with-lease</code>而非<code class="fe lf lg lh li b">--force</code>。</p><h1 id="56fb" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">何时使用武力</h1><p id="1e2f" class="pw-post-body-paragraph ki kj it kk b kl mt ju kn ko mu jx kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">可以使用<code class="fe lf lg lh li b">--force</code>忽略远程分支上新添加的提交，并用本地提交覆盖它们。</p><blockquote class="nm"><p id="8d1a" class="nn no it bd np nq nr ns nt nu nv ld dk translated">不要强行推动，除非你想打破什么东西。</p></blockquote><p id="5502" class="pw-post-body-paragraph ki kj it kk b kl nw ju kn ko nx jx kq kr ny kt ku kv nz kx ky kz oa lb lc ld im bi translated">一个例子是，有人不小心推到你的分行，或者你想扔掉你同事的零钱，用你的来代替。如果是这种情况，我仍然会获取错误的更改，恢复它们，并在最后(当合并到master时)将所有的提交挤压在一起，有效地删除错误的提交，但也避免了意外丢失某些内容的风险。</p><h1 id="5b80" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">笔记</h1><ul class=""><li id="a8dc" class="my mz it kk b kl mt ko mu kr ob kv oc kz od ld nd ne nf ng bi translated">打破快进规则的任何改变都可以实现，不需要改变基础。</li><li id="8796" class="my mz it kk b kl nh ko ni kr nj kv nk kz nl ld nd ne nf ng bi translated">人们可以打破项目的历史，破坏人们的工作，但仍然可以用<code class="fe lf lg lh li b">--force-with-lease</code>来推动。</li></ul><h1 id="a13b" class="mc ls it bd md me mf mg mh mi mj mk ml jz mm ka mn kc mo kd mp kf mq kg mr ms bi translated">最后的话</h1><p id="04b6" class="pw-post-body-paragraph ki kj it kk b kl mt ju kn ko mu jx kq kr mv kt ku kv mw kx ky kz mx lb lc ld im bi translated">在我使用git的6年中，我只使用过一次<code class="fe lf lg lh li b">--force</code>:我从回购的整个历史中删除了一个完整的目录(使它成为自己的回购，并作为子模块导入)。然后我知道我也可以用<code class="fe lf lg lh li b">--force-with-lease</code>做那个。</p><p id="f557" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要想找到做<code class="fe lf lg lh li b">force-with-lease</code>和其他git技巧的捷径，请看看我的另一篇文章“<a class="ae mb" href="https://medium.com/@aerabi/16-git-tips-and-tricks-bf08d0602d3b?source=friends_link&amp;sk=2c9f7092004461adf64bd448a8183dff" rel="noopener"> 16个Git技巧和窍门</a>”。</p></div></div>    
</body>
</html>