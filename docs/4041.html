<html>
<head>
<title>Deploy an Angular application on AWS using serverless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用无服务器在AWS上部署Angular应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/deploy-an-angular-application-on-aws-using-serverless-5e099a851e92?source=collection_archive---------0-----------------------#2020-04-15">https://itnext.io/deploy-an-angular-application-on-aws-using-serverless-5e099a851e92?source=collection_archive---------0-----------------------#2020-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="18be" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Amazon Web Services上生产就绪的无服务器Angular应用程序的快速入门</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0caa1d1dc83d816df671d8dd170b31ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cYeJl0n2VRdEQWlS"/></div></div></figure><h1 id="dbdd" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">什么是无服务器</h1><p id="9e71" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">无服务器是一个基于云的架构，允许用户编写和部署代码，而不用担心底层的基础设施。</p><p id="c7da" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">像AWS、Azure或Google Cloud这样的云提供商通过<strong class="ll ir">动态分配资源</strong>来负责执行代码，这种范式使您能够将更多的运营责任转移给提供商，让您专注于业务逻辑。</p><p id="8287" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">无服务器方法通常用于后端应用程序，但是我们也可以利用这种架构来快速部署前端应用程序。</p><h1 id="409e" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">无服务器框架</h1><p id="30d9" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated"><a class="ae mk" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>帮助您开发和<strong class="ll ir">部署您的云资源，以及它们所需的基础设施资源</strong>。这是一个CLI，它提供了现成的结构、自动化和最佳实践。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/fa01161f656ef84328bee5c63d8e39c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yfH2_dCyblq9aIAx"/></div></div></figure><p id="fae5" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">无服务器与几家云提供商合作，但在本教程中，我们将重点关注<strong class="ll ir">亚马逊网络服务</strong>。</p><h1 id="02b1" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">参考知识库</h1><p id="7ed6" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将使用的angular base项目的一个工作示例可在:<a class="ae mk" href="https://github.com/mzuccaroli/angular-serverless-starter" rel="noopener ugc nofollow" target="_blank">https://github.com/mzuccaroli/angular-serverless-starter</a>:，这是一个简单的angular项目，使用angular CLI命令“ng new”生成。欲了解更多信息，请参阅angular2项目快速入门。您可以将此项目作为项目的快速启动工具。</p><p id="90b6" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">你可以在我的公司博客上看到这篇文章的意大利语翻译:“<a class="ae mk" href="https://www.axelerant.it/blog/pubblicare-unapplicazione-angular-su-aws-usando-serverless/" rel="noopener ugc nofollow" target="_blank">public care un ' applicazione Angular su AWS usando server less</a>”也是我写的。</p><h1 id="ca08" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">最初的例子</h1><p id="9b53" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">本教程基于“<a class="ae mk" href="https://github.com/serverless/examples/tree/master/aws-node-single-page-app-via-cloudfront" rel="noopener ugc nofollow" target="_blank"> aws节点单页应用程序via cloudfront </a>”无服务器示例，我们将无服务器基础示例改编为angular应用程序。您可以克隆它用于代码参考和定制改编。</p><h1 id="474b" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">先决条件</h1><p id="6f52" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">您需要在系统中全局安装无服务器:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="e339" class="mr ks iq mn b gy ms mt l mu mv">$ npm install -g serverless</span></pre><p id="2732" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">更多信息请见:<a class="ae mk" href="https://serverless.com/framework/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">https://serverless.com/framework/docs/getting-started/</a></p><p id="8892" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您还需要一个AWS帐户，如果您没有，请查看以下链接:<a class="ae mk" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank"> <strong class="ll ir">如何创建一个AWS帐户</strong> </a>。亚马逊提供<strong class="ll ir">一年免费等级</strong>，你可以使用并充分利用。</p><p id="3843" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">如果你已经有了一个AWS账户，一定要有cloudfront、cloudformation和s3的权限。</p><h1 id="1bab" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">构建您的应用程序</h1><h2 id="f84d" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">入门指南</h2><p id="6614" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">通过键入以下命令，使用angular CLI创建一个基础angular项目(如果您还没有):</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6732" class="mr ks iq mn b gy ms mt l mu mv">$ ng new</span></pre><p id="9afc" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">按照步骤使用angular libs的最新版本搭建您的项目。</p><p id="17d3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">一旦Angular项目设置好了，您就可以定制它来处理无服务器部署。</p><h2 id="f5fa" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">添加单页应用程序插件</h2><p id="dcd4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">转到<a class="ae mk" href="https://github.com/serverless/examples/tree/master/aws-node-single-page-app-via-cloudfront" rel="noopener ugc nofollow" target="_blank">基本范例库</a>并开始复制一些有用的文件:</p><p id="c29e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我们将需要完整的<a class="ae mk" href="https://github.com/serverless/examples/tree/master/aws-node-single-page-app-via-cloudfront/serverless-single-page-app-plugin" rel="noopener ugc nofollow" target="_blank">无服务器单页应用插件</a>文件夹，将其复制到您的项目根目录，这个插件将允许您简化部署体验。部署单页面应用程序不需要理解插件。</p><p id="b449" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">通过将这个插件添加到requirements部分的package.json中，使它在您的项目中可用:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h2 id="62ac" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">安装无服务器dotenv插件</h2><p id="25e8" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这将帮助您处理项目中的各种环境和阶段</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="4f9d" class="mr ks iq mn b gy ms mt l mu mv">$ npm install serverless-dotenv-plugin</span></pre><p id="0363" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">请注意，dotenv插件需要在应用程序根文件夹中有一个git忽略的. env文件。欲了解更多信息，请查看<a class="ae mk" href="https://www.serverless.com/plugins/serverless-dotenv-plugin/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><h2 id="b5c4" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">添加serverless.yml文件</h2><p id="9a9d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">该文件是无服务器部署核心，您可以从<a class="ae mk" href="https://github.com/serverless/examples/blob/master/aws-node-single-page-app-via-cloudfront/serverless.yml" rel="noopener ugc nofollow" target="_blank">主示例</a>中复制并编辑它，或者使用参考库中的<a class="ae mk" href="https://github.com/mzuccaroli/angular-serverless-starter/blob/develop/serverless.yml" rel="noopener ugc nofollow" target="_blank">自定义文件</a></p><p id="5764" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">主要定制位于插件定制和提供者部分:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="e68c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">您将需要使用自定义的唯一名称自定义s3Bucket值，然后使用angular dist文件夹作为无服务器dist文件夹，最后使用serverless-dotenv-plugin，以便能够在多个阶段上部署。</p><h2 id="5ba7" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">自定义您的gitignore</h2><p id="2044" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">请务必添加。无服务器文件夹到您的。git通过添加以下内容忽略文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><h1 id="6ff9" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">构建和部署</h1><h2 id="21b8" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">建设</h2><p id="0ed6" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">确保您的环境已设置好，然后执行常规的角度构建过程:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="6b0e" class="mr ks iq mn b gy ms mt l mu mv">$ ng build</span></pre><p id="551c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">构建工件将被存储在<em class="nj"> dist/ </em>目录中。对生产版本使用prod标志。</p><h2 id="dd10" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">首次部署</h2><p id="6045" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">警告:每当您对serverless.yml中的CloudFront资源进行更改时，部署可能需要一段时间，例如20分钟。</p><p id="f3c1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">为了部署应用程序，您需要首先通过运行</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="eb21" class="mr ks iq mn b gy ms mt l mu mv">$ serverless deploy</span></pre><p id="2cae" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">预期的结果应该类似于:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="1aee" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在这一步之后，您的S3 bucket和CloudFront发行版就设置好了。现在你需要上传你的静态文件，也就是你的dist文件夹，到S3。你可以通过跑步做到这一点</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="d533" class="mr ks iq mn b gy ms mt l mu mv">$ serverless syncToS3</span></pre><p id="a0c4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">预期的结果应该类似于</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="044d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">现在您只需要找出部署的URL。您可以使用AWS控制台UI或运行</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="87f1" class="mr ks iq mn b gy ms mt l mu mv">$ sls domainInfo</span></pre><p id="b10e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">预期的结果应该类似于</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="a31f" class="mr ks iq mn b gy ms mt l mu mv">Serverless: Web App Domain: dyj5gf0txxyyzz.cloudfront.net</span></pre><p id="e20d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">访问打印域域查看您的应用。</p><p id="27ec" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">它会自动把你带到HTTPS。</p><h2 id="6847" class="mr ks iq bd kt mw mx dn kx my mz dp lb ls na nb ld lw nc nd lf ma ne nf lh ng bi translated">重新部署</h2><p id="12d2" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果您对您的单页面应用程序进行更改，您不需要重新部署整个堆栈，您只需要将新文件上传到s3，并使CloudFront的缓存无效，以确保新文件得到服务。</p><p id="b993" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">运行:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="136a" class="mr ks iq mn b gy ms mt l mu mv">$ serverless syncToS3</span></pre><p id="d65f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">同步您的文件，然后:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="2c48" class="mr ks iq mn b gy ms mt l mu mv">$ serverless invalidateCloudFrontCache</span></pre></div></div>    
</body>
</html>