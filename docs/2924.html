<html>
<head>
<title>Getting started with a service mesh starts with a Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用服务网格从网关开始</h1>
<blockquote>原文：<a href="https://itnext.io/getting-started-with-a-service-mesh-starts-with-a-gateway-62a470350242?source=collection_archive---------3-----------------------#2019-08-30">https://itnext.io/getting-started-with-a-service-mesh-starts-with-a-gateway-62a470350242?source=collection_archive---------3-----------------------#2019-08-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="160f" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">开始使用服务网格从网关开始</h1><p id="e3de" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">两年多来，我一直在服务网(service mesh)和T2特使代理(Envoy Proxy)上帮忙发布消息。看到社区是如何成长的，更重要的是，看到组织是如何开始使用它来解决困难的生产和运营问题的，真是令人惊讶。随着<a class="ae lj" href="https://blog.christianposta.com/moving-on-from-red-hat/" rel="noopener ugc nofollow" target="_blank">我在Red Hat的时光</a>，以及<a class="ae lj" href="https://blog.christianposta.com/career/new-adventure-starts-at-solo-io/" rel="noopener ugc nofollow" target="_blank">现在的Solo.io </a>，我很幸运地在他们的服务网格采用之旅中与组织密切合作。</p><p id="ea6e" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这次，我开发了这种方法来成功地在生产中采用服务网格:</p><ol class=""><li id="86a4" class="lp lq iq kn b ko lk ks ll kw lr la ls le lt li lu lv lw lx bi translated">深入了解最终服务网格的数据平面技术</li><li id="ef83" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">理想情况下，首先使用共享网关，以较小的流量部分运行数据平面</li><li id="ea4a" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">选择应用程序子集以启用网状(基于边车)网络</li><li id="dc92" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">缓慢地启用服务网格中能够提供最大价值的功能</li><li id="9b1b" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">冲洗并重复步骤2–4</li></ol><p id="20ab" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">我离开Red Hat加入Solo.io 的一个重要原因是我们对服务网格的<a class="ae lj" href="https://medium.com/solo-io/the-multi-mesh-vision-and-how-supergloo-will-bring-it-to-life-a89891d8815c" rel="noopener">愿景，包括这个简单的采用列表，非常一致</a>。博客的其余部分是我们目前如何使用网关和数据平面优先的方法来帮助客户采用服务网格。</p><h2 id="d0ba" class="md jo iq bd jp me mf dn jt mg mh dp jx kw mi mj kb la mk ml kf le mm mn kj mo bi translated">了解特使代理</h2><p id="0af2" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae lj" href="https://www.envoyproxy.io" rel="noopener ugc nofollow" target="_blank"> Envoy </a>已经成为许多服务网格技术的基础数据层。像<a class="ae lj" href="https://istio.io" rel="noopener ugc nofollow" target="_blank"> Istio </a>、<a class="ae lj" href="https://www.consul.io" rel="noopener ugc nofollow" target="_blank"> Consul Connect </a>、<a class="ae lj" href="https://aws.amazon.com/app-mesh/" rel="noopener ugc nofollow" target="_blank"> AWS App Mesh </a>、<a class="ae lj" href="https://deciphernow.com/grey-matter" rel="noopener ugc nofollow" target="_blank"> Grey Matter </a>(其他来自现有<a class="ae lj" href="https://medium.com/solo-io/api-gateways-are-going-through-an-identity-crisis-d1d833a313d7" rel="noopener"> API管理厂商</a>的也有可能在路上)都是基于Envoy的。</p><p id="956a" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">特使是一项极其强大、通用和复杂的技术。在过去从事消息传递基础设施的工作中，<a class="ae lj" href="https://blog.christianposta.com/activemq/from-inside-the-code-activemq-network-connectors/" rel="noopener ugc nofollow" target="_blank">有一件事一直困扰着我</a>,那就是从一个管道向另一个管道传递消息(或字节)表面上看起来很容易，但实际上比你想象的要困难得多。理解Envoy是如何工作的非常重要，包括它的各种过滤器、它收集的遥测数据以及它的配置API是如何工作的。这种理解最好通过在您的环境中操作Envoy的经验来获得。</p><p id="f428" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">理想情况下，您从单个特使部署(逻辑上是单个)开始部署您的应用程序。</p><h2 id="c137" class="md jo iq bd jp me mf dn jt mg mh dp jx kw mi mj kb la mk ml kf le mm mn kj mo bi translated">使用基于Envoy构建的网关作为垫脚石</h2><p id="43cf" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当采用服务网格时，使用Envoy作为共享网关是一个很好的起点。在我的书<a class="ae lj" href="https://www.manning.com/books/istio-in-action" rel="noopener ugc nofollow" target="_blank"> <em class="mp"> Istio in Action </em> </a>中，我在书的开头介绍了Istio <a class="ae lj" href="https://istio.io/docs/tasks/traffic-management/ingress/ingress-control/" rel="noopener ugc nofollow" target="_blank">网关资源</a>及其相关配置<a class="ae lj" href="https://livebook.manning.com/book/istio-in-action/chapter-4" rel="noopener ugc nofollow" target="_blank">，</a>，因为这是开始使用Istio的最佳方式。该网关构建在Envoy上，可以部署您的微服务，而无需被迫构建完整的网格(即，在您的所有应用程序旁边注入sidecars。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi gj"><img src="../Images/df760c9579cd6f33c442d4e6f20f3d17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IO8-MHXnOD5r8VC3vlfYrQ.png"/></div></div></figure><p id="9444" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">使用网关作为应用程序的前端意味着您既可以获得运行Envoy的操作体验，也可以获得“服务网格精简版”体验。当网关就位时，您可以获得一些强大的流量路由控制(包括基于百分比的路由、基于标头/方法的路由以及影子流量等)、TLS终止/通过、TCP控制等。</p><p id="c426" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">像Istio网关这样的简单网关可能是在开始时向您的集群提供基本流量入口的好方法，但基于Envoy构建的功能更全的API网关可能会提供更多好处。</p><h2 id="da3a" class="md jo iq bd jp me mf dn jt mg mh dp jx kw mi mj kb la mk ml kf le mm mn kj mo bi translated">建立在特使之上的更好的网关</h2><p id="3e5c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现实是，当将集群/未来服务网格之外的客户端连接到集群/服务网格内运行的那些服务时，<a class="ae lj" href="https://medium.com/solo-io/api-gateways-are-going-through-an-identity-crisis-d1d833a313d7" rel="noopener">必须考虑一个残酷的现实</a>:现有组织已经有了关于流量如何流动的假设，并且应该受到保护。</p><p id="4f96" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">例如，当通过网关将流量引入集群或新的服务网格时，我们需要解决以下问题:</p><ul class=""><li id="8823" class="lp lq iq kn b ko lk ks ll kw lr la ls le lt li nb lv lw lx bi translated">贮藏</li><li id="af74" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">尖峰停止/速率限制</li><li id="e9d0" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">最终用户/客户oauth流程</li><li id="5298" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">HMAC/消息签名</li><li id="e149" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">jwt验证(包括与现有JWT发行者或身份管理集成)</li><li id="39a3" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">网络应用防火墙(WAF)</li><li id="4d81" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">消息转换</li><li id="0ccd" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li nb lv lw lx bi translated">API编排</li></ul><p id="5e69" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">和许多其他人。换句话说，这个入口点需要比a basic Envoy网关(即Istio的网关)更强大、更有能力。它需要处理API网关中常见的熟悉的edge功能。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi gj"><img src="../Images/5106abb6a2bbb42f35ac8be1072d4dfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRjkKAJ-s1N3G6eNcrqwbA.png"/></div></div></figure><p id="c226" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">Solo.io的Gloo是一个基于代理的API网关<a class="ae lj" href="https://gloo.solo.io/introduction/" rel="noopener ugc nofollow" target="_blank"/>，它提供了两个世界的精华:</p><ol class=""><li id="4985" class="lp lq iq kn b ko lk ks ll kw lr la ls le lt li lu lv lw lx bi translated">通过简化采用单一前端网关的体验以及</li><li id="573c" class="lp lq iq kn b ko ly ks lz kw ma la mb le mc li lu lv lw lx bi translated">处理熟悉的API网关功能的能力。</li></ol><p id="b73f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">Gloo允许你<a class="ae lj" href="https://gloo.solo.io/gloo_integrations/" rel="noopener ugc nofollow" target="_blank">结合API网关和服务网格的特性</a>。Gloo与所有服务网格实现完全集成，如<a class="ae lj" href="https://gloo.solo.io/gloo_integrations/service_mesh/" rel="noopener ugc nofollow" target="_blank"> Istio、Consul、AWS App Mesh和Linkerd </a>。在指导团队实施Envoy的同时，我们已经通过这种简单的迭代方法获得了很多客户的成功。</p><figure class="mq mr ms mt gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi gj"><img src="../Images/3d5a6dff74c6b54fe70d14482b88a832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAorKexZwugvuhGeLpDa8g.png"/></div></div></figure><p id="8459" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><a class="ae lj" href="https://gloo.solo.io/introduction/whygloo/" rel="noopener ugc nofollow" target="_blank">Gloo</a>不同于<a class="ae lj" href="https://gloo.solo.io/introduction/others/" rel="noopener ugc nofollow" target="_blank">其他基于Envoy </a>构建的API网关，因为它是由一个拥有丰富的Envoy操作经验的团队构建的，是一个可扩展、灵活的控制平台，具有安全第一的思想，以及Kubernetes本地和非Kubernetes部署。</p><h2 id="7798" class="md jo iq bd jp me mf dn jt mg mh dp jx kw mi mj kb la mk ml kf le mm mn kj mo bi translated">包扎</h2><p id="16bc" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果您正在迈向服务网格，请记住这一简单、可靠且真实的采用方法。Envoy是事实上的服务网格数据平面(除了Linkerd——至少在这一点上),围绕Envoy构建您的策略是重要的第一步。如果您正在探索不是基于Envoy构建的API管理或网关L7网络技术，您可能希望再看一眼，特别是如果您正在寻找一个到服务网格的简单入口。</p></div></div>    
</body>
</html>