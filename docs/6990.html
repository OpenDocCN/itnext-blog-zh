<html>
<head>
<title>Setting up SSL certificates with Istio Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Istio网关设置SSL证书</h1>
<blockquote>原文：<a href="https://itnext.io/setting-up-ssl-certificates-with-istio-gateway-a3ac16043ea6?source=collection_archive---------3-----------------------#2022-05-09">https://itnext.io/setting-up-ssl-certificates-with-istio-gateway-a3ac16043ea6?source=collection_archive---------3-----------------------#2022-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ab2f24793fcc3c89c3c0f9380e7f80c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JVPQ_tGYQwSD-0Tr"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">照片由<a class="ae kf" href="https://unsplash.com/es/@ibidsy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克莱顿</a>在<a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="9d82" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如今SSL证书是必须的。它们通过加密帮助保护在服务器和客户端之间发送的数据，这给了你的网站更多的可信度。在这篇博文中，我将探索几种不同的方法来获得SSL证书，并配置Istio网关来使用它们。</p><p id="e6e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第一部分中，我将向您展示如何手动创建自签名证书，然后获取一个实际的SSL证书并进行设置。正如您将看到的，设置这一切并不太复杂。在以后的一篇文章中，我还会解释如何在证书自动过期之前检索和刷新它们。</p><p id="25f0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将需要一个实际的、云托管的Kubernetes集群，因为您需要一个外部IP地址来连接您的域。我已经使用Istio 1.13.3的演示配置文件安装测试了这些步骤。</p><p id="5328" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">先决条件:</p><ul class=""><li id="56c1" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">云托管的Kubernetes集群</li><li id="18fb" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://istio.io/latest/docs/setup/getting-started/" rel="noopener ugc nofollow" target="_blank"> Istio 1.13.3 </a>(如<code class="fe ls lt lu lv b">istioctl install</code>)，命名空间<code class="fe ls lt lu lv b">default</code>标记为Istio边车注射</li></ul><h1 id="364b" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">部署示例应用程序</h1><p id="6756" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">为了确保工作正常，我们将从部署一个简单的Hello World web应用程序开始。如果你有自己想要使用的应用程序/服务，请随意使用。</p><p id="d46f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来定义Kubernetes服务帐户、服务和部署:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">helloworld.yaml</figcaption></figure><p id="4abf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将上述文件保存到<code class="fe ls lt lu lv b">helloworld.yaml</code>，并使用以下命令进行部署:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="f41a" class="nj lx it lv b gy nk nl l nm nn">kubectl apply -f helloworld.yaml</span></pre><p id="952f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因为我们将在公共域上公开<code class="fe ls lt lu lv b">helloworld</code>应用程序，所以我们需要创建一个网关资源:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="0dd9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将上述内容保存到<code class="fe ls lt lu lv b">gateway.yaml</code>，并使用<code class="fe ls lt lu lv b">kubectl apply -f gateway.yaml</code>进行部署。</p></div><div class="ab cl no np hx nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="im in io ip iq"><p id="340a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">查看下面的推文，它解释了<code class="fe ls lt lu lv b">hosts</code>字段中的<code class="fe ls lt lu lv b">*</code>是什么意思，以及网关资源如何与虚拟服务相关联。</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nv ne l"/></div></figure><p id="c3ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还需要一个附加到网关资源的虚拟服务，并将流量路由到<code class="fe ls lt lu lv b">helloworld</code> Kubernetes服务:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="593d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将上述YAML保存到<code class="fe ls lt lu lv b">virtualservice.yaml</code>，并使用<code class="fe ls lt lu lv b">kubectl apply -f virtualservice.yaml</code>进行部署。</p><p id="24c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以列出VirtualService，以查看它连接到哪个网关以及它监听哪些主机:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="ece8" class="nj lx it lv b gy nk nl l nm nn">$ kubectl get vs</span><span id="622c" class="nj lx it lv b gy nw nl l nm nn">NAME       GATEWAYS            HOSTS AGE<br/>helloworld [“public-gateway”] [“*”]  106s</span></pre><p id="55d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">部署所有这些资源后，我们现在可以获得Istio入口网关的外部IP，并将其存储在<code class="fe ls lt lu lv b">GATEWAY_URL</code>环境变量中:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="e44f" class="nj lx it lv b gy nk nl l nm nn">GATEWAY_IP=$(kubectl get svc -n istio-system istio-ingressgateway -ojsonpath=’{.status.loadBalancer.ingress[0].ip}’)</span></pre><p id="472a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果在浏览器中打开<code class="fe ls lt lu lv b">GATEWAY_IP</code>，会看到类似下图的东西。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6b959f805fc2534fac0f454ad01b8318.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*Mk7eeETiENAUCW757gcJeQ.png"/></div></figure><p id="ce1b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您确实从应用程序得到了响应，但您也从浏览器得到了“不安全”的消息，这告诉用户连接不安全，不会对您的网站产生信心。</p><h1 id="3e2c" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">自签名证书和手动设置</h1><p id="b251" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">让我们从最简单的场景开始，手动获取证书。首先，选择一个您想要使用的域名，注意，要测试这个，您不必拥有域名:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="a372" class="nj lx it lv b gy nk nl l nm nn">export DOMAIN_NAME=mysuperdomain.com</span></pre><p id="095e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为第一步，您将创建根证书(<code class="fe ls lt lu lv b">$DOMAIN_NAME.crt</code>)和用于签署证书的私钥(<code class="fe ls lt lu lv b">$DOMAIN_NAME.key</code>):</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="3eb5" class="nj lx it lv b gy nk nl l nm nn">openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -subj ‘/O=$DOMAIN_NAME Inc./CN=$DOMAIN_NAME’ -keyout $DOMAIN_NAME.key -out $DOMAIN_NAME.crt</span></pre><p id="7d51" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，您需要创建私钥:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="d7de" class="nj lx it lv b gy nk nl l nm nn">openssl req -out helloworld.$DOMAIN_NAME.csr -newkey rsa:2048 -nodes -keyout helloworld.$DOMAIN_NAME.key -subj “/CN=helloworld.$DOMAIN_NAME/O=hello world from $DOMAIN_NAME”</span></pre><p id="979e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">证书是:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="2ff0" class="nj lx it lv b gy nk nl l nm nn">openssl x509 -req -days 365 -CA $DOMAIN_NAME.crt -CAkey $DOMAIN_NAME.key -set_serial 0 -in helloworld.$DOMAIN_NAME.csr -out helloworld.$DOMAIN_NAME.crt</span></pre><p id="f499" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以创建Kubernetes秘密来存储证书和密钥。我们可以随意命名这个秘密，只要我们将它放在运行它的入口网关所在的名称空间中。默认情况下，这是<code class="fe ls lt lu lv b">istio-system</code>名称空间。</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="76b4" class="nj lx it lv b gy nk nl l nm nn">$ kubectl create secret tls mysuperdomain-certs -n istio-system — key helloworld.$DOMAIN_NAME.key — cert helloworld.$DOMAIN_NAME.crt</span><span id="33b8" class="nj lx it lv b gy nw nl l nm nn">secret/mysuperdomain-certs created</span></pre><p id="ad56" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这个秘密，我们需要更新网关资源，告诉它使用这个证书:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3853" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将上述YAML保存到<code class="fe ls lt lu lv b">gateway.yaml</code>，并使用<code class="fe ls lt lu lv b">kubectl apply -f gateway.yaml</code>进行部署。我们将覆盖之前使用<code class="fe ls lt lu lv b">apply</code>命令创建的网关资源。</p><p id="574a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，我们需要更新VirtualService中的<code class="fe ls lt lu lv b">hosts</code>字段:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a2c1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">将上述YAML保存到<code class="fe ls lt lu lv b">virtualservice.yaml</code>，并使用<code class="fe ls lt lu lv b">kubectl apply -f virtualservice.yaml</code>覆盖现有的虚拟服务。</p><p id="d914" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测试这种工作方式的最简单方法是使用带有<code class="fe ls lt lu lv b">--resolve</code>标志的<code class="fe ls lt lu lv b">curl</code>。resolve标志的格式为<code class="fe ls lt lu lv b">[DOMAIN]:[PORT]:[IP]</code>，它将所有与<code class="fe ls lt lu lv b">[DOMAIN]:[PORT]</code>部分匹配的请求路由到指定的IP地址。这样，你就不需要去你的DNS/域名注册商那里进行修改就可以测试了。</p><p id="ccf4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是curl命令，您可以使用它来测试SSL证书是否得到验证和使用:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="35b2" class="nj lx it lv b gy nk nl l nm nn">curl -v — resolve helloworld.$DOMAIN_NAME:443:$GATEWAY_IP — cacert $DOMAIN_NAME.crt <a class="ae kf" href="https://helloworld.$DOMAIN_NAME" rel="noopener ugc nofollow" target="_blank">https://helloworld.$DOMAIN_NAME</a></span></pre><p id="5d32" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用上面的命令，我们告诉curl将任何对<code class="fe ls lt lu lv b">helloworld.mysuperdomain.com:443</code>的请求解析到入口网关的外部IP地址。此外，我们还提供了之前创建的CA证书的名称。</p><p id="6354" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从输出中，您将能够看到服务器证书的详细信息和一行表示证书已被验证的内容，以及来自<code class="fe ls lt lu lv b">helloworld</code> pod的实际响应:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="93fd" class="nj lx it lv b gy nk nl l nm nn">...</span><span id="d480" class="nj lx it lv b gy nw nl l nm nn">* Server certificate:<br/>*  subject: CN=helloworld.mysuperdomain.com; O=hello world from mysuperdomain.com<br/>*  start date: Nov 30 22:27:11 2019 GMT<br/>*  expire date: Nov 29 22:27:11 2020 GMT<br/>*  common name: helloworld.mysuperdomain.com (matched)<br/>*  issuer: O=mysuperdomain.com Inc.; CN=mysuperdomain.com<br/>*  SSL certificate verify ok.<br/>...</span><span id="14c2" class="nj lx it lv b gy nw nl l nm nn">&lt;link rel="stylesheet" type="text/css" href="css/style.css" /&gt;<br/>&lt;div class="container"&gt;<br/>  Hello World!<br/>* Connection #0 to host helloworld.mysuperdomain.com left intact<br/>&lt;/div&gt;* Closing connection 0</span></pre><h1 id="5110" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">使用ZeroSSL获取证书</h1><p id="2124" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">上一节中的自签名证书路线实际上只是为了试验和测试。但是，您需要由您的客户端可以信任的实际证书颁发机构签署的证书。</p><p id="cde0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有几种方法可以获得SSL证书，最流行的是<a class="ae kf" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>。我将使用<a class="ae kf" href="https://www.zerossl.com/" rel="noopener ugc nofollow" target="_blank"> ZeroSSL </a>，它使用Let's Encrypt来发布证书。如果你想花钱，你也可以从你的域名注册商或者在<a class="ae kf" href="https://digicert.com" rel="noopener ugc nofollow" target="_blank"> DigiCert </a>购买SSL证书。</p><p id="32aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一节中，我将使用一个真实的域名和实际的SSL证书——这意味着如果您想跟进，请确保您已经准备好了域名。我使用的是<a class="ae kf" href="https://name.com" rel="noopener ugc nofollow" target="_blank">Name.com</a>，但是你可以使用任何其他域名注册商。</p><p id="a793" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在您已经有了自己的域，注册并登录到<a class="ae kf" href="https://zerossl.com" rel="noopener ugc nofollow" target="_blank"> ZeroSSL </a>获取您的SSL证书:</p><ol class=""><li id="2b08" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld ny lk ll lm bi translated">点击<strong class="ki iu">新建证书</strong>按钮开始。</li><li id="c965" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld ny lk ll lm bi translated">输入域名，点击<strong class="ki iu">下一步</strong>按钮。<em class="nz">我将使用</em> <code class="fe ls lt lu lv b"><em class="nz">startcloudnative.com</em></code> <em class="nz">作为我的域名</em></li><li id="652f" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld ny lk ll lm bi translated">选择<strong class="ki iu"> 90天证书</strong>，点击<strong class="ki iu">下一步</strong>按钮。</li><li id="cc66" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld ny lk ll lm bi translated">选择<strong class="ki iu">自由</strong>选项，点击<strong class="ki iu">下一步</strong>按钮。</li></ol><p id="98ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在下载证书和密钥之前，您必须验证您拥有您申请证书的域名。有多种方法可以验证域名所有权。如果你在域名上设置了电子邮件，你可以选择电子邮件验证；否则使用DNS (CNAME)验证。</p><p id="cf24" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DNS验证将要求您登录到您注册域名的网站，并添加自定义DNS记录。完成后，点击<strong class="ki iu">下一步</strong>按钮和<strong class="ki iu">验证域</strong>按钮。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/4747cd16d55b69259dd8bf72808e846b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6wNwCYF-cEY3jdRIqDPHg.png"/></div></div></figure><h2 id="57ef" class="nj lx it bd ly ob oc dn mc od oe dp mg kr of og mk kv oh oi mo kz oj ok ms ol bi translated">设置一个名称记录</h2><p id="5d13" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">当您登录到域名注册商的网站时，请确保您添加了A记录。A记录(IP地址)会将您的域名指向Istio入口网关的外部IP地址(T2)。</p><p id="bec4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我已经申请了<code class="fe ls lt lu lv b">startcloudnative.com</code>和<code class="fe ls lt lu lv b">www.startcloudnative.com</code>的证书。我的A记录将从<code class="fe ls lt lu lv b">startcloudnative.com</code>指向IP地址(T3)。我不会像以前那样使用<code class="fe ls lt lu lv b">helloworld</code>子域。</p><p id="78f2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦颁发了证书，您就可以下载<code class="fe ls lt lu lv b">.zip</code>文件以及为您的域生成的所有文件。您可以选择多种服务器类型，但保留默认格式是我们想要的。</p><p id="3933" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">中会有三个文件。zip包:</p><ul class=""><li id="f02b" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><code class="fe ls lt lu lv b">ca_bundle.crt</code></li><li id="6b74" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><code class="fe ls lt lu lv b">certificate.crt</code></li><li id="fb4a" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><code class="fe ls lt lu lv b">private.key</code></li></ul><h2 id="3bce" class="nj lx it bd ly ob oc dn mc od oe dp mg kr of og mk kv oh oi mo kz oj ok ms ol bi translated">用真实的证书重新创建秘密</h2><p id="be29" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">让我们删除我们创建的最后一个密码，并用实际证书创建一个新密码:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="033c" class="nj lx it lv b gy nk nl l nm nn">kubectl delete mysuperdomain-certs -n istio-system</span></pre><p id="f27f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以使用从下载的包中获得的实际SSL证书和密钥重新创建它。您可以使用您的域名来命名该机密:</p><pre class="mz na nb nc gt nf lv ng nh aw ni bi"><span id="adb4" class="nj lx it lv b gy nk nl l nm nn">kubectl create secret tls startcloudnative-certs -n istio-system — key private.key — cert certificate.crt</span></pre><p id="fb2b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还必须更新网关和虚拟服务，以修改主机名并指向我们创建的新密码。</p><p id="0e34" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们首先更新网关(确保用您的实际域名替换<code class="fe ls lt lu lv b">startcloudnative.com</code>):</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="12f1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">类似地，让我们对VirtualService中的<code class="fe ls lt lu lv b">hosts</code>字段进行更改:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a099" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更新这两个资源后，您可以打开您选择的浏览器并导航到您的域。你应该看看“你好，世界！`响应和域名前的挂锁，这表明网站是安全的。如果您点击挂锁并检查证书，您将在证书中看到您的域名、根授权(让我们加密)和到期日期。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi om"><img src="../Images/44b41b64ede5ff885b6e40e8a948d05b.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*3cxxrSxOl786oDLfv8dUGA.png"/></div></figure><h2 id="f197" class="nj lx it bd ly ob oc dn mc od oe dp mg kr of og mk kv oh oi mo kz oj ok ms ol bi translated">结论</h2><p id="48c7" class="pw-post-body-paragraph kg kh it ki b kj mu kl km kn mv kp kq kr mw kt ku kv mx kx ky kz my lb lc ld im bi translated">本文解释了如何配置Istio入口网关来服务HTTPS流量。我们还介绍了如何创建自签名TLS证书，以及如何使用ZeroSSL创建一个实际的SSL证书。</p><p id="6b7a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个合乎逻辑的步骤是安装和配置<a class="ae kf" href="https://cert-manager.io/" rel="noopener ugc nofollow" target="_blank">证书管理器</a>，以便在证书自动过期之前获取和刷新它们。你可以用Ambassador检查<a class="ae kf" href="https://learncloudnative.com/blog/2020-06-24-ssl-ambassador-lets-encrypt" rel="noopener ugc nofollow" target="_blank">保护Kubernetes入口，让我们加密</a>来学习如何做到这一点。</p></div></div>    
</body>
</html>