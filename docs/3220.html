<html>
<head>
<title>Swagger/OpenAPI with NSwag and ASP.NET Core 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有NSwag和ASP.NET核心3的Swagger/OpenAPI</h1>
<blockquote>原文：<a href="https://itnext.io/swagger-openapi-with-nswag-and-asp-net-core-3-43efb2055251?source=collection_archive---------2-----------------------#2019-10-28">https://itnext.io/swagger-openapi-with-nswag-and-asp-net-core-3-43efb2055251?source=collection_archive---------2-----------------------#2019-10-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="80c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在。NET Core 3已经发布了，我认为这是一个重新审视使用Swagger/OpenAPI公开API文档的好时机。在过去，我写过关于使用<a class="ae kl" href="https://elanderson.net/2017/10/swagger-and-swashbuckle-with-asp-net-core-2/" rel="noopener ugc nofollow" target="_blank"> Swashbuckle来揭露Swagger文档</a>的帖子，但是为了这篇帖子，我打算试用<a class="ae kl" href="https://github.com/RicoSuter/NSwag" rel="noopener ugc nofollow" target="_blank"> NSwag </a>。</p><h2 id="44d3" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">什么是OpenAPI vs Swagger？</h2><p id="5a22" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">引用<a class="ae kl" href="https://swagger.io/docs/specification/about/" rel="noopener ugc nofollow" target="_blank">招摇过市的文件</a>:</p><blockquote class="lk ll lm"><p id="0026" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated"><strong class="jp ir"> OpenAPI规范</strong>(原Swagger规范)是REST APIs的API描述格式。OpenAPI文件允许你描述你的整个API。API规范可以用YAML或JSON编写。这种格式易于学习，对人和机器都可读。</p><p id="ffbe" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated"><strong class="jp ir"> Swagger </strong>是一套围绕OpenAPI规范构建的开源工具，可以帮助你设计、构建、文档化和消费REST APIs。</p></blockquote><h2 id="a3d6" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">什么是NSwag？</h2><p id="f2c1" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">引用<a class="ae kl" href="https://github.com/RicoSuter/NSwag" rel="noopener ugc nofollow" target="_blank"> NSwag GitHub自述</a>:</p><blockquote class="lk ll lm"><p id="f1c6" class="jn jo ln jp b jq jr js jt ju jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj kk ij bi translated">NSwag是Swagger/OpenAPI 2.0和3.0工具链，用于。网，。NET Core，Web API，ASP.NET Core，TypeScript (jQuery，AngularJS，Angular 2+，Aurelia，KnockoutJS等等)等平台，用C#写的。<a class="ae kl" href="https://github.com/OAI/OpenAPI-Specification" rel="noopener ugc nofollow" target="_blank"> OpenAPI/Swagger规范</a>使用JSON和JSON模式来描述RESTful web API。NSwag项目提供了从现有的ASP.NET Web API控制器生成OpenAPI规范的工具，以及从这些OpenAPI规范生成客户端代码的工具。</p></blockquote><p id="bfdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于NSwag的一个巧妙之处是，除了OpenAPI规范之外，它还有工具来帮助生成API消费者端。</p><h2 id="1f0d" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">示例项目</h2><p id="44a0" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在这篇文章中，我通过。NET CLI使用以下命令。并不是说所有这些都可以通过Visual Studio UI来完成，如果这是您的偏好。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="d38c" class="km kn iq lw b gy ma mb l mc md">dotnet new webapi</span></pre><p id="bcad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我来说，这个项目将是一个新系列文章的开始，所以我还添加了一个解决方案文件，并添加了上面创建的项目。这些命令是可选的。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="1fec" class="km kn iq lw b gy ma mb l mc md">dotnet add sln<br/>dotnet sln add src\ContactsApi\ContactsApi.csproj</span></pre><h2 id="7bac" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">添加NSwag</h2><p id="f8a3" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">在与项目文件相同的目录中使用CLI，使用以下命令添加对<strong class="jp ir"> NSwag的引用。AspNetCore </strong>到项目。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="b7df" class="km kn iq lw b gy ma mb l mc md">dotnet add package NSwag.AspNetCore</span></pre><p id="6868" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在您喜欢的编辑器中打开我们创建的项目/目录，并打开<strong class="jp ir"> Startup.cs </strong>文件。在<strong class="jp ir">配置服务</strong>功能中添加<strong class="jp ir">服务。addopenapodocculation</strong>。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="1ab8" class="km kn iq lw b gy ma mb l mc md">public void ConfigureServices(IServiceCollection services)<br/>{<br/>    services.AddControllers();<br/>    services.AddOpenApiDocument();<br/>}</span></pre><p id="babb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后在<strong class="jp ir">末尾配置</strong>功能添加对<strong class="jp ir"> app的调用。使用OpenApi </strong>和<strong class="jp ir"> app。使用swaggeri 3</strong>。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="48eb" class="km kn iq lw b gy ma mb l mc md">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)<br/>{<br/>    if (env.IsDevelopment()) app.UseDeveloperExceptionPage();<br/><br/>    app.UseHttpsRedirection();<br/>    app.UseRouting();<br/>    app.UseAuthorization();<br/><br/>    app.UseEndpoints(endpoints =&gt;<br/>    {<br/>        endpoints.MapControllers();<br/>    });<br/><br/>    app.UseOpenApi();<br/>    app.UseSwaggerUi3();<br/>}</span></pre><p id="6b59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意，NSwag也支持<a class="ae kl" href="https://github.com/Rebilly/ReDoc" rel="noopener ugc nofollow" target="_blank"> ReDoc </a>，如果你喜欢它胜过<a class="ae kl" href="https://github.com/swagger-api/swagger-ui" rel="noopener ugc nofollow" target="_blank"> Swagger UI </a>。</p><h2 id="5971" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">样本模型和控制器</h2><p id="b63c" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">现在我们已经安装了NSwag，让我们为它创建一个新的端点来显示。按照我的标准，我将以联系人为例进行说明。首先我创建了一个<strong class="jp ir">模型</strong>目录，然后在其中添加了下面的<strong class="jp ir">联系人</strong>类。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="82aa" class="km kn iq lw b gy ma mb l mc md">public class Contact<br/>{<br/>    public int Id { get; set; }<br/>    public string Name { get; set; }<br/>    public string Address { get; set; }<br/>    public string City { get; set; }<br/>    public string State { get; set; }<br/>    public string PostalCode { get; set; }<br/>    public string Phone { get; set; }<br/>    public string Email { get; set; }<br/>}</span></pre><p id="f1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，在<strong class="jp ir">控制器</strong>目录中添加一个<strong class="jp ir"> ContactsController </strong>，它在下面的代码中返回5个普通联系人的列表。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="37a6" class="km kn iq lw b gy ma mb l mc md">[ApiController]<br/>[Route("[controller]")]<br/>public class ContactsController : ControllerBase<br/>{<br/>    private readonly ILogger&lt;ContactsController&gt; _logger;<br/><br/>    public ContactsController(ILogger&lt;ContactsController&gt; logger)<br/>    {<br/>        _logger = logger;<br/>    }<br/><br/>    [HttpGet]<br/>    public IEnumerable&lt;Contact&gt; Get()<br/>    {<br/>        return Enumerable.Range(1, 5).Select(index =&gt; new Contact<br/>        {<br/>            Id = index,<br/>            Name = $"Test{index}",<br/>            Address = $"{index} Main St.",<br/>            City = "Nashville",<br/>            State = "TN",<br/>            PostalCode = "37219",<br/>            Phone = "615-555-5555",<br/>            Email = $"test{index}@test.com"<br/>        });<br/>    }<br/>}</span></pre><h2 id="f266" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">结果</h2><p id="072e" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">运行您的项目，然后在浏览器中导航到您的基本URL /swagger。例如my for my project即<a class="ae kl" href="https://localhost:5001/swagger." rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://localhost:5001/swagger</strong>。</a>你应该会看到类似下面这样的东西，这将让你探索你的API，甚至使用你在UI中看到的<strong class="jp ir">试用</strong>按钮来执行针对你的API的请求。</p><figure class="lr ls lt lu gt mf gh gi paragraph-image"><div class="gh gi me"><img src="../Images/7bba17506af10bc71dfcc332b7485598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/0*Oq5S0v1Qdl2SpY8B.png"/></div></figure><h2 id="840a" class="km kn iq bd ko kp kq dn kr ks kt dp ku jy kv kw kx kc ky kz la kg lb lc ld le bi translated">包扎</h2><p id="064e" class="pw-post-body-paragraph jn jo iq jp b jq lf js jt ju lg jw jx jy lh ka kb kc li ke kf kg lj ki kj kk ij bi translated">就像使用Swashbuckle一样，NSwag使得开始提供API文档变得非常容易。这篇文章只讲述了最基本的内容，我期待着深入了解NSwag的一些更高级的特性，比如客户端生成。</p><p id="9efb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">微软的docs网站上有一篇关于NSwag 入门的文章，我推荐阅读。这是我计划在未来介绍的一些东西的预览，但是有一些属性可以添加到控制器中，帮助NSwag提供关于API可以返回什么的更好的细节，并且微软有一个关于使用web API约定的文档，使得应用一些通用约定变得容易。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><p id="3527" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ln">原载于</em> <a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank"> <em class="ln">埃里克·安德森</em> </a> <em class="ln">。</em></p></div></div>    
</body>
</html>