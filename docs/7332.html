<html>
<head>
<title>Install and configure the ELK stack with Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Ansible安装和配置ELK堆栈</h1>
<blockquote>原文：<a href="https://itnext.io/install-and-configure-the-elk-stack-with-ansible-aa7c1494477a?source=collection_archive---------4-----------------------#2022-08-23">https://itnext.io/install-and-configure-the-elk-stack-with-ansible-aa7c1494477a?source=collection_archive---------4-----------------------#2022-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/3a93b812ada1a1576b685cd010ec8d0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*3ZsQecni48jFjBUlI1JOBw.png"/></div></figure><div class=""/><p id="a948" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这个<a class="ae ks" href="https://github.com/garutilorenzo/ansible-collection-elk" rel="noopener ugc nofollow" target="_blank">可行集合</a>将安装和配置一个高可用的<a class="ae ks" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank">弹性搜索集群</a>。</p><p id="8ed2" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用此集合，您还可以安装和配置:</p><ul class=""><li id="5701" class="kt ku ix jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" href="https://www.elastic.co/logstash/" rel="noopener ugc nofollow" target="_blank"> Logstash </a>是一个免费开放的服务器端数据处理管道，它从大量来源获取数据，对其进行转换，然后将其发送到您最喜欢的“stash”</li><li id="d011" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">Kibana是一个免费开放的用户界面，可以让你可视化你的Elasticsearch数据并浏览Elastic Stack。做任何事情，从跟踪查询负载到了解请求通过应用程序的方式</li></ul><p id="7b2e" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">还有弹性拍子:</p><ul class=""><li id="4137" class="kt ku ix jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated"><a class="ae ks" href="https://www.elastic.co/beats/filebeat" rel="noopener ugc nofollow" target="_blank"> filebeat </a> —无论您是从安全设备、云、容器、主机还是OT收集数据，filebeat都通过提供一种轻量级的方法来转发和集中日志和文件，帮助您让简单的事情变得简单。</li><li id="779e" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://www.elastic.co/beats/metricbeat" rel="noopener ugc nofollow" target="_blank">指标测试</a>从您的系统和服务中收集指标。从CPU到内存，从Redis到NGINX，等等，Metricbeat是一种发送系统和服务统计信息的轻量级方式。</li><li id="f676" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated"><a class="ae ks" href="https://www.elastic.co/beats/heartbeat" rel="noopener ugc nofollow" target="_blank"> heartbeath </a>通过主动探测监控服务的可用性。给定一个URL列表，Heartbeat会问一个简单的问题:你还活着吗？Heartbeat将这些信息和响应时间发送给弹性堆栈的其余部分，以供进一步分析。</li></ul><p id="8c11" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在大多数情况下，你可能更喜欢<a class="ae ks" href="https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-quickstart.html" rel="noopener ugc nofollow" target="_blank"> ECK </a>或<a class="ae ks" href="https://www.elastic.co/cloud/" rel="noopener ugc nofollow" target="_blank">弹性云</a>,但是如果Kubernetes对你来说就像超人的氪石，或者如果你对你的数据很好奇，或者甚至如果你不信任任何云提供商，这就是正确的地方。</p><h1 id="3def" class="lh li ix bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">流浪起来，建立测试基础设施</h1><p id="d8db" class="pw-post-body-paragraph ju jv ix jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">为了测试这个集合，我们使用了<a class="ae ks" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">流浪者</a>和<a class="ae ks" href="https://www.virtualbox.org/" rel="noopener ugc nofollow" target="_blank"> Virtualbox </a>，但是如果你喜欢，你也可以使用你自己的虚拟机或者你的裸机。</p><p id="78ae" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第一步是下载这个<a class="ae ks" href="https://github.com/garutilorenzo/ansible-collection-elk" rel="noopener ugc nofollow" target="_blank"> repo </a>并启动所有虚拟机。但是首先在这个流浪汉文件中把你的公共ssh密钥粘贴到<em class="mk"> CHANGE_ME </em>变量中。您还可以通过更改NNODES变量来调整部署的虚拟机数量(在本例中，我们将使用6个节点)。现在，我们准备好调配机器了:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="71cf" class="mu li ix mq b gy mv mw l mx my">git clone https://github.com/garutilorenzo/ansible-collection-elk.git<br/><br/>cd nsible-collection-elk/<br/><br/>vagrant up<br/>Bringing machine 'elk-ubuntu-0' up with 'virtualbox' provider...<br/>Bringing machine 'elk-ubuntu-1' up with 'virtualbox' provider...<br/>Bringing machine 'elk-ubuntu-2' up with 'virtualbox' provider...<br/>Bringing machine 'elk-ubuntu-3' up with 'virtualbox' provider...<br/>Bringing machine 'elk-ubuntu-4' up with 'virtualbox' provider...<br/>Bringing machine 'elk-ubuntu-5' up with 'virtualbox' provider...<br/><br/>[...]<br/>[...]<br/><br/>    elk-ubuntu-5: Inserting generated public key within guest...<br/>==&gt; elk-ubuntu-5: Machine booted and ready!<br/>==&gt; elk-ubuntu-5: Checking for guest additions in VM...<br/>    elk-ubuntu-5: The guest additions on this VM do not match the installed version of<br/>    elk-ubuntu-5: VirtualBox! In most cases this is fine, but in rare cases it can<br/>    elk-ubuntu-5: prevent things such as shared folders from working properly. If you see<br/>    elk-ubuntu-5: shared folder errors, please make sure the guest additions within the<br/>    elk-ubuntu-5: virtual machine match the version of VirtualBox you have installed on<br/>    elk-ubuntu-5: your host and reload your VM.<br/>    elk-ubuntu-5:<br/>    elk-ubuntu-5: Guest Additions Version: 6.0.0 r127566<br/>    elk-ubuntu-5: VirtualBox Version: 6.1<br/>==&gt; elk-ubuntu-5: Setting hostname...<br/>==&gt; elk-ubuntu-5: Configuring and enabling network interfaces...<br/>==&gt; elk-ubuntu-5: Mounting shared folders...<br/>    elk-ubuntu-5: /vagrant =&gt; C:/Users/Lorenzo Garuti/workspaces/simple-ubuntu<br/>==&gt; elk-ubuntu-5: Running provisioner: shell...<br/>    elk-ubuntu-5: Running: inline script<br/>==&gt; elk-ubuntu-5: Running provisioner: shell...<br/>    elk-ubuntu-5: Running: inline script<br/>    elk-ubuntu-5: hello from node 5</span></pre><h1 id="4aff" class="lh li ix bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">可行的设置和飞行前检查</h1><p id="155f" class="pw-post-body-paragraph ju jv ix jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">现在，如果您没有安装Ansible，请安装ansible并满足所有要求:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="9ebe" class="mu li ix mq b gy mv mw l mx my">apt-get install python3 python3-pip<br/>pip3 install pipenv<br/><br/>pipenv shell<br/>pip install -r requirements.txt</span></pre><p id="65c7" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在安装了Ansible之后，我们可以直接从GitHub下载这个集合:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c583" class="mu li ix mq b gy mv mw l mx my">ansible-galaxy collection install git+https://github.com/garutilorenzo/ansible-collection-elk</span></pre><p id="ca54" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">安装Ansible和集合后，我们可以设置库存文件(hosts.ini):</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="e709" class="mu li ix mq b gy mv mw l mx my">[elasticsearch_master]<br/>elk-ubuntu-0 ansible_host=192.168.25.110<br/>elk-ubuntu-1 ansible_host=192.168.25.111<br/>elk-ubuntu-2 ansible_host=192.168.25.112<br/><br/>[elasticsearch_data]<br/>elk-ubuntu-3 ansible_host=192.168.25.113<br/>elk-ubuntu-4 ansible_host=192.168.25.114<br/>elk-ubuntu-5 ansible_host=192.168.25.115<br/><br/>[elasticsearch_ca]<br/>elk-ubuntu-0 ansible_host=192.168.25.110<br/><br/>[kibana]<br/>elk-ubuntu-1 ansible_host=192.168.25.111<br/>elk-ubuntu-4 ansible_host=192.168.25.114<br/><br/>[logstash]<br/>elk-ubuntu-2 ansible_host=192.168.25.112<br/>elk-ubuntu-5 ansible_host=192.168.25.115<br/><br/>[elasticsearch:children]<br/>elasticsearch_master<br/>elasticsearch_data</span></pre><p id="6d55" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">和vars.yml文件:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d414" class="mu li ix mq b gy mv mw l mx my">---</span><span id="103d" class="mu li ix mq b gy mz mw l mx my">disable_firewall: yes<br/>disable_selinux: yes</span><span id="972d" class="mu li ix mq b gy mz mw l mx my">elasticsearch_version: 8.3.3<br/>kibana_version: 8.3.3<br/>logstash_version: 8.3.3<br/>beats_version: 8.3.3</span><span id="fbae" class="mu li ix mq b gy mz mw l mx my">elasticsearch_resolv_mode: hosts<br/>elasticsearch_install_mode: local<br/>elasticsearch_local_tar_path: ~/elk_tar_path<br/>elasticsearch_monitoring_enabled: yes<br/>elasticsearch_master_is_also_data_node: yes</span><span id="3bce" class="mu li ix mq b gy mz mw l mx my">kibana_install_mode: local<br/>kibana_local_tar_path: ~/elk_tar_path<br/>setup_kibana_dashboards: yes<br/>kibana_url: <a class="ae ks" href="http://elk-ubuntu-1:5601" rel="noopener ugc nofollow" target="_blank">http://elk-ubuntu-1:5601</a></span><span id="4022" class="mu li ix mq b gy mz mw l mx my">heartbeat_number_of_shards: 3<br/>heartbeat_number_of_replicas: 3</span><span id="7747" class="mu li ix mq b gy mz mw l mx my">metricbeat_number_of_shards: 3<br/>metricbeat_number_of_replicas: 3</span><span id="3bb7" class="mu li ix mq b gy mz mw l mx my">filebeat_number_of_shards: 3<br/>filebeat_number_of_replicas: 3</span><span id="3f32" class="mu li ix mq b gy mz mw l mx my">elasticsearch_hosts:<br/>  - elk-ubuntu-0 <br/>  - elk-ubuntu-1<br/>  - elk-ubuntu-2 <br/>  - elk-ubuntu-3 <br/>  - elk-ubuntu-4 <br/>  - elk-ubuntu-5</span></pre><p id="0db3" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最后一组将包括:</p><ul class=""><li id="0a97" class="kt ku ix jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">6个弹性搜索节点(主节点也是数据节点)</li><li id="7515" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">2个基巴纳实例</li><li id="531c" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">2个logstash实例</li></ul><p id="a229" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">并且:</p><ul class=""><li id="e0b7" class="kt ku ix jw b jx jy kb kc kf kv kj kw kn kx kr ky kz la lb bi translated">所有虚拟机都将受到弹性节拍的监控</li><li id="c7e7" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">所有的索引模板都有3个碎片和3个副本</li><li id="c0d1" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">由于我们没有任何可用的DNS，Ansible将在/etc/hosts文件中插入所有的节点名</li><li id="e02e" class="kt ku ix jw b jx lc kb ld kf le kj lf kn lg kr ky kz la lb bi translated">防火墙和selinux将被禁用</li></ul><p id="5c55" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了节省带宽，我们将elasticsearch和kibana下载到我们的Ansible机器上:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ba80" class="mu li ix mq b gy mv mw l mx my">mkdir -p ~/elk_tar_path # &lt;- you can customize this path by changing elasticsearch_local_tar_path variable<br/>curl  -o ~/elk_tar_path/kibana-8.3.3-linux-x86_64.tar.gz https://artifacts.elastic.co/downloads/kibana/kibana-8.3.3-linux-x86_64.tar.gz<br/>curl  -o ~/elk_tar_path/elk_tar_path/elasticsearch-8.3.3-linux-x86_64.tar.gz https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.3.3-linux-x86_64.tar.gz</span></pre><p id="584c" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们必须创建证书目录，弹性证书将存储在该目录中:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="68a3" class="mu li ix mq b gy mv mw l mx my">mkdir -p ~/very_secure_dir # &lt;- you can customize this path by changing elasticsearch_local_certs_dir variable</span></pre><p id="9e66" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">继续安装前的最后一步是创建site.yml文件:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="0116" class="mu li ix mq b gy mv mw l mx my">---<br/>- hosts: elasticsearch <br/>  become: yes<br/>  remote_user: vagrant<br/>  collections:<br/>    - garutilorenzo.ansible_collection_elk<br/>  vars_files:<br/>    - vars.yml</span><span id="1d3d" class="mu li ix mq b gy mz mw l mx my">tasks:<br/>    - import_role:<br/>        name: elasticsearch</span><span id="709f" class="mu li ix mq b gy mz mw l mx my">- hosts: kibana <br/>  become: yes<br/>  remote_user: vagrant<br/>  collections:<br/>    - garutilorenzo.ansible_collection_elk<br/>  vars_files:<br/>    - vars.yml</span><span id="d247" class="mu li ix mq b gy mz mw l mx my">tasks:<br/>    - import_role:<br/>        name: kibana</span><span id="4a56" class="mu li ix mq b gy mz mw l mx my">- hosts: logstash <br/>  become: yes<br/>  remote_user: vagrant<br/>  collections:<br/>    - garutilorenzo.ansible_collection_elk<br/>  vars_files:<br/>    - vars.yml</span><span id="53a8" class="mu li ix mq b gy mz mw l mx my">tasks:<br/>    - import_role:<br/>        name: logstash</span><span id="3691" class="mu li ix mq b gy mz mw l mx my">- hosts: elasticsearch <br/>  become: yes<br/>  remote_user: vagrant<br/>  collections:<br/>    - garutilorenzo.ansible_collection_elk<br/>  vars_files:<br/>    - vars.yml</span><span id="afc5" class="mu li ix mq b gy mz mw l mx my">tasks:<br/>    - import_role:<br/>        name: beats</span></pre><h1 id="4d5d" class="lh li ix bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">用Ansible部署ELK</h1><p id="5c61" class="pw-post-body-paragraph ju jv ix jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">我们终于准备好用ansible安装ELK堆栈了，因为我们没有任何CA证书，我们将一个额外的变量<em class="mk"> generateca </em>传递给我们的剧本:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="cb98" class="mu li ix mq b gy mv mw l mx my">export ANSIBLE_HOST_KEY_CHECKING=False # Ansible skip ssh-key validation<br/>ansible-playbook site.yml -i hosts.ini -e "generateca=yes"</span><span id="a141" class="mu li ix mq b gy mz mw l mx my">ansible-playbook site.yml -i hosts.ini</span><span id="79a2" class="mu li ix mq b gy mz mw l mx my">PLAY [elasticsearch] ***************************************************************************************************************************************</span><span id="ca28" class="mu li ix mq b gy mz mw l mx my">TASK [Gathering Facts] *************************************************************************************************************************************<br/>ok: [elk-ubuntu-0]<br/>ok: [elk-ubuntu-1]<br/>ok: [elk-ubuntu-2]<br/>ok: [elk-ubuntu-3]<br/>ok: [elk-ubuntu-4]<br/>ok: [elk-ubuntu-5]</span><span id="f607" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : setup] ******************************************************************************************<br/>ok: [elk-ubuntu-2]<br/>ok: [elk-ubuntu-0]<br/>ok: [elk-ubuntu-3]<br/>ok: [elk-ubuntu-1]<br/>ok: [elk-ubuntu-4]<br/>ok: [elk-ubuntu-5]</span><span id="e86f" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : include_tasks] **********************************************************************************<br/>included: /home/lorenzo/workspaces-local/ansible-test-collection/elk/collections/ansible_collections/garutilorenzo/ansible_collection_elk/roles/elasticsearch/tasks/preflight.yml for elk-ubuntu-0, elk-ubuntu-1, elk-ubuntu-2, elk-ubuntu-3, elk-ubuntu-4, elk-ubuntu-5</span><span id="dd4d" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : Put SELinux in permissive mode, logging actions that would be blocked.] *************************<br/>skipping: [elk-ubuntu-0]<br/>skipping: [elk-ubuntu-1]<br/>skipping: [elk-ubuntu-2]<br/>skipping: [elk-ubuntu-3]<br/>skipping: [elk-ubuntu-4]<br/>skipping: [elk-ubuntu-5]</span><span id="e7bb" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : Disable SELinux] ********************************************************************************<br/>skipping: [elk-ubuntu-0]<br/>skipping: [elk-ubuntu-1]<br/>skipping: [elk-ubuntu-2]<br/>skipping: [elk-ubuntu-3]<br/>skipping: [elk-ubuntu-4]<br/>skipping: [elk-ubuntu-5]</span><span id="7126" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : disable firewalld] ******************************************************************************<br/>skipping: [elk-ubuntu-0]<br/>skipping: [elk-ubuntu-1]<br/>skipping: [elk-ubuntu-2]<br/>skipping: [elk-ubuntu-3]<br/>skipping: [elk-ubuntu-4]<br/>skipping: [elk-ubuntu-5]</span><span id="f901" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.elasticsearch : disable ufw] ************************************************************************************<br/>changed: [elk-ubuntu-3]<br/>changed: [elk-ubuntu-0]<br/>changed: [elk-ubuntu-2]<br/>changed: [elk-ubuntu-4]<br/>changed: [elk-ubuntu-1]<br/>changed: [elk-ubuntu-5]</span><span id="27b8" class="mu li ix mq b gy mz mw l mx my">[...]<br/>[...]</span></pre><p id="2070" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这可能需要一段时间，但是如果一切顺利，最终可能的输出将是:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="23ee" class="mu li ix mq b gy mv mw l mx my">[...]<br/>[...]</span><span id="425d" class="mu li ix mq b gy mz mw l mx my">TASK [garutilorenzo.ansible_collection_elk.beats : enable and start heartbeat] *****************************************************************************<br/>changed: [elk-ubuntu-0]<br/>changed: [elk-ubuntu-1]<br/>changed: [elk-ubuntu-3]<br/>changed: [elk-ubuntu-4]<br/>changed: [elk-ubuntu-5]<br/>changed: [elk-ubuntu-2]</span><span id="90d9" class="mu li ix mq b gy mz mw l mx my">RUNNING HANDLER [garutilorenzo.ansible_collection_elk.beats : reload systemd] ******************************************************************************<br/>ok: [elk-ubuntu-4]<br/>ok: [elk-ubuntu-0]<br/>ok: [elk-ubuntu-3]<br/>ok: [elk-ubuntu-1]<br/>ok: [elk-ubuntu-2]<br/>ok: [elk-ubuntu-5]</span><span id="e636" class="mu li ix mq b gy mz mw l mx my">RUNNING HANDLER [garutilorenzo.ansible_collection_elk.beats : reload filebeat] *****************************************************************************<br/>changed: [elk-ubuntu-0]<br/>changed: [elk-ubuntu-4]<br/>changed: [elk-ubuntu-1]<br/>changed: [elk-ubuntu-2]<br/>changed: [elk-ubuntu-5]<br/>changed: [elk-ubuntu-3]</span><span id="5fbb" class="mu li ix mq b gy mz mw l mx my">RUNNING HANDLER [garutilorenzo.ansible_collection_elk.beats : reload heartbeat] ****************************************************************************<br/>changed: [elk-ubuntu-2]<br/>changed: [elk-ubuntu-1]<br/>changed: [elk-ubuntu-0]<br/>changed: [elk-ubuntu-3]<br/>changed: [elk-ubuntu-4]<br/>changed: [elk-ubuntu-5]</span><span id="cd42" class="mu li ix mq b gy mz mw l mx my">RUNNING HANDLER [garutilorenzo.ansible_collection_elk.beats : reload metricbeat] ***************************************************************************<br/>changed: [elk-ubuntu-1]<br/>changed: [elk-ubuntu-4]<br/>changed: [elk-ubuntu-0]<br/>changed: [elk-ubuntu-3]<br/>changed: [elk-ubuntu-5]<br/>changed: [elk-ubuntu-2]</span><span id="9cf4" class="mu li ix mq b gy mz mw l mx my">PLAY RECAP *************************************************************************************************************************************************<br/>elk-ubuntu-0               : ok=119  changed=61   unreachable=0    failed=0    skipped=12   rescued=0    ignored=1   <br/>elk-ubuntu-1               : ok=135  changed=68   unreachable=0    failed=0    skipped=15   rescued=0    ignored=1   <br/>elk-ubuntu-2               : ok=136  changed=72   unreachable=0    failed=0    skipped=14   rescued=0    ignored=1   <br/>elk-ubuntu-3               : ok=114  changed=58   unreachable=0    failed=0    skipped=12   rescued=0    ignored=1   <br/>elk-ubuntu-4               : ok=135  changed=68   unreachable=0    failed=0    skipped=15   rescued=0    ignored=1   <br/>elk-ubuntu-5               : ok=136  changed=72   unreachable=0    failed=0    skipped=14   rescued=0    ignored=1</span></pre><p id="8eaa" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们使用Kibana来分析我们的弹性搜索数据:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/8899b76a66935545936c7a05db9cff28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*_ioUjPKJbmx9blia1qgUfA.png"/></div></figure><p id="c05d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">密码是默认的引导密码<em class="mk"> changeme </em>。你可以在elasticsearch角色中自定义这个变量，你要修改<em class="mk">elastic search _ bootstrap _ password</em>变量。<strong class="jw iy">记住</strong>在vars.yml文件中设置相同的值格式<em class="mk"> elasticsearch_password </em>和<em class="mk">elastic search _ bootstrap _ password</em>。</p><p id="2dcd" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这是默认的Kibana仪表板:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/891598b15ed115215388d5afed4651ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OKWE9GG454FnS7aewgS-Q.png"/></div></div></figure><p id="a34a" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在我们可以<em class="mk">发现</em>我们在分析中的数据- &gt;发现:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ng"><img src="../Images/d52abb111ea97c1b8e654ad7a740f594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*drJi3fSf6PKtGB9UqyaKsQ.png"/></div></div></figure><p id="e94d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在这里，我们可以使用KQL语法过滤我们的数据，或者使用许多Kibana特性中的一个。</p><p id="7816" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们还可以使用各种Beats提供的众多仪表板中的一个来检查我们的数据(分析-&gt;仪表板)。例如，我们可以检查metricbeat系统仪表板:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nb"><img src="../Images/891598b15ed115215388d5afed4651ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OKWE9GG454FnS7aewgS-Q.png"/></div></div></figure><p id="e646" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在管理-&gt;堆栈管理-&gt;索引管理中，我们可以看到所有的索引。我们必须启用<em class="mk">Include hidden indexes</em>，因为在我们全新的集群中，所有索引都是隐藏的(filebeat、heartbeat、metricbeat)</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nh"><img src="../Images/95602ced51cca50881b7ee9d668bd9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V_qfsepwREhc_kIjYL0x7A.png"/></div></div></figure><p id="1f11" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在管理-&gt;堆栈监控中，我们可以启用<em class="mk">自我监控</em>功能:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ni"><img src="../Images/b605e335d7e514d748dbf19f5e5c9b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JktthoZosWPK6WkUxCx9HQ.png"/></div></div></figure><p id="188f" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">现在，我们可以检查集群状态:</p><figure class="ml mm mn mo gt is gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nj"><img src="../Images/e5cacda997629ce6cbd63b56fda7231a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nORScH785SMFPkvPv2aozQ.png"/></div></div></figure><p id="3f3d" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这只是对ELK Stack的一个简短介绍，你可以在<a class="ae ks" href="https://www.elastic.co/guide/index.html" rel="noopener ugc nofollow" target="_blank"> Elastic Docs </a>上阅读更多内容。为了获得最佳形式的麋鹿栈阅读也<a class="ae ks" href="https://www.elastic.co/observability" rel="noopener ugc nofollow" target="_blank">弹性可观性</a>。</p><h1 id="39e7" class="lh li ix bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">打扫</h1><p id="bbbc" class="pw-post-body-paragraph ju jv ix jw b jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr ij bi translated">完成后，您最终可以使用以下命令销毁集群:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d15b" class="mu li ix mq b gy mv mw l mx my">vagrant destroy<br/>    elk-ubuntu-5: Are you sure you want to destroy the 'elk-ubuntu-5' VM? [y/N] y<br/>==&gt; elk-ubuntu-5: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-5: Destroying VM and associated drives...<br/>    elk-ubuntu-4: Are you sure you want to destroy the 'elk-ubuntu-4' VM? [y/N] y<br/>==&gt; elk-ubuntu-4: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-4: Destroying VM and associated drives...<br/>    elk-ubuntu-3: Are you sure you want to destroy the 'elk-ubuntu-3' VM? [y/N] y<br/>==&gt; elk-ubuntu-3: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-3: Destroying VM and associated drives...<br/>    elk-ubuntu-2: Are you sure you want to destroy the 'elk-ubuntu-2' VM? [y/N] y<br/>==&gt; elk-ubuntu-2: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-2: Destroying VM and associated drives...<br/>    elk-ubuntu-1: Are you sure you want to destroy the 'elk-ubuntu-1' VM? [y/N] y<br/>==&gt; elk-ubuntu-1: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-1: Destroying VM and associated drives...<br/>    elk-ubuntu-0: Are you sure you want to destroy the 'elk-ubuntu-0' VM? [y/N] y<br/>==&gt; elk-ubuntu-0: Forcing shutdown of VM...<br/>==&gt; elk-ubuntu-0: Destroying VM and associated drives...</span></pre></div></div>    
</body>
</html>