<html>
<head>
<title>System Logger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">系统日志器</h1>
<blockquote>原文：<a href="https://itnext.io/system-logger-d4ce82f687a3?source=collection_archive---------1-----------------------#2022-02-13">https://itnext.io/system-logger-d4ce82f687a3?source=collection_archive---------1-----------------------#2022-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b4652744106f60a9458256aa9ea0f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IuZA7hYgw86nIgwDhJPZMw.jpeg"/></div></div></figure><p id="41a2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">12月对Java开发人员来说不是一个好时机，对Ops来说更是如此。前者必须用一个固定的Log4J版本重新打包他们的应用程序，而后者必须重新部署它们——好几次。然而，每片乌云都有一线光明。以我为例，我了解了<code class="fe kw kx ky kz b">System.Logger</code>。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi la"><img src="../Images/f860c786de0c26489b53d9a5e9f9531d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GtXTKelOTGBpMC4uktVXGw.png"/></div></div></figure><p id="010a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">简而言之，<code class="fe kw kx ky kz b">System.Logger</code>是您的日志引擎的一个外观。比方说，不使用SFL4J的API和想要的实现，而是使用<code class="fe kw kx ky kz b">System.Logger</code>而不是SLF4J。它从Java 9开始就有了，我只是最近才知道这一点，真是令人失望。</p><h1 id="d4e5" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">系统。记录器API</h1><p id="66dd" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">该API与其他日志记录API略有不同:它避免了不同的日志记录方法，如<code class="fe kw kx ky kz b">debug()</code>、<code class="fe kw kx ky kz b">info()</code>，而是支持传递日志记录<code class="fe kw kx ky kz b">Level</code>参数的单个<code class="fe kw kx ky kz b">log()</code>方法。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/809680cb3f9c24f56a03badd9265d683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llCaZ9XcDFsjHPPiX1n-Hw.png"/></div></div></figure><p id="52a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有在类路径上提供任何相应的实现，<code class="fe kw kx ky kz b">System.Logger</code>默认为JUL。</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="2a3e" class="mn lg iq kz b gy mo mp l mq mr">public class LoggerExample {</span><span id="6c21" class="mn lg iq kz b gy ms mp l mq mr">  private static final System.Logger LOGGER = System.getLogger("c.f.b.DefaultLogger"); // 1</span><span id="9b36" class="mn lg iq kz b gy ms mp l mq mr">  public static void main(String[] args) {<br/>      LOGGER.log(DEBUG, "A debug message");<br/>      LOGGER.log(INFO, "Hello world!");<br/>  }<br/>}</span></pre><ol class=""><li id="58cf" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">去找伐木工</li></ol><p id="9aa4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行上面的代码片段会输出以下内容:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="c09c" class="mn lg iq kz b gy mo mp l mq mr">Dec 24, 2021 10:38:15 AM c.f.b.DefaultLogger main<br/>INFO: Hello world!</span></pre><h1 id="2cdc" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">兼容实现</h1><p id="5a50" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">目前大多数应用程序使用<a class="ae nc" href="https://logging.apache.org/log4j/2.x/" rel="noopener ugc nofollow" target="_blank"> Log4J2 </a>或<a class="ae nc" href="https://www.slf4j.org/" rel="noopener ugc nofollow" target="_blank"> SLF4J </a>。两者都提供了兼容的<code class="fe kw kx ky kz b">System.Logger</code>实现。</p><p id="2247" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Log4J，我们需要添加两个依赖项:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="aa83" class="mn lg iq kz b gy mo mp l mq mr">&lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;<br/>        &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;            &lt;!-- 1 --&gt;<br/>        &lt;version&gt;2.17.0&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>        &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;    &lt;!-- 2 --&gt;<br/>        &lt;artifactId&gt;log4j-jpl&lt;/artifactId&gt;<br/>        &lt;version&gt;2.17.0&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><ol class=""><li id="2427" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">Log4J实现</li><li id="b349" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv my mz na nb bi translated">从<code class="fe kw kx ky kz b">System.Logger</code>到Log4J的桥接</li></ol><p id="4482" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与上面相同的日志记录片段现在输出以下内容:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="edf9" class="mn lg iq kz b gy mo mp l mq mr">11:00:07.373 [main] INFO  c.f.b.DefaultLogger - Hello world!</span></pre><p id="37d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要改用SLF4J，请使用以下依赖项:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="ea02" class="mn lg iq kz b gy mo mp l mq mr">&lt;dependencies&gt;<br/>  &lt;dependency&gt;<br/>    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;               &lt;!-- 1 --&gt;<br/>    &lt;version&gt;2.0.0-alpha5&lt;/version&gt;<br/>  &lt;/dependency&gt;<br/>  &lt;dependency&gt;<br/>    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;slf4j-jdk-platform-logging&lt;/artifactId&gt; &lt;!-- 2 --&gt;<br/>    &lt;version&gt;2.0.0-alpha5&lt;/version&gt;<br/>  &lt;/dependency&gt;<br/>&lt;/dependencies&gt;</span></pre><ol class=""><li id="a2d8" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">基本SLF4J实现。任何其他实现都可以，<em class="ni">例如</em>回退</li><li id="65e3" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv my mz na nb bi translated">从<code class="fe kw kx ky kz b">System.Logger</code>到Log4J的桥</li></ol><p id="5802" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">代码片段输出:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="187e" class="mn lg iq kz b gy mo mp l mq mr">[main] INFO c.f.b.DefaultLogger - Hello world!</span></pre><h1 id="dd42" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">您自己的<code class="fe kw kx ky kz b">System.Logger</code>实现</h1><p id="70f9" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated"><code class="fe kw kx ky kz b">System.Logger</code>依赖于Java的<a class="ae nc" href="https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html" rel="noopener ugc nofollow" target="_blank"> ServiceLoader </a>机制。<code class="fe kw kx ky kz b">log4j-jpl</code>和<code class="fe kw kx ky kz b">slf4j-jdk-platform-logging</code>都包含一个指向<code class="fe kw kx ky kz b">LoggerFinder</code>实现的<code class="fe kw kx ky kz b">META-INF/services/java.lang.System$LoggerFinder</code>文件。</p><figure class="lb lc ld le gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/c39f4a771b043c62a49d92288d0ca543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_92gkkTJoGFC-8FDldC7w.png"/></div></div></figure><p id="a062" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以基于<code class="fe kw kx ky kz b">System.out</code>创建自己的用于教育目的。第一步是实现记录器本身。</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="cfa5" class="mn lg iq kz b gy mo mp l mq mr">public class ConsoleLogger implements System.Logger {</span><span id="1180" class="mn lg iq kz b gy ms mp l mq mr">    private final String name;</span><span id="865b" class="mn lg iq kz b gy ms mp l mq mr">    public ConsoleLogger(String name) {<br/>        this.name = name;<br/>    }</span><span id="959e" class="mn lg iq kz b gy ms mp l mq mr">    @Override<br/>    public String getName() {<br/>        return name;<br/>    }</span><span id="7e36" class="mn lg iq kz b gy ms mp l mq mr">    @Override<br/>    public boolean isLoggable(Level level) {<br/>        return level.getSeverity() &gt;= Level.INFO.getSeverity();<br/>    }</span><span id="4cd1" class="mn lg iq kz b gy ms mp l mq mr">    @Override<br/>    public void log(Level level, ResourceBundle bundle, String msg, Throwable thrown) {<br/>        if (isLoggable(level)) {<br/>            System.out.println(msg);<br/>            thrown.printStackTrace();<br/>        }<br/>    }</span><span id="f4f8" class="mn lg iq kz b gy ms mp l mq mr">    @Override<br/>    public void log(Level level, ResourceBundle bundle, String format, Object... params) {<br/>        if (isLoggable(level)) {<br/>            System.out.println(MessageFormat.format(format, params));<br/>        }<br/>    }<br/>}</span></pre><p id="9723" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们需要对<code class="fe kw kx ky kz b">System.LoggerFinder</code>进行编码:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="bae2" class="mn lg iq kz b gy mo mp l mq mr">public class ConsoleLoggerFinder extends System.LoggerFinder {</span><span id="0f97" class="mn lg iq kz b gy ms mp l mq mr">    private static final Map&lt;String, ConsoleLogger&gt; LOGGERS = new HashMap&lt;&gt;(); // 1</span><span id="cf36" class="mn lg iq kz b gy ms mp l mq mr">    @Override<br/>    public System.Logger getLogger(String name, Module module) {<br/>        return LOGGERS.computeIfAbsent(name, ConsoleLogger::new);              // 2<br/>    }<br/>}</span></pre><ol class=""><li id="484e" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv my mz na nb bi translated">保留一份所有现有伐木工的地图</li><li id="d91d" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv my mz na nb bi translated">如果记录器不存在，创建一个并存储它</li></ol><p id="0aeb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们创建一个服务文件:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="7cb8" class="mn lg iq kz b gy mo mp l mq mr">ch.frankel.blog.ConsoleLoggerFinder</span></pre><p id="5a01" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，运行相同的代码片段输出:</p><pre class="lb lc ld le gt mj kz mk ml aw mm bi"><span id="280c" class="mn lg iq kz b gy mo mp l mq mr">Hello world!</span></pre><h1 id="d9cb" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="e94f" class="pw-post-body-paragraph jy jz iq ka b kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv ij bi translated">虽然这个API比其他更成熟的日志API更有限，但是<code class="fe kw kx ky kz b">System.Logger</code>是一个很好的主意。它的正面是JDK的一部分。因此，它避免了使用需要将调用连接到另一个不相关的实现的第三方外观，<em class="ni">，例如</em> SLF4J到Log4J2。</p><p id="24ed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">出于这个原因，我想我会尝试一下<code class="fe kw kx ky kz b">System.Logger</code>，哪怕只是为了获得一些实践经验。</p><p id="5955" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章的完整源代码可以在Maven格式的<a class="ae nc" href="https://github.com/ajavageek/system-logger" rel="noopener ugc nofollow" target="_blank">那里</a>找到。</p><p id="048c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更进一步:</strong></p><ul class=""><li id="9635" class="mt mu iq ka b kb kc kf kg kj mv kn mw kr mx kv nk mz na nb bi translated"><a class="ae nc" href="https://openjdk.java.net/jeps/264" rel="noopener ugc nofollow" target="_blank"> JEP 264:平台日志API和服务</a></li><li id="0ae2" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv nk mz na nb bi translated"><a class="ae nc" href="https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html" rel="noopener ugc nofollow" target="_blank">类服务加载器</a></li><li id="74a0" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv nk mz na nb bi translated"><a class="ae nc" href="https://blog.frankel.ch/simplest-java-decoupling-without-3rd-party-frameworks/" rel="noopener ugc nofollow" target="_blank">没有第三方框架的最简单的Java解耦</a></li><li id="77da" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv nk mz na nb bi translated"><a class="ae nc" href="https://blog.frankel.ch/migrating-serviceloader-java-9-module-system/" rel="noopener ugc nofollow" target="_blank">将ServiceLoader迁移到Java 9模块系统</a></li><li id="1088" class="mt mu iq ka b kb nd kf ne kj nf kn ng kr nh kv nk mz na nb bi translated"><a class="ae nc" href="https://blog.frankel.ch/java-service-loader-vs-spring-factories/" rel="noopener ugc nofollow" target="_blank"> Java服务加载器vs Spring工厂加载器</a></li></ul></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="b71c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="ni">原载于</em> <a class="ae nc" href="https://blog.frankel.ch/system-logger/" rel="noopener ugc nofollow" target="_blank"> <em class="ni">一个Java怪胎</em></a><em class="ni">2022年2月13日</em></p></div></div>    
</body>
</html>