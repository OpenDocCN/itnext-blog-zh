<html>
<head>
<title>Android MessagingStyle Notification As Clear As Possible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android消息样式通知尽可能清晰</h1>
<blockquote>原文：<a href="https://itnext.io/android-messagingstyle-notification-as-clear-as-possible-1847f809ad59?source=collection_archive---------3-----------------------#2020-05-07">https://itnext.io/android-messagingstyle-notification-as-clear-as-possible-1847f809ad59?source=collection_archive---------3-----------------------#2020-05-07</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="3e33" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">如果我有错误，欢迎你指出来。谢谢你😉</h2></div><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/f821140d72f487a23757bf485b46122f.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*2C-YjEUW0K_gRECg.gif"/></div></figure><p id="f9fa" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi ln translated"><span class="l lo lp lq bm lr ls lt lu lv di">我</span>相信你每天都在使用消息应用与你的朋友、爱人和家人交流。Android为我们提供了一种用户友好的通知风格，以一种更加优雅和有用的方式来显示消息通知。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj ma"><img src="../Images/c18f87f9329b907cf381da5fa61e59a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z021DB_71H9aLPywjSq0Kg.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">MessagingStyle的解剖；通知操作在通知时设置。改为构建器</figcaption></figure><p id="6f4f" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">开发人员可以设置对话标题，并将相关消息分组到单个通知中。甚至还有一个<code class="fe lw lx ly lz b">RemoteInput</code>供用户输入消息，直接回复消息发送者，无需启动app。</p><p id="e157" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">在本文中，我将介绍实现消息样式通知的所有步骤，并逐一讨论属性。希望你会觉得这有趣和有用。开始吧！</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="ec11" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">概观</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj ni"><img src="../Images/c263e7c1b24b45cb0fef4fcb55b57ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gSXCuBRu33jUWCFO.jpg"/></div></div></figure><ol class=""><li id="42a0" class="nj nk iu kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/Person" rel="noopener ugc nofollow" target="_blank">人</a>物<br/>它代表消息的发送者或接收者(用户本人)。</li><li id="9bbf" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/Notification.MessagingStyle.Message" rel="noopener ugc nofollow" target="_blank">消息</a>对象<br/>它可以包含文本消息，也可以包含图像消息，并且必须绑定一个<code class="fe lw lx ly lz b">Person</code>。来自同一发送者的连续消息被组合成一个主块。</li><li id="4e49" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/Notification.MessagingStyle" rel="noopener ugc nofollow" target="_blank"> MessagingStyle </a>对象<br/>设置对话标题和消息列表。消息列表可以包含正常消息和历史消息。</li><li id="f0e5" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/RemoteInput" rel="noopener ugc nofollow" target="_blank"> RemoteInput </a> object <br/>它是一个用户友好的小部件，包含一个列表<code class="fe lw lx ly lz b">Choice</code>和一个<code class="fe lw lx ly lz b">EditText</code>，用户可以在不启动应用程序的情况下快速回复发件人。</li></ol></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="c700" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">第1部分)人对象</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj ny"><img src="../Images/43de9c7cfc04d6d4fcbcd803d9f029bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0MM1QkXy9JE576R_YIAfQ.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">人员属性</figcaption></figure><p id="164d" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">Person</code>是一个表示消息发送者详细信息的类，包括他/她的id，显示名称&amp;图标(缩略图)。每个<code class="fe lw lx ly lz b">Message</code>对象(将在下一节介绍)必须绑定一个<code class="fe lw lx ly lz b">Person</code>对象。具有相同<code class="fe lw lx ly lz b">Person</code>(由<code class="fe lw lx ly lz b">id</code>字段标识)的连续<code class="fe lw lx ly lz b">Message</code>对象被组合成一个显示文本块。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><h2 id="36f0" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">属性1)键</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj on"><img src="../Images/582ff829efe002692d297cc3ccb768de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AzKZCx6ZQNF5Rz0uROdISg.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">密钥生成代码</figcaption></figure><p id="1d46" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">key</code>是用于区分每个消息发送者的<code class="fe lw lx ly lz b">String</code>标识符。来自同一邮件发件人的具有相同<code class="fe lw lx ly lz b">key</code>的连续邮件被合并。</p><p id="3bb3" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">我们可以使用<code class="fe lw lx ly lz b">Math.random()</code>为每个发送者生成一个密钥。这个代码输出一个16位十进制数。碰撞的可能性是0.0000000000001，这在正常使用情况下是可以接受的。</p><blockquote class="oo op oq"><p id="4c90" class="kr ks or kt b ku kv jv kw kx ky jy kz os lb lc ld ot lf lg lh ou lj lk ll lm in bi translated"><strong class="kt iv">重要提示</strong> : <br/>由于Android会默认使用<code class="fe lw lx ly lz b">name</code>字段作为<code class="fe lw lx ly lz b">key</code>，因此未设置<code class="fe lw lx ly lz b">key</code>时会导致严重问题。<code class="fe lw lx ly lz b">name</code>难道<strong class="kt iv">不</strong>就一定唯一！<br/>参考:<a class="ae ns" href="https://developer.android.com/reference/android/app/Person.Builder#setKey(java.lang.String)" rel="noopener ugc nofollow" target="_blank">人。建造商官方文件</a></p></blockquote><h2 id="b5cc" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">物业2)名称</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj ov"><img src="../Images/b182f59e16059a928147ab386323734f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YeMgNeZKFy8xqyP-XAAe1w.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">在发件人姓名上使用SpannableString的图示</figcaption></figure><p id="3153" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">name</code>是显示的发送者姓名的字符串。第5行的<code class="fe lw lx ly lz b">setName()</code>接受<code class="fe lw lx ly lz b">CharSequence</code>作为参数。换句话说，发件人的显示名称可以通过<code class="fe lw lx ly lz b">SpannableString</code>使用<code class="fe lw lx ly lz b">Spans</code>进行样式化。</p><p id="07c1" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">为了更容易地使用<code class="fe lw lx ly lz b">SpannableString</code>，欢迎您使用<code class="fe lw lx ly lz b"><a class="ae ns" href="https://github.com/myrickchow32/MCSpannableStringExtension" rel="noopener ugc nofollow" target="_blank">MCSpannableStringExtension</a></code>，它可以通过使用Kotlin扩展功能来简化沸腾板代码。有关示例实现，请参见第8–10行。</p><h2 id="421f" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">属性3) <code class="fe lw lx ly lz b">Icon</code></h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj ow"><img src="../Images/99fa669c23905ddf04a18d4885beb91e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_At4O02Wjdh_iJJLFG5D-A.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">自定义图标和生成的图标取决于显示名称的第一个字符</figcaption></figure><p id="bcbe" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">Icon</code>代表消息发送者的缩略图。它是一个刻度类型为<code class="fe lw lx ly lz b">center</code>的正方形<code class="fe lw lx ly lz b">ImageView</code>。开发者可以通过<code class="fe lw lx ly lz b">setIcon(icon: Icon)</code>给每个人设置一个自定义的<code class="fe lw lx ly lz b">Icon</code>，具体实现见第13行。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ox"><img src="../Images/48778538efefb82b69dc0ea31b300083.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*21uFCd3Dk_dM2vx4Iy2YEQ.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">系统默认的用户名图标以英文、中文和符号字符开头</figcaption></figure><p id="5f33" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">Icon</code>是一个可选字段。系统根据用户名的第一个字符生成一组默认图标。根据上面的截图，它支持多种语言。</p><p id="5ea2" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">然而，默认图标的背景颜色是<strong class="kt iv">而不是</strong>在代码级别可定制的，范围从浅灰色到黑色。为了给用户提供良好的UX，建议<strong class="kt iv">使用自定义图标</strong>。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="edcd" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">第2部分)消息</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj oy"><img src="../Images/e731673ffcfe481bd7c253c8948752c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yuzuc3Nkf-Pah5AzKB6iRg.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">像素3处的图像和文本消息的屏幕截图(API 29)</figcaption></figure><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="0a5d" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">构造一个文本<code class="fe lw lx ly lz b">Message</code>对象非常简单，见第10行。它需要以下三个参数:</p><ol class=""><li id="6f05" class="nj nk iu kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated">短信内容— <code class="fe lw lx ly lz b">CharSequence</code>支持<code class="fe lw lx ly lz b">SpannableString</code></li><li id="e2be" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">消息到达时间— <code class="fe lw lx ly lz b">Long</code></li><li id="28c4" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">发送者详细信息— <code class="fe lw lx ly lz b">Person</code>，这在上一节中已经介绍过了</li></ol><p id="f3dd" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">从<a class="ae ns" href="https://developer.android.com/about/versions/pie/android-9.0#enhanced_messaging_experience" rel="noopener ugc nofollow" target="_blank"> Android 9 </a> (API 28)开始，通过<code class="fe lw lx ly lz b">setData()</code>函数设置数据，通知支持同时显示<strong class="kt iv">文本</strong>和<strong class="kt iv">图片</strong>消息，详见第11–18行。然而，文本和图像数据不能同时显示在一个<code class="fe lw lx ly lz b">Message</code>对象中。换句话说，当设置图像数据时，<strong class="kt iv">文本内容被忽略。</strong></p><p id="df78" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">因此，要实现上述文本和图像的演示消息通知，必须独立创建两个<code class="fe lw lx ly lz b">Message</code>实例，如下所示:</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="02da" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">第3部分)设置消息样式</h1><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="3347" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">第三步是给通知样式分配一个<code class="fe lw lx ly lz b">MessagingStyle</code>对象。共有4个功能用于设置属性:</p><ol class=""><li id="3f0d" class="nj nk iu kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated"><strong class="kt iv">添加消息(消息:消息)</strong></li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj oz"><img src="../Images/b81f4a0f761e59db1f6a5335299c9797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7nTGDogmwTOV2j1RWbVLVw.png"/></div></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">在运行API 29的Pixel 3中，只能同时显示4条消息</figcaption></figure><p id="d252" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">可以通过<code class="fe lw lx ly lz b">addMessage()</code>直接添加消息，但是显示消息的顺序基于在<code class="fe lw lx ly lz b">Message</code>对象中定义的消息到达时间，详见最后一节“第2部分)消息”。</p><p id="ba67" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">此外，由于每个系统通知的空间有限(最大高度:256dp ),旧消息可能会被隐藏，以便为新消息释放空间。</p><p id="3f2d" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">2.<strong class="kt iv">添加历史消息(消息:消息)</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pa"><img src="../Images/dbca70cb90ee6334bf95ed3c941578d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*g6S6ZwqEv22ef_aX.gif"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">历史消息仅在选择远程输入时显示</figcaption></figure><p id="5b4c" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">通知中通常不会显示历史消息。这是一条特殊的消息，仅在用户通过<code class="fe lw lx ly lz b">RemoteInput</code>回复时显示，(由于步骤复杂，将在下一节“高级主题—远程输入的4个步骤”中讨论)) .仅当消息不是通知的主要主题，但可能为对话提供上下文时，才应使用此选项。</p><p id="4e3e" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">3.<strong class="kt iv"> setConversationTitle(标题:字符序列)</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pb"><img src="../Images/40697b3f896a1dda13af56ca0dc7bbf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*ttZX-WU7i61SAK0XyLyAww.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">对话标题</figcaption></figure><p id="6425" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">Conversation只是一个简单的对话通知显示字符串。可以通过<code class="fe lw lx ly lz b">SpannableString</code>和<code class="fe lw lx ly lz b"><a class="ae ns" href="https://github.com/myrickchow32/MCSpannableStringExtension" rel="noopener ugc nofollow" target="_blank">MCSpannableStringExtension</a></code>用<code class="fe lw lx ly lz b">Spans</code>进行样式化。</p><p id="1948" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">4.<strong class="kt iv">setgroup conversation(isGroupConversation:Boolean)</strong></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pc"><img src="../Images/916755a7f5bb92968ebce45c0a7ab0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*JTw7tt4WCvqjnM3Rpk887g.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">大图标仅在通话组通知中显示</figcaption></figure><p id="fdf8" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">设置此对话通知是否代表一个组。如果应用程序的目标是Android P (API 29)，如果应用程序想要显示大图标，这是必需的。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="4866" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">第4部分)5步远程输入</h1><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/5d447a58ae2c1b8084042e9c468c888a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*oKpG1rx14vRU11lPxSlbgQ.gif"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">运行于Android 28的三星Galaxy Tab S6截图</figcaption></figure><p id="2974" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b"><a class="ae ns" href="https://developer.android.com/reference/android/app/RemoteInput" rel="noopener ugc nofollow" target="_blank">RemoteInput</a></code>是定义用户输入方法的对象。有两个选项:</p><ol class=""><li id="fa0f" class="nj nk iu kt b ku kv kx ky la nl le nm li nn lm no np nq nr bi translated"><code class="fe lw lx ly lz b">Choice</code>列表—选择任何预定义的消息，例如是&amp;否</li><li id="29c9" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><code class="fe lw lx ly lz b">EditText</code> —输入任意<code class="fe lw lx ly lz b">String</code></li></ol><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pe"><img src="../Images/1f0dd40768c0d5580838df9d9061c558.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*DLnHwbOpmioVj5bYzSNtiQ.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">2个回复选项输入回复—选择和编辑文本</figcaption></figure><p id="2aaa" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><strong class="kt iv">步骤1)定义一个</strong> <code class="fe lw lx ly lz b"><strong class="kt iv">RemoteInput</strong></code></p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="f7c0" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">RemoteInput</code>以构建器模式构建。<code class="fe lw lx ly lz b">RemoteInput.Builder</code>构造函数的<code class="fe lw lx ly lz b">Key</code>参数(第2行)是检索用户输入的文本或返回的<code class="fe lw lx ly lz b">Intent</code>中的选择的关键。有关更多详细信息，请参见步骤5)。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pf"><img src="../Images/ed1079ccbbe6e5ed1b1c9e0dd42a9647.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*uB6rq-TP9jMcDOW37qqE6w.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">在展开状态下重放标签</figcaption></figure><p id="945c" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">在第3行，<code class="fe lw lx ly lz b">setLabel(label: CharSequence)</code>用于设置点击回复动作按钮时<code class="fe lw lx ly lz b">EditText</code>的占位符。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pf"><img src="../Images/5e644451286cfed470d64d85fc96967e.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*-QZPUHsHXJ2BEAPCIw1-Wg.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">选择列表</figcaption></figure><p id="5112" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">在第4行，<code class="fe lw lx ly lz b">setChoices(choices: Array&lt;CharSequence&gt;)</code>用来定义列表的选择标题。选项仅显示在一行中。由于空间有限，有些选项在没有空间显示时会被隐藏，例如“选项4”和“选项5”在纵向模式下隐藏，但在横向模式下显示。</p><p id="7ac4" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">因此，我们应该限制每个选项的数量和标题长度，以防止被系统裁剪。</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gi gj pg"><img src="../Images/e7c2a3276facd0baa249722735c31382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RAwWhhz6kb13qUrgukdsYw.png"/></div></div></figure><h2 id="d6dd" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">步骤2)定义一个<code class="fe lw lx ly lz b">PendingIntent</code>用于发回用户选择的选项</h2><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="3e54" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">当用户在<code class="fe lw lx ly lz b">RemoteInput</code>选择一个选项或提交一条文本消息时，这个<code class="fe lw lx ly lz b">PendingIntent</code>被触发。在第3行，我们声明了一个<code class="fe lw lx ly lz b">Receiver</code>来处理用户动作，因此在第6行使用<code class="fe lw lx ly lz b">PendingIntent.getBroadcast()</code>构造函数来构造一个<code class="fe lw lx ly lz b">PendingIntent</code>对象。</p><blockquote class="oo op oq"><p id="60b4" class="kr ks or kt b ku kv jv kw kx ky jy kz os lb lc ld ot lf lg lh ou lj lk ll lm in bi translated">这里有几个<code class="fe lw lx ly lz b">PendingIntent</code>中的构造函数，我们不应该混淆它们:<br/> <code class="fe lw lx ly lz b">PendingIntent.getBroadcast()</code>在<code class="fe lw lx ly lz b">Receiver</code>被触发时使用。<br/> <code class="fe lw lx ly lz b">PendingIntent.getActivity()</code>在<code class="fe lw lx ly lz b">Activity</code>被触发时使用。<br/> <code class="fe lw lx ly lz b">PendingIntent.getService()</code>在<code class="fe lw lx ly lz b">Service</code>被触发时使用。</p><p id="5b70" class="kr ks or kt b ku kv jv kw kx ky jy kz os lb lc ld ot lf lg lh ou lj lk ll lm in bi translated">参考:<a class="ae ns" href="https://developer.android.com/reference/android/app/PendingIntent" rel="noopener ugc nofollow" target="_blank">待定正式文档</a></p></blockquote></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><p id="a3ac" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><strong class="kt iv">步骤3)定义一个</strong> <code class="fe lw lx ly lz b"><strong class="kt iv">BroadcastReceiver</strong></code></p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="34ae" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">BroadcastReceiver</code>可以接收系统<code class="fe lw lx ly lz b">Intent</code>即使app被杀，对消息类app也有好处。最好在<code class="fe lw lx ly lz b">AndroidManifest</code>声明，而不是在运行时注册。</p><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="4224" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">在<code class="fe lw lx ly lz b">BroadcastReceiver</code>的<code class="fe lw lx ly lz b">onReceived</code>回调中，主要功能是检索用户输入并通过<code class="fe lw lx ly lz b">recoveredNotificationBuilder</code>更新通知。</p><p id="31c8" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">在第9–10行，用户输入的文本(选项标题或提交的文本)用步骤1中在<code class="fe lw lx ly lz b">RemoteInput</code>构造函数中设置的关键字检索，通知id用步骤2中在PendingIntent中设置的一个检索。</p><p id="4474" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">第13–19行显示了通过通知id过滤通知和通过<code class="fe lw lx ly lz b">Notification</code>对象检索原始<code class="fe lw lx ly lz b">Notification.Builder</code>的步骤。</p><p id="f884" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">第21–23行显示了根据检索到的用户输入添加新的<code class="fe lw lx ly lz b">Message</code>的步骤。可以从<code class="fe lw lx ly lz b">MessagingStyle</code>对象中检索用户<code class="fe lw lx ly lz b">Person</code>对象。不需要从原始数据中重建它。</p><p id="5363" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">最后，可以通过在第27行用原始通知id和更新的<code class="fe lw lx ly lz b">Notification</code>对象通知<code class="fe lw lx ly lz b">NotificationManager</code>来更新通知。</p></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h2 id="d4c3" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">步骤4)定义通知操作</h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pf"><img src="../Images/e45dab93b12ea6ce4db991339d7d7fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*FGPtdCPy5dppHqjpD2OlqQ.png"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">通知操作按钮</figcaption></figure><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="8849" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated"><code class="fe lw lx ly lz b">Notification.Action</code>定义上面高亮显示的动作按钮的细节。第3行需要一个图标、一个标题和一个<code class="fe lw lx ly lz b">PendingIntent</code>来构造一个<code class="fe lw lx ly lz b">Notification.Action.Builder</code>，我们在第1步定义的<code class="fe lw lx ly lz b">RemoteInput</code>被添加到第4行的<code class="fe lw lx ly lz b">Notification.Action</code>中。</p><p id="0221" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">但是，您是否注意到操作按钮附近没有显示图标？根据谷歌的<a class="ae ns" href="https://android-developers.googleblog.com/2016/06/notifications-in-android-n.html" rel="noopener ugc nofollow" target="_blank"> <em class="or"> Ian Lake(开发者倡导者)</em>的博客，图标将不会显示，以便给更多的空间来显示更多的动作。</a></p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj ph"><img src="../Images/29bd191140c71c038e8771be330a7ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*3JHsf4QP3EPn7N3VWEZafg.png"/></div></figure><h2 id="954b" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">步骤5)将通知活动附加至通知生成器</h2><figure class="kk kl km kn gu ko"><div class="bz fq l di"><div class="nz oa l"/></div></figure><p id="e295" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">最后一步只是简单地将<code class="fe lw lx ly lz b">Notification.Action</code>加到<code class="fe lw lx ly lz b">Notification.Builder</code>上。运行代码后，您会得到以下行为:</p><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/5d447a58ae2c1b8084042e9c468c888a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*oKpG1rx14vRU11lPxSlbgQ.gif"/></div><figcaption class="mf mg gk gi gj mh mi bd b be z dk translated">运行于Android 28的三星Galaxy Tab S6截图</figcaption></figure></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="8cae" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">摘要</h1><ol class=""><li id="7681" class="nj nk iu kt b ku pi kx pj la pk le pl li pm lm no np nq nr bi translated">应该实现MessagingStyle来为用户提供更好的UI和UX。</li><li id="16df" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">请记住，必须在<code class="fe lw lx ly lz b">Person</code>对象中设置唯一的<code class="fe lw lx ly lz b">key</code>，以防止与其他发送者混淆。</li><li id="4e9d" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">每个<code class="fe lw lx ly lz b">Message</code>可以显示文本信息或图像信息。来自同一发件人的连续消息被合并成一个大块。</li><li id="7848" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">默认通知高度为256dp，一些旧消息无法显示。</li><li id="84e7" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><code class="fe lw lx ly lz b">RemoteInput</code>是<code class="fe lw lx ly lz b">MessagingStyle</code>通知中最有用的工具。它提供了一个可选的<code class="fe lw lx ly lz b">Choice</code>列表和一个<code class="fe lw lx ly lz b">EditText</code>供用户在不打开应用程序的情况下回复。</li><li id="922e" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated">必须正确选择<code class="fe lw lx ly lz b">PendingIntent</code>的构造器。<code class="fe lw lx ly lz b">PendingIntent</code>构造函数与目标<code class="fe lw lx ly lz b">Intent</code>不匹配将不会产生任何结果。</li></ol></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="5b61" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">通知相关的媒体发布</h1><h2 id="7911" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated"><strong class="ak"> 1。安卓通知一体机</strong></h2><div class="pn po gq gs pp pq"><a rel="noopener  ugc nofollow" target="_blank" href="/android-notification-all-in-one-8df3e1218e0e"><div class="pr ab fp"><div class="ps ab pt cl cj pu"><h2 class="bd iv gz z fq pv fs ft pw fv fx it bi translated">安卓通知一体机</h2><div class="px l"><h3 class="bd b gz z fq pv fs ft pw fv fx dk translated">在21世纪，通知已经成为每个人日常生活的一部分。作为一个Android开发者，最好多了解一些…</h3></div><div class="py l"><p class="bd b dl z fq pv fs ft pw fv fx dk translated">itnext.io</p></div></div><div class="pz l"><div class="qa l qb qc qd pz qe kp pq"/></div></div></a></div><h2 id="4b16" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated"><strong class="ak"> 2。自定义通知</strong></h2><div class="pn po gq gs pp pq"><a rel="noopener  ugc nofollow" target="_blank" href="/android-custom-notification-in-6-mins-c2e7e2ddadab"><div class="pr ab fp"><div class="ps ab pt cl cj pu"><h2 class="bd iv gz z fq pv fs ft pw fv fx it bi translated">Android自定义通知在6分钟内完成</h2><div class="px l"><h3 class="bd b gz z fq pv fs ft pw fv fx dk translated">定制通知可以包含比默认通知样式提供的更多奇特的小部件。让我们点击…</h3></div><div class="py l"><p class="bd b dl z fq pv fs ft pw fv fx dk translated">itnext.io</p></div></div><div class="pz l"><div class="qf l qb qc qd pz qe kp pq"/></div></div></a></div><h2 id="351d" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">3.<strong class="ak"> NotificationChannel完整解释</strong></h2><div class="pn po gq gs pp pq"><a rel="noopener  ugc nofollow" target="_blank" href="/android-notification-channel-as-deep-as-possible-1a5b08538c87"><div class="pr ab fp"><div class="ps ab pt cl cj pu"><h2 class="bd iv gz z fq pv fs ft pw fv fx it bi translated">尽可能深入的Android通知通道</h2><div class="px l"><h3 class="bd b gz z fq pv fs ft pw fv fx dk translated">自从……以来，通知通道已经成为向通知抽屉发送通知对象的必要部分</h3></div><div class="py l"><p class="bd b dl z fq pv fs ft pw fv fx dk translated">itnext.io</p></div></div><div class="pz l"><div class="qg l qb qc qd pz qe kp pq"/></div></div></a></div><h2 id="c767" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated"><strong class="ak"> 4。</strong><a class="ae ns" rel="noopener ugc nofollow" target="_blank" href="/android-notification-bigtextstyle-bd35f7530eae">T3【BigTextSytle】通知T5】</a></h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj kj"><img src="../Images/fa97340365774cd046d81a131ae0152b.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*1Z66YnAQTmJvWuNo.gif"/></div></figure><h2 id="13ec" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">5.<a class="ae ns" rel="noopener ugc nofollow" target="_blank" href="/android-notification-bigpicturestyle-1f293e6cabaf"><strong class="ak">BigPictureStyleNotification</strong></a></h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj qh"><img src="../Images/7de0015fc0ee333aa58a0772b93349ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*0P5mw51hC2_7-oxW.gif"/></div></figure><h2 id="bca2" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">6.<a class="ae ns" rel="noopener ugc nofollow" target="_blank" href="/android-inboxstyle-notification-as-deep-as-possible-4d74c0c725f1"><strong class="ak">inbox style notification</strong></a></h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pa"><img src="../Images/55a57bc519c12269031839e4a0ebb8e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*0BlS8sKlVrGIjTFP.gif"/></div></figure><h2 id="333c" class="ob mr iu bd ms oc od dn mw oe of dp na la og oh nc le oi oj ne li ok ol ng om bi translated">7.<a class="ae ns" rel="noopener ugc nofollow" target="_blank" href="/android-notification-styling-cc6b0bb86021"> <strong class="ak">安卓通知样式</strong> </a></h2><figure class="kk kl km kn gu ko gi gj paragraph-image"><div class="gi gj pd"><img src="../Images/c00fbe61d646e5e7b6ad20609a54e98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*H4KpPpmubxy_DELK.png"/></div></figure></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><h1 id="c1ce" class="mq mr iu bd ms mt mu mv mw mx my mz na ka nb kb nc kd nd ke ne kg nf kh ng nh bi translated">阅读和参考资料:</h1><ol class=""><li id="8139" class="nj nk iu kt b ku pi kx pj la pk le pl li pm lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/Person.Builder#setKey(java.lang.String)" rel="noopener ugc nofollow" target="_blank">安卓个人官方文档</a></li><li id="d12b" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/Notification.MessagingStyle" rel="noopener ugc nofollow" target="_blank"> Android MessagingStyle官方文档</a></li><li id="52a0" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/reference/android/app/RemoteInput" rel="noopener ugc nofollow" target="_blank"> Android RemoteInput官方文档</a></li><li id="9cb5" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://android-developers.googleblog.com/2016/06/notifications-in-android-n.html" rel="noopener ugc nofollow" target="_blank"> Ian Lake(开发者倡导者)关于通知的博客文章</a></li><li id="a9f8" class="nj nk iu kt b ku nt kx nu la nv le nw li nx lm no np nq nr bi translated"><a class="ae ns" href="https://developer.android.com/about/versions/pie/android-9.0#enhanced_messaging_experience" rel="noopener ugc nofollow" target="_blank"> Android 9消息传递增强</a></li></ol></div><div class="ab cl mj mk hy ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="in io ip iq ir"><p id="d28c" class="pw-post-body-paragraph kr ks iu kt b ku kv jv kw kx ky jy kz la lb lc ld le lf lg lh li lj lk ll lm in bi translated">欢迎您在<a class="ae ns" href="https://twitter.com/myrick_chow" rel="noopener ugc nofollow" target="_blank">Twitter @ my rik _ chow</a>关注我，了解更多信息和文章。感谢您阅读这篇文章。祝您愉快！😄</p></div></div>    
</body>
</html>