<html>
<head>
<title>How to build a SoundCloud-like audio player app with VueJS, Quasar and WaveSurfer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用VueJS、Quasar和WaveSurfer构建类似SoundCloud的音频播放器应用程序</h1>
<blockquote>原文：<a href="https://itnext.io/how-to-build-a-soundcloud-like-audio-player-app-with-vuejs-quasar-and-wavesurfer-316431c174d4?source=collection_archive---------2-----------------------#2019-07-27">https://itnext.io/how-to-build-a-soundcloud-like-audio-player-app-with-vuejs-quasar-and-wavesurfer-316431c174d4?source=collection_archive---------2-----------------------#2019-07-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b55c2167be336308836bf8e3ed8bb80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KVjWqVly4zQjQGh7.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">最终结果</figcaption></figure><p id="d2b6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将使用Quasar和WaveSurfer来构建一个类似SoundCloud的跨平台移动音频播放器应用程序。我们将使用html文件输入从设备加载本地音频文件，呈现波形并添加控件来播放音频。</p><h1 id="a816" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">类星体？</h1><p id="4b34" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">Quasar是一个基于Vue.js构建的UI框架。它似乎比Vuetify更面向移动，并且也有一个优秀的CLI，非常适合生成Cordova应用程序。您可以通过开箱即用的热重新加载在实际设备上进行调试。这是高效开发过程的关键部分，也是我选择框架/栈的决定性因素之一。</p><p id="519e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">更多让我想尝试一下的地方:</p><ul class=""><li id="e5cf" class="md me iq ke b kf kg kj kk kn mf kr mg kv mh kz mi mj mk ml bi translated">充满活力的社区(11K GitHub stars)</li><li id="7841" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">伟大的CLI</li><li id="c6f9" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">漂亮的UI组件和内置的网格系统(我喜欢尽可能少写CSS)</li><li id="5ae2" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">使用你了解并喜爱的Vue生态系统</li></ul><h1 id="1d9e" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">脚手架</h1><blockquote class="mr ms mt"><p id="eaf8" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated"><em class="iq">我假设你已经有了一个配置了android studio / xcode的Cordova设置。只需跟随</em> <a class="ae my" href="https://quasar.dev/quasar-cli/developing-cordova-apps/preparation" rel="noopener ugc nofollow" target="_blank"> <em class="iq">类星体的教程</em> </a></p></blockquote><p id="2a3a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们从安装Quasar CLI开始。从您的工作区终端运行:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="dbed" class="ni lb iq ne b gy nj nk l nl nm">npm install -g @quasar/cli</span></pre><p id="b506" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后创建一个项目:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="f635" class="ni lb iq ne b gy nj nk l nl nm">quasar create quasar-wavesurfer-audio-player</span></pre><p id="7bb4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">插入以下答案:</p><ul class=""><li id="8d7e" class="md me iq ke b kf kg kj kk kn mf kr mg kv mh kz mi mj mk ml bi translated">项目名称:默认</li><li id="a738" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">项目产品名称:更改为“酷玩”</li><li id="2ea7" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">项目描述:一个使用quasar和wavesurfer的类似soundcloud的音频播放器</li><li id="a960" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">作者:你</li><li id="1447" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">功能:我们不需要任何功能</li><li id="3c5a" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">Cordova id:保持原样，除非您想要发布到商店</li></ul><p id="8ac8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Quasar CLI将安装所需的软件包。完成后，进入文件夹，运行<code class="fe nn no np ne b">quasar dev</code>查看基本布局:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="0096" class="ni lb iq ne b gy nj nk l nl nm">cd quasar-wavesurfer-audio-player quasar dev</span></pre><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9fd677ffc56b45ad5f92e25f61682406.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/0*IeVHYQ3L8HilwuqT.png"/></div></figure><blockquote class="mr ms mt"><p id="562e" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated"><em class="iq">一个工作版本！这是初始化git repo并进行第一次提交的好时机。</em></p></blockquote><h1 id="ad6c" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">添加科尔多瓦模式</h1><p id="b2d9" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">现在，我们有一个类星体应用程序运行在温泉模式。为了把它变成一个我们可以发布到应用商店的移动应用，我们需要添加Quasar的<code class="fe nn no np ne b">cordova mode</code>:</p><p id="68a8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个Quasar CLI命令添加了一个<code class="fe nn no np ne b">src-cordova</code>文件夹，包含我们的Cordova项目。在这个文件夹中，我们可以运行任何Cordova CLI命令。Quasar将构建我们的Vue代码，并将资产放在<code class="fe nn no np ne b">src-cordova/www</code>文件夹中。</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/b73284e61d76c6ec5836147cb23dad43.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/0*iWbSSIrJ8DAHQK-5.png"/></div></figure><p id="25f7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们将检查它是否在我们的设备上运行。这应该尽可能早地完成，作为检查设置是否工作的健全性检查。我将使用android来实现这一点，但它在iOS上也同样适用。</p><p id="3d81" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">确保您的设备通过USB连接，并运行:</p><blockquote class="mr ms mt"><p id="ffe2" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated"><em class="iq">注意:较新的chrome版本默认阻止明文流量，所以Cordova的内部WebView会抛出一个</em> <code class="fe nn no np ne b"><em class="iq">ERR_CLEARTEXT_NOT_PERMITTED</em></code> <em class="iq">错误。要解决这个问题，取消</em> <code class="fe nn no np ne b"><em class="iq">quasar.conf.js</em></code>中 <code class="fe nn no np ne b"><em class="iq">devServer</em></code>下<em class="iq">段的</em> <code class="fe nn no np ne b"><em class="iq">https: true,</em></code> <em class="iq">注释</em></p><p id="21b5" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated"><em class="iq">注2:如果你正在为iOS构建，建议使用</em> <a class="ae my" href="https://quasar.dev/quasar-cli/developing-cordova-apps/preparation" rel="noopener ugc nofollow" target="_blank"> <em class="iq">此处</em> </a>描述的方法之一从废弃的ui webview(Cordova默认使用的)升级到WKWebView</p></blockquote><p id="72e8" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在，CLI会询问您使用哪个IP。选择可从您的移动设备访问的IP(它们必须在同一个网络上)。Quasar将创建一个Cordova应用程序，从这个IP的内部WebView加载，从而使我们能够在我们的设备上开发热重装。这是高效开发过程的一个重要特征。</p><p id="c69e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将继续使用<code class="fe nn no np ne b">quasar dev</code>进行开发，同时定期在实际设备上进行测试，看看是否一切正常。</p><blockquote class="mr ms mt"><p id="b82e" class="kc kd mu ke b kf kg kh ki kj kk kl km mv ko kp kq mw ks kt ku mx kw kx ky kz ij bi translated"><em class="iq">如果你正在开发一个想在android </em>和iOS<em class="iq">上运行的应用，我建议定期在这两个平台上运行它。它们永远不会相同。</em></p></blockquote><h1 id="c21c" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">类星体项目结构</h1><p id="a923" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">现在让我们来看看CLI为我们创建的项目结构，以便快速了解Quasar。Quasar CLI在<code class="fe nn no np ne b">layouts</code>文件夹中搭建一个默认布局<code class="fe nn no np ne b">MyLayout.vue</code>的文件夹结构。布局是一个Vue组件，拥有所有的Quasar UI元素，包括导航抽屉、工具栏和主页。你可以发现以<code class="fe nn no np ne b">q-</code>开头的类星体成分，例如<code class="fe nn no np ne b">q-layout</code>、<code class="fe nn no np ne b">q-toolbar</code>等。这些都是Quasar团队写的Vue组件(类似于Vuetify的<code class="fe nn no np ne b">v-</code>组件)。</p><p id="6e55" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了使用Quasar UI组件，您需要显式地将它们包含在<code class="fe nn no np ne b">quasar.conf.js</code>中，我们将在后面看到。<br/>主页面包含在<code class="fe nn no np ne b">MyLayout.vue</code>中的<code class="fe nn no np ne b">&lt;q-page-container&gt;</code>元素内，其中包含了一个<code class="fe nn no np ne b">&lt;router-view /&gt;</code>——同样是你所知道和喜爱的<code class="fe nn no np ne b">vue-router</code>。路线保存在<code class="fe nn no np ne b">pages</code>文件夹中。</p><p id="8021" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">默认加载的主页面是在<code class="fe nn no np ne b">pages</code>文件夹下的<code class="fe nn no np ne b">Index.vue</code>，所以我们将在这里添加我们的代码。</p><h1 id="67f7" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">添加wavesurfer.js</h1><p id="b951" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">WaveSurfer 是一个开源音频播放器，可以将音频波渲染到html5画布上。我们来补充一下:</p><p id="835b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们将把WaveSurfer导入到<code class="fe nn no np ne b">Index.vue</code>中，添加一个<code class="fe nn no np ne b">wavesurfer</code>数据成员，以及一个方法<code class="fe nn no np ne b">createWaveSurfer</code>，当组件被挂载时，该方法将初始化它。<code class="fe nn no np ne b">wavesurfer</code>对象需要一个<code class="fe nn no np ne b">container</code>，这是它将在其中呈现的html元素的ID。因此，我们还将向组件的模板添加一个容器div。我们将加载一个演示mp3文件，只是为了在这个阶段进行测试。这是<code class="fe nn no np ne b">Index.vue</code>现在的样子:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="071e" class="ni lb iq ne b gy nj nk l nl nm">&lt;template&gt;<br/>  &lt;div id="waveform"&gt;&lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import WaveSurfer from "wavesurfer.js";<br/><br/>export default {<br/>  name: 'PageIndex',<br/>  data: () =&gt; ({<br/>    wavesurfer: null,<br/>  }),<br/>  async mounted() {<br/>    if (!this.wavesurfer) this.createWaveSurfer();<br/>  },<br/>  methods: {<br/>    createWaveSurfer() {<br/>      this.wavesurfer = WaveSurfer.create({<br/>        container: "#waveform",<br/>        barWidth: 3<br/>      });<br/>      this.wavesurfer.load(<br/>        "https://ia902606.us.archive.org/35/items/shortpoetry_047_librivox/song_cjrg_teasdale_64kb.mp3"<br/>      );<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="01a9" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用<code class="fe nn no np ne b">quasar dev</code>运行时，您应该会看到呈现的波形:</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/0234cb6576eb4a9c49f709c692e53471.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/0*wsr5FdgnnF5529Jl.png"/></div></figure><h1 id="d478" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">加载本地音频文件</h1><p id="7bbe" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我们将使用html的<code class="fe nn no np ne b">&lt;input type="file"&gt;</code>从本地设备加载文件。让我们在工具栏上添加一个文件加载按钮。在<code class="fe nn no np ne b">MyLayout.vue</code>中，用一个<code class="fe nn no np ne b">q-btn</code>组件替换<code class="fe nn no np ne b">&lt;div&gt;Quasar v{{ $q.version }}&lt;/div&gt;</code>:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="1622" class="ni lb iq ne b gy nj nk l nl nm">&lt;q-btn color="white" text-color="primary"&gt;<br/>Load File<br/>&lt;input<br/>    type="file"<br/>    class="q-uploader__input overflow-hidden absolute-full"<br/>    v-on:change="fileChosen"<br/>    ref="fileInput"<br/>    accept="audio/mpeg"<br/>/&gt;<br/>&lt;/q-btn&gt;</span></pre><p id="c728" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们这里有一个<code class="fe nn no np ne b">&lt;q-btn&gt;</code> (Quasar按钮)，包含一个常规的html <code class="fe nn no np ne b">&lt;input&gt;</code>元素，带有<code class="fe nn no np ne b">type="file"</code>(使其成为一个文件选择器)，只接受音频文件(<code class="fe nn no np ne b">accept="audio/mpeg"</code>)。</p><p id="1e79" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请注意，浏览器试图强制文件输入具有互联网上最丑陋的设计之一，就像这样:</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/25b18f6329187e4b40e238db90b13bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/0*Tk-L-YauaHk1RXm9.png"/></div></figure><p id="3b2b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然没有官方方法来改变文件输入的外观，但我们将从Quasar的<code class="fe nn no np ne b">q-uploader</code>组件“借用”css类，以便使它看起来更像一个按钮，而不像90年代的遗物。在Cordova应用程序中单击它将打开本机设备的文件选择界面。</p><p id="e7f3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在methods部分添加一个用于接收文件的处理程序:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="c532" class="ni lb iq ne b gy nj nk l nl nm">fileChosen(file) {<br/>    // Chosen file passed as argument<br/>}</span></pre><h1 id="63df" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">将文件发送到主页</h1><p id="e847" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">由于我们在<code class="fe nn no np ne b">MyLayout</code>组件中接收了file对象，但在<code class="fe nn no np ne b">Index</code>组件中接收了wavesurfer对象，我们将使用事件总线在它们之间进行通信，并在文件被选中时发送文件。使用另一个Vue对象可以很容易地创建事件总线。用新的<code class="fe nn no np ne b">event-bus.js</code>文件添加一个<code class="fe nn no np ne b">services</code>文件夹，包含:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="cfbd" class="ni lb iq ne b gy nj nk l nl nm">import Vue from 'vue';<br/>export const EventBus = new Vue();</span></pre><p id="9ce2" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们将它导入到<code class="fe nn no np ne b">MyLayout.vue</code>中，并在文件输入值改变时发出一个事件:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="5fb2" class="ni lb iq ne b gy nj nk l nl nm">import { EventBus } from "../services/event-bus.js";<br/><br/>...<br/><br/>methods: {<br/>    fileChosen(file) {<br/>        EventBus.$emit("fileChosen", file);<br/>    }<br/>}</span></pre><p id="69d4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">现在我们想在<code class="fe nn no np ne b">Index.vue</code>的<code class="fe nn no np ne b">mounted</code>处理程序中捕捉事件:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="fc6e" class="ni lb iq ne b gy nj nk l nl nm">import { EventBus } from "../services/event-bus.js";<br/><br/>...<br/>mounted() {<br/>    ...<br/><br/>    EventBus.$on("fileChosen", file =&gt; {<br/>        this.loadFile(file);<br/>    });<br/>}</span></pre><p id="c322" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，我们将使用wavesurfer的<code class="fe nn no np ne b">loadBlob</code>方法加载文件:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="371d" class="ni lb iq ne b gy nj nk l nl nm">loadFile(file) {<br/>    if (file.target.files.length == 0) return;<br/><br/>    this.wavesurfer.loadBlob(file.target.files[0]);<br/>}</span></pre><p id="652f" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">尝试从您的设备加载一个文件，您应该会看到它的呈现:</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/6c81ca2ab3eaa96293a6e6bad34f110c.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*MRC0A_rrMwbL_VBvCBfGqQ.png"/></div></figure><h1 id="9f91" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">添加控件</h1><p id="9420" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">让我们添加一些播放/暂停/跳过按钮。在<code class="fe nn no np ne b">Index.vue</code>中，将以下代码添加到模板部分:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="e009" class="ni lb iq ne b gy nj nk l nl nm">&lt;template&gt;<br/>  &lt;q-page class&gt;<br/>    &lt;div class="audio-container"&gt;<br/>      &lt;div class="row q-ma-md"&gt;<br/>        &lt;div class="col-12"&gt;<br/>          &lt;div id="waveform"&gt;&lt;/div&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>    &lt;div class="controls row flex flex-center fixed-bottom q-pb-md q-pt-md shadow-10"&gt;<br/>      &lt;div class&gt;<br/>        &lt;q-btn<br/>          color="primary"<br/>          flat<br/>          round<br/>          icon="fast_rewind"<br/>          size="xl"<br/>          @click="wavesurfer.skipBackward(1)"<br/>        /&gt;<br/>        &lt;q-btn<br/>          v-if="isPlaying"<br/>          color="primary"<br/>          round<br/>          icon="pause"<br/>          size="xl"<br/>          @click="wavesurfer.playPause()"<br/>        /&gt;<br/>        &lt;q-btn<br/>          v-if="!isPlaying"<br/>          color="primary"<br/>          round<br/>          icon="play_arrow"<br/>          size="xl"<br/>          @click="wavesurfer.playPause()"<br/>        /&gt;<br/>        &lt;q-btn<br/>          color="primary"<br/>          flat<br/>          round<br/>          icon="fast_forward"<br/>          size="xl"<br/>          @click="wavesurfer.skipForward(1)"<br/>        /&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/q-page&gt;<br/>&lt;/template&gt;</span></pre><p id="1d6b" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在脚本部分:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="dcba" class="ni lb iq ne b gy nj nk l nl nm">computed: {<br/>    isPlaying() {<br/>      if (!this.wavesurfer) return false;<br/><br/>      return this.wavesurfer.isPlaying();<br/>    }<br/>},</span></pre><p id="4f81" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们已经使用Quasar的<code class="fe nn no np ne b">&lt;q-btn&gt;</code>组件在Quasar <code class="fe nn no np ne b">"row"</code> div中添加了一些控件，它使用定位助手<code class="fe nn no np ne b">flex</code>、<code class="fe nn no np ne b">fixed-center</code>和<code class="fe nn no np ne b">fixed-bottom</code>将它们整齐地排列起来。<code class="fe nn no np ne b">q-pb-md/q-pt-md</code>给了我们一些预定义的边距。<code class="fe nn no np ne b">@click</code>处理程序直接调用wavesurfer的方法。</p><p id="fb54" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">注意我们是如何使用模板部分声明性地设计UI的，使用了Quasar的修饰符，如<code class="fe nn no np ne b">round</code>、<code class="fe nn no np ne b">flat</code>和<code class="fe nn no np ne b">size</code>。这为我们节省了99%的手工编写的css代码。</p><p id="dea1" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们还添加了一个<code class="fe nn no np ne b">isPlaying</code> computed，它是wavesurfer方法的包装器，用于决定是显示播放按钮还是暂停按钮。它应该是这样的:</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/13bcd05903fcd049e405d0770c9b29ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*yeRc7oaqbLAkcbmW.png"/></div></figure><h1 id="51db" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">使用wavesurfer挂钩添加装载微调器</h1><p id="8003" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">快好了！现在我们将添加一个微调器，以便在文件加载时给用户一些反馈。Wavesurfer公开了一些钩子，因此我们可以处理各种事件。我们将使用<code class="fe nn no np ne b">error</code>、<code class="fe nn no np ne b">loading</code>和<code class="fe nn no np ne b">ready</code>事件。</p><p id="6223" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<code class="fe nn no np ne b">quasar.conf.js</code>组件部分，将<code class="fe nn no np ne b">'QCircularProgress'</code>添加到列表中。然后在<code class="fe nn no np ne b">Index.vue</code>，播放按钮上方，添加一个<code class="fe nn no np ne b">q-circular-progress</code>:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="0724" class="ni lb iq ne b gy nj nk l nl nm">&lt;q-circular-progress v-if="isLoading" size="72px" indeterminate color="primary" /&gt;</span></pre><p id="2eea" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将播放按钮更改为仅在不加载时显示:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="435f" class="ni lb iq ne b gy nj nk l nl nm">&lt;q-btn v-if="!isPlaying &amp;&amp; !isLoading" <br/>...</span></pre><p id="c89a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">将<code class="fe nn no np ne b">isLoading</code>构件添加到<code class="fe nn no np ne b">data</code>部分:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="1a4e" class="ni lb iq ne b gy nj nk l nl nm">isLoading: false</span></pre><p id="3373" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在<code class="fe nn no np ne b">createWaveSurfer()</code>方法中，我们将挂钩wavesurfer事件:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="639f" class="ni lb iq ne b gy nj nk l nl nm">this.wavesurfer.on("error", err =&gt; {<br/>    console.error(err);<br/>    this.isLoading = false;<br/>    this.$q.notify({ message: err });<br/>});<br/><br/>this.wavesurfer.on("loading", () =&gt; {<br/>    this.isLoading = true;<br/>});<br/><br/>this.wavesurfer.on("ready", () =&gt; {<br/>    this.isLoading = false;<br/>});</span></pre><p id="92e6" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们还增加了一个类星体通知(snackbar ),每当有错误。在Quasar中，从代码的任何地方使用<code class="fe nn no np ne b">this.$q.notify</code>都非常容易做到这一点。</p><h1 id="38a7" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">一个小设计</h1><p id="d6ee" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">为了最终完成设计，我们将添加一个漂亮的背景图像和一些波形样式。我使用了詹姆斯·欧文的<a class="ae my" href="https://unsplash.com/photos/c-NBiJrhwdM" rel="noopener ugc nofollow" target="_blank">图片</a>作为背景。将图片保存为<code class="fe nn no np ne b">assets</code>文件夹下的<code class="fe nn no np ne b">audio.png</code>，并使用下面的css将其设置为主div的背景:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="8c79" class="ni lb iq ne b gy nj nk l nl nm">.controls {<br/>  background-color: white;<br/>}<br/>.audio-container {<br/>  position: absolute;<br/>  top: 0;<br/>  left: 0;<br/>  height: 100%;<br/>  width: 100%;<br/>  background: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)),<br/>    url("../assets/audio.jpg") no-repeat center;<br/>  background-size: cover;<br/>}</span></pre><p id="eaf0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">和一些使用WaveSurfer选项的波形样式:</p><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="a321" class="ni lb iq ne b gy nj nk l nl nm">this.wavesurfer = WaveSurfer.create({<br/>    container: "#waveform",<br/>    hideScrollbar: true,<br/>    waveColor: "white",<br/>    progressColor: "hsla(200, 100%, 30%, 0.5)",<br/>    cursorColor: "#fff",<br/>    barWidth: 3<br/>});</span></pre><p id="a7d4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">就是这样！</p><figure class="mz na nb nc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b55c2167be336308836bf8e3ed8bb80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KVjWqVly4zQjQGh7.png"/></div></div></figure><h1 id="4a28" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">摘要</h1><p id="295a" class="pw-post-body-paragraph kc kd iq ke b kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv mc kx ky kz ij bi translated">我发现Quasar是使用Vue开发设计良好的移动/桌面/网络应用的一种非常快速的方式，只需要很少的CSS。CLI也非常棒，省去了很多令人头疼的Cordova配置。</p><p id="f151" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">WaveSurfer可以定制，有很多插件。我们已经为演示加载了本地文件，但它也可以从您的服务器获取远程URL。</p><h1 id="ca84" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">链接</h1><ul class=""><li id="8995" class="md me iq ke b kf ly kj lz kn nw kr nx kv ny kz mi mj mk ml bi translated">完整源代码:<a class="ae my" href="https://github.com/syonip/quasar-wavesurfer-audio-player" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="74f4" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">在twitter上提问/留言:<a class="ae my" href="https://twitter.com/johnnymakestuff" rel="noopener ugc nofollow" target="_blank"> @johnnymakestuff </a></li><li id="9bc1" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated"><a class="ae my" href="https://quasar.dev/" rel="noopener ugc nofollow" target="_blank">类星体</a></li><li id="d5b8" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated"><a class="ae my" href="https://wavesurfer-js.org/" rel="noopener ugc nofollow" target="_blank"> WaveSurfer </a></li><li id="44bd" class="md me iq ke b kf mm kj mn kn mo kr mp kv mq kz mi mj mk ml bi translated">用<a class="ae my" href="https://threed.io/" rel="noopener ugc nofollow" target="_blank"> threed.io </a>创建的设备模型</li></ul></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="9a22" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="mu">原载于</em><a class="ae my" href="https://www.learningsomethingnew.com/how-to-build-a-sound-cloud-like-audio-player-app-with-vue-js-quasar-and-wave-surfer" rel="noopener ugc nofollow" target="_blank"><em class="mu">https://www.learningsomethingnew.com</em></a><em class="mu">。</em></p></div></div>    
</body>
</html>