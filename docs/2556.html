<html>
<head>
<title>React Native share PDF</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React本机共享PDF</h1>
<blockquote>原文：<a href="https://itnext.io/react-native-share-pdf-b58a0c4211ea?source=collection_archive---------3-----------------------#2019-06-14">https://itnext.io/react-native-share-pdf-b58a0c4211ea?source=collection_archive---------3-----------------------#2019-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="aab4" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><em class="iq">TL；DR:使用</em><a class="ae kp" href="https://github.com/MadeinFrance/react-native-share-pdf" rel="noopener ugc nofollow" target="_blank"><em class="iq">react-native-share-PDF</em></a><em class="iq">库在Android/iOS上共享base64 PDF。</em></p></blockquote><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/06e440d73ba90cb666f360c15bcbae67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BbkOQR3_y2QdL8FqvtIa2w.jpeg"/></div></div></figure><h1 id="8af8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">语境</h1><p id="f590" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">在ING Investments，我们使用<strong class="jt ir"> React Native </strong>在两个平台上发布移动投资应用。移动应用程序是一个交易应用程序，允许在荷兰市场买卖不同的金融工具。没有注册帐户，你可以尝试公共环境，给一个可用功能的潜行高峰。有兴趣的话可以在这里找到这个游乐场:(<a class="ae kp" href="https://itunes.apple.com/app/id1231921275" rel="noopener ugc nofollow" target="_blank"> iOS </a> — <a class="ae kp" href="https://play.google.com/store/apps/details?id=com.ing.investment" rel="noopener ugc nofollow" target="_blank"> Android </a>)。</p><p id="936b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">作为ING Investments的一个小型多学科团队的全栈开发人员，我们致力于所有金融交易的成本透明。作为这一关键功能的一部分，我们遇到了对时间敏感的挑战，即<strong class="jt ir">共享一个PDF文件</strong>(编码为<code class="fe mi mj mk ml b">base64</code>)，以便用户可以在他的首选目的地保存一个本地副本，这在税收等方面非常有用。</p><p id="b76e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><strong class="jt ir">在iOS上分享文档确实有效，但在Android上却不行</strong>。让我们检查一下为什么以及如何解决这个问题。</p><h1 id="311e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">为什么反应原生？</h1><p id="b20c" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">React Native 是一个有价值的框架，它借用React的范例和设计原则来实现快速、跨平台的快速ui开发。<a class="ae kp" href="https://facebook.github.io/react-native/showcase" rel="noopener ugc nofollow" target="_blank">脸书、优步、Instagram、Tesla、Skype和许多其他公司</a>已经为iOS和Android用户开发了基于React Native的最新应用&amp;。作为首批使用React Native的荷兰团队之一，我们对这项技术和其他原生模块的体验是最佳的。</p><h1 id="fec2" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在React Native中共享</h1><p id="659a" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">我们的目标是打开native Share<a class="ae kp" href="https://developer.apple.com/design/human-interface-guidelines/ios/views/action-sheets/" rel="noopener ugc nofollow" target="_blank">action sheet</a>(或activity)，这样系统就可以推荐支持PDF格式的应用。之后，用户可以选择哪个应用程序将被用来存储文件。</p><p id="e5e4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">在iOS上，React Native允许我们使用<a class="ae kp" href="https://facebook.github.io/react-native/docs/share#ios" rel="noopener ugc nofollow" target="_blank"> &lt; url &gt; </a>属性轻松共享base64编码的文件。</p><p id="af27" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">以下代码片段打开本机共享操作表。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="93e5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">系统解释<url>类型和数据，并给出创建PDF的选项。</url></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/16a79c6468d339b408174fb0afb1686e.png" data-original-src="https://miro.medium.com/v2/resize:fit:336/format:webp/1*Lzazf0jHA8KwzD5ntbeSfg.png"/></div></figure><p id="32ef" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><strong class="jt ir">遗憾的是，在Android上不支持</strong><a class="ae kp" href="https://facebook.github.io/react-native/docs/share#android" rel="noopener ugc nofollow" target="_blank"><strong class="jt ir">&lt;URL&gt;</strong></a><strong class="jt ir">属性。</strong></p><h1 id="f721" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">ING投资解决方案</h1><p id="28be" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">React Native的设计方式使您能够执行跨语言的函数调用。您可以从JavaScript执行自定义本机代码，反之亦然。</p><p id="69e8" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">➡️:让我们描述一下我们的本地解决方案，以便在客户的设备上共享PDF文件。</p><p id="50b5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">检索base64数据后，Android的原生Java解决方案包括以下步骤:</p><ol class=""><li id="4787" class="mp mq iq jt b ju jv jy jz mc mr me ms mg mt ko mu mv mw mx bi translated"><strong class="jt ir">清理以前共享的PDF文件。<br/> </strong>我们不想在设备上积累太多文件，所以我们清理了之前共享的PDF文件:</li></ol><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="f3e1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><strong class="jt ir"> 2。将PDF文件写入设备系统。<br/> </strong>我们可以通过将<code class="fe mi mj mk ml b">base64</code>字符串解码为<code class="fe mi mj mk ml b">byte array</code>来做到这一点:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="cdff" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><strong class="jt ir"> 3。开始分享活动。</strong></p><p id="f227" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">在Android中，我们必须通过用<code class="fe mi mj mk ml b">ACTION_SEND</code>指定PDF mime类型来构建一个<a class="ae kp" href="https://developer.android.com/reference/android/content/Intent" rel="noopener ugc nofollow" target="_blank">意图</a>，以便将PDF文件数据从一个活动发送到另一个活动。<code class="fe mi mj mk ml b">EXTRA_STREAM</code>用于指定将要共享的实际二进制数据。</p><pre class="kr ks kt ku gt my ml mz na aw nb bi"><span id="84d8" class="nc ld iq ml b gy nd ne l nf ng">Uri outputFileUri = FileProvider.getUriForFile(reactContext, "com.maximegerbe.reactnative.sharefile.provider", file);</span><span id="d356" class="nc ld iq ml b gy nh ne l nf ng">Intent intentShareFile = new Intent(Intent.ACTION_SEND);<br/>intentShareFile.setType(TYPE_PDF);<br/>intentShareFile.putExtra(Intent.EXTRA_STREAM, outputFileUri);</span><span id="aeb1" class="nc ld iq ml b gy nh ne l nf ng">reactContext.startActivity(Intent.createChooser(intentShareFile, ""));</span></pre><p id="888a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">为了向设备系统写入/读取PDF文件，我们需要在<code class="fe mi mj mk ml b">AndroidManifest.xml</code>中创建一个<a class="ae kp" href="https://developer.android.com/reference/android/support/v4/content/FileProvider" rel="noopener ugc nofollow" target="_blank"> FileProvider </a>组件。为了指定可用文件的目录，我们使用了<code class="fe mi mj mk ml b">&lt;paths&gt;</code>元素的子元素。例如，下面的<code class="fe mi mj mk ml b">paths</code>元素告诉<code class="fe mi mj mk ml b">FileProvider</code>您打算为私有文件区域的<code class="fe mi mj mk ml b">pdf_documents_for_sharing/</code>子目录请求内容URIs。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="b275" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><code class="fe mi mj mk ml b">ShareFile</code>将处理上述3个步骤。Java类的完整实现可以在<a class="ae kp" href="https://github.com/MadeinFrance/react-native-share-pdf/blob/master/android/src/main/java/com/maximegerbe/reactnative/sharefile/ShareFile.java" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="c716" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">从本机模块中，我们导出了<code class="fe mi mj mk ml b">RNShareFile</code>对象，并公开了可以从JavaScript层调用的下面的<code class="fe mi mj mk ml b">share()</code>方法。你可以在这里阅读更多关于有案可稽的原生模块设置<a class="ae kp" href="https://facebook.github.io/react-native/docs/native-modules-android" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="5684" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">共享方法签名:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="0d54" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">在<code class="fe mi mj mk ml b">App.js</code>的用法:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="bb87" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">这开启了本地共享活动(更多<a class="ae kp" href="https://github.com/MadeinFrance/react-native-share-pdf/blob/master/README.md#demo" rel="noopener ugc nofollow" target="_blank">演示</a></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi ni"><img src="../Images/f9324ea1e61c0af349a2ef0e3a069e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yyiZS5CLU3ipbzDJC1aeHA.gif"/></div></div></figure><p id="31a0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">机器人</p><p id="6d83" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><em class="js">在本例中，我们将PDF文件共享给GMail。</em></p><h1 id="b7d6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">单元测试</h1><p id="8eea" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">目标是验证<code class="fe mi mj mk ml b">sharePDF()</code>方法为每个平台做了一件事:</p><ul class=""><li id="5e47" class="mp mq iq jt b ju jv jy jz mc mr me ms mg mt ko nj mv mw mx bi translated">调用iOS平台API。</li><li id="422d" class="mp mq iq jt b ju nk jy nl mc nm me nn mg no ko nj mv mw mx bi translated">在Android上调用我们本机模块的<code class="fe mi mj mk ml b">share()</code>方法。</li></ul><p id="1fdd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">我们可以通过模仿React本地库<code class="fe mi mj mk ml b">Platform.select</code>和<code class="fe mi mj mk ml b">Share.share</code>用<a class="ae kp" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>来实现这一点:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="4407" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">覆盖率结果:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/6669f73eb45aec98fcb0312a7f508c81.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*FQ-ARDiLt5Xb-WmueoVMwA.png"/></div></figure><h1 id="d84a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="af39" class="pw-post-body-paragraph jq jr iq jt b ju ma jw jx jy mb ka kb mc md ke kf me mf ki kj mg mh km kn ko ij bi translated">PDF用例表明，有时应用程序需要访问平台API，如果React Native不提供相应的模块，我们可以随时编写本机代码，并获得平台的全部功能。其他示例包括:重用现有的本机代码、多线程代码等。</p><p id="dd29" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">目前我们只能共享mime类型为<code class="fe mi mj mk ml b">application/pdf</code>的文件。我们可以通过提供mime类型作为参数来改进这一点。由于React Native是一个开源项目，将来我们可以通过将这个库集成到项目中来做出贡献。</p><p id="65f1" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">这个库以NPM包的形式分发:<a class="ae kp" href="https://www.npmjs.com/package/react-native-share-pdf" rel="noopener ugc nofollow" target="_blank"> NPM </a> (4.2 kB)，源代码可以在GitHub:<a class="ae kp" href="https://github.com/MadeinFrance/react-native-share-pdf" rel="noopener ugc nofollow" target="_blank">https://github.com/MadeinFrance/react-native-share-pdf</a>上获得</p><p id="73ab" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">如果这篇文章引起了你的注意，你可以在这里找到一个演示项目<a class="ae kp" href="https://github.com/MadeinFrance/react-native-share-pdf/tree/master/demo" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b812" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated">对于任何问题或反馈，请在下面的评论中告诉我。如果这有用，请点击拍手👏按钮，以示支持。</p><p id="e761" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb mc kd ke kf me kh ki kj mg kl km kn ko ij bi translated"><em class="js">感谢阅读，<br/> Maxime Gerbe。</em></p></div></div>    
</body>
</html>