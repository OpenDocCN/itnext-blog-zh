<html>
<head>
<title>probe.gl — Benchmarking in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">probe . GL—node . js中的基准测试</h1>
<blockquote>原文：<a href="https://itnext.io/probe-gl-benchmarking-in-node-js-2362548d4a99?source=collection_archive---------3-----------------------#2022-10-27">https://itnext.io/probe-gl-benchmarking-in-node-js-2362548d4a99?source=collection_archive---------3-----------------------#2022-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="0122" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">在Node.js寻找标杆？我来介绍一下</em><a class="ae km" href="https://uber-web.github.io/probe.gl/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">probe . GL</em></strong></a><strong class="jp ir"><em class="kl"/></strong><em class="kl">——优步制作的JavaScript前端调试工具集合。</em></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/5676faea4c04e3799f431851bdc526f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LnyBxDLdtPaRNvoaI0VWDA.jpeg"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">由<a class="ae km" href="https://unsplash.com/@marco_biotico?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Marco Biondi </a>在<a class="ae km" href="https://unsplash.com/s/photos/bench?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="894f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae km" href="https://uber-web.github.io/probe.gl/" rel="noopener ugc nofollow" target="_blank"> probe.gl </a>是优步制作的JavaScript前端调试工具集合。<a class="ae km" href="https://uber-web.github.io/probe.gl/" rel="noopener ugc nofollow" target="_blank"> probe.gl </a>有各种各样的工具，但今天我们将重点关注<code class="fe ld le lf lg b">Bench</code>，这是一个基准测试工具类，可以轻松创建用于优化和回归测试目的的“微基准”。在这个故事中，我们将构建一个示例React应用程序，它实现了<a class="ae km" href="https://uber-web.github.io/probe.gl/" rel="noopener ugc nofollow" target="_blank"> probe.gl </a>基准测试平台。<strong class="jp ir"> </strong>如果你想找到更多关于<a class="ae km" href="https://uber-web.github.io/probe.gl/" rel="noopener ugc nofollow" target="_blank"> probe.gl </a>的文档，你可以去<a class="ae km" href="https://uber-web.github.io/probe.gl/docs" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><blockquote class="lh li lj"><p id="c670" class="jn jo kl jp b jq jr js jt ju jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj kk ij bi translated">注意:您可以在本文的底部看到基准测试的输出。</p></blockquote></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h1 id="50ec" class="lu lv iq bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">开始之前</h1><p id="bc92" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">在开始之前，我想说明一下，这个故事中的所有代码都可以在GitHub这里找到:<a class="ae km" href="https://github.com/danielkon96/probegl-benchmarking-sample" rel="noopener ugc nofollow" target="_blank"><em class="kl">probe GL-benchmark-sample</em></a>。请随意在您自己的个人和专业项目中使用它，并根据您的需要进行更改。</p><h1 id="3092" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">设置</h1><p id="55a2" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">首先，让我们创建一个新的React项目</p><blockquote class="lh li lj"><p id="a634" class="jn jo kl jp b jq jr js jt ju jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj kk ij bi translated">注意:我使用的是节点版本<a class="ae km" href="https://nodejs.org/en/blog/release/v12.18.0/" rel="noopener ugc nofollow" target="_blank"> v18.12.0 </a></p></blockquote><pre class="ko kp kq kr gt nc lg nd ne aw nf bi"><span id="c519" class="ng lv iq lg b gy nh ni l nj nk">npx create-react-app <!-- -->benchmark-react-app<br/>cd <!-- -->benchmark-react-app</span></pre><p id="7cab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要将probe.gl <code class="fe ld le lf lg b">bench</code>添加到我们的项目中</p><pre class="ko kp kq kr gt nc lg nd ne aw nf bi"><span id="142e" class="ng lv iq lg b gy nh ni l nj nk">npm install "<a class="ae km" href="http://twitter.com/probe" rel="noopener ugc nofollow" target="_blank">@probe</a>.gl/bench"</span></pre><h1 id="ec4a" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">示例函数</h1><p id="84ef" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">接下来，让我们来看看示例函数。导航到<strong class="jp ir"> App.js </strong>并创建我们将进行基准测试的两个示例函数:<strong class="jp ir"><em class="kl">sample _ function _ sleep _ async</em></strong>和<strong class="jp ir"><em class="kl">sample _ function _ math _ sqrt</em></strong>。第一个函数休眠100毫秒。第二个函数只是调用内置的Math.sqrt函数。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">两个示例函数</figcaption></figure><h1 id="e3dd" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">先决条件</h1><p id="3b87" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">在我们编写基准之前，我们需要完成一些先决条件。在这种情况下，我们需要创建一个名为<strong class="jp ir"><em class="kl">probe GL helper . js</em></strong>的probe.gl辅助文件。乍一看，这个文件包含大量代码，您是对的。但是，我会逐行详细描述该文件包含的所有内容。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">助手文件代码</figcaption></figure><p id="6291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有很多东西要打开。这个帮助文件包含两个主要函数:<code class="fe ld le lf lg b">customLogger</code>和<code class="fe ld le lf lg b">runBenchmarks</code>。<code class="fe ld le lf lg b">customLogger</code> <em class="kl"> </em>用于记录我们的基准测试结果。<code class="fe ld le lf lg b">runBenchmarks</code> <em class="kl"> </em>用于更好地控制我们的基准运行。让我们一行一行地浏览<strong class="jp ir"> ProbeGLHelper.js </strong>。</p><p id="cf9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第1–7行:</strong>这些是在两个辅助函数中使用的辅助变量</p><p id="db15" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第9–40行:</strong>这些函数格式化<code class="fe ld le lf lg b">customLogger</code> <em class="kl"> </em>输出，以提高可读性</p><p id="88c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第47行:</strong>这一行收集了从基准测试返回的所有变量probe.gl</p><p id="bcd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第49行:</strong>每次probe.gl运行一个基准<code class="fe ld le lf lg b">customLogger</code> <em class="kl"> </em>被调用，这个switch语句被触发</p><p id="c606" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第59行:</strong>在这一行，我们存储从probe.gl返回的<a class="ae km" href="https://en.wikipedia.org/wiki/Coefficient_of_variation" rel="noopener ugc nofollow" target="_blank">变异系数</a>，并将其存储在一个名为cv的数组中。我们在最终结果表的第78行使用这个数组</p><p id="7e39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第61–90行:</strong>当probe.gl完成所有基准测试时，调用该部分。这是<code class="fe ld le lf lg b">customLogger</code>构建显示到控制台的表格的地方</p><blockquote class="lh li lj"><p id="dcb6" class="jn jo kl jp b jq jr js jt ju jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj kk ij bi translated">注意:您可以在<strong class="jp ir">71–86</strong>行调整基准测试结果的输出</p></blockquote><p id="b762" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第95–112行</strong>:在运行基准测试时，这一部分为我们提供了对probe.gl的更多控制。例如，第<strong class="jp ir">96–102</strong>行允许您更改每次迭代运行的异步测试数量<em class="kl">(默认情况下，每次迭代运行10个异步测试。在这里，我们将其更改为每次迭代1次异步测试运行)</em></p><h1 id="1449" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">创建基准</h1><p id="db7e" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">在我们编写基准之前，我们需要在App.js的顶部添加以下导入语句</p><pre class="ko kp kq kr gt nc lg nd ne aw nf bi"><span id="fb85" class="ng lv iq lg b gy nh ni l nj nk">import React, { useEffect } from 'react';<br/>import { Bench } from '@probe.gl/bench';<br/>import { customLogger, runBenchmarks } from './ProbeGLHelper';</span></pre><p id="2a4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们准备写一些基准！让我们首先创建一个名为<strong class="jp ir"><em class="kl">sample _ benchmark</em></strong>的异步函数。下面我将逐行详细描述这个函数包含的所有内容。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">基准代码</figcaption></figure><p id="30cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多要打开。这个函数创建了我们的基准！我们来一行一行的过<strong class="jp ir"><em class="kl">sample _ benchmark</em></strong>。</p><p id="ec2f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第2–6行</strong>:这是我们为<code class="fe ld le lf lg b">Bench</code>设置选项的地方，包括我们的<code class="fe ld le lf lg b">customLogger</code></p><p id="c206" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第7行</strong>:初始化probe.gl基准线束类<code class="fe ld le lf lg b">Bench</code>，传<code class="fe ld le lf lg b">benchOptions</code>为参数</p><p id="4889" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第10行</strong> <em class="kl">(与</em> <strong class="jp ir"> <em class="kl">第18行</em> </strong> <em class="kl"> ) </em>:创建一个包含指定基准的组</p><p id="9cf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第11–15行</strong> <em class="kl">(同样的概念适用于</em> <strong class="jp ir"> <em class="kl">第19–23行</em> </strong> <em class="kl"> ) </em>:这里我们给我们的基准测试一个<code class="fe ld le lf lg b">priority (optional)</code>、一个<code class="fe ld le lf lg b">id</code>、一个我们将要测试的<code class="fe ld le lf lg b">function</code>和一个<code class="fe ld le lf lg b">initFunction</code>(这个不推荐使用，所以我们传递null)</p><blockquote class="lh li lj"><p id="a511" class="jn jo kl jp b jq jr js jt ju jv jw jx lk jz ka kb ll kd ke kf lm kh ki kj kk ij bi translated">注意:add/addAsync的函数签名是:</p></blockquote><pre class="ko kp kq kr gt nc lg nd ne aw nf bi"><span id="d0c1" class="ng lv iq lg b gy nh ni l nj nk">add(priority, id, testFunc, initFunc[Deprecated]) : Bench<br/>addAsync(priority, id, testFunc, initFunc[Deprecated]) : Bench</span></pre><p id="ec4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第26行:</strong>将<code class="fe ld le lf lg b">bench</code>传递给我们在助手文件中创建的助手函数<code class="fe ld le lf lg b">runBenchmarks</code>。这将运行我们创建的基准。</p><h1 id="d897" class="lu lv iq bd lw lx mx lz ma mb my md me mf mz mh mi mj na ml mm mn nb mp mq mr bi translated">运行基准</h1><p id="3d53" class="pw-post-body-paragraph jn jo iq jp b jq ms js jt ju mt jw jx jy mu ka kb kc mv ke kf kg mw ki kj kk ij bi translated">现在在函数<strong class="jp ir"> <em class="kl"> App </em> </strong>中用下面的代码替换所有默认生成的代码。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">函数App()代码</figcaption></figure><p id="604b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要启动我们的应用程序，请运行以下命令</p><pre class="ko kp kq kr gt nc lg nd ne aw nf bi"><span id="0ee4" class="ng lv iq lg b gy nh ni l nj nk">npm run start</span></pre><p id="2632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当你打开你的网页浏览器控制台时，你应该会看到类似下面<em class="kl">的截图(如果没有，刷新页面。浏览器有时会在第一页加载时跳过控制台日志)</em></p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi nn"><img src="../Images/488ff3e7392d24bd2b21133816172625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_B-727SiaTAY1H8oquzFg.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">控制台截图</figcaption></figure><p id="f134" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您已经使用probe.gl成功地在Node.js中实现了基准测试。如果您有任何问题或者想要使用probe.gl查看特定的基准测试场景，请告诉我！</p><p id="0566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你遇到任何问题或不清楚的地方，请随时回复。编码快乐，上帝保佑！</p></div></div>    
</body>
</html>