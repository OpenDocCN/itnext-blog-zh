# 你不需要微服务

> 原文：<https://itnext.io/you-dont-need-microservices-2ad8508b9e27?source=collection_archive---------0----------------------->

说到 web 软件架构，微服务非常流行。微服务架构有大量高知名度的从业者和支持者。

脸书、优步、Groupon、Klarna、亚马逊、网飞、易贝、康卡斯特等等。

你很可能不是这些公司。也就是说，你的团队可能一点也不像这些公司的团队。你可能不会面临和他们一样的问题。

如果你是(但你可能不是)，停止阅读。你可能需要微服务。

![](img/f2df1b5691e4f77cfef26edc393cd461.png)

# 微服务的稻草人

微服务有许多据称的好处。问题不在于微服务不能提供这些好处。相反，它们并不是由微服务专门解决的。

在某种程度上，这些事情中的大部分，如果不是全部，都可以通过一个整体来实现。

当有人阐述微服务架构的优点时，言外之意是为了解决这些问题，您必须采用微服务模型。

事实是，**微服务允许你*购买*的额外一层和一定程度的灵活性**来解决这些问题。

关键词是**买入**。

微服务不是免费的。众所周知，它们的建造和维护费用昂贵。

如果你需要额外的灵活性？太好了。总的来说，也许额外的花费是值得的。也许微服务是一个很好的选择。也许你应该认真考虑一下。

如果没有呢？好吧，你只是过度设计了你的堆栈，严重阻碍了你的团队向客户交付价值的能力。

让我们来看看微服务的一些最常见的好处，并考虑我们如何通过 monolith 减轻这些担忧。

# 可量测性

运行微服务意味着应用程序的每个功能都运行在自己的资源上，这些资源可以彼此独立扩展。当然，这将使您能够更好地控制分配给每个功能的资源数量和类型。

但是你真的需要这种程度的控制吗？

您的应用程序的不同功能会经历不同的负载水平吗？

它们是否倾向于以不同的速率扩展？

它们在 CPU、内存、存储和 GPU 方面的要求是否不同？

## 向它扔盒子

对于许多团队来说，通过简单地增加所有可用盒子的大小或数量来弥补这些资源问题的差异会更便宜。即。大多数情况下，不优化基础设施，使其接近使用寿命，会更加经济高效。

## 修复你的巨石

解决整体架构中的性能问题和瓶颈比过渡到新的架构模式更容易。这方面的细节是特定于栈的，但是你不应该走得太远去寻找如何收紧你的应用的想法。

## 将流量路由到可独立扩展的集群

如果您有不止一台服务器，您将在它前面运行某种负载平衡器。您可以使用此负载平衡器的配置将流量路由到您的应用程序实例的独立可扩展集群。

您还可以将异步任务拉入具有独立可伸缩队列的后台作业中。确保您有足够的队列，以便能够精确地控制必要的机箱数量，从而减少队列数量，并使基础设施成本合理。

# 故障隔离

应用程序的单个功能停止运行而不影响其他功能的能力是设计合理的微服务架构的一大优势。

## 将流量路由到孤立的集群

将不同类型的流量路由到集群进行扩展的想法也可以提供一种针对故障的保护措施。

想想你的大部分历史断层是从哪里来的。这将会给你一个指示，如何最好地路由您的流量。如果你与“吵闹的邻居”斗争，你可能想要基于帐户 ID 路由。如果你有一个脆弱但次要的功能，习惯于把所有东西都搞坏，也许可以把它的端点路由到它自己的应用实例集群。如果您有有问题的后台作业，将它们放在自己的队列中，这样不会影响其他作业。

## 自动化测试

预防胜于治疗。如果你能防止或至少减少错误的数量，你就不用那么担心隔离它们了。

培养一种健康的测试文化以确保对你运送的货物质量的信心是关键。不仅在于它能够可靠地交付所需的功能。还在于它在生产负载下这样做的能力。

# 与编程语言和技术无关

如果没有独立的服务，引入新语言和新技术的选择并不多。

在大多数情况下，这与其说是一个 bug，不如说是一个特性。在选择语言和技术时，给工程师太多的选择会导致一个支离破碎和过于复杂的技术堆栈。

向一整块带来的简单和对齐倾斜。

如果您*确实*对针对特定功能的专业语言有特定领域的需求，您可能需要考虑单独的服务。您需要权衡任何额外技术带来的好处和维护它的额外成本。

# 数据安全

你认为保护一块巨石很难吗？微服务只会让这项工作变得更加复杂。通过增加堆栈的复杂性，您增加了受攻击的范围。

## 保护你的巨石

的确，将功能隔离到不同的服务中可以让您对每个服务应用不同级别的安全性和勤勉。但是，请考虑这种级别的控制是否必要。

把你的整块巨石固定在必要的最高位置是否更容易？

您的数据是否有不同的安全要求？

# 团队自治

我非常喜欢自主的跨职能团队。我有点困惑，为什么要引入网络边界来实现这一点。

让每个团队拥有特定的独立系统看起来像是一种提高团队自主性的方法，但实际上，这可能会适得其反。

假设我的团队需要对另一个团队拥有的功能进行更改。对于微服务架构，我可能需要利用他们在该服务方面的知识和经验来对其进行更改。我甚至可能要等他们来做。如果特性是在一个整体中，我很可能已经熟悉了代码或者至少是它的惯例。

团队自治的程度是模块化程度和系统一致性程度的函数。无论是整体服务还是微服务都不会保证或毁灭你在这些方面的任何一个。然而，微服务将迫使你的系统模块化，而一个整体将倾向于鼓励更多的一致性。

## 模块化你的整体

微服务，就其本质而言，会迫使你将系统模块化。monolith 在这里并没有提供太多的帮助(尽管您选择的 monolith 框架可能会提供帮助)，但是它们当然也不会妨碍您自己做这件事。

具有有限关注点的松散耦合模块化代码是一个好主意，不管您是否碰巧在这些关注点之间增加了网络边界的复杂性。

## 微服务不能确保良好的模块化

尽管微服务实施模块化，但不能保证它是好的模块化。如果设计没有充分考虑，微服务很容易成为紧密耦合的“分布式整体”。

如果你不能成功地模块化一个整体，你将很难构建一个成功的微服务架构。

微服务迫使模块化，但**他们使做好它更难**。

# 可独立部署

在能够独立部署服务是一种优势的情况下，您可能会做出许多改变。但是为了你的面包和黄油。你的日常变化。这可能成为一个棘手的瓶颈。

跨单独的服务编排大量部署的需求将使快速发布特性变得更加困难和复杂。

## 分解复杂的变化

使用 monolith，仍然有可能将复杂的、有风险的变更分解成单独的部署。一个常见的例子是使迁移向前和向后兼容他们自己的 PRs 和他们自己的部署。

这显然增加了运送功能的复杂性，就像微服务一样。你不会想轻率地使用它。但它确实为*提供了一些*微服务的好处，而不必被迫在每次变化时都利用它。

# 依赖性管理

微服务允许你对每个服务有独立的依赖，但是你真的需要它们吗？

在一个庞大的整体中管理依赖关系已经够难的了。将它分成几个更小的列表简化了对每个单独列表的管理，但是对于整个系统来说，这样做会变得复杂。

使用 monolith，迟早，你会陷入“依赖地狱”,在两个依赖之间产生冲突。微服务不会确保你避免这种情况，但它们应该会减少出现问题的可能性。

## 掌握依赖关系更新

保持您的依赖关系最新显然是可取的。但在现实世界中，通常，一些被允许滑动的东西。

停留在可用版本的最前沿实际上可能会加剧这个问题，因为一个依赖项比其他相关依赖项前进得更快。但是“保持领先”并不意味着尽可能更新到最新版本。

# 更简单、更容易理解的代码

这种好处往好里说是不真诚的，往坏里说是赤裸裸的谎言。

每项服务都更简单，更容易理解。当然可以。整个系统要复杂得多，也更难理解。你还没有去掉复杂性；你把它增加了，然后移植到别的地方。

## 模块化你的整体

我们不需要引入网络边界和隔离进程来使我们的代码更容易被工程师理解。

一个被分解成具有明确定义和有限关注点的模块的整体将会比一个被分解成独立服务的系统更容易理解。

# 但是我们感受到了我们巨石的痛苦

如果你的独石遇到了问题，那可能是因为你的独石有问题，而不是因为*它是*独石。

你的 monolith 可能是代码质量、工具和模块化的一盏明灯。如果这是你，而你仍然在经历痛苦，那么可能是时候开始考虑微服务了。但这可能不是你。你可能只需要改进你的独石。

构建软件很难。组织大型复杂系统是非常困难的，这些系统有许多随时间演变的活动部件。

我会举起手来。我建造了乱七八糟的巨石柱。

我不是来评判任何人的。

但是如果你认为你所面临的问题可以通过微服务神奇地解决，甚至简化，那你就陷入了痛苦的世界。

# 我应该考虑微服务吗？

整体服务和微服务之间的选择通常表现为两种相互排斥的思维模式。老学校对新学校。无论对错。非此即彼。

事实是，它们都是有效的方法，只是有不同的权衡。正确的选择是高度具体的，必须包括广泛的考虑因素。

这种选择本身是一种错误的二分法，在某些情况下，应该基于一个特性一个特性地进行选择，而不是针对整个组织的工程团队的单一方法。

应该考虑微服务吗？

通常情况下，这要视情况而定。您可能会真正从微服务架构中受益。

当然，在某些情况下，他们可以支付他们的费用，但如果你是一个中小型团队或早期项目:

**不，你可能不需要微服务。**

# 不相信我？问问周围

询问整个行业，你会发现关于微服务及其给团队带来的问题的警示故事不胜枚举。

[部门](https://segment.com/)是一个[有据可查的](https://segment.com/blog/goodbye-microservices)和高调的团队在微服务上掉头的例子。

这同样适用于单片微服务。仅仅因为他们在执行中有问题，并不意味着核心前提从根本上有缺陷。

但是，如果您打算采用微服务方法，您需要睁大眼睛。接受折衷，并准备好成功完成任务所需的额外资源。

# 我的观点

对于新的、小型和中型的工程团队来说，monolith 应该仍然是默认的选择。微服务仍然是一种选择，但是您应该有令人信服的特定于上下文的理由来证明它们的使用。

对于中型到大型团队来说，应该考虑这一点，但是要对权衡有更多的理解和认识。