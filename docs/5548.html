<html>
<head>
<title>Configure an NFS Storage Class on an Existing KubeSphere Cluster and Create a PersistentVolumeClaim</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在现有的KubeSphere集群上配置一个NFS存储类，并创建一个PersistentVolumeClaim</h1>
<blockquote>原文：<a href="https://itnext.io/configure-an-nfs-storage-class-on-an-existing-kubesphere-cluster-and-create-a-persistentvolumeclaim-c4d4dc82442f?source=collection_archive---------2-----------------------#2021-03-31">https://itnext.io/configure-an-nfs-storage-class-on-an-existing-kubesphere-cluster-and-create-a-persistentvolumeclaim-c4d4dc82442f?source=collection_archive---------2-----------------------#2021-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="15aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我的<a class="ae kl" href="https://kubesphere.io/blogs/install-nfs-server-client-for-kubesphere-cluster/" rel="noopener ugc nofollow" target="_blank">上一篇文章</a>中，我谈到了如何使用KubeKey和NFS存储创建一个Kubernetes和KubeSphere集群。事实上，KubeSphere为您提供了极大的灵活性，因为您可以在创建集群时使用KubeKey来安装NFS存储，同时它也可以单独部署在现有的集群上。</p><p id="c291" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">KubeSphere拥有一个高度交互式的仪表盘，几乎所有的操作都可以在上面进行。在本文中，我将展示如何在现有的KubeSphere集群上配置一个NFS存储类，并使用该存储类创建一个PVC。</p><h1 id="820e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">开始之前</h1><ul class=""><li id="7a60" class="lk ll iq jp b jq lm ju ln jy lo kc lp kg lq kk lr ls lt lu bi translated">您已经<a class="ae kl" href="https://kubesphere.io/docs/quick-start/all-in-one-on-linux/" rel="noopener ugc nofollow" target="_blank">设置了一个Kubernetes集群，其中安装了KubeSphere】。以下是我的集群信息，供您参考:</a></li></ul><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="6b6d" class="me kn iq ma b gy mf mg l mh mi"># kubectl get node -o wide</span><span id="04bf" class="me kn iq ma b gy mj mg l mh mi">NAME     STATUS   ROLES            AGE   VERSION   INTERNAL-IP   <br/>client   Ready    master,worker    17m   v1.17.9   192.168.0.3</span><span id="e4f2" class="me kn iq ma b gy mj mg l mh mi">EXTERNAL-IP     OS-IMAGE               KERNEL-VERSION      <br/>&lt;none&gt;          Ubuntu 16.04.4 LTS     4.4.0-116-generic</span><span id="1681" class="me kn iq ma b gy mj mg l mh mi">CONTAINER-RUNTIME<br/>docker://20.10.5</span></pre><ul class=""><li id="ced8" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk lr ls lt lu bi translated">您有一个可用的NFS服务器，它为外部存储服务提供导出的目录。更多信息见<a class="ae kl" href="https://kubesphere.io/blogs/install-nfs-server-client-for-kubesphere-cluster/#install-and-configure-an-nfs-server" rel="noopener ugc nofollow" target="_blank">我之前的文章</a>。</li></ul><h1 id="2868" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">配置客户端机器</h1><p id="a9f5" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">这与我上次所做的基本相同，因为我们需要确保我们所有的客户端机器都可以使用基本的NFS客户端库和实用程序。</p><ol class=""><li id="8221" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk mq ls lt lu bi translated">运行以下命令以确保您使用的是最新的包。</li></ol><p id="154f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt ma b">sudo apt-get update</code></p><p id="b374" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.在所有客户端上安装<code class="fe mr ms mt ma b">nfs-common</code>。</p><p id="82e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt ma b">sudo apt-get install nfs-common</code></p><p id="be86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><p id="7753" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">对于基于CentOS的Linux发行版，需要安装</em> <code class="fe mr ms mt ma b"><em class="mu">nfs-utils</em></code> <em class="mu">。</em></p><p id="b615" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.为了确保您可以使用NFS存储，您需要安装其相应的卷插件。因为默认情况下Helm是和KubeSphere一起安装的，所以我将通过Helm图表安装<a class="ae kl" href="https://github.com/kubernetes-retired/external-storage/tree/master/nfs-client" rel="noopener ugc nofollow" target="_blank"> NFS客户端供应器</a>，包括它的存储类。首先运行以下命令添加一个存储库:</p><p id="8a4e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mr ms mt ma b">helm repo add stable <a class="ae kl" href="https://charts.kubesphere.io/main" rel="noopener ugc nofollow" target="_blank">https://charts.kubesphere.io/main</a></code></p><p id="46b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><ul class=""><li id="8ca4" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk lr ls lt lu bi translated"><em class="mu">由于NFS本身没有内部供应器，我将使用NFS客户端供应器进行卷的动态供应。</em></li><li id="41a2" class="lk ll iq jp b jq mv ju mw jy mx kc my kg mz kk lr ls lt lu bi translated"><code class="fe mr ms mt ma b"><em class="mu">kubectl</em></code> <em class="mu">被集成到KubeSphere的控制台中。您可以从KubeSphere仪表盘右下角的</em> <strong class="jp ir"> <em class="mu">工具箱</em> </strong> <em class="mu">中运行命令。</em></li></ul><p id="97fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.总计<a class="ae kl" href="https://github.com/kubernetes-retired/external-storage/tree/master/nfs-client" rel="noopener ugc nofollow" target="_blank">NFS-客户供应方</a>。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="0f5b" class="me kn iq ma b gy mf mg l mh mi">helm install stable/nfs-client-provisioner --set nfs.server=192.168.0.2 --set nfs.path=/mnt/demo</span></pre><p id="c9a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><ul class=""><li id="74f9" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk lr ls lt lu bi translated"><em class="mu">在上面的命令中，用您自己的地址替换服务器IP地址和导出的目录。</em></li><li id="9cb4" class="lk ll iq jp b jq mv ju mw jy mx kc my kg mz kk lr ls lt lu bi translated"><em class="mu">对于头盔3，必须指定旗帜</em> <code class="fe mr ms mt ma b"><em class="mu">--generate-name</em></code> <em class="mu">。</em></li><li id="30b8" class="lk ll iq jp b jq mv ju mw jy mx kc my kg mz kk lr ls lt lu bi translated"><em class="mu">关于可配置参数的更多信息，参见本表</em> <a class="ae kl" href="https://github.com/kubesphere/helm-charts/tree/master/src/main/nfs-client-provisioner#configuration" rel="noopener ugc nofollow" target="_blank"> <em class="mu">。</em> </a></li></ul><p id="0c57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.使用默认帐户和密码(<code class="fe mr ms mt ma b">admin/P@88w0rd</code>)登录KubeSphere控制台，并转到<strong class="jp ir">集群管理</strong>页面上的<strong class="jp ir">存储类</strong>。您可以看到已经添加了NFS存储类。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi na"><img src="../Images/ee78c2b5137ba68d85dcd83e5aec1364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EFtbZrt20nqjTeQI.png"/></div></div></figure><h1 id="6a0d" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建一个PVC并将一个卷装载到一个工作负载</h1><p id="70e0" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">要将一个卷挂载到您的工作负载，您需要首先创建一个<a class="ae kl" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims" rel="noopener ugc nofollow" target="_blank">PersistentVolumeClaim</a>(PVC)。如果您的存储类支持动态预配置，KubeSphere会自动将创建的PVC绑定到满足您为PVC设置的请求(如访问模式和容量)的<a class="ae kl" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/" rel="noopener ugc nofollow" target="_blank"> PersistentVolume </a> (PV)。然后，您可以将其装载到您的工作负载中，以提供存储服务。</p><ol class=""><li id="2524" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk mq ls lt lu bi translated">在KubeSphere中，工作负载运行在不同的项目(即名称空间)中。转到一个项目，导航到<strong class="jp ir">卷</strong>页面，然后单击<strong class="jp ir">创建</strong>。</li></ol><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi ni"><img src="../Images/a3f02d775a384adf7e65b353d2d6460b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zj5cMoNoPEALhdN4.png"/></div></div></figure><p id="a920" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><ul class=""><li id="ed4c" class="lk ll iq jp b jq jr ju jv jy mk kc ml kg mm kk lr ls lt lu bi translated"><em class="mu">在此页面上创建的所有对象本质上都是PVC。</em></li><li id="5b4b" class="lk ll iq jp b jq mv ju mw jy mx kc my kg mz kk lr ls lt lu bi translated"><em class="mu">本文不关注KubeSphere的多租户系统，该系统具有不同的租户隔离级别。有关KubeSphere工作区和项目的更多信息，请参见本文</em><a class="ae kl" href="https://kubesphere.io/docs/quick-start/create-workspace-and-project/" rel="noopener ugc nofollow" target="_blank"><em class="mu"/></a><em class="mu">。</em></li></ul><p id="5c07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.点击<strong class="jp ir">创建</strong>，为PVC设置一个名称和必要的参数。您可以选择<code class="fe mr ms mt ma b">nfs-client</code>作为存储类别，如下图所示:</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nj"><img src="../Images/655fd935c7c2254c663a6e3f1802c3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X70IQtij5knXvS_Q.png"/></div></div></figure><p id="5e54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><p id="357a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">事实上，您也可以使用卷快照来创建卷，但您的存储类必须支持此功能。更多信息，请参见</em> <a class="ae kl" href="https://kubesphere.io/docs/project-user-guide/storage/volume-snapshots/" rel="noopener ugc nofollow" target="_blank"> <em class="mu">卷快照</em> </a> <em class="mu">。</em></p><p id="d223" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.PVC现在被绑定了。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi na"><img src="../Images/3dd2dcd46c2cbcd6633990243562eae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jkUsY_qMLmMYohEz.png"/></div></div></figure><p id="21e0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.转到<strong class="jp ir">应用程序工作负载</strong>并从<strong class="jp ir">工作负载</strong>创建一个部署。这里我以NGINX为例。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nk"><img src="../Images/33476fa795990b655a5c787bef94a8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yy4wJmQt1ftW4FeC.png"/></div></div></figure><p id="a74d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">注</em></p><p id="1d8b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mu">要在KubeSphere中创建工作负载，您可以像之前一样创建并应用YAML文件(右上角的</em> <strong class="jp ir"> <em class="mu">编辑模式</em> </strong> <em class="mu">)。同时，您还可以在KubeSphere仪表盘上为您的工作负载逐个设置参数。我不会详细谈论整个过程，因为本文主要是关于如何配置存储和创建卷。查看KubeSphere文档</em>  <em class="mu">以了解更多关于如何创建工作负载的信息。</em></p><p id="8baa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.在<strong class="jp ir">挂载卷</strong>选项卡上，点击<strong class="jp ir">添加卷</strong>并选择刚刚创建的PVC。下面是我的配置，供你参考。有关仪表板属性的更多信息，请参见<a class="ae kl" href="https://kubesphere.io/docs/project-user-guide/storage/volumes/" rel="noopener ugc nofollow" target="_blank">卷</a>。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi nl"><img src="../Images/6b1ded91957faa79ad5cb12c8dcc6177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qjyIMdyfF_jdNI90.png"/></div></div></figure><p id="c4ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.部署将在创建后很快启动并运行。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi na"><img src="../Images/de64ff7b03a3ec129da6075c7db0bec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lV7qEDcAJTV20Gi7.png"/></div></div></figure><p id="0035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">7.该卷也已成功装载。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi na"><img src="../Images/3121ba7bf31efbd82af3b46722036477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MHcxN0ykGOqO6Txf.png"/></div></div></figure><p id="8282" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">8.单击PVC查看详细页面。</p><figure class="lv lw lx ly gt nb gh gi paragraph-image"><div role="button" tabindex="0" class="nc nd di ne bf nf"><div class="gh gi na"><img src="../Images/08eb9d562254e754adb66b838745b4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xu3DTugvKBitbeZu.png"/></div></div></figure><h1 id="4407" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">摘要</h1><p id="bf11" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">我想一旦你准备好了你的NFS存储服务器，用Helm安装存储类就不是一件复杂的事情了(KubeSphere默认为你安装Helm)。至于创建和使用PVC，KubeSphere提供了一致的用户体验，因为您可以像往常一样从命令行创建您的资源。也就是说，尝试使用它的仪表板来创建PVC并不是一个坏主意，这样您就不用手动创建和应用任何YAML配置了。</p><h1 id="c6b8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">参考</h1><p id="f574" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated"><a class="ae kl" href="https://kubesphere.io/docs/project-user-guide/storage/volumes/" rel="noopener ugc nofollow" target="_blank">卷</a></p><p id="02fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://kubesphere.io/docs/cluster-administration/persistent-volume-and-storage-class/" rel="noopener ugc nofollow" target="_blank">持久卷和存储类</a></p><h1 id="1c4f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">关于KubeSphere</h1><p id="8fce" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mn ka kb kc mo ke kf kg mp ki kj kk ij bi translated">KubeSphere是一个基于Kubernetes的开源容器平台，其核心是应用程序。它提供全栈It自动化操作和简化的开发运维工作流。</p><p id="b317" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://kubesphere.io" rel="noopener ugc nofollow" target="_blank"> KubeSphere </a>已被全球数千家企业采用，如<strong class="jp ir"> Aqara、新浪、奔来、中国太平、华夏银行、国药控股、微众银行、Geko Cloud、VNG公司、Radore </strong>。KubeSphere为运维提供向导界面和各种企业级功能，包括Kubernetes资源管理、<a class="ae kl" href="https://kubesphere.io/devops/" rel="noopener ugc nofollow" target="_blank">、DevOps (CI/CD) </a>、应用生命周期管理、服务网格、多租户管理、<a class="ae kl" href="https://kubesphere.io/observability/" rel="noopener ugc nofollow" target="_blank">监控</a>、日志记录、警报、通知、存储和网络管理以及GPU支持。有了KubeSphere，企业能够快速建立一个强大且功能丰富的容器平台。</p><p id="d6cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">欲了解更多信息，请访问<a class="ae kl" href="https://kubesphere.io/" rel="noopener ugc nofollow" target="_blank"> https://kubesphere.io </a></p></div></div>    
</body>
</html>