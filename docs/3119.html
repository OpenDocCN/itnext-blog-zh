<html>
<head>
<title>EKS VS KOPS: Why EKS can be the best solution for AWS users.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EKS VS KOPS:为什么EKS可以成为AWS用户的最佳解决方案。</h1>
<blockquote>原文：<a href="https://itnext.io/eks-vs-kops-a-comparison-for-aws-users-b6ecd94d2999?source=collection_archive---------4-----------------------#2019-10-07">https://itnext.io/eks-vs-kops-a-comparison-for-aws-users-b6ecd94d2999?source=collection_archive---------4-----------------------#2019-10-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/39aae24b49a9501d4469ebbce342292c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXNd_mG4TJUFerzLOdZ18Q.jpeg"/></div></div></figure><h1 id="07c1" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">序文</h1><p id="9621" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们都可以肯定地说，Kubernetes正被广泛接受为容器编排的首选。过去几年，我们看到每一个主要的云提供商都试图为Kubernetes提供最佳的托管解决方案。谷歌的GKE是目前为止遥遥领先的赢家。在我使用Kubernetes的3年多时间里，我个人使用过GKE、Kubespray(在openstack cloud上)、KOPS和EKS。借助GKE，我能够轻松管理5个不同的集群，因此我对其他云提供商寄予厚望。</p><p id="0a44" class="pw-post-body-paragraph kw kx iq ky b kz lu lb lc ld lv lf lg lh lw lj lk ll lx ln lo lp ly lr ls lt ij bi translated">AWS仍然是使用最广泛的云提供商，它从2018年6月开始提供EKS。AWS用户长期以来一直使用KOPS来创建和管理Kubernetes集群。在EKS之前我用的是KOPS。与GKE类似，EKS也负责Kubernetes主节点，用户只需关注工人节点。让我们现在就开始:</p><h1 id="8b63" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">云支持:</h1><h2 id="d549" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="b04d" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">EKS仅面向AWS用户和将其物理基础架构扩展到AWS云的公司。</li></ul><h2 id="ba9d" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="5d8f" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">AWS是官方支持的。</li><li id="e486" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">GCE和OpenStack处于beta支持阶段，VMware vSphere处于alpha支持阶段。</li><li id="6e59" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">KOPS非常适合拥有多云战略的公司。</li></ul><h1 id="9e94" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">安全性:</h1><h2 id="6088" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="df75" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">由于EKS负责主节点，用户只需管理工作节点的安全性。</li></ul><h2 id="b198" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="215a" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">KOPS用户应该轮换加密密钥和证书，以限制密钥泄露的<code class="fe mz na nb nc b">blast radius</code>。正如这里所解释的<a class="ae nd" href="https://github.com/kubernetes/kops/blob/master/docs/rotate-secrets.md" rel="noopener ugc nofollow" target="_blank">，这对KOPS来说是一个破坏性的过程。</a></li><li id="8155" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">对<strong class="ky ir"> API服务器的</strong> <strong class="ky ir"> etcd </strong>的写访问权限相当于获得整个集群的root权限，甚至读访问权限也可以用来相当容易地提升权限。拥有自己的专用节点是很好的做法。对于KOPS，默认情况下，etcd与其他控制平面组件一起部署。</li><li id="d263" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">用户甚至可以在主节点上以非根用户的身份运行容器，一旦遭到破坏，可能会帮助攻击者进一步攻击<strong class="ky ir">。</strong></li></ul><blockquote class="ne nf ng"><p id="2ada" class="kw kx nh ky b kz lu lb lc ld lv lf lg ni lw lj lk nj lx ln lo nk ly lr ls lt ij bi translated">安全性应该是所有公司关注的主要问题。EKS只是剥夺了主节点的安全性。工程师甚至应该对工人节点保持警惕，不管是EKS还是KOPS。</p></blockquote><h1 id="c2dd" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">基础设施成本:</h1><h2 id="8747" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="fbec" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">每个集群每小时的EKS成本仅为0.2美元。</li></ul><h2 id="e3b9" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="b944" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">对于小型集群，KOPS和EKS一样好。</li><li id="b4bc" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">大型集群需要具有高资源的主节点，这将增加成本。对于非常大的集群，这个成本应该非常高。例如，单个<code class="fe mz na nb nc b">t3.xlarge </code>实例类型每小时花费<code class="fe mz na nb nc b">$0.1504</code>，用户至少需要3个。对于计算和内存特定的实例类型，成本更高。</li><li id="dbab" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">默认情况下，KOPS创建自己的VPC，如果你不使用现有的VPC，那么你必须承担VPC成本。点击<a class="ae nd" href="https://aws.amazon.com/vpc/pricing/" rel="noopener ugc nofollow" target="_blank">此处</a>查看VPC价格。</li></ul><h1 id="92ea" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">运营工作:</h1><p id="6f79" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我只在IAAC使用Terraform(基础设施作为代码)。因此，我将提到所有神奇的terraform可以为您的EKS集群。</p><h2 id="0c36" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ol class=""><li id="503f" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt nl mr ms mt bi translated">自我修复控制平面，因此主节点不需要监控/警报。</li><li id="1e2f" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">基础设施作为一种代码是一条路要走，对于EKS来说，使用Cloudformation或<a class="ae nd" href="https://github.com/terraform-aws-modules/terraform-aws-eks" rel="noopener ugc nofollow" target="_blank"> Terraform模块</a>创建和管理集群非常容易。</li><li id="4067" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">AWS负责升级主节点的<strong class="ky ir">，这可以通过UI完成，也可以在terraform中更新<a class="ae nd" href="https://www.terraform.io/docs/providers/aws/r/eks_cluster.html#version" rel="noopener ugc nofollow" target="_blank">版本</a>值。</strong></li><li id="2c73" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">您可以通过更新工作节点的AMI来升级工作节点，尽管需要更多的规划。</li><li id="3a7a" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">AWS计划在未来引入受管工作节点，这将大大减少运营工作量。</li><li id="43b3" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">对于开发团队管理他们自己的Kube集群的公司来说，没有控制平面是件好事。</li><li id="e3cd" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt nl mr ms mt bi translated">轻松添加/删除员工组池(KOPS的实例组)。下面是来自Terraform模块的代码。点击<a class="ae nd" href="https://github.com/terraform-aws-modules/terraform-aws-eks/blob/master/examples/basic/main.tf" rel="noopener ugc nofollow" target="_blank">此处</a>查看整个文件:</li></ol><pre class="nm nn no np gt nq nc nr ns aw nt bi"><span id="d000" class="lz jz iq nc b gy nu nv l nw nx">worker_groups = [<br/>    {<br/>      name                          = "worker-group-1"<br/>      instance_type                 = "t2.small"<br/>      additional_userdata           = "echo foo bar"<br/>      asg_desired_capacity          = 2<br/>      additional_security_group_ids = [aws_security_group.worker_group_mgmt_one.id]<br/>    },<br/>    {<br/>      name                          = "worker-group-2"<br/>      instance_type                 = "t2.medium"<br/>      additional_userdata           = "echo foo bar"<br/>      additional_security_group_ids = [aws_security_group.worker_group_mgmt_two.id]<br/>      asg_desired_capacity          = 1<br/>    },<br/>  ]</span></pre><h2 id="fd93" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="3459" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">用户需要监控、警告和修复主节点的问题(如果有的话)。</li><li id="a939" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">通过添加<code class="fe mz na nb nc b"> —-target=terraform </code>标志，Kops可以创建一个terraform文件，需要应用该文件来创建集群。如果您不想使用IAAC，那么可以从bash shell中运行KOPS命令，尽管不推荐用于生产用例。</li><li id="14cd" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">用户需要对整个集群进行升级。升级必须从命令行完成，这可能是一个严格遵循IAAC公司的问题。</li></ul><h1 id="c454" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">微调Kubernetes集群。</h1><h2 id="5a01" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="2233" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">EKS为主节点提供了良好的默认值，控制平面无法微调。</li><li id="cd98" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">AWS开源了用于构建亚马逊EKS优化AMI的构建脚本。他们可以在这里找到<a class="ae nd" href="https://github.com/awslabs/amazon-eks-ami" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><h2 id="0b07" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="7dea" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">与EKS相比，Kops提供了对控制平面的更多控制。尽管与运行裸机Kube集群相比仍有限制，例如，不能使用KOPS更改或更新控制面板pod注释。</li><li id="bd11" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">用户也能够使用他们自己的AMI。</li></ul><h1 id="4a9c" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">CNI网络:</h1><h2 id="1481" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="a7c6" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">用户必须使用aws-vpc-cni作为EKS的cni。</li><li id="6c6c" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">用户可以通过使用hacky方法选择不同的CNI。</li><li id="ed04" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">aws-vpc-cni的一个优点是，与EKS集群有网络连接的ec2实例可以使用它们的IP直接连接到pod。对于边缘情况，这是一个很好的特性，在这种情况下，您希望从kubernetes之外或另一个集群中运行的应用程序直接连接到pods。随着pod获得VPC IP，EKS集群需要拥有大型IP池的VPC。</li></ul><h2 id="d299" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="8bda" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">用户可以选择使用CNI。</li><li id="2a31" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">在IP池方面还是挺宽松的。</li></ul><h1 id="5908" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">版本和更新:</h1><p id="f4c2" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">到目前为止，EKS在版本和更新方面领先于KOPS。</p><h1 id="f7b9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">与AWS的集成:</h1><h2 id="55ba" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">EKS:</h2><ul class=""><li id="b7c7" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">总体而言，与aws服务的集成非常好。它内置了与aws-iam-authenticator的集成。</li><li id="dc46" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">它可以与CloudTrail集成进行审计。AWS计划带来更多与AWS服务的集成。</li><li id="38b4" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">Kube2Iam是与Iam集成的必由之路。</li></ul><h2 id="7890" class="lz jz iq bd ka ma mb dn ke mc md dp ki lh me mf km ll mg mh kq lp mi mj ku mk bi translated">KOPS:</h2><ul class=""><li id="34d4" class="ml mm iq ky b kz la ld le lh mn ll mo lp mp lt mq mr ms mt bi translated">在IAM集成方面，用户可以使用KIAM或Kube2IAM以及aws-iam-authenticator。</li><li id="6ae2" class="ml mm iq ky b kz mu ld mv lh mw ll mx lp my lt mq mr ms mt bi translated">它不能与其他AWS服务集成。</li></ul><h1 id="efb6" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">总结:</h1><p id="b449" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">EKS和KOPS都是了不起的工具。对于某些用例，KOPS似乎是一个不错的选择。对于大多数用例来说，EKS是AWS用户的好工具。我希望这篇文章对用户和公司决定选择什么有用。</p></div></div>    
</body>
</html>