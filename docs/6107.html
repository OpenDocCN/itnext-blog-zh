<html>
<head>
<title>WebSocket communication between two Go programs, the easy way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">两个Go程序之间的WebSocket通信，简单的方法</h1>
<blockquote>原文：<a href="https://itnext.io/websocket-communication-between-two-go-programs-the-easy-way-d8c9cf40043f?source=collection_archive---------2-----------------------#2021-08-20">https://itnext.io/websocket-communication-between-two-go-programs-the-easy-way-d8c9cf40043f?source=collection_archive---------2-----------------------#2021-08-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5a4a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有一个提示，在Docker中运行围棋程序时</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/aa422e05879a14540fef7cd2232ed742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPLP3nZxRX7p36HUhk0P0A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">由Renee French创建的原始地鼠图像，使用由Maria Letta创建的地鼠图像</figcaption></figure><p id="a34f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">写这篇文章的目的只有一个:向您展示如何使用WebSockets在两个Go程序之间进行通信。最简单的方法。</p><p id="57b8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本文是由<a class="lu lv ep" href="https://medium.com/u/6f72c855da06?source=post_page-----d8c9cf40043f--------------------------------" rel="noopener" target="_blank">彼得·贾霍达</a>撰写的系列文章的独立补充，明智的做法是将这种类型的交流纳入正确的服务行为(系列文章的第2部分)。</p><div class="lw lx gp gr ly lz"><a href="https://medium.com/swlh/create-go-service-the-easy-way-de827d7f07cf" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd iu gy z fp me fr fs mf fu fw is bi translated">以简单的方式创建Go服务</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">适用于Windows、Linux、MacOS和Docker</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">medium.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ks lz"/></div></div></a></div><p id="a237" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当使用WebSockets时，一个程序必须充当服务器。</p><p id="8ef6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是可以有许多其他程序作为客户端。在本文中，我们将创建一个服务器和一个客户端。戈兰将是我们的首选。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="9d43" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">WebSocket服务器</h1><p id="3f73" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">服务器的代码非常简单。而且因为不想多此一举，我们就用<code class="fe ns nt nu nv b">gobwas</code>模块。</p><p id="99eb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是运行在端口8080上的WebSocket服务器的代码</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="1215" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">服务器除了等待连接、打印接收到的数据并最终发回一条消息(随机整数)之外什么也不做。</p><p id="4980" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果一个客户端断开连接(或者有人停止了程序)，它将打印一个关于这个断开连接的信息。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="e771" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">WebSocket客户端</h1><p id="d388" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">客户端的代码是类似的。同样，我们将使用<code class="fe ns nt nu nv b">gobwas</code>模块。</p><p id="559a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">客户端通过端口8080连接到本地主机。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw nx l"/></div></figure><p id="eff5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个客户端除了连接、发送消息(随机整数)和打印发送回来的内容之外，没有做任何特别的事情。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="d18f" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">测试通信</h1><p id="2b04" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">我同时负责这两个项目。</p><p id="a701" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在左侧，您可以看到服务器结果。<br/>右边，客户端结果。</p><p id="c4c7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一张图片胜过千言万语。不管是gif还是几百万字。</p><p id="68e3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/6bc5cf45b820adefe70b1f6337f6050d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*o37OflV9fCglrFsLify3zQ.gif"/></div></div></figure><p id="0d4b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">客户端每5秒钟向服务器发送一个随机数。服务器用另一个随机数作出响应。</p><p id="2bf9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">仅此而已。两个程序之间的通信。完成了。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="5e41" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您停止服务器，您将在客户端看到服务器已断开连接。如果您再次启动服务器，客户端会再次连接。</p><p id="1f6c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你可以期待同样的行为以另一种方式出现。如果您停止客户端，服务器将打印一条消息，表明客户端已断开连接。如果您再次运行客户端，它会再次连接。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="d670" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">结果</h1><p id="4b4b" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">因为Go大量用于服务和/或微服务，所以在这些服务之间进行通信是有意义的。</p><p id="847c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">WebSockets对一些应用程序结构有用，对另一些则没用，但是在你的口袋里有一个工具，知道你如何使用它总是好的。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="8168" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">码头工人小费</h1><p id="9dcb" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">一个提示，如果你正在使用Docker(就像我们经常使用的那样):你可以创建一个Docker服务器服务(例如，用一个名字<code class="fe ns nt nu nv b">ws-server</code>)，运行在端口8080和Docker客户端服务上。</p><p id="c4cd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过使用Docker Compose文件，客户端可以连接到<code class="fe ns nt nu nv b">ws://ws-server:8080/</code>，而无需知道正确的ip地址。</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><h1 id="0110" class="mv mw it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">更新</h1><p id="fe21" class="pw-post-body-paragraph ky kz it la b lb nn ju ld le no jx lg lh np lj lk ll nq ln lo lp nr lr ls lt im bi translated">这里有一篇关于普通套接字通信的文章。</p><p id="8778" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><a class="ae nz" href="https://petrjahoda.medium.com/plain-socket-communication-between-two-go-programs-the-easy-way-bd5ac5819eb6" rel="noopener">https://petrjahoda . medium . com/plain-socket-communication-between-two-go-programs-the-easy-way-bd5ac 5819 EB 6</a></p></div></div>    
</body>
</html>