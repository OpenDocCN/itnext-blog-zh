<html>
<head>
<title>Write Azure Functions in *any* language with the HTTP Worker (Custom Handler)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HTTP Worker(自定义处理程序)用*any*语言编写Azure函数</h1>
<blockquote>原文：<a href="https://itnext.io/write-azure-functions-in-any-language-with-the-http-worker-34d01f522bfd?source=collection_archive---------2-----------------------#2020-03-18">https://itnext.io/write-azure-functions-in-any-language-with-the-http-worker-34d01f522bfd?source=collection_archive---------2-----------------------#2020-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/df0ce6ee1b4cad17e17f19a459b6e665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLV2pHoc3ZHYoGbw7HQ96A.png"/></div></div></figure><div class=""/><p id="aba8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Azure Functions主机运行时中的一个新的实验性特性现在允许你<em class="kw">自带api </em>并将其与Azure Function triggers &amp;绑定挂钩。这个特性被称为“HTTP Worker”，本质上是作为函数绑定和代码之间的代理层。在这里玩的回购样本:<a class="ae kx" href="https://github.com/damoodamoo/azure-func-go-java" rel="noopener ugc nofollow" target="_blank">https://github.com/damoodamoo/azure-func-go-java</a>。</p><p id="56cc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">这是刚刚公开宣布的——参见此处</em> <a class="ae kx" href="https://docs.microsoft.com/en-gb/azure/azure-functions/functions-custom-handlers" rel="noopener ugc nofollow" target="_blank"> <em class="kw">的文档</em> </a> <em class="kw">和此处</em>  <em class="kw">的官方回购样本。</em></p><h2 id="b21c" class="ky kz jb bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">情节</h2><p id="591f" class="pw-post-body-paragraph jy jz jb ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">假设你真的很喜欢<strong class="ka jc"> Go </strong>，它已经成为你的团队/组织的标准语言。然而，当谈到Azure函数时，目前只支持C# / Python / Java &amp; PowerShell。不去。你是做什么的？现在你可以简单地编写一个标准的Go API，让主机运行时启动它，然后通过HTTP Worker从函数中调用它。</p><p id="8caf" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，假设你是一家Java公司，Java 11 / Spring是你所有web项目的标准。要用Java编写函数，你目前只能使用Java 8，而且你必须经历一些困难才能使用Spring。你可能还会担心你正在编写的代码会把你和Azure函数捆绑在一起。现在——再一次——您只需创建您的bog标准Spring API，然后让函数宿主启动它，并调用它。</p><h2 id="5ea0" class="ky kz jb bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">怎么做:你好，世界</h2><p id="2473" class="pw-post-body-paragraph jy jz jb ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">开始行动出奇的简单。让我们制作一个Go示例:</p><ol class=""><li id="15bb" class="lw lx jb ka b kb kc kf kg kj ly kn lz kr ma kv mb mc md me bi translated">确保您使用的是最新的功能核心工具:</li></ol><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="f063" class="ky kz jb mk b gy mo mp l mq mr">$&gt; npm i -g <strong class="mk jc">azure-functions-core-tools</strong>@core — unsafe-perm true</span></pre><p id="94e3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.创建一个新的目录并初始化一个函数项目(我使用的是WSL，但这无关紧要):</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="0448" class="ky kz jb mk b gy mo mp l mq mr">$&gt; mkdir go-func<br/>$&gt; cd go-func<br/>$&gt; func init --docker </span></pre><p id="654c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.选择<code class="fe ms mt mu mk b">node</code>作为运行时间。我们实际上不会使用node，但它只是使构建/部署更加简单，因为C#有一个不同的机制。</p><p id="6c76" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.使用核心工具创建一个函数。这只是创建了一个模板文件，没什么特别的:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="6a9c" class="ky kz jb mk b gy mo mp l mq mr">$&gt; func new </span></pre><p id="d7dc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按照提示选择<code class="fe ms mt mu mk b">HTTP trigger</code>，并给它起个名字(我们选<code class="fe ms mt mu mk b">hello-world</code>)。我们并不局限于HTTP触发的函数，但是对于我们的第一个函数来说，这是最简单的。</p><p id="80d1" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">5.打开项目—我使用VS代码，但是任何IDE都可以。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="78b3" class="ky kz jb mk b gy mo mp l mq mr">$&gt; code .</span></pre><p id="5e10" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">6.删除<code class="fe ms mt mu mk b">hello-world</code>文件夹中的<code class="fe ms mt mu mk b">index.js</code>文件。现在我们有一个空的函数项目和一个函数绑定文件。我们现在可以构建我们的API了。</p><p id="7305" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">7.构建REST API，使用一个名为<code class="fe ms mt mu mk b">hello-world</code>的端点。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="4b32" class="ky kz jb mk b gy mo mp l mq mr">func helloWorld(w http.ResponseWriter, r *http.Request){<br/>   // doesn't matter what it does here...<br/>}</span><span id="3595" class="ky kz jb mk b gy mv mp l mq mr">...</span><span id="2b13" class="ky kz jb mk b gy mv mp l mq mr">func main() {</span><span id="a3ad" class="ky kz jb mk b gy mv mp l mq mr">   mux := http.NewServeMux()</span><span id="78f3" class="ky kz jb mk b gy mv mp l mq mr">   // routes<br/>   mux.HandleFunc("/hello-world", helloWorld)</span><span id="0234" class="ky kz jb mk b gy mv mp l mq mr">   ...</span><span id="b3a0" class="ky kz jb mk b gy mv mp l mq mr">}</span></pre><p id="5166" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要复制更完整的示例，请参见该文件:<a class="ae kx" href="https://github.com/damoodamoo/azure-func-go-java/blob/master/go/go-http-server/shopping-list-api.go" rel="noopener ugc nofollow" target="_blank"> shopping-list-api.go </a>。</p><p id="3bef" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">8.确保REST API运行在由环境变量<code class="fe ms mt mu mk b">FUNCTIONS_HTTPWORKER_PORT</code>指定的端口上。对于围棋来说，这意味着<code class="fe ms mt mu mk b">main</code>中的这段代码:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="be89" class="ky kz jb mk b gy mo mp l mq mr">httpPort, _:= os.LookupEnv("FUNCTIONS_HTTPWORKER_PORT")<br/>http.ListenAndServe(":"+httpPort, mux)</span></pre><p id="a5c3" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，您应该能够完全独立于函数来构建和运行您的API:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="eeac" class="ky kz jb mk b gy mo mp l mq mr">$&gt; env GOOS=your-os GOARCH=your-arch go build ./path/to/go-api<br/>$&gt; export FUNCTIONS_HTTPWORKER_PORT=8080<br/>$&gt; go run ./path/to/go-api<br/># now you can curl http://localhost:8080/hello-world</span></pre><p id="5d4f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">9.在<code class="fe ms mt mu mk b">host.json</code>中引用。这告诉宿主运行时启动您的api。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="9913" class="ky kz jb mk b gy mo mp l mq mr">{<br/>  "version": "2.0",<br/>  "httpWorker": {<br/>   "description": {<br/>      "defaultExecutablePath": "./path/to/built/go-api/[.exe]"<br/>    }<br/>  }<br/>}</span><span id="f7a8" class="ky kz jb mk b gy mv mp l mq mr">...</span></pre><p id="88f8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">工作示例见<a class="ae kx" href="https://github.com/damoodamoo/azure-func-go-java/blob/master/host-go.json" rel="noopener ugc nofollow" target="_blank"> host-go.json </a>。</p><p id="5d20" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用Go很简单，因为它是独立运行的——但是像java这样的东西就需要了(注意<code class="fe ms mt mu mk b">arguments</code>和<code class="fe ms mt mu mk b">defaultExecutablePath</code>的额外参数)</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ff1c" class="ky kz jb mk b gy mo mp l mq mr">"httpWorker": {<br/>  "description": {<br/>    "arguments": ["-jar"],<br/>    "defaultExecutablePath": "java",<br/>    "defaultWorkerPath": "path/to/my.jar"<br/>  }<br/>}</span></pre><p id="4ff8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">10.启动功能！</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7566" class="ky kz jb mk b gy mo mp l mq mr">$&gt; func start</span></pre><p id="f442" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您将在启动日志中看到一些有趣的事情:</p><p id="af27" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将函数端点映射到api(按名称):</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/5a07561e976ec0d33045cf5dc8e0fec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dknue1JmHuJxY57piCLIDA.png"/></div></div></figure><p id="b356" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">启动您的API:</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mx"><img src="../Images/90a30396703feeb009646d67b55e55f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UW4FuiLnp_U9YG6I0jfUew.png"/></div></div></figure><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/da89ff8af109d74e9dcefd623a15e478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWJGVgdGz2UIKyR1QKlW-A.png"/></div></div></figure><p id="2997" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">对于Java Spring API，您将看到熟悉的…</p><figure class="mf mg mh mi gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/4bf1be7c7daefe683e19ea4910cc61c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lSCrDu7BZZ6N0FTSH-PL2Q.png"/></div></div></figure><p id="35fc" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">11.发挥你的作用:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="13d7" class="ky kz jb mk b gy mo mp l mq mr">$&gt; curl http://localhost:7071/api/hello-world</span></pre><h2 id="4f22" class="ky kz jb bd la lb lc dn ld le lf dp lg kj lh li lj kn lk ll lm kr ln lo lp lq bi translated">总结和下一步…</h2><p id="d1db" class="pw-post-body-paragraph jy jz jb ka b kb lr kd ke kf ls kh ki kj lt kl km kn lu kp kq kr lv kt ku kv ij bi translated">希望这能让你开始。我们只讨论了最基本的内容，现在您可能想深入了解:</p><ul class=""><li id="ec99" class="lw lx jb ka b kb kc kf kg kj ly kn lz kr ma kv na mc md me bi translated"><a class="ae kx" href="https://medium.com/@damoo/azure-functions-http-worker-bindings-and-schemas-f32f126a3654" rel="noopener">概述不同的绑定、请求/响应模式</a>，以及</li><li id="47dc" class="lw lx jb ka b kb nb kf nc kj nd kn ne kr nf kv na mc md me bi translated"><a class="ae kx" href="https://medium.com/@damoo/debugging-your-azure-function-when-using-the-http-worker-3dcfabff4f16" rel="noopener">调试</a>。</li></ul></div></div>    
</body>
</html>