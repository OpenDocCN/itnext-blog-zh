<html>
<head>
<title>Firebase Functions Helper — an Improved Method to Work with Cloud Firestore</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase Functions Helper —一种改进的云Firestore使用方法</h1>
<blockquote>原文：<a href="https://itnext.io/firebase-functions-helper-an-improved-method-to-work-with-cloud-firestore-9b5d116452cc?source=collection_archive---------1-----------------------#2018-05-25">https://itnext.io/firebase-functions-helper-an-improved-method-to-work-with-cloud-firestore-9b5d116452cc?source=collection_archive---------1-----------------------#2018-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7210971ba0ea87db28867e8f9e199fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RRHnSIV4giXh_WKd25-5RA.jpeg"/></div></div></figure><p id="c4fc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你正在阅读这篇文章，这意味着你知道什么是云Firestore。如果你不知道，请阅读<a class="ae kw" href="https://firebase.google.com/docs/firestore/" rel="noopener ugc nofollow" target="_blank">Google Firestore Docs</a>——它基本上只是一个云托管的NoSQL数据库。</p><p id="1ff7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">老实说，我真的很喜欢使用Firestore，尤其是通过实时监听器跨客户端应用程序同步的能力，甚至是对移动和网络的离线支持。<em class="kx">请注意，在撰写本文时，Cloud Firestore目前处于测试版。</em></p><p id="66da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然我喜欢与Firestore合作，但谷歌团队需要改进的功能很少，例如<a class="ae kw" href="https://github.com/dalenguyen/firestore-backup-restore" rel="noopener ugc nofollow" target="_blank">备份和恢复firestore </a>。实时数据库已经实现了这一点。更重要的是，每当我需要做一些事情时，这个查询就有点重复我自己，我不喜欢重复我自己。</p><p id="8d75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以我写了一个NPM包，减少了代码行，改进了它们所缺乏的特性。</p><div class="ky kz gp gr la lb"><a href="https://www.npmjs.com/package/firebase-functions-helper" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd ir gy z fp lg fr fs lh fu fw ip bi translated">消防基地-功能-助手</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">用于Firebase云函数的辅助NPM包</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">www.npmjs.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp jw lb"/></div></div></a></div><p id="4828" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请记住，该项目仍处于开发过程中。如果要在生产中使用这个，风险自担。</p><p id="e0f8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看如何从Firestore docs获取文档</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="ec9e" class="lz ma iq lv b gy mb mc l md me">var docRef = db.collection("cities").doc("SF");<br/><br/>docRef.get().then(function(doc) {<br/>    if (doc.exists) {<br/>        console.log("Document data:", doc.data());<br/>    } else {<br/>        // doc.data() will be undefined in this case<br/>        console.log("No such document!");<br/>    }<br/>}).catch(function(error) {<br/>    console.log("Error getting document:", error);<br/>});</span></pre><p id="4e4a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我想当你想得到另一份文件时，你必须重复所有的事情。现在让我们来看看从<a class="ae kw" href="https://github.com/dalenguyen/firebase-functions-helper" rel="noopener ugc nofollow" target="_blank"> firebase functions helper </a>获取文档的过程</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="e178" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.getDocument(db, 'collection-name', 'document-id')<br/>.then(doc =&gt; console.log(doc));</span></pre><p id="b3ac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这在我的情况下要干净得多，我已经为你做了所有的捕捉工作；)</p><p id="0b2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你仍然对这个项目感兴趣。请尝试一下，报告错误并在<a class="ae kw" href="https://github.com/dalenguyen/firebase-functions-helper/issues" rel="noopener ugc nofollow" target="_blank">问题跟踪器</a>中提出功能请求，派生并创建拉式请求！</p><ol class=""><li id="eb3b" class="mf mg iq ka b kb kc kf kg kj mh kn mi kr mj kv mk ml mm mn bi translated"><strong class="ka ir">安装Firebase函数助手</strong></li></ol><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="fe88" class="lz ma iq lv b gy mb mc l md me">npm install firebase-functions-helper</span></pre><p id="1838" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.<strong class="ka ir">初始化Firebase应用程序</strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="4c5d" class="lz ma iq lv b gy mb mc l md me">const firebaseHelper = require('firebase-functions-helper'); <br/>const serviceAccount = require('./serviceAccountKey.json');  </span><span id="084b" class="lz ma iq lv b gy mo mc l md me">// Initialize Firebase App <br/>const app = firebaseHelper.initializeApp(serviceAccount, databaseURL);  </span><span id="c11c" class="lz ma iq lv b gy mo mc l md me">// Get Firestore DB <br/>const db = app.firestore;</span></pre><p id="18c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">准备好firestore后，您可以对该包做很多事情，例如:</p><p id="c46e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.1获取Firestore收藏与子收藏</em> </strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="0c81" class="lz ma iq lv b gy mb mc l md me">// Start exporting your collection <br/>firebaseHelper.firestore<br/>.backup(db, 'collection-name', 'sub-collection-optional')<br/>.then(data =&gt; console.log(JSON.stringify(data)))</span></pre><p id="5d6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有了这个特性，您可以从一个集合中获取并遍历所有文档</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="453e" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.backup(db, 'collection-name')<br/>.then(data =&gt; {         <br/>  let docs = data['collection-name'];     <br/>  for (const key in docs) {         <br/>     if (docs.hasOwnProperty(key)) {                         <br/>       console.log('Doc id: ', key);             <br/>       console.log('Document data: ', docs[key])                             <br/>     }     <br/>  } <br/>})</span></pre><p id="5c44" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.2导入数据到firestore </em> </strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="fd15" class="lz ma iq lv b gy mb mc l md me">// Start exporting your data <br/>firebaseHelper.firestore.restore(db, 'your-file-path.json');</span></pre><p id="d879" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">JSON的格式如下。集合名称为<strong class="ka ir">测试</strong>。<strong class="ka ir">第一键</strong>和<strong class="ka ir">第二键</strong>为文件id。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="6f43" class="lz ma iq lv b gy mb mc l md me">{<br/>  "test" : {<br/>    "first-key" : {<br/>      "email"   : "dungnq@itbox4vn.com",<br/>      "website" : "dalenguyen.me",<br/>      "custom"  : {<br/>        "firstName" : "Dale",<br/>        "lastName"  : "Nguyen"<br/>      }<br/>    },<br/>    "second-key" : {<br/>      "email"   : "test@dalenguyen.me",<br/>      "website" : "google.com",<br/>      "custom"  : {<br/>        "firstName" : "Harry",<br/>        "lastName"  : "Potter"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="6342" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.3在firestore中创建id为的文档</em> </strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="08f0" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.createDocumentWithID(db, 'collection-name', 'document-id', data);</span></pre><p id="30ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.4新建一个没有ID的文档</em> </strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="ff56" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.creatNewDocument(db, 'collection-name', data);</span></pre><p id="8dd4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">2.5<em class="kx">更新一个文档</em>T7】</strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="6221" class="lz ma iq lv b gy mb mc l md me">let data = {key: value}; <br/>firebaseHelper.firestore<br/>.updateDocument(db, 'collection-name', 'document-id', data);</span></pre><p id="b2a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.6删除文档</em> </strong></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="4aef" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.deleteDocument(db, 'collection-name', 'document-id');</span></pre><p id="666a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.7检查单据是否存在</em> </strong></p><p id="b02a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将返回一个承诺<boolean/></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="86a2" class="lz ma iq lv b gy mb mc l md me">firebaseHelper.firestore<br/>.checkDocumentExists(db, 'collection-name', 'document-id')<br/>.then(exists =&gt; console.log(exists));</span></pre><p id="149a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="kx"> 2.8从firestore查询数据</em> </strong></p><p id="4661" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将返回一份承诺<array>的文件</array></p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="27c0" class="lz ma iq lv b gy mb mc l md me">// Search for data ( &lt;, &lt;=, ==, &gt;, or &gt;= ) <br/>const queryArray = ['website', '==', 'dalenguyen.me']; firebaseHelper.firestore<br/>.queryData(db, 'collection-name', queryArray)<br/>.then(docs =&gt; console.log(docs));</span></pre><p id="ea55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你对此感兴趣，请查看我的github资源库的更新:<a class="ae kw" href="https://github.com/dalenguyen/firebase-functions-helper" rel="noopener ugc nofollow" target="_blank">https://github.com/dalenguyen/firebase-functions-helper</a></p></div></div>    
</body>
</html>