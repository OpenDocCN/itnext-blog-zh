<html>
<head>
<title>Azure DevOps and React Native UI testing part 2 - Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure DevOps和React原生UI测试第2部分- Android</h1>
<blockquote>原文：<a href="https://itnext.io/azure-devops-and-react-native-ui-testing-part-2-android-580c44d8c7ec?source=collection_archive---------2-----------------------#2020-06-17">https://itnext.io/azure-devops-and-react-native-ui-testing-part-2-android-580c44d8c7ec?source=collection_archive---------2-----------------------#2020-06-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f92c3d7caa9d37e0f89b37565a1d7bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5Q-PkjHnA-FVKyCAySXHg.jpeg"/></div></div></figure><p id="27fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/azure-devops-and-react-native-ui-testing-8144ba1a9eb"> Azure DevOps和React Native UI测试中</a>描述了如何使用Azure DevOps实现iOS应用的UI测试。但Azure DevOps并不仅限于iOS，它还可以对android应用程序进行UI测试。</p><h1 id="4fdf" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">入门指南</h1><p id="3f34" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">类似于iOS实现，只需要做几个步骤就可以实现android应用的UI测试。要开始，您需要:</p><ul class=""><li id="e7d9" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">集成了<a class="ae kw" href="https://github.com/rumax/react-native-PixelsCatcher" rel="noopener ugc nofollow" target="_blank">像素捕捉器</a>的工作项目</li><li id="9b0d" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><a class="ae kw" href="https://azure.com" rel="noopener ugc nofollow" target="_blank"> Azure账户</a></li><li id="5085" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">azure如何工作以及什么是<a class="ae kw" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema%2Cparameter-schema" rel="noopener ugc nofollow" target="_blank"> YAML模式</a>的基本知识</li></ul><h1 id="2d29" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">使用NodeJS并安装NPM依赖项</h1><p id="47b2" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果项目需要特定版本的NodeJS，请使用NodeTool@0任务定义它:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="96ba" class="mx ky iq mt b gy my mz l na nb">- task: NodeTool@0<br/>  displayName: 'Use Node 12.x'<br/>  inputs:<br/>    versionSpec: '12.x'</span></pre><p id="4e55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">并安装NPM依赖项:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="209f" class="mx ky iq mt b gy my mz l na nb">- script: npm install<br/>  displayName: 'NPM Install'</span></pre><h1 id="fdec" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建Android模拟器</h1><p id="3968" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">要运行UI测试，有必要准备android模拟器，这可以很容易地通过Azure DevOps和Android模拟器手册上的<a class="ae kw" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/ecosystems/android?view=azure-devops#test-on-the-android-emulator" rel="noopener ugc nofollow" target="_blank">测试来完成，方法是将脚本添加到项目中，比如说添加到<code class="fe nc nd ne mt b">scripts/create_android_emulator.sh </code>并定义步骤:</a></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="edac" class="mx ky iq mt b gy my mz l na nb">- script: ./scripts/create_android_emulator.sh<br/>  displayName: 'Create and start Android Emulator'</span></pre><p id="306d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将创建并启动一个android模拟器。这意味着环境已经准备好进行测试了。</p><h1 id="2a31" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">编译和运行UI测试</h1><p id="0303" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">对此几乎没有选择:</p><ul class=""><li id="db28" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">使用预定义的<code class="fe nc nd ne mt b">Gradle</code>任务编译和构建应用程序</li><li id="433e" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">使用命令行和<a class="ae kw" href="https://github.com/rumax/react-native-PixelsCatcher/blob/master/demo/run_android_debug.sh" rel="noopener ugc nofollow" target="_blank"> bash脚本</a>，在一个步骤中编译和运行测试:</li></ul><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="387d" class="mx ky iq mt b gy my mz l na nb">- script: ./run_android_debug.sh<br/>  displayName: 'Run tests'<br/>  workingDirectory: '$(Build.SourcesDirectory)/demo'</span></pre><h1 id="7eb4" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发布测试结果</h1><p id="1b27" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">执行完所有测试并生成JUnit测试报告后，就该上传结果了。这可以通过PublishTestResults@2任务来完成:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="e1b9" class="mx ky iq mt b gy my mz l na nb">- task: PublishTestResults@2<br/>  condition: succeededOrFailed()<br/>  inputs:<br/>    testRunner: JUnit<br/>    testResultsFiles: '$(Build.SourcesDirectory)/junit.xml'</span></pre><p id="eac5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果可以在Azure测试概述中查看:</p><figure class="mo mp mq mr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/4ff8c5df98b638ea0815b3856e6c3452.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3fYpRJY8YnTU5mhzNG6Ew.png"/></div></div></figure><h1 id="6d9d" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">发布工件</h1><p id="ab34" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">可以完成的最后一步是将结果发布到管道工件。如果一些测试失败，这是很方便的，并且可以准确地知道什么是错误的以及组件/屏幕是如何呈现的:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="007a" class="mx ky iq mt b gy my mz l na nb">- publish: $(Build.SourcesDirectory)/snapshots/android<br/>  condition: failed()<br/>  artifact: screenshots_android<br/>  displayName: 'Test results'</span></pre><h1 id="bfd0" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="c61c" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">仅此而已！另外30行代码的YAML模式和Android UI测试是完全自动化的，并成为持续交付的一部分，使项目更加稳定，可预测，并使其有可能在源代码发生任何变化后向您的用户交付像素级完美的应用程序。</p></div></div>    
</body>
</html>