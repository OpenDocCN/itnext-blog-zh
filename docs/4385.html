<html>
<head>
<title>Flutter State Management with Mobx and Providers : Change App Theme Dynamically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mobx和提供商的颤振状态管理:动态改变应用程序主题</h1>
<blockquote>原文：<a href="https://itnext.io/flutter-state-management-with-mobx-and-providers-change-app-theme-dynamically-ba3b60619050?source=collection_archive---------0-----------------------#2020-06-21">https://itnext.io/flutter-state-management-with-mobx-and-providers-change-app-theme-dynamically-ba3b60619050?source=collection_archive---------0-----------------------#2020-06-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="0f27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Flutter中的状态管理就像一个迷宫，你可能很容易在InheritedWidget、ScopedModel、Redux、BloC、Mobx和许多其他库之间迷失。选择一个是非常困难的，尤其是当你刚刚开始使用Flutter的时候。这是我的案例，经过反复试验，我偶然发现了Mobx并爱上了它。</p><h2 id="52b3" class="ko kp it bd kq kr ks dn kt ku kv dp kw kb kx ky kz kf la lb lc kj ld le lf lg bi translated">Mobx状态管理解释道:</h2><p id="258e" class="pw-post-body-paragraph jq jr it js b jt lh jv jw jx li jz ka kb lj kd ke kf lk kh ki kj ll kl km kn im bi translated">Mobx是什么？</p><blockquote class="lm ln lo"><p id="b770" class="jq jr lp js b jt ju jv jw jx jy jz ka lq kc kd ke lr kg kh ki ls kk kl km kn im bi translated">【Dart和Flutter应用的无故障状态管理</p></blockquote><p id="588f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Mobx使得将UI与您的反应数据连接起来变得非常容易。如果你有兴趣阅读更多关于Mobx如何工作的内容，你可以去官方文档(链接)。但简而言之，我们可以这样说:</p><ul class=""><li id="5c31" class="lt lu it js b jt ju jx jy kb lv kf lw kj lx kn ly lz ma mb bi translated">UI(或观察者)将触发一个动作</li><li id="235d" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">该动作将触发可观察到的突变</li><li id="6abf" class="lt lu it js b jt mc jx md kb me kf mf kj mg kn ly lz ma mb bi translated">UI将对可观察对象的变化做出反应。</li></ul><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/0ce894a1e8d381d71fd71925638bf322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*rKoivG_L2zsWmIhi0k6P4A.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">Mobx的概念</figcaption></figure></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="d83a" class="ko kp it bd kq kr ks dn kt ku kv dp kw kb kx ky kz kf la lb lc kj ld le lf lg bi translated">Mobx入门:</h2><p id="ca53" class="pw-post-body-paragraph jq jr it js b jt lh jv jw jx li jz ka kb lj kd ke kf lk kh ki kj ll kl km kn im bi translated">要使用Mobx，您需要将这些依赖项添加到您的Flutter项目中:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi na"><img src="../Images/32a80d3908f71d29fefe29011297d5fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*_ZSUSMn2u4W3WFQDPYNZuQ.png"/></div></figure><p id="32ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将需要提供者包。这个包将允许我们在小部件树中注入我们的Mobx存储。这种方法比使用Singleton更好，因为一旦不再使用小部件，提供者将自动处理我们的存储。这可能会派上用场，尤其是在大型项目中。<br/>大概就是这样。现在我们需要定义保存状态的商店，但是首先，我们需要创建我们的应用程序和UI。</p><h2 id="4ed0" class="ko kp it bd kq kr ks dn kt ku kv dp kw kb kx ky kz kf la lb lc kj ld le lf lg bi translated">创建应用程序:</h2><p id="1ec0" class="pw-post-body-paragraph jq jr it js b jt lh jv jw jx li jz ka kb lj kd ke kf lk kh ki kj ll kl km kn im bi translated">我们今天要创建的应用程序是一个非常简单的应用程序，只有一个功能:改变应用程序的全局主题。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ea584ace7eefc1ff16ced889087885f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/1*B-DhmYfepcU5MNmQmFyRsA.gif"/></div></figure><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/81bc66843b1f5c76ec67879fe959c857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_noR_dVTQ4zKpJ66oMOLw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">主.镖</figcaption></figure><p id="d727" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你从上面的动画图像中看到的，当我们按下单选按钮时，什么也没有发生。我们想要做的是将我们的状态与我们的UI挂钩，并让它对变化做出反应。</p><p id="c1c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为此，我们需要创建主题商店。主题商店将暂时代表我们应用程序的状态。请注意，对于较大的项目，您可能希望根据使用情况将您的状态分成多个存储。一个更好的实现应该使用像MVVM(模型-视图-视图模型)这样的原则。</p><p id="1c74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Mobx让我们能够使用代码生成来为我们的代码生成样板文件，我们所要做的就是使用注释:<strong class="js iu"> <em class="lp"> @action </em> </strong>，<strong class="js iu"> <em class="lp"> @observable </em> </strong>和<strong class="js iu"> <em class="lp"> @computed </em> </strong>，Mobx代码生成器会处理剩下的事情。</p><p id="67b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于<strong class="js iu"> <em class="lp"> @computed </em> </strong>来说，这就是Mobx创建者所说的派生状态，这意味着一个computed的值不会直接受到动作的影响，而是一个或多个可观察值发生变化的结果。</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/7a05f64b44da89673296e034bdde10e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tVgPFqHehAjzNWdRoYqSfw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">主题_商店.镖</figcaption></figure><p id="15b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是通过键入以下命令来运行代码生成器:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ni"><img src="../Images/c62b427322a0512544bf335bca60b86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLxSUx9A28XSwGGgIyYvJA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">生成Mobx代码的命令</figcaption></figure><p id="9373" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">命令完成后(通常需要几秒钟完成)，您会注意到Mobx为我们生成了一个名为theme_store.g.dart的新文件</p><p id="3cd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经读取了状态存储，并使用Mobx代码生成器生成了代码，剩下要做就是像这样把它们连接起来:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nj"><img src="../Images/da3745866c2bdafb9fe94a432bd045ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFT0grXC9JJ2bEc6sqO3Dg.png"/></div></div></figure><p id="9fa3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你从上面的代码中看到的，我们有了一个名为<strong class="js iu"> <em class="lp"> Observer </em> </strong>的新小部件。每当我们的状态(可观察的/计算的)发生变化时，Mobx就会使用这个小部件在Observer的构建方法中触发重建。</p><p id="840b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后的结果是:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/1a9cc7af7150f110beac2339bb7c5cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/1*C3MoItxN3ItQgFvI1KY7wQ.gif"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">决赛成绩</figcaption></figure><h2 id="0f6b" class="ko kp it bd kq kr ks dn kt ku kv dp kw kb kx ky kz kf la lb lc kj ld le lf lg bi translated"><strong class="ak">从不同页面更改主题:</strong></h2><p id="92e8" class="pw-post-body-paragraph jq jr it js b jt lh jv jw jx li jz ka kb lj kd ke kf lk kh ki kj ll kl km kn im bi translated">如果我们想改变另一个页面的主题呢？一个简单的解决方案是沿着部件树注入我们的状态存储，但是如果我们有多个状态存储呢？这样做不是很大的项目可能会有一些非常严重的性能问题，调试变得非常困难，老实说，这不是很好。</p><blockquote class="lm ln lo"><p id="ba85" class="jq jr lp js b jt ju jv jw jx jy jz ka lq kc kd ke lr kg kh ki ls kk kl km kn im bi translated">救援提供者</p></blockquote><p id="2520" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一个更优雅的解决方案是Mobx + Provider，Provider包允许我们注入我们的存储，并从我们的widget树的任何地方检索它们。下面的代码演示了我们如何做到这一点。</p><p id="bbb3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要做的第一件事是将提供者包依赖项添加到我们的项目中:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/ef3bb03e311e62a148e8aa42b6bd229a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*Qtvm4AsRU-rTtoxdMVwnSw.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">提供商依赖性</figcaption></figure><p id="4457" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们需要使用Provider在我们的小部件树中注入我们的Mobx存储。作为一个习惯，我总是使用MultipleProvier，并且在应用程序的根目录下注入我所有的存储。要沿着小部件树检索我们的商店，提供者有三种方法:</p><blockquote class="lm ln lo"><p id="d273" class="jq jr lp js b jt ju jv jw jx jy jz ka lq kc kd ke lr kg kh ki ls kk kl km kn im bi translated"><code class="fe nl nm nn no b">context.watch&lt;T&gt;()</code>，让小工具监听<code class="fe nl nm nn no b">T</code>上的变化</p><p id="6dfe" class="jq jr lp js b jt ju jv jw jx jy jz ka lq kc kd ke lr kg kh ki ls kk kl km kn im bi translated"><code class="fe nl nm nn no b">context.read&lt;T&gt;()</code>，不听就返回<code class="fe nl nm nn no b">T</code></p><p id="c7fe" class="jq jr lp js b jt ju jv jw jx jy jz ka lq kc kd ke lr kg kh ki ls kk kl km kn im bi translated"><code class="fe nl nm nn no b">context.select&lt;T, R&gt;(R cb(T value))</code>，允许一个widget只监听<code class="fe nl nm nn no b">T</code>的一小部分。</p></blockquote><p id="f693" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的新代码将如下所示:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi np"><img src="../Images/9df497199155a237d4e41b3e7914f755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dr1_TuhK5oABpLYu4D75lw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">主.镖</figcaption></figure><p id="87a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最终结果应该是这样的:</p><figure class="mi mj mk ml gt mm gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nq"><img src="../Images/4383f69c4298b3e78548a7cdabbcb623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*8KDdEP-KS2NCITYOkb1Jjw.gif"/></div></div></figure><h2 id="f62d" class="ko kp it bd kq kr ks dn kt ku kv dp kw kb kx ky kz kf la lb lc kj ld le lf lg bi translated">结论:</h2><p id="4573" class="pw-post-body-paragraph jq jr it js b jt lh jv jw jx li jz ka kb lj kd ke kf lk kh ki kj ll kl km kn im bi translated">在Flutter应用程序的状态管理解决方案的海洋中，Mobx是我的状态管理需求的首选解决方案。我发现它非常强大，非常容易使用，这使得Flutter开发成为一种非常愉快的体验。<br/>就这些了，你可以在下面的Github库中找到本文的完整代码。感谢您的阅读！</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><div class="mi mj mk ml gt nr"><a href="https://github.com/yiss/mobx_theme_provider" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">yiss/mobx_theme_provider</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">一个新的颤振项目。这个项目是颤振应用的起点。一些帮助您入门的资源…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of mn nr"/></div></div></a></div></div></div>    
</body>
</html>