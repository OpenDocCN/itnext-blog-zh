<html>
<head>
<title>Flipper — A React Native revolution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">鳍状肢——一场反动的本土革命</h1>
<blockquote>原文：<a href="https://itnext.io/flipper-a-react-native-revolution-4859d6acd685?source=collection_archive---------0-----------------------#2020-04-19">https://itnext.io/flipper-a-react-native-revolution-4859d6acd685?source=collection_archive---------0-----------------------#2020-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3fbe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想谈谈最近集成的React Native开发工具Flipper。我成为这个工具的超级粉丝，并相信它将是我们调试React本机应用程序的一场革命。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/edcba7b0feedb9e2ce441d40acdff735.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*J_e0EbExqfFm6_z4H0966w.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">鳍状肢+反应本土= ❤️</figcaption></figure><p id="678e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我深入研究Flipper本身之前，最好先了解一下我们今天使用的工具。</p><p id="8732" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">众所周知，开发者工具的选择非常“丰富多彩”,提供了许多不同的调试方法。</p><p id="5146" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我试着编译我在RN应用程序工作中使用的工具。</p><h2 id="1623" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">React本地开发人员工具</h2><p id="813f" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">我的第一个调试React Native的小步骤完全是用远程调试选项完成的。它使用Chrome DevTools作为调试/记录应用程序的接口。这个工作流程带来了我作为一名前web开发人员所希望的完美的开发体验。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/8aa1a971601b6d9c8deedb71c02eee81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LPwZ2Mm_QnPDRXQL8TpJYg.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">使用Chrome DevTools进行远程调试</figcaption></figure><p id="4e2c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">后来我发现，它和普通的网站用的Chrome DevTools不完全一样。没有网络日志，我不能使用devtools的许多内置功能，我的应用程序变得更慢。我无法检查我的redux状态或查看React组件树。如果我们回到我在网站上工作的经历，这有点糟糕。</p><p id="7847" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我寻找更好的工具时，我遇到了看起来非常相似的工具<a class="ae ma" href="https://github.com/jhen0409/react-native-debugger" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> React原生调试器</strong> </a>。它使用Chrome DevTools的电子版，但它启用了网络标签来记录所有网络请求(在JS中调用),并在此基础上添加了React + Redux DevTools。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mb"><img src="../Images/b3d4123d2f2abb77a8ce289b51dd895f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3fjEtjoFUG98wZC4woffw.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">React本机调试器又名React本机瑞士刀</figcaption></figure><p id="e3f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将是我的文章，我们如何找到一个最好的开发工具，很好的结尾。但是我的标题会有点误导，在现实生活中事情并不那么容易发生，不是吗？</p><h2 id="4003" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">什么是远程调试？</h2><p id="53d4" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">在使用远程调试一段时间后，我们不得不提出一个问题，问自己它实际上是如何工作的？</p><p id="c26b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总的来说，远程调试的工作方式非常简单，我们只需将JS代码的执行转移到不同的引擎上。运行引擎的进程是在我们自己的机器上启动的(不是在模拟器或真实设备中)。</p><p id="5857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，我们将在Chrome (V8)中运行JS，而不是使用JavascriptCore(这是默认的RN JS引擎)。并通过web socket连接从JS  Native发送所有命令。</p><p id="2b55" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这实际上听起来是一种很酷的调试方式。但是它有一个很大的缺陷，那就是环境本身。我们在一个引擎中运行我们的JS代码，它不会被我们的最终用户使用，这是一个很大的风险。迟早会有bug，我们错误地将它发布到产品中，而没有在远程调试选项关闭时测试代码。</p><blockquote class="mc md me"><p id="8e2e" class="jn jo mf jp b jq jr js jt ju jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj kk ij bi translated">请注意，目前正在讨论将社区转移到"<a class="ae ma" href="https://github.com/react-native-community/discussions-and-proposals/issues/206" rel="noopener ugc nofollow" target="_blank">直接调试</a>"</p></blockquote><h2 id="af0d" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">什么是“直接”调试？</h2><p id="7015" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">如果我们想停止使用远程调试，我们需要从React本地应用程序内部创建web套接字连接。</p><blockquote class="mc md me"><p id="06f1" class="jn jo mf jp b jq jr js jt ju jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj kk ij bi translated">基本上在这个原则上，当调试运行时没有直接访问时，所有的浏览器devtools工作，甚至反应Devtools。</p></blockquote><p id="5167" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法的第一个例子是<strong class="jp ir">反应堆晶体管</strong>。它在app和devtool之间创建自己的web socket连接。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mj"><img src="../Images/80be1503b911e0a5b30703a8f6449536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IoTlWT2k-WVDshMhFFJR0w.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">电抗器</figcaption></figure><p id="9d3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它有各种各样的工具，涵盖了最基本的用例。我想说这个工具提供了总体上非常愉快的体验。但它缺少一些其他工具，如React devtools或更高级的网络日志。</p><p id="c7fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我需要强调的一个想法是自定义命令，它允许用预定义的UI扩展Reactotron。因此，我们可以在我们的应用程序和Reactotron之间交换自定义命令。</p><p id="4dc9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后我想提一下尊贵的devtool，它不太为人所知，但自从React Native开始，它就一直伴随着我们。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mk"><img src="../Images/ddb690e99adae37c2c66475a90f6dd54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sq017sgs1kJP-ZI5oSesHQ.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Safari DevTool (Safari Web检查器)</figcaption></figure><p id="cbd5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它直接连接到JavascriptCore，所以我们可以访问运行时，所以它不需要远程调试。但是它只支持调试JS(源代码和概要分析器)和日志值。网络日志不可用。</p><blockquote class="mc md me"><p id="8846" class="jn jo mf jp b jq jr js jt ju jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj kk ij bi translated">根据我的经验，如果我们允许<a class="ae ma" href="https://blog.nparashuram.com/2019/10/debugging-react-native-ios-apps-with.html" rel="noopener ugc nofollow" target="_blank">内联源代码图</a>拥有更好的概要信息，整个运行时间将会大大降低，所以收集的数据并没有多大帮助。</p></blockquote><p id="030e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最大的难点之一是，每次我们重新加载软件包时，它都会创建一个新的窗口…所以这对于这个工具来说是一个很大的问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/306cec04dc0edb3b2ef4de77b5b51a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*Wk9xd4RJPPDYrRSvcu68fQ.gif"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">许多Safari Devtool窗口…</figcaption></figure><p id="f554" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这绝对不是我们可以使用的所有工具，Wix还有令人惊叹的工具<a class="ae ma" href="https://github.com/wix/DetoxInstruments" rel="noopener ugc nofollow" target="_blank">排毒仪器</a>，以及其他适用于iOS/Android的原生工具。</p><p id="4f92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">选择最好的工具并不容易。每一种都有它自己的局限性。我们没有简单的方法来开发这些工具。大多数时候，它涉及到派生我们自己的版本，并以“hacky”的方式添加更多的功能。</p><p id="462b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，调试React Native app的体验看起来就像一直在不同的工具之间周旋，并试图掌握它们…</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">引入工具来找出React本机应用程序性能中的回归问题</figcaption></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h2 id="acd4" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">鳍状肢</h2><p id="0d59" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">哦耶，它来了。我为冗长的介绍道歉。我相信大多数人都是为了这篇文章而来的。我只是想在介绍Flipper时创造正确的视角。</p><p id="7988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所谓的革命承诺。你可能会觉得我们已经拥有了所有需要的工具，为什么还要再增加一个呢？</p><p id="e213" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我简单介绍一下它默认包含的所有工具列表:</p><ul class=""><li id="d752" class="mv mw iq jp b jq jr ju jv jy mx kc my kg mz kk na nb nc nd bi translated">网络日志——与Chrome中的非常相似</li><li id="4f23" class="mv mw iq jp b jq ne ju nf jy ng kc nh kg ni kk na nb nc nd bi translated">日志—结合了<em class="mf"> console.log </em>，本地日志(ADB，IDB)</li><li id="491f" class="mv mw iq jp b jq ne ju nf jy ng kc nh kg ni kk na nb nc nd bi translated">React开发工具</li><li id="e846" class="mv mw iq jp b jq ne ju nf jy ng kc nh kg ni kk na nb nc nd bi translated">Hermes调试器——在Android上调试Hermes的简单方法</li><li id="c567" class="mv mw iq jp b jq ne ju nf jy ng kc nh kg ni kk na nb nc nd bi translated">和bunch more(主要集中在原生端)。</li></ul><p id="245f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与我使用的其他工具相比，这个列表已经有所不同了。最棒的是，所有这些都是预装的，所以您不必花时间添加任何内容。它就在那里等着你用。</p><p id="8080" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是老实说，仅仅是将这些工具结合在一起并不是我所说的革命。</p><p id="0308" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对我来说，革命在于脚蹼的延展性。它有一个非常相似的插件系统，就像我们从可视代码或Chrome中知道的那样。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nj"><img src="../Images/1e146e921a28410e0974b5d8f6d73005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ttk1bNue4zRYCZIwNFJCIA.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Flipper插件管理器(FPM)</figcaption></figure><blockquote class="mc md me"><p id="58f6" class="jn jo mf jp b jq jr js jt ju jv jw jx mg jz ka kb mh kd ke kf mi kh ki kj kk ij bi translated">也许将来我们都这样做:<strong class="jp ir"> fpm安装redux-devtools </strong></p></blockquote><p id="44b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着任何人都可以为Flipper贡献和发布插件。这使得这个工具非常强大。它实际上有无限的选择，我们现在可以做什么，并与他人分享。我仍然认为这个工具没有早点出现。当我有机会使用它时，它变得如此有意义。</p><p id="b99b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae ma" href="https://fbflipper.com/docs/features/index.html" rel="noopener ugc nofollow" target="_blank"> Flipper </a>网站已经很好地展示了所有的工具，所以我不会再浪费时间在这里做介绍了。</p><p id="9c11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看这个架构，看看我们如何能让这个工具变得更好。</p><h2 id="63ea" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">体系结构</h2><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nk"><img src="../Images/e9b022166fbca1c7fea1db188f5e49ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3XQ_QTkbXxe-JIhAHMc8Q.png"/></div></div><figcaption class="kt ku gj gh gi kv kw bd b be z dk translated">Flipper通信快速概述</figcaption></figure><p id="75eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们看一下上面的图表，我们可以看到三个主要部分。</p><p id="27e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先是我们在设备/模拟器上运行的应用程序。App本身由两部分组成<strong class="jp ir"> Javascript </strong>和<strong class="jp ir"> Native </strong> (Objective-C，Java)。Flipper插件既可以和JS端通信，也可以和native端通信。这取决于插件的类型。大部分时间React原生插件会在JS环境下运行。</p><p id="17b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">应用程序和Flipper桌面之间的所有通信都是通过本机端进行的，它维护RSocket连接。</p><p id="735f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就把我们带到了Flipper app本身，它负责发现所有正在运行的设备/模拟器，并显示插件的UI。Flipper应用程序是用React编写的，作为电子应用程序运行。它还使用ADB/IDB来收集日志并直接与设备通信。另一个沟通渠道是Metro packager。</p><p id="ab16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">地铁打包机是最后一部分。它能够获得控制台。日志和重新加载/切换应用程序中的开发菜单(+一堆其他东西)。</p><p id="772e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是Flipper架构的一个简要概述。它将帮助您更好地理解这个工具的潜力。</p><h2 id="0a36" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">脚蹼的未来</h2><p id="5f86" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">现在预测Flipper的未来还为时过早，但迄今为止我的期望很高。</p><p id="9200" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我真的迫不及待地想看到有多少新的插件将被添加，并看到反应原生社区的参与，这样我们就可以得到适当维护的插件。到目前为止，插件的体验并不完美，但Flipper团队正在努力改善这一点。</p><p id="1631" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Reactotron背后的团队刚刚发布了它的Flipper端口，这是另一个有希望的事实。这发出了一个强烈信号，脚蹼可能会成为一个非常受欢迎的工具。</p><p id="d41d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一定要让我知道，你对脚蹼的第一印象是什么。我可能会写更多关于Flipper的文章。例如如何为React Native开发插件，介绍每个工具以及扩展它们或做出贡献的方式。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nl"><img src="../Images/fb29c4b9ca1fc7beb312c370cd85cfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EOmBRm0LE1LyhpSDEUagw.png"/></div></div></figure></div></div>    
</body>
</html>