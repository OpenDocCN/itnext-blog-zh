<html>
<head>
<title>Using NSwag to Generate a Vue Client for an ASP.NET Core 3.1 API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NSwag为ASP.NET核心3.1 API生成Vue客户端</h1>
<blockquote>原文：<a href="https://itnext.io/using-nswag-to-generate-a-vue-client-for-an-asp-net-core-3-1-api-cae8c121c1cf?source=collection_archive---------7-----------------------#2020-01-27">https://itnext.io/using-nswag-to-generate-a-vue-client-for-an-asp-net-core-3-1-api-cae8c121c1cf?source=collection_archive---------7-----------------------#2020-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c44e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本周我们将添加一个<a class="ae kl" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue </a>项目，该项目将利用我们几周前使用NSwag生成的客户端创建的contacts API。这篇文章是ASP.NET核心基础回购的改造的一部分。NET Core 3.0现已发布，目标是。网芯3.1。有关相关样本如何达到当前状态的详细信息，请查看以下帖子。</p><p id="1632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/" rel="noopener ugc nofollow" target="_blank">使用NSwag和ASP.NET Core 3的Swagger/open API</a><br/><a class="ae kl" href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/" rel="noopener ugc nofollow" target="_blank">ASP.NET Core 3:将实体框架核心添加到现有项目</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/new-razor-pages-application-backed-with-an-api/" rel="noopener ugc nofollow" target="_blank">支持API的新Razor Pages项目</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成Angular客户端</a> <br/> <a class="ae kl" href="https://elanderson.net/2019/12/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3 API生成React客户端</a> <br/> <a class="ae kl" href="https://elanderson.net/2020/01/using-nswag-to-generate-blazor-server-client-for-an-asp-net-core-3-1-api/" rel="noopener ugc nofollow" target="_blank">使用NSwag为ASP.NET Core 3.1 API生成Blazor服务器客户端</a></p><p id="6673" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文修改前的示例代码可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/0ac0e84ca999545e5cac7764a019b14ce76353c8" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/fe8946b3b6c4683e3005147267ba3817.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*vNykNG5vbt_NsIDG.png"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/94dcb98d6605119aafdb650c25f8e6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*Pf-3M4BYkh-DNz6c.png"/></div></figure><h2 id="6a6a" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">创建Vue项目</h2><p id="c0c0" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">与本系列中的其他项目不同，没有。微软的. NET CLI模板支持Vue，所以为了创建Vue项目，我们将使用<a class="ae kl" href="https://cli.vuejs.org/guide/" rel="noopener ugc nofollow" target="_blank"> Vue CLI </a>。开始之前，确保您已经安装了<a class="ae kl" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">NPM</a>。</p><p id="8a8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在命令提示符下使用以下命令安装Vue CLI。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="cd5e" class="ku kv iq lt b gy lx ly l lz ma">npm install -g @vue/cli</span></pre><p id="6abc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，使用以下命令通过Vue CLI启动项目创建过程。请记住，CLI会使用项目名称创建一个目录。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="6071" class="ku kv iq lt b gy lx ly l lz ma">vue create contacts-vue</span></pre><p id="6691" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的命令引发了一系列关于应用程序的问题。该示例将使用TypeScript，这意味着不能使用默认设置，因此我们需要选择<strong class="jp ir">手动选择特性</strong>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/63748eaee5d4d31a344f47392e2318a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/0*-eW21NEgK9Py6Oe4.png"/></div></figure><p id="486f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下一个问题，我们需要选择<strong class="jp ir">打字稿</strong>。我还包括了路由器和Linter / Formatter。我还发现后来在这个过程中，巴别塔是需要的，所以在这个问题上可以随意选择它。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/91ccf20c44a6ed04322a029f62856e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/0*aVqbjw5zbU3INS1F.png"/></div></figure><p id="f236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">项目创建过程问了很多问题，我基本上都默认了。下面是我使用的所有问题和选项的截图。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi md"><img src="../Images/6dd85ce6691b8f265413559c799c5956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y-bRaFA0S4aMOqLW.png"/></div></div></figure><p id="59c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">既然项目已经创建，如果我们需要将目录更改为上面过程中创建的目录。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="fc18" class="ku kv iq lt b gy lx ly l lz ma">cd contacts-vue</span></pre><p id="ad68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用以下命令运行新项目。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="6dc7" class="ku kv iq lt b gy lx ly l lz ma">npm run serve</span></pre><h2 id="56c4" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">使用NSwagStudio生成API客户端</h2><p id="f511" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">NSwag为客户端生成提供了多种选项，包括CLI、代码或Windows应用程序。这篇文章将使用名为NSwagStudio的Windows应用程序。NSwagStudio可以从<a class="ae kl" href="http://rsuter.com/Projects/NSwagStudio/installer.php" rel="noopener ugc nofollow" target="_blank">这里</a>下载安装。</p><p id="0f65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，确保您的API正在运行，并获取其OpenAPI/Swagger规范URL的URL。例如，使用示例解决方案的Contacts API的本地实例，URL是<a class="ae kl" href="https://localhost:5001/swagger/v1/swagger.json." rel="noopener ugc nofollow" target="_blank"><strong class="jp ir">https://localhost:5001/swagger/v1/swagger . JSON</strong>。如果你正在使用Swagger UI，你可以在API标题下找到你的swagger.json的链接。</a></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/11663d411db43bfbcf38ef11fe65b708.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/0*lge5DnwqyiijNL6h.png"/></div></figure><p id="b6eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了API的OpenAPI/Swager规范URL，切换到NSwagStudio。应用程序将打开，并带有一个准备就绪的新文档。我们需要设置几个选项。首先，选择<strong class="jp ir"> OpenAPI/Swagger规范</strong>选项卡，并在<strong class="jp ir">规范URL </strong>框中输入您的API规范URL。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi mj"><img src="../Images/72a4f4b16c35b94ed99070351bae235d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XnbjgtLTxlO4NfSU.png"/></div></div></figure><p id="d865" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<strong class="jp ir">输出</strong>部分勾选<strong class="jp ir">打字客户端</strong>复选框，然后选择<strong class="jp ir">打字客户端</strong>选项卡。有许多选项可供选择，突出显示的选项对于本示例非常重要。首先，确保<strong class="jp ir">模块名</strong>和<strong class="jp ir">命名空间</strong>都为空。我确信有一种方法可以让客户端使用模块或名称空间，但是我没有任何运气。对于<strong class="jp ir">模板</strong>，我们只需要一个基于<strong class="jp ir">获取</strong>的客户端。需要设置的最后一个选项是<strong class="jp ir">输出文件</strong>路径，这是您希望生成的文件所在的位置。我输出到/src/apis/contactApi.ts下的Vue项目目录，设置好所有选项后点击<strong class="jp ir">生成文件</strong>。</p><h2 id="c990" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">创建UI并使用生成的客户端</h2><p id="803f" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">请注意，我已经很长时间没有接触Vue了，所以实际上UI位可能是也可能不是在Vue中做这些事情的“正确”方式，但它应该足够容易理解，您可以看到API客户端是如何使用的。和其他文章一样，我们将创建一个联系人列表，从API获取数据。</p><p id="4a65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将在/src/component目录中为联系人列表创建一个新组件，文件名为<strong class="jp ir"> ContactList.vue </strong>，内容如下。特定于使用NSwag生成的客户端的行被突出显示。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="4318" class="ku kv iq lt b gy lx ly l lz ma">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;table class="table table-striped" aria-labelledby="tabelLabel"&gt;<br/>      &lt;thead&gt;<br/>        &lt;tr&gt;<br/>          &lt;th&gt;Name&lt;/th&gt;<br/>          &lt;th&gt;Address&lt;/th&gt;<br/>          &lt;th&gt;City&lt;/th&gt;<br/>          &lt;th&gt;State&lt;/th&gt;<br/>          &lt;th&gt;Postal Code&lt;/th&gt;<br/>          &lt;th&gt;Phone&lt;/th&gt;<br/>          &lt;th&gt;Email&lt;/th&gt;<br/>        &lt;/tr&gt;<br/>      &lt;/thead&gt;<br/>      &lt;tbody&gt;<br/>        &lt;tr v-for="contact in contacts" v-bind:key="contact.id"&gt;<br/>          &lt;td&gt;{{contact.name}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.address}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.city}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.state}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.postalCode}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.phone}}&lt;/td&gt;<br/>          &lt;td&gt;{{contact.email}}&lt;/td&gt;<br/>        &lt;/tr&gt;<br/>      &lt;/tbody&gt;<br/>    &lt;/table&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script lang="ts"&gt;<br/>import { Component, Prop, Vue } from 'vue-property-decorator'<br/>import { ContactsClient, Contact } from '../apis/contactsApi'<br/>@Component<br/>export default class HelloWorld extends Vue {<br/>  name: string = 'ContactList';<br/>  contacts: Contact[] = [];<br/>  private created () {<br/>    let client = new ContactsClient()<br/>    client.getContacts().then(data =&gt; (this.contacts = data))<br/>  }<br/>}<br/>&lt;/script&gt;<br/><br/>&lt;style scoped&gt;<br/>&lt;/style&gt;</span></pre><p id="1415" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的<strong class="jp ir">创建的</strong>函数中可以看出，我们正在创建一个<strong class="jp ir"> ContactsClient </strong>的新实例，并调用它的<strong class="jp ir"> getContacts </strong>函数，使用我们从API返回的数据用API调用的结果替换<strong class="jp ir"> contacts </strong>字段。</p><p id="7a00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们将使用下面的代码在/src/views目录下创建一个<strong class="jp ir"> ContactList.vue </strong>。这基本上是我们上面创建的组件的包装。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="251a" class="ku kv iq lt b gy lx ly l lz ma">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;ContactListComponent/&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import ContactListComponent from '@/components/ContacList'<br/>export default {<br/>  name: 'contactList',<br/>  components: {<br/>    ContactListComponent<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="6ffe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经准备好了视图，我们需要添加一个到应用程序导航的链接，这样用户就可以访问联系人列表。打开<strong class="jp ir"> App.vue </strong>和一个路由器链接到联系人列表的nav div。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="6ff5" class="ku kv iq lt b gy lx ly l lz ma">&lt;div id="nav"&gt;<br/>    &lt;router-link to="/"&gt;Home&lt;/router-link&gt; |<br/>    &lt;router-link to="/contactList"&gt;Contacts&lt;/router-link&gt; |<br/>    &lt;router-link to="/about"&gt;About&lt;/router-link&gt;<br/>&lt;/div&gt;</span></pre><p id="08f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们需要将新组件添加到应用程序的路由中。打开/src/router目录中的<strong class="jp ir"> index.ts </strong>，为联系人列表视图添加一个导入。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="28c5" class="ku kv iq lt b gy lx ly l lz ma">import ContactList from '../views/ContactList.vue'</span></pre><p id="f267" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，将联系人列表添加到routes数组中。</p><pre class="kn ko kp kq gt ls lt lu lv aw lw bi"><span id="d3e8" class="ku kv iq lt b gy lx ly l lz ma">const routes = [<br/>  {<br/>    path: '/',<br/>    name: 'home',<br/>    component: Home<br/>  },<br/>  {<br/>    path: '/contactList',<br/>    name: 'contactList',<br/>    component: ContactList<br/>  },<br/>  {<br/>    path: '/about',<br/>    name: 'about',<br/>    // route level code-splitting<br/>    // this generates a separate chunk (about.[hash].js) for this route<br/>    // which is lazy-loaded when the route is visited.<br/>    component: () =&gt; import(/* webpackChunkName: "about" */ '../views/About.vue')<br/>  }<br/>]</span></pre><h2 id="7cf3" class="ku kv iq bd kw kx ky dn kz la lb dp lc jy ld le lf kc lg lh li kg lj lk ll lm bi translated">包扎</h2><p id="3857" class="pw-post-body-paragraph jn jo iq jp b jq ln js jt ju lo jw jx jy lp ka kb kc lq ke kf kg lr ki kj kk ij bi translated">一如既往，NSwag使得创建一个与API交互的客户端变得非常容易。希望这是有用的，即使我的Vue代码可能不是惯用的。</p><p id="b4d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本帖修改后的样本项目可以在<a class="ae kl" href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/a7e807f6fb4195caafb357c4b037d01cf41a33aa" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="bab4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mr">原载于</em> <a class="ae kl" href="https://elanderson.net/2020/01/using-nswag-to-generate-a-vue-client-for-an-asp-net-core-3-1-api/" rel="noopener ugc nofollow" target="_blank"> <em class="mr">埃里克·安德森</em> </a> <em class="mr">。</em></p></div></div>    
</body>
</html>