<html>
<head>
<title>Going down the Service Mesh rabbit hole — Why do you think you need it, and architecture considerations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">走进服务网格兔子洞——为什么您认为您需要它，以及架构考虑</h1>
<blockquote>原文：<a href="https://itnext.io/going-down-the-service-mesh-rabbit-hole-why-do-you-think-you-need-it-and-architecture-8eb440ea5fea?source=collection_archive---------2-----------------------#2020-11-03">https://itnext.io/going-down-the-service-mesh-rabbit-hole-why-do-you-think-you-need-it-and-architecture-8eb440ea5fea?source=collection_archive---------2-----------------------#2020-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="48f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">先说一个好的背景故事。</p><p id="d430" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总有一天，你会拥有闪亮的<strong class="js iu"/>，<strong class="js iu">新款</strong> Kubernetes Cluster。</p><p id="76d3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它可以工作，可以施展魔法，使您能够使用您选择的CI/CD发布模型来执行幂等微服务发布。<br/> <strong class="js iu">是的</strong>，在生产。<br/>你已经为你的Kubernetes (Nginx或任何其他)入口控制器、WAF保护等考虑了应用负载平衡器。</p><p id="a446" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您的K8s生产微服务(应该)具备所有最佳实践；资源<code class="fe ko kp kq kr b">quotas</code>、<code class="fe ko kp kq kr b">limits</code>、<code class="fe ko kp kq kr b">HorizontalPodAutoscaling</code>，甚至<code class="fe ko kp kq kr b">NetworkPolicy</code>来保持SecOps功能正常运行。</p><p id="6b72" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇博文旨在让<em class="ks">技术</em>和<em class="ks">管理</em>读者共同探索<em class="ks">更大的组织视角、</em>以及欣赏更精细的<em class="ks">细节。</em>这是<em class="ks">一个</em>的努力，帮助你在<strong class="js iu"/><strong class="js iu">服务网格的话题上做出<em class="ks">更好的决策</em>。</strong></p><p id="bc13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以向生产级Kubernetes环境中添加更多的生产服务。一切都很顺利。</p><blockquote class="kt"><p id="9d23" class="ku kv it bd kw kx ky kz la lb lc kn dk translated">那么你一定听说过这个东西——<strong class="ak">服务网格</strong>。</p></blockquote><blockquote class="ld le lf"><p id="566e" class="jq jr ks js b jt lg jv jw jx lh jz ka li lj kd ke lk ll kh ki lm ln kl km kn im bi translated">你查过了。看起来这是每个人解决所有业务和技术扩展问题的方式。It解决方案位于DevOps之后的某个位置，但可能与SRE一致，因为它似乎最具敏捷性。所以现在你想要了。你老板肯定要，是时候看看这个兔子洞到底有多深了……</p></blockquote><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/02c8f2bc7c4e4ac5244c6327fd5ad03d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OL-ckk5A6F1HOHuz-EhxcQ.png"/></div></div></figure><p id="9ec4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这正是我呼吁所有人坐下来，喝点令人放松的甘菊茶，并反思这种果汁如何以及为什么值得压榨的时候。</p><p id="b7a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我不会剥夺你的幻想，但考虑这样的技术并列是很重要的，<strong class="js iu">需要</strong>对<strong class="js iu">想要</strong>，从<strong class="js iu">为什么</strong>开始，然后是<strong class="js iu">为什么现在</strong></p><h1 id="cefe" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated"><strong class="ak">尴尬的一点。为什么</strong></h1><p id="8b19" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我们应该进行一个小的坦率的问卷调查，以确保我们涵盖了所有的角度。</p><ul class=""><li id="7d06" class="nd ne it js b jt ju jx jy kb nf kf ng kj nh kn ni nj nk nl bi translated">这是否满足一套<strong class="js iu">业务需求</strong>？是否有<strong class="js iu">备选方案</strong>来实现相同的目标，为mesh服务？</li><li id="7c3e" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">敏捷度</strong>如何<strong class="js iu">是你的组织</strong>你是否有<strong class="js iu">工程团队(SRE)的能力</strong>对现有的Kubernetes集群进行有经验的、高效的操作？</li><li id="785f" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">您是否经历过影响SLA的停机时间？</li><li id="4eed" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">您的监控功能的<strong class="js iu">效果如何？您的监控<strong class="js iu">有多全面</strong>？是否有[任何]待处理的警报需要稍后重新处理？</strong></li><li id="22c9" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">您对所有微服务和Kubernetes集群状态的<strong class="js iu">可观察性</strong>能力的有效性如何？</li></ul><p id="8664" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你知道要点了。</p><p id="d43e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以我最浅显的观点来看，这些只是在跳入游泳池深水区之前值得考虑的一些先决条件。<br/>为了避免任何利益的曲解，<strong class="js iu">我100%支持</strong>给出那个闪亮的框架，那个工具，<code class="fe ko kp kq kr b">have-a-go</code>。</p><p id="5a08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">作为工程师，我们通常会为正确的工作选择正确的工具。通常情况下。</p><p id="70b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，尽管我最初呼吁理性冷静时含糊不清，但如果我们确实有这些简单的问题，并且业务和工程团队都支持对T1的需求，那么让我们继续进行具体的规划和架构设计，不要再拖延了。如果我们没有得到所有这些问题的满意答案，停下来评估替代工具并没有错。那里真的有很多——可以更好地满足你的组织需求。</p><blockquote class="kt"><p id="adf5" class="ku kv it bd kw kx ky kz la lb lc kn dk translated">简而言之<strong class="ak"> —如果时机或需求不太合适，可以离开服务网。这不是适合工作的工具。事情就是这样。</strong></p><p id="41af" class="ku kv it bd kw kx ky kz la lb lc kn dk translated"><strong class="ak">没有剧情。</strong></p></blockquote><blockquote class="ld le lf"><p id="de99" class="jq jr ks js b jt lg jv jw jx lh jz ka li lj kd ke lk ll kh ki lm ln kl km kn im bi translated">另一方面，如果有<em class="it">文化</em>，那么<em class="it">团队</em>——也就是复数——随时准备实现这些服务网格特性，以<code class="fe ko kp kq kr b">further</code>增强由<em class="it">业务</em>用例支持的工程能力。<strong class="js iu">超级。</strong>加入一点<em class="it">风险偏好——因为事情就是这样</em>。</p></blockquote><p id="c18f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很高兴<strong class="js iu">的尴尬位</strong>已经不碍事了。</p><p id="4a75" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然有许多关于(Istio)服务网格的开源实现的精彩演示、详细图表和文章，但我在我的帖子中想要表达的重点更多的是在执行服务网格实现之前的规划和设计考虑。有很多未知因素，但我希望这种规划远见能驱散神话，突出关注领域，并有助于减轻许多未兑现的承诺。</p><blockquote class="kt"><p id="3bf5" class="ku kv it bd kw kx ky kz la lb lc kn dk translated">TLDR；我想为您的组织和团队介绍服务网格架构和设计。</p><p id="dfce" class="ku kv it bd kw kx ky kz la lb lc kn dk translated">因为服务网格的实现很可能会测试组织的开发运维及敏捷准备情况。</p><p id="24e7" class="ku kv it bd kw kx ky kz la lb lc kn dk translated">让我们来评估一下服务网状部署将如何为您服务。</p></blockquote><p id="37e4" class="pw-post-body-paragraph jq jr it js b jt lg jv jw jx lh jz ka kb lj kd ke kf ll kh ki kj ln kl km kn im bi translated"><strong class="js iu">服务网格(Istio) </strong>模糊了那些众所周知的界限，即<strong class="js iu">平台</strong>或<strong class="js iu">基础设施</strong>团队开始并完成他们的<code class="fe ko kp kq kr b">bit</code>，而<strong class="js iu">应用</strong> <strong class="js iu">开发</strong>团队接管对他们的应用<code class="fe ko kp kq kr b">bit</code>必要且特定的配置。</p><p id="deb3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们都是开发人员，但是平台工程功能包括什么，假设应用程序开发团队现在可能拥有基础设施资产的很大一部分。</p><h1 id="7103" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">规划</h1><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/713dd3bfe24e167b20a72f2330d90389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*aK9p8qa-aiKOUT2L394-Fw.gif"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">有了承诺，就有了计划。</figcaption></figure><p id="fdc4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">忘记从Istio或LinkerD文档开始。这是通常被忽略的一点，它是在任何安装之前对您的业务和工程能力的总体评估。让我们试着回答一些问题。</p><ul class=""><li id="b34b" class="nd ne it js b jt ju jx jy kb nf kf ng kj nh kn ni nj nk nl bi translated">Kubernetes集群的当前状态是什么，它现在处于预期的、计划的状态吗(除了网状之外)？</li><li id="abc9" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">随着服务网格的引入，当前的入口控制器架构将如何变化？</li><li id="eb66" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">您是否需要在您的集群中利用流量整形，以便能够发现新的服务版本？（</li><li id="0e23" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">是否有解决任何集群<em class="ks">多租户</em>的业务需求和工程能力？未来有这样的规划吗？</li><li id="e3b5" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated">在您的组织内，服务网格集成如何影响您当前的运营模式？应用程序和基础设施开发和支持之间的责任矩阵。<em class="ks">如果之前、之后或此时没有考虑过，请在评论中发表。</em></li></ul><h1 id="ceff" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">控制平面和数据平面</h1><p id="527f" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">如果你对服务网格有所了解，比如Istio，它有两个部分—<strong class="js iu">控制</strong>平面和<strong class="js iu">数据</strong>平面。</p><p id="7c2e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要通过比较和对比场景来理解差异，以及它们如何在更广泛的组织所谓的<strong class="js iu">运营模式</strong>中得到恰当的运用。</p><p id="779e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这两者是紧密交织在一起的(obv ),但我看到了很多关于这样做的必要性以及在推出时这一切在实际实践中意味着什么的困惑。</p><p id="d561" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">简而言之，Istio服务网格的初始<a class="ae nw" href="https://istio.io/latest/docs/setup/getting-started/" rel="noopener ugc nofollow" target="_blank">安装</a>将在您的Kubernetes集群中安装所有必要的组件。他们顶多是<strong class="js iu">惰性</strong>。</p><p id="5b12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以使用入口控制器的“经典”选择继续运行您的工作负载，就像<code class="fe ko kp kq kr b">nginx-ingress-controller</code>不知道。</p><p id="15d8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">应用团队可以继续执行他们的微服务发布BAU，平台团队和DevOps跨团队功能可以开始探索和挑选服务网格功能和特性，当他们在小的增量步骤。</p><p id="dd74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您开始规划到Kubernetes服务的交通路线时，乐趣就开始了。Istio服务网格有自己的部署，一个服务(和云平台提供的负载平衡器)，你需要深入到<code class="fe ko kp kq kr b">istio-ingressgateway</code>部署的配置中，并开始用<code class="fe ko kp kq kr b">VirtualService</code>和<code class="fe ko kp kq kr b">Gateway.</code>配置这个<strong class="js iu">入口</strong></p><p id="b611" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请参见下图，了解它如何映射到现有工作负载，以及这些组件之间的关联交互提供了哪些<code class="fe ko kp kq kr b">Istio</code> <strong class="js iu">组件/功能</strong>。</p><p id="f20f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了开始使用一些附加功能，值得探索一下<code class="fe ko kp kq kr b"><a class="ae nw" href="https://istio.io/latest/docs/setup/additional-setup/config-profiles/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">demo</strong></a></code> <a class="ae nw" href="https://istio.io/latest/docs/setup/additional-setup/config-profiles/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">服务网格配置文件</strong> </a>，您可以开始使用。通过这种方式，您可以获得最小值，以及相关种类配置的<code class="fe ko kp kq kr b">Istio-IngressGateway</code>和<code class="fe ko kp kq kr b">Istio-EgressGateway</code>，并“上路运行”一个工作演示供您仔细阅读。</p><p id="805b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些是服务网格组件和<code class="fe ko kp kq kr b">demo</code>服务网格配置文件，当<a class="ae nw" href="https://istio.io/latest/docs/setup/getting-started/" rel="noopener ugc nofollow" target="_blank">开始安装Istio时，可以使用<code class="fe ko kp kq kr b">istioctl</code> CLI命令。</a></p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nx"><img src="../Images/f3f5eec29ade1c2e35df64a682dab84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wyELWAWmUfTtmIL3tQlGVg.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk translated">突出显示组件对现有工作负载的映射，以及这些组件之间的关联交互提供了哪些<code class="fe ko kp kq kr b">Istio</code> <strong class="bd mc">组件/功能</strong>。</figcaption></figure><h1 id="1d0c" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">大局</h1><p id="e51d" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated"><strong class="js iu">需要明确的是</strong>,<strong class="js iu">服务网</strong>推广工作的好处只有在<em class="ks">组织</em>层面有了<code class="fe ko kp kq kr b">techno-cultural buy-in</code>才会开花结果<strong class="js iu">。</strong></p><p id="fd8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些努力的结果可能会实现<strong class="js iu">只有</strong>用<code class="fe ko kp kq kr b"> all-hands-on-deck</code>的方法去<strong class="js iu">学习</strong>，分享&amp;关心的会话，就像<code class="fe ko kp kq kr b">AGILE</code>你想要的那样(声称)。</p><p id="a438" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你是一名<strong class="js iu">工程师</strong>，你可能会欣赏下面<strong class="js iu">大</strong> <strong class="js iu">考虑事项</strong>部分中的每一项技术挑战的实际操作。</p><p id="3a63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于<strong class="js iu">领导层</strong>，可以说——这绝不是一个彻底详尽的操作指南，但可以作为一个<strong class="js iu">准备情况评估，</strong>来确保你的<em class="ks">组织</em>达到一个非常令人羡慕的<em class="ks">未来</em>基础设施状态。你的竞争对手可能会对“我们运行服务网”的声明羡慕不已，但当“意想不到的停机时间”最终真的发生时，他们会首先质疑你的技术实力。这还不算SLA对您企业客户的影响。</p><h2 id="7c87" class="ny mb it bd mc nz oa dn mg ob oc dp mk kb od oe mo kf of og ms kj oh oi mw oj bi translated">考虑因素</h2><p id="d18c" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">虽然没有什么能阻止您进行大爆炸式安装，但对您现有的工作负载影响很小或没有影响。当<strong class="js iu">为您的应用程序工作负载启用服务网格</strong>时，有一系列考虑事项需要审查和仔细考虑，我认为您应该审查和评估这些事项。</p><ul class=""><li id="9c54" class="nd ne it js b jt ju jx jy kb nf kf ng kj nh kn ni nj nk nl bi translated"><strong class="js iu">只在需要</strong>的地方用<code class="fe ko kp kq kr b">Istio-injection=true</code> <strong class="js iu">启用Istio服务网格</strong>。当<code class="fe ko kp kq kr b">envoy</code>代理在其各自的<code class="fe ko kp kq kr b">Pods</code>上被注入时，一些应用<strong class="js iu">将会中断</strong>。<code class="fe ko kp kq kr b">Envoy</code>边车集装箱充当所有<code class="fe ko kp kq kr b">POD</code>网络流量的漏斗。这意味着，如果应用程序容器需要在<code class="fe ko kp kq kr b">Quorum</code>或<strong class="js iu">上工作，则将</strong>直接连接到其他POD【容器】<strong class="js iu"/>，每个Pod上的此类<code class="fe ko kp kq kr b">Envoy</code>边车会使事情变得复杂，相应的应用程序需要将所有通信重新路由到<code class="fe ko kp kq kr b">127.0.0.1</code>，以便<code class="fe ko kp kq kr b">Envoy</code>边车在每个此类Pod上拾取和运行。想想<code class="fe ko kp kq kr b">Redis</code>或者<code class="fe ko kp kq kr b">ZooKeeper</code>。请参见下面的<code class="fe ko kp kq kr b">Namespace</code>部分，了解潜在的解决方法。</li><li id="01bb" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">网络策略— </strong>利用<code class="fe ko kp kq kr b">NetworkPolicy</code>进行业务流管理，以确保应用业务确实(且仅)通过预定的服务网格入口路由流动(在适当的情况下)。这适用于单租户和多租户环境，最小使用案例为将<code class="fe ko kp kq kr b">Namespace</code>作为流量源/目的地白名单的<code class="fe ko kp kq kr b">Networkpolicy</code>配置。请记住，默认情况下，Kubernetes集群中的所有Pods都可以与所有其他Pods通信。这意味着服务可以“由东向西”到达——通过其他服务，即使是无意的，也可以通过先前配置的<code class="fe ko kp kq kr b">Ingress(es).</code>配置一个<code class="fe ko kp kq kr b">NetworkPolicy</code>将强制流量流过一个单一的批准的路由，并确保您获得服务网格<strong class="js iu">可观察性</strong>印象分。请在下面阅读更多相关内容。</li><li id="7af2" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">高可用性(PDB)——</strong>通过为服务网格组件(citadel除外)设置多个<strong class="js iu">可用的</strong>最小pod来确保高可用性，尤其是在<em class="ks">就地</em>升级过程中。配置<code class="fe ko kp kq kr b">PodDisruptionBudget</code>以设置在升级和节点池重新平衡期间，每个服务网格组件始终保持的最小<code class="fe ko kp kq kr b">pod</code>可用性计数。</li><li id="2f9b" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">自动伸缩(HPA) &amp;资源配额— </strong> Istio服务网格入口组件带有一个<code class="fe ko kp kq kr b">Kind: Deployment</code>。在Kubernetes (v1.10或更高版本)中，集群操作<strong class="js iu">指标-服务器</strong>，公开资源指标。因此，<code class="fe ko kp kq kr b">HorizontalPodAutoscaler</code> ( <code class="fe ko kp kq kr b">HPA</code> ) <code class="fe ko kp kq kr b">Kind</code>可用于配置，以帮助扩展Istio <code class="fe ko kp kq kr b">IngressGateway</code> <code class="fe ko kp kq kr b">Deployment</code>副本数量，从而满足性能需求。执行服务网格组件资源<strong class="js iu">配额</strong>的正确调整，例如<code class="fe ko kp kq kr b">Envoy</code> <code class="fe ko kp kq kr b">Proxy</code>容器和<code class="fe ko kp kq kr b">Ingress</code> / <code class="fe ko kp kq kr b">Egress</code> - <code class="fe ko kp kq kr b">gateway</code>部署<strong class="js iu">与</strong>它们的实际<strong class="js iu">利用率</strong>。这确保了<code class="fe ko kp kq kr b">(HPA)</code>配置在必要时工作。</li><li id="188d" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">名称空间— </strong>使用<code class="fe ko kp kq kr b">namespace</code>逻辑<code class="fe ko kp kq kr b">label</code>分离工作负载，并使用它来分离<strong class="js iu">类型的工作负载</strong> ( <code class="fe ko kp kq kr b">istio-system</code>、<code class="fe ko kp kq kr b">team1</code>、<code class="fe ko kp kq kr b">team2</code>、<code class="fe ko kp kq kr b">monitoring</code>等)。这进一步提高了安全性，因为<code class="fe ko kp kq kr b">NetworkPolicy</code>可以按名称空间应用，从而实现有效的安全性控制。在适当的名称空间(标签)中逻辑分离工作负载简化了用于服务网格集成的<code class="fe ko kp kq kr b">envoy-proxy</code>自动边车注入，因为自动特使边车注入作为名称空间<em class="ks">注释</em>被启用。</li><li id="7a9d" class="nd ne it js b jt nm jx nn kb no kf np kj nq kn ni nj nk nl bi translated"><strong class="js iu">Ingress&amp;Egress—</strong><code class="fe ko kp kq kr b">VirsualService</code>、<code class="fe ko kp kq kr b">Gateway</code>、<code class="fe ko kp kq kr b">DestinationRule</code>等组件可以在一个<code class="fe ko kp kq kr b">default</code>、<code class="fe ko kp kq kr b">namespace</code>中持久化，在其他名称空间中被引用消耗。最佳实践是确保这些配置是在<code class="fe ko kp kq kr b">default</code>、<code class="fe ko kp kq kr b">istio-system and kube-system</code>名称空间之外创建的。相反，它们应该代表一个专用的、本地独立的实体，最好是每个租户。然而，重要的是要提到，在多租户环境中，在某些用例下，<code class="fe ko kp kq kr b">Ingress</code>应该是<em class="ks">进一步</em>分离的<code class="fe ko kp kq kr b">Ingress</code>配置，在期望的<code class="fe ko kp kq kr b">namespace</code>中带有<code class="fe ko kp kq kr b">exportTo</code>标志和关联的<code class="fe ko kp kq kr b">DestinationRule</code>。对称的<code class="fe ko kp kq kr b">Egress</code>可能会得到类似的处理，有另一个专用的名称空间，与<code class="fe ko kp kq kr b">NetworkPolicy</code>成对匹配。</li></ul><h1 id="9710" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">最后的想法</h1><p id="b36e" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">服务网格确实令人望而生畏，尤其是它带来了越来越多的更新和特性。我建议从基本的和最小的开始。</p><p id="6fa4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你有<code class="fe ko kp kq kr b">istio-IngressGateway</code>——先配置那个<strong class="js iu"/>。优化第二个<strong class="js iu">。</strong></p><p id="a234" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">确保您有一组高质量的<code class="fe ko kp kq kr b">NetworkPolicy(ies)</code>，特别是对于多租户Kubernetes集群，以确保开始通过服务网格将流量引入服务。</p><p id="f460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您将需要考虑扩展集群服务，以包括一个<strong class="js iu">证书管理器</strong>和<strong class="js iu">外部dns </strong>，以确保您拥有一个全功能、自动化、动态的能力，来促进相关的dns保留和证书颁发(和更新)。在利用<code class="fe ko kp kq kr b">the service mesh</code>之前，您可能/应该已经具备这样的能力！</p><p id="a815" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">部署像<code class="fe ko kp kq kr b"><strong class="js iu">Prometheus</strong></code>这样的指标聚合器，以便聚合所有的<code class="fe ko kp kq kr b">istio</code>指标，并使用适当的仪表板来可视化它们。如果您没有通过服务网格传输流量，您将不会在<code class="fe ko kp kq kr b"><strong class="js iu">Prometheus</strong></code>中看到相关指标。如果您在阅读本文的同时考虑到了服务网格，那么您最好已经在Kubernetes集群上拥有了成熟的<strong class="js iu">监控</strong>和<strong class="js iu">观察</strong>功能。</p><p id="3f42" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">数据包追踪</strong> —一旦你的服务网可以运行，就使用<strong class="js iu"> Jaeger + Kiali </strong>插件。他们是伟大的，但是你可以离开直到最后。我敢肯定，你现在就渴望探索这些承诺的酷功能。但是不要跑题。<strong class="js iu">婴儿步</strong>。</p><p id="2e25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">考虑一下<strong class="js iu">相互TLS </strong>、东西向和南北向TLS(<em class="ks">尽管在后一种情况下探索Apigee产品</em> ) —安全的集群到集群通信是下一个级别要做的事情。这确实使你的设置成倍地复杂化了。你甚至可能希望尝试经营你自己的认证机构。它将有助于管理多集群加密通信。提供PKI服务的Hashicorp Vault可能会是你感兴趣的一个领域。但现阶段可能有点过了。</p><p id="d31f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以我想现在就这样了。<br/>这绝不是详尽无遗的，但最近的思考和实际上的头脑风暴，我希望能就<strong class="js iu">服务网格即解决方案</strong>(<strong class="js iu">SMaaS</strong>——不过这最好不要成为一件事)</p><p id="1426" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望在接下来的文章中涵盖所有的插件、扩展和扩充。</p><p id="2917" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望这篇文章能够为您开始设计和构建服务网格实现提供足够的指导。</p><p id="ef8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你喜欢阅读，喜欢，分享知识。</p><p id="8b74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">连接上</strong> <a class="ae nw" href="https://www.linkedin.com/in/johas/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> LinkedIn </strong> </a> <strong class="js iu">或找我上</strong> <a class="ae nw" href="https://istio.slack.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu"> Istio </strong> </a> <strong class="js iu">和</strong><a class="ae nw" href="https://slack.k8s.io/" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">Kubernetes</strong></a><strong class="js iu">松弛群。</strong></p></div></div>    
</body>
</html>