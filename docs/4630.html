<html>
<head>
<title>Build a Shopping Cart with React, Redux, and React-DnD — PART 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React、Redux和React-DnD构建购物车—第4部分</h1>
<blockquote>原文：<a href="https://itnext.io/build-a-shopping-cart-with-react-redux-and-react-dnd-part-4-6a77f0a39c0c?source=collection_archive---------2-----------------------#2020-08-08">https://itnext.io/build-a-shopping-cart-with-react-redux-and-react-dnd-part-4-6a77f0a39c0c?source=collection_archive---------2-----------------------#2020-08-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/d6617435532384981a028eaf870649ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*_K8fX6RIe3lyWpOxJFlZTQ.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated"><strong class="bd jy">图1 </strong>拖拽劈砍车</figcaption></figure><p id="e197" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated"><span class="l ky kz la bm lb lc ld le lf di"> W </span>欢迎来到<strong class="kb ir">第4部分</strong>构建一个利用<a class="ae lg" href="https://react-dnd.github.io/react-dnd/about" rel="noopener ugc nofollow" target="_blank"> React DnD </a>的简单购物车。在第三部分中，我们将React DnD集成到了React应用程序中。如果你想从第4部分开始构建，确保从这个<a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/React-Drag-and-Drop" rel="noopener ugc nofollow" target="_blank">分支</a>克隆并下载第3部分的代码，因为第4部分是一个延续。</p><h1 id="b4ec" class="lh li iq bd jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">入门指南</h1><p id="0d30" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">在本文中，我们将继续构建我们的购物车，使用React Actions和Reducers将项目从拖动源移动到拖放目标，以响应React DnD <code class="fe mj mk ml mm b">endDrag</code>事件。在这篇文章的结尾，我们将学习</p><ul class=""><li id="b33b" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated"><a class="ae lg" href="https://redux.js.org/basics/actions" rel="noopener ugc nofollow" target="_blank">动作</a></li><li id="0560" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated"><a class="ae lg" href="https://redux.js.org/basics/reducers" rel="noopener ugc nofollow" target="_blank">减速器</a></li><li id="09cb" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated"><a class="ae lg" href="https://redux.js.org/api/store#dispatchaction" rel="noopener ugc nofollow" target="_blank">调度</a></li><li id="3bc9" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated"><a class="ae lg" href="https://redux.js.org/advanced/middleware" rel="noopener ugc nofollow" target="_blank">中间件</a></li></ul><blockquote class="nb nc nd"><p id="0f8d" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated"><em class="iq">本节所有代码在</em> <a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/Move-Action" rel="noopener ugc nofollow" target="_blank"> <em class="iq">分支</em> </a>中找到</p></blockquote><h1 id="3fb7" class="lh li iq bd jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">我们想要建造的东西</h1><p id="ec38" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">到目前为止，每当我们将一个项目从拖动源拖动到拖放目标时，除了一些控制台日志消息之外，没有什么特别的事情发生。</p><figure class="ni nj nk nl gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/a4ca5c039dbdd78e92d2aa407611b65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*Um6rqck1fP_xrrqZ2akrhg.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk translated">图2 我们React应用程序的当前状态</figcaption></figure><p id="e2e2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们现在试图构建的是使拖放到拖放目标中的项目实际上移动到其中，如上面的<strong class="kb ir">图1 </strong>所示。</p><h2 id="bfd7" class="nm li iq bd jy nn no dn lm np nq dp lq kk nr ns lu ko nt nu ly ks nv nw mc nx bi translated">行动</h2><p id="111d" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">我们集成React DnD的方式是，每当我们将一个兼容的项目放入拖放目标时，就会触发<code class="fe mj mk ml mm b">endDrag</code>事件。我们希望通过通知商店采取何种措施来应对这一事件。</p><blockquote class="nb nc nd"><p id="8ddc" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">动作是将数据从应用程序发送到商店的信息负载。他们是商店唯一的<em class="iq">信息来源。你用<code class="fe mj mk ml mm b"><a class="ae lg" href="https://redux.js.org/api/store#dispatchaction" rel="noopener ugc nofollow" target="_blank">store.dispatch()</a></code>把它们送到商店。</em></p></blockquote><p id="ddc4" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">移动到<code class="fe mj mk ml mm b">src/actions/phones.js</code>并修改如下</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="9f08" class="nm li iq mm b gy oc od l oe of">export const RECEIVE_PHONES = 'RECEIVE_PHONES'<br/><strong class="mm ir">export const MOVE_INCART = 'MOVE_INCART'</strong></span><span id="2f82" class="nm li iq mm b gy og od l oe of">export function receivePhones(phones){<br/>    return{<br/>        type: RECEIVE_PHONES,<br/>        phones<br/>    }<br/>}</span><span id="890b" class="nm li iq mm b gy og od l oe of"><strong class="mm ir">export function moveIncart(phone_id){<br/>    return{<br/>        type: MOVE_INCART,<br/>        id: phone_id<br/>    }<br/>}</strong></span></pre><p id="5d5a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们的动作是一个普通的JavaScript对象，带有一个强制的<code class="fe mj mk ml mm b">type</code>属性，该属性通常采用一个字符串常量值来指示正在执行的动作的类型。在这种情况下，<code class="fe mj mk ml mm b">MOVE_INCART.</code>我们接下来需要的是我们想要移动的项目的id<code class="fe mj mk ml mm b">phone_id</code>，它作为参数被传递给<code class="fe mj mk ml mm b">moveIncart()</code>函数。</p><h2 id="7b85" class="nm li iq bd jy nn no dn lm np nq dp lq kk nr ns lu ko nt nu ly ks nv nw mc nx bi translated">还原剂</h2><p id="869c" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">在动作被发送到商店之后，我们需要一个reducer来指定状态将如何响应动作而改变。</p><blockquote class="nb nc nd"><p id="cf43" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">Reducers指定应用程序的状态如何改变，以响应发送到商店的<a class="ae lg" href="https://redux.js.org/basics/actions" rel="noopener ugc nofollow" target="_blank">动作</a>。记住动作只描述了<em class="iq">发生了什么</em>，而没有描述应用程序的状态如何变化。</p></blockquote><p id="6cd4" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">移动到<code class="fe mj mk ml mm b">src/reducers/phones.js</code>并修改如下</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="0feb" class="nm li iq mm b gy oc od l oe of">import { RECEIVE_PHONES } from '../actions/phones'<br/><strong class="mm ir">export const MOVE_INCART = 'MOVE_INCART'</strong></span><span id="ca93" class="nm li iq mm b gy og od l oe of">export default function phones(state={}, action){<br/>    switch(action.type){<br/>        case RECEIVE_PHONES:<br/>            return {<br/>                ...state,<br/>                ...action.phones<br/>            }<br/>        <strong class="mm ir">case MOVE_INCART:<br/>            return{<br/>                ...state,<br/>                [action.id]:{<br/>                    ...state[action.id],<br/>                    inCart: 'true'<br/>                }<br/>            }<br/> </strong>       default:<br/>            return state<br/>    }<br/>}</span></pre><p id="0391" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">上面的代码基本上将特定项的<code class="fe mj mk ml mm b">inCart</code>属性从<code class="fe mj mk ml mm b">false</code>修改为<code class="fe mj mk ml mm b">true</code></p><h2 id="e7ae" class="nm li iq bd jy nn no dn lm np nq dp lq kk nr ns lu ko nt nu ly ks nv nw mc nx bi translated">分配器</h2><p id="6824" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">我们已经设置了动作和减速器，现在是触发状态改变的时候了。对于我们的应用程序，我们将在<code class="fe mj mk ml mm b">endDrag</code>事件被触发时分派一个动作。通过这种方式，我们获得特定商品的id并将其传递给action函数，action函数又被传递给dispatch函数。</p><blockquote class="nb nc nd"><p id="afee" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">一个存储保存了你的应用程序的整个状态树。改变它内部状态的唯一方法是对它分派一个<a class="ae lg" href="https://redux.js.org/glossary#action" rel="noopener ugc nofollow" target="_blank">动作</a>。</p></blockquote><p id="531b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">打开<code class="fe mj mk ml mm b">src/components/Phone.js</code>并修改如下代码</p><blockquote class="nb nc nd"><p id="6014" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">在我使用<code class="fe mj mk ml mm b"><em class="iq">// Lines of code stay the same here</em></code> <em class="iq">、</em>的地方，请参考<a class="ae lg" rel="noopener ugc nofollow" target="_blank" href="/build-a-shopping-cart-with-react-redux-and-react-dnd-part-3-f1e1e8265d14"> PART3 </a>以获得代码的完整部分，或者与这个<a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/Move-Action" rel="noopener ugc nofollow" target="_blank">分支</a>进行比较。既然是一样的，我就不想重复了。</p></blockquote><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="de7c" class="nm li iq mm b gy oc od l oe of">import React, { Component } from 'react'<br/>import { DragSource } from 'react-dnd';<br/><strong class="mm ir">import { connect } from 'react-redux'</strong></span><span id="b0f4" class="nm li iq mm b gy og od l oe of">import { ItemTypes } from './Constants';<br/><strong class="mm ir">import { moveIncart } from '../actions/phones'</strong></span><span id="f850" class="nm li iq mm b gy og od l oe of">// phone DnD spec<br/>const phoneSpec = {<br/>    beginDrag(props){<br/>        return{<br/>            name: props.brand,<br/>            id: props.id<br/>            <br/>        }<br/>    },<br/>    endDrag(props, monitor, component){<br/>        if (monitor.didDrop()){<br/>            const dragItem = monitor.getItem();<br/>            const dropResult = monitor.getDropResult();           <br/>            console.log("You dropped ", dragItem.name, ' into '+ dropResult.name)<br/>             // Move action goes here<br/>            <strong class="mm ir">props.dispatch(moveIncart(dragItem.id))</strong><br/>        }else{<br/>            return;<br/>        }<br/>    }<br/>}<br/><em class="ne">// Lines of code stay the same here.</em></span><span id="02c4" class="nm li iq mm b gy og od l oe of">export default <strong class="mm ir">connect()</strong>(DragSource(ItemTypes.PHONE, phoneSpec, collect)(Phone));</span></pre><p id="af51" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们从' react-redux '导入了<code class="fe mj mk ml mm b"><a class="ae lg" href="https://react-redux.js.org/api/connect#connect" rel="noopener ugc nofollow" target="_blank">connect</a></code>,它将为我们提供用于向商店分派动作的函数<code class="fe mj mk ml mm b">dispatch</code>。</p><ul class=""><li id="679c" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated"><code class="fe mj mk ml mm b">dragItem.id</code>从<code class="fe mj mk ml mm b">beginDrag's</code>返回的对象中获取，该对象可从<code class="fe mj mk ml mm b">monitor.getItem()</code>访问</li><li id="bf29" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">如果<code class="fe mj mk ml mm b">monitor.didDrop()</code>为真，意味着如果拖动源与放下目标兼容，我们将调度一个动作。</li></ul><h1 id="c07b" class="lh li iq bd jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">最后润色</h1><p id="613d" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">我们上面的调度将向reducer发送一个动作，这个动作将改变项目的<code class="fe mj mk ml mm b">inCart </code>属性的状态。但是，为了完成这一部分，我们还需要处理一些事情。</p><ul class=""><li id="4445" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated">我们需要获取所有电话条目，并根据它们的<code class="fe mj mk ml mm b">inCart</code>属性是‘真’还是‘假’来过滤它们。“真”将显示在<code class="fe mj mk ml mm b">target list</code>部分，而“假”将保留在<code class="fe mj mk ml mm b">shopping list</code>部分。</li></ul><blockquote class="nb nc nd"><p id="bc49" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">查看<a class="ae lg" rel="noopener ugc nofollow" target="_blank" href="/build-a-shopping-cart-with-react-redux-and-react-dnd-part-2-b4cd649e25db">part 2</a>T27中名为<code class="fe mj mk ml mm b">resulting UI with Semantic UI</code>的图像，了解<code class="fe mj mk ml mm b">Shopping List</code>和<code class="fe mj mk ml mm b">Target Space</code>的位置</p></blockquote><p id="fdc1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated"><span class="l ky kz la bm lb lc ld le lf di">一</span> pp.js</p><p id="1f4f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">移动到<code class="fe mj mk ml mm b">scr/components/App.js</code>并修改代码如下</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="1cb0" class="nm li iq mm b gy oc od l oe of">// Lines of code stay the same here.<br/>  render(){<br/> <br/>    return (<br/>      &lt;Container /&gt;<br/>    );<br/>  }<br/>}</span><span id="6c7c" class="nm li iq mm b gy og od l oe of">export default connect()(App);</span></pre><p id="147d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请注意，我们移除了<code class="fe mj mk ml mm b">mapStateToProps</code>。此外，我们不需要像在<a class="ae lg" rel="noopener ugc nofollow" target="_blank" href="/build-a-shopping-cart-with-react-redux-and-react-dnd-part-3-f1e1e8265d14"> PART3 </a>中那样手动将我们的存储传递给<code class="fe mj mk ml mm b">Container</code>组件。因为，<code class="fe mj mk ml mm b">src/index.js</code>中的<code class="fe mj mk ml mm b">&lt;Provider &gt;</code>为我们处理。</p><blockquote class="nb nc nd"><p id="7cd2" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated"><code class="fe mj mk ml mm b">&lt;Provider /&gt;</code>使Redux <code class="fe mj mk ml mm b">store</code>对任何已经被包装在<code class="fe mj mk ml mm b">connect()</code>函数中的嵌套组件可用。</p></blockquote><p id="7668" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated"><span class="l ky kz la bm lb lc ld le lf di"> D </span> isplayPhone.js</p><p id="0ee0" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们上面提到过，我们必须在<code class="fe mj mk ml mm b">target space</code>和<code class="fe mj mk ml mm b">shopping list</code>部分显示电话项目。因此，我们将创建一个用于每种情况的组件，而不是重复的代码。</p><p id="f8b3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">创建组件<code class="fe mj mk ml mm b">src/components/DisplayPhone.js</code>并插入代码</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="09db" class="nm li iq mm b gy oc od l oe of">import React, { Component } from 'react';<br/>import { connect } from 'react-redux'</span><span id="ebe1" class="nm li iq mm b gy og od l oe of">import Phone from './Phone'</span><span id="dbe3" class="nm li iq mm b gy og od l oe of">class DisplayPhone extends Component {<br/>    render(){<br/>        const { phones, displayPhones } = this.props<br/>        return(<br/>            &lt;div&gt;<br/>                {displayPhones<br/>                    .map((phone) =&gt;(<br/>                        &lt;Phone <br/>                             key={phone} <br/>                             id={phone} <br/>                             brand={phones[phone].brand} /&gt;<br/>                        <br/>                ))}<br/>            &lt;/div&gt;<br/>        )<br/>    }<br/>}</span><span id="c9ec" class="nm li iq mm b gy og od l oe of">function mapStateToProps({phones}){</span><span id="a9fe" class="nm li iq mm b gy og od l oe of">return{<br/>        phones,<br/>    }<br/>  }</span><span id="5518" class="nm li iq mm b gy og od l oe of">export default connect(mapStateToProps)(DisplayPhone);</span></pre><ul class=""><li id="3d29" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated">它接受我们的商店(<code class="fe mj mk ml mm b">phones</code>)和一组要显示的电话id(<code class="fe mj mk ml mm b">displayPhones</code>)</li><li id="4084" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">然后，它使用<code class="fe mj mk ml mm b">Phone</code>组件创建用于显示的电话结构。</li></ul><p id="31c5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated"><span class="l ky kz la bm lb lc ld le lf di"> C </span> ontainer.js</p><p id="b127" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们的容器组件将被修改，为每个部分(<code class="fe mj mk ml mm b">target space</code>和<code class="fe mj mk ml mm b">shopping list</code>)提供要显示的正确的id数组。</p><p id="5364" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">移动到<code class="fe mj mk ml mm b">scr/components/Container.js</code>，修改代码如下</p><figure class="ni nj nk nl gt jr"><div class="bz fp l di"><div class="oh oi l"/></div></figure><ul class=""><li id="fd79" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated">我们在<strong class="kb ir">4、9线增加了两个进口。</strong></li><li id="c8e6" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">我们在<strong class="kb ir">行57 </strong>上的<code class="fe mj mk ml mm b">connect</code>函数将为我们的容器提供存储，并在作为<code class="fe mj mk ml mm b">props</code>输入我们的容器之前使用<code class="fe mj mk ml mm b">mapStateToProps</code>修改我们的存储。</li><li id="e1b5" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">我们的<code class="fe mj mk ml mm b">mapStateToProps()</code>函数接收我们的存储并创建两个数组<code class="fe mj mk ml mm b">inCart_phones</code>和<code class="fe mj mk ml mm b">outCart_phone</code>，每个数组保存电话商品的id。前者保存具有<code class="fe mj mk ml mm b">inCart</code>属性等于‘真’的电话的id，而后者保存具有<code class="fe mj mk ml mm b">inCart</code>属性等于‘假’的电话的id。</li><li id="67df" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">它从<strong class="kb ir">线13 </strong>上的<code class="fe mj mk ml mm b">props</code>中提取这些数组，并分别传递给<strong class="kb ir">线34 </strong>和<strong class="kb ir"> 36 </strong>上的部件<code class="fe mj mk ml mm b">DisplayPhone</code>和<code class="fe mj mk ml mm b">ShoppingCart</code>。</li><li id="94a5" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated"><strong class="kb ir">行34 </strong>将在<code class="fe mj mk ml mm b">shopping list</code>部分显示电话项目，而<strong class="kb ir">行36 </strong>将在<code class="fe mj mk ml mm b">target space</code>部分显示电话项目。</li></ul><p id="72d8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated">S  hoppingCart.js</p><p id="c086" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">该组件将接收数组<code class="fe mj mk ml mm b">inCart_phones</code>，该数组包含属性<code class="fe mj mk ml mm b">inCart</code>等于‘true’的电话项目的id，并在<code class="fe mj mk ml mm b">DisplayPhone</code>容器的帮助下显示它们。</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="3619" class="nm li iq mm b gy oc od l oe of">import React, { Component } from 'react'<br/>import { DropTarget } from 'react-dnd'</span><span id="5ef0" class="nm li iq mm b gy og od l oe of">import { ItemTypes } from './Constants'<br/><strong class="mm ir">import DisplayPhone from './DisplayPhone'</strong></span><span id="a1a7" class="nm li iq mm b gy og od l oe of"><em class="ne">// Lines of code stay the same here.<br/></em></span><span id="c688" class="nm li iq mm b gy og od l oe of">return connectDropTarget(<br/>            <strong class="mm ir">&lt;div className="shopping-cart" style={ style } &gt;<br/>                { !inCart_phones.length  &amp;&amp;<br/>                    (isActive<br/>                    ? 'Humm, phone!'<br/>                    : 'Drag here to order!')<br/>                }<br/>                { inCart_phones.length<br/>                ? &lt;DisplayPhone displayPhones = {inCart_phones} /&gt;<br/>                : null<br/>                }<br/>            &lt;/div&gt;</strong><br/>        )<br/>    }<br/>}</span><span id="950f" class="nm li iq mm b gy og od l oe of">export default DropTarget(ItemTypes.PHONE, ShoppingCartSpec, collect)(ShoppingCart);</span></pre><h2 id="43c1" class="nm li iq bd jy nn no dn lm np nq dp lq kk nr ns lu ko nt nu ly ks nv nw mc nx bi translated">中间件</h2><p id="5d30" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">为了确保我们的应用程序正常工作并便于调试，我们将引入一个中间件<code class="fe mj mk ml mm b">logger</code>，它将在我们与应用程序交互时记录我们的活动。</p><blockquote class="nb nc nd"><p id="dfa0" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">中间件在分派动作和动作到达缩减器之间提供了第三方扩展点。人们使用Redux中间件进行日志记录、崩溃报告、与异步API对话、路由等等</p></blockquote><p id="0101" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb ir">中间件:日志</strong></p><p id="c8bc" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如上所述，我们想要监控分派给我们的reducer的每一个动作。因此，我们的日志记录函数将打印以下内容。</p><ul class=""><li id="ae9d" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated">即将被派遣的行动<code class="fe mj mk ml mm b">type</code>。</li><li id="0085" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">行动开始后我们商店的新状态。</li></ul><p id="1dd8" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在开发应用程序时，logger()中间件函数的好处是巨大的。在这种情况下，它将拦截所有的调度调用，并记录已经被调度的动作以及reducer运行后的状态变化。然后，我们可以使用这些信息来跟踪我们的应用程序中正在发生的事情，并轻松地注意到任何潜在的错误。</p><p id="e177" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">创建文件<code class="fe mj mk ml mm b">src/middleware/logger.js</code>并插入代码</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="59e4" class="nm li iq mm b gy oc od l oe of">const logger = (store) =&gt; (next) =&gt; (action) =&gt;{<br/>    console.group(action.type)<br/>        console.log("The action: ",action)<br/>        const result = next(action);<br/>        console.log("New state is: ", store.getState())<br/>    console.groupEnd()<br/>    return result<br/>}</span><span id="7e41" class="nm li iq mm b gy og od l oe of">export default logger</span></pre><p id="c123" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我知道对吗？我们的logger()中间件函数看起来很奇怪。实际上它的作用是:</p><ul class=""><li id="76b4" class="mn mo iq kb b kc kd kg kh kk mp ko mq ks mr kw ms mt mu mv bi translated">我们的记录器是一个接收<code class="fe mj mk ml mm b">store</code>的函数，并返回一个接收<code class="fe mj mk ml mm b">next</code>的函数，接下来可能是另一个中间件或调度程序。这又返回了另一个函数，该函数接受我们的<code class="fe mj mk ml mm b">action</code>。所有这些都让我们可以使用这三个特性。</li><li id="98fb" class="mn mo iq kb b kc mw kg mx kk my ko mz ks na kw ms mt mu mv bi translated">然后它打印我们的动作的<code class="fe mj mk ml mm b">type</code>，然后它调用<code class="fe mj mk ml mm b">next</code>，在这种情况下<code class="fe mj mk ml mm b">dispatch, </code>传递给它我们的动作，并用<code class="fe mj mk ml mm b">store.getState()</code>获取我们的商店的新状态</li></ul><p id="1be9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb ir">应用中间件</strong></p><p id="a0e1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">为了将logger()中间件函数应用到redux中，我们将在将商店创建到<code class="fe mj mk ml mm b">createStore()</code>时传递它。但是首先，我们将使用<code class="fe mj mk ml mm b">applyMiddleware()</code>函数，它是一个<a class="ae lg" href="https://redux.js.org/glossary#store-enhancer" rel="noopener ugc nofollow" target="_blank">存储增强器</a>，然后将它传递给我们的<code class="fe mj mk ml mm b">createStore()</code>函数。</p><p id="460e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi kx translated">我 ndex.js</p><p id="a287" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">让我们将我们的<code class="fe mj mk ml mm b">logger()</code>中间件功能添加到存储增强器<code class="fe mj mk ml mm b">applyMiddleware()</code>中。创建文件<code class="fe mj mk ml mm b">src/middleware/index.js</code>并插入代码</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="95c2" class="nm li iq mm b gy oc od l oe of">import {applyMiddleware} from 'redux'</span><span id="c4f0" class="nm li iq mm b gy og od l oe of">import logger from './logger'</span><span id="c159" class="nm li iq mm b gy og od l oe of">export default applyMiddleware(<br/>    logger<br/>)</span></pre><blockquote class="nb nc nd"><p id="76f9" class="jz ka ne kb b kc kd ke kf kg kh ki kj nf kl km kn ng kp kq kr nh kt ku kv kw ij bi translated">注意，我们可以在<code class="fe mj mk ml mm b">applyMiddleware()</code>函数中添加任意多的中间件函数！中间件按照它们被提供给存储增强器的顺序被调用。</p></blockquote><p id="5a2d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">接下来，我们将把中间件添加到<code class="fe mj mk ml mm b">createStore()</code>功能中。移动到<code class="fe mj mk ml mm b">src/index.js</code>并修改代码如下</p><pre class="ni nj nk nl gt ny mm nz oa aw ob bi"><span id="2c6a" class="nm li iq mm b gy oc od l oe of">import React from 'react';<br/>import { render } from 'react-dom'<br/>import { Provider } from 'react-redux'<br/>import { createStore } from 'redux'</span><span id="1bf6" class="nm li iq mm b gy og od l oe of">import reducer from './reducers'<br/><strong class="mm ir">import middleware from './middleware'<br/></strong>import './index.css';<br/>import App from './components/App';</span><span id="251e" class="nm li iq mm b gy og od l oe of"><strong class="mm ir">let store = createStore(reducer, middleware)</strong></span><span id="deff" class="nm li iq mm b gy og od l oe of">render(<br/>  &lt;Provider store={ store }&gt;<br/>    &lt;App /&gt;<br/>  &lt;/Provider&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="47b5" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">检查这个分支的<a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/Move-Action" rel="noopener ugc nofollow" target="_blank">自述文件</a>以查看当一个电话项目被放入目标空间时<code class="fe mj mk ml mm b">logger()</code>会记录什么信息。</p><h1 id="7726" class="lh li iq bd jy lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="ddde" class="pw-post-body-paragraph jz ka iq kb b kc me ke kf kg mf ki kj kk mg km kn ko mh kq kr ks mi ku kv kw ij bi translated">这个旅程的第四部分是展示redux action、reducer、dispatch和中间件的使用。你可以在这里获得这部分<a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/Move-Action" rel="noopener ugc nofollow" target="_blank">的完整代码。<strong class="kb ir">接下来，我们将更新</strong> <code class="fe mj mk ml mm b"><strong class="kb ir">My cart</strong></code> <strong class="kb ir">部分，这样当一个电话项目被放入目标空间时，它的信息将显示在该部分中。查看这个分支</strong> </a><a class="ae lg" href="https://github.com/Eyongkevin/shopping-list---React-Redux-DragandDrop/tree/my-card" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir">自述</strong> </a> <strong class="kb ir">来领略一下我们接下来要看的</strong>。</p><p id="90f1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">不要错过我即将发布的第5部分。<strong class="kb ir">承诺</strong>！</p></div></div>    
</body>
</html>