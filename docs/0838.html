<html>
<head>
<title>Using React’s context API to provide a localization toolbox for your components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React的上下文API为组件提供本地化工具箱</h1>
<blockquote>原文：<a href="https://itnext.io/using-reacts-context-api-to-provide-a-localization-toolbox-for-your-components-48915f04bb54?source=collection_archive---------3-----------------------#2018-06-06">https://itnext.io/using-reacts-context-api-to-provide-a-localization-toolbox-for-your-components-48915f04bb54?source=collection_archive---------3-----------------------#2018-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3a59" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">简要概述了如何格式化时间和数字，如何使其与特定的语言环境相关，以及如何使用React的上下文API使这一切变得简单。</h2></div><h1 id="fd07" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">本地化很难</h1><p id="86ca" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">WooRank提供6种语言的服务:英语、西班牙语、法语、德语、荷兰语和葡萄牙语。这给了我们国际影响力，但也意味着要保持全面的一致性有些头疼。</p><p id="7ecd" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">我们的服务基于数据，基于数字、日期、价值和比率。有趣的是，每种语言都有不同的方式来格式化这些看似不言自明的信息。</p><p id="1c85" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">以英语中简单的日期/时间为例:<code class="fe lz ma mb mc b">June 5, 2018 3:56 PM</code>。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/e476c7d4f72ee10e80194bbf0085fecb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1huMhrCsbFZ8TzqbL1hKGA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">审核生成的日期和时间。</figcaption></figure><p id="d33c" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">下面是它在其他语言中的翻译:</p><ul class=""><li id="d48f" class="mt mu iq kz b la lu ld lv lg mv lk mw lo mx ls my mz na nb bi translated"><strong class="kz ir">西班牙语</strong> : <code class="fe lz ma mb mc b">5 junio de 2018 15:56</code></li><li id="c558" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated"><strong class="kz ir">法语</strong> : <code class="fe lz ma mb mc b">5 juin 2018 15:56</code></li><li id="64a5" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated"><strong class="kz ir">德语</strong> : <code class="fe lz ma mb mc b">5. Juni 2018 15:56</code></li><li id="9fcc" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated"><strong class="kz ir">荷兰语</strong> : <code class="fe lz ma mb mc b">5 juni 2018 15:56</code></li><li id="1b13" class="mt mu iq kz b la nc ld nd lg ne lk nf lo ng ls my mz na nb bi translated"><strong class="kz ir">葡萄牙语</strong> : <code class="fe lz ma mb mc b">5 de junho de 2018 15:56</code></li></ul><p id="ed49" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">相信我，你不会想设计自己的解决方案来从Unix时间戳自动生成这些内容。</p><p id="60d0" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">但是还有更多！当你需要显示百分比的时候呢？还是向下舍入一个值？当然，你可以像这样写一些不同的实用函数:</p><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="e479" class="nm kg iq mc b gy nn no l np nq">const formatPercent = number =&gt; Math.round(number * 10000) / 100;</span></pre><p id="bb1a" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">但是你真的想吗？</p><p id="9431" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">那么显示一个数字的简单任务呢？<code class="fe lz ma mb mc b">1,000,000</code>在英语中是正确的，但在法语、德语或荷兰语中是无意义的，在这些语言中这样的数字会被标注为<code class="fe lz ma mb mc b">1 000 000</code>。他们用逗号来标记小数点。在那些语言中，<code class="fe lz ma mb mc b">1,5</code>是正确的，而在英语中则是<code class="fe lz ma mb mc b">1.5</code>。</p><p id="f84e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这是一个全新的语言学和科学传统的世界，你也不会想进入最底层。</p><h1 id="f68b" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">一个解决了的问题…？</h1><p id="1fe7" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">幸运的是，格式化日期和数字的问题和互联网甚至计算机科学一样古老，非常聪明的人已经为我们解决了这个问题。在JavaScript世界中，这主要意味着使用<a class="ae lt" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank">矩</a>处理日期，使用<a class="ae lt" href="http://numeraljs.com/" rel="noopener ugc nofollow" target="_blank">数字</a>处理数字。</p><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="8a9d" class="nm kg iq mc b gy nn no l np nq">import moment from 'moment';<br/>import numeral from 'numeral';</span><span id="a054" class="nm kg iq mc b gy nr no l np nq">moment(1528206960000).format('LLL');<br/>// June 5, 2018 5:56 pm</span><span id="5661" class="nm kg iq mc b gy nr no l np nq">numeral(1000000).format();<br/>// 1,000,000<br/>numeral(1.5).format('0.0');<br/>// 1.5</span></pre><p id="466a" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">但是等等！我们还希望这些格式良好的数据能够根据用户选择的语言进行适当的本地化。这就是两个库都提供的<code class="fe lz ma mb mc b">locales</code> <strong class="kz ir"> </strong>发挥作用的地方。这些包含了所有必要的数据以保证一切正常(例如，这里是来自<code class="fe lz ma mb mc b">numeral</code>的<code class="fe lz ma mb mc b"><a class="ae lt" href="https://github.com/adamwdraper/Numeral-js/blob/master/locales/fr.js" rel="noopener ugc nofollow" target="_blank">‘fr’</a></code> <a class="ae lt" href="https://github.com/adamwdraper/Numeral-js/blob/master/locales/fr.js" rel="noopener ugc nofollow" target="_blank">区域设置</a>)。</p><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="1a19" class="nm kg iq mc b gy nn no l np nq">import moment from 'moment';<br/>import numeral from 'numeral';<br/>import 'numeral/locales';<br/>// yes, you have to import the locales from numeral manually</span><span id="4b88" class="nm kg iq mc b gy nr no l np nq">moment.locale('es');<br/>moment(1528206960000).format('LLL');<br/>// 5 de junio de 2018 15:56</span><span id="26bb" class="nm kg iq mc b gy nr no l np nq">numeral.locales('fr');<br/>numeral(1000000).format();<br/>// 1 000 000<br/>numeral(1.5).format('0.0');<br/>// 1,5</span></pre><p id="a9bf" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">那好吧。我将在需要本地化数据的地方导入这些库。还有那个<code class="fe lz ma mb mc b">locales</code>也是。然后我会获取当前的语言值。希望服务器和客户机在这一点上不会有分歧。但是我在哪里设置<code class="fe lz ma mb mc b">locale</code>值呢？每个组件一次？还是在app的顶层？嗯…</p><p id="aebd" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi">…</p><p id="4255" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">一定有更好的办法。</p><h1 id="9bfc" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">React的上下文API来拯救</h1><p id="d0ac" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated"><a class="ae lt" href="https://reactjs.org/blog/2018/03/29/react-v-16-3.html" rel="noopener ugc nofollow" target="_blank"> React 16.3 </a>得到了大量的炒作。喜欢，很多。尤其是因为<code class="fe lz ma mb mc b"><a class="ae lt" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">context</a></code> <a class="ae lt" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> API </a>的稳定实现。基本上，这是一种在React应用中传递数据的方式，而无需通过props自上而下地钻取数据，直到您需要它。实现我们目的的完美工具:构建一个<code class="fe lz ma mb mc b">localizationContext</code>,它将在React应用程序中的任何地方访问正确本地化的<code class="fe lz ma mb mc b">numeral</code>和<code class="fe lz ma mb mc b">moment</code>实例。</p><p id="e4dd" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated"><strong class="kz ir">编辑(2018年6月30日，星期六):</strong>正如在回应中观察到的，也正如WooRank的首席开发人员所回答的，这是一个在处理同构应用程序时特别有用的解决方案(即关注在客户端和服务器上渲染相同的代码)。对于纯粹的客户端spa来说，这可能是过度的和/或低效的。</p><p id="3c49" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">我们需要的零件是:</p><ul class=""><li id="8365" class="mt mu iq kz b la lu ld lv lg mv lk mw lo mx ls my mz na nb bi translated">一个根<code class="fe lz ma mb mc b">App</code>，我们将在这里创建<code class="fe lz ma mb mc b">moment</code>和<code class="fe lz ma mb mc b">numeral</code>的本地化版本。对于<code class="fe lz ma mb mc b">moment</code>，我们可以通过在它上面调用<code class="fe lz ma mb mc b">.locale(lang)</code>来创建一个本地化的实例。不幸的是，<code class="fe lz ma mb mc b">numeral</code>还不支持这个，所以我们必须全局设置区域设置。</li></ul><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="b384" class="nm kg iq mc b gy nn no l np nq">const lang = "en";</span><span id="7b9a" class="nm kg iq mc b gy nr no l np nq">const localizedMoment = (...args) =&gt; {<br/>  return moment(...args).locale(lang);<br/>};</span><span id="1222" class="nm kg iq mc b gy nr no l np nq">const localizedNumeral = (...args) =&gt; {<br/>  numeral.locale(lang);<br/>  return numeral(...args);<br/>}</span><span id="033d" class="nm kg iq mc b gy nr no l np nq">  return numeral(...args);<br/>}</span><span id="5d8a" class="nm kg iq mc b gy nr no l np nq">localizedMoment(1528206960000).format('LLL');<br/>// June 5, 2018 5:56 pm</span><span id="2754" class="nm kg iq mc b gy nr no l np nq">localizedNumeral(1000000).format();<br/>// 1.000.000</span></pre><ul class=""><li id="453e" class="mt mu iq kz b la lu ld lv lg mv lk mw lo mx ls my mz na nb bi translated">一个反应<code class="fe lz ma mb mc b">Context</code>给我们进入<code class="fe lz ma mb mc b">Provider</code>(它将在它的<code class="fe lz ma mb mc b">value</code>道具上接受我们的<code class="fe lz ma mb mc b">localizedMoment</code>和<code class="fe lz ma mb mc b">localizedNumeral</code>)…</li></ul><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="d763" class="nm kg iq mc b gy nn no l np nq">const Context = React.createContext();</span><span id="c102" class="nm kg iq mc b gy nr no l np nq">const ContextProvider = props =&gt; {<br/>  return (<br/>    &lt;Context.Provider<br/>      value={{<br/>        moment: props.moment,<br/>        numeral: props.numeral<br/>      }}<br/>    &gt;<br/>      {props.children}<br/>    &lt;/Context.Provider&gt;<br/>  );<br/>};</span></pre><ul class=""><li id="2b7b" class="mt mu iq kz b la lu ld lv lg mv lk mw lo mx ls my mz na nb bi translated">…让我们能够访问<code class="fe lz ma mb mc b">Consumer</code>，这将使我们能够在组件中检索<code class="fe lz ma mb mc b">localizedMoment</code>和<code class="fe lz ma mb mc b">localizedNumeral</code>。因为我们预计我们会经常需要这些组件，并且我们懒得将每个需要它的<code class="fe lz ma mb mc b">div</code>封装在一个<code class="fe lz ma mb mc b">&lt;Context.Consumer&gt;</code>中，所以我们将创建一个<code class="fe lz ma mb mc b">withLocalization</code> <a class="ae lt" href="https://reactjs.org/docs/higher-order-components.html" rel="noopener ugc nofollow" target="_blank">高阶组件</a>，它接受一个组件并返回相同的组件，但是将我们的本地化工具箱合并到它的props中！</li></ul><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="f65b" class="nm kg iq mc b gy nn no l np nq">const withLocalization = Component =&gt; {<br/>  return function LocalizedComponent (props) {<br/>    return (<br/>      &lt;Context.Consumer&gt;<br/>        {context =&gt; {<br/>          return &lt;Component<br/>            {...props}<br/>            moment={context.moment}<br/>            numeral={context.numeral}<br/>          /&gt;;<br/>        }}<br/>      &lt;/Context.Consumer&gt;<br/>    );<br/>  };<br/>}</span></pre><h1 id="18a8" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">插上电源</h1><p id="6c68" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">是时候把所有东西放在一起了！您的应用程序的根可能如下所示:</p><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="d81c" class="nm kg iq mc b gy nn no l np nq">const time = 1528206960000;<br/>const data = { amount: 19879989776, fraction: 0.22 };</span><span id="eeea" class="nm kg iq mc b gy nr no l np nq">const App = () =&gt; (<br/>  &lt;ContextProvider<br/>    moment={localizedMoment}<br/>    numeral={localizedNumeral}<br/>  &gt;<br/>    &lt;Localized data={data} time={time} /&gt;<br/>  &lt;/ContextProvider&gt;<br/>);</span><span id="a0db" class="nm kg iq mc b gy nr no l np nq">render(&lt;App /&gt;, document.getElementById("root"));</span></pre><p id="7ea8" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">虽然您的<code class="fe lz ma mb mc b">Localized</code>组件可能看起来像这样(注意我们如何通过将它包装在我们的<code class="fe lz ma mb mc b">withLocalization</code>高阶组件中来访问其道具上的<code class="fe lz ma mb mc b">moment</code>和<code class="fe lz ma mb mc b">numeral</code>):</p><pre class="me mf mg mh gt ni mc nj nk aw nl bi"><span id="49fa" class="nm kg iq mc b gy nn no l np nq">import { withLocalization } from "./localizationContext";</span><span id="6701" class="nm kg iq mc b gy nr no l np nq">const Localized = ({ data, time, moment, numeral }) =&gt; {<br/>  const localizedDate = moment(time).format("LLL");<br/>  const localizedAmount = numeral(data.amount).format();<br/>  const formattedFraction = numeral(data.fraction).format("0%");</span><span id="bfcc" class="nm kg iq mc b gy nr no l np nq">return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;h1&gt;Date : {localizedDate}&lt;/h1&gt;<br/>      &lt;h1&gt;Amount : {localizedAmount}&lt;/h1&gt;<br/>      &lt;h1&gt;Percent : {formattedFraction}&lt;/h1&gt;<br/>    &lt;/React.Fragment&gt;<br/>  );<br/>};</span><span id="1184" class="nm kg iq mc b gy nr no l np nq">export default withLocalization(Localized);</span></pre><p id="3886" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这是你应该能得到的结果！</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ns"><img src="../Images/e7fd999b2f9d4eff0f39fdc95d20c07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zo37Kp3knixjAGwuupjmpQ.gif"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">更改应用程序根目录的区域设置值</figcaption></figure><p id="676f" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">从那时起，您可以向您的本地化上下文添加各种其他工具，如<code class="fe lz ma mb mc b">translate</code>函数或时区处理！</p><p id="7a48" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">我希望你已经学到了一些东西，并且，请为这个小项目 ~~</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk translated">这个小项目的代码沙箱</figcaption></figure></div></div>    
</body>
</html>