<html>
<head>
<title>You need to know curry</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你需要了解库里</h1>
<blockquote>原文：<a href="https://itnext.io/you-need-to-know-curry-8822772a1fab?source=collection_archive---------10-----------------------#2018-03-14">https://itnext.io/you-need-to-know-curry-8822772a1fab?source=collection_archive---------10-----------------------#2018-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/eb19496e9ac77e83daf330f420572ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YxRl6YIAbyYLp1PpkSo_7Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图像可能受版权保护</figcaption></figure><div class=""/><h1 id="39c7" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">职能是一等公民</h1><p id="02d5" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">函数在JavaScript中是一等公民，与其他类型(如数字、数组、对象)一样。它们可以用作参数，也可以作为其他函数的返回值。</p><p id="040f" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">举个简单的例子，如果我们的目标是打印出一个数组中的所有元素，大多数人可能会这样做:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="dbe6" class="mm kd jf mi b gy mn mo l mp mq">function printWithLoop(arr) {<br/>    for (let i = 0, len = arr.length; i &lt; len; i++) {<br/>        console.log(arr[i]);<br/>    }<br/>}</span></pre><p id="d3cd" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">如果你对高阶函数有点熟悉，你可能会倾向于使用<a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" rel="noopener ugc nofollow" target="_blank"> Array.prototype.forEach </a>:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c825" class="mm kd jf mi b gy mn mo l mp mq">function printWithIterator(arr) {<br/>    (arr || []).forEach(it =&gt; {<br/>        console.log(it);<br/>    });<br/>}</span></pre><p id="e434" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">然后，我们可以通过以下方式进一步简化代码:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="75a8" class="mm kd jf mi b gy mn mo l mp mq">function simplePrint(arr) {<br/>    (arr || []).forEach(console.log);<br/>}</span></pre><p id="783c" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated"><strong class="lc jg">这里再想一想，<em class="ms"> simplePrint </em>的输出与<em class="ms"> printWithIterator </em>的输出是否完全相同？如果不是，你能解释一下有什么不同吗？</strong></p><h1 id="0e1d" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">函数重载</h1><p id="cd7e" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">函数重载使函数能够根据分段的数量或类型表现出不同的行为。例如<a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from" rel="noopener ugc nofollow" target="_blank"> Array.from </a>。</p><ul class=""><li id="22d6" class="mt mu jf lc b ld ly lh lz ll mv lp mw lt mx lx my mz na nb bi translated">当给定一个参数时，它简单地从一个类似数组或可迭代的对象创建一个新的数组实例</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5738" class="mm kd jf mi b gy mn mo l mp mq">let set = new Set(['foo', 'bar', 'foo']);<br/>console.log(Array.from(set)); //["foo", "bar"]</span></pre><ul class=""><li id="2d75" class="mt mu jf lc b ld ly lh lz ll mv lp mw lt mx lx my mz na nb bi translated">当给定可选的第二个参数<em class="ms"> mapFn </em>时，它将在创建新数组时将<em class="ms"> mapFn </em>应用于每个元素。</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="27d7" class="mm kd jf mi b gy mn mo l mp mq">console.log(Array.from([1, 2, 3], x =&gt; x + x)); // [2, 4, 6]</span></pre><h1 id="9ee6" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">咖喱菜肴</h1><p id="c673" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">库里，也叫局部应用。Currying一个函数基本上意味着一个函数将吸收一些参数并返回另一个函数供以后调用。返回函数可以通过<a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noopener ugc nofollow" target="_blank">闭包</a>访问已经被吸收的参数。</p><h1 id="e138" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">参数与自变量</h1><p id="d99d" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">首先我们需要理解函数中的两个基本概念。</p><ul class=""><li id="d02d" class="mt mu jf lc b ld ly lh lz ll mv lp mw lt mx lx my mz na nb bi translated">参数:函数声明中的占位符。我们可以使用<em class="ms"> function.length </em>来获取参数的个数。</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="851e" class="mm kd jf mi b gy mn mo l mp mq">function A(a, b) {}<br/>// a and b are parameters<br/>console.log(A.length); //2</span></pre><ul class=""><li id="717d" class="mt mu jf lc b ld ly lh lz ll mv lp mw lt mx lx my mz na nb bi translated">参数:应用函数时传递给函数的值。我们可以使用<em class="ms">参数</em>来获得参数列表。</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="4d2c" class="mm kd jf mi b gy mn mo l mp mq">function B(a, b) {<br/>    console.log(arguments);<br/>}</span><span id="f8b6" class="mm kd jf mi b gy nc mo l mp mq">B(1,2,3); // 1,2,3</span></pre><p id="d8ca" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">总而言之，参数是你<em class="ms">期望的</em>，而参数是你<em class="ms">得到的</em>。</p><h1 id="396d" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">咖喱的例子</h1><p id="ce75" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated">假设我们有一个函数来计算三个数的和。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="97ea" class="mm kd jf mi b gy mn mo l mp mq">function sum(x, y, z) {<br/>    console.log(x + y + z);<br/>}</span><span id="edb9" class="mm kd jf mi b gy nc mo l mp mq">sum(1,2,3); //6</span></pre><p id="fa3a" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">如果我们想达到以下结果:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1af7" class="mm kd jf mi b gy mn mo l mp mq">sum(1,2,3); //6<br/>sum(1)(2,3); //6<br/>sum(1,2)(3); //6</span></pre><p id="d488" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">深看一下，我们想要实现的是，当函数<em class="ms"> sum </em>收到它所期望的自变量(即三个数)时，它会计算它们的和并返回值。否则，它将继续返回另一个函数(例如sum(1)和sum(1，2)都返回另一个函数)，该函数可以用更多的数字调用。这是咖喱！</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="83fe" class="mm kd jf mi b gy mn mo l mp mq">function curry(fn) { //Let's ignore the function context for simplicity<br/>    return function f(...args) {<br/>        /**<br/>         * if the number of passed in arguments is more than what we expect<br/>         * invoke the function and return the result<br/>         */<br/>        if(args.length &gt;= fn.length) { <br/>            return fn.apply(this, args);<br/>        } else {<br/>            //return another function which can access to the passed arguments through closure<br/>            return function(...arr) { <br/>                return f.apply(this, args.concat(arr));<br/>            }<br/>        }<br/>    }<br/>}</span><span id="d8ce" class="mm kd jf mi b gy nc mo l mp mq">let sumWithCurry = curry(sum);<br/>sumWithCurry(1,2,3); //6<br/>sumWithCurry(1)(2,3); //6<br/>sumWithCurry(1,2)(3); //6</span></pre><h1 id="6415" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" rel="noopener ugc nofollow" target="_blank">函数.原型.绑定</a></h1><p id="fc27" class="pw-post-body-paragraph la lb jf lc b ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ij bi translated"><a class="ae mr" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" rel="noopener ugc nofollow" target="_blank"> Function.prototype.bind </a>有两个主要功能:</p><ul class=""><li id="b61d" class="mt mu jf lc b ld ly lh lz ll mv lp mw lt mx lx my mz na nb bi translated">绑定函数上下文<em class="ms">这个</em></li><li id="e7ec" class="mt mu jf lc b ld nd lh ne ll nf lp ng lt nh lx my mz na nb bi translated">咖喱菜肴</li></ul><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f700" class="mm kd jf mi b gy mn mo l mp mq">function sayHi(greeting, ending) {<br/>    console.log(`My name is ${this.name}, ${greeting}. ${ending}!`);<br/>}</span><span id="8978" class="mm kd jf mi b gy nc mo l mp mq">let fn = sayHi.bind({name: 'mike'}, 'Love you'); // greeting is absorded<br/>fn('Thanks!'); // My name is mike, Love you. Thanks!!</span></pre><p id="16e3" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">在开发中，我们可以使用curry编写更优雅的代码:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1aab" class="mm kd jf mi b gy mn mo l mp mq">function print(arr) {<br/>    console.log(arr.join('|'));<br/>}</span><span id="56d1" class="mm kd jf mi b gy nc mo l mp mq">let arr = [1,2,3];<br/>setTimeout(function(){<br/>    print([1,2,3]);<br/>}, 1000);<br/>// 1|2|3</span></pre><p id="566c" class="pw-post-body-paragraph la lb jf lc b ld ly lf lg lh lz lj lk ll ma ln lo lp mb lr ls lt mc lv lw lx ij bi translated">相当于</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b496" class="mm kd jf mi b gy mn mo l mp mq">function print(arr) {<br/>    console.log(arr.join('|'));<br/>}</span><span id="c153" class="mm kd jf mi b gy nc mo l mp mq">let arr = [1,2,3];<br/>setTimeout(print.bind(null, arr), 1000);<br/>// 1|2|3</span></pre><h1 id="c4ba" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">参考</h1><ul class=""><li id="14e5" class="mt mu jf lc b ld le lh li ll ni lp nj lt nk lx my mz na nb bi translated"><a class="ae mr" href="https://www.amazon.com/Effective-JavaScript-Specific-Software-Development/dp/0321812182/ref=sr_1_3?s=books&amp;ie=UTF8&amp;qid=1521248523&amp;sr=1-3&amp;keywords=Effective+JavaScript" rel="noopener ugc nofollow" target="_blank">有效的JavaScript </a></li></ul><h1 id="2f7d" class="kc kd jf bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">通知；注意</h1><ul class=""><li id="643c" class="mt mu jf lc b ld le lh li ll ni lp nj lt nk lx my mz na nb bi translated">读书笔记系列如果想关注最新的新闻/文章，请<a class="ae mr" href="https://github.com/n0ruSh/the-art-of-reading" rel="noopener ugc nofollow" target="_blank">【观看】</a>订阅。</li></ul></div></div>    
</body>
</html>