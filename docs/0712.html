<html>
<head>
<title>Love live data in Firestore but need to work with something static?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">喜欢Firestore中的实时数据，但需要处理静态数据？</h1>
<blockquote>原文：<a href="https://itnext.io/love-live-data-in-firestore-but-need-to-work-with-something-static-31a5e0a1a9ba?source=collection_archive---------4-----------------------#2018-05-11">https://itnext.io/love-live-data-in-firestore-but-need-to-work-with-something-static-31a5e0a1a9ba?source=collection_archive---------4-----------------------#2018-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8978ad4a26b5dea3bd8a29bb73cc829d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9FZNED95MpV5dNzD."/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk translated">奥斯卡·伊尔迪兹在<a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="1077" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我正在开发一个应用程序，我想在单击时向列表项添加一个简单的动画，并应用一些幕后代码将该项添加到Firestore的一个组中。</p><p id="f928" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我考虑这样做的方法是在列表项上切换一个类，然后像这样激活该项(注意我使用的是Angular，但本文适用于所有框架):</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="30b7" class="lk ll iq lg b gy lm ln l lo lp">onClickItem(): void {<br/>   item.isActive = true;<br/>}</span><span id="6ba9" class="lk ll iq lg b gy lq ln l lo lp">animations: [<br/>   trigger("isActive", [<br/>      state("true", style({<br/>         backgroundColor: "#08aeea",<br/>         color: "#fff"<br/>      })),<br/>      transition("* =&gt; true", animate("150ms ease-in"))<br/>   ])<br/>]</span></pre><p id="cbac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，太简单了。我在我的列表上试着这样做，瞧，像魔法一样工作，然后我注意到一些有趣的事情，偶尔我会点击列表项目，动画会运行一半，闪烁，然后恢复正常——这是怎么回事？？？</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="8d39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不打算说谎这确实难倒了我大约一个小时。然后我看了看我是如何在Firestore上呈现我的清单的:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="39be" class="lk ll iq lg b gy lm ln l lo lp"><br/>this.groups$ = this.getGroupsAsObservable(); <br/>// groups$ to indicate is an Observable</span><span id="4876" class="lk ll iq lg b gy lq ln l lo lp">getGroupsAsObservable(): Observable&lt;Group[]&gt; {<br/>   return this.afs.collection&lt;Group&gt;("groups").valueChanges();<br/>}</span></pre><blockquote class="ly lz ma"><p id="350f" class="kd ke mb kf b kg kh ki kj kk kl km kn mc kp kq kr md kt ku kv me kx ky kz la ij bi translated">注意valueChanges()部分——这是允许你的应用从firestore直播数据的秘方</p></blockquote><p id="2c78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在发生的是，当点击该项目时，它会在后台检查该项目是否属于某个组，如果不属于，它会将该项目添加到该组，并在Firestore中列出该组(一个对象)的相关项目的小块数据。</p><p id="425f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着该组的文档发生了变化，并将在我们的应用程序中触发重新呈现！</p><p id="060d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我意识到我需要我的组列表是纯静态的地方。</p><p id="bafa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mb">这实际上有点棘手，文档中没有明确提到“静态”或“读取一次”数据</em>。</p><p id="dd2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我需要数据的第一件事是返回数据的快照。文件中有一点是这样的:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="19cc" class="lk ll iq lg b gy lm ln l lo lp">getUsersGroupsOnce(userId): Promise&lt;QuerySnapshot&gt; { <br/>// return a static snapshot of the users groups</span><span id="60ee" class="lk ll iq lg b gy lq ln l lo lp">   return this.afs.collection("groups", ref =&gt;      <br/>      ref.where(`users.${userId}`, "==", true)<br/>   )<br/>   .ref.get(); // this is the static part</span><span id="d1e7" class="lk ll iq lg b gy lq ln l lo lp">}</span></pre><p id="950e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好，现在我有了一个静态引用—我需要为它构建一个数组，按照我做的文档:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="03ee" class="lk ll iq lg b gy lm ln l lo lp">this.fb.getUsersGroupsOnce(user.uid).then(q =&gt; {<br/>   q.forEach(doc =&gt; {<br/>     console.log(doc.data())<br/>   });<br/>});</span></pre><p id="65bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，现在我有了数据，我只需要把它推到一个数组中，对吗？我试过这个:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="acfc" class="lk ll iq lg b gy lm ln l lo lp">q.forEach(doc =&gt; {<br/>   this.groups.push(doc.data());<br/>});</span></pre><p id="da9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是typescript在抱怨，所以我就像这样强迫它:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="d479" class="lk ll iq lg b gy lm ln l lo lp">q.forEach(doc =&gt; {<br/>   this.groups.push(doc.data() as Group);<br/>});</span></pre><p id="f849" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">瞧，我现在有了一个静态的— <em class="mb">或者我喜欢称之为‘read once’</em>列表。现在我知道99/100的实时数据流很棒，但是知道如何不时地获取静态数据也很方便。</p><p id="f11e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有更好的方法吗？欢迎在下方留言评论。</p></div></div>    
</body>
</html>